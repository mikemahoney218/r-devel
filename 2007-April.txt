From rfrancois at mango-solutions.com  Sun Apr  1 09:51:20 2007
From: rfrancois at mango-solutions.com (Romain Francois)
Date: Sun, 01 Apr 2007 08:51:20 +0100
Subject: [Rd] Probem with argument "append" in "Rprof"
In-Reply-To: <460EC5A6.8080401@mango-solutions.com>
References: <460EC5A6.8080401@mango-solutions.com>
Message-ID: <460F6478.3050308@mango-solutions.com>

.... And now I realize I gave the patches in the wrong order, let me try
again

Cheers,

Romain

Romain Francois wrote:
> [forgot to attach the second patch in the first mail, sorry.]
>
> Hello,
>
> Appending information to the profiler's output seems to generate
> problems. Here is a small example of code :
>
> <code r>
> require(boot)
> Rprof( memory.profiling = TRUE)
> Rprof(NULL)
> for(i in 1:2){
>   Rprof( memory.profiling = TRUE, append = TRUE)
>   example(boot)
>   Rprof(NULL)
> }
> </code>
>
> The problem is that the file Rprof.out contains more than once the
> header information:
>
> $ grep "sample.interval=" Rprof.out
> memory profiling: sample.interval=20000
> memory profiling: sample.interval=20000
> memory profiling: sample.interval=20000
>
> and `summaryRprof` or `R CMD Rprof` are not dealing with it
>
>   
>> idx <- grep( "sample", rownames( smp <- summaryRprof()[[1]] ) );
>>     
> smp[idx, ]
>                       self.time self.pct total.time total.pct
> sample.interval=20000         0        0       0.04       0.1
>
> `sample.interval=20000` is incorrectly considered as a function.
>
>
> This is not too much of a big deal, but then if I ask for memory
> profiling information as well, I get nothing:
>
>   
>> summaryRprof( mem = "stats")
>>     
> Error in tapply(1:1L, list(index = c("sample.interval=20000:profiling:",  :
>         arguments must have same length
>   
>> summaryRprof( mem = "tseries")
>>     
> Error in data.frame(..., check.names = FALSE) :
>         arguments imply differing number of rows: 1, 1490
>   
>> summaryRprof( mem = "both")
>>     
> Error in apply(sapply(strsplit(memstuff, ":"), as.numeric), 1, diff) :
>         dim(X) must have a positive length
>
> $ R CMD Rprof Rprof.out
>
> Each sample represents  seconds.
> Total run time: 0 seconds.
>
> Total seconds: time spent in function and callees.
> Self seconds: time spent in function alone.
>
>    %       total       %       self
>  total    seconds     self    seconds    name
> Illegal division by zero at /usr/local/lib/R/bin/Rprof line 91, <> line
> 1491.
>
> A quick fix could be to ignore all the lines containing sample.interval=
> except the first one, but then if someone wants to actually change the
> interval argument in Rprof, it would not be correct. I attach a patch
> against R-devel/src/library/utils/R/summRprof.R to do that anyway, but I
> will look at a better solution.
>
> I am not fluent enough in Perl to do the same in the Rprof script, it
> looks like it does not handle the memory profiling information anyway. I
> am about to learn Perl, so I guess it could be a useful way to do it. I
> also attach a patch against R-devel/src/scripts/Rprof that would at
> least get rid of the memory profiling information (if any). This is not
> as good as dealing with it, but ... this is the first time I ever touch
> a Perl script.
>
>
> Cheers,
>
> Romain
>
>
>
>   
>> version
>>     
>
> _
> platform
> i686-pc-linux-gnu
> arch
> i686
> os
> linux-gnu
> system         i686,
> linux-gnu
> status         Under development
> (unstable)
> major
> 2
> minor          6.0
> year
> 2007
> month
> 03
> day
> 30
> svn rev
> 40983
> language
> R
> version.string R version 2.6.0 Under development (unstable) (2007-03-30
> r40983)
>   
-- 
Mango Solutions
data analysis that delivers

Tel:  +44(0) 1249 467 467
Fax:  +44(0) 1249 467 468
Mob:  +44(0) 7813 526 123

-------------- next part --------------
A non-text attachment was scrubbed...
Name: summRprof.patch
Type: text/x-patch
Size: 770 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20070401/22c8ab4c/attachment.bin 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Rprof.patch
Type: text/x-patch
Size: 412 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20070401/22c8ab4c/attachment-0001.bin 

From renaud.lancelot at gmail.com  Sun Apr  1 11:54:34 2007
From: renaud.lancelot at gmail.com (Renaud Lancelot)
Date: Sun, 1 Apr 2007 11:54:34 +0200
Subject: [Rd] new warnings related to the extractor "$" with R 2.5.0alpha
Message-ID: <c2ee56800704010254w68c4f5b5ke51a7aca1e4a93ed@mail.gmail.com>

Dear all,

I just installed R 2.5.0alpha and noticed new warnings related to the
extractor "$" when using contributed packages. For instance:

> library(RODBC)
Warning message:
$ operator is not valid for atomic vectors, returning NULL

> library(aod)
Package aod, version 1.1-18
> data(orob2)
> m1 <- betabin(cbind(y, n-y) ~ 1, random = ~ 1, data = orob2)
> head(residuals(m1))
         1          2          3          4          5          6
-1.4629774 -0.7897877 -1.3754283  0.1029910 -0.3556985  1.4030026
Warning message:
$ operator not defined for this S4 class, returning NULL

In these two cases, I deleted the former installations and re-built
the packages from sources.

How to overcome this problem ?

Kind regards,

Renaud

##################

> sessionInfo()
R version 2.5.0 alpha (2007-03-30 r40957)
i386-pc-mingw32

locale:
LC_COLLATE=French_France.1252;LC_CTYPE=French_France.1252;LC_MONETARY=French_France.1252;LC_NUMERIC=C;LC_TIME=French_France.1252

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"
"tcltk"     "methods"   "base"

other attached packages:
     aod    RODBC fortunes     svIO   R2HTML   svMisc svSocket    svIDE
"1.1-18"  "1.1-8"  "1.3-2"  "0.9-5"   "1.58"  "0.9-5"  "0.9-5"  "0.9-5"



-- 
Renaud LANCELOT
D?partement Syst?mes Biologiques du CIRAD
CIRAD, Biological Systems Department

Campus International de Baillarguet
TA 30 / B
F34398 Montpellier
Tel   +33 (0)4 67 59 37 17
Secr. +33 (0)4 67 59 37 37
Fax   +33 (0)4 67 59 37 95


From ripley at stats.ox.ac.uk  Sun Apr  1 12:32:40 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 1 Apr 2007 11:32:40 +0100 (BST)
Subject: [Rd] new warnings related to the extractor "$" with R 2.5.0alpha
In-Reply-To: <c2ee56800704010254w68c4f5b5ke51a7aca1e4a93ed@mail.gmail.com>
References: <c2ee56800704010254w68c4f5b5ke51a7aca1e4a93ed@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0704011119390.14756@gannet.stats.ox.ac.uk>

On Sun, 1 Apr 2007, Renaud Lancelot wrote:

> Dear all,
>
> I just installed R 2.5.0alpha and noticed new warnings related to the
> extractor "$" when using contributed packages. For instance:
>
>> library(RODBC)
> Warning message:
> $ operator is not valid for atomic vectors, returning NULL
>
>> library(aod)
> Package aod, version 1.1-18
>> data(orob2)
>> m1 <- betabin(cbind(y, n-y) ~ 1, random = ~ 1, data = orob2)
>> head(residuals(m1))
>         1          2          3          4          5          6
> -1.4629774 -0.7897877 -1.3754283  0.1029910 -0.3556985  1.4030026
> Warning message:
> $ operator not defined for this S4 class, returning NULL
>
> In these two cases, I deleted the former installations and re-built
> the packages from sources.
>
> How to overcome this problem ?

Wait for package updates.  For RODBC, it is harmless but the warning will 
not appear in 1.1-9 (which will be released before R 2.5.0 is).

(The first message is not really right: $ for lists was valid and 
documented to return NULL in released versions of R, as it was in the Blue 
Book.  It should say that it is 'deprecated' in R 2.5.0, since this 
amounts to a change of language definition and that should be giving a 
warning of deprecation.)

Later versions of R 2.5.0 alpha give more informative messages.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From renaud.lancelot at gmail.com  Sun Apr  1 13:17:27 2007
From: renaud.lancelot at gmail.com (Renaud Lancelot)
Date: Sun, 1 Apr 2007 13:17:27 +0200
Subject: [Rd] new warnings related to the extractor "$" with R 2.5.0alpha
In-Reply-To: <Pine.LNX.4.64.0704011119390.14756@gannet.stats.ox.ac.uk>
References: <c2ee56800704010254w68c4f5b5ke51a7aca1e4a93ed@mail.gmail.com>
	<Pine.LNX.4.64.0704011119390.14756@gannet.stats.ox.ac.uk>
Message-ID: <c2ee56800704010417g57087b85s4997f947070b9b86@mail.gmail.com>

Thank you for this explanation. As the package maintainer for aod
(second warning message), I found where the warning came from and will
post an update soon.

Kind regards,

Renaud

2007/4/1, Prof Brian Ripley <ripley at stats.ox.ac.uk>:
> On Sun, 1 Apr 2007, Renaud Lancelot wrote:
>
> > Dear all,
> >
> > I just installed R 2.5.0alpha and noticed new warnings related to the
> > extractor "$" when using contributed packages. For instance:
> >
> >> library(RODBC)
> > Warning message:
> > $ operator is not valid for atomic vectors, returning NULL
> >
> >> library(aod)
> > Package aod, version 1.1-18
> >> data(orob2)
> >> m1 <- betabin(cbind(y, n-y) ~ 1, random = ~ 1, data = orob2)
> >> head(residuals(m1))
> >         1          2          3          4          5          6
> > -1.4629774 -0.7897877 -1.3754283  0.1029910 -0.3556985  1.4030026
> > Warning message:
> > $ operator not defined for this S4 class, returning NULL
> >
> > In these two cases, I deleted the former installations and re-built
> > the packages from sources.
> >
> > How to overcome this problem ?
>
> Wait for package updates.  For RODBC, it is harmless but the warning will
> not appear in 1.1-9 (which will be released before R 2.5.0 is).
>
> (The first message is not really right: $ for lists was valid and
> documented to return NULL in released versions of R, as it was in the Blue
> Book.  It should say that it is 'deprecated' in R 2.5.0, since this
> amounts to a change of language definition and that should be giving a
> warning of deprecation.)
>
> Later versions of R 2.5.0 alpha give more informative messages.
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


-- 
Renaud LANCELOT
D?partement Syst?mes Biologiques du CIRAD
CIRAD, Biological Systems Department

Campus International de Baillarguet
TA 30 / B
F34398 Montpellier
Tel   +33 (0)4 67 59 37 17
Secr. +33 (0)4 67 59 37 37
Fax   +33 (0)4 67 59 37 95


From elff at sowi.uni-mannheim.de  Sun Apr  1 15:32:10 2007
From: elff at sowi.uni-mannheim.de (Martin Elff)
Date: Sun, 1 Apr 2007 15:32:10 +0200
Subject: [Rd] checking existence of active bindings
In-Reply-To: <460AE471.3040702@acm.org>
References: <460AE471.3040702@acm.org>
Message-ID: <200704011532.11148.elff@sowi.uni-mannheim.de>

On Wednesday 28 March 2007 23:56, Tony Plate wrote:
> Is there any way to check whether an active binding exists without
> actually calling the active binding?  I'd like to be able to do
> something like exists("x", ...) and know whether "x" exists without
> actually fetching its value if it is an active binding (because it could
> consume significant resources to fetch the value).
>
>  > exists("x", inherits=FALSE)
>
> getting x1
> [1] TRUE
>

As you most probably found out for yourself - this works
as intended.
> "x" %in% ls(globalenv())
[1] TRUE


Best,

Martin


From jfox at mcmaster.ca  Sun Apr  1 15:57:42 2007
From: jfox at mcmaster.ca (John Fox)
Date: Sun, 1 Apr 2007 09:57:42 -0400
Subject: [Rd] Non-unique column names in data frames
Message-ID: <20070401135743.EZTQ1612.tomts36-srv.bellnexxia.net@JohnDesktop8300>

Dear r-devel members,

It's just been brought to my attention that R permits non-unique column
names in data frames -- e.g., via assignment to names() or colnames(). This
behaviour is consistent with the help files (as I discovered), but it's not
consistent with the behaviour of rownames() and row.names(). For example,

	row.names(airquality) <- rep("a", nrow(airquality)) 

generates an error, but 

	names(airquality) <- rep("a", ncol(airquality))

or even 

	names(airquality) <- rep("", ncol(airquality))

do not.

I figure that there must be some rationale for this difference, but I can't
think of what it might be. Any thoughts?

Regards,
 John

--------------------------------
John Fox
Department of Sociology
McMaster University
Hamilton, Ontario
Canada L8S 4M4
905-525-9140x23604
http://socserv.mcmaster.ca/jfox


From ronggui.huang at gmail.com  Sun Apr  1 17:56:39 2007
From: ronggui.huang at gmail.com (ronggui)
Date: Sun, 1 Apr 2007 23:56:39 +0800
Subject: [Rd] Bug with Sys.glob?
Message-ID: <38b9f0350704010856h273df313s716d93ef557a9ff@mail.gmail.com>

When I run the example command of Sys.glob(), R crashes.
> Sys.glob(file.path(R.home(), "library", "*", "R", "*.rdx"))

> version
               _
platform       i386-pc-mingw32
arch           i386
os             mingw32
system         i386, mingw32
status         alpha
major          2
minor          5.0
year           2007
month          03
day            30
svn rev        40957
language       R
version.string R version 2.5.0 alpha (2007-03-30 r40957)
>


-- 
Ronggui Huang
Department of Sociology
Fudan University, Shanghai, China


From rdiaz at cnio.es  Mon Apr  2 10:23:09 2007
From: rdiaz at cnio.es (Ramon Diaz-Uriarte)
Date: Mon, 2 Apr 2007 10:23:09 +0200
Subject: [Rd] Rmpi and OpenMPI ?
In-Reply-To: <17933.27791.611377.369470@basebud.nulle.part>
References: <17929.54296.884935.214790@basebud.nulle.part>
	<dc41e1260703292048j65ed60bfv13f4eb6862de6715@mail.gmail.com>
	<17933.27791.611377.369470@basebud.nulle.part>
Message-ID: <200704021023.09752.rdiaz@cnio.es>

On Friday 30 March 2007 22:01, Dirk Eddelbuettel wrote:
> On 30 March 2007 at 12:48, Ei-ji Nakama wrote:
> | Prof. Nakano(ism Japan) and I wrestled in Rmpi on HP-MPI.
> | Do not know a method to distinguish MPI well?
> | It is an ad-hoc patch at that time as follows.
>
> Thank you *very much* for this.  I tried an ad-hoc patch that did about
> half of this (i.e. coping with configure, and not letting zzz.R play with
> lamboot) which let to Rmpi at least building ... but not yet running.
>
> I will look more closely at what needs to happen at the C/C++ level in MPI
> and see if I can (eventually) put the rest together.
>
> As for your question about distinguishing MPI implementations: Not sure
> yet. Under Debian, I had to un-install the lam and mpich2 development
> packages as configure would otherwise find their mpi.h first.  I'll have to
> see if there is a canonical / portable identifier for MPI.
>
> For anybody else reading along, this appears to be a great resource (and it
> requires a free registration for webct):
>
> 	http://webct.ncsa.uiuc.edu:8900/public/MPI/


Thanks for the link! Looks really nice indeed.

Best,

R.

>
> Regards,  Dirk

-- 
Ram?n D?az-Uriarte
Statistical Computing Team
Centro Nacional de Investigaciones Oncol?gicas (CNIO)
(Spanish National Cancer Center)
Melchor Fern?ndez Almagro, 3
28029 Madrid (Spain)
Fax: +-34-91-224-6972
Phone: +-34-91-224-6900

http://ligarto.org/rdiaz
PGP KeyID: 0xE89B3462
(http://ligarto.org/rdiaz/0xE89B3462.asc)



**NOTA DE CONFIDENCIALIDAD** Este correo electr?nico, y en s...{{dropped}}


From hin-tak.leung at cimr.cam.ac.uk  Mon Apr  2 14:38:46 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Mon, 02 Apr 2007 13:38:46 +0100
Subject: [Rd] Matrix package: compilation error
In-Reply-To: <460EC045.4050205@gwdg.de>
References: <460E9470.1010307@gwdg.de>	<Pine.LNX.4.64.0703311859120.15900@gannet.stats.ox.ac.uk>
	<460EC045.4050205@gwdg.de>
Message-ID: <4610F956.2090309@cimr.cam.ac.uk>

Rainer Hurling wrote:
> Thanks, Brian and Martin,
> 
> I think you are both right, Matrix tries to use BSD make (/usr/bin/make) 
> on FreeBSD instead of GNU make (/usr/local/bin/gmake).
> 
> Sorry, but I don't know how to persuade the configure script to use 
> gmake :-(

easy -

mkdir ~/mynewbin
ln -s /usr/local/bin/gmake ~/mynewbin/make
export PATH=${HOME}/mynewbin:${PATH}

Then run "R CMD INSTALL ..." as you did.

and afterwards, "rm -rf ~/mynewbin". (I hope I don't need to explain
what the 3 lines above do...)

HTL


> 
> Rainer
> 
> 
> Prof Brian Ripley schrieb:
>> This is because of the GNUism in Matrix/src/Makefile
>>
>> ## get rid of this, once we have 'Depends: R (>= 2.5.0)':
>> ifeq (, $(findstring -lRlapack, $(LAPACK_LIBS)))
>> SOURCES_LAPACK =
>> else
>> SOURCES_LAPACK = zpotf2.f zpotrf.f zlacgv.f
>> endif
>>
>> I guess you know what you need to do to fix it for BSD make?
>>
>> On Sat, 31 Mar 2007, Rainer Hurling wrote:
>>
>>> Trying to compile the package Matrix_0.9975-11.tar.gz with newest
>>> R-2.5.0 alpha (2007-03-31 r40986) on FreeBSD 7.0-CURRENT (i386) I get
>>> the following error:
>>>
>>> -----
>>> R CMD INSTALL Matrix_0.9975-11.tar.gz
>>> * Installing to library '/usr/local/lib/R/library'
>>> * Installing *source* package 'Matrix' ...
>>> ** libs
>>> ** arch -
>>> "Makefile", line 10: Missing dependency operator
>>> "Makefile", line 12: Need an operator
>>> "Makefile", line 14: Need an operator
>>> make: fatal errors encountered -- cannot continue
>>> ERROR: compilation failed for package 'Matrix'
>>> ** Removing '/usr/local/lib/R/library/Matrix'
>>> -----
>>>
>>>
>>> Under FreeBSD I have installed the LAPACK package (3.0.2) with library
>>> at location
>>>
>>> /usr/local/lib/liblapack.so.4
>>>
>>> Is it possible that the Makefile of package Matrix fails because of that?
>> Not used unless you asked for it during R's configure.
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From cstrato at aon.at  Mon Apr  2 17:30:15 2007
From: cstrato at aon.at (cstrato)
Date: Mon, 02 Apr 2007 17:30:15 +0200
Subject: [Rd]  Problem with S4 inheritance: unexpected re-initialization?
Message-ID: <46112187.3090009@aon.at>

Dear S4 experts,

Since I was reminded that I posted a similar question some time ago,
I am attaching a modified version of my demo package, which allows me
to track what happens during initialization of the following similar
subclasses:
   SubSubClassA <- SubClassB <- BaseClass
   SubSubClassB <- SubClassB <- BaseClass

First, I need to create SubClassA:
 > library(myclasspkg)
 > subA <- 
new("SubClassA",filename="OutSubA",filedir="/Volumes/CoreData/CRAN/Workspaces/rclasspkg",mytitle="TitleSubA")
 
Then, I create both subclasses, SubSubClassA and SubSubClassB, either
with a virtual BaseClass or with a non-virtual BaseClass:

1. new("SubSubClassA"): BaseClass is VIRTUAL
 > subsubA <- 
new("SubSubClassA",filename="MyFileName",filedir="/Volumes/CoreData/CRAN/Workspaces/rclasspkg",subA=subA)
[1] "------initialize:SubSubClassA------"
[1] "------initialize:SubClassB------"
[1] "------initialize:BaseClass------"
[1] "------setValidity:BaseClass------"
[1] "------setValidity:SubClassB------"
[1] "------setValidity:SubSubClassA------"

As far as I understand the S4 classes, this is the correct initialization
workflow that I expect. The resulting object "subsubA" is correct.

However, when BaseClass is not virtual, I get the following unexpected
initialization workflow:

2. new("SubSubClassA"): BaseClass is NOT VIRTUAL
 > subsubA <- 
new("SubSubClassA",filename="MyFileName",filedir="/Volumes/CoreData/CRAN/Workspaces/rclasspkg",subA=subA)
[1] "------initialize:SubSubClassA------"
[1] "------initialize:SubClassB------"
[1] "------initialize:BaseClass------"
[1] "------setValidity:BaseClass------" (called but NOT executed!)
[1] "------initialize:BaseClass------" (2.initialization, why?)
[1] "------setValidity:BaseClass------"
[1] "------setValidity:SubClassB------"
[1] "------setValidity:SubSubClassA------"

The first call to setValidity is not executed, and BaseClass is
initialized twice, the second time in a completely wrong way, which
normally results in an error. Interestingly, the resulting object
"subsubA" is still correct.

The results are completely different for SubSubClassB:

3. new("SubSubClassB"): BaseClass is VIRTUAL
 > subsubB <- 
new("SubSubClassB",filename="MyFileNameB",filedir="/Volumes/CoreData/CRAN/Workspaces/rclasspkg",subA=subA)
[1] "------initialize:SubSubClassB------"
[1] "------initialize:SubClassB------"
[1] "------initialize:BaseClass------"
[1] "------setValidity:BaseClass------"
[1] "------initialize:SubClassB------"
[1] "------initialize:BaseClass------"
[1] "------initialize:SubClassA------"
[1] "------initialize:BaseClass------"
[1] "------setValidity:BaseClass------"
[1] "------setValidity:SubClassA------"
[1] "------setValidity:BaseClass------"
[1] "------setValidity:SubClassB------"
Error in validObject(.Object) : invalid class "SubClassB" object: 
'filename' is missing

For some unknown reason SubClassA is initialized and BaseClass is
initialized three times. SetValidity is called until an error occurs.

Things get more weird when BaseClass is not virtal:

4. new("SubSubClassB"): BaseClass is NOT VIRTUAL
 > subsubB <- 
new("SubSubClassB",filename="MyFileNameB",filedir="/Volumes/CoreData/CRAN/Workspaces/rclasspkg",subA=subA)
[1] "------initialize:SubSubClassB------"
[1] "------initialize:SubClassB------"
[1] "------initialize:BaseClass------"
[1] "------setValidity:BaseClass------"
[1] "------initialize:SubClassB------"
[1] "------initialize:BaseClass------"
[1] "------initialize:SubClassA------"
[1] "------initialize:BaseClass------"
[1] "------setValidity:BaseClass------"
[1] "------initialize:BaseClass------"
[1] "------setValidity:BaseClass------"
[1] "------setValidity:SubClassA------"
[1] "------setValidity:BaseClass------"
[1] "------initialize:BaseClass------"
[1] "------setValidity:BaseClass------"
[1] "------setValidity:SubClassB------"
Error in validObject(.Object) : invalid class "SubClassB" object: 
'filename' is missing

It seems that initialization occurs in an endless cycle until an
error occurs.

Finally, let us look what happens when I follow the usual convention
where callNextMethod() is called first:

5. new("SubSubClassA"): callNextMethod() as 1.command; BaseClass is VIRTUAL
 > subsubA <- 
new("SubSubClassA",filename="MyFileName",filedir="/Volumes/CoreData/CRAN/Workspaces/rclasspkg",subA=subA)
[1] "------initialize:SubSubClassA------"
[1] "------initialize:SubClassB------"
[1] "------initialize:BaseClass------"

The object "subsubA" is created correctly, however, setValidity()
is never called.

The same is true for SubSubClassB:

6. new("SubSubClassB"): callNextMethod() as 1.command; BaseClass is VIRTUAL
 > subsubB <- 
new("SubSubClassB",filename="MyFileNameB",filedir="/Volumes/CoreData/CRAN/Workspaces/rclasspkg",subA=subA)
[1] "------initialize:SubSubClassB------"
[1] "------initialize:SubClassB------"
[1] "------initialize:BaseClass------"

The object "subsubB" is for the first time created correctly, however,
once again setValidity() is never called.

Maybe, I am misunderstanding an important part of creating S4 classes.
I would be really greatful, if the S4 experts could explain me what
happens here and what might be wrong with my demo package.

As a side note, when studying the code of the S4 packages "Biobase",
"affy" and "oligo", I made the observation, that none of these packages
calls "initialize" and "setValidity" for all classes and sub-classes.

Thank you very much in advance.
Best regards
Christian

-------------- next part --------------
A non-text attachment was scrubbed...
Name: myclasspkg_0.1.1.tar.gz
Type: application/x-gzip
Size: 5523 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20070402/17170514/attachment.gz 

From rhurlin at gwdg.de  Mon Apr  2 18:55:43 2007
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Mon, 02 Apr 2007 18:55:43 +0200
Subject: [Rd] Matrix package: compilation error
In-Reply-To: <4610F956.2090309@cimr.cam.ac.uk>
References: <460E9470.1010307@gwdg.de>	<Pine.LNX.4.64.0703311859120.15900@gannet.stats.ox.ac.uk>
	<460EC045.4050205@gwdg.de> <4610F956.2090309@cimr.cam.ac.uk>
Message-ID: <4611358F.2060102@gwdg.de>

Thank you Hin-Tak Leung,

on Saturday, 31th, Brian Ripley and Martin Maechler showed me the use of 
gmake without linking make against gmake:

   setenv MAKE gmake
   R CMD INSTALL Matrix_0.9975-11.tar.gz
   unsetenv MAKE
   R CMD INSTALL spdep_0.4-2.tar.gz

Everything works fine now. However, on my wishlist is a general way to 
integrate "the search for gmake on systems like FreeBSD" in the 
configure script of packages like Matrix ... ;-)

Rainer Hurling


Hin-Tak Leung schrieb:
> Rainer Hurling wrote:
>> Thanks, Brian and Martin,
>>
>> I think you are both right, Matrix tries to use BSD make 
>> (/usr/bin/make) on FreeBSD instead of GNU make (/usr/local/bin/gmake).
>>
>> Sorry, but I don't know how to persuade the configure script to use 
>> gmake :-(
> 
> easy -
> 
> mkdir ~/mynewbin
> ln -s /usr/local/bin/gmake ~/mynewbin/make
> export PATH=${HOME}/mynewbin:${PATH}
> 
> Then run "R CMD INSTALL ..." as you did.
> 
> and afterwards, "rm -rf ~/mynewbin". (I hope I don't need to explain
> what the 3 lines above do...)
> 
> HTL
> 
> 
>>
>> Rainer
>>
>>
>> Prof Brian Ripley schrieb:
>>> This is because of the GNUism in Matrix/src/Makefile
>>>
>>> ## get rid of this, once we have 'Depends: R (>= 2.5.0)':
>>> ifeq (, $(findstring -lRlapack, $(LAPACK_LIBS)))
>>> SOURCES_LAPACK =
>>> else
>>> SOURCES_LAPACK = zpotf2.f zpotrf.f zlacgv.f
>>> endif
>>>
>>> I guess you know what you need to do to fix it for BSD make?
>>>
>>> On Sat, 31 Mar 2007, Rainer Hurling wrote:
>>>
>>>> Trying to compile the package Matrix_0.9975-11.tar.gz with newest
>>>> R-2.5.0 alpha (2007-03-31 r40986) on FreeBSD 7.0-CURRENT (i386) I get
>>>> the following error:
>>>>
>>>> -----
>>>> R CMD INSTALL Matrix_0.9975-11.tar.gz
>>>> * Installing to library '/usr/local/lib/R/library'
>>>> * Installing *source* package 'Matrix' ...
>>>> ** libs
>>>> ** arch -
>>>> "Makefile", line 10: Missing dependency operator
>>>> "Makefile", line 12: Need an operator
>>>> "Makefile", line 14: Need an operator
>>>> make: fatal errors encountered -- cannot continue
>>>> ERROR: compilation failed for package 'Matrix'
>>>> ** Removing '/usr/local/lib/R/library/Matrix'
>>>> -----
>>>>
>>>>
>>>> Under FreeBSD I have installed the LAPACK package (3.0.2) with library
>>>> at location
>>>>
>>>> /usr/local/lib/liblapack.so.4
>>>>
>>>> Is it possible that the Makefile of package Matrix fails because of 
>>>> that?
>>> Not used unless you asked for it during R's configure.
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From hin-tak.leung at cimr.cam.ac.uk  Mon Apr  2 19:04:43 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Mon, 02 Apr 2007 18:04:43 +0100
Subject: [Rd] Matrix package: compilation error
In-Reply-To: <4611358F.2060102@gwdg.de>
References: <460E9470.1010307@gwdg.de>	<Pine.LNX.4.64.0703311859120.15900@gannet.stats.ox.ac.uk>
	<460EC045.4050205@gwdg.de> <4610F956.2090309@cimr.cam.ac.uk>
	<4611358F.2060102@gwdg.de>
Message-ID: <461137AB.8000009@cimr.cam.ac.uk>

Rainer Hurling wrote:
> Thank you Hin-Tak Leung,
> 
> on Saturday, 31th, Brian Ripley and Martin Maechler showed me the use of 
> gmake without linking make against gmake:
> 
>   setenv MAKE gmake
>   R CMD INSTALL Matrix_0.9975-11.tar.gz
>   unsetenv MAKE
>   R CMD INSTALL spdep_0.4-2.tar.gz
> 
> Everything works fine now. However, on my wishlist is a general way to 
> integrate "the search for gmake on systems like FreeBSD" in the 
> configure script of packages like Matrix ... ;-)

Hmm, you are using a csh-like shell. Just replace the "export" statement 
below with the equivalent setenv statement:
     setenv PATH ${HOME}/mynewbin:${PATH}

The PATH trick is also a useful thing to do if you have say,
multiple java JDK's, or other things.

> Hin-Tak Leung schrieb:
>> Rainer Hurling wrote:
>>> Thanks, Brian and Martin,
>>>
>>> I think you are both right, Matrix tries to use BSD make 
>>> (/usr/bin/make) on FreeBSD instead of GNU make (/usr/local/bin/gmake).
>>>
>>> Sorry, but I don't know how to persuade the configure script to use 
>>> gmake :-(
>>
>> easy -
>>
>> mkdir ~/mynewbin
>> ln -s /usr/local/bin/gmake ~/mynewbin/make
>> export PATH=${HOME}/mynewbin:${PATH}
>>
>> Then run "R CMD INSTALL ..." as you did.
>>
>> and afterwards, "rm -rf ~/mynewbin". (I hope I don't need to explain
>> what the 3 lines above do...)
>>
>> HTL
>>
>>
>>>
>>> Rainer
>>>
>>>
>>> Prof Brian Ripley schrieb:
>>>> This is because of the GNUism in Matrix/src/Makefile
>>>>
>>>> ## get rid of this, once we have 'Depends: R (>= 2.5.0)':
>>>> ifeq (, $(findstring -lRlapack, $(LAPACK_LIBS)))
>>>> SOURCES_LAPACK =
>>>> else
>>>> SOURCES_LAPACK = zpotf2.f zpotrf.f zlacgv.f
>>>> endif
>>>>
>>>> I guess you know what you need to do to fix it for BSD make?
>>>>
>>>> On Sat, 31 Mar 2007, Rainer Hurling wrote:
>>>>
>>>>> Trying to compile the package Matrix_0.9975-11.tar.gz with newest
>>>>> R-2.5.0 alpha (2007-03-31 r40986) on FreeBSD 7.0-CURRENT (i386) I get
>>>>> the following error:
>>>>>
>>>>> -----
>>>>> R CMD INSTALL Matrix_0.9975-11.tar.gz
>>>>> * Installing to library '/usr/local/lib/R/library'
>>>>> * Installing *source* package 'Matrix' ...
>>>>> ** libs
>>>>> ** arch -
>>>>> "Makefile", line 10: Missing dependency operator
>>>>> "Makefile", line 12: Need an operator
>>>>> "Makefile", line 14: Need an operator
>>>>> make: fatal errors encountered -- cannot continue
>>>>> ERROR: compilation failed for package 'Matrix'
>>>>> ** Removing '/usr/local/lib/R/library/Matrix'
>>>>> -----
>>>>>
>>>>>
>>>>> Under FreeBSD I have installed the LAPACK package (3.0.2) with library
>>>>> at location
>>>>>
>>>>> /usr/local/lib/liblapack.so.4
>>>>>
>>>>> Is it possible that the Makefile of package Matrix fails because of 
>>>>> that?
>>>> Not used unless you asked for it during R's configure.
>>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>


From tplate at acm.org  Mon Apr  2 19:34:02 2007
From: tplate at acm.org (Tony Plate)
Date: Mon, 02 Apr 2007 11:34:02 -0600
Subject: [Rd] Developer work cycle
In-Reply-To: <D79013E40FEF254AAF0D72DFC94F27482308B4@extas4-hba.tas.csiro.au>
References: <4607F803.7060700@decsai.ugr.es><40e66e0b0703291103m2ff62deej1af424ab1de13ab@mail.gmail.com>	<460C5B09.4070501@r-project.org>
	<D79013E40FEF254AAF0D72DFC94F27482308B4@extas4-hba.tas.csiro.au>
Message-ID: <46113E8A.3000806@acm.org>

I tried to summarize some of the very useful tips in this discussion in 
the R Wiki at 
http://wiki.r-project.org/rwiki/doku.php?id=developers:workcycle

If you feel I used your contribution inappropriately, please let me know 
and I'll remove it.

Anyone, please feel free to improve it!

-- Tony Plate


Mark.Bravington at csiro.au wrote:
> Couple of quick points:
> 
> FYI1: the 'mtrace' function in the 'debug' package does let you trace hidden S3 methods (though it lacks the edit= argument).
> 
> FYI2: In my own alpha-version of 'mvbutils', I am able to do live edits of code in (selected) installed packages, including adding & deleting functions from the namespace, and also to do a quick patch of the installed library from inside R (rather than requiring re-installation) so that the modified version is loaded next time I use 'library'. I only need to re-build the package with rcmd when I want to update the helpfiles. My plan is to release the new 'mvbutils' later this year-- time permitting.
> 
> Mark
> 
> Mark Bravington
> CSIRO Mathematical & Information Sciences
> Marine Laboratory
> Castray Esplanade
> Hobart 7001
> TAS
> 
> ph (+61) 3 6232 5118
> fax (+61) 3 6232 5012
> mob (+61) 438 315 623
>  
> 
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org 
>> [mailto:r-devel-bounces at r-project.org] On Behalf Of John Chambers
>> Sent: Friday, 30 March 2007 10:34 AM
>> To: Douglas Bates
>> Cc: "Jos? Luis Aznarte M."; r-devel at r-project.org
>> Subject: Re: [Rd] Developer work cycle
>>
>> Douglas Bates wrote:
>>> On 3/26/07, "Jos? Luis Aznarte M." <jlaznarte at decsai.ugr.es> wrote:
>>>   
>>>>     Hi! I've been browsing through the last months' archive and I 
>>>> can't find an answer to my question, so here it is (let's 
>> hope it's 
>>>> not too
>>>> obvious):
>>>>     I'm working on extensions of an R library, and I would be very 
>>>> surprised if everyone developing R packages is doing the 
>> following, as I do:
>>>>         1.- Write down a modification of an R file
>>>>         2.- Exit the current R session
>>>>         3.- Install the package as root (sudo R CMD INSTALL...)
>>>>         4.- Launch a new R session
>>>>         5.- Test the change, if it does not work, go back 
>> to 1 or debug.
>>>>         6.- Finish.
>>>>
>>>>     Is this the proper (but quite awkward) way to proceed 
>> or there is 
>>>> an alternative to skip steps 2 to 4? I'm using emacs with 
>> ESS under linux.
>>>>     
>>> John Chambers has provided an alternative approach of using
>>>
>>> trace(fname, edit = TRUE)
>>>
>>> where fname is the name of your function.  (Make sure that 
>> the server 
>>> for emacsclient has been started in your emacs session with M-x
>>> server-start.)  This opens an emacs buffer containing the 
>> source for 
>>> the function which you can then edit.  After writing the file and 
>>> closing the client (C-x #) your ESS session has the new definition 
>>> installed in the package's namespace.
>>>
>>> This will work even for objects hidden in the namespace.  
>> The argument 
>>> "signature" allows you to edit S4 methods on the fly like 
>> this.  In my 
>>> experience you cannot edit registered S3 methods like this 
>> but it may 
>>> be that I am just not using trace correctly.
>>>   
>> Indeed, trace() does not currently work for registered S3 
>> methods, with or without the edit=TRUE argument.
>>
>> There is a fix, just committed to r-devel, which should be in 
>> the final 2.5.0.
>>> Of course you must copy the modified version of the source code to 
>>> your package sources when you are done.
>>>
>>> As others have indicated, it is a good practice to install 
>> development 
>>> versions of packages in a private library so you do not need to use 
>>> sudo or worry about messing up system-wide directories.
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>   
>> 	[[alternative HTML version deleted]]
>>
>>
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From deepayan.sarkar at gmail.com  Tue Apr  3 02:51:23 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Mon, 2 Apr 2007 17:51:23 -0700
Subject: [Rd] R callbacks
Message-ID: <eb555e660704021751i30f8854m9f83c81d966ef6a@mail.gmail.com>

Hi,

I'm trying to understand (mostly from the R-exts manual) how to use
the callbacks declared in Rinterface.h. As a first attempt, I'm trying
to redefine ptr_R_WriteConsole in a very trivial manner. Here's my
code:

---------------
$ cat altr.c

int Rf_initialize_R(int ac, char **av);

#define R_INTERFACE_PTRS 1
#include <Rinterface.h>

extern int R_running_as_main_program;

static void my_R_WriteConsole(char *buf, int len)
{
    printf("R<< %s", buf);
}

int main(int ac, char **av)
{
    R_running_as_main_program = 1;
    ptr_R_WriteConsole = my_R_WriteConsole;
    Rf_initialize_R(ac, av);
    Rf_mainloop();
    return 0;
}
---------------

I compile and run this in bash with


RPROG=R

INC=`${RPROG} CMD config --cppflags`
LDF=`${RPROG} CMD config --ldflags`
export LD_LIBRARY_PATH=`${RPROG} RHOME`/lib
gcc -o altr ${INC} ${LDF} altr.c

${RPROG} CMD ./altr

However, my customized version seems not to be used. What am I missing?

-Deepayan


From byron.ellis at gmail.com  Tue Apr  3 06:23:54 2007
From: byron.ellis at gmail.com (Byron Ellis)
Date: Mon, 2 Apr 2007 21:23:54 -0700
Subject: [Rd] R callbacks
In-Reply-To: <eb555e660704021751i30f8854m9f83c81d966ef6a@mail.gmail.com>
References: <eb555e660704021751i30f8854m9f83c81d966ef6a@mail.gmail.com>
Message-ID: <7098abec0704022123hd0806eesdeb54432dc6090e9@mail.gmail.com>

Hi Deepayan,

IIRC Rf_initialize_R sets up the pointers so ptr_R_WriteConsole is
just being overwritten by the original. You want to do it between
initialization and the mainloop

On 4/2/07, Deepayan Sarkar <deepayan.sarkar at gmail.com> wrote:
> Hi,
>
> I'm trying to understand (mostly from the R-exts manual) how to use
> the callbacks declared in Rinterface.h. As a first attempt, I'm trying
> to redefine ptr_R_WriteConsole in a very trivial manner. Here's my
> code:
>
> ---------------
> $ cat altr.c
>
> int Rf_initialize_R(int ac, char **av);
>
> #define R_INTERFACE_PTRS 1
> #include <Rinterface.h>
>
> extern int R_running_as_main_program;
>
> static void my_R_WriteConsole(char *buf, int len)
> {
>     printf("R<< %s", buf);
> }
>
> int main(int ac, char **av)
> {
>     R_running_as_main_program = 1;
>     ptr_R_WriteConsole = my_R_WriteConsole;
>     Rf_initialize_R(ac, av);
>     Rf_mainloop();
>     return 0;
> }
> ---------------
>
> I compile and run this in bash with
>
>
> RPROG=R
>
> INC=`${RPROG} CMD config --cppflags`
> LDF=`${RPROG} CMD config --ldflags`
> export LD_LIBRARY_PATH=`${RPROG} RHOME`/lib
> gcc -o altr ${INC} ${LDF} altr.c
>
> ${RPROG} CMD ./altr
>
> However, my customized version seems not to be used. What am I missing?
>
> -Deepayan
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Byron Ellis (byron.ellis at gmail.com)
"Oook" -- The Librarian


From ggrothendieck at gmail.com  Tue Apr  3 06:40:03 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 3 Apr 2007 00:40:03 -0400
Subject: [Rd] Behavior of seq_along (was: Create a new var reflecting the
	order of subjects in existing var)
Message-ID: <971536df0704022140x37d61904l1ec7f5dbc0761052@mail.gmail.com>

I am moving this from r-help to r-devel.  Based on offline communications
with Jim, suppose dat is defined as follows:

set.seed(123)
dat <- data.frame(ID= c(rep(1,2),rep(2,3), rep(3,3), rep(4,4),
   rep(5,5)), var1 =rnorm(17, 35,2), var2=runif(17,0,1))

# Then this ave call works as expected:

ave(dat$ID, dat$ID, FUN = function(x) seq_along(x))

# but this apparently identical calculation gives an error:

ave(dat$ID, dat$ID, FUN = seq_along)

The only difference between the two calls is that the first one
uses seq_along and the second uses function(x) seq_along(x)
in its place.

Does anyone know why the second gives an error?  Is this
a bug in the implementation of seq_along?


From bcarvalh at jhsph.edu  Tue Apr  3 06:46:18 2007
From: bcarvalh at jhsph.edu (Benilton Carvalho)
Date: Tue, 3 Apr 2007 00:46:18 -0400
Subject: [Rd] Behavior of seq_along (was: Create a new var reflecting
	the order of subjects in existing var)
In-Reply-To: <971536df0704022140x37d61904l1ec7f5dbc0761052@mail.gmail.com>
References: <971536df0704022140x37d61904l1ec7f5dbc0761052@mail.gmail.com>
Message-ID: <DF32B4E3-2289-4233-B429-B1DB255BCB48@jhsph.edu>

I'm not sure what your sessionInfo() is, but take a look at what I got:

 > set.seed(123)
 > dat <- data.frame(ID= c(rep(1,2),rep(2,3), rep(3,3), rep(4,4),
+    rep(5,5)), var1 =rnorm(17, 35,2), var2=runif(17,0,1))
 > dat
    ID     var1       var2
1   1 33.87905 0.02461368
2   1 34.53965 0.47779597
3   2 38.11742 0.75845954
4   2 35.14102 0.21640794
5   2 35.25858 0.31818101
6   3 38.43013 0.23162579
7   3 35.92183 0.14280002
8   3 32.46988 0.41454634
9   4 33.62629 0.41372433
10  4 34.10868 0.36884545
11  4 37.44816 0.15244475
12  4 35.71963 0.13880606
13  5 35.80154 0.23303410
14  5 35.22137 0.46596245
15  5 33.88832 0.26597264
16  5 38.57383 0.85782772
17  5 35.99570 0.04583117
 > ave(dat$ID, dat$ID, FUN = function(x) seq_along(x))
[1] 1 2 1 2 3 1 2 3 1 2 3 4 1 2 3 4 5
 > ave(dat$ID, dat$ID, FUN = seq_along)
[1] 1 2 1 2 3 1 2 3 1 2 3 4 1 2 3 4 5
 > sessionInfo()
R version 2.5.0 Under development (unstable) (2007-01-07 r40398)
x86_64-unknown-linux-gnu

locale:
LC_CTYPE=en_US.iso885915;LC_NUMERIC=C;LC_TIME=en_US.iso885915;LC_COLLATE 
=en_US.iso885915;LC_MONETARY=en_US.iso885915;LC_MESSAGES=en_US.iso885915 
;LC_PAPER=en_US.iso885915;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASU 
REMENT=en_US.iso885915;LC_IDENTIFICATION=C

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"   
"methods"
[7] "base"
 >

cheers,
b

On Apr 3, 2007, at 12:40 AM, Gabor Grothendieck wrote:

> I am moving this from r-help to r-devel.  Based on offline  
> communications
> with Jim, suppose dat is defined as follows:
>
> set.seed(123)
> dat <- data.frame(ID= c(rep(1,2),rep(2,3), rep(3,3), rep(4,4),
>    rep(5,5)), var1 =rnorm(17, 35,2), var2=runif(17,0,1))
>
> # Then this ave call works as expected:
>
> ave(dat$ID, dat$ID, FUN = function(x) seq_along(x))
>
> # but this apparently identical calculation gives an error:
>
> ave(dat$ID, dat$ID, FUN = seq_along)
>
> The only difference between the two calls is that the first one
> uses seq_along and the second uses function(x) seq_along(x)
> in its place.
>
> Does anyone know why the second gives an error?  Is this
> a bug in the implementation of seq_along?
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ggrothendieck at gmail.com  Tue Apr  3 06:53:44 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 3 Apr 2007 00:53:44 -0400
Subject: [Rd] Behavior of seq_along (was: Create a new var reflecting
	the order of subjects in existing var)
In-Reply-To: <DF32B4E3-2289-4233-B429-B1DB255BCB48@jhsph.edu>
References: <971536df0704022140x37d61904l1ec7f5dbc0761052@mail.gmail.com>
	<DF32B4E3-2289-4233-B429-B1DB255BCB48@jhsph.edu>
Message-ID: <971536df0704022153u560df5c8oe1ec6ecae241629d@mail.gmail.com>

Good point.  I tried it on

"R version 2.5.0 Under development (unstable) (2007-02-25 r40804)"

under Windows XP and both the seq_along and function(x) seq_along(x)
versions worked without error, as well.

So it seems this was a bug in 2.4.1 that is fixed in 2.5.0 .

On 4/3/07, Benilton Carvalho <bcarvalh at jhsph.edu> wrote:
> I'm not sure what your sessionInfo() is, but take a look at what I got:
>
>  > set.seed(123)
>  > dat <- data.frame(ID= c(rep(1,2),rep(2,3), rep(3,3), rep(4,4),
> +    rep(5,5)), var1 =rnorm(17, 35,2), var2=runif(17,0,1))
>  > dat
>    ID     var1       var2
> 1   1 33.87905 0.02461368
> 2   1 34.53965 0.47779597
> 3   2 38.11742 0.75845954
> 4   2 35.14102 0.21640794
> 5   2 35.25858 0.31818101
> 6   3 38.43013 0.23162579
> 7   3 35.92183 0.14280002
> 8   3 32.46988 0.41454634
> 9   4 33.62629 0.41372433
> 10  4 34.10868 0.36884545
> 11  4 37.44816 0.15244475
> 12  4 35.71963 0.13880606
> 13  5 35.80154 0.23303410
> 14  5 35.22137 0.46596245
> 15  5 33.88832 0.26597264
> 16  5 38.57383 0.85782772
> 17  5 35.99570 0.04583117
>  > ave(dat$ID, dat$ID, FUN = function(x) seq_along(x))
> [1] 1 2 1 2 3 1 2 3 1 2 3 4 1 2 3 4 5
>  > ave(dat$ID, dat$ID, FUN = seq_along)
> [1] 1 2 1 2 3 1 2 3 1 2 3 4 1 2 3 4 5
>  > sessionInfo()
> R version 2.5.0 Under development (unstable) (2007-01-07 r40398)
> x86_64-unknown-linux-gnu
>
> locale:
> LC_CTYPE=en_US.iso885915;LC_NUMERIC=C;LC_TIME=en_US.iso885915;LC_COLLATE
> =en_US.iso885915;LC_MONETARY=en_US.iso885915;LC_MESSAGES=en_US.iso885915
> ;LC_PAPER=en_US.iso885915;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASU
> REMENT=en_US.iso885915;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"
> "methods"
> [7] "base"
>  >
>
> cheers,
> b
>
> On Apr 3, 2007, at 12:40 AM, Gabor Grothendieck wrote:
>
> > I am moving this from r-help to r-devel.  Based on offline
> > communications
> > with Jim, suppose dat is defined as follows:
> >
> > set.seed(123)
> > dat <- data.frame(ID= c(rep(1,2),rep(2,3), rep(3,3), rep(4,4),
> >    rep(5,5)), var1 =rnorm(17, 35,2), var2=runif(17,0,1))
> >
> > # Then this ave call works as expected:
> >
> > ave(dat$ID, dat$ID, FUN = function(x) seq_along(x))
> >
> > # but this apparently identical calculation gives an error:
> >
> > ave(dat$ID, dat$ID, FUN = seq_along)
> >
> > The only difference between the two calls is that the first one
> > uses seq_along and the second uses function(x) seq_along(x)
> > in its place.
> >
> > Does anyone know why the second gives an error?  Is this
> > a bug in the implementation of seq_along?
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Tue Apr  3 09:21:31 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 3 Apr 2007 08:21:31 +0100 (BST)
Subject: [Rd] Non-unique column names in data frames
In-Reply-To: <20070401135743.EZTQ1612.tomts36-srv.bellnexxia.net@JohnDesktop8300>
References: <20070401135743.EZTQ1612.tomts36-srv.bellnexxia.net@JohnDesktop8300>
Message-ID: <Pine.LNX.4.64.0704011734350.18350@gannet.stats.ox.ac.uk>

On Sun, 1 Apr 2007, John Fox wrote:

> Dear r-devel members,
>
> It's just been brought to my attention that R permits non-unique column
> names in data frames -- e.g., via assignment to names() or colnames(). This
> behaviour is consistent with the help files (as I discovered), but it's not
> consistent with the behaviour of rownames() and row.names(). For example,

??  matrices and data frames are different, but rownames() and row.names() 
do the same on each class.

>
> 	row.names(airquality) <- rep("a", nrow(airquality))
>
> generates an error, but

as does rownames().

>
> 	names(airquality) <- rep("a", ncol(airquality))
>
> or even
>
> 	names(airquality) <- rep("", ncol(airquality))
>
> do not.
>
> I figure that there must be some rationale for this difference, but I can't
> think of what it might be. Any thoughts?

It's part of the definition of a data frame, from long ago (White Book 
p.60).  Think of the row names as a 'primary key' in the sense of a 
DBMS/SQL.

Why the names are not also required to be non-empty and unique 
is something for the designer (and John Chambers has not (yet) replied), 
but it is clearly deliberate as data.frame(check.names=FALSE) is allowed.
One possible issue is that there are many ways to set names of a data 
frame, e.g. DF$name <- value can add a column, and checking them all could 
be tedious.  OTOH, setting row names is centralized (it is done inside
attr<-()).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Tue Apr  3 10:41:37 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 3 Apr 2007 09:41:37 +0100 (BST)
Subject: [Rd] [R] Compiling C codes in Windows
In-Reply-To: <dca1bca314395.4611abbb@usc.edu>
References: <de40888b11fbf.46105d26@usc.edu>
	<6ph8xdb9my7.fsf@gopher4.fhcrc.org>
	<46112D84.8020304@stats.uwo.ca> <dca1bca314395.4611abbb@usc.edu>
Message-ID: <Pine.LNX.4.64.0704030939360.17627@gannet.stats.ox.ac.uk>

On Tue, 3 Apr 2007, Tong Wang wrote:

> Thank you all for the help . It seems I only need to change the back slash to forward slash to get things work .
>
> As to using Cygwin as the shell, I couldn't find an instruction 
> dedicated to Cygwin, should I just follow the " Installing R under 
> Unix-alikes " ?  Is there an easier way, like making use of the 
> installed binaries.

Yes, any reasonable shell works (I use tcsh, Duncan Murdoch uses bash), 
and you can install packages, use SHLIB and so via the installed binaries.
It is all documented.

> I will post future questions to R-devel.
>
> Thanks again.
>
> tong
>
> ----- Original Message -----
> From: Duncan Murdoch <murdoch at stats.uwo.ca>
> Date: Monday, April 2, 2007 9:21 am
> Subject: Re: [R] Compiling C codes in Windows
> To: Martin Morgan <mtmorgan at fhcrc.org>
> Cc: Tong Wang <wangtong at usc.edu>, R help <r-help at stat.math.ethz.ch>
>
>> On 4/2/2007 4:53 AM, Martin Morgan wrote:
>>> Tong Wang <wangtong at usc.edu> writes:
>>>
>>>> Hi All,
>>> [...]
>>>> After I followed all the instructions in " Building R for
>> Windows"
>>> [...]
>>>>      Anyway, I assumed that I need to run this command in Cygwin
>>>
>>> No, do this from a DOS shell.
>>
>> Cygwin is fine as a shell (it's what I use), but the rest of your
>> advice
>> is correct:
>>
>>> The usual problems are either missing
>>> components from the installation steps outlined in Building R for
>>> Windows, or an incorrect PATH variable so that windows or cygwin
>>> versions of programs are used rather than MinGW / Rtools.
>>
>> Duncan Murdoch
>>
>>>
>>> Also, this question belongs on the R-devel list, where those doing
>>> development work are more likely to see and respond to your
>>> questions.
>>>
>>> Hope that helps,
>>>
>>> Martin Morgan
>>>>
>>>> $ make all recommended
>>>> make: ./Rpwd.exe: Command not found
>>>> make[1]: ./Rpwd.exe: Command not found
>>>> make --no-print-directory -C front-ends Rpwd
>>>> make -C ../../include -f Makefile.win version
>>>> make Rpwd.exe
>>>> gcc  -O3 -Wall -pedantic -I../../include  -c rpwd.c -o rpwd.o
>>>> rpwd.c:22:20: direct.h: No such file or directory
>>>> rpwd.c: In function `main':
>>>> rpwd.c:42: warning: implicit declaration of function `chdir'
>>>> rpwd.c:45: warning: implicit declaration of function `getcwd'
>>>> make[3]: *** [rpwd.o] Error 1
>>>> make[2]: *** [Rpwd] Error 2
>>>> make[1]: *** [front-ends/Rpwd.exe] Error 2
>>>> make: *** [all] Error 2
>>>>
>>>>
>>>> Can I get some help with my quesitons , and some suggestions
>> concerning the best way to solve the whole problem ?
>>>>
>>>> THanks a lot  for your help..
>>>>
>>>> tong
>>>>
>>>> ______________________________________________
>>>> R-help at stat.math.ethz.ch mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>>> PLEASE do read the posting guide http://www.R-
>> project.org/posting-guide.html
>>>> and provide commented, minimal, self-contained, reproducible code.
>>>
>>
>>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch at stats.uwo.ca  Tue Apr  3 14:38:24 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 03 Apr 2007 08:38:24 -0400
Subject: [Rd] [R] Compiling C codes in Windows
In-Reply-To: <dca1bca314395.4611abbb@usc.edu>
References: <de40888b11fbf.46105d26@usc.edu>	<6ph8xdb9my7.fsf@gopher4.fhcrc.org>
	<46112D84.8020304@stats.uwo.ca> <dca1bca314395.4611abbb@usc.edu>
Message-ID: <46124AC0.7000907@stats.uwo.ca>

On 4/3/2007 4:19 AM, Tong Wang wrote:
> Thank you all for the help . It seems I only need to change the back slash to forward slash to get things work .
> 
> As to using Cygwin as the shell, I couldn't find an instruction dedicated to Cygwin, should I just follow the " Installing 
> R under Unix-alikes " ? 

As Prof. Ripley said, we don't support a native Cygwin build, so you 
need to follow the instructions for building in Windows.  They are 
mainly fairly neutral about which shell you're using, but you may need 
to translate a few Windows CMD specifics into Cygwin equivalents.  For 
example, instead of

PATH=c:\Rtools\bin;...

you would want something like

export PATH=/cygdrive/c/Rtools/bin:...

in bash.

> Is there an easier way, like making use of the installed binaries.

As long as you choose to install the "Source Package Installation Files" 
(which are selected by default) when you install R, and you install the 
tools as described in the R Admin manual or on my 
http://www.murdoch-sutherland.com/Rtools page, you shouldn't need to 
build R in order to compile C code for packages.

Please note that there has been a binary installer available for the 
Rtools for a few days.  It doesn't do a complete install, but it will 
save several steps.

Duncan Murdoch

> 
> I will post future questions to R-devel.  
> 
> Thanks again.
> 
> tong 
> 
> ----- Original Message -----
> From: Duncan Murdoch <murdoch at stats.uwo.ca>
> Date: Monday, April 2, 2007 9:21 am
> Subject: Re: [R] Compiling C codes in Windows
> To: Martin Morgan <mtmorgan at fhcrc.org>
> Cc: Tong Wang <wangtong at usc.edu>, R help <r-help at stat.math.ethz.ch>
> 
>> On 4/2/2007 4:53 AM, Martin Morgan wrote:
>> > Tong Wang <wangtong at usc.edu> writes:
>> > 
>> >> Hi All,
>> > [...]
>> >> After I followed all the instructions in " Building R for 
>> Windows" 
>> > [...]
>> >>      Anyway, I assumed that I need to run this command in Cygwin
>> > 
>> > No, do this from a DOS shell. 
>> 
>> Cygwin is fine as a shell (it's what I use), but the rest of your 
>> advice 
>> is correct:
>> 
>> > The usual problems are either missing
>> > components from the installation steps outlined in Building R for
>> > Windows, or an incorrect PATH variable so that windows or cygwin
>> > versions of programs are used rather than MinGW / Rtools.
>> 
>> Duncan Murdoch
>> 
>> > 
>> > Also, this question belongs on the R-devel list, where those doing
>> > development work are more likely to see and respond to your
>> > questions.
>> > 
>> > Hope that helps,
>> > 
>> > Martin Morgan
>> >>
>> >> $ make all recommended
>> >> make: ./Rpwd.exe: Command not found
>> >> make[1]: ./Rpwd.exe: Command not found
>> >> make --no-print-directory -C front-ends Rpwd
>> >> make -C ../../include -f Makefile.win version
>> >> make Rpwd.exe
>> >> gcc  -O3 -Wall -pedantic -I../../include  -c rpwd.c -o rpwd.o
>> >> rpwd.c:22:20: direct.h: No such file or directory
>> >> rpwd.c: In function `main':
>> >> rpwd.c:42: warning: implicit declaration of function `chdir'
>> >> rpwd.c:45: warning: implicit declaration of function `getcwd'
>> >> make[3]: *** [rpwd.o] Error 1
>> >> make[2]: *** [Rpwd] Error 2
>> >> make[1]: *** [front-ends/Rpwd.exe] Error 2
>> >> make: *** [all] Error 2 
>> >>
>> >>
>> >> Can I get some help with my quesitons , and some suggestions 
>> concerning the best way to solve the whole problem ?
>> >>
>> >> THanks a lot  for your help..
>> >>
>> >> tong
>> >>
>> >> ______________________________________________
>> >> R-help at stat.math.ethz.ch mailing list
>> >> https://stat.ethz.ch/mailman/listinfo/r-help
>> >> PLEASE do read the posting guide http://www.R-
>> project.org/posting-guide.html
>> >> and provide commented, minimal, self-contained, reproducible code.
>> > 
>> 
>>
> 
> ______________________________________________
> R-help at stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From simon.urbanek at r-project.org  Tue Apr  3 16:11:03 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 3 Apr 2007 10:11:03 -0400
Subject: [Rd] R callbacks
In-Reply-To: <eb555e660704021751i30f8854m9f83c81d966ef6a@mail.gmail.com>
References: <eb555e660704021751i30f8854m9f83c81d966ef6a@mail.gmail.com>
Message-ID: <7DAE25C3-CAD3-4491-8B1E-7A1A5D2EDC49@r-project.org>

On Apr 2, 2007, at 8:51 PM, Deepayan Sarkar wrote:

> Hi,
>
> I'm trying to understand (mostly from the R-exts manual) how to use
> the callbacks declared in Rinterface.h. As a first attempt, I'm trying
> to redefine ptr_R_WriteConsole in a very trivial manner. Here's my
> code:
>
> ---------------
> $ cat altr.c
>
> int Rf_initialize_R(int ac, char **av);
>
> #define R_INTERFACE_PTRS 1
> #include <Rinterface.h>
>
> extern int R_running_as_main_program;
>
> static void my_R_WriteConsole(char *buf, int len)
> {
>     printf("R<< %s", buf);
> }
>
> int main(int ac, char **av)
> {
>     R_running_as_main_program = 1;
>     ptr_R_WriteConsole = my_R_WriteConsole;
>     Rf_initialize_R(ac, av);
>     Rf_mainloop();
>     return 0;
> }
> ---------------
>
> I compile and run this in bash with
>
>
> RPROG=R
>
> INC=`${RPROG} CMD config --cppflags`
> LDF=`${RPROG} CMD config --ldflags`
> export LD_LIBRARY_PATH=`${RPROG} RHOME`/lib
> gcc -o altr ${INC} ${LDF} altr.c
>
> ${RPROG} CMD ./altr
>
> However, my customized version seems not to be used. What am I  
> missing?
>

1) see Byron's e-mail
2) by default R uses stdout/err connections instead of the console  
API, you need to disable that

so the resulting code should look like this:

     Rf_initialize_R(ac, av);
     ptr_R_WriteConsole = my_R_WriteConsole;
     R_Outputfile = NULL;
     R_Consolefile = NULL;
     Rf_mainloop();

Cheers,
Simon


From ross at biostat.ucsf.edu  Tue Apr  3 20:04:16 2007
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Tue, 3 Apr 2007 11:04:16 -0700
Subject: [Rd] future plans for missing() in inner functions
Message-ID: <20070403180416.GA25978@wheat.betterworld.us>

Currently, if one wants to test if an argument to an outer function is
missing from within an inner function, this works:
> g5 <- function(a) {
+   inner <- function(a) {
+     if (missing(a))
+       "outer arg is missing"
+     else
+       "found outer arg!"
+   }
+   inner(a)
+ }
> g5(3)
[1] "found outer arg!"
> g5()
[1] "outer arg is missing"

While if inner is defined as function() (without arguments) one gets
an error: 'missing' can only be used for arguments.

However, ?missing contains a note that this behavior is subject to
change.

I'm particularly interested in whether the code shown above will
continue to work.  While it does what I want in this case, the
behavior seems a bit surprising since textually the call to inner does
provide an argument.  So it seems possible that might change.

Can anyone provide more insight into how things may change?

Thanks.


From hpages at fhcrc.org  Tue Apr  3 20:29:25 2007
From: hpages at fhcrc.org (Herve Pages)
Date: Tue, 03 Apr 2007 11:29:25 -0700
Subject: [Rd] source(...,
	echo=TRUE) broken in R-2.5.0 alpha and in R-2.6.0 devel
Message-ID: <46129D05.5080200@fhcrc.org>

Hi,

I get this error with R-2.5.0 alpha and R-2.6.0 devel:

  > source("http://bioconductor.org/biocLite.R", echo=TRUE)
  Error in if (timestamp != srcfile$timestamp) warning("Timestamp of '",  :
          missing value where TRUE/FALSE needed

Same with 'verbose=TRUE':

  > source("http://bioconductor.org/biocLite.R", verbose=TRUE)
  'envir' chosen:<environment: R_GlobalEnv>
  encoding = "native.enc" chosen
  --> parsed 2 expressions; now eval(.)ing them:

  >>>> eval(expression_nr. 1 )
                   =================
  Error in if (timestamp != srcfile$timestamp) warning("Timestamp of '",  :
          missing value where TRUE/FALSE needed

The above works fine with R-2.4.1.

Cheers,
H.


From hpages at fhcrc.org  Tue Apr  3 23:52:43 2007
From: hpages at fhcrc.org (Herve Pages)
Date: Tue, 03 Apr 2007 14:52:43 -0700
Subject: [Rd] Problem with S4 inheritance: unexpected re-initialization?
In-Reply-To: <46112187.3090009@aon.at>
References: <46112187.3090009@aon.at>
Message-ID: <4612CCAB.1080809@fhcrc.org>

Hi Christian,

I can only give you a few reasons why IMO it is very unlikely that anybody
will be able to help you on this, with the current form of your post.

1) Unless you have a really good reason to do so, don't attach a package
   to your post. Do your best to provide a few lines of code that anybody
   can easily copy and paste into their session.

2) Your package is messy (yes I looked at it). You have far too many classes
   with far too many slots that we don't care about. If you could provide
   the smallest possible set of classes with the smallest possible set of slots
   with the smallest possible set of generics and methods that still allow to
   reproduce the issue you want to show us, that would help!

3) You show us an example where BaseClass is VIRTUAL (which is indeed how it is
   defined in your package) and then an example where BaseClass is NOT VIRTUAL.
   How can we reproduce the latter? Don't expect people to go into your package,
   change the class definition, reinstall, restart R and then run your example!

4) Note that for clarity and conformance to almost universal convention, it's
   better to use arrows pointing from derived classes to base classes
   in your inheritance tree.

5) It's good to provide the inheritance tree, but it's better when it's complete.
   I've looked at what you actually have in your package and the complete
   inheritance tree is something like this:

     BaseClass <- SubClassA
               <- SubClassB <- SubSubClassA
                            <- SubSubClassB

   Where is the SubClassA class in the inheritance tree that you included in your
   post below?

6) Another thing I note is that you have a naming problem: any reason why you name
   "SubSubClassA" a subclass of SubClassB? Given that you also have defined SubClassA,
   this can only lead to confusion!

7) You need to use proper terminology if you expect people to follow you. In your post
   below, every time you instanciate a class you say that your are creating it:
     o "First, I need to create SubClassA..."
     o "I create both subclasses, SubSubClassA and SubSubClassB..."
     o etc...
   Creating a class is not the same as instanciating it!

8) You start your examples by "First, I need to create SubClassA..." so you are
   introducing us a class that doesn't show up in your inheritance tree so we don't
   know how it is related to the other classes. Also you say that you "need" to
   create SubClassA but we have no idea why!

9) You have a slot in SubClassB that is of class SubClassA! This means "a SubClassB
   object _is_ a BaseClass object and it _has_ a slot that is itself a BaseClass
   object (since a SubClassA object is a BaseClass object too)". I hope that this
   is really what you want... but maybe this could be related to the fact that you
   see 2 instanciations of BaseClass when you instanciate SubSubClassA or SubSubClassB.

10) You have several different issues (initialize called multiple times when you expect
    only 1 time, setValidity not called, etc..). May be they are related, maybe they
    are not. If you can isolate those problems and make a separate post for each of them,
    that would help too.

You'll be surprised, but once you've made the effort to follow those recommendations,
it's most likely that you will have a better understanding of what's going on. And you
might even be able to sort out these issues by yourself!

Cheers,
H.


cstrato wrote:
> Dear S4 experts,
> 
> Since I was reminded that I posted a similar question some time ago,
> I am attaching a modified version of my demo package, which allows me
> to track what happens during initialization of the following similar
> subclasses:
>   SubSubClassA <- SubClassB <- BaseClass
>   SubSubClassB <- SubClassB <- BaseClass
> 
> First, I need to create SubClassA:
>> library(myclasspkg)
>> subA <-
> new("SubClassA",filename="OutSubA",filedir="/Volumes/CoreData/CRAN/Workspaces/rclasspkg",mytitle="TitleSubA")
> 
> 
> Then, I create both subclasses, SubSubClassA and SubSubClassB, either
> with a virtual BaseClass or with a non-virtual BaseClass:
> 
> 1. new("SubSubClassA"): BaseClass is VIRTUAL
>> subsubA <-
> new("SubSubClassA",filename="MyFileName",filedir="/Volumes/CoreData/CRAN/Workspaces/rclasspkg",subA=subA)
> 
> [1] "------initialize:SubSubClassA------"
> [1] "------initialize:SubClassB------"
> [1] "------initialize:BaseClass------"
> [1] "------setValidity:BaseClass------"
> [1] "------setValidity:SubClassB------"
> [1] "------setValidity:SubSubClassA------"
> 
> As far as I understand the S4 classes, this is the correct initialization
> workflow that I expect. The resulting object "subsubA" is correct.
> 
> However, when BaseClass is not virtual, I get the following unexpected
> initialization workflow:
> 
> 2. new("SubSubClassA"): BaseClass is NOT VIRTUAL
>> subsubA <-
> new("SubSubClassA",filename="MyFileName",filedir="/Volumes/CoreData/CRAN/Workspaces/rclasspkg",subA=subA)
> 
> [1] "------initialize:SubSubClassA------"
> [1] "------initialize:SubClassB------"
> [1] "------initialize:BaseClass------"
> [1] "------setValidity:BaseClass------" (called but NOT executed!)
> [1] "------initialize:BaseClass------" (2.initialization, why?)
> [1] "------setValidity:BaseClass------"
> [1] "------setValidity:SubClassB------"
> [1] "------setValidity:SubSubClassA------"
> 
> The first call to setValidity is not executed, and BaseClass is
> initialized twice, the second time in a completely wrong way, which
> normally results in an error. Interestingly, the resulting object
> "subsubA" is still correct.
> 
> The results are completely different for SubSubClassB:
> 
> 3. new("SubSubClassB"): BaseClass is VIRTUAL
>> subsubB <-
> new("SubSubClassB",filename="MyFileNameB",filedir="/Volumes/CoreData/CRAN/Workspaces/rclasspkg",subA=subA)
> 
> [1] "------initialize:SubSubClassB------"
> [1] "------initialize:SubClassB------"
> [1] "------initialize:BaseClass------"
> [1] "------setValidity:BaseClass------"
> [1] "------initialize:SubClassB------"
> [1] "------initialize:BaseClass------"
> [1] "------initialize:SubClassA------"
> [1] "------initialize:BaseClass------"
> [1] "------setValidity:BaseClass------"
> [1] "------setValidity:SubClassA------"
> [1] "------setValidity:BaseClass------"
> [1] "------setValidity:SubClassB------"
> Error in validObject(.Object) : invalid class "SubClassB" object:
> 'filename' is missing
> 
> For some unknown reason SubClassA is initialized and BaseClass is
> initialized three times. SetValidity is called until an error occurs.
> 
> Things get more weird when BaseClass is not virtal:
> 
> 4. new("SubSubClassB"): BaseClass is NOT VIRTUAL
>> subsubB <-
> new("SubSubClassB",filename="MyFileNameB",filedir="/Volumes/CoreData/CRAN/Workspaces/rclasspkg",subA=subA)
> 
> [1] "------initialize:SubSubClassB------"
> [1] "------initialize:SubClassB------"
> [1] "------initialize:BaseClass------"
> [1] "------setValidity:BaseClass------"
> [1] "------initialize:SubClassB------"
> [1] "------initialize:BaseClass------"
> [1] "------initialize:SubClassA------"
> [1] "------initialize:BaseClass------"
> [1] "------setValidity:BaseClass------"
> [1] "------initialize:BaseClass------"
> [1] "------setValidity:BaseClass------"
> [1] "------setValidity:SubClassA------"
> [1] "------setValidity:BaseClass------"
> [1] "------initialize:BaseClass------"
> [1] "------setValidity:BaseClass------"
> [1] "------setValidity:SubClassB------"
> Error in validObject(.Object) : invalid class "SubClassB" object:
> 'filename' is missing
> 
> It seems that initialization occurs in an endless cycle until an
> error occurs.
> 
> Finally, let us look what happens when I follow the usual convention
> where callNextMethod() is called first:
> 
> 5. new("SubSubClassA"): callNextMethod() as 1.command; BaseClass is VIRTUAL
>> subsubA <-
> new("SubSubClassA",filename="MyFileName",filedir="/Volumes/CoreData/CRAN/Workspaces/rclasspkg",subA=subA)
> 
> [1] "------initialize:SubSubClassA------"
> [1] "------initialize:SubClassB------"
> [1] "------initialize:BaseClass------"
> 
> The object "subsubA" is created correctly, however, setValidity()
> is never called.
> 
> The same is true for SubSubClassB:
> 
> 6. new("SubSubClassB"): callNextMethod() as 1.command; BaseClass is VIRTUAL
>> subsubB <-
> new("SubSubClassB",filename="MyFileNameB",filedir="/Volumes/CoreData/CRAN/Workspaces/rclasspkg",subA=subA)
> 
> [1] "------initialize:SubSubClassB------"
> [1] "------initialize:SubClassB------"
> [1] "------initialize:BaseClass------"
> 
> The object "subsubB" is for the first time created correctly, however,
> once again setValidity() is never called.
> 
> Maybe, I am misunderstanding an important part of creating S4 classes.
> I would be really greatful, if the S4 experts could explain me what
> happens here and what might be wrong with my demo package.
> 
> As a side note, when studying the code of the S4 packages "Biobase",
> "affy" and "oligo", I made the observation, that none of these packages
> calls "initialize" and "setValidity" for all classes and sub-classes.
> 
> Thank you very much in advance.
> Best regards
> Christian
> 
> 
> ------------------------------------------------------------------------
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From deepayan.sarkar at gmail.com  Wed Apr  4 01:17:03 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Tue, 3 Apr 2007 16:17:03 -0700
Subject: [Rd] R callbacks
In-Reply-To: <7DAE25C3-CAD3-4491-8B1E-7A1A5D2EDC49@r-project.org>
References: <eb555e660704021751i30f8854m9f83c81d966ef6a@mail.gmail.com>
	<7DAE25C3-CAD3-4491-8B1E-7A1A5D2EDC49@r-project.org>
Message-ID: <eb555e660704031617j6ce3f5ebk4ad236e58cf9274a@mail.gmail.com>

On 4/3/07, Simon Urbanek <simon.urbanek at r-project.org> wrote:
> On Apr 2, 2007, at 8:51 PM, Deepayan Sarkar wrote:
>
> > Hi,
> >
> > I'm trying to understand (mostly from the R-exts manual) how to use
> > the callbacks declared in Rinterface.h. As a first attempt, I'm trying
> > to redefine ptr_R_WriteConsole in a very trivial manner. Here's my
> > code:
> >
> > ---------------
> > $ cat altr.c
> >
> > int Rf_initialize_R(int ac, char **av);
> >
> > #define R_INTERFACE_PTRS 1
> > #include <Rinterface.h>
> >
> > extern int R_running_as_main_program;
> >
> > static void my_R_WriteConsole(char *buf, int len)
> > {
> >     printf("R<< %s", buf);
> > }
> >
> > int main(int ac, char **av)
> > {
> >     R_running_as_main_program = 1;
> >     ptr_R_WriteConsole = my_R_WriteConsole;
> >     Rf_initialize_R(ac, av);
> >     Rf_mainloop();
> >     return 0;
> > }
> > ---------------
> >
> > I compile and run this in bash with
> >
> >
> > RPROG=R
> >
> > INC=`${RPROG} CMD config --cppflags`
> > LDF=`${RPROG} CMD config --ldflags`
> > export LD_LIBRARY_PATH=`${RPROG} RHOME`/lib
> > gcc -o altr ${INC} ${LDF} altr.c
> >
> > ${RPROG} CMD ./altr
> >
> > However, my customized version seems not to be used. What am I
> > missing?
> >
>
> 1) see Byron's e-mail
> 2) by default R uses stdout/err connections instead of the console
> API, you need to disable that
>
> so the resulting code should look like this:
>
>      Rf_initialize_R(ac, av);
>      ptr_R_WriteConsole = my_R_WriteConsole;
>      R_Outputfile = NULL;
>      R_Consolefile = NULL;
>      Rf_mainloop();

Thanks, setting things to NULL was the critical piece (I had tried
Byron's suggestion myself). A note mentioning this in R-exts would be
helpful.

-Deepayan


From wangtong at usc.edu  Tue Apr  3 10:37:23 2007
From: wangtong at usc.edu (Tong Wang)
Date: Tue, 03 Apr 2007 01:37:23 -0700
Subject: [Rd] Strange number produced by dnorm
Message-ID: <dc3f83df14128.4611afd3@usc.edu>

Hi All,
    I just started to learn compiling C codes for R usage, and got a problem when I was playing with my 'hello world' code. 
  
#include <R.h>
#include <Rdefines.h>    
#include <Rmath.h>

SEXP test( ) {
  double x;
  x=dnorm(1.0,0.0,1.0,1);
  printf(" x value is: %d \n",x);
  return(R_NilValue);
}

   I got the result :    x value is: -466460838 

Could someone explain to me what was wrong here ?

Thanks a lot. 

tong


From martin.becker at mx.uni-saarland.de  Wed Apr  4 09:24:15 2007
From: martin.becker at mx.uni-saarland.de (Martin Becker)
Date: Wed, 04 Apr 2007 09:24:15 +0200
Subject: [Rd] Strange number produced by dnorm
In-Reply-To: <dc3f83df14128.4611afd3@usc.edu>
References: <dc3f83df14128.4611afd3@usc.edu>
Message-ID: <4613529F.7090406@mx.uni-saarland.de>

Hi,

I think the only thing that's wrong is "%d" in your printf statement, 
shouldn't it be "%f"? ("%d" is used for decimal (integer) numbers, "%f" 
for float (double) numbers)

Regards,

  Martin

Tong Wang wrote:
> Hi All,
>     I just started to learn compiling C codes for R usage, and got a problem when I was playing with my 'hello world' code. 
>   
> #include <R.h>
> #include <Rdefines.h>    
> #include <Rmath.h>
>
> SEXP test( ) {
>   double x;
>   x=dnorm(1.0,0.0,1.0,1);
>   printf(" x value is: %d \n",x);
>   return(R_NilValue);
> }
>
>    I got the result :    x value is: -466460838 
>
> Could someone explain to me what was wrong here ?
>
> Thanks a lot. 
>
> tong
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Wed Apr  4 09:26:39 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 4 Apr 2007 08:26:39 +0100 (BST)
Subject: [Rd] Strange number produced by dnorm
In-Reply-To: <dc3f83df14128.4611afd3@usc.edu>
References: <dc3f83df14128.4611afd3@usc.edu>
Message-ID: <Pine.LNX.4.64.0704040823220.7854@auk.stats>

On Tue, 3 Apr 2007, Tong Wang wrote:

> Hi All,

>    I just started to learn compiling C codes for R usage, and got a 
> problem when I was playing with my 'hello world' code.
>
> #include <R.h>
> #include <Rdefines.h>
> #include <Rmath.h>
>
> SEXP test( ) {
>  double x;
>  x=dnorm(1.0,0.0,1.0,1);
>  printf(" x value is: %d \n",x);
>  return(R_NilValue);
> }
>
>   I got the result :    x value is: -466460838
>
> Could someone explain to me what was wrong here ?

double value, integer format (you want %g).
[Also, using printf not Rprintf.]

Please do make use of the ability if your compiler to tell you this.
You haven't told us your platform, but if it is still Windows XP, you 
want to add -Wall -pedantic to your CFLAGS.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Apr  4 09:38:19 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 4 Apr 2007 08:38:19 +0100 (BST)
Subject: [Rd] R callbacks
In-Reply-To: <eb555e660704031617j6ce3f5ebk4ad236e58cf9274a@mail.gmail.com>
References: <eb555e660704021751i30f8854m9f83c81d966ef6a@mail.gmail.com>
	<7DAE25C3-CAD3-4491-8B1E-7A1A5D2EDC49@r-project.org>
	<eb555e660704031617j6ce3f5ebk4ad236e58cf9274a@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0704040702200.8290@gannet.stats.ox.ac.uk>

On Tue, 3 Apr 2007, Deepayan Sarkar wrote:

> On 4/3/07, Simon Urbanek <simon.urbanek at r-project.org> wrote:
>> On Apr 2, 2007, at 8:51 PM, Deepayan Sarkar wrote:
>>
>>> Hi,
>>>
>>> I'm trying to understand (mostly from the R-exts manual) how to use
>>> the callbacks declared in Rinterface.h. As a first attempt, I'm trying
>>> to redefine ptr_R_WriteConsole in a very trivial manner. Here's my
>>> code:
>>>
>>> ---------------
>>> $ cat altr.c
>>>
>>> int Rf_initialize_R(int ac, char **av);
>>>
>>> #define R_INTERFACE_PTRS 1
>>> #include <Rinterface.h>
>>>
>>> extern int R_running_as_main_program;
>>>
>>> static void my_R_WriteConsole(char *buf, int len)
>>> {
>>>     printf("R<< %s", buf);
>>> }
>>>
>>> int main(int ac, char **av)
>>> {
>>>     R_running_as_main_program = 1;
>>>     ptr_R_WriteConsole = my_R_WriteConsole;
>>>     Rf_initialize_R(ac, av);
>>>     Rf_mainloop();
>>>     return 0;
>>> }
>>> ---------------
>>>
>>> I compile and run this in bash with
>>>
>>>
>>> RPROG=R
>>>
>>> INC=`${RPROG} CMD config --cppflags`
>>> LDF=`${RPROG} CMD config --ldflags`
>>> export LD_LIBRARY_PATH=`${RPROG} RHOME`/lib
>>> gcc -o altr ${INC} ${LDF} altr.c
>>>
>>> ${RPROG} CMD ./altr
>>>
>>> However, my customized version seems not to be used. What am I
>>> missing?
>>>
>>
>> 1) see Byron's e-mail
>> 2) by default R uses stdout/err connections instead of the console
>> API, you need to disable that
>>
>> so the resulting code should look like this:
>>
>>      Rf_initialize_R(ac, av);
>>      ptr_R_WriteConsole = my_R_WriteConsole;
>>      R_Outputfile = NULL;
>>      R_Consolefile = NULL;
>>      Rf_mainloop();
>
> Thanks, setting things to NULL was the critical piece (I had tried
> Byron's suggestion myself). A note mentioning this in R-exts would be
> helpful.

Done for 2.5.0.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From p.dalgaard at biostat.ku.dk  Wed Apr  4 09:43:51 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 04 Apr 2007 09:43:51 +0200
Subject: [Rd] Strange number produced by dnorm
In-Reply-To: <dc3f83df14128.4611afd3@usc.edu>
References: <dc3f83df14128.4611afd3@usc.edu>
Message-ID: <46135737.3030200@biostat.ku.dk>

Tong Wang wrote:
> Hi All,
>     I just started to learn compiling C codes for R usage, and got a problem when I was playing with my 'hello world' code. 
>   
> #include <R.h>
> #include <Rdefines.h>    
> #include <Rmath.h>
>
> SEXP test( ) {
>   double x;
>   x=dnorm(1.0,0.0,1.0,1);
>   printf(" x value is: %d \n",x);
>   return(R_NilValue);
> }
>
>    I got the result :    x value is: -466460838 
>
> Could someone explain to me what was wrong here ?
>
>   
Wrong printf format. "%d" is for integers.


From maechler at stat.math.ethz.ch  Wed Apr  4 11:21:26 2007
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 4 Apr 2007 11:21:26 +0200
Subject: [Rd] source(...,
	echo=TRUE) broken in R-2.5.0 alpha and in R-2.6.0 devel
In-Reply-To: <46129D05.5080200@fhcrc.org>
References: <46129D05.5080200@fhcrc.org>
Message-ID: <17939.28182.453575.600227@stat.math.ethz.ch>

>>>>> "Herve" == Herve Pages <hpages at fhcrc.org>
>>>>>     on Tue, 03 Apr 2007 11:29:25 -0700 writes:

    Herve> Hi, I get this error with R-2.5.0 alpha and R-2.6.0
    Herve> devel:

    >> source("http://bioconductor.org/biocLite.R", echo=TRUE)
    Herve>   Error in if (timestamp != srcfile$timestamp)
    Herve> warning("Timestamp of '", : missing value where TRUE/FALSE needed

Indeed, there's a bug 
 iff both 'echo' is TRUE and the ``file'' that is sourced is not
 a proper file (but e.g. a http:// connection).

It looks like the current code in source() and some of its
helper functions such as getSrcLines()
have not yet been "robustified" to work correctly in such a case.

We (R-core) will look at a patch ASAP.

    Herve> Same with 'verbose=TRUE':

yes, since that automatically uses  echo = TRUE

     [...............]

    Herve> The above works fine with R-2.4.1.


From murdoch at stats.uwo.ca  Wed Apr  4 15:07:33 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 04 Apr 2007 09:07:33 -0400
Subject: [Rd] source(...,
 echo=TRUE) broken in R-2.5.0 alpha and in R-2.6.0 devel
In-Reply-To: <17939.28182.453575.600227@stat.math.ethz.ch>
References: <46129D05.5080200@fhcrc.org>
	<17939.28182.453575.600227@stat.math.ethz.ch>
Message-ID: <4613A315.9060608@stats.uwo.ca>

On 4/4/2007 5:21 AM, Martin Maechler wrote:
>>>>>> "Herve" == Herve Pages <hpages at fhcrc.org>
>>>>>>     on Tue, 03 Apr 2007 11:29:25 -0700 writes:
> 
>     Herve> Hi, I get this error with R-2.5.0 alpha and R-2.6.0
>     Herve> devel:
> 
>     >> source("http://bioconductor.org/biocLite.R", echo=TRUE)
>     Herve>   Error in if (timestamp != srcfile$timestamp)
>     Herve> warning("Timestamp of '", : missing value where TRUE/FALSE needed
> 
> Indeed, there's a bug 
>  iff both 'echo' is TRUE and the ``file'' that is sourced is not
>  a proper file (but e.g. a http:// connection).
> 
> It looks like the current code in source() and some of its
> helper functions such as getSrcLines()
> have not yet been "robustified" to work correctly in such a case.
> 
> We (R-core) will look at a patch ASAP.
> 
>     Herve> Same with 'verbose=TRUE':
> 
> yes, since that automatically uses  echo = TRUE
> 
>      [...............]
> 
>     Herve> The above works fine with R-2.4.1.

Thanks for reporting this.

This is now fixed and committed to svn.  It will take a day or two for 
the change to make it onto CRAN.

Duncan Murdoch


From cstrato at aon.at  Wed Apr  4 17:02:53 2007
From: cstrato at aon.at (cstrato)
Date: Wed, 04 Apr 2007 17:02:53 +0200
Subject: [Rd] Problem with S4 inheritance: unexpected re-initialization?
In-Reply-To: <4612CCAB.1080809@fhcrc.org>
References: <46112187.3090009@aon.at> <4612CCAB.1080809@fhcrc.org>
Message-ID: <4613BE1D.5000507@aon.at>

Dear Herve

Thank you for your helpful comments, and I especially appreciate that
you tried to run my package. I will try to answer each point separately.

Herve Pages wrote:
> Hi Christian,
>
> I can only give you a few reasons why IMO it is very unlikely that anybody
> will be able to help you on this, with the current form of your post.
>
> 1) Unless you have a really good reason to do so, don't attach a package
>    to your post. Do your best to provide a few lines of code that anybody
>    can easily copy and paste into their session.
>   
Sorrowly, sometimes, a few lines of code are not sufficient to show
the problem. Furthermore, most of the time there are complaints that
people do not provide enough information, an issue I wanted to avoid.

At the end of my answer I provide now the minimal necessary code for
people to easily copy-paste into their session.

Nevertheless, I also attach the same code as package, since some
problems only appear when compiling the package, concretely:
The behavior of the attached package is completely different, when
I "exportMethods("initialize")" in the NAMESPACE file or not. To see
the changes, please comment-out this one line in the NAMESPACE file.

> 2) Your package is messy (yes I looked at it). You have far too many classes
>    with far too many slots that we don't care about. If you could provide
>    the smallest possible set of classes with the smallest possible set of slots
>    with the smallest possible set of generics and methods that still allow to
>    reproduce the issue you want to show us, that would help!
>   
You are correct, I wanted to provide a complete demo-package. As
mentioned above, I provide now the minimal necessary code (at least
I hope so).

> 3) You show us an example where BaseClass is VIRTUAL (which is indeed how it is
>    defined in your package) and then an example where BaseClass is NOT VIRTUAL.
>    How can we reproduce the latter? Don't expect people to go into your package,
>    change the class definition, reinstall, restart R and then run your example!
>   
I thought, it would be easy for developers to understand what I mean
and to simply comment-out the one line in the definition of BaseClass.

> 4) Note that for clarity and conformance to almost universal convention, it's
>    better to use arrows pointing from derived classes to base classes
>    in your inheritance tree.
>   
Sorry, my mistake.

> 5) It's good to provide the inheritance tree, but it's better when it's complete.
>    I've looked at what you actually have in your package and the complete
>    inheritance tree is something like this:
>
>      BaseClass <- SubClassA
>                <- SubClassB <- SubSubClassA
>                             <- SubSubClassB
>
>    Where is the SubClassA class in the inheritance tree that you included in your
>    post below?
>   
Sorry, my mistake.

> 6) Another thing I note is that you have a naming problem: any reason why you name
>    "SubSubClassA" a subclass of SubClassB? Given that you also have defined SubClassA,
>    this can only lead to confusion!
>   
Again, you are correct, my mistake. Here is the corrected inheritance tree:

   BaseClass <- SubClassA
             <- SubClassB <- SubSubClassB1
             <- SubClassB <- SubSubClassB2

> 7) You need to use proper terminology if you expect people to follow you. In your post
>    below, every time you instanciate a class you say that your are creating it:
>      o "First, I need to create SubClassA..."
>      o "I create both subclasses, SubSubClassA and SubSubClassB..."
>      o etc...
>    Creating a class is not the same as instanciating it!
>   
You are correct, this was confusing. I meant, theat I create an object,
which is probably the same as instanciating a class?

Here is the actual code to use:
 > subA <- 
new("SubClassA",filename="OutSubA",filedir="/Volumes/CoreData/CRAN/",namesubA="NameSubA")
 > subsubB1 <- 
new("SubSubClassB1",filename="MyFileNameB1",filedir="/Volumes/CoreData/",subA=subA)
 > subsubB2 <- 
new("SubSubClassB2",filename="MyFileNameB2",filedir="/Volumes/CoreExtra",subA=subA)

> 8) You start your examples by "First, I need to create SubClassA..." so you are
>    introducing us a class that doesn't show up in your inheritance tree so we don't
>    know how it is related to the other classes. Also you say that you "need" to
>    create SubClassA but we have no idea why!
>   
Once again you are correct, this was confusing. I need to create object
"subA" of class SubClassA, since it is a slot of SubClassB, and needs to
be included in the instanciation of objects "subsubB1" and "subsubB2".

> 9) You have a slot in SubClassB that is of class SubClassA! This means "a SubClassB
>    object _is_ a BaseClass object and it _has_ a slot that is itself a BaseClass
>    object (since a SubClassA object is a BaseClass object too)". I hope that this
>    is really what you want... but maybe this could be related to the fact that you
>    see 2 instanciations of BaseClass when you instanciate SubSubClassA or SubSubClassB.
>   
This is the most IMPORTANT point and may be the cause of my problems:
YES, both SubClassA and SubClassB are derived from BaseClass, AND
SubClassA is a slot of SubClassB. This is what I want indeed!

In real OOP languages such as C++ and Java this is no problem, and I
really hope that this is possible when using S4 classes, too.

> 10) You have several different issues (initialize called multiple times when you expect
>     only 1 time, setValidity not called, etc..). May be they are related, maybe they
>     are not. If you can isolate those problems and make a separate post for each of them,
>     that would help too.
>   
Once again, you are correct, and normally I post these poblems seperately.
However, since I discovered all these problems while trying to solve the
main problem with my classes myself, I have mentioned them in my post.

> You'll be surprised, but once you've made the effort to follow those recommendations,
> it's most likely that you will have a better understanding of what's going on. And you
> might even be able to sort out these issues by yourself!
>   
As you see, I tried to follow most (all?) of your recommendations, but
sorrowly, the problem remains the same.

When you copy-paste the code below and then do:
subA <- 
new("SubClassA",filename="OutSubA",filedir="/Volumes/CoreData/CRAN/",namesubA="NameSubA")
subsubB1 <- 
new("SubSubClassB1",filename="MyFileNameB1",filedir="/Volumes/CoreData/",subA=subA)
subsubB2 <- 
new("SubSubClassB2",filename="MyFileNameB2",filedir="/Volumes/CoreExtra",subA=subA)

you will see that "subA" and "subsubB1" give the correct result, but
"subsubB2" results in the error that "filename" is missing, although it
is supplied.

> Cheers,
> H.
>
>
>   
Thus, I would really appreciate any help.

Best regards
Christian

# - - - - - - - - - - - - - - - - - - BEGIN - - - - - - - - - - - - - - 
- - - - - - -
setClass("BaseClass",
   representation(filename = "character",
                  filedir  = "character",
                  "VIRTUAL"
#                  filedir  = "character"
   ),
   prototype(filename = character(),
             filedir  = as.character(getwd())
   )
)#BaseClass

setClass("SubClassA",
   representation(namesubA = "character"),
   contains=c("BaseClass"),
   prototype(namesubA = "")
)#SubClassA

setClass("SubClassB",
   representation(subA = "SubClassA",
                  data = "data.frame"
   ),

   contains=c("BaseClass"),

   prototype(subA = new("SubClassA"),
             data = data.frame(matrix(nr=0,nc=0))
   )
)#SubClassB

setClass("SubSubClassB1",
   contains=c("SubClassB")
)#SubSubClassB1

setClass("SubSubClassB2",
   representation(namesubsubB2 = "character"),
   contains=c("SubClassB"),
   prototype(namesubsubB2 = "MySubSubB2")
)#SubSubClassB2

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
- - - -
validMsg <- function(msg, result) {
   if (is.character(result)) {
      append(msg, result);
   } else {
      msg;
   }#if
}#validMsg

pathFile <- function(filename=character(0), filedir=character(0)) {
   print("------pathFile------")

   if (length(filename) != 0) {
      filename <- basename(filename);
   }#if
   if (length(filename) == 0) {
      filename <- as.character("ERROR_MISSING_FILENAME");
   }#if
   if (dirname(filename) != ".") {
      filedir <- dirname(filename);
   }#if
   if (filedir == "" || filedir == ".") {
      filedir <- as.character(getwd());
   }#if
   if (substr(filedir, nchar(filedir), nchar(filedir)) == "/") {
      filedir <- substr(filedir, 0, nchar(filedir)-1);
   }#if
   dirfile <- paste(filedir, "/", filename, sep="");
   return(dirfile);
}#pathFile

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
- - - -
"initialize.BaseClass" <-
function(.Object, filename=character(), filedir=as.character(getwd()), 
...) {
   print("------initialize:BaseClass------")
print(paste("BaseClass:init:class(.Object) = ", class(.Object)))

#   .Object <- callNextMethod(.Object, ...);

   dirfile <- pathFile(filename, filedir);
print(paste("BaseClass:init:dirfile = ", dirfile))

   .Object <- callNextMethod(.Object, filename=filename, 
filedir=filedir, ...);

   .Object at filename <- filename;
   .Object at filedir  <- filedir;
   .Object;
}#initialize.BaseClass

setMethod("initialize", "BaseClass", initialize.BaseClass);

setValidity("BaseClass",
   function(object) {
      print("------setValidity:BaseClass------")
print(paste("BaseClass:val:class(object) = ", class(object)))
      msg <- NULL;

      if (!(is.character(object at filedir))) {
#      if (is.na(file.dir(object at filedir))) {
         msg <- validMsg(msg,
                         paste(sQuote("filedir"), "is not a system 
directory"));
      }#if
print(paste("BaseClass:val:filedir = ",object at filedir))

      if (is.null(msg)) TRUE else msg;
   }
)#setValidity

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
- - - -
"initialize.SubClassA" <-
function(.Object, namesubA="MyNameSubA", ...) {
   print("------initialize:SubClassA------")
print(paste("SubClassA:init:class(.Object) = ", class(.Object)))

#   .Object <- callNextMethod(.Object, ...);

   if (namesubA == "") {
      namesubA <- "DefaultNameSubA";
   }#if
print(paste("SubClassA:init:namesubA = ", namesubA))

   .Object <- callNextMethod(.Object, namesubA=namesubA, ...);

   .Object at namesubA <- namesubA;
#validObject(.Object);
   .Object;
}#initialize.SubClassA

setMethod("initialize", "SubClassA", initialize.SubClassA);

setValidity("SubClassA",
   function(object) {
      print("------setValidity:SubClassA------")
print(paste("SubClassA:val:class(object) = ", class(object)))
      msg <- NULL;

      strg <- object at namesubA;
      if (!(is.character(strg) && nchar(strg) > 0)) {
         msg <- validMsg(msg, paste(sQuote("namesubA"), "is missing"));
      }#if
print(paste("SubClassA:val:namesubA = ",object at namesubA))

      if (is.null(msg)) TRUE else msg;
   }
)#setValidity

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
- - - -
"initialize.SubClassB" <-
function(.Object, subA=new("SubClassA"), data = data.frame(), ...) {
   print("------initialize:SubClassB------")
print(paste("SubClassB:init:class(.Object) = ", class(.Object)))

#   .Object <- callNextMethod(.Object, ...);

   .Object <- callNextMethod(.Object, subA=subA, data=data, ...);

   .Object at subA = subA;
   .Object at data = data;
   .Object;
}#initialize.SubClassB

setMethod("initialize", "SubClassB", initialize.SubClassB);

setValidity("SubClassB",
   function(object) {
      print("------setValidity:SubClassB------")
print(paste("SubClassB:val:class(object) = ", class(object)))
      msg <- NULL;

      ## check filename
      strg <- object at filename;
#      if (!(is(strg, "character") && nchar(strg) > 0)) {
      if (!(is.character(strg) && length(strg) > 0)) {
         msg <- validMsg(msg, paste(sQuote("filename"), "is missing"));
      }#if
print(paste("SubClassB:val:filename = ",object at filename))

      if (is.null(msg)) TRUE else msg;
   }
)#setValidity

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
- - - -
"initialize.SubSubClassB1" <-
function(.Object, ...) {
   print("------initialize:SubSubClassB1------")
print(paste("SubSubClassB1:init:class(.Object) = ", class(.Object)))

   .Object <- callNextMethod(.Object, ...);
#validObject(.Object);
   .Object;
}#initialize.SubSubClassB1

setMethod("initialize", "SubSubClassB1", initialize.SubSubClassB1);

setValidity("SubSubClassB1",
   function(object) {
      print("------setValidity:SubSubClassB1------")
print(paste("SubSubClassB1:val:class(.Object) = ", class(object)))
      msg <- NULL;

      if (is.null(msg)) TRUE else msg;
   }
)#setValidity

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
- - - -
"initialize.SubSubClassB2" <-
function(.Object, namesubsubB2="MyNamesubsubB2", ...) {
   print("------initialize:SubSubClassB2------")
print(paste("SubSubClassB2:init:class(.Object) = ", class(.Object)))

#   .Object <- callNextMethod(.Object, ...);

   ## set default subsubnameB
   if (namesubsubB2 == "") {
      namesubsubB2 <- "DefaultNamesubsubB";
   }#if
print(paste("SubSubClassB2:init:namesubsubB2 = ", namesubsubB2))

   .Object <- callNextMethod(.Object, namesubsubB2=namesubsubB2, ...);

   .Object at namesubsubB2 <- namesubsubB2;
#validObject(.Object);
   .Object;
}#initialize.SubSubClassB2

setMethod("initialize", "SubSubClassB2", initialize.SubSubClassB2);

setValidity("SubSubClassB2",
   function(object) {
      print("------setValidity:SubSubClassB2------")
print(paste("SubSubClassB2:val:class(object) = ", class(object)))
      msg <- NULL;

      ## check subsubnameB
      strg <- object at namesubsubB2;
      if (!(is.character(strg) && nchar(strg) > 0)) {
         msg <- validMsg(msg, paste(sQuote("namesubsubB2"), "is missing"));
      }#if
print(paste("SubSubClassB2:val:namesubsubB2 = ",object at namesubsubB2))

      if (is.null(msg)) TRUE else msg;
   }
)#setValidity

# - - - - - - - - - - - - - - - - END  - - - - - - - - - - - - - - - - - 
- - - - - -

-------------- next part --------------
A non-text attachment was scrubbed...
Name: myclasspkg2_0.1.1.tar.gz
Type: application/x-gzip
Size: 3445 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20070404/0546a913/attachment.gz 

From tlumley at u.washington.edu  Wed Apr  4 17:19:42 2007
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Wed, 4 Apr 2007 08:19:42 -0700 (PDT)
Subject: [Rd] Probem with argument "append" in "Rprof"
In-Reply-To: <460F6478.3050308@mango-solutions.com>
References: <460EC5A6.8080401@mango-solutions.com>
	<460F6478.3050308@mango-solutions.com>
Message-ID: <Pine.LNX.4.64.0704040817240.8991@homer24.u.washington.edu>


Thanks for this.  I will look at it over the weekend.

 	-thomas


On Sun, 1 Apr 2007, Romain Francois wrote:

> .... And now I realize I gave the patches in the wrong order, let me try
> again
>
> Cheers,
>
> Romain
>
> Romain Francois wrote:
>> [forgot to attach the second patch in the first mail, sorry.]
>>
>> Hello,
>>
>> Appending information to the profiler's output seems to generate
>> problems. Here is a small example of code :
>>
>> <code r>
>> require(boot)
>> Rprof( memory.profiling = TRUE)
>> Rprof(NULL)
>> for(i in 1:2){
>>   Rprof( memory.profiling = TRUE, append = TRUE)
>>   example(boot)
>>   Rprof(NULL)
>> }
>> </code>
>>
>> The problem is that the file Rprof.out contains more than once the
>> header information:
>>
>> $ grep "sample.interval=" Rprof.out
>> memory profiling: sample.interval=20000
>> memory profiling: sample.interval=20000
>> memory profiling: sample.interval=20000
>>
>> and `summaryRprof` or `R CMD Rprof` are not dealing with it
>>
>>
>>> idx <- grep( "sample", rownames( smp <- summaryRprof()[[1]] ) );
>>>
>> smp[idx, ]
>>                       self.time self.pct total.time total.pct
>> sample.interval=20000         0        0       0.04       0.1
>>
>> `sample.interval=20000` is incorrectly considered as a function.
>>
>>
>> This is not too much of a big deal, but then if I ask for memory
>> profiling information as well, I get nothing:
>>
>>
>>> summaryRprof( mem = "stats")
>>>
>> Error in tapply(1:1L, list(index = c("sample.interval=20000:profiling:",  :
>>         arguments must have same length
>>
>>> summaryRprof( mem = "tseries")
>>>
>> Error in data.frame(..., check.names = FALSE) :
>>         arguments imply differing number of rows: 1, 1490
>>
>>> summaryRprof( mem = "both")
>>>
>> Error in apply(sapply(strsplit(memstuff, ":"), as.numeric), 1, diff) :
>>         dim(X) must have a positive length
>>
>> $ R CMD Rprof Rprof.out
>>
>> Each sample represents  seconds.
>> Total run time: 0 seconds.
>>
>> Total seconds: time spent in function and callees.
>> Self seconds: time spent in function alone.
>>
>>    %       total       %       self
>>  total    seconds     self    seconds    name
>> Illegal division by zero at /usr/local/lib/R/bin/Rprof line 91, <> line
>> 1491.
>>
>> A quick fix could be to ignore all the lines containing sample.interval=
>> except the first one, but then if someone wants to actually change the
>> interval argument in Rprof, it would not be correct. I attach a patch
>> against R-devel/src/library/utils/R/summRprof.R to do that anyway, but I
>> will look at a better solution.
>>
>> I am not fluent enough in Perl to do the same in the Rprof script, it
>> looks like it does not handle the memory profiling information anyway. I
>> am about to learn Perl, so I guess it could be a useful way to do it. I
>> also attach a patch against R-devel/src/scripts/Rprof that would at
>> least get rid of the memory profiling information (if any). This is not
>> as good as dealing with it, but ... this is the first time I ever touch
>> a Perl script.
>>
>>
>> Cheers,
>>
>> Romain
>>
>>
>>
>>
>>> version
>>>
>>
>> _
>> platform
>> i686-pc-linux-gnu
>> arch
>> i686
>> os
>> linux-gnu
>> system         i686,
>> linux-gnu
>> status         Under development
>> (unstable)
>> major
>> 2
>> minor          6.0
>> year
>> 2007
>> month
>> 03
>> day
>> 30
>> svn rev
>> 40983
>> language
>> R
>> version.string R version 2.6.0 Under development (unstable) (2007-03-30
>> r40983)
>>
> -- 
> Mango Solutions
> data analysis that delivers
>
> Tel:  +44(0) 1249 467 467
> Fax:  +44(0) 1249 467 468
> Mob:  +44(0) 7813 526 123
>
>

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From pgilbert at bank-banque-canada.ca  Wed Apr  4 18:10:11 2007
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Wed, 04 Apr 2007 12:10:11 -0400
Subject: [Rd] broken link in posting-guide.html
Message-ID: <4613CDE3.9080104@bank-banque-canada.ca>

There seems to be a broken link at 
<http://www.r-project.org/posting-guide.html> in the line

*Technical details of posting*: See General Instructions 
<http://www.r-project.org/mail#instructions> for more details of the 
following:

Paul Gilbert
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From murdoch at stats.uwo.ca  Wed Apr  4 18:24:59 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 04 Apr 2007 12:24:59 -0400
Subject: [Rd] broken link in posting-guide.html
In-Reply-To: <4613CDE3.9080104@bank-banque-canada.ca>
References: <4613CDE3.9080104@bank-banque-canada.ca>
Message-ID: <4613D15B.6000700@stats.uwo.ca>

On 4/4/2007 12:10 PM, Paul Gilbert wrote:
> There seems to be a broken link at 
> <http://www.r-project.org/posting-guide.html> in the line
> 
> *Technical details of posting*: See General Instructions 
> <http://www.r-project.org/mail#instructions> for more details of the 
> following:
> 

Thanks, I'll fix it.  ("mail" should be "mail.html".)

Duncan Murdoch


From hpages at fhcrc.org  Wed Apr  4 19:20:59 2007
From: hpages at fhcrc.org (Herve Pages)
Date: Wed, 04 Apr 2007 10:20:59 -0700
Subject: [Rd] source(...,
 echo=TRUE) broken in R-2.5.0 alpha and in R-2.6.0 devel
In-Reply-To: <4613A315.9060608@stats.uwo.ca>
References: <46129D05.5080200@fhcrc.org>
	<17939.28182.453575.600227@stat.math.ethz.ch>
	<4613A315.9060608@stats.uwo.ca>
Message-ID: <4613DE7B.2020201@fhcrc.org>

Duncan Murdoch wrote:
> 
> Thanks for reporting this.
> 
> This is now fixed and committed to svn.  It will take a day or two for
> the change to make it onto CRAN.

OK. Thanks Martin and Duncan!

Cheers,
H.


From Peter.Ruckdeschel at uni-bayreuth.de  Wed Apr  4 19:25:25 2007
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Wed, 04 Apr 2007 19:25:25 +0200
Subject: [Rd] Exchange of information between functions aside from
 argument/return-value interface
Message-ID: <4613DF85.6030002@uni-bayreuth.de>

Hi R-devels,

I would like to ask for your advice on the preferred way to exchange
information between functions aside from the regular argument/return-value
interface.

I am well aware that, S being a functional language, this is to be avoided
where possible. There are exceptions, though:

Let myF() and myH() be functions provided by me, and notmyG() be a function
provided by someone else.

The calling hierarchie is myF() calls notmyG() which calls --- possibly
with other functions being called in between ---  myH().

notmyG() takes as argument a function with return value of type numeric
--- typically a function for optimizing, integrating or zero-finding ---
and is a function which I do not want to modify (and subsequently maintain
the modification).

As myH() is expensive as to evaluation time and, as a side effect, also
provides important side information, I would like to pass this information
back to myF(). (Also see example below).

Using information from myF() in myH() by lexical scoping is straight
forward, whereas to pass information from myH() to myF() directly, the
solution I found so far is to use assign() with a corresponding
envir=./pos=.-argument.

(Q1) Is there a better way to do so?

While it is not too difficult to find out the correct value for the
envir/pos argument when using "pure" R-functions for notmyG(), the
situation is a little more complicated as soon as notmyG() calls myH()
through intermediate calls to .Internal() as in case of optim(),
uniroot().

Is there any way to

(Q2a) find out a corresponding correct value for argument envir/pos in assign
      ---on run-time---, i.e. how many layers of calls are between
      myF() and myH()?

 --- my first guess was to use sys.frame() but I am not convinced...

(Q2b) to make myH() when called from within a call to .Internal()
      perform assignments in the environment of myF()

?

Or should we proceed in a completely different way?

Thank you already for your advice,

Peter

--------------------------------------------------------------------------
--- Example:

To given clipping height b, myH() calculates an "optimal"  influence curve
which involves determining certain Lagrange multipliers in a fixed-point type
algorithm.
To determine b according to a certain criterium, moreover, myH() evaluates
a function H0 in b, the zero of which will be the "optimal" b.

So to use notmyG()=uniroot() as zero-finder the return value of myH()
should be H0(b), while myF() should also get to know about the Lagrange
multipliers determined in myH().


From jelkink at gmail.com  Wed Apr  4 19:44:03 2007
From: jelkink at gmail.com (Jos Elkink)
Date: Wed, 4 Apr 2007 13:44:03 -0400
Subject: [Rd] Accessing C++ code from R
Message-ID: <cc06ac9d0704041044l273113ecn5c6d6153ba3cfbeb@mail.gmail.com>

Hi,

I am trying to use existing C++ code from R. I have no problems
compiling C code and using it in R, but with C++ I'm running into
problems.

Here's the compiler output:

Macintosh-10:~/Desktop/dissertation/Model - CPP version/R labguest$
g++ -I/Library/Frameworks/R.framework/Resources/include
-I/Library/Frameworks/R.framework/Resources/include/i386 *.cpp
In file included from /usr/include/c++/4.0.0/bits/locale_facets.h:1533,
                 from /usr/include/c++/4.0.0/bits/basic_ios.h:44,
                 from /usr/include/c++/4.0.0/ios:50,
                 from /usr/include/c++/4.0.0/ostream:44,
                 from /usr/include/c++/4.0.0/iostream:44,
                 from main.cpp:5:
/usr/include/c++/4.0.0/bits/codecvt.h:217:45: error: macro "length"
passed 4 arguments, but takes just 1
/usr/include/c++/4.0.0/bits/codecvt.h:216: error: expected ';' before 'const'
/usr/include/c++/4.0.0/bits/codecvt.h:220: error: expected `;' before 'int'
main.cpp:51: error: brace-enclosed initializer used to initialize
'R_NativePrimitiveArgType*'


Line 51 refers to the standard part to register the function in R:

R_CMethodDef cMethods[] = {
  {"runSimulation", (void* (*) ()) &runSimulation, 27, {INTSXP,
INTSXP, INTSXP, REALSXP, REALSXP, REALSXP, INTSXP, INTSXP, INTSXP,
INTSXP, INTSXP, INTSXP, REALSXP, REALSXP, INTSXP, INTSXP, INTSXP,
INTSXP, INTSXP, INTSXP, INTSXP, INTSXP, INTSXP, INTSXP, REALSXP,
REALSXP, REALSXP}},
  {NULL, NULL, 0}
};


I had to add the explicit cast of &runSimulation to get rid of one
compiler error, but do not know how to deal with this one.
Encapsulating this part of the code in

extern "C" {
}

has no effect.

runSimulation is just a regular function, with a lot of int* and
double* parameters, and it is not part of a class. It does inside
create a class, though.

Outline:

void runSimulation(int *p_1 ... etc) {

   try {
     CModel Model();
     Model.Run();
   } catch (CException& e) {
     cout << "exception" << endl;
   }
}

Encapsulating this function in extern "C" also has no effect.

Anyone any ideas what I should do? The system I am using is an Intel-based Mac.

Thanks in advance!

Jos


From luke at stat.uiowa.edu  Wed Apr  4 19:46:56 2007
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Wed, 4 Apr 2007 12:46:56 -0500 (CDT)
Subject: [Rd] Exchange of information between functions aside from
 argument/return-value interface
In-Reply-To: <4613DF85.6030002@uni-bayreuth.de>
References: <4613DF85.6030002@uni-bayreuth.de>
Message-ID: <Pine.LNX.4.64.0704041245320.17651@nokomis.stat.uiowa.edu>

On Wed, 4 Apr 2007, Peter Ruckdeschel wrote:

> Hi R-devels,
>
> I would like to ask for your advice on the preferred way to exchange
> information between functions aside from the regular argument/return-value
> interface.
>
> I am well aware that, S being a functional language, this is to be avoided
> where possible. There are exceptions, though:
>
> Let myF() and myH() be functions provided by me, and notmyG() be a function
> provided by someone else.
>
> The calling hierarchie is myF() calls notmyG() which calls --- possibly
> with other functions being called in between ---  myH().
>
> notmyG() takes as argument a function with return value of type numeric
> --- typically a function for optimizing, integrating or zero-finding ---
> and is a function which I do not want to modify (and subsequently maintain
> the modification).
>
> As myH() is expensive as to evaluation time and, as a side effect, also
> provides important side information, I would like to pass this information
> back to myF(). (Also see example below).
>
> Using information from myF() in myH() by lexical scoping is straight
> forward, whereas to pass information from myH() to myF() directly, the
> solution I found so far is to use assign() with a corresponding
> envir=./pos=.-argument.
>
> (Q1) Is there a better way to do so?
>

Sounds like lexical scoping should work for this also -- use <<- to
assign to the variable in the containing scope.

Best,

luke

> While it is not too difficult to find out the correct value for the
> envir/pos argument when using "pure" R-functions for notmyG(), the
> situation is a little more complicated as soon as notmyG() calls myH()
> through intermediate calls to .Internal() as in case of optim(),
> uniroot().
>
> Is there any way to
>
> (Q2a) find out a corresponding correct value for argument envir/pos in assign
>      ---on run-time---, i.e. how many layers of calls are between
>      myF() and myH()?
>
> --- my first guess was to use sys.frame() but I am not convinced...
>
> (Q2b) to make myH() when called from within a call to .Internal()
>      perform assignments in the environment of myF()
>
> ?
>
> Or should we proceed in a completely different way?
>
> Thank you already for your advice,
>
> Peter
>
> --------------------------------------------------------------------------
> --- Example:
>
> To given clipping height b, myH() calculates an "optimal"  influence curve
> which involves determining certain Lagrange multipliers in a fixed-point type
> algorithm.
> To determine b according to a certain criterium, moreover, myH() evaluates
> a function H0 in b, the zero of which will be the "optimal" b.
>
> So to use notmyG()=uniroot() as zero-finder the return value of myH()
> should be H0(b), while myF() should also get to know about the Lagrange
> multipliers determined in myH().
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From Peter.Ruckdeschel at uni-bayreuth.de  Wed Apr  4 20:27:21 2007
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Wed, 04 Apr 2007 20:27:21 +0200
Subject: [Rd] Exchange of information between functions aside from
 argument/return-value interface
In-Reply-To: <Pine.LNX.4.64.0704041245320.17651@nokomis.stat.uiowa.edu>
References: <4613DF85.6030002@uni-bayreuth.de>
	<Pine.LNX.4.64.0704041245320.17651@nokomis.stat.uiowa.edu>
Message-ID: <4613EE09.8000809@uni-bayreuth.de>

Thank you, Luke, for your promptous response.

[snipped away my original message; to be found on
 https://stat.ethz.ch/pipermail/r-devel/2007-April/045216.html]

> Sounds like lexical scoping should work for this also -- use <<- to
> assign to the variable in the containing scope.
> 
> Best,
> 
> luke

yes, in my application, this really solves the problem. Thank you.


But I am not quite sure for the general situation:

Recall that we have the sequence of calls

myF() calls notmyG() which --with possibly more functions involved in between--
directly or indirectly calls myH().

Now, if I do not know exactly which variables are defined
in the intermediate notmyG() or in some of the functions called "in between",
I would have thought that using

VariableInMyF <<- something

within myH() bears the danger that I am overwriting
a variable of name VariableInMyF in notmyG() and "in-between's"
instead of in myF().

Or did I get something wrong?

Thanks for your help
Peter


From simon.urbanek at r-project.org  Wed Apr  4 20:34:03 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 4 Apr 2007 14:34:03 -0400
Subject: [Rd] Accessing C++ code from R
In-Reply-To: <cc06ac9d0704041044l273113ecn5c6d6153ba3cfbeb@mail.gmail.com>
References: <cc06ac9d0704041044l273113ecn5c6d6153ba3cfbeb@mail.gmail.com>
Message-ID: <5C9CB370-AC77-4A0C-A081-433AEC58E1C3@r-project.org>

Jos,

you omitted the crucial part but my guess would be that all you have  
to do is to put #include <iostream> *before* R headers includes (R  
defines "length" which throws off iostream).
Also note that using cout is not a good idea, because it is not  
captured by R, you should be using Rprintf instead.

Cheers,
Simon

On Apr 4, 2007, at 1:44 PM, Jos Elkink wrote:

> Hi,
>
> I am trying to use existing C++ code from R. I have no problems
> compiling C code and using it in R, but with C++ I'm running into
> problems.
>
> Here's the compiler output:
>
> Macintosh-10:~/Desktop/dissertation/Model - CPP version/R labguest$
> g++ -I/Library/Frameworks/R.framework/Resources/include
> -I/Library/Frameworks/R.framework/Resources/include/i386 *.cpp
> In file included from /usr/include/c++/4.0.0/bits/locale_facets.h: 
> 1533,
>                  from /usr/include/c++/4.0.0/bits/basic_ios.h:44,
>                  from /usr/include/c++/4.0.0/ios:50,
>                  from /usr/include/c++/4.0.0/ostream:44,
>                  from /usr/include/c++/4.0.0/iostream:44,
>                  from main.cpp:5:
> /usr/include/c++/4.0.0/bits/codecvt.h:217:45: error: macro "length"
> passed 4 arguments, but takes just 1
> /usr/include/c++/4.0.0/bits/codecvt.h:216: error: expected ';'  
> before 'const'
> /usr/include/c++/4.0.0/bits/codecvt.h:220: error: expected `;'  
> before 'int'
> main.cpp:51: error: brace-enclosed initializer used to initialize
> 'R_NativePrimitiveArgType*'
>
>
> Line 51 refers to the standard part to register the function in R:
>
> R_CMethodDef cMethods[] = {
>   {"runSimulation", (void* (*) ()) &runSimulation, 27, {INTSXP,
> INTSXP, INTSXP, REALSXP, REALSXP, REALSXP, INTSXP, INTSXP, INTSXP,
> INTSXP, INTSXP, INTSXP, REALSXP, REALSXP, INTSXP, INTSXP, INTSXP,
> INTSXP, INTSXP, INTSXP, INTSXP, INTSXP, INTSXP, INTSXP, REALSXP,
> REALSXP, REALSXP}},
>   {NULL, NULL, 0}
> };
>
>
> I had to add the explicit cast of &runSimulation to get rid of one
> compiler error, but do not know how to deal with this one.
> Encapsulating this part of the code in
>
> extern "C" {
> }
>
> has no effect.
>
> runSimulation is just a regular function, with a lot of int* and
> double* parameters, and it is not part of a class. It does inside
> create a class, though.
>
> Outline:
>
> void runSimulation(int *p_1 ... etc) {
>
>    try {
>      CModel Model();
>      Model.Run();
>    } catch (CException& e) {
>      cout << "exception" << endl;
>    }
> }
>
> Encapsulating this function in extern "C" also has no effect.
>
> Anyone any ideas what I should do? The system I am using is an  
> Intel-based Mac.
>
> Thanks in advance!
>
> Jos
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From hpages at fhcrc.org  Wed Apr  4 20:42:14 2007
From: hpages at fhcrc.org (Herve Pages)
Date: Wed, 04 Apr 2007 11:42:14 -0700
Subject: [Rd] Problem with S4 inheritance: unexpected re-initialization?
In-Reply-To: <4613BE1D.5000507@aon.at>
References: <46112187.3090009@aon.at> <4612CCAB.1080809@fhcrc.org>
	<4613BE1D.5000507@aon.at>
Message-ID: <4613F186.1060507@fhcrc.org>

Hi Christian,

cstrato wrote:
> Dear Herve
> 
> Thank you for your helpful comments, and I especially appreciate that
> you tried to run my package. I will try to answer each point separately.
> 
> Herve Pages wrote:
>> Hi Christian,
>>
>> I can only give you a few reasons why IMO it is very unlikely that
>> anybody
>> will be able to help you on this, with the current form of your post.
>>
>> 1) Unless you have a really good reason to do so, don't attach a package
>>    to your post. Do your best to provide a few lines of code that anybody
>>    can easily copy and paste into their session.
>>   
> Sorrowly, sometimes, a few lines of code are not sufficient to show
> the problem. Furthermore, most of the time there are complaints that
> people do not provide enough information, an issue I wanted to avoid.

The code you provide below is still too long and overcluttered with stuff that is
probably unrelated with the issue you want to discuss. Your class definitions
still have slots that we don't care about. Basically if you want to
discuss an S4 issue, you should get rid of all this file system related stuff
(the 'dirfile', 'filedir', 'filename' slots, the 'pathFile' function, the dozens
of calls to 'basename', 'dirname', 'getwd', 'file.dir' etc...)

Also your code is dirty and hard to read. Take this for example:

  "initialize.BaseClass" <-
  function(.Object, filename=character(), filedir=as.character(getwd()), ...) {
    print("------initialize:BaseClass------")
  print(paste("BaseClass:init:class(.Object) = ", class(.Object)))

  #   .Object <- callNextMethod(.Object, ...);

    dirfile <- pathFile(filename, filedir);
  print(paste("BaseClass:init:dirfile = ", dirfile))

    .Object <- callNextMethod(.Object, filename=filename, filedir=filedir, ...);

    .Object at filename <- filename;
    .Object at filedir  <- filedir;
    .Object;
  }#initialize.BaseClass

  setMethod("initialize", "BaseClass", initialize.BaseClass);

o It's not properly indented.
o Why those empty lines in the middle of such a short function?
o Why those semi-columns at the end of lines?
o Why put the implementation of the initialize method into a separate function?
o Why use this construct 'print(paste())' instead of just 'cat()'?
o Why leave the first call to callNextMethod() commented?
o What do you do with 'dirfile', except that you print it? Do you need this for
  the purpose of the S4 discussion?

What about adopting this style:

    setMethod("initialize", "BaseClass",
        function(.Object, filename=character(), filedir=as.character(getwd()), ...)
        {
            cat("------initialize:BaseClass------\n")
            cat("BaseClass:init:class(.Object) = ", class(.Object))
            .Object <- callNextMethod(.Object, filename=filename, filedir=filedir, ...)
            .Object at filename <- filename
            .Object at filedir  <- filedir
            .Object
        }
    )

That's for the style. Now let's talk about the semantic. Here is the definition of
your BaseClass class:

    setClass("BaseClass",
        representation(
            "VIRTUAL",
            filename="character",
            filedir="character"
        ),
        prototype(
            filename = character(),
            filedir  = as.character(getwd())
        )
    )

(Note that this definition is what _I_ get after I cleaned it and indented it which
is something that _you_ are expected to do.)

o Initializing the 'filename' slot to character() is useless since this is the default.
o Wrapping getwd() inside as.character() is useless since getwd() returns a character vector.
o BUT MOST IMPORTANTLY THAN ANYTHING ELSE: given the fact that you've provided a prototype
  for class BaseClass, your initialize method is useless since it does _nothing_ more
  than what the default initialize method does! If you want to define your own "initialize"
  method for the only purpose of printing messages, then you could do it in a much simpler
  way:

    setMethod("initialize", "BaseClass",
        function(.Object, ...)
        {
            cat("------initialize:BaseClass------\n")
            cat("BaseClass:init:class(.Object) = ", class(.Object), "\n", sep="")
            callNextMethod()
        }
    )

But as I said initially, the file system related stuff is useless to illustrate the
S4 issue you want to show us so why didn't you just provide:

    setClass("BaseClass",
        representation("VIRTUAL", slot1="character"),
        prototype(slot1="aaa")
    )

    setMethod("initialize", "BaseClass",
        function(.Object, ...)
        {
            cat("------initialize:BaseClass------\n")
            cat("BaseClass:init:class(.Object) = ", class(.Object), "\n", sep="")
            callNextMethod()
        }
    )

See? I ended up by replacing 25 lines of your hard-to-read/confusing code by 12
lines of clean code containing only the STRICTLY NECESSARY stuff for an S4 discussion.
That's what you should have done instead of sending us 150 lines of code.

Sorrowly people will not try to read your code unless it's obvious that _you_ did your
best to provide the cleanest/simplest possible code that illustrates the issue you want
to discuss.

Also maybe you could try to read a little bit more about S4 and initialization mechanisms.

Cheers,
H.

> 
> At the end of my answer I provide now the minimal necessary code for
> people to easily copy-paste into their session.
> 
> Nevertheless, I also attach the same code as package, since some
> problems only appear when compiling the package, concretely:
> The behavior of the attached package is completely different, when
> I "exportMethods("initialize")" in the NAMESPACE file or not. To see
> the changes, please comment-out this one line in the NAMESPACE file.
> 
>> 2) Your package is messy (yes I looked at it). You have far too many
>> classes
>>    with far too many slots that we don't care about. If you could provide
>>    the smallest possible set of classes with the smallest possible set
>> of slots
>>    with the smallest possible set of generics and methods that still
>> allow to
>>    reproduce the issue you want to show us, that would help!
>>   
> You are correct, I wanted to provide a complete demo-package. As
> mentioned above, I provide now the minimal necessary code (at least
> I hope so).
> 
>> 3) You show us an example where BaseClass is VIRTUAL (which is indeed
>> how it is
>>    defined in your package) and then an example where BaseClass is NOT
>> VIRTUAL.
>>    How can we reproduce the latter? Don't expect people to go into
>> your package,
>>    change the class definition, reinstall, restart R and then run your
>> example!
>>   
> I thought, it would be easy for developers to understand what I mean
> and to simply comment-out the one line in the definition of BaseClass.
> 
>> 4) Note that for clarity and conformance to almost universal
>> convention, it's
>>    better to use arrows pointing from derived classes to base classes
>>    in your inheritance tree.
>>   
> Sorry, my mistake.
> 
>> 5) It's good to provide the inheritance tree, but it's better when
>> it's complete.
>>    I've looked at what you actually have in your package and the complete
>>    inheritance tree is something like this:
>>
>>      BaseClass <- SubClassA
>>                <- SubClassB <- SubSubClassA
>>                             <- SubSubClassB
>>
>>    Where is the SubClassA class in the inheritance tree that you
>> included in your
>>    post below?
>>   
> Sorry, my mistake.
> 
>> 6) Another thing I note is that you have a naming problem: any reason
>> why you name
>>    "SubSubClassA" a subclass of SubClassB? Given that you also have
>> defined SubClassA,
>>    this can only lead to confusion!
>>   
> Again, you are correct, my mistake. Here is the corrected inheritance tree:
> 
>   BaseClass <- SubClassA
>             <- SubClassB <- SubSubClassB1
>             <- SubClassB <- SubSubClassB2
> 
>> 7) You need to use proper terminology if you expect people to follow
>> you. In your post
>>    below, every time you instanciate a class you say that your are
>> creating it:
>>      o "First, I need to create SubClassA..."
>>      o "I create both subclasses, SubSubClassA and SubSubClassB..."
>>      o etc...
>>    Creating a class is not the same as instanciating it!
>>   
> You are correct, this was confusing. I meant, theat I create an object,
> which is probably the same as instanciating a class?
> 
> Here is the actual code to use:
>> subA <-
> new("SubClassA",filename="OutSubA",filedir="/Volumes/CoreData/CRAN/",namesubA="NameSubA")
> 
>> subsubB1 <-
> new("SubSubClassB1",filename="MyFileNameB1",filedir="/Volumes/CoreData/",subA=subA)
> 
>> subsubB2 <-
> new("SubSubClassB2",filename="MyFileNameB2",filedir="/Volumes/CoreExtra",subA=subA)
> 
> 
>> 8) You start your examples by "First, I need to create SubClassA..."
>> so you are
>>    introducing us a class that doesn't show up in your inheritance
>> tree so we don't
>>    know how it is related to the other classes. Also you say that you
>> "need" to
>>    create SubClassA but we have no idea why!
>>   
> Once again you are correct, this was confusing. I need to create object
> "subA" of class SubClassA, since it is a slot of SubClassB, and needs to
> be included in the instanciation of objects "subsubB1" and "subsubB2".
> 
>> 9) You have a slot in SubClassB that is of class SubClassA! This means
>> "a SubClassB
>>    object _is_ a BaseClass object and it _has_ a slot that is itself a
>> BaseClass
>>    object (since a SubClassA object is a BaseClass object too)". I
>> hope that this
>>    is really what you want... but maybe this could be related to the
>> fact that you
>>    see 2 instanciations of BaseClass when you instanciate SubSubClassA
>> or SubSubClassB.
>>   
> This is the most IMPORTANT point and may be the cause of my problems:
> YES, both SubClassA and SubClassB are derived from BaseClass, AND
> SubClassA is a slot of SubClassB. This is what I want indeed!
> 
> In real OOP languages such as C++ and Java this is no problem, and I
> really hope that this is possible when using S4 classes, too.
> 
>> 10) You have several different issues (initialize called multiple
>> times when you expect
>>     only 1 time, setValidity not called, etc..). May be they are
>> related, maybe they
>>     are not. If you can isolate those problems and make a separate
>> post for each of them,
>>     that would help too.
>>   
> Once again, you are correct, and normally I post these poblems seperately.
> However, since I discovered all these problems while trying to solve the
> main problem with my classes myself, I have mentioned them in my post.
> 
>> You'll be surprised, but once you've made the effort to follow those
>> recommendations,
>> it's most likely that you will have a better understanding of what's
>> going on. And you
>> might even be able to sort out these issues by yourself!
>>   
> As you see, I tried to follow most (all?) of your recommendations, but
> sorrowly, the problem remains the same.
> 
> When you copy-paste the code below and then do:
> subA <-
> new("SubClassA",filename="OutSubA",filedir="/Volumes/CoreData/CRAN/",namesubA="NameSubA")
> 
> subsubB1 <-
> new("SubSubClassB1",filename="MyFileNameB1",filedir="/Volumes/CoreData/",subA=subA)
> 
> subsubB2 <-
> new("SubSubClassB2",filename="MyFileNameB2",filedir="/Volumes/CoreExtra",subA=subA)
> 
> 
> you will see that "subA" and "subsubB1" give the correct result, but
> "subsubB2" results in the error that "filename" is missing, although it
> is supplied.
> 
>> Cheers,
>> H.
>>
>>
>>   
> Thus, I would really appreciate any help.
> 
> Best regards
> Christian
> 
> # - - - - - - - - - - - - - - - - - - BEGIN - - - - - - - - - - - - - -
> - - - - - - -
> setClass("BaseClass",
>   representation(filename = "character",
>                  filedir  = "character",
>                  "VIRTUAL"
> #                  filedir  = "character"
>   ),
>   prototype(filename = character(),
>             filedir  = as.character(getwd())
>   )
> )#BaseClass
> 
> setClass("SubClassA",
>   representation(namesubA = "character"),
>   contains=c("BaseClass"),
>   prototype(namesubA = "")
> )#SubClassA
> 
> setClass("SubClassB",
>   representation(subA = "SubClassA",
>                  data = "data.frame"
>   ),
> 
>   contains=c("BaseClass"),
> 
>   prototype(subA = new("SubClassA"),
>             data = data.frame(matrix(nr=0,nc=0))
>   )
> )#SubClassB
> 
> setClass("SubSubClassB1",
>   contains=c("SubClassB")
> )#SubSubClassB1
> 
> setClass("SubSubClassB2",
>   representation(namesubsubB2 = "character"),
>   contains=c("SubClassB"),
>   prototype(namesubsubB2 = "MySubSubB2")
> )#SubSubClassB2
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
> - - - -
> validMsg <- function(msg, result) {
>   if (is.character(result)) {
>      append(msg, result);
>   } else {
>      msg;
>   }#if
> }#validMsg
> 
> pathFile <- function(filename=character(0), filedir=character(0)) {
>   print("------pathFile------")
> 
>   if (length(filename) != 0) {
>      filename <- basename(filename);
>   }#if
>   if (length(filename) == 0) {
>      filename <- as.character("ERROR_MISSING_FILENAME");
>   }#if
>   if (dirname(filename) != ".") {
>      filedir <- dirname(filename);
>   }#if
>   if (filedir == "" || filedir == ".") {
>      filedir <- as.character(getwd());
>   }#if
>   if (substr(filedir, nchar(filedir), nchar(filedir)) == "/") {
>      filedir <- substr(filedir, 0, nchar(filedir)-1);
>   }#if
>   dirfile <- paste(filedir, "/", filename, sep="");
>   return(dirfile);
> }#pathFile
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
> - - - -
> "initialize.BaseClass" <-
> function(.Object, filename=character(), filedir=as.character(getwd()),
> ...) {
>   print("------initialize:BaseClass------")
> print(paste("BaseClass:init:class(.Object) = ", class(.Object)))
> 
> #   .Object <- callNextMethod(.Object, ...);
> 
>   dirfile <- pathFile(filename, filedir);
> print(paste("BaseClass:init:dirfile = ", dirfile))
> 
>   .Object <- callNextMethod(.Object, filename=filename, filedir=filedir,
> ...);
> 
>   .Object at filename <- filename;
>   .Object at filedir  <- filedir;
>   .Object;
> }#initialize.BaseClass
> 
> setMethod("initialize", "BaseClass", initialize.BaseClass);
> 
> setValidity("BaseClass",
>   function(object) {
>      print("------setValidity:BaseClass------")
> print(paste("BaseClass:val:class(object) = ", class(object)))
>      msg <- NULL;
> 
>      if (!(is.character(object at filedir))) {
> #      if (is.na(file.dir(object at filedir))) {
>         msg <- validMsg(msg,
>                         paste(sQuote("filedir"), "is not a system
> directory"));
>      }#if
> print(paste("BaseClass:val:filedir = ",object at filedir))
> 
>      if (is.null(msg)) TRUE else msg;
>   }
> )#setValidity
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
> - - - -
> "initialize.SubClassA" <-
> function(.Object, namesubA="MyNameSubA", ...) {
>   print("------initialize:SubClassA------")
> print(paste("SubClassA:init:class(.Object) = ", class(.Object)))
> 
> #   .Object <- callNextMethod(.Object, ...);
> 
>   if (namesubA == "") {
>      namesubA <- "DefaultNameSubA";
>   }#if
> print(paste("SubClassA:init:namesubA = ", namesubA))
> 
>   .Object <- callNextMethod(.Object, namesubA=namesubA, ...);
> 
>   .Object at namesubA <- namesubA;
> #validObject(.Object);
>   .Object;
> }#initialize.SubClassA
> 
> setMethod("initialize", "SubClassA", initialize.SubClassA);
> 
> setValidity("SubClassA",
>   function(object) {
>      print("------setValidity:SubClassA------")
> print(paste("SubClassA:val:class(object) = ", class(object)))
>      msg <- NULL;
> 
>      strg <- object at namesubA;
>      if (!(is.character(strg) && nchar(strg) > 0)) {
>         msg <- validMsg(msg, paste(sQuote("namesubA"), "is missing"));
>      }#if
> print(paste("SubClassA:val:namesubA = ",object at namesubA))
> 
>      if (is.null(msg)) TRUE else msg;
>   }
> )#setValidity
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
> - - - -
> "initialize.SubClassB" <-
> function(.Object, subA=new("SubClassA"), data = data.frame(), ...) {
>   print("------initialize:SubClassB------")
> print(paste("SubClassB:init:class(.Object) = ", class(.Object)))
> 
> #   .Object <- callNextMethod(.Object, ...);
> 
>   .Object <- callNextMethod(.Object, subA=subA, data=data, ...);
> 
>   .Object at subA = subA;
>   .Object at data = data;
>   .Object;
> }#initialize.SubClassB
> 
> setMethod("initialize", "SubClassB", initialize.SubClassB);
> 
> setValidity("SubClassB",
>   function(object) {
>      print("------setValidity:SubClassB------")
> print(paste("SubClassB:val:class(object) = ", class(object)))
>      msg <- NULL;
> 
>      ## check filename
>      strg <- object at filename;
> #      if (!(is(strg, "character") && nchar(strg) > 0)) {
>      if (!(is.character(strg) && length(strg) > 0)) {
>         msg <- validMsg(msg, paste(sQuote("filename"), "is missing"));
>      }#if
> print(paste("SubClassB:val:filename = ",object at filename))
> 
>      if (is.null(msg)) TRUE else msg;
>   }
> )#setValidity
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
> - - - -
> "initialize.SubSubClassB1" <-
> function(.Object, ...) {
>   print("------initialize:SubSubClassB1------")
> print(paste("SubSubClassB1:init:class(.Object) = ", class(.Object)))
> 
>   .Object <- callNextMethod(.Object, ...);
> #validObject(.Object);
>   .Object;
> }#initialize.SubSubClassB1
> 
> setMethod("initialize", "SubSubClassB1", initialize.SubSubClassB1);
> 
> setValidity("SubSubClassB1",
>   function(object) {
>      print("------setValidity:SubSubClassB1------")
> print(paste("SubSubClassB1:val:class(.Object) = ", class(object)))
>      msg <- NULL;
> 
>      if (is.null(msg)) TRUE else msg;
>   }
> )#setValidity
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
> - - - -
> "initialize.SubSubClassB2" <-
> function(.Object, namesubsubB2="MyNamesubsubB2", ...) {
>   print("------initialize:SubSubClassB2------")
> print(paste("SubSubClassB2:init:class(.Object) = ", class(.Object)))
> 
> #   .Object <- callNextMethod(.Object, ...);
> 
>   ## set default subsubnameB
>   if (namesubsubB2 == "") {
>      namesubsubB2 <- "DefaultNamesubsubB";
>   }#if
> print(paste("SubSubClassB2:init:namesubsubB2 = ", namesubsubB2))
> 
>   .Object <- callNextMethod(.Object, namesubsubB2=namesubsubB2, ...);
> 
>   .Object at namesubsubB2 <- namesubsubB2;
> #validObject(.Object);
>   .Object;
> }#initialize.SubSubClassB2
> 
> setMethod("initialize", "SubSubClassB2", initialize.SubSubClassB2);
> 
> setValidity("SubSubClassB2",
>   function(object) {
>      print("------setValidity:SubSubClassB2------")
> print(paste("SubSubClassB2:val:class(object) = ", class(object)))
>      msg <- NULL;
> 
>      ## check subsubnameB
>      strg <- object at namesubsubB2;
>      if (!(is.character(strg) && nchar(strg) > 0)) {
>         msg <- validMsg(msg, paste(sQuote("namesubsubB2"), "is missing"));
>      }#if
> print(paste("SubSubClassB2:val:namesubsubB2 = ",object at namesubsubB2))
> 
>      if (is.null(msg)) TRUE else msg;
>   }
> )#setValidity
> 
> # - - - - - - - - - - - - - - - - END  - - - - - - - - - - - - - - - - -
> - - - - - -
>


From luke at stat.uiowa.edu  Wed Apr  4 20:45:25 2007
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Wed, 4 Apr 2007 13:45:25 -0500 (CDT)
Subject: [Rd] Exchange of information between functions aside from
 argument/return-value interface
In-Reply-To: <4613EE09.8000809@uni-bayreuth.de>
References: <4613DF85.6030002@uni-bayreuth.de>
	<Pine.LNX.4.64.0704041245320.17651@nokomis.stat.uiowa.edu>
	<4613EE09.8000809@uni-bayreuth.de>
Message-ID: <Pine.LNX.4.64.0704041337480.17651@nokomis.stat.uiowa.edu>

On Wed, 4 Apr 2007, Peter Ruckdeschel wrote:

> Thank you, Luke, for your promptous response.
>
> [snipped away my original message; to be found on
> https://stat.ethz.ch/pipermail/r-devel/2007-April/045216.html]
>
>> Sounds like lexical scoping should work for this also -- use <<- to
>> assign to the variable in the containing scope.
>>
>> Best,
>>
>> luke
>
> yes, in my application, this really solves the problem. Thank you.
>
>
> But I am not quite sure for the general situation:
>
> Recall that we have the sequence of calls
>
> myF() calls notmyG() which --with possibly more functions involved in between--
> directly or indirectly calls myH().
>
> Now, if I do not know exactly which variables are defined
> in the intermediate notmyG() or in some of the functions called "in between",
> I would have thought that using
>
> VariableInMyF <<- something
>
> within myH() bears the danger that I am overwriting
> a variable of name VariableInMyF in notmyG() and "in-between's"
> instead of in myF().
>
> Or did I get something wrong?

I think you did. You seem to be thinking in terms of dynamic scope,
which looks for variables in the caller and then the caller's caller.

Lexical scope addresses exactly this problem.  In lexical scope
variable references are resolved on the basis of how function
definitions are nested in the written code (hence the term lexical).
If you define myH inside myF then free variables in myH are looked up
first in myF and then in the context where myF is defined. How myH is
called does not matter.  Nested functions in Pascal work the same way
if that helps.

[In terms of the internal implementation, the enclosing environment of
the environment of myH is the frame of the call to myF that created
myH.]

Best,

luke


THis is exactly the pro
>
> Thanks for your help
> Peter
>
>
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From jelkink at gmail.com  Wed Apr  4 20:46:31 2007
From: jelkink at gmail.com (Jos Elkink)
Date: Wed, 4 Apr 2007 14:46:31 -0400
Subject: [Rd] Accessing C++ code from R
In-Reply-To: <5C9CB370-AC77-4A0C-A081-433AEC58E1C3@r-project.org>
References: <cc06ac9d0704041044l273113ecn5c6d6153ba3cfbeb@mail.gmail.com>
	<5C9CB370-AC77-4A0C-A081-433AEC58E1C3@r-project.org>
Message-ID: <cc06ac9d0704041146j30808556ta5a50a3a40a5ad89@mail.gmail.com>

Hi Simon,

Thank you - that indeed fixes the first problem (about cout). It still
leaves the second error, though:

main.cpp:52: error: brace-enclosed initializer used to initialize
'R_NativePrimitiveArgType*'

Any ideas about that?

Thanks again for the first suggestion, anyway, and I'll keep your
point about cout in mind.

Jos

On 4/4/07, Simon Urbanek <simon.urbanek at r-project.org> wrote:
> Jos,
>
> you omitted the crucial part but my guess would be that all you have
> to do is to put #include <iostream> *before* R headers includes (R
> defines "length" which throws off iostream).
> Also note that using cout is not a good idea, because it is not
> captured by R, you should be using Rprintf instead.
>
> Cheers,
> Simon
>
> On Apr 4, 2007, at 1:44 PM, Jos Elkink wrote:
>
> > Hi,
> >
> > I am trying to use existing C++ code from R. I have no problems
> > compiling C code and using it in R, but with C++ I'm running into
> > problems.
> >
> > Here's the compiler output:
> >
> > Macintosh-10:~/Desktop/dissertation/Model - CPP version/R labguest$
> > g++ -I/Library/Frameworks/R.framework/Resources/include
> > -I/Library/Frameworks/R.framework/Resources/include/i386 *.cpp
> > In file included from /usr/include/c++/4.0.0/bits/locale_facets.h:
> > 1533,
> >                  from /usr/include/c++/4.0.0/bits/basic_ios.h:44,
> >                  from /usr/include/c++/4.0.0/ios:50,
> >                  from /usr/include/c++/4.0.0/ostream:44,
> >                  from /usr/include/c++/4.0.0/iostream:44,
> >                  from main.cpp:5:
> > /usr/include/c++/4.0.0/bits/codecvt.h:217:45: error: macro "length"
> > passed 4 arguments, but takes just 1
> > /usr/include/c++/4.0.0/bits/codecvt.h:216: error: expected ';'
> > before 'const'
> > /usr/include/c++/4.0.0/bits/codecvt.h:220: error: expected `;'
> > before 'int'
> > main.cpp:51: error: brace-enclosed initializer used to initialize
> > 'R_NativePrimitiveArgType*'
> >
> >
> > Line 51 refers to the standard part to register the function in R:
> >
> > R_CMethodDef cMethods[] = {
> >   {"runSimulation", (void* (*) ()) &runSimulation, 27, {INTSXP,
> > INTSXP, INTSXP, REALSXP, REALSXP, REALSXP, INTSXP, INTSXP, INTSXP,
> > INTSXP, INTSXP, INTSXP, REALSXP, REALSXP, INTSXP, INTSXP, INTSXP,
> > INTSXP, INTSXP, INTSXP, INTSXP, INTSXP, INTSXP, INTSXP, REALSXP,
> > REALSXP, REALSXP}},
> >   {NULL, NULL, 0}
> > };
> >
> >
> > I had to add the explicit cast of &runSimulation to get rid of one
> > compiler error, but do not know how to deal with this one.
> > Encapsulating this part of the code in
> >
> > extern "C" {
> > }
> >
> > has no effect.
> >
> > runSimulation is just a regular function, with a lot of int* and
> > double* parameters, and it is not part of a class. It does inside
> > create a class, though.
> >
> > Outline:
> >
> > void runSimulation(int *p_1 ... etc) {
> >
> >    try {
> >      CModel Model();
> >      Model.Run();
> >    } catch (CException& e) {
> >      cout << "exception" << endl;
> >    }
> > }
> >
> > Encapsulating this function in extern "C" also has no effect.
> >
> > Anyone any ideas what I should do? The system I am using is an
> > Intel-based Mac.
> >
> > Thanks in advance!
> >
> > Jos
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >
>
>


-- 
Jos Elkink
PhD Candidate, Trinity College Dublin
HMDC Fellow, Harvard University
http://jaeweb.cantr.net


From Peter.Ruckdeschel at uni-bayreuth.de  Wed Apr  4 21:25:59 2007
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Wed, 04 Apr 2007 21:25:59 +0200
Subject: [Rd] Exchange of information between functions aside from
 argument/return-value interface
In-Reply-To: <Pine.LNX.4.64.0704041337480.17651@nokomis.stat.uiowa.edu>
References: <4613DF85.6030002@uni-bayreuth.de>
	<Pine.LNX.4.64.0704041245320.17651@nokomis.stat.uiowa.edu>
	<4613EE09.8000809@uni-bayreuth.de>
	<Pine.LNX.4.64.0704041337480.17651@nokomis.stat.uiowa.edu>
Message-ID: <4613FBC7.4020707@uni-bayreuth.de>

Thank you, Luke, once again.

>> [snipped away my original message; to be found on
>> https://stat.ethz.ch/pipermail/r-devel/2007-April/045219.html]

>> Or did I get something wrong?
> 
> I think you did. You seem to be thinking in terms of dynamic scope,
> which looks for variables in the caller and then the caller's caller.
> 
> Lexical scope addresses exactly this problem.  In lexical scope
> variable references are resolved on the basis of how function
> definitions are nested in the written code (hence the term lexical).
> If you define myH inside myF then free variables in myH are looked up
> first in myF and then in the context where myF is defined. How myH is
> called does not matter.  Nested functions in Pascal work the same way
> if that helps.

OK got it. I should have known this. I am pretty much embarrassed to
have bothered you.

Thanks again for your help
Peter


From simon.urbanek at r-project.org  Wed Apr  4 21:27:28 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 4 Apr 2007 15:27:28 -0400
Subject: [Rd] Accessing C++ code from R
In-Reply-To: <cc06ac9d0704041146j30808556ta5a50a3a40a5ad89@mail.gmail.com>
References: <cc06ac9d0704041044l273113ecn5c6d6153ba3cfbeb@mail.gmail.com>
	<5C9CB370-AC77-4A0C-A081-433AEC58E1C3@r-project.org>
	<cc06ac9d0704041146j30808556ta5a50a3a40a5ad89@mail.gmail.com>
Message-ID: <2A4D2794-049A-4036-9895-D79942659A88@r-project.org>


On Apr 4, 2007, at 2:46 PM, Jos Elkink wrote:

> Thank you - that indeed fixes the first problem (about cout). It  
> still leaves the second error, though:
>
> main.cpp:52: error: brace-enclosed initializer used to initialize  
> 'R_NativePrimitiveArgType*'
>
> Any ideas about that?
>

Sure, do what the compiler tells you to - use a reference instead:

static R_NativePrimitiveArgType runSimulation_t[] =
   {INTSXP, INTSXP, INTSXP, REALSXP, REALSXP, REALSXP, INTSXP,  
INTSXP, INTSXP,
    INTSXP, INTSXP, INTSXP, REALSXP, REALSXP, INTSXP, INTSXP, INTSXP,
    INTSXP, INTSXP, INTSXP, INTSXP, INTSXP, INTSXP, INTSXP, REALSXP,
    REALSXP, REALSXP};

R_CMethodDef cMethods[] = {
   {"runSimulation", (DL_FUNC) &runSimulation, 27, runSimulation_t},
   {NULL, NULL, 0}
};

BTW have a look at registration.c in R sources for an elegant way to  
make this less error-prone when registering multiple functions (and  
looking at your argument list ... you should seriously consider  
using .Call :P)

Cheers,
Simon



>
> On 4/4/07, Simon Urbanek <simon.urbanek at r-project.org> wrote:
>> Jos,
>>
>> you omitted the crucial part but my guess would be that all you have
>> to do is to put #include <iostream> *before* R headers includes (R
>> defines "length" which throws off iostream).
>> Also note that using cout is not a good idea, because it is not
>> captured by R, you should be using Rprintf instead.
>>
>> Cheers,
>> Simon
>>
>> On Apr 4, 2007, at 1:44 PM, Jos Elkink wrote:
>>
>>> Hi,
>>>
>>> I am trying to use existing C++ code from R. I have no problems
>>> compiling C code and using it in R, but with C++ I'm running into
>>> problems.
>>>
>>> Here's the compiler output:
>>>
>>> Macintosh-10:~/Desktop/dissertation/Model - CPP version/R labguest$
>>> g++ -I/Library/Frameworks/R.framework/Resources/include
>>> -I/Library/Frameworks/R.framework/Resources/include/i386 *.cpp
>>> In file included from /usr/include/c++/4.0.0/bits/locale_facets.h:
>>> 1533,
>>>                  from /usr/include/c++/4.0.0/bits/basic_ios.h:44,
>>>                  from /usr/include/c++/4.0.0/ios:50,
>>>                  from /usr/include/c++/4.0.0/ostream:44,
>>>                  from /usr/include/c++/4.0.0/iostream:44,
>>>                  from main.cpp:5:
>>> /usr/include/c++/4.0.0/bits/codecvt.h:217:45: error: macro "length"
>>> passed 4 arguments, but takes just 1
>>> /usr/include/c++/4.0.0/bits/codecvt.h:216: error: expected ';'
>>> before 'const'
>>> /usr/include/c++/4.0.0/bits/codecvt.h:220: error: expected `;'
>>> before 'int'
>>> main.cpp:51: error: brace-enclosed initializer used to initialize
>>> 'R_NativePrimitiveArgType*'
>>>
>>>
>>> Line 51 refers to the standard part to register the function in R:
>>>
>>> R_CMethodDef cMethods[] = {
>>>   {"runSimulation", (void* (*) ()) &runSimulation, 27, {INTSXP,
>>> INTSXP, INTSXP, REALSXP, REALSXP, REALSXP, INTSXP, INTSXP, INTSXP,
>>> INTSXP, INTSXP, INTSXP, REALSXP, REALSXP, INTSXP, INTSXP, INTSXP,
>>> INTSXP, INTSXP, INTSXP, INTSXP, INTSXP, INTSXP, INTSXP, REALSXP,
>>> REALSXP, REALSXP}},
>>>   {NULL, NULL, 0}
>>> };
>>>
>>>
>>> I had to add the explicit cast of &runSimulation to get rid of one
>>> compiler error, but do not know how to deal with this one.
>>> Encapsulating this part of the code in
>>>
>>> extern "C" {
>>> }
>>>
>>> has no effect.
>>>
>>> runSimulation is just a regular function, with a lot of int* and
>>> double* parameters, and it is not part of a class. It does inside
>>> create a class, though.
>>>
>>> Outline:
>>>
>>> void runSimulation(int *p_1 ... etc) {
>>>
>>>    try {
>>>      CModel Model();
>>>      Model.Run();
>>>    } catch (CException& e) {
>>>      cout << "exception" << endl;
>>>    }
>>> }
>>>
>>> Encapsulating this function in extern "C" also has no effect.
>>>
>>> Anyone any ideas what I should do? The system I am using is an
>>> Intel-based Mac.
>>>
>>> Thanks in advance!
>>>
>>> Jos
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
>>
>
>
> -- 
> Jos Elkink
> PhD Candidate, Trinity College Dublin
> HMDC Fellow, Harvard University
> http://jaeweb.cantr.net
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From hpages at fhcrc.org  Thu Apr  5 02:05:29 2007
From: hpages at fhcrc.org (Herve Pages)
Date: Wed, 04 Apr 2007 17:05:29 -0700
Subject: [Rd] 'R CMD check' fails when suggested package is not available
Message-ID: <46143D49.2000001@fhcrc.org>

Hi there,

I was wondering why I get the following error message:

  * checking package dependencies ... ERROR
  Packages required but not available:
    Rmpi

when I run 'R CMD check' on a package that _suggests_ Rmpi?
Why isn't it OK to not have all the suggested packages installed?

Maybe one of the 3 following behaviours would be more appropriate:

  a) Having the error saying something like:

    Package suggested but not available:
      Rmpi

  b) Make this a warning instead of an error.

  c) Don't do anything at all for suggested packages.

This issue showed up today while I was checking a new Bioconductor package:
the package suggests Rmpi but the vignette and the examples don't use it. If I remove
Rmpi from the Suggests field then 'R CMD check' runs all the examples and re-create
the vignette with no problem. Most users will not have Rmpi on their machine neither
will they be interested in getting into the trouble of installing it.
The package I was checking suggests Rmpi only because it contains 1 function that tries
to use it if it's installed but will work perfectly fine otherwise.
In this case it seems reasonable to have Rmpi in the Suggests field but this will
make 'R CMD check' to fail which is problematic in the context of automated builds :-/
If 'R CMD check' can't be a little bit more relaxed about this, then I guess we will
need to remove Rmpi from the Suggests field, but then 'R CMD check' will complain that:

  * checking for unstated dependencies in R code ... WARNING
  'library' or 'require' calls not declared from:
    Rmpi

which is always better than getting an ERROR.

Thanks!

H.


From ripley at stats.ox.ac.uk  Thu Apr  5 05:29:17 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 5 Apr 2007 04:29:17 +0100 (BST)
Subject: [Rd] 'R CMD check' fails when suggested package is not available
In-Reply-To: <46143D49.2000001@fhcrc.org>
References: <46143D49.2000001@fhcrc.org>
Message-ID: <Pine.LNX.4.64.0704050419580.7641@gannet.stats.ox.ac.uk>

This is a configurable option 'R_check_force_suggests' documented in 
'Writing R Extensions'.

This package should be using Enhances: Rmpi, it seems.

On Wed, 4 Apr 2007, Herve Pages wrote:

> Hi there,
>
> I was wondering why I get the following error message:
>
>  * checking package dependencies ... ERROR
>  Packages required but not available:
>    Rmpi
>
> when I run 'R CMD check' on a package that _suggests_ Rmpi?
> Why isn't it OK to not have all the suggested packages installed?
>
> Maybe one of the 3 following behaviours would be more appropriate:
>
>  a) Having the error saying something like:
>
>    Package suggested but not available:
>      Rmpi
>
>  b) Make this a warning instead of an error.
>
>  c) Don't do anything at all for suggested packages.
>
> This issue showed up today while I was checking a new Bioconductor package:
> the package suggests Rmpi but the vignette and the examples don't use it. If I remove
> Rmpi from the Suggests field then 'R CMD check' runs all the examples and re-create
> the vignette with no problem. Most users will not have Rmpi on their machine neither
> will they be interested in getting into the trouble of installing it.

'Most users' will not be running 'R CMD check', of course.

> The package I was checking suggests Rmpi only because it contains 1 function that tries
> to use it if it's installed but will work perfectly fine otherwise.
> In this case it seems reasonable to have Rmpi in the Suggests field but this will
> make 'R CMD check' to fail which is problematic in the context of automated builds :-/
> If 'R CMD check' can't be a little bit more relaxed about this, then I guess we will
> need to remove Rmpi from the Suggests field, but then 'R CMD check' will complain that:
>
>  * checking for unstated dependencies in R code ... WARNING
>  'library' or 'require' calls not declared from:
>    Rmpi
>
> which is always better than getting an ERROR.
>
> Thanks!
>
> H.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From rpeng at jhsph.edu  Thu Apr  5 00:21:27 2007
From: rpeng at jhsph.edu (Roger D. Peng)
Date: Wed, 04 Apr 2007 18:21:27 -0400
Subject: [Rd] tilde expansion with install.packages
Message-ID: <461424E7.6060105@jhsph.edu>

I've noticed recently that 'update.packages' and 'install.packages' seem to not 
do tilde expansion anymore, i.e. when I run

update.packages("~/R-local/lib")

on R-alpha (r41043) I get the message

/home/rpeng/install/R-alpha/lib64/R/bin/INSTALL: line 304: cd: ~/R-local/lib: No 
such file or directory

and the package is subsequently installed in the current working directory.

The attached patch solves the problem for me.

-roger
-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: INSTALL.patch
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070404/b4ea418d/attachment.pl 

From jarioksa at sun3.oulu.fi  Thu Apr  5 10:08:13 2007
From: jarioksa at sun3.oulu.fi (Jari Oksanen)
Date: Thu, 05 Apr 2007 11:08:13 +0300
Subject: [Rd] 'R CMD check' fails when suggested package is not	available
In-Reply-To: <46143D49.2000001@fhcrc.org>
References: <46143D49.2000001@fhcrc.org>
Message-ID: <1175760493.21156.13.camel@biol102145.oulu.fi>

On Wed, 2007-04-04 at 17:05 -0700, Herve Pages wrote:
> Hi there,
> 
> I was wondering why I get the following error message:
> 
>   * checking package dependencies ... ERROR
>   Packages required but not available:
>     Rmpi
> 
> when I run 'R CMD check' on a package that _suggests_ Rmpi?
> Why isn't it OK to not have all the suggested packages installed?
> 
Hi there too,

This has been discussed before:
http://tolstoy.newcastle.edu.au/R/devel/05/09/2326.html

Then the Core decided to maintain the Mafia style suggestion ("that you
can't refuse"), but later seems to have introduced a new field
"enhances" which to me looks like a suggestion in the meaning of the
word I know: a suggestion that you can refuse.

I think that the R-ext description is somewhat confusing and misleading
for fields "Requires", "Suggests", "Enhances". The R extension manual
"suggests" different situations where the author of the manual thinks
that other people would like to use these fields. However, the manual
does not clearly say what are the practical and real consequences of
selecting a certain entry. It seems that "Requires" means that a package
is always required, "Suggests" means that the package is required in
check (with a threat of error), but only suggested for normal use, and
"Enhances" means that the package only is suggested. It does not matter
whether the package really "enhances" anything, but this is the meaning
of the word in behaviouristic sense. 

cheers, jari oksanen

> Maybe one of the 3 following behaviours would be more appropriate:
> 
>   a) Having the error saying something like:
> 
>     Package suggested but not available:
>       Rmpi
> 
>   b) Make this a warning instead of an error.
> 
>   c) Don't do anything at all for suggested packages.
> 
> This issue showed up today while I was checking a new Bioconductor package:
> the package suggests Rmpi but the vignette and the examples don't use it. If I remove
> Rmpi from the Suggests field then 'R CMD check' runs all the examples and re-create
> the vignette with no problem. Most users will not have Rmpi on their machine neither
> will they be interested in getting into the trouble of installing it.
> The package I was checking suggests Rmpi only because it contains 1 function that tries
> to use it if it's installed but will work perfectly fine otherwise.
> In this case it seems reasonable to have Rmpi in the Suggests field but this will
> make 'R CMD check' to fail which is problematic in the context of automated builds :-/
> If 'R CMD check' can't be a little bit more relaxed about this, then I guess we will
> need to remove Rmpi from the Suggests field, but then 'R CMD check' will complain that:
> 
>   * checking for unstated dependencies in R code ... WARNING
>   'library' or 'require' calls not declared from:
>     Rmpi

-- 
"Object-oriented programming is an exceptionally bad idea that could
only have been invented in California." -- Edsger Dijkstra


From ripley at stats.ox.ac.uk  Thu Apr  5 10:49:39 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 5 Apr 2007 09:49:39 +0100 (BST)
Subject: [Rd] tilde expansion with install.packages
In-Reply-To: <461424E7.6060105@jhsph.edu>
References: <461424E7.6060105@jhsph.edu>
Message-ID: <Pine.LNX.4.64.0704050948010.16695@gannet.stats.ox.ac.uk>

Looks right, and now committed, thanks.

On Wed, 4 Apr 2007, Roger D. Peng wrote:

> I've noticed recently that 'update.packages' and 'install.packages' seem to 
> not do tilde expansion anymore, i.e. when I run
>
> update.packages("~/R-local/lib")
>
> on R-alpha (r41043) I get the message
>
> /home/rpeng/install/R-alpha/lib64/R/bin/INSTALL: line 304: cd: 
> ~/R-local/lib: No such file or directory
>
> and the package is subsequently installed in the current working directory.
>
> The attached patch solves the problem for me.
>
> -roger
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From J.Oosting at lumc.nl  Thu Apr  5 12:53:33 2007
From: J.Oosting at lumc.nl (J.Oosting at lumc.nl)
Date: Thu, 5 Apr 2007 12:53:33 +0200
Subject: [Rd] issue with pdf(paper="a4") in 2.5.0 alpha
Message-ID: <40964D91251A18469CB08B6E96FB30BA01BA411E@mailc.lumcnet.prod.intern>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070405/61ddba65/attachment.pl 

From Roy.Mendelssohn at noaa.gov  Thu Apr  5 16:24:45 2007
From: Roy.Mendelssohn at noaa.gov (Roy Mendelssohn)
Date: Thu, 05 Apr 2007 07:24:45 -0700
Subject: [Rd] StructTS
Message-ID: <DBB4BBF4-5AB5-488C-8108-EB3905317A5C@noaa.gov>

I apologize in advance if I picked the wrong list to post this to.  I  
have made an effort to find the answers to these questions on CRAN,  
but if they are there, I couldn't find them, and I was going to email  
the developer of StructTS directly but could not find who that is.

I have 2 interrelated questions about StructTS

1.  Where can I obtain the source code for StructTS if I wanted to  
produce a similar function with an extended capability?

2.  Would the person who developed StructTS have any interest in  
adding the ability to include an AR term and/or a stochastic cycle?

Thanks in advance,

-Roy M.



**********************
"The contents of this message do not reflect any position of the U.S.  
Government or NOAA."
**********************
Roy Mendelssohn
Supervisory Operations Research Analyst
NOAA/NMFS
Environmental Research Division	
Southwest Fisheries Science Center
1352 Lighthouse Avenue
Pacific Grove, CA 93950-2097

e-mail: Roy.Mendelssohn at noaa.gov (Note new e-mail address)
voice: (831)-648-9029
fax: (831)-648-8440
www: http://www.pfeg.noaa.gov/

"Old age and treachery will overcome youth and skill."


From sgiannerini at gmail.com  Thu Apr  5 16:45:12 2007
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Thu, 5 Apr 2007 16:45:12 +0200
Subject: [Rd] is.loaded() and dyn.load()
Message-ID: <3c12769c0704050745o6145fef3r3633ac81e3a9e310@mail.gmail.com>

Dear all,

I am puzzled at the behaviour of is.loaded() when a dyn.load() call to a a
FORTRAN shared library is included in a file to be sourced.
A reproducible example is the following:

1. the attached fortran subroutine try_it.f90 performs a summation of the
elements of a REAL*8 vector
compile with

gfortran try_it.f90 -shared -s -otry_it.dll

2. create a file to be sourced (see the attached try_it.R) containing the
following commands:

BEGIN try_it.R ************************************
dyn.load("try_it.dll");


try.it <- function(X){
    N <- length(X);
    S <- .Fortran("try_it_",as.double(X),as.integer(N),S=as.double(0))$S
    return(S)
}
END try_it.R ************************************


3. Switch to R

> source("try_it.R")
> try.it(1:10)
Error in .Fortran("try_it_", as.double(X), as.integer(N), S = as.double(0))
:
        Fortran symbol name "try_it_" not in load table
> is.loaded("try_it_")
[1] TRUE
> try.it(1:10)
[1] 55
>
it looks like is.loaded() triggers the loading, inserting
is.loaded("try_it_")in
the file try_it.R does the trick but
is this behaviour expected?

Thank you,

Regards

Simone

> R.version
               _
platform       i386-pc-mingw32
arch           i386
os             mingw32
system         i386, mingw32
status
major          2
minor          4.1
year           2006
month          12
day            18
svn rev        40228
language       R
version.string R version 2.4.1 (2006-12-18)
-- 
______________________________________________________

Simone Giannerini
Dipartimento di Scienze Statistiche "Paolo Fortunati"
Universita' di Bologna
Via delle belle arti 41 - 40126  Bologna,  ITALY
Tel: +39 051 2098262  Fax: +39 051 232153
______________________________________________________

From ripley at stats.ox.ac.uk  Thu Apr  5 17:23:38 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 5 Apr 2007 16:23:38 +0100 (BST)
Subject: [Rd] is.loaded() and dyn.load()
In-Reply-To: <3c12769c0704050745o6145fef3r3633ac81e3a9e310@mail.gmail.com>
References: <3c12769c0704050745o6145fef3r3633ac81e3a9e310@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0704051615580.21221@gannet.stats.ox.ac.uk>

Did you read the comments under ?.Fortran about this?  What you are doing 
is quite explicitly said not to be supported.

gfortran is not a supported Fortran compiler for R for Windows 2.4.1.
It behaves differently from the supported g77.
The behaviour is adapted to the compiler used when configure is used, and 
on Windows that is what the maintainers used, not you are using.  If you 
follow the advice not to use underscores in names you are much less likely 
to confuse yourself and produce portable code.

On Thu, 5 Apr 2007, Simone Giannerini wrote:

> Dear all,
>
> I am puzzled at the behaviour of is.loaded() when a dyn.load() call to a a
> FORTRAN shared library is included in a file to be sourced.
> A reproducible example is the following:
>
> 1. the attached fortran subroutine try_it.f90 performs a summation of the
> elements of a REAL*8 vector
> compile with
>
> gfortran try_it.f90 -shared -s -otry_it.dll
>
> 2. create a file to be sourced (see the attached try_it.R) containing the
> following commands:
>
> BEGIN try_it.R ************************************
> dyn.load("try_it.dll");
>
>
> try.it <- function(X){
>   N <- length(X);
>   S <- .Fortran("try_it_",as.double(X),as.integer(N),S=as.double(0))$S
>   return(S)
> }
> END try_it.R ************************************
>
>
> 3. Switch to R
>
>> source("try_it.R")
>> try.it(1:10)
> Error in .Fortran("try_it_", as.double(X), as.integer(N), S = as.double(0))
> :
>       Fortran symbol name "try_it_" not in load table
>> is.loaded("try_it_")
> [1] TRUE
>> try.it(1:10)
> [1] 55
>> 
> it looks like is.loaded() triggers the loading, inserting
> is.loaded("try_it_")in
> the file try_it.R does the trick but
> is this behaviour expected?
>
> Thank you,
>
> Regards
>
> Simone
>
>> R.version
>              _
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status
> major          2
> minor          4.1
> year           2006
> month          12
> day            18
> svn rev        40228
> language       R
> version.string R version 2.4.1 (2006-12-18)
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From h.wickham at gmail.com  Thu Apr  5 17:43:41 2007
From: h.wickham at gmail.com (hadley wickham)
Date: Thu, 5 Apr 2007 10:43:41 -0500
Subject: [Rd] Implementation of pretty
Message-ID: <f8e6ff050704050843p696d0967gad054c663d692afc@mail.gmail.com>

Hi,

I'm trying to track down any references for the implementation of
pretty (or grid.pretty) in R.  Is it original work?

Thanks,

Hadley


From maechler at stat.math.ethz.ch  Thu Apr  5 18:52:15 2007
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 5 Apr 2007 18:52:15 +0200
Subject: [Rd] Implementation of pretty
In-Reply-To: <f8e6ff050704050843p696d0967gad054c663d692afc@mail.gmail.com>
References: <f8e6ff050704050843p696d0967gad054c663d692afc@mail.gmail.com>
Message-ID: <17941.10559.64618.842368@stat.math.ethz.ch>

>>>>> "hadley" == hadley wickham <h.wickham at gmail.com>
>>>>>     on Thu, 5 Apr 2007 10:43:41 -0500 writes:

    hadley> Hi, I'm trying to track down any references for the
    hadley> implementation of pretty (or grid.pretty) in R.  Is
    hadley> it original work?

Much of it is.  The original version, say R version 0.01, may
have been based on some reference, but we have added quite a few extra tweaks,
where in my case I sat down with a piece of paper, considered
and transformed some inequalities and also did computer
experiments additionally. 
I've even started to make more coherent notes eventually, but
not electronically, and hence no tech.report /  publication / ...

 { Did you really want to know this :-) }

Regards,
Martin


From cstrato at aon.at  Thu Apr  5 19:00:37 2007
From: cstrato at aon.at (cstrato)
Date: Thu, 05 Apr 2007 19:00:37 +0200
Subject: [Rd] Problem with S4 inheritance: unexpected re-initialization?
In-Reply-To: <4613F186.1060507@fhcrc.org>
References: <46112187.3090009@aon.at> <4612CCAB.1080809@fhcrc.org>
	<4613BE1D.5000507@aon.at> <4613F186.1060507@fhcrc.org>
Message-ID: <46152B35.2070200@aon.at>

Dear Herve

Thank you once again for taking your time, I appreciate it very much.
I followed your advice and kept only the minimum code, which I believe
is necessary. I have even removed SubClassA, so the inheritance tree is:

   BaseClass <- SubClassB <- SubSubClassB1
             <- SubClassB <- SubSubClassB2

The source code is shown below and the examples are:
 > subsubB1 <- new("SubSubClassB1", filename="MyFileNameB1", 
nameB="MyNameB")
 > subsubB2 <- new("SubSubClassB2", filename="MyFileNameB2", 
nameB="MyNameB")

Although SubSubClassB1 and SubSubClassB2 differ only slightly, the results
for "subsubB1" are correct, while "subsubB2" gives a wrong result, see:
 > subsubB2 <- new("SubSubClassB2", filename="MyFileNameB2", 
nameB="MyNameB")
 > subsubB2
An object of class "SubSubClassB2"
Slot "nameB2":
[1] "MyNameB"

Slot "nameB":
[1] ""

Slot "filename":
[1] "MyFileNameB2"

Only, when adding "nameB2="MyNameB2", I get the correct result, see:
 > subsubB2 <- new("SubSubClassB2", filename="MyFileNameB2", 
nameB="MyNameB",nameB2="MyNameB2")
 > subsubB2
An object of class "SubSubClassB2"
Slot "nameB2":
[1] "MyNameB2"

Slot "nameB":
[1] "MyNameB"

Slot "filename":
[1] "MyFileNameB2"

It is not clear to me why omitting "nameB2" results in the wrong assignemt
of the value for "nameB" to "nameB2"?

When running both examples, the sequence of initialization and validation
method is also completely different.
For "SubSubClassB1" I get the correct and expected sequence of events:
 > subsubB1 <- new("SubSubClassB1", filename="MyFileNameB1", 
nameB="MyNameB")
------initialize:SubSubClassB1
------initialize:SubClassB
------initialize:BaseClass
------setValidity:BaseClass
------setValidity:SubClassB
------setValidity:SubSubClassB1

In contrast, for "SubSubClassB2" I get the following sequence of events:
 > subsubB2 <- new("SubSubClassB2", filename="MyFileNameB2", 
nameB="MyNameB")
------initialize:SubSubClassB2
------initialize:SubClassB
------initialize:BaseClass
------setValidity:BaseClass
------initialize:SubClassB
------initialize:BaseClass
------setValidity:BaseClass
------setValidity:SubClassB
------setValidity:SubClassB
------initialize:SubClassB
------initialize:BaseClass
------setValidity:BaseClass
------setValidity:SubClassB
------setValidity:SubSubClassB2

Furthermore, the slot "filename" is first initialized correctly to
"filename=MyFileNameB2", but then it is twice initialized incorrectly
to "filename=ERROR_FileName", indicating that it may not have been
initialized at all. I do not understand this behavior, why is this so?

I really hope that this time the code below is acceptable to you.
Thank you for your help.
Best regards
Christian

# - - - - - - - - - - - - - - - - BEGIN - - - - - - - - - - - - - - - - 
- - - -
setClass("BaseClass",
   representation(filename = "character", "VIRTUAL"),
   prototype(filename = "DefaultFileName")
)

setClass("SubClassB",
   representation(nameB = "character"),
   contains=c("BaseClass"),
   prototype(nameB = "NameB")
)

setClass("SubSubClassB1",
   contains=c("SubClassB")
)

setClass("SubSubClassB2",
   representation(nameB2 = "character"),
   contains=c("SubClassB"),
   prototype(nameB2 = "NameB2")
)

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
setMethod("initialize", "BaseClass",
   function(.Object, filename="",  ...) {
      cat("------initialize:BaseClass------\n")
      cat("BaseClass:init:class(.Object) = ", class(.Object), "\n", sep="")
      if (filename == "" || nchar(filename) == 0) filename <- 
"ERROR_FileName"
      cat("BaseClass:init:filename = ", filename, "\n", sep="")
      .Object <- callNextMethod(.Object, filename=filename, ...)
      .Object at filename <- filename
      .Object
   }
)

setValidity("BaseClass",
   function(object) {
      cat("------setValidity:BaseClass------\n")
      cat("BaseClass:val:class(.Object) = ", class(object), "\n", sep="")
      msg <- NULL
      if (!(is.character(object at filename)))
         msg <- cat("missing filename\n")
      cat("BaseClass:val:filename = ",object at filename, "\n", sep="")
      if (is.null(msg)) TRUE else msg
   }
)

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
setMethod("initialize", "SubClassB",
   function(.Object, nameB="",  ...) {
      cat("------initialize:SubClassB------\n")
      cat("SubClassB:init:class(.Object) = ", class(.Object), "\n", sep="")
      .Object <- callNextMethod(.Object, nameB=nameB, ...)
      .Object at nameB = nameB
      .Object
   }
)

setValidity("SubClassB",
   function(object) {
      cat("------setValidity:SubClassB------\n")
      cat("SubClassB:val:class(object) = ", class(object), "\n", sep="")
      msg <- NULL
      if (!(is.character(object at nameB) && length(object at nameB) > 0))
         msg <- cat("missing nameB\n")
      cat("SubClassB:val:nameB = ",object at nameB, "\n", sep="")
      if (is.null(msg)) TRUE else msg
   }
)

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
setMethod("initialize", "SubSubClassB1",
   function(.Object, ...) {
      cat("------initialize:SubSubClassB1------\n")
      cat("SubSubClassB1:init:class(.Object) = ", class(.Object), "\n", 
sep="")
      .Object <- callNextMethod(.Object, ...)
      .Object
   }
)

setValidity("SubSubClassB1",
   function(object) {
      cat("------setValidity:SubSubClassB1------\n")
      cat("SubSubClassB1:val:class(object) = ", class(object), "\n", sep="")
      return(TRUE)
   }
)

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
setMethod("initialize", "SubSubClassB2",
   function(.Object, nameB2="MyNameB2", ...) {
      cat("------initialize:SubSubClassB2------\n")
      cat("SubSubClassB2:init:class(.Object) = ", class(.Object), "\n", 
sep="")
      if (nameB2 == "") nameB2 <- "DefaultNameB2";
      cat("SubSubClassB2:init:nameB2 = ", nameB2, "\n", sep="")
      .Object <- callNextMethod(.Object, nameB2=nameB2, ...)
      .Object at nameB2 <- nameB2
      .Object
   }
)

setValidity("SubSubClassB2",
   function(object) {
      cat("------setValidity:SubSubClassB2------\n")
      cat("SubSubClassB2:val:class(object) = ", class(object), "\n", sep="")
      msg <- NULL;
      if (!(is.character(object at nameB2) && length(object at nameB2) > 0))
         msg <- cat("missing nameB2\n")
      cat("SubClassB:val:nameB2 = ",object at nameB2, "\n", sep="")
      if (is.null(msg)) TRUE else msg
   }
)

# - - - - - - - - - - - - - - - END - - - - - - - - - - - - - - - - -


Herve Pages wrote:
> Hi Christian,
>
> cstrato wrote:
>   
>> Dear Herve
>>
>> Thank you for your helpful comments, and I especially appreciate that
>> you tried to run my package. I will try to answer each point separately.
>>
>> Herve Pages wrote:
>>     
>>> Hi Christian,
>>>
>>> I can only give you a few reasons why IMO it is very unlikely that
>>> anybody
>>> will be able to help you on this, with the current form of your post.
>>>
>>> 1) Unless you have a really good reason to do so, don't attach a package
>>>    to your post. Do your best to provide a few lines of code that anybody
>>>    can easily copy and paste into their session.
>>>   
>>>       
>> Sorrowly, sometimes, a few lines of code are not sufficient to show
>> the problem. Furthermore, most of the time there are complaints that
>> people do not provide enough information, an issue I wanted to avoid.
>>     
>
> The code you provide below is still too long and overcluttered with stuff that is
> probably unrelated with the issue you want to discuss. Your class definitions
> still have slots that we don't care about. Basically if you want to
> discuss an S4 issue, you should get rid of all this file system related stuff
> (the 'dirfile', 'filedir', 'filename' slots, the 'pathFile' function, the dozens
> of calls to 'basename', 'dirname', 'getwd', 'file.dir' etc...)
>
> Also your code is dirty and hard to read. Take this for example:
>
>   "initialize.BaseClass" <-
>   function(.Object, filename=character(), filedir=as.character(getwd()), ...) {
>     print("------initialize:BaseClass------")
>   print(paste("BaseClass:init:class(.Object) = ", class(.Object)))
>
>   #   .Object <- callNextMethod(.Object, ...);
>
>     dirfile <- pathFile(filename, filedir);
>   print(paste("BaseClass:init:dirfile = ", dirfile))
>
>     .Object <- callNextMethod(.Object, filename=filename, filedir=filedir, ...);
>
>     .Object at filename <- filename;
>     .Object at filedir  <- filedir;
>     .Object;
>   }#initialize.BaseClass
>
>   setMethod("initialize", "BaseClass", initialize.BaseClass);
>
> o It's not properly indented.
> o Why those empty lines in the middle of such a short function?
> o Why those semi-columns at the end of lines?
> o Why put the implementation of the initialize method into a separate function?
> o Why use this construct 'print(paste())' instead of just 'cat()'?
> o Why leave the first call to callNextMethod() commented?
> o What do you do with 'dirfile', except that you print it? Do you need this for
>   the purpose of the S4 discussion?
>
> What about adopting this style:
>
>     setMethod("initialize", "BaseClass",
>         function(.Object, filename=character(), filedir=as.character(getwd()), ...)
>         {
>             cat("------initialize:BaseClass------\n")
>             cat("BaseClass:init:class(.Object) = ", class(.Object))
>             .Object <- callNextMethod(.Object, filename=filename, filedir=filedir, ...)
>             .Object at filename <- filename
>             .Object at filedir  <- filedir
>             .Object
>         }
>     )
>
> That's for the style. Now let's talk about the semantic. Here is the definition of
> your BaseClass class:
>
>     setClass("BaseClass",
>         representation(
>             "VIRTUAL",
>             filename="character",
>             filedir="character"
>         ),
>         prototype(
>             filename = character(),
>             filedir  = as.character(getwd())
>         )
>     )
>
> (Note that this definition is what _I_ get after I cleaned it and indented it which
> is something that _you_ are expected to do.)
>
> o Initializing the 'filename' slot to character() is useless since this is the default.
> o Wrapping getwd() inside as.character() is useless since getwd() returns a character vector.
> o BUT MOST IMPORTANTLY THAN ANYTHING ELSE: given the fact that you've provided a prototype
>   for class BaseClass, your initialize method is useless since it does _nothing_ more
>   than what the default initialize method does! If you want to define your own "initialize"
>   method for the only purpose of printing messages, then you could do it in a much simpler
>   way:
>
>     setMethod("initialize", "BaseClass",
>         function(.Object, ...)
>         {
>             cat("------initialize:BaseClass------\n")
>             cat("BaseClass:init:class(.Object) = ", class(.Object), "\n", sep="")
>             callNextMethod()
>         }
>     )
>
> But as I said initially, the file system related stuff is useless to illustrate the
> S4 issue you want to show us so why didn't you just provide:
>
>     setClass("BaseClass",
>         representation("VIRTUAL", slot1="character"),
>         prototype(slot1="aaa")
>     )
>
>     setMethod("initialize", "BaseClass",
>         function(.Object, ...)
>         {
>             cat("------initialize:BaseClass------\n")
>             cat("BaseClass:init:class(.Object) = ", class(.Object), "\n", sep="")
>             callNextMethod()
>         }
>     )
>
> See? I ended up by replacing 25 lines of your hard-to-read/confusing code by 12
> lines of clean code containing only the STRICTLY NECESSARY stuff for an S4 discussion.
> That's what you should have done instead of sending us 150 lines of code.
>
> Sorrowly people will not try to read your code unless it's obvious that _you_ did your
> best to provide the cleanest/simplest possible code that illustrates the issue you want
> to discuss.
>
> Also maybe you could try to read a little bit more about S4 and initialization mechanisms.
>
> Cheers,
> H.
>
>


From S.Smith at manchester.ac.uk  Thu Apr  5 18:48:06 2007
From: S.Smith at manchester.ac.uk (Sam Smith)
Date: Thu, 5 Apr 2007 17:48:06 +0100 (BST)
Subject: [Rd] some SPSS 15 files wont open in R 2.4.0
Message-ID: <Pine.BSO.4.64.0704051747320.18758@recount.ccsr.ac.uk>


Trying to open some SPSS .sav files (saved with SPSS 15) gives the following:

 	read.spss('/data/big/unzipped_ukda/seh3767/3767SPSS_570D6A086C9A1B0636F13255F25A58C1/prgrp95.sav')
 	Error in 
read.spss("/data/big/unzipped_ukda/seh3767/3767SPSS_570D6A086C9A1B0636F13255F25A58C1/prgrp95.sav"): 
error reading system-file header
 	In addition: Warning message:
 	/data/big/unzipped_ukda/seh3767/3767SPSS_570D6A086C9A1B0636F13255F25A58C1/prgrp95.sav:
 	File-indicated character representation code (Unknown) is not ASCII

Some are fine in R, some are not.


The file opens in SPSS, and googling the error message gives
this mail about PSPP
         http://www.nabble.com/problem-loading-SPSS-15.0-save-files-t2726500.html
which includes a diff for the PSPP code which opens R files
and throws that exact error message back.

R documentation says that it uses some code based on PSPP,
I can't see it in the R distribution?. Does anyone with more
clue than I know whether the above is likely to fix it, and
where I should be looking for the code to change?


Alternatively, has anyone got any ideas on opening these files?





Thanks

Sam

-- 
s.smith at manchester.ac.uk ; www.ccsr.ac.uk


From ripley at stats.ox.ac.uk  Thu Apr  5 19:31:47 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 5 Apr 2007 18:31:47 +0100 (BST)
Subject: [Rd] some SPSS 15 files wont open in R 2.4.0
In-Reply-To: <Pine.BSO.4.64.0704051747320.18758@recount.ccsr.ac.uk>
References: <Pine.BSO.4.64.0704051747320.18758@recount.ccsr.ac.uk>
Message-ID: <Pine.LNX.4.64.0704051816490.24811@gannet.stats.ox.ac.uk>

On Thu, 5 Apr 2007, Sam Smith wrote:

>
> Trying to open some SPSS .sav files (saved with SPSS 15) gives the following:
>
> 	read.spss('/data/big/unzipped_ukda/seh3767/3767SPSS_570D6A086C9A1B0636F13255F25A58C1/prgrp95.sav')
> 	Error in
> read.spss("/data/big/unzipped_ukda/seh3767/3767SPSS_570D6A086C9A1B0636F13255F25A58C1/prgrp95.sav"):
> error reading system-file header
> 	In addition: Warning message:
> 	/data/big/unzipped_ukda/seh3767/3767SPSS_570D6A086C9A1B0636F13255F25A58C1/prgrp95.sav:
> 	File-indicated character representation code (Unknown) is not ASCII
>
> Some are fine in R, some are not.

This is not 'in R', it is in contributed (recommended) package 'foreign', 
so it is that's version that is relevant here. (We do ask for 
sessionInfo() in the R posting guide for good reason.)

> The file opens in SPSS, and googling the error message gives
> this mail about PSPP
>         http://www.nabble.com/problem-loading-SPSS-15.0-save-files-t2726500.html
> which includes a diff for the PSPP code which opens R files
> and throws that exact error message back.

'R files'?  Surely, 'SPSS 15 files'!

That just removes a test.  If Ben Pfaff thinks it is no longer needed, I 
suppose we could just remove it, but what happens if SPSS has Latin-1 or 
UTF-8 data?  I think we should give a warning if not an error.

> R documentation says that it uses some code based on PSPP,
> I can't see it in the R distribution?.

Look in the tarball for foreign (in src/library/Recommended).

> Does anyone with more
> clue than I know whether the above is likely to fix it, and
> where I should be looking for the code to change?
>
> Alternatively, has anyone got any ideas on opening these files?

Use SPSS and re-save in an open format?

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From h.wickham at gmail.com  Thu Apr  5 19:41:13 2007
From: h.wickham at gmail.com (hadley wickham)
Date: Thu, 5 Apr 2007 12:41:13 -0500
Subject: [Rd] Implementation of pretty
In-Reply-To: <17941.10559.64618.842368@stat.math.ethz.ch>
References: <f8e6ff050704050843p696d0967gad054c663d692afc@mail.gmail.com>
	<17941.10559.64618.842368@stat.math.ethz.ch>
Message-ID: <f8e6ff050704051041w35026ea0i433c2db452cd0592@mail.gmail.com>

On 4/5/07, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
> >>>>> "hadley" == hadley wickham <h.wickham at gmail.com>
> >>>>>     on Thu, 5 Apr 2007 10:43:41 -0500 writes:
>
>     hadley> Hi, I'm trying to track down any references for the
>     hadley> implementation of pretty (or grid.pretty) in R.  Is
>     hadley> it original work?
>
> Much of it is.  The original version, say R version 0.01, may
> have been based on some reference, but we have added quite a few extra tweaks,
> where in my case I sat down with a piece of paper, considered
> and transformed some inequalities and also did computer
> experiments additionally.
> I've even started to make more coherent notes eventually, but
> not electronically, and hence no tech.report /  publication / ...
>
>  { Did you really want to know this :-) }

Yes - that's great!  And if you ever do put you notes in electronic
format I'd love to see them.  There's very little written on the
subject of choosing good tick marks.

Hadley


From murdoch at stats.uwo.ca  Thu Apr  5 20:56:50 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 05 Apr 2007 14:56:50 -0400
Subject: [Rd] Implementation of pretty
In-Reply-To: <f8e6ff050704051041w35026ea0i433c2db452cd0592@mail.gmail.com>
References: <f8e6ff050704050843p696d0967gad054c663d692afc@mail.gmail.com>	<17941.10559.64618.842368@stat.math.ethz.ch>
	<f8e6ff050704051041w35026ea0i433c2db452cd0592@mail.gmail.com>
Message-ID: <46154672.3070806@stats.uwo.ca>

On 4/5/2007 1:41 PM, hadley wickham wrote:
> On 4/5/07, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
>> >>>>> "hadley" == hadley wickham <h.wickham at gmail.com>
>> >>>>>     on Thu, 5 Apr 2007 10:43:41 -0500 writes:
>>
>>     hadley> Hi, I'm trying to track down any references for the
>>     hadley> implementation of pretty (or grid.pretty) in R.  Is
>>     hadley> it original work?
>>
>> Much of it is.  The original version, say R version 0.01, may
>> have been based on some reference, but we have added quite a few extra tweaks,
>> where in my case I sat down with a piece of paper, considered
>> and transformed some inequalities and also did computer
>> experiments additionally.
>> I've even started to make more coherent notes eventually, but
>> not electronically, and hence no tech.report /  publication / ...
>>
>>  { Did you really want to know this :-) }
> 
> Yes - that's great!  And if you ever do put you notes in electronic
> format I'd love to see them.  There's very little written on the
> subject of choosing good tick marks.

I wrote a little bit on this in a Chance column:

Murdoch, D.J. (2000).  Drawing a scatterplot.  {\em Chance} {\bf 13.3}, 
53--55.

Duncan Murdoch


From hpages at fhcrc.org  Fri Apr  6 02:27:19 2007
From: hpages at fhcrc.org (Herve Pages)
Date: Thu, 05 Apr 2007 17:27:19 -0700
Subject: [Rd] Problem with S4 inheritance: unexpected re-initialization?
In-Reply-To: <46152B35.2070200@aon.at>
References: <46112187.3090009@aon.at> <4612CCAB.1080809@fhcrc.org>
	<4613BE1D.5000507@aon.at> <4613F186.1060507@fhcrc.org>
	<46152B35.2070200@aon.at>
Message-ID: <461593E7.2050208@fhcrc.org>

Hi Cristian,

cstrato wrote:
[...]
> Although SubSubClassB1 and SubSubClassB2 differ only slightly, the results
> for "subsubB1" are correct, while "subsubB2" gives a wrong result, see:
>> subsubB2 <- new("SubSubClassB2", filename="MyFileNameB2",
> nameB="MyNameB")
>> subsubB2
> An object of class "SubSubClassB2"
> Slot "nameB2":
> [1] "MyNameB"
> 
> Slot "nameB":
> [1] ""
> 
> Slot "filename":
> [1] "MyFileNameB2"

I think that the problem has to do with the way you use callNextMethod() in your
"initialize" method for SubSubClassB2:

  setMethod("initialize", "SubSubClassB2",
    function(.Object, nameB2="MyNameB2", ...) {
       cat("------initialize:SubSubClassB2------\n")
       cat("SubSubClassB2:init:class(.Object) = ", class(.Object), "\n", sep="")
       if (nameB2 == "") nameB2 <- "DefaultNameB2";
       cat("SubSubClassB2:init:nameB2 = ", nameB2, "\n", sep="")
       .Object <- callNextMethod(.Object, nameB2=nameB2, ...)
       .Object at nameB2 <- nameB2
       .Object
    }
  )

As a side note: I don't understand why you want to define a default value for
the 'nameB2' argument since you have defined a prototype for the SubSubClassB2
class (with a different default value for the 'nameB2' slot).

Try this instead:

  setMethod("initialize", "SubSubClassB2",
    function(.Object, ...) {
       cat("------initialize:SubSubClassB2------\n")
       cat("SubSubClassB2:init:class(.Object) = ", class(.Object), "\n", sep="")
       .Object <- callNextMethod()
       if (.Object at nameB2 == "") .Object at nameB2 <- "DefaultNameB2"
       .Object
    }
  )

It gives you what you want:

  > new("SubSubClassB2", filename="MyFileNameB2", nameB="MyNameB")
  ------initialize:SubSubClassB2------
  SubSubClassB2:init:class(.Object) = SubSubClassB2
  ------initialize:SubClassB------
  SubClassB:init:class(.Object) = SubSubClassB2
  ------initialize:BaseClass------
  BaseClass:init:class(.Object) = SubSubClassB2
  BaseClass:init:filename = MyFileNameB2
  An object of class "SubSubClassB2"
  Slot "nameB2":
  [1] "NameB2"

  Slot "nameB":
  [1] "MyNameB"

  Slot "filename":
  [1] "MyFileNameB2"


[...]
> 
> In contrast, for "SubSubClassB2" I get the following sequence of events:
>> subsubB2 <- new("SubSubClassB2", filename="MyFileNameB2",
> nameB="MyNameB")
> ------initialize:SubSubClassB2
> ------initialize:SubClassB
> ------initialize:BaseClass
> ------setValidity:BaseClass
> ------initialize:SubClassB
> ------initialize:BaseClass
> ------setValidity:BaseClass
> ------setValidity:SubClassB
> ------setValidity:SubClassB
> ------initialize:SubClassB
> ------initialize:BaseClass
> ------setValidity:BaseClass
> ------setValidity:SubClassB
> ------setValidity:SubSubClassB2

I can reproduce this behaviour with a _much_ simple and shorter code:

  setClass("A",
    representation(a="character"),
    prototype(a="a0")
  )
  setValidity("A",
    function(object) {
        cat("------setValidity:A------\n")
        tmp <- class(object)
        TRUE
    }
  )
  setMethod("initialize", "A",
    function(.Object, ...) {
        cat("------initialize:A------\n")
        callNextMethod()
    }
  )

  setClass("B",
    contains="A",
    representation(b="character")
  )
  setValidity("B",
    function(object) {
        cat("------setValidity:B------\n")
        TRUE
    }
  )
  setMethod("initialize", "B",
    function(.Object, ...) {
        cat("------initialize:B------\n")
        callNextMethod()
    }
  )

Then I get this:

  > b <- new("B", b="hello")
  ------initialize:B------
  ------initialize:A------
  ------setValidity:A------
  ------initialize:A------
  ------setValidity:B------

Why is initialize:A called twice? I have no idea (bug?) but I agree with you that
this is unexpected. Note that this line

  tmp <- class(object)

in setValidity:A is what triggers the extra call to initialize:A. If you remove
it, things work as expected. Very strange!

Cheers,
H.


> sessionInfo()
R version 2.5.0 alpha (2007-03-30 r40957)
x86_64-unknown-linux-gnu

locale:
LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=en_US;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
[7] "base"



> 
> Furthermore, the slot "filename" is first initialized correctly to
> "filename=MyFileNameB2", but then it is twice initialized incorrectly
> to "filename=ERROR_FileName", indicating that it may not have been
> initialized at all. I do not understand this behavior, why is this so?
> 
> I really hope that this time the code below is acceptable to you.
> Thank you for your help.
> Best regards
> Christian
> 
> # - - - - - - - - - - - - - - - - BEGIN - - - - - - - - - - - - - - - -
> - - - -
> setClass("BaseClass",
>   representation(filename = "character", "VIRTUAL"),
>   prototype(filename = "DefaultFileName")
> )
> 
> setClass("SubClassB",
>   representation(nameB = "character"),
>   contains=c("BaseClass"),
>   prototype(nameB = "NameB")
> )
> 
> setClass("SubSubClassB1",
>   contains=c("SubClassB")
> )
> 
> setClass("SubSubClassB2",
>   representation(nameB2 = "character"),
>   contains=c("SubClassB"),
>   prototype(nameB2 = "NameB2")
> )
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
> setMethod("initialize", "BaseClass",
>   function(.Object, filename="",  ...) {
>      cat("------initialize:BaseClass------\n")
>      cat("BaseClass:init:class(.Object) = ", class(.Object), "\n", sep="")
>      if (filename == "" || nchar(filename) == 0) filename <-
> "ERROR_FileName"
>      cat("BaseClass:init:filename = ", filename, "\n", sep="")
>      .Object <- callNextMethod(.Object, filename=filename, ...)
>      .Object at filename <- filename
>      .Object
>   }
> )
> 
> setValidity("BaseClass",
>   function(object) {
>      cat("------setValidity:BaseClass------\n")
>      cat("BaseClass:val:class(.Object) = ", class(object), "\n", sep="")
>      msg <- NULL
>      if (!(is.character(object at filename)))
>         msg <- cat("missing filename\n")
>      cat("BaseClass:val:filename = ",object at filename, "\n", sep="")
>      if (is.null(msg)) TRUE else msg
>   }
> )
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
> setMethod("initialize", "SubClassB",
>   function(.Object, nameB="",  ...) {
>      cat("------initialize:SubClassB------\n")
>      cat("SubClassB:init:class(.Object) = ", class(.Object), "\n", sep="")
>      .Object <- callNextMethod(.Object, nameB=nameB, ...)
>      .Object at nameB = nameB
>      .Object
>   }
> )
> 
> setValidity("SubClassB",
>   function(object) {
>      cat("------setValidity:SubClassB------\n")
>      cat("SubClassB:val:class(object) = ", class(object), "\n", sep="")
>      msg <- NULL
>      if (!(is.character(object at nameB) && length(object at nameB) > 0))
>         msg <- cat("missing nameB\n")
>      cat("SubClassB:val:nameB = ",object at nameB, "\n", sep="")
>      if (is.null(msg)) TRUE else msg
>   }
> )
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
> setMethod("initialize", "SubSubClassB1",
>   function(.Object, ...) {
>      cat("------initialize:SubSubClassB1------\n")
>      cat("SubSubClassB1:init:class(.Object) = ", class(.Object), "\n",
> sep="")
>      .Object <- callNextMethod(.Object, ...)
>      .Object
>   }
> )
> 
> setValidity("SubSubClassB1",
>   function(object) {
>      cat("------setValidity:SubSubClassB1------\n")
>      cat("SubSubClassB1:val:class(object) = ", class(object), "\n", sep="")
>      return(TRUE)
>   }
> )
> 
> # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
> setMethod("initialize", "SubSubClassB2",
>   function(.Object, nameB2="MyNameB2", ...) {
>      cat("------initialize:SubSubClassB2------\n")
>      cat("SubSubClassB2:init:class(.Object) = ", class(.Object), "\n",
> sep="")
>      if (nameB2 == "") nameB2 <- "DefaultNameB2";
>      cat("SubSubClassB2:init:nameB2 = ", nameB2, "\n", sep="")
>      .Object <- callNextMethod(.Object, nameB2=nameB2, ...)
>      .Object at nameB2 <- nameB2
>      .Object
>   }
> )
> 
> setValidity("SubSubClassB2",
>   function(object) {
>      cat("------setValidity:SubSubClassB2------\n")
>      cat("SubSubClassB2:val:class(object) = ", class(object), "\n", sep="")
>      msg <- NULL;
>      if (!(is.character(object at nameB2) && length(object at nameB2) > 0))
>         msg <- cat("missing nameB2\n")
>      cat("SubClassB:val:nameB2 = ",object at nameB2, "\n", sep="")
>      if (is.null(msg)) TRUE else msg
>   }
> )
> 
> # - - - - - - - - - - - - - - - END - - - - - - - - - - - - - - - - -


From felix at nfrac.org  Fri Apr  6 04:53:19 2007
From: felix at nfrac.org (felix at nfrac.org)
Date: Fri,  6 Apr 2007 04:53:19 +0200 (CEST)
Subject: [Rd] bquote(function(x,y) T) (PR#9602)
Message-ID: <20070406025319.A0ED55DE5D@slim.kubism.ku.dk>

> quote(function(x, y) T)
function(x, y) T

> bquote(function(x, y) T)
function(, y) T

> eval(.Last.value)
Error in eval(expr, envir, enclos) : invalid formal argument list for "function"

> R.version
               _
platform       i386-pc-mingw32
arch           i386
os             mingw32
system         i386, mingw32
status
major          2
minor          4.1
year           2006
month          12
day            18
svn rev        40228
language       R
version.string R version 2.4.1 (2006-12-18)


-- 
Felix Andrews / $B0BJ!N)(B
PhD candidate, The Fenner School of Environment and Society
The Australian National University (Building 48A), ACT 0200
Beijing Bag, Locked Bag 40, Kingston ACT 2604
http://www.neurofractal.org/felix/
voice:+86_1051404394 (in China)
mobile:+86_13522529265 (in China)
mobile:+61_410400963 (in Australia)
xmpp:foolish.android at gmail.com
3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8


From mtmorgan at fhcrc.org  Fri Apr  6 10:55:50 2007
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Fri, 06 Apr 2007 01:55:50 -0700
Subject: [Rd] Problem with S4 inheritance: unexpected re-initialization?
In-Reply-To: <46152B35.2070200@aon.at> (cstrato@aon.at's message of "Thu, 05
	Apr 2007 19:00:37 +0200")
References: <46112187.3090009@aon.at> <4612CCAB.1080809@fhcrc.org>
	<4613BE1D.5000507@aon.at> <4613F186.1060507@fhcrc.org>
	<46152B35.2070200@aon.at>
Message-ID: <6phfy7dlw4p.fsf@gopher4.fhcrc.org>

Christian, Herve --

In the end, I think you're being caught by partial matching in
function arguments:

> f <- function(x1) cat("x1:", x1, "\n")
> f(x="hello")
x1: hello 

In the functional call x gets matched to x1. In your initialization
method for SubSubClassB2, nameB gets matched to nameB2 and so not
passed as ... in the callNextMethod.

The apparently extra calls to initialize with the wrong arguments come
about because of the validity methods -- validity gets checked by
coercing derived objects to their superclass, which involves a call to
'new' (hence initialize) followed by copying appropriate slots.

The funny effect where class(object) seems to trigger construction of
a new object is lazy evaluation -- the 'object' argument to
setValidity is not evaluated until needed, i.e., until class(object)
(anything would trigger this, including force(object)); only then do
you see the attempt to create the new object of the previous
paragraph.

Without partial matching issues, the use of callNextMethod as here:

setMethod("initialize", "SubSubClassB2",
   function(.Object, nameB2="MyNameB2", ...) {
      if (nameB2 == "") nameB2 <- "DefaultNameB2";
      callNextMethod(.Object, nameB2=nameB2, ...)
   }
)

is fine (though weird to have a prototype, a named argument, and a
conditional assignment!).

With

  setMethod("initialize", "SubSubClassB2",
    function(.Object, ...) {
       .Object <- callNextMethod()
       if (.Object at nameB2 == "") .Object at nameB2 <- "DefaultNameB2"
       .Object
    }
  )

as suggested by Herve, the "SubClassB" initializer matches the nameB
argument to 'new' to the nameB argument of the initialize method for
SubClassB. 

Simplifying the code to illustrate the problem was very helpful. It
would have been better to not present the validity methods (this might
have been a different thread), to remove the cat statements, to remove
unnecessary slots and classes (SubSubClassB1) and to name classes,
slots, and argument values in an easier to remember way (e.g., classes
A, B, C, slots a, b, c)

Hope that helps. 


Martin


cstrato <cstrato at aon.at> writes:

> Dear Herve
>
> Thank you once again for taking your time, I appreciate it very much.
> I followed your advice and kept only the minimum code, which I believe
> is necessary. I have even removed SubClassA, so the inheritance tree is:
>
>    BaseClass <- SubClassB <- SubSubClassB1
>              <- SubClassB <- SubSubClassB2
>
> The source code is shown below and the examples are:
>  > subsubB1 <- new("SubSubClassB1", filename="MyFileNameB1", 
> nameB="MyNameB")
>  > subsubB2 <- new("SubSubClassB2", filename="MyFileNameB2", 
> nameB="MyNameB")
>
> Although SubSubClassB1 and SubSubClassB2 differ only slightly, the results
> for "subsubB1" are correct, while "subsubB2" gives a wrong result, see:
>  > subsubB2 <- new("SubSubClassB2", filename="MyFileNameB2", 
> nameB="MyNameB")
>  > subsubB2
> An object of class "SubSubClassB2"
> Slot "nameB2":
> [1] "MyNameB"
>
> Slot "nameB":
> [1] ""
>
> Slot "filename":
> [1] "MyFileNameB2"
>
> Only, when adding "nameB2="MyNameB2", I get the correct result, see:
>  > subsubB2 <- new("SubSubClassB2", filename="MyFileNameB2", 
> nameB="MyNameB",nameB2="MyNameB2")
>  > subsubB2
> An object of class "SubSubClassB2"
> Slot "nameB2":
> [1] "MyNameB2"
>
> Slot "nameB":
> [1] "MyNameB"
>
> Slot "filename":
> [1] "MyFileNameB2"
>
> It is not clear to me why omitting "nameB2" results in the wrong assignemt
> of the value for "nameB" to "nameB2"?
>
> When running both examples, the sequence of initialization and validation
> method is also completely different.
> For "SubSubClassB1" I get the correct and expected sequence of events:
>  > subsubB1 <- new("SubSubClassB1", filename="MyFileNameB1", 
> nameB="MyNameB")
> ------initialize:SubSubClassB1
> ------initialize:SubClassB
> ------initialize:BaseClass
> ------setValidity:BaseClass
> ------setValidity:SubClassB
> ------setValidity:SubSubClassB1
>
> In contrast, for "SubSubClassB2" I get the following sequence of events:
>  > subsubB2 <- new("SubSubClassB2", filename="MyFileNameB2", 
> nameB="MyNameB")
> ------initialize:SubSubClassB2
> ------initialize:SubClassB
> ------initialize:BaseClass
> ------setValidity:BaseClass
> ------initialize:SubClassB
> ------initialize:BaseClass
> ------setValidity:BaseClass
> ------setValidity:SubClassB
> ------setValidity:SubClassB
> ------initialize:SubClassB
> ------initialize:BaseClass
> ------setValidity:BaseClass
> ------setValidity:SubClassB
> ------setValidity:SubSubClassB2
>
> Furthermore, the slot "filename" is first initialized correctly to
> "filename=MyFileNameB2", but then it is twice initialized incorrectly
> to "filename=ERROR_FileName", indicating that it may not have been
> initialized at all. I do not understand this behavior, why is this so?
>
> I really hope that this time the code below is acceptable to you.
> Thank you for your help.
> Best regards
> Christian
>
> # - - - - - - - - - - - - - - - - BEGIN - - - - - - - - - - - - - - - - 
> - - - -
> setClass("BaseClass",
>    representation(filename = "character", "VIRTUAL"),
>    prototype(filename = "DefaultFileName")
> )
>
> setClass("SubClassB",
>    representation(nameB = "character"),
>    contains=c("BaseClass"),
>    prototype(nameB = "NameB")
> )
>
> setClass("SubSubClassB1",
>    contains=c("SubClassB")
> )
>
> setClass("SubSubClassB2",
>    representation(nameB2 = "character"),
>    contains=c("SubClassB"),
>    prototype(nameB2 = "NameB2")
> )
>
> # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
> setMethod("initialize", "BaseClass",
>    function(.Object, filename="",  ...) {
>       cat("------initialize:BaseClass------\n")
>       cat("BaseClass:init:class(.Object) = ", class(.Object), "\n", sep="")
>       if (filename == "" || nchar(filename) == 0) filename <- 
> "ERROR_FileName"
>       cat("BaseClass:init:filename = ", filename, "\n", sep="")
>       .Object <- callNextMethod(.Object, filename=filename, ...)
>       .Object at filename <- filename
>       .Object
>    }
> )
>
> setValidity("BaseClass",
>    function(object) {
>       cat("------setValidity:BaseClass------\n")
>       cat("BaseClass:val:class(.Object) = ", class(object), "\n", sep="")
>       msg <- NULL
>       if (!(is.character(object at filename)))
>          msg <- cat("missing filename\n")
>       cat("BaseClass:val:filename = ",object at filename, "\n", sep="")
>       if (is.null(msg)) TRUE else msg
>    }
> )
>
> # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
> setMethod("initialize", "SubClassB",
>    function(.Object, nameB="",  ...) {
>       cat("------initialize:SubClassB------\n")
>       cat("SubClassB:init:class(.Object) = ", class(.Object), "\n", sep="")
>       .Object <- callNextMethod(.Object, nameB=nameB, ...)
>       .Object at nameB = nameB
>       .Object
>    }
> )
>
> setValidity("SubClassB",
>    function(object) {
>       cat("------setValidity:SubClassB------\n")
>       cat("SubClassB:val:class(object) = ", class(object), "\n", sep="")
>       msg <- NULL
>       if (!(is.character(object at nameB) && length(object at nameB) > 0))
>          msg <- cat("missing nameB\n")
>       cat("SubClassB:val:nameB = ",object at nameB, "\n", sep="")
>       if (is.null(msg)) TRUE else msg
>    }
> )
>
> # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
> setMethod("initialize", "SubSubClassB1",
>    function(.Object, ...) {
>       cat("------initialize:SubSubClassB1------\n")
>       cat("SubSubClassB1:init:class(.Object) = ", class(.Object), "\n", 
> sep="")
>       .Object <- callNextMethod(.Object, ...)
>       .Object
>    }
> )
>
> setValidity("SubSubClassB1",
>    function(object) {
>       cat("------setValidity:SubSubClassB1------\n")
>       cat("SubSubClassB1:val:class(object) = ", class(object), "\n", sep="")
>       return(TRUE)
>    }
> )
>
> # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
> setMethod("initialize", "SubSubClassB2",
>    function(.Object, nameB2="MyNameB2", ...) {
>       cat("------initialize:SubSubClassB2------\n")
>       cat("SubSubClassB2:init:class(.Object) = ", class(.Object), "\n", 
> sep="")
>       if (nameB2 == "") nameB2 <- "DefaultNameB2";
>       cat("SubSubClassB2:init:nameB2 = ", nameB2, "\n", sep="")
>       .Object <- callNextMethod(.Object, nameB2=nameB2, ...)
>       .Object at nameB2 <- nameB2
>       .Object
>    }
> )
>
> setValidity("SubSubClassB2",
>    function(object) {
>       cat("------setValidity:SubSubClassB2------\n")
>       cat("SubSubClassB2:val:class(object) = ", class(object), "\n", sep="")
>       msg <- NULL;
>       if (!(is.character(object at nameB2) && length(object at nameB2) > 0))
>          msg <- cat("missing nameB2\n")
>       cat("SubClassB:val:nameB2 = ",object at nameB2, "\n", sep="")
>       if (is.null(msg)) TRUE else msg
>    }
> )
>
> # - - - - - - - - - - - - - - - END - - - - - - - - - - - - - - - - -
>
>
> Herve Pages wrote:
>> Hi Christian,
>>
>> cstrato wrote:
>>   
>>> Dear Herve
>>>
>>> Thank you for your helpful comments, and I especially appreciate that
>>> you tried to run my package. I will try to answer each point separately.
>>>
>>> Herve Pages wrote:
>>>     
>>>> Hi Christian,
>>>>
>>>> I can only give you a few reasons why IMO it is very unlikely that
>>>> anybody
>>>> will be able to help you on this, with the current form of your post.
>>>>
>>>> 1) Unless you have a really good reason to do so, don't attach a package
>>>>    to your post. Do your best to provide a few lines of code that anybody
>>>>    can easily copy and paste into their session.
>>>>   
>>>>       
>>> Sorrowly, sometimes, a few lines of code are not sufficient to show
>>> the problem. Furthermore, most of the time there are complaints that
>>> people do not provide enough information, an issue I wanted to avoid.
>>>     
>>
>> The code you provide below is still too long and overcluttered with stuff that is
>> probably unrelated with the issue you want to discuss. Your class definitions
>> still have slots that we don't care about. Basically if you want to
>> discuss an S4 issue, you should get rid of all this file system related stuff
>> (the 'dirfile', 'filedir', 'filename' slots, the 'pathFile' function, the dozens
>> of calls to 'basename', 'dirname', 'getwd', 'file.dir' etc...)
>>
>> Also your code is dirty and hard to read. Take this for example:
>>
>>   "initialize.BaseClass" <-
>>   function(.Object, filename=character(), filedir=as.character(getwd()), ...) {
>>     print("------initialize:BaseClass------")
>>   print(paste("BaseClass:init:class(.Object) = ", class(.Object)))
>>
>>   #   .Object <- callNextMethod(.Object, ...);
>>
>>     dirfile <- pathFile(filename, filedir);
>>   print(paste("BaseClass:init:dirfile = ", dirfile))
>>
>>     .Object <- callNextMethod(.Object, filename=filename, filedir=filedir, ...);
>>
>>     .Object at filename <- filename;
>>     .Object at filedir  <- filedir;
>>     .Object;
>>   }#initialize.BaseClass
>>
>>   setMethod("initialize", "BaseClass", initialize.BaseClass);
>>
>> o It's not properly indented.
>> o Why those empty lines in the middle of such a short function?
>> o Why those semi-columns at the end of lines?
>> o Why put the implementation of the initialize method into a separate function?
>> o Why use this construct 'print(paste())' instead of just 'cat()'?
>> o Why leave the first call to callNextMethod() commented?
>> o What do you do with 'dirfile', except that you print it? Do you need this for
>>   the purpose of the S4 discussion?
>>
>> What about adopting this style:
>>
>>     setMethod("initialize", "BaseClass",
>>         function(.Object, filename=character(), filedir=as.character(getwd()), ...)
>>         {
>>             cat("------initialize:BaseClass------\n")
>>             cat("BaseClass:init:class(.Object) = ", class(.Object))
>>             .Object <- callNextMethod(.Object, filename=filename, filedir=filedir, ...)
>>             .Object at filename <- filename
>>             .Object at filedir  <- filedir
>>             .Object
>>         }
>>     )
>>
>> That's for the style. Now let's talk about the semantic. Here is the definition of
>> your BaseClass class:
>>
>>     setClass("BaseClass",
>>         representation(
>>             "VIRTUAL",
>>             filename="character",
>>             filedir="character"
>>         ),
>>         prototype(
>>             filename = character(),
>>             filedir  = as.character(getwd())
>>         )
>>     )
>>
>> (Note that this definition is what _I_ get after I cleaned it and indented it which
>> is something that _you_ are expected to do.)
>>
>> o Initializing the 'filename' slot to character() is useless since this is the default.
>> o Wrapping getwd() inside as.character() is useless since getwd() returns a character vector.
>> o BUT MOST IMPORTANTLY THAN ANYTHING ELSE: given the fact that you've provided a prototype
>>   for class BaseClass, your initialize method is useless since it does _nothing_ more
>>   than what the default initialize method does! If you want to define your own "initialize"
>>   method for the only purpose of printing messages, then you could do it in a much simpler
>>   way:
>>
>>     setMethod("initialize", "BaseClass",
>>         function(.Object, ...)
>>         {
>>             cat("------initialize:BaseClass------\n")
>>             cat("BaseClass:init:class(.Object) = ", class(.Object), "\n", sep="")
>>             callNextMethod()
>>         }
>>     )
>>
>> But as I said initially, the file system related stuff is useless to illustrate the
>> S4 issue you want to show us so why didn't you just provide:
>>
>>     setClass("BaseClass",
>>         representation("VIRTUAL", slot1="character"),
>>         prototype(slot1="aaa")
>>     )
>>
>>     setMethod("initialize", "BaseClass",
>>         function(.Object, ...)
>>         {
>>             cat("------initialize:BaseClass------\n")
>>             cat("BaseClass:init:class(.Object) = ", class(.Object), "\n", sep="")
>>             callNextMethod()
>>         }
>>     )
>>
>> See? I ended up by replacing 25 lines of your hard-to-read/confusing code by 12
>> lines of clean code containing only the STRICTLY NECESSARY stuff for an S4 discussion.
>> That's what you should have done instead of sending us 150 lines of code.
>>
>> Sorrowly people will not try to read your code unless it's obvious that _you_ did your
>> best to provide the cleanest/simplest possible code that illustrates the issue you want
>> to discuss.
>>
>> Also maybe you could try to read a little bit more about S4 and initialization mechanisms.
>>
>> Cheers,
>> H.
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin Morgan
Bioconductor / Computational Biology
http://bioconductor.org


From gregor.gorjanc at bfro.uni-lj.si  Fri Apr  6 12:53:07 2007
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Fri, 06 Apr 2007 12:53:07 +0200
Subject: [Rd] R-Forge?
Message-ID: <46162693.20809@bfro.uni-lj.si>

Hello!

I have recently found RForge.net (http://www.rforge.net/) by Simon
Urbanek and found out today that the site is accepting subscriptions.
Great! However, browsing a bit on the site I found a link to another
forge: R-Forge (http://r-forge.r-project.org/).

Is/will the last one be the "offcial" forge for R packages, given that
it has domain r-project.org?

Regards, Gregor


From penel at biomserv.univ-lyon1.fr  Fri Apr  6 15:09:07 2007
From: penel at biomserv.univ-lyon1.fr (Simon Penel)
Date: Fri, 06 Apr 2007 15:09:07 +0200
Subject: [Rd] getConnection is not found in R depending on the Linux flavour
 (RedHat or Debian) - dyn.load problems
Message-ID: <46164673.8000008@biomserv.univ-lyon1.fr>


Hello R developers,

I am working on the "seqinr" package and I encounter a tricky problem 
using  a C
function.

We defined a C fonction called   "getzlibsock" which is dedicated to 
compressed
socket connections. This function is using the R internal  C function
called "getConnection(int)" in order to get information about the socket
previously opened with the dedicated R functions.

The program works fine on several platform:
-Unix (SunOS),
-MacOS and
-Linux (some).
However, on Linux, an error occurs  depending on the installation.

I tried to play with the Makevars file  by specifing lots of path and 
library
without succees
On Red Hat Linux  it works fine, but on Debian the dynamic library can 
not be
loaded:

Library is working fine with Linux  Red Hat:
---------------------------------------------------------

R.2.4.0
Linux ccali24 2.4.21-32.0.1.ELsmp #1 SMP Wed May 25 15:42:26 CDT 2005 
i686 i686 i386 GNU/Linux
RedHat
gcc version 3.2.3 20030502 (Red Hat Linux 3.2.3-52)
Reading specs from /usr/lib/gcc-lib/i386-redhat-linux/3.2.3/specs
Configured with:
 ../configure --prefix=/usr --mandir=/usr/share/man
--infodir=/usr/share/info --enable-shared --enable-threads=posix
--disable-checking --with-system-zlib --enable-__cxa_atexit
--host=i386-redhat-linux
Thread model: posix


Compiling the dynamic library:
Makevars:
PKG_CFLAGS = -ansi -DUSE_TYPE_CHECKING_STRICT

R CMD SHLIB -o test.so *.c
gcc -I/afs/in2p3.fr/home/throng/biometr/R_dir/install//lib/R/include 
-I/afs/in2p3.fr/home/throng/biometr/R_dir/install//lib/R/include  
-I/usr/local/include   -ansi -DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 
-std=gnu99 -c alignment.c -o alignment.o
gcc -I/afs/in2p3.fr/home/throng/biometr/R_dir/install//lib/R/include 
-I/afs/in2p3.fr/home/throng/biometr/R_dir/install//lib/R/include  
-I/usr/local/include   -ansi -DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 
-std=gnu99 -c getzlibsock.c -o getzlibsock.o
gcc -I/afs/in2p3.fr/home/throng/biometr/R_dir/install//lib/R/include 
-I/afs/in2p3.fr/home/throng/biometr/R_dir/install//lib/R/include  
-I/usr/local/include   -ansi -DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 
-std=gnu99 -c kaks.c -o kaks.o
gcc -I/afs/in2p3.fr/home/throng/biometr/R_dir/install//lib/R/include 
-I/afs/in2p3.fr/home/throng/biometr/R_dir/install//lib/R/include  
-I/usr/local/include   -ansi -DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 
-std=gnu99 -c util.c -o util.o
gcc -I/afs/in2p3.fr/home/throng/biometr/R_dir/install//lib/R/include 
-I/afs/in2p3.fr/home/throng/biometr/R_dir/install//lib/R/include  
-I/usr/local/include   -ansi -DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 
-std=gnu99 -c zsockr.c -o zsockr.o
gcc -shared -L/usr/local/lib -o test.so alignment.o getzlibsock.o kaks.o 
util.o zsockr.o  


Note that the dll libR.so is not asked not the path to the dll
Loading the dynamic library:

R version 2.4.0 (2006-10-03)
Copyright (C) 2006 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

 > dyn.load("test.so")
 >



Problem in library  with Linux Debian
--------------------------------------------------
( both  binary distribution of R and version builded from sources):



a) with the binary version
R version 2.4.1 (2006-12-18)

This the binary distribution obtained via apt-get

Linux pcstef 2.6.15-1-686-smp #2 SMP Mon Mar 6 15:34:50 UTC 2006 i686 
GNU/Linux
Debian
gcc version 4.1.2 20061115 (prerelease) (Debian 4.1.1-21)

Configured with:
../src/configure -v --enable-languages=c,c++,fortran,objc,obj-c++,treelang
--prefix=/usr --enable-shared --with-system-zlib --libexecdir=/usr/lib
--without-included-gettext --enable-threads=posix --enable-nls
--program-suffix=-4.1 --enable-__cxa_atexit --enable-clocale=gnu
--enable-libstdcxx-debug --enable-mpfr --with-tune=i686
--enable-checking=release i486-linux-gnu
Thread model: posix

Compiling the dynamic library:
Makevars:
PKG_CFLAGS = -ansi -DUSE_TYPE_CHECKING_STRICT
PKG_LIBS =  -lR  -lz
 rm *o
 
 
R CMD SHLIB -o test.so *.c
gcc -std=gnu99 -I/usr/share/R/include -I/usr/share/R/include     -ansi 
-DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 -c alignment.c -o alignment.o
gcc -std=gnu99 -I/usr/share/R/include -I/usr/share/R/include     -ansi 
-DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 -c getzlibsock.c -o getzlibsock.o
gcc -std=gnu99 -I/usr/share/R/include -I/usr/share/R/include     -ansi 
-DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 -c kaks.c -o kaks.o
gcc -std=gnu99 -I/usr/share/R/include -I/usr/share/R/include     -ansi 
-DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 -c util.c -o util.o
gcc -std=gnu99 -I/usr/share/R/include -I/usr/share/R/include     -ansi 
-DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 -c zsockr.c -o zsockr.o
gcc -std=gnu99 -shared  -o test.so alignment.o getzlibsock.o kaks.o 
util.o zsockr.o -lR  -lz  -L/usr/lib/R/lib -lR


Loading the dynamic library:
....
 > dyn.load("test.so")
Erreur dans dyn.load(x, as.logical(local), as.logical(now)) :
        impossible de charger la biblioth?que partag?e 
'/home/simon/seqinr_in2p3/seqinr/src/test.so':
  /home/simon/seqinr_in2p3/seqinr/src/test.so: undefined symbol: 
getConnection
 >
....
However  the dll libR.so exists in the "/usr/lib/R/lib" path:
ls /usr/lib/R/lib
libRlapack.so  libR.so

But the libR.so does not seems to contain getConnection:
grep getConnection /usr/lib/R/lib/libR.so  give no answer


Moreover libR.so can not be read by nm:
nm: /usr/lib/R/lib/libR.so: aucun symbole

b) with the sources

I was thus wondering if the problem was due to a incompatibility between 
the binary
version of R I get  via apt-get and the dynamic library I compiled with  the
current gcc.

I try with the R installed from sources

../../../R-install_R-2.4.1/bin/R  CMD SHLIB -o test.so *.c
gcc-4.1 -std=gnu99 -I/home/simon/R-install_R-2.4.1//lib/R/include 
-I/home/simon/R-install_R-2.4.1//lib/R/include  -I/usr/local/include   
-ansi -DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 -c alignment.c -o alignment.o
gcc-4.1 -std=gnu99 -I/home/simon/R-install_R-2.4.1//lib/R/include 
-I/home/simon/R-install_R-2.4.1//lib/R/include  -I/usr/local/include   
-ansi -DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 -c getzlibsock.c -o 
getzlibsock.o
gcc-4.1 -std=gnu99 -I/home/simon/R-install_R-2.4.1//lib/R/include 
-I/home/simon/R-install_R-2.4.1//lib/R/include  -I/usr/local/include   
-ansi -DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 -c kaks.c -o kaks.o
gcc-4.1 -std=gnu99 -I/home/simon/R-install_R-2.4.1//lib/R/include 
-I/home/simon/R-install_R-2.4.1//lib/R/include  -I/usr/local/include   
-ansi -DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 -c util.c -o util.o
gcc-4.1 -std=gnu99 -I/home/simon/R-install_R-2.4.1//lib/R/include 
-I/home/simon/R-install_R-2.4.1//lib/R/include  -I/usr/local/include   
-ansi -DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 -c zsockr.c -o zsockr.o
gcc-4.1 -std=gnu99 -shared -L/usr/local/lib -o test.so alignment.o 
getzlibsock.o kaks.o util.o zsockr.o -lR  -lz  
-L/home/simon/R-install_R-2.4.1//lib/R/lib -lR



Loading the dynamic library:

~/seqinr_in2p3/seqinr/src$ 
../../../R-install_R-2.4.1/bin/R                         
R version 2.4.1 (2006-12-18)
Copyright (C) 2006 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
...
 > dyn.load("test.so")
Erreur dans dyn.load(x, as.logical(local), as.logical(now)) :
        impossible de charger la biblioth?que partag?e 
'/home/simon/seqinr_in2p3/seqinr/src/test.so':
  /home/simon/seqinr_in2p3/seqinr/src/test.so: undefined symbol: 
getConnection
 >
...

In this case the path still contains 
/home/simon/R-install_R-2.4.1//lib/R/lib
where the R ldd can be found:
 ls /home/simon/R-install_R-2.4.1//lib/R/lib
libRblas.so  libRlapack.so  libR.so

and libR.so contains getConnection:
 nm  /home/simon/R-install_R-2.4.1//lib/R/lib/libR.so |grep getConnection
00052990 t getConnection
00052240 t getConnection_no_err



I was wondering if the problem was a difference between R-2.4.1 and 
R.2.4.0 but I
think this not the case because it is possible to compile and load the 
dll test.so on Linux
Red Hat with the R-devel version as well as the R-2.4.0., and it works 
fine as well on the MacOS
R-2.4.1.:


Library is working fine with MacOS:
-----------------------------------------------

R-2.4.1
Darwin chobits.univ-lyon1.fr 8.8.0 Darwin Kernel Version 8.8.0: Fri Sep  
8 17:18:57 PDT 2006; root:xnu-792.12.6.obj~1/RELEASE_PPC Power Macintosh 
powerpc
gcc: Target: i686-apple-darwin8
Configured with: ../gcc-4.0.3/configure --prefix=/usr/local/gcc4.0 
--disable-checking --program-transform-name=/^[cg][^.-]*$/s/$/-4.0/ 
--build=i686-apple-darwin8 --program-prefix=powerpc-apple-darwin8- 
--host=powerpc-apple-darwin8 --target=i686-apple-darwin8 --with-sysroot= 
--enable-languages=c,c++,f95,objc
Thread model: posix
gcc version 4.0.3


 R CMD SHLIB -o test.o *.c
gcc-4.0 -arch ppc -std=gnu99 
-I/Library/Frameworks/R.framework/Resources/include 
-I/Library/Frameworks/R.framework/Resources/include/ppc  
-I/usr/local/include   -ansi -DUSE_TYPE_CHECKING_STRICT -fPIC  -g -O2 -c 
alignment.c -o alignment.o
gcc-4.0 -arch ppc -std=gnu99 
-I/Library/Frameworks/R.framework/Resources/include 
-I/Library/Frameworks/R.framework/Resources/include/ppc  
-I/usr/local/include   -ansi -DUSE_TYPE_CHECKING_STRICT -fPIC  -g -O2 -c 
getzlibsock.c -o getzlibsock.o
gcc-4.0 -arch ppc -std=gnu99 
-I/Library/Frameworks/R.framework/Resources/include 
-I/Library/Frameworks/R.framework/Resources/include/ppc  
-I/usr/local/include   -ansi -DUSE_TYPE_CHECKING_STRICT -fPIC  -g -O2 -c 
kaks.c -o kaks.o
gcc-4.0 -arch ppc -std=gnu99 
-I/Library/Frameworks/R.framework/Resources/include 
-I/Library/Frameworks/R.framework/Resources/include/ppc  
-I/usr/local/include   -ansi -DUSE_TYPE_CHECKING_STRICT -fPIC  -g -O2 -c 
util.c -o util.o
gcc-4.0 -arch ppc -std=gnu99 
-I/Library/Frameworks/R.framework/Resources/include 
-I/Library/Frameworks/R.framework/Resources/include/ppc  
-I/usr/local/include   -ansi -DUSE_TYPE_CHECKING_STRICT -fPIC  -g -O2 -c 
zsockr.c -o zsockr.o
gcc-4.0 -arch ppc -std=gnu99 -dynamiclib -Wl -single_module 
-multiply_defined suppress -L/usr/local/lib -o test.o alignment.o 
getzlibsock.o kaks.o util.o zsockr.o   
-L/Library/Frameworks/R.framework/Resources/lib/ppc -lR -dylib_file 
libRblas.dylib:/Library/Frameworks/R.framework/Resources/lib/ppc/libRblas.dylib

R version 2.4.1 (2006-12-18)
Copyright (C) 2006 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
....
 > dyn.load("test.o")
 >
 >


R Installation problem?
-------------------------------

I was wondering if it the way in which R is configured? I installed R on 
the Linux Debian  with these options ./configure --prefix
/home/simon/R-install_R-2.4.1/ --without-dataentry --without-x 
--disable-dataentry --enable-R-shlib --enable-static
--with-recommended-packages CC=gcc-4.1

I noticed as well that concerning the  Debian Linux installations ,I 
had  problem when the libR.so  was required during compilation of my
 sources ( -lR option). I try a new installation of R with the folowing 
options:

 ./configure --prefix=/home/simon/R-2.4.1_otherinstall/install/ 
--without-dataentry --without-x --disable-dataentry --enable-static
--with-recommended-packages

When compiling my sources I get:

 rm *o
../../../R-2.4.1_otherinstall/install/bin/R CMD SHLIB -o test.o *.c
gcc -std=gnu99 -I/home/simon/R-2.4.1_otherinstall/install//lib/R/include 
-I/home/simon/R-2.4.1_otherinstall/install//lib/R/include  
-I/usr/local/include   -ansi -DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 -c 
alignment.c -o alignment.o
gcc -std=gnu99 -I/home/simon/R-2.4.1_otherinstall/install//lib/R/include 
-I/home/simon/R-2.4.1_otherinstall/install//lib/R/include  
-I/usr/local/include   -ansi -DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 -c 
getzlibsock.c -o getzlibsock.o
gcc -std=gnu99 -I/home/simon/R-2.4.1_otherinstall/install//lib/R/include 
-I/home/simon/R-2.4.1_otherinstall/install//lib/R/include  
-I/usr/local/include   -ansi -DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 -c 
kaks.c -o kaks.o
gcc -std=gnu99 -I/home/simon/R-2.4.1_otherinstall/install//lib/R/include 
-I/home/simon/R-2.4.1_otherinstall/install//lib/R/include  
-I/usr/local/include   -ansi -DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 -c 
util.c -o util.o
gcc -std=gnu99 -I/home/simon/R-2.4.1_otherinstall/install//lib/R/include 
-I/home/simon/R-2.4.1_otherinstall/install//lib/R/include  
-I/usr/local/include   -ansi -DUSE_TYPE_CHECKING_STRICT -fpic  -g -O2 -c 
zsockr.c -o zsockr.o
gcc -std=gnu99 -shared -L/usr/local/lib -o test.o alignment.o 
getzlibsock.o kaks.o util.o zsockr.o  


But the problem still occurs:
../../../R-2.4.1_otherinstall/install/bin/R

R version 2.4.1 (2006-12-18)
Copyright (C) 2006 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
...
 > dyn.load("test.o")
Erreur dans dyn.load(x, as.logical(local), as.logical(now)) :
        impossible de charger la biblioth?que partag?e 
'/home/simon/seqinr_in2p3/seqinr/src/test.o':
  /home/simon/seqinr_in2p3/seqinr/src/test.o: undefined symbol: 
getConnection
 >


Finally I tried as well on Windows and the function "getConnection" was 
not found at the compilation step.....

Thanks very much for any help!!

Simon


-- 
Simon Penel
Laboratoire de Biometrie et Biologie Evolutive           
Bat 711  -   CNRS UMR 5558  -    Universite Lyon 1              
43 bd du 11 novembre 1918 69622 Villeurbanne Cedex       
Tel:   04 72 43 29 04      Fax:  04 72 43 13 88
http://pbil.univ-lyon1.fr/members/penel


From Achim.Zeileis at wu-wien.ac.at  Fri Apr  6 15:54:20 2007
From: Achim.Zeileis at wu-wien.ac.at (Achim Zeileis)
Date: Fri, 6 Apr 2007 15:54:20 +0200 (CEST)
Subject: [Rd] R-Forge?
In-Reply-To: <46162693.20809@bfro.uni-lj.si>
References: <46162693.20809@bfro.uni-lj.si>
Message-ID: <Pine.LNX.4.64.0704061541060.6584@eowyn>

On Fri, 6 Apr 2007, Gregor Gorjanc wrote:

> Hello!
>
> I have recently found RForge.net (http://www.rforge.net/) by Simon
> Urbanek and found out today that the site is accepting subscriptions.
> Great! However, browsing a bit on the site I found a link to another
> forge: R-Forge (http://r-forge.r-project.org/).
>
> Is/will the last one be the "offcial" forge for R packages, given that
> it has domain r-project.org?

Yes, we're currently still testing the functionality and improving the 
documentation, but an article for R News that announces the functionality 
is under preparation. There is already a user's manual available on the 
main page which explains how you can register and set up your project etc. 
Just as Simon's site this already offers an SVN and nightly builds in a 
CRAN-style repository, and additionally there is the whole GForge system 
with other features such as project forums, mailing lists etc.

Best,
Z

> Regards, Gregor
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From h.wickham at gmail.com  Fri Apr  6 16:18:13 2007
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 6 Apr 2007 09:18:13 -0500
Subject: [Rd] R-Forge?
In-Reply-To: <Pine.LNX.4.64.0704061541060.6584@eowyn>
References: <46162693.20809@bfro.uni-lj.si>
	<Pine.LNX.4.64.0704061541060.6584@eowyn>
Message-ID: <f8e6ff050704060718g407b5a6gd562766ed6d941c0@mail.gmail.com>

> > I have recently found RForge.net (http://www.rforge.net/) by Simon
> > Urbanek and found out today that the site is accepting subscriptions.
> > Great! However, browsing a bit on the site I found a link to another
> > forge: R-Forge (http://r-forge.r-project.org/).
> >
> > Is/will the last one be the "offcial" forge for R packages, given that
> > it has domain r-project.org?
>
> Yes, we're currently still testing the functionality and improving the
> documentation, but an article for R News that announces the functionality
> is under preparation. There is already a user's manual available on the
> main page which explains how you can register and set up your project etc.
> Just as Simon's site this already offers an SVN and nightly builds in a
> CRAN-style repository, and additionally there is the whole GForge system
> with other features such as project forums, mailing lists etc.

Is it possible to use r-forge just for the nightly builds?   (ie. with
svn hosted elsewhere)  That would be really handy.

Hadley


From h.wickham at gmail.com  Fri Apr  6 18:22:27 2007
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 6 Apr 2007 11:22:27 -0500
Subject: [Rd] R-Forge?
In-Reply-To: <46166086.8010802@ai.wu-wien.ac.at>
References: <46162693.20809@bfro.uni-lj.si>
	<Pine.LNX.4.64.0704061541060.6584@eowyn>
	<f8e6ff050704060718g407b5a6gd562766ed6d941c0@mail.gmail.com>
	<46166086.8010802@ai.wu-wien.ac.at>
Message-ID: <f8e6ff050704060922oee6cec1u92785ae4b8af2f98@mail.gmail.com>

On 4/6/07, Stefan Theussl <theussl at ai.wu-wien.ac.at> wrote:
> hadley wickham wrote:
> >> > I have recently found RForge.net (http://www.rforge.net/) by Simon
> >> > Urbanek and found out today that the site is accepting subscriptions.
> >> > Great! However, browsing a bit on the site I found a link to another
> >> > forge: R-Forge (http://r-forge.r-project.org/).
> >> >
> >> > Is/will the last one be the "offcial" forge for R packages, given that
> >> > it has domain r-project.org?
> >>
> >> Yes, we're currently still testing the functionality and improving the
> >> documentation, but an article for R News that announces the
> >> functionality
> >> is under preparation. There is already a user's manual available on the
> >> main page which explains how you can register and set up your project
> >> etc.
> >> Just as Simon's site this already offers an SVN and nightly builds in a
> >> CRAN-style repository, and additionally there is the whole GForge system
> >> with other features such as project forums, mailing lists etc.
> >
> > Is it possible to use r-forge just for the nightly builds?   (ie. with
> > svn hosted elsewhere)  That would be really handy.
> >
> > Hadley
> We have never thought about it, but this would be technically difficult.
>
> But you may migrate your svn (or the part which contains the package) to
> R-Forge and have the advantage of daily build and checked packages with
> the possibility to install it directly from R-Forge:
> |install.packages("/packagename/",repos="http://r-forge.r-project.org")|

I guess I'm not really comfortable moving my code to an external
repository completely out of my control.  It would be really
convenient to be able to upload a source package, and have it built,
with out R CMD check being enforced.

Hadley


From simon.urbanek at r-project.org  Fri Apr  6 19:04:15 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 6 Apr 2007 13:04:15 -0400
Subject: [Rd] R-Forge?
In-Reply-To: <f8e6ff050704060922oee6cec1u92785ae4b8af2f98@mail.gmail.com>
References: <46162693.20809@bfro.uni-lj.si>
	<Pine.LNX.4.64.0704061541060.6584@eowyn>
	<f8e6ff050704060718g407b5a6gd562766ed6d941c0@mail.gmail.com>
	<46166086.8010802@ai.wu-wien.ac.at>
	<f8e6ff050704060922oee6cec1u92785ae4b8af2f98@mail.gmail.com>
Message-ID: <3029D199-DE92-4B26-A380-9990EC782E1D@r-project.org>


On Apr 6, 2007, at 12:22 PM, hadley wickham wrote:

> On 4/6/07, Stefan Theussl <theussl at ai.wu-wien.ac.at> wrote:
>> hadley wickham wrote:
>>>>> I have recently found RForge.net (http://www.rforge.net/) by Simon
>>>>> Urbanek and found out today that the site is accepting  
>>>>> subscriptions.
>>>>> Great! However, browsing a bit on the site I found a link to  
>>>>> another
>>>>> forge: R-Forge (http://r-forge.r-project.org/).
>>>>>
>>>>> Is/will the last one be the "offcial" forge for R packages,  
>>>>> given that
>>>>> it has domain r-project.org?
>>>>
>>>> Yes, we're currently still testing the functionality and  
>>>> improving the
>>>> documentation, but an article for R News that announces the
>>>> functionality
>>>> is under preparation. There is already a user's manual available  
>>>> on the
>>>> main page which explains how you can register and set up your  
>>>> project
>>>> etc.
>>>> Just as Simon's site this already offers an SVN and nightly  
>>>> builds in a
>>>> CRAN-style repository, and additionally there is the whole  
>>>> GForge system
>>>> with other features such as project forums, mailing lists etc.
>>>
>>> Is it possible to use r-forge just for the nightly builds?   (ie.  
>>> with
>>> svn hosted elsewhere)  That would be really handy.
>>>
>>> Hadley
>> We have never thought about it, but this would be technically  
>> difficult.
>>
>> But you may migrate your svn (or the part which contains the  
>> package) to
>> R-Forge and have the advantage of daily build and checked packages  
>> with
>> the possibility to install it directly from R-Forge:
>> |install.packages("/packagename/",repos="http://r-forge.r- 
>> project.org")|
>
> I guess I'm not really comfortable moving my code to an external
> repository completely out of my control.  It would be really
> convenient to be able to upload a source package, and have it built,
> with out R CMD check being enforced.
>

I see the whole point of using external repository (like either  
rforge) in having fully-backed SVN repository on server-grade  
hardware. If you already have a SVN repository, why won't you use a  
post-commit script on the same machine to do the build and check?

Cheers,
Simon


From cstrato at aon.at  Fri Apr  6 19:10:13 2007
From: cstrato at aon.at (cstrato)
Date: Fri, 06 Apr 2007 19:10:13 +0200
Subject: [Rd] Problem with S4 inheritance: unexpected re-initialization?
In-Reply-To: <6phfy7dlw4p.fsf@gopher4.fhcrc.org>
References: <46112187.3090009@aon.at>
	<4612CCAB.1080809@fhcrc.org>	<4613BE1D.5000507@aon.at>
	<4613F186.1060507@fhcrc.org>	<46152B35.2070200@aon.at>
	<6phfy7dlw4p.fsf@gopher4.fhcrc.org>
Message-ID: <46167EF5.5090406@aon.at>

Dear Herve, dear Martin,

First I want to thank Herve very much for your continuous efforts. You can
not imagine, how relieved I was that you mangaged to reproduce this 
behavior.

Just when I wanted to send my reply to Herve, I received Martin's comments:
As you mention, there were two problems in my example:

1. partial matching:
Thank you for your explanation, now I hope that I understand the behavior.
However, as Herve correctly mentioned, this is only a side issue.

2. lazy evaluation and validity methods:
This is the real problem, that I try to solve since three weeks, and I am
afraid, that I still do not know how to solve it.

Following Herve's example, I have managed to reduce my own example so that
it is only slightly larger than his example, however, now I had to expand
it again to make my point, see the final code below.
(For the moment I stick with my naming of the classes)

The result I get is the following:
 > subsubB2 <- new("SubSubClassB2", filename="MyFileNameB2", 
nameB="MyNameB")
------initialize:SubSubClassB2------
------initialize:SubClassB------
------initialize:BaseClass------
BaseClass:init:filename = MyFileNameB2
------setValidity:BaseClass------
------initialize:SubClassB------
------initialize:BaseClass------
BaseClass:init:filename = ERROR_FileName
------setValidity:BaseClass------
------setValidity:SubClassB------
------setValidity:SubClassB------
------setValidity:SubSubClassB2------
SubSubClassB2:val:filename = MyFileNameB2

Although the final output gives the correct result "filename = 
MyFileNameB2",
in the interim code, filename is set to "filename = ERROR_FileName".

In my real package the line "filename <- ERROR_FileName" is replaced by
a function. To take advantage of inheritance, I have defined "filename"
in BaseClass, and I want to check for its validity only once in BaseClass.

With the current information I have to re-evaluate my code in order to
avoid "lazy evaluation", since this might be the problem.

Thank you both for your extensive help.
Best regards
Christian

# - - - - - - - - - - - - - - - BEGIN - - - - - - - - - - - - - - - -
setClass("BaseClass",
   representation(filename = "character", "VIRTUAL"),
   prototype(filename = "DefaultFileName")
)

setClass("SubClassB",
   representation(nameB = "character"),
   contains=c("BaseClass"),
   prototype(nameB = "NameB")
)

setClass("SubSubClassB2",
   representation(nameB2 = "character"),
   contains=c("SubClassB"),
   prototype(nameB2 = "NameB2")
)

setMethod("initialize", "BaseClass",
   function(.Object, filename="",  ...) {
      cat("------initialize:BaseClass------\n")
      if (filename == "" || nchar(filename) == 0) filename <- 
"ERROR_FileName"
      cat("BaseClass:init:filename = ", filename, "\n", sep="")
      .Object <- callNextMethod(.Object, filename=filename, ...)
      .Object at filename <- filename
      .Object
   }
)

setValidity("BaseClass",
   function(object) {
      cat("------setValidity:BaseClass------\n")
      msg <- NULL
      str <- object at filename
      if (!(is.character(object at filename)))
         msg <- cat("missing filename\n")
      if (is.null(msg)) TRUE else msg
   }
)

setMethod("initialize", "SubClassB",
   function(.Object, nameB="",  ...) {
      cat("------initialize:SubClassB------\n")
      .Object <- callNextMethod(.Object, nameB=nameB, ...)
   }
)

setValidity("SubClassB",
   function(object) {
      cat("------setValidity:SubClassB------\n")
      TRUE
   }
)

setMethod("initialize", "SubSubClassB2",
   function(.Object, ...) {
      cat("------initialize:SubSubClassB2------\n")
      .Object <- callNextMethod(.Object, ...)
   }
)

setValidity("SubSubClassB2",
   function(object) {
      cat("------setValidity:SubSubClassB2------\n")
      cat("SubSubClassB2:val:filename = ", object at filename, "\n", sep="")
      TRUE
   }
)
# - - - - - - - - - - - - - - - END - - - - - - - - - - - - - - - - -


Martin Morgan wrote:
> Christian, Herve --
>
> In the end, I think you're being caught by partial matching in
> function arguments:
>
>   
>> f <- function(x1) cat("x1:", x1, "\n")
>> f(x="hello")
>>     
> x1: hello 
>
> In the functional call x gets matched to x1. In your initialization
> method for SubSubClassB2, nameB gets matched to nameB2 and so not
> passed as ... in the callNextMethod.
>
> The apparently extra calls to initialize with the wrong arguments come
> about because of the validity methods -- validity gets checked by
> coercing derived objects to their superclass, which involves a call to
> 'new' (hence initialize) followed by copying appropriate slots.
>
> The funny effect where class(object) seems to trigger construction of
> a new object is lazy evaluation -- the 'object' argument to
> setValidity is not evaluated until needed, i.e., until class(object)
> (anything would trigger this, including force(object)); only then do
> you see the attempt to create the new object of the previous
> paragraph.
>
> Without partial matching issues, the use of callNextMethod as here:
>
> setMethod("initialize", "SubSubClassB2",
>    function(.Object, nameB2="MyNameB2", ...) {
>       if (nameB2 == "") nameB2 <- "DefaultNameB2";
>       callNextMethod(.Object, nameB2=nameB2, ...)
>    }
> )
>
> is fine (though weird to have a prototype, a named argument, and a
> conditional assignment!).
>
> With
>
>   setMethod("initialize", "SubSubClassB2",
>     function(.Object, ...) {
>        .Object <- callNextMethod()
>        if (.Object at nameB2 == "") .Object at nameB2 <- "DefaultNameB2"
>        .Object
>     }
>   )
>
> as suggested by Herve, the "SubClassB" initializer matches the nameB
> argument to 'new' to the nameB argument of the initialize method for
> SubClassB. 
>
> Simplifying the code to illustrate the problem was very helpful. It
> would have been better to not present the validity methods (this might
> have been a different thread), to remove the cat statements, to remove
> unnecessary slots and classes (SubSubClassB1) and to name classes,
> slots, and argument values in an easier to remember way (e.g., classes
> A, B, C, slots a, b, c)
>
> Hope that helps. 
>
>
> Martin
>
>
>


From hpages at fhcrc.org  Fri Apr  6 20:01:58 2007
From: hpages at fhcrc.org (Herve Pages)
Date: Fri, 06 Apr 2007 11:01:58 -0700
Subject: [Rd] Problem with S4 inheritance: unexpected re-initialization?
In-Reply-To: <6phfy7dlw4p.fsf@gopher4.fhcrc.org>
References: <46112187.3090009@aon.at>
	<4612CCAB.1080809@fhcrc.org>	<4613BE1D.5000507@aon.at>
	<4613F186.1060507@fhcrc.org>	<46152B35.2070200@aon.at>
	<6phfy7dlw4p.fsf@gopher4.fhcrc.org>
Message-ID: <46168B16.4090703@fhcrc.org>

Martin,

Martin Morgan wrote:
> The funny effect where class(object) seems to trigger construction of
> a new object is lazy evaluation -- the 'object' argument to
> setValidity is not evaluated until needed, i.e., until class(object)
> (anything would trigger this, including force(object)); only then do
> you see the attempt to create the new object of the previous
> paragraph.

The fact that you can't predict the number of times the "initialize"
method will be called is problematic. Here is a simple example
where "initialize-A" increments a global counter to keep track of the
number of A-objects:

  A.GLOBALS <- new.env(parent=emptyenv())
  A.GLOBALS[["nobjs"]] <- 0L

  setClass("A",
    representation(a="character"),
    prototype(a="a0")
  )
  setMethod("initialize", "A",
    function(.Object, ...) {
        cat("------initialize:A------\n")
        A.GLOBALS[["nobjs"]] <- A.GLOBALS[["nobjs"]] + 1
        cat("A-object #", A.GLOBALS[["nobjs"]], "\n", sep="")
        callNextMethod()
    }
  )
  setValidity("A",
    function(object) {
        cat("------setValidity:A------\n")
        tmp <- class(object)
        TRUE
    }
  )

  setClass("B",
    contains="A",
    representation(b = "character")
  )
  setMethod("initialize", "B",
    function(.Object, ...) {
        cat("------initialize:B------\n")
        callNextMethod()
    }
  )
  setValidity("B",
    function(object) {
        cat("------setValidity:B------\n")
        TRUE
    }
  )

Let's try it:

  > b1 <- new("B")
  ------initialize:B------
  ------initialize:A------
  A-object #1
  > A.GLOBALS[["nobjs"]]
  [1] 1

  > b1 <- new("B", b="hello")
  ------initialize:B------
  ------initialize:A------
  A-object #2
  ------setValidity:A------
  ------initialize:A------
  A-object #3
  ------setValidity:B------
  > A.GLOBALS[["nobjs"]]
  [1] 3

Shouldn't the "initializing" ("constructor" in other languages) code be executed
exactly 1 time per object instanciation? Something that the programmer can simply
rely on, whatever this code contains and whatever the internal subtilities of the
programming lamguage are?

Cheers,
H.


From deepayan.sarkar at gmail.com  Fri Apr  6 20:56:23 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Fri, 6 Apr 2007 11:56:23 -0700
Subject: [Rd] R-Forge?
In-Reply-To: <f8e6ff050704060922oee6cec1u92785ae4b8af2f98@mail.gmail.com>
References: <46162693.20809@bfro.uni-lj.si>
	<Pine.LNX.4.64.0704061541060.6584@eowyn>
	<f8e6ff050704060718g407b5a6gd562766ed6d941c0@mail.gmail.com>
	<46166086.8010802@ai.wu-wien.ac.at>
	<f8e6ff050704060922oee6cec1u92785ae4b8af2f98@mail.gmail.com>
Message-ID: <eb555e660704061156w54b40767jc05d869d2b2da785@mail.gmail.com>

On 4/6/07, hadley wickham <h.wickham at gmail.com> wrote:
> On 4/6/07, Stefan Theussl <theussl at ai.wu-wien.ac.at> wrote:
> > hadley wickham wrote:
> > >> > I have recently found RForge.net (http://www.rforge.net/) by Simon
> > >> > Urbanek and found out today that the site is accepting subscriptions.
> > >> > Great! However, browsing a bit on the site I found a link to another
> > >> > forge: R-Forge (http://r-forge.r-project.org/).
> > >> >
> > >> > Is/will the last one be the "offcial" forge for R packages, given that
> > >> > it has domain r-project.org?
> > >>
> > >> Yes, we're currently still testing the functionality and improving the
> > >> documentation, but an article for R News that announces the
> > >> functionality
> > >> is under preparation. There is already a user's manual available on the
> > >> main page which explains how you can register and set up your project
> > >> etc.
> > >> Just as Simon's site this already offers an SVN and nightly builds in a
> > >> CRAN-style repository, and additionally there is the whole GForge system
> > >> with other features such as project forums, mailing lists etc.
> > >
> > > Is it possible to use r-forge just for the nightly builds?   (ie. with
> > > svn hosted elsewhere)  That would be really handy.
> > >
> > > Hadley
> > We have never thought about it, but this would be technically difficult.
> >
> > But you may migrate your svn (or the part which contains the package) to
> > R-Forge and have the advantage of daily build and checked packages with
> > the possibility to install it directly from R-Forge:
> > |install.packages("/packagename/",repos="http://r-forge.r-project.org")|
>
> I guess I'm not really comfortable moving my code to an external
> repository completely out of my control.  It would be really
> convenient to be able to upload a source package, and have it built,
> with out R CMD check being enforced.

If you are comfortable with mirroring, I recently discovered the
svnsync tool (new in subversion 1.4). It will mirror a subversion
repository in its entirety (including commit history). It requires a
hook script to be present in the target repository (so needs
cooperation from the admin), but otherwise, once you set it up, a one
line cron job will synchronize it.

A quick description is available here:

http://code.google.com/support/bin/answer.py?answer=56682&topic=10386

and the subversion book has more detail.

-Deepayan


From h.wickham at gmail.com  Fri Apr  6 21:26:29 2007
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 6 Apr 2007 14:26:29 -0500
Subject: [Rd] R-Forge?
In-Reply-To: <3029D199-DE92-4B26-A380-9990EC782E1D@r-project.org>
References: <46162693.20809@bfro.uni-lj.si>
	<Pine.LNX.4.64.0704061541060.6584@eowyn>
	<f8e6ff050704060718g407b5a6gd562766ed6d941c0@mail.gmail.com>
	<46166086.8010802@ai.wu-wien.ac.at>
	<f8e6ff050704060922oee6cec1u92785ae4b8af2f98@mail.gmail.com>
	<3029D199-DE92-4B26-A380-9990EC782E1D@r-project.org>
Message-ID: <f8e6ff050704061226l3c1eb640tbafb0c6d4c40e72@mail.gmail.com>

On 4/6/07, Simon Urbanek <simon.urbanek at r-project.org> wrote:
>
> On Apr 6, 2007, at 12:22 PM, hadley wickham wrote:
>
> > On 4/6/07, Stefan Theussl <theussl at ai.wu-wien.ac.at> wrote:
> >> hadley wickham wrote:
> >>>>> I have recently found RForge.net (http://www.rforge.net/) by Simon
> >>>>> Urbanek and found out today that the site is accepting
> >>>>> subscriptions.
> >>>>> Great! However, browsing a bit on the site I found a link to
> >>>>> another
> >>>>> forge: R-Forge (http://r-forge.r-project.org/).
> >>>>>
> >>>>> Is/will the last one be the "offcial" forge for R packages,
> >>>>> given that
> >>>>> it has domain r-project.org?
> >>>>
> >>>> Yes, we're currently still testing the functionality and
> >>>> improving the
> >>>> documentation, but an article for R News that announces the
> >>>> functionality
> >>>> is under preparation. There is already a user's manual available
> >>>> on the
> >>>> main page which explains how you can register and set up your
> >>>> project
> >>>> etc.
> >>>> Just as Simon's site this already offers an SVN and nightly
> >>>> builds in a
> >>>> CRAN-style repository, and additionally there is the whole
> >>>> GForge system
> >>>> with other features such as project forums, mailing lists etc.
> >>>
> >>> Is it possible to use r-forge just for the nightly builds?   (ie.
> >>> with
> >>> svn hosted elsewhere)  That would be really handy.
> >>>
> >>> Hadley
> >> We have never thought about it, but this would be technically
> >> difficult.
> >>
> >> But you may migrate your svn (or the part which contains the
> >> package) to
> >> R-Forge and have the advantage of daily build and checked packages
> >> with
> >> the possibility to install it directly from R-Forge:
> >> |install.packages("/packagename/",repos="http://r-forge.r-
> >> project.org")|
> >
> > I guess I'm not really comfortable moving my code to an external
> > repository completely out of my control.  It would be really
> > convenient to be able to upload a source package, and have it built,
> > with out R CMD check being enforced.
> >
>
> I see the whole point of using external repository (like either
> rforge) in having fully-backed SVN repository on server-grade
> hardware. If you already have a SVN repository, why won't you use a
> post-commit script on the same machine to do the build and check?

The svn server is the easy bit - you can get that at any number of
hosts.  Cross-platform R builds are much trickier, and is the unique
thing that the r-forge sites offer.  If I could have some one else
deal with the package building for linux, mac and windows for test
packages I would be a very happy man.

Hadley


From cstrato at aon.at  Fri Apr  6 21:37:53 2007
From: cstrato at aon.at (cstrato)
Date: Fri, 06 Apr 2007 21:37:53 +0200
Subject: [Rd] Problem with S4 inheritance: unexpected re-initialization?
In-Reply-To: <46168B16.4090703@fhcrc.org>
References: <46112187.3090009@aon.at>
	<4612CCAB.1080809@fhcrc.org>	<4613BE1D.5000507@aon.at>
	<4613F186.1060507@fhcrc.org>	<46152B35.2070200@aon.at>
	<6phfy7dlw4p.fsf@gopher4.fhcrc.org> <46168B16.4090703@fhcrc.org>
Message-ID: <4616A191.2070109@aon.at>

Dear Herve

Although I am currently learning to use S4 classes, and thus I am 
probably not the person
to comment on S4 classes, I completely agree with you.

Coming from C++ (most of my code is C++), this is what I have 
intuitively expected,
although I was not able to formulate it. I am glad that you did.

At the moment I try to find out if there is a possibility to circumvent 
this problem.
I do not know if there is a possibility to set an object to NULL 
initially, and then
call: "if (!is.null(object)) do something"

Best regards
Christian



Herve Pages wrote:
> Martin,
>
> Martin Morgan wrote:
>   
>> The funny effect where class(object) seems to trigger construction of
>> a new object is lazy evaluation -- the 'object' argument to
>> setValidity is not evaluated until needed, i.e., until class(object)
>> (anything would trigger this, including force(object)); only then do
>> you see the attempt to create the new object of the previous
>> paragraph.
>>     
>
> The fact that you can't predict the number of times the "initialize"
> method will be called is problematic. Here is a simple example
> where "initialize-A" increments a global counter to keep track of the
> number of A-objects:
>
>   A.GLOBALS <- new.env(parent=emptyenv())
>   A.GLOBALS[["nobjs"]] <- 0L
>
>   setClass("A",
>     representation(a="character"),
>     prototype(a="a0")
>   )
>   setMethod("initialize", "A",
>     function(.Object, ...) {
>         cat("------initialize:A------\n")
>         A.GLOBALS[["nobjs"]] <- A.GLOBALS[["nobjs"]] + 1
>         cat("A-object #", A.GLOBALS[["nobjs"]], "\n", sep="")
>         callNextMethod()
>     }
>   )
>   setValidity("A",
>     function(object) {
>         cat("------setValidity:A------\n")
>         tmp <- class(object)
>         TRUE
>     }
>   )
>
>   setClass("B",
>     contains="A",
>     representation(b = "character")
>   )
>   setMethod("initialize", "B",
>     function(.Object, ...) {
>         cat("------initialize:B------\n")
>         callNextMethod()
>     }
>   )
>   setValidity("B",
>     function(object) {
>         cat("------setValidity:B------\n")
>         TRUE
>     }
>   )
>
> Let's try it:
>
>   > b1 <- new("B")
>   ------initialize:B------
>   ------initialize:A------
>   A-object #1
>   > A.GLOBALS[["nobjs"]]
>   [1] 1
>
>   > b1 <- new("B", b="hello")
>   ------initialize:B------
>   ------initialize:A------
>   A-object #2
>   ------setValidity:A------
>   ------initialize:A------
>   A-object #3
>   ------setValidity:B------
>   > A.GLOBALS[["nobjs"]]
>   [1] 3
>
> Shouldn't the "initializing" ("constructor" in other languages) code be executed
> exactly 1 time per object instanciation? Something that the programmer can simply
> rely on, whatever this code contains and whatever the internal subtilities of the
> programming lamguage are?
>
> Cheers,
> H.
>
>
>
>


From ligges at statistik.uni-dortmund.de  Fri Apr  6 21:44:34 2007
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Fri, 06 Apr 2007 21:44:34 +0200
Subject: [Rd] R-Forge?
In-Reply-To: <f8e6ff050704061226l3c1eb640tbafb0c6d4c40e72@mail.gmail.com>
References: <46162693.20809@bfro.uni-lj.si>	<Pine.LNX.4.64.0704061541060.6584@eowyn>	<f8e6ff050704060718g407b5a6gd562766ed6d941c0@mail.gmail.com>	<46166086.8010802@ai.wu-wien.ac.at>	<f8e6ff050704060922oee6cec1u92785ae4b8af2f98@mail.gmail.com>	<3029D199-DE92-4B26-A380-9990EC782E1D@r-project.org>
	<f8e6ff050704061226l3c1eb640tbafb0c6d4c40e72@mail.gmail.com>
Message-ID: <4616A322.8090708@statistik.uni-dortmund.de>



hadley wickham wrote:
> On 4/6/07, Simon Urbanek <simon.urbanek at r-project.org> wrote:
>> On Apr 6, 2007, at 12:22 PM, hadley wickham wrote:
>>
>>> On 4/6/07, Stefan Theussl <theussl at ai.wu-wien.ac.at> wrote:
>>>> hadley wickham wrote:
>>>>>>> I have recently found RForge.net (http://www.rforge.net/) by Simon
>>>>>>> Urbanek and found out today that the site is accepting
>>>>>>> subscriptions.
>>>>>>> Great! However, browsing a bit on the site I found a link to
>>>>>>> another
>>>>>>> forge: R-Forge (http://r-forge.r-project.org/).
>>>>>>>
>>>>>>> Is/will the last one be the "offcial" forge for R packages,
>>>>>>> given that
>>>>>>> it has domain r-project.org?
>>>>>> Yes, we're currently still testing the functionality and
>>>>>> improving the
>>>>>> documentation, but an article for R News that announces the
>>>>>> functionality
>>>>>> is under preparation. There is already a user's manual available
>>>>>> on the
>>>>>> main page which explains how you can register and set up your
>>>>>> project
>>>>>> etc.
>>>>>> Just as Simon's site this already offers an SVN and nightly
>>>>>> builds in a
>>>>>> CRAN-style repository, and additionally there is the whole
>>>>>> GForge system
>>>>>> with other features such as project forums, mailing lists etc.
>>>>> Is it possible to use r-forge just for the nightly builds?   (ie.
>>>>> with
>>>>> svn hosted elsewhere)  That would be really handy.
>>>>>
>>>>> Hadley
>>>> We have never thought about it, but this would be technically
>>>> difficult.
>>>>
>>>> But you may migrate your svn (or the part which contains the
>>>> package) to
>>>> R-Forge and have the advantage of daily build and checked packages
>>>> with
>>>> the possibility to install it directly from R-Forge:
>>>> |install.packages("/packagename/",repos="http://r-forge.r-
>>>> project.org")|
>>> I guess I'm not really comfortable moving my code to an external
>>> repository completely out of my control.  It would be really
>>> convenient to be able to upload a source package, and have it built,
>>> with out R CMD check being enforced.
>>>
>> I see the whole point of using external repository (like either
>> rforge) in having fully-backed SVN repository on server-grade
>> hardware. If you already have a SVN repository, why won't you use a
>> post-commit script on the same machine to do the build and check?
> 
> The svn server is the easy bit - you can get that at any number of
> hosts.  Cross-platform R builds are much trickier, and is the unique
> thing that the r-forge sites offer.  If I could have some one else
> deal with the package building for linux, mac and windows for test
> packages I would be a very happy man.


At least for Windows it is there:
http://129.217.207.166

Uwe Ligges



> Hadley
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From deepayan.sarkar at gmail.com  Fri Apr  6 22:27:50 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Fri, 6 Apr 2007 13:27:50 -0700
Subject: [Rd] corrections to R-exts
Message-ID: <eb555e660704061327g4004abd8wf645483e0a3e560b@mail.gmail.com>

Hi,

a couple of minor fixes to R-exts.texi:

In
@subsection Setting R callbacks
which describes Rinterface.h,

The @example block correctly has

extern int  (*ptr_R_ReadConsole)(char *, unsigned char *, int, int);
extern int  (*ptr_R_ShowFiles)(int, char **, char **, char *,
                               Rboolean, char *);

Just below that, these are described incorrectly as:

deftypefun int R_ReadConsole (char *@var{prompt}, char *@var{buf}, @
  int @var{buflen}, int @var{hist})

(missing 'unsigned')

@deftypefun void R_ShowFiles (int @var{nfile}, char **@var{file}, [...]

(return type 'void' instead of 'int')


Also, the paragraph on R_ReadConsole ends with:

"The return value is 0 on success and >0 on failure."

This is wrong.

-Deepayan


From deepayan.sarkar at gmail.com  Sat Apr  7 00:00:49 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Fri, 6 Apr 2007 15:00:49 -0700
Subject: [Rd] wishlist: additional argument in R_tryEval (Rinternals.h)
Message-ID: <eb555e660704061500o58da8b60ya109a17f239fb64c@mail.gmail.com>

Hi,

R_tryEval, exported in Rinternals.h but not part of the API, is
currently defined as:

R_tryEval(SEXP e, SEXP env, int *ErrorOccurred);

I'm trying to embed R in an application (basically yet another GUI),
and this has been very helpful to catch errors. It would be even more
helpful if it also gave access to the visibility flag. I can wrap this
in a call to withVisible, and that works great, but if there is an
error, traceback() contains a bunch of irrelevant levels.

It seems fairly easy to add another argument, similar to
ErrorOccurred, that is set to the visibility flag before returning. Is
this something that could be considered for addition in R-devel? A
possible patch for R/trunk is attached. Mac-GUI/REngine/REngine.m will
also need a patch, but I don't understand the language it's written
in.

-Deepayan
-------------- next part --------------
A non-text attachment was scrubbed...
Name: tryEval-patch.diff
Type: text/x-patch
Size: 5296 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20070406/e5e19008/attachment.bin 

From duncan at wald.ucdavis.edu  Sat Apr  7 00:31:17 2007
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Fri, 06 Apr 2007 15:31:17 -0700
Subject: [Rd] wishlist: additional argument in R_tryEval (Rinternals.h)
In-Reply-To: <eb555e660704061500o58da8b60ya109a17f239fb64c@mail.gmail.com>
References: <eb555e660704061500o58da8b60ya109a17f239fb64c@mail.gmail.com>
Message-ID: <4616CA35.7060802@wald.ucdavis.edu>


Hi Deepayan.

 It is not part of the API, but it is used in numerous packages
that would break if such a change were made.
It is an easy change to make, but not necessarily a robust approach
if we keep adding parameters. If we need the room to add more,
using a structure whose fields are modified within the R_tryEval()
would be more flexible for future evolutions.
But then again, that is creeping towards an object and that is
precisely what we need for the evaluator itself...... (More perhaps
in the future.)



 D.

Deepayan Sarkar wrote:
> Hi,
> 
> R_tryEval, exported in Rinternals.h but not part of the API, is
> currently defined as:
> 
> R_tryEval(SEXP e, SEXP env, int *ErrorOccurred);
> 
> I'm trying to embed R in an application (basically yet another GUI),
> and this has been very helpful to catch errors. It would be even more
> helpful if it also gave access to the visibility flag. I can wrap this
> in a call to withVisible, and that works great, but if there is an
> error, traceback() contains a bunch of irrelevant levels.
> 
> It seems fairly easy to add another argument, similar to
> ErrorOccurred, that is set to the visibility flag before returning. Is
> this something that could be considered for addition in R-devel? A
> possible patch for R/trunk is attached. Mac-GUI/REngine/REngine.m will
> also need a patch, but I don't understand the language it's written
> in.
> 
> -Deepayan
> 
> 
> ------------------------------------------------------------------------
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From luke at stat.uiowa.edu  Sat Apr  7 00:39:35 2007
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Fri, 6 Apr 2007 17:39:35 -0500 (CDT)
Subject: [Rd] wishlist: additional argument in R_tryEval (Rinternals.h)
In-Reply-To: <eb555e660704061500o58da8b60ya109a17f239fb64c@mail.gmail.com>
References: <eb555e660704061500o58da8b60ya109a17f239fb64c@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0704061726440.3661@itasca2.wildberry.org>

Even though it isn't officially part of the API it has seen some use
so I'd prefer not to change the interface; instead add

SEXP R_tryEvalWithVis(SEXP e, SEXP env, int *ErrorOccurred, int *visible);

or something along those lines and define R_tryEval internally in
terms of that.

It may be worth thinking a bit more though to see if there is
something else that might be useful at this point.  I vaguely recall
thinking recently about needing something else of this flavor but I
can't seem to remember what it was exactly -- will try to see if I can
recall.

Best,

luke


On Fri, 6 Apr 2007, Deepayan Sarkar wrote:

> Hi,
>
> R_tryEval, exported in Rinternals.h but not part of the API, is
> currently defined as:
>
> R_tryEval(SEXP e, SEXP env, int *ErrorOccurred);
>
> I'm trying to embed R in an application (basically yet another GUI),
> and this has been very helpful to catch errors. It would be even more
> helpful if it also gave access to the visibility flag. I can wrap this
> in a call to withVisible, and that works great, but if there is an
> error, traceback() contains a bunch of irrelevant levels.
>
> It seems fairly easy to add another argument, similar to
> ErrorOccurred, that is set to the visibility flag before returning. Is
> this something that could be considered for addition in R-devel? A
> possible patch for R/trunk is attached. Mac-GUI/REngine/REngine.m will
> also need a patch, but I don't understand the language it's written
> in.
>
> -Deepayan
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From byron.ellis at gmail.com  Sat Apr  7 01:23:07 2007
From: byron.ellis at gmail.com (Byron Ellis)
Date: Fri, 6 Apr 2007 16:23:07 -0700
Subject: [Rd] wishlist: additional argument in R_tryEval (Rinternals.h)
In-Reply-To: <Pine.LNX.4.64.0704061726440.3661@itasca2.wildberry.org>
References: <eb555e660704061500o58da8b60ya109a17f239fb64c@mail.gmail.com>
	<Pine.LNX.4.64.0704061726440.3661@itasca2.wildberry.org>
Message-ID: <7098abec0704061623h207e60c8v247aced20e24c416@mail.gmail.com>

It's come up for me when I do FFI stuff. For GUI stuff I usually just
want to suppress, but it's possible that you'd want to detect
visibility if you were to make the GUI more programmable. I usually
end up having to work around the whole business by fiddling with
R_Visible.

Speaking of R_tryEval, can someone with the appropriate powers PRETTY
PLEASE just make it an official API? Having it continue to be
unofficial is just getting silly.


On 4/6/07, Luke Tierney <luke at stat.uiowa.edu> wrote:
> Even though it isn't officially part of the API it has seen some use
> so I'd prefer not to change the interface; instead add
>
> SEXP R_tryEvalWithVis(SEXP e, SEXP env, int *ErrorOccurred, int *visible);
>
> or something along those lines and define R_tryEval internally in
> terms of that.
>
> It may be worth thinking a bit more though to see if there is
> something else that might be useful at this point.  I vaguely recall
> thinking recently about needing something else of this flavor but I
> can't seem to remember what it was exactly -- will try to see if I can
> recall.
>
> Best,
>
> luke
>
>
> On Fri, 6 Apr 2007, Deepayan Sarkar wrote:
>
> > Hi,
> >
> > R_tryEval, exported in Rinternals.h but not part of the API, is
> > currently defined as:
> >
> > R_tryEval(SEXP e, SEXP env, int *ErrorOccurred);
> >
> > I'm trying to embed R in an application (basically yet another GUI),
> > and this has been very helpful to catch errors. It would be even more
> > helpful if it also gave access to the visibility flag. I can wrap this
> > in a call to withVisible, and that works great, but if there is an
> > error, traceback() contains a bunch of irrelevant levels.
> >
> > It seems fairly easy to add another argument, similar to
> > ErrorOccurred, that is set to the visibility flag before returning. Is
> > this something that could be considered for addition in R-devel? A
> > possible patch for R/trunk is attached. Mac-GUI/REngine/REngine.m will
> > also need a patch, but I don't understand the language it's written
> > in.
> >
> > -Deepayan
> >
>
> --
> Luke Tierney
> Chair, Statistics and Actuarial Science
> Ralph E. Wareham Professor of Mathematical Sciences
> University of Iowa                  Phone:             319-335-3386
> Department of Statistics and        Fax:               319-335-3017
>     Actuarial Science
> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Byron Ellis (byron.ellis at gmail.com)
"Oook" -- The Librarian


From deepayan.sarkar at gmail.com  Sat Apr  7 02:54:29 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Fri, 6 Apr 2007 17:54:29 -0700
Subject: [Rd] wishlist: additional argument in R_tryEval (Rinternals.h)
In-Reply-To: <7098abec0704061623h207e60c8v247aced20e24c416@mail.gmail.com>
References: <eb555e660704061500o58da8b60ya109a17f239fb64c@mail.gmail.com>
	<Pine.LNX.4.64.0704061726440.3661@itasca2.wildberry.org>
	<7098abec0704061623h207e60c8v247aced20e24c416@mail.gmail.com>
Message-ID: <eb555e660704061754y3f53231dn461a4f33755fe0c8@mail.gmail.com>

On 4/6/07, Byron Ellis <byron.ellis at gmail.com> wrote:
> It's come up for me when I do FFI stuff. For GUI stuff I usually just
> want to suppress, but it's possible that you'd want to detect
> visibility if you were to make the GUI more programmable. I usually
> end up having to work around the whole business by fiddling with
> R_Visible.

My GUI is basically a wrapper around R (it's an exercise in teaching
myself Qt), so replicating console functionality is a major goal. R is
embedded and not the main thread, mostly because I didn't read R-exts
carefully enough before starting. But most things have gone fairly
smoothly, and I want to see how far I can go.

> Speaking of R_tryEval, can someone with the appropriate powers PRETTY
> PLEASE just make it an official API? Having it continue to be
> unofficial is just getting silly.
>
>
> On 4/6/07, Luke Tierney <luke at stat.uiowa.edu> wrote:
> > Even though it isn't officially part of the API it has seen some use
> > so I'd prefer not to change the interface; instead add
> >
> > SEXP R_tryEvalWithVis(SEXP e, SEXP env, int *ErrorOccurred, int *visible);
> >
> > or something along those lines and define R_tryEval internally in
> > terms of that.
> >
> > It may be worth thinking a bit more though to see if there is
> > something else that might be useful at this point.  I vaguely recall
> > thinking recently about needing something else of this flavor but I
> > can't seem to remember what it was exactly -- will try to see if I can
> > recall.

OK, I'll stick with withVisible for now, and wait for something like
R_tryEvalWithVis.

-Deepayan


From Kurt.Hornik at wu-wien.ac.at  Sat Apr  7 09:00:05 2007
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Sat, 7 Apr 2007 09:00:05 +0200
Subject: [Rd] CRAN's src/contrib/Devel area
Message-ID: <17943.16757.258926.11867@mithrandir.hornik.net>

Dear R developers,

With the release of R 2.5.0 on 2007-04-24 CRAN will remove its 'Devel'
subdirectory (originally intended to distribute "development" versions
of packages, but now apparently no longer needed and/or used).

Packages in the 'Devel' are which do not pass R CMD check without
warnings or errors will be moved to the Archive.  In two cases, the
current maintainers have indicated that this is the preferred approach,
with one package scheduled for resurrection eventually.

In two cases, we have not received feedback from the maintainers as
listed in the package DESCRIPTION metadata:

  gllm: David Duffy <davidD at qimr.edu.au>
  runStat: David Brahm <brahm at alum.mit.edu>

If anyone knows how to contact the maintainers, pls let us know.

The maintainer of 'ensemble' has suggested to look for a new maintainer.

In case you are interested in taking over maintaining one of

  ensemble gllm runStat

pls let us know.

Best
-k


From ripley at stats.ox.ac.uk  Sat Apr  7 09:52:59 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 7 Apr 2007 08:52:59 +0100 (BST)
Subject: [Rd] getConnection is not found in R depending on the Linux
 flavour (RedHat or Debian) - dyn.load problems
In-Reply-To: <46164673.8000008@biomserv.univ-lyon1.fr>
References: <46164673.8000008@biomserv.univ-lyon1.fr>
Message-ID: <Pine.LNX.4.64.0704061525580.17180@gannet.stats.ox.ac.uk>

getConnection is not part of the API, so it is not intended to be visible 
to your code.  The code reads

/* internal, not the same as R function getConnection */
attribute_hidden
Rconnection getConnection(int n)

and 'internal' and 'attribute_hidden' should have been enough of a clue! 
On many OSes it is noticeably more efficient not to export unneeded entry 
points from DLLs, so we do not do so where the OS supplies (simple) 
facilities to do so.

There are severe warnings in 'Writing R Extensions' about making use of 
entry points not in the API.

There are medium-term plans to change the internal structure of 
connections to make use of features not in R when they were designed (weak 
references and finalizers), so this will definitely remain non-API.

On Fri, 6 Apr 2007, Simon Penel wrote:

>
> Hello R developers,
>
> I am working on the "seqinr" package and I encounter a tricky problem 
> using a C function.
>
> We defined a C fonction called   "getzlibsock" which is dedicated to
> compressed
> socket connections. This function is using the R internal  C function
> called "getConnection(int)" in order to get information about the socket
> previously opened with the dedicated R functions.
>
> The program works fine on several platform:
> -Unix (SunOS),
> -MacOS and
> -Linux (some).
> However, on Linux, an error occurs  depending on the installation.

[...]


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Sat Apr  7 11:34:02 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Sat,  7 Apr 2007 11:34:02 +0200 (CEST)
Subject: [Rd] bquote(function(x,y) T) (PR#9602)
Message-ID: <20070407093402.9F7A65DEBD@slim.kubism.ku.dk>

This is already different in 2.5.0 alpha.

It is not clear what the bug was supposed to be, but if it was in bquote() 
it was already fixed.


On Fri, 6 Apr 2007, felix at nfrac.org wrote:

>> quote(function(x, y) T)
> function(x, y) T
>
>> bquote(function(x, y) T)
> function(, y) T
>
>> eval(.Last.value)
> Error in eval(expr, envir, enclos) : invalid formal argument list for "function"
>
>> R.version
>               _
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status
> major          2
> minor          4.1
> year           2006
> month          12
> day            18
> svn rev        40228
> language       R
> version.string R version 2.4.1 (2006-12-18)
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sbernard at infobiogen.fr  Sat Apr  7 12:28:47 2007
From: sbernard at infobiogen.fr (Simon de Bernard)
Date: Sat, 7 Apr 2007 12:28:47 +0200
Subject: [Rd] segmentation fault
Message-ID: <68CA8B53-9FCB-4A84-A035-1E8AB59B8039@infobiogen.fr>

Dear list,

I am having a segfault while working with large lists in R 2.4.1  
patched (64-bit compilation) on an apple xserve xeon with 16GB RAM (I  
don't know if this is reproducible on other configs since this is the  
only computer with enough memory I have access to...)

You will find below a simple somewhat reproducible (usually it  
crashes around 5.5GB of vsize, sometimes it gets into an infinite  
loop) exemple and the relevant sessionInfo.

Is this a "normal" limitation of R, a problem with my config or a  
*cough* bug ?

best regards,

Simon.

 > l<-list(1)
 > while(1) { print(object.size(l)/1024/1024); l<-c(l,l,l) }
[1] 9.155273e-05
[1] 0.0002059937
[1] 0.0005722046
[1] 0.001480103
[1] 0.004364014
[1] 0.01301575
[1] 0.03897095
[1] 0.1168365
[1] 0.3504333
[1] 1.051224
[1] 3.153595
[1] 9.460709
[1] 28.38205
[1] 85.14607
[1] 255.4381
[1] 766.3143
[1] 2298.943

*** caught segfault ***
address 0x21000011, cause 'memory not mapped'

 > sessionInfo()
R version 2.4.1 Patched (2007-03-31 r41078)
x86_64-apple-darwin8.9.1

locale:
C

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"   
"methods"
[7] "base"


From rpeng at jhsph.edu  Sat Apr  7 13:56:40 2007
From: rpeng at jhsph.edu (Roger Peng)
Date: Sat, 07 Apr 2007 07:56:40 -0400
Subject: [Rd] bug in Stangle(split=TRUE)
Message-ID: <461786F8.9040105@jhsph.edu>

[I originally emailed this to Friedrich Leisch but got no response and I 
just wanted to make sure it made it in before release.]

While working with Stangle(), I noticed a problem when using 'split = 
TRUE'.  Particularly, when there are two chunks where one chunk's name 
is a prefix of another chunk's name, then the two chunks will be written 
to a single file rather than two separate files (if the chunk who's name 
is a prefix comes after the other chunk).  Running 'Stangle(split=TRUE)' 
with the attached 'test1.Rnw' file should reproduce the problem.

I think it boils down to a partial matching problem in 'RtangleRuncode'. 
  I've attached a patch against R-alpha (r41020) which I think fixes 
this problem but I'm not sure it's necessarily the best approach (there 
are other instances of this construction in the code).

-roger
-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: sweave.patch
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070407/ba6232d3/attachment.pl 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: test1.Rnw
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070407/ba6232d3/attachment-0001.pl 

From chatfield at clio.arc.nasa.gov  Sat Apr  7 01:59:02 2007
From: chatfield at clio.arc.nasa.gov (chatfield at clio.arc.nasa.gov)
Date: Sat,  7 Apr 2007 01:59:02 +0200 (CEST)
Subject: [Rd] Orphaned ncvar? (PR#9603)
Message-ID: <20070406235902.07C105DEA8@slim.kubism.ku.dk>

>
An orphaned package?  anyone in Switzerland know if there's an  
alternative?
Note the email.
I guess CRAN-R should be notified.

regards, Bob C

> The original message was received at Fri, 6 Apr 2007 16:32:57 -0700
> from vayu.arc.nasa.gov [143.232.122.22]
>
>    ----- The following addresses had permanent fatal errors -----
> <juerg.schmidli at env.ethz.ch>
>     (reason: 550-Callout verification failed:)
>
>    ----- Transcript of session follows -----
> ... while talking to phil1.ethz.ch.:
>
>>>> DATA
>>>>
> <<< 550-Callout verification failed:
> <<< 550 550 5.1.1 User unknown
> 550 5.1.1 <juerg.schmidli at env.ethz.ch>... User unknown
> <<< 503 valid RCPT command must precede DATA
> Reporting-MTA: dns; pagent2.arc.nasa.gov
> Received-From-MTA: DNS; vayu.arc.nasa.gov
> Arrival-Date: Fri, 6 Apr 2007 16:32:57 -0700
>
> Final-Recipient: RFC822; juerg.schmidli at env.ethz.ch
> Action: failed
> Status: 5.1.1
> Remote-MTA: DNS; phil1.ethz.ch
> Diagnostic-Code: SMTP; 550-Callout verification failed:
> Last-Attempt-Date: Fri, 6 Apr 2007 16:33:08 -0700


> Could you help? The notes are just too telegraphic.
>
> I keep getting missing packages  or missing main in netdcdf messages
> in my attempts to install.
>
> Macintosh OS X (10.4)  this happens to be old-chip PowerPC ...  
> other install will be new-chip Intel
>
>
> * binaries are listed on all the R mirrors, but they uniformly fail  
> to work
>
> * I've tried to build these from source, but need netcdf.
>
> I see this ---
>
> Note
> The NetCDF and the udunits library must be already installed on the  
> system.
> Author(s)
> Pavel Michna
>
> but the installs don't work ...at configure stage.
>
> I have downloaded netcdf using the fink package manner (debian- 
> linux like)
> which creates files in
> /sw/lib
> and
> /sw/include
>
> but have not been able to get these recognized by R at compile time,
> even after using .libPaths("/sw/include")  for the new library and  
> confirming
> it with .libPaths()
>
> Either they are missing the library or cannot find "main" or  
> something.
>
> If we are to build these ourselves, it would be great to find out  
> just how
> to get libraries recognized in the documentation, ... or for there  
> to be binaries.
>
> If you have notes within the .tgz files, I have not found those.
>
> Please, help ! ;-)
> regards, Bob C
>
> 	
>
>
> Dr. Robert Chatfield
> Earth Sciences, MS 245-5
> NASA Ames Research Center
> Moffett Field, CA 94035    USA
>
> Ph: 650-604-5490  FAX 650-604-3625
>
> http://geo.arc.nasa.gov/sgg/chatfield
>

	[[alternative HTML version deleted]]


From theussl at ai.wu-wien.ac.at  Fri Apr  6 15:50:23 2007
From: theussl at ai.wu-wien.ac.at (Stefan Theussl)
Date: Fri, 06 Apr 2007 15:50:23 +0200
Subject: [Rd] R-Forge
Message-ID: <4616501F.5020409@ai.wu-wien.ac.at>

Hello Gregor,

Yes, R-Forge.R-project.org will be the official forge for the R 
Community.  But we have to fix a few things before we are going public. 
If you like you can participate and help us testing. If you have a 
package or a devel version of your package you're welcome to use SVN 
provided by R-Forge.
For further questions please contact me or R-Forge at R-project.org.

Regards,
Stefan

-------------- next part --------------
An embedded message was scrubbed...
From: Kurt Hornik <Kurt.Hornik at wu-wien.ac.at>
Subject: forwarded message from Gregor Gorjanc
Date: Fri, 6 Apr 2007 14:38:40 +0200
Size: 6900
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070406/e3f2335e/attachment.mht 

From theussl at ai.wu-wien.ac.at  Fri Apr  6 17:00:22 2007
From: theussl at ai.wu-wien.ac.at (Stefan Theussl)
Date: Fri, 06 Apr 2007 17:00:22 +0200
Subject: [Rd] R-Forge?
In-Reply-To: <f8e6ff050704060718g407b5a6gd562766ed6d941c0@mail.gmail.com>
References: <46162693.20809@bfro.uni-lj.si>	
	<Pine.LNX.4.64.0704061541060.6584@eowyn>
	<f8e6ff050704060718g407b5a6gd562766ed6d941c0@mail.gmail.com>
Message-ID: <46166086.8010802@ai.wu-wien.ac.at>

hadley wickham wrote:
>> > I have recently found RForge.net (http://www.rforge.net/) by Simon
>> > Urbanek and found out today that the site is accepting subscriptions.
>> > Great! However, browsing a bit on the site I found a link to another
>> > forge: R-Forge (http://r-forge.r-project.org/).
>> >
>> > Is/will the last one be the "offcial" forge for R packages, given that
>> > it has domain r-project.org?
>>
>> Yes, we're currently still testing the functionality and improving the
>> documentation, but an article for R News that announces the 
>> functionality
>> is under preparation. There is already a user's manual available on the
>> main page which explains how you can register and set up your project 
>> etc.
>> Just as Simon's site this already offers an SVN and nightly builds in a
>> CRAN-style repository, and additionally there is the whole GForge system
>> with other features such as project forums, mailing lists etc.
>
> Is it possible to use r-forge just for the nightly builds?   (ie. with
> svn hosted elsewhere)  That would be really handy.
>
> Hadley
We have never thought about it, but this would be technically difficult.

But you may migrate your svn (or the part which contains the package) to 
R-Forge and have the advantage of daily build and checked packages with 
the possibility to install it directly from R-Forge:
|install.packages("/packagename/",repos="http://r-forge.r-project.org")|

Best,
Stefan


From v.moreno at ico.scs.es  Fri Apr  6 01:55:20 2007
From: v.moreno at ico.scs.es (v.moreno at ico.scs.es)
Date: Fri,  6 Apr 2007 01:55:20 +0200 (CEST)
Subject: [Rd] data.frame backwards compatibility (PR#9601)
Message-ID: <20070405235520.D53755DE9D@slim.kubism.ku.dk>

Full_Name: Victor Moreno
Version: R2.5.0
OS: windows
Submission from: (NULL) (68.40.63.169)


This may not be a bug, but seems not yet documented. Some data.frames created
with development version 2.5.0, when read in 2.4.1, show error:

Error in dim.data.frame(chip23) : negative length vectors are not allowed

A dump of the data.frame shows as last code:

, row.names = as.integer(c(NA, -7269)), class = "data.frame") 

This seems related to the new feature of data.frames without rownames.


From thomas.friedrichsmeier at ruhr-uni-bochum.de  Sat Apr  7 15:07:35 2007
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: Sat, 7 Apr 2007 15:07:35 +0200
Subject: [Rd] wishlist: additional argument in R_tryEval (Rinternals.h)
In-Reply-To: <Pine.LNX.4.64.0704061726440.3661@itasca2.wildberry.org>
References: <eb555e660704061500o58da8b60ya109a17f239fb64c@mail.gmail.com>
	<Pine.LNX.4.64.0704061726440.3661@itasca2.wildberry.org>
Message-ID: <200704071507.40116.thomas.friedrichsmeier@ruhr-uni-bochum.de>

On Saturday 07 April 2007 00:39, Luke Tierney wrote:
> Even though it isn't officially part of the API it has seen some use
> so I'd prefer not to change the interface; instead add
>
> SEXP R_tryEvalWithVis(SEXP e, SEXP env, int *ErrorOccurred, int *visible);
>
> or something along those lines and define R_tryEval internally in
> terms of that.

Note that R_ToplevelExec() is available in Rinternals.h (IIRC since 2.4.0), so 
it's no longer really necessary to add more R_trySomething() functions. 
Embedding applications can simply roll their own safe wrappers around those C 
functions that they need.

An R_evalWithVis() in the C headers would be very helpful, indeed, though.

> It may be worth thinking a bit more though to see if there is
> something else that might be useful at this point.  I vaguely recall
> thinking recently about needing something else of this flavor but I
> can't seem to remember what it was exactly -- will try to see if I can
> recall.

Perhaps access to parse (syntax) errors? For me it's the one other thing that 
is missing most dearly while trying to write a frontend.

See also wishes #9466 and #9467 (but I'm starting to sound like an old broken 
record in mentioning these two over and over again, so I'll better shut up, 
now).

Regards
Thomas
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20070407/86568a8a/attachment.bin 

From hb at stat.berkeley.edu  Sat Apr  7 18:35:14 2007
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sat, 7 Apr 2007 09:35:14 -0700
Subject: [Rd] R CMD install on R 2.5.0 alpha
Message-ID: <59d7961d0704070935k422e8679i8334c97c37fd8bad@mail.gmail.com>

Hi,

I've just downloaded the latest R v2.5.0 alpha (2007-04-04 r41043) for
WinXP.  When I try to
install a package R tries to install it to a no-name (empty name)
directory (causing error downstream):

RCMD INSTALL R.oo
installing to ''

FYI: Package install perfectly on R v2.4.1 patched, and did so also on
earlier R v2.5.0 devel/alpha(?) versions.

Current directory is:
C:\tmp

with subdirectory R.oo/ containing inst/ man/ R/ DESCRIPTION as usual.

I noticed the following in CHANGES and NEWS related to R CMD INSTALL:

 o	R CMD INSTALL now installs by default into the first library on
	the library path if R was run in the current environment.
	Similarly, R CMD REMOVE by default removes from that library.
	R CMD INSTALL does a better job of removing its temporary
	directory.

 o	R CMD INSTALL and R CMD REMOVE now use as the default library
	(if -l is not specified) the first library that would be used
	if R were run in the current environment (and they run R to
	find it).

    o	R CMD INSTALL now prepends the installation directory (if
	specified) to the library search path.

But my I do have:

> .libPaths()
[1] "C:/PROGRA~1/R/R-2.5.0alpha/library"

My setup:
echo %RHOME%:
C:\PROGRA~1\R\R-2.5.0alpha
> .libPaths()
[1] "C:/PROGRA~1/R/R-2.5.0alpha/library"
> sessionInfo()
R version 2.5.0 alpha (2007-04-04 r41043)
i386-pc-mingw32
locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MON
ETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
[7] "base"


Any help appreciated

Henrik


From hb at stat.berkeley.edu  Sat Apr  7 18:41:27 2007
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sat, 7 Apr 2007 09:41:27 -0700
Subject: [Rd] R-Forge
In-Reply-To: <4616501F.5020409@ai.wu-wien.ac.at>
References: <4616501F.5020409@ai.wu-wien.ac.at>
Message-ID: <59d7961d0704070941yca65a46kaacfa46a89f033fa@mail.gmail.com>

Hi,

thanks for working on this and offering us this service.  One thing I
wonder is about backup.  What kind of backup do you use or plan to
use?

Best,

Henrik

On 4/6/07, Stefan Theussl <theussl at ai.wu-wien.ac.at> wrote:
> Hello Gregor,
>
> Yes, R-Forge.R-project.org will be the official forge for the R
> Community.  But we have to fix a few things before we are going public.
> If you like you can participate and help us testing. If you have a
> package or a devel version of your package you're welcome to use SVN
> provided by R-Forge.
> For further questions please contact me or R-Forge at R-project.org.
>
> Regards,
> Stefan
>
>
>
> ---------- Forwarded message ----------
> From: Kurt Hornik <Kurt.Hornik at wu-wien.ac.at>
> To: Stefan Theussl <stefan.theussl at wu-wien.ac.at>
> Date: Fri, 6 Apr 2007 14:38:40 +0200
> Subject: forwarded message from Gregor Gorjanc
>
>
> ---------- Forwarded message ----------
> From: Gregor Gorjanc <gregor.gorjanc at bfro.uni-lj.si>
> To: r-devel at r-project.org
> Date: Fri, 06 Apr 2007 12:53:07 +0200
> Subject: [Rd] R-Forge?
> Hello!
>
> I have recently found RForge.net (http://www.rforge.net/) by Simon
> Urbanek and found out today that the site is accepting subscriptions.
> Great! However, browsing a bit on the site I found a link to another
> forge: R-Forge (http://r-forge.r-project.org/).
>
> Is/will the last one be the "offcial" forge for R packages, given that
> it has domain r-project.org?
>
> Regards, Gregor
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From luke at stat.uiowa.edu  Sat Apr  7 18:58:20 2007
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Sat, 7 Apr 2007 11:58:20 -0500 (CDT)
Subject: [Rd] segmentation fault
In-Reply-To: <68CA8B53-9FCB-4A84-A035-1E8AB59B8039@infobiogen.fr>
References: <68CA8B53-9FCB-4A84-A035-1E8AB59B8039@infobiogen.fr>
Message-ID: <Pine.LNX.4.64.0704071137290.2918@itasca2.wildberry.org>

I can't reproduce the crash on a 16Gb x86_64 linux machine. It gets
over 16G of use and so into paging and seems to be making slow
progress but I killed it at that point to avoid hogging the machine.

This example will allocate large generic vectors and then allocate
lots of copies of 1 to fill it in. Can you reproduce the problem with
something of coarser granularity, e.g. pasting together vectors of
1000000 doubles?  Otherwise, maybe info from running under gdb might
help.

Best,

luke

On Sat, 7 Apr 2007, Simon de Bernard wrote:

> Dear list,
>
> I am having a segfault while working with large lists in R 2.4.1
> patched (64-bit compilation) on an apple xserve xeon with 16GB RAM (I
> don't know if this is reproducible on other configs since this is the
> only computer with enough memory I have access to...)
>
> You will find below a simple somewhat reproducible (usually it
> crashes around 5.5GB of vsize, sometimes it gets into an infinite
> loop) exemple and the relevant sessionInfo.
>
> Is this a "normal" limitation of R, a problem with my config or a
> *cough* bug ?
>
> best regards,
>
> Simon.
>
> > l<-list(1)
> > while(1) { print(object.size(l)/1024/1024); l<-c(l,l,l) }
> [1] 9.155273e-05
> [1] 0.0002059937
> [1] 0.0005722046
> [1] 0.001480103
> [1] 0.004364014
> [1] 0.01301575
> [1] 0.03897095
> [1] 0.1168365
> [1] 0.3504333
> [1] 1.051224
> [1] 3.153595
> [1] 9.460709
> [1] 28.38205
> [1] 85.14607
> [1] 255.4381
> [1] 766.3143
> [1] 2298.943
>
> *** caught segfault ***
> address 0x21000011, cause 'memory not mapped'
>
> > sessionInfo()
> R version 2.4.1 Patched (2007-03-31 r41078)
> x86_64-apple-darwin8.9.1
>
> locale:
> C
>
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"
> "methods"
> [7] "base"
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From maechler at stat.math.ethz.ch  Sat Apr  7 19:29:25 2007
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 7 Apr 2007 19:29:25 +0200
Subject: [Rd] issue with pdf(paper="a4") in 2.5.0 alpha
In-Reply-To: <40964D91251A18469CB08B6E96FB30BA01BA411E@mailc.lumcnet.prod.intern>
References: <40964D91251A18469CB08B6E96FB30BA01BA411E@mailc.lumcnet.prod.intern>
Message-ID: <17943.54517.586849.671069@stat.math.ethz.ch>

Thank you, Jan, for the report.

There was bug and that has been fixed in the mean time (not by me).
We (the development team) are very glad for everyone who uses R
2.5.0 alpha (soon "beta") and tells about any strange /
incompatible behavior {well, after having read 'NEWS'}.

Martin

>>>>> "JanO" ==   <J.Oosting at lumc.nl>
>>>>>     on Thu, 5 Apr 2007 12:53:33 +0200 writes:

    JanO> In the latest windows binary (2007-04-03 r41023) pdf()
    JanO> with an argument paper="a4" gives an error, this was
    JanO> still ok in (2007-03-18 r40854) Jan Oosting
 
    >> pdf("test.pdf",paper="a4")

    JanO> Error in pdf("test.pdf", paper = "a4") : invalid paper type 'a4' (pdf)

    >> sessionInfo()
    JanO> R version 2.5.0 alpha (2007-04-03 r41023)
    JanO> i386-pc-mingw32 locale:
    JanO> LC_COLLATE=Dutch_Netherlands.1252;LC_CTYPE=Dutch_Netherlands.1252;LC_MONETARY=Dutch_Netherlands.1252;LC_NUMERIC=C;LC_TIME=Dutch_Netherlands.1252
    JanO> attached base packages: [1] "stats" "graphics"
    JanO> "grDevices" "utils" "datasets" "methods" [7] "base"
    >>

 

 



    JanO> 	[[alternative HTML version deleted]]

    JanO> ______________________________________________
    JanO> R-devel at r-project.org mailing list
    JanO> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Sat Apr  7 19:33:08 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 7 Apr 2007 18:33:08 +0100 (BST)
Subject: [Rd] R CMD install on R 2.5.0 alpha
In-Reply-To: <59d7961d0704070935k422e8679i8334c97c37fd8bad@mail.gmail.com>
References: <59d7961d0704070935k422e8679i8334c97c37fd8bad@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0704071811190.14499@gannet.stats.ox.ac.uk>

Nothing has changed here for three months, AFAICS.  However, I noticed you 
have installed R into a directory with a space in the path, despite the 
advice not to.  OTOH, I have just tested installing where you did, and
was able to install R.oo:

[c:/Program Files/R/R-2.5.0alpha/bin]% ./Rcmd INSTALL d:/R/packages/contrib/R.oo_1.2.3.tar.gz
installing to 'c:/PROGRA~1/R/R-25~1.0AL/library'
...

On Windows, INSTALL is a Perl script.  Please debug it to see what is 
going wrong on your setup (it is working for many others).

You can of course specify -l to workaround this.

On Sat, 7 Apr 2007, Henrik Bengtsson wrote:

> Hi,
>
> I've just downloaded the latest R v2.5.0 alpha (2007-04-04 r41043) for

That is not the latest binary build I am offered, let alone the latest 
sources.

> WinXP.  When I try to
> install a package R tries to install it to a no-name (empty name)
> directory (causing error downstream):
>
> RCMD INSTALL R.oo
> installing to ''
>
> FYI: Package install perfectly on R v2.4.1 patched, and did so also on
> earlier R v2.5.0 devel/alpha(?) versions.
>
> Current directory is:
> C:\tmp
>
> with subdirectory R.oo/ containing inst/ man/ R/ DESCRIPTION as usual.
>
> I noticed the following in CHANGES and NEWS related to R CMD INSTALL:
>
> o	R CMD INSTALL now installs by default into the first library on
> 	the library path if R was run in the current environment.
> 	Similarly, R CMD REMOVE by default removes from that library.
> 	R CMD INSTALL does a better job of removing its temporary
> 	directory.
>
> o	R CMD INSTALL and R CMD REMOVE now use as the default library
> 	(if -l is not specified) the first library that would be used
> 	if R were run in the current environment (and they run R to
> 	find it).
>
>    o	R CMD INSTALL now prepends the installation directory (if
> 	specified) to the library search path.
>
> But my I do have:
>
>> .libPaths()
> [1] "C:/PROGRA~1/R/R-2.5.0alpha/library"
>
> My setup:
> echo %RHOME%:
> C:\PROGRA~1\R\R-2.5.0alpha
>> .libPaths()
> [1] "C:/PROGRA~1/R/R-2.5.0alpha/library"
>> sessionInfo()
> R version 2.5.0 alpha (2007-04-04 r41043)
> i386-pc-mingw32
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MON
> ETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
> [7] "base"
>
>
> Any help appreciated
>
> Henrik
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at stat.berkeley.edu  Sat Apr  7 19:57:19 2007
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sat, 7 Apr 2007 10:57:19 -0700
Subject: [Rd] R CMD install on R 2.5.0 alpha
In-Reply-To: <Pine.LNX.4.64.0704071811190.14499@gannet.stats.ox.ac.uk>
References: <59d7961d0704070935k422e8679i8334c97c37fd8bad@mail.gmail.com>
	<Pine.LNX.4.64.0704071811190.14499@gannet.stats.ox.ac.uk>
Message-ID: <59d7961d0704071057xea3ce3aq98abfab1d09b8780@mail.gmail.com>

Hi.

On 4/7/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> Nothing has changed here for three months, AFAICS.  However, I noticed you
> have installed R into a directory with a space in the path, despite the
> advice not to.  OTOH, I have just tested installing where you did, and
> was able to install R.oo:
>
> [c:/Program Files/R/R-2.5.0alpha/bin]% ./Rcmd INSTALL d:/R/packages/contrib/R.oo_1.2.3.tar.gz
> installing to 'c:/PROGRA~1/R/R-25~1.0AL/library'
> ...

Thank you for this confirmation.  It is odd though, because so have
also I done successfully for years.

>
> On Windows, INSTALL is a Perl script.  Please debug it to see what is
> going wrong on your setup (it is working for many others).

I will debug INSTALL to see what might go wrong.  I'll see if I can
locate an earlier version of R 2.5.0 alpha to see if the error really
is there or not.

>
> You can of course specify -l to workaround this.
>
> On Sat, 7 Apr 2007, Henrik Bengtsson wrote:
>
> > Hi,
> >
> > I've just downloaded the latest R v2.5.0 alpha (2007-04-04 r41043) for
>
> That is not the latest binary build I am offered, let alone the latest
> sources.

Got it from the UC Davis CRAN mirror about an one hour before my message.

Thanks

Henrik

>
> > WinXP.  When I try to
> > install a package R tries to install it to a no-name (empty name)
> > directory (causing error downstream):
> >
> > RCMD INSTALL R.oo
> > installing to ''
> >
> > FYI: Package install perfectly on R v2.4.1 patched, and did so also on
> > earlier R v2.5.0 devel/alpha(?) versions.
> >
> > Current directory is:
> > C:\tmp
> >
> > with subdirectory R.oo/ containing inst/ man/ R/ DESCRIPTION as usual.
> >
> > I noticed the following in CHANGES and NEWS related to R CMD INSTALL:
> >
> > o     R CMD INSTALL now installs by default into the first library on
> >       the library path if R was run in the current environment.
> >       Similarly, R CMD REMOVE by default removes from that library.
> >       R CMD INSTALL does a better job of removing its temporary
> >       directory.
> >
> > o     R CMD INSTALL and R CMD REMOVE now use as the default library
> >       (if -l is not specified) the first library that would be used
> >       if R were run in the current environment (and they run R to
> >       find it).
> >
> >    o  R CMD INSTALL now prepends the installation directory (if
> >       specified) to the library search path.
> >
> > But my I do have:
> >
> >> .libPaths()
> > [1] "C:/PROGRA~1/R/R-2.5.0alpha/library"
> >
> > My setup:
> > echo %RHOME%:
> > C:\PROGRA~1\R\R-2.5.0alpha
> >> .libPaths()
> > [1] "C:/PROGRA~1/R/R-2.5.0alpha/library"
> >> sessionInfo()
> > R version 2.5.0 alpha (2007-04-04 r41043)
> > i386-pc-mingw32
> > locale:
> > LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MON
> > ETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> > attached base packages:
> > [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
> > [7] "base"
> >
> >
> > Any help appreciated
> >
> > Henrik
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


From ripley at stats.ox.ac.uk  Sat Apr  7 20:01:52 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 7 Apr 2007 19:01:52 +0100 (BST)
Subject: [Rd] R CMD install on R 2.5.0 alpha
In-Reply-To: <59d7961d0704071057xea3ce3aq98abfab1d09b8780@mail.gmail.com>
References: <59d7961d0704070935k422e8679i8334c97c37fd8bad@mail.gmail.com> 
	<Pine.LNX.4.64.0704071811190.14499@gannet.stats.ox.ac.uk>
	<59d7961d0704071057xea3ce3aq98abfab1d09b8780@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0704071857570.15722@gannet.stats.ox.ac.uk>

On Sat, 7 Apr 2007, Henrik Bengtsson wrote:

> Hi.
>
> On 4/7/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>> Nothing has changed here for three months, AFAICS.  However, I noticed you
>> have installed R into a directory with a space in the path, despite the
>> advice not to.  OTOH, I have just tested installing where you did, and
>> was able to install R.oo:
>> 
>> [c:/Program Files/R/R-2.5.0alpha/bin]% ./Rcmd INSTALL 
>> d:/R/packages/contrib/R.oo_1.2.3.tar.gz
>> installing to 'c:/PROGRA~1/R/R-25~1.0AL/library'
>> ...
>
> Thank you for this confirmation.  It is odd though, because so have
> also I done successfully for years.
>
>> 
>> On Windows, INSTALL is a Perl script.  Please debug it to see what is
>> going wrong on your setup (it is working for many others).
>
> I will debug INSTALL to see what might go wrong.  I'll see if I can
> locate an earlier version of R 2.5.0 alpha to see if the error really
> is there or not.
>
>> 
>> You can of course specify -l to workaround this.
>> 
>> On Sat, 7 Apr 2007, Henrik Bengtsson wrote:
>> 
>> > Hi,
>> >
>> > I've just downloaded the latest R v2.5.0 alpha (2007-04-04 r41043) for
>> 
>> That is not the latest binary build I am offered, let alone the latest
>> sources.
>
> Got it from the UC Davis CRAN mirror about an one hour before my message.

There is not much point in getting alpha/betas from mirrors: they can 
introduce another 24-hour delay.

>
> Thanks
>
> Henrik
>
>> 
>> > WinXP.  When I try to
>> > install a package R tries to install it to a no-name (empty name)
>> > directory (causing error downstream):
>> >
>> > RCMD INSTALL R.oo
>> > installing to ''
>> >
>> > FYI: Package install perfectly on R v2.4.1 patched, and did so also on
>> > earlier R v2.5.0 devel/alpha(?) versions.
>> >
>> > Current directory is:
>> > C:\tmp
>> >
>> > with subdirectory R.oo/ containing inst/ man/ R/ DESCRIPTION as usual.
>> >
>> > I noticed the following in CHANGES and NEWS related to R CMD INSTALL:
>> >
>> > o     R CMD INSTALL now installs by default into the first library on
>> >       the library path if R was run in the current environment.
>> >       Similarly, R CMD REMOVE by default removes from that library.
>> >       R CMD INSTALL does a better job of removing its temporary
>> >       directory.
>> >
>> > o     R CMD INSTALL and R CMD REMOVE now use as the default library
>> >       (if -l is not specified) the first library that would be used
>> >       if R were run in the current environment (and they run R to
>> >       find it).
>> >
>> >    o  R CMD INSTALL now prepends the installation directory (if
>> >       specified) to the library search path.
>> >
>> > But my I do have:
>> >
>> >> .libPaths()
>> > [1] "C:/PROGRA~1/R/R-2.5.0alpha/library"
>> >
>> > My setup:
>> > echo %RHOME%:
>> > C:\PROGRA~1\R\R-2.5.0alpha
>> >> .libPaths()
>> > [1] "C:/PROGRA~1/R/R-2.5.0alpha/library"
>> >> sessionInfo()
>> > R version 2.5.0 alpha (2007-04-04 r41043)
>> > i386-pc-mingw32
>> > locale:
>> > LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
>> States.1252;LC_MON
>> > ETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United 
>> States.1252
>> > attached base packages:
>> > [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
>> > [7] "base"
>> >
>> >
>> > Any help appreciated
>> >
>> > Henrik
>> >
>> > ______________________________________________
>> > R-devel at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-devel
>> >
>> 
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>> 
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From p.dalgaard at biostat.ku.dk  Sat Apr  7 21:41:49 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sat, 07 Apr 2007 21:41:49 +0200
Subject: [Rd] Orphaned ncvar? (PR#9603)
In-Reply-To: <20070406235902.07C105DEA8@slim.kubism.ku.dk>
References: <20070406235902.07C105DEA8@slim.kubism.ku.dk>
Message-ID: <4617F3FD.2070706@biostat.ku.dk>

chatfield at clio.arc.nasa.gov wrote:
> An orphaned package?  anyone in Switzerland know if there's an  
> alternative?
> Note the email.
> I guess CRAN-R should be notified.
>
> regards, Bob C
>
>   
This appears confused. Where is the bug in R?

I have difficulties seeing even what it is you're trying to achieve, but 
for one thing, manipulating .libPaths is NOT the way to help anything 
find include files and C libraries (LD_LIBRARY_PATH and configure 
options might be). If the issue is that mail to juerg.schmidli bounces, 
how about looking him up on the net?

    -pd
>> The original message was received at Fri, 6 Apr 2007 16:32:57 -0700
>> from vayu.arc.nasa.gov [143.232.122.22]
>>
>>    ----- The following addresses had permanent fatal errors -----
>> <juerg.schmidli at env.ethz.ch>
>>     (reason: 550-Callout verification failed:)
>>
>>    ----- Transcript of session follows -----
>> ... while talking to phil1.ethz.ch.:
>>
>>     
>>>>> DATA
>>>>>
>>>>>           
>> <<< 550-Callout verification failed:
>> <<< 550 550 5.1.1 User unknown
>> 550 5.1.1 <juerg.schmidli at env.ethz.ch>... User unknown
>> <<< 503 valid RCPT command must precede DATA
>> Reporting-MTA: dns; pagent2.arc.nasa.gov
>> Received-From-MTA: DNS; vayu.arc.nasa.gov
>> Arrival-Date: Fri, 6 Apr 2007 16:32:57 -0700
>>
>> Final-Recipient: RFC822; juerg.schmidli at env.ethz.ch
>> Action: failed
>> Status: 5.1.1
>> Remote-MTA: DNS; phil1.ethz.ch
>> Diagnostic-Code: SMTP; 550-Callout verification failed:
>> Last-Attempt-Date: Fri, 6 Apr 2007 16:33:08 -0700
>>     
>
>
>   
>> Could you help? The notes are just too telegraphic.
>>
>> I keep getting missing packages  or missing main in netdcdf messages
>> in my attempts to install.
>>
>> Macintosh OS X (10.4)  this happens to be old-chip PowerPC ...  
>> other install will be new-chip Intel
>>
>>
>> * binaries are listed on all the R mirrors, but they uniformly fail  
>> to work
>>
>> * I've tried to build these from source, but need netcdf.
>>
>> I see this ---
>>
>> Note
>> The NetCDF and the udunits library must be already installed on the  
>> system.
>> Author(s)
>> Pavel Michna
>>
>> but the installs don't work ...at configure stage.
>>
>> I have downloaded netcdf using the fink package manner (debian- 
>> linux like)
>> which creates files in
>> /sw/lib
>> and
>> /sw/include
>>
>> but have not been able to get these recognized by R at compile time,
>> even after using .libPaths("/sw/include")  for the new library and  
>> confirming
>> it with .libPaths()
>>
>> Either they are missing the library or cannot find "main" or  
>> something.
>>
>> If we are to build these ourselves, it would be great to find out  
>> just how
>> to get libraries recognized in the documentation, ... or for there  
>> to be binaries.
>>
>> If you have notes within the .tgz files, I have not found those.
>>
>> Please, help ! ;-)
>> regards, Bob C
>>
>> 	
>>
>>
>> Dr. Robert Chatfield
>> Earth Sciences, MS 245-5
>> NASA Ames Research Center
>> Moffett Field, CA 94035    USA
>>
>> Ph: 650-604-5490  FAX 650-604-3625
>>
>> http://geo.arc.nasa.gov/sgg/chatfield
>>
>>     
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From sbernard at infobiogen.fr  Sat Apr  7 21:45:32 2007
From: sbernard at infobiogen.fr (Simon de Bernard)
Date: Sat, 7 Apr 2007 21:45:32 +0200
Subject: [Rd] segmentation fault
In-Reply-To: <Pine.LNX.4.64.0704071137290.2918@itasca2.wildberry.org>
References: <68CA8B53-9FCB-4A84-A035-1E8AB59B8039@infobiogen.fr>
	<Pine.LNX.4.64.0704071137290.2918@itasca2.wildberry.org>
Message-ID: <22C3BD96-D85C-4FB3-AC1B-D9E7142AAFFC@infobiogen.fr>

Hi Luke,

thanks for your answer.

> I can't reproduce the crash on a 16Gb x86_64 linux machine. It gets
> over 16G of use and so into paging and seems to be making slow
> progress but I killed it at that point to avoid hogging the machine.

well  if it's platform/compiler specific, I guess I'll see if I can  
get some help from Simon Urbanek and his mac know-how...

> This example will allocate large generic vectors and then allocate
> lots of copies of 1 to fill it in. Can you reproduce the problem with
> something of coarser granularity, e.g. pasting together vectors of
> 1000000 doubles?

with vectors, I hit the vector length limit before getting into any  
trouble.

>   Otherwise, maybe info from running under gdb might help.

here is a backtrace:

Program received signal EXC_BAD_ACCESS, Could not access memory.
Reason: KERN_INVALID_ADDRESS at address: 0x0000000021000011
0x00000001004d9a28 in RunGenCollect (size_needed=1) at ../../../../R. 
2.4/src/main/memory.c:1313
1313        PROCESS_NODES();
(gdb) bt
#0  0x00000001004d9a28 in RunGenCollect (size_needed=1)  
at ../../../../R.2.4/src/main/memory.c:1313
#1  0x00000001004de764 in R_gc_internal (size_needed=1)  
at ../../../../R.2.4/src/main/memory.c:2142
#2  0x00000001004ddf56 in Rf_allocVector (type=14, length=1)  
at ../../../../R.2.4/src/main/memory.c:1943
#3  0x0000000100489c83 in duplicate1 (s=0x125aaec88) at ../../../../R. 
2.4/src/main/duplicate.c:214
#4  0x0000000100489181 in Rf_duplicate (s=0x125aaec88) at ../../../../ 
R.2.4/src/main/duplicate.c:111
#5  0x00000001004241d9 in ListAnswer (x=0x182008000, recurse=0,  
data=0x7fff5fbfe010) at ../../../../R.2.4/src/main/bind.c:187
#6  0x000000010042600b in do_c_dflt (call=0x103a47c08,  
op=0x10300ec68, args=0x103dbf980, env=0x10302e3f8) at ../../../../R. 
2.4/src/main/bind.c:752
#7  0x0000000100425df9 in do_c (call=0x103a47c08, op=0x10300ec68,  
args=0x103a47d90, env=0x10302e3f8) at ../../../../R.2.4/src/main/ 
bind.c:688
#8  0x00000001004a2952 in Rf_eval (e=0x103a47c08, rho=0x10302e3f8)  
at ../../../../R.2.4/src/main/eval.c:431
#9  0x00000001004a560c in do_set (call=0x103a42308, op=0x10300bb18,  
args=0x103a42340, rho=0x10302e3f8) at ../../../../R.2.4/src/main/ 
eval.c:1357
#10 0x00000001004a2952 in Rf_eval (e=0x103a42308, rho=0x10302e3f8)  
at ../../../../R.2.4/src/main/eval.c:431
#11 0x00000001004a4aa2 in do_begin (call=0x103a47ea8, op=0x10300b920,  
args=0x103a422d0, rho=0x10302e3f8) at ../../../../R.2.4/src/main/ 
eval.c:1107
#12 0x00000001004a2952 in Rf_eval (e=0x103a47ea8, rho=0x10302e3f8)  
at ../../../../R.2.4/src/main/eval.c:431
#13 0x00000001004a46f8 in do_while (call=0x103a42228, op=0x10300a388,  
args=0x103a42260, rho=0x10302e3f8) at ../../../../R.2.4/src/main/ 
eval.c:1037
#14 0x00000001004a2952 in Rf_eval (e=0x103a42228, rho=0x10302e3f8)  
at ../../../../R.2.4/src/main/eval.c:431
#15 0x00000001004d00c9 in Rf_ReplIteration (rho=0x10302e3f8,  
savestack=0, browselevel=0, state=0x7fff5fbfe9f0) at ../../../../R. 
2.4/src/main/main.c:256
#16 0x00000001004d026c in R_ReplConsole (rho=0x10302e3f8,  
savestack=0, browselevel=0) at ../../../../R.2.4/src/main/main.c:305
#17 0x00000001004d162a in run_Rmainloop () at ../../../../R.2.4/src/ 
main/main.c:945
#18 0x00000001004d163f in Rf_mainloop () at ../../../../R.2.4/src/ 
main/main.c:952
#19 0x0000000100000ddc in main (ac=1, av=0x7fff5fbfeeb0)  
at ../../../../R.2.4/src/main/Rmain.c:33

best,

Simon.


From hb at stat.berkeley.edu  Sat Apr  7 23:51:22 2007
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sat, 7 Apr 2007 14:51:22 -0700
Subject: [Rd] readBin() can read beyond end of raw vector
Message-ID: <59d7961d0704071451m590e037cjb3673e25906e1812@mail.gmail.com>

FYI, in R v2.5.0 alpha, readBin() can be used to read beyond end of raw vector:

> bfr <- as.raw(1:10)
> readBin(con=bfr, what="raw", n=20)
 [1] 01 02 03 04 05 06 07 08 09 0a

> readBin(con=bfr, what="integer", n=20)
[1]  67305985 134678021

> readBin(con=bfr, what="integer", size=4, n=20)
[1]  67305985 134678021

> readBin(con=bfr, what="integer", size=2, n=20)
 [1]    513   1027   1541   2055   2569  29537  29541      0      9  16384
[11]   9376    453 -18208    505 -18328    505      9      0      0      0

> readBin(con=bfr, what="integer", size=1, n=20)
 [1]   1   2   3   4   5   6   7   8   9  10  97 115 101 115   0   0   9   0   0
[20]  64

> sessionInfo()
R version 2.5.0 alpha (2007-04-04 r41043)
i386-pc-mingw32

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MON
ETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252


attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
[7] "base"

/Henrik


From deepayan.sarkar at gmail.com  Sun Apr  8 00:15:28 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Sat, 7 Apr 2007 15:15:28 -0700
Subject: [Rd] small update required in R-lang
Message-ID: <eb555e660704071515i69e9a093uc045d5cbbfe64e7e@mail.gmail.com>

The R-lang manual has this example which no longer holds (I couldn't
think of a simple alternative):

As it happens, @R{}'s parser is not perfectly invertible, nor is its
deparser, as the following examples show

@example
> deparse(quote(c(1, 2)))
[1] "c(1, 2)"
> deparse(1:2)
[1] "c(1, 2)"

-Deepayan


From deepayan.sarkar at gmail.com  Sun Apr  8 01:33:49 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Sat, 7 Apr 2007 16:33:49 -0700
Subject: [Rd] Rf_PrintValue problem with methods::show
Message-ID: <eb555e660704071633sf733745s897754e30f8eed44@mail.gmail.com>

Hi,

I think this is a bug (even though I can't find documentation
explicitly saying that it should work). Basically, Rf_PrintValue(obj)
fails when 'obj' is an S4 object that should be printed using show()
rather than print(). From the error message I'm guessing that the need
to use show is detected correctly but then show is not found.

"cbind2" in the code below is just a representative object, the same
holds for the few other S4 objects I have tried.

The following uses r-devel on i686-pc-linux-gnu, but the results are
same with R 2.4.1 (with suitable changes to the R_ParseVector call).
On powerpc Linux I get a segfault.


$ RPROG=R-devel
$ ${RPROG} --version | head -1
R version 2.6.0 Under development (unstable) (2007-04-06 r41080)
$ export LD_LIBRARY_PATH=`${RPROG} RHOME`/lib
$ cat parseEvalS4.c

#include <Rinternals.h>
#include <Rembedded.h>
#include <R_ext/Parse.h>

int main(int argc, char *argv[])
{
    SEXP e, val;
    int i, errorOccurred;
    ParseStatus status;
    char *cmds[] = { "show(5)", "show(cbind2)", "cbind2" };

    argv[0] = "R";
    Rf_initEmbeddedR(argc, argv);

    for (i = 0; i < 3; i++) {
        printf("** I **: Executing command: %s\n", cmds[i]);
        PROTECT(e = R_ParseVector(mkString(cmds[i]), -1, &status, R_NilValue));
        val = eval(VECTOR_ELT(e, 0), R_GlobalEnv);
        printf("** I **: Evaluation succeeded, now printing using
Rf_PrintValue:\n");
        Rf_PrintValue(val);
        UNPROTECT(1);
    }

    Rf_endEmbeddedR(0);
    return 0;
}

$
$ gcc -o parseEvalS4 \
>        `${RPROG} CMD config --cppflags` \
>        `${RPROG} CMD config --ldflags` parseEvalS4.c
$
$ ${RPROG} CMD ./parseEvalS4 --vanilla --silent
** I **: Executing command: show(5)
[1] 5
** I **: Evaluation succeeded, now printing using Rf_PrintValue:
[1] 5
** I **: Executing command: show(cbind2)
standardGeneric for "cbind2" defined from package "methods"

function (x, y)
standardGeneric("cbind2")
<environment: 0x8b34ef8>
Methods may be defined for arguments: x, y

** I **: Evaluation succeeded, now printing using Rf_PrintValue:
NULL
** I **: Executing command: cbind2
** I **: Evaluation succeeded, now printing using Rf_PrintValue:
Error: could not find function "show"
Error: unprotect(): only 0 protected items
$

-Deepayan


From hb at stat.berkeley.edu  Sun Apr  8 02:44:34 2007
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sat, 7 Apr 2007 17:44:34 -0700
Subject: [Rd] R CMD install on R 2.5.0 alpha
In-Reply-To: <Pine.LNX.4.64.0704071857570.15722@gannet.stats.ox.ac.uk>
References: <59d7961d0704070935k422e8679i8334c97c37fd8bad@mail.gmail.com>
	<Pine.LNX.4.64.0704071811190.14499@gannet.stats.ox.ac.uk>
	<59d7961d0704071057xea3ce3aq98abfab1d09b8780@mail.gmail.com>
	<Pine.LNX.4.64.0704071857570.15722@gannet.stats.ox.ac.uk>
Message-ID: <59d7961d0704071744j723e1541j404d944a822e9198@mail.gmail.com>

I located the problem to INSTALL.  If no the library path is not
passed explicitly, that is no -l option is use, the following code in
called:

132:    my @out = R_runR("cat(.libPaths()[1])", "--slave");
133:    $library = @out[0];
134:    $library = Win32::GetShortPathName($library) if $library =~ / /;
135:    print "installing to '$library'\n";

In my .Rprofile I write a message "$HOME2/.Rprofile ...done" to
stdout.  This is what is picked up in @out[0] above, and then I guess
the code on line 134 turns this into an empty string (somehow).  By
adding option --vanilla to the R call, this problem goes away.

Here is a patch to $R_HOME/bin/INSTALL.

C:\Program Files\R\R-2.5.0alpha\bin>diff INSTALL INSTALL.new
132c132
<     my @out = R_runR("cat(.libPaths()[1])", "--slave");
---
>     my @out = R_runR("cat(.libPaths()[1])", "--vanilla --slave");


I'm not sure if that INSTALL is in the source.  The only thing I can
find in the SVN is INSTALL.in
(https://svn.r-project.org/R/trunk/src/scripts/INSTALL.in), but that
contains no such line of code?!?

/Henrik


On 4/7/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On Sat, 7 Apr 2007, Henrik Bengtsson wrote:
>
> > Hi.
> >
> > On 4/7/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> >> Nothing has changed here for three months, AFAICS.  However, I noticed you
> >> have installed R into a directory with a space in the path, despite the
> >> advice not to.  OTOH, I have just tested installing where you did, and
> >> was able to install R.oo:
> >>
> >> [c:/Program Files/R/R-2.5.0alpha/bin]% ./Rcmd INSTALL
> >> d:/R/packages/contrib/R.oo_1.2.3.tar.gz
> >> installing to 'c:/PROGRA~1/R/R-25~1.0AL/library'
> >> ...
> >
> > Thank you for this confirmation.  It is odd though, because so have
> > also I done successfully for years.
> >
> >>
> >> On Windows, INSTALL is a Perl script.  Please debug it to see what is
> >> going wrong on your setup (it is working for many others).
> >
> > I will debug INSTALL to see what might go wrong.  I'll see if I can
> > locate an earlier version of R 2.5.0 alpha to see if the error really
> > is there or not.
> >
> >>
> >> You can of course specify -l to workaround this.
> >>
> >> On Sat, 7 Apr 2007, Henrik Bengtsson wrote:
> >>
> >> > Hi,
> >> >
> >> > I've just downloaded the latest R v2.5.0 alpha (2007-04-04 r41043) for
> >>
> >> That is not the latest binary build I am offered, let alone the latest
> >> sources.
> >
> > Got it from the UC Davis CRAN mirror about an one hour before my message.
>
> There is not much point in getting alpha/betas from mirrors: they can
> introduce another 24-hour delay.
>
> >
> > Thanks
> >
> > Henrik
> >
> >>
> >> > WinXP.  When I try to
> >> > install a package R tries to install it to a no-name (empty name)
> >> > directory (causing error downstream):
> >> >
> >> > RCMD INSTALL R.oo
> >> > installing to ''
> >> >
> >> > FYI: Package install perfectly on R v2.4.1 patched, and did so also on
> >> > earlier R v2.5.0 devel/alpha(?) versions.
> >> >
> >> > Current directory is:
> >> > C:\tmp
> >> >
> >> > with subdirectory R.oo/ containing inst/ man/ R/ DESCRIPTION as usual.
> >> >
> >> > I noticed the following in CHANGES and NEWS related to R CMD INSTALL:
> >> >
> >> > o     R CMD INSTALL now installs by default into the first library on
> >> >       the library path if R was run in the current environment.
> >> >       Similarly, R CMD REMOVE by default removes from that library.
> >> >       R CMD INSTALL does a better job of removing its temporary
> >> >       directory.
> >> >
> >> > o     R CMD INSTALL and R CMD REMOVE now use as the default library
> >> >       (if -l is not specified) the first library that would be used
> >> >       if R were run in the current environment (and they run R to
> >> >       find it).
> >> >
> >> >    o  R CMD INSTALL now prepends the installation directory (if
> >> >       specified) to the library search path.
> >> >
> >> > But my I do have:
> >> >
> >> >> .libPaths()
> >> > [1] "C:/PROGRA~1/R/R-2.5.0alpha/library"
> >> >
> >> > My setup:
> >> > echo %RHOME%:
> >> > C:\PROGRA~1\R\R-2.5.0alpha
> >> >> .libPaths()
> >> > [1] "C:/PROGRA~1/R/R-2.5.0alpha/library"
> >> >> sessionInfo()
> >> > R version 2.5.0 alpha (2007-04-04 r41043)
> >> > i386-pc-mingw32
> >> > locale:
> >> > LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> >> States.1252;LC_MON
> >> > ETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United
> >> States.1252
> >> > attached base packages:
> >> > [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
> >> > [7] "base"
> >> >
> >> >
> >> > Any help appreciated
> >> >
> >> > Henrik
> >> >
> >> > ______________________________________________
> >> > R-devel at r-project.org mailing list
> >> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >> >
> >>
> >> --
> >> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> >> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> >> University of Oxford,             Tel:  +44 1865 272861 (self)
> >> 1 South Parks Road,                     +44 1865 272866 (PA)
> >> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> >>
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


From ripley at stats.ox.ac.uk  Sun Apr  8 05:28:59 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 8 Apr 2007 04:28:59 +0100 (BST)
Subject: [Rd] R CMD install on R 2.5.0 alpha
In-Reply-To: <59d7961d0704071744j723e1541j404d944a822e9198@mail.gmail.com>
References: <59d7961d0704070935k422e8679i8334c97c37fd8bad@mail.gmail.com> 
	<Pine.LNX.4.64.0704071811190.14499@gannet.stats.ox.ac.uk> 
	<59d7961d0704071057xea3ce3aq98abfab1d09b8780@mail.gmail.com> 
	<Pine.LNX.4.64.0704071857570.15722@gannet.stats.ox.ac.uk>
	<59d7961d0704071744j723e1541j404d944a822e9198@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0704080352310.31916@gannet.stats.ox.ac.uk>

The file is src/gnuwin32/fixed/bin/INSTALL.

You do not want --vanilla: the point is to run R under normal conditions 
to pick up the value it uses.   There is a workaround on the Unix side, nd 
I will add a similar one to the Windows code.

There will be the usual delays in this getting into an alpha Windows 
binary, so please try

https://svn.r-project.org/R/trunk/src/gnuwin32/fixed/bin/INSTALL

(save it and drop it into the R_HOME/bin directory).

On Sat, 7 Apr 2007, Henrik Bengtsson wrote:

> I located the problem to INSTALL.  If no the library path is not
> passed explicitly, that is no -l option is use, the following code in
> called:
>
> 132:    my @out = R_runR("cat(.libPaths()[1])", "--slave");
> 133:    $library = @out[0];
> 134:    $library = Win32::GetShortPathName($library) if $library =~ / /;
> 135:    print "installing to '$library'\n";
>
> In my .Rprofile I write a message "$HOME2/.Rprofile ...done" to
> stdout.  This is what is picked up in @out[0] above, and then I guess
> the code on line 134 turns this into an empty string (somehow).  By
> adding option --vanilla to the R call, this problem goes away.
>
> Here is a patch to $R_HOME/bin/INSTALL.
>
> C:\Program Files\R\R-2.5.0alpha\bin>diff INSTALL INSTALL.new
> 132c132
> <     my @out = R_runR("cat(.libPaths()[1])", "--slave");
> ---
>>     my @out = R_runR("cat(.libPaths()[1])", "--vanilla --slave");
>
>
> I'm not sure if that INSTALL is in the source.  The only thing I can
> find in the SVN is INSTALL.in
> (https://svn.r-project.org/R/trunk/src/scripts/INSTALL.in), but that
> contains no such line of code?!?
>
> /Henrik
>
>
> On 4/7/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>> On Sat, 7 Apr 2007, Henrik Bengtsson wrote:
>> 
>> > Hi.
>> >
>> > On 4/7/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>> >> Nothing has changed here for three months, AFAICS.  However, I noticed 
>> you
>> >> have installed R into a directory with a space in the path, despite the
>> >> advice not to.  OTOH, I have just tested installing where you did, and
>> >> was able to install R.oo:
>> >>
>> >> [c:/Program Files/R/R-2.5.0alpha/bin]% ./Rcmd INSTALL
>> >> d:/R/packages/contrib/R.oo_1.2.3.tar.gz
>> >> installing to 'c:/PROGRA~1/R/R-25~1.0AL/library'
>> >> ...
>> >
>> > Thank you for this confirmation.  It is odd though, because so have
>> > also I done successfully for years.
>> >
>> >>
>> >> On Windows, INSTALL is a Perl script.  Please debug it to see what is
>> >> going wrong on your setup (it is working for many others).
>> >
>> > I will debug INSTALL to see what might go wrong.  I'll see if I can
>> > locate an earlier version of R 2.5.0 alpha to see if the error really
>> > is there or not.
>> >
>> >>
>> >> You can of course specify -l to workaround this.
>> >>
>> >> On Sat, 7 Apr 2007, Henrik Bengtsson wrote:
>> >>
>> >> > Hi,
>> >> >
>> >> > I've just downloaded the latest R v2.5.0 alpha (2007-04-04 r41043) for
>> >>
>> >> That is not the latest binary build I am offered, let alone the latest
>> >> sources.
>> >
>> > Got it from the UC Davis CRAN mirror about an one hour before my message.
>> 
>> There is not much point in getting alpha/betas from mirrors: they can
>> introduce another 24-hour delay.
>> 
>> >
>> > Thanks
>> >
>> > Henrik
>> >
>> >>
>> >> > WinXP.  When I try to
>> >> > install a package R tries to install it to a no-name (empty name)
>> >> > directory (causing error downstream):
>> >> >
>> >> > RCMD INSTALL R.oo
>> >> > installing to ''
>> >> >
>> >> > FYI: Package install perfectly on R v2.4.1 patched, and did so also on
>> >> > earlier R v2.5.0 devel/alpha(?) versions.
>> >> >
>> >> > Current directory is:
>> >> > C:\tmp
>> >> >
>> >> > with subdirectory R.oo/ containing inst/ man/ R/ DESCRIPTION as usual.
>> >> >
>> >> > I noticed the following in CHANGES and NEWS related to R CMD INSTALL:
>> >> >
>> >> > o     R CMD INSTALL now installs by default into the first library on
>> >> >       the library path if R was run in the current environment.
>> >> >       Similarly, R CMD REMOVE by default removes from that library.
>> >> >       R CMD INSTALL does a better job of removing its temporary
>> >> >       directory.
>> >> >
>> >> > o     R CMD INSTALL and R CMD REMOVE now use as the default library
>> >> >       (if -l is not specified) the first library that would be used
>> >> >       if R were run in the current environment (and they run R to
>> >> >       find it).
>> >> >
>> >> >    o  R CMD INSTALL now prepends the installation directory (if
>> >> >       specified) to the library search path.
>> >> >
>> >> > But my I do have:
>> >> >
>> >> >> .libPaths()
>> >> > [1] "C:/PROGRA~1/R/R-2.5.0alpha/library"
>> >> >
>> >> > My setup:
>> >> > echo %RHOME%:
>> >> > C:\PROGRA~1\R\R-2.5.0alpha
>> >> >> .libPaths()
>> >> > [1] "C:/PROGRA~1/R/R-2.5.0alpha/library"
>> >> >> sessionInfo()
>> >> > R version 2.5.0 alpha (2007-04-04 r41043)
>> >> > i386-pc-mingw32
>> >> > locale:
>> >> > LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
>> >> States.1252;LC_MON
>> >> > ETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United
>> >> States.1252
>> >> > attached base packages:
>> >> > [1] "stats"     "graphics"  "grDevices" "utils"     "datasets" 
>> "methods"
>> >> > [7] "base"
>> >> >
>> >> >
>> >> > Any help appreciated
>> >> >
>> >> > Henrik
>> >> >
>> >> > ______________________________________________
>> >> > R-devel at r-project.org mailing list
>> >> > https://stat.ethz.ch/mailman/listinfo/r-devel
>> >> >
>> >>
>> >> --
>> >> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> >> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> >> University of Oxford,             Tel:  +44 1865 272861 (self)
>> >> 1 South Parks Road,                     +44 1865 272866 (PA)
>> >> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>> >>
>> >
>> 
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>> 
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Sun Apr  8 06:03:07 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 8 Apr 2007 05:03:07 +0100 (BST)
Subject: [Rd] readBin() can read beyond end of raw vector
In-Reply-To: <59d7961d0704071451m590e037cjb3673e25906e1812@mail.gmail.com>
References: <59d7961d0704071451m590e037cjb3673e25906e1812@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0704080501090.27275@gannet.stats.ox.ac.uk>

Thanks for the report. BTW, this is not new in 2.5.0 alpha AFAICS.

It needs a tiny change in the C function readRaw: fixed in SVN now.

On Sat, 7 Apr 2007, Henrik Bengtsson wrote:

> FYI, in R v2.5.0 alpha, readBin() can be used to read beyond end of raw vector:
>
>> bfr <- as.raw(1:10)
>> readBin(con=bfr, what="raw", n=20)
> [1] 01 02 03 04 05 06 07 08 09 0a
>
>> readBin(con=bfr, what="integer", n=20)
> [1]  67305985 134678021
>
>> readBin(con=bfr, what="integer", size=4, n=20)
> [1]  67305985 134678021
>
>> readBin(con=bfr, what="integer", size=2, n=20)
> [1]    513   1027   1541   2055   2569  29537  29541      0      9  16384
> [11]   9376    453 -18208    505 -18328    505      9      0      0      0
>
>> readBin(con=bfr, what="integer", size=1, n=20)
> [1]   1   2   3   4   5   6   7   8   9  10  97 115 101 115   0   0   9   0   0
> [20]  64
>
>> sessionInfo()
> R version 2.5.0 alpha (2007-04-04 r41043)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MON
> ETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>
>
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
> [7] "base"
>
> /Henrik
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Sun Apr  8 09:14:00 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 8 Apr 2007 08:14:00 +0100 (BST)
Subject: [Rd] Rf_PrintValue problem with methods::show
In-Reply-To: <eb555e660704071633sf733745s897754e30f8eed44@mail.gmail.com>
References: <eb555e660704071633sf733745s897754e30f8eed44@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0704080642270.22715@gannet.stats.ox.ac.uk>

Look at the definition of PrintValue:

void PrintValue(SEXP s)
{
     PrintValueEnv(s, R_BaseEnv);
}

That's not going to find show from R_BaseEnv.  We need to get it from the 
methods namespace.


On Sat, 7 Apr 2007, Deepayan Sarkar wrote:

> Hi,
>
> I think this is a bug (even though I can't find documentation
> explicitly saying that it should work). Basically, Rf_PrintValue(obj)
> fails when 'obj' is an S4 object that should be printed using show()
> rather than print(). From the error message I'm guessing that the need
> to use show is detected correctly but then show is not found.
>
> "cbind2" in the code below is just a representative object, the same
> holds for the few other S4 objects I have tried.
>
> The following uses r-devel on i686-pc-linux-gnu, but the results are
> same with R 2.4.1 (with suitable changes to the R_ParseVector call).
> On powerpc Linux I get a segfault.
>
>
> $ RPROG=R-devel
> $ ${RPROG} --version | head -1
> R version 2.6.0 Under development (unstable) (2007-04-06 r41080)
> $ export LD_LIBRARY_PATH=`${RPROG} RHOME`/lib
> $ cat parseEvalS4.c
>
> #include <Rinternals.h>
> #include <Rembedded.h>
> #include <R_ext/Parse.h>
>
> int main(int argc, char *argv[])
> {
>    SEXP e, val;
>    int i, errorOccurred;
>    ParseStatus status;
>    char *cmds[] = { "show(5)", "show(cbind2)", "cbind2" };
>
>    argv[0] = "R";
>    Rf_initEmbeddedR(argc, argv);
>
>    for (i = 0; i < 3; i++) {
>        printf("** I **: Executing command: %s\n", cmds[i]);
>        PROTECT(e = R_ParseVector(mkString(cmds[i]), -1, &status, R_NilValue));
>        val = eval(VECTOR_ELT(e, 0), R_GlobalEnv);
>        printf("** I **: Evaluation succeeded, now printing using
> Rf_PrintValue:\n");
>        Rf_PrintValue(val);
>        UNPROTECT(1);
>    }
>
>    Rf_endEmbeddedR(0);
>    return 0;
> }
>
> $
> $ gcc -o parseEvalS4 \
>>        `${RPROG} CMD config --cppflags` \
>>        `${RPROG} CMD config --ldflags` parseEvalS4.c
> $
> $ ${RPROG} CMD ./parseEvalS4 --vanilla --silent
> ** I **: Executing command: show(5)
> [1] 5
> ** I **: Evaluation succeeded, now printing using Rf_PrintValue:
> [1] 5
> ** I **: Executing command: show(cbind2)
> standardGeneric for "cbind2" defined from package "methods"
>
> function (x, y)
> standardGeneric("cbind2")
> <environment: 0x8b34ef8>
> Methods may be defined for arguments: x, y
>
> ** I **: Evaluation succeeded, now printing using Rf_PrintValue:
> NULL
> ** I **: Executing command: cbind2
> ** I **: Evaluation succeeded, now printing using Rf_PrintValue:
> Error: could not find function "show"
> Error: unprotect(): only 0 protected items
> $
>
> -Deepayan
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From rgentlem at fhcrc.org  Sun Apr  8 09:52:26 2007
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Sun, 08 Apr 2007 00:52:26 -0700
Subject: [Rd] buglet in terms calculations
Message-ID: <46189F3A.3080702@fhcrc.org>

Hi,
   Vince and I have noticed a problem with non-syntactic names in data 
frames and some modeling code (but not all modeling code).

   The following, while almost surely as documented could be a bit more 
helpful:

  m = matrix(rnorm(100), nc=10)
  colnames(m) = paste(1:10, letters[1:10], sep="_")

  d = data.frame(m, check.names=FALSE)

  f = formula(`1_a` ~ ., data=d)

  tm = terms(f, data=d)

  ##failure here, as somehow back-ticks have become part of the name
  ##not a quoting mechanism
  d[attr(tm, "term.labels")]

   The variable attribute, in the terms object, keeps them as quotes, so 
modeling code that uses that attribute seems fine, but code that uses 
the term.labels fails. In particular, it seems (of those tested) that 
glm, lda, randomForest seem to work fine, while nnet, rpart can't
handle nonsyntactic names in formulae as such

   In particlar, rpart contains this code:

  lapply(m[attr(Terms, "term.labels")], tfun)

   which fails for the reasons given.


  One way to get around this, might be to modify the do_termsform code,
right now we have:
    PROTECT(varnames = allocVector(STRSXP, nvar));
     for (v = CDR(varlist), i = 0; v != R_NilValue; v = CDR(v))
         SET_STRING_ELT(varnames, i++, STRING_ELT(deparse1line(CAR(v), 
     0), 0));

  and then for term.labels, we copy over the varnames (with :, as 
needed) and perhaps we need to save the unquoted names somewhere?

  Or is there some other approach that will get us there? Certainly 
cleaning up the names via
   cleanTick = function(x) gsub("`", "", x)

  works, but it seems a bit ugly, and it might be better if the modeling 
code was modified.

   best wishes



-- 

Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From rgentlem at fhcrc.org  Sun Apr  8 10:09:05 2007
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Sun, 08 Apr 2007 01:09:05 -0700
Subject: [Rd] boundary case anomaly
Message-ID: <4618A321.5070808@fhcrc.org>

Hi,
  Any reason these should be different?

  x=matrix(0, nr=0, nc=3)
  colnames(x) = letters[1:3]
  data.frame(x)
#[1] a b c
#<0 rows> (or 0-length row.names)
  y=vector("list", length=3)
  names(y) = letters[1:3]
  data.frame(y)
#NULL data frame with 0 rows


both should have names (the second one does not) and why print something 
different for y?

  The two of the last three examples refer to a "NULL data frame", eg
   (d00 <- d0[FALSE,])  # NULL data frame with 0 rows

  but there is no description of what a NULL data frame should be (zero 
rows or zero columns, or either or both - and why a special name?)


  best wishes
    Robert


-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From p.dalgaard at biostat.ku.dk  Sun Apr  8 11:59:40 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sun, 08 Apr 2007 11:59:40 +0200
Subject: [Rd] buglet in terms calculations
In-Reply-To: <46189F3A.3080702@fhcrc.org>
References: <46189F3A.3080702@fhcrc.org>
Message-ID: <4618BD0C.5030001@biostat.ku.dk>

Robert Gentleman wrote:
> Hi,
>    Vince and I have noticed a problem with non-syntactic names in data 
> frames and some modeling code (but not all modeling code).
>
>    The following, while almost surely as documented could be a bit more 
> helpful:
>
>   m = matrix(rnorm(100), nc=10)
>   colnames(m) = paste(1:10, letters[1:10], sep="_")
>
>   d = data.frame(m, check.names=FALSE)
>
>   f = formula(`1_a` ~ ., data=d)
>
>   tm = terms(f, data=d)
>
>   ##failure here, as somehow back-ticks have become part of the name
>   ##not a quoting mechanism
>   d[attr(tm, "term.labels")]
>
>    The variable attribute, in the terms object, keeps them as quotes, so 
> modeling code that uses that attribute seems fine, but code that uses 
> the term.labels fails. In particular, it seems (of those tested) that 
> glm, lda, randomForest seem to work fine, while nnet, rpart can't
> handle nonsyntactic names in formulae as such
>
>    In particlar, rpart contains this code:
>
>   lapply(m[attr(Terms, "term.labels")], tfun)
>
>    which fails for the reasons given.
>
>
>   One way to get around this, might be to modify the do_termsform code,
> right now we have:
>     PROTECT(varnames = allocVector(STRSXP, nvar));
>      for (v = CDR(varlist), i = 0; v != R_NilValue; v = CDR(v))
>          SET_STRING_ELT(varnames, i++, STRING_ELT(deparse1line(CAR(v), 
>      0), 0));
>
>   and then for term.labels, we copy over the varnames (with :, as 
> needed) and perhaps we need to save the unquoted names somewhere?
>
>   Or is there some other approach that will get us there? Certainly 
> cleaning up the names via
>    cleanTick = function(x) gsub("`", "", x)
>
>   works, but it seems a bit ugly, and it might be better if the modeling 
> code was modified.
>
>   
Hmm, .Internal(deparse(....)) has a backtick option (for related 
reasons, IIRC). Could this be  used instead of  deparse1line?

(There's an inbuilt contradiction in having special terms like 
"(Intercept)" and at the same time allowing arbitrary non-syntactical 
names, but I suppose that  people who actually name their variables 
`(Intercept)` deserve whatever they get.)


From simon.urbanek at r-project.org  Sun Apr  8 14:31:26 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Sun, 8 Apr 2007 08:31:26 -0400
Subject: [Rd] Rf_PrintValue problem with methods::show
In-Reply-To: <eb555e660704071633sf733745s897754e30f8eed44@mail.gmail.com>
References: <eb555e660704071633sf733745s897754e30f8eed44@mail.gmail.com>
Message-ID: <5DAFC0A4-EAF5-4692-BE65-0C19F843154B@r-project.org>

Deepayan,

you fail to load the methods package, so you cannot use S4. Eval  
"library(methods)" first then everything is fine.

Cheers,
Simon

On Apr 7, 2007, at 7:33 PM, Deepayan Sarkar wrote:

> Hi,
>
> I think this is a bug (even though I can't find documentation
> explicitly saying that it should work). Basically, Rf_PrintValue(obj)
> fails when 'obj' is an S4 object that should be printed using show()
> rather than print(). From the error message I'm guessing that the need
> to use show is detected correctly but then show is not found.
>
> "cbind2" in the code below is just a representative object, the same
> holds for the few other S4 objects I have tried.
>
> The following uses r-devel on i686-pc-linux-gnu, but the results are
> same with R 2.4.1 (with suitable changes to the R_ParseVector call).
> On powerpc Linux I get a segfault.
>
>
> $ RPROG=R-devel
> $ ${RPROG} --version | head -1
> R version 2.6.0 Under development (unstable) (2007-04-06 r41080)
> $ export LD_LIBRARY_PATH=`${RPROG} RHOME`/lib
> $ cat parseEvalS4.c
>
> #include <Rinternals.h>
> #include <Rembedded.h>
> #include <R_ext/Parse.h>
>
> int main(int argc, char *argv[])
> {
>     SEXP e, val;
>     int i, errorOccurred;
>     ParseStatus status;
>     char *cmds[] = { "show(5)", "show(cbind2)", "cbind2" };
>
>     argv[0] = "R";
>     Rf_initEmbeddedR(argc, argv);
>
>     for (i = 0; i < 3; i++) {
>         printf("** I **: Executing command: %s\n", cmds[i]);
>         PROTECT(e = R_ParseVector(mkString(cmds[i]), -1, &status,  
> R_NilValue));
>         val = eval(VECTOR_ELT(e, 0), R_GlobalEnv);
>         printf("** I **: Evaluation succeeded, now printing using
> Rf_PrintValue:\n");
>         Rf_PrintValue(val);
>         UNPROTECT(1);
>     }
>
>     Rf_endEmbeddedR(0);
>     return 0;
> }
>
> $
> $ gcc -o parseEvalS4 \
>>        `${RPROG} CMD config --cppflags` \
>>        `${RPROG} CMD config --ldflags` parseEvalS4.c
> $
> $ ${RPROG} CMD ./parseEvalS4 --vanilla --silent
> ** I **: Executing command: show(5)
> [1] 5
> ** I **: Evaluation succeeded, now printing using Rf_PrintValue:
> [1] 5
> ** I **: Executing command: show(cbind2)
> standardGeneric for "cbind2" defined from package "methods"
>
> function (x, y)
> standardGeneric("cbind2")
> <environment: 0x8b34ef8>
> Methods may be defined for arguments: x, y
>
> ** I **: Evaluation succeeded, now printing using Rf_PrintValue:
> NULL
> ** I **: Executing command: cbind2
> ** I **: Evaluation succeeded, now printing using Rf_PrintValue:
> Error: could not find function "show"
> Error: unprotect(): only 0 protected items
> $
>
> -Deepayan
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From simon.urbanek at r-project.org  Sun Apr  8 14:57:28 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Sun, 8 Apr 2007 08:57:28 -0400
Subject: [Rd] Rf_PrintValue problem with methods::show
In-Reply-To: <5DAFC0A4-EAF5-4692-BE65-0C19F843154B@r-project.org>
References: <eb555e660704071633sf733745s897754e30f8eed44@mail.gmail.com>
	<5DAFC0A4-EAF5-4692-BE65-0C19F843154B@r-project.org>
Message-ID: <A7DD8ADD-CE02-4280-BBB1-7B0548D44A6B@r-project.org>

Deepayan,

don't mind my last mail - one shouldn't write e-mails before the  
first cup of coffee in the morning ;).. "methods" used to be excluded  
from the embedded startup (AFAIR), but that's no longer the case, so  
it must be something else. Sorry for the noise (I'm off to get the  
coffee :P).

Cheers,
Simon

On Apr 8, 2007, at 8:31 AM, Simon Urbanek wrote:

> Deepayan,
>
> you fail to load the methods package, so you cannot use S4. Eval  
> "library(methods)" first then everything is fine.
>
> Cheers,
> Simon
>
> On Apr 7, 2007, at 7:33 PM, Deepayan Sarkar wrote:
>
>> Hi,
>>
>> I think this is a bug (even though I can't find documentation
>> explicitly saying that it should work). Basically, Rf_PrintValue(obj)
>> fails when 'obj' is an S4 object that should be printed using show()
>> rather than print(). From the error message I'm guessing that the  
>> need
>> to use show is detected correctly but then show is not found.
>>
>> "cbind2" in the code below is just a representative object, the same
>> holds for the few other S4 objects I have tried.
>>
>> The following uses r-devel on i686-pc-linux-gnu, but the results are
>> same with R 2.4.1 (with suitable changes to the R_ParseVector call).
>> On powerpc Linux I get a segfault.
>>
>>
>> $ RPROG=R-devel
>> $ ${RPROG} --version | head -1
>> R version 2.6.0 Under development (unstable) (2007-04-06 r41080)
>> $ export LD_LIBRARY_PATH=`${RPROG} RHOME`/lib
>> $ cat parseEvalS4.c
>>
>> #include <Rinternals.h>
>> #include <Rembedded.h>
>> #include <R_ext/Parse.h>
>>
>> int main(int argc, char *argv[])
>> {
>>     SEXP e, val;
>>     int i, errorOccurred;
>>     ParseStatus status;
>>     char *cmds[] = { "show(5)", "show(cbind2)", "cbind2" };
>>
>>     argv[0] = "R";
>>     Rf_initEmbeddedR(argc, argv);
>>
>>     for (i = 0; i < 3; i++) {
>>         printf("** I **: Executing command: %s\n", cmds[i]);
>>         PROTECT(e = R_ParseVector(mkString(cmds[i]), -1, &status,  
>> R_NilValue));
>>         val = eval(VECTOR_ELT(e, 0), R_GlobalEnv);
>>         printf("** I **: Evaluation succeeded, now printing using
>> Rf_PrintValue:\n");
>>         Rf_PrintValue(val);
>>         UNPROTECT(1);
>>     }
>>
>>     Rf_endEmbeddedR(0);
>>     return 0;
>> }
>>
>> $
>> $ gcc -o parseEvalS4 \
>>>        `${RPROG} CMD config --cppflags` \
>>>        `${RPROG} CMD config --ldflags` parseEvalS4.c
>> $
>> $ ${RPROG} CMD ./parseEvalS4 --vanilla --silent
>> ** I **: Executing command: show(5)
>> [1] 5
>> ** I **: Evaluation succeeded, now printing using Rf_PrintValue:
>> [1] 5
>> ** I **: Executing command: show(cbind2)
>> standardGeneric for "cbind2" defined from package "methods"
>>
>> function (x, y)
>> standardGeneric("cbind2")
>> <environment: 0x8b34ef8>
>> Methods may be defined for arguments: x, y
>>
>> ** I **: Evaluation succeeded, now printing using Rf_PrintValue:
>> NULL
>> ** I **: Executing command: cbind2
>> ** I **: Evaluation succeeded, now printing using Rf_PrintValue:
>> Error: could not find function "show"
>> Error: unprotect(): only 0 protected items
>> $
>>
>> -Deepayan
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>


From ligges at statistik.uni-dortmund.de  Sun Apr  8 16:31:03 2007
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Sun, 08 Apr 2007 16:31:03 +0200
Subject: [Rd] Windows binary packages under R-2.5.0 alpha
Message-ID: <4618FCA7.4070707@statistik.uni-dortmund.de>

Dear package maintainers,

currently, 39 CRAN packages (not counting those on my 
exclude-from-Windows lists) are not passing the checks under Windows for 
R-2.5.0 alpha.
Additional 157 (!!!) packages are only passing with one or more WARNINGS.

Maintainers of failing packages will receive an automatical generated 
message today. In case your package does not pass the checks: Please 
remember that R-2.5.0 will be released in roughly two weeks and we are 
closely approaching beta status ...

I'd like to ask all package maintainers to look into the check summaries 
at http://cran.r-project.org/src/contrib/checkSummary.html

Thank you  -- and keep the updates rolling in,
Uwe Ligges


From ripley at stats.ox.ac.uk  Sun Apr  8 17:53:50 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 8 Apr 2007 16:53:50 +0100 (BST)
Subject: [Rd] Rf_PrintValue problem with methods::show
In-Reply-To: <5DAFC0A4-EAF5-4692-BE65-0C19F843154B@r-project.org>
References: <eb555e660704071633sf733745s897754e30f8eed44@mail.gmail.com>
	<5DAFC0A4-EAF5-4692-BE65-0C19F843154B@r-project.org>
Message-ID: <Pine.LNX.4.64.0704081642130.8106@gannet.stats.ox.ac.uk>

Simon,

There are a couple of subtle issues here.  As I wrote, PrintValue 
evaluates in the base environment, so sees only base functions.  It is not 
clear to me that is the right place (why the base environment and not the 
base namespace, for example), and one might consider evaluating in 
R_GlobalEnv.

However, as I understand it, one can load the methods namespace and turn 
S4 dispatch on without attaching the package.  So it seems entirely 
possible (but unusual) to have a package import 'methods' and then create 
S4 objects, and expect autoprinting to work.  That's why PrintValueEnv has 
to get show() from the methods namespace (at least as a last resort).

Now, there is an issue as to what autoprinting should do if a user defines 
his own version of print or show higher up the search path.  At present I 
believe the users's version is used for autoprinting, so we might want to 
preserve those semantics.  There are also issues with the visibility of S3 
print methods, and possible discrepancies in the choice between methods on 
the search path and registered ones.

I need to think through what the best fix is (suggestions welcome), and 
get this into 2.5.0 as a bug fix (I won't have time until Tuesday at the 
earliest).

Brian

On Sun, 8 Apr 2007, Simon Urbanek wrote:

> Deepayan,
>
> you fail to load the methods package, so you cannot use S4. Eval
> "library(methods)" first then everything is fine.
>
> Cheers,
> Simon
>
> On Apr 7, 2007, at 7:33 PM, Deepayan Sarkar wrote:
>
>> Hi,
>>
>> I think this is a bug (even though I can't find documentation
>> explicitly saying that it should work). Basically, Rf_PrintValue(obj)
>> fails when 'obj' is an S4 object that should be printed using show()
>> rather than print(). From the error message I'm guessing that the need
>> to use show is detected correctly but then show is not found.
>>
>> "cbind2" in the code below is just a representative object, the same
>> holds for the few other S4 objects I have tried.
>>
>> The following uses r-devel on i686-pc-linux-gnu, but the results are
>> same with R 2.4.1 (with suitable changes to the R_ParseVector call).
>> On powerpc Linux I get a segfault.
>>
>>
>> $ RPROG=R-devel
>> $ ${RPROG} --version | head -1
>> R version 2.6.0 Under development (unstable) (2007-04-06 r41080)
>> $ export LD_LIBRARY_PATH=`${RPROG} RHOME`/lib
>> $ cat parseEvalS4.c
>>
>> #include <Rinternals.h>
>> #include <Rembedded.h>
>> #include <R_ext/Parse.h>
>>
>> int main(int argc, char *argv[])
>> {
>>     SEXP e, val;
>>     int i, errorOccurred;
>>     ParseStatus status;
>>     char *cmds[] = { "show(5)", "show(cbind2)", "cbind2" };
>>
>>     argv[0] = "R";
>>     Rf_initEmbeddedR(argc, argv);
>>
>>     for (i = 0; i < 3; i++) {
>>         printf("** I **: Executing command: %s\n", cmds[i]);
>>         PROTECT(e = R_ParseVector(mkString(cmds[i]), -1, &status,
>> R_NilValue));
>>         val = eval(VECTOR_ELT(e, 0), R_GlobalEnv);
>>         printf("** I **: Evaluation succeeded, now printing using
>> Rf_PrintValue:\n");
>>         Rf_PrintValue(val);
>>         UNPROTECT(1);
>>     }
>>
>>     Rf_endEmbeddedR(0);
>>     return 0;
>> }
>>
>> $
>> $ gcc -o parseEvalS4 \
>>>        `${RPROG} CMD config --cppflags` \
>>>        `${RPROG} CMD config --ldflags` parseEvalS4.c
>> $
>> $ ${RPROG} CMD ./parseEvalS4 --vanilla --silent
>> ** I **: Executing command: show(5)
>> [1] 5
>> ** I **: Evaluation succeeded, now printing using Rf_PrintValue:
>> [1] 5
>> ** I **: Executing command: show(cbind2)
>> standardGeneric for "cbind2" defined from package "methods"
>>
>> function (x, y)
>> standardGeneric("cbind2")
>> <environment: 0x8b34ef8>
>> Methods may be defined for arguments: x, y
>>
>> ** I **: Evaluation succeeded, now printing using Rf_PrintValue:
>> NULL
>> ** I **: Executing command: cbind2
>> ** I **: Evaluation succeeded, now printing using Rf_PrintValue:
>> Error: could not find function "show"
>> Error: unprotect(): only 0 protected items
>> $
>>
>> -Deepayan
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at stat.berkeley.edu  Sun Apr  8 20:33:31 2007
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sun, 8 Apr 2007 11:33:31 -0700
Subject: [Rd] R CMD install on R 2.5.0 alpha
In-Reply-To: <Pine.LNX.4.64.0704080352310.31916@gannet.stats.ox.ac.uk>
References: <59d7961d0704070935k422e8679i8334c97c37fd8bad@mail.gmail.com>
	<Pine.LNX.4.64.0704071811190.14499@gannet.stats.ox.ac.uk>
	<59d7961d0704071057xea3ce3aq98abfab1d09b8780@mail.gmail.com>
	<Pine.LNX.4.64.0704071857570.15722@gannet.stats.ox.ac.uk>
	<59d7961d0704071744j723e1541j404d944a822e9198@mail.gmail.com>
	<Pine.LNX.4.64.0704080352310.31916@gannet.stats.ox.ac.uk>
Message-ID: <59d7961d0704081133i38f4afe3mc214a3c9936d2adc@mail.gmail.com>

On 4/7/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> The file is src/gnuwin32/fixed/bin/INSTALL.
>
> You do not want --vanilla: the point is to run R under normal conditions
> to pick up the value it uses.   There is a workaround on the Unix side, nd
> I will add a similar one to the Windows code.

Ah, you're right, that was the purpose of adding it the first place.

>
> There will be the usual delays in this getting into an alpha Windows
> binary, so please try
>
> https://svn.r-project.org/R/trunk/src/gnuwin32/fixed/bin/INSTALL
>
> (save it and drop it into the R_HOME/bin directory).

Done. Tested. Works. Thanks!

/Henrik

>
> On Sat, 7 Apr 2007, Henrik Bengtsson wrote:
>
> > I located the problem to INSTALL.  If no the library path is not
> > passed explicitly, that is no -l option is use, the following code in
> > called:
> >
> > 132:    my @out = R_runR("cat(.libPaths()[1])", "--slave");
> > 133:    $library = @out[0];
> > 134:    $library = Win32::GetShortPathName($library) if $library =~ / /;
> > 135:    print "installing to '$library'\n";
> >
> > In my .Rprofile I write a message "$HOME2/.Rprofile ...done" to
> > stdout.  This is what is picked up in @out[0] above, and then I guess
> > the code on line 134 turns this into an empty string (somehow).  By
> > adding option --vanilla to the R call, this problem goes away.
> >
> > Here is a patch to $R_HOME/bin/INSTALL.
> >
> > C:\Program Files\R\R-2.5.0alpha\bin>diff INSTALL INSTALL.new
> > 132c132
> > <     my @out = R_runR("cat(.libPaths()[1])", "--slave");
> > ---
> >>     my @out = R_runR("cat(.libPaths()[1])", "--vanilla --slave");
> >
> >
> > I'm not sure if that INSTALL is in the source.  The only thing I can
> > find in the SVN is INSTALL.in
> > (https://svn.r-project.org/R/trunk/src/scripts/INSTALL.in), but that
> > contains no such line of code?!?
> >
> > /Henrik
> >
> >
> > On 4/7/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> >> On Sat, 7 Apr 2007, Henrik Bengtsson wrote:
> >>
> >> > Hi.
> >> >
> >> > On 4/7/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> >> >> Nothing has changed here for three months, AFAICS.  However, I noticed
> >> you
> >> >> have installed R into a directory with a space in the path, despite the
> >> >> advice not to.  OTOH, I have just tested installing where you did, and
> >> >> was able to install R.oo:
> >> >>
> >> >> [c:/Program Files/R/R-2.5.0alpha/bin]% ./Rcmd INSTALL
> >> >> d:/R/packages/contrib/R.oo_1.2.3.tar.gz
> >> >> installing to 'c:/PROGRA~1/R/R-25~1.0AL/library'
> >> >> ...
> >> >
> >> > Thank you for this confirmation.  It is odd though, because so have
> >> > also I done successfully for years.
> >> >
> >> >>
> >> >> On Windows, INSTALL is a Perl script.  Please debug it to see what is
> >> >> going wrong on your setup (it is working for many others).
> >> >
> >> > I will debug INSTALL to see what might go wrong.  I'll see if I can
> >> > locate an earlier version of R 2.5.0 alpha to see if the error really
> >> > is there or not.
> >> >
> >> >>
> >> >> You can of course specify -l to workaround this.
> >> >>
> >> >> On Sat, 7 Apr 2007, Henrik Bengtsson wrote:
> >> >>
> >> >> > Hi,
> >> >> >
> >> >> > I've just downloaded the latest R v2.5.0 alpha (2007-04-04 r41043) for
> >> >>
> >> >> That is not the latest binary build I am offered, let alone the latest
> >> >> sources.
> >> >
> >> > Got it from the UC Davis CRAN mirror about an one hour before my message.
> >>
> >> There is not much point in getting alpha/betas from mirrors: they can
> >> introduce another 24-hour delay.
> >>
> >> >
> >> > Thanks
> >> >
> >> > Henrik
> >> >
> >> >>
> >> >> > WinXP.  When I try to
> >> >> > install a package R tries to install it to a no-name (empty name)
> >> >> > directory (causing error downstream):
> >> >> >
> >> >> > RCMD INSTALL R.oo
> >> >> > installing to ''
> >> >> >
> >> >> > FYI: Package install perfectly on R v2.4.1 patched, and did so also on
> >> >> > earlier R v2.5.0 devel/alpha(?) versions.
> >> >> >
> >> >> > Current directory is:
> >> >> > C:\tmp
> >> >> >
> >> >> > with subdirectory R.oo/ containing inst/ man/ R/ DESCRIPTION as usual.
> >> >> >
> >> >> > I noticed the following in CHANGES and NEWS related to R CMD INSTALL:
> >> >> >
> >> >> > o     R CMD INSTALL now installs by default into the first library on
> >> >> >       the library path if R was run in the current environment.
> >> >> >       Similarly, R CMD REMOVE by default removes from that library.
> >> >> >       R CMD INSTALL does a better job of removing its temporary
> >> >> >       directory.
> >> >> >
> >> >> > o     R CMD INSTALL and R CMD REMOVE now use as the default library
> >> >> >       (if -l is not specified) the first library that would be used
> >> >> >       if R were run in the current environment (and they run R to
> >> >> >       find it).
> >> >> >
> >> >> >    o  R CMD INSTALL now prepends the installation directory (if
> >> >> >       specified) to the library search path.
> >> >> >
> >> >> > But my I do have:
> >> >> >
> >> >> >> .libPaths()
> >> >> > [1] "C:/PROGRA~1/R/R-2.5.0alpha/library"
> >> >> >
> >> >> > My setup:
> >> >> > echo %RHOME%:
> >> >> > C:\PROGRA~1\R\R-2.5.0alpha
> >> >> >> .libPaths()
> >> >> > [1] "C:/PROGRA~1/R/R-2.5.0alpha/library"
> >> >> >> sessionInfo()
> >> >> > R version 2.5.0 alpha (2007-04-04 r41043)
> >> >> > i386-pc-mingw32
> >> >> > locale:
> >> >> > LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> >> >> States.1252;LC_MON
> >> >> > ETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United
> >> >> States.1252
> >> >> > attached base packages:
> >> >> > [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"
> >> "methods"
> >> >> > [7] "base"
> >> >> >
> >> >> >
> >> >> > Any help appreciated
> >> >> >
> >> >> > Henrik
> >> >> >
> >> >> > ______________________________________________
> >> >> > R-devel at r-project.org mailing list
> >> >> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >> >> >
> >> >>
> >> >> --
> >> >> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> >> >> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> >> >> University of Oxford,             Tel:  +44 1865 272861 (self)
> >> >> 1 South Parks Road,                     +44 1865 272866 (PA)
> >> >> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> >> >>
> >> >
> >>
> >> --
> >> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> >> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> >> University of Oxford,             Tel:  +44 1865 272861 (self)
> >> 1 South Parks Road,                     +44 1865 272866 (PA)
> >> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> >>
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


From byron.ellis at gmail.com  Mon Apr  9 01:21:00 2007
From: byron.ellis at gmail.com (Byron Ellis)
Date: Sun, 8 Apr 2007 16:21:00 -0700
Subject: [Rd] Rf_PrintValue problem with methods::show
In-Reply-To: <A7DD8ADD-CE02-4280-BBB1-7B0548D44A6B@r-project.org>
References: <eb555e660704071633sf733745s897754e30f8eed44@mail.gmail.com>
	<5DAFC0A4-EAF5-4692-BE65-0C19F843154B@r-project.org>
	<A7DD8ADD-CE02-4280-BBB1-7B0548D44A6B@r-project.org>
Message-ID: <7098abec0704081621x2b4c2d7bh7b79d90d1fc330a5@mail.gmail.com>

Indeed, you run into the same problem when trying to use PrintValue in
a package (say, for debugging purposes). I just have an implementation
that uses GlobalEnv instead of BaseEnv though I'm not sure that it's
necessarily the correct choice (though it has yet to do something I
don't want).

On 4/8/07, Simon Urbanek <simon.urbanek at r-project.org> wrote:
> Deepayan,
>
> don't mind my last mail - one shouldn't write e-mails before the
> first cup of coffee in the morning ;).. "methods" used to be excluded
> from the embedded startup (AFAIR), but that's no longer the case, so
> it must be something else. Sorry for the noise (I'm off to get the
> coffee :P).
>
> Cheers,
> Simon
>
> On Apr 8, 2007, at 8:31 AM, Simon Urbanek wrote:
>
> > Deepayan,
> >
> > you fail to load the methods package, so you cannot use S4. Eval
> > "library(methods)" first then everything is fine.
> >
> > Cheers,
> > Simon
> >
> > On Apr 7, 2007, at 7:33 PM, Deepayan Sarkar wrote:
> >
> >> Hi,
> >>
> >> I think this is a bug (even though I can't find documentation
> >> explicitly saying that it should work). Basically, Rf_PrintValue(obj)
> >> fails when 'obj' is an S4 object that should be printed using show()
> >> rather than print(). From the error message I'm guessing that the
> >> need
> >> to use show is detected correctly but then show is not found.
> >>
> >> "cbind2" in the code below is just a representative object, the same
> >> holds for the few other S4 objects I have tried.
> >>
> >> The following uses r-devel on i686-pc-linux-gnu, but the results are
> >> same with R 2.4.1 (with suitable changes to the R_ParseVector call).
> >> On powerpc Linux I get a segfault.
> >>
> >>
> >> $ RPROG=R-devel
> >> $ ${RPROG} --version | head -1
> >> R version 2.6.0 Under development (unstable) (2007-04-06 r41080)
> >> $ export LD_LIBRARY_PATH=`${RPROG} RHOME`/lib
> >> $ cat parseEvalS4.c
> >>
> >> #include <Rinternals.h>
> >> #include <Rembedded.h>
> >> #include <R_ext/Parse.h>
> >>
> >> int main(int argc, char *argv[])
> >> {
> >>     SEXP e, val;
> >>     int i, errorOccurred;
> >>     ParseStatus status;
> >>     char *cmds[] = { "show(5)", "show(cbind2)", "cbind2" };
> >>
> >>     argv[0] = "R";
> >>     Rf_initEmbeddedR(argc, argv);
> >>
> >>     for (i = 0; i < 3; i++) {
> >>         printf("** I **: Executing command: %s\n", cmds[i]);
> >>         PROTECT(e = R_ParseVector(mkString(cmds[i]), -1, &status,
> >> R_NilValue));
> >>         val = eval(VECTOR_ELT(e, 0), R_GlobalEnv);
> >>         printf("** I **: Evaluation succeeded, now printing using
> >> Rf_PrintValue:\n");
> >>         Rf_PrintValue(val);
> >>         UNPROTECT(1);
> >>     }
> >>
> >>     Rf_endEmbeddedR(0);
> >>     return 0;
> >> }
> >>
> >> $
> >> $ gcc -o parseEvalS4 \
> >>>        `${RPROG} CMD config --cppflags` \
> >>>        `${RPROG} CMD config --ldflags` parseEvalS4.c
> >> $
> >> $ ${RPROG} CMD ./parseEvalS4 --vanilla --silent
> >> ** I **: Executing command: show(5)
> >> [1] 5
> >> ** I **: Evaluation succeeded, now printing using Rf_PrintValue:
> >> [1] 5
> >> ** I **: Executing command: show(cbind2)
> >> standardGeneric for "cbind2" defined from package "methods"
> >>
> >> function (x, y)
> >> standardGeneric("cbind2")
> >> <environment: 0x8b34ef8>
> >> Methods may be defined for arguments: x, y
> >>
> >> ** I **: Evaluation succeeded, now printing using Rf_PrintValue:
> >> NULL
> >> ** I **: Executing command: cbind2
> >> ** I **: Evaluation succeeded, now printing using Rf_PrintValue:
> >> Error: could not find function "show"
> >> Error: unprotect(): only 0 protected items
> >> $
> >>
> >> -Deepayan
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >>
> >
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Byron Ellis (byron.ellis at gmail.com)
"Oook" -- The Librarian


From ripley at stats.ox.ac.uk  Mon Apr  9 11:20:47 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 9 Apr 2007 10:20:47 +0100 (BST)
Subject: [Rd] Problems ahead from misuse of DUP=FALSE in .C and .Fortran
	calls
Message-ID: <Pine.LNX.4.64.0704051109320.19729@auk.stats>

I have been looking into making as.double() and friends do less copying 
(and they now do in R-devel).  The problem is that people have been 
writing code which assumes copying is guaranteed, so we decided not to put 
any changes into 2.5.0.

All but one of the cases I have detected (RandomFields, cluster::diana and 
stats::smooth, but there may be others that I have not) are due to the use 
of DUP=FALSE.  Now, there is a pretty strong warning against this on the 
help page, but people still do it and some of you are relying on as.xxxx 
making a new object which the compiled code then alters.

I think the message is clear: do not use DUP=FALSE unless you can prove 
that alteration of arguments in your C/Fortran code never has a 
side-effect.  Watch out for what that side-effect might be: in one case it 
is to change the parsed code in the loaded namespace which affects 
subsequent uses of the function but the first example works correctly (and 
few test suites try functions repeatedly).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From chatfield at alumni.rice.edu  Mon Apr  9 08:32:03 2007
From: chatfield at alumni.rice.edu (Robert Chatfield)
Date: Sun, 8 Apr 2007 23:32:03 -0700
Subject: [Rd] Orphaned ncvar? (PR#9603)
In-Reply-To: <4617F3FD.2070706@biostat.ku.dk>
References: <20070406235902.07C105DEA8@slim.kubism.ku.dk>
	<4617F3FD.2070706@biostat.ku.dk>
Message-ID: <85C099BF-E7CF-4CD6-AC13-E5D4547E2D7A@alumni.rice.edu>

 From one view, there is no confusion at all, Peter.

There are persistant difficulties with the binary builds at all sites  
I can try.  It seems that
this build is failing tests.  Possibly it's as simple as a change in  
name for the binary, but
it's impossible for me to guess the correct name.

Of course I tried source builds, but they also present real  
problems.   Techniques for
making libraries known ... and which libraries,    ... .h , ...lib,   
more specific dynamic iibraries ...
way beyond the poor soul who's paid to do statistics and science ...   
well, he is paid if he's lucky
and the funding is not suddenly pulled due to "shortfalls"   ... but  
it is.     ... We all try.

There is some help in what you mentioned ...

> I have difficulties seeing even what it is you're trying to  
> achieve, but for one thing, manipulating .libPaths is NOT the way  
> to help anything find include files and C libraries  
> (LD_LIBRARY_PATH and configure options might be).

So what is the correct way and what are the techniques an humble  
atmospheric scientist
might figure this out based on the documentation that the scientist  
can _readily_ find.  I do try.

For example "Having difficulty with binary builds?    See ... and ...  
and ... ; note that ... documentation
is completely out of date and you had best write  
to ... at ... . ... . .. to find out what we all know,
and .... somehow ... you seem not to know.

(flame off)
best regards, Bob Chatfield
... big fan of R


On Apr 7, 2007, at 12:41 PM, Peter Dalgaard wrote:

> chatfield at clio.arc.nasa.gov wrote:
>> An orphaned package?  anyone in Switzerland know if there's an   
>> alternative?
>> Note the email.
>> I guess CRAN-R should be notified.
>>
>> regards, Bob C
>>
>>
> This appears confused. Where is the bug in R?
>
> I have difficulties seeing even what it is you're trying to  
> achieve, but for one thing, manipulating .libPaths is NOT the way  
> to help anything find include files and C libraries  
> (LD_LIBRARY_PATH and configure options might be). If the issue is  
> that mail to juerg.schmidli bounces, how about looking him up on  
> the net?
>
>    -pd
>>> The original message was received at Fri, 6 Apr 2007 16:32:57 -0700
>>> from vayu.arc.nasa.gov [143.232.122.22]
>>>
>>>    ----- The following addresses had permanent fatal errors -----
>>> <juerg.schmidli at env.ethz.ch>
>>>     (reason: 550-Callout verification failed:)
>>>
>>>    ----- Transcript of session follows -----
>>> ... while talking to phil1.ethz.ch.:
>>>
>>>
>>>>>> DATA
>>>>>>
>>>>>>
>>> <<< 550-Callout verification failed:
>>> <<< 550 550 5.1.1 User unknown
>>> 550 5.1.1 <juerg.schmidli at env.ethz.ch>... User unknown
>>> <<< 503 valid RCPT command must precede DATA
>>> Reporting-MTA: dns; pagent2.arc.nasa.gov
>>> Received-From-MTA: DNS; vayu.arc.nasa.gov
>>> Arrival-Date: Fri, 6 Apr 2007 16:32:57 -0700
>>>
>>> Final-Recipient: RFC822; juerg.schmidli at env.ethz.ch
>>> Action: failed
>>> Status: 5.1.1
>>> Remote-MTA: DNS; phil1.ethz.ch
>>> Diagnostic-Code: SMTP; 550-Callout verification failed:
>>> Last-Attempt-Date: Fri, 6 Apr 2007 16:33:08 -0700
>>>
>>
>>
>>
>>> Could you help? The notes are just too telegraphic.
>>>
>>> I keep getting missing packages  or missing main in netdcdf messages
>>> in my attempts to install.
>>>
>>> Macintosh OS X (10.4)  this happens to be old-chip PowerPC ...   
>>> other install will be new-chip Intel
>>>
>>>
>>> * binaries are listed on all the R mirrors, but they uniformly  
>>> fail  to work
>>>
>>> * I've tried to build these from source, but need netcdf.
>>>
>>> I see this ---
>>>
>>> Note
>>> The NetCDF and the udunits library must be already installed on  
>>> the  system.
>>> Author(s)
>>> Pavel Michna
>>>
>>> but the installs don't work ...at configure stage.
>>>
>>> I have downloaded netcdf using the fink package manner (debian-  
>>> linux like)
>>> which creates files in
>>> /sw/lib
>>> and
>>> /sw/include
>>>
>>> but have not been able to get these recognized by R at compile time,
>>> even after using .libPaths("/sw/include")  for the new library  
>>> and  confirming
>>> it with .libPaths()
>>>
>>> Either they are missing the library or cannot find "main" or   
>>> something.
>>>
>>> If we are to build these ourselves, it would be great to find  
>>> out  just how
>>> to get libraries recognized in the documentation, ... or for  
>>> there  to be binaries.
>>>
>>> If you have notes within the .tgz files, I have not found those.
>>>
>>> Please, help ! ;-)
>>> regards, Bob C
>>>
>>> 	
>>>
>>>
>>> Dr. Robert Chatfield
>>> Earth Sciences, MS 245-5
>>> NASA Ames Research Center
>>> Moffett Field, CA 94035    USA
>>>
>>> Ph: 650-604-5490  FAX 650-604-3625
>>>
>>> http://geo.arc.nasa.gov/sgg/chatfield
>>>
>>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>


From wangtong at usc.edu  Mon Apr  9 03:13:33 2007
From: wangtong at usc.edu (Tong Wang)
Date: Sun, 08 Apr 2007 18:13:33 -0700
Subject: [Rd] Strange number produced by dnorm
In-Reply-To: <46135737.3030200@biostat.ku.dk>
References: <dc3f83df14128.4611afd3@usc.edu> <46135737.3030200@biostat.ku.dk>
Message-ID: <de1ece041195b.461930cd@usc.edu>

Having a hard time picking  up C :(      Thanks a lot for all your time .

tong

----- Original Message -----
From: Peter Dalgaard <p.dalgaard at biostat.ku.dk>
Date: Wednesday, April 4, 2007 12:44 am
Subject: Re: [Rd] Strange number produced by dnorm
To: Tong Wang <wangtong at usc.edu>
Cc: R-devel <r-devel at r-project.org>

> Tong Wang wrote:
> > Hi All,
> >     I just started to learn compiling C codes for R usage, and 
> got a problem when I was playing with my 'hello world' code. 
> >   
> > #include <R.h>
> > #include <Rdefines.h>    
> > #include <Rmath.h>
> >
> > SEXP test( ) {
> >   double x;
> >   x=dnorm(1.0,0.0,1.0,1);
> >   printf(" x value is: %d \n",x);
> >   return(R_NilValue);
> > }
> >
> >    I got the result :    x value is: -466460838 
> >
> > Could someone explain to me what was wrong here ?
> >
> >   
> Wrong printf format. "%d" is for integers.
> 
>


From theussl at ai.wu-wien.ac.at  Tue Apr 10 12:30:33 2007
From: theussl at ai.wu-wien.ac.at (Stefan Theussl)
Date: Tue, 10 Apr 2007 12:30:33 +0200
Subject: [Rd] R-Forge
In-Reply-To: <59d7961d0704070941yca65a46kaacfa46a89f033fa@mail.gmail.com>
References: <4616501F.5020409@ai.wu-wien.ac.at>
	<59d7961d0704070941yca65a46kaacfa46a89f033fa@mail.gmail.com>
Message-ID: <461B6749.2070201@ai.wu-wien.ac.at>

Henrik Bengtsson wrote:
> Hi,
>
> thanks for working on this and offering us this service.  One thing I
> wonder is about backup.  What kind of backup do you use or plan to
> use?
We plan to daily backup the svn repositories and the database (which 
contains R-Forge specific data). The files are stored on a RAID 5 on a 
separate server. We also have the option to use a tape storage. But we 
have to discuss this issue in more detail first.

Best,
Stefan
>
> Best,
>
> Henrik
>
> On 4/6/07, Stefan Theussl <theussl at ai.wu-wien.ac.at> wrote:
>> Hello Gregor,
>>
>> Yes, R-Forge.R-project.org will be the official forge for the R
>> Community.  But we have to fix a few things before we are going public.
>> If you like you can participate and help us testing. If you have a
>> package or a devel version of your package you're welcome to use SVN
>> provided by R-Forge.
>> For further questions please contact me or R-Forge at R-project.org.
>>
>> Regards,
>> Stefan
>>
>>
>>
>> ---------- Forwarded message ----------
>> From: Kurt Hornik <Kurt.Hornik at wu-wien.ac.at>
>> To: Stefan Theussl <stefan.theussl at wu-wien.ac.at>
>> Date: Fri, 6 Apr 2007 14:38:40 +0200
>> Subject: forwarded message from Gregor Gorjanc
>>
>>
>> ---------- Forwarded message ----------
>> From: Gregor Gorjanc <gregor.gorjanc at bfro.uni-lj.si>
>> To: r-devel at r-project.org
>> Date: Fri, 06 Apr 2007 12:53:07 +0200
>> Subject: [Rd] R-Forge?
>> Hello!
>>
>> I have recently found RForge.net (http://www.rforge.net/) by Simon
>> Urbanek and found out today that the site is accepting subscriptions.
>> Great! However, browsing a bit on the site I found a link to another
>> forge: R-Forge (http://r-forge.r-project.org/).
>>
>> Is/will the last one be the "offcial" forge for R packages, given that
>> it has domain r-project.org?
>>
>> Regards, Gregor
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>


From sfalcon at fhcrc.org  Tue Apr 10 16:47:41 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Tue, 10 Apr 2007 07:47:41 -0700
Subject: [Rd] list/matrix chimera
Message-ID: <m2lkh0xp4i.fsf@fhcrc.org>

Hi all,

If dimensions are added to a list, it will become a matrix-like hybrid
that calls itself a matrix, but returns lists for subset operations.

This was brought to my attention by a user that encountered such an
object and was quite confused by its behavior.  Although I have not
found the code that created the object yet, I believe that code is
simply incorrect.  Nevertheless, I wonder if R_data_class in attrib.c
should be a bit more discriminating and only return matrix or array
for atomic vectors.  Perhaps something like this:

--- a/src/main/attrib.c
+++ b/src/main/attrib.c
@@ -536,7 +536,7 @@ SEXP R_data_class(SEXP obj, Rboolean singleString)
     if(n == 0) {
        SEXP dim = getAttrib(obj, R_DimSymbol);
        int nd = length(dim);
-       if(nd > 0) {
+       if(nd > 0 && isVectorAtomic(obj)) {
            if(nd == 2)
                klass = mkChar("matrix");
            else

Here is an example that illustrates:

    vv <- as.list(1:24)
    dim(vv) <- c(6, 4)
    vv
         [,1] [,2] [,3] [,4]
    [1,] 1    7    13   19  
    [2,] 2    8    14   20  
    [3,] 3    9    15   21  
    [4,] 4    10   16   22  
    [5,] 5    11   17   23  
    [6,] 6    12   18   24  
    
    class(vv)
    [1] "matrix"
    
    typeof(vv)
    [1] "list"
    
    vv[1, 1]
    [[1]]
    [1] 1
    
    vv[1, ]
    [[1]]
    [1] 1
    
    [[2]]
    [1] 7
    
    [[3]]
    [1] 13
    
    [[4]]
    [1] 19


+ seth

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From tplate at blackmesacapital.com  Tue Apr 10 17:02:44 2007
From: tplate at blackmesacapital.com (Tony Plate)
Date: Tue, 10 Apr 2007 09:02:44 -0600
Subject: [Rd] list/matrix chimera
In-Reply-To: <m2lkh0xp4i.fsf@fhcrc.org>
References: <m2lkh0xp4i.fsf@fhcrc.org>
Message-ID: <461BA714.5040009@blackmesacapital.com>

Aren't you just seeing the effect of drop=TRUE? (at least with the 
examples you give below -- they all pick out a submatrix with extent one 
on some dimension)

AFAICT, matrices with a list as the underlying data work properly, e.g.:

 > vv <- array(as.list(1:12), 3:4)
 > vv
      [,1] [,2] [,3] [,4]
[1,] 1    4    7    10
[2,] 2    5    8    11
[3,] 3    6    9    12
 > vv[1:2,]
      [,1] [,2] [,3] [,4]
[1,] 1    4    7    10
[2,] 2    5    8    11
 > vv[1,,drop=FALSE]
      [,1] [,2] [,3] [,4]
[1,] 1    4    7    10
 >

It can actually be useful sometimes to have a matrix (or array) of 
non-atomic objects -- wouldn't your proposed change remove (or at least 
damage) that functionality?

-- Tony Plate

Seth Falcon wrote:
> Hi all,
> 
> If dimensions are added to a list, it will become a matrix-like hybrid
> that calls itself a matrix, but returns lists for subset operations.
> 
> This was brought to my attention by a user that encountered such an
> object and was quite confused by its behavior.  Although I have not
> found the code that created the object yet, I believe that code is
> simply incorrect.  Nevertheless, I wonder if R_data_class in attrib.c
> should be a bit more discriminating and only return matrix or array
> for atomic vectors.  Perhaps something like this:
> 
> --- a/src/main/attrib.c
> +++ b/src/main/attrib.c
> @@ -536,7 +536,7 @@ SEXP R_data_class(SEXP obj, Rboolean singleString)
>      if(n == 0) {
>         SEXP dim = getAttrib(obj, R_DimSymbol);
>         int nd = length(dim);
> -       if(nd > 0) {
> +       if(nd > 0 && isVectorAtomic(obj)) {
>             if(nd == 2)
>                 klass = mkChar("matrix");
>             else
> 
> Here is an example that illustrates:
> 
>     vv <- as.list(1:24)
>     dim(vv) <- c(6, 4)
>     vv
>          [,1] [,2] [,3] [,4]
>     [1,] 1    7    13   19  
>     [2,] 2    8    14   20  
>     [3,] 3    9    15   21  
>     [4,] 4    10   16   22  
>     [5,] 5    11   17   23  
>     [6,] 6    12   18   24  
>     
>     class(vv)
>     [1] "matrix"
>     
>     typeof(vv)
>     [1] "list"
>     
>     vv[1, 1]
>     [[1]]
>     [1] 1
>     
>     vv[1, ]
>     [[1]]
>     [1] 1
>     
>     [[2]]
>     [1] 7
>     
>     [[3]]
>     [1] 13
>     
>     [[4]]
>     [1] 19
> 
> 
> + seth
>


From h.wickham at gmail.com  Tue Apr 10 18:30:27 2007
From: h.wickham at gmail.com (hadley wickham)
Date: Tue, 10 Apr 2007 11:30:27 -0500
Subject: [Rd] list/matrix chimera
In-Reply-To: <461BA714.5040009@blackmesacapital.com>
References: <m2lkh0xp4i.fsf@fhcrc.org> <461BA714.5040009@blackmesacapital.com>
Message-ID: <f8e6ff050704100930p444beafwe2b6ed1caf229927@mail.gmail.com>

On 4/10/07, Tony Plate <tplate at blackmesacapital.com> wrote:
> Aren't you just seeing the effect of drop=TRUE? (at least with the
> examples you give below -- they all pick out a submatrix with extent one
> on some dimension)
>
> AFAICT, matrices with a list as the underlying data work properly, e.g.:
>
>  > vv <- array(as.list(1:12), 3:4)
>  > vv
>       [,1] [,2] [,3] [,4]
> [1,] 1    4    7    10
> [2,] 2    5    8    11
> [3,] 3    6    9    12
>  > vv[1:2,]
>       [,1] [,2] [,3] [,4]
> [1,] 1    4    7    10
> [2,] 2    5    8    11
>  > vv[1,,drop=FALSE]
>       [,1] [,2] [,3] [,4]
> [1,] 1    4    7    10
>  >
>
> It can actually be useful sometimes to have a matrix (or array) of
> non-atomic objects -- wouldn't your proposed change remove (or at least
> damage) that functionality?

I use this functionality a lot in the reshape package.  I would hate
to see it go!

It would be nice to have some way to remove the [[1]] from vv[1, 2][[1]] though.

Hadley


From tplate at blackmesacapital.com  Tue Apr 10 19:03:24 2007
From: tplate at blackmesacapital.com (Tony Plate)
Date: Tue, 10 Apr 2007 11:03:24 -0600
Subject: [Rd] list/matrix chimera
In-Reply-To: <f8e6ff050704100930p444beafwe2b6ed1caf229927@mail.gmail.com>
References: <m2lkh0xp4i.fsf@fhcrc.org> <461BA714.5040009@blackmesacapital.com>
	<f8e6ff050704100930p444beafwe2b6ed1caf229927@mail.gmail.com>
Message-ID: <461BC35C.2070306@blackmesacapital.com>

hadley wickham wrote:
> On 4/10/07, Tony Plate <tplate at blackmesacapital.com> wrote:
>> Aren't you just seeing the effect of drop=TRUE? (at least with the
>> examples you give below -- they all pick out a submatrix with extent one
>> on some dimension)
>>
>> AFAICT, matrices with a list as the underlying data work properly, e.g.:
>>
>>  > vv <- array(as.list(1:12), 3:4)
>>  > vv
>>       [,1] [,2] [,3] [,4]
>> [1,] 1    4    7    10
>> [2,] 2    5    8    11
>> [3,] 3    6    9    12
>>  > vv[1:2,]
>>       [,1] [,2] [,3] [,4]
>> [1,] 1    4    7    10
>> [2,] 2    5    8    11
>>  > vv[1,,drop=FALSE]
>>       [,1] [,2] [,3] [,4]
>> [1,] 1    4    7    10
>>  >
>>
>> It can actually be useful sometimes to have a matrix (or array) of
>> non-atomic objects -- wouldn't your proposed change remove (or at least
>> damage) that functionality?
> 
> I use this functionality a lot in the reshape package.  I would hate
> to see it go!
> 
> It would be nice to have some way to remove the [[1]] from vv[1, 2][[1]] 
> though.
> 
> Hadley
> 

Doesn't vv[[1,2]] do that?

-- Tony


From sfalcon at fhcrc.org  Tue Apr 10 19:12:53 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Tue, 10 Apr 2007 10:12:53 -0700
Subject: [Rd] list/matrix chimera
In-Reply-To: <f8e6ff050704100930p444beafwe2b6ed1caf229927@mail.gmail.com>
	(hadley wickham's message of "Tue, 10 Apr 2007 11:30:27 -0500")
References: <m2lkh0xp4i.fsf@fhcrc.org> <461BA714.5040009@blackmesacapital.com>
	<f8e6ff050704100930p444beafwe2b6ed1caf229927@mail.gmail.com>
Message-ID: <m28xd0xiei.fsf@fhcrc.org>

"hadley wickham" <h.wickham at gmail.com> writes:

> On 4/10/07, Tony Plate <tplate at blackmesacapital.com> wrote:
>> Aren't you just seeing the effect of drop=TRUE? (at least with the
>> examples you give below -- they all pick out a submatrix with extent one
>> on some dimension)
>>
>> AFAICT, matrices with a list as the underlying data work properly, 

Yes, I guess so, although I'm surprised this is all that useful.  My
mental model is that a matrix is a vector with dimension and that as
such all elements are of the same type.  When a list is used for the
underlying data, then this is still true in that each element is
itself a list (at least according to vv[i]), but that is less useful
-- even if you figure out to use [[, there is no guarantee what you
will find there:

    vv = c(list(a=list(inner=1), b="foo", c=matrix(1, nrow=2, ncol=2)), 
           as.list(1:7))
    dim(vv) = c(2, 5)

>> It can actually be useful sometimes to have a matrix (or array) of
>> non-atomic objects 

Well if you say so.  I'm not sure how useful it could be without
knowing that each element is the same type -- perhaps a notion of a
vector of S4 objects would be useful...

>> -- wouldn't your proposed change remove (or at least
>> damage) that functionality?

Yes, and it would not avoid the confusion that generated this post as
cbind is documented to do what it does when given lists.

So, with apologies for the noise, please ignore my suggestion
regarding the behavior of R_data_class.

> I use this functionality a lot in the reshape package.  I would hate
> to see it go!
>
> It would be nice to have some way to remove the [[1]] from vv[1,
> 2][[1]] though.

For lists, there is no guaranteed structure and so you can't avoid
[[1]] since [1] will return a list and it can contain *anything*.

What could be useful is the notion of a vector of S4 objects.  There
you could ensure they are all the same type.

+ seth

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From gavin.simpson at ucl.ac.uk  Tue Apr 10 19:14:06 2007
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Tue, 10 Apr 2007 18:14:06 +0100
Subject: [Rd] CRAN packages maintained by you
In-Reply-To: <17943.15590.79914.772712@mithrandir.hornik.net>
References: <17943.15590.79914.772712@mithrandir.hornik.net>
Message-ID: <1176225246.2438.45.camel@graptoleberis.geog.ucl.ac.uk>

On Sat, 2007-04-07 at 08:40 +0200, Kurt Hornik wrote:
> Dear maintainers of CRAN packages,
> 
> This concerns the packages
<snip />
> 
> And now keep the updates rolling in ...

Dear R Developers,

I was recently emailed by the CRAN maintainers about warnings for my two
packages, analog and cocorresp, that are on CRAN.

I have built both packages (the versions on CRAN plus new,
in-development versions) under R 2.4.1, R 2.5.0-alpha [r41095] and R
2.6.0 (on two separate machines, both of which run FC 5 linux) and
cannot replicate the error message that the Daily Check Summary page
quotes:

"checking R files for syntax errors ... WARNING
Warning in Sys.setlocale(category, locale) : 
OS reports request cannot be honored",

Which I get only for the R pre-release (r-prerel) on Linux ix86 and Mac
OS X ix86 versions.

I am actually at a loss as to what the problem might be. My packages
don't use Sys.setlocale() and I am not familiar enough with what this
function does to suggest why it might be causing a problem on the CRAN
servers.

Does anyone have any suggestions as to what might be causing these
warnings or how I might track down the problem?

All the best,

G

> 
> Best
> -k
> 
> 
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Gavin Simpson                 [t] +44 (0)20 7679 0522
 ECRC & ENSIS, UCL Geography,  [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/cv/
 London, UK. WC1E 6BT.         [w] http://www.ucl.ac.uk/~ucfagls/
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From ggrothendieck at gmail.com  Tue Apr 10 19:22:35 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 10 Apr 2007 13:22:35 -0400
Subject: [Rd] list/matrix chimera
In-Reply-To: <f8e6ff050704100930p444beafwe2b6ed1caf229927@mail.gmail.com>
References: <m2lkh0xp4i.fsf@fhcrc.org> <461BA714.5040009@blackmesacapital.com>
	<f8e6ff050704100930p444beafwe2b6ed1caf229927@mail.gmail.com>
Message-ID: <971536df0704101022q565a6ea4xd2b46ac2a283655b@mail.gmail.com>

On 4/10/07, hadley wickham <h.wickham at gmail.com> wrote:
> On 4/10/07, Tony Plate <tplate at blackmesacapital.com> wrote:
> > Aren't you just seeing the effect of drop=TRUE? (at least with the
> > examples you give below -- they all pick out a submatrix with extent one
> > on some dimension)
> >
> > AFAICT, matrices with a list as the underlying data work properly, e.g.:
> >
> >  > vv <- array(as.list(1:12), 3:4)
> >  > vv
> >       [,1] [,2] [,3] [,4]
> > [1,] 1    4    7    10
> > [2,] 2    5    8    11
> > [3,] 3    6    9    12
> >  > vv[1:2,]
> >       [,1] [,2] [,3] [,4]
> > [1,] 1    4    7    10
> > [2,] 2    5    8    11
> >  > vv[1,,drop=FALSE]
> >       [,1] [,2] [,3] [,4]
> > [1,] 1    4    7    10
> >  >
> >
> > It can actually be useful sometimes to have a matrix (or array) of
> > non-atomic objects -- wouldn't your proposed change remove (or at least
> > damage) that functionality?
>
> I use this functionality a lot in the reshape package.  I would hate
> to see it go!
>
> It would be nice to have some way to remove the [[1]] from vv[1, 2][[1]] though.

Try vv[[1,2]]


From h.wickham at gmail.com  Tue Apr 10 19:33:34 2007
From: h.wickham at gmail.com (hadley wickham)
Date: Tue, 10 Apr 2007 12:33:34 -0500
Subject: [Rd] list/matrix chimera
In-Reply-To: <m28xd0xiei.fsf@fhcrc.org>
References: <m2lkh0xp4i.fsf@fhcrc.org> <461BA714.5040009@blackmesacapital.com>
	<f8e6ff050704100930p444beafwe2b6ed1caf229927@mail.gmail.com>
	<m28xd0xiei.fsf@fhcrc.org>
Message-ID: <f8e6ff050704101033v51a7b3d7w755babb636293024@mail.gmail.com>

On 4/10/07, Seth Falcon <sfalcon at fhcrc.org> wrote:
> "hadley wickham" <h.wickham at gmail.com> writes:
>
> > On 4/10/07, Tony Plate <tplate at blackmesacapital.com> wrote:
> >> Aren't you just seeing the effect of drop=TRUE? (at least with the
> >> examples you give below -- they all pick out a submatrix with extent one
> >> on some dimension)
> >>
> >> AFAICT, matrices with a list as the underlying data work properly,
>
> Yes, I guess so, although I'm surprised this is all that useful.  My
> mental model is that a matrix is a vector with dimension and that as
> such all elements are of the same type.  When a list is used for the
> underlying data, then this is still true in that each element is
> itself a list (at least according to vv[i]), but that is less useful
> -- even if you figure out to use [[, there is no guarantee what you
> will find there:
>
>     vv = c(list(a=list(inner=1), b="foo", c=matrix(1, nrow=2, ncol=2)),
>            as.list(1:7))
>     dim(vv) = c(2, 5)

That's rather a contrived example.  In practice, you would create a
list containing the same type of objects.  eg:

library(reshape)
models <- stamp(mtcars, vs ~ am, function(df) lm(mpg ~ wt, data=df))
models
dimnames(models)
summary(models[[1, 1]])

which I think is a valid and useful thing to do (although a little
contrived in this example)


> > I use this functionality a lot in the reshape package.  I would hate
> > to see it go!
> >
> > It would be nice to have some way to remove the [[1]] from vv[1,
> > 2][[1]] though.
>
> For lists, there is no guaranteed structure and so you can't avoid
> [[1]] since [1] will return a list and it can contain *anything*.

As (many) others have pointed out, vv[[1,2]] works, as I probably
should have checked!

> What could be useful is the notion of a vector of S4 objects.  There
> you could ensure they are all the same type.

Yes, but I know what I put in my structure.  The contract is not
enforced by code, but it is enforced by me.  Most of the things I'm
dealing with are S3 objects, so a S4 templated vector wouldn't be
particularly helpful.

Hadley


From ripley at stats.ox.ac.uk  Tue Apr 10 19:41:21 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 10 Apr 2007 18:41:21 +0100 (BST)
Subject: [Rd] CRAN packages maintained by you
In-Reply-To: <1176225246.2438.45.camel@graptoleberis.geog.ucl.ac.uk>
References: <17943.15590.79914.772712@mithrandir.hornik.net>
	<1176225246.2438.45.camel@graptoleberis.geog.ucl.ac.uk>
Message-ID: <Pine.LNX.4.64.0704101835430.2994@auk.stats>

I only see analogue (sic), but is this not related to the

Encoding: UTF-8

?  Debian is very fond of subdividing packages, and I suspect it is the 
standard glibc UTF-8 locale ("en_US.utf8") that is missing.  There is an 
override for such people, to set R_ENCODING_LOCALES, and looks like they 
have lost their setting.  Kurt had this working once, maybe on a different 
machine.


On Tue, 10 Apr 2007, Gavin Simpson wrote:

> On Sat, 2007-04-07 at 08:40 +0200, Kurt Hornik wrote:
>> Dear maintainers of CRAN packages,
>>
>> This concerns the packages
> <snip />
>>
>> And now keep the updates rolling in ...
>
> Dear R Developers,
>
> I was recently emailed by the CRAN maintainers about warnings for my two
> packages, analog and cocorresp, that are on CRAN.
>
> I have built both packages (the versions on CRAN plus new,
> in-development versions) under R 2.4.1, R 2.5.0-alpha [r41095] and R
> 2.6.0 (on two separate machines, both of which run FC 5 linux) and
> cannot replicate the error message that the Daily Check Summary page
> quotes:
>
> "checking R files for syntax errors ... WARNING
> Warning in Sys.setlocale(category, locale) :
> OS reports request cannot be honored",
>
> Which I get only for the R pre-release (r-prerel) on Linux ix86 and Mac
> OS X ix86 versions.
>
> I am actually at a loss as to what the problem might be. My packages
> don't use Sys.setlocale() and I am not familiar enough with what this
> function does to suggest why it might be causing a problem on the CRAN
> servers.
>
> Does anyone have any suggestions as to what might be causing these
> warnings or how I might track down the problem?
>
> All the best,
>
> G
>
>>
>> Best
>> -k
>>
>>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sfalcon at fhcrc.org  Tue Apr 10 19:45:48 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Tue, 10 Apr 2007 10:45:48 -0700
Subject: [Rd] list/matrix chimera
In-Reply-To: <f8e6ff050704101033v51a7b3d7w755babb636293024@mail.gmail.com>
	(hadley wickham's message of "Tue, 10 Apr 2007 12:33:34 -0500")
References: <m2lkh0xp4i.fsf@fhcrc.org> <461BA714.5040009@blackmesacapital.com>
	<f8e6ff050704100930p444beafwe2b6ed1caf229927@mail.gmail.com>
	<m28xd0xiei.fsf@fhcrc.org>
	<f8e6ff050704101033v51a7b3d7w755babb636293024@mail.gmail.com>
Message-ID: <m2zm5gw2b7.fsf@fhcrc.org>

"hadley wickham" <h.wickham at gmail.com> writes:
> That's rather a contrived example.  In practice, you would create a
> list containing the same type of objects.  eg:

Yes, great.  But when you have code that is expecting a matrix
argument, you can't know what you are going to get.  I suspect there
is a fair amount of matrix manipulating code that breaks when given
list-based matrices.


From pgilbert at bank-banque-canada.ca  Tue Apr 10 19:50:33 2007
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Tue, 10 Apr 2007 13:50:33 -0400
Subject: [Rd] eigen in beta
Message-ID: <461BCE69.2020409@bank-banque-canada.ca>

I am having some trouble with a case where  eigen in R-beta  gives a  
different largest value than in previous versions of R. Other values 
seem to be the same. Before I spend too much time, is anyone aware of a 
problem (symmetric = FALSE, only.values = TRUE).

Paul Gilbert
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From ripley at stats.ox.ac.uk  Tue Apr 10 19:57:39 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 10 Apr 2007 18:57:39 +0100 (BST)
Subject: [Rd] eigen in beta
In-Reply-To: <461BCE69.2020409@bank-banque-canada.ca>
References: <461BCE69.2020409@bank-banque-canada.ca>
Message-ID: <Pine.LNX.4.64.0704101854560.32417@gannet.stats.ox.ac.uk>

We are only aware of better behaviour from LAPACK 3.1 (which is what I 
suppose you are talking about, that is R compiled with its internal 
LAPACK).

But in at least one case that means finding a complex set of eigenvalues 
where previously a real one was found.

On Tue, 10 Apr 2007, Paul Gilbert wrote:

> I am having some trouble with a case where  eigen in R-beta  gives a
> different largest value than in previous versions of R. Other values
> seem to be the same. Before I spend too much time, is anyone aware of a
> problem (symmetric = FALSE, only.values = TRUE).
>
> Paul Gilbert
> ====================================================================================
>
> La version fran?aise suit le texte anglais.
>
> ------------------------------------------------------------------------------------
>
> This email may contain privileged and/or confidential inform...{{dropped}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From timh at insightful.com  Tue Apr 10 20:26:22 2007
From: timh at insightful.com (timh at insightful.com)
Date: Tue, 10 Apr 2007 20:26:22 +0200 (CEST)
Subject: [Rd] R CMD Rdconv drops sections: arguments, seealso,
	examples (PR#9606)
Message-ID: <20070410182622.1610B5ABC4@slim.kubism.ku.dk>

I've created a .Rd file (below), then converted that to .sgml using 
	R CMD Rdconv --type=Ssgm combn.Rd  > combn.sgml
The output (shown below) is missing some of the sections:
	arguments
	seealso
	examples
If instead I convert to .d (below), the same sections are missing,
and the "note" section is included but without the necessary newline.

--------------------------------------------------
\name{combn}
\alias{combn}
\title{ Generate combinations of m elements out of x }
\description{
  Generate all combinations of \code{m} elements out of \code{x} or
  \code{1:n}, and optionally apply a function to each, and return
  a list or simplify to a matrix or array.
}
\usage{
combn(x, m, FUN = NULL, simplify = TRUE, ...)
}
\arguments{
  \item{x}{ This is normally an integer \code{n}, in which case
    combinations of elemnents from \code{1:n} are returned.
    Otherwise this is a a vector, and elements of the vector are returned.
  \item{m}{ Number of elements in each combination. }
  \item{FUN}{ function to apply to each combination.  If \code{NULL},
    the combinations themselves are returned, one in each column of the
    result. }
  \item{simplify}{ If \code{FALSE}, the results are returned as a list,
    one combination or function value in each element.  If \code{TRUE},
    if possible the results are simplified to a matrix or array.
  }
  \item{\dots}{ Optional argument to pass to \code{FUN}
  }
}
\details{
  The case where \code{FUN} is supplied are handled by calling
  \code{\link{sapply}}, so \code{...}
  should not include argument to \code{\link{sapply}} -- in particular avoid
    \code{X} and \code{FUN}.
}
\value{
  Normally, a matrix with \code{m} rows and \code{choose(n,m)} columns.
  If \code{simplify=FALSE} a list is returned instead, with 
  \code{choose(n,m)} elements.  If \code{FUN} is supplied then the
  results of calling the function replace the combinations.
}
\note{This is similar to the R function \code{combn}.  However,
  this version returns a list if simplification is not possible, e.g.
  because the \code{FUN} returns objects with varying lengths.
}
\seealso{ \code{\link{combinations}} is used to create the combinations.
  It is faster to call function directly (note that it gives the combinations
  in a different order).
  \code{\link{sapply}} is used when \code{FUN} is supplied.
\examples{
combn(5, 3)
combinations(5, 3)
combn(letters[1:5], 3)
combn(5, 3, simplify = FALSE)
combn(5, 3, FUN = max)
\keyword{ math }

--------------------------------------------------
<!doctype s-function-doc system "s-function-doc.dtd" [
<!entity % S-OLD "INCLUDE">
]
>
<s-function-doc>
<s-topics>
  <s-topic>combn</s-topic>
</s-topics>

<s-title>
Generate combinations of m elements out of x
</s-title>

<s-description>
Generate all combinations of <code>m</code> elements out of <code>x</code> or
<code>1:n</code>, and optionally apply a function to each, and return
a list or simplify to a matrix or array.
</s-description>

<s-usage>
<s-old-style-usage>
combn(x, m, FUN = NULL, simplify = TRUE, ...)
</s-old-style-usage>
</s-usage>

<s-details>
The case where <code>FUN</code> is supplied are handled by calling
<s-function name="sapply">sapply</s-function>, so <code>...</code>
should not include argument to <s-function name="sapply">sapply</s-function> &ndash; in particular avoid
<code>X</code> and <code>FUN</code>.
</s-details>

<s-value>
Normally, a matrix with <code>m</code> rows and <code>choose(n,m)</code> columns.
If <code>simplify=FALSE</code> a list is returned instead, with 
<code>choose(n,m)</code> elements.  If <code>FUN</code> is supplied then the
results of calling the function replace the combinations.
</s-value>

<s-section name="NOTE">
This is similar to the R function <code>combn</code>.  However,
this version returns a list if simplification is not possible, e.g.
because the <code>FUN</code> returns objects with varying lengths.
</s-section>

<s-keywords>
<s-keyword>math</s-keyword>
</s-keywords>
<s-docclass>
function
</s-docclass>
</s-function-doc>

--------------------------------------------------
.\" -*- nroff -*- generated from .Rd format
.de PF
,br
.ne 2
.ft 3
.nf
..
.de FP
.br
.ne 2
.ft 1
.fi
..
.BG
.FN combn
.TL
Generate combinations of m elements out of x
.DN
Generate all combinations of 'm' elements out of 'x' or
'1:n', and optionally apply a function to each, and return
a list or simplify to a matrix or array.
.CS

combn(x, m, FUN = NULL, simplify = TRUE, ...)

.RT
Normally, a matrix with 'm' rows and 'choose(n,m)' columns.
If 'simplify=FALSE' a list is returned instead, with 
'choose(n,m)' elements.  If 'FUN' is supplied then the
results of calling the function replace the combinations.
.DT
The case where 'FUN' is supplied are handled by calling
'sapply', so '\&...'
should not include argument to 'sapply' - in particular avoid
'X' and 'FUN'.Note
This is similar to the R function 'combn'.  However,
this version returns a list if simplification is not possible, e.g.
because the 'FUN' returns objects with varying lengths.

.KW math
.WR






--please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status = 
 major = 2
 minor = 4.1
 year = 2006
 month = 12
 day = 18
 svn rev = 40228
 language = R
 version.string = R version 2.4.1 (2006-12-18)

Locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

Search Path:
 .GlobalEnv, package:combinat, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, package:methods, Autoloads, package:base


From pgilbert at bank-banque-canada.ca  Tue Apr 10 20:31:05 2007
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Tue, 10 Apr 2007 14:31:05 -0400
Subject: [Rd] eigen in beta
In-Reply-To: <Pine.LNX.4.64.0704101854560.32417@gannet.stats.ox.ac.uk>
References: <461BCE69.2020409@bank-banque-canada.ca>
	<Pine.LNX.4.64.0704101854560.32417@gannet.stats.ox.ac.uk>
Message-ID: <461BD7E9.1050200@bank-banque-canada.ca>

Here is the example. Pehaps others could check on other platforms. It is 
only the first eigenvalue that is different.  I am relatively sure the 
old values are correct, since I compare with an alternate calculation 
using the expansion of a polynomial determinant.


z <- t(matrix(c(
 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.0064083373167516857, 
-0.14786612501440565826,  0.368411802235074137,
 0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0568624483195125444,  
0.08575928008564302762, -0.101993668348446601,
 0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0039684327579889069, 
-0.00002857482925046247,  0.202241897806646448,
 1, 0, 0, 0, 0, 0, 0, 0, 0, -0.0222834092601282285, 
-0.09126708346036176145,  0.644249961695308682,
 0, 1, 0, 0, 0, 0, 0, 0, 0, -0.0032676036920228878,  
0.16985862929849462888,  0.057282326361118636,
 0, 0, 1, 0, 0, 0, 0, 0, 0,  0.0148488735227452068, 
-0.06175528918915401677,  0.109566197834008949,
 0, 0, 0, 1, 0, 0, 0, 0, 0, -0.0392756265125193960,  
0.04921079262665441212,  0.078176878215115805,
 0, 0, 0, 0, 1, 0, 0, 0, 0, -0.0013937451966661973,  
0.02009823693764142133, -0.207228935136287512,
 0, 0, 0, 0, 0, 1, 0, 0, 0,  0.0273358858605219357,  
0.03830466468488327725,  0.224426004034737836,
 0, 0, 0, 0, 0, 0, 1, 0, 0, -0.1456426235151105919,  
0.28688029213315069388,  0.326933845656016908,
 0, 0, 0, 0, 0, 0, 0, 1, 0,  0.0164670122082246559, 
-0.21966261349875662590,  0.036404179329694988,
 0, 0, 0, 0, 0, 0, 0, 0, 1,  0.0146156940584119890,  
0.07505490943478997090,  0.077660578370038813
 ), 12, 12))
 

R-2.5.0 gives
 >  eigen(z, symmetric = FALSE, only.values = TRUE)$values
 [1]  0.8465266+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
 [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
 [7]  0.6177419+0.0000000i -0.5604582+0.1958709i -0.5604582-0.1958709i
[10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i

R-2.4.1 and many, many previous versions gave
 >  eigen(z, symmetric = FALSE, only.values = TRUE)$values
 [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
 [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
 [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
[10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
 
Sys.info()
                             sysname                              release
                             "Linux"                    "2.4.21-40.ELsmp"
                             version                             nodename
"#1 SMP Thu Feb 2 22:13:55 EST 2006"                           "mfa04559"
                             machine                               
                            "x86_64" 

Paul Gilbert

Prof Brian Ripley wrote:

> We are only aware of better behaviour from LAPACK 3.1 (which is what I 
> suppose you are talking about, that is R compiled with its internal 
> LAPACK).
>
> But in at least one case that means finding a complex set of 
> eigenvalues where previously a real one was found.
>
> On Tue, 10 Apr 2007, Paul Gilbert wrote:
>
>> I am having some trouble with a case where  eigen in R-beta  gives a
>> different largest value than in previous versions of R. Other values
>> seem to be the same. Before I spend too much time, is anyone aware of a
>> problem (symmetric = FALSE, only.values = TRUE).
>>
>> Paul Gilbert
>> ==================================================================================== 
>>
>>
>> La version fran?aise suit le texte anglais.
>>
>> ------------------------------------------------------------------------------------ 
>>
>>
>> This email may contain privileged and/or confidential 
>> inform...{{dropped}}
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From ripley at stats.ox.ac.uk  Tue Apr 10 20:50:48 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Tue, 10 Apr 2007 20:50:48 +0200 (CEST)
Subject: [Rd] (PR#9606)  R CMD Rdconv drops sections: arguments, seealso,
Message-ID: <20070410185048.7BCDF5ABE0@slim.kubism.ku.dk>

Ny understanding was that Insightful had been asked to provide patches fo 
this.

We look forward to receiving them.

On Tue, 10 Apr 2007, timh at insightful.com wrote:

> I've created a .Rd file (below), then converted that to .sgml using
> 	R CMD Rdconv --type=Ssgm combn.Rd  > combn.sgml
> The output (shown below) is missing some of the sections:
> 	arguments
> 	seealso
> 	examples
> If instead I convert to .d (below), the same sections are missing,
> and the "note" section is included but without the necessary newline.
>
> --------------------------------------------------
> \name{combn}
> \alias{combn}
> \title{ Generate combinations of m elements out of x }
> \description{
>  Generate all combinations of \code{m} elements out of \code{x} or
>  \code{1:n}, and optionally apply a function to each, and return
>  a list or simplify to a matrix or array.
> }
> \usage{
> combn(x, m, FUN = NULL, simplify = TRUE, ...)
> }
> \arguments{
>  \item{x}{ This is normally an integer \code{n}, in which case
>    combinations of elemnents from \code{1:n} are returned.
>    Otherwise this is a a vector, and elements of the vector are returned.
>  \item{m}{ Number of elements in each combination. }
>  \item{FUN}{ function to apply to each combination.  If \code{NULL},
>    the combinations themselves are returned, one in each column of the
>    result. }
>  \item{simplify}{ If \code{FALSE}, the results are returned as a list,
>    one combination or function value in each element.  If \code{TRUE},
>    if possible the results are simplified to a matrix or array.
>  }
>  \item{\dots}{ Optional argument to pass to \code{FUN}
>  }
> }
> \details{
>  The case where \code{FUN} is supplied are handled by calling
>  \code{\link{sapply}}, so \code{...}
>  should not include argument to \code{\link{sapply}} -- in particular avoid
>    \code{X} and \code{FUN}.
> }
> \value{
>  Normally, a matrix with \code{m} rows and \code{choose(n,m)} columns.
>  If \code{simplify=FALSE} a list is returned instead, with
>  \code{choose(n,m)} elements.  If \code{FUN} is supplied then the
>  results of calling the function replace the combinations.
> }
> \note{This is similar to the R function \code{combn}.  However,
>  this version returns a list if simplification is not possible, e.g.
>  because the \code{FUN} returns objects with varying lengths.
> }
> \seealso{ \code{\link{combinations}} is used to create the combinations.
>  It is faster to call function directly (note that it gives the combinations
>  in a different order).
>  \code{\link{sapply}} is used when \code{FUN} is supplied.
> \examples{
> combn(5, 3)
> combinations(5, 3)
> combn(letters[1:5], 3)
> combn(5, 3, simplify = FALSE)
> combn(5, 3, FUN = max)
> \keyword{ math }
>
> --------------------------------------------------
> <!doctype s-function-doc system "s-function-doc.dtd" [
> <!entity % S-OLD "INCLUDE">
> ]
>>
> <s-function-doc>
> <s-topics>
>  <s-topic>combn</s-topic>
> </s-topics>
>
> <s-title>
> Generate combinations of m elements out of x
> </s-title>
>
> <s-description>
> Generate all combinations of <code>m</code> elements out of <code>x</code> or
> <code>1:n</code>, and optionally apply a function to each, and return
> a list or simplify to a matrix or array.
> </s-description>
>
> <s-usage>
> <s-old-style-usage>
> combn(x, m, FUN = NULL, simplify = TRUE, ...)
> </s-old-style-usage>
> </s-usage>
>
> <s-details>
> The case where <code>FUN</code> is supplied are handled by calling
> <s-function name="sapply">sapply</s-function>, so <code>...</code>
> should not include argument to <s-function name="sapply">sapply</s-function> &ndash; in particular avoid
> <code>X</code> and <code>FUN</code>.
> </s-details>
>
> <s-value>
> Normally, a matrix with <code>m</code> rows and <code>choose(n,m)</code> columns.
> If <code>simplify=FALSE</code> a list is returned instead, with
> <code>choose(n,m)</code> elements.  If <code>FUN</code> is supplied then the
> results of calling the function replace the combinations.
> </s-value>
>
> <s-section name="NOTE">
> This is similar to the R function <code>combn</code>.  However,
> this version returns a list if simplification is not possible, e.g.
> because the <code>FUN</code> returns objects with varying lengths.
> </s-section>
>
> <s-keywords>
> <s-keyword>math</s-keyword>
> </s-keywords>
> <s-docclass>
> function
> </s-docclass>
> </s-function-doc>
>
> --------------------------------------------------
> .\" -*- nroff -*- generated from .Rd format
> .de PF
> ,br
> .ne 2
> .ft 3
> .nf
> ..
> .de FP
> .br
> .ne 2
> .ft 1
> .fi
> ..
> .BG
> .FN combn
> .TL
> Generate combinations of m elements out of x
> .DN
> Generate all combinations of 'm' elements out of 'x' or
> '1:n', and optionally apply a function to each, and return
> a list or simplify to a matrix or array.
> .CS
>
> combn(x, m, FUN = NULL, simplify = TRUE, ...)
>
> .RT
> Normally, a matrix with 'm' rows and 'choose(n,m)' columns.
> If 'simplify=FALSE' a list is returned instead, with
> 'choose(n,m)' elements.  If 'FUN' is supplied then the
> results of calling the function replace the combinations.
> .DT
> The case where 'FUN' is supplied are handled by calling
> 'sapply', so '\&...'
> should not include argument to 'sapply' - in particular avoid
> 'X' and 'FUN'.Note
> This is similar to the R function 'combn'.  However,
> this version returns a list if simplification is not possible, e.g.
> because the 'FUN' returns objects with varying lengths.
>
> .KW math
> .WR
>
>
>
>
>
>
> --please do not edit the information below--
>
> Version:
> platform = i686-pc-linux-gnu
> arch = i686
> os = linux-gnu
> system = i686, linux-gnu
> status =
> major = 2
> minor = 4.1
> year = 2006
> month = 12
> day = 18
> svn rev = 40228
> language = R
> version.string = R version 2.4.1 (2006-12-18)
>
> Locale:
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>
> Search Path:
> .GlobalEnv, package:combinat, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, package:methods, Autoloads, package:base
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From pgilbert at bank-banque-canada.ca  Tue Apr 10 21:15:02 2007
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Tue, 10 Apr 2007 15:15:02 -0400
Subject: [Rd] eigen in beta
In-Reply-To: <461BD7E9.1050200@bank-banque-canada.ca>
References: <461BCE69.2020409@bank-banque-canada.ca>
	<Pine.LNX.4.64.0704101854560.32417@gannet.stats.ox.ac.uk>
	<461BD7E9.1050200@bank-banque-canada.ca>
Message-ID: <461BE236.7000405@bank-banque-canada.ca>

Here is another check that R-2.4.1 is right. This should give 1.

prod(eigen(z, symmetric = FALSE, only.values = TRUE)$values ) *
prod(eigen(solve(z), symmetric = FALSE, only.values = TRUE)$values )

R-2.4.1 gives
[1] 1+0i

R-2.5.0  gives
[1] 1.01677-0i

Paul

Paul Gilbert wrote:

> Here is the example. Pehaps others could check on other platforms. It 
> is only the first eigenvalue that is different.  I am relatively sure 
> the old values are correct, since I compare with an alternate 
> calculation using the expansion of a polynomial determinant.
>
>
> z <- t(matrix(c(
> 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.0064083373167516857, 
> -0.14786612501440565826,  0.368411802235074137,
> 0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0568624483195125444,  
> 0.08575928008564302762, -0.101993668348446601,
> 0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0039684327579889069, 
> -0.00002857482925046247,  0.202241897806646448,
> 1, 0, 0, 0, 0, 0, 0, 0, 0, -0.0222834092601282285, 
> -0.09126708346036176145,  0.644249961695308682,
> 0, 1, 0, 0, 0, 0, 0, 0, 0, -0.0032676036920228878,  
> 0.16985862929849462888,  0.057282326361118636,
> 0, 0, 1, 0, 0, 0, 0, 0, 0,  0.0148488735227452068, 
> -0.06175528918915401677,  0.109566197834008949,
> 0, 0, 0, 1, 0, 0, 0, 0, 0, -0.0392756265125193960,  
> 0.04921079262665441212,  0.078176878215115805,
> 0, 0, 0, 0, 1, 0, 0, 0, 0, -0.0013937451966661973,  
> 0.02009823693764142133, -0.207228935136287512,
> 0, 0, 0, 0, 0, 1, 0, 0, 0,  0.0273358858605219357,  
> 0.03830466468488327725,  0.224426004034737836,
> 0, 0, 0, 0, 0, 0, 1, 0, 0, -0.1456426235151105919,  
> 0.28688029213315069388,  0.326933845656016908,
> 0, 0, 0, 0, 0, 0, 0, 1, 0,  0.0164670122082246559, 
> -0.21966261349875662590,  0.036404179329694988,
> 0, 0, 0, 0, 0, 0, 0, 0, 1,  0.0146156940584119890,  
> 0.07505490943478997090,  0.077660578370038813
> ), 12, 12))
>
>
> R-2.5.0 gives
> >  eigen(z, symmetric = FALSE, only.values = TRUE)$values
> [1]  0.8465266+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
> [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
> [7]  0.6177419+0.0000000i -0.5604582+0.1958709i -0.5604582-0.1958709i
> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>
> R-2.4.1 and many, many previous versions gave
> >  eigen(z, symmetric = FALSE, only.values = TRUE)$values
> [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
> [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
> [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>
> Sys.info()
>                             sysname                              release
>                             "Linux"                    "2.4.21-40.ELsmp"
>                             version                             nodename
> "#1 SMP Thu Feb 2 22:13:55 EST 2006"                           "mfa04559"
>                             machine                               
>                            "x86_64"
> Paul Gilbert
>
> Prof Brian Ripley wrote:
>
>> We are only aware of better behaviour from LAPACK 3.1 (which is what 
>> I suppose you are talking about, that is R compiled with its internal 
>> LAPACK).
>>
>> But in at least one case that means finding a complex set of 
>> eigenvalues where previously a real one was found.
>>
>> On Tue, 10 Apr 2007, Paul Gilbert wrote:
>>
>>> I am having some trouble with a case where  eigen in R-beta  gives a
>>> different largest value than in previous versions of R. Other values
>>> seem to be the same. Before I spend too much time, is anyone aware of a
>>> problem (symmetric = FALSE, only.values = TRUE).
>>>
>>> Paul Gilbert
>>> ==================================================================================== 
>>>
>>>
>>> La version fran?aise suit le texte anglais.
>>>
>>> ------------------------------------------------------------------------------------ 
>>>
>>>
>>> This email may contain privileged and/or confidential 
>>> inform...{{dropped}}
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From Kurt.Hornik at wu-wien.ac.at  Tue Apr 10 21:58:10 2007
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Tue, 10 Apr 2007 21:58:10 +0200
Subject: [Rd] CRAN packages maintained by you
In-Reply-To: <Pine.LNX.4.64.0704101835430.2994@auk.stats>
References: <17943.15590.79914.772712@mithrandir.hornik.net>
	<1176225246.2438.45.camel@graptoleberis.geog.ucl.ac.uk>
	<Pine.LNX.4.64.0704101835430.2994@auk.stats>
Message-ID: <17947.60498.806445.750037@mithrandir.hornik.net>

>>>>> Prof Brian Ripley writes:

> I only see analogue (sic), but is this not related to the
> Encoding: UTF-8

> ?  Debian is very fond of subdividing packages, and I suspect it is
> the standard glibc UTF-8 locale ("en_US.utf8") that is missing.  There
> is an override for such people, to set R_ENCODING_LOCALES, and looks
> like they have lost their setting.  Kurt had this working once, maybe
> on a different machine.

Seems that the machine running the prerel checks has no latin1 locales.
Will generate these (and in fact this time all possible ones).

Best
-k


> On Tue, 10 Apr 2007, Gavin Simpson wrote:

>> On Sat, 2007-04-07 at 08:40 +0200, Kurt Hornik wrote:
>>> Dear maintainers of CRAN packages,
>>> 
>>> This concerns the packages
>> <snip />
>>> 
>>> And now keep the updates rolling in ...
>> 
>> Dear R Developers,
>> 
>> I was recently emailed by the CRAN maintainers about warnings for my two
>> packages, analog and cocorresp, that are on CRAN.
>> 
>> I have built both packages (the versions on CRAN plus new,
>> in-development versions) under R 2.4.1, R 2.5.0-alpha [r41095] and R
>> 2.6.0 (on two separate machines, both of which run FC 5 linux) and
>> cannot replicate the error message that the Daily Check Summary page
>> quotes:
>> 
>> "checking R files for syntax errors ... WARNING
>> Warning in Sys.setlocale(category, locale) :
>> OS reports request cannot be honored",
>> 
>> Which I get only for the R pre-release (r-prerel) on Linux ix86 and Mac
>> OS X ix86 versions.
>> 
>> I am actually at a loss as to what the problem might be. My packages
>> don't use Sys.setlocale() and I am not familiar enough with what this
>> function does to suggest why it might be causing a problem on the CRAN
>> servers.
>> 
>> Does anyone have any suggestions as to what might be causing these
>> warnings or how I might track down the problem?
>> 
>> All the best,
>> 
>> G
>> 
>>> 
>>> Best
>>> -k
>>> 
>>> 
>> 

> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From p.dalgaard at biostat.ku.dk  Tue Apr 10 22:04:27 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 10 Apr 2007 22:04:27 +0200
Subject: [Rd] eigen in beta
In-Reply-To: <461BD7E9.1050200@bank-banque-canada.ca>
References: <461BCE69.2020409@bank-banque-canada.ca>	<Pine.LNX.4.64.0704101854560.32417@gannet.stats.ox.ac.uk>
	<461BD7E9.1050200@bank-banque-canada.ca>
Message-ID: <461BEDCB.7090805@biostat.ku.dk>

Paul Gilbert wrote:
> Here is the example. Pehaps others could check on other platforms. It is 
> only the first eigenvalue that is different.  I am relatively sure the 
> old values are correct, since I compare with an alternate calculation 
> using the expansion of a polynomial determinant.
>
>
> z <- t(matrix(c(
>  0, 0, 0, 0, 0, 0, 0, 0, 0, -0.0064083373167516857, 
> -0.14786612501440565826,  0.368411802235074137,
>  0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0568624483195125444,  
> 0.08575928008564302762, -0.101993668348446601,
>  0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0039684327579889069, 
> -0.00002857482925046247,  0.202241897806646448,
>  1, 0, 0, 0, 0, 0, 0, 0, 0, -0.0222834092601282285, 
> -0.09126708346036176145,  0.644249961695308682,
>  0, 1, 0, 0, 0, 0, 0, 0, 0, -0.0032676036920228878,  
> 0.16985862929849462888,  0.057282326361118636,
>  0, 0, 1, 0, 0, 0, 0, 0, 0,  0.0148488735227452068, 
> -0.06175528918915401677,  0.109566197834008949,
>  0, 0, 0, 1, 0, 0, 0, 0, 0, -0.0392756265125193960,  
> 0.04921079262665441212,  0.078176878215115805,
>  0, 0, 0, 0, 1, 0, 0, 0, 0, -0.0013937451966661973,  
> 0.02009823693764142133, -0.207228935136287512,
>  0, 0, 0, 0, 0, 1, 0, 0, 0,  0.0273358858605219357,  
> 0.03830466468488327725,  0.224426004034737836,
>  0, 0, 0, 0, 0, 0, 1, 0, 0, -0.1456426235151105919,  
> 0.28688029213315069388,  0.326933845656016908,
>  0, 0, 0, 0, 0, 0, 0, 1, 0,  0.0164670122082246559, 
> -0.21966261349875662590,  0.036404179329694988,
>  0, 0, 0, 0, 0, 0, 0, 0, 1,  0.0146156940584119890,  
> 0.07505490943478997090,  0.077660578370038813
>  ), 12, 12))
>  
>
> R-2.5.0 gives
>  >  eigen(z, symmetric = FALSE, only.values = TRUE)$values
>  [1]  0.8465266+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
>  [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
>  [7]  0.6177419+0.0000000i -0.5604582+0.1958709i -0.5604582-0.1958709i
> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>
> R-2.4.1 and many, many previous versions gave
>  >  eigen(z, symmetric = FALSE, only.values = TRUE)$values
>  [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
>  [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
>  [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>  
> Sys.info()
>                              sysname                              release
>                              "Linux"                    "2.4.21-40.ELsmp"
>                              version                             nodename
> "#1 SMP Thu Feb 2 22:13:55 EST 2006"                           "mfa04559"
>                              machine                               
>                             "x86_64" 
>
> Paul Gilbert
Hmm, I don't get that

> version$version.string
[1] "R version 2.5.0 beta (2007-04-10 r41105)"
> eigen(z, symmetric = FALSE, only.values = TRUE)$values
 [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
 [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
 [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
[10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
> Sys.info()
                              sysname                               release 
                              "Linux"                   "2.6.20-1.2933.fc6" 
                              version                              nodename 
"#1 SMP Mon Mar 19 11:38:26 EDT 2007"              "titmouse2.kubism.ku.dk" 
                              machine                                 login 
                               "i686"                                  "pd" 
                                 user 
                                 "pd" 



And 

> version$version.string
[1] "R version 2.5.0 beta (2007-04-09 r41098)"
>  eigen(z, symmetric = FALSE, only.values = TRUE)$values
 [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
 [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
 [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
[10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
> Sys.info()
                             sysname                              release 
                             "Linux"               "2.6.18.8-0.1-default" 
                             version                             nodename 
"#1 SMP Fri Mar 2 13:51:59 UTC 2007"                              "viggo" 
                             machine                                login 
                            "x86_64"                                 "pd" 
                                user 
                                "pd" 



The latter should be the actual build used in the current beta tarball 
(which is what you used, right?).

I would suspect one of the following:

- RHEL compilers
- over-optimizing compiler settings
- system blas/lapack libraries
- system glibc

but Brian probably has more concrete information.

> Prof Brian Ripley wrote:
>
>   
>> We are only aware of better behaviour from LAPACK 3.1 (which is what I 
>> suppose you are talking about, that is R compiled with its internal 
>> LAPACK).
>>
>> But in at least one case that means finding a complex set of 
>> eigenvalues where previously a real one was found.
>>
>> On Tue, 10 Apr 2007, Paul Gilbert wrote:
>>
>>     
>>> I am having some trouble with a case where  eigen in R-beta  gives a
>>> different largest value than in previous versions of R. Other values
>>> seem to be the same. Before I spend too much time, is anyone aware of a
>>> problem (symmetric = FALSE, only.values = TRUE).
>>>
>>> Paul Gilbert
>>> ==================================================================================== 
>>>
>>>
>>> La version fran?aise suit le texte anglais.
>>>
>>> ------------------------------------------------------------------------------------ 
>>>
>>>
>>> This email may contain privileged and/or confidential 
>>> inform...{{dropped}}
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>       
> ====================================================================================
>
> La version fran?aise suit le texte anglais.
>
> ------------------------------------------------------------------------------------
>
> This email may contain privileged and/or confidential inform...{{dropped}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From pgilbert at bank-banque-canada.ca  Tue Apr 10 22:45:22 2007
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Tue, 10 Apr 2007 16:45:22 -0400
Subject: [Rd] eigen in beta
In-Reply-To: <461BEDCB.7090805@biostat.ku.dk>
References: <461BCE69.2020409@bank-banque-canada.ca>	<Pine.LNX.4.64.0704101854560.32417@gannet.stats.ox.ac.uk>
	<461BD7E9.1050200@bank-banque-canada.ca>
	<461BEDCB.7090805@biostat.ku.dk>
Message-ID: <461BF762.2040102@bank-banque-canada.ca>



Peter Dalgaard wrote:

> Paul Gilbert wrote:
>
>> Here is the example. Pehaps others could check on other platforms. It 
>> is only the first eigenvalue that is different.  I am relatively sure 
>> the old values are correct, since I compare with an alternate 
>> calculation using the expansion of a polynomial determinant.
>>
>>
>> z <- t(matrix(c(
>>  0, 0, 0, 0, 0, 0, 0, 0, 0, -0.0064083373167516857, 
>> -0.14786612501440565826,  0.368411802235074137,
>>  0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0568624483195125444,  
>> 0.08575928008564302762, -0.101993668348446601,
>>  0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0039684327579889069, 
>> -0.00002857482925046247,  0.202241897806646448,
>>  1, 0, 0, 0, 0, 0, 0, 0, 0, -0.0222834092601282285, 
>> -0.09126708346036176145,  0.644249961695308682,
>>  0, 1, 0, 0, 0, 0, 0, 0, 0, -0.0032676036920228878,  
>> 0.16985862929849462888,  0.057282326361118636,
>>  0, 0, 1, 0, 0, 0, 0, 0, 0,  0.0148488735227452068, 
>> -0.06175528918915401677,  0.109566197834008949,
>>  0, 0, 0, 1, 0, 0, 0, 0, 0, -0.0392756265125193960,  
>> 0.04921079262665441212,  0.078176878215115805,
>>  0, 0, 0, 0, 1, 0, 0, 0, 0, -0.0013937451966661973,  
>> 0.02009823693764142133, -0.207228935136287512,
>>  0, 0, 0, 0, 0, 1, 0, 0, 0,  0.0273358858605219357,  
>> 0.03830466468488327725,  0.224426004034737836,
>>  0, 0, 0, 0, 0, 0, 1, 0, 0, -0.1456426235151105919,  
>> 0.28688029213315069388,  0.326933845656016908,
>>  0, 0, 0, 0, 0, 0, 0, 1, 0,  0.0164670122082246559, 
>> -0.21966261349875662590,  0.036404179329694988,
>>  0, 0, 0, 0, 0, 0, 0, 0, 1,  0.0146156940584119890,  
>> 0.07505490943478997090,  0.077660578370038813
>>  ), 12, 12))
>>  
>>
>> R-2.5.0 gives
>>  >  eigen(z, symmetric = FALSE, only.values = TRUE)$values
>>  [1]  0.8465266+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
>>  [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
>>  [7]  0.6177419+0.0000000i -0.5604582+0.1958709i -0.5604582-0.1958709i
>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>>
>> R-2.4.1 and many, many previous versions gave
>>  >  eigen(z, symmetric = FALSE, only.values = TRUE)$values
>>  [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
>>  [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
>>  [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>>  
>> Sys.info()
>>                              sysname                              
>> release
>>                              "Linux"                    
>> "2.4.21-40.ELsmp"
>>                              version                             
>> nodename
>> "#1 SMP Thu Feb 2 22:13:55 EST 2006"                           
>> "mfa04559"
>>                              machine                               
>>                             "x86_64"
>> Paul Gilbert
>
> Hmm, I don't get that
>
>> version$version.string
>
> [1] "R version 2.5.0 beta (2007-04-10 r41105)"
>
>> eigen(z, symmetric = FALSE, only.values = TRUE)$values
>
> [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
> [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
> [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>
>> Sys.info()
>
>                              sysname                               
> release                              "Linux"                   
> "2.6.20-1.2933.fc6"                              
> version                              nodename "#1 SMP Mon Mar 19 
> 11:38:26 EDT 2007"              "titmouse2.kubism.ku.dk" 
>                              machine                                 
> login                               
> "i686"                                  "pd" 
>                                 user                                 "pd"
>
>
> And
>
>> version$version.string
>
> [1] "R version 2.5.0 beta (2007-04-09 r41098)"
>
>>  eigen(z, symmetric = FALSE, only.values = TRUE)$values
>
> [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
> [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
> [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>
>> Sys.info()
>
>                             sysname                              
> release                             "Linux"               
> "2.6.18.8-0.1-default"                             
> version                             nodename "#1 SMP Fri Mar 2 
> 13:51:59 UTC 2007"                              "viggo" 
>                             machine                                
> login                            
> "x86_64"                                 "pd" 
>                                user                                "pd"
>
>
> The latter should be the actual build used in the current beta tarball 
> (which is what you used, right?).

Yes.
 > version$version.string
[1] "R version 2.5.0 beta (2007-04-09 r41098)"

I didn't do anything special, just ./configure and make.  I am just 
rebuild and here is the configure output.  (I can never find this 
information if I don't save it.  Where is it saved?)

R is now configured for x86_64-unknown-linux-gnu

  Source directory:          .
  Installation directory:    /usr/local

  C compiler:                gcc -std=gnu99  -g -O2
  Fortran 77 compiler:       g77  -g -O2

  C++ compiler:              g++  -g -O2
  Fortran 90/95 compiler:    g77 -g -O2
  Obj-C compiler:          -g -O2

  Interfaces supported:      X11, tcltk
  External libraries:        readline
  Additional capabilities:   PNG, JPEG, iconv, MBCS, NLS
  Options enabled:           shared BLAS, R profiling

  Recommended packages:      yes

configure: WARNING: you cannot build info or HTML versions of the R manuals

I suppose there are some more details about my configuration  I need to 
find somewhere.

Paul

>
> I would suspect one of the following:
>
> - RHEL compilers
> - over-optimizing compiler settings
> - system blas/lapack libraries
> - system glibc
>
> but Brian probably has more concrete information.
>
>> Prof Brian Ripley wrote:
>>
>>  
>>
>>> We are only aware of better behaviour from LAPACK 3.1 (which is what 
>>> I suppose you are talking about, that is R compiled with its 
>>> internal LAPACK).
>>>
>>> But in at least one case that means finding a complex set of 
>>> eigenvalues where previously a real one was found.
>>>
>>> On Tue, 10 Apr 2007, Paul Gilbert wrote:
>>>
>>>    
>>>
>>>> I am having some trouble with a case where  eigen in R-beta  gives a
>>>> different largest value than in previous versions of R. Other values
>>>> seem to be the same. Before I spend too much time, is anyone aware 
>>>> of a
>>>> problem (symmetric = FALSE, only.values = TRUE).
>>>>
>>>> Paul Gilbert
>>>> ==================================================================================== 
>>>>
>>>>
>>>> La version fran?aise suit le texte anglais.
>>>>
>>>> ------------------------------------------------------------------------------------ 
>>>>
>>>>
>>>> This email may contain privileged and/or confidential 
>>>> inform...{{dropped}}
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>       
>>>
>> ==================================================================================== 
>>
>>
>> La version fran?aise suit le texte anglais.
>>
>> ------------------------------------------------------------------------------------ 
>>
>>
>> This email may contain privileged and/or confidential 
>> inform...{{dropped}}
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>   
>
>
>
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From simon.urbanek at r-project.org  Tue Apr 10 23:52:39 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 10 Apr 2007 17:52:39 -0400
Subject: [Rd] CRAN packages maintained by you
In-Reply-To: <17947.60498.806445.750037@mithrandir.hornik.net>
References: <17943.15590.79914.772712@mithrandir.hornik.net>
	<1176225246.2438.45.camel@graptoleberis.geog.ucl.ac.uk>
	<Pine.LNX.4.64.0704101835430.2994@auk.stats>
	<17947.60498.806445.750037@mithrandir.hornik.net>
Message-ID: <C254E6A6-4020-4721-B72F-38E9B70FE68C@r-project.org>


On Apr 10, 2007, at 3:58 PM, Kurt Hornik wrote:

>>>>>> Prof Brian Ripley writes:
>
>> I only see analogue (sic), but is this not related to the
>> Encoding: UTF-8
>
>> ?  Debian is very fond of subdividing packages, and I suspect it is
>> the standard glibc UTF-8 locale ("en_US.utf8") that is missing.   
>> There
>> is an override for such people, to set R_ENCODING_LOCALES, and looks
>> like they have lost their setting.  Kurt had this working once, maybe
>> on a different machine.
>
> Seems that the machine running the prerel checks has no latin1  
> locales.
> Will generate these (and in fact this time all possible ones).
>

Kurt, can you give me some pointers as of what/where this happens? I  
have never seen it happen before, because Macs usually have all  
locales installed, so I'm wondering if this is really something  
machine-specific or a bug ...

Thanks,
Simon


>
>> On Tue, 10 Apr 2007, Gavin Simpson wrote:
>
>>> On Sat, 2007-04-07 at 08:40 +0200, Kurt Hornik wrote:
>>>> Dear maintainers of CRAN packages,
>>>>
>>>> This concerns the packages
>>> <snip />
>>>>
>>>> And now keep the updates rolling in ...
>>>
>>> Dear R Developers,
>>>
>>> I was recently emailed by the CRAN maintainers about warnings for  
>>> my two
>>> packages, analog and cocorresp, that are on CRAN.
>>>
>>> I have built both packages (the versions on CRAN plus new,
>>> in-development versions) under R 2.4.1, R 2.5.0-alpha [r41095] and R
>>> 2.6.0 (on two separate machines, both of which run FC 5 linux) and
>>> cannot replicate the error message that the Daily Check Summary page
>>> quotes:
>>>
>>> "checking R files for syntax errors ... WARNING
>>> Warning in Sys.setlocale(category, locale) :
>>> OS reports request cannot be honored",
>>>
>>> Which I get only for the R pre-release (r-prerel) on Linux ix86  
>>> and Mac
>>> OS X ix86 versions.
>>>
>>> I am actually at a loss as to what the problem might be. My packages
>>> don't use Sys.setlocale() and I am not familiar enough with what  
>>> this
>>> function does to suggest why it might be causing a problem on the  
>>> CRAN
>>> servers.
>>>
>>> Does anyone have any suggestions as to what might be causing these
>>> warnings or how I might track down the problem?
>>>
>>> All the best,
>>>
>>> G
>>>
>>>>
>>>> Best
>>>> -k
>>>>
>>>>
>>>
>
>> -- 
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From gavin.simpson at ucl.ac.uk  Wed Apr 11 00:51:30 2007
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Tue, 10 Apr 2007 23:51:30 +0100
Subject: [Rd] CRAN packages maintained by you
In-Reply-To: <17947.60498.806445.750037@mithrandir.hornik.net>
References: <17943.15590.79914.772712@mithrandir.hornik.net>
	<1176225246.2438.45.camel@graptoleberis.geog.ucl.ac.uk>
	<Pine.LNX.4.64.0704101835430.2994@auk.stats>
	<17947.60498.806445.750037@mithrandir.hornik.net>
Message-ID: <1176245490.8551.34.camel@graptoleberis.geog.ucl.ac.uk>

Thank you Prof. Ripley for identifying the potential cause of the
warnings. From what Kurt says in his email, I can wait a little while
and see if the warnings for r-prerel go away in the future.

On Tue, 2007-04-10 at 21:58 +0200, Kurt Hornik wrote:
> >>>>> Prof Brian Ripley writes:
> 
> > I only see analogue (sic), 

Yes, I confuse myself with these things; there is an analog() in that
package.

All the best,

G

> but is this not related to the
> > Encoding: UTF-8
> 
> > ?  Debian is very fond of subdividing packages, and I suspect it is
> > the standard glibc UTF-8 locale ("en_US.utf8") that is missing.  There
> > is an override for such people, to set R_ENCODING_LOCALES, and looks
> > like they have lost their setting.  Kurt had this working once, maybe
> > on a different machine.
> 
> Seems that the machine running the prerel checks has no latin1 locales.
> Will generate these (and in fact this time all possible ones).
> 
> Best
> -k
> 
> 
> > On Tue, 10 Apr 2007, Gavin Simpson wrote:
> 
> >> On Sat, 2007-04-07 at 08:40 +0200, Kurt Hornik wrote:
> >>> Dear maintainers of CRAN packages,
> >>> 
> >>> This concerns the packages
> >> <snip />
> >>> 
> >>> And now keep the updates rolling in ...
> >> 
> >> Dear R Developers,
> >> 
> >> I was recently emailed by the CRAN maintainers about warnings for my two
> >> packages, analog and cocorresp, that are on CRAN.
> >> 
> >> I have built both packages (the versions on CRAN plus new,
> >> in-development versions) under R 2.4.1, R 2.5.0-alpha [r41095] and R
> >> 2.6.0 (on two separate machines, both of which run FC 5 linux) and
> >> cannot replicate the error message that the Daily Check Summary page
> >> quotes:
> >> 
> >> "checking R files for syntax errors ... WARNING
> >> Warning in Sys.setlocale(category, locale) :
> >> OS reports request cannot be honored",
> >> 
> >> Which I get only for the R pre-release (r-prerel) on Linux ix86 and Mac
> >> OS X ix86 versions.
> >> 
> >> I am actually at a loss as to what the problem might be. My packages
> >> don't use Sys.setlocale() and I am not familiar enough with what this
> >> function does to suggest why it might be causing a problem on the CRAN
> >> servers.
> >> 
> >> Does anyone have any suggestions as to what might be causing these
> >> warnings or how I might track down the problem?
> >> 
> >> All the best,
> >> 
> >> G
> >> 
> >>> 
> >>> Best
> >>> -k
> >>> 
> >>> 
> >> 
> 
> > -- 
> > Brian D. Ripley,                  ripley at stats.ox.ac.uk
> > Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> > University of Oxford,             Tel:  +44 1865 272861 (self)
> > 1 South Parks Road,                     +44 1865 272866 (PA)
> > Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Gavin Simpson                 [t] +44 (0)20 7679 0522
 ECRC & ENSIS, UCL Geography,  [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/cv/
 London, UK. WC1E 6BT.         [w] http://www.ucl.ac.uk/~ucfagls/
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From sfalcon at fhcrc.org  Wed Apr 11 02:27:56 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Tue, 10 Apr 2007 17:27:56 -0700
Subject: [Rd] Checking versions in Imports field?
Message-ID: <m24pnnwy9f.fsf@fhcrc.org>

Hi,

Package authors can specify the minimum required version of a
dependency using:

   Depends: somePackage (>= 1.2.3)

Is there a way to demand a minimum version when importing a
dependency?  Version specifiers in the Imports field are currently
ignored AFAICT.

+ seth

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From ripley at stats.ox.ac.uk  Wed Apr 11 08:43:38 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 11 Apr 2007 07:43:38 +0100 (BST)
Subject: [Rd] eigen in beta
In-Reply-To: <461BEDCB.7090805@biostat.ku.dk>
References: <461BCE69.2020409@bank-banque-canada.ca>
	<Pine.LNX.4.64.0704101854560.32417@gannet.stats.ox.ac.uk>
	<461BD7E9.1050200@bank-banque-canada.ca>
	<461BEDCB.7090805@biostat.ku.dk>
Message-ID: <Pine.LNX.4.64.0704110734210.1007@gannet.stats.ox.ac.uk>

All the systems I tried this on give the 'correct' answer, including

x86_64 Linux, FC5 (gcc 4.1.1)
i686 Linux, FC5
ix86 Windows (both gcc 3.4.5 and gcc pre-4.3.0)
Sparc Solaris, with gcc3, gcc4 and SunPro compilers.

Mainly with R 2.5.0 beta, some with R-devel (where the code is unchanged).

We have seen problems specific to RHEL's Fortran compilers on x86_64 
several times before. I would strongly recommend compiler updates.


On Tue, 10 Apr 2007, Peter Dalgaard wrote:

> Paul Gilbert wrote:
>> Here is the example. Pehaps others could check on other platforms. It is
>> only the first eigenvalue that is different.  I am relatively sure the
>> old values are correct, since I compare with an alternate calculation
>> using the expansion of a polynomial determinant.
>>
>>
>> z <- t(matrix(c(
>>  0, 0, 0, 0, 0, 0, 0, 0, 0, -0.0064083373167516857,
>> -0.14786612501440565826,  0.368411802235074137,
>>  0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0568624483195125444,
>> 0.08575928008564302762, -0.101993668348446601,
>>  0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0039684327579889069,
>> -0.00002857482925046247,  0.202241897806646448,
>>  1, 0, 0, 0, 0, 0, 0, 0, 0, -0.0222834092601282285,
>> -0.09126708346036176145,  0.644249961695308682,
>>  0, 1, 0, 0, 0, 0, 0, 0, 0, -0.0032676036920228878,
>> 0.16985862929849462888,  0.057282326361118636,
>>  0, 0, 1, 0, 0, 0, 0, 0, 0,  0.0148488735227452068,
>> -0.06175528918915401677,  0.109566197834008949,
>>  0, 0, 0, 1, 0, 0, 0, 0, 0, -0.0392756265125193960,
>> 0.04921079262665441212,  0.078176878215115805,
>>  0, 0, 0, 0, 1, 0, 0, 0, 0, -0.0013937451966661973,
>> 0.02009823693764142133, -0.207228935136287512,
>>  0, 0, 0, 0, 0, 1, 0, 0, 0,  0.0273358858605219357,
>> 0.03830466468488327725,  0.224426004034737836,
>>  0, 0, 0, 0, 0, 0, 1, 0, 0, -0.1456426235151105919,
>> 0.28688029213315069388,  0.326933845656016908,
>>  0, 0, 0, 0, 0, 0, 0, 1, 0,  0.0164670122082246559,
>> -0.21966261349875662590,  0.036404179329694988,
>>  0, 0, 0, 0, 0, 0, 0, 0, 1,  0.0146156940584119890,
>> 0.07505490943478997090,  0.077660578370038813
>>  ), 12, 12))
>>
>>
>> R-2.5.0 gives
>> >  eigen(z, symmetric = FALSE, only.values = TRUE)$values
>>  [1]  0.8465266+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
>>  [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
>>  [7]  0.6177419+0.0000000i -0.5604582+0.1958709i -0.5604582-0.1958709i
>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>>
>> R-2.4.1 and many, many previous versions gave
>> >  eigen(z, symmetric = FALSE, only.values = TRUE)$values
>>  [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
>>  [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
>>  [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>>
>> Sys.info()
>>                              sysname                              release
>>                              "Linux"                    "2.4.21-40.ELsmp"
>>                              version                             nodename
>> "#1 SMP Thu Feb 2 22:13:55 EST 2006"                           "mfa04559"
>>                              machine
>>                             "x86_64"
>>
>> Paul Gilbert
> Hmm, I don't get that
>
>> version$version.string
> [1] "R version 2.5.0 beta (2007-04-10 r41105)"
>> eigen(z, symmetric = FALSE, only.values = TRUE)$values
> [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
> [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
> [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>> Sys.info()
>                              sysname                               release
>                              "Linux"                   "2.6.20-1.2933.fc6"
>                              version                              nodename
> "#1 SMP Mon Mar 19 11:38:26 EDT 2007"              "titmouse2.kubism.ku.dk"
>                              machine                                 login
>                               "i686"                                  "pd"
>                                 user
>                                 "pd"
>
>
>
> And
>
>> version$version.string
> [1] "R version 2.5.0 beta (2007-04-09 r41098)"
>>  eigen(z, symmetric = FALSE, only.values = TRUE)$values
> [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
> [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
> [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>> Sys.info()
>                             sysname                              release
>                             "Linux"               "2.6.18.8-0.1-default"
>                             version                             nodename
> "#1 SMP Fri Mar 2 13:51:59 UTC 2007"                              "viggo"
>                             machine                                login
>                            "x86_64"                                 "pd"
>                                user
>                                "pd"
>
>
>
> The latter should be the actual build used in the current beta tarball
> (which is what you used, right?).
>
> I would suspect one of the following:
>
> - RHEL compilers
> - over-optimizing compiler settings
> - system blas/lapack libraries
> - system glibc
>
> but Brian probably has more concrete information.
>
>> Prof Brian Ripley wrote:
>>
>>
>>> We are only aware of better behaviour from LAPACK 3.1 (which is what I
>>> suppose you are talking about, that is R compiled with its internal
>>> LAPACK).
>>>
>>> But in at least one case that means finding a complex set of
>>> eigenvalues where previously a real one was found.
>>>
>>> On Tue, 10 Apr 2007, Paul Gilbert wrote:
>>>
>>>
>>>> I am having some trouble with a case where  eigen in R-beta  gives a
>>>> different largest value than in previous versions of R. Other values
>>>> seem to be the same. Before I spend too much time, is anyone aware of a
>>>> problem (symmetric = FALSE, only.values = TRUE).
>>>>
>>>> Paul Gilbert
>>>> ====================================================================================
>>>>
>>>>
>>>> La version fran?aise suit le texte anglais.
>>>>
>>>> ------------------------------------------------------------------------------------
>>>>
>>>>
>>>> This email may contain privileged and/or confidential
>>>> inform...{{dropped}}
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>
>> ====================================================================================
>>
>> La version fran?aise suit le texte anglais.
>>
>> ------------------------------------------------------------------------------------
>>
>> This email may contain privileged and/or confidential inform...{{dropped}}
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From maechler at stat.math.ethz.ch  Wed Apr 11 09:33:36 2007
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 11 Apr 2007 09:33:36 +0200
Subject: [Rd] eigen in beta
In-Reply-To: <Pine.LNX.4.64.0704110734210.1007@gannet.stats.ox.ac.uk>
References: <461BCE69.2020409@bank-banque-canada.ca>
	<Pine.LNX.4.64.0704101854560.32417@gannet.stats.ox.ac.uk>
	<461BD7E9.1050200@bank-banque-canada.ca>
	<461BEDCB.7090805@biostat.ku.dk>
	<Pine.LNX.4.64.0704110734210.1007@gannet.stats.ox.ac.uk>
Message-ID: <17948.36688.835545.286274@stat.math.ethz.ch>

I've also tried 

 on  Redhat EL4    (x86_64)  [but with /usr/local/..  gcc/gfortran 4.1.1]
 and FC6           (ix86 & x86_64)
 and Ubuntu dapper (x86_64)

and never got the wrong results.

>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>>>     on Wed, 11 Apr 2007 07:43:38 +0100 (BST) writes:

    BDR> All the systems I tried this on give the 'correct'
    BDR> answer, including x86_64 Linux, FC5 (gcc 4.1.1) i686
    BDR> Linux, FC5 ix86 Windows (both gcc 3.4.5 and gcc
    BDR> pre-4.3.0) Sparc Solaris, with gcc3, gcc4 and SunPro
    BDR> compilers.

    BDR> Mainly with R 2.5.0 beta, some with R-devel (where the
    BDR> code is unchanged).

    BDR> We have seen problems specific to RHEL's Fortran
    BDR> compilers on x86_64 several times before. I would
    BDR> strongly recommend compiler updates.


    BDR> On Tue, 10 Apr 2007, Peter Dalgaard wrote:

    >> Paul Gilbert wrote:
    >>> Here is the example. Pehaps others could check on other
    >>> platforms. It is only the first eigenvalue that is
    >>> different.  I am relatively sure the old values are
    >>> correct, since I compare with an alternate calculation
    >>> using the expansion of a polynomial determinant.
    >>> 
    >>> 
    >>> z <- t(matrix(c( 0, 0, 0, 0, 0, 0, 0, 0, 0,
    >>> -0.0064083373167516857, -0.14786612501440565826,
    >>> 0.368411802235074137, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    >>> 0.0568624483195125444, 0.08575928008564302762,
    >>> -0.101993668348446601, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    >>> 0.0039684327579889069, -0.00002857482925046247,
    >>> 0.202241897806646448, 1, 0, 0, 0, 0, 0, 0, 0, 0,
    >>> -0.0222834092601282285, -0.09126708346036176145,
    >>> 0.644249961695308682, 0, 1, 0, 0, 0, 0, 0, 0, 0,
    >>> -0.0032676036920228878, 0.16985862929849462888,
    >>> 0.057282326361118636, 0, 0, 1, 0, 0, 0, 0, 0, 0,
    >>> 0.0148488735227452068, -0.06175528918915401677,
    >>> 0.109566197834008949, 0, 0, 0, 1, 0, 0, 0, 0, 0,
    >>> -0.0392756265125193960, 0.04921079262665441212,
    >>> 0.078176878215115805, 0, 0, 0, 0, 1, 0, 0, 0, 0,
    >>> -0.0013937451966661973, 0.02009823693764142133,
    >>> -0.207228935136287512, 0, 0, 0, 0, 0, 1, 0, 0, 0,
    >>> 0.0273358858605219357, 0.03830466468488327725,
    >>> 0.224426004034737836, 0, 0, 0, 0, 0, 0, 1, 0, 0,
    >>> -0.1456426235151105919, 0.28688029213315069388,
    >>> 0.326933845656016908, 0, 0, 0, 0, 0, 0, 0, 1, 0,
    >>> 0.0164670122082246559, -0.21966261349875662590,
    >>> 0.036404179329694988, 0, 0, 0, 0, 0, 0, 0, 0, 1,
    >>> 0.0146156940584119890, 0.07505490943478997090,
    >>> 0.077660578370038813 ), 12, 12))
    >>> 
    >>> 
    >>> R-2.5.0 gives > eigen(z, symmetric = FALSE, only.values
    >>> = TRUE)$values [1] 0.8465266+0.0000000i
    >>> -0.0280087+0.6244992i -0.0280087-0.6244992i [4]
    >>> -0.2908409+0.5522274i -0.2908409-0.5522274i
    >>> -0.6228929+0.0000000i [7] 0.6177419+0.0000000i
    >>> -0.5604582+0.1958709i -0.5604582-0.1958709i [10]
    >>> 0.1458799+0.4909300i 0.1458799-0.4909300i
    >>> 0.3378356+0.0000000i
    >>> 
    >>> R-2.4.1 and many, many previous versions gave > eigen(z,
    >>> symmetric = FALSE, only.values = TRUE)$values [1]
    >>> 0.8794798+0.0000000i -0.0280087+0.6244992i
    >>> -0.0280087-0.6244992i [4] -0.2908409+0.5522274i
    >>> -0.2908409-0.5522274i -0.6228929+0.0000000i [7]
    >>> -0.5604582+0.1958709i -0.5604582-0.1958709i
    >>> 0.5847887+0.0000000i [10] 0.1458799+0.4909300i
    >>> 0.1458799-0.4909300i 0.3378356+0.0000000i
    >>> 
    >>> Sys.info() sysname release "Linux" "2.4.21-40.ELsmp"
    >>> version nodename "#1 SMP Thu Feb 2 22:13:55 EST 2006"
    >>> "mfa04559" machine "x86_64"
    >>> 
    >>> Paul Gilbert
    >> Hmm, I don't get that
    >> 
    >>> version$version.string
    >> [1] "R version 2.5.0 beta (2007-04-10 r41105)"
    >>> eigen(z, symmetric = FALSE, only.values = TRUE)$values
    >> [1] 0.8794798+0.0000000i -0.0280087+0.6244992i
    >> -0.0280087-0.6244992i [4] -0.2908409+0.5522274i
    >> -0.2908409-0.5522274i -0.6228929+0.0000000i [7]
    >> -0.5604582+0.1958709i -0.5604582-0.1958709i
    >> 0.5847887+0.0000000i [10] 0.1458799+0.4909300i
    >> 0.1458799-0.4909300i 0.3378356+0.0000000i
    >>> Sys.info()
    >> sysname release "Linux" "2.6.20-1.2933.fc6" version
    >> nodename "#1 SMP Mon Mar 19 11:38:26 EDT 2007"
    >> "titmouse2.kubism.ku.dk" machine login "i686" "pd" user
    >> "pd"
    >> 
    >> 
    >> 
    >> And
    >> 
    >>> version$version.string
    >> [1] "R version 2.5.0 beta (2007-04-09 r41098)"
    >>> eigen(z, symmetric = FALSE, only.values = TRUE)$values
    >> [1] 0.8794798+0.0000000i -0.0280087+0.6244992i
    >> -0.0280087-0.6244992i [4] -0.2908409+0.5522274i
    >> -0.2908409-0.5522274i -0.6228929+0.0000000i [7]
    >> -0.5604582+0.1958709i -0.5604582-0.1958709i
    >> 0.5847887+0.0000000i [10] 0.1458799+0.4909300i
    >> 0.1458799-0.4909300i 0.3378356+0.0000000i
    >>> Sys.info()
    >> sysname release "Linux" "2.6.18.8-0.1-default" version
    >> nodename "#1 SMP Fri Mar 2 13:51:59 UTC 2007" "viggo"
    >> machine login "x86_64" "pd" user "pd"
    >> 
    >> 
    >> 
    >> The latter should be the actual build used in the current
    >> beta tarball (which is what you used, right?).
    >> 
    >> I would suspect one of the following:
    >> 
    >> - RHEL compilers - over-optimizing compiler settings -
    >> system blas/lapack libraries - system glibc
    >> 
    >> but Brian probably has more concrete information.
    >> 
    >>> Prof Brian Ripley wrote:
    >>> 
    >>> 
    >>>> We are only aware of better behaviour from LAPACK 3.1
    >>>> (which is what I suppose you are talking about, that is
    >>>> R compiled with its internal LAPACK).
    >>>> 
    >>>> But in at least one case that means finding a complex
    >>>> set of eigenvalues where previously a real one was
    >>>> found.
    >>>> 
    >>>> On Tue, 10 Apr 2007, Paul Gilbert wrote:
    >>>> 
    >>>> 
    >>>>> I am having some trouble with a case where eigen in
    >>>>> R-beta gives a different largest value than in
    >>>>> previous versions of R. Other values seem to be the
    >>>>> same. Before I spend too much time, is anyone aware of
    >>>>> a problem (symmetric = FALSE, only.values = TRUE).
    >>>>> 
    >>>>> Paul Gilbert
    >>>>> ====================================================================================
    >>>>> 
    >>>>> 
    >>>>> La version fran?aise suit le texte anglais.
    >>>>> 
    >>>>> ------------------------------------------------------------------------------------
    >>>>> 
    >>>>> 
    >>>>> This email may contain privileged and/or confidential
    >>>>> inform...{{dropped}}
    >>>>> 
    >>>>> ______________________________________________
    >>>>> R-devel at r-project.org mailing list
    >>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
    >>>>> 
    >>>>> 
    >>> ====================================================================================
    >>> 
    >>> La version fran?aise suit le texte anglais.
    >>> 
    >>> ------------------------------------------------------------------------------------
    >>> 
    >>> This email may contain privileged and/or confidential
    >>> inform...{{dropped}}
    >>> 
    >>> ______________________________________________
    >>> R-devel at r-project.org mailing list
    >>> https://stat.ethz.ch/mailman/listinfo/r-devel
    >>> 
    >>  ______________________________________________
    >> R-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 

    BDR> -- Brian D. Ripley, ripley at stats.ox.ac.uk Professor of
    BDR> Applied Statistics, http://www.stats.ox.ac.uk/~ripley/
    BDR> University of Oxford, Tel: +44 1865 272861 (self) 1
    BDR> South Parks Road, +44 1865 272866 (PA) Oxford OX1 3TG,
    BDR> UK Fax: +44 1865
    BDR> 272595______________________________________________
    BDR> R-devel at r-project.org mailing list
    BDR> https://stat.ethz.ch/mailman/listinfo/r-devel


From sgiannerini at gmail.com  Wed Apr 11 12:40:42 2007
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Wed, 11 Apr 2007 12:40:42 +0200
Subject: [Rd] is.loaded() and dyn.load()
In-Reply-To: <Pine.LNX.4.64.0704051615580.21221@gannet.stats.ox.ac.uk>
References: <3c12769c0704050745o6145fef3r3633ac81e3a9e310@mail.gmail.com>
	<Pine.LNX.4.64.0704051615580.21221@gannet.stats.ox.ac.uk>
Message-ID: <3c12769c0704110340q11540387l6eeb5d2e425086db@mail.gmail.com>

Your aggressive tone would be inacceptable even if your comments were
relevant.

What's more they are not.

The point here is  that under Windows it is very likely that fortran
compiled code is not being properly loaded unless g77 is used, and that
is.loaded() would trigger  the dynamic loading. It is neither a matter of
underscores in variable names nor of  fixed form f77.

see the example below

I attach the FORTRAN 77 fixed form source file tryme.f which has been
compiled with Compaq Visual Fortran 6.6c3

# df tryme.f -dll -LINK -RELEASE

then, under R

> dyn.load("tryme.dll");


try.me <- function(X){
    S <- .Fortran("tryme",as.integer(X),S=as.integer(0))$S #
    return(S)
}

>  try.me(8)
Error in .Fortran("tryme", as.integer(X), S = as.integer(0)) :
        Fortran symbol name "tryme" not in load table
> is.loaded("tryme")
[1] TRUE
>  try.me(8)
[1] 9


The problem does not show up if g77 is used:

# g77 tryme.f -shared -s -otryme.dll

> dyn.load("tryme.dll");
> try.me(8)
[1] 9


The issue does not show up in my OpenSUSE 10.2 box with R patched compiled
with gfortran;


> dyn.load("tryme.dll");
>
> try.me <- function(X){
+     S <- .Fortran("tryme",as.integer(X),S=as.integer(0))$S
+     return(S)
+ }
>
> try.me(8)
[1] 9


> unlist(R.Version())
                                     platform
                   "x86_64-unknown-linux-gnu"
                                         arch
                                     "x86_64"
                                           os
                                  "linux-gnu"
                                       system
                          "x86_64, linux-gnu"
                                       status
                                    "Patched"
                                        major
                                          "2"
                                        minor
                                        "4.1"
                                         year
                                       "2007"
                                        month
                                         "03"
                                          day
                                         "20"
                                      svn rev
                                      "40858"
                                     language
                                          "R"
                               version.string
"R version 2.4.1 Patched (2007-03-20 r40858)"


All this regardless of the kind of Fortran language used and independently
from the presence of underscores in variable names.

Besided this IMHO it might be interesting to discuss in this list the issues
related to Fortran 90/95 and the use of different compilers in view of a
possible complete support from R also considered that
1. under Linux gfortan is now the default compiler for gcc>4.0.0
2. switching back to F77 might  **not** be an option for many people.

My intention here was also to provide the community with some feedback on
this but it is hard to have a proper discussion
in these conditions.

Kind regards,

Simone Giannerini

On 4/5/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>
> Did you read the comments under ?.Fortran about this?  What you are doing
> is quite explicitly said not to be supported.
>
> gfortran is not a supported Fortran compiler for R for Windows 2.4.1.
> It behaves differently from the supported g77.
> The behaviour is adapted to the compiler used when configure is used, and
> on Windows that is what the maintainers used, not you are using.  If you
> follow the advice not to use underscores in names you are much less likely
> to confuse yourself and produce portable code.
>
> On Thu, 5 Apr 2007, Simone Giannerini wrote:
>
> > Dear all,
> >
> > I am puzzled at the behaviour of is.loaded() when a dyn.load() call to a
> a
> > FORTRAN shared library is included in a file to be sourced.
> > A reproducible example is the following:
> >
> > 1. the attached fortran subroutine try_it.f90 performs a summation of
> the
> > elements of a REAL*8 vector
> > compile with
> >
> > gfortran try_it.f90 -shared -s -otry_it.dll
> >
> > 2. create a file to be sourced (see the attached try_it.R) containing
> the
> > following commands:
> >
> > BEGIN try_it.R ************************************
> > dyn.load("try_it.dll");
> >
> >
> > try.it <- function(X){
> >   N <- length(X);
> >   S <- .Fortran("try_it_",as.double(X),as.integer(N),S=as.double(0))$S
> >   return(S)
> > }
> > END try_it.R ************************************
> >
> >
> > 3. Switch to R
> >
> >> source("try_it.R")
> >> try.it(1:10)
> > Error in .Fortran("try_it_", as.double(X), as.integer(N), S = as.double
> (0))
> > :
> >       Fortran symbol name "try_it_" not in load table
> >> is.loaded("try_it_")
> > [1] TRUE
> >> try.it(1:10)
> > [1] 55
> >>
> > it looks like is.loaded() triggers the loading, inserting
> > is.loaded("try_it_")in
> > the file try_it.R does the trick but
> > is this behaviour expected?
> >
> > Thank you,
> >
> > Regards
> >
> > Simone
> >
> >> R.version
> >              _
> > platform       i386-pc-mingw32
> > arch           i386
> > os             mingw32
> > system         i386, mingw32
> > status
> > major          2
> > minor          4.1
> > year           2006
> > month          12
> > day            18
> > svn rev        40228
> > language       R
> > version.string R version 2.4.1 (2006-12-18)
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>



-- 
______________________________________________________

Simone Giannerini
Dipartimento di Scienze Statistiche "Paolo Fortunati"
Universita' di Bologna
Via delle belle arti 41 - 40126  Bologna,  ITALY
Tel: +39 051 2098262  Fax: +39 051 232153
______________________________________________________

From joehl at web.de  Wed Apr 11 12:40:51 2007
From: joehl at web.de (=?iso-8859-15?Q?Jens_Oehlschl=E4gel?=)
Date: Wed, 11 Apr 2007 12:40:51 +0200
Subject: [Rd] =?iso-8859-15?q?package_incompatibility_under_2=2E5=2E0_=28p?=
 =?iso-8859-15?q?lease_respond_directly=2C_I_am_not_on_r-devel=29?=
Message-ID: <761028988@web.de>

Dear all,

For my package "ref" I have implemented extensive regression testing. It now fails to compile since primitives "dim" and "dimnames" (and their assignment methods) no longer allow for additional arguments. I was using an additional argument "ref" with several methods. For "].refdata" it still works, with "dim.refdata" no longer. Could you please allow for additional arguments for the following generic functions (or primitives):

dim <- function (x, ...)
UseMethod("dim")

"dim<-" <- function (x, ..., value)
UseMethod("dim<-")

dimnames <- function (x, ...)
UseMethod("dimnames")

"dimnames<-" <- function (x, ..., value)
UseMethod("dimnames<-")

row.names <- function (x, ...)
UseMethod("row.names")

"row.names<-" <- function (x, ..., value)
UseMethod("row.names<-")

names <- function (x, ...)
UseMethod("names")

"names<-" <- function (x, ..., value)
UseMethod("names<-")

BTW: why does get("dim") returns 
function (x) .Primitive("dim")
and args() works on it, 
while get("[") returns
.Primitive("[")
and args() doesn't work on it? 

Furthermore, until now "rownames", "colnames" have been convenience wrappers for "dimnames". Consequently implementing "dimnames" and "dimnames<-" would indirectly implement "rownames", "colnames" and their assignment methods. This no longer works for classes inheriting from "data.frame" because the assignment methods no longer work via "dimnames<-". I can imagine that this change breaks existing code in other packages as well - without formally throwing errors at package check time (as I said, I have unusually strict regression testing included in the example section, that other packages may not have). If it is really necessary to treat data.frames differently, I'd recommend to change "rownames" and "colnames" accordingly, in order to have symmetry between accessor and assignment functions. That would mean defining "names" and "row.names" and their assignment methods for any classes inheriting from data.frame, instead of "dimnames", correct? Maybe *all* package maintainers should be warned about this or R CMD CHECK should check whether anyone defines "dimnames" or "dimnames<-" for any class inheriting from "data.frame".

Best regards


Jens Oehlschl?gel



> -----Urspr?ngliche Nachricht-----
> Von: Uwe.Ligges at R-Project.org
> Gesendet: 08.04.07 16:50:29
> An: joehl at web.de
> CC: Uwe.Ligges at R-Project.org,olafm at kimberly.tako.de
> Betreff: Package ref_0.92.tar.gz did not pass R CMD check


> Dear package maintainer,
> 
> this notification has been generated automatically.
> Your package ref_0.92.tar.gz did not pass 'R CMD check' on
> Windows and will be omitted from the corresponding CRAN directory
> (CRAN/bin/windows/contrib/2.5/).
> Please check the attached log-file and consider to resubmit a version
> with increased version number that passes R CMD check on Windows.
> R version 2.5.0 alpha (2007-04-05 r41063)
> 
> All the best,
> Uwe Ligges
> (Maintainer of binary packages for Windows)
> 
> 
> <hr>
> * using log directory 'd:/Rcompile/CRANpkg/local/2.5/ref.Rcheck'
> * using R version 2.5.0 alpha (2007-04-05 r41063)
> * checking for file 'ref/DESCRIPTION' ... OK
> * this is package 'ref' version '0.92'
> * checking package dependencies ... OK
> * checking if this is a source package ... OK
> * checking whether package 'ref' can be installed ... OK
> * checking package directory ... OK
> * checking for portable file names ... OK
> * checking DESCRIPTION meta-information ... OK
> * checking top-level files ... OK
> * checking index information ... OK
> * checking package subdirectories ... OK
> * checking R files for non-ASCII characters ... OK
> * checking R files for syntax errors ... OK
> * checking whether the package can be loaded ... OK
> * checking whether the package can be loaded with stated dependencies ... OK
> * checking for unstated dependencies in R code ... OK
> * checking S3 generic/method consistency ... WARNING
> dim:
> function(x)
> dim.refdata:
> function(x, ref)
> 
> dimnames:
> function(x)
> dimnames.refdata:
> function(x, ref)
> 
> dimnames<-:
> function(x, value)
> dimnames<-.refdata:
> function(x, ref, value)
> 
> See section 'Generic functions and methods' of the 'Writing R Extensions'
> manual.
> * checking replacement functions ... OK
> * checking foreign function calls ... OK
> * checking R code for possible problems ... OK
> * checking Rd files ... OK
> * checking Rd cross-references ... OK
> * checking for missing documentation entries ... OK
> * checking for code/documentation mismatches ... OK
> * checking Rd \usage sections ... OK
> * creating ref-Ex.R ... OK
> * checking examples ... ERROR
> Running examples in 'ref-Ex.R' failed.
> The error most likely occurred in:
> 
> > ### * refdata
> > 
> > flush(stderr()); flush(stdout())
> > 
> > ### Name: refdata
> > ### Title: subsettable reference to matrix or data.frame
> > ### Aliases: refdata [.refdata [<-.refdata [[.refdata [[<-.refdata
> > ### $.refdata $<-.refdata dim.refdata dim<-.refdata dimnames.refdata
> > ### dimnames<-.refdata print.refdata
> > ### Keywords: programming manip
> > 
> > ### ** Examples
> > 
> > 
> > ## Simple usage Example
> > x <- cbind(1:5, 5:1) # take a matrix or data frame
> > rx <- refdata(x) # wrap it into an refdata object
> > rx # see the autoprinting
> refdata (matrix) with [5,2] of [5,2]
> use x[] to get the complete actual subset
> use x[...] for standard extraction
> use x[..., ref=TRUE] to get a newly indexed refdata object
> use x[...] <- value to overwrite x with a refdata object containing a new env containing a modified dataset
> use x[..., ref=TRUE] <- value to modify the original dataset
> > rm(x) # delete original to save memory
> > rx[] # extract all data
> [,1] [,2]
> [1,] 1 5
> [2,] 2 4
> [3,] 3 3
> [4,] 4 2
> [5,] 5 1
> > rx[-1, ] # extract part of data
> [,1] [,2]
> [1,] 2 4
> [2,] 3 3
> [3,] 4 2
> [4,] 5 1
> > rx2 <- rx[-1, , ref=TRUE] # create refdata object referencing part of data (only index, no data is duplicated)
> > rx2 # compare autoprinting
> refdata (matrix) with [4,2] of [5,2]
> use x[] to get the complete actual subset
> use x[...] for standard extraction
> use x[..., ref=TRUE] to get a newly indexed refdata object
> use x[...] <- value to overwrite x with a refdata object containing a new env containing a modified dataset
> use x[..., ref=TRUE] <- value to modify the original dataset
> > rx2[] # extract 'all' data
> [,1] [,2]
> [1,] 2 4
> [2,] 3 3
> [3,] 4 2
> [4,] 5 1
> > rx2[-1, ] # extract part of (part of) data
> [,1] [,2]
> [1,] 3 3
> [2,] 4 2
> [3,] 5 1
> > cat("for more examples look the help pages\n")
> for more examples look the help pages
> > 
> > ## Not run: 
> > ##D # Memory saving demos
> > ##D square.matrix.size <- 1000
> > ##D recursion.depth.limit <- 10
> > ##D non.referenced.matrix <- matrix(1:(square.matrix.size*square.matrix.size), nrow=square.matrix.size, ncol=square.matrix.size)
> > ##D rownames(non.referenced.matrix) <- paste("a", seq(length=square.matrix.size), sep="")
> > ##D colnames(non.referenced.matrix) <- paste("b", seq(length=square.matrix.size), sep="")
> > ##D referenced.matrix <- refdata(non.referenced.matrix)
> > ##D recurse.nonref <- function(m, depth.limit=10){
> > ##D x <- m[1,1] # need read access here to create local copy
> > ##D gc()
> > ##D cat("depth.limit=", depth.limit, " memory.size=", memsize.wrapper(), "\n", sep="")
> > ##D if (depth.limit)
> > ##D Recall(m[-1, -1, drop=FALSE], depth.limit=depth.limit-1)
> > ##D invisible()
> > ##D }
> > ##D recurse.ref <- function(m, depth.limit=10){
> > ##D x <- m[1,1] # read access, otherwise nothing happens
> > ##D gc()
> > ##D cat("depth.limit=", depth.limit, " memory.size=", memsize.wrapper(), "\n", sep="")
> > ##D if (depth.limit)
> > ##D Recall(m[-1, -1, ref=TRUE], depth.limit=depth.limit-1)
> > ##D invisible()
> > ##D }
> > ##D gc()
> > ##D memsize.wrapper()
> > ##D recurse.ref(referenced.matrix, recursion.depth.limit)
> > ##D gc()
> > ##D memsize.wrapper()
> > ##D recurse.nonref(non.referenced.matrix, recursion.depth.limit)
> > ##D gc()
> > ##D memsize.wrapper()
> > ##D rm(recurse.nonref, recurse.ref, non.referenced.matrix, referenced.matrix, square.matrix.size, recursion.depth.limit)
> > ##D 
> > ## End(Not run)
> > cat("for even more examples look at regression.test.refdata()\n")
> for even more examples look at regression.test.refdata()
> > regression.test.refdata() # testing correctness of refdata functionality
> testing refdata with matrix
> Error in identical(dim(rx3, ref = TRUE), dim(x)) : 
> 2 arguments passed to 'dim' which requires 1
> Execution halted
> 
>


From rvivekrao at yahoo.com  Wed Apr 11 15:20:21 2007
From: rvivekrao at yahoo.com (Vivek Rao)
Date: Wed, 11 Apr 2007 06:20:21 -0700 (PDT)
Subject: [Rd] Fortran coding standards
Message-ID: <984221.73301.qm@web58301.mail.re3.yahoo.com>

I have some comments on the Fortran code in the
fseries package in file 4A-GarchModelling.f ,
especially the subroutine GARCHFIT and function
DSNORM.
I appended the code to the end of an earlier message,
but it was rejected by some rule. Let me first say
that I am grateful that packages for financial
econometrics exist in R.

Fortran 77 had PARAMETERs, and PARAMETERs equal to
99999 and 200 should have been defined instead of
repeatedly using "magic numbers". More importantly,
the code will fail if NN exceeds 99999, but the code
does not check for this. I hope someone will fix this.

In the code dsged the variables half, one, two should
be made parameters, and instead of 

      IMPLICIT DOUBLE PRECISION (A-H, O-Z)

      IMPLICIT NONE 

should be used and all variables declared. Although
IMPLICIT NONE is not standard Fortran 77, it is
standard Fortran 90 and is supported by g77.
Experienced Fortranners know that IMPLICIT NONE
catches errors. Another defect is the use of specific
intrinsic functions such as DSQRT. There is no need to
use this, since the SQRT function is generic, handling
both single and double precision arguments.

Maybe there should R coding standards to address such
issues. I hope that eventually the Fortran code in R
will use the modern features of Fortran 90 and later
standards, using the gfortran compiler. However, with
a little effort one can still write clean code in
Fortran 77 that also conforms to later standards.

Vivek Rao


       
____________________________________________________________________________________
Sucker-punch spam with award-winning protection.


From rvivekrao at yahoo.com  Wed Apr 11 15:28:53 2007
From: rvivekrao at yahoo.com (Vivek Rao)
Date: Wed, 11 Apr 2007 06:28:53 -0700 (PDT)
Subject: [Rd] Fortran coding standards
Message-ID: <783538.81701.qm@web58308.mail.re3.yahoo.com>

I have some comments on the Fortran code in the
fseries package in file 4A-GarchModelling.f ,
especially the subroutine GARCHFIT and function
DSNORM.
I appended the code to the end of an earlier message,
but it was rejected by some rule. Let me first say
that I am grateful that packages for financial
econometrics exist in R.

Fortran 77 had PARAMETERs, and PARAMETERs equal to
99999 and 200 should have been defined instead of
repeatedly using "magic numbers". More importantly,
the code will fail if NN exceeds 99999, but the code
does not check for this. I hope someone will fix this.

In the code dsged the variables half, one, two should
be made parameters, and instead of 

      IMPLICIT DOUBLE PRECISION (A-H, O-Z)

      IMPLICIT NONE 

should be used and all variables declared. Although
IMPLICIT NONE is not standard Fortran 77, it is
standard Fortran 90 and is supported by g77.
Experienced Fortranners know that IMPLICIT NONE
catches errors. Another defect is the use of specific
intrinsic functions such as DSQRT. There is no need to
use this, since the SQRT function is generic, handling
both single and double precision arguments.

Maybe there should R coding standards to address such
issues. I hope that eventually the Fortran code in R
will use the modern features of Fortran 90 and later
standards, using the gfortran compiler. However, with
a little effort one can still write clean code in
Fortran 77 that also conforms to later standards.

Vivek Rao


       
____________________________________________________________________________________
It's here! Your new message!  
Get new email alerts with the free Yahoo! Toolbar.


From ripley at stats.ox.ac.uk  Wed Apr 11 15:41:10 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 11 Apr 2007 14:41:10 +0100 (BST)
Subject: [Rd] Fortran coding standards
In-Reply-To: <984221.73301.qm@web58301.mail.re3.yahoo.com>
References: <984221.73301.qm@web58301.mail.re3.yahoo.com>
Message-ID: <Pine.LNX.4.64.0704111429070.30340@gannet.stats.ox.ac.uk>

On Wed, 11 Apr 2007, Vivek Rao wrote:

> I have some comments on the Fortran code in the
> fseries package in file 4A-GarchModelling.f ,
> especially the subroutine GARCHFIT and function
> DSNORM.
> I appended the code to the end of an earlier message,
> but it was rejected by some rule. Let me first say
> that I am grateful that packages for financial
> econometrics exist in R.

Please pass those on to the maintainer.

Note that currently we expect only Fortran 77 to be used in R and 
(preferably) its packages, as there still are users with a Fortran 77 
compiler and nothing later.  One major group are those on Windows, and it 
is hoped that that will move to gcc 4.2.x in 2007.  There are still quite 
a few users on OSes that are two or more years old and for which
gcc3 is the norm.

> Fortran 77 had PARAMETERs, and PARAMETERs equal to
> 99999 and 200 should have been defined instead of
> repeatedly using "magic numbers". More importantly,
> the code will fail if NN exceeds 99999, but the code
> does not check for this. I hope someone will fix this.
>
> In the code dsged the variables half, one, two should
> be made parameters, and instead of
>
>      IMPLICIT DOUBLE PRECISION (A-H, O-Z)
>
>      IMPLICIT NONE
>
> should be used and all variables declared. Although
> IMPLICIT NONE is not standard Fortran 77, it is
> standard Fortran 90 and is supported by g77.
> Experienced Fortranners know that IMPLICIT NONE
> catches errors. Another defect is the use of specific
> intrinsic functions such as DSQRT. There is no need to
> use this, since the SQRT function is generic, handling
> both single and double precision arguments.
>
> Maybe there should R coding standards to address such
> issues. I hope that eventually the Fortran code in R
> will use the modern features of Fortran 90 and later
> standards, using the gfortran compiler. However, with
> a little effort one can still write clean code in
> Fortran 77 that also conforms to later standards.

The Fortran code in R itself is (entirely, I think) imported from 
elsewhere, e.g. from EISPACK or LAPACK or Netlib.  We have little interest 
in changing long-established code, and as the recent thread 'eigen in 
beta' shows, everytime we update such code someone thinks there is a new 
bug in R.

The developer.r-project.org has a collection of references to encourage 
'portable programming', including on Fortran standards.

> Vivek Rao

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hin-tak.leung at cimr.cam.ac.uk  Wed Apr 11 15:55:07 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Wed, 11 Apr 2007 14:55:07 +0100
Subject: [Rd] Fortran coding standards
In-Reply-To: <783538.81701.qm@web58308.mail.re3.yahoo.com>
References: <783538.81701.qm@web58308.mail.re3.yahoo.com>
Message-ID: <461CE8BB.3000908@cimr.cam.ac.uk>

I am not familiar with fseries, nor the other routines you
mentioned, but can I make a few points:

(1) A good part of R's fortran code are "borrowed" from elsewhere.
When one is "borrowing", it is customary to keep deviation minimum
and strictly necessary i.e. bug-fixes only, and no re-indentation,
nor stylistic changes like many of those you outlined. All in all,
if you want to push for stylistic changes, you need to approach
the original writers.

(2) g77, gfortran are not the only fortran compilers out there!
"...it is standard Fortran 90 and is supported by g77", is just not
good enough - what do you mean by "...also conforms to later standards"?
Some piece of code is either fortran 77 conformant, or not
(i.e. *at least one* feature used are not).

(3) if it is not broken, don't try to fix it. It is possible to debate
on stylistic changes for eternity and not getting any real work done.

HTL

Vivek Rao wrote:
> I have some comments on the Fortran code in the
> fseries package in file 4A-GarchModelling.f ,
> especially the subroutine GARCHFIT and function
> DSNORM.
> I appended the code to the end of an earlier message,
> but it was rejected by some rule. Let me first say
> that I am grateful that packages for financial
> econometrics exist in R.
> 
> Fortran 77 had PARAMETERs, and PARAMETERs equal to
> 99999 and 200 should have been defined instead of
> repeatedly using "magic numbers". More importantly,
> the code will fail if NN exceeds 99999, but the code
> does not check for this. I hope someone will fix this.
> 
> In the code dsged the variables half, one, two should
> be made parameters, and instead of 
> 
>       IMPLICIT DOUBLE PRECISION (A-H, O-Z)
> 
>       IMPLICIT NONE 
> 
> should be used and all variables declared. Although
> IMPLICIT NONE is not standard Fortran 77, it is
> standard Fortran 90 and is supported by g77.
> Experienced Fortranners know that IMPLICIT NONE
> catches errors. Another defect is the use of specific
> intrinsic functions such as DSQRT. There is no need to
> use this, since the SQRT function is generic, handling
> both single and double precision arguments.
> 
> Maybe there should R coding standards to address such
> issues. I hope that eventually the Fortran code in R
> will use the modern features of Fortran 90 and later
> standards, using the gfortran compiler. However, with
> a little effort one can still write clean code in
> Fortran 77 that also conforms to later standards.
> 
> Vivek Rao
> 
> 
>        
> ____________________________________________________________________________________
> It's here! Your new message!  
> Get new email alerts with the free Yahoo! Toolbar.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Wed Apr 11 15:56:11 2007
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 11 Apr 2007 15:56:11 +0200
Subject: [Rd] Fortran coding standards
In-Reply-To: <984221.73301.qm@web58301.mail.re3.yahoo.com>
References: <984221.73301.qm@web58301.mail.re3.yahoo.com>
Message-ID: <17948.59643.441339.830488@stat.math.ethz.ch>

Hi Vivek,

>>>>> "Vivek" == Vivek Rao <rvivekrao at yahoo.com>
>>>>>     on Wed, 11 Apr 2007 06:20:21 -0700 (PDT) writes:

    Vivek> I have some comments on the Fortran code in the
    Vivek> fseries package in file 4A-GarchModelling.f ,

this is "fSeries" {and case does matter in R - contrary to Fortran :-)}
a CRAN-contributed package which has a well-defined maintainer 
whom you can quickly find using

  packageDescription("fSeries")

Further, he might not read R-devel on a regular basis at all ..

    Vivek> especially the subroutine GARCHFIT and function
    Vivek> DSNORM.
    Vivek> I appended the code to the end of an earlier message,
    Vivek> but it was rejected by some rule. 

you (i.e. your mailer) must have used an unspecified binary
mime-type; do use  "text/plain" instead  and the attachments
won't be filtered.

    Vivek> Let me first say that I am grateful that packages for
    Vivek> financial econometrics exist in R.

    Vivek> Fortran 77 had PARAMETERs, and PARAMETERs equal to
    Vivek> 99999 and 200 should have been defined instead of
    Vivek> repeatedly using "magic numbers". More importantly,
    Vivek> the code will fail if NN exceeds 99999, but the code
    Vivek> does not check for this. I hope someone will fix this.

    Vivek> In the code dsged the variables half, one, two should
    Vivek> be made parameters, and instead of 

    Vivek> IMPLICIT DOUBLE PRECISION (A-H, O-Z)

    Vivek> IMPLICIT NONE 

    Vivek> should be used and all variables declared. Although
    Vivek> IMPLICIT NONE is not standard Fortran 77, it is
    Vivek> standard Fortran 90 and is supported by g77.
    Vivek> Experienced Fortranners know that IMPLICIT NONE
    Vivek> catches errors. Another defect is the use of specific
    Vivek> intrinsic functions such as DSQRT. There is no need to
    Vivek> use this, since the SQRT function is generic, handling
    Vivek> both single and double precision arguments.

    Vivek> Maybe there should R coding standards to address such
    Vivek> issues. I hope that eventually the Fortran code in R
    Vivek> will use the modern features of Fortran 90 and later
    Vivek> standards, using the gfortran compiler. However, with
    Vivek> a little effort one can still write clean code in
    Vivek> Fortran 77 that also conforms to later standards.

I mostly agree with all you say above.

But we (R-core) have never wanted to play style-police for the
1000++ CRAN / bioconductor / omegahat R packages that other
people provide.

As core team we only feel responsible for the code that we
distribute with the R distribution, and even there, the so-called
recommended ("non-core") packages typically have their own
individual maintainer.
I'd say, R-core would typically follow your recommendations
above,  apart from the fact that most of us would not use
Fortran for developing new code.
And for legacy code that is well tested with many years of
history, we'd rarely want to spend the time just for beautifying
code (though I occasionally have done so, when wanting to find
      out what the code was doing at all).

Martin Maechler, ETH Zurich


From sfalcon at fhcrc.org  Wed Apr 11 16:49:39 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Wed, 11 Apr 2007 07:49:39 -0700
Subject: [Rd] Sort output of apropos
Message-ID: <m2abxfufss.fsf@fhcrc.org>

A further improvement to apropos() would be to sort the output.
Currently, the output of apropos is in the order found on the search
list and this will rarely be useful to the user.

All that is needed is a sort(x) at the end of the function.

+ seth

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From pgilbert at bank-banque-canada.ca  Wed Apr 11 16:51:22 2007
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Wed, 11 Apr 2007 10:51:22 -0400
Subject: [Rd] eigen in beta
In-Reply-To: <Pine.LNX.4.64.0704110734210.1007@gannet.stats.ox.ac.uk>
References: <461BCE69.2020409@bank-banque-canada.ca>
	<Pine.LNX.4.64.0704101854560.32417@gannet.stats.ox.ac.uk>
	<461BD7E9.1050200@bank-banque-canada.ca>
	<461BEDCB.7090805@biostat.ku.dk>
	<Pine.LNX.4.64.0704110734210.1007@gannet.stats.ox.ac.uk>
Message-ID: <461CF5EA.4050001@bank-banque-canada.ca>

Hmmm.  It is a bit disconcerting that make check passes and I can get a 
fairly seriously wrong answer. Perhaps this test could be added to make 
check. Whether or not the one answer is correct may be questionable, but 
there is no question that

  prod(eigen(z, symmetric = FALSE, only.values = TRUE)$values ) *
  prod(eigen(solve(z), symmetric = FALSE, only.values = TRUE)$values )
   [1] 1.01677-0i

is wrong. (The product of the determinants should equal the determinant 
of the product, and the determinant of I is 1.)

On this machine I am using GNU Fortran (GCC 3.2.3 20030502 (Red Hat 
Linux 3.2.3-54)) 3.2.3 20030502 (Red Hat Linux 3.2.3-54),  which is a 
bit old but not really old. (I am using gcc 4.1.1 on my home machine, 
but the failing machine is suppose to be fairly new and "supported." 
(There is an OS upgrade planned.)  Should I really be thinking of this 
as an old compiler?  Is the compiler the most likely problem or is it 
possible I have a bad BLAS configuration, or something else? Previous 
versions of R have compiled without problems on this machine. (I am 
never very sure where to find all the information to report for a 
problem like this. Is there a simple way to get all the relevant 
information?)

Paul Gilbert

Prof Brian Ripley wrote:
> All the systems I tried this on give the 'correct' answer, including
>
> x86_64 Linux, FC5 (gcc 4.1.1)
> i686 Linux, FC5
> ix86 Windows (both gcc 3.4.5 and gcc pre-4.3.0)
> Sparc Solaris, with gcc3, gcc4 and SunPro compilers.
>
> Mainly with R 2.5.0 beta, some with R-devel (where the code is 
> unchanged).
>
> We have seen problems specific to RHEL's Fortran compilers on x86_64 
> several times before. I would strongly recommend compiler updates.
>
>
> On Tue, 10 Apr 2007, Peter Dalgaard wrote:
>
>> Paul Gilbert wrote:
>>> Here is the example. Pehaps others could check on other platforms. 
>>> It is
>>> only the first eigenvalue that is different.  I am relatively sure the
>>> old values are correct, since I compare with an alternate calculation
>>> using the expansion of a polynomial determinant.
>>>
>>>
>>> z <- t(matrix(c(
>>>  0, 0, 0, 0, 0, 0, 0, 0, 0, -0.0064083373167516857,
>>> -0.14786612501440565826,  0.368411802235074137,
>>>  0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0568624483195125444,
>>> 0.08575928008564302762, -0.101993668348446601,
>>>  0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0039684327579889069,
>>> -0.00002857482925046247,  0.202241897806646448,
>>>  1, 0, 0, 0, 0, 0, 0, 0, 0, -0.0222834092601282285,
>>> -0.09126708346036176145,  0.644249961695308682,
>>>  0, 1, 0, 0, 0, 0, 0, 0, 0, -0.0032676036920228878,
>>> 0.16985862929849462888,  0.057282326361118636,
>>>  0, 0, 1, 0, 0, 0, 0, 0, 0,  0.0148488735227452068,
>>> -0.06175528918915401677,  0.109566197834008949,
>>>  0, 0, 0, 1, 0, 0, 0, 0, 0, -0.0392756265125193960,
>>> 0.04921079262665441212,  0.078176878215115805,
>>>  0, 0, 0, 0, 1, 0, 0, 0, 0, -0.0013937451966661973,
>>> 0.02009823693764142133, -0.207228935136287512,
>>>  0, 0, 0, 0, 0, 1, 0, 0, 0,  0.0273358858605219357,
>>> 0.03830466468488327725,  0.224426004034737836,
>>>  0, 0, 0, 0, 0, 0, 1, 0, 0, -0.1456426235151105919,
>>> 0.28688029213315069388,  0.326933845656016908,
>>>  0, 0, 0, 0, 0, 0, 0, 1, 0,  0.0164670122082246559,
>>> -0.21966261349875662590,  0.036404179329694988,
>>>  0, 0, 0, 0, 0, 0, 0, 0, 1,  0.0146156940584119890,
>>> 0.07505490943478997090,  0.077660578370038813
>>>  ), 12, 12))
>>>
>>>
>>> R-2.5.0 gives
>>> >  eigen(z, symmetric = FALSE, only.values = TRUE)$values
>>>  [1]  0.8465266+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
>>>  [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
>>>  [7]  0.6177419+0.0000000i -0.5604582+0.1958709i -0.5604582-0.1958709i
>>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>>>
>>> R-2.4.1 and many, many previous versions gave
>>> >  eigen(z, symmetric = FALSE, only.values = TRUE)$values
>>>  [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
>>>  [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
>>>  [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
>>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>>>
>>> Sys.info()
>>>                              sysname                              
>>> release
>>>                              "Linux"                    
>>> "2.4.21-40.ELsmp"
>>>                              version                             
>>> nodename
>>> "#1 SMP Thu Feb 2 22:13:55 EST 2006"                           
>>> "mfa04559"
>>>                              machine
>>>                             "x86_64"
>>>
>>> Paul Gilbert
>> Hmm, I don't get that
>>
>>> version$version.string
>> [1] "R version 2.5.0 beta (2007-04-10 r41105)"
>>> eigen(z, symmetric = FALSE, only.values = TRUE)$values
>> [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
>> [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
>> [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>>> Sys.info()
>>                              sysname                               
>> release
>>                              "Linux"                   
>> "2.6.20-1.2933.fc6"
>>                              version                              
>> nodename
>> "#1 SMP Mon Mar 19 11:38:26 EDT 2007"              
>> "titmouse2.kubism.ku.dk"
>>                              machine                                 
>> login
>>                               "i686"                                  
>> "pd"
>>                                 user
>>                                 "pd"
>>
>>
>>
>> And
>>
>>> version$version.string
>> [1] "R version 2.5.0 beta (2007-04-09 r41098)"
>>>  eigen(z, symmetric = FALSE, only.values = TRUE)$values
>> [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
>> [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
>> [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>>> Sys.info()
>>                             sysname                              release
>>                             "Linux"               "2.6.18.8-0.1-default"
>>                             version                             nodename
>> "#1 SMP Fri Mar 2 13:51:59 UTC 2007"                              
>> "viggo"
>>                             machine                                login
>>                            "x86_64"                                 "pd"
>>                                user
>>                                "pd"
>>
>>
>>
>> The latter should be the actual build used in the current beta tarball
>> (which is what you used, right?).
>>
>> I would suspect one of the following:
>>
>> - RHEL compilers
>> - over-optimizing compiler settings
>> - system blas/lapack libraries
>> - system glibc
>>
>> but Brian probably has more concrete information.
>>
>>> Prof Brian Ripley wrote:
>>>
>>>
>>>> We are only aware of better behaviour from LAPACK 3.1 (which is what I
>>>> suppose you are talking about, that is R compiled with its internal
>>>> LAPACK).
>>>>
>>>> But in at least one case that means finding a complex set of
>>>> eigenvalues where previously a real one was found.
>>>>
>>>> On Tue, 10 Apr 2007, Paul Gilbert wrote:
>>>>
>>>>
>>>>> I am having some trouble with a case where  eigen in R-beta  gives a
>>>>> different largest value than in previous versions of R. Other values
>>>>> seem to be the same. Before I spend too much time, is anyone aware 
>>>>> of a
>>>>> problem (symmetric = FALSE, only.values = TRUE).
>>>>>
>>>>> Paul Gilbert
>>>>> ==================================================================================== 
>>>>>
>>>>>
>>>>>
>>>>> La version fran?aise suit le texte anglais.
>>>>>
>>>>> ------------------------------------------------------------------------------------ 
>>>>>
>>>>>
>>>>>
>>>>> This email may contain privileged and/or confidential
>>>>> inform...{{dropped}}
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>>
>>> ==================================================================================== 
>>>
>>>
>>> La version fran?aise suit le texte anglais.
>>>
>>> ------------------------------------------------------------------------------------ 
>>>
>>>
>>> This email may contain privileged and/or confidential 
>>> inform...{{dropped}}
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From ripley at stats.ox.ac.uk  Wed Apr 11 17:00:26 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 11 Apr 2007 16:00:26 +0100 (BST)
Subject: [Rd] eigen in beta
In-Reply-To: <461CF5EA.4050001@bank-banque-canada.ca>
References: <461BCE69.2020409@bank-banque-canada.ca>
	<Pine.LNX.4.64.0704101854560.32417@gannet.stats.ox.ac.uk>
	<461BD7E9.1050200@bank-banque-canada.ca>
	<461BEDCB.7090805@biostat.ku.dk>
	<Pine.LNX.4.64.0704110734210.1007@gannet.stats.ox.ac.uk>
	<461CF5EA.4050001@bank-banque-canada.ca>
Message-ID: <Pine.LNX.4.64.0704111555430.28108@gannet.stats.ox.ac.uk>

On Wed, 11 Apr 2007, Paul Gilbert wrote:

> Hmmm.  It is a bit disconcerting that make check passes and I can get a 
> fairly seriously wrong answer. Perhaps this test could be added to make 
> check.

Well, you have learnt something new about software engineering!  'make 
check' is supposed to test the operation of R, not compilers.

> Whether or not the one answer is correct may be questionable, but 
> there is no question that
>
> prod(eigen(z, symmetric = FALSE, only.values = TRUE)$values ) *
> prod(eigen(solve(z), symmetric = FALSE, only.values = TRUE)$values )
>  [1] 1.01677-0i
>
> is wrong. (The product of the determinants should equal the determinant of 
> the product, and the determinant of I is 1.)
>
> On this machine I am using GNU Fortran (GCC 3.2.3 20030502 (Red Hat Linux 
> 3.2.3-54)) 3.2.3 20030502 (Red Hat Linux 3.2.3-54),  which is a bit old but 
> not really old. (I am using gcc 4.1.1 on my home machine, but the failing 
> machine is suppose to be fairly new and "supported." (There is an OS upgrade 
> planned.)  Should I really be thinking of this as an old compiler?  Is the

Yes, a known bad compiler, as searching the list archives would have 
found out.  Don't use anything older that gcc 3.4.x on x86_64 Linux.

> compiler the most likely problem or is it possible I have a bad BLAS 
> configuration, or something else? Previous versions of R have compiled 
> without problems on this machine. (I am never very sure where to find all the 
> information to report for a problem like this. Is there a simple way to get 
> all the relevant information?)
>
> Paul Gilbert
>
> Prof Brian Ripley wrote:
>> All the systems I tried this on give the 'correct' answer, including
>> 
>> x86_64 Linux, FC5 (gcc 4.1.1)
>> i686 Linux, FC5
>> ix86 Windows (both gcc 3.4.5 and gcc pre-4.3.0)
>> Sparc Solaris, with gcc3, gcc4 and SunPro compilers.
>> 
>> Mainly with R 2.5.0 beta, some with R-devel (where the code is unchanged).
>> 
>> We have seen problems specific to RHEL's Fortran compilers on x86_64 
>> several times before. I would strongly recommend compiler updates.
>> 
>> 
>> On Tue, 10 Apr 2007, Peter Dalgaard wrote:
>> 
>>> Paul Gilbert wrote:
>>>> Here is the example. Pehaps others could check on other platforms. It is
>>>> only the first eigenvalue that is different.  I am relatively sure the
>>>> old values are correct, since I compare with an alternate calculation
>>>> using the expansion of a polynomial determinant.
>>>> 
>>>> 
>>>> z <- t(matrix(c(
>>>>  0, 0, 0, 0, 0, 0, 0, 0, 0, -0.0064083373167516857,
>>>> -0.14786612501440565826,  0.368411802235074137,
>>>>  0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0568624483195125444,
>>>> 0.08575928008564302762, -0.101993668348446601,
>>>>  0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0039684327579889069,
>>>> -0.00002857482925046247,  0.202241897806646448,
>>>>  1, 0, 0, 0, 0, 0, 0, 0, 0, -0.0222834092601282285,
>>>> -0.09126708346036176145,  0.644249961695308682,
>>>>  0, 1, 0, 0, 0, 0, 0, 0, 0, -0.0032676036920228878,
>>>> 0.16985862929849462888,  0.057282326361118636,
>>>>  0, 0, 1, 0, 0, 0, 0, 0, 0,  0.0148488735227452068,
>>>> -0.06175528918915401677,  0.109566197834008949,
>>>>  0, 0, 0, 1, 0, 0, 0, 0, 0, -0.0392756265125193960,
>>>> 0.04921079262665441212,  0.078176878215115805,
>>>>  0, 0, 0, 0, 1, 0, 0, 0, 0, -0.0013937451966661973,
>>>> 0.02009823693764142133, -0.207228935136287512,
>>>>  0, 0, 0, 0, 0, 1, 0, 0, 0,  0.0273358858605219357,
>>>> 0.03830466468488327725,  0.224426004034737836,
>>>>  0, 0, 0, 0, 0, 0, 1, 0, 0, -0.1456426235151105919,
>>>> 0.28688029213315069388,  0.326933845656016908,
>>>>  0, 0, 0, 0, 0, 0, 0, 1, 0,  0.0164670122082246559,
>>>> -0.21966261349875662590,  0.036404179329694988,
>>>>  0, 0, 0, 0, 0, 0, 0, 0, 1,  0.0146156940584119890,
>>>> 0.07505490943478997090,  0.077660578370038813
>>>>  ), 12, 12))
>>>> 
>>>> 
>>>> R-2.5.0 gives
>>>> >  eigen(z, symmetric = FALSE, only.values = TRUE)$values
>>>>  [1]  0.8465266+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
>>>>  [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
>>>>  [7]  0.6177419+0.0000000i -0.5604582+0.1958709i -0.5604582-0.1958709i
>>>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>>>> 
>>>> R-2.4.1 and many, many previous versions gave
>>>> >  eigen(z, symmetric = FALSE, only.values = TRUE)$values
>>>>  [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
>>>>  [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
>>>>  [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
>>>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>>>> 
>>>> Sys.info()
>>>>                              sysname                              release
>>>>                              "Linux"                    "2.4.21-40.ELsmp"
>>>>                              version                             nodename
>>>> "#1 SMP Thu Feb 2 22:13:55 EST 2006"                           "mfa04559"
>>>>                              machine
>>>>                             "x86_64"
>>>> 
>>>> Paul Gilbert
>>> Hmm, I don't get that
>>> 
>>>> version$version.string
>>> [1] "R version 2.5.0 beta (2007-04-10 r41105)"
>>>> eigen(z, symmetric = FALSE, only.values = TRUE)$values
>>> [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
>>> [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
>>> [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
>>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>>>> Sys.info()
>>>                              sysname                               release
>>>                              "Linux"                   "2.6.20-1.2933.fc6"
>>>                              version                              nodename
>>> "#1 SMP Mon Mar 19 11:38:26 EDT 2007" 
>>> "titmouse2.kubism.ku.dk"
>>>                              machine                                 login
>>>                               "i686"                                  "pd"
>>>                                 user
>>>                                 "pd"
>>> 
>>> 
>>> 
>>> And
>>> 
>>>> version$version.string
>>> [1] "R version 2.5.0 beta (2007-04-09 r41098)"
>>>>  eigen(z, symmetric = FALSE, only.values = TRUE)$values
>>> [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
>>> [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
>>> [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
>>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>>>> Sys.info()
>>>                             sysname                              release
>>>                             "Linux"               "2.6.18.8-0.1-default"
>>>                             version                             nodename
>>> "#1 SMP Fri Mar 2 13:51:59 UTC 2007"                              "viggo"
>>>                             machine                                login
>>>                            "x86_64"                                 "pd"
>>>                                user
>>>                                "pd"
>>> 
>>> 
>>> 
>>> The latter should be the actual build used in the current beta tarball
>>> (which is what you used, right?).
>>> 
>>> I would suspect one of the following:
>>> 
>>> - RHEL compilers
>>> - over-optimizing compiler settings
>>> - system blas/lapack libraries
>>> - system glibc
>>> 
>>> but Brian probably has more concrete information.
>>> 
>>>> Prof Brian Ripley wrote:
>>>> 
>>>> 
>>>>> We are only aware of better behaviour from LAPACK 3.1 (which is what I
>>>>> suppose you are talking about, that is R compiled with its internal
>>>>> LAPACK).
>>>>> 
>>>>> But in at least one case that means finding a complex set of
>>>>> eigenvalues where previously a real one was found.
>>>>> 
>>>>> On Tue, 10 Apr 2007, Paul Gilbert wrote:
>>>>> 
>>>>> 
>>>>>> I am having some trouble with a case where  eigen in R-beta  gives a
>>>>>> different largest value than in previous versions of R. Other values
>>>>>> seem to be the same. Before I spend too much time, is anyone aware of a
>>>>>> problem (symmetric = FALSE, only.values = TRUE).
>>>>>> 
>>>>>> Paul Gilbert
>>>>>> ==================================================================================== 
>>>>>> 
>>>>>> 
>>>>>> La version fran?aise suit le texte anglais.
>>>>>>
>>>>>> 
>>>>>> ------------------------------------------------------------------------------------ 
>>>>>> 
>>>>>> 
>>>>>> This email may contain privileged and/or confidential
>>>>>> inform...{{dropped}}
>>>>>> 
>>>>>> ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>> 
>>>>>> 
>>>> ==================================================================================== 
>>>> 
>>>> La version fran?aise suit le texte anglais.
>>>>
>>>> 
>>>> ------------------------------------------------------------------------------------ 
>>>> 
>>>> This email may contain privileged and/or confidential 
>>>> inform...{{dropped}}
>>>> 
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>> 
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>> 
> ====================================================================================
>
> La version fran?aise suit le texte anglais.
>
> ------------------------------------------------------------------------------------
>
> This email may contain privileged and/or confidential information, and the 
> Bank of
> Canada does not waive any related rights. Any distribution, use, or copying 
> of this
> email or the information it contains by other than the intended recipient is
> unauthorized. If you received this email in error please delete it 
> immediately from
> your system and notify the sender promptly by email that you have done so. 
> ------------------------------------------------------------------------------------
>
> Le pr?sent courriel peut contenir de l'information privil?gi?e ou 
> confidentielle.
> La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute 
> diffusion,
> utilisation ou copie de ce courriel ou des renseignements qu'il contient par 
> une
> personne autre que le ou les destinataires d?sign?s est interdite. Si vous 
> recevez
> ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer sans 
> d?lai ?
> l'exp?diteur un message ?lectronique pour l'aviser que vous avez ?limin? de 
> votre
> ordinateur toute copie du courriel re?u.
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From pgilbert at bank-banque-canada.ca  Wed Apr 11 17:47:57 2007
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Wed, 11 Apr 2007 11:47:57 -0400
Subject: [Rd] eigen in beta
In-Reply-To: <Pine.LNX.4.64.0704111555430.28108@gannet.stats.ox.ac.uk>
References: <461BCE69.2020409@bank-banque-canada.ca>
	<Pine.LNX.4.64.0704101854560.32417@gannet.stats.ox.ac.uk>
	<461BD7E9.1050200@bank-banque-canada.ca>
	<461BEDCB.7090805@biostat.ku.dk>
	<Pine.LNX.4.64.0704110734210.1007@gannet.stats.ox.ac.uk>
	<461CF5EA.4050001@bank-banque-canada.ca>
	<Pine.LNX.4.64.0704111555430.28108@gannet.stats.ox.ac.uk>
Message-ID: <461D032D.40304@bank-banque-canada.ca>

Prof Brian Ripley wrote:
> On Wed, 11 Apr 2007, Paul Gilbert wrote:
>> Hmmm.  It is a bit disconcerting that make check passes and I can get 
>> a fairly seriously wrong answer. Perhaps this test could be added to 
>> make check.
> Well, you have learnt something new about software engineering!  'make 
> check' is supposed to test the operation of R, not compilers.
I'm not sure I would call this engineering. Engineers are suppose to 
worry about the integrity of the whole system.  In any case, if it is 
not make check,  then what is the system for checking that you have a 
good R build?
>
>> Whether or not the one answer is correct may be questionable, but 
>> there is no question that
>>
>> prod(eigen(z, symmetric = FALSE, only.values = TRUE)$values ) *
>> prod(eigen(solve(z), symmetric = FALSE, only.values = TRUE)$values )
>>  [1] 1.01677-0i
>>
>> is wrong. (The product of the determinants should equal the 
>> determinant of the product, and the determinant of I is 1.)
>>
>> On this machine I am using GNU Fortran (GCC 3.2.3 20030502 (Red Hat 
>> Linux 3.2.3-54)) 3.2.3 20030502 (Red Hat Linux 3.2.3-54),  which is a 
>> bit old but not really old. (I am using gcc 4.1.1 on my home machine, 
>> but the failing machine is suppose to be fairly new and "supported." 
>> (There is an OS upgrade planned.)  Should I really be thinking of 
>> this as an old compiler?  Is the
>
> Yes, a known bad compiler, as searching the list archives would have 
> found out.  Don't use anything older that gcc 3.4.x on x86_64 Linux.
Thanks, I'll bug the sys admin.

Paul
>
>> compiler the most likely problem or is it possible I have a bad BLAS 
>> configuration, or something else? Previous versions of R have 
>> compiled without problems on this machine. (I am never very sure 
>> where to find all the information to report for a problem like this. 
>> Is there a simple way to get all the relevant information?)
>>
>> Paul Gilbert
>>
>> Prof Brian Ripley wrote:
>>> All the systems I tried this on give the 'correct' answer, including
>>>
>>> x86_64 Linux, FC5 (gcc 4.1.1)
>>> i686 Linux, FC5
>>> ix86 Windows (both gcc 3.4.5 and gcc pre-4.3.0)
>>> Sparc Solaris, with gcc3, gcc4 and SunPro compilers.
>>>
>>> Mainly with R 2.5.0 beta, some with R-devel (where the code is 
>>> unchanged).
>>>
>>> We have seen problems specific to RHEL's Fortran compilers on x86_64 
>>> several times before. I would strongly recommend compiler updates.
>>>
>>>
>>> On Tue, 10 Apr 2007, Peter Dalgaard wrote:
>>>
>>>> Paul Gilbert wrote:
>>>>> Here is the example. Pehaps others could check on other platforms. 
>>>>> It is
>>>>> only the first eigenvalue that is different.  I am relatively sure 
>>>>> the
>>>>> old values are correct, since I compare with an alternate calculation
>>>>> using the expansion of a polynomial determinant.
>>>>>
>>>>>
>>>>> z <- t(matrix(c(
>>>>>  0, 0, 0, 0, 0, 0, 0, 0, 0, -0.0064083373167516857,
>>>>> -0.14786612501440565826,  0.368411802235074137,
>>>>>  0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0568624483195125444,
>>>>> 0.08575928008564302762, -0.101993668348446601,
>>>>>  0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0039684327579889069,
>>>>> -0.00002857482925046247,  0.202241897806646448,
>>>>>  1, 0, 0, 0, 0, 0, 0, 0, 0, -0.0222834092601282285,
>>>>> -0.09126708346036176145,  0.644249961695308682,
>>>>>  0, 1, 0, 0, 0, 0, 0, 0, 0, -0.0032676036920228878,
>>>>> 0.16985862929849462888,  0.057282326361118636,
>>>>>  0, 0, 1, 0, 0, 0, 0, 0, 0,  0.0148488735227452068,
>>>>> -0.06175528918915401677,  0.109566197834008949,
>>>>>  0, 0, 0, 1, 0, 0, 0, 0, 0, -0.0392756265125193960,
>>>>> 0.04921079262665441212,  0.078176878215115805,
>>>>>  0, 0, 0, 0, 1, 0, 0, 0, 0, -0.0013937451966661973,
>>>>> 0.02009823693764142133, -0.207228935136287512,
>>>>>  0, 0, 0, 0, 0, 1, 0, 0, 0,  0.0273358858605219357,
>>>>> 0.03830466468488327725,  0.224426004034737836,
>>>>>  0, 0, 0, 0, 0, 0, 1, 0, 0, -0.1456426235151105919,
>>>>> 0.28688029213315069388,  0.326933845656016908,
>>>>>  0, 0, 0, 0, 0, 0, 0, 1, 0,  0.0164670122082246559,
>>>>> -0.21966261349875662590,  0.036404179329694988,
>>>>>  0, 0, 0, 0, 0, 0, 0, 0, 1,  0.0146156940584119890,
>>>>> 0.07505490943478997090,  0.077660578370038813
>>>>>  ), 12, 12))
>>>>>
>>>>>
>>>>> R-2.5.0 gives
>>>>> >  eigen(z, symmetric = FALSE, only.values = TRUE)$values
>>>>>  [1]  0.8465266+0.0000000i -0.0280087+0.6244992i 
>>>>> -0.0280087-0.6244992i
>>>>>  [4] -0.2908409+0.5522274i -0.2908409-0.5522274i 
>>>>> -0.6228929+0.0000000i
>>>>>  [7]  0.6177419+0.0000000i -0.5604582+0.1958709i 
>>>>> -0.5604582-0.1958709i
>>>>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  
>>>>> 0.3378356+0.0000000i
>>>>>
>>>>> R-2.4.1 and many, many previous versions gave
>>>>> >  eigen(z, symmetric = FALSE, only.values = TRUE)$values
>>>>>  [1]  0.8794798+0.0000000i -0.0280087+0.6244992i 
>>>>> -0.0280087-0.6244992i
>>>>>  [4] -0.2908409+0.5522274i -0.2908409-0.5522274i 
>>>>> -0.6228929+0.0000000i
>>>>>  [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  
>>>>> 0.5847887+0.0000000i
>>>>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  
>>>>> 0.3378356+0.0000000i
>>>>>
>>>>> Sys.info()
>>>>>                              sysname                              
>>>>> release
>>>>>                              "Linux"                    
>>>>> "2.4.21-40.ELsmp"
>>>>>                              version                             
>>>>> nodename
>>>>> "#1 SMP Thu Feb 2 22:13:55 EST 2006"                           
>>>>> "mfa04559"
>>>>>                              machine
>>>>>                             "x86_64"
>>>>>
>>>>> Paul Gilbert
>>>> Hmm, I don't get that
>>>>
>>>>> version$version.string
>>>> [1] "R version 2.5.0 beta (2007-04-10 r41105)"
>>>>> eigen(z, symmetric = FALSE, only.values = TRUE)$values
>>>> [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
>>>> [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
>>>> [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
>>>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>>>>> Sys.info()
>>>>                              sysname                               
>>>> release
>>>>                              "Linux"                   
>>>> "2.6.20-1.2933.fc6"
>>>>                              version                              
>>>> nodename
>>>> "#1 SMP Mon Mar 19 11:38:26 EDT 2007" "titmouse2.kubism.ku.dk"
>>>>                              
>>>> machine                                 login
>>>>                               
>>>> "i686"                                  "pd"
>>>>                                 user
>>>>                                 "pd"
>>>>
>>>>
>>>>
>>>> And
>>>>
>>>>> version$version.string
>>>> [1] "R version 2.5.0 beta (2007-04-09 r41098)"
>>>>>  eigen(z, symmetric = FALSE, only.values = TRUE)$values
>>>> [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
>>>> [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
>>>> [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
>>>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>>>>> Sys.info()
>>>>                             sysname                              
>>>> release
>>>>                             "Linux"               
>>>> "2.6.18.8-0.1-default"
>>>>                             version                             
>>>> nodename
>>>> "#1 SMP Fri Mar 2 13:51:59 UTC 2007"                              
>>>> "viggo"
>>>>                             machine                                
>>>> login
>>>>                            "x86_64"                                 
>>>> "pd"
>>>>                                user
>>>>                                "pd"
>>>>
>>>>
>>>>
>>>> The latter should be the actual build used in the current beta tarball
>>>> (which is what you used, right?).
>>>>
>>>> I would suspect one of the following:
>>>>
>>>> - RHEL compilers
>>>> - over-optimizing compiler settings
>>>> - system blas/lapack libraries
>>>> - system glibc
>>>>
>>>> but Brian probably has more concrete information.
>>>>
>>>>> Prof Brian Ripley wrote:
>>>>>
>>>>>
>>>>>> We are only aware of better behaviour from LAPACK 3.1 (which is 
>>>>>> what I
>>>>>> suppose you are talking about, that is R compiled with its internal
>>>>>> LAPACK).
>>>>>>
>>>>>> But in at least one case that means finding a complex set of
>>>>>> eigenvalues where previously a real one was found.
>>>>>>
>>>>>> On Tue, 10 Apr 2007, Paul Gilbert wrote:
>>>>>>
>>>>>>
>>>>>>> I am having some trouble with a case where  eigen in R-beta  
>>>>>>> gives a
>>>>>>> different largest value than in previous versions of R. Other 
>>>>>>> values
>>>>>>> seem to be the same. Before I spend too much time, is anyone 
>>>>>>> aware of a
>>>>>>> problem (symmetric = FALSE, only.values = TRUE).
>>>>>>>
>>>>>>> Paul Gilbert
>>>>>>> ==================================================================================== 
>>>>>>>
>>>>>>>
>>>>>>> La version fran?aise suit le texte anglais.
>>>>>>>
>>>>>>>
>>>>>>> ------------------------------------------------------------------------------------ 
>>>>>>>
>>>>>>>
>>>>>>> This email may contain privileged and/or confidential
>>>>>>> inform...{{dropped}}
>>>>>>>
>>>>>>> ______________________________________________
>>>>>>> R-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>>
>>>>>>>
>>>>> ==================================================================================== 
>>>>>
>>>>> La version fran?aise suit le texte anglais.
>>>>>
>>>>>
>>>>> ------------------------------------------------------------------------------------ 
>>>>>
>>>>> This email may contain privileged and/or confidential 
>>>>> inform...{{dropped}}
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>> ==================================================================================== 
>>
>>
>> La version fran?aise suit le texte anglais.
>>
>> ------------------------------------------------------------------------------------ 
>>
>>
>> This email may contain privileged and/or confidential information, 
>> and the Bank of
>> Canada does not waive any related rights. Any distribution, use, or 
>> copying of this
>> email or the information it contains by other than the intended 
>> recipient is
>> unauthorized. If you received this email in error please delete it 
>> immediately from
>> your system and notify the sender promptly by email that you have 
>> done so. 
>> ------------------------------------------------------------------------------------ 
>>
>>
>> Le pr?sent courriel peut contenir de l'information privil?gi?e ou 
>> confidentielle.
>> La Banque du Canada ne renonce pas aux droits qui s'y rapportent. 
>> Toute diffusion,
>> utilisation ou copie de ce courriel ou des renseignements qu'il 
>> contient par une
>> personne autre que le ou les destinataires d?sign?s est interdite. Si 
>> vous recevez
>> ce courriel par erreur, veuillez le supprimer imm?diatement et 
>> envoyer sans d?lai ?
>> l'exp?diteur un message ?lectronique pour l'aviser que vous avez 
>> ?limin? de votre
>> ordinateur toute copie du courriel re?u.
>>
>
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From maechler at stat.math.ethz.ch  Wed Apr 11 17:53:17 2007
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 11 Apr 2007 17:53:17 +0200
Subject: [Rd] eigen in beta
In-Reply-To: <461CF5EA.4050001@bank-banque-canada.ca>
References: <461BCE69.2020409@bank-banque-canada.ca>
	<Pine.LNX.4.64.0704101854560.32417@gannet.stats.ox.ac.uk>
	<461BD7E9.1050200@bank-banque-canada.ca>
	<461BEDCB.7090805@biostat.ku.dk>
	<Pine.LNX.4.64.0704110734210.1007@gannet.stats.ox.ac.uk>
	<461CF5EA.4050001@bank-banque-canada.ca>
Message-ID: <17949.1133.668179.769813@stat.math.ethz.ch>

>>>>> "PaulG" == Paul Gilbert <pgilbert at bank-banque-canada.ca>
>>>>>     on Wed, 11 Apr 2007 10:51:22 -0400 writes:

    PaulG> Hmmm.  It is a bit disconcerting that make check passes and I can get a 
    PaulG> fairly seriously wrong answer. Perhaps this test could be added to make 
    PaulG> check. 

Yes.  If I set

 EV <- function(x) eigen(x, symmetric = FALSE, only.values = TRUE)$values
 dDet <- function(x) prod(EV(x))

something like

 (pp <- dDet(z) * dDet(solve(z)))
 all.equal(pp, 1 + 0i)

Can you see the problem also with e.g.,

   z. <- round(z, 4)
or even
   z. <- round(z * 100)

that would make the example code slightly nicer "to the eye"
...

   
    PaulG> check. Whether or not the one answer is correct may be questionable, but 
    PaulG> there is no question that

    PaulG> prod(eigen(z, symmetric = FALSE, only.values = TRUE)$values ) *
    PaulG> prod(eigen(solve(z), symmetric = FALSE, only.values = TRUE)$values )
    PaulG> [1] 1.01677-0i

    PaulG> is wrong. (The product of the determinants should equal the determinant 
    PaulG> of the product, and the determinant of I is 1.)

yes, indeed (included in my code above)


    PaulG> On this machine I am using GNU Fortran (GCC 3.2.3 20030502 (Red Hat 
    PaulG> Linux 3.2.3-54)) 3.2.3 20030502 (Red Hat Linux 3.2.3-54),  which is a 
    PaulG> bit old but not really old. (I am using gcc 4.1.1 on my home machine, 
    PaulG> but the failing machine is suppose to be fairly new and "supported." 
    PaulG> (There is an OS upgrade planned.)  

I'd say your OS version (using a 2.4 kernel) is quite old indeed.

    PaulG> Should I really be thinking of this  as an old compiler?

maybe not old, but buggy?

    PaulG>   Is the compiler the most likely problem or is it
    PaulG> possible I have a bad BLAS configuration, or
    PaulG> something else? Previous versions of R have compiled
    PaulG> without problems on this machine. (I am never very
    PaulG> sure where to find all the information to report for
    PaulG> a problem like this. Is there a simple way to get all
    PaulG> the relevant information?)

"simple" yes: the config.log file in your build directory,
	 but that's typically much more than you'd want in a
	 specific case, i.e. contains much more than just the
	 relevant information.

Regards,
Martin


    PaulG> Paul Gilbert

    PaulG> Prof Brian Ripley wrote:
    >> All the systems I tried this on give the 'correct' answer, including
    >> 
    >> x86_64 Linux, FC5 (gcc 4.1.1)
    >> i686 Linux, FC5
    >> ix86 Windows (both gcc 3.4.5 and gcc pre-4.3.0)
    >> Sparc Solaris, with gcc3, gcc4 and SunPro compilers.
    >> 
    >> Mainly with R 2.5.0 beta, some with R-devel (where the code is 
    >> unchanged).
    >> 
    >> We have seen problems specific to RHEL's Fortran compilers on x86_64 
    >> several times before. I would strongly recommend compiler updates.
    >> 
    >> 
    >> On Tue, 10 Apr 2007, Peter Dalgaard wrote:
    >> 
    >>> Paul Gilbert wrote:
    >>>> Here is the example. Pehaps others could check on other platforms. 
    >>>> It is
    >>>> only the first eigenvalue that is different.  I am relatively sure the
    >>>> old values are correct, since I compare with an alternate calculation
    >>>> using the expansion of a polynomial determinant.
    >>>> 
    >>>> 
    >>>> z <- t(matrix(c(
    >>>> 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.0064083373167516857,
    >>>> -0.14786612501440565826,  0.368411802235074137,
    >>>> 0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0568624483195125444,
    >>>> 0.08575928008564302762, -0.101993668348446601,
    >>>> 0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0039684327579889069,
    >>>> -0.00002857482925046247,  0.202241897806646448,
    >>>> 1, 0, 0, 0, 0, 0, 0, 0, 0, -0.0222834092601282285,
    >>>> -0.09126708346036176145,  0.644249961695308682,
    >>>> 0, 1, 0, 0, 0, 0, 0, 0, 0, -0.0032676036920228878,
    >>>> 0.16985862929849462888,  0.057282326361118636,
    >>>> 0, 0, 1, 0, 0, 0, 0, 0, 0,  0.0148488735227452068,
    >>>> -0.06175528918915401677,  0.109566197834008949,
    >>>> 0, 0, 0, 1, 0, 0, 0, 0, 0, -0.0392756265125193960,
    >>>> 0.04921079262665441212,  0.078176878215115805,
    >>>> 0, 0, 0, 0, 1, 0, 0, 0, 0, -0.0013937451966661973,
    >>>> 0.02009823693764142133, -0.207228935136287512,
    >>>> 0, 0, 0, 0, 0, 1, 0, 0, 0,  0.0273358858605219357,
    >>>> 0.03830466468488327725,  0.224426004034737836,
    >>>> 0, 0, 0, 0, 0, 0, 1, 0, 0, -0.1456426235151105919,
    >>>> 0.28688029213315069388,  0.326933845656016908,
    >>>> 0, 0, 0, 0, 0, 0, 0, 1, 0,  0.0164670122082246559,
    >>>> -0.21966261349875662590,  0.036404179329694988,
    >>>> 0, 0, 0, 0, 0, 0, 0, 0, 1,  0.0146156940584119890,
    >>>> 0.07505490943478997090,  0.077660578370038813
    >>>> ), 12, 12))
    >>>> 
    >>>> 
    >>>> R-2.5.0 gives
    >>>> >  eigen(z, symmetric = FALSE, only.values = TRUE)$values
    >>>> [1]  0.8465266+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
    >>>> [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
    >>>> [7]  0.6177419+0.0000000i -0.5604582+0.1958709i -0.5604582-0.1958709i
    >>>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
    >>>> 
    >>>> R-2.4.1 and many, many previous versions gave
    >>>> >  eigen(z, symmetric = FALSE, only.values = TRUE)$values
    >>>> [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
    >>>> [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
    >>>> [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
    >>>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
    >>>> 
    >>>> Sys.info()
    >>>> sysname                              
    >>>> release
    >>>> "Linux"                    
    >>>> "2.4.21-40.ELsmp"
    >>>> version                             
    >>>> nodename
    >>>> "#1 SMP Thu Feb 2 22:13:55 EST 2006"                           
    >>>> "mfa04559"
    >>>> machine
    >>>> "x86_64"
    >>>> 
    >>>> Paul Gilbert
    >>> Hmm, I don't get that
    >>> 
    >>>> version$version.string
    >>> [1] "R version 2.5.0 beta (2007-04-10 r41105)"
    >>>> eigen(z, symmetric = FALSE, only.values = TRUE)$values
    >>> [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
    >>> [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
    >>> [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
    >>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
    >>>> Sys.info()
    >>> sysname                               
    >>> release
    >>> "Linux"                   
    >>> "2.6.20-1.2933.fc6"
    >>> version                              
    >>> nodename
    >>> "#1 SMP Mon Mar 19 11:38:26 EDT 2007"              
    >>> "titmouse2.kubism.ku.dk"
    >>> machine                                 
    >>> login
    >>> "i686"                                  
    >>> "pd"
    >>> user
    >>> "pd"
    >>> 
    >>> 
    >>> 
    >>> And
    >>> 
    >>>> version$version.string
    >>> [1] "R version 2.5.0 beta (2007-04-09 r41098)"
    >>>> eigen(z, symmetric = FALSE, only.values = TRUE)$values
    >>> [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
    >>> [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
    >>> [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
    >>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
    >>>> Sys.info()
    >>> sysname                              release
    >>> "Linux"               "2.6.18.8-0.1-default"
    >>> version                             nodename
    >>> "#1 SMP Fri Mar 2 13:51:59 UTC 2007"                              
    >>> "viggo"
    >>> machine                                login
    >>> "x86_64"                                 "pd"
    >>> user
    >>> "pd"
    >>> 
    >>> 
    >>> 
    >>> The latter should be the actual build used in the current beta tarball
    >>> (which is what you used, right?).
    >>> 
    >>> I would suspect one of the following:
    >>> 
    >>> - RHEL compilers
    >>> - over-optimizing compiler settings
    >>> - system blas/lapack libraries
    >>> - system glibc
    >>> 
    >>> but Brian probably has more concrete information.
    >>> 
    >>>> Prof Brian Ripley wrote:
    >>>> 
    >>>> 
    >>>>> We are only aware of better behaviour from LAPACK 3.1 (which is what I
    >>>>> suppose you are talking about, that is R compiled with its internal
    >>>>> LAPACK).
    >>>>> 
    >>>>> But in at least one case that means finding a complex set of
    >>>>> eigenvalues where previously a real one was found.
    >>>>> 
    >>>>> On Tue, 10 Apr 2007, Paul Gilbert wrote:
    >>>>> 
    >>>>> 
>>>>> I am having some trouble with a case where  eigen in R-beta  gives a
>>>>> different largest value than in previous versions of R. Other values
>>>>> seem to be the same. Before I spend too much time, is anyone aware 
>>>>> of a
>>>>> problem (symmetric = FALSE, only.values = TRUE).
    >>>>>> 
>>>>> Paul Gilbert
>>>>> ==================================================================================== 
    >>>>>> 
    >>>>>> 
    >>>>>> 
>>>>> La version fran?aise suit le texte anglais.
    >>>>>> 
>>>>> ------------------------------------------------------------------------------------ 
    >>>>>> 
    >>>>>> 
    >>>>>> 
>>>>> This email may contain privileged and/or confidential
>>>>> inform...{{dropped}}
    >>>>>> 
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
    >>>>>> 
    >>>>>> 
    >>>> ==================================================================================== 
    >>>> 
    >>>> 
    >>>> La version fran?aise suit le texte anglais.
    >>>> 
    >>>> ------------------------------------------------------------------------------------ 
    >>>> 
    >>>> 
    >>>> This email may contain privileged and/or confidential 
    >>>> inform...{{dropped}}
    >>>> 
    >>>> ______________________________________________
    >>>> R-devel at r-project.org mailing list
    >>>> https://stat.ethz.ch/mailman/listinfo/r-devel
    >>>> 
    >>> 
    >>> ______________________________________________
    >>> R-devel at r-project.org mailing list
    >>> https://stat.ethz.ch/mailman/listinfo/r-devel
    >>> 
    >> 
    PaulG> ====================================================================================

    PaulG> La version fran?aise suit le texte anglais.

    PaulG> ------------------------------------------------------------------------------------

    PaulG> This email may contain privileged and/or confidential information, and the Bank of
    PaulG> Canada does not waive any related rights. Any distribution, use, or copying of this
    PaulG> email or the information it contains by other than the intended recipient is
    PaulG> unauthorized. If you received this email in error please delete it immediately from
    PaulG> your system and notify the sender promptly by email that you have done so. 

    PaulG> ------------------------------------------------------------------------------------

    PaulG> Le pr?sent courriel peut contenir de l'information privil?gi?e ou confidentielle.
    PaulG> La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute diffusion,
    PaulG> utilisation ou copie de ce courriel ou des renseignements qu'il contient par une
    PaulG> personne autre que le ou les destinataires d?sign?s est interdite. Si vous recevez
    PaulG> ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer sans d?lai ?
    PaulG> l'exp?diteur un message ?lectronique pour l'aviser que vous avez ?limin? de votre
    PaulG> ordinateur toute copie du courriel re?u.


From p.dalgaard at biostat.ku.dk  Wed Apr 11 18:54:59 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 11 Apr 2007 18:54:59 +0200
Subject: [Rd] eigen in beta
In-Reply-To: <461D032D.40304@bank-banque-canada.ca>
References: <461BCE69.2020409@bank-banque-canada.ca>	<Pine.LNX.4.64.0704101854560.32417@gannet.stats.ox.ac.uk>	<461BD7E9.1050200@bank-banque-canada.ca>	<461BEDCB.7090805@biostat.ku.dk>	<Pine.LNX.4.64.0704110734210.1007@gannet.stats.ox.ac.uk>	<461CF5EA.4050001@bank-banque-canada.ca>	<Pine.LNX.4.64.0704111555430.28108@gannet.stats.ox.ac.uk>
	<461D032D.40304@bank-banque-canada.ca>
Message-ID: <461D12E3.5040206@biostat.ku.dk>

Paul Gilbert wrote:
> Prof Brian Ripley wrote:
>   
>> On Wed, 11 Apr 2007, Paul Gilbert wrote:
>>     
>>> Hmmm.  It is a bit disconcerting that make check passes and I can get 
>>> a fairly seriously wrong answer. Perhaps this test could be added to 
>>> make check.
>>>       
>> Well, you have learnt something new about software engineering!  'make 
>> check' is supposed to test the operation of R, not compilers.
>>     
> I'm not sure I would call this engineering. Engineers are suppose to 
> worry about the integrity of the whole system.  In any case, if it is 
> not make check,  then what is the system for checking that you have a 
> good R build?
>   

Well, there's make check-all... 

That doesn't check everything either, though. The point is that there is 
a limit to what we can check: We don't check whether the CPU gets 
floating point operations wrong in the 5th decimal place on rare 
occasions either. (Same thing applies to structural engineering: You 
can't test the chemical composition of every steel rod. At some point 
you have to shift reponsibility to your subcontractors.)

We do have regression checks though, i.e. we try to ensure that known 
errors do not reappear, and compiler issues have been worked around 
occasionally. E.g. (IIRC) the original qbeta() function was written so 
as to get the very last bit of accuracy squeezed out of the solution to 
a nonlinear equation, but modern optimizing compilers would reorder some 
instructions, losing a few bits of accuracy and sending  the code into 
an infinite loop in some cases.

    -pd


>>> Whether or not the one answer is correct may be questionable, but 
>>> there is no question that
>>>
>>> prod(eigen(z, symmetric = FALSE, only.values = TRUE)$values ) *
>>> prod(eigen(solve(z), symmetric = FALSE, only.values = TRUE)$values )
>>>  [1] 1.01677-0i
>>>
>>> is wrong. (The product of the determinants should equal the 
>>> determinant of the product, and the determinant of I is 1.)
>>>
>>> On this machine I am using GNU Fortran (GCC 3.2.3 20030502 (Red Hat 
>>> Linux 3.2.3-54)) 3.2.3 20030502 (Red Hat Linux 3.2.3-54),  which is a 
>>> bit old but not really old. (I am using gcc 4.1.1 on my home machine, 
>>> but the failing machine is suppose to be fairly new and "supported." 
>>> (There is an OS upgrade planned.)  Should I really be thinking of 
>>> this as an old compiler?  Is the
>>>       
>> Yes, a known bad compiler, as searching the list archives would have 
>> found out.  Don't use anything older that gcc 3.4.x on x86_64 Linux.
>>     
> Thanks, I'll bug the sys admin.
>
> Paul
>   
>>> compiler the most likely problem or is it possible I have a bad BLAS 
>>> configuration, or something else? Previous versions of R have 
>>> compiled without problems on this machine. (I am never very sure 
>>> where to find all the information to report for a problem like this. 
>>> Is there a simple way to get all the relevant information?)
>>>
>>> Paul Gilbert
>>>
>>> Prof Brian Ripley wrote:
>>>       
>>>> All the systems I tried this on give the 'correct' answer, including
>>>>
>>>> x86_64 Linux, FC5 (gcc 4.1.1)
>>>> i686 Linux, FC5
>>>> ix86 Windows (both gcc 3.4.5 and gcc pre-4.3.0)
>>>> Sparc Solaris, with gcc3, gcc4 and SunPro compilers.
>>>>
>>>> Mainly with R 2.5.0 beta, some with R-devel (where the code is 
>>>> unchanged).
>>>>
>>>> We have seen problems specific to RHEL's Fortran compilers on x86_64 
>>>> several times before. I would strongly recommend compiler updates.
>>>>
>>>>
>>>> On Tue, 10 Apr 2007, Peter Dalgaard wrote:
>>>>
>>>>         
>>>>> Paul Gilbert wrote:
>>>>>           
>>>>>> Here is the example. Pehaps others could check on other platforms. 
>>>>>> It is
>>>>>> only the first eigenvalue that is different.  I am relatively sure 
>>>>>> the
>>>>>> old values are correct, since I compare with an alternate calculation
>>>>>> using the expansion of a polynomial determinant.
>>>>>>
>>>>>>
>>>>>> z <- t(matrix(c(
>>>>>>  0, 0, 0, 0, 0, 0, 0, 0, 0, -0.0064083373167516857,
>>>>>> -0.14786612501440565826,  0.368411802235074137,
>>>>>>  0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0568624483195125444,
>>>>>> 0.08575928008564302762, -0.101993668348446601,
>>>>>>  0, 0, 0, 0, 0, 0, 0, 0, 0,  0.0039684327579889069,
>>>>>> -0.00002857482925046247,  0.202241897806646448,
>>>>>>  1, 0, 0, 0, 0, 0, 0, 0, 0, -0.0222834092601282285,
>>>>>> -0.09126708346036176145,  0.644249961695308682,
>>>>>>  0, 1, 0, 0, 0, 0, 0, 0, 0, -0.0032676036920228878,
>>>>>> 0.16985862929849462888,  0.057282326361118636,
>>>>>>  0, 0, 1, 0, 0, 0, 0, 0, 0,  0.0148488735227452068,
>>>>>> -0.06175528918915401677,  0.109566197834008949,
>>>>>>  0, 0, 0, 1, 0, 0, 0, 0, 0, -0.0392756265125193960,
>>>>>> 0.04921079262665441212,  0.078176878215115805,
>>>>>>  0, 0, 0, 0, 1, 0, 0, 0, 0, -0.0013937451966661973,
>>>>>> 0.02009823693764142133, -0.207228935136287512,
>>>>>>  0, 0, 0, 0, 0, 1, 0, 0, 0,  0.0273358858605219357,
>>>>>> 0.03830466468488327725,  0.224426004034737836,
>>>>>>  0, 0, 0, 0, 0, 0, 1, 0, 0, -0.1456426235151105919,
>>>>>> 0.28688029213315069388,  0.326933845656016908,
>>>>>>  0, 0, 0, 0, 0, 0, 0, 1, 0,  0.0164670122082246559,
>>>>>> -0.21966261349875662590,  0.036404179329694988,
>>>>>>  0, 0, 0, 0, 0, 0, 0, 0, 1,  0.0146156940584119890,
>>>>>> 0.07505490943478997090,  0.077660578370038813
>>>>>>  ), 12, 12))
>>>>>>
>>>>>>
>>>>>> R-2.5.0 gives
>>>>>>             
>>>>>>>  eigen(z, symmetric = FALSE, only.values = TRUE)$values
>>>>>>>               
>>>>>>  [1]  0.8465266+0.0000000i -0.0280087+0.6244992i 
>>>>>> -0.0280087-0.6244992i
>>>>>>  [4] -0.2908409+0.5522274i -0.2908409-0.5522274i 
>>>>>> -0.6228929+0.0000000i
>>>>>>  [7]  0.6177419+0.0000000i -0.5604582+0.1958709i 
>>>>>> -0.5604582-0.1958709i
>>>>>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  
>>>>>> 0.3378356+0.0000000i
>>>>>>
>>>>>> R-2.4.1 and many, many previous versions gave
>>>>>>             
>>>>>>>  eigen(z, symmetric = FALSE, only.values = TRUE)$values
>>>>>>>               
>>>>>>  [1]  0.8794798+0.0000000i -0.0280087+0.6244992i 
>>>>>> -0.0280087-0.6244992i
>>>>>>  [4] -0.2908409+0.5522274i -0.2908409-0.5522274i 
>>>>>> -0.6228929+0.0000000i
>>>>>>  [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  
>>>>>> 0.5847887+0.0000000i
>>>>>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  
>>>>>> 0.3378356+0.0000000i
>>>>>>
>>>>>> Sys.info()
>>>>>>                              sysname                              
>>>>>> release
>>>>>>                              "Linux"                    
>>>>>> "2.4.21-40.ELsmp"
>>>>>>                              version                             
>>>>>> nodename
>>>>>> "#1 SMP Thu Feb 2 22:13:55 EST 2006"                           
>>>>>> "mfa04559"
>>>>>>                              machine
>>>>>>                             "x86_64"
>>>>>>
>>>>>> Paul Gilbert
>>>>>>             
>>>>> Hmm, I don't get that
>>>>>
>>>>>           
>>>>>> version$version.string
>>>>>>             
>>>>> [1] "R version 2.5.0 beta (2007-04-10 r41105)"
>>>>>           
>>>>>> eigen(z, symmetric = FALSE, only.values = TRUE)$values
>>>>>>             
>>>>> [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
>>>>> [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
>>>>> [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
>>>>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>>>>>           
>>>>>> Sys.info()
>>>>>>             
>>>>>                              sysname                               
>>>>> release
>>>>>                              "Linux"                   
>>>>> "2.6.20-1.2933.fc6"
>>>>>                              version                              
>>>>> nodename
>>>>> "#1 SMP Mon Mar 19 11:38:26 EDT 2007" "titmouse2.kubism.ku.dk"
>>>>>                              
>>>>> machine                                 login
>>>>>                               
>>>>> "i686"                                  "pd"
>>>>>                                 user
>>>>>                                 "pd"
>>>>>
>>>>>
>>>>>
>>>>> And
>>>>>
>>>>>           
>>>>>> version$version.string
>>>>>>             
>>>>> [1] "R version 2.5.0 beta (2007-04-09 r41098)"
>>>>>           
>>>>>>  eigen(z, symmetric = FALSE, only.values = TRUE)$values
>>>>>>             
>>>>> [1]  0.8794798+0.0000000i -0.0280087+0.6244992i -0.0280087-0.6244992i
>>>>> [4] -0.2908409+0.5522274i -0.2908409-0.5522274i -0.6228929+0.0000000i
>>>>> [7] -0.5604582+0.1958709i -0.5604582-0.1958709i  0.5847887+0.0000000i
>>>>> [10]  0.1458799+0.4909300i  0.1458799-0.4909300i  0.3378356+0.0000000i
>>>>>           
>>>>>> Sys.info()
>>>>>>             
>>>>>                             sysname                              
>>>>> release
>>>>>                             "Linux"               
>>>>> "2.6.18.8-0.1-default"
>>>>>                             version                             
>>>>> nodename
>>>>> "#1 SMP Fri Mar 2 13:51:59 UTC 2007"                              
>>>>> "viggo"
>>>>>                             machine                                
>>>>> login
>>>>>                            "x86_64"                                 
>>>>> "pd"
>>>>>                                user
>>>>>                                "pd"
>>>>>
>>>>>
>>>>>
>>>>> The latter should be the actual build used in the current beta tarball
>>>>> (which is what you used, right?).
>>>>>
>>>>> I would suspect one of the following:
>>>>>
>>>>> - RHEL compilers
>>>>> - over-optimizing compiler settings
>>>>> - system blas/lapack libraries
>>>>> - system glibc
>>>>>
>>>>> but Brian probably has more concrete information.
>>>>>
>>>>>           
>>>>>> Prof Brian Ripley wrote:
>>>>>>
>>>>>>
>>>>>>             
>>>>>>> We are only aware of better behaviour from LAPACK 3.1 (which is 
>>>>>>> what I
>>>>>>> suppose you are talking about, that is R compiled with its internal
>>>>>>> LAPACK).
>>>>>>>
>>>>>>> But in at least one case that means finding a complex set of
>>>>>>> eigenvalues where previously a real one was found.
>>>>>>>
>>>>>>> On Tue, 10 Apr 2007, Paul Gilbert wrote:
>>>>>>>
>>>>>>>
>>>>>>>               
>>>>>>>> I am having some trouble with a case where  eigen in R-beta  
>>>>>>>> gives a
>>>>>>>> different largest value than in previous versions of R. Other 
>>>>>>>> values
>>>>>>>> seem to be the same. Before I spend too much time, is anyone 
>>>>>>>> aware of a
>>>>>>>> problem (symmetric = FALSE, only.values = TRUE).
>>>>>>>>
>>>>>>>> Paul Gilbert
>>>>>>>> ==================================================================================== 
>>>>>>>>
>>>>>>>>
>>>>>>>> La version fran?aise suit le texte anglais.
>>>>>>>>
>>>>>>>>
>>>>>>>> ------------------------------------------------------------------------------------ 
>>>>>>>>
>>>>>>>>
>>>>>>>> This email may contain privileged and/or confidential
>>>>>>>> inform...{{dropped}}
>>>>>>>>
>>>>>>>> ______________________________________________
>>>>>>>> R-devel at r-project.org mailing list
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>>>
>>>>>>>>
>>>>>>>>                 
>>>>>> ==================================================================================== 
>>>>>>
>>>>>> La version fran?aise suit le texte anglais.
>>>>>>
>>>>>>
>>>>>> ------------------------------------------------------------------------------------ 
>>>>>>
>>>>>> This email may contain privileged and/or confidential 
>>>>>> inform...{{dropped}}
>>>>>>
>>>>>> ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>
>>>>>>             
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>>           
>>> ==================================================================================== 
>>>
>>>
>>> La version fran?aise suit le texte anglais.
>>>
>>> ------------------------------------------------------------------------------------ 
>>>
>>>
>>> This email may contain privileged and/or confidential information, 
>>> and the Bank of
>>> Canada does not waive any related rights. Any distribution, use, or 
>>> copying of this
>>> email or the information it contains by other than the intended 
>>> recipient is
>>> unauthorized. If you received this email in error please delete it 
>>> immediately from
>>> your system and notify the sender promptly by email that you have 
>>> done so. 
>>> ------------------------------------------------------------------------------------ 
>>>
>>>
>>> Le pr?sent courriel peut contenir de l'information privil?gi?e ou 
>>> confidentielle.
>>> La Banque du Canada ne renonce pas aux droits qui s'y rapportent. 
>>> Toute diffusion,
>>> utilisation ou copie de ce courriel ou des renseignements qu'il 
>>> contient par une
>>> personne autre que le ou les destinataires d?sign?s est interdite. Si 
>>> vous recevez
>>> ce courriel par erreur, veuillez le supprimer imm?diatement et 
>>> envoyer sans d?lai ?
>>> l'exp?diteur un message ?lectronique pour l'aviser que vous avez 
>>> ?limin? de votre
>>> ordinateur toute copie du courriel re?u.
>>>
>>>       
> ====================================================================================
>
> La version fran?aise suit le texte anglais.
>
> ------------------------------------------------------------------------------------
>
> This email may contain privileged and/or confidential inform...{{dropped}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From tplate at acm.org  Wed Apr 11 19:29:42 2007
From: tplate at acm.org (Tony Plate)
Date: Wed, 11 Apr 2007 11:29:42 -0600
Subject: [Rd] accessing hidden functions in testing code
Message-ID: <461D1B06.9020308@acm.org>

I'd like to be able to access unexported functions in the testing code 
for a package with a namespace.  I know that one way to do this is to 
use the ":::" operator, but I'd prefer to avoid cluttering up my testing 
code with lots of repetitions of "myPackageName:::".

One way I found to do this was to attach() the namespace of the package, 
e.g., using the following:

pkg <- "myPackageName"
library(package=pkg, character.only=TRUE)
## --- Load the name space to allow testing of private functions ---
if (is.element(pkg, loadedNamespaces()))
     attach(loadNamespace(pkg), name=paste("namespace", pkg, sep=":"), 
pos=3)


Are there any pitfalls that I will find if I continue with this 
approach?  Or is there another better way?

-- Tony Plate


From pgilbert at bank-banque-canada.ca  Wed Apr 11 19:53:12 2007
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Wed, 11 Apr 2007 13:53:12 -0400
Subject: [Rd] eigen in beta
In-Reply-To: <461D12E3.5040206@biostat.ku.dk>
References: <461BCE69.2020409@bank-banque-canada.ca>	<Pine.LNX.4.64.0704101854560.32417@gannet.stats.ox.ac.uk>	<461BD7E9.1050200@bank-banque-canada.ca>	<461BEDCB.7090805@biostat.ku.dk>	<Pine.LNX.4.64.0704110734210.1007@gannet.stats.ox.ac.uk>	<461CF5EA.4050001@bank-banque-canada.ca>	<Pine.LNX.4.64.0704111555430.28108@gannet.stats.ox.ac.uk>
	<461D032D.40304@bank-banque-canada.ca>
	<461D12E3.5040206@biostat.ku.dk>
Message-ID: <461D2088.1070802@bank-banque-canada.ca>

Peter Dalgaard wrote:
....
> Well, there's make check-all...
Ok, this is what I should be running.  It reports
....
running tests of LAPACK-based functions
make[3]: Entering directory `/home/mfa/gilp/toolchain/R/src/R-beta/tests'
running code in 'lapack.R' ...make[3]: *** [lapack.Rout] Error 1
make[3]: Leaving directory `/home/mfa/gilp/toolchain/R/src/R-beta/tests'
make[2]: *** [test-Lapack] Error 2
make[2]: Leaving directory `/home/mfa/gilp/toolchain/R/src/R-beta/tests'
make[1]: *** [test-all-devel] Error 1
make[1]: Leaving directory `/home/mfa/gilp/toolchain/R/src/R-beta/tests'
make: *** [check-all] Error 2
~/toolchain/R/src/R-beta:
and   lapack.Rout.fail  reports
....
 > ## failed for some 64bit-Lapack-gcc combinations:
 > sm <- cbind(1, 3:1, 1:3)
 > eigenok(sm, eigen(sm))
Error: abs(A %*% V - V %*% diag(lam)) < Eps is not all TRUE
Execution halted
> That doesn't check everything either, though. The point is that there 
> is a limit to what we can check: We don't check whether the CPU gets 
> floating point operations wrong in the 5th decimal place on rare 
> occasions either.  ...
Well, I'm talking about 3 to 4% in the maximum eigenvalue, in a problem 
that I don't think is especially ill-conditioned.  There are not many 
more fundamental calculations in statistics.  And all I am asking is 
that the problem gets reported, I'm not asking for a work around. I 
clearly need to fix something other than R on the system.

I guess it is difficult to know at what level problems should be 
flagged.  I don't think many people run make check-all.  Some 
calculation errors seem bad enough that plain "make" should catch them 
and not suggest there was a successful build.  It would do R's 
reputation a lot of damage if people used and reported the results of 
such bad calculations.

It might be nice to have an R package (called something like 
integrityCheck) that runs several numerical checks. This would allow end 
users to take some responsibility for ensuring their system is built 
properly.  I'm worried about the situation where a sys-admin installs R 
and does not do any testing.

Paul
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From hpages at fhcrc.org  Wed Apr 11 21:59:43 2007
From: hpages at fhcrc.org (Herve Pages)
Date: Wed, 11 Apr 2007 12:59:43 -0700
Subject: [Rd] 'R CMD check' fails when suggested package is not available
In-Reply-To: <Pine.LNX.4.64.0704050419580.7641@gannet.stats.ox.ac.uk>
References: <46143D49.2000001@fhcrc.org>
	<Pine.LNX.4.64.0704050419580.7641@gannet.stats.ox.ac.uk>
Message-ID: <461D3E2F.8070905@fhcrc.org>

Prof Brian Ripley wrote:
> This is a configurable option 'R_check_force_suggests' documented in
> 'Writing R Extensions'.

Thanks for pointing this to me. I tried "R-2.5 CMD check --help" but was not
very successful with it...

> 
> This package should be using Enhances: Rmpi, it seems.

Yep this sounds like what we need here (never heard about this field before,
will be the first time a Bioconductor package uses it).

Is there any reason why the "Enhances" field is not supported by install.packages?

  > install.packages("XML", dep="Enhances")
  Error in as.vector(available[p1, dependencies]) :
        subscript out of bounds

I know this is in sync with the man page for 'install.packages' (which only
mentions Depends, Imports and Suggests) but there are for sure people that would
like to be able to install a package with _all_ its capabilities (especially those
that enhance it) by just doing
  > install.packages(..., dependencies=TRUE)
and not having to look at its DESCRIPTION file in order to figure out what great
enhancements there are missing and then install them separately ;-)

BTW, the name of this field ("Enhances") and the documentation does not help
to understand the "direction" of the enhancing relationship (who enhances who?):
both (the name "Enhances" and the 'Writing R Extensions' manual) tend to say that
the packages listed in the field are enhanced by the package at hand. That's a
point of view. But IMO it's rather the package at hand that is enhanced by the
packages listed in the field (at least this is the case with Rmpi).

Cheers,
H.

> 
> On Wed, 4 Apr 2007, Herve Pages wrote:
> 
>> Hi there,
>>
>> I was wondering why I get the following error message:
>>
>>  * checking package dependencies ... ERROR
>>  Packages required but not available:
>>    Rmpi
>>
>> when I run 'R CMD check' on a package that _suggests_ Rmpi?
>> Why isn't it OK to not have all the suggested packages installed?
>>
>> Maybe one of the 3 following behaviours would be more appropriate:
>>
>>  a) Having the error saying something like:
>>
>>    Package suggested but not available:
>>      Rmpi
>>
>>  b) Make this a warning instead of an error.
>>
>>  c) Don't do anything at all for suggested packages.
>>
>> This issue showed up today while I was checking a new Bioconductor
>> package:
>> the package suggests Rmpi but the vignette and the examples don't use
>> it. If I remove
>> Rmpi from the Suggests field then 'R CMD check' runs all the examples
>> and re-create
>> the vignette with no problem. Most users will not have Rmpi on their
>> machine neither
>> will they be interested in getting into the trouble of installing it.
> 
> 'Most users' will not be running 'R CMD check', of course.
> 
>> The package I was checking suggests Rmpi only because it contains 1
>> function that tries
>> to use it if it's installed but will work perfectly fine otherwise.
>> In this case it seems reasonable to have Rmpi in the Suggests field
>> but this will
>> make 'R CMD check' to fail which is problematic in the context of
>> automated builds :-/
>> If 'R CMD check' can't be a little bit more relaxed about this, then I
>> guess we will
>> need to remove Rmpi from the Suggests field, but then 'R CMD check'
>> will complain that:
>>
>>  * checking for unstated dependencies in R code ... WARNING
>>  'library' or 'require' calls not declared from:
>>    Rmpi
>>
>> which is always better than getting an ERROR.
>>
>> Thanks!
>>
>> H.
> 
>


From p.dalgaard at biostat.ku.dk  Wed Apr 11 22:26:32 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 11 Apr 2007 22:26:32 +0200
Subject: [Rd] eigen in beta
In-Reply-To: <461D2088.1070802@bank-banque-canada.ca>
References: <461BCE69.2020409@bank-banque-canada.ca>	<Pine.LNX.4.64.0704101854560.32417@gannet.stats.ox.ac.uk>	<461BD7E9.1050200@bank-banque-canada.ca>	<461BEDCB.7090805@biostat.ku.dk>	<Pine.LNX.4.64.0704110734210.1007@gannet.stats.ox.ac.uk>	<461CF5EA.4050001@bank-banque-canada.ca>	<Pine.LNX.4.64.0704111555430.28108@gannet.stats.ox.ac.uk>	<461D032D.40304@bank-banque-canada.ca>	<461D12E3.5040206@biostat.ku.dk>
	<461D2088.1070802@bank-banque-canada.ca>
Message-ID: <461D4478.7050100@biostat.ku.dk>

Paul Gilbert wrote:
> Peter Dalgaard wrote:
> ....
>   
>> Well, there's make check-all...
>>     
> Ok, this is what I should be running.  It reports
> ....
> running tests of LAPACK-based functions
> make[3]: Entering directory `/home/mfa/gilp/toolchain/R/src/R-beta/tests'
> running code in 'lapack.R' ...make[3]: *** [lapack.Rout] Error 1
> make[3]: Leaving directory `/home/mfa/gilp/toolchain/R/src/R-beta/tests'
> make[2]: *** [test-Lapack] Error 2
> make[2]: Leaving directory `/home/mfa/gilp/toolchain/R/src/R-beta/tests'
> make[1]: *** [test-all-devel] Error 1
> make[1]: Leaving directory `/home/mfa/gilp/toolchain/R/src/R-beta/tests'
> make: *** [check-all] Error 2
> ~/toolchain/R/src/R-beta:
> and   lapack.Rout.fail  reports
> ....
>  > ## failed for some 64bit-Lapack-gcc combinations:
>  > sm <- cbind(1, 3:1, 1:3)
>  > eigenok(sm, eigen(sm))
> Error: abs(A %*% V - V %*% diag(lam)) < Eps is not all TRUE
> Execution halted
>   
>> That doesn't check everything either, though. The point is that there 
>> is a limit to what we can check: We don't check whether the CPU gets 
>> floating point operations wrong in the 5th decimal place on rare 
>> occasions either.  ...
>>     
> Well, I'm talking about 3 to 4% in the maximum eigenvalue, in a problem 
> that I don't think is especially ill-conditioned.  
You didn't feel the "whoosh" as the reference to the 1994 Pentium FDIV 
bug went right past you? The magnitude of the error was never the point, 
rather the point was that we need to assume that most things "just 
works" -- that log() computes logarithms, that floating point divisions 
are accurate up to round off, etc., but also that linear algebra 
libraries do what they are expected to do. We check as much as we can, 
including comparisons of standard routines with expected output  in many 
cases, but some inconsistencies need a targeted test, and those don't 
get written without a specific suspicion.
> There are not many 
> more fundamental calculations in statistics.  And all I am asking is 
> that the problem gets reported, I'm not asking for a work around. I 
> clearly need to fix something other than R on the system.
>
>   
Yup.

> I guess it is difficult to know at what level problems should be 
> flagged.  I don't think many people run make check-all.  Some 
> calculation errors seem bad enough that plain "make" should catch them 
> and not suggest there was a successful build.  It would do R's 
> reputation a lot of damage if people used and reported the results of 
> such bad calculations.
>   
It is a bit like Brian's famous "fortune" entry about writing and 
reading documentation. We do provide the tools, but developers would go 
nuts if they had to run make check-all every time they fixed a typo, so 
it is the testers' obligation to, well, run the tests. One might hope 
that your example demonstrates to anyone else reading this thread, that 
relying on others to have done the testing for you can be dangerous, 
especially if your setup is out of the mainstream. (And as you found out 
the hard way, the "ultrastable" enterprise editions tend to be just 
that: Only largish shops install them, and on top of that, they tend to 
have somewhat dated toolchains.)
> It might be nice to have an R package (called something like 
> integrityCheck) that runs several numerical checks. This would allow end 
> users to take some responsibility for ensuring their system is built 
> properly.  I'm worried about the situation where a sys-admin installs R 
> and does not do any testing.
>   
Hmm, a make dependency of "install" on "check-all" is actually possible. 
Not quite sure how that would be received, though.

    -pd


From mtmorgan at fhcrc.org  Wed Apr 11 22:43:28 2007
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Wed, 11 Apr 2007 13:43:28 -0700
Subject: [Rd] R CMD build fails with try(stop()) in vignette
Message-ID: <6phps6aprpr.fsf@gopher4.fhcrc.org>

A vignette in <pkg>/inst/doc with

\documentclass[]{article}
\begin{document}
<<test>>=
try(stop('err'))
@ 
\end{document}

produces an error with R CMD build <pkg>:

...
** building package indices ...
* DONE (testPkg)
* creating vignettes ... ERROR
Error in try(stop("err")) : err

This is not seen with Sweave alone.

> sessionInfo()
R version 2.5.0 beta (2007-04-11 r41127) 
x86_64-unknown-linux-gnu 

locale:
LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=en_US;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[7] "base"     


-- 
Martin Morgan
Bioconductor / Computational Biology
http://bioconductor.org


From luke at stat.uiowa.edu  Thu Apr 12 00:28:31 2007
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Wed, 11 Apr 2007 17:28:31 -0500 (CDT)
Subject: [Rd] R CMD build fails with try(stop()) in vignette
In-Reply-To: <6phps6aprpr.fsf@gopher4.fhcrc.org>
References: <6phps6aprpr.fsf@gopher4.fhcrc.org>
Message-ID: <Pine.LNX.4.64.0704111726460.22931@nokomis.stat.uiowa.edu>

It would appear that printing the error message to stderr() is what is
causing the build to fail; replace

 	try(stop('err'))

with

 	cat('Error in try(stop("err")) : err\n', file = stderr())

and I get the same failure.

Best,

luke

On Wed, 11 Apr 2007, Martin Morgan wrote:

> A vignette in <pkg>/inst/doc with
>
> \documentclass[]{article}
> \begin{document}
> <<test>>=
> try(stop('err'))
> @
> \end{document}
>
> produces an error with R CMD build <pkg>:
>
> ...
> ** building package indices ...
> * DONE (testPkg)
> * creating vignettes ... ERROR
> Error in try(stop("err")) : err
>
> This is not seen with Sweave alone.
>
>> sessionInfo()
> R version 2.5.0 beta (2007-04-11 r41127)
> x86_64-unknown-linux-gnu
>
> locale:
> LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=en_US;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
> [7] "base"
>
>
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From rvivekrao at yahoo.com  Thu Apr 12 03:40:46 2007
From: rvivekrao at yahoo.com (Vivek Rao)
Date: Wed, 11 Apr 2007 18:40:46 -0700 (PDT)
Subject: [Rd] Fortran coding standards
In-Reply-To: <Pine.LNX.4.64.0704111429070.30340@gannet.stats.ox.ac.uk>
Message-ID: <452936.77508.qm@web58302.mail.re3.yahoo.com>


--- Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:

> On Wed, 11 Apr 2007, Vivek Rao wrote:

<snip>
 
> Note that currently we expect only Fortran 77 to be
> used in R and 
> (preferably) its packages, as there still are users
> with a Fortran 77 
> compiler and nothing later.  One major group are
> those on Windows, and it 
> is hoped that that will move to gcc 4.2.x in 2007. 

I don't understand this statement. Windows does not
come with C or Fortran 77 compilers preinstalled,
either. Windows binaries for the free Fortran 95
compilers gfortran and g95 do exist, and I use them
daily.

<snip>
 
> The Fortran code in R itself is (entirely, I think)
> imported from 
> elsewhere, e.g. from EISPACK or LAPACK or Netlib. 
> We have little interest 
> in changing long-established code, and as the recent
> thread 'eigen in 
> beta' shows, everytime we update such code someone
> thinks there is a new 
> bug in R.

That is understandable, but it also suggests that
defects in code in contributed packages should be
fixed 
before it is "published" and people start to rely on
it.

The main benefit of the R project is the provision of
working software to end users, who do not care about
the style of the underlying C and Fortran code. A
secondary benefit is that it provides a source of code
for statistical algorithms that programmers can
incorporate in their own programs. This audience will
care about the quality of the code.


From rvivekrao at yahoo.com  Thu Apr 12 04:16:28 2007
From: rvivekrao at yahoo.com (Vivek Rao)
Date: Wed, 11 Apr 2007 19:16:28 -0700 (PDT)
Subject: [Rd] Fortran coding standards
In-Reply-To: <461CE8BB.3000908@cimr.cam.ac.uk>
Message-ID: <193190.13050.qm@web58309.mail.re3.yahoo.com>


--- Hin-Tak Leung <hin-tak.leung at cimr.cam.ac.uk>
wrote:

<snip>

> (2) g77, gfortran are not the only fortran compilers
> out there!
> "...it is standard Fortran 90 and is supported by
> g77", is just not
> good enough - what do you mean by "...also conforms
> to later standards"?
> Some piece of code is either fortran 77 conformant,
> or not
> (i.e. *at least one* feature used are not).

Almost all of Fortran 77 is included in the later
standards F90, F95, and F2003, but there are a few
exceptions, for example non-integer loop variables.
The currently supported and developed Fortran
compilers implement Fortran 95. G77 is not being
maintained. Therefore I think that people programming
in Fortran 77  should use the subset (about 99%) of
the language that is present in F95. This can be
verified by compiling the code with g95 or gfortran
with the std=f95 option. F90 and F95 retain the fixed
source form of F77 as an option.

> (3) if it is not broken, don't try to fix it. It is
> possible to debate
> on stylistic changes for eternity and not getting
> any real work done.

I think modifying code so that it is more robust and
readable constitutes real progress, especially for
people who will directly with the code.



       
____________________________________________________________________________________
It's here! Your new message!  
Get new email alerts with the free Yahoo! Toolbar.


From ripley at stats.ox.ac.uk  Thu Apr 12 08:06:52 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 12 Apr 2007 07:06:52 +0100 (BST)
Subject: [Rd] Fortran coding standards
In-Reply-To: <452936.77508.qm@web58302.mail.re3.yahoo.com>
References: <452936.77508.qm@web58302.mail.re3.yahoo.com>
Message-ID: <Pine.LNX.4.64.0704120648540.18425@gannet.stats.ox.ac.uk>

On Wed, 11 Apr 2007, Vivek Rao wrote:

>
> --- Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>
>> On Wed, 11 Apr 2007, Vivek Rao wrote:
>
> <snip>
>
>> Note that currently we expect only Fortran 77 to be used in R and 
>> (preferably) its packages, as there still are users with a Fortran 77 
>> compiler and nothing later.  One major group are those on Windows, and 
>> it is hoped that that will move to gcc 4.2.x in 2007.
>
> I don't understand this statement. Windows does not
> come with C or Fortran 77 compilers preinstalled,
> either. Windows binaries for the free Fortran 95
> compilers gfortran and g95 do exist, and I use them
> daily.

If you mean MinGW, they are private builds of unreleased versions. The 
actual maintainers do not recommend using them until their patches are 
incorporated (in gcc 4.2.0, to be released Real Soon Now).  I don't know 
of binaries of C, C++ and Fortran from a single source for gcc4 for MinGW, 
and you need a consistent set to build R and its packages.
(As you will see from the R-admin manual, I do use builds from unreleased 
versions to test that R will build (and have patched it so it does) in the 
hope that official builds will be available before 2.6.0 is released.)

MinGW builds of gfortran 4.x (or g95) are not compatible with MinGW gcc3 
in ways that can lead to incorrect calculations.

So there is nothing we can recommend to Windows users of R as yet, and 
there will not be while the R Windows binaries are built with gcc 3.4.5.


> <snip>
>
>> The Fortran code in R itself is (entirely, I think) imported from 
>> elsewhere, e.g. from EISPACK or LAPACK or Netlib. We have little 
>> interest in changing long-established code, and as the recent thread 
>> 'eigen in beta' shows, everytime we update such code someone thinks 
>> there is a new bug in R.
>
> That is understandable, but it also suggests that
> defects in code in contributed packages should be
> fixed
> before it is "published" and people start to rely on
> it.

Which is why we asked you to report such *to the maintainer* and not on R 
lists.

> The main benefit of the R project is the provision of
> working software to end users, who do not care about
> the style of the underlying C and Fortran code. A
> secondary benefit is that it provides a source of code
> for statistical algorithms that programmers can
> incorporate in their own programs. This audience will
> care about the quality of the code.

The R project is not responsible for the contributed packages, nor (as I 
and others have said) for the Fortran code shipped with R.
It is not even (strictly) responsible for CRAN.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Thu Apr 12 08:14:06 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Thu, 12 Apr 2007 08:14:06 +0200 (CEST)
Subject: [Rd] data.frame backwards compatibility (PR#9601)
Message-ID: <20070412061406.6D0C45AAB5@slim.kubism.ku.dk>

What you are reporting as missing would be *forwards* compatibility, and 
of an unstated representation (dump? save?) of objects of class 
"data.frame", not the object data.frame() itself.

The correct terminology is 'a data frame', not 'the data.frame' (which 
means something different).

No one has ever said that objects dumped/saved in future versions of R 
would be valid when restored in a current version.  How for example do you 
expect a data frame containing a raw vector to be read in a version of R 
from before the raw type was added?

You will find many instances of lack of forwards compatibility: it is 
essential to progress.

On Fri, 6 Apr 2007, v.moreno at ico.scs.es wrote:

> Full_Name: Victor Moreno
> Version: R2.5.0

That is a future version of R, so no one knows how it will behave.

> OS: windows
> Submission from: (NULL) (68.40.63.169)
>
>
> This may not be a bug, but seems not yet documented.

1) You are asked in the FAQ not to use this address for things you are not 
'sure' are bugs.

2) This change is documented under USER-VISIBLE CHANGES, clearly 
highlighting it.

> Some data.frames created with development version 2.5.0, when read in 
> 2.4.1, show error:

What does 'read in' mean?  load()?  source() from a dump()?

> Error in dim.data.frame(chip23) : negative length vectors are not allowed

The code you used is not here, so we have no idea what you did to get that 
error.  The FAQ and the posting guide do ask for reproducible code.

> A dump of the data.frame shows as last code:
>
> , row.names = as.integer(c(NA, -7269)), class = "data.frame")
>
> This seems related to the new feature of data.frames without rownames.

Data frames always have row names (sic), by definition, and that dump 
output does show row names.  What is new is that they are allowed to be 
integers.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From b.rowlingson at lancaster.ac.uk  Thu Apr 12 10:46:32 2007
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 12 Apr 2007 09:46:32 +0100
Subject: [Rd] R-Forge?
In-Reply-To: <46162693.20809@bfro.uni-lj.si>
References: <46162693.20809@bfro.uni-lj.si>
Message-ID: <461DF1E8.1000605@lancaster.ac.uk>

Gregor Gorjanc wrote:

> I have recently found RForge.net (http://www.rforge.net/) by Simon
> Urbanek and found out today that the site is accepting subscriptions.
> Great! However, browsing a bit on the site I found a link to another
> forge: R-Forge (http://r-forge.r-project.org/).
> 
> Is/will the last one be the "offcial" forge for R packages, given that
> it has domain r-project.org?

  Perhaps one is the real forge and the other is a forgery? Or a forge-R-y?

  I'll get my coat...

Barry


From mel at altk.com  Thu Apr 12 11:59:10 2007
From: mel at altk.com (mel)
Date: Thu, 12 Apr 2007 11:59:10 +0200
Subject: [Rd] printf capture
Message-ID: <461E02EE.7040105@altk.com>

printf capture

Dear All,

I'm running R-2.4.1 on WindowsXP.
I wrote a small C++ DLL using Rprintf() and all works fine
dyn.load(), is.loaded('f1'), Rprintf(), .C(), all is ok.

Now, the worry :
I use also a 3rd party piece of C++ program which was not designed
for R and uses printf().

I though on sink(...) before .C('f1'), but it doesn't work.
I call sink(file="res.txt") and only the Rprintf() are catched

Is there any way to however capture those printf() outputs ?

Thanks for any hint/pointer (... and i apologize
if i missed something obvious !).

Vincent

(for what may be worth, a "minimal" stuff is at www.khi.fr/IB/rp2)


From ripley at stats.ox.ac.uk  Thu Apr 12 12:28:11 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 12 Apr 2007 11:28:11 +0100 (BST)
Subject: [Rd] printf capture
In-Reply-To: <461E02EE.7040105@altk.com>
References: <461E02EE.7040105@altk.com>
Message-ID: <Pine.LNX.4.64.0704121122480.26905@gannet.stats.ox.ac.uk>

If you are using Rgui (it should work under rterm) there is no C-level 
'stdout' file stream (the normal state for Windows GUI programs), so no 
way to capture it inside R.

On Thu, 12 Apr 2007, mel wrote:

> printf capture
>
> Dear All,
>
> I'm running R-2.4.1 on WindowsXP.
> I wrote a small C++ DLL using Rprintf() and all works fine
> dyn.load(), is.loaded('f1'), Rprintf(), .C(), all is ok.
>
> Now, the worry :
> I use also a 3rd party piece of C++ program which was not designed
> for R and uses printf().

If you have the program, can you not edit it before compiling it?
Adding

#define printf Rprintf

will probably do the trick.

> I though on sink(...) before .C('f1'), but it doesn't work.
> I call sink(file="res.txt") and only the Rprintf() are catched
>
> Is there any way to however capture those printf() outputs ?
>
> Thanks for any hint/pointer (... and i apologize
> if i missed something obvious !).
>
> Vincent
>
> (for what may be worth, a "minimal" stuff is at www.khi.fr/IB/rp2)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Friedrich.Leisch at stat.uni-muenchen.de  Thu Apr 12 13:10:33 2007
From: Friedrich.Leisch at stat.uni-muenchen.de (Friedrich Leisch)
Date: Thu, 12 Apr 2007 13:10:33 +0200
Subject: [Rd] bug in Stangle(split=TRUE)
In-Reply-To: <461786F8.9040105@jhsph.edu>
References: <461786F8.9040105@jhsph.edu>
Message-ID: <17950.5033.303966.748393@celebrian.ci.tuwien.ac.at>

>>>>> On Sat, 07 Apr 2007 07:56:40 -0400,
>>>>> Roger Peng (RP) wrote:

  > [I originally emailed this to Friedrich Leisch but got no response

Sorry, was on easter vacation and have not fully suceeded to go through
all mails in my inbox yet.

  > and I 
  > just wanted to make sure it made it in before release.]

  > While working with Stangle(), I noticed a problem when using 'split = 
  > TRUE'.  Particularly, when there are two chunks where one chunk's name 
  > is a prefix of another chunk's name, then the two chunks will be written 
  > to a single file rather than two separate files (if the chunk who's name 
  > is a prefix comes after the other chunk).  Running 'Stangle(split=TRUE)' 
  > with the attached 'test1.Rnw' file should reproduce the problem.

  > I think it boils down to a partial matching problem in 'RtangleRuncode'. 
  >   I've attached a patch against R-alpha (r41020) which I think fixes 
  > this problem but I'm not sure it's necessarily the best approach (there 
  > are other instances of this construction in the code).

Same bug was also affecting Sweave. Fixed in the 2.5 and 2.6 branches,
thanks a lot for the report.

Best,
Fritz


From Friedrich.Leisch at stat.uni-muenchen.de  Thu Apr 12 13:20:09 2007
From: Friedrich.Leisch at stat.uni-muenchen.de (Friedrich Leisch)
Date: Thu, 12 Apr 2007 13:20:09 +0200
Subject: [Rd] R CMD build fails with try(stop()) in vignette
In-Reply-To: <Pine.LNX.4.64.0704111726460.22931@nokomis.stat.uiowa.edu>
References: <6phps6aprpr.fsf@gopher4.fhcrc.org>
	<Pine.LNX.4.64.0704111726460.22931@nokomis.stat.uiowa.edu>
Message-ID: <17950.5609.45983.142007@celebrian.ci.tuwien.ac.at>

>>>>> On Wed, 11 Apr 2007 17:28:31 -0500 (CDT),
>>>>> Luke Tierney (LT) wrote:

  > It would appear that printing the error message to stderr() is what is
  > causing the build to fail; replace

  >  	try(stop('err'))

  > with

  >  	cat('Error in try(stop("err")) : err\n', file = stderr())

  > and I get the same failure.

Yes, both R CMD check and R CMD build "analyse" the textual output
from running R (on examples, vigenttes, ...) to locate
problems. Reason is a chicken&egg problem: You cannot use the same R
process which runs the code to spot all problems, because it may not
survive until the point where you are able to spot the problem.

Having errors thrown in code chunks is still in many ways an open
problem in Sweave files, because it is hard to distinguish problems
the user wants to show to the reader from ones that are not deliberate
...


Best,
Fritz


From p.dalgaard at biostat.ku.dk  Thu Apr 12 14:21:43 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu, 12 Apr 2007 14:21:43 +0200
Subject: [Rd] printf capture
In-Reply-To: <Pine.LNX.4.64.0704121122480.26905@gannet.stats.ox.ac.uk>
References: <461E02EE.7040105@altk.com>
	<Pine.LNX.4.64.0704121122480.26905@gannet.stats.ox.ac.uk>
Message-ID: <461E2457.9040401@biostat.ku.dk>

Prof Brian Ripley wrote:
> If you are using Rgui (it should work under rterm) there is no C-level 
> 'stdout' file stream (the normal state for Windows GUI programs), so no 
> way to capture it inside R.
>
> On Thu, 12 Apr 2007, mel wrote:
>
>   
>> printf capture
>>
>> Dear All,
>>
>> I'm running R-2.4.1 on WindowsXP.
>> I wrote a small C++ DLL using Rprintf() and all works fine
>> dyn.load(), is.loaded('f1'), Rprintf(), .C(), all is ok.
>>
>> Now, the worry :
>> I use also a 3rd party piece of C++ program which was not designed
>> for R and uses printf().
>>     
>
> If you have the program, can you not edit it before compiling it?
> Adding
>
> #define printf Rprintf
>
> will probably do the trick.
>
>   
If not:

If it really is a standalone program, look into variations of system() 
and shell().

If it is a DLL, you might get away with explicitly opening a file 
descriptor for stdout on entry and closing it on exit. Not sure exactly 
how this works, though, especially on Windows.
>> I though on sink(...) before .C('f1'), but it doesn't work.
>> I call sink(file="res.txt") and only the Rprintf() are catched
>>
>> Is there any way to however capture those printf() outputs ?
>>
>> Thanks for any hint/pointer (... and i apologize
>> if i missed something obvious !).
>>
>> Vincent
>>
>> (for what may be worth, a "minimal" stuff is at www.khi.fr/IB/rp2)
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>     
>
>


From luke at stat.uiowa.edu  Thu Apr 12 14:35:28 2007
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Thu, 12 Apr 2007 07:35:28 -0500 (CDT)
Subject: [Rd] R CMD build fails with try(stop()) in vignette
In-Reply-To: <17950.5609.45983.142007@celebrian.ci.tuwien.ac.at>
References: <6phps6aprpr.fsf@gopher4.fhcrc.org>
	<Pine.LNX.4.64.0704111726460.22931@nokomis.stat.uiowa.edu>
	<17950.5609.45983.142007@celebrian.ci.tuwien.ac.at>
Message-ID: <Pine.LNX.4.64.0704120731510.22931@nokomis.stat.uiowa.edu>

On Thu, 12 Apr 2007, Friedrich Leisch wrote:

>>>>>> On Wed, 11 Apr 2007 17:28:31 -0500 (CDT),
>>>>>> Luke Tierney (LT) wrote:
>
>  > It would appear that printing the error message to stderr() is what is
>  > causing the build to fail; replace
>
>  >  	try(stop('err'))
>
>  > with
>
>  >  	cat('Error in try(stop("err")) : err\n', file = stderr())
>
>  > and I get the same failure.
>
> Yes, both R CMD check and R CMD build "analyse" the textual output
> from running R (on examples, vigenttes, ...) to locate
> problems. Reason is a chicken&egg problem: You cannot use the same R
> process which runs the code to spot all problems, because it may not
> survive until the point where you are able to spot the problem.
>
> Having errors thrown in code chunks is still in many ways an open
> problem in Sweave files, because it is hard to distinguish problems
> the user wants to show to the reader from ones that are not deliberate
> ...

Just to clarify: this means for now the recommendation would be for
authors of vignettes using try() to arrange to suppress the error
message either by adding silent=TRUE to the call or setting the
show.error.messages option to FALSE?

Best,

luke

>
>
> Best,
> Fritz
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From Friedrich.Leisch at stat.uni-muenchen.de  Thu Apr 12 14:49:26 2007
From: Friedrich.Leisch at stat.uni-muenchen.de (Friedrich Leisch)
Date: Thu, 12 Apr 2007 14:49:26 +0200
Subject: [Rd] R CMD build fails with try(stop()) in vignette
In-Reply-To: <Pine.LNX.4.64.0704120731510.22931@nokomis.stat.uiowa.edu>
References: <6phps6aprpr.fsf@gopher4.fhcrc.org>
	<Pine.LNX.4.64.0704111726460.22931@nokomis.stat.uiowa.edu>
	<17950.5609.45983.142007@celebrian.ci.tuwien.ac.at>
	<Pine.LNX.4.64.0704120731510.22931@nokomis.stat.uiowa.edu>
Message-ID: <17950.10966.806919.930956@celebrian.ci.tuwien.ac.at>

>>>>> On Thu, 12 Apr 2007 07:35:28 -0500 (CDT),
>>>>> Luke Tierney (LT) wrote:

  > On Thu, 12 Apr 2007, Friedrich Leisch wrote:
  >>>>>>> On Wed, 11 Apr 2007 17:28:31 -0500 (CDT),
  >>>>>>> Luke Tierney (LT) wrote:
  >> 
  >> > It would appear that printing the error message to stderr() is what is
  >> > causing the build to fail; replace
  >> 
  >> >  	try(stop('err'))
  >> 
  >> > with
  >> 
  >> >  	cat('Error in try(stop("err")) : err\n', file = stderr())
  >> 
  >> > and I get the same failure.
  >> 
  >> Yes, both R CMD check and R CMD build "analyse" the textual output
  >> from running R (on examples, vigenttes, ...) to locate
  >> problems. Reason is a chicken&egg problem: You cannot use the same R
  >> process which runs the code to spot all problems, because it may not
  >> survive untilthe point where you are able to spot the problem.
  >> 
  >> Having errors thrown in code chunks is still in many ways an open
  >> problem in Sweave files, because it is hard to distinguish problems
  >> the user wants to show to the reader from ones that are not deliberate
  >> ...

  > Just to clarify: this means for now the recommendation would be for
  > authors of vignettes using try() to arrange to suppress the error
  > message either by adding silent=TRUE to the call or setting the
  > show.error.messages option to FALSE?

Yes. We should try to get a better system, but I'm not sure what that
should be (and definetely not for 2.5).

Most of the stuff is by Kurt, so we should wait for his opinion. If
you look at the R CMD check code you will see a lot of grep's for
"^Error", so merely inserting a blank before the error message may do
the trick, but we have no means to automate that yet.

.f


From mel at altk.com  Thu Apr 12 16:17:51 2007
From: mel at altk.com (mel)
Date: Thu, 12 Apr 2007 16:17:51 +0200
Subject: [Rd] printf capture
In-Reply-To: <Pine.LNX.4.64.0704121122480.26905@gannet.stats.ox.ac.uk>
References: <461E02EE.7040105@altk.com>
	<Pine.LNX.4.64.0704121122480.26905@gannet.stats.ox.ac.uk>
Message-ID: <461E3F8F.4050801@altk.com>

Prof Brian Ripley a ?crit :

> If you are using Rgui (it should work under rterm) 

yes indeed, it works under rterm

> there is no C-level 'stdout' file stream (the normal state
> for Windows GUI programs), so no way to capture it inside R.

Aie ! (I feared this answer). Thanks however for the explanation.
I was looking at pipe(), scan() etc.
So, no hope from this side.

> If you have the program, can you not edit it before compiling it?
> Adding
> #define printf Rprintf
> will probably do the trick.

yes thanks, I already though on that, and it works.
But i would have preferred not touching this 3rd party code.

=====================================

There is another little annoyance (always on WindowsXP + R-2.4.1)
When including both <windows.h> and <R.h>
#include <windows.h>
#include <R.h>	

There is a #define ERROR redefinition

#define ERROR ),error(R_problem_buf);} // this one in Rs.h
#define ERROR 0                        //  in MinGW/.../wingdi.h

It's only a warning, but i would prefer to avoid it
and i'm searching how to avoid it.
Thanks for any idea.


PS : compilation details :

g++ -IJ:/softs/R-2.4.1/include -c f1.cpp -o f1.o
In file included from J:/softs/R-2.4.1/include/R.h:49,
                  from f1.cpp:11:
J:/softs/R-2.4.1/include/R_ext/RS.h:40:1: warning: "ERROR" redefined
In file included from
f:/MinGW/bin/../lib/gcc/mingw32/3.4.2/../../../../include/windows.h:52,
                  from f1.cpp:10:
f:/MinGW/bin/../lib/gcc/mingw32/3.4.2/../../../../include/wingdi.h:313:1:
warning: this is the location of the previous definition


From ripley at stats.ox.ac.uk  Thu Apr 12 17:02:49 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 12 Apr 2007 16:02:49 +0100 (BST)
Subject: [Rd] printf capture
In-Reply-To: <461E3F8F.4050801@altk.com>
References: <461E02EE.7040105@altk.com>
	<Pine.LNX.4.64.0704121122480.26905@gannet.stats.ox.ac.uk>
	<461E3F8F.4050801@altk.com>
Message-ID: <Pine.LNX.4.64.0704121558260.11792@gannet.stats.ox.ac.uk>

On Thu, 12 Apr 2007, mel wrote:

> Prof Brian Ripley a ?crit :
>
>> If you are using Rgui (it should work under rterm)
>
> yes indeed, it works under rterm
>
>> there is no C-level 'stdout' file stream (the normal state
>> for Windows GUI programs), so no way to capture it inside R.
>
> Aie ! (I feared this answer). Thanks however for the explanation.
> I was looking at pipe(), scan() etc.
> So, no hope from this side.
>
>> If you have the program, can you not edit it before compiling it?
>> Adding
>> #define printf Rprintf
>> will probably do the trick.
>
> yes thanks, I already though on that, and it works.
> But i would have preferred not touching this 3rd party code.

You can always link in a wrapper that defined printf and passes the 
arguments to Rprintf.

> =====================================
>
> There is another little annoyance (always on WindowsXP + R-2.4.1)
> When including both <windows.h> and <R.h>
> #include <windows.h>
> #include <R.h>
>
> There is a #define ERROR redefinition
>
> #define ERROR ),error(R_problem_buf);} // this one in Rs.h
> #define ERROR 0                        //  in MinGW/.../wingdi.h
>
> It's only a warning, but i would prefer to avoid it
> and i'm searching how to avoid it.
> Thanks for any idea.

It's documented in 'Writing R Extensions'.

   The defines used for compatibility with @Sl{} sometimes causes
   conflicts (notably with Windows headers), and the known
   problematic defines can be removed by defining @code{STRICT_R_HEADERS}.


>
>
> PS : compilation details :
>
> g++ -IJ:/softs/R-2.4.1/include -c f1.cpp -o f1.o
> In file included from J:/softs/R-2.4.1/include/R.h:49,
>                  from f1.cpp:11:
> J:/softs/R-2.4.1/include/R_ext/RS.h:40:1: warning: "ERROR" redefined
> In file included from
> f:/MinGW/bin/../lib/gcc/mingw32/3.4.2/../../../../include/windows.h:52,
>                  from f1.cpp:10:
> f:/MinGW/bin/../lib/gcc/mingw32/3.4.2/../../../../include/wingdi.h:313:1:
> warning: this is the location of the previous definition
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From hb at stat.berkeley.edu  Thu Apr 12 18:09:21 2007
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Thu, 12 Apr 2007 09:09:21 -0700
Subject: [Rd] Milestone: 1000 packages on CRAN as of today(?)
Message-ID: <59d7961d0704120909w5c37a7a4l1ffd886d0f01ff42@mail.gmail.com>

Hi,

I was just looking at the "CRAN Daily Package Check Results"
[http://cran.r-project.org/src/contrib/checkSummary.html], and
realized there are 1000 packages on CRAN as of today (look at row 3 in
the table below).  Yet another quite extraordinary milestone in R
history.

Last updated on 2007-04-12 11:48:32

Results for installing and checking packages using the three current
flavors of R on systems running Debian GNU/Linux testing (r-devel
ix86: AMD Athlon(tm) XP 2400+ (2GHz), r-devel x86_64: Dual Core AMD
Opteron(tm) Processor 280, r-prerel/r-release: Intel(R) Pentium(R) 4
CPU 2.66GHz), MacOS X 10.4.7 (iMac, Intel Core Duo 1.83GHz), and
Windows Server 2003 SP2 (32-bit) (AMD Athlon64 X2 5000+).

	Flavor 	OS 	CPU 	OK 	WARN 	ERROR 	Total
1 	r-devel 	Linux 	ix86 	769 	135 	32 	936
2 	r-devel 	Linux 	x86_64 	523 	101 	36 	660
3 	r-prerel 	Linux 	ix86 	816 	154 	30 	1000
4 	r-prerel 	MacOS_X 	ix86 	738 	160 	95 	993
5 	r-prerel 	Windows 	x86_64 	787 	142 	36 	965
6 	r-release 	Linux 	ix86 	919 	63 	15 	997
7 	r-release 	Windows 	x86_64 	908 	50 	19 	977

Hope those WARN and ERROR packages will turn into OK before the 2.5.0
release.  I've tried to do my contribution ;)

While maintaining R at my previous place, I kept track on the number
of package installed, which included almost all CRAN packages, except
a few hard-to-install ones, plus some Bioconductor packages.  This is
my summary:

  20020917   68, R v1.5.1
  20030326 206, R v1.6.2
  20030424 269, R v1.6.2
  20030903 298, R v1.7.1
  20031015 306, R v1.7.1
  20031126 352, R v1.7.1
  20040310 370, R v1.8.1
  20040525 411, R v1.9.0
  20041005 459, R v1.9.1
  20041217 506, R v2.0.1
  20060217 698, R v2.2.1

Quite a growth.  Are there any "official" records like these?

Cheers

Henrik


From ripley at stats.ox.ac.uk  Thu Apr 12 18:54:59 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 12 Apr 2007 17:54:59 +0100 (BST)
Subject: [Rd] Milestone: 1000 packages on CRAN as of today(?)
In-Reply-To: <59d7961d0704120909w5c37a7a4l1ffd886d0f01ff42@mail.gmail.com>
References: <59d7961d0704120909w5c37a7a4l1ffd886d0f01ff42@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0704121743460.29609@gannet.stats.ox.ac.uk>

The number of packages on CRAN usable with the current version of R is
recorded from time to time in the file tests/internet.Rout.save.  So e.g. 
on 2001-05-30 there were 106 and on 2004-12-27 there were 433 (rather less 
than you recorded) and on 2005-12-17, 647 (rather more), assuming I got 
the correct versions.

Note that progress is not monotone: there may be 1000 packages but some 
are uninstallable under R 2.5.0 and are likely to be moved to the 
Archive.

On Thu, 12 Apr 2007, Henrik Bengtsson wrote:

> Hi,
>
> I was just looking at the "CRAN Daily Package Check Results"
> [http://cran.r-project.org/src/contrib/checkSummary.html], and
> realized there are 1000 packages on CRAN as of today (look at row 3 in
> the table below).  Yet another quite extraordinary milestone in R
> history.
>
> Last updated on 2007-04-12 11:48:32
>
> Results for installing and checking packages using the three current
> flavors of R on systems running Debian GNU/Linux testing (r-devel
> ix86: AMD Athlon(tm) XP 2400+ (2GHz), r-devel x86_64: Dual Core AMD
> Opteron(tm) Processor 280, r-prerel/r-release: Intel(R) Pentium(R) 4
> CPU 2.66GHz), MacOS X 10.4.7 (iMac, Intel Core Duo 1.83GHz), and
> Windows Server 2003 SP2 (32-bit) (AMD Athlon64 X2 5000+).
>
> 	Flavor 	OS 	CPU 	OK 	WARN 	ERROR 	Total
> 1 	r-devel 	Linux 	ix86 	769 	135 	32 	936
> 2 	r-devel 	Linux 	x86_64 	523 	101 	36 	660
> 3 	r-prerel 	Linux 	ix86 	816 	154 	30 	1000
> 4 	r-prerel 	MacOS_X 	ix86 	738 	160 	95 	993
> 5 	r-prerel 	Windows 	x86_64 	787 	142 	36 	965
> 6 	r-release 	Linux 	ix86 	919 	63 	15 	997
> 7 	r-release 	Windows 	x86_64 	908 	50 	19 	977
>
> Hope those WARN and ERROR packages will turn into OK before the 2.5.0
> release.  I've tried to do my contribution ;)
>
> While maintaining R at my previous place, I kept track on the number
> of package installed, which included almost all CRAN packages, except
> a few hard-to-install ones, plus some Bioconductor packages.  This is
> my summary:
>
>  20020917   68, R v1.5.1
>  20030326 206, R v1.6.2
>  20030424 269, R v1.6.2
>  20030903 298, R v1.7.1
>  20031015 306, R v1.7.1
>  20031126 352, R v1.7.1
>  20040310 370, R v1.8.1
>  20040525 411, R v1.9.0
>  20041005 459, R v1.9.1
>  20041217 506, R v2.0.1
>  20060217 698, R v2.2.1
>
> Quite a growth.  Are there any "official" records like these?
>
> Cheers
>
> Henrik
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Fri Apr 13 08:38:59 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 13 Apr 2007 07:38:59 +0100 (BST)
Subject: [Rd]
 =?iso-8859-15?q?package_incompatibility_under_2=2E5=2E0_=28p?=
 =?iso-8859-15?q?lease_respond_directly=2C_I_am_not_on_r-devel=29?=
In-Reply-To: <761028988@web.de>
References: <761028988@web.de>
Message-ID: <Pine.LNX.4.64.0704130624340.28259@gannet.stats.ox.ac.uk>

Unfortunately a claim of 'extensive regression testing' is not going to 
help you if the original contains the mistake.  It seems that your package 
is not using these functions as they are (and always have been, AFAIK) 
documented in R or the Blue and White Books.

A summary would be that new checks in R 2.5.0 have found several 
long-standing incompatibilities of your code with R.

R 2.5.0 is in feature freeze, and changing the argument list of basic 
functions is not something we would do lightly (and certainly not at this 
late stage).  In essence you are asking everyone else to change their 
usage to conform to yours, since if we change these many other packages 
(and R itself) will show warnings in 'R CMD check'.

There is an advantage in not having a '...' argument in generics that 
Martin Maechler often points out: it means that errors in actual argument 
names are caught.  And these new checks have caught unintended usage 
errors in other packages.

On Wed, 11 Apr 2007, Jens Oehlschl?gel wrote:

> Dear all,
>
> For my package "ref" I have implemented extensive regression testing. It 
> now fails to compile since primitives "dim" and "dimnames" (and their 
> assignment methods) no longer allow for additional arguments. I was 
> using an additional argument "ref" with several methods. For "].refdata"

If you mean '[.refdata', '[' is really part of the language and documented 
to allow zero or more arguments.

> it still works, with "dim.refdata" no longer. Could you please allow for 
> additional arguments for the following generic functions (or 
> primitives):
>
> dim <- function (x, ...)
> UseMethod("dim")
>
> "dim<-" <- function (x, ..., value)
> UseMethod("dim<-")
>
> dimnames <- function (x, ...)
> UseMethod("dimnames")
>
> "dimnames<-" <- function (x, ..., value)
> UseMethod("dimnames<-")
>
> row.names <- function (x, ...)
> UseMethod("row.names")
>
> "row.names<-" <- function (x, ..., value)
> UseMethod("row.names<-")
>
> names <- function (x, ...)
> UseMethod("names")
>
> "names<-" <- function (x, ..., value)
> UseMethod("names<-")
>
> BTW: why does get("dim") returns
> function (x) .Primitive("dim")
> and args() works on it,
> while get("[") returns
> .Primitive("[")
> and args() doesn't work on it?

It is regarded as part of the language (like '{' and '(', which equally 
are primitives).  It would be unusual to apply them as functions, and 
args() applies to functions.

> Furthermore, until now "rownames", "colnames" have been convenience 
> wrappers for "dimnames". Consequently implementing "dimnames" and 
> "dimnames<-" would indirectly implement "rownames", "colnames" and their 
> assignment methods. This no longer works for classes inheriting from 
> "data.frame" because the assignment methods no longer work via 
> "dimnames<-". I can imagine that this change breaks existing code in 
> other packages as well - without formally throwing errors at package 
> check time (as I said, I have unusually strict regression testing 
> included in the example section, that other packages may not have).
> If it is really necessary to treat data.frames differently, I'd

It is.

> recommend to change "rownames" and "colnames" accordingly, in order to 
> have symmetry between accessor and assignment functions. That would mean 
> defining "names" and "row.names" and their assignment methods for any 
> classes inheriting from data.frame, instead of "dimnames", correct? 
> Maybe *all* package maintainers should be warned about this or R CMD 
> CHECK should check whether anyone defines "dimnames" or "dimnames<-" for 
> any class inheriting from "data.frame".

The documentation says (and used to say)

      For a data frame, 'rownames' and
      'colnames' are equivalent to 'row.names' and 'names' respectively,
      but the latter are preferred (and can be much faster).

and it now works as documented.

>
> Best regards
>
>
> Jens Oehlschl?gel
>
>
>
>> -----Urspr?ngliche Nachricht-----
>> Von: Uwe.Ligges at R-Project.org
>> Gesendet: 08.04.07 16:50:29
>> An: joehl at web.de
>> CC: Uwe.Ligges at R-Project.org,olafm at kimberly.tako.de
>> Betreff: Package ref_0.92.tar.gz did not pass R CMD check
>
>
>> Dear package maintainer,
>>
>> this notification has been generated automatically.
>> Your package ref_0.92.tar.gz did not pass 'R CMD check' on
>> Windows and will be omitted from the corresponding CRAN directory
>> (CRAN/bin/windows/contrib/2.5/).
>> Please check the attached log-file and consider to resubmit a version
>> with increased version number that passes R CMD check on Windows.
>> R version 2.5.0 alpha (2007-04-05 r41063)

[...]

>> Error in identical(dim(rx3, ref = TRUE), dim(x)) :
>> 2 arguments passed to 'dim' which requires 1
>> Execution halted

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From rpeng at jhsph.edu  Fri Apr 13 19:53:46 2007
From: rpeng at jhsph.edu (Roger Peng)
Date: Fri, 13 Apr 2007 13:53:46 -0400
Subject: [Rd] directory/filename completion
Message-ID: <461FC3AA.9010204@jhsph.edu>

I've noticed something recently in R-beta that has changed since R 2.4.1 
and I'm not sure if it's a readline problem or an R problem.  I am on a 
Linux FC5 system and in R 2.4.1 I could do

load("my-directory/

and then hit TAB and it would list all of the files in 'my-directory', 
after which I could start typing the beginning of the file, hit TAB 
again, and it would complete the file name along with adding the closing 
double quote.

In R-beta, when I try the same thing, nothing happens (i.e. no directory 
listing and no file name completion).  Specifically, if I type

load("my

and then it TAB, it will complete the 'my-directory' but it will not 
look further into the files inside of 'my-directory'.

Also, I've noticed that if I rename 'my-directory' to 'mydirectory' (so 
no dash), everything works fine (just like in R 2.4.1).

Has anyone else noticed this?

-roger
-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/


From Taiwei.Lin at Sun.COM  Fri Apr 13 19:30:08 2007
From: Taiwei.Lin at Sun.COM (Tai-Wei (David) Lin)
Date: Fri, 13 Apr 2007 10:30:08 -0700
Subject: [Rd] R on Solaris 10 x64
Message-ID: <461FBE20.4010901@sun.com>

Hi R Developers,

Greg is helping me with debugging R on Solaris 10 x64. Please let us
know if you have any thoughts or tips that can help us debug this.

Thanks,

David



************
Using default transfer plist
in vector_io: permuting
About to write

 *** caught segfault ***
address e8554000, cause 'memory not mapped'

Traceback:
 1: .External("do_hdf5save", call, sys.frame(sys.parent()), fileout,
 ..., PACKAGE = "hdf5")
 2: hdf5save(hdf5_Fstat, "Fstat", "geneNames", "genotype")
aborting ...
************

We've tried many things to debug it:

* dbx Runtime Checking (RTC) is not detecting any (meaningful) memory
access problems that I can see.

* The same on Solaris/SPARC.

* Neither does Valgrind on Linux.

* I've tried increasing the C stack size, assuming R could be running
out of stack size. Didn't help.

Running R under dbx (without RTC) until the crash shows this:

...
About to write
t at 1 (l at 1) signal SEGV (no mapping at the fault address) in _memcpy at
0xfe90444b
0xfe90444b: _memcpy+0x006b:     movaps   0x00000000(%esi),%xmm0
Current function is H5D_select_mgath
  379               HDmemcpy(tgath_buf,buf+off[curr_seq],curr_len);
(dbx) where
current thread: t at 1
  [1] _memcpy(0x0, 0xfdebc707, 0x9f5c4f0), at 0xfe90444b
=>[2] H5D_select_mgath(_buf = 0x9f79580, space = 0x8966770, iter =
0x8045980, nelmts = 3120U, dxpl_cache = 0xfe170078, _tgath_buf =
0x9f5c4f0), line 379 in "H5Dselect.c"
  [3] H5D_contig_write(io_info = 0x804620c, nelmts = 3120ULL, mem_type =
0x97b05c8, mem_space = 0x8966770, file_space = 0x8966770, tpath =
0x8ee7078, src_id = 201326906, dst_id = 201326904, buf = 0x9f79580),
line 1418 in "H5Dio.c"
  [4] H5D_write(dataset = 0x8f169c0, mem_type_id = 201326906, mem_space
= 0x8966770, file_space = 0x8966770, dxpl_id = 671088643, buf =
0x9f79580), line 952 in "H5Dio.c"
  [5] H5Dwrite(dset_id = 335544330, mem_type_id = 201326906,
mem_space_id = 0, file_space_id = 0, plist_id = 671088643, buf =
0x9f79580), line 586 in "H5Dio.c"
  [6] vector_io(call = 0x97234ec, writeflag = 1, dataset = 335544330,
space = 268435472, obj = 0x98386a0), line 535 in "hdf5.c"
  [7] hdf5_write_vector(call = 0x97234ec, id = 67108867, symname =
0x9cf35d0 "geneNames", val = 0x98386a0), line 693 in "hdf5.c"
  [8] hdf5_save_object(call = 0x97234ec, fid = 67108867, symname =
0x9cf35d0 "geneNames", val = 0x98386a0), line 957 in "hdf5.c"
  [9] do_hdf5save(args = 0x9723284), line 1104 in "hdf5.c"
  [10] do_External(call = 0x86d62bc, op = 0x8371cd8, args = 0x972340c,
env = 0x9723594), line 832 in "dotcode.c"
  [11] Rf_eval(e = 0x86d62bc, rho = 0x9723594), line 445 in "eval.c"
  [12] Rf_evalList(el = 0x86d6230, rho = 0x9723594, op = 0x837226c),
line 1463 in "eval.c"
  [13] Rf_eval(e = 0x86d6214, rho = 0x9723594), line 438 in "eval.c"
  [14] do_begin(call = 0x86d56bc, op = 0x836709c, args = 0x86d61dc, rho
= 0x9723594), line 1107 in "eval.c"
  [15] Rf_eval(e = 0x86d56bc, rho = 0x9723594), line 431 in "eval.c"
  [16] Rf_applyClosure(call = 0x9723738, op = 0x83c0328, arglist =
0x97236e4, rho = 0x8379b1c, suppliedenv = 0x8379b38), line 614 in "eval.c"
  [17] Rf_eval(e = 0x9723738, rho = 0x8379b1c), line 455 in "eval.c"
  [18] Rf_ReplIteration(rho = 0x8379b1c, savestack = 0, browselevel = 0,
state = 0x8047328), line 256 in "main.c"
  [19] R_ReplConsole(rho = 0x8379b1c, savestack = 0, browselevel = 0),
line 305 in "main.c"
  [20] run_Rmainloop(), line 944 in "main.c"
  [21] Rf_mainloop(), line 951 in "main.c"
  [22] main(ac = 4, av = 0x80477ac), line 33 in "Rmain.c"
(dbx) p curr_len
curr_len = 24960U
(dbx) p curr_seq
curr_seq = 0
(dbx) p of
dbx: "of" is not defined in the scope
`libhdf5.so.0.0.0`H5Dselect.c`H5D_select_mgath:347`
dbx: see `help scope' for details
(dbx) p off
off = 0x8042960
(dbx) p tgath_buf
tgath_buf = 0x9f5c4f0
"\xd87\x83^H\xa8\xf3\x82^H0^X\x82^H^X\xd4\x81^H^P\x90\x81^H\xb8m\x80^H^H'\x80^H\x88^?^?^H\x908^?^H\xb0\xf7~^H\xd8\xad~^H\xf8\xb2~^H\xb8\x8e~^H\xe8]~^H\xe8\xcb\xed^HP\xe3}^Hh\xdd\xbb^H\x98\xc4}^H\xf0\xa0}^H\xa8r}^HH}\xc3^HpO|^HH^V|^H^X\xd8|^H\xc0\xb1|^H8=}^H\x90\xcd{^H^Pm{^H\xb8#{^Hx'{^H\x90\xf8x^HpKx^H^POx^H\xa8~w^H^H>w^H\xf0\xb2w^H\xc8^Ew^HX'x^H\xf8\xdbv^H"
(dbx) p buf
buf = 0x9f79580
"\xd87\x83^H\xa8\xf3\x82^H0^X\x82^H^X\xd4\x81^H^P\x90\x81^H\xb8m\x80^H^H'\x80^H\x88^?^?^H\x908^?^H\xb0\xf7~^H\xd8\xad~^H\xf8\xb2~^H\xb8\x8e~^H\xe8]~^H\xe8\xcb\xed^HP\xe3}^Hh\xdd\xbb^H\x98\xc4}^H\xf0\xa0}^H\xa8r}^HH}\xc3^HpO|^HH^V|^H^X\xd8|^H\xc0\xb1|^H8=}^H\x90\xcd{^H^Pm{^H\xb8#{^Hx'{^H\x90\xf8x^HpKx^H^POx^H\xa8~w^H^H>w^H\xf0\xb2w^H\xc8^Ew^HX'x^H\xf8\xdbv^H"
(dbx) p nseq
nseq = 1U
(dbx) p len
len = 0x804195c
(dbx) p len[0..2]
len[0..2] =
[0] = 24960U
[1] = 140025512U
[2] = 140013048U
(dbx)


The R code in question is:

...
        /* Loop, while sequences left to process */
        for(curr_seq=0; curr_seq<nseq; curr_seq++) {
            /* Get the number of bytes in sequence */
            curr_len=len[curr_seq];

            HDmemcpy(tgath_buf,buf+off[curr_seq],curr_len);

            /* Advance offset in gather buffer */
            tgath_buf+=curr_len;
        } /* end for */
...

where

./src/hdf5-1.6.5/src/H5private.h:
#define HDmemcpy(X,Y,Z)  memcpy((char*)(X),(const char*)(Y),Z)

Maybe the "curr_len = 24960U" value is too high. I have no way of
knowing what it should be in this case.

The crash could be caused by a compiler bug, although it's not very
likely. These crashes have occurred both with and without optimization,
with and without -g.


From ripley at stats.ox.ac.uk  Fri Apr 13 20:23:07 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 13 Apr 2007 19:23:07 +0100 (BST)
Subject: [Rd] R on Solaris 10 x64
In-Reply-To: <461FBE20.4010901@sun.com>
References: <461FBE20.4010901@sun.com>
Message-ID: <Pine.LNX.4.64.0704131918480.695@gannet.stats.ox.ac.uk>

What did the maintainer of this unmentioned contributed package (hdf5) say 
when you ask him?

[Hint: you *have* read the posting guide at

http://www.r-project.org/posting-guide.html

and done as it asks?]

There is no evidence here that this is anything to do with R itself.


On Fri, 13 Apr 2007, Tai-Wei (David) Lin wrote:

> Hi R Developers,
>
> Greg is helping me with debugging R on Solaris 10 x64. Please let us
> know if you have any thoughts or tips that can help us debug this.
>
> Thanks,
>
> David
>
>
>
> ************
> Using default transfer plist
> in vector_io: permuting
> About to write
>
> *** caught segfault ***
> address e8554000, cause 'memory not mapped'
>
> Traceback:
> 1: .External("do_hdf5save", call, sys.frame(sys.parent()), fileout,
> ..., PACKAGE = "hdf5")
> 2: hdf5save(hdf5_Fstat, "Fstat", "geneNames", "genotype")
> aborting ...
> ************
>
> We've tried many things to debug it:
>
> * dbx Runtime Checking (RTC) is not detecting any (meaningful) memory
> access problems that I can see.
>
> * The same on Solaris/SPARC.
>
> * Neither does Valgrind on Linux.
>
> * I've tried increasing the C stack size, assuming R could be running
> out of stack size. Didn't help.
>
> Running R under dbx (without RTC) until the crash shows this:
>
> ...
> About to write
> t at 1 (l at 1) signal SEGV (no mapping at the fault address) in _memcpy at
> 0xfe90444b
> 0xfe90444b: _memcpy+0x006b:     movaps   0x00000000(%esi),%xmm0
> Current function is H5D_select_mgath
>  379               HDmemcpy(tgath_buf,buf+off[curr_seq],curr_len);
> (dbx) where
> current thread: t at 1
>  [1] _memcpy(0x0, 0xfdebc707, 0x9f5c4f0), at 0xfe90444b
> =>[2] H5D_select_mgath(_buf = 0x9f79580, space = 0x8966770, iter =
> 0x8045980, nelmts = 3120U, dxpl_cache = 0xfe170078, _tgath_buf =
> 0x9f5c4f0), line 379 in "H5Dselect.c"
>  [3] H5D_contig_write(io_info = 0x804620c, nelmts = 3120ULL, mem_type =
> 0x97b05c8, mem_space = 0x8966770, file_space = 0x8966770, tpath =
> 0x8ee7078, src_id = 201326906, dst_id = 201326904, buf = 0x9f79580),
> line 1418 in "H5Dio.c"
>  [4] H5D_write(dataset = 0x8f169c0, mem_type_id = 201326906, mem_space
> = 0x8966770, file_space = 0x8966770, dxpl_id = 671088643, buf =
> 0x9f79580), line 952 in "H5Dio.c"
>  [5] H5Dwrite(dset_id = 335544330, mem_type_id = 201326906,
> mem_space_id = 0, file_space_id = 0, plist_id = 671088643, buf =
> 0x9f79580), line 586 in "H5Dio.c"
>  [6] vector_io(call = 0x97234ec, writeflag = 1, dataset = 335544330,
> space = 268435472, obj = 0x98386a0), line 535 in "hdf5.c"
>  [7] hdf5_write_vector(call = 0x97234ec, id = 67108867, symname =
> 0x9cf35d0 "geneNames", val = 0x98386a0), line 693 in "hdf5.c"
>  [8] hdf5_save_object(call = 0x97234ec, fid = 67108867, symname =
> 0x9cf35d0 "geneNames", val = 0x98386a0), line 957 in "hdf5.c"
>  [9] do_hdf5save(args = 0x9723284), line 1104 in "hdf5.c"
>  [10] do_External(call = 0x86d62bc, op = 0x8371cd8, args = 0x972340c,
> env = 0x9723594), line 832 in "dotcode.c"
>  [11] Rf_eval(e = 0x86d62bc, rho = 0x9723594), line 445 in "eval.c"
>  [12] Rf_evalList(el = 0x86d6230, rho = 0x9723594, op = 0x837226c),
> line 1463 in "eval.c"
>  [13] Rf_eval(e = 0x86d6214, rho = 0x9723594), line 438 in "eval.c"
>  [14] do_begin(call = 0x86d56bc, op = 0x836709c, args = 0x86d61dc, rho
> = 0x9723594), line 1107 in "eval.c"
>  [15] Rf_eval(e = 0x86d56bc, rho = 0x9723594), line 431 in "eval.c"
>  [16] Rf_applyClosure(call = 0x9723738, op = 0x83c0328, arglist =
> 0x97236e4, rho = 0x8379b1c, suppliedenv = 0x8379b38), line 614 in "eval.c"
>  [17] Rf_eval(e = 0x9723738, rho = 0x8379b1c), line 455 in "eval.c"
>  [18] Rf_ReplIteration(rho = 0x8379b1c, savestack = 0, browselevel = 0,
> state = 0x8047328), line 256 in "main.c"
>  [19] R_ReplConsole(rho = 0x8379b1c, savestack = 0, browselevel = 0),
> line 305 in "main.c"
>  [20] run_Rmainloop(), line 944 in "main.c"
>  [21] Rf_mainloop(), line 951 in "main.c"
>  [22] main(ac = 4, av = 0x80477ac), line 33 in "Rmain.c"
> (dbx) p curr_len
> curr_len = 24960U
> (dbx) p curr_seq
> curr_seq = 0
> (dbx) p of
> dbx: "of" is not defined in the scope
> `libhdf5.so.0.0.0`H5Dselect.c`H5D_select_mgath:347`
> dbx: see `help scope' for details
> (dbx) p off
> off = 0x8042960
> (dbx) p tgath_buf
> tgath_buf = 0x9f5c4f0
> "\xd87\x83^H\xa8\xf3\x82^H0^X\x82^H^X\xd4\x81^H^P\x90\x81^H\xb8m\x80^H^H'\x80^H\x88^?^?^H\x908^?^H\xb0\xf7~^H\xd8\xad~^H\xf8\xb2~^H\xb8\x8e~^H\xe8]~^H\xe8\xcb\xed^HP\xe3}^Hh\xdd\xbb^H\x98\xc4}^H\xf0\xa0}^H\xa8r}^HH}\xc3^HpO|^HH^V|^H^X\xd8|^H\xc0\xb1|^H8=}^H\x90\xcd{^H^Pm{^H\xb8#{^Hx'{^H\x90\xf8x^HpKx^H^POx^H\xa8~w^H^H>w^H\xf0\xb2w^H\xc8^Ew^HX'x^H\xf8\xdbv^H"
> (dbx) p buf
> buf = 0x9f79580
> "\xd87\x83^H\xa8\xf3\x82^H0^X\x82^H^X\xd4\x81^H^P\x90\x81^H\xb8m\x80^H^H'\x80^H\x88^?^?^H\x908^?^H\xb0\xf7~^H\xd8\xad~^H\xf8\xb2~^H\xb8\x8e~^H\xe8]~^H\xe8\xcb\xed^HP\xe3}^Hh\xdd\xbb^H\x98\xc4}^H\xf0\xa0}^H\xa8r}^HH}\xc3^HpO|^HH^V|^H^X\xd8|^H\xc0\xb1|^H8=}^H\x90\xcd{^H^Pm{^H\xb8#{^Hx'{^H\x90\xf8x^HpKx^H^POx^H\xa8~w^H^H>w^H\xf0\xb2w^H\xc8^Ew^HX'x^H\xf8\xdbv^H"
> (dbx) p nseq
> nseq = 1U
> (dbx) p len
> len = 0x804195c
> (dbx) p len[0..2]
> len[0..2] =
> [0] = 24960U
> [1] = 140025512U
> [2] = 140013048U
> (dbx)
>
>
> The R code in question is:
>
> ...
>        /* Loop, while sequences left to process */
>        for(curr_seq=0; curr_seq<nseq; curr_seq++) {
>            /* Get the number of bytes in sequence */
>            curr_len=len[curr_seq];
>
>            HDmemcpy(tgath_buf,buf+off[curr_seq],curr_len);
>
>            /* Advance offset in gather buffer */
>            tgath_buf+=curr_len;
>        } /* end for */
> ...
>
> where
>
> ./src/hdf5-1.6.5/src/H5private.h:
> #define HDmemcpy(X,Y,Z)  memcpy((char*)(X),(const char*)(Y),Z)
>
> Maybe the "curr_len = 24960U" value is too high. I have no way of
> knowing what it should be in this case.
>
> The crash could be caused by a compiler bug, although it's not very
> likely. These crashes have occurred both with and without optimization,
> with and without -g.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From h.wickham at gmail.com  Fri Apr 13 21:31:32 2007
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 13 Apr 2007 14:31:32 -0500
Subject: [Rd] directory/filename completion
In-Reply-To: <461FC3AA.9010204@jhsph.edu>
References: <461FC3AA.9010204@jhsph.edu>
Message-ID: <f8e6ff050704131231u18f0a2efo9d1102895318f7c2@mail.gmail.com>

On 4/13/07, Roger Peng <rpeng at jhsph.edu> wrote:
> I've noticed something recently in R-beta that has changed since R 2.4.1
> and I'm not sure if it's a readline problem or an R problem.  I am on a
> Linux FC5 system and in R 2.4.1 I could do
>
> load("my-directory/
>
> and then hit TAB and it would list all of the files in 'my-directory',
> after which I could start typing the beginning of the file, hit TAB
> again, and it would complete the file name along with adding the closing
> double quote.
>
> In R-beta, when I try the same thing, nothing happens (i.e. no directory
> listing and no file name completion).  Specifically, if I type
>
> load("my
>
> and then it TAB, it will complete the 'my-directory' but it will not
> look further into the files inside of 'my-directory'.
>
> Also, I've noticed that if I rename 'my-directory' to 'mydirectory' (so
> no dash), everything works fine (just like in R 2.4.1).
>
> Has anyone else noticed this?

I've noticed that if I have the rcompgen library loaded - perhaps
you've installed that recently?

Hadley


From p.dalgaard at biostat.ku.dk  Fri Apr 13 21:43:21 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Fri, 13 Apr 2007 21:43:21 +0200
Subject: [Rd] R on Solaris 10 x64
In-Reply-To: <Pine.LNX.4.64.0704131918480.695@gannet.stats.ox.ac.uk>
References: <461FBE20.4010901@sun.com>
	<Pine.LNX.4.64.0704131918480.695@gannet.stats.ox.ac.uk>
Message-ID: <461FDD59.8090408@biostat.ku.dk>

Prof Brian Ripley wrote:
> What did the maintainer of this unmentioned contributed package (hdf5) say 
> when you ask him?
>
> [Hint: you *have* read the posting guide at
>
> http://www.r-project.org/posting-guide.html
>
> and done as it asks?]
>
> There is no evidence here that this is anything to do with R itself.
>
>   
Er, Brian, I think you are misfiring this time. As I understand it, they 
(David/Greg) are well aware that they are debugging an issue in a 
contributed package which occurs with an uncommon compiler on a maybe 
not so uncommon platform. They are just looking for hints on how to 
proceed to pinpoint the issue.

--------------

2 things caught my eye (except that their "R code" is clearly C): The 
dbx output doesn't show off[curr_seq], which could actually be the 
culprit, and the _memcpy call on the stack looks odd:

_memcpy(0x0, 0xfdebc707, 0x9f5c4f0)


(What happened to the length and how did NULL get in there.) If memcpy() 
is a  macro, I think I'd take a closer look at the include files and see 
if something is getting expanded  in an unintended way.

> On Fri, 13 Apr 2007, Tai-Wei (David) Lin wrote:
>
>   
>> Hi R Developers,
>>
>> Greg is helping me with debugging R on Solaris 10 x64. Please let us
>> know if you have any thoughts or tips that can help us debug this.
>>
>> Thanks,
>>
>> David
>>
>>
>>
>> ************
>> Using default transfer plist
>> in vector_io: permuting
>> About to write
>>
>> *** caught segfault ***
>> address e8554000, cause 'memory not mapped'
>>
>> Traceback:
>> 1: .External("do_hdf5save", call, sys.frame(sys.parent()), fileout,
>> ..., PACKAGE = "hdf5")
>> 2: hdf5save(hdf5_Fstat, "Fstat", "geneNames", "genotype")
>> aborting ...
>> ************
>>
>> We've tried many things to debug it:
>>
>> * dbx Runtime Checking (RTC) is not detecting any (meaningful) memory
>> access problems that I can see.
>>
>> * The same on Solaris/SPARC.
>>
>> * Neither does Valgrind on Linux.
>>
>> * I've tried increasing the C stack size, assuming R could be running
>> out of stack size. Didn't help.
>>
>> Running R under dbx (without RTC) until the crash shows this:
>>
>> ...
>> About to write
>> t at 1 (l at 1) signal SEGV (no mapping at the fault address) in _memcpy at
>> 0xfe90444b
>> 0xfe90444b: _memcpy+0x006b:     movaps   0x00000000(%esi),%xmm0
>> Current function is H5D_select_mgath
>>  379               HDmemcpy(tgath_buf,buf+off[curr_seq],curr_len);
>> (dbx) where
>> current thread: t at 1
>>  [1] _memcpy(0x0, 0xfdebc707, 0x9f5c4f0), at 0xfe90444b
>> =>[2] H5D_select_mgath(_buf = 0x9f79580, space = 0x8966770, iter =
>> 0x8045980, nelmts = 3120U, dxpl_cache = 0xfe170078, _tgath_buf =
>> 0x9f5c4f0), line 379 in "H5Dselect.c"
>>  [3] H5D_contig_write(io_info = 0x804620c, nelmts = 3120ULL, mem_type =
>> 0x97b05c8, mem_space = 0x8966770, file_space = 0x8966770, tpath =
>> 0x8ee7078, src_id = 201326906, dst_id = 201326904, buf = 0x9f79580),
>> line 1418 in "H5Dio.c"
>>  [4] H5D_write(dataset = 0x8f169c0, mem_type_id = 201326906, mem_space
>> = 0x8966770, file_space = 0x8966770, dxpl_id = 671088643, buf =
>> 0x9f79580), line 952 in "H5Dio.c"
>>  [5] H5Dwrite(dset_id = 335544330, mem_type_id = 201326906,
>> mem_space_id = 0, file_space_id = 0, plist_id = 671088643, buf =
>> 0x9f79580), line 586 in "H5Dio.c"
>>  [6] vector_io(call = 0x97234ec, writeflag = 1, dataset = 335544330,
>> space = 268435472, obj = 0x98386a0), line 535 in "hdf5.c"
>>  [7] hdf5_write_vector(call = 0x97234ec, id = 67108867, symname =
>> 0x9cf35d0 "geneNames", val = 0x98386a0), line 693 in "hdf5.c"
>>  [8] hdf5_save_object(call = 0x97234ec, fid = 67108867, symname =
>> 0x9cf35d0 "geneNames", val = 0x98386a0), line 957 in "hdf5.c"
>>  [9] do_hdf5save(args = 0x9723284), line 1104 in "hdf5.c"
>>  [10] do_External(call = 0x86d62bc, op = 0x8371cd8, args = 0x972340c,
>> env = 0x9723594), line 832 in "dotcode.c"
>>  [11] Rf_eval(e = 0x86d62bc, rho = 0x9723594), line 445 in "eval.c"
>>  [12] Rf_evalList(el = 0x86d6230, rho = 0x9723594, op = 0x837226c),
>> line 1463 in "eval.c"
>>  [13] Rf_eval(e = 0x86d6214, rho = 0x9723594), line 438 in "eval.c"
>>  [14] do_begin(call = 0x86d56bc, op = 0x836709c, args = 0x86d61dc, rho
>> = 0x9723594), line 1107 in "eval.c"
>>  [15] Rf_eval(e = 0x86d56bc, rho = 0x9723594), line 431 in "eval.c"
>>  [16] Rf_applyClosure(call = 0x9723738, op = 0x83c0328, arglist =
>> 0x97236e4, rho = 0x8379b1c, suppliedenv = 0x8379b38), line 614 in "eval.c"
>>  [17] Rf_eval(e = 0x9723738, rho = 0x8379b1c), line 455 in "eval.c"
>>  [18] Rf_ReplIteration(rho = 0x8379b1c, savestack = 0, browselevel = 0,
>> state = 0x8047328), line 256 in "main.c"
>>  [19] R_ReplConsole(rho = 0x8379b1c, savestack = 0, browselevel = 0),
>> line 305 in "main.c"
>>  [20] run_Rmainloop(), line 944 in "main.c"
>>  [21] Rf_mainloop(), line 951 in "main.c"
>>  [22] main(ac = 4, av = 0x80477ac), line 33 in "Rmain.c"
>> (dbx) p curr_len
>> curr_len = 24960U
>> (dbx) p curr_seq
>> curr_seq = 0
>> (dbx) p of
>> dbx: "of" is not defined in the scope
>> `libhdf5.so.0.0.0`H5Dselect.c`H5D_select_mgath:347`
>> dbx: see `help scope' for details
>> (dbx) p off
>> off = 0x8042960
>> (dbx) p tgath_buf
>> tgath_buf = 0x9f5c4f0
>> "\xd87\x83^H\xa8\xf3\x82^H0^X\x82^H^X\xd4\x81^H^P\x90\x81^H\xb8m\x80^H^H'\x80^H\x88^?^?^H\x908^?^H\xb0\xf7~^H\xd8\xad~^H\xf8\xb2~^H\xb8\x8e~^H\xe8]~^H\xe8\xcb\xed^HP\xe3}^Hh\xdd\xbb^H\x98\xc4}^H\xf0\xa0}^H\xa8r}^HH}\xc3^HpO|^HH^V|^H^X\xd8|^H\xc0\xb1|^H8=}^H\x90\xcd{^H^Pm{^H\xb8#{^Hx'{^H\x90\xf8x^HpKx^H^POx^H\xa8~w^H^H>w^H\xf0\xb2w^H\xc8^Ew^HX'x^H\xf8\xdbv^H"
>> (dbx) p buf
>> buf = 0x9f79580
>> "\xd87\x83^H\xa8\xf3\x82^H0^X\x82^H^X\xd4\x81^H^P\x90\x81^H\xb8m\x80^H^H'\x80^H\x88^?^?^H\x908^?^H\xb0\xf7~^H\xd8\xad~^H\xf8\xb2~^H\xb8\x8e~^H\xe8]~^H\xe8\xcb\xed^HP\xe3}^Hh\xdd\xbb^H\x98\xc4}^H\xf0\xa0}^H\xa8r}^HH}\xc3^HpO|^HH^V|^H^X\xd8|^H\xc0\xb1|^H8=}^H\x90\xcd{^H^Pm{^H\xb8#{^Hx'{^H\x90\xf8x^HpKx^H^POx^H\xa8~w^H^H>w^H\xf0\xb2w^H\xc8^Ew^HX'x^H\xf8\xdbv^H"
>> (dbx) p nseq
>> nseq = 1U
>> (dbx) p len
>> len = 0x804195c
>> (dbx) p len[0..2]
>> len[0..2] =
>> [0] = 24960U
>> [1] = 140025512U
>> [2] = 140013048U
>> (dbx)
>>
>>
>> The R code in question is:
>>
>> ...
>>        /* Loop, while sequences left to process */
>>        for(curr_seq=0; curr_seq<nseq; curr_seq++) {
>>            /* Get the number of bytes in sequence */
>>            curr_len=len[curr_seq];
>>
>>            HDmemcpy(tgath_buf,buf+off[curr_seq],curr_len);
>>
>>            /* Advance offset in gather buffer */
>>            tgath_buf+=curr_len;
>>        } /* end for */
>> ...
>>
>> where
>>
>> ./src/hdf5-1.6.5/src/H5private.h:
>> #define HDmemcpy(X,Y,Z)  memcpy((char*)(X),(const char*)(Y),Z)
>>
>> Maybe the "curr_len = 24960U" value is too high. I have no way of
>> knowing what it should be in this case.
>>
>> The crash could be caused by a compiler bug, although it's not very
>> likely. These crashes have occurred both with and without optimization,
>> with and without -g.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>     
>
>


From deepayan.sarkar at gmail.com  Fri Apr 13 21:57:56 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Fri, 13 Apr 2007 12:57:56 -0700
Subject: [Rd] help with Qt and event loops
Message-ID: <eb555e660704131257y3d3513a7m4ef266c00869f782@mail.gmail.com>

Hi,

I have been playing with Qt recently, and have the beginnings of a Qt
device. Unfortunately, I haven't been able to make it work as an R
package yet (I know the device code works because I can use it from a
GUI where R is embedded). Trying to package it, I have managed to get
it to a stage where typing

> library(qtdevice)
> QT()

will open up a new window, but then control doesn't return to R, so
nothing useful can be done.  Right now, I have no idea how to proceed.

Would someone with enough experience with event loops (preferably in
both R and Qt) be willing to look into this? The source code and a
brief write-up is available here:

http://dsarkar.fhcrc.org/R/R-Qt.html

Thanks,
-Deepayan


From ripley at stats.ox.ac.uk  Fri Apr 13 22:15:10 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 13 Apr 2007 21:15:10 +0100 (BST)
Subject: [Rd] directory/filename completion
In-Reply-To: <f8e6ff050704131231u18f0a2efo9d1102895318f7c2@mail.gmail.com>
References: <461FC3AA.9010204@jhsph.edu>
	<f8e6ff050704131231u18f0a2efo9d1102895318f7c2@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0704132039290.16284@gannet.stats.ox.ac.uk>

On Fri, 13 Apr 2007, hadley wickham wrote:

> On 4/13/07, Roger Peng <rpeng at jhsph.edu> wrote:
>> I've noticed something recently in R-beta that has changed since R 2.4.1
>> and I'm not sure if it's a readline problem or an R problem.  I am on a
>> Linux FC5 system and in R 2.4.1 I could do
>>
>> load("my-directory/
>>
>> and then hit TAB and it would list all of the files in 'my-directory',
>> after which I could start typing the beginning of the file, hit TAB
>> again, and it would complete the file name along with adding the closing
>> double quote.
>>
>> In R-beta, when I try the same thing, nothing happens (i.e. no directory
>> listing and no file name completion).  Specifically, if I type
>>
>> load("my
>>
>> and then it TAB, it will complete the 'my-directory' but it will not
>> look further into the files inside of 'my-directory'.
>>
>> Also, I've noticed that if I rename 'my-directory' to 'mydirectory' (so
>> no dash), everything works fine (just like in R 2.4.1).
>>
>> Has anyone else noticed this?
>
> I've noticed that if I have the rcompgen library loaded - perhaps
> you've installed that recently?

Loading rcompgen is the default uner 2.5.0 beta, but you can turn it off. 
This is in the USER-VISIBLE CHANGES in NEWS: just how prominent does it 
need to be?

It is a feature of the rcompletion interface to rcompgen, now part of 
base R.  From the source code comment

        These break line into tokens.  Unfortunately, this also breaks
        file names, so a path with a - in it will not be completed.

We decided to make this the default in 2.5.0 to get user feedback: if it 
was not switched on few people would use it.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From pinard at iro.umontreal.ca  Fri Apr 13 22:43:30 2007
From: pinard at iro.umontreal.ca (=?iso-8859-1?Q?Fran=E7ois?= Pinard)
Date: Fri, 13 Apr 2007 16:43:30 -0400
Subject: [Rd] R on Solaris 10 x64
In-Reply-To: <461FDD59.8090408@biostat.ku.dk>
References: <461FBE20.4010901@sun.com>
	<Pine.LNX.4.64.0704131918480.695@gannet.stats.ox.ac.uk>
	<461FDD59.8090408@biostat.ku.dk>
Message-ID: <20070413204330.GA30546@alcyon.progiciels-bpi.ca>

[Peter Dalgaard]

>Er, Brian, I think you are misfiring this time.

Firing is always misfiring, at least in that it lacks elegance.  There 
are ways to speak without the heat, or otherwise, to merely stay silent.

Yet this particular aspect of things improved a lot, lately, on the 
various R lists.  Congratulations to all.

-- 
Fran?ois Pinard   http://pinard.progiciels-bpi.ca


From duncan at wald.ucdavis.edu  Fri Apr 13 22:52:07 2007
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Fri, 13 Apr 2007 13:52:07 -0700
Subject: [Rd] help with Qt and event loops
In-Reply-To: <eb555e660704131257y3d3513a7m4ef266c00869f782@mail.gmail.com>
References: <eb555e660704131257y3d3513a7m4ef266c00869f782@mail.gmail.com>
Message-ID: <20070413205207.GA30532@wald.ucdavis.edu>

Hi Deepayan.

 I can take a look, but it may not be for a few days. 
But if anyone else has the time, can you keep us informed
about any progress so that we don't replicate work in parallel.

 D.


Deepayan Sarkar wrote:
> Hi,
> 
> I have been playing with Qt recently, and have the beginnings of a Qt
> device. Unfortunately, I haven't been able to make it work as an R
> package yet (I know the device code works because I can use it from a
> GUI where R is embedded). Trying to package it, I have managed to get
> it to a stage where typing
> 
> > library(qtdevice)
> > QT()
> 
> will open up a new window, but then control doesn't return to R, so
> nothing useful can be done.  Right now, I have no idea how to proceed.
> 
> Would someone with enough experience with event loops (preferably in
> both R and Qt) be willing to look into this? The source code and a
> brief write-up is available here:
> 
> http://dsarkar.fhcrc.org/R/R-Qt.html
> 
> Thanks,
> -Deepayan
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Duncan Temple Lang                duncan at wald.ucdavis.edu
Department of Statistics          work:  (530) 752-4782
4210 Mathematical Sciences Bldg.  fax:   (530) 752-7099
One Shields Ave.
University of California at Davis
Davis, CA 95616, USA



-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20070413/4580954e/attachment.bin 

From tplate at acm.org  Fri Apr 13 22:52:28 2007
From: tplate at acm.org (Tony Plate)
Date: Fri, 13 Apr 2007 14:52:28 -0600
Subject: [Rd] how to control which version of a package library() installs?
Message-ID: <461FED8C.2040603@acm.org>

library() seems to remember the location of a package when I give it a 
lib.loc, and then use that version thereafter, even if I don't supply 
lib.loc again.  Is there any way I can load different versions of a 
package in one R session? -- I don't seem to able to simply detach the 
package and then load a different version from a different library location.

$ R
[...startup info...]
 > # only version we currently know about is in the standard library
 > .find.package("ExamplePackage")
[1] "c:/R/R-2.4.1/library/ExamplePackage"
 > # load a version from a different library e:/devinst
 > library(ExamplePackage, lib.loc="e:/devinst")
 > # and check we've got the right version ... yes
 > system.file(package="ExamplePackage")
[1] "e:/devinst/ExamplePackage"
 > .find.package("ExamplePackage")
[1] "e:/devinst/ExamplePackage"
 > detach(2)
 >
 > # Now I'd like to load the version in the standard library.
 > # .find.package() finds the version I want
 > .find.package("ExamplePackage")
[1] "c:/R/R-2.4.1/library/ExamplePackage"
 > # but library() loads the same version it did before, even
 > # though I don't supply lib.loc, and .libPaths is untouched.
 > library(ExamplePackage)
 > system.file(package="ExamplePackage")
[1] "e:/devinst/ExamplePackage"
 > .find.package("ExamplePackage")
[1] "e:/devinst/ExamplePackage"
 > .libPaths()
[1] "c:/R/R-2.4.1/library"
 > sessionInfo()
R version 2.4.1 (2006-12-18)
i386-pc-mingw32

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
States.1252;LC_MON
ETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United 
States.1252


attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
[7] "base"

other attached packages:
ExamplePackage
          "1.0"
 >

Am I doing something wrong here?  I can't find any mention of 
persistence of package location in ?library.

thanks for any help or suggestions,

Tony Plate


From deepayan.sarkar at gmail.com  Fri Apr 13 22:59:35 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Fri, 13 Apr 2007 13:59:35 -0700
Subject: [Rd] help with Qt and event loops
In-Reply-To: <20070413205207.GA30532@wald.ucdavis.edu>
References: <eb555e660704131257y3d3513a7m4ef266c00869f782@mail.gmail.com>
	<20070413205207.GA30532@wald.ucdavis.edu>
Message-ID: <eb555e660704131359m165763ccs71b30607e0a77b96@mail.gmail.com>

On 4/13/07, Duncan Temple Lang <duncan at wald.ucdavis.edu> wrote:
> Hi Deepayan.
>
>  I can take a look, but it may not be for a few days.

No problem.

> But if anyone else has the time, can you keep us informed
> about any progress so that we don't replicate work in parallel.

Sure.

-Deepayan


From ripley at stats.ox.ac.uk  Fri Apr 13 23:12:46 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 13 Apr 2007 22:12:46 +0100 (BST)
Subject: [Rd] how to control which version of a package library()
	installs?
In-Reply-To: <461FED8C.2040603@acm.org>
References: <461FED8C.2040603@acm.org>
Message-ID: <Pine.LNX.4.64.0704132204150.18247@gannet.stats.ox.ac.uk>

On Fri, 13 Apr 2007, Tony Plate wrote:

> library() seems to remember the location of a package when I give it a
> lib.loc, and then use that version thereafter, even if I don't supply

Not quite: it notices that it is loaded and does not load it again, 
possibly attaching the exports of a still-loaded namespace.

> lib.loc again.  Is there any way I can load different versions of a
> package in one R session? -- I don't seem to able to simply detach the
> package and then load a different version from a different library location.

Without the output of search(), searchpath() and loadedNamespace() we 
cannot know what happened here.  But here is an example of my own

> library(Matrix, lib.loc="~/R/test26")
Loading required package: lattice
> searchpaths()
  [1] ".GlobalEnv"
  [2] "/data/gannet/ripley/R/test26/Matrix"
  ...
> detach(2)
> search()
  [1] ".GlobalEnv"        "package:lattice"   "package:stats"
  [4] "package:graphics"  "package:grDevices" "package:utils"
  [7] "package:datasets"  "package:methods"   "Autoloads"
[10] "package:base"
> library(Matrix, lib.loc="~/R/test-library")
> searchpaths()
  [1] ".GlobalEnv"
  [2] "/data/gannet/ripley/R/test26/Matrix"
  ...

The point is that the namespace Matrix is still loaded.

> detach(2)
> unloadNamespace("Matrix")
> library(Matrix, lib.loc="~/R/test-library")
> searchpaths()
  [1] ".GlobalEnv"
  [2] "/data/gannet/ripley/R/test-library/Matrix"

Might your example be similar?


> $ R
> [...startup info...]
> > # only version we currently know about is in the standard library
> > .find.package("ExamplePackage")
> [1] "c:/R/R-2.4.1/library/ExamplePackage"
> > # load a version from a different library e:/devinst
> > library(ExamplePackage, lib.loc="e:/devinst")
> > # and check we've got the right version ... yes
> > system.file(package="ExamplePackage")
> [1] "e:/devinst/ExamplePackage"
> > .find.package("ExamplePackage")
> [1] "e:/devinst/ExamplePackage"
> > detach(2)
> >
> > # Now I'd like to load the version in the standard library.
> > # .find.package() finds the version I want
> > .find.package("ExamplePackage")
> [1] "c:/R/R-2.4.1/library/ExamplePackage"
> > # but library() loads the same version it did before, even
> > # though I don't supply lib.loc, and .libPaths is untouched.
> > library(ExamplePackage)
> > system.file(package="ExamplePackage")
> [1] "e:/devinst/ExamplePackage"
> > .find.package("ExamplePackage")
> [1] "e:/devinst/ExamplePackage"
> > .libPaths()
> [1] "c:/R/R-2.4.1/library"
> > sessionInfo()
> R version 2.4.1 (2006-12-18)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> States.1252;LC_MON
> ETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United
> States.1252
>
>
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
> [7] "base"
>
> other attached packages:
> ExamplePackage
>          "1.0"
> >
>
> Am I doing something wrong here?  I can't find any mention of
> persistence of package location in ?library.
>
> thanks for any help or suggestions,
>
> Tony Plate
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From rpeng at jhsph.edu  Fri Apr 13 23:25:23 2007
From: rpeng at jhsph.edu (Roger Peng)
Date: Fri, 13 Apr 2007 17:25:23 -0400
Subject: [Rd] directory/filename completion
In-Reply-To: <Pine.LNX.4.64.0704132039290.16284@gannet.stats.ox.ac.uk>
References: <461FC3AA.9010204@jhsph.edu>
	<f8e6ff050704131231u18f0a2efo9d1102895318f7c2@mail.gmail.com>
	<Pine.LNX.4.64.0704132039290.16284@gannet.stats.ox.ac.uk>
Message-ID: <461FF543.90203@jhsph.edu>

Okay, I wasn't sure if it was definitely related to rcompgen or was a 
result of something else.  At least I can turn it off then.

Thanks,
-roger

Prof Brian Ripley wrote:
> On Fri, 13 Apr 2007, hadley wickham wrote:
> 
>> On 4/13/07, Roger Peng <rpeng at jhsph.edu> wrote:
>>
>>> I've noticed something recently in R-beta that has changed since R 2.4.1
>>> and I'm not sure if it's a readline problem or an R problem.  I am on a
>>> Linux FC5 system and in R 2.4.1 I could do
>>>
>>> load("my-directory/
>>>
>>> and then hit TAB and it would list all of the files in 'my-directory',
>>> after which I could start typing the beginning of the file, hit TAB
>>> again, and it would complete the file name along with adding the closing
>>> double quote.
>>>
>>> In R-beta, when I try the same thing, nothing happens (i.e. no directory
>>> listing and no file name completion).  Specifically, if I type
>>>
>>> load("my
>>>
>>> and then it TAB, it will complete the 'my-directory' but it will not
>>> look further into the files inside of 'my-directory'.
>>>
>>> Also, I've noticed that if I rename 'my-directory' to 'mydirectory' (so
>>> no dash), everything works fine (just like in R 2.4.1).
>>>
>>> Has anyone else noticed this?
>>
>>
>> I've noticed that if I have the rcompgen library loaded - perhaps
>> you've installed that recently?
> 
> 
> Loading rcompgen is the default uner 2.5.0 beta, but you can turn it 
> off. This is in the USER-VISIBLE CHANGES in NEWS: just how prominent 
> does it need to be?
> 
> It is a feature of the rcompletion interface to rcompgen, now part of 
> base R.  From the source code comment
> 
>        These break line into tokens.  Unfortunately, this also breaks
>        file names, so a path with a - in it will not be completed.
> 
> We decided to make this the default in 2.5.0 to get user feedback: if it 
> was not switched on few people would use it.
> 

-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/


From p.dalgaard at biostat.ku.dk  Fri Apr 13 23:40:16 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Fri, 13 Apr 2007 23:40:16 +0200
Subject: [Rd] R on Solaris 10 x64
In-Reply-To: <461FE383.70208@sun.com>
References: <461FBE20.4010901@sun.com>
	<Pine.LNX.4.64.0704131918480.695@gannet.stats.ox.ac.uk>
	<461FDD59.8090408@biostat.ku.dk> <461FE383.70208@sun.com>
Message-ID: <461FF8C0.5050707@biostat.ku.dk>

Greg Nakhimovsky wrote:
> Peter,
>
> Thanks for the hints.
>
>> 2 things caught my eye (except that their "R code" is clearly C): The 
>> dbx output doesn't show off[curr_seq], which could actually be the 
>> culprit, 
>
> (dbx) p off[curr_seq]
> off[curr_seq] = 0
>
>> and the _memcpy call on the stack looks odd:
>>
>> _memcpy(0x0, 0xfdebc707, 0x9f5c4f0)
>
> It shows the register values, which are not necessarily the arguments 
> to memcpy(), apparently not in this case.
>
> The "guilty" line of code
>
> HDmemcpy(tgath_buf,buf+off[curr_seq],curr_len);
>
> translates into (due to macro "#define HDmemcpy(X,Y,Z) 
> memcpy((char*)(X),(const char*)(Y),Z)")
Hmm, and can you see "both ends" of tgath_buf and buf (in particular 
tgath_but[curr_len - 1] and buf[curr_len-1])?

If only to "eliminate from our inquiries", I'd try running CPP over the 
code and see if the full macro expansion (including that from memcpy to 
_memcpy) is working as intended.

I take it that you've already tried compiling the module at maximal 
warning level?

>
> memcpy((char*)(tgath_buf),(const char*)(buf+off[curr_seq]),curr_len);
>
> and
>
> (dbx) p tgath_buf
> tgath_buf = 0x9f5c4f0
> (definitely not NULL)
>
> We've also asked for help at help at hdfgroup.org regarding the HDF5 
> package.
>
> This is under Solaris 10 x86, using the latest Sun Studio compiler/tools.
>
> -Greg
>
>>
>>
>> (What happened to the length and how did NULL get in there.) If 
>> memcpy() is a macro, I think I'd take a closer look at the include 
>> files and see if something is getting expanded in an unintended way.


From tplate at acm.org  Fri Apr 13 23:46:17 2007
From: tplate at acm.org (Tony Plate)
Date: Fri, 13 Apr 2007 15:46:17 -0600
Subject: [Rd] how to control which version of a package library()
	installs?
In-Reply-To: <Pine.LNX.4.64.0704132204150.18247@gannet.stats.ox.ac.uk>
References: <461FED8C.2040603@acm.org>
	<Pine.LNX.4.64.0704132204150.18247@gannet.stats.ox.ac.uk>
Message-ID: <461FFA29.8040401@acm.org>

Thank you!  I had not realized that the name space remained loaded. 
When I did unloadNamespace("ExamplePackage") after the detach() I got 
what I wanted.

Maybe the following sentence might be a useful addition to the "Details" 
or "Notes" section of the help page for detach?:
   To detach() and reattach() a package you will probably need to use 
unloadNamespace("somePackage") after detach("package:somePackage")

-- Tony Plate


Prof Brian Ripley wrote:
> On Fri, 13 Apr 2007, Tony Plate wrote:
> 
>> library() seems to remember the location of a package when I give it a
>> lib.loc, and then use that version thereafter, even if I don't supply
> 
> Not quite: it notices that it is loaded and does not load it again, 
> possibly attaching the exports of a still-loaded namespace.
> 
>> lib.loc again.  Is there any way I can load different versions of a
>> package in one R session? -- I don't seem to able to simply detach the
>> package and then load a different version from a different library 
>> location.
> 
> Without the output of search(), searchpath() and loadedNamespace() we 
> cannot know what happened here.  But here is an example of my own
> 
>> library(Matrix, lib.loc="~/R/test26")
> Loading required package: lattice
>> searchpaths()
>  [1] ".GlobalEnv"
>  [2] "/data/gannet/ripley/R/test26/Matrix"
>  ...
>> detach(2)
>> search()
>  [1] ".GlobalEnv"        "package:lattice"   "package:stats"
>  [4] "package:graphics"  "package:grDevices" "package:utils"
>  [7] "package:datasets"  "package:methods"   "Autoloads"
> [10] "package:base"
>> library(Matrix, lib.loc="~/R/test-library")
>> searchpaths()
>  [1] ".GlobalEnv"
>  [2] "/data/gannet/ripley/R/test26/Matrix"
>  ...
> 
> The point is that the namespace Matrix is still loaded.
> 
>> detach(2)
>> unloadNamespace("Matrix")
>> library(Matrix, lib.loc="~/R/test-library")
>> searchpaths()
>  [1] ".GlobalEnv"
>  [2] "/data/gannet/ripley/R/test-library/Matrix"
> 
> Might your example be similar?
> 
> 
>> $ R
>> [...startup info...]
>> > # only version we currently know about is in the standard library
>> > .find.package("ExamplePackage")
>> [1] "c:/R/R-2.4.1/library/ExamplePackage"
>> > # load a version from a different library e:/devinst
>> > library(ExamplePackage, lib.loc="e:/devinst")
>> > # and check we've got the right version ... yes
>> > system.file(package="ExamplePackage")
>> [1] "e:/devinst/ExamplePackage"
>> > .find.package("ExamplePackage")
>> [1] "e:/devinst/ExamplePackage"
>> > detach(2)
>> >
>> > # Now I'd like to load the version in the standard library.
>> > # .find.package() finds the version I want
>> > .find.package("ExamplePackage")
>> [1] "c:/R/R-2.4.1/library/ExamplePackage"
>> > # but library() loads the same version it did before, even
>> > # though I don't supply lib.loc, and .libPaths is untouched.
>> > library(ExamplePackage)
>> > system.file(package="ExamplePackage")
>> [1] "e:/devinst/ExamplePackage"
>> > .find.package("ExamplePackage")
>> [1] "e:/devinst/ExamplePackage"
>> > .libPaths()
>> [1] "c:/R/R-2.4.1/library"
>> > sessionInfo()
>> R version 2.4.1 (2006-12-18)
>> i386-pc-mingw32
>>
>> locale:
>> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
>> States.1252;LC_MON
>> ETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United
>> States.1252
>>
>>
>> attached base packages:
>> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
>> [7] "base"
>>
>> other attached packages:
>> ExamplePackage
>>          "1.0"
>> >
>>
>> Am I doing something wrong here?  I can't find any mention of
>> persistence of package location in ?library.
>>
>> thanks for any help or suggestions,
>>
>> Tony Plate
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From ripley at stats.ox.ac.uk  Sat Apr 14 00:04:00 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 13 Apr 2007 23:04:00 +0100 (BST)
Subject: [Rd] how to control which version of a package library()
	installs?
In-Reply-To: <461FFA29.8040401@acm.org>
References: <461FED8C.2040603@acm.org>
	<Pine.LNX.4.64.0704132204150.18247@gannet.stats.ox.ac.uk>
	<461FFA29.8040401@acm.org>
Message-ID: <Pine.LNX.4.64.0704132252050.17244@auk.stats>

On Fri, 13 Apr 2007, Tony Plate wrote:

> Thank you!  I had not realized that the name space remained loaded. When I 
> did unloadNamespace("ExamplePackage") after the detach() I got what I 
> wanted.
>
> Maybe the following sentence might be a useful addition to the "Details" or 
> "Notes" section of the help page for detach?:
>  To detach() and reattach() a package you will probably need to use 
> unloadNamespace("somePackage") after detach("package:somePackage")

We should try to explain this, but there is another level of complexity.
If a package has compiled code, unloading the namespace is unlikely to 
unload the DLL (it would need to be done explicitly in .onUnload).
And even then, as I understand it there are OSes on which you cannot 
really unload DLLs, and certainly cannot load another DLL of the same name 
into the process: you get the previously loaded one.

Given all the issues, I always work on the assumption that re-loading a 
package into a R session is not going to do what I intend.

>
> -- Tony Plate
>
>
> Prof Brian Ripley wrote:
>> On Fri, 13 Apr 2007, Tony Plate wrote:
>> 
>>> library() seems to remember the location of a package when I give it a
>>> lib.loc, and then use that version thereafter, even if I don't supply
>> 
>> Not quite: it notices that it is loaded and does not load it again, 
>> possibly attaching the exports of a still-loaded namespace.
>> 
>>> lib.loc again.  Is there any way I can load different versions of a
>>> package in one R session? -- I don't seem to able to simply detach the
>>> package and then load a different version from a different library 
>>> location.
>> 
>> Without the output of search(), searchpath() and loadedNamespace() we 
>> cannot know what happened here.  But here is an example of my own
>> 
>>> library(Matrix, lib.loc="~/R/test26")
>> Loading required package: lattice
>>> searchpaths()
>>  [1] ".GlobalEnv"
>>  [2] "/data/gannet/ripley/R/test26/Matrix"
>>  ...
>>> detach(2)
>>> search()
>>  [1] ".GlobalEnv"        "package:lattice"   "package:stats"
>>  [4] "package:graphics"  "package:grDevices" "package:utils"
>>  [7] "package:datasets"  "package:methods"   "Autoloads"
>> [10] "package:base"
>>> library(Matrix, lib.loc="~/R/test-library")
>>> searchpaths()
>>  [1] ".GlobalEnv"
>>  [2] "/data/gannet/ripley/R/test26/Matrix"
>>  ...
>> 
>> The point is that the namespace Matrix is still loaded.
>> 
>>> detach(2)
>>> unloadNamespace("Matrix")
>>> library(Matrix, lib.loc="~/R/test-library")
>>> searchpaths()
>>  [1] ".GlobalEnv"
>>  [2] "/data/gannet/ripley/R/test-library/Matrix"
>> 
>> Might your example be similar?
>> 
>> 
>>> $ R
>>> [...startup info...]
>>> > # only version we currently know about is in the standard library
>>> > .find.package("ExamplePackage")
>>> [1] "c:/R/R-2.4.1/library/ExamplePackage"
>>> > # load a version from a different library e:/devinst
>>> > library(ExamplePackage, lib.loc="e:/devinst")
>>> > # and check we've got the right version ... yes
>>> > system.file(package="ExamplePackage")
>>> [1] "e:/devinst/ExamplePackage"
>>> > .find.package("ExamplePackage")
>>> [1] "e:/devinst/ExamplePackage"
>>> > detach(2)
>>> >
>>> > # Now I'd like to load the version in the standard library.
>>> > # .find.package() finds the version I want
>>> > .find.package("ExamplePackage")
>>> [1] "c:/R/R-2.4.1/library/ExamplePackage"
>>> > # but library() loads the same version it did before, even
>>> > # though I don't supply lib.loc, and .libPaths is untouched.
>>> > library(ExamplePackage)
>>> > system.file(package="ExamplePackage")
>>> [1] "e:/devinst/ExamplePackage"
>>> > .find.package("ExamplePackage")
>>> [1] "e:/devinst/ExamplePackage"
>>> > .libPaths()
>>> [1] "c:/R/R-2.4.1/library"
>>> > sessionInfo()
>>> R version 2.4.1 (2006-12-18)
>>> i386-pc-mingw32
>>> 
>>> locale:
>>> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
>>> States.1252;LC_MON
>>> ETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United
>>> States.1252
>>> 
>>> 
>>> attached base packages:
>>> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
>>> [7] "base"
>>> 
>>> other attached packages:
>>> ExamplePackage
>>>          "1.0"
>>> >
>>> 
>>> Am I doing something wrong here?  I can't find any mention of
>>> persistence of package location in ?library.
>>> 
>>> thanks for any help or suggestions,
>>> 
>>> Tony Plate
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>> 
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From tplate at acm.org  Sat Apr 14 00:10:30 2007
From: tplate at acm.org (Tony Plate)
Date: Fri, 13 Apr 2007 16:10:30 -0600
Subject: [Rd] how to control which version of a package
	library()	installs?
In-Reply-To: <461FFA29.8040401@acm.org>
References: <461FED8C.2040603@acm.org>	<Pine.LNX.4.64.0704132204150.18247@gannet.stats.ox.ac.uk>
	<461FFA29.8040401@acm.org>
Message-ID: <461FFFD6.4040201@acm.org>

Tony Plate wrote:
> [snip]
 >
> Maybe the following sentence might be a useful addition to the "Details" 
> or "Notes" section of the help page for detach?:
>    To detach() and reattach() a package you will probably need to use 
> unloadNamespace("somePackage") after detach("package:somePackage")
> 

Better: "If you want to detach() and reattach() a package to get a 
different version of it, you will probably need to use 
unloadNamespace("somePackage") after detach("package:somePackage")"

-- Tony Plate


From tplate at acm.org  Sat Apr 14 00:31:25 2007
From: tplate at acm.org (Tony Plate)
Date: Fri, 13 Apr 2007 16:31:25 -0600
Subject: [Rd] how to control which version of a package library()
	installs?
In-Reply-To: <Pine.LNX.4.64.0704132252050.17244@auk.stats>
References: <461FED8C.2040603@acm.org>
	<Pine.LNX.4.64.0704132204150.18247@gannet.stats.ox.ac.uk>
	<461FFA29.8040401@acm.org>
	<Pine.LNX.4.64.0704132252050.17244@auk.stats>
Message-ID: <462004BD.60702@acm.org>

Prof Brian Ripley wrote:
> On Fri, 13 Apr 2007, Tony Plate wrote:
> 
>> Thank you!  I had not realized that the name space remained loaded. 
>> When I did unloadNamespace("ExamplePackage") after the detach() I got 
>> what I wanted.
>>
>> Maybe the following sentence might be a useful addition to the 
>> "Details" or "Notes" section of the help page for detach?:
>>  To detach() and reattach() a package you will probably need to use 
>> unloadNamespace("somePackage") after detach("package:somePackage")
> 
> We should try to explain this, but there is another level of complexity.
> If a package has compiled code, unloading the namespace is unlikely to 
> unload the DLL (it would need to be done explicitly in .onUnload).
> And even then, as I understand it there are OSes on which you cannot 
> really unload DLLs, and certainly cannot load another DLL of the same 
> name into the process: you get the previously loaded one.
> 
> Given all the issues, I always work on the assumption that re-loading a 
> package into a R session is not going to do what I intend.

Ok, but will it work for packages with pure R code? (disregarding things 
a package might do in its load hooks).  If so, then how about:

To detach() and reattach() a package in order to get a different version 
of it, it will be necessary to do unloadNamespace("somePackage") after 
detach("package:somePackage").  However, this is very likely to be 
problematic for packages with compiled code because some OSes do not 
support unloading DLLs or loading another DLL of the same name.

Or are there yet other issues?

-- Tony Plate

> 
>>
>> -- Tony Plate
>>
>>
>> Prof Brian Ripley wrote:
>>> On Fri, 13 Apr 2007, Tony Plate wrote:
>>>
>>>> library() seems to remember the location of a package when I give it a
>>>> lib.loc, and then use that version thereafter, even if I don't supply
>>>
>>> Not quite: it notices that it is loaded and does not load it again, 
>>> possibly attaching the exports of a still-loaded namespace.
>>>
>>>> lib.loc again.  Is there any way I can load different versions of a
>>>> package in one R session? -- I don't seem to able to simply detach the
>>>> package and then load a different version from a different library 
>>>> location.
>>>
>>> Without the output of search(), searchpath() and loadedNamespace() we 
>>> cannot know what happened here.  But here is an example of my own
>>>
>>>> library(Matrix, lib.loc="~/R/test26")
>>> Loading required package: lattice
>>>> searchpaths()
>>>  [1] ".GlobalEnv"
>>>  [2] "/data/gannet/ripley/R/test26/Matrix"
>>>  ...
>>>> detach(2)
>>>> search()
>>>  [1] ".GlobalEnv"        "package:lattice"   "package:stats"
>>>  [4] "package:graphics"  "package:grDevices" "package:utils"
>>>  [7] "package:datasets"  "package:methods"   "Autoloads"
>>> [10] "package:base"
>>>> library(Matrix, lib.loc="~/R/test-library")
>>>> searchpaths()
>>>  [1] ".GlobalEnv"
>>>  [2] "/data/gannet/ripley/R/test26/Matrix"
>>>  ...
>>>
>>> The point is that the namespace Matrix is still loaded.
>>>
>>>> detach(2)
>>>> unloadNamespace("Matrix")
>>>> library(Matrix, lib.loc="~/R/test-library")
>>>> searchpaths()
>>>  [1] ".GlobalEnv"
>>>  [2] "/data/gannet/ripley/R/test-library/Matrix"
>>>
>>> Might your example be similar?
>>>
>>>
>>>> $ R
>>>> [...startup info...]
>>>> > # only version we currently know about is in the standard library
>>>> > .find.package("ExamplePackage")
>>>> [1] "c:/R/R-2.4.1/library/ExamplePackage"
>>>> > # load a version from a different library e:/devinst
>>>> > library(ExamplePackage, lib.loc="e:/devinst")
>>>> > # and check we've got the right version ... yes
>>>> > system.file(package="ExamplePackage")
>>>> [1] "e:/devinst/ExamplePackage"
>>>> > .find.package("ExamplePackage")
>>>> [1] "e:/devinst/ExamplePackage"
>>>> > detach(2)
>>>> >
>>>> > # Now I'd like to load the version in the standard library.
>>>> > # .find.package() finds the version I want
>>>> > .find.package("ExamplePackage")
>>>> [1] "c:/R/R-2.4.1/library/ExamplePackage"
>>>> > # but library() loads the same version it did before, even
>>>> > # though I don't supply lib.loc, and .libPaths is untouched.
>>>> > library(ExamplePackage)
>>>> > system.file(package="ExamplePackage")
>>>> [1] "e:/devinst/ExamplePackage"
>>>> > .find.package("ExamplePackage")
>>>> [1] "e:/devinst/ExamplePackage"
>>>> > .libPaths()
>>>> [1] "c:/R/R-2.4.1/library"
>>>> > sessionInfo()
>>>> R version 2.4.1 (2006-12-18)
>>>> i386-pc-mingw32
>>>>
>>>> locale:
>>>> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
>>>> States.1252;LC_MON
>>>> ETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United
>>>> States.1252
>>>>
>>>>
>>>> attached base packages:
>>>> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  
>>>> "methods"
>>>> [7] "base"
>>>>
>>>> other attached packages:
>>>> ExamplePackage
>>>>          "1.0"
>>>> >
>>>>
>>>> Am I doing something wrong here?  I can't find any mention of
>>>> persistence of package location in ?library.
>>>>
>>>> thanks for any help or suggestions,
>>>>
>>>> Tony Plate
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>
>


From sfalcon at fhcrc.org  Sat Apr 14 00:43:19 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Fri, 13 Apr 2007 15:43:19 -0700
Subject: [Rd] how to control which version of a package library()
	installs?
In-Reply-To: <Pine.LNX.4.64.0704132252050.17244@auk.stats> (Brian Ripley's
	message of "Fri, 13 Apr 2007 23:04:00 +0100 (BST)")
References: <461FED8C.2040603@acm.org>
	<Pine.LNX.4.64.0704132204150.18247@gannet.stats.ox.ac.uk>
	<461FFA29.8040401@acm.org>
	<Pine.LNX.4.64.0704132252050.17244@auk.stats>
Message-ID: <m2wt0fhp4o.fsf@fhcrc.org>

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
> We should try to explain this, but there is another level of complexity.
> If a package has compiled code, unloading the namespace is unlikely to 
> unload the DLL (it would need to be done explicitly in .onUnload).
> And even then, as I understand it there are OSes on which you cannot 
> really unload DLLs, and certainly cannot load another DLL of the same name 
> into the process: you get the previously loaded one.
>
> Given all the issues, I always work on the assumption that re-loading a 
> package into a R session is not going to do what I intend.

I work under the same assumption.  It would be nice if package loading
were reversible, but as you point out, there are cases where the OS
will prevent this.

The OP might also note the recent addition of an 'unload' argument to
the detach function which attempts to unload the name space and S4
methods if TRUE.  It will fail if the name space is in use by another
package.

+ seth

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From deepayan.sarkar at gmail.com  Sat Apr 14 03:28:18 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Fri, 13 Apr 2007 18:28:18 -0700
Subject: [Rd] Rinterface.h on Windows
Message-ID: <eb555e660704131828k1664044bs9f56131662bdeaa8@mail.gmail.com>

Hi,

it looks like Rinterface.h is not available on Windows. Does this mean
I can not reset the various ptr_R_* callbacks? Is there an
alternative? Is this something fundamentally difficult or something
not done because no one needs it?

-Deepayan


From hpages at fhcrc.org  Sat Apr 14 03:36:21 2007
From: hpages at fhcrc.org (Herve Pages)
Date: Fri, 13 Apr 2007 18:36:21 -0700
Subject: [Rd] R on Solaris 10 x64
In-Reply-To: <461FBE20.4010901@sun.com>
References: <461FBE20.4010901@sun.com>
Message-ID: <46203015.6000405@fhcrc.org>

Hi David,

Tai-Wei (David) Lin wrote:
> Hi R Developers,
> 
> Greg is helping me with debugging R on Solaris 10 x64. Please let us
> know if you have any thoughts or tips that can help us debug this.
> 
> Thanks,
> 
> David
> 
> 
> 
> ************
> Using default transfer plist
> in vector_io: permuting
> About to write
> 
>  *** caught segfault ***
> address e8554000, cause 'memory not mapped'
> 
> Traceback:
>  1: .External("do_hdf5save", call, sys.frame(sys.parent()), fileout,
>  ..., PACKAGE = "hdf5")
>  2: hdf5save(hdf5_Fstat, "Fstat", "geneNames", "genotype")
> aborting ...
> ************
> 
> We've tried many things to debug it:
> 
> * dbx Runtime Checking (RTC) is not detecting any (meaningful) memory
> access problems that I can see.
> 
> * The same on Solaris/SPARC.
> 
> * Neither does Valgrind on Linux.
> 
> * I've tried increasing the C stack size, assuming R could be running
> out of stack size. Didn't help.
> 
> Running R under dbx (without RTC) until the crash shows this:
> 
> ...
> About to write
> t at 1 (l at 1) signal SEGV (no mapping at the fault address) in _memcpy at
> 0xfe90444b
> 0xfe90444b: _memcpy+0x006b:     movaps   0x00000000(%esi),%xmm0
> Current function is H5D_select_mgath
>   379               HDmemcpy(tgath_buf,buf+off[curr_seq],curr_len);
> (dbx) where
> current thread: t at 1
>   [1] _memcpy(0x0, 0xfdebc707, 0x9f5c4f0), at 0xfe90444b
> =>[2] H5D_select_mgath(_buf = 0x9f79580, space = 0x8966770, iter =
> 0x8045980, nelmts = 3120U, dxpl_cache = 0xfe170078, _tgath_buf =
> 0x9f5c4f0), line 379 in "H5Dselect.c"
>   [3] H5D_contig_write(io_info = 0x804620c, nelmts = 3120ULL, mem_type =
> 0x97b05c8, mem_space = 0x8966770, file_space = 0x8966770, tpath =
> 0x8ee7078, src_id = 201326906, dst_id = 201326904, buf = 0x9f79580),
> line 1418 in "H5Dio.c"
>   [4] H5D_write(dataset = 0x8f169c0, mem_type_id = 201326906, mem_space
> = 0x8966770, file_space = 0x8966770, dxpl_id = 671088643, buf =
> 0x9f79580), line 952 in "H5Dio.c"
>   [5] H5Dwrite(dset_id = 335544330, mem_type_id = 201326906,
> mem_space_id = 0, file_space_id = 0, plist_id = 671088643, buf =
> 0x9f79580), line 586 in "H5Dio.c"
>   [6] vector_io(call = 0x97234ec, writeflag = 1, dataset = 335544330,
> space = 268435472, obj = 0x98386a0), line 535 in "hdf5.c"
>   [7] hdf5_write_vector(call = 0x97234ec, id = 67108867, symname =
> 0x9cf35d0 "geneNames", val = 0x98386a0), line 693 in "hdf5.c"
>   [8] hdf5_save_object(call = 0x97234ec, fid = 67108867, symname =
> 0x9cf35d0 "geneNames", val = 0x98386a0), line 957 in "hdf5.c"
>   [9] do_hdf5save(args = 0x9723284), line 1104 in "hdf5.c"
>   [10] do_External(call = 0x86d62bc, op = 0x8371cd8, args = 0x972340c,
> env = 0x9723594), line 832 in "dotcode.c"
>   [11] Rf_eval(e = 0x86d62bc, rho = 0x9723594), line 445 in "eval.c"
>   [12] Rf_evalList(el = 0x86d6230, rho = 0x9723594, op = 0x837226c),
> line 1463 in "eval.c"
>   [13] Rf_eval(e = 0x86d6214, rho = 0x9723594), line 438 in "eval.c"
>   [14] do_begin(call = 0x86d56bc, op = 0x836709c, args = 0x86d61dc, rho
> = 0x9723594), line 1107 in "eval.c"
>   [15] Rf_eval(e = 0x86d56bc, rho = 0x9723594), line 431 in "eval.c"
>   [16] Rf_applyClosure(call = 0x9723738, op = 0x83c0328, arglist =
> 0x97236e4, rho = 0x8379b1c, suppliedenv = 0x8379b38), line 614 in "eval.c"
>   [17] Rf_eval(e = 0x9723738, rho = 0x8379b1c), line 455 in "eval.c"
>   [18] Rf_ReplIteration(rho = 0x8379b1c, savestack = 0, browselevel = 0,
> state = 0x8047328), line 256 in "main.c"
>   [19] R_ReplConsole(rho = 0x8379b1c, savestack = 0, browselevel = 0),
> line 305 in "main.c"
>   [20] run_Rmainloop(), line 944 in "main.c"
>   [21] Rf_mainloop(), line 951 in "main.c"
>   [22] main(ac = 4, av = 0x80477ac), line 33 in "Rmain.c"
> (dbx) p curr_len
> curr_len = 24960U
> (dbx) p curr_seq
> curr_seq = 0
> (dbx) p of
> dbx: "of" is not defined in the scope
> `libhdf5.so.0.0.0`H5Dselect.c`H5D_select_mgath:347`
> dbx: see `help scope' for details
> (dbx) p off
> off = 0x8042960
> (dbx) p tgath_buf
> tgath_buf = 0x9f5c4f0
> "\xd87\x83^H\xa8\xf3\x82^H0^X\x82^H^X\xd4\x81^H^P\x90\x81^H\xb8m\x80^H^H'\x80^H\x88^?^?^H\x908^?^H\xb0\xf7~^H\xd8\xad~^H\xf8\xb2~^H\xb8\x8e~^H\xe8]~^H\xe8\xcb\xed^HP\xe3}^Hh\xdd\xbb^H\x98\xc4}^H\xf0\xa0}^H\xa8r}^HH}\xc3^HpO|^HH^V|^H^X\xd8|^H\xc0\xb1|^H8=}^H\x90\xcd{^H^Pm{^H\xb8#{^Hx'{^H\x90\xf8x^HpKx^H^POx^H\xa8~w^H^H>w^H\xf0\xb2w^H\xc8^Ew^HX'x^H\xf8\xdbv^H"
> (dbx) p buf
> buf = 0x9f79580
> "\xd87\x83^H\xa8\xf3\x82^H0^X\x82^H^X\xd4\x81^H^P\x90\x81^H\xb8m\x80^H^H'\x80^H\x88^?^?^H\x908^?^H\xb0\xf7~^H\xd8\xad~^H\xf8\xb2~^H\xb8\x8e~^H\xe8]~^H\xe8\xcb\xed^HP\xe3}^Hh\xdd\xbb^H\x98\xc4}^H\xf0\xa0}^H\xa8r}^HH}\xc3^HpO|^HH^V|^H^X\xd8|^H\xc0\xb1|^H8=}^H\x90\xcd{^H^Pm{^H\xb8#{^Hx'{^H\x90\xf8x^HpKx^H^POx^H\xa8~w^H^H>w^H\xf0\xb2w^H\xc8^Ew^HX'x^H\xf8\xdbv^H"
> (dbx) p nseq
> nseq = 1U
> (dbx) p len
> len = 0x804195c
> (dbx) p len[0..2]
> len[0..2] =
> [0] = 24960U
> [1] = 140025512U
> [2] = 140013048U
> (dbx)
> 
> 
> The R code in question is:
> 
> ...
>         /* Loop, while sequences left to process */
>         for(curr_seq=0; curr_seq<nseq; curr_seq++) {
>             /* Get the number of bytes in sequence */
>             curr_len=len[curr_seq];
> 
>             HDmemcpy(tgath_buf,buf+off[curr_seq],curr_len);
> 
>             /* Advance offset in gather buffer */
>             tgath_buf+=curr_len;
>         } /* end for */
> ...


What's the initial size of tgath_buf? You need to make sure that you are not stepping
out of it i.e. that sum(len[i], for 0<=i<nseq) is not greater than its initial size.
That's for the writing side. Same on the reading side: you need to make sure that
buf+off[curr_seq]+len[i]-1 is a safe place to be for any 0<=i<nseq.

Otherwise, expect bad things to happen. And they are generally not reproducible in a
consistent way. So even if this code never crashes on other systems, it doesn't mean that
it is not broken.

Cheers,
H.


> 
> where
> 
> ./src/hdf5-1.6.5/src/H5private.h:
> #define HDmemcpy(X,Y,Z)  memcpy((char*)(X),(const char*)(Y),Z)
> 
> Maybe the "curr_len = 24960U" value is too high. I have no way of
> knowing what it should be in this case.
> 
> The crash could be caused by a compiler bug, although it's not very
> likely. These crashes have occurred both with and without optimization,
> with and without -g.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From deepayan.sarkar at gmail.com  Sat Apr 14 03:45:42 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Fri, 13 Apr 2007 18:45:42 -0700
Subject: [Rd] Rinterface.h on Windows
In-Reply-To: <eb555e660704131828k1664044bs9f56131662bdeaa8@mail.gmail.com>
References: <eb555e660704131828k1664044bs9f56131662bdeaa8@mail.gmail.com>
Message-ID: <eb555e660704131845m54d417feqbd663122a8cda50a@mail.gmail.com>

On 4/13/07, Deepayan Sarkar <deepayan.sarkar at gmail.com> wrote:
> Hi,
>
> it looks like Rinterface.h is not available on Windows. Does this mean
> I can not reset the various ptr_R_* callbacks? Is there an
> alternative? Is this something fundamentally difficult or something
> not done because no one needs it?

For the record, I would really like it if this worked on Windows,
because my Qt GUI seems to be working fine if I comment out these
callbacks (except that nothing gets printed on the console).

-Deepayan


From ripley at stats.ox.ac.uk  Sat Apr 14 06:52:45 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 14 Apr 2007 05:52:45 +0100 (BST)
Subject: [Rd] Rinterface.h on Windows
In-Reply-To: <eb555e660704131828k1664044bs9f56131662bdeaa8@mail.gmail.com>
References: <eb555e660704131828k1664044bs9f56131662bdeaa8@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0704140540240.26420@gannet.stats.ox.ac.uk>

On Fri, 13 Apr 2007, Deepayan Sarkar wrote:

> Hi,
>
> it looks like Rinterface.h is not available on Windows. Does this mean
> I can not reset the various ptr_R_* callbacks? Is there an
> alternative? Is this something fundamentally difficult or something
> not done because no one needs it?

To my knowledge no one has asked for it, so I assume the latter.
At a glance, it does not look too difficult, as similar things are going 
on in src/gnuwin32/system.c.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Sat Apr 14 09:07:46 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 14 Apr 2007 08:07:46 +0100 (BST)
Subject: [Rd] how to control which version of a package library()
	installs?
In-Reply-To: <462004BD.60702@acm.org>
References: <461FED8C.2040603@acm.org>
	<Pine.LNX.4.64.0704132204150.18247@gannet.stats.ox.ac.uk>
	<461FFA29.8040401@acm.org>
	<Pine.LNX.4.64.0704132252050.17244@auk.stats>
	<462004BD.60702@acm.org>
Message-ID: <Pine.LNX.4.64.0704140744510.23679@auk.stats>

On Fri, 13 Apr 2007, Tony Plate wrote:

> Prof Brian Ripley wrote:
>> On Fri, 13 Apr 2007, Tony Plate wrote:
>>
>>> Thank you!  I had not realized that the name space remained loaded.
>>> When I did unloadNamespace("ExamplePackage") after the detach() I got
>>> what I wanted.

Seth Falcon mentioned detach(unload=TRUE) (needs R 2.5.x, I think), but 
unloadNamespace() does detach() if needed.

>>> Maybe the following sentence might be a useful addition to the
>>> "Details" or "Notes" section of the help page for detach?:
>>>  To detach() and reattach() a package you will probably need to use
>>> unloadNamespace("somePackage") after detach("package:somePackage")
>>
>> We should try to explain this, but there is another level of complexity.
>> If a package has compiled code, unloading the namespace is unlikely to
>> unload the DLL (it would need to be done explicitly in .onUnload).
>> And even then, as I understand it there are OSes on which you cannot
>> really unload DLLs, and certainly cannot load another DLL of the same
>> name into the process: you get the previously loaded one.
>>
>> Given all the issues, I always work on the assumption that re-loading a
>> package into a R session is not going to do what I intend.
>
> Ok, but will it work for packages with pure R code? (disregarding things
> a package might do in its load hooks).

Not necessarily, because registered S3 methods are not removed.
Also, you cannot unload a name space from which there are imports in use.

Also, exported S4 methods from a name space are cached, so the S4 methods 
cache needs to be rebuilt (which would happen if the new version of the 
package had S4 methods, and is done by detach(unload=TRUE)).  However, the 
S4 story is worse: setting S4 generics in a package on an existing 
function captures the definition at package install time, so changing the 
version of one package may require others to be re-installed.  (That is 
not hypothetical: it has happened in R-devel several times in the last two 
weeks.)

I won't even start to mention versioned installs ....

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Greg.Nakhimovsky at Sun.COM  Fri Apr 13 22:09:39 2007
From: Greg.Nakhimovsky at Sun.COM (Greg Nakhimovsky)
Date: Fri, 13 Apr 2007 16:09:39 -0400
Subject: [Rd] R on Solaris 10 x64
In-Reply-To: <461FDD59.8090408@biostat.ku.dk>
References: <461FBE20.4010901@sun.com>
	<Pine.LNX.4.64.0704131918480.695@gannet.stats.ox.ac.uk>
	<461FDD59.8090408@biostat.ku.dk>
Message-ID: <461FE383.70208@sun.com>

Peter,

Thanks for the hints.

> 2 things caught my eye (except that their "R code" is clearly C): The 
> dbx output doesn't show off[curr_seq], which could actually be the 
> culprit, 

(dbx) p off[curr_seq]
off[curr_seq] = 0

> and the _memcpy call on the stack looks odd:
> 
> _memcpy(0x0, 0xfdebc707, 0x9f5c4f0)

It shows the register values, which are not necessarily the 
arguments to memcpy(), apparently not in this case.

The "guilty" line of code

HDmemcpy(tgath_buf,buf+off[curr_seq],curr_len);

translates into (due to macro "#define HDmemcpy(X,Y,Z) 
memcpy((char*)(X),(const char*)(Y),Z)")

memcpy((char*)(tgath_buf),(const char*)(buf+off[curr_seq]),curr_len);

and

(dbx) p tgath_buf
tgath_buf = 0x9f5c4f0
(definitely not NULL)

We've also asked for help at help at hdfgroup.org regarding the HDF5 
package.

This is under Solaris 10 x86, using the latest Sun Studio 
compiler/tools.

-Greg

> 
> 
> (What happened to the length and how did NULL get in there.) If memcpy() 
> is a  macro, I think I'd take a closer look at the include files and see 
> if something is getting expanded  in an unintended way.


From Greg.Nakhimovsky at Sun.COM  Sat Apr 14 00:01:29 2007
From: Greg.Nakhimovsky at Sun.COM (Greg Nakhimovsky)
Date: Fri, 13 Apr 2007 18:01:29 -0400
Subject: [Rd] R on Solaris 10 x64
In-Reply-To: <461FF8C0.5050707@biostat.ku.dk>
References: <461FBE20.4010901@sun.com>
	<Pine.LNX.4.64.0704131918480.695@gannet.stats.ox.ac.uk>
	<461FDD59.8090408@biostat.ku.dk> <461FE383.70208@sun.com>
	<461FF8C0.5050707@biostat.ku.dk>
Message-ID: <461FFDB9.1010400@sun.com>

> Hmm, and can you see "both ends" of tgath_buf and buf (in particular 
> tgath_but[curr_len - 1] and buf[curr_len-1])?

(dbx) p tgath_buf[curr_len - 1]
tgath_buf[curr_len-1] = '\0'
(dbx) p buf[curr_len-1]
dbx: cannot access address 0x9f7f6ff
(dbx) p tgath_buf[curr_len - 2]
tgath_buf[curr_len-2] = '\0'
(dbx) p buf[curr_len-2]
dbx: cannot access address 0x9f7f6fe
(dbx)

Something is definitely wrong with this memcpy() operation. I 
suppose we'll need some help from the HDF5 folks to figure out 
what the buf memory buffer is supposed contain in this case.

> If only to "eliminate from our inquiries", I'd try running CPP over the 
> code and see if the full macro expansion (including that from memcpy to 
> _memcpy) is working as intended.

After the macro expansion, this code looks like this:

         for(curr_seq=0; curr_seq<nseq; curr_seq++) {
             curr_len=len[curr_seq];
              memcpy ( ( char * ) ( tgath_buf ) , ( const char * 
) ( buf + off [curr_seq ] ) , curr_len );
             tgath_buf+=curr_len;
         }
> I take it that you've already tried compiling the module at maximal 
> warning level?

No. We can try that, as well as lint.

Thanks.

-Greg


From Kurt.Hornik at wu-wien.ac.at  Sat Apr 14 16:44:13 2007
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Sat, 14 Apr 2007 16:44:13 +0200
Subject: [Rd] CRAN packages with invalid maintainer email addresses
Message-ID: <17952.59581.613933.966858@mithrandir.hornik.net>

As part of the process for the upcoming release of 2.5.0, we recently
contacted all maintainers of CRAN packages which give R CMD check
warnings or errors for a current prerelease of R 2.5.0.

Emails to the following addresses bounced:

  "Jens Henrik Badsberg" <JensHenrik.Badsberg at agrsci.dk>
  vito.muggeo at giustizia.it
  susanneheim at gmx.de
  ivisser at uva.nl
  beat.kaufmann at epfl.ch
  adinno at hsph.harvard.edu
  curran at stats.waikato.ac.nz
  ebarrios at wisc.edu
  j.schaber at web.de
  aas.claus.dethlefsen at nja.dk

meaning that the packages  

  BHH2 Bolstad CoCo LoopAnalyst depmix dynamicGraph giRaph mathgraph
  pheno riv segmented svcm

are to be considered unmaintained.  

If you maintain one of these package, pls do provide an update fixing
the problems indicated on
http://cran.r-project.org/src/contrib/checkSummary.html, and provide a
valid email address.

If you know how to contact the respective maintainers, pls let me know.

If we receive no new information regarding these packages/maintainers,
we need to start orphaning these packages when 2.5.0 is released (Apr
24, 10 days from now).

Thanks!

-k


From deepayan.sarkar at gmail.com  Sun Apr 15 03:13:15 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Sat, 14 Apr 2007 18:13:15 -0700
Subject: [Rd] Rinterface.h on Windows
In-Reply-To: <Pine.LNX.4.64.0704140540240.26420@gannet.stats.ox.ac.uk>
References: <eb555e660704131828k1664044bs9f56131662bdeaa8@mail.gmail.com>
	<Pine.LNX.4.64.0704140540240.26420@gannet.stats.ox.ac.uk>
Message-ID: <eb555e660704141813l37669f5eifd446b3c80cb73d1@mail.gmail.com>

On 4/13/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On Fri, 13 Apr 2007, Deepayan Sarkar wrote:
>
> > Hi,
> >
> > it looks like Rinterface.h is not available on Windows. Does this mean
> > I can not reset the various ptr_R_* callbacks? Is there an
> > alternative? Is this something fundamentally difficult or something
> > not done because no one needs it?
>
> To my knowledge no one has asked for it, so I assume the latter.
> At a glance, it does not look too difficult, as similar things are going
> on in src/gnuwin32/system.c.

Hmm, so I guess the good long term strategy would be to convert that
to using the Rinterface.h API. I'll take a look some day when I'm
feeling more adventurous.

-Deepayan


From ripley at stats.ox.ac.uk  Sun Apr 15 09:30:10 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 15 Apr 2007 08:30:10 +0100 (BST)
Subject: [Rd] Sort output of apropos
In-Reply-To: <m2abxfufss.fsf@fhcrc.org>
References: <m2abxfufss.fsf@fhcrc.org>
Message-ID: <Pine.LNX.4.64.0704150828360.12218@gannet.stats.ox.ac.uk>

Seems sensible, but 2.5.0 is in feature freeze and it is possible that 
someone has relied on this.

I've added this (and a \value section to the help file) for R-devel.


On Wed, 11 Apr 2007, Seth Falcon wrote:

> A further improvement to apropos() would be to sort the output.
> Currently, the output of apropos is in the order found on the search
> list and this will rarely be useful to the user.
>
> All that is needed is a sort(x) at the end of the function.
>
> + seth
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sfalcon at fhcrc.org  Sun Apr 15 17:35:41 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Sun, 15 Apr 2007 08:35:41 -0700
Subject: [Rd] Sort output of apropos
In-Reply-To: <Pine.LNX.4.64.0704150828360.12218@gannet.stats.ox.ac.uk> (Brian
	Ripley's message of "Sun, 15 Apr 2007 08:30:10 +0100 (BST)")
References: <m2abxfufss.fsf@fhcrc.org>
	<Pine.LNX.4.64.0704150828360.12218@gannet.stats.ox.ac.uk>
Message-ID: <m2abx9fy5u.fsf@fhcrc.org>

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> Seems sensible, but 2.5.0 is in feature freeze and it is possible that
> someone has relied on this.
>
> I've added this (and a \value section to the help file) for R-devel.

Excellent.  Thank you.

+ seth

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From hb at stat.berkeley.edu  Sun Apr 15 20:01:44 2007
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sun, 15 Apr 2007 11:01:44 -0700
Subject: [Rd] save() and interrupts
Message-ID: <59d7961d0704151101w2e892a98r81038a7a336a2ec1@mail.gmail.com>

Hi,

are there any (cross-platform) specs on what the saved filed is if
save() is interrupted, e.g. by a user interrupt?   It could be
non-existing, empty, partly written, or completed.

Thanks

Henrik


From ripley at stats.ox.ac.uk  Sun Apr 15 21:09:56 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 15 Apr 2007 20:09:56 +0100 (BST)
Subject: [Rd] save() and interrupts
In-Reply-To: <59d7961d0704151101w2e892a98r81038a7a336a2ec1@mail.gmail.com>
References: <59d7961d0704151101w2e892a98r81038a7a336a2ec1@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0704151945120.11794@gannet.stats.ox.ac.uk>

On Sun, 15 Apr 2007, Henrik Bengtsson wrote:

> are there any (cross-platform) specs on what the saved filed is if
> save() is interrupted, e.g. by a user interrupt?   It could be
> non-existing, empty, partly written, or completed.

My understanding is that you cannot user interrupt compiled code unless it 
is set up to check interrupts.  Version 2 saves are done via the internal 
saveToConn, and I don't see any calls to R_CheckUserInterrupt there. So 
you only need to worry about user interrupts in the R code, and that has 
an on.exit action to close the connection (which should be executed even 
if you interrupt).  Which suggests that the file will be

non-existent
empty
complete

and the first two depend on interrupting in the millisecond or less before 
the compiled code gets called.

For other forms of interrupts, e.g. a Unix kill -9, the file state could 
be anything.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at stat.berkeley.edu  Sun Apr 15 21:46:42 2007
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sun, 15 Apr 2007 12:46:42 -0700
Subject: [Rd] save() and interrupts
In-Reply-To: <Pine.LNX.4.64.0704151945120.11794@gannet.stats.ox.ac.uk>
References: <59d7961d0704151101w2e892a98r81038a7a336a2ec1@mail.gmail.com>
	<Pine.LNX.4.64.0704151945120.11794@gannet.stats.ox.ac.uk>
Message-ID: <59d7961d0704151246y3005178av67bd5396b991606a@mail.gmail.com>

Hi,

thanks for this.

On 4/15/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On Sun, 15 Apr 2007, Henrik Bengtsson wrote:
>
> > are there any (cross-platform) specs on what the saved filed is if
> > save() is interrupted, e.g. by a user interrupt?   It could be
> > non-existing, empty, partly written, or completed.
>
> My understanding is that you cannot user interrupt compiled code unless it
> is set up to check interrupts.  Version 2 saves are done via the internal
> saveToConn, and I don't see any calls to R_CheckUserInterrupt there. So
> you only need to worry about user interrupts in the R code, and that has
> an on.exit action to close the connection (which should be executed even
> if you interrupt).  Which suggests that the file will be
>
> non-existent
> empty
> complete
>
> and the first two depend on interrupting in the millisecond or less before
> the compiled code gets called.

I'll put it on my todo list to investigate how to make save() more
robust against interrupts before calling the internal code.  One
option is to use tryCatch().  However, that does not handle too
frequent user interrupts, e.g. if an interrupt is sent while in the
"interrupt" call, that will interrupt the function.  So, tryCatch()
alone will only lower the risk for incomplete empty files.  For data
written to files, one alternative is to check for files of zero size
in the on.exit() statement and remove such.

/Henrik

>
> For other forms of interrupts, e.g. a Unix kill -9, the file state could
> be anything.
>
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


From sfalcon at fhcrc.org  Mon Apr 16 01:51:39 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Sun, 15 Apr 2007 16:51:39 -0700
Subject: [Rd] as() creates invalid entries in methods list?
Message-ID: <m2fy71dwms.fsf@fhcrc.org>

Hi,

We've observed rather strange behavior related to as().  When as() is
used to make a conversion to a super class, an invalid entry is
inserted into the table of methods.

   > setClass("A", contains="list")
   > get(".MTable", environment(coerce))[["list#A"]]
   NULL

   > as(list(), "A")
   > get(".MTable", environment(coerce))[["list#A"]]
   function (from, to) 
   {
       obj <- new("A")
       as(obj, "list") <- from
       obj
   }
   <environment: namespace:methods>

Entries in .MTable should be MethodDefinition objects (or at least
that is what is usually there for methods defined via setAs).  It
happens that if you try to load a package that has a NAMESPACE file
with a directive exportMethods(coerce) but no call to setAs then you
get an error:

   library("hello")
   Error in .mergeMethodsTable(generic, mtable, get(tname, envir = env),  : 
           Invalid object in meta table of methods for "coerce", label "list#A", had class "function"

So I think there are two problems that might need fixes:

1. methods::as shouldn't create invalid entries.  I've included a
   patch (see below) that seems to help, but I'm not sure it is the
   right fix.  For example, there are two helper functions that create
   coerce methods and perhaps a better fix is for both of these to be
   modified to return MethodDefinition objects.

2. The name space code allows packages to have methods listed in
   exportMethods directives even if no corresponding setMethod,
   setGeneric, or setAs call appears in the R code.  Ideally, a
   warning or error would be raised in this case.  I'm not sure such a
   declaration should do any harm in theory, but in practice it seems
   to trigger subtle bugs in the methods package.

+ seth

--- a/src/library/methods/R/as.R
+++ b/src/library/methods/R/as.R
@@ -37,9 +37,6 @@ as <-
                   test <- ext at test
                   asMethod <- .makeAsMethod(ext at coerce, ext at simple, Class, Clas
                   canCache <- (!is(test, "function")) || identical(body(test), 
-                  if(canCache) { # make into method definition
-                    asMethod <- .asCoerceMethod(asMethod, sig, FALSE)
-                  }
                 }
             }
             if(is.null(asMethod) && extends(Class, thisClass)) {
@@ -54,6 +51,10 @@ as <-
                                          fdef = coerceFun, mlist =
                                          coerceMethods)
                 inherited <- TRUE
+            } else {
+                if(canCache) { # make into method definition
+                    asMethod <- .asCoerceMethod(asMethod, sig, FALSE)
+                }
             }
             ## cache in the coerce function's environment
             if(canCache && !is.null(asMethod)) {



-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From kate at few.vu.nl  Mon Apr 16 09:35:43 2007
From: kate at few.vu.nl (Katharine Mullen)
Date: Mon, 16 Apr 2007 09:35:43 +0200 (CEST)
Subject: [Rd] nls with algorithm = "port", starting values
Message-ID: <Pine.GSO.4.56.0704160924550.26251@laurel.few.vu.nl>

The documentation for nls says the following about the starting values:

 start: a named list or named numeric vector of starting estimates.
          Since R 2.4.0, when 'start' is missing, a very cheap guess
          for 'start' is tried (if 'algorithm != "plinear"').

It may be a good idea to document that when algorithm = "port", if start
is a named list, the elements of the list must be numeric vectors of
length 1.  Ie, start = list(a=1,b=2,c=3) is ok, but start = list(a=c(1,2),
b=3) is not.  This is not the case when algorithm is "plinear" or the
default GN, and is because of the way that the "port" code in nls.R
transforms the starting values (the other options do something else):

nls_port_fit <- function(m, start, lower, upper, control, trace)
{
    ## Establish the working vectors and check and set options
    p <- length(par <- as.double(start))


Example:

## exponentially decaying data
getExpmat <- function(theta, t)
{
        conc <- matrix(nrow = length(t), ncol = length(theta))
        for(i in 1:length(theta)) {
                conc[, i] <- exp(- theta[i] * t)
        }
        conc
}

expsum <- as.vector(getExpmat(c(.05,.005), 1:100) %*% c(1,1))
expsumNoisy <- expsum + max(expsum) *.001 * rnorm(100)
expsum.df <-data.frame(expsumNoisy)

## estimate decay rates, amplitudes with default Gauss-Newton
summary (nls(expsumNoisy ~ getExpmat(k, 1:100) %*% sp, expsum.df, start =
list(k = c(.6,.02), sp = c(1,2)), trace=TRUE, control =
nls.control(maxiter=20,
warnOnly =  TRUE)))

## won't work with port
summary (nls(expsumNoisy ~ getExpmat(k, 1:100) %*% sp, expsum.df, start =
list(k = c(.6,.02), sp = c(1,2)), algorithm = "port",
trace=TRUE, control = nls.control(maxiter=20,
warnOnly =  TRUE)))


From gregor.gorjanc at bfro.uni-lj.si  Mon Apr 16 13:01:37 2007
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Mon, 16 Apr 2007 13:01:37 +0200
Subject: [Rd] Sweave.sh shell script on CRAN
Message-ID: <46235791.6080308@bfro.uni-lj.si>

Dear developeRs,

Martin Maechler has suggested that I resend this email to R-devel
instead to R-packages for further comments and potential availability
for Windows.

----------------------------------------------------------------------

I have uploaded my Sweave (bash) shell script on CRAN. It is available at

http://cran.r-project.org/contrib/extra/scripts/

In short this script runs Sweave on given Rnw file(s) and post process
produced tex file(s) with LaTeX and friends directly from command line.
It has quite a rich set of command line options to mainly ease the LaTeX
compilation.

Please do not hesitate to contact me in case you find errors or have
suggestions and/or code contributions. I am particularly, interested in
making this script work under Windows.

----------------------------------------------------------------------

I do not have any experience with use of (bash) shell scripts under
Windows. Sweave.sh can be used with Cygwin, but I am not sure how to use
shell script without Cygwin. I noticed that some "scripts" in R*/bin
directory on our Windows machine are perl (build, check, INSTALL, ...)
and shell (Rd2dvi.sh, Stangle.sh, Sweave.sh, ...) scripts. This
therefore means that R ships also perl and shell interpreter or am I
missing something?

Thanks!

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc
----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty        www: http://www.bfro.uni-lj.si/MR/ggorjan
Zootechnical Department     blog: http://ggorjan.blogspot.com
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si
SI-1230 Domzale             fax: +386 (0)1 72 17 888
Slovenia, Europe            tel: +386 (0)1 72 17 861


From hin-tak.leung at cimr.cam.ac.uk  Mon Apr 16 13:15:27 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Mon, 16 Apr 2007 12:15:27 +0100
Subject: [Rd] how to control which version of a package
	library()	installs?
In-Reply-To: <Pine.LNX.4.64.0704132252050.17244@auk.stats>
References: <461FED8C.2040603@acm.org>	<Pine.LNX.4.64.0704132204150.18247@gannet.stats.ox.ac.uk>	<461FFA29.8040401@acm.org>
	<Pine.LNX.4.64.0704132252050.17244@auk.stats>
Message-ID: <46235ACF.9060408@cimr.cam.ac.uk>

Prof Brian Ripley wrote:
<snipped>
> 
> We should try to explain this, but there is another level of complexity.
> If a package has compiled code, unloading the namespace is unlikely to 
> unload the DLL (it would need to be done explicitly in .onUnload).
> And even then, as I understand it there are OSes on which you cannot 
> really unload DLLs, and certainly cannot load another DLL of the same name 
> into the process: you get the previously loaded one.
<snipped>

On this, I am quite sure I have managed to crash wine on linux by
dyn.load() an updated version of a DLL of the same name with win32 R in
wine. It is obviously a useful thing to be able to change the source,
re-compile it, and load a new version into R, so that's why I did it,
I think. (and it does work with native R on linux). Genuine windows
may or may not crash, but I don't usually sit in front of windows
for development...

HTL


From murdoch at stats.uwo.ca  Mon Apr 16 13:23:34 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 16 Apr 2007 07:23:34 -0400
Subject: [Rd] Sweave.sh shell script on CRAN
In-Reply-To: <46235791.6080308@bfro.uni-lj.si>
References: <46235791.6080308@bfro.uni-lj.si>
Message-ID: <46235CB6.3050201@stats.uwo.ca>

On 4/16/2007 7:01 AM, Gregor Gorjanc wrote:
> Dear developeRs,
> 
> Martin Maechler has suggested that I resend this email to R-devel
> instead to R-packages for further comments and potential availability
> for Windows.
> 
> ----------------------------------------------------------------------
> 
> I have uploaded my Sweave (bash) shell script on CRAN. It is available at
> 
> http://cran.r-project.org/contrib/extra/scripts/
> 
> In short this script runs Sweave on given Rnw file(s) and post process
> produced tex file(s) with LaTeX and friends directly from command line.
> It has quite a rich set of command line options to mainly ease the LaTeX
> compilation.
> 
> Please do not hesitate to contact me in case you find errors or have
> suggestions and/or code contributions. I am particularly, interested in
> making this script work under Windows.
> 
> ----------------------------------------------------------------------
> 
> I do not have any experience with use of (bash) shell scripts under
> Windows. Sweave.sh can be used with Cygwin, but I am not sure how to use
> shell script without Cygwin. I noticed that some "scripts" in R*/bin
> directory on our Windows machine are perl (build, check, INSTALL, ...)
> and shell (Rd2dvi.sh, Stangle.sh, Sweave.sh, ...) scripts. This
> therefore means that R ships also perl and shell interpreter or am I
> missing something?

We don't ship Perl or sh.exe, but we do describe how to get them in the 
R Admin manual.

I'd be interested in talking to you about integration of my patchDVI 
functions into your script.  They allow forward and reverse search 
between the .dvi file and the .Rnw file (in yap and xdvi, at least).

Duncan Murdoch


From gregor.gorjanc at bfro.uni-lj.si  Mon Apr 16 13:53:21 2007
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Mon, 16 Apr 2007 13:53:21 +0200
Subject: [Rd] Sweave.sh shell script on CRAN
In-Reply-To: <46235CB6.3050201@stats.uwo.ca>
References: <46235791.6080308@bfro.uni-lj.si> <46235CB6.3050201@stats.uwo.ca>
Message-ID: <462363B1.7000406@bfro.uni-lj.si>

Duncan Murdoch wrote:
>> I do not have any experience with use of (bash) shell scripts under
>> Windows. Sweave.sh can be used with Cygwin, but I am not sure how to use
>> shell script without Cygwin. I noticed that some "scripts" in R*/bin
>> directory on our Windows machine are perl (build, check, INSTALL, ...)
>> and shell (Rd2dvi.sh, Stangle.sh, Sweave.sh, ...) scripts. This
>> therefore means that R ships also perl and shell interpreter or am I
>> missing something?
> 
> We don't ship Perl or sh.exe, but we do describe how to get them in the
> R Admin manual.

Maybe I got this totally wrong. Say someone who uses Windows finds R and
installs it via setup file. Can he/she launch the folowing without
having Perl and/or sh.exe?

R CMD script whateverOption

> I'd be interested in talking to you about integration of my patchDVI
> functions into your script.  They allow forward and reverse search
> between the .dvi file and the .Rnw file (in yap and xdvi, at least).

I am all ears.

Gregor


From ggrothendieck at gmail.com  Mon Apr 16 15:16:18 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 16 Apr 2007 09:16:18 -0400
Subject: [Rd] Sweave.sh shell script on CRAN
In-Reply-To: <46235CB6.3050201@stats.uwo.ca>
References: <46235791.6080308@bfro.uni-lj.si> <46235CB6.3050201@stats.uwo.ca>
Message-ID: <971536df0704160616q4b4e2f10oc2f96bb334eb677a@mail.gmail.com>

On Windows sweave.bat is a Windows XP batchfile that will run sweave
and then latex and then display the file on screen.   Issuing the command
sweave without args from the Windows command line gives info on how to use it.

The batchfiles home page is:

   http://code.google.com/p/batchfiles/

The public svn for batchfiles is there and there is also a link
there to CRAN where the distribution itself is located.

There is some info in the README file and also if you issue the command

   sweave

without args it gives instructions on use.

To install sweave.bat you must place sweave.bat (and Rcmd.bat) both
from this batchfiles distribution anywhere in your path.  It does not require
sh.exe and does not make use of perl but does use  "Rcmd sweave"
so would have no prerequisites beyond latex, Acrobot (or other viewer)
and those of Rcmd.




On 4/16/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 4/16/2007 7:01 AM, Gregor Gorjanc wrote:
> > Dear developeRs,
> >
> > Martin Maechler has suggested that I resend this email to R-devel
> > instead to R-packages for further comments and potential availability
> > for Windows.
> >
> > ----------------------------------------------------------------------
> >
> > I have uploaded my Sweave (bash) shell script on CRAN. It is available at
> >
> > http://cran.r-project.org/contrib/extra/scripts/
> >
> > In short this script runs Sweave on given Rnw file(s) and post process
> > produced tex file(s) with LaTeX and friends directly from command line.
> > It has quite a rich set of command line options to mainly ease the LaTeX
> > compilation.
> >
> > Please do not hesitate to contact me in case you find errors or have
> > suggestions and/or code contributions. I am particularly, interested in
> > making this script work under Windows.
> >
> > ----------------------------------------------------------------------
> >
> > I do not have any experience with use of (bash) shell scripts under
> > Windows. Sweave.sh can be used with Cygwin, but I am not sure how to use
> > shell script without Cygwin. I noticed that some "scripts" in R*/bin
> > directory on our Windows machine are perl (build, check, INSTALL, ...)
> > and shell (Rd2dvi.sh, Stangle.sh, Sweave.sh, ...) scripts. This
> > therefore means that R ships also perl and shell interpreter or am I
> > missing something?
>
> We don't ship Perl or sh.exe, but we do describe how to get them in the
> R Admin manual.
>
> I'd be interested in talking to you about integration of my patchDVI
> functions into your script.  They allow forward and reverse search
> between the .dvi file and the .Rnw file (in yap and xdvi, at least).
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From gregor.gorjanc at bfro.uni-lj.si  Mon Apr 16 15:39:38 2007
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Mon, 16 Apr 2007 15:39:38 +0200
Subject: [Rd] Sweave.sh shell script on CRAN
In-Reply-To: <971536df0704160616q4b4e2f10oc2f96bb334eb677a@mail.gmail.com>
References: <46235791.6080308@bfro.uni-lj.si> <46235CB6.3050201@stats.uwo.ca>
	<971536df0704160616q4b4e2f10oc2f96bb334eb677a@mail.gmail.com>
Message-ID: <46237C9A.8000006@bfro.uni-lj.si>

Gabor Grothendieck wrote:
> On Windows sweave.bat is a Windows XP batchfile that will run sweave
> and then latex and then display the file on screen.   Issuing the command
> sweave without args from the Windows command line gives info on how to
> use it.
> 

Nice to see windows "equivalent". However, I must say that my script
provides several ways to get to the result e.g. if you use prosper you
need to go via postscript, beamer behaves differently etc.

There are now the following ways of LaTeX processing:

Command and path Script option             Used tools
- texi2dvi
  - PS          -tp, --texi2dvi2ps       texi2dvi and dvips
  - PS to PDF   -tld, --texi2dvi2ps2pdf  texi2dvi, dvips and ps2pdf
  - PDF         -td, --texi2dvi2pdf      texi2dvi with pdf option

- latex
  - PS          -lp, --latex2dvi2ps      hardcoded 'latex+co' + dvips
  - PS to PDF   -lld, --latex2dvi2ps2pdf hardcoded 'latex+co' + dvips

- pdflatex
  - PDF         -ld, --latex2pdf         hardcoded 'latex+co' + dvips

> To install sweave.bat you must place sweave.bat (and Rcmd.bat) both
> from this batchfiles distribution anywhere in your path.  It does not
> require
> sh.exe and does not make use of perl but does use  "Rcmd sweave"
> so would have no prerequisites beyond latex, Acrobot (or other viewer)
> and those of Rcmd.

As I stated I am not sure how Rcmd works, but Sweave in SVN is a shell
script as well as Rcmd! How does it become an exe file?

Gregor


From murdoch at stats.uwo.ca  Mon Apr 16 16:02:23 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 16 Apr 2007 10:02:23 -0400
Subject: [Rd] Sweave.sh shell script on CRAN
In-Reply-To: <462363B1.7000406@bfro.uni-lj.si>
References: <46235791.6080308@bfro.uni-lj.si> <46235CB6.3050201@stats.uwo.ca>
	<462363B1.7000406@bfro.uni-lj.si>
Message-ID: <462381EF.2050009@stats.uwo.ca>

On 4/16/2007 7:53 AM, Gregor Gorjanc wrote:
> Duncan Murdoch wrote:
>>> I do not have any experience with use of (bash) shell scripts under
>>> Windows. Sweave.sh can be used with Cygwin, but I am not sure how to use
>>> shell script without Cygwin. I noticed that some "scripts" in R*/bin
>>> directory on our Windows machine are perl (build, check, INSTALL, ...)
>>> and shell (Rd2dvi.sh, Stangle.sh, Sweave.sh, ...) scripts. This
>>> therefore means that R ships also perl and shell interpreter or am I
>>> missing something?
>> 
>> We don't ship Perl or sh.exe, but we do describe how to get them in the
>> R Admin manual.
> 
> Maybe I got this totally wrong. Say someone who uses Windows finds R and
> installs it via setup file. Can he/she launch the folowing without
> having Perl and/or sh.exe?
> 
> R CMD script whateverOption

No.  Installing a binary package has a pure R implementation so it 
doesn't need R CMD, but most of the capabilities of R CMD are not 
available with a basic R install.

There are two reasons for this.  One is that the extra tools that are 
needed take up a lot of space, so they would make the setup file really 
huge.  That's an issue of less importance these days than in the past.

Another issue that is still important is that not all the tools needed 
have licenses compatible with redistribution:  in particular ActiveState 
Perl and the Microsoft Help Workshop.  There are other Perl 
implementations, but in the past Brian Ripley found that they didn't 
work.  I don't know if that's still true.  (In fact, I don't know if the 
licenses still limit redistribution.)

>> I'd be interested in talking to you about integration of my patchDVI
>> functions into your script.  They allow forward and reverse search
>> between the .dvi file and the .Rnw file (in yap and xdvi, at least).
> 
> I am all ears.

The package is on my web page as

http://www.stats.uwo.ca/faculty/murdoch/software/patchDVI_1.0.tar.gz

Starting in R 2.5.0 (currently in beta), if you use Sweave options including

\SweaveOpts{keep.source=TRUE,concordance=TRUE}

then it will write out an \input{} for a file containing a TeX 
\special{} encoding the concordance between the lines in the .Rnw file 
and the lines in the .tex file.  The patchDVI package contains routines 
to look through a .dvi file for these specials, and the specials 
inserted by latex when you ask for forward and reverse search (the 
--src  option in MikTeX, not sure how it's invoked in other 
implementations), and patches the .dvi so the references point to the 
.Rnw file instead.

It would make more sense for the previewer to interpret the specials 
directly and so not require the patch, but currently it appears nobody 
has done something like this.  (If you know differently, please let me 
know!)  I think most people don't use forward and reverse search, so 
there's not a lot of pressure for this feature in the previewers.

It would probably also make sense to make the concordance format a 
little more general than it currently is (it assumes that each .tex file 
comes from exactly one source Rnw file, for instance; I think that's 
generally true now, but not necessarily true about other preprocessors.).

In the current implementation, this means the processing goes like this:

1.  Run Sweave to produce the .tex.
2.  Run latex to produce the .dvi.
3.  Run patchDVI to patch the .dvi.
4.  Run the previewer.

Since invoking R is slow in Windows, I wrote an R function SweaveMiktex 
in patchDVI that does steps 1-3 in one R session.

Duncan Murdoch


From ggrothendieck at gmail.com  Mon Apr 16 16:05:44 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 16 Apr 2007 10:05:44 -0400
Subject: [Rd] Sweave.sh shell script on CRAN
In-Reply-To: <46237C9A.8000006@bfro.uni-lj.si>
References: <46235791.6080308@bfro.uni-lj.si> <46235CB6.3050201@stats.uwo.ca>
	<971536df0704160616q4b4e2f10oc2f96bb334eb677a@mail.gmail.com>
	<46237C9A.8000006@bfro.uni-lj.si>
Message-ID: <971536df0704160705j233797a2p5ecb9cd65e10743e@mail.gmail.com>

On 4/16/07, Gregor Gorjanc <gregor.gorjanc at bfro.uni-lj.si> wrote:
> Gabor Grothendieck wrote:
> > On Windows sweave.bat is a Windows XP batchfile that will run sweave
> > and then latex and then display the file on screen.   Issuing the command
> > sweave without args from the Windows command line gives info on how to
> > use it.
> >
>
> Nice to see windows "equivalent". However, I must say that my script
> provides several ways to get to the result e.g. if you use prosper you
> need to go via postscript, beamer behaves differently etc.
>
> There are now the following ways of LaTeX processing:
>
> Command and path Script option             Used tools
> - texi2dvi
>  - PS          -tp, --texi2dvi2ps       texi2dvi and dvips
>  - PS to PDF   -tld, --texi2dvi2ps2pdf  texi2dvi, dvips and ps2pdf
>  - PDF         -td, --texi2dvi2pdf      texi2dvi with pdf option
>
> - latex
>  - PS          -lp, --latex2dvi2ps      hardcoded 'latex+co' + dvips
>  - PS to PDF   -lld, --latex2dvi2ps2pdf hardcoded 'latex+co' + dvips
>
> - pdflatex
>  - PDF         -ld, --latex2pdf         hardcoded 'latex+co' + dvips
>
> > To install sweave.bat you must place sweave.bat (and Rcmd.bat) both
> > from this batchfiles distribution anywhere in your path.  It does not
> > require
> > sh.exe and does not make use of perl but does use  "Rcmd sweave"
> > so would have no prerequisites beyond latex, Acrobot (or other viewer)
> > and those of Rcmd.
>
> As I stated I am not sure how Rcmd works, but Sweave in SVN is a shell
> script as well as Rcmd! How does it become an exe file?
>
> Gregor
>

If by "Sweave in SVN" you are referring to sweave.bat in the batchfiles
distribution then its not a shell file; rather, its a Windows batch file.
Windows has a batch processor built in that directly runs Windows
batch files without any precompiling to an exe.  As stated, you
simply place sweave.bat and rcmd.bat, both files from the batchfiles
distribution, anywhere in your path to run it.  There is no further installation
required.  That was why I used Windows batch -- to eliminate dependencies,
installation procedures, precompilations setting environment variable
names, etc.


From ggrothendieck at gmail.com  Mon Apr 16 16:13:52 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 16 Apr 2007 10:13:52 -0400
Subject: [Rd] Sweave.sh shell script on CRAN
In-Reply-To: <462381EF.2050009@stats.uwo.ca>
References: <46235791.6080308@bfro.uni-lj.si> <46235CB6.3050201@stats.uwo.ca>
	<462363B1.7000406@bfro.uni-lj.si> <462381EF.2050009@stats.uwo.ca>
Message-ID: <971536df0704160713l1a48eb5ak2d6c555b9e4a20a2@mail.gmail.com>

On 4/16/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 4/16/2007 7:53 AM, Gregor Gorjanc wrote:
> > Duncan Murdoch wrote:
> >>> I do not have any experience with use of (bash) shell scripts under
> >>> Windows. Sweave.sh can be used with Cygwin, but I am not sure how to use
> >>> shell script without Cygwin. I noticed that some "scripts" in R*/bin
> >>> directory on our Windows machine are perl (build, check, INSTALL, ...)
> >>> and shell (Rd2dvi.sh, Stangle.sh, Sweave.sh, ...) scripts. This
> >>> therefore means that R ships also perl and shell interpreter or am I
> >>> missing something?
> >>
> >> We don't ship Perl or sh.exe, but we do describe how to get them in the
> >> R Admin manual.
> >
> > Maybe I got this totally wrong. Say someone who uses Windows finds R and
> > installs it via setup file. Can he/she launch the folowing without
> > having Perl and/or sh.exe?
> >
> > R CMD script whateverOption
>
> No.  Installing a binary package has a pure R implementation so it
> doesn't need R CMD, but most of the capabilities of R CMD are not
> available with a basic R install.

Can you just clarify what the dependencies are for

Rcmd sweave

where Rcmd is the Rcmd command distributed with R that is run
from the Windows command line.   Does that require perl or other
tools to run?


From gregor.gorjanc at bfro.uni-lj.si  Mon Apr 16 16:13:16 2007
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Mon, 16 Apr 2007 16:13:16 +0200
Subject: [Rd] Sweave.sh shell script on CRAN
In-Reply-To: <971536df0704160705j233797a2p5ecb9cd65e10743e@mail.gmail.com>
References: <46235791.6080308@bfro.uni-lj.si> <46235CB6.3050201@stats.uwo.ca>	
	<971536df0704160616q4b4e2f10oc2f96bb334eb677a@mail.gmail.com>	
	<46237C9A.8000006@bfro.uni-lj.si>
	<971536df0704160705j233797a2p5ecb9cd65e10743e@mail.gmail.com>
Message-ID: <4623847C.4010106@bfro.uni-lj.si>

Gabor Grothendieck wrote:
...
> If by "Sweave in SVN" you are referring to sweave.bat in the batchfiles
> distribution then its not a shell file; rather, its a Windows batch file.

Nope. I meant Sweave.sh in R SVN.

Gregor


From gregor.gorjanc at bfro.uni-lj.si  Mon Apr 16 16:16:50 2007
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Mon, 16 Apr 2007 16:16:50 +0200
Subject: [Rd] Sweave.sh shell script on CRAN
In-Reply-To: <462381EF.2050009@stats.uwo.ca>
References: <46235791.6080308@bfro.uni-lj.si> <46235CB6.3050201@stats.uwo.ca>
	<462363B1.7000406@bfro.uni-lj.si> <462381EF.2050009@stats.uwo.ca>
Message-ID: <46238552.1000602@bfro.uni-lj.si>

Duncan Murdoch wrote:
...
>> Maybe I got this totally wrong. Say someone who uses Windows finds R and
>> installs it via setup file. Can he/she launch the folowing without
>> having Perl and/or sh.exe?
>>
>> R CMD script whateverOption
> 
> No.  Installing a binary package has a pure R implementation so it
> doesn't need R CMD, but most of the capabilities of R CMD are not
> available with a basic R install.
> 
> There are two reasons for this.  One is that the extra tools that are
> needed take up a lot of space, so they would make the setup file really
> huge.  That's an issue of less importance these days than in the past.
> 
> Another issue that is still important is that not all the tools needed
> have licenses compatible with redistribution:  in particular ActiveState
> Perl and the Microsoft Help Workshop.  There are other Perl
> implementations, but in the past Brian Ripley found that they didn't
> work.  I don't know if that's still true.  (In fact, I don't know if the
> licenses still limit redistribution.)


OK. Thank you for this explanation. I can not live without unix shell
and therefore never noticed that under Windows say R CMD INSTALL or
other R CMD scripts do not work without sh.exe (and/or Perl).

Gregor


From murdoch at stats.uwo.ca  Mon Apr 16 16:28:04 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 16 Apr 2007 10:28:04 -0400
Subject: [Rd] Sweave.sh shell script on CRAN
In-Reply-To: <971536df0704160713l1a48eb5ak2d6c555b9e4a20a2@mail.gmail.com>
References: <46235791.6080308@bfro.uni-lj.si> <46235CB6.3050201@stats.uwo.ca>	
	<462363B1.7000406@bfro.uni-lj.si> <462381EF.2050009@stats.uwo.ca>
	<971536df0704160713l1a48eb5ak2d6c555b9e4a20a2@mail.gmail.com>
Message-ID: <462387F4.5070506@stats.uwo.ca>

On 4/16/2007 10:13 AM, Gabor Grothendieck wrote:
> On 4/16/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>> On 4/16/2007 7:53 AM, Gregor Gorjanc wrote:
>> > Duncan Murdoch wrote:
>> >>> I do not have any experience with use of (bash) shell scripts under
>> >>> Windows. Sweave.sh can be used with Cygwin, but I am not sure how to use
>> >>> shell script without Cygwin. I noticed that some "scripts" in R*/bin
>> >>> directory on our Windows machine are perl (build, check, INSTALL, ...)
>> >>> and shell (Rd2dvi.sh, Stangle.sh, Sweave.sh, ...) scripts. This
>> >>> therefore means that R ships also perl and shell interpreter or am I
>> >>> missing something?
>> >>
>> >> We don't ship Perl or sh.exe, but we do describe how to get them in the
>> >> R Admin manual.
>> >
>> > Maybe I got this totally wrong. Say someone who uses Windows finds R and
>> > installs it via setup file. Can he/she launch the folowing without
>> > having Perl and/or sh.exe?
>> >
>> > R CMD script whateverOption
>>
>> No.  Installing a binary package has a pure R implementation so it
>> doesn't need R CMD, but most of the capabilities of R CMD are not
>> available with a basic R install.
> 
> Can you just clarify what the dependencies are for
> 
> Rcmd sweave
> 
> where Rcmd is the Rcmd command distributed with R that is run
> from the Windows command line.   Does that require perl or other
> tools to run?

That needs sh.exe, not Perl.  But it's just the equivalent of

  echo "library('utils'); Sweave('filename')" | Rterm --no-restore --slave

at the command line or

  Sweave("filename")

in a standard R session.

Duncan Murdoch


From gregor.gorjanc at bfro.uni-lj.si  Mon Apr 16 16:38:18 2007
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Mon, 16 Apr 2007 16:38:18 +0200
Subject: [Rd] Sweave.sh shell script on CRAN
In-Reply-To: <462387F4.5070506@stats.uwo.ca>
References: <46235791.6080308@bfro.uni-lj.si> <46235CB6.3050201@stats.uwo.ca>	
	<462363B1.7000406@bfro.uni-lj.si> <462381EF.2050009@stats.uwo.ca>
	<971536df0704160713l1a48eb5ak2d6c555b9e4a20a2@mail.gmail.com>
	<462387F4.5070506@stats.uwo.ca>
Message-ID: <46238A5A.2000701@bfro.uni-lj.si>

Duncan Murdoch wrote:
>> Can you just clarify what the dependencies are for
>>
>> Rcmd sweave
>>
>> where Rcmd is the Rcmd command distributed with R that is run
>> from the Windows command line.   Does that require perl or other
>> tools to run?
> 
> That needs sh.exe, not Perl.  But it's just the equivalent of
> 
>  echo "library('utils'); Sweave('filename')" | Rterm --no-restore --slave

Then sweave.bat from batchfiles depends on sh.exe as my Sweave.sh.
However, I guess that above line can also be done with MS command line.

Gregor


From ripley at stats.ox.ac.uk  Mon Apr 16 17:22:54 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 16 Apr 2007 16:22:54 +0100 (BST)
Subject: [Rd] nls with algorithm = "port", starting values
In-Reply-To: <Pine.GSO.4.56.0704160924550.26251@laurel.few.vu.nl>
References: <Pine.GSO.4.56.0704160924550.26251@laurel.few.vu.nl>
Message-ID: <Pine.LNX.4.64.0704160855500.27276@gannet.stats.ox.ac.uk>

I think we should fix the code to do as the documentation says: all it 
needs is an unlist().

Thank you for the examples, which helped test this.

On Mon, 16 Apr 2007, Katharine Mullen wrote:

> The documentation for nls says the following about the starting values:
>
> start: a named list or named numeric vector of starting estimates.
>          Since R 2.4.0, when 'start' is missing, a very cheap guess
>          for 'start' is tried (if 'algorithm != "plinear"').
>
> It may be a good idea to document that when algorithm = "port", if start
> is a named list, the elements of the list must be numeric vectors of
> length 1.  Ie, start = list(a=1,b=2,c=3) is ok, but start = list(a=c(1,2),
> b=3) is not.  This is not the case when algorithm is "plinear" or the
> default GN, and is because of the way that the "port" code in nls.R
> transforms the starting values (the other options do something else):
>
> nls_port_fit <- function(m, start, lower, upper, control, trace)
> {
>    ## Establish the working vectors and check and set options
>    p <- length(par <- as.double(start))
>
>
> Example:
>
> ## exponentially decaying data
> getExpmat <- function(theta, t)
> {
>        conc <- matrix(nrow = length(t), ncol = length(theta))
>        for(i in 1:length(theta)) {
>                conc[, i] <- exp(- theta[i] * t)
>        }
>        conc
> }
>
> expsum <- as.vector(getExpmat(c(.05,.005), 1:100) %*% c(1,1))
> expsumNoisy <- expsum + max(expsum) *.001 * rnorm(100)
> expsum.df <-data.frame(expsumNoisy)
>
> ## estimate decay rates, amplitudes with default Gauss-Newton
> summary (nls(expsumNoisy ~ getExpmat(k, 1:100) %*% sp, expsum.df, start =
> list(k = c(.6,.02), sp = c(1,2)), trace=TRUE, control =
> nls.control(maxiter=20,
> warnOnly =  TRUE)))
>
> ## won't work with port
> summary (nls(expsumNoisy ~ getExpmat(k, 1:100) %*% sp, expsum.df, start =
> list(k = c(.6,.02), sp = c(1,2)), algorithm = "port",
> trace=TRUE, control = nls.control(maxiter=20,
> warnOnly =  TRUE)))
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ggrothendieck at gmail.com  Mon Apr 16 18:14:50 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 16 Apr 2007 12:14:50 -0400
Subject: [Rd] Sweave.sh shell script on CRAN
In-Reply-To: <462387F4.5070506@stats.uwo.ca>
References: <46235791.6080308@bfro.uni-lj.si> <46235CB6.3050201@stats.uwo.ca>
	<462363B1.7000406@bfro.uni-lj.si> <462381EF.2050009@stats.uwo.ca>
	<971536df0704160713l1a48eb5ak2d6c555b9e4a20a2@mail.gmail.com>
	<462387F4.5070506@stats.uwo.ca>
Message-ID: <971536df0704160914r28ef7a52xa9d4a804e3ab1262@mail.gmail.com>

On 4/16/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 4/16/2007 10:13 AM, Gabor Grothendieck wrote:
> > On 4/16/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> >> On 4/16/2007 7:53 AM, Gregor Gorjanc wrote:
> >> > Duncan Murdoch wrote:
> >> >>> I do not have any experience with use of (bash) shell scripts under
> >> >>> Windows. Sweave.sh can be used with Cygwin, but I am not sure how to use
> >> >>> shell script without Cygwin. I noticed that some "scripts" in R*/bin
> >> >>> directory on our Windows machine are perl (build, check, INSTALL, ...)
> >> >>> and shell (Rd2dvi.sh, Stangle.sh, Sweave.sh, ...) scripts. This
> >> >>> therefore means that R ships also perl and shell interpreter or am I
> >> >>> missing something?
> >> >>
> >> >> We don't ship Perl or sh.exe, but we do describe how to get them in the
> >> >> R Admin manual.
> >> >
> >> > Maybe I got this totally wrong. Say someone who uses Windows finds R and
> >> > installs it via setup file. Can he/she launch the folowing without
> >> > having Perl and/or sh.exe?
> >> >
> >> > R CMD script whateverOption
> >>
> >> No.  Installing a binary package has a pure R implementation so it
> >> doesn't need R CMD, but most of the capabilities of R CMD are not
> >> available with a basic R install.
> >
> > Can you just clarify what the dependencies are for
> >
> > Rcmd sweave
> >
> > where Rcmd is the Rcmd command distributed with R that is run
> > from the Windows command line.   Does that require perl or other
> > tools to run?
>
> That needs sh.exe, not Perl.  But it's just the equivalent of
>
>  echo "library('utils'); Sweave('filename')" | Rterm --no-restore --slave
>
> at the command line or
>
>  Sweave("filename")
>
> in a standard R session.

Thanks for the explanation.  I could look into replacing Rcmd with the Rterm
pipeline in the sweave.bat script to eliminate the sh.exe dependency so
sweave.bat can be used with a basic R installation.


From jeff.horner at vanderbilt.edu  Mon Apr 16 18:23:16 2007
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Mon, 16 Apr 2007 11:23:16 -0500
Subject: [Rd] Documentation bug for sys.parent
Message-ID: <4623A2F4.6030705@vanderbilt.edu>

In R-trunk version 41191, the 'Value' section of sys.parent.Rd explains 
that sys.parent() returns an environment, which is wrong. The 'Details' 
sections explains that it returns the number of the parent frame, etc. 
Here's a fix:

Index: src/library/base/man/sys.parent.Rd
===================================================================
--- src/library/base/man/sys.parent.Rd  (revision 41191)
+++ src/library/base/man/sys.parent.Rd  (working copy)
@@ -81,8 +81,8 @@
  }
  \value{
    \code{sys.call} returns a call, \code{sys.function} a function
-  definition, and \code{sys.frame}, \code{sys.parent} and
-  \code{parent.frame} return an environment.
+  definition, and \code{sys.frame} and \code{parent.frame} return an
+  environment.

    For the other functions, see the Details section.
  }

Best,

Jeff
-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner


From thomas.friedrichsmeier at ruhr-uni-bochum.de  Mon Apr 16 18:53:03 2007
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: Mon, 16 Apr 2007 18:53:03 +0200
Subject: [Rd] args / formals on primitives
Message-ID: <200704161853.07237.thomas.friedrichsmeier@ruhr-uni-bochum.de>

On SVN revision 41087:

?args has this example line:

args(c)            # -> NULL (c is a 'primitive' function)

The comment seems out of date, as args(c) does in fact have a non-NULL return 
value:

args(c)
# function (..., recursive = FALSE) 
# NULL

While at it, I was wondering, why

formals(c)

still returns NULL, in contrast.

Regards
Thomas Friedrichsmeier
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20070416/07116e3c/attachment.bin 

From jeff.horner at vanderbilt.edu  Mon Apr 16 18:57:21 2007
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Mon, 16 Apr 2007 11:57:21 -0500
Subject: [Rd] Documentation update to R-lang.texi
Message-ID: <4623AAF1.5000000@vanderbilt.edu>

Section 4.3.4 of R-lang.texi version 41191 in the paragraph that starts 
"When h(3) is..." explains that x and y are unbound variables in the 
function body of g in this example:

      f <- function(x) {
          y <- 10
          g <- function(x) x + y
          return(g)
      }
      h <- f()
      h(3)

while the paragraph following the example explains that "bound variables 
are those that match the formal arguments to the function." So wouldn't 
x be bound?

Jeff
-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner


From ggrothendieck at gmail.com  Mon Apr 16 19:53:53 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 16 Apr 2007 13:53:53 -0400
Subject: [Rd] Sweave.sh shell script on CRAN
In-Reply-To: <971536df0704160914r28ef7a52xa9d4a804e3ab1262@mail.gmail.com>
References: <46235791.6080308@bfro.uni-lj.si> <46235CB6.3050201@stats.uwo.ca>
	<462363B1.7000406@bfro.uni-lj.si> <462381EF.2050009@stats.uwo.ca>
	<971536df0704160713l1a48eb5ak2d6c555b9e4a20a2@mail.gmail.com>
	<462387F4.5070506@stats.uwo.ca>
	<971536df0704160914r28ef7a52xa9d4a804e3ab1262@mail.gmail.com>
Message-ID: <971536df0704161053p4fb2f19ct50b92192588492bf@mail.gmail.com>

On 4/16/07, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> On 4/16/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> > On 4/16/2007 10:13 AM, Gabor Grothendieck wrote:
> > > On 4/16/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> > >> On 4/16/2007 7:53 AM, Gregor Gorjanc wrote:
> > >> > Duncan Murdoch wrote:
> > >> >>> I do not have any experience with use of (bash) shell scripts under
> > >> >>> Windows. Sweave.sh can be used with Cygwin, but I am not sure how to use
> > >> >>> shell script without Cygwin. I noticed that some "scripts" in R*/bin
> > >> >>> directory on our Windows machine are perl (build, check, INSTALL, ...)
> > >> >>> and shell (Rd2dvi.sh, Stangle.sh, Sweave.sh, ...) scripts. This
> > >> >>> therefore means that R ships also perl and shell interpreter or am I
> > >> >>> missing something?
> > >> >>
> > >> >> We don't ship Perl or sh.exe, but we do describe how to get them in the
> > >> >> R Admin manual.
> > >> >
> > >> > Maybe I got this totally wrong. Say someone who uses Windows finds R and
> > >> > installs it via setup file. Can he/she launch the folowing without
> > >> > having Perl and/or sh.exe?
> > >> >
> > >> > R CMD script whateverOption
> > >>
> > >> No.  Installing a binary package has a pure R implementation so it
> > >> doesn't need R CMD, but most of the capabilities of R CMD are not
> > >> available with a basic R install.
> > >
> > > Can you just clarify what the dependencies are for
> > >
> > > Rcmd sweave
> > >
> > > where Rcmd is the Rcmd command distributed with R that is run
> > > from the Windows command line.   Does that require perl or other
> > > tools to run?
> >
> > That needs sh.exe, not Perl.  But it's just the equivalent of
> >
> >  echo "library('utils'); Sweave('filename')" | Rterm --no-restore --slave
> >
> > at the command line or
> >
> >  Sweave("filename")
> >
> > in a standard R session.
>
> Thanks for the explanation.  I could look into replacing Rcmd with the Rterm
> pipeline in the sweave.bat script to eliminate the sh.exe dependency so
> sweave.bat can be used with a basic R installation.
>

Actually it turned out to be a relatively simple change so I made it.
Place these two files anywhere in your path on Windows XP:

http://batchfiles.googlecode.com/svn/trunk/sweave.bat
http://batchfiles.googlecode.com/svn/trunk/rterm.bat

and at the Windows XP console type

sweave

for further instructions.  sh.exe should no longer be needed so it should
run with a basic R installation (plus latex and a PDF viewer). I will upload
this to CRAN in the next few days but in the meantime its available as
indicated.


From bill at insightful.com  Mon Apr 16 21:14:24 2007
From: bill at insightful.com (Bill Dunlap)
Date: Mon, 16 Apr 2007 12:14:24 -0700 (PDT)
Subject: [Rd] save() and interrupts
In-Reply-To: <59d7961d0704151246y3005178av67bd5396b991606a@mail.gmail.com>
References: <59d7961d0704151101w2e892a98r81038a7a336a2ec1@mail.gmail.com>
	<Pine.LNX.4.64.0704151945120.11794@gannet.stats.ox.ac.uk>
	<59d7961d0704151246y3005178av67bd5396b991606a@mail.gmail.com>
Message-ID: <Pine.GSO.4.56.0704161210050.11912@durian.statsci.com>

On Sun, 15 Apr 2007, Henrik Bengtsson wrote:

> On 4/15/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> > On Sun, 15 Apr 2007, Henrik Bengtsson wrote:
> >
> > > are there any (cross-platform) specs on what the saved filed is if
> > > save() is interrupted, e.g. by a user interrupt?   It could be
> > > non-existing, empty, partly written, or completed.
> >
> > My understanding is that you cannot user interrupt compiled code unless it
> > is set up to check interrupts.  Version 2 saves are done via the internal
> > saveToConn, and I don't see any calls to R_CheckUserInterrupt there. So
> > you only need to worry about user interrupts in the R code, and that has
> > an on.exit action to close the connection (which should be executed even
> > if you interrupt).  Which suggests that the file will be
> >
> > non-existent
> > empty
> > complete
> >
> > and the first two depend on interrupting in the millisecond or less before
> > the compiled code gets called.
>
> I'll put it on my todo list to investigate how to make save() more
> robust against interrupts before calling the internal code.  One
> option is to use tryCatch().  However, that does not handle too
> frequent user interrupts, e.g. if an interrupt is sent while in the
> "interrupt" call, that will interrupt the function.  So, tryCatch()
> alone will only lower the risk for incomplete empty files.  For data
> written to files, one alternative is to check for files of zero size
> in the on.exit() statement and remove such.
>
> /Henrik
> >
> > For other forms of interrupts, e.g. a Unix kill -9, the file state could
> > be anything.
> >
> > Brian D. Ripley,                  ripley at stats.ox.ac.uk
> > ...

You could change the code to write to a temporary
file (in the directory you want the result in) and
when you successfully finish writing to the file
you rename it to the permanent name.  (On an interrupt
you remove the temp file, and on 'kill -9' the only
bad effect is the space used by the partially written
temp file.)  This has the added advantage that you don't
overwrite an existing save file by the given name until
you know a suitable replacement is ready.

Perhaps we need a connection type that encapsulates this.

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From luke at stat.uiowa.edu  Mon Apr 16 21:23:15 2007
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Mon, 16 Apr 2007 14:23:15 -0500 (CDT)
Subject: [Rd] save() and interrupts
In-Reply-To: <Pine.GSO.4.56.0704161210050.11912@durian.statsci.com>
References: <59d7961d0704151101w2e892a98r81038a7a336a2ec1@mail.gmail.com>
	<Pine.LNX.4.64.0704151945120.11794@gannet.stats.ox.ac.uk>
	<59d7961d0704151246y3005178av67bd5396b991606a@mail.gmail.com>
	<Pine.GSO.4.56.0704161210050.11912@durian.statsci.com>
Message-ID: <Pine.LNX.4.64.0704161417240.3835@nokomis.stat.uiowa.edu>

On Mon, 16 Apr 2007, Bill Dunlap wrote:

> On Sun, 15 Apr 2007, Henrik Bengtsson wrote:
>
>> On 4/15/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>>> On Sun, 15 Apr 2007, Henrik Bengtsson wrote:
>>>
>>>> are there any (cross-platform) specs on what the saved filed is if
>>>> save() is interrupted, e.g. by a user interrupt?   It could be
>>>> non-existing, empty, partly written, or completed.
>>>
>>> My understanding is that you cannot user interrupt compiled code unless it
>>> is set up to check interrupts.  Version 2 saves are done via the internal
>>> saveToConn, and I don't see any calls to R_CheckUserInterrupt there. So
>>> you only need to worry about user interrupts in the R code, and that has
>>> an on.exit action to close the connection (which should be executed even
>>> if you interrupt).  Which suggests that the file will be
>>>
>>> non-existent
>>> empty
>>> complete
>>>
>>> and the first two depend on interrupting in the millisecond or less before
>>> the compiled code gets called.
>>
>> I'll put it on my todo list to investigate how to make save() more
>> robust against interrupts before calling the internal code.  One
>> option is to use tryCatch().  However, that does not handle too
>> frequent user interrupts, e.g. if an interrupt is sent while in the
>> "interrupt" call, that will interrupt the function.  So, tryCatch()
>> alone will only lower the risk for incomplete empty files.  For data
>> written to files, one alternative is to check for files of zero size
>> in the on.exit() statement and remove such.
>>
>> /Henrik
>>>
>>> For other forms of interrupts, e.g. a Unix kill -9, the file state could
>>> be anything.
>>>
>>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>>> ...
>
> You could change the code to write to a temporary
> file (in the directory you want the result in) and
> when you successfully finish writing to the file
> you rename it to the permanent name.  (On an interrupt
> you remove the temp file, and on 'kill -9' the only
> bad effect is the space used by the partially written
> temp file.)  This has the added advantage that you don't
> overwrite an existing save file by the given name until
> you know a suitable replacement is ready.
>
> Perhaps we need a connection type that encapsulates this.
>
> ----------------------------------------------------------------------------
> Bill Dunlap
> Insightful Corporation
> bill at insightful dot com
> 360-428-8146
>
> "All statements in this message represent the opinions of the author and do
> not necessarily reflect Insightful Corporation policy or position."

We do this with save.image.  Since save is a little more general it is
a bit less obvious what the right way to do this sort of thing is, or
whether there is a single right way.  I think if I was concerned about
this I would write something around the current save for particular
kinds of connections rather than changing save itself.  The main
reason for taking a different rout with save.image is that that gets
called implicitly by q().

[our current ability to manage user interrupts is not ideal--hopefully
we can make a bit of progress on this soon.]

Best,

luke

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From hb at stat.berkeley.edu  Mon Apr 16 21:58:15 2007
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Mon, 16 Apr 2007 12:58:15 -0700
Subject: [Rd] save() and interrupts
In-Reply-To: <Pine.LNX.4.64.0704161417240.3835@nokomis.stat.uiowa.edu>
References: <59d7961d0704151101w2e892a98r81038a7a336a2ec1@mail.gmail.com>
	<Pine.LNX.4.64.0704151945120.11794@gannet.stats.ox.ac.uk>
	<59d7961d0704151246y3005178av67bd5396b991606a@mail.gmail.com>
	<Pine.GSO.4.56.0704161210050.11912@durian.statsci.com>
	<Pine.LNX.4.64.0704161417240.3835@nokomis.stat.uiowa.edu>
Message-ID: <59d7961d0704161258l715b1640of9b22d42784d4df3@mail.gmail.com>

On 4/16/07, Luke Tierney <luke at stat.uiowa.edu> wrote:
> On Mon, 16 Apr 2007, Bill Dunlap wrote:
>
> > On Sun, 15 Apr 2007, Henrik Bengtsson wrote:
> >
> >> On 4/15/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> >>> On Sun, 15 Apr 2007, Henrik Bengtsson wrote:
> >>>
> >>>> are there any (cross-platform) specs on what the saved filed is if
> >>>> save() is interrupted, e.g. by a user interrupt?   It could be
> >>>> non-existing, empty, partly written, or completed.
> >>>
> >>> My understanding is that you cannot user interrupt compiled code unless it
> >>> is set up to check interrupts.  Version 2 saves are done via the internal
> >>> saveToConn, and I don't see any calls to R_CheckUserInterrupt there. So
> >>> you only need to worry about user interrupts in the R code, and that has
> >>> an on.exit action to close the connection (which should be executed even
> >>> if you interrupt).  Which suggests that the file will be
> >>>
> >>> non-existent
> >>> empty
> >>> complete
> >>>
> >>> and the first two depend on interrupting in the millisecond or less before
> >>> the compiled code gets called.
> >>
> >> I'll put it on my todo list to investigate how to make save() more
> >> robust against interrupts before calling the internal code.  One
> >> option is to use tryCatch().  However, that does not handle too
> >> frequent user interrupts, e.g. if an interrupt is sent while in the
> >> "interrupt" call, that will interrupt the function.  So, tryCatch()
> >> alone will only lower the risk for incomplete empty files.  For data
> >> written to files, one alternative is to check for files of zero size
> >> in the on.exit() statement and remove such.
> >>
> >> /Henrik
> >>>
> >>> For other forms of interrupts, e.g. a Unix kill -9, the file state could
> >>> be anything.
> >>>
> >>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> >>> ...
> >
> > You could change the code to write to a temporary
> > file (in the directory you want the result in) and
> > when you successfully finish writing to the file
> > you rename it to the permanent name.  (On an interrupt
> > you remove the temp file, and on 'kill -9' the only
> > bad effect is the space used by the partially written
> > temp file.)  This has the added advantage that you don't
> > overwrite an existing save file by the given name until
> > you know a suitable replacement is ready.
> >
> > Perhaps we need a connection type that encapsulates this.
> >
> > ----------------------------------------------------------------------------
> > Bill Dunlap
> > Insightful Corporation
> > bill at insightful dot com
> > 360-428-8146
> >
> > "All statements in this message represent the opinions of the author and do
> > not necessarily reflect Insightful Corporation policy or position."
>
> We do this with save.image.  Since save is a little more general it is
> a bit less obvious what the right way to do this sort of thing is, or
> whether there is a single right way.  I think if I was concerned about
> this I would write something around the current save for particular
> kinds of connections rather than changing save itself.  The main
> reason for taking a different rout with save.image is that that gets
> called implicitly by q().
>
> [our current ability to manage user interrupts is not ideal--hopefully
> we can make a bit of progress on this soon.]

I was thinking about this last night:  It would be useful to have a
feature/construct to evaluate an R expression atomically where user
interrupts will *not have an affect until afterwards*, cf. calls to
native code.  This would solve the problem of getting interrupts while
in a tryCatch(..., interrupt=..., finally=...).  Of course this
requires caution by the programmer, but it is also unlikely to be used
by someone who do not know what the risks are.  I do not know the
different signals available, but one could consider such atomic calls
to be protected against different levels of signals.  In addition, one
could have an optional threshold of the number of interrupt signals it
takes to (even) interrupt an atomic evaluation.

/Henrik

>
> Best,
>
> luke
>
> --
> Luke Tierney
> Chair, Statistics and Actuarial Science
> Ralph E. Wareham Professor of Mathematical Sciences
> University of Iowa                  Phone:             319-335-3386
> Department of Statistics and        Fax:               319-335-3017
>     Actuarial Science
> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>


From ripley at stats.ox.ac.uk  Tue Apr 17 09:12:49 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 17 Apr 2007 08:12:49 +0100 (BST)
Subject: [Rd] args / formals on primitives
In-Reply-To: <200704161853.07237.thomas.friedrichsmeier@ruhr-uni-bochum.de>
References: <200704161853.07237.thomas.friedrichsmeier@ruhr-uni-bochum.de>
Message-ID: <Pine.LNX.4.64.0704161823240.10009@gannet.stats.ox.ac.uk>

On Mon, 16 Apr 2007, Thomas Friedrichsmeier wrote:

> On SVN revision 41087:

which is over 100 old.

Now we are in code freeze, the pace of change should reduce considerably 
(although people will continue to work in R-devel)

> ?args has this example line:
>
> args(c)            # -> NULL (c is a 'primitive' function)
>
> The comment seems out of date, as args(c) does in fact have a non-NULL return
> value:
>
> args(c)
> # function (..., recursive = FALSE)
> # NULL

That has been fixed once but the fix seems to have got lost, so I have put 
in back.

> While at it, I was wondering, why
>
> formals(c)
>
> still returns NULL, in contrast.

Because only closures have formals, the way things are defined.  This 
makes sense to me as formals<-() cannot work on primitives.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From r.hankin at noc.soton.ac.uk  Tue Apr 17 09:39:43 2007
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Tue, 17 Apr 2007 08:39:43 +0100
Subject: [Rd] no visible binding for global variable
Message-ID: <3B7634A3-D77F-44A9-B9A4-4F51C0644721@soc.soton.ac.uk>

Hello everyone

I am trying to get one of my packages through R's QC.

The package is clean for me under  R-2.4.1, R-2.5.0, and
R-devel,  but Kurt gets


>
> * checking R code for possible problems ... WARNING
>  hypercube: no visible binding for global variable ?f?



Function hypercube() [cut-&-pasted below] is intended to
return an adjacency matrix for an n-dimensional
hypercube with 2^n nodes.  hypercube(n) returns a
2^n -by- 2^n matrix, and works as intended for me.

Can someone explain what the error message means?






"hypercube" <- function(n){

   jj <- as.matrix(expand.grid(rep(list(0:1),n)))

   wrapper <- function(x, y, my.fun) {
     f <- function(x,y,tol=1e-4){
       abs(sum(abs(jj[x,]-jj[y,]))-1)<tol
     }
     sapply(seq(along = x), FUN = function(i){f(x[i], y[i])})
   }

   o <- -outer(1:(2^n),1:(2^n), wrapper, my.fun=f)
   jj.names <- apply(jj,1,paste,collapse="")
   rownames(o) <- jj.names
   colnames(o) <- jj.names
   diag(o) <- -apply(o,1,sum,na.rm=TRUE)
   return(o)
}








--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From ripley at stats.ox.ac.uk  Tue Apr 17 11:28:35 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 17 Apr 2007 10:28:35 +0100 (BST)
Subject: [Rd] no visible binding for global variable
In-Reply-To: <3B7634A3-D77F-44A9-B9A4-4F51C0644721@soc.soton.ac.uk>
References: <3B7634A3-D77F-44A9-B9A4-4F51C0644721@soc.soton.ac.uk>
Message-ID: <Pine.LNX.4.64.0704171018140.25999@gannet.stats.ox.ac.uk>

On Tue, 17 Apr 2007, Robin Hankin wrote:

> Hello everyone
>
> I am trying to get one of my packages through R's QC.
>
> The package is clean for me under  R-2.4.1, R-2.5.0, and
> R-devel,  but Kurt gets

Do you have _R_CHECK_USE_CODETOOLS_ set to something true (and for 2.4.1, 
codetools installed)?  See `Writing R Extensions'.

>> * checking R code for possible problems ... WARNING
>>  hypercube: no visible binding for global variable ?f?
>
> Function hypercube() [cut-&-pasted below] is intended to
> return an adjacency matrix for an n-dimensional
> hypercube with 2^n nodes.  hypercube(n) returns a
> 2^n -by- 2^n matrix, and works as intended for me.
>
> Can someone explain what the error message means?

If the arguments of outer() were evaluated in the frame of hypercube, 
there is no visible object 'f'.  So if 'wrapper' actually made use of its 
'my.fun' argument, this would fail.  As it is, lazy evaluation postpones 
the error (for ever).

Try removing the unused argument from wrapper(), and running the same 
test that Kurt did before and after.

BTW, it looks like updating one of your packages has broken another 
(untb).

> "hypercube" <- function(n){
>
>   jj <- as.matrix(expand.grid(rep(list(0:1),n)))
>
>   wrapper <- function(x, y, my.fun) {
>     f <- function(x,y,tol=1e-4){
>       abs(sum(abs(jj[x,]-jj[y,]))-1)<tol
>     }
>     sapply(seq(along = x), FUN = function(i){f(x[i], y[i])})
>   }
>
>   o <- -outer(1:(2^n),1:(2^n), wrapper, my.fun=f)
>   jj.names <- apply(jj,1,paste,collapse="")
>   rownames(o) <- jj.names
>   colnames(o) <- jj.names
>   diag(o) <- -apply(o,1,sum,na.rm=TRUE)
>   return(o)
> }

> --
> Robin Hankin
> Uncertainty Analyst
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>  tel  023-8059-7743


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From kirk.hampel at abs.gov.au  Tue Apr 17 03:23:48 2007
From: kirk.hampel at abs.gov.au (kirk.hampel at abs.gov.au)
Date: Tue, 17 Apr 2007 03:23:48 +0200 (CEST)
Subject: [Rd] predict.ar() produces wrong SE's (PR#9614)
Message-ID: <20070417012348.182215AC1B@slim.kubism.ku.dk>

Full_Name: Kirk Hampel
Version: 2.4.1
OS: Windows
Submission from: (NULL) (144.53.251.2)


Given an AR(p) model, the last p SE's are wrong.

The source of the bug is that the C code (ver 2.4.0) assumes *npsi is the length
of the psi vector (which is n+p), whilst the predict.ar function in R passes out
as.integer(npsi), where npsi <- n-1.

Some R code following reproduces the error. Let p=4, n=6, then

> ar<-c(-0.5,0.25,-0.125,0.0625)
> Mod(polyroot(c(1,-ar))) # ar model is stationary
[1] 1.037580 2.444163 2.444163 2.581298
> #Pass in values as predict.ar does
> cumsum(c(1,.C("artoma",as.integer(4),as.double(ar),double(9),as.integer(5))[[3]][1:5]^2))
[1] 1.000000 1.250000 1.312500 1.328125 1.332031 1.332031
> #Pass in value that C code expects
> cumsum(c(1,.C("artoma",as.integer(4),as.double(ar),double(9),as.integer(9))[[3]][1:5]^2))
[1] 1.000000 1.250000 1.500000 1.750000 2.000000 2.219727


From lbraglia at gmail.com  Tue Apr 17 00:43:32 2007
From: lbraglia at gmail.com (lbraglia at gmail.com)
Date: Tue, 17 Apr 2007 00:43:32 +0200 (CEST)
Subject: [Rd] [Wishlist] to uniform help(x) and library(help=x) behaviours
	relating "htmlhelp" option (PR#9613)
Message-ID: <20070416224332.F33225DE56@slim.kubism.ku.dk>

Full_Name: Luca Braglia
Version: R version 2.4.1 (2006-12-18)
OS: Debian Lenny (testing)
Submission from: (NULL) (82.61.142.240)


Some options of mine:

> options("htmlhelp")
$htmlhelp
[1] TRUE

> options("browser")
$browser
[1] "/usr/bin/urxvt -rv -e elinks"


I run R under X windows system: if I command

help(foo)

foo manual page is printed, correctly, under elinks (my textual browser); but if
I command 

library(help=asd)

asd package summary page is printed in R console.
I would like library(help=asd) to be printed in my browser too, if possible:
strictly speaking

--> add htmlhelp = getOption("htmlhelp") in library arguments

to be used only if "help" option  is specified.


Thanks a lot,

     Luca







Version:
 platform = i486-pc-linux-gnu
 arch = i486
 os = linux-gnu
 system = i486, linux-gnu
 status =
 major = 2
 minor = 4.1
 year = 2006
 month = 12
 day = 18
 svn rev = 40228
 language = R
 version.string = R version 2.4.1 (2006-12-18)


locale:
LC_CTYPE=it_IT.UTF-8;LC_NUMERIC=C;LC_TIME=it_IT.UTF-8;LC_COLLATE=it_IT.UTF-8;LC_MONETARY=it_IT.UTF-8;LC_MESSAGES=it_IT.UTF-8;LC_PAPER=it_IT.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=it_IT.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] "utils"     "stats"     "graphics"  "grDevices" "methods"  
[6] "base"     

other attached packages:
    MASS 
"7.2-33" 


Search Path:
 .GlobalEnv, package:MASS, package:utils, package:stats, package:graphics,
pack\
age:grDevices, package:methods, Autoloads, package:base


From luke at stat.uiowa.edu  Tue Apr 17 14:48:30 2007
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Tue, 17 Apr 2007 07:48:30 -0500 (CDT)
Subject: [Rd] save() and interrupts
In-Reply-To: <59d7961d0704161258l715b1640of9b22d42784d4df3@mail.gmail.com>
References: <59d7961d0704151101w2e892a98r81038a7a336a2ec1@mail.gmail.com> 
	<Pine.LNX.4.64.0704151945120.11794@gannet.stats.ox.ac.uk> 
	<59d7961d0704151246y3005178av67bd5396b991606a@mail.gmail.com> 
	<Pine.GSO.4.56.0704161210050.11912@durian.statsci.com> 
	<Pine.LNX.4.64.0704161417240.3835@nokomis.stat.uiowa.edu>
	<59d7961d0704161258l715b1640of9b22d42784d4df3@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0704170746080.3835@nokomis.stat.uiowa.edu>

On Mon, 16 Apr 2007, Henrik Bengtsson wrote:

> On 4/16/07, Luke Tierney <luke at stat.uiowa.edu> wrote:
>> On Mon, 16 Apr 2007, Bill Dunlap wrote:
>> 
>> > On Sun, 15 Apr 2007, Henrik Bengtsson wrote:
>> >
>> >> On 4/15/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>> >>> On Sun, 15 Apr 2007, Henrik Bengtsson wrote:
>> >>>
>> >>>> are there any (cross-platform) specs on what the saved filed is if
>> >>>> save() is interrupted, e.g. by a user interrupt?   It could be
>> >>>> non-existing, empty, partly written, or completed.
>> >>>
>> >>> My understanding is that you cannot user interrupt compiled code unless 
>> it
>> >>> is set up to check interrupts.  Version 2 saves are done via the 
>> internal
>> >>> saveToConn, and I don't see any calls to R_CheckUserInterrupt there. So
>> >>> you only need to worry about user interrupts in the R code, and that 
>> has
>> >>> an on.exit action to close the connection (which should be executed 
>> even
>> >>> if you interrupt).  Which suggests that the file will be
>> >>>
>> >>> non-existent
>> >>> empty
>> >>> complete
>> >>>
>> >>> and the first two depend on interrupting in the millisecond or less 
>> before
>> >>> the compiled code gets called.
>> >>
>> >> I'll put it on my todo list to investigate how to make save() more
>> >> robust against interrupts before calling the internal code.  One
>> >> option is to use tryCatch().  However, that does not handle too
>> >> frequent user interrupts, e.g. if an interrupt is sent while in the
>> >> "interrupt" call, that will interrupt the function.  So, tryCatch()
>> >> alone will only lower the risk for incomplete empty files.  For data
>> >> written to files, one alternative is to check for files of zero size
>> >> in the on.exit() statement and remove such.
>> >>
>> >> /Henrik
>> >>>
>> >>> For other forms of interrupts, e.g. a Unix kill -9, the file state 
>> could
>> >>> be anything.
>> >>>
>> >>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> >>> ...
>> >
>> > You could change the code to write to a temporary
>> > file (in the directory you want the result in) and
>> > when you successfully finish writing to the file
>> > you rename it to the permanent name.  (On an interrupt
>> > you remove the temp file, and on 'kill -9' the only
>> > bad effect is the space used by the partially written
>> > temp file.)  This has the added advantage that you don't
>> > overwrite an existing save file by the given name until
>> > you know a suitable replacement is ready.
>> >
>> > Perhaps we need a connection type that encapsulates this.
>> >
>> > 
>> ----------------------------------------------------------------------------
>> > Bill Dunlap
>> > Insightful Corporation
>> > bill at insightful dot com
>> > 360-428-8146
>> >
>> > "All statements in this message represent the opinions of the author and 
>> do
>> > not necessarily reflect Insightful Corporation policy or position."
>> 
>> We do this with save.image.  Since save is a little more general it is
>> a bit less obvious what the right way to do this sort of thing is, or
>> whether there is a single right way.  I think if I was concerned about
>> this I would write something around the current save for particular
>> kinds of connections rather than changing save itself.  The main
>> reason for taking a different rout with save.image is that that gets
>> called implicitly by q().
>> 
>> [our current ability to manage user interrupts is not ideal--hopefully
>> we can make a bit of progress on this soon.]
>
> I was thinking about this last night:  It would be useful to have a
> feature/construct to evaluate an R expression atomically where user
> interrupts will *not have an affect until afterwards*, cf. calls to
> native code.  This would solve the problem of getting interrupts while
> in a tryCatch(..., interrupt=..., finally=...).  Of course this
> requires caution by the programmer, but it is also unlikely to be used
> by someone who do not know what the risks are.  I do not know the
> different signals available, but one could consider such atomic calls
> to be protected against different levels of signals.  In addition, one
> could have an optional threshold of the number of interrupt signals it
> takes to (even) interrupt an atomic evaluation.

This is the sort of thing I have been tinking about. One also needs to
enable interrupts within selected parts of such a construct, and these
things need to cooperate with each other and with internal code. There
is a paper on doing these sorts of things in a principled way in
Haskell that I want to spend some time reading to see what translates
to us.

Best,

luke

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From bwalton at artsci.utoronto.ca  Tue Apr 17 16:15:36 2007
From: bwalton at artsci.utoronto.ca (Ben Walton)
Date: Tue, 17 Apr 2007 10:15:36 -0400
Subject: [Rd] rhel5 rpm spec mods
Message-ID: <20070417141531.GA21970@cquest.utoronto.ca>

Hi All,

I'm in the process of building an rpm for rhel5 (client currently).
This has required modification of the spec file.  When I've completed
the process, I'd like to submit the changes to save others doing the
same work.  Is this the appropriate place to submit a patch with those
changes?

Thanks
-Ben
-- 
Ben Walton
Systems Programmer
Office of Planning & IT
Faculty of Arts & Science
University of Toronto
Cell: 416.407.5610

GPG Key Id: 8E89F6D2; Keyserver: pgp.mit.edu
Contact me to arrange for a CAcert assurance meeting.

Please Note: This e-mail is intended only for the use of the individual or
entity to which it is addressed.  It may contain information that is
privileged, confidential and exempt from disclosure under applicable law.
Any dissemination, disclosure, printing, publishing or use of this email
or the information contained herein without written authorization of the
sender is strictly prohibited.  If you have received this e-mail in
error, please notify the sender immediately and delete. Thank you.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20070417/3761d96f/attachment.bin 

From ripley at stats.ox.ac.uk  Tue Apr 17 16:24:48 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 17 Apr 2007 15:24:48 +0100 (BST)
Subject: [Rd] rhel5 rpm spec mods
In-Reply-To: <20070417141531.GA21970@cquest.utoronto.ca>
References: <20070417141531.GA21970@cquest.utoronto.ca>
Message-ID: <Pine.LNX.4.64.0704171521570.2524@gannet.stats.ox.ac.uk>

On Tue, 17 Apr 2007, Ben Walton wrote:

> Hi All,
>
> I'm in the process of building an rpm for rhel5 (client currently).
> This has required modification of the spec file.  When I've completed
> the process, I'd like to submit the changes to save others doing the
> same work.  Is this the appropriate place to submit a patch with those
> changes?

http://cran.r-project.org/bin/linux/redhat/SRPMS/R.spec

names the principal author, Martyn Plummer. Please contact him.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From P.Dalgaard at biostat.ku.dk  Tue Apr 17 16:27:47 2007
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 17 Apr 2007 16:27:47 +0200
Subject: [Rd] rhel5 rpm spec mods
In-Reply-To: <20070417141531.GA21970@cquest.utoronto.ca>
References: <20070417141531.GA21970@cquest.utoronto.ca>
Message-ID: <4624D963.6030509@biostat.ku.dk>

Ben Walton wrote:
> Hi All,
>
> I'm in the process of building an rpm for rhel5 (client currently).
> This has required modification of the spec file.  When I've completed
> the process, I'd like to submit the changes to save others doing the
> same work.  Is this the appropriate place to submit a patch with those
> changes?
>   
Probably, contacting Martyn Plummer directly is the way to go.

> Thanks
> -Ben
>   
> ------------------------------------------------------------------------
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From hin-tak.leung at cimr.cam.ac.uk  Tue Apr 17 16:47:01 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Tue, 17 Apr 2007 15:47:01 +0100
Subject: [Rd] rhel5 rpm spec mods
In-Reply-To: <20070417141531.GA21970@cquest.utoronto.ca>
References: <20070417141531.GA21970@cquest.utoronto.ca>
Message-ID: <4624DDE5.8000601@cimr.cam.ac.uk>

Ben Walton wrote:
> Hi All,
> 
> I'm in the process of building an rpm for rhel5 (client currently).
> This has required modification of the spec file.  When I've completed
> the process, I'd like to submit the changes to save others doing the
> same work.  Is this the appropriate place to submit a patch with those
> changes?
> 
> Thanks
> -Ben

I'll be interested to see it, but I wonder what kind of modification is
*required*? I am currently using a spec file modified from the 2.3 era
for 2.4 onto fedora 6, and I don't think there is *any* required
change to make the old spec file works on fc6.

Here are a list of my changes (from a diff I just do):
(1) ver 2.3.1<->2.4.1, plus a custom release tag to distinguish
from official build
(2) a bunch of change to do with LDFLAGS, etc so that I can do 32-bit 
build on 64-bit platforms.
(3) enable memory profiling and strict type check
(4) make also the pdf's for the full reference manual and the
extension manual.

These are all personal preferences; and FWIW, fedora extra also carries 
R (and I believe RHEL5 can get at fedora extra's via yum), so
(1) are you refering to the spec file on cran or the spec file on fedora 
extra? They are quite different!
(2) are you sure your "required" modification not a matter of personal 
preference as well?

HTL


From bwalton at artsci.utoronto.ca  Tue Apr 17 17:16:08 2007
From: bwalton at artsci.utoronto.ca (Ben Walton)
Date: Tue, 17 Apr 2007 11:16:08 -0400
Subject: [Rd] rhel5 rpm spec mods
In-Reply-To: <4624DDE5.8000601@cimr.cam.ac.uk>
References: <20070417141531.GA21970@cquest.utoronto.ca>
	<4624DDE5.8000601@cimr.cam.ac.uk>
Message-ID: <20070417151604.GD21970@cquest.utoronto.ca>

The only changes I've made (taken from the fc6.src.rpm) are in the
initial detection of which linux/rpm-based distro it's being built on.
This allows detection of gcc version, pdfviewer, etc.  These changes are
all similar to what happens in the fc line of detection, but weren't
being done for rhel.

Without modification, rpmbuild was looking for XFree86-devel and gcc-g77
which aren't valid packages in rhel5 (haven't looked at 4 as rpms were
already built for that).

I am aware of fedora extras but haven't gotten to the point of using
them in rhel (we do in our fc installs).  Personally, I'd prefer to stay
away from the fc rpm trees when possible as (being a devel distro)
versions can change wildly and bugs are more likely to crop up in
packaging, etc (we've been bitten in the past).  I'm moving away from fc
for production machines for this reason.  I prefer fewer surprises in
production machines when possible.

I'll discuss the required(1) changes with Martyn and submit them if he's
agreeable.

Thanks
-Ben

(1) assuming that they are required and I'm not missing the obvious.
-- 
Ben Walton
Systems Programmer
Office of Planning & IT
Faculty of Arts & Science
University of Toronto
Cell: 416.407.5610

GPG Key Id: 8E89F6D2; Keyserver: pgp.mit.edu
Contact me to arrange for a CAcert assurance meeting.

Please Note: This e-mail is intended only for the use of the individual or
entity to which it is addressed.  It may contain information that is
privileged, confidential and exempt from disclosure under applicable law.
Any dissemination, disclosure, printing, publishing or use of this email
or the information contained herein without written authorization of the
sender is strictly prohibited.  If you have received this e-mail in
error, please notify the sender immediately and delete. Thank you.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20070417/012f14ff/attachment.bin 

From ripley at stats.ox.ac.uk  Tue Apr 17 18:01:29 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Tue, 17 Apr 2007 18:01:29 +0200 (CEST)
Subject: [Rd] predict.ar() produces wrong SE's (PR#9614)
Message-ID: <20070417160129.824875DE7D@slim.kubism.ku.dk>

Thank you.  Here is a reproducible example (since yours is not of the 
actual code):

example(ar)
predict(sunspot.ar, n.ahead=25)
predict(sunspot.ar, n.ahead=20)

and compare, say, prediction 20.

Fixed for 2.5.0.

On Tue, 17 Apr 2007, kirk.hampel at abs.gov.au wrote:

> Full_Name: Kirk Hampel
> Version: 2.4.1
> OS: Windows
> Submission from: (NULL) (144.53.251.2)
>
>
> Given an AR(p) model, the last p SE's are wrong.
>
> The source of the bug is that the C code (ver 2.4.0) assumes *npsi is the length
> of the psi vector (which is n+p), whilst the predict.ar function in R passes out
> as.integer(npsi), where npsi <- n-1.
>
> Some R code following reproduces the error. Let p=4, n=6, then
>
>> ar<-c(-0.5,0.25,-0.125,0.0625)
>> Mod(polyroot(c(1,-ar))) # ar model is stationary
> [1] 1.037580 2.444163 2.444163 2.581298
>> #Pass in values as predict.ar does
>> cumsum(c(1,.C("artoma",as.integer(4),as.double(ar),double(9),as.integer(5))[[3]][1:5]^2))
> [1] 1.000000 1.250000 1.312500 1.328125 1.332031 1.332031
>> #Pass in value that C code expects
>> cumsum(c(1,.C("artoma",as.integer(4),as.double(ar),double(9),as.integer(9))[[3]][1:5]^2))
> [1] 1.000000 1.250000 1.500000 1.750000 2.000000 2.219727
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hin-tak.leung at cimr.cam.ac.uk  Tue Apr 17 18:29:31 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Tue, 17 Apr 2007 17:29:31 +0100
Subject: [Rd] rhel5 rpm spec mods
In-Reply-To: <20070417151604.GD21970@cquest.utoronto.ca>
References: <20070417141531.GA21970@cquest.utoronto.ca>
	<4624DDE5.8000601@cimr.cam.ac.uk>
	<20070417151604.GD21970@cquest.utoronto.ca>
Message-ID: <4624F5EB.1000200@cimr.cam.ac.uk>

Ben Walton wrote:
> The only changes I've made (taken from the fc6.src.rpm) are in the
> initial detection of which linux/rpm-based distro it's being built on.
> This allows detection of gcc version, pdfviewer, etc.  These changes are
> all similar to what happens in the fc line of detection, but weren't
> being done for rhel.

Yes, those sounds reasonable.

> Without modification, rpmbuild was looking for XFree86-devel and gcc-g77
> which aren't valid packages in rhel5 (haven't looked at 4 as rpms were
> already built for that).

yes and no. You can do "rpmbuild --nodeps <otherstuff>" without
modifying the spec file to tell rpmbuild to go ahead, I think.
This is also often the technique used when one tries to
build rpm's on non-rpm based systems like debian/gentoo/slackware.

> I am aware of fedora extras but haven't gotten to the point of using
> them in rhel (we do in our fc installs).  Personally, I'd prefer to stay
> away from the fc rpm trees when possible as (being a devel distro)
> versions can change wildly and bugs are more likely to crop up in
> packaging, etc (we've been bitten in the past).  I'm moving away from fc
> for production machines for this reason.  I prefer fewer surprises in
> production machines when possible.

Personally, I think EL4 is too old/conservative (and I don't have access
to EL5), and it makes me angry when I encounter a bug or limitation
that I know was already fixed/addressed a year or two ago. Can't win.
:-).

HTL


From bwalton at artsci.utoronto.ca  Tue Apr 17 18:44:20 2007
From: bwalton at artsci.utoronto.ca (Ben Walton)
Date: Tue, 17 Apr 2007 12:44:20 -0400
Subject: [Rd] rhel5 rpm spec mods
In-Reply-To: <4624F5EB.1000200@cimr.cam.ac.uk>
References: <20070417141531.GA21970@cquest.utoronto.ca>
	<4624DDE5.8000601@cimr.cam.ac.uk>
	<20070417151604.GD21970@cquest.utoronto.ca>
	<4624F5EB.1000200@cimr.cam.ac.uk>
Message-ID: <20070417164420.GA23131@cquest.utoronto.ca>

On Tue, Apr 17, 2007 at 05:29:31PM +0100, Hin-Tak Leung wrote:
+>  >Without modification, rpmbuild was looking for XFree86-devel and gcc-g77
+>  >which aren't valid packages in rhel5 (haven't looked at 4 as rpms were
+>  >already built for that).
+>  
+>  yes and no. You can do "rpmbuild --nodeps <otherstuff>" without
+>  modifying the spec file to tell rpmbuild to go ahead, I think.
+>  This is also often the technique used when one tries to
+>  build rpm's on non-rpm based systems like debian/gentoo/slackware.

That would work, but shouldn't be required, imho.  I sent the patch to
Martyn already, so hopefully it gets included.

+>  >I am aware of fedora extras but haven't gotten to the point of using
+>  >them in rhel (we do in our fc installs).  Personally, I'd prefer to stay
+>  >away from the fc rpm trees when possible as (being a devel distro)
+>  >versions can change wildly and bugs are more likely to crop up in
+>  >packaging, etc (we've been bitten in the past).  I'm moving away from fc
+>  >for production machines for this reason.  I prefer fewer surprises in
+>  >production machines when possible.
+>  
+>  Personally, I think EL4 is too old/conservative (and I don't have access
+>  to EL5), and it makes me angry when I encounter a bug or limitation
+>  that I know was already fixed/addressed a year or two ago. Can't win.
+>  :-).

Yes, EL4 is old and conservative.  EL5 will be the same in short order.
They are also stable and (mostly) surprise free.  I have encountered
bugs that are frustrating due to their age (open nfs locks and crashing
apps springs to mind) but for the most part I like it for my servers
(and lab machines/workstations, etc).  FC has it's (very important)
place and I do suggest that home users work with it (or Ubuntu/Debian).
The other issue with FC in production is the legacy support one.  I
can't be bothered to upgrade machines as often as the fc support cycle
would have me do (I miss fedoralegacy.org already).  I'm not really
saying I personally prefer RedHat, but it does meet a very important
need for me.

Thanks
-Ben
-- 
Ben Walton
Systems Programmer
Office of Planning & IT
Faculty of Arts & Science
University of Toronto
Cell: 416.407.5610

GPG Key Id: 8E89F6D2; Keyserver: pgp.mit.edu
Contact me to arrange for a CAcert assurance meeting.

Please Note: This e-mail is intended only for the use of the individual or
entity to which it is addressed.  It may contain information that is
privileged, confidential and exempt from disclosure under applicable law.
Any dissemination, disclosure, printing, publishing or use of this email
or the information contained herein without written authorization of the
sender is strictly prohibited.  If you have received this e-mail in
error, please notify the sender immediately and delete. Thank you.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20070417/ee560e38/attachment.bin 

From tplate at acm.org  Tue Apr 17 19:04:01 2007
From: tplate at acm.org (Tony Plate)
Date: Tue, 17 Apr 2007 11:04:01 -0600
Subject: [Rd] typo in R-exts
Message-ID: <4624FE01.3000008@acm.org>

There looks to be a typo in the R-exts manual:

The whose @file{tests} is copied to the check area, ...
     ^^^^^

I'm not sure what was intended here, so I can't suggest a fix.

(from https://svn.r-project.org/R/trunk/doc/manual/R-exts.texi)

-- Tony Plate


From tplate at acm.org  Tue Apr 17 19:06:03 2007
From: tplate at acm.org (Tony Plate)
Date: Tue, 17 Apr 2007 11:06:03 -0600
Subject: [Rd] use of .Rout.save files in the 'tests' directory of a package
Message-ID: <4624FE7B.4050905@acm.org>

Even though all files in the 'tests' directory are copied to the 
installation directory and tests are run there, the current makefiles 
that runs the tests (share/make/{tests,wintests}.mk seem to go to some 
trouble to refer to the .Rout.save files in the original 'tests' 
directory. (E.g., in the line "@if test -f $(srcdir)/$@.save; then" in 
share/make/tests.mk.)  This means that .Rout.save files created during 
the testing process (either by .Rin files or via 'make') are not seen. 
I'm using R-2.5.0 (beta) under Windows and Linux, and AFAICT, this is 
the same under both systems.

Is there some good reason that .Rout.save files from the source 'tests' 
directory are used rather than the ones in the fresh copy of the 'tests' 
directory?  If this is some sort of historical legacy, could this be 
changed so that the testing always uses the copies of the files in fresh 
copy of the 'tests' directory?  (In cases where they are present in the 
source directory, they should be identical, AFAICS.)

-- Tony Plate


From p.dalgaard at biostat.ku.dk  Tue Apr 17 20:33:19 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 17 Apr 2007 20:33:19 +0200
Subject: [Rd] typo in R-exts
In-Reply-To: <4624FE01.3000008@acm.org>
References: <4624FE01.3000008@acm.org>
Message-ID: <462512EF.6020000@biostat.ku.dk>

Tony Plate wrote:
> There looks to be a typo in the R-exts manual:
>
> The whose @file{tests} is copied to the check area, ...
>      ^^^^^
>
> I'm not sure what was intended here, so I can't suggest a fix.
>   
'svn blame' tells me that this was Brian's addition in rev.35362. There 
is no previous version to help with guessing the intention. One 
possibility is that "The whose" should be "The directory", or maybe "The 
whole directory".
> (from https://svn.r-project.org/R/trunk/doc/manual/R-exts.texi)
>
> -- Tony Plate
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From tplate at acm.org  Tue Apr 17 20:56:55 2007
From: tplate at acm.org (Tony Plate)
Date: Tue, 17 Apr 2007 12:56:55 -0600
Subject: [Rd] typo in R-exts
In-Reply-To: <462512EF.6020000@biostat.ku.dk>
References: <4624FE01.3000008@acm.org> <462512EF.6020000@biostat.ku.dk>
Message-ID: <46251877.6010404@acm.org>

The actual behavior, as far as I can make out, is that all the files in 
the 'tests' directory are copied, but not any subdirectories (which I 
personally would have found useful).

So, saying the "whole directory" is probably not accurate.

-- Tony Plate

Peter Dalgaard wrote:
> Tony Plate wrote:
>> There looks to be a typo in the R-exts manual:
>>
>> The whose @file{tests} is copied to the check area, ...
>>      ^^^^^
>>
>> I'm not sure what was intended here, so I can't suggest a fix.
>>   
> 'svn blame' tells me that this was Brian's addition in rev.35362. There 
> is no previous version to help with guessing the intention. One 
> possibility is that "The whose" should be "The directory", or maybe "The 
> whole directory".
>> (from https://svn.r-project.org/R/trunk/doc/manual/R-exts.texi)
>>
>> -- Tony Plate
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>   
>


From ripley at stats.ox.ac.uk  Tue Apr 17 20:57:02 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 17 Apr 2007 19:57:02 +0100 (BST)
Subject: [Rd] typo in R-exts
In-Reply-To: <462512EF.6020000@biostat.ku.dk>
References: <4624FE01.3000008@acm.org> <462512EF.6020000@biostat.ku.dk>
Message-ID: <Pine.LNX.4.64.0704171953560.19031@gannet.stats.ox.ac.uk>

'whole of', as svn up will show you.

I prefer 'svn praise' myself.

BTW, it is very easy to read @file{foo} as 'file foo', and that is a 
frequent problem.

On Tue, 17 Apr 2007, Peter Dalgaard wrote:

> Tony Plate wrote:
>> There looks to be a typo in the R-exts manual:
>>
>> The whose @file{tests} is copied to the check area, ...
>>      ^^^^^
>>
>> I'm not sure what was intended here, so I can't suggest a fix.
>>
> 'svn blame' tells me that this was Brian's addition in rev.35362. There
> is no previous version to help with guessing the intention. One
> possibility is that "The whose" should be "The directory", or maybe "The
> whole directory".
>> (from https://svn.r-project.org/R/trunk/doc/manual/R-exts.texi)
>>
>> -- Tony Plate
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From p.dalgaard at biostat.ku.dk  Tue Apr 17 21:35:25 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 17 Apr 2007 21:35:25 +0200
Subject: [Rd] typo in R-exts
In-Reply-To: <Pine.LNX.4.64.0704171953560.19031@gannet.stats.ox.ac.uk>
References: <4624FE01.3000008@acm.org> <462512EF.6020000@biostat.ku.dk>
	<Pine.LNX.4.64.0704171953560.19031@gannet.stats.ox.ac.uk>
Message-ID: <4625217D.4090206@biostat.ku.dk>

Prof Brian Ripley wrote:
>
> I prefer 'svn praise' myself.
Or 'svn annotate'.

I think it depends on what I'm looking for, plus the risk that the 
author (perpetrator, contributor) might be me....


From jeff.horner at vanderbilt.edu  Tue Apr 17 23:40:10 2007
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Tue, 17 Apr 2007 16:40:10 -0500
Subject: [Rd] sys.call and friends
Message-ID: <46253EBA.3050800@vanderbilt.edu>

Hello,


I noticed that sys.frame treats which = 0 differently than sys.call and 
sys.function, and the documentation was unclear about it.

 > f <- function() sys.call()
 > f()
f()
 > f <- function() sys.function()
 > f()
function() sys.function()
 > f <- function() sys.frame()
 > f()
<environment: R_GlobalEnv>

sys.frame(0) always returns the .GlobalEnv, while sys.call(0) and 
sys.function(0) return the current call and function definition.

I offer a patch to clarify this for the uninitiated.

 > sessionInfo()
R version 2.6.0 Under development (unstable) (2007-04-16 r41194)
i686-pc-linux-gnu

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
[7] "base"

Jeff
-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner
-------------- next part --------------
A non-text attachment was scrubbed...
Name: sys.parent.rd.patch
Type: text/x-diff
Size: 2406 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20070417/248b1396/attachment.bin 

From murdoch at stats.uwo.ca  Wed Apr 18 00:45:48 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 17 Apr 2007 18:45:48 -0400
Subject: [Rd] Documentation update to R-lang.texi
In-Reply-To: <4623AAF1.5000000@vanderbilt.edu>
References: <4623AAF1.5000000@vanderbilt.edu>
Message-ID: <46254E1C.9010109@stats.uwo.ca>

On 4/16/2007 12:57 PM, Jeffrey Horner wrote:
> Section 4.3.4 of R-lang.texi version 41191 in the paragraph that starts 
> "When h(3) is..." explains that x and y are unbound variables in the 
> function body of g in this example:
> 
>       f <- function(x) {
>           y <- 10
>           g <- function(x) x + y
>           return(g)
>       }
>       h <- f()
>       h(3)
> 
> while the paragraph following the example explains that "bound variables 
> are those that match the formal arguments to the function." So wouldn't 
> x be bound?

I'll fix this in R-devel and the beta.

Duncan Murdoch


From ross at biostat.ucsf.edu  Wed Apr 18 04:43:27 2007
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Tue, 17 Apr 2007 19:43:27 -0700
Subject: [Rd] undefined symbol: Rf_rownamesgets
Message-ID: <20070418024327.GA27800@wheat.betterworld.us>

I get the error
 undefined symbol: Rf_rownamesgets
when I try to load my package, which include C++ code that calls that
function.  This is particularly strange since the code also calls
Rf_classgets, and it loaded OK with just that.

Can anyone tell me what's going on?  

For the record, I worked around this with the general purpose
attribute setting commands and R_RowNamesSymbol.  I discovered that
even with that I wasn't constructing a valid data.frame, and fell back
to returning a list of results.

I notice Rinternals.h defines
LibExtern SEXP	R_RowNamesSymbol;   /* "row.names" */
twice in the same block of code.

I'm using R 2.4.1 on Debian. The symbol seems to be there:
$ nm -D /usr/lib/R/lib/libR.so | grep classgets
00032e70 T Rf_classgets
$ nm -D /usr/lib/R/lib/libR.so | grep namesgets
00031370 T Rf_dimnamesgets
00034500 T Rf_namesgets

The source includes
#define R_NO_REMAP 1
#include <R.h>
#include <Rinternals.h>
and later
#include <memory>  // I think this is why I needed R_NO_REMAP

I realize this is not a complete example, but I'm hoping this will
ring a bell with someone.  I encountered this while running
R CMD check.  The link line generated was
g++ -shared  -o mspath.so AbstractTimeStepsGenerator.o Coefficients.o CompositeHistoryComputer.o CompressedTimeStepsGenerator.o Covariates.o Data.o Environment.o Evaluator.o FixedTimeStepsGenerator.o LinearProduct.o Manager.o Model.o ModelBuilder.o Path.o PathGenerator.o PrimitiveHistoryComputer.o SimpleRecorder.o Specification.o StateTimeClassifier.o SuccessorGenerator.o TimePoint.o TimeStepsGenerator.o mspath.o mspathR.o   -L/usr/lib/R/lib -lR

Thanks.
Ross


From erubin at bgu.ac.il  Wed Apr 18 05:44:06 2007
From: erubin at bgu.ac.il (Eitan Rubin)
Date: Wed, 18 Apr 2007 05:44:06 +0200
Subject: [Rd] Performing Merge and Duplicated on very large files
Message-ID: <005901c7816b$d103f610$7001a8c0@med.ad.bgu.ac.il>

Hi,

  I am working with very large matrices (>1 million records), and need to
1. Join the files (can be achieved with Merge)
2. Find lines that have the same value in some field (after the join) and
randomly sample 1 row.

I am concerned with the complexity of merge - how (un)efficient is it? I
don't have access to the real data, I need to send the script to someone who
does, so I can't just try and see what happens.

Similarly I am worried about the duplicated function - will it run on the
merged matrix? It is expected to be ~500,000 rows long, and have small
clusters of duplicated values (1-10 repeats of the same value).

  ER
 - - - - - -
Eitan Rubin
Dept. of Microbiology and Immunology
AND
National Institute of Biotechnology in the Negev

Ben Gurion University
Beer Sheva, Israel
Phone: 08-6479197


From murdoch at stats.uwo.ca  Wed Apr 18 05:07:12 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 17 Apr 2007 23:07:12 -0400
Subject: [Rd] undefined symbol: Rf_rownamesgets
In-Reply-To: <20070418024327.GA27800@wheat.betterworld.us>
References: <20070418024327.GA27800@wheat.betterworld.us>
Message-ID: <46258B60.2080708@stats.uwo.ca>

On 4/17/2007 10:43 PM, Ross Boylan wrote:
> I get the error
>  undefined symbol: Rf_rownamesgets
> when I try to load my package, which include C++ code that calls that
> function.  This is particularly strange since the code also calls
> Rf_classgets, and it loaded OK with just that.
> 
> Can anyone tell me what's going on?  
> 
> For the record, I worked around this with the general purpose
> attribute setting commands and R_RowNamesSymbol.  I discovered that
> even with that I wasn't constructing a valid data.frame, and fell back
> to returning a list of results.
> 
> I notice Rinternals.h defines
> LibExtern SEXP	R_RowNamesSymbol;   /* "row.names" */
> twice in the same block of code.
> 
> I'm using R 2.4.1 on Debian. The symbol seems to be there:
> $ nm -D /usr/lib/R/lib/libR.so | grep classgets
> 00032e70 T Rf_classgets
> $ nm -D /usr/lib/R/lib/libR.so | grep namesgets
> 00031370 T Rf_dimnamesgets
> 00034500 T Rf_namesgets

I don't see Rf_rownamesgets there, or in the R Externals manual among 
the API entry points listed.  Can't you use the documented dimnamesgets?

Duncan Murdoch

> The source includes
> #define R_NO_REMAP 1
> #include <R.h>
> #include <Rinternals.h>
> and later
> #include <memory>  // I think this is why I needed R_NO_REMAP
> 
> I realize this is not a complete example, but I'm hoping this will
> ring a bell with someone.  I encountered this while running
> R CMD check.  The link line generated was
> g++ -shared  -o mspath.so AbstractTimeStepsGenerator.o Coefficients.o CompositeHistoryComputer.o CompressedTimeStepsGenerator.o Covariates.o Data.o Environment.o Evaluator.o FixedTimeStepsGenerator.o LinearProduct.o Manager.o Model.o ModelBuilder.o Path.o PathGenerator.o PrimitiveHistoryComputer.o SimpleRecorder.o Specification.o StateTimeClassifier.o SuccessorGenerator.o TimePoint.o TimeStepsGenerator.o mspath.o mspathR.o   -L/usr/lib/R/lib -lR
> 
> Thanks.
> Ross
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ross at biostat.ucsf.edu  Wed Apr 18 06:17:22 2007
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Tue, 17 Apr 2007 21:17:22 -0700
Subject: [Rd] undefined symbol: Rf_rownamesgets
In-Reply-To: <46258B60.2080708@stats.uwo.ca>
References: <20070418024327.GA27800@wheat.betterworld.us>
	<46258B60.2080708@stats.uwo.ca>
Message-ID: <20070418041722.GJ13225@wheat.betterworld.us>

On Tue, Apr 17, 2007 at 11:07:12PM -0400, Duncan Murdoch wrote:
> On 4/17/2007 10:43 PM, Ross Boylan wrote:
> >I get the error
> > undefined symbol: Rf_rownamesgets
> >when I try to load my package, which include C++ code that calls that
> >function.  This is particularly strange since the code also calls
> >Rf_classgets, and it loaded OK with just that.
> >
> >Can anyone tell me what's going on?  
> >
> >For the record, I worked around this with the general purpose
> >attribute setting commands and R_RowNamesSymbol.  I discovered that
> >even with that I wasn't constructing a valid data.frame, and fell back
> >to returning a list of results.
> >
> >I notice Rinternals.h defines
> >LibExtern SEXP	R_RowNamesSymbol;   /* "row.names" */
> >twice in the same block of code.
> >
> >I'm using R 2.4.1 on Debian. The symbol seems to be there:
> >$ nm -D /usr/lib/R/lib/libR.so | grep classgets
> >00032e70 T Rf_classgets
> >$ nm -D /usr/lib/R/lib/libR.so | grep namesgets
> >00031370 T Rf_dimnamesgets
> >00034500 T Rf_namesgets
> 
> I don't see Rf_rownamesgets there, or in the R Externals manual among 
> the API entry points listed.  
You're right; sorry.  So does this function just not exist?  If so,
it would be good to remove the corresponding entries in Rinternals.h.

>Can't you use the documented dimnamesgets?
I did one better and didn't use anything!  I thought presence in
Rinternals.h constituted (terse) documentation, since the R Externals
manual says ("Handling R objects in C")
-------------------
   There are two approaches that can be taken to handling R objects from
within C code.  The first (historically) is to use the macros and
functions that have been used to implement the core parts of R through
`.Internal' calls.  A public subset of these is defined in the header
file `Rinternals.h' ...
-----------------------------

So is relying on Rinternals.h a bad idea?

In this case, accessing the row names through dimnamesgets looks a
little awkward, since it requires navigating to the right spot in
dimnames.  I would need Rf_dimnamesgets since I disabled the shortcut
names.

Ross


From ripley at stats.ox.ac.uk  Wed Apr 18 07:29:07 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 18 Apr 2007 06:29:07 +0100 (BST)
Subject: [Rd] undefined symbol: Rf_rownamesgets
In-Reply-To: <46258B60.2080708@stats.uwo.ca>
References: <20070418024327.GA27800@wheat.betterworld.us>
	<46258B60.2080708@stats.uwo.ca>
Message-ID: <Pine.LNX.4.64.0704180623240.23261@gannet.stats.ox.ac.uk>

On Tue, 17 Apr 2007, Duncan Murdoch wrote:

> On 4/17/2007 10:43 PM, Ross Boylan wrote:
>> I get the error
>>  undefined symbol: Rf_rownamesgets
>> when I try to load my package, which include C++ code that calls that
>> function.  This is particularly strange since the code also calls
>> Rf_classgets, and it loaded OK with just that.
>>
>> Can anyone tell me what's going on?
>>
>> For the record, I worked around this with the general purpose
>> attribute setting commands and R_RowNamesSymbol.  I discovered that
>> even with that I wasn't constructing a valid data.frame, and fell back
>> to returning a list of results.
>>
>> I notice Rinternals.h defines
>> LibExtern SEXP	R_RowNamesSymbol;   /* "row.names" */
>> twice in the same block of code.
>>
>> I'm using R 2.4.1 on Debian. The symbol seems to be there:
>> $ nm -D /usr/lib/R/lib/libR.so | grep classgets
>> 00032e70 T Rf_classgets
>> $ nm -D /usr/lib/R/lib/libR.so | grep namesgets
>> 00031370 T Rf_dimnamesgets
>> 00034500 T Rf_namesgets
>
> I don't see Rf_rownamesgets there, or in the R Externals manual among
> the API entry points listed.  Can't you use the documented dimnamesgets?

dimnamesgets is for arrays not data frames.  There is no 'rownamesgets' in 
the current sources, but a static row_names_gets that is called by 
setAttrib.

>
> Duncan Murdoch
>
>> The source includes
>> #define R_NO_REMAP 1
>> #include <R.h>
>> #include <Rinternals.h>
>> and later
>> #include <memory>  // I think this is why I needed R_NO_REMAP
>>
>> I realize this is not a complete example, but I'm hoping this will
>> ring a bell with someone.  I encountered this while running
>> R CMD check.  The link line generated was
>> g++ -shared  -o mspath.so AbstractTimeStepsGenerator.o Coefficients.o CompositeHistoryComputer.o CompressedTimeStepsGenerator.o Covariates.o Data.o Environment.o Evaluator.o FixedTimeStepsGenerator.o LinearProduct.o Manager.o Model.o ModelBuilder.o Path.o PathGenerator.o PrimitiveHistoryComputer.o SimpleRecorder.o Specification.o StateTimeClassifier.o SuccessorGenerator.o TimePoint.o TimeStepsGenerator.o mspath.o mspathR.o   -L/usr/lib/R/lib -lR
>>
>> Thanks.
>> Ross
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From D.Wischik at cs.ucl.ac.uk  Tue Apr 17 16:12:47 2007
From: D.Wischik at cs.ucl.ac.uk (D.Wischik at cs.ucl.ac.uk)
Date: Tue, 17 Apr 2007 16:12:47 +0200 (CEST)
Subject: [Rd] format() applied to an NA character string (PR#9616)
Message-ID: <20070417141247.4D4465DE7B@slim.kubism.ku.dk>


I get strange results when I try to format() an NA character string.

> x <- 'sometext'
> x[1] <- NA
> format(NA, width=32) # displays sensibly, right-justified
> format(x,width=32)   # displays sensibly, left-justified
> format(x,width=33)   # displays ""
> format(x,width=36)   # R exits abnormally with code 5

> version
platform       i386-pc-mingw32
arch           i386
os             mingw32
system         i386, mingw32
status
major          2
minor          4.1
year           2006
month          12
day            18
svn rev        40228
language       R
version.string R version 2.4.1 (2006-12-18)

I'm running Windows XP.

Damon.


From P.Dalgaard at biostat.ku.dk  Wed Apr 18 11:41:53 2007
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 18 Apr 2007 11:41:53 +0200
Subject: [Rd] format() applied to an NA character string (PR#9616)
In-Reply-To: <20070417141247.4D4465DE7B@slim.kubism.ku.dk>
References: <20070417141247.4D4465DE7B@slim.kubism.ku.dk>
Message-ID: <4625E7E1.60108@biostat.ku.dk>

D.Wischik at cs.ucl.ac.uk wrote:
> I get strange results when I try to format() an NA character string.
>
>   
>> x <- 'sometext'
>> x[1] <- NA
>> format(NA, width=32) # displays sensibly, right-justified
>> format(x,width=32)   # displays sensibly, left-justified
>> format(x,width=33)   # displays ""
>> format(x,width=36)   # R exits abnormally with code 5
>>     
>
>   
This happens on Linux too, given slightly larger widths:

R version 2.5.0 RC (2007-04-17 r41210)
....
> x <- as.character(NA)
> format(x,width=64)

Program received signal SIGSEGV, Segmentation fault.
Rstrlen (s=0x20000009, quote=0) at ../../../R/src/main/printutils.c:374
374         return Rstrwid(CHAR(s), LENGTH(s), quote);



>> version
>>     
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status
> major          2
> minor          4.1
> year           2006
> month          12
> day            18
> svn rev        40228
> language       R
> version.string R version 2.4.1 (2006-12-18)
>
> I'm running Windows XP.
>
> Damon.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From sdavis2 at mail.nih.gov  Wed Apr 18 12:17:58 2007
From: sdavis2 at mail.nih.gov (Sean Davis)
Date: Wed, 18 Apr 2007 06:17:58 -0400
Subject: [Rd] Performing Merge and Duplicated on very large files
In-Reply-To: <005901c7816b$d103f610$7001a8c0@med.ad.bgu.ac.il>
References: <005901c7816b$d103f610$7001a8c0@med.ad.bgu.ac.il>
Message-ID: <200704180617.58990.sdavis2@mail.nih.gov>

On Tuesday 17 April 2007 23:44, Eitan Rubin wrote:
> Hi,
>
>   I am working with very large matrices (>1 million records), and need to
> 1. Join the files (can be achieved with Merge)
> 2. Find lines that have the same value in some field (after the join) and
> randomly sample 1 row.
>
> I am concerned with the complexity of merge - how (un)efficient is it? I
> don't have access to the real data, I need to send the script to someone
> who does, so I can't just try and see what happens.
>
> Similarly I am worried about the duplicated function - will it run on the
> merged matrix? It is expected to be ~500,000 rows long, and have small
> clusters of duplicated values (1-10 repeats of the same value).

Eitan,

This is a question better asked on R-help.  You will need to test, perhaps 
with simulated data, but merge() and certainly duplicated() can typically be 
used on 1M rows.  However, you imply that you have multiple of these tables.  
You might also consider using a SQL database for your data.  RSQLite is a 
self-contained database and gives you the power of SQL with little hassle.  

Sean


From gregor.gorjanc at bfro.uni-lj.si  Wed Apr 18 12:49:19 2007
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Wed, 18 Apr 2007 10:49:19 +0000 (UTC)
Subject: [Rd] format() applied to an NA character string (PR#9616)
References: <20070417141247.4D4465DE7B@slim.kubism.ku.dk>
	<4625E7E1.60108@biostat.ku.dk>
Message-ID: <loom.20070418T124756-10@post.gmane.org>

Peter Dalgaard <P.Dalgaard <at> biostat.ku.dk> writes:
> This happens on Linux too, given slightly larger widths:
> 
> R version 2.5.0 RC (2007-04-17 r41210)
> ....
> > x <- as.character(NA)
> > format(x,width=64)

I can confirm this on Linux also. 

> format(x,width=36)
[1] "NA                                  "
R> format(x,width=64)

 *** caught segfault ***
address 0x20202020, cause 'memory not mapped'

Traceback:
 1: switch(mode(x), "NULL" = "NULL", character = .Internal(format(x,     trim,
digits, nsmall, width, adj, na.encode, scientific)),     call = , expression = ,
"function" = , "(" = deparse(x),     raw = as.character(x),
prettyNum(.Internal(format(x, trim,         digits, nsmall, width, 3, na.encode,
scientific)), big.mark = big.mark,         big.interval = big.interval,
small.mark = small.mark,         small.interval = small.interval, decimal.mark =
decimal.mark,         zero.print = zero.print, preserve.width = if (trim)
"individual" else "common"))
 2: format.default(x, width = 64)
 3: format(x, width = 64)

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status = Under development (unstable)
 major = 2
 minor = 6.0
 year = 2007
 month = 04
 day = 18
 svn rev = 41219
 language = R
 version.string = R version 2.6.0 Under development (unstable) (2007-04-18 r41219)

Gregor


From gregor.gorjanc at bfro.uni-lj.si  Wed Apr 18 12:44:31 2007
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Wed, 18 Apr 2007 12:44:31 +0200
Subject: [Rd] Problem with: Vignette dependencies (\VignetteDepends{}
 entries) must be contained in
Message-ID: <4625F68F.4000903@bfro.uni-lj.si>

Hello!

I have just discovered a possible bug or lack of my knowledge. The last
option is not so uncommon and I decided to ask here before flooding the
bugs repository.

Say I have a package test with vignette. Moving package directory to
some other name, say test2, fails R CMD check with

$ R CMD check test2
* checking for working latex ... OK
* using log directory '/home/ggorjan/programs/R/devel/test2.Rcheck'
* using R version 2.4.1 (2006-12-18)
* checking for file 'test2/DESCRIPTION' ... OK
* checking extension type ... Package
* this is package 'test' version '0.1.0'
* checking package dependencies ... ERROR
Vignette dependencies not required:
  test
Vignette dependencies (\VignetteDepends{} entries) must be contained in
the DESCRIPTION Depends/Suggests entries.

I got the same behaviour with recent R-devel (2007-04-18 r41219). Search
on R-{help,devel} and BioC mailing lists did not show any relevant info
for this error.

Search in R-devel sources reveals that above error string comes from
src/library/tools/R/{all.R,QC.R} - function print.check_package_depends,
which in turns uses info from function .check_package_depends and it
seems to me that relevant code is on lines 2436-2447.

I am attaching both test and test2 tarballs so anyone can test this easily.

Version:
 platform = i486-pc-linux-gnu
 arch = i486
 os = linux-gnu
 system = i486, linux-gnu
 status =
 major = 2
 minor = 4.1
 year = 2006
 month = 12
 day = 18
 svn rev = 40228
 language = R
 version.string = R version 2.4.1 (2006-12-18)

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc
----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty        www: http://www.bfro.uni-lj.si/MR/ggorjan
Zootechnical Department     blog: http://ggorjan.blogspot.com
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si
SI-1230 Domzale             fax: +386 (0)1 72 17 888
Slovenia, Europe            tel: +386 (0)1 72 17 861
----------------------------------------------------------------------
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.tgz
Type: application/x-compressed-tar
Size: 785 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20070418/2888b274/attachment.bin 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test2.tgz
Type: application/x-compressed-tar
Size: 770 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20070418/2888b274/attachment-0001.bin 

From thomas.friedrichsmeier at ruhr-uni-bochum.de  Wed Apr 18 14:17:02 2007
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: Wed, 18 Apr 2007 14:17:02 +0200
Subject: [Rd] args / formals on primitives
In-Reply-To: <Pine.LNX.4.64.0704161823240.10009@gannet.stats.ox.ac.uk>
References: <200704161853.07237.thomas.friedrichsmeier@ruhr-uni-bochum.de>
	<Pine.LNX.4.64.0704161823240.10009@gannet.stats.ox.ac.uk>
Message-ID: <200704181417.03020.thomas.friedrichsmeier@ruhr-uni-bochum.de>

On Tuesday 17 April 2007 09:12, Prof Brian Ripley wrote:
> On Mon, 16 Apr 2007, Thomas Friedrichsmeier wrote:

[...]

> > While at it, I was wondering, why
> >
> > formals(c)
> >
> > still returns NULL, in contrast.
>
> Because only closures have formals, the way things are defined.  This
> makes sense to me as formals<-() cannot work on primitives.

On the other hand, a return value of NULL does not differentiate between a 
closure which simply does not have any formals and a primitive:

f <- function () 1
formals (f)		# NULL
formals (c)	# NULL

In the former case, formals<-() will work, in the latter case, it won't. To 
differentiate between those, one could use is.primitive() or typeof().

I don't pretend to understand the technicalities involved, but to me it looks 
like there is some effort to make all types of functions "look" the same in R 
for most purposes. Having the same in formals() would make it slightly easier 
to provide argument completion or object browsers (but then, args() could be 
used for such purposes).

Either way it's painless to me, and is now clearly documented. So if this does 
not make too much sense, just ignore me.

Regards
Thomas Friedrichsmeier


From gregor.gorjanc at bfro.uni-lj.si  Wed Apr 18 16:33:12 2007
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Wed, 18 Apr 2007 14:33:12 +0000 (UTC)
Subject: [Rd]
	=?utf-8?q?Problem_with=3A_Vignette_dependencies_=28=5CVignet?=
	=?utf-8?q?teDepends=7B=7D_entries=29_must_be_contained_in?=
References: <4625F68F.4000903@bfro.uni-lj.si>
Message-ID: <loom.20070418T162747-326@post.gmane.org>

Gregor Gorjanc <gregor.gorjanc <at> bfro.uni-lj.si> writes:
> 
> Hello!
> 
> I have just discovered a possible bug or lack of my knowledge. The last
> option is not so uncommon and I decided to ask here before flooding the
> bugs repository.
> 
> Say I have a package test with vignette. Moving package directory to
> some other name, say test2, fails R CMD check with

This problem is due to my specification in Rnw file i.e.

% \VignetteDepends{test}

If I remove this or remove just test and leave some other packages in it (that
are also in DESCRIPTION Depends field), then previously reported error in R CMD
check does not show up. It seems that I have not understood \VignetteDepends{}
properly. I thought that we need to specify all packages that are needed for
vignette to work.

Gregor


From ripley at stats.ox.ac.uk  Wed Apr 18 17:34:48 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Wed, 18 Apr 2007 17:34:48 +0200 (CEST)
Subject: [Rd] format() applied to an NA character string (PR#9616)
Message-ID: <20070418153448.778B862609@slim.kubism.ku.dk>

On Wed, 18 Apr 2007, Peter Dalgaard wrote:

> D.Wischik at cs.ucl.ac.uk wrote:
>> I get strange results when I try to format() an NA character string.
>>
>>
>>> x <- 'sometext'
>>> x[1] <- NA
>>> format(NA, width=32) # displays sensibly, right-justified
>>> format(x,width=32)   # displays sensibly, left-justified
>>> format(x,width=33)   # displays ""
>>> format(x,width=36)   # R exits abnormally with code 5
>>>
>>
>>
> This happens on Linux too, given slightly larger widths:

It happened for me on Linux in R 2.4.1 at width=32, but those examples are 
fine on both Linux and Windows in pre-2.5.0.

It was (of course) a buffer overflow, fixed now for 2.5.0.
Valgrind got to the correct spot (in paste.c).

>
> R version 2.5.0 RC (2007-04-17 r41210)
> ....
>> x <- as.character(NA)
>> format(x,width=64)
>
> Program received signal SIGSEGV, Segmentation fault.
> Rstrlen (s=0x20000009, quote=0) at ../../../R/src/main/printutils.c:374
> 374         return Rstrwid(CHAR(s), LENGTH(s), quote);
>
>
>
>>> version
>>>
>> platform       i386-pc-mingw32
>> arch           i386
>> os             mingw32
>> system         i386, mingw32
>> status
>> major          2
>> minor          4.1
>> year           2006
>> month          12
>> day            18
>> svn rev        40228
>> language       R
>> version.string R version 2.4.1 (2006-12-18)
>>
>> I'm running Windows XP.
>>
>> Damon.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Apr 18 18:19:50 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 18 Apr 2007 17:19:50 +0100 (BST)
Subject: [Rd] typo in R-exts
In-Reply-To: <46251877.6010404@acm.org>
References: <4624FE01.3000008@acm.org> <462512EF.6020000@biostat.ku.dk>
	<46251877.6010404@acm.org>
Message-ID: <Pine.LNX.4.64.0704180833270.22100@auk.stats>

On Tue, 17 Apr 2007, Tony Plate wrote:

> The actual behavior, as far as I can make out, is that all the files in
> the 'tests' directory are copied, but not any subdirectories (which I
> personally would have found useful).
>
> So, saying the "whole directory" is probably not accurate.

I think it is: to copy subdirectories as well you need a recursive copy 
(cp -r), which Perl does not support in its base configuration.
I'll see if I can add the latter for 2.6.0.

>
> -- Tony Plate
>
> Peter Dalgaard wrote:
>> Tony Plate wrote:
>>> There looks to be a typo in the R-exts manual:
>>>
>>> The whose @file{tests} is copied to the check area, ...
>>>      ^^^^^
>>>
>>> I'm not sure what was intended here, so I can't suggest a fix.
>>>
>> 'svn blame' tells me that this was Brian's addition in rev.35362. There
>> is no previous version to help with guessing the intention. One
>> possibility is that "The whose" should be "The directory", or maybe "The
>> whole directory".
>>> (from https://svn.r-project.org/R/trunk/doc/manual/R-exts.texi)
>>>
>>> -- Tony Plate
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hin-tak.leung at cimr.cam.ac.uk  Wed Apr 18 20:05:54 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Wed, 18 Apr 2007 19:05:54 +0100
Subject: [Rd] curious package behaviors under cross-build and/or between
	windows/unix
Message-ID: <46265E02.2040902@cimr.cam.ac.uk>

Hi,

I have gone back to cross-compiling again, and I have come to two 
curious issues: (I have native R under linux x86_64 and win32 R
under wine) - both 2.4.1:

(1) for a pure R package (i.e. no compiled code), win32 R would
happily load the unix version, but the unix version complains
the cross-built package that it was built for x86 mingw and refuses
to load it. Is there any reason for the difference?

(2) I get two "arguments in definition changed from (obj) to (object)"
messages when I do library(XML) on win32 R - but not on native R,
I know R-devel is not for asking omegahat questions, but
the message seem to be emitted by R core, so for some reason win32 R is 
behaving differently from native linux R. Again, why the difference
in behavior?

Thanks for an ideas.

Hin-Tak Leung


From ripley at stats.ox.ac.uk  Wed Apr 18 20:49:26 2007
From: ripley at stats.ox.ac.uk (Prof Brian D Ripley)
Date: Wed, 18 Apr 2007 19:49:26 +0100 (GMT Daylight Time)
Subject: [Rd] curious package behaviors under cross-build and/or between
 windows/unix
In-Reply-To: <46265E02.2040902@cimr.cam.ac.uk>
References: <46265E02.2040902@cimr.cam.ac.uk>
Message-ID: <Pine.WNT.4.64.0704181943180.3620@Petrel>

On Wed, 18 Apr 2007, Hin-Tak Leung wrote:

> Hi,
>
> I have gone back to cross-compiling again, and I have come to two
> curious issues: (I have native R under linux x86_64 and win32 R
> under wine) - both 2.4.1:
>
> (1) for a pure R package (i.e. no compiled code), win32 R would
> happily load the unix version, but the unix version complains
> the cross-built package that it was built for x86 mingw and refuses
> to load it. Is there any reason for the difference?

Yes.  Take a look at the installed DESCRIPTION file, and the Built: line. 
(One reason is line endings: not everything works on Unix (diff, for one) 
with CRLF endings, but everything does work on Windows with LF endings.)

> (2) I get two "arguments in definition changed from (obj) to (object)"
> messages when I do library(XML) on win32 R - but not on native R,

I get it on all platforms with 2.5.0 RC and later (2.4.x is closed), and it 
is a bug in the XML package, AFAICS.

> I know R-devel is not for asking omegahat questions, but
> the message seem to be emitted by R core, so for some reason win32 R is
> behaving differently from native linux R. Again, why the difference
> in behavior?
>
> Thanks for an ideas.
>
> Hin-Tak Leung
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hin-tak.leung at cimr.cam.ac.uk  Wed Apr 18 21:25:25 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Wed, 18 Apr 2007 20:25:25 +0100
Subject: [Rd] curious package behaviors under cross-build and/or between
 windows/unix
In-Reply-To: <Pine.WNT.4.64.0704181943180.3620@Petrel>
References: <46265E02.2040902@cimr.cam.ac.uk>
	<Pine.WNT.4.64.0704181943180.3620@Petrel>
Message-ID: <462670A5.10708@cimr.cam.ac.uk>

Prof Brian D Ripley wrote:
> On Wed, 18 Apr 2007, Hin-Tak Leung wrote:
> 
>> Hi,
>>
>> I have gone back to cross-compiling again, and I have come to two
>> curious issues: (I have native R under linux x86_64 and win32 R
>> under wine) - both 2.4.1:
>>
>> (1) for a pure R package (i.e. no compiled code), win32 R would
>> happily load the unix version, but the unix version complains
>> the cross-built package that it was built for x86 mingw and refuses
>> to load it. Is there any reason for the difference?
> 
> Yes.  Take a look at the installed DESCRIPTION file, and the Built: 
> line. (One reason is line endings: not everything works on Unix (diff, 
> for one) with CRLF endings, but everything does work on Windows with LF 
> endings.)

Yes, I know about that line in the DESCRIPTION file, and I tried
deleting it without the desired effect. It seems that the built info
is stored elsewhere as well for the cross-build?; but my point is
that the native unix build DESCRIPTION file also says
"Built: R 2.4.1; i686-redhat-linux-gnu; 2007-03-05 19:03:08; unix"
but win32 R doesn't seem to mind loading it?

It seems to be fairly common knowledge(?) that for pure R packages,
one can just zip up the unix install to stick it on windows; and I
was just surprised that the reverse is not true.

>> (2) I get two "arguments in definition changed from (obj) to (object)"
>> messages when I do library(XML) on win32 R - but not on native R,
> 
> I get it on all platforms with 2.5.0 RC and later (2.4.x is closed), and 
> it is a bug in the XML package, AFAICS.

I do believe it is a bug in XML (having had a look at google), but
I can't pin-point how/where it triggers a message from R-core. I
suppose I'll just look harder :-). This behavior seems to be specific
to win32 R 2.4.x though, as I have "identical" R versions for the two:

 > sessionInfo()
R version 2.4.1 (2006-12-18)
i686-redhat-linux-gnu

 > sessionInfo()
R version 2.4.1 (2006-12-18)
i386-pc-mingw32

Hin-Tak


From tplate at acm.org  Thu Apr 19 06:08:34 2007
From: tplate at acm.org (tplate at acm.org)
Date: Thu, 19 Apr 2007 06:08:34 +0200 (CEST)
Subject: [Rd] minor omissions re "special" windows file names (PR#9622)
Message-ID: <20070419040834.5AB085DE53@slim.kubism.ku.dk>

"lpt1" through "lpt9" and "com1" through "com9"  are in fact "special" 
file names under various versions of Microsoft Windows.  However, "R 
Extensions" says only that "lpt1" through "lpt4" and "com1" through 
"com3" cannot be used as filenames, and "R CMD check" checks for just 
these filenames.  Consequently, "R CMD check" can let through filenames 
that are disallowed under Windows.

For references, see http://en.wikipedia.org/wiki/Filename and 
http://msdn.microsoft.com/library/default.asp?url=/library/en-us/fileio/fs/naming_a_file.asp
(FWIW, note however that Wikipedia *may* be mistaken in claiming that 
"com0" and "lpt0" are special file names -- these are not listed on the 
Microsoft page, and I verified that they can be used as normal file 
names on my Windows XP machine at least.)

Accordingly, the following changes might be desired:

In src/scripts/check.in:
OLD LINE:
          if(grep(/^(con|prn|aux|clock\$|nul|lpt[1-3]|com[1-4])$/,
NEW LINE:
         if(grep(/^(con|prn|aux|clock\$|nul|lpt[1-9]|com[1-9])$/,
ALSO: fix comment at beginning of check.in (search for "com1")

In doc/manuals/R-exts.texi, I would suggest changing
-----
names.  In addition, files with names @samp{con}, @samp{prn},
@samp{aux}, @samp{clock$}, @samp{nul}, @samp{com1} to @samp{com4}, and
@samp{lpt1} to @samp{lpt3} after conversion to lower case and stripping
possible ``extensions'', are disallowed.  Also, file names in the same
-----
to
-----
names.  In addition, files with names @samp{con}, @samp{prn},
@samp{aux}, @samp{clock$}, @samp{nul}, @samp{com1} to @samp{com9}, and
@samp{lpt1} to @samp{lpt9} after conversion to lower case and stripping
possible ``extensions'', are disallowed
(e.g., @samp{lpt5.foo.bar} is disallowed.)  Also, file names in the same
-----

(with the example added to clarify what "stripping possible extensions" 
means).

Obviously, not a high-priority error.

-- Tony Plate


From gregory.warnes at mac.com  Thu Apr 19 00:58:04 2007
From: gregory.warnes at mac.com (Gregory Warnes)
Date: Wed, 18 Apr 2007 18:58:04 -0400
Subject: [Rd] [R] Error loading libraries in MAC
In-Reply-To: <07A9CBD0-C0BF-4017-A56D-63DEDB90B55A@mail.rockefeller.edu>
References: <07A9CBD0-C0BF-4017-A56D-63DEDB90B55A@mail.rockefeller.edu>
Message-ID: <5CCD3B76-5831-47AE-BAF4-1D1D72AF3F24@mac.com>

I have received a number of reports of problems with recent unversal  
Mac packages from CRAN when used with R 2.4.1.  Has something in the  
build script changed?

-G


On Apr 18, 2007, at 4:49PM , Mayte Suarez-Farinas wrote:

> Hi I just installed the gmodels package
> and the installation was successful but when I was trying to load the
> library I got an error (see below).
> Interesting, yesterday I wrote to the maintainer of RSQLite apckage
> because I got the same error.
> Does somebody knows what is going on ??
>
> thanks,
> Mayte
>
>
> library(gmodels)
> Error in dyn.load(x, as.logical(local), as.logical(now)) :
> 	unable to load shared library '/Library/Frameworks/R.framework/
> Versions/2.4/Resources/library/gtools/libs/i386/gtools.so':
>    dlopen(/Library/Frameworks/R.framework/Versions/2.4/Resources/
> library/gtools/libs/i386/gtools.so, 6): Library not loaded: /usr/
> local/gcc4.0/i686-apple-darwin8/lib/libgcc_s.1.0.dylib
>    Referenced from: /Library/Frameworks/R.framework/Versions/2.4/
> Resources/library/gtools/libs/i386/gtools.so
>    Reason: image not found
> Error: package/namespace load failed for 'gmodels'
>
> R.Version()
> $platform
> [1] "i386-apple-darwin8.8.1"
>
> $arch
> [1] "i386"
>
> $os
> [1] "darwin8.8.1"
>
> $system
> [1] "i386, darwin8.8.1"
>
> $status
> [1] ""
>
> $major
> [1] "2"
>
> $minor
> [1] "4.1"
>
> $year
> [1] "2006"
>
> $month
> [1] "12"
>
> $day
> [1] "18"
>
> $`svn rev`
> [1] "40228"
>
> $language
> [1] "R"
>
> $version.string
> [1] "R version 2.4.1 (2006-12-18)"
>
>>
>
> ______________________________________________
> R-help at stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting- 
> guide.html
> and provide commented, minimal, self-contained, reproducible code.


From mwtoews at sfu.ca  Thu Apr 19 05:20:22 2007
From: mwtoews at sfu.ca (mwtoews at sfu.ca)
Date: Thu, 19 Apr 2007 05:20:22 +0200 (CEST)
Subject: [Rd] Feature request for 'sprintf' optimization (PR#9621)
Message-ID: <20070419032022.479B15DE35@slim.kubism.ku.dk>

Full_Name: Michael Toews
Version: R-devel and 2.4.1
OS: Debian etch and WindowsXP
Submission from: (NULL) (142.58.206.114)


This is a quick demonstration of the present time limitation of 'sprintf' on
long vectors with a suggestion for significant optimization.

First, consider a data.frame with numeric (double) values:

dat <- data.frame(year=as.numeric(rep(1970:2000,each=365)),
                  yday=as.numeric(1:365))
nrow(dat)

Consider using 'sprintf' in R with and without casting the arrays:

wocast <- system.time(with(dat,sprintf("%04i-%03i",year,yday)))
wcast  <- system.time(with(dat,sprintf("%04i-%03i",as.integer(year),
                                                   as.integer(yday))))
100*wocast/wcast # as a percent comparison

My results on a Debian VM with R-devel (r41236) have elapsed ratios of 63408%,
and on Windows XP with R 2.4.1 of 23300%. Using a similar data frame to 'dat'
except, much longer (using 1900:2100 for year; nrow=73365) result in ratios of
120775%. Certainly, the time of the 'sprintf' wrapper is dependent not only on
processor and platform, but more significantly on the data types of the '...'
values passed to the wrapper.

The first and simplest suggestion is to document in 'sprnitf' that it is
significantly faster when supplied with values in the intended data type for
'fmt' through casting (namely using 'as.integer'). However, to the user it would
seem that they have to specify the format twice (e.g., once for '%i' and the
second for 'as.integer()').

A second and more elegant suggestion is for 'sprintf' (or called C code) is to
parse 'fmt' for the data types, and cast the values from '...' according to
those types before continuing with the wrapper call.

(I have not looked at the source code, nor am I good C programmer, so I can't do
more than suggest -- it is possible there could be an alternate optimizations in
the wrapper, since the processing time is very dependent on the length of the
'...' vectors, and it might be evaluating the values repeatedly in a 'for'
loop.)

Thanks!
+mt


From sdavis2 at mail.nih.gov  Thu Apr 19 12:08:25 2007
From: sdavis2 at mail.nih.gov (Sean Davis)
Date: Thu, 19 Apr 2007 06:08:25 -0400
Subject: [Rd] [R] Error loading libraries in MAC
In-Reply-To: <5CCD3B76-5831-47AE-BAF4-1D1D72AF3F24@mac.com>
References: <07A9CBD0-C0BF-4017-A56D-63DEDB90B55A@mail.rockefeller.edu>
	<5CCD3B76-5831-47AE-BAF4-1D1D72AF3F24@mac.com>
Message-ID: <200704190608.25274.sdavis2@mail.nih.gov>

I'll chime in to note the same.  And just to add, sometimes restarting R seems 
to alleviate the problem....

On Wednesday 18 April 2007 18:58, Gregory Warnes wrote:
> I have received a number of reports of problems with recent unversal
> Mac packages from CRAN when used with R 2.4.1.  Has something in the
> build script changed?
>
> -G
>
> On Apr 18, 2007, at 4:49PM , Mayte Suarez-Farinas wrote:
> > Hi I just installed the gmodels package
> > and the installation was successful but when I was trying to load the
> > library I got an error (see below).
> > Interesting, yesterday I wrote to the maintainer of RSQLite apckage
> > because I got the same error.
> > Does somebody knows what is going on ??
> >
> > thanks,
> > Mayte
> >
> >
> > library(gmodels)
> > Error in dyn.load(x, as.logical(local), as.logical(now)) :
> > 	unable to load shared library '/Library/Frameworks/R.framework/
> > Versions/2.4/Resources/library/gtools/libs/i386/gtools.so':
> >    dlopen(/Library/Frameworks/R.framework/Versions/2.4/Resources/
> > library/gtools/libs/i386/gtools.so, 6): Library not loaded: /usr/
> > local/gcc4.0/i686-apple-darwin8/lib/libgcc_s.1.0.dylib
> >    Referenced from: /Library/Frameworks/R.framework/Versions/2.4/
> > Resources/library/gtools/libs/i386/gtools.so
> >    Reason: image not found
> > Error: package/namespace load failed for 'gmodels'
> >
> > R.Version()
> > $platform
> > [1] "i386-apple-darwin8.8.1"
> >
> > $arch
> > [1] "i386"
> >
> > $os
> > [1] "darwin8.8.1"
> >
> > $system
> > [1] "i386, darwin8.8.1"
> >
> > $status
> > [1] ""
> >
> > $major
> > [1] "2"
> >
> > $minor
> > [1] "4.1"
> >
> > $year
> > [1] "2006"
> >
> > $month
> > [1] "12"
> >
> > $day
> > [1] "18"
> >
> > $`svn rev`
> > [1] "40228"
> >
> > $language
> > [1] "R"
> >
> > $version.string
> > [1] "R version 2.4.1 (2006-12-18)"
> >
> >
> >
> > ______________________________________________
> > R-help at stat.math.ethz.ch mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide http://www.R-project.org/posting-
> > guide.html
> > and provide commented, minimal, self-contained, reproducible code.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From sdavis2 at mail.nih.gov  Thu Apr 19 12:08:25 2007
From: sdavis2 at mail.nih.gov (Sean Davis)
Date: Thu, 19 Apr 2007 06:08:25 -0400
Subject: [Rd] [R] Error loading libraries in MAC
In-Reply-To: <5CCD3B76-5831-47AE-BAF4-1D1D72AF3F24@mac.com>
References: <07A9CBD0-C0BF-4017-A56D-63DEDB90B55A@mail.rockefeller.edu>
	<5CCD3B76-5831-47AE-BAF4-1D1D72AF3F24@mac.com>
Message-ID: <200704190608.25274.sdavis2@mail.nih.gov>

I'll chime in to note the same.  And just to add, sometimes restarting R seems 
to alleviate the problem....

On Wednesday 18 April 2007 18:58, Gregory Warnes wrote:
> I have received a number of reports of problems with recent unversal
> Mac packages from CRAN when used with R 2.4.1.  Has something in the
> build script changed?
>
> -G
>
> On Apr 18, 2007, at 4:49PM , Mayte Suarez-Farinas wrote:
> > Hi I just installed the gmodels package
> > and the installation was successful but when I was trying to load the
> > library I got an error (see below).
> > Interesting, yesterday I wrote to the maintainer of RSQLite apckage
> > because I got the same error.
> > Does somebody knows what is going on ??
> >
> > thanks,
> > Mayte
> >
> >
> > library(gmodels)
> > Error in dyn.load(x, as.logical(local), as.logical(now)) :
> > 	unable to load shared library '/Library/Frameworks/R.framework/
> > Versions/2.4/Resources/library/gtools/libs/i386/gtools.so':
> >    dlopen(/Library/Frameworks/R.framework/Versions/2.4/Resources/
> > library/gtools/libs/i386/gtools.so, 6): Library not loaded: /usr/
> > local/gcc4.0/i686-apple-darwin8/lib/libgcc_s.1.0.dylib
> >    Referenced from: /Library/Frameworks/R.framework/Versions/2.4/
> > Resources/library/gtools/libs/i386/gtools.so
> >    Reason: image not found
> > Error: package/namespace load failed for 'gmodels'
> >
> > R.Version()
> > $platform
> > [1] "i386-apple-darwin8.8.1"
> >
> > $arch
> > [1] "i386"
> >
> > $os
> > [1] "darwin8.8.1"
> >
> > $system
> > [1] "i386, darwin8.8.1"
> >
> > $status
> > [1] ""
> >
> > $major
> > [1] "2"
> >
> > $minor
> > [1] "4.1"
> >
> > $year
> > [1] "2006"
> >
> > $month
> > [1] "12"
> >
> > $day
> > [1] "18"
> >
> > $`svn rev`
> > [1] "40228"
> >
> > $language
> > [1] "R"
> >
> > $version.string
> > [1] "R version 2.4.1 (2006-12-18)"
> >
> >
> >
> > ______________________________________________
> > R-help at stat.math.ethz.ch mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide http://www.R-project.org/posting-
> > guide.html
> > and provide commented, minimal, self-contained, reproducible code.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Thu Apr 19 14:56:32 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Thu, 19 Apr 2007 14:56:32 +0200 (CEST)
Subject: [Rd] (PR#9613) [Wishlist] to uniform help(x) and library(help=x)
Message-ID: <20070419125632.ACB9662632@slim.kubism.ku.dk>

What library(help=foo) produces is not HTML and has no hyperlinks, so why 
do you want it displayed in a browser?  If you do want text displayed in a 
browser, you can set options("pager") to point to your browser (or a 
wrapper).

It is no different from other library() help modes, like library() with no 
argument, nor from help(package="foo").

Indeed, the help for help says

htmlhelp: logical (or 'NULL').  If 'TRUE' (which is the default after
           'help.start' has been called), the HTML version of the help
           on the topic will be shown in the browser specified by
           'options("browser")'.

and note 'topic' and 'HTML version'.  Where there is no such help, plain 
text is shown.

On Tue, 17 Apr 2007, lbraglia at gmail.com wrote:

> Full_Name: Luca Braglia
> Version: R version 2.4.1 (2006-12-18)
> OS: Debian Lenny (testing)
> Submission from: (NULL) (82.61.142.240)
>
>
> Some options of mine:
>
>> options("htmlhelp")
> $htmlhelp
> [1] TRUE
>
>> options("browser")
> $browser
> [1] "/usr/bin/urxvt -rv -e elinks"
>
>
> I run R under X windows system: if I command
>
> help(foo)
>
> foo manual page is printed, correctly, under elinks (my textual browser); but if
> I command
>
> library(help=asd)
>
> asd package summary page is printed in R console.
> I would like library(help=asd) to be printed in my browser too, if possible:
> strictly speaking
>
> --> add htmlhelp = getOption("htmlhelp") in library arguments
>
> to be used only if "help" option  is specified.
>
>
> Thanks a lot,
>
>     Luca
>
>
>
>
>
>
>
> Version:
> platform = i486-pc-linux-gnu
> arch = i486
> os = linux-gnu
> system = i486, linux-gnu
> status =
> major = 2
> minor = 4.1
> year = 2006
> month = 12
> day = 18
> svn rev = 40228
> language = R
> version.string = R version 2.4.1 (2006-12-18)
>
>
> locale:
> LC_CTYPE=it_IT.UTF-8;LC_NUMERIC=C;LC_TIME=it_IT.UTF-8;LC_COLLATE=it_IT.UTF-8;LC_MONETARY=it_IT.UTF-8;LC_MESSAGES=it_IT.UTF-8;LC_PAPER=it_IT.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=it_IT.UTF-8;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] "utils"     "stats"     "graphics"  "grDevices" "methods"
> [6] "base"
>
> other attached packages:
>    MASS
> "7.2-33"
>
>
> Search Path:
> .GlobalEnv, package:MASS, package:utils, package:stats, package:graphics,
> pack\
> age:grDevices, package:methods, Autoloads, package:base
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From mel at altk.com  Thu Apr 19 16:31:30 2007
From: mel at altk.com (mel)
Date: Thu, 19 Apr 2007 16:31:30 +0200
Subject: [Rd] printf capture
In-Reply-To: <Pine.LNX.4.64.0704121558260.11792@gannet.stats.ox.ac.uk>
References: <461E02EE.7040105@altk.com>
	<Pine.LNX.4.64.0704121122480.26905@gannet.stats.ox.ac.uk>
	<461E3F8F.4050801@altk.com>
	<Pine.LNX.4.64.0704121558260.11792@gannet.stats.ox.ac.uk>
Message-ID: <46277D42.9080203@altk.com>

Prof Brian Ripley a ?crit :

> You can always link in a wrapper that defined printf and passes the 
> arguments to Rprintf.

I apologize but confess i didn't completely understand
this suggestion.

> It's documented in 'Writing R Extensions'.
>   The defines used for compatibility with @Sl{} sometimes causes
>   conflicts (notably with Windows headers), and the known
>   problematic defines can be removed by defining @code{STRICT_R_HEADERS}.

Yes, i added
#define STRICT_R_HEADERS
in my cpp code, and the redefinition warning vanishes indeed.

Many thanks for your precise tips and my apologies for the late answer.


From helprhelp at gmail.com  Thu Apr 19 18:34:47 2007
From: helprhelp at gmail.com (Weiwei Shi)
Date: Thu, 19 Apr 2007 12:34:47 -0400
Subject: [Rd] [R] Error loading libraries in MAC
In-Reply-To: <200704190608.25274.sdavis2@mail.nih.gov>
References: <07A9CBD0-C0BF-4017-A56D-63DEDB90B55A@mail.rockefeller.edu>
	<5CCD3B76-5831-47AE-BAF4-1D1D72AF3F24@mac.com>
	<200704190608.25274.sdavis2@mail.nih.gov>
Message-ID: <cdf817830704190934g15016507k6b67f92f7f7af926@mail.gmail.com>

same here.

weiwei

On 4/19/07, Sean Davis <sdavis2 at mail.nih.gov> wrote:
> I'll chime in to note the same.  And just to add, sometimes restarting R seems
> to alleviate the problem....
>
> On Wednesday 18 April 2007 18:58, Gregory Warnes wrote:
> > I have received a number of reports of problems with recent unversal
> > Mac packages from CRAN when used with R 2.4.1.  Has something in the
> > build script changed?
> >
> > -G
> >
> > On Apr 18, 2007, at 4:49PM , Mayte Suarez-Farinas wrote:
> > > Hi I just installed the gmodels package
> > > and the installation was successful but when I was trying to load the
> > > library I got an error (see below).
> > > Interesting, yesterday I wrote to the maintainer of RSQLite apckage
> > > because I got the same error.
> > > Does somebody knows what is going on ??
> > >
> > > thanks,
> > > Mayte
> > >
> > >
> > > library(gmodels)
> > > Error in dyn.load(x, as.logical(local), as.logical(now)) :
> > >     unable to load shared library '/Library/Frameworks/R.framework/
> > > Versions/2.4/Resources/library/gtools/libs/i386/gtools.so':
> > >    dlopen(/Library/Frameworks/R.framework/Versions/2.4/Resources/
> > > library/gtools/libs/i386/gtools.so, 6): Library not loaded: /usr/
> > > local/gcc4.0/i686-apple-darwin8/lib/libgcc_s.1.0.dylib
> > >    Referenced from: /Library/Frameworks/R.framework/Versions/2.4/
> > > Resources/library/gtools/libs/i386/gtools.so
> > >    Reason: image not found
> > > Error: package/namespace load failed for 'gmodels'
> > >
> > > R.Version()
> > > $platform
> > > [1] "i386-apple-darwin8.8.1"
> > >
> > > $arch
> > > [1] "i386"
> > >
> > > $os
> > > [1] "darwin8.8.1"
> > >
> > > $system
> > > [1] "i386, darwin8.8.1"
> > >
> > > $status
> > > [1] ""
> > >
> > > $major
> > > [1] "2"
> > >
> > > $minor
> > > [1] "4.1"
> > >
> > > $year
> > > [1] "2006"
> > >
> > > $month
> > > [1] "12"
> > >
> > > $day
> > > [1] "18"
> > >
> > > $`svn rev`
> > > [1] "40228"
> > >
> > > $language
> > > [1] "R"
> > >
> > > $version.string
> > > [1] "R version 2.4.1 (2006-12-18)"
> > >
> > >
> > >
> > > ______________________________________________
> > > R-help at stat.math.ethz.ch mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-help
> > > PLEASE do read the posting guide http://www.R-project.org/posting-
> > > guide.html
> > > and provide commented, minimal, self-contained, reproducible code.
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Weiwei Shi, Ph.D
Research Scientist
GeneGO, Inc.

"Did you always know?"
"No, I did not. But I believed..."
---Matrix III


From helprhelp at gmail.com  Thu Apr 19 18:34:47 2007
From: helprhelp at gmail.com (Weiwei Shi)
Date: Thu, 19 Apr 2007 12:34:47 -0400
Subject: [Rd] [R] Error loading libraries in MAC
In-Reply-To: <200704190608.25274.sdavis2@mail.nih.gov>
References: <07A9CBD0-C0BF-4017-A56D-63DEDB90B55A@mail.rockefeller.edu>
	<5CCD3B76-5831-47AE-BAF4-1D1D72AF3F24@mac.com>
	<200704190608.25274.sdavis2@mail.nih.gov>
Message-ID: <cdf817830704190934g15016507k6b67f92f7f7af926@mail.gmail.com>

same here.

weiwei

On 4/19/07, Sean Davis <sdavis2 at mail.nih.gov> wrote:
> I'll chime in to note the same.  And just to add, sometimes restarting R seems
> to alleviate the problem....
>
> On Wednesday 18 April 2007 18:58, Gregory Warnes wrote:
> > I have received a number of reports of problems with recent unversal
> > Mac packages from CRAN when used with R 2.4.1.  Has something in the
> > build script changed?
> >
> > -G
> >
> > On Apr 18, 2007, at 4:49PM , Mayte Suarez-Farinas wrote:
> > > Hi I just installed the gmodels package
> > > and the installation was successful but when I was trying to load the
> > > library I got an error (see below).
> > > Interesting, yesterday I wrote to the maintainer of RSQLite apckage
> > > because I got the same error.
> > > Does somebody knows what is going on ??
> > >
> > > thanks,
> > > Mayte
> > >
> > >
> > > library(gmodels)
> > > Error in dyn.load(x, as.logical(local), as.logical(now)) :
> > >     unable to load shared library '/Library/Frameworks/R.framework/
> > > Versions/2.4/Resources/library/gtools/libs/i386/gtools.so':
> > >    dlopen(/Library/Frameworks/R.framework/Versions/2.4/Resources/
> > > library/gtools/libs/i386/gtools.so, 6): Library not loaded: /usr/
> > > local/gcc4.0/i686-apple-darwin8/lib/libgcc_s.1.0.dylib
> > >    Referenced from: /Library/Frameworks/R.framework/Versions/2.4/
> > > Resources/library/gtools/libs/i386/gtools.so
> > >    Reason: image not found
> > > Error: package/namespace load failed for 'gmodels'
> > >
> > > R.Version()
> > > $platform
> > > [1] "i386-apple-darwin8.8.1"
> > >
> > > $arch
> > > [1] "i386"
> > >
> > > $os
> > > [1] "darwin8.8.1"
> > >
> > > $system
> > > [1] "i386, darwin8.8.1"
> > >
> > > $status
> > > [1] ""
> > >
> > > $major
> > > [1] "2"
> > >
> > > $minor
> > > [1] "4.1"
> > >
> > > $year
> > > [1] "2006"
> > >
> > > $month
> > > [1] "12"
> > >
> > > $day
> > > [1] "18"
> > >
> > > $`svn rev`
> > > [1] "40228"
> > >
> > > $language
> > > [1] "R"
> > >
> > > $version.string
> > > [1] "R version 2.4.1 (2006-12-18)"
> > >
> > >
> > >
> > > ______________________________________________
> > > R-help at stat.math.ethz.ch mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-help
> > > PLEASE do read the posting guide http://www.R-project.org/posting-
> > > guide.html
> > > and provide commented, minimal, self-contained, reproducible code.
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Weiwei Shi, Ph.D
Research Scientist
GeneGO, Inc.

"Did you always know?"
"No, I did not. But I believed..."
---Matrix III


From Iago.Mosqueira at cefas.co.uk  Thu Apr 19 19:55:35 2007
From: Iago.Mosqueira at cefas.co.uk (Iago Mosqueira (Cefas))
Date: Thu, 19 Apr 2007 18:55:35 +0100
Subject: [Rd] setClass inside a function
In-Reply-To: <mailman.9.1176976803.13947.r-devel@r-project.org>
Message-ID: <40A15E1D8A76A949AF0271EF3133E1A9CF7E60@LOWEXPRESS.corp.cefas.co.uk>

Hello,

I would like to create a function that gets passed a class name and then calls setClass, and a few other functions, inside. I have done this in the past with setmethod, creating accessors for all slots in a set of S4 classes. But setClass is choking when my function is called isnide a package, telling about an error in exists(cname, where). I assume this to be a problem with the environment where the class is created. If I define my creator function in a package and load it, when I call it I get

Error in assign(mname, def, where): cannot add bindings to a locked environment

This does not happen if I redefine the creator function in my working environment.

I have attached an example of the kind of function below, and I am using R 2.5.0.

Where should I look for information on undertanding what might be going on here? Why does this way of working succeeds with setMethod but not setClass?

The intention here is to provide an easy way for creating extended classes that will inherit from a class already defined, instead of array as in the example.

Many thanks,


Iago


defineClass <- function(name, dimnames) {
	#  dim, names[2], dimnames[2]
	if(names(dimnames)[1] != 'iter')
		dimnames <- c(list(iter=1), dimnames)
	dim <- unlist(lapply(dimnames, length))

	#  validity
	foo <- "validity <- function(object) {"
	# foo <- c(foo, "browser()")
	foo <- c(foo, paste("if(all(names(dimnames(object)) != c('",
		paste(names(dimnames), collapse="','", sep=""), "')))", sep=""))
	foo <- c(foo, "stop(paste('dimnames are not correct for class', name))")
	foo <- c(foo, "return(TRUE)}")
	eval(parse(text=foo))

	#  setClass
	setClass(name, representation('array'),
    	prototype=prototype(array(as.numeric(NA), dim=dim, dimnames=dimnames), units='NA'),
		validity=validity, where=sys.parent(n=-2))

	# setValidity
	setValidity(name, validity)

	#  constructors
	eval(parse(text=paste("setGeneric('", name,
		"', function(object, ...) standardGeneric('", name, "'))", sep="")))

	setMethod(name, signature(object='ANY'),
		function(object, ...)
			return(FLPar(object, ..., class=name))
	)
	setMethod(name, signature(object='missing'),
		function(...) {
			return(FLPar(..., class=name))
		}
	)

}

---
Iago Mosqueira
Systems Modelling
Cefas
Pakefield Rd.
Lowestoft NR33 0HT
U.K.
Tel +44 (0) 1502 558003


***********************************************************************************
This email and any attachments are intended for the named re...{{dropped}}


From simon.urbanek at r-project.org  Thu Apr 19 20:17:56 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 19 Apr 2007 14:17:56 -0400
Subject: [Rd] printf capture
In-Reply-To: <46277D42.9080203@altk.com>
References: <461E02EE.7040105@altk.com>
	<Pine.LNX.4.64.0704121122480.26905@gannet.stats.ox.ac.uk>
	<461E3F8F.4050801@altk.com>
	<Pine.LNX.4.64.0704121558260.11792@gannet.stats.ox.ac.uk>
	<46277D42.9080203@altk.com>
Message-ID: <097DF923-E961-4707-B29C-81F3C85B9461@r-project.org>


On Apr 19, 2007, at 10:31 AM, mel wrote:

> Prof Brian Ripley a ?crit :
>
>> You can always link in a wrapper that defined printf and passes  
>> the arguments to Rprintf.
>
> I apologize but confess i didn't completely understand this  
> suggestion.
>

The wrapper:

#include <R.h>

int printf(const char *format, ...) {
   va_list (ap);
   va_start(ap, format);
   Rvprintf((char*)format, ap);
   va_end(ap);
   return 0;
}

If you link this in your project (simply create a separate object  
file with this), the project will be using Rprintf via this wrapper  
instead of printf from libc. Note that you shouldn't be relying on  
the return value literally, otherwise you're in trouble ;).

Cheers,
Simon

>> It's documented in 'Writing R Extensions'.
>>   The defines used for compatibility with @Sl{} sometimes causes
>>   conflicts (notably with Windows headers), and the known
>>   problematic defines can be removed by defining @code 
>> {STRICT_R_HEADERS}.
>
> Yes, i added
> #define STRICT_R_HEADERS
> in my cpp code, and the redefinition warning vanishes indeed.
>
> Many thanks for your precise tips and my apologies for the late  
> answer.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From simon.urbanek at r-project.org  Fri Apr 20 04:50:40 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 19 Apr 2007 22:50:40 -0400
Subject: [Rd] update on failing Mac packages in 2.4.1
Message-ID: <E57DD2DB-9859-438E-97C3-1EE3657E0E00@r-project.org>

This is about recent packages failing to load on Mac in R 2.4.1 with  
"unable to load shared library" errors:

The good news is that I found and fixed the problem, the bad news is  
that the build machine is slow and needs to re-build both R and the  
packages which will take some time. Expect most fixed packages to be  
online sometime tomorrow from the R.research.att.com site and  
correspondingly later on the mirrors. (R 2.5.0 is not affected and I  
encourage you to test the RC so bugs can be fixed before the release!!)

For those that missed the hot fix: install gcc4.0.3 from the full R  
2.4.1 installation image if you want the problem to go away  
immediately without re-installing packages. (Open the R 2.4.1 full  
image from CRAN, double-click on "Packages" and then "gcc4.0.3")

Cheers,
Simon

PS: I'm cross-posting this to R-devel, because people don't read the  
FAQ and don't look where they should - sorry about that.


From kushler at oakland.edu  Fri Apr 20 07:28:20 2007
From: kushler at oakland.edu (Robert Kushler)
Date: Fri, 20 Apr 2007 01:28:20 -0400
Subject: [Rd] problem with plot.lm
Message-ID: <46284F74.8090007@oakland.edu>


There is a problem with the "Constant Leverage" plot.  Try the following:

y <- c(8,9,7,9,6,9,5,9)
grp <- factor(rep(1:4,each=2),labels=c('A','B','C','D'))
mod <- lm(y ~ grp)
windows()
par(mfrow=c(2,2))
plot(mod)
# Plot 5 ("Constant Leverage") has X axis labels sorted
# by the fitted value (as advertised), but the data are
# still plotted in the original order.
# This occurs in R 2.4.1 and 2.5.0 RC for windows
# but not in earlier releases


From mel at altk.com  Fri Apr 20 12:09:56 2007
From: mel at altk.com (mel)
Date: Fri, 20 Apr 2007 12:09:56 +0200
Subject: [Rd] printf capture
In-Reply-To: <097DF923-E961-4707-B29C-81F3C85B9461@r-project.org>
References: <461E02EE.7040105@altk.com>
	<Pine.LNX.4.64.0704121122480.26905@gannet.stats.ox.ac.uk>
	<461E3F8F.4050801@altk.com>
	<Pine.LNX.4.64.0704121558260.11792@gannet.stats.ox.ac.uk>
	<46277D42.9080203@altk.com>
	<097DF923-E961-4707-B29C-81F3C85B9461@r-project.org>
Message-ID: <46289174.7090904@altk.com>

Simon Urbanek a ?crit :

> The wrapper:
> 
> #include <R.h>
> 
> int printf(const char *format, ...) {
>   va_list (ap);
>   va_start(ap, format);
>   Rvprintf((char*)format, ap);
>   va_end(ap);
>   return 0;
> }
> 
> If you link this in your project (simply create a separate object file 
> with this), the project will be using Rprintf via this wrapper instead 
> of printf from libc. Note that you shouldn't be relying on the return 
> value literally, otherwise you're in trouble ;).
> 
> Cheers,
> Simon

Thanks for the code.
The idea seems indeed interesting/appropriate for my needs.
I didn't remember at all that one could redefine
functions such as printf().
seems i need a good C/C++ brush up !
Thanks
Vincent


From mtmorgan at fhcrc.org  Fri Apr 20 18:20:33 2007
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Fri, 20 Apr 2007 09:20:33 -0700
Subject: [Rd] setClass inside a function
In-Reply-To: <40A15E1D8A76A949AF0271EF3133E1A9CF7E60@LOWEXPRESS.corp.cefas.co.uk>
	(Iago Mosqueira's message of "Thu, 19 Apr 2007 18:55:35 +0100")
References: <40A15E1D8A76A949AF0271EF3133E1A9CF7E60@LOWEXPRESS.corp.cefas.co.uk>
Message-ID: <6phirbr81bi.fsf@gopher4.fhcrc.org>

Hi Iago --

Here's my attempt at an answer.

"Iago Mosqueira (Cefas)" <Iago.Mosqueira at cefas.co.uk> writes:

> Hello,
>
> I would like to create a function that gets passed a class name and
> then calls setClass, and a few other functions, inside. I have done
> this in the past with setmethod, creating accessors for all slots in a
> set of S4 classes. But setClass is choking when my function is called
> isnide a package, telling about an error in exists(cname, where). I
> assume this to be a problem with the environment where the class is
> created. If I define my creator function in a package and load it,
> when I call it I get
>
> Error in assign(mname, def, where): cannot add bindings to a locked
> environment

You're trying to create a class in the package name space, and the
name space is locked (cannot be modified) after the package is
loaded. If your intention is programmatically generate static classes
(in a kind of macro-like way) then I think you could still use this
approach but ensure that the classes are created when the package is
loaded (e.g., by including a class creation function that is actually
evaluated, not just defined, in your package code). 

> This does not happen if I redefine the creator function in my working
> environment.

yes, here you are creating the class in the global environment, which
is not locked (!).

> I have attached an example of the kind of function below, and I am
> using R 2.5.0.
>
> Where should I look for information on undertanding what might be
> going on here? Why does this way of working succeeds with setMethod
> but not setClass?

I think that setMethod works because the methods package has already
created an environment within the appropriate name space (try 'ls(<pkg
name space>, all=TRUE)' and look at the '.__<etc>' bindings). What
setMethod does is modfies this environment, rather than the
environment of the name space.

Hope that helps, and is not too misleading.

Martin

> The intention here is to provide an easy way for creating extended
> classes that will inherit from a class already defined, instead of
> array as in the example.
>
> Many thanks,
>
>
> Iago
>
>
> defineClass <- function(name, dimnames) {
> 	# dim, names[2], dimnames[2]
> 	if(names(dimnames)[1] != 'iter')
> 		dimnames <- c(list(iter=1), dimnames)
> 	dim <- unlist(lapply(dimnames, length))
>
> 	# validity
> 	foo <- "validity <- function(object) {"
> 	# foo <- c(foo, "browser()")
> 	foo <- c(foo, paste("if(all(names(dimnames(object)) != c('",
> 		paste(names(dimnames), collapse="','", sep=""), "')))",
> sep=""))
> 	foo <- c(foo, "stop(paste('dimnames are not correct for class',
> name))")
> 	foo <- c(foo, "return(TRUE)}")
> 	eval(parse(text=foo))
>
> 	# setClass
> 	setClass(name, representation('array'),
>     	prototype=prototype(array(as.numeric(NA), dim=dim,
> dimnames=dimnames), units='NA'),
> 		validity=validity, where=sys.parent(n=-2))
>
> 	# setValidity
> 	setValidity(name, validity)
>
> 	# constructors
> 	eval(parse(text=paste("setGeneric('", name,
> 		"', function(object, ...) standardGeneric('", name, "'))",
> sep="")))
>
> 	setMethod(name, signature(object='ANY'),
> 		function(object, ...)
> 			return(FLPar(object, ..., class=name))
> 	)
> 	setMethod(name, signature(object='missing'),
> 		function(...) {
> 			return(FLPar(..., class=name))
> 		}
> 	)
>
> }
>
> --- Iago Mosqueira Systems Modelling Cefas Pakefield Rd.  Lowestoft
> NR33 0HT U.K.  Tel +44 (0) 1502 558003
>
>
> ***********************************************************************************
> This email and any attachments are intended for the named\...{{dropped}}


From Iago.Mosqueira at cefas.co.uk  Fri Apr 20 18:31:51 2007
From: Iago.Mosqueira at cefas.co.uk (Iago Mosqueira (Cefas))
Date: Fri, 20 Apr 2007 17:31:51 +0100
Subject: [Rd] setClass inside a function
In-Reply-To: <6phirbr81bi.fsf@gopher4.fhcrc.org>
Message-ID: <40A15E1D8A76A949AF0271EF3133E1A9CF7E6B@LOWEXPRESS.corp.cefas.co.uk>

Hi Martin,

Thanks very much for your help.

> 
> Hi Iago --
> 
> Here's my attempt at an answer.
> 
> "Iago Mosqueira (Cefas)" <Iago.Mosqueira at cefas.co.uk> writes:
> 
> > Hello,
> >
> > I would like to create a function that gets passed a class name and
> > then calls setClass, and a few other functions, inside. I have done
> > this in the past with setmethod, creating accessors for all 
> slots in a
> > set of S4 classes. But setClass is choking when my function 
> is called
> > isnide a package, telling about an error in exists(cname, where). I
> > assume this to be a problem with the environment where the class is
> > created. If I define my creator function in a package and load it,
> > when I call it I get
> >
> > Error in assign(mname, def, where): cannot add bindings to a locked
> > environment
> 
> You're trying to create a class in the package name space, and the
> name space is locked (cannot be modified) after the package is
> loaded. If your intention is programmatically generate static classes
> (in a kind of macro-like way) then I think you could still use this
> approach but ensure that the classes are created when the package is
> loaded (e.g., by including a class creation function that is actually
> evaluated, not just defined, in your package code). 

Yes, I have tried that. Inmediatly after the creator function is defined I use it to create a new class. And this class is exported in the package NAMESPACE. Still, it says the package environment is locked, although the call to setClass is part of the package.

> > This does not happen if I redefine the creator function in 
> my working
> > environment.
> 
> yes, here you are creating the class in the global environment, which
> is not locked (!).
> 
> > I have attached an example of the kind of function below, and I am
> > using R 2.5.0.
> >
> > Where should I look for information on undertanding what might be
> > going on here? Why does this way of working succeeds with setMethod
> > but not setClass?
> 
> I think that setMethod works because the methods package has already
> created an environment within the appropriate name space (try 'ls(<pkg
> name space>, all=TRUE)' and look at the '.__<etc>' bindings). What
> setMethod does is modfies this environment, rather than the
> environment of the name space.

Thanks very for this clarification.

> Hope that helps, and is not too misleading.

Not all, very helpful. Cheers,

Iago


> Martin
> 
> > The intention here is to provide an easy way for creating extended
> > classes that will inherit from a class already defined, instead of
> > array as in the example.
> >
> > Many thanks,
> >
> >
> > Iago
> >
> >
> > defineClass <- function(name, dimnames) {
> > 	# dim, names[2], dimnames[2]
> > 	if(names(dimnames)[1] != 'iter')
> > 		dimnames <- c(list(iter=1), dimnames)
> > 	dim <- unlist(lapply(dimnames, length))
> >
> > 	# validity
> > 	foo <- "validity <- function(object) {"
> > 	# foo <- c(foo, "browser()")
> > 	foo <- c(foo, paste("if(all(names(dimnames(object)) != c('",
> > 		paste(names(dimnames), collapse="','", sep=""), "')))",
> > sep=""))
> > 	foo <- c(foo, "stop(paste('dimnames are not correct for class',
> > name))")
> > 	foo <- c(foo, "return(TRUE)}")
> > 	eval(parse(text=foo))
> >
> > 	# setClass
> > 	setClass(name, representation('array'),
> >     	prototype=prototype(array(as.numeric(NA), dim=dim,
> > dimnames=dimnames), units='NA'),
> > 		validity=validity, where=sys.parent(n=-2))
> >
> > 	# setValidity
> > 	setValidity(name, validity)
> >
> > 	# constructors
> > 	eval(parse(text=paste("setGeneric('", name,
> > 		"', function(object, ...) standardGeneric('", 
> name, "'))",
> > sep="")))
> >
> > 	setMethod(name, signature(object='ANY'),
> > 		function(object, ...)
> > 			return(FLPar(object, ..., class=name))
> > 	)
> > 	setMethod(name, signature(object='missing'),
> > 		function(...) {
> > 			return(FLPar(..., class=name))
> > 		}
> > 	)
> >
> > }
> >
> > --- Iago Mosqueira Systems Modelling Cefas Pakefield Rd.  Lowestoft
> > NR33 0HT U.K.  Tel +44 (0) 1502 558003
> >
> >
> > 
> **************************************************************
> *********************
> > This email and any attachments are intended for the named
> > re...{{dropped}}
> >
> > ______________________________________________ R-devel at r-project.org
> > mailing list https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> -- 
> Martin Morgan
> Bioconductor / Computational Biology
> http://bioconductor.org
> 


***********************************************************************************
This email and any attachments are intended for the named re...{{dropped}}


From sfalcon at fhcrc.org  Fri Apr 20 19:56:15 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Fri, 20 Apr 2007 10:56:15 -0700
Subject: [Rd] infinite recursion when printing former S4 objects
Message-ID: <m2ps5zlykg.fsf@ziti.local>

Hello all,

An S4 class that contains matrix can be converted into a matrix using
as().  When the resulting object is printed implicitly at the command
line, all is well.  When print() is explicitly called, I see an
infinite recursion.

Here is an example:

## create a subclass of matrix
    > setClass("Foo", representation(name="character"), contains="matrix")
    [1] "Foo"

## test it out
    > f <- new("Foo", name="Sam", matrix())
    > z <- as(f, "matrix")
    > z
         [,1]
    [1,]   NA
    > print(z)
    Error: evaluation nested too deeply: infinite recursion / options(expressions=)?

An easy cut/paste version is below.  I'm seeing this with an R 2.5.0
beta.  I noticed that isS4(z) returns TRUE.  This may or may not be
surprising, but seems quite related to the issue at hand.


+ seth



## ----------------8<--------------8<-----------------------

setClass("Foo", representation(name="character"), contains="matrix")
f <- new("Foo", name="Sam", matrix())
f
m <- as(f, "matrix")
m
print(m)

## ----------------8<--------------8<-----------------------


-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From mtmorgan at fhcrc.org  Fri Apr 20 21:02:53 2007
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Fri, 20 Apr 2007 12:02:53 -0700
Subject: [Rd] setClass inside a function
In-Reply-To: <40A15E1D8A76A949AF0271EF3133E1A9CF7E6B@LOWEXPRESS.corp.cefas.co.uk>
	(Iago Mosqueira's message of "Fri, 20 Apr 2007 17:31:51 +0100")
References: <40A15E1D8A76A949AF0271EF3133E1A9CF7E6B@LOWEXPRESS.corp.cefas.co.uk>
Message-ID: <6ph1wie98de.fsf@gopher4.fhcrc.org>

"Iago Mosqueira (Cefas)" <Iago.Mosqueira at cefas.co.uk> writes:

> Hi Martin,
>
> Thanks very much for your help.
>
>> Hi Iago --
>> 
>> Here's my attempt at an answer.
>> 
>> "Iago Mosqueira (Cefas)" <Iago.Mosqueira at cefas.co.uk> writes:
>> 
>> > set of S4 classes. But setClass is choking when my function 
>> is called
>> > isnide a package, telling about an error in exists(cname, where). I
>> > assume this to be a problem with the environment where the class is
>> > created. If I define my creator function in a package and load it,
>> > when I call it I get
>> >
>> > Error in assign(mname, def, where): cannot add bindings to a locked
>> > environment
>> 
>> You're trying to create a class in the package name space, and the
>> name space is locked (cannot be modified) after the package is
>> loaded. If your intention is programmatically generate static classes
>> (in a kind of macro-like way) then I think you could still use this
>> approach but ensure that the classes are created when the package is
>> loaded (e.g., by including a class creation function that is actually
>> evaluated, not just defined, in your package code). 
>
> Yes, I have tried that. Inmediatly after the creator function is
> defined I use it to create a new class. And this class is exported
> in the package NAMESPACE. Still, it says the package environment is
> locked, although the call to setClass is part of the package.

Try removing the 'where' argument in setClass; or replacing it with
topenv(parent.frame()) -- the top environment when the package is
loaded is the name space.

Also, for fun,

>> > 	# validity
>> > 	foo <- "validity <- function(object) {"
>> > 	# foo <- c(foo, "browser()")
>> > 	foo <- c(foo, paste("if(all(names(dimnames(object)) != c('",
>> > 		paste(names(dimnames), collapse="','", sep=""), "')))",
>> > sep=""))
>> > 	foo <- c(foo, "stop(paste('dimnames are not correct for class',
>> > name))")
>> > 	foo <- c(foo, "return(TRUE)}")
>> > 	eval(parse(text=foo))

you can write something like

    validity <- function (object) {
        msg <- NULL
        cat("checking", name, "/", class(object), "validity\n")
        if (all(names(dimnames(object)) != c("iter", "y"))) 
            msg <- paste("dimnames are not correct for class", name)
        if (is.null(msg)) TRUE
        else msg
    }

and continue to include validity=validity in setClass. This will use
R's lexical scope to figure out the correct name, etc for each class
created. Note also that the idea is that the validity function either
returns TRUE or a character string, not itself calling 'stop'.

>> > 	# constructors
>> > 	eval(parse(text=paste("setGeneric('", name,
>> > 		"', function(object, ...) standardGeneric('", 
>> name, "'))",
>> > sep="")))

I had expected that

    setGeneric(name,
               function(object, ...) standardGeneric(name))

would work, but apparently not. This might be a bit cleaner way to
create complcated substitutions;

    eval(substitute({
        setGeneric(NAME,
                   function(object, ...) {
                       standardGeneric(NAME)
                   })
        }, list(NAME=name)))

>> > 	setMethod(name, signature(object='missing'),
>> > 		function(...) {
>> > 			return(FLPar(..., class=name))
>> > 		}
>> > 	)

It's a bit surprising that this setMethod works, as the function
signature is different from the generic. This might cause problems
further down the line. I would have thought that the correct
formulation would be along the lines of

    setMethod(name, signature(object='missing'),
              function(object, ...) {
                  FLPar(..., class=name)
              })

Martin
-- 
Martin Morgan
Bioconductor / Computational Biology
http://bioconductor.org


From brech at delphioutpost.com  Thu Apr 19 17:03:06 2007
From: brech at delphioutpost.com (brech at delphioutpost.com)
Date: Thu, 19 Apr 2007 17:03:06 +0200 (CEST)
Subject: [Rd] qr.coef: permutes dimnames; inserts NA;
	promises minimum-length (PR#9623)
Message-ID: <20070419150306.ACDD362640@slim.kubism.ku.dk>

Full_Name: Christian Brechbuehler
Version: 2.4.1 Patched (2007-03-25 r40917)
OS: Linux 2.6.15-27-adm64-xeon; Ubuntu 6.06.1 LTS
Submission from: (NULL) (24.61.47.236)


Splus and R have different ideas about what qr.coef(qr()) should return,
which is fine... but I believe that R has a bug in that it is not
internally consistent, and another separate bug in the documentation. 

In particular, on this problem, Splus generates a permuted solution
vector:

Splus 6.2.1:
    > A <- matrix(c(0,0,0, 1,1,1), nrow=3,dimnames=list(NULL, c("zero",
"one")))
    > A
         zero one 
    [1,]    0   1
    [2,]    0   1
    [3,]    0   1
    > y <- matrix(c(6,7,8), nrow=3, dimnames=list(NULL, "y"))
    > y
         y 
    [1,] 6
    [2,] 7
    [3,] 8
    > x <- qr.coef(qr(A), y)
    > x
         y 
     one 7
    zero 0
    > 
    
To my taste, the answer from Splus is unexpected; I was looking for
this:
    
    > x[qr(A)$pivot,,drop=F]
         y 
    zero 0
     one 7

But at least the answer is internally consistent: the values and the
row names were scrambled in corresponding ways.

However, R seems to helpfully un-permute the data values, but forgets
to un-permute the dimnames, which seems broken.  

R version 2.4.1 Patched (2007-03-25 r40917)
    > A <- matrix(c(0,0,0, 1,1,1), nrow=3,dimnames=list(NULL, c("zero",
"one")))
    > y <- matrix(c(6,7,8), nrow=3, dimnames=list(NULL, "y"))
    > x <- qr.coef(qr(A), y)
    > x
          y
    one  NA
    zero  7
    
I think the answer from qr.coef() should look more like this:

    > x.wanted
          y
    zero NA
    one   7
    > 

In addition, R uses NA to fill in rather than zero.  NA for this
problem above might mean "undefined": any value will do.  But given
the application of this function, where the solution might be
multiplied by the matrix, any NA will cause that to turn into an NA
result... in math, zero times anything is zero, but in R, NA times
anything (even zero) is NA.  This seems somewhat inconvenient.  So I'd really
like
R to return this:

    > x
          y
    zero  0
    one   7

More on the scrambling; I see in dqrsl.f that:

c               if pivoting was requested in dqrdc, the j-th
c               component of b will be associated with column jpvt(j)
c               of the original matrix x that was input into dqrdc.)

which I think is referring to the helpful un-permuting, but I think
qr.coef() in R needs to correspondingly un-permute the dimnames as
well?

  Code from qr.coef: 
    if (!is.null(nam <- colnames(qr$qr))) 
        rownames(coef) <- nam
  Proposed fix: That second line could be changed to
        rownames(coef)[qr$pivot] <- nam


Another issue (either with the documentation or the code) is as follows.
In R, help(qr) promises:
   
   'solve.qr' is the method for 'solve' for 'qr' objects. 'qr.solve'
   solves systems of equations via the QR decomposition: if 'a' is a
   QR decomposition it is the same as 'solve.qr', but if 'a' is a
   rectangular matrix the QR decomposition is computed first.  Either
   will handle over- and under-determined systems, providing a
   minimal-length solution or a least-squares fit if appropriate.
   
So unlike Splus, R promises a minimal-length solution, but I don't
think it delivers that.  For example, let's get the minimal-length
solution for the following under-determined system:
   
     x1 + 2*x2  ==  5
   
qr.solve would fail due to the singular matrix, so use qr.coef:
   
     > qr.coef(qr(t(1:2)),c(5))
   
   R:
     [1]  5 NA
   
   Splus:
     [1] 5 0
   
1*5 + 2*0 does equal 5, so modulo NA, this is a solution, but it is
NOT minimal-length.  OTOH, svd gives the right answer in both Splus and
R:
   
     > d <- svd(t(1:2));  c(5) %*% d$u %*% diag(1/d$d, length(d$d)) %*% t(d$v)
          [,1] [,2]
     [1,]    1    2
   
This *is* minimum length, and 1*1 + 2*2 == 5.  So either qr.coef(qr())
should deliver that, or the documentation should clarify when a
minimal-length solution is delivered?

And revisiting the NA issue... in this problem, for the qr.coef()
result to be a solution, that 2nd value MUST be zero, no other values
will work.  So the NA seems wrong here, more clearly than in the other
example.

Finally, a simpler test case that shows the same issues with a 2x1
example instead of 2x3; any fix to qr.coef() should handle this as
well:

> qr.coef(qr(matrix(0:1,1,dimnames=list(NULL, c("zero","one")))),5)
 one zero 
  NA    5 

I think that should return:

 zero  one
    0    5 

or at least:

 zero  one
   NA    5


From watplatt at us.ibm.com  Thu Apr 19 19:42:17 2007
From: watplatt at us.ibm.com (Daniel Platt)
Date: Thu, 19 Apr 2007 13:42:17 -0400
Subject: [Rd] AIX testers needed
In-Reply-To: <Pine.LNX.4.64.0703290708120.17596@gannet.stats.ox.ac.uk>
Message-ID: <OF29390B16.AEB68FC4-ON852572C2.00604A44-852572C2.00614495@us.ibm.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070419/fc3c814c/attachment.pl 

From mckellercran at gmail.com  Thu Apr 19 22:54:54 2007
From: mckellercran at gmail.com (Matthew Keller)
Date: Thu, 19 Apr 2007 16:54:54 -0400
Subject: [Rd] [R] Error loading libraries in MAC
In-Reply-To: <5CCD3B76-5831-47AE-BAF4-1D1D72AF3F24@mac.com>
References: <07A9CBD0-C0BF-4017-A56D-63DEDB90B55A@mail.rockefeller.edu>
	<5CCD3B76-5831-47AE-BAF4-1D1D72AF3F24@mac.com>
Message-ID: <3f547caa0704191354r7ac6beabl4da392df8a9e2f80@mail.gmail.com>

HI Mayte & Gregory,

This is probably a question needing to be posted to r-sig-mac. A
search for this problem on that forum turns up lots of hits. I think
everyone is having these problems (which makes me pause about whether
to switch to Mac, given how much I use R). Below is a message from the
r-sig-mac forum from R/Mac guru Simon Urbanek:


Simon Urbanek  to Byron, r-sig-mac
 show details  9:53 am (6 hours ago)


On Apr 19, 2007, at 5:47 AM, Byron Ellis wrote:

> Actually it appears that a variety of packages are doing this
> (gtools did it to me earlier today). Looks like there may be a
> general compilation change, perhaps in preparation for 2.5?
>


Yes, indeed, R 2.5.0 doesn't need the 4.0.3 compilers anymore and
thus no path changes. Unfortunately this seems to have influenced the
2.4 builds process. A hot fix is to install gcc4.0.3 from the full
image of R 2.4.1 (open the installation image, click on "Packages"
and then "gcc4.0.3" to install) or to use R 2.5.0 RC instead. I'll
see if I can find the culprit in the meantime...


On 4/18/07, Gregory Warnes <gregory.warnes at mac.com> wrote:
> I have received a number of reports of problems with recent unversal
> Mac packages from CRAN when used with R 2.4.1.  Has something in the
> build script changed?
>
> -G
>
>
> On Apr 18, 2007, at 4:49PM , Mayte Suarez-Farinas wrote:
>
> > Hi I just installed the gmodels package
> > and the installation was successful but when I was trying to load the
> > library I got an error (see below).
> > Interesting, yesterday I wrote to the maintainer of RSQLite apckage
> > because I got the same error.
> > Does somebody knows what is going on ??
> >
> > thanks,
> > Mayte
> >
> >
> > library(gmodels)
> > Error in dyn.load(x, as.logical(local), as.logical(now)) :
> >       unable to load shared library '/Library/Frameworks/R.framework/
> > Versions/2.4/Resources/library/gtools/libs/i386/gtools.so':
> >    dlopen(/Library/Frameworks/R.framework/Versions/2.4/Resources/
> > library/gtools/libs/i386/gtools.so, 6): Library not loaded: /usr/
> > local/gcc4.0/i686-apple-darwin8/lib/libgcc_s.1.0.dylib
> >    Referenced from: /Library/Frameworks/R.framework/Versions/2.4/
> > Resources/library/gtools/libs/i386/gtools.so
> >    Reason: image not found
> > Error: package/namespace load failed for 'gmodels'
> >
> > R.Version()
> > $platform
> > [1] "i386-apple-darwin8.8.1"
> >
> > $arch
> > [1] "i386"
> >
> > $os
> > [1] "darwin8.8.1"
> >
> > $system
> > [1] "i386, darwin8.8.1"
> >
> > $status
> > [1] ""
> >
> > $major
> > [1] "2"
> >
> > $minor
> > [1] "4.1"
> >
> > $year
> > [1] "2006"
> >
> > $month
> > [1] "12"
> >
> > $day
> > [1] "18"
> >
> > $`svn rev`
> > [1] "40228"
> >
> > $language
> > [1] "R"
> >
> > $version.string
> > [1] "R version 2.4.1 (2006-12-18)"
> >
> >>
> >
> > ______________________________________________
> > R-help at stat.math.ethz.ch mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide http://www.R-project.org/posting-
> > guide.html
> > and provide commented, minimal, self-contained, reproducible code.
>
> ______________________________________________
> R-help at stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>


-- 
Matthew C Keller
Postdoctoral Fellow
Virginia Institute for Psychiatric and Behavioral Genetics


From deepayan.sarkar at gmail.com  Fri Apr 20 23:46:33 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Fri, 20 Apr 2007 14:46:33 -0700
Subject: [Rd] dendrogram definition
Message-ID: <eb555e660704201446j58dd4cb2p6efb5d389c0a010f@mail.gmail.com>

Hi,

I'm trying to create a "grob" representing a dendrogram object (for
use as a legend with lattice), and I have a question regarding how a
"dendrogram" should be interpreted. Are they by definition binary
trees or can they in principle have more than two children?

-Deepayan


From simon.urbanek at r-project.org  Sat Apr 21 03:21:28 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 20 Apr 2007 21:21:28 -0400
Subject: [Rd] [R] Error loading libraries in MAC
In-Reply-To: <3f547caa0704191354r7ac6beabl4da392df8a9e2f80@mail.gmail.com>
References: <07A9CBD0-C0BF-4017-A56D-63DEDB90B55A@mail.rockefeller.edu>
	<5CCD3B76-5831-47AE-BAF4-1D1D72AF3F24@mac.com>
	<3f547caa0704191354r7ac6beabl4da392df8a9e2f80@mail.gmail.com>
Message-ID: <D1CD5656-0D7E-4B56-8F4B-6F916C8562BB@r-project.org>

On Apr 19, 2007, at 4:54 PM, Matthew Keller wrote:

> HI Mayte & Gregory,
>
> This is probably a question needing to be posted to r-sig-mac. A  
> search for this problem on that forum turns up lots of hits. I  
> think everyone is having these problems (which makes me pause about  
> whether to switch to Mac, given how much I use R).

Sorry about that - it shouldn't make you pause as it was just a  
glitch in my build script because we changed compilers for the  
upcoming R 2.5.0 release.

It's all fixed now, the updated packages are on the master machine  
and should spread through the mirrors as we speak. (For those  
impatient, you can use http://r.research.att.com as a mirror to get  
the updated packages right now).

Cheers,
Simon

PS: To all: for Mac-related issues, please, always use R-SIG-Mac -  
read it and post there if you have problems. I usually try to respond  
ASAP.


> On Apr 19, 2007, at 5:47 AM, Byron Ellis wrote:
>
>> Actually it appears that a variety of packages are doing this
>> (gtools did it to me earlier today). Looks like there may be a
>> general compilation change, perhaps in preparation for 2.5?
>>
>
>
> Yes, indeed, R 2.5.0 doesn't need the 4.0.3 compilers anymore and
> thus no path changes. Unfortunately this seems to have influenced the
> 2.4 builds process. A hot fix is to install gcc4.0.3 from the full
> image of R 2.4.1 (open the installation image, click on "Packages"
> and then "gcc4.0.3" to install) or to use R 2.5.0 RC instead. I'll
> see if I can find the culprit in the meantime...
>
>
> On 4/18/07, Gregory Warnes <gregory.warnes at mac.com> wrote:
>> I have received a number of reports of problems with recent unversal
>> Mac packages from CRAN when used with R 2.4.1.  Has something in the
>> build script changed?
>>
>> -G
>>
>>
>> On Apr 18, 2007, at 4:49PM , Mayte Suarez-Farinas wrote:
>>
>>> Hi I just installed the gmodels package
>>> and the installation was successful but when I was trying to load  
>>> the
>>> library I got an error (see below).
>>> Interesting, yesterday I wrote to the maintainer of RSQLite apckage
>>> because I got the same error.
>>> Does somebody knows what is going on ??
>>>
>>> thanks,
>>> Mayte
>>>
>>>
>>> library(gmodels)
>>> Error in dyn.load(x, as.logical(local), as.logical(now)) :
>>>       unable to load shared library '/Library/Frameworks/ 
>>> R.framework/
>>> Versions/2.4/Resources/library/gtools/libs/i386/gtools.so':
>>>    dlopen(/Library/Frameworks/R.framework/Versions/2.4/Resources/
>>> library/gtools/libs/i386/gtools.so, 6): Library not loaded: /usr/
>>> local/gcc4.0/i686-apple-darwin8/lib/libgcc_s.1.0.dylib
>>>    Referenced from: /Library/Frameworks/R.framework/Versions/2.4/
>>> Resources/library/gtools/libs/i386/gtools.so
>>>    Reason: image not found
>>> Error: package/namespace load failed for 'gmodels'
>>>
>>> R.Version()
>>> $platform
>>> [1] "i386-apple-darwin8.8.1"
>>>
>>> $arch
>>> [1] "i386"
>>>
>>> $os
>>> [1] "darwin8.8.1"
>>>
>>> $system
>>> [1] "i386, darwin8.8.1"
>>>
>>> $status
>>> [1] ""
>>>
>>> $major
>>> [1] "2"
>>>
>>> $minor
>>> [1] "4.1"
>>>
>>> $year
>>> [1] "2006"
>>>
>>> $month
>>> [1] "12"
>>>
>>> $day
>>> [1] "18"
>>>
>>> $`svn rev`
>>> [1] "40228"
>>>
>>> $language
>>> [1] "R"
>>>
>>> $version.string
>>> [1] "R version 2.4.1 (2006-12-18)"
>>>
>>>>
>>>
>>> ______________________________________________
>>> R-help at stat.math.ethz.ch mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>> PLEASE do read the posting guide http://www.R-project.org/posting-
>>> guide.html
>>> and provide commented, minimal, self-contained, reproducible code.
>>
>> ______________________________________________
>> R-help at stat.math.ethz.ch mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide http://www.R-project.org/posting- 
>> guide.html
>> and provide commented, minimal, self-contained, reproducible code.
>>
>
>
> -- 
> Matthew C Keller
> Postdoctoral Fellow
> Virginia Institute for Psychiatric and Behavioral Genetics
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From jmc at r-project.org  Sun Apr 22 00:08:14 2007
From: jmc at r-project.org (John Chambers)
Date: Sat, 21 Apr 2007 15:08:14 -0700
Subject: [Rd] infinite recursion when printing former S4 objects
In-Reply-To: <m2ps5zlykg.fsf@ziti.local>
References: <m2ps5zlykg.fsf@ziti.local>
Message-ID: <462A8B4E.9000101@r-project.org>

Classes that contain "matrix" are trouble.  Matrix objects are, well, 
weird.  They look like they should be S3 classes but the object bit is 
not turned on and they have no class attribute.   They seem to be 
recognized by much internal code on the basis of the "dim" attribute, so 
they appear to dispatch S3 methods, for example.

They've been allowed as a data part in S4 class definitions, but it 
seems that we should perhaps retract that, unless it can be made to work 
reliably, which may not be possible without changing the semantics of 
matrix objects.

The problems with class "Foo" are not just with printing.  For example:

 > setClass("Foo", representation(name="character"), contains="matrix")
[1] "Foo"
 > x = new("Foo", 1:12)
Error: evaluation nested too deeply: infinite recursion / 
options(expressions=)?

A little investigation pins this one down to as(x, "vector") <-

Aside from these really nasty features, there is a problem with 
containing S3 classes in general, because the S3 dispatch can't 
recognize the new class as inheriting from the S3 class.  For example:

 > bar = function(x)UseMethod("bar")
 > bar.matrix = function(x)"Matrix bar"
 > mm = matrix(1:12,3,4)
 > bar(mm)
[1] "Matrix bar"
 > mF = new("Foo", mm)
 > bar(mF)
Error in bar(mF) : no applicable method for "bar"
 > is.matrix(mF)
[1] TRUE

I do agree that the S4 bit should be turned off when an object drops 
down to having no class--it's something that doesn't seem to cause the 
same problems with inheritance from other basic data classes, though:

 > setClass("c2", representation(name = "character"), contains = "numeric")
[1] "c2"
 > cc = new("c2", 1:12)
 > as(cc, "numeric")
 [1]  1  2  3  4  5  6  7  8  9 10 11 12
 > cn = as(cc,"numeric")
 > class(cn)
[1] "integer"
 > attr(cn, "class")
NULL
 > isS4(cn)
[1] TRUE
 > print(cn)
 [1]  1  2  3  4  5  6  7  8  9 10 11 12

John

Seth Falcon wrote:
> Hello all,
>
> An S4 class that contains matrix can be converted into a matrix using
> as().  When the resulting object is printed implicitly at the command
> line, all is well.  When print() is explicitly called, I see an
> infinite recursion.
>
> Here is an example:
>
> ## create a subclass of matrix
>     > setClass("Foo", representation(name="character"), contains="matrix")
>     [1] "Foo"
>
> ## test it out
>     > f <- new("Foo", name="Sam", matrix())
>     > z <- as(f, "matrix")
>     > z
>          [,1]
>     [1,]   NA
>     > print(z)
>     Error: evaluation nested too deeply: infinite recursion / options(expressions=)?
>
> An easy cut/paste version is below.  I'm seeing this with an R 2.5.0
> beta.  I noticed that isS4(z) returns TRUE.  This may or may not be
> surprising, but seems quite related to the issue at hand.
>
>
> + seth
>
>
>
> ## ----------------8<--------------8<-----------------------
>
> setClass("Foo", representation(name="character"), contains="matrix")
> f <- new("Foo", name="Sam", matrix())
> f
> m <- as(f, "matrix")
> m
> print(m)
>
> ## ----------------8<--------------8<-----------------------
>
>
>


From nakama at ki.rim.or.jp  Sun Apr 22 00:38:42 2007
From: nakama at ki.rim.or.jp (Ei-ji Nakama)
Date: Sun, 22 Apr 2007 07:38:42 +0900
Subject: [Rd] AIX testers needed
In-Reply-To: <OF29390B16.AEB68FC4-ON852572C2.00604A44-852572C2.00614495@us.ibm.com>
References: <Pine.LNX.4.64.0703290708120.17596@gannet.stats.ox.ac.uk>
	<OF29390B16.AEB68FC4-ON852572C2.00604A44-852572C2.00614495@us.ibm.com>
Message-ID: <dc41e1260704211538x7efbd5e8mf79587be669c87b5@mail.gmail.com>

Hi,
Thank you for the test.
What did the compiler use?

I am making the  wrapper that uses iconv of AIX.
However, there is still an bug...


2007/4/20, Daniel Platt <watplatt at us.ibm.com>:
> Hi,
>
> The build worked smoothly.
>
> 'install.packages("e1071")' worked correctly (this used to crash on the
> only version I had managed to build before).
>
> I have noticed that there are a lot of permissions that I had to check
> after I did a "make install" .
>
> "make check" failed with the following message:
>
> watplatt at haplo.watson.ibm.com:/geno4/watplatt/R/R-rc $ make check
> make[1]: Entering directory `/geno4/watplatt/R/R-rc/tests'
> make[2]: Entering directory `/geno4/watplatt/R/R-rc/tests'
> make[3]: Entering directory `/geno4/watplatt/R/R-rc/tests/Examples'
> make[4]: Entering directory `/geno4/watplatt/R/R-rc/tests/Examples'
> make[4]: `Makedeps' is up to date.
> make[4]: Leaving directory `/geno4/watplatt/R/R-rc/tests/Examples'
> make[4]: Entering directory `/geno4/watplatt/R/R-rc/tests/Examples'
> running code in 'base-Ex.R' ...make[4]: *** [base-Ex.Rout] Error 1
> make[4]: Leaving directory `/geno4/watplatt/R/R-rc/tests/Examples'
> make[3]: *** [test-Examples-Base] Error 2
> make[3]: Leaving directory `/geno4/watplatt/R/R-rc/tests/Examples'
> make[2]: *** [test-Examples] Error 2
> make[2]: Leaving directory `/geno4/watplatt/R/R-rc/tests'
> make[1]: *** [test-all-basics] Error 1
> make[1]: Leaving directory `/geno4/watplatt/R/R-rc/tests'
> make: *** [check] Error 2
> watplatt at haplo.watson.ibm.com:/geno4/watplatt/R/R-rc $
>
> The log file indicates the error is due to iconv not being available on
> the system.  (Specifically, configure would not run without the iconv flag
> being set to "no").
>
> Dan
>
> Daniel E. Platt
> Bioinformatics and Pattern Discovery
> IBM T. J. Watson Research Center
> Yorktown Hgts, NY 10598
> (914)945-1388
>
>
>
> Prof Brian Ripley <ripley at stats.ox.ac.uk>
> 03/29/2007 02:27 AM
>
> To
> R-devel at R-project.org
> cc
> Matthew Beason <mbeason at harrahs.com>, Tiong Lim <t.lim at auckland.ac.nz>,
> "Sheth, Jagat K" <jagat.k.sheth at citigroup.com>, kamil Marcinkowski
> <kamil at ualberta.ca>, Eric Harley <ericctharley at gmail.com>, Roy Heimbach
> <royh at hpc.unm.edu>, Daniel Platt/Watson/IBM at IBMUS
> Subject
> AIX testers needed
>
>
>
>
>
>
> With much thanks to Ei-ji Nakama, R 2.5.0 alpha supports building on AIX
> (at least AIX 5.2 on one system).
>
> Would anyone able to test this please get the latest tarball from
>
> http://cran.r-project.org/src/base-prerelease/R-latest.tar.gz
>
> and try installing (after reading the AIX notes in R-admin.html section
> C.9).
>
> In particular it would be very helpful to know if
>
> 1) --enable-BLAS-shlib works (it is the default everywhere except AIX and
> Darwin)
>
> 2) if people succeed in installing GNU libiconv and building without
> needing --without-iconv.
>
> I am Cc:ing all the people I tracked down who reported attempted AIX
> installations in 2006 in the hope that they may still be interested.
>
> Please report success and any hints or problems in the R-devel list.
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>


-- 
EI-JI Nakama  <nakama at ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb"  <nakama at ki.rim.or.jp>


From pdmmac at mcmaster.ca  Sun Apr 22 05:19:20 2007
From: pdmmac at mcmaster.ca (pdmmac at mcmaster.ca)
Date: Sun, 22 Apr 2007 05:19:20 +0200 (CEST)
Subject: [Rd] dput/dget when a data frame has 2 rows (PR#9627)
Message-ID: <20070422031920.BD4205ABBE@slim.kubism.ku.dk>

This doesn't seem right; I'm using R version 2.4.1 (2006-12-18) on Mac OS
and Win XP and find the same issue:

> mydataframe <- data.frame(ppi=c(.5,.5),mmu=c(5,10))
> dput(mydataframe,"mydataframe.txt")
> dget("mydataframe.txt")
Error in attributes(.Data) <- c(attributes(.Data), attrib) :
    row names must be 'character' or 'integer', not 'double'
> mydataframe3 <- data.frame(ppi=c(.5,.5,.5),mmu=c(5,10,15))
> dput(mydataframe3,"mydataframe3.txt")
> dget("mydataframe3.txt")
  ppi mmu
1 0.5   5
2 0.5  10
3 0.5  15


-- 
 Peter D.M. Macdonald, D.Phil., P.Stat.
 Professor of Math & Statistics
 McMaster University
 Hamilton, Ontario, Canada L8S 4K1


From wangtong at usc.edu  Mon Apr 23 06:21:08 2007
From: wangtong at usc.edu (Tong Wang)
Date: Sun, 22 Apr 2007 21:21:08 -0700
Subject: [Rd] How to debug C code running in R
Message-ID: <dde9f9a92244a.462bd1c4@usc.edu>

Hi,
    I am in the situation where I could get my code run correctly under GNU C, but it produced different (strange) results
while running in R . ( I use .C to call the function).   May I get some general advice on how could I do step by step debug
of source code in R ?

Thanks


From ripley at stats.ox.ac.uk  Mon Apr 23 09:30:13 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon, 23 Apr 2007 09:30:13 +0200 (CEST)
Subject: [Rd] dput/dget when a data frame has 2 rows (PR#9627)
Message-ID: <20070423073013.B949A5A7F4@slim.kubism.ku.dk>

It is right.

The problem is that dput() does not give a faithful representation, as its 
help says.  R 2.5.0 does a better job, since the defaults for dput() have 
been changed, enough so that your example works there.


On Sun, 22 Apr 2007, pdmmac at mcmaster.ca wrote:

> This doesn't seem right; I'm using R version 2.4.1 (2006-12-18) on Mac OS
> and Win XP and find the same issue:
>
>> mydataframe <- data.frame(ppi=c(.5,.5),mmu=c(5,10))
>> dput(mydataframe,"mydataframe.txt")
>> dget("mydataframe.txt")
> Error in attributes(.Data) <- c(attributes(.Data), attrib) :
>    row names must be 'character' or 'integer', not 'double'
>> mydataframe3 <- data.frame(ppi=c(.5,.5,.5),mmu=c(5,10,15))
>> dput(mydataframe3,"mydataframe3.txt")
>> dget("mydataframe3.txt")
>  ppi mmu
> 1 0.5   5
> 2 0.5  10
> 3 0.5  15
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Mon Apr 23 09:33:08 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 23 Apr 2007 08:33:08 +0100 (BST)
Subject: [Rd] How to debug C code running in R
In-Reply-To: <dde9f9a92244a.462bd1c4@usc.edu>
References: <dde9f9a92244a.462bd1c4@usc.edu>
Message-ID: <Pine.LNX.4.64.0704230830010.22687@gannet.stats.ox.ac.uk>

You haven't told us your OS (as asked for in the posting guide).  But

Writing R Extensions section 4.4
rw-FAQ Q8.4

both appear to give the instructions you are asking for.

On Sun, 22 Apr 2007, Tong Wang wrote:

> Hi,

>    I am in the situation where I could get my code run correctly under 
> GNU C, but it produced different (strange) results while running in R . 
> ( I use .C to call the function).  May I get some general advice on how 
> could I do step by step debug of source code in R ?
>
> Thanks

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From friedrich.leisch at stat.uni-muenchen.de  Mon Apr 23 10:29:09 2007
From: friedrich.leisch at stat.uni-muenchen.de (Friedrich Leisch)
Date: Mon, 23 Apr 2007 10:29:09 +0200
Subject: [Rd] dendrogram definition
In-Reply-To: <eb555e660704201446j58dd4cb2p6efb5d389c0a010f@mail.gmail.com>
References: <eb555e660704201446j58dd4cb2p6efb5d389c0a010f@mail.gmail.com>
Message-ID: <17964.28245.673639.140342@lxh5.stat.uni-muenchen.de>

>>>>> On Fri, 20 Apr 2007 14:46:33 -0700,
>>>>> Deepayan Sarkar (DS) wrote:

  > Hi,
  > I'm trying to create a "grob" representing a dendrogram object (for
  > use as a legend with lattice), and I have a question regarding how a
  > "dendrogram" should be interpreted. Are they by definition binary
  > trees or can they in principle have more than two children?

They can have more than 2 children, and class "dendrogram" supports
this. However, as most trees are currently created using hclust, all
examples have binary trees.

E.g.,

example(dendrogram)
d3e[[3]]=d3e
attr(d3e,"members")=14
str(d3e)

creates a tree with three branches in the root node (not all
attributes are correct after that brute force operation, so plots will
not look as nice as possible).

Best,
Fritz


From murdoch at stats.uwo.ca  Mon Apr 23 12:44:25 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 23 Apr 2007 06:44:25 -0400
Subject: [Rd] How to debug C code running in R
In-Reply-To: <dde9f9a92244a.462bd1c4@usc.edu>
References: <dde9f9a92244a.462bd1c4@usc.edu>
Message-ID: <462C8E09.6060103@stats.uwo.ca>

On 4/23/2007 12:21 AM, Tong Wang wrote:
> Hi,
>     I am in the situation where I could get my code run correctly under GNU C, but it produced different (strange) results
> while running in R . ( I use .C to call the function).   May I get some general advice on how could I do step by step debug
> of source code in R ?

There's a chapter on debugging in Writing R Extensions, with specific 
advice for compiled code.  I also put together a web page of mostly 
Windows-specific advice, at

http://www.stats.uwo.ca/faculty/murdoch/software/debuggingR

Duncan Murdoch


From ligges at statistik.uni-dortmund.de  Mon Apr 23 14:41:40 2007
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Mon, 23 Apr 2007 14:41:40 +0200
Subject: [Rd] R RC: make all
Message-ID: <462CA984.8060301@statistik.uni-dortmund.de>

Looks like
   make all
does not imply
   make recommended
in the RC version of R-2.5.0 ...

Uwe


From P.Dalgaard at biostat.ku.dk  Mon Apr 23 14:51:12 2007
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Mon, 23 Apr 2007 14:51:12 +0200
Subject: [Rd] R RC: make all
In-Reply-To: <462CA984.8060301@statistik.uni-dortmund.de>
References: <462CA984.8060301@statistik.uni-dortmund.de>
Message-ID: <462CABC0.6060303@biostat.ku.dk>

Uwe Ligges wrote:
> Looks like
>    make all
> does not imply
>    make recommended
> in the RC version of R-2.5.0 ...
>
> Uwe
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   
Eh? What makes you say that?


all: Makefile Makeconf R docs recommended
recommended: @USE_RECOMMENDED_PACKAGES_TRUE@ stamp-recommended


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Mon Apr 23 14:58:01 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 23 Apr 2007 13:58:01 +0100 (BST)
Subject: [Rd] R RC: make all
In-Reply-To: <462CA984.8060301@statistik.uni-dortmund.de>
References: <462CA984.8060301@statistik.uni-dortmund.de>
Message-ID: <Pine.LNX.4.64.0704231355580.14330@gannet.stats.ox.ac.uk>

On Mon, 23 Apr 2007, Uwe Ligges wrote:

> Looks like
>   make all
> does not imply
>   make recommended
> in the RC version of R-2.5.0 ...

It never did on Windows, seems still to on Unix (I've just tested it 
under our Intel compilers, newly updated so they work again on Fedora Core 
5).

Brian

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ligges at statistik.uni-dortmund.de  Mon Apr 23 15:05:52 2007
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Mon, 23 Apr 2007 15:05:52 +0200
Subject: [Rd] R RC: make all
In-Reply-To: <462CABC0.6060303@biostat.ku.dk>
References: <462CA984.8060301@statistik.uni-dortmund.de>
	<462CABC0.6060303@biostat.ku.dk>
Message-ID: <462CAF30.5030602@statistik.uni-dortmund.de>

Peter Dalgaard wrote:
> Uwe Ligges wrote:
>> Looks like
>>    make all
>> does not imply
>>    make recommended
>> in the RC version of R-2.5.0 ...
>>
>> Uwe
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>   
> Eh? What makes you say that?

Apologies! This happens if doing things too quickly.

I was talking about ./src/gnuwin32/Makefile and just recognized that 
'make recommended' was never part of 'make all', just of 'make 
distribution'. I was somehow mixing it with the Linux version, 
obviously. My autobuilder usually builds R for me, hence I am unused to 
do it manually.

Uwe



> 
> all: Makefile Makeconf R docs recommended
> recommended: @USE_RECOMMENDED_PACKAGES_TRUE@ stamp-recommended


From murdoch at stats.uwo.ca  Mon Apr 23 15:20:40 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 23 Apr 2007 09:20:40 -0400
Subject: [Rd] R RC: make all
In-Reply-To: <462CABC0.6060303@biostat.ku.dk>
References: <462CA984.8060301@statistik.uni-dortmund.de>
	<462CABC0.6060303@biostat.ku.dk>
Message-ID: <462CB2A8.3090501@stats.uwo.ca>

On 4/23/2007 8:51 AM, Peter Dalgaard wrote:
> Uwe Ligges wrote:
>> Looks like
>>    make all
>> does not imply
>>    make recommended
>> in the RC version of R-2.5.0 ...
>>
>> Uwe
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>   
> Eh? What makes you say that?
> 
> 
> all: Makefile Makeconf R docs recommended
> recommended: @USE_RECOMMENDED_PACKAGES_TRUE@ stamp-recommended

This is true in the Windows src/gnuwin32/Makefile, but it's not new. 
The only target that depends on "recommended" is "distribution", and it 
does it by forcing "make recommended" every time, whether needed or not.

"make all" also misses "bitmapdll" (which I think has no equivalent in 
Unix?), "manuals" (part of "docs" in Unix), and installer related targets.

It would probably be reasonable if "make all" were more consistent 
across platforms, but "make recommended" is quite slow, so I'm not sure 
I would like it to be in the default ("all" is the default target).

Another argument in favour of including "recommended" in the default is 
that currently "make ; make check" fails in Windows, because some of the 
checks depend on recommended packages.

Duncan Murdoch


From ripley at stats.ox.ac.uk  Mon Apr 23 15:42:38 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 23 Apr 2007 14:42:38 +0100 (BST)
Subject: [Rd] R RC: make all
In-Reply-To: <462CB2A8.3090501@stats.uwo.ca>
References: <462CA984.8060301@statistik.uni-dortmund.de>
	<462CABC0.6060303@biostat.ku.dk> <462CB2A8.3090501@stats.uwo.ca>
Message-ID: <Pine.LNX.4.64.0704231435240.15733@gannet.stats.ox.ac.uk>

On Mon, 23 Apr 2007, Duncan Murdoch wrote:

> On 4/23/2007 8:51 AM, Peter Dalgaard wrote:
>> Uwe Ligges wrote:
>>> Looks like
>>>    make all
>>> does not imply
>>>    make recommended
>>> in the RC version of R-2.5.0 ...
>>>
>>> Uwe
>>>
>> Eh? What makes you say that?
>>
>>
>> all: Makefile Makeconf R docs recommended
>> recommended: @USE_RECOMMENDED_PACKAGES_TRUE@ stamp-recommended
>
> This is true in the Windows src/gnuwin32/Makefile, but it's not new.
> The only target that depends on "recommended" is "distribution", and it
> does it by forcing "make recommended" every time, whether needed or not.
>
> "make all" also misses "bitmapdll" (which I think has no equivalent in
> Unix?), "manuals" (part of "docs" in Unix), and installer related targets.

'make manuals' is equivalent to 'make pdf' on Unix.

> It would probably be reasonable if "make all" were more consistent
> across platforms, but "make recommended" is quite slow, so I'm not sure
> I would like it to be in the default ("all" is the default target).

This could be overcome by using timestamps, as on Unix.  However, those do 
not work entirely right on Unix, as they only check if the package sources 
have been updated, and not that R has been changed in a way that needs the 
package to be regnerated (e.g. the C headers have changed, or methods need 
to be re-dumped).  So I have been reluctant to change to a known flawed 
system.  (Originally the Windows toolkit was missing 'touch', which you 
would need to do timestamps right.)

> Another argument in favour of including "recommended" in the default is
> that currently "make ; make check" fails in Windows, because some of the
> checks depend on recommended packages.
>
> Duncan Murdoch

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ligges at statistik.uni-dortmund.de  Mon Apr 23 16:10:27 2007
From: ligges at statistik.uni-dortmund.de (ligges at statistik.uni-dortmund.de)
Date: Mon, 23 Apr 2007 16:10:27 +0200 (CEST)
Subject: [Rd] plot.xy() with type="s" and huge data (PR#9629)
Message-ID: <20070423141027.EDB5D6265E@slim.kubism.ku.dk>

The following code snippet crashes R (under Windows and Linux) for both 
R-2.4.1 and R-2.5.0 RC as of yesterday:

   set.seed(1)
   H <- rnorm(400000)
   temp <- rnorm(400000)
   plot(H, temp, type='s')
   # (no, it was not my idea to do something like that!)


I *guess* it is some overflow in plot.xy() which calls
   .Internal(plot.xy(xy, type, pch, lty, col, bg, cex, lwd, ...))
but I haven't investigated closely enough, submitting the bug report in 
case anybody can (and has time to) fix this before tomorrow.

Uwe Ligges


From bill at insightful.com  Mon Apr 23 17:56:26 2007
From: bill at insightful.com (Bill Dunlap)
Date: Mon, 23 Apr 2007 08:56:26 -0700 (PDT)
Subject: [Rd] plot.xy() with type="s" and huge data (PR#9629)
In-Reply-To: <20070423141027.EDB5D6265E@slim.kubism.ku.dk>
References: <20070423141027.EDB5D6265E@slim.kubism.ku.dk>
Message-ID: <Pine.GSO.4.56.0704230854240.15681@durian.statsci.com>

On Mon, 23 Apr 2007 ligges at statistik.uni-dortmund.de wrote:

> The following code snippet crashes R (under Windows and Linux) for both
> R-2.4.1 and R-2.5.0 RC as of yesterday:
>
>    set.seed(1)
>    H <- rnorm(400000)
>    temp <- rnorm(400000)
>    plot(H, temp, type='s')
>    # (no, it was not my idea to do something like that!)
>
>
> I *guess* it is some overflow in plot.xy() which calls
>    .Internal(plot.xy(xy, type, pch, lty, col, bg, cex, lwd, ...))
> but I haven't investigated closely enough, submitting the bug report in
> case anybody can (and has time to) fix this before tomorrow.

It happens right after 2 calls to alloca(), which probably
ought to be changed to non-stack allocations.  (On Linux there
is a complaint about stack overflow and valgrind complains
that someone changed the stack pointer.)  type='S' also uses
alloca().

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From ripley at stats.ox.ac.uk  Mon Apr 23 19:20:04 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon, 23 Apr 2007 19:20:04 +0200 (CEST)
Subject: [Rd] plot.xy() with type="s" and huge data (PR#9629)
Message-ID: <20070423172004.0F89D5DE3C@slim.kubism.ku.dk>

On Mon, 23 Apr 2007, Bill Dunlap wrote:

> On Mon, 23 Apr 2007 ligges at statistik.uni-dortmund.de wrote:
>
>> The following code snippet crashes R (under Windows and Linux) for both
>> R-2.4.1 and R-2.5.0 RC as of yesterday:
>>
>>    set.seed(1)
>>    H <- rnorm(400000)
>>    temp <- rnorm(400000)
>>    plot(H, temp, type='s')
>>    # (no, it was not my idea to do something like that!)
>>
>>
>> I *guess* it is some overflow in plot.xy() which calls
>>    .Internal(plot.xy(xy, type, pch, lty, col, bg, cex, lwd, ...))
>> but I haven't investigated closely enough, submitting the bug report in
>> case anybody can (and has time to) fix this before tomorrow.
>
> It happens right after 2 calls to alloca(), which probably
> ought to be changed to non-stack allocations.  (On Linux there
> is a complaint about stack overflow and valgrind complains
> that someone changed the stack pointer.)  type='S' also uses
> alloca().

I think rather it should use alloca for moderate sizes (for speed), and 
something else for large ones.  Or perhaps we should just not allow such 
usage (the graphics device is going to have indigestion: Windows GDI only 
copes with 1000 segments or so and we need to split up the call).

Certainly not something to be fixed for 2.5.0, and pretty low priority.
What we can do quickly is stick in a stack check, which will stop the 
crash.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jhallman at frb.gov  Mon Apr 23 20:23:15 2007
From: jhallman at frb.gov (jhallman at frb.gov)
Date: Mon, 23 Apr 2007 20:23:15 +0200 (CEST)
Subject: [Rd] foreign::read.ssd and long names (PR#9631)
Message-ID: <20070423182315.AA72662615@slim.kubism.ku.dk>

Full_Name: Jeff Hallman
Version: 2.4.1
OS: Linux
Submission from: (NULL) (132.200.32.34)


read.ssd() invokes PROC COPY to create an xport file, but PROC COPY has some
annoying limitations that read.ssd() should deal with.  The first is that PROC
COPY doesn't work with member names (the sectionnames argument to read.ssd)
longer than 8 characters.  The second is that PROC COPY also fails if any of the
columns in the dataset being copied are too long, unless you first set (in SAS)
"option validvarname = v6;".  

I'm including here a rewritten read.ssd() that deals with these two issues.  The
sectionnames 8-character limitation is dealt with by creating symbolic links
with shorter names.  The problem with long column names is handled by adding SAS
code to set "option validvarname = v6", which shortens column names that are too
long while still keeping them unique within the dataset.  A further enhancement
might be to use PROC CONTENTS to retrieve the full-length column names and then
assign them as the column names of the returned data.frames, but that seems to
be more effort than its worth.


From jhallman at frb.gov  Mon Apr 23 20:38:34 2007
From: jhallman at frb.gov (jhallman at frb.gov)
Date: Mon, 23 Apr 2007 20:38:34 +0200 (CEST)
Subject: [Rd] Correction to PR #9631 (PR#9632)
Message-ID: <20070423183834.843F15DE3C@slim.kubism.ku.dk>

Full_Name: Jeff Hallman
Version: 2.4.1
OS: Linux
Submission from: (NULL) (132.200.32.34)


When I filed this a few minutes ago, I left off the rewritten read.ssd().  I've
included it at the end this time.


read.ssd() invokes PROC COPY to create an xport file, but PROC COPY has some
annoying limitations that read.ssd() should deal with.  The first is that PROC
COPY doesn't work with member names (the sectionnames argument to read.ssd)
longer than 8 characters.  The second is that PROC COPY also fails if any of
the
columns in the dataset being copied are too long, unless you first set (in SAS)
"option validvarname = v6;".  

I'm including here a rewritten read.ssd() that deals with these two issues. 
The
sectionnames 8-character limitation is dealt with by creating symbolic links
with shorter names.  The problem with long column names is handled by adding
SAS
code to set "option validvarname = v6", which shortens column names that are
too
long while still keeping them unique within the dataset.  A further enhancement
might be to use PROC CONTENTS to retrieve the full-length column names and then
assign them as the column names of the returned data.frames, but that seems to
be more effort than its worth.

read.ssd <- function(libname,
                     sectionnames,
                     tmpXport = tempfile(),
                     tmpProgLoc = tempfile(), 
                     sascmd = "sas"){
  tmpFiles <- tmpXport
  on.exit(unlink(tmpFiles))
  logGuess <- function(x){
    expl <- strsplit(x, "")[[1]]
    rex <- rev(expl)
    br <- match("/", rex)[1]
    if(is.na(br)) 
      return(x)
    return(paste(rev(rex[1:(br - 1)]), sep = "", collapse = ""))
  }
  fileExtension <- function(string){
    n <- nchar(string)
    chars <- substring(string, 1:n, 1:n)
    lastDot <- n + 1 - match(".", rev(chars), nomatch = n + 1)
    substring(string, lastDot + 1, n)
  }
  sn <- sectionnames
  if(any(nchar(sn) > 8)){
    oldDir   <- libname
    libname  <- tempdir()
    allFiles <- list.files(oldDir)
    oldNames <- character(0)
    for(i in 1:length(sn)){
      fName <- grep(sn[i], allFiles, value = T)
      if(length(fName) == 0) stop(paste("sectionname", sn[i], "not found"))
      oldNames <- c(oldNames, fName)
    }
    sectionnames <- linkNames <- character(length(oldNames))
    for(i in 1:length(oldNames)){
      sectionnames[i] <- paste("sn", i, sep = "")
      linkNames[i] <- paste(sectionnames[i],
                            fileExtension(oldNames[i]),
                            sep = ".")
      oldPath  <- file.path(oldDir,  oldNames[i])
      linkPath <- file.path(libname, linkNames[i])
      file.symlink(oldPath, linkPath)

      tmpFiles <- c(tmpFiles, linkPath)
    }
  }
  st0 <- "option validvarname = v6;"
  st1 <- paste("libname src2rd '", libname, "';\n", sep = "")
  st2 <- paste("libname rd xport '", tmpXport, "';\n", sep = "")
  st3 <- paste("proc copy in=src2rd out=rd;\n")
  st4 <- paste("select", sectionnames, ";\n", sep = " ")
  tmpProg <- paste(tmpProgLoc, ".sas", sep = "")
  tmpProgLogBase <- logGuess(tmpProgLoc)
  tmpProgLog <- paste(tmpProgLogBase, ".log", sep = "")
  cat(st0, file = tmpProg)
  cat(st1, file = tmpProg, append = TRUE)
  cat(st2, file = tmpProg, append = TRUE)
  cat(st3, file = tmpProg, append = TRUE)
  cat(st4, file = tmpProg, append = TRUE)
  if(.Platform$OS.type == "windows") 
    sascmd <- paste(shQuote(sascmd), "-sysin")
  sasrun <- try(sysret <- system(paste(sascmd, tmpProg)))
  if(!inherits(sasrun, "try-error") & sysret == 0){
    unlink(tmpProg)
    unlink(tmpProgLog)
    if(length(sectionnames) == 1) return(foreign::read.xport(tmpXport))
    else {
      zz <- read.xport(tmpXport)
      names(zz) <- sn
      return(zz)
    }
  }
  else {
    cat("SAS failed.  SAS program at", tmpProg, "\n")
    if(.Platform$OS.type == "unix"){
      cat("a log and other error products should be in the vicinity\n")
      system(paste("ls -l ", tmpProgLog))
    }
    else {
      cat("The log file will be ", paste(basename(tmpProgLoc), 
                                         ".log", sep = ""), " in the current
directory\n", 
          sep = "")
    }
    warning("SAS return code was ", sysret)
    return(NULL)
  }
}


From deepayan.sarkar at gmail.com  Mon Apr 23 23:14:33 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Mon, 23 Apr 2007 14:14:33 -0700
Subject: [Rd] dendrogram definition
In-Reply-To: <17964.28245.673639.140342@lxh5.stat.uni-muenchen.de>
References: <eb555e660704201446j58dd4cb2p6efb5d389c0a010f@mail.gmail.com>
	<17964.28245.673639.140342@lxh5.stat.uni-muenchen.de>
Message-ID: <eb555e660704231414t10419ab8wfd3f92501926e624@mail.gmail.com>

On 4/23/07, Friedrich Leisch <friedrich.leisch at stat.uni-muenchen.de> wrote:
> >>>>> On Fri, 20 Apr 2007 14:46:33 -0700,
> >>>>> Deepayan Sarkar (DS) wrote:
>
>   > Hi,
>   > I'm trying to create a "grob" representing a dendrogram object (for
>   > use as a legend with lattice), and I have a question regarding how a
>   > "dendrogram" should be interpreted. Are they by definition binary
>   > trees or can they in principle have more than two children?
>
> They can have more than 2 children, and class "dendrogram" supports
> this. However, as most trees are currently created using hclust, all
> examples have binary trees.

Thanks, that's what my guess was since the help page doesn't say
anything special about binary trees. My code should work in either
case.

In case anyone's interested, there's an example of a lattice/grid heatmap at

http://dsarkar.fhcrc.org/R/heatmap/lattice-heatmap.pdf

(the primary benefit for me is better control over aspect ratio).

-Deepayan


From hothorn at hothorn.de  Tue Apr 24 10:58:26 2007
From: hothorn at hothorn.de (Torsten Hothorn)
Date: Tue, 24 Apr 2007 10:58:26 +0200 (CEST)
Subject: [Rd] nlevels(<no factor>) is 0 and not NA
Message-ID: <Pine.LNX.4.64.0704241056070.7612@localhost.localdomain>


> nlevels(c("a", "b"))
[1] 0

but the documentation in R 2.5.0 (and earlier) says

 	If the argument is not a 'factor', 'NA' is returned.

I hope it isn't too late, I only came across this in a lecture this 
morning.

Best,

Torsten


From ivowel at gmail.com  Tue Apr 24 01:23:11 2007
From: ivowel at gmail.com (ivo welch)
Date: Mon, 23 Apr 2007 19:23:11 -0400
Subject: [Rd] Error Reporting
Message-ID: <50d1c22d0704231623r5a79dc87lc7b91bb98ed4bb70@mail.gmail.com>

Dear R developers:  May I suggest that future versions of R improve a
little on the error reporting?  For example, right now, I am trying to
figure out which of my column names in a select statement has been
mis-spelled:

Error in `[.data.frame`(x, r, vars, drop = drop) :
        undefined columns selected

It would be nice if it could say what the name of the undefined column is.

Of course, I have already begged a couple of times that errors like
this be preceded by a backtrace or the last line number from the
user's R program.

joke.R:22: Error in `[.data.frame`(x, r, vars, drop = drop) :
        undefined columns selected: "non.existing.name" in "data.frame.name"

I don't understand why this is difficult (simply storing the currently
executing line and/or linenumber) as the program executes---but then,
I am a lousy freerider who does not look at the code.  (All I do is
occasionally donate to the R org.)

of course, I appreciate the great language you have put together.
just begging to make it a little better.  (yes, I do not want to use
ESS.)

regards,

/ivo


From iago.mosqueira at gmail.com  Tue Apr 24 11:37:46 2007
From: iago.mosqueira at gmail.com (Iago Mosqueira)
Date: Tue, 24 Apr 2007 11:37:46 +0200
Subject: [Rd] setClass inside a function
Message-ID: <dba1e14b0704240237x666ffeabha325659b1d194b68@mail.gmail.com>

Hi Martin,



Thanks very much, your suggestion on the "where" argument did the trick.



Many thanks,





Iago



>

> "Iago Mosqueira (Cefas)" <Iago.Mosqueira at cefas.co.uk> writes:

>

> > Hi Martin,

> >

> > Thanks very much for your help.

> >

> >> Hi Iago --

> >>

> >> Here's my attempt at an answer.

> >>

> >> "Iago Mosqueira (Cefas)" <Iago.Mosqueira at cefas.co.uk> writes:

> >>

> >> > set of S4 classes. But setClass is choking when my function

> >> is called

> >> > isnide a package, telling about an error in

> exists(cname, where). I

> >> > assume this to be a problem with the environment where

> the class is

> >> > created. If I define my creator function in a package

> and load it,

> >> > when I call it I get

> >> >

> >> > Error in assign(mname, def, where): cannot add bindings

> to a locked

> >> > environment

> >>

> >> You're trying to create a class in the package name space, and the

> >> name space is locked (cannot be modified) after the package is

> >> loaded. If your intention is programmatically generate

> static classes

> >> (in a kind of macro-like way) then I think you could still use this

> >> approach but ensure that the classes are created when the

> package is

> >> loaded (e.g., by including a class creation function that

> is actually

> >> evaluated, not just defined, in your package code).

> >

> > Yes, I have tried that. Inmediatly after the creator function is

> > defined I use it to create a new class. And this class is exported

> > in the package NAMESPACE. Still, it says the package environment is

> > locked, although the call to setClass is part of the package.

>

> Try removing the 'where' argument in setClass; or replacing it with

> topenv(parent.frame()) -- the top environment when the package is

> loaded is the name space.

>

> Also, for fun,

>

> >> > 	# validity

> >> > 	foo <- "validity <- function(object) {"

> >> > 	# foo <- c(foo, "browser()")

> >> > 	foo <- c(foo, paste("if(all(names(dimnames(object)) != c('",

> >> > 		paste(names(dimnames), collapse="','", sep=""), "')))",

> >> > sep=""))

> >> > 	foo <- c(foo, "stop(paste('dimnames are not correct for class',

> >> > name))")

> >> > 	foo <- c(foo, "return(TRUE)}")

> >> > 	eval(parse(text=foo))

>

> you can write something like

>

>     validity <- function (object) {

>         msg <- NULL

>         cat("checking", name, "/", class(object), "validity\n")

>         if (all(names(dimnames(object)) != c("iter", "y")))

>             msg <- paste("dimnames are not correct for class", name)

>         if (is.null(msg)) TRUE

>         else msg

>     }

>

> and continue to include validity=validity in setClass. This will use

> R's lexical scope to figure out the correct name, etc for each class

> created. Note also that the idea is that the validity function either

> returns TRUE or a character string, not itself calling 'stop'.

>

> >> > 	# constructors

> >> > 	eval(parse(text=paste("setGeneric('", name,

> >> > 		"', function(object, ...) standardGeneric('",

> >> name, "'))",

> >> > sep="")))

>

> I had expected that

>

>     setGeneric(name,

>                function(object, ...) standardGeneric(name))

>

> would work, but apparently not. This might be a bit cleaner way to

> create complcated substitutions;

>

>     eval(substitute({

>         setGeneric(NAME,

>                    function(object, ...) {

>                        standardGeneric(NAME)

>                    })

>         }, list(NAME=name)))

>

> >> > 	setMethod(name, signature(object='missing'),

> >> > 		function(...) {

> >> > 			return(FLPar(..., class=name))

> >> > 		}

> >> > 	)

>

> It's a bit surprising that this setMethod works, as the function

> signature is different from the generic. This might cause problems

> further down the line. I would have thought that the correct

> formulation would be along the lines of

>

>     setMethod(name, signature(object='missing'),

>               function(object, ...) {

>                   FLPar(..., class=name)

>               })

>

> Martin

> --

> Martin Morgan

> Bioconductor / Computational Biology

> http://bioconductor.org

>


From murdoch at stats.uwo.ca  Tue Apr 24 13:22:10 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 24 Apr 2007 07:22:10 -0400
Subject: [Rd] Error Reporting
In-Reply-To: <50d1c22d0704231623r5a79dc87lc7b91bb98ed4bb70@mail.gmail.com>
References: <50d1c22d0704231623r5a79dc87lc7b91bb98ed4bb70@mail.gmail.com>
Message-ID: <462DE862.5090402@stats.uwo.ca>

On 4/23/2007 7:23 PM, ivo welch wrote:
> Dear R developers:  May I suggest that future versions of R improve a
> little on the error reporting?  For example, right now, I am trying to
> figure out which of my column names in a select statement has been
> mis-spelled:
> 
> Error in `[.data.frame`(x, r, vars, drop = drop) :
>         undefined columns selected
> 
> It would be nice if it could say what the name of the undefined column is.

I think this message usually arises when you're doing something like

 > vars <- NA
 > df[1, vars]
Error in `[.data.frame`(df, 1, vars) : undefined columns selected

so the message is trying to tell you that there isn't any name 
available.  Conceivably the message could be clearer (e.g. in this 
specific case, "NA in column selection"), but that may not be the only 
way this error could arise.

> Of course, I have already begged a couple of times that errors like
> this be preceded by a backtrace or the last line number from the
> user's R program.
 >
 > joke.R:22: Error in `[.data.frame`(x, r, vars, drop = drop) :
 >         undefined columns selected: "non.existing.name" in 
"data.frame.name"
 >

That's quite difficult.  The parser knows line numbers, and can report 
them (as of 2.5.0), but these aren't kept when the lines are evaluated. 
  The sequence is:

read the file
parse it into a list of expressions
evaluate it

Parsing errors can report line numbers, but the evaluator doesn't keep them.

This means R doesn't have any idea what line caused a particular error. 
  In principle it could (e.g. by keeping line number info in functions), 
but it's tricky to get right, because there are so many ways to modify 
expressions after parsing.

There are limitations to the parser line number reporting (e.g. in a 
package, all source files are concatenated before parsing; if you have a 
syntax error you'll see the report about the concatenated file line 
number, not the original source file line number).  I'd say fixing those 
is the first priority.  My long range goal is to provide support for 
source-level debugging, which has requirements similar to the error 
reports you want:  they may come at the same time.  I'd guess this won't 
happen in 2.6.0, but you never know.

Duncan Murdoch

> I don't understand why this is difficult (simply storing the currently
> executing line and/or linenumber) as the program executes---but then,
> I am a lousy freerider who does not look at the code.  (All I do is
> occasionally donate to the R org.)
> 
> of course, I appreciate the great language you have put together.
> just begging to make it a little better.  (yes, I do not want to use
> ESS.)


From murdoch at stats.uwo.ca  Tue Apr 24 13:27:47 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 24 Apr 2007 07:27:47 -0400
Subject: [Rd] nlevels(<no factor>) is 0 and not NA
In-Reply-To: <Pine.LNX.4.64.0704241056070.7612@localhost.localdomain>
References: <Pine.LNX.4.64.0704241056070.7612@localhost.localdomain>
Message-ID: <462DE9B3.6070604@stats.uwo.ca>

On 4/24/2007 4:58 AM, Torsten Hothorn wrote:
>> nlevels(c("a", "b"))
> [1] 0
> 
> but the documentation in R 2.5.0 (and earlier) says
> 
>  	If the argument is not a 'factor', 'NA' is returned.
> 
> I hope it isn't too late, I only came across this in a lecture this 
> morning.

It's too late for 2.5.0, but not for 2.5.1, or 2.6.0, ...

Just to be clear:  this is a documentation error, right?  The behaviour 
is unchanged back at least as far as 2.2.1.

Duncan Murdoch


From ripley at stats.ox.ac.uk  Tue Apr 24 13:51:57 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 24 Apr 2007 12:51:57 +0100 (BST)
Subject: [Rd] nlevels(<no factor>) is 0 and not NA
In-Reply-To: <462DE9B3.6070604@stats.uwo.ca>
References: <Pine.LNX.4.64.0704241056070.7612@localhost.localdomain>
	<462DE9B3.6070604@stats.uwo.ca>
Message-ID: <Pine.LNX.4.64.0704241247250.15882@auk.stats>

On Tue, 24 Apr 2007, Duncan Murdoch wrote:

> On 4/24/2007 4:58 AM, Torsten Hothorn wrote:
>>> nlevels(c("a", "b"))
>> [1] 0
>>
>> but the documentation in R 2.5.0 (and earlier) says
>>
>>  	If the argument is not a 'factor', 'NA' is returned.
>>
>> I hope it isn't too late, I only came across this in a lecture this
>> morning.
>
> It's too late for 2.5.0, but not for 2.5.1, or 2.6.0, ...
>
> Just to be clear:  this is a documentation error, right?  The behaviour
> is unchanged back at least as far as 2.2.1.

It is also wrong in that other objects can have levels (in which case 
nlevels() reports how many), and I think the sentence should be deleted.
In theory there ought to be a \value section like

\value{
    The length of \code{\link{levels}(x)}, which is zero if
    \code{x} has no levels. 
}

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ivowel at gmail.com  Tue Apr 24 14:13:22 2007
From: ivowel at gmail.com (ivo welch)
Date: Tue, 24 Apr 2007 08:13:22 -0400
Subject: [Rd] Error Reporting
In-Reply-To: <462DE862.5090402@stats.uwo.ca>
References: <50d1c22d0704231623r5a79dc87lc7b91bb98ed4bb70@mail.gmail.com>
	<462DE862.5090402@stats.uwo.ca>
Message-ID: <50d1c22d0704240513je857c1cge1c7a9f0dde4f6bc@mail.gmail.com>

thank you, duncan.  I get this particular error from subset(d,
select=c( list.of.many.variables.one.of.which.is.misspelled) );  this
is probably not too uncommon in data sets with many long-named
variables.  hunting down what causes it is a pain.  I am definitely
looking forward to 2.6.0 and hope that keeping source line numbers (as
"comment do nothing" statements?) in the evaluator will happen.

regards,

/ivo


On 4/24/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 4/23/2007 7:23 PM, ivo welch wrote:
> > Dear R developers:  May I suggest that future versions of R improve a
> > little on the error reporting?  For example, right now, I am trying to
> > figure out which of my column names in a select statement has been
> > mis-spelled:
> >
> > Error in `[.data.frame`(x, r, vars, drop = drop) :
> >         undefined columns selected
> >
> > It would be nice if it could say what the name of the undefined column is.
>
> I think this message usually arises when you're doing something like
>
>  > vars <- NA
>  > df[1, vars]
> Error in `[.data.frame`(df, 1, vars) : undefined columns selected
>
> so the message is trying to tell you that there isn't any name
> available.  Conceivably the message could be clearer (e.g. in this
> specific case, "NA in column selection"), but that may not be the only
> way this error could arise.
>
> > Of course, I have already begged a couple of times that errors like
> > this be preceded by a backtrace or the last line number from the
> > user's R program.
>  >
>  > joke.R:22: Error in `[.data.frame`(x, r, vars, drop = drop) :
>  >         undefined columns selected: "non.existing.name" in
> "data.frame.name"
>  >
>
> That's quite difficult.  The parser knows line numbers, and can report
> them (as of 2.5.0), but these aren't kept when the lines are evaluated.
>   The sequence is:
>
> read the file
> parse it into a list of expressions
> evaluate it
>
> Parsing errors can report line numbers, but the evaluator doesn't keep them.
>
> This means R doesn't have any idea what line caused a particular error.
>   In principle it could (e.g. by keeping line number info in functions),
> but it's tricky to get right, because there are so many ways to modify
> expressions after parsing.
>
> There are limitations to the parser line number reporting (e.g. in a
> package, all source files are concatenated before parsing; if you have a
> syntax error you'll see the report about the concatenated file line
> number, not the original source file line number).  I'd say fixing those
> is the first priority.  My long range goal is to provide support for
> source-level debugging, which has requirements similar to the error
> reports you want:  they may come at the same time.  I'd guess this won't
> happen in 2.6.0, but you never know.
>
> Duncan Murdoch
>
> > I don't understand why this is difficult (simply storing the currently
> > executing line and/or linenumber) as the program executes---but then,
> > I am a lousy freerider who does not look at the code.  (All I do is
> > occasionally donate to the R org.)
> >
> > of course, I appreciate the great language you have put together.
> > just begging to make it a little better.  (yes, I do not want to use
> > ESS.)
>
>


From wangtong at usc.edu  Wed Apr 25 09:47:13 2007
From: wangtong at usc.edu (Tong Wang)
Date: Wed, 25 Apr 2007 00:47:13 -0700
Subject: [Rd] To use breaktodebugger(),
	which file should I include in C code?
Message-ID: <d9429a3a6def.462ea511@usc.edu>

Hi, 
    I have tried several headers in RHOME/include , but none of them seemed to work . 

Thanks for your help.


From murdoch at stats.uwo.ca  Wed Apr 25 12:44:59 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 25 Apr 2007 06:44:59 -0400
Subject: [Rd] To use breaktodebugger(),
 which file should I include in C code?
In-Reply-To: <d9429a3a6def.462ea511@usc.edu>
References: <d9429a3a6def.462ea511@usc.edu>
Message-ID: <462F312B.8090107@stats.uwo.ca>

On 4/25/2007 3:47 AM, Tong Wang wrote:
> Hi, 
>     I have tried several headers in RHOME/include , but none of them seemed to work . 
> 
> Thanks for your help.

It's not part of the API, so you can't call it from package code.

But the implementation is very simple in Windows:

void breaktodebugger()
{
     asm("int $3");
}

so you could easily write your own.  I don't know the equivalent for 
other platforms.

Duncan Murdoch


From ernest.turro at ic.ac.uk  Wed Apr 25 13:24:28 2007
From: ernest.turro at ic.ac.uk (Ernest Turro)
Date: Wed, 25 Apr 2007 12:24:28 +0100
Subject: [Rd] R-2.5.0 and unlink/wildcards
Message-ID: <F4683CA2-ACD2-4647-9C1D-0C4A01892B1E@ic.ac.uk>

It seems unlink doesn't work with wildcards in 2.5.0. I've tried  
R-2.5.0 under gnu/linux from source and the Mac binary from att  
research. Example:

 > dir()
[1] "bgx.Rnw" "bgx.pdf" "run.1"
 > unlink("run.*",recursive=T)
 > dir()
[1] "bgx.Rnw" "bgx.pdf" "run.1"
 > unlink("run.1",recursive=T)
 > dir()
[1] "bgx.Rnw" "bgx.pdf"


Cheers,

Ernest


From ripley at stats.ox.ac.uk  Wed Apr 25 13:38:55 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 25 Apr 2007 12:38:55 +0100 (BST)
Subject: [Rd] R-2.5.0 and unlink/wildcards
In-Reply-To: <F4683CA2-ACD2-4647-9C1D-0C4A01892B1E@ic.ac.uk>
References: <F4683CA2-ACD2-4647-9C1D-0C4A01892B1E@ic.ac.uk>
Message-ID: <Pine.LNX.4.64.0704251234500.7115@gannet.stats.ox.ac.uk>

This is shell-dependent on a Unix-alike, but Sys.glob() should work.  So 
try

unlink(Sys.glob("run.*"), recursive=TRUE)


On Wed, 25 Apr 2007, Ernest Turro wrote:

> It seems unlink doesn't work with wildcards in 2.5.0. I've tried
> R-2.5.0 under gnu/linux from source and the Mac binary from att
> research. Example:
>
> > dir()
> [1] "bgx.Rnw" "bgx.pdf" "run.1"
> > unlink("run.*",recursive=T)
> > dir()
> [1] "bgx.Rnw" "bgx.pdf" "run.1"
> > unlink("run.1",recursive=T)
> > dir()
> [1] "bgx.Rnw" "bgx.pdf"

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ernest.turro at ic.ac.uk  Wed Apr 25 13:43:53 2007
From: ernest.turro at ic.ac.uk (Ernest Turro)
Date: Wed, 25 Apr 2007 12:43:53 +0100
Subject: [Rd] R-2.5.0 and unlink/wildcards
In-Reply-To: <Pine.LNX.4.64.0704251234500.7115@gannet.stats.ox.ac.uk>
References: <F4683CA2-ACD2-4647-9C1D-0C4A01892B1E@ic.ac.uk>
	<Pine.LNX.4.64.0704251234500.7115@gannet.stats.ox.ac.uk>
Message-ID: <A07E9250-6199-4DE7-B73B-6C646CEF12BA@ic.ac.uk>

Thanks, this now works.

I'd just like to mention that Sys.glob() wasn't necessary in 2.4.1  
and this potential requirement should perhaps be mentioned in ?unlink.

Thanks

E

On 25 Apr 2007, at 12:38, Prof Brian Ripley wrote:

> This is shell-dependent on a Unix-alike, but Sys.glob() should  
> work.  So try
>
> unlink(Sys.glob("run.*"), recursive=TRUE)
>
>
> On Wed, 25 Apr 2007, Ernest Turro wrote:
>
>> It seems unlink doesn't work with wildcards in 2.5.0. I've tried
>> R-2.5.0 under gnu/linux from source and the Mac binary from att
>> research. Example:
>>
>> > dir()
>> [1] "bgx.Rnw" "bgx.pdf" "run.1"
>> > unlink("run.*",recursive=T)
>> > dir()
>> [1] "bgx.Rnw" "bgx.pdf" "run.1"
>> > unlink("run.1",recursive=T)
>> > dir()
>> [1] "bgx.Rnw" "bgx.pdf"
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From P.Dalgaard at biostat.ku.dk  Wed Apr 25 13:47:22 2007
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 25 Apr 2007 13:47:22 +0200
Subject: [Rd] R-2.5.0 and unlink/wildcards
In-Reply-To: <F4683CA2-ACD2-4647-9C1D-0C4A01892B1E@ic.ac.uk>
References: <F4683CA2-ACD2-4647-9C1D-0C4A01892B1E@ic.ac.uk>
Message-ID: <462F3FCA.6000709@biostat.ku.dk>

Ernest Turro wrote:
> It seems unlink doesn't work with wildcards in 2.5.0. I've tried  
> R-2.5.0 under gnu/linux from source and the Mac binary from att  
> research. Example:
>
>  > dir()
> [1] "bgx.Rnw" "bgx.pdf" "run.1"
>  > unlink("run.*",recursive=T)
>  > dir()
> [1] "bgx.Rnw" "bgx.pdf" "run.1"
>  > unlink("run.1",recursive=T)
>  > dir()
> [1] "bgx.Rnw" "bgx.pdf"
>
>   
Yes. The argument is now passed through shQuote, and that has the side
effect of removing wildcard expansions. If this was intentional, someone
forgot to change the help page...

Presumably, the change was done to prevent issues with embedded spaces:
unlink("Program Files") would otherwise delete "Program" and "Files". It
is not obvious to me how this can be achieved  while retaining wildcard
expansion.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Wed Apr 25 14:01:09 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 25 Apr 2007 13:01:09 +0100 (BST)
Subject: [Rd] R-2.5.0 and unlink/wildcards
In-Reply-To: <462F3FCA.6000709@biostat.ku.dk>
References: <F4683CA2-ACD2-4647-9C1D-0C4A01892B1E@ic.ac.uk>
	<462F3FCA.6000709@biostat.ku.dk>
Message-ID: <Pine.LNX.4.64.0704251252391.7386@gannet.stats.ox.ac.uk>

On Wed, 25 Apr 2007, Peter Dalgaard wrote:

> Ernest Turro wrote:
>> It seems unlink doesn't work with wildcards in 2.5.0. I've tried
>> R-2.5.0 under gnu/linux from source and the Mac binary from att
>> research. Example:
>>
>> > dir()
>> [1] "bgx.Rnw" "bgx.pdf" "run.1"
>> > unlink("run.*",recursive=T)
>> > dir()
>> [1] "bgx.Rnw" "bgx.pdf" "run.1"
>> > unlink("run.1",recursive=T)
>> > dir()
>> [1] "bgx.Rnw" "bgx.pdf"
>>
>>
> Yes. The argument is now passed through shQuote, and that has the side
> effect of removing wildcard expansions. If this was intentional, someone
> forgot to change the help page...
>
> Presumably, the change was done to prevent issues with embedded spaces:

NEWS says:

     o	unlink() on Unix-alikes failed for paths containing spaces.

> unlink("Program Files") would otherwise delete "Program" and "Files". It
> is not obvious to me how this can be achieved  while retaining wildcard
> expansion.

By using Sys.glob(), but it never got done and no one using pre-2.5.0 
reported this so presumably few people use it.  I'll put a fix in 2.5.0 
patched shortly.

There is the following comment in the R source file

##--- The following should/could really be done in C [platform !] :
unlink <- function(x, recursive = FALSE) {

and that would be a better idea (the Windows version is in C).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Apr 25 14:49:15 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 25 Apr 2007 13:49:15 +0100 (BST)
Subject: [Rd] [R] Coercing data types for use in model.frame
In-Reply-To: <462ECEFD.8010705@vanderbilt.edu>
References: <462ECEFD.8010705@vanderbilt.edu>
Message-ID: <Pine.LNX.4.64.0704251014120.2746@gannet.stats.ox.ac.uk>

Moved to R-devel ....

What is the 'data class'?  In particular what is its underlying type? And 
where in model.frame[.default] are you trying to use it (in the formula, 
data, in ..., etc).

This is an example of where some reproducible code and the error messages 
would be very helpful indeed.

Brian

On Tue, 24 Apr 2007, Frank E Harrell Jr wrote:

> In the Hmisc package there is a new data class 'mChoice' for multiple
> choice variables.  There are format and as.numeric methods (the latter
> creates a matrix of dummy variables).  mChoice variables are not allowed
> by model.frame.  Is there a way to specify a conversion function that
> model.frame will use automatically?  I would use as.factor here.
> model.frame does not seem to use as.data.frame.foo for individual variables.
>
> Thanks
> Frank
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From f.harrell at vanderbilt.edu  Wed Apr 25 19:00:39 2007
From: f.harrell at vanderbilt.edu (Frank E Harrell Jr)
Date: Wed, 25 Apr 2007 12:00:39 -0500
Subject: [Rd] [R] Coercing data types for use in model.frame
In-Reply-To: <Pine.LNX.4.64.0704251014120.2746@gannet.stats.ox.ac.uk>
References: <462ECEFD.8010705@vanderbilt.edu>
	<Pine.LNX.4.64.0704251014120.2746@gannet.stats.ox.ac.uk>
Message-ID: <462F8937.7020408@vanderbilt.edu>

Prof Brian Ripley wrote:
> Moved to R-devel ....
> 
> What is the 'data class'?  In particular what is its underlying type? 
> And where in model.frame[.default] are you trying to use it (in the 
> formula, data, in ..., etc).
> 
> This is an example of where some reproducible code and the error 
> messages would be very helpful indeed.
> 
> Brian

Brian,

Sorry - this was one of those "too late in the day" errors.  The problem 
was in a function called just before model.frame.  model.frame seems to 
work fine with an object of class c('mChoice', 'labelled').  It keeps 
mChoice variables as mChoice.  After model.frame is finished I'll change 
such variables to factors or matrices.

Frank


> 
> On Tue, 24 Apr 2007, Frank E Harrell Jr wrote:
> 
>> In the Hmisc package there is a new data class 'mChoice' for multiple
>> choice variables.  There are format and as.numeric methods (the latter
>> creates a matrix of dummy variables).  mChoice variables are not allowed
>> by model.frame.  Is there a way to specify a conversion function that
>> model.frame will use automatically?  I would use as.factor here.
>> model.frame does not seem to use as.data.frame.foo for individual 
>> variables.
>>
>> Thanks
>> Frank
>>
> 


-- 
Frank E Harrell Jr   Professor and Chair           School of Medicine
                      Department of Biostatistics   Vanderbilt University


From jgvcqa at rit.edu  Wed Apr 25 20:15:04 2007
From: jgvcqa at rit.edu (jgvcqa at rit.edu)
Date: Wed, 25 Apr 2007 20:15:04 +0200 (CEST)
Subject: [Rd] identify() and metafile copies under Windows XP (PR#9634)
Message-ID: <20070425181504.C00265DD1E@slim.kubism.ku.dk>

I am running R version as follows under Windows XP.


platform       i386-pc-mingw32             
arch           i386                        
os             mingw32                     
system         i386, mingw32               
status                                     
major          2                           
minor          5.0                         
year           2007                        
month          04                          
day            23                          
svn rev        41293                       
language       R                           
version.string R version 2.5.0 (2007-04-23)


Consider the following R commands and comments

x<-1:10
plot(x)
identify(x,n=1) 
# I click under the 4th data point (and "4" appears on the graph). I
save as a Metafile and paste into Word. The original plot and "4" are
copied. This is good.

identify(x) 
# I click under the 5th data point (and "5" also now appears on the
graph) and then use the Esc key to stop the processing. I save as a
Metafile and paste into Word. The original plot and "4" are copied, but
"5" is not copied. This is not good.

identify(x,n=1) 
# I click under the 6th data point. I save as a Metafile and paste into
Word. The original plot and "4" and "6" are copied, but "5" is not
copied


If I save as a bitmap the "5" is also copied.

The same problem occurred in 2.4.0.

Regards,

Joseph G. Voelkel, Ph.D.
Associate Professor and Chair, Graduate Statistics Program
Center for Quality and Applied Statistics
Kate Gleason College of Engineering
Rochester Institute of Technology
V 585-475-2231
F 585-475-5959
joseph.voelkel at rit.edu


From jeff.horner at vanderbilt.edu  Wed Apr 25 22:11:35 2007
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Wed, 25 Apr 2007 15:11:35 -0500
Subject: [Rd] R-exts.texi typo
Message-ID: <462FB5F7.2000007@vanderbilt.edu>

Index: doc/manual/R-exts.texi
===================================================================
--- doc/manual/R-exts.texi      (revision 41314)
+++ doc/manual/R-exts.texi      (working copy)
@@ -8951,7 +8951,7 @@
  @deftypefun int R_ReadConsole (char *@var{prompt}, unsigned char 
*@var{buf}, @
    int @var{buflen}, int @var{hist})
  @deftypefunx void R_WriteConsole (char *@var{buf}, int @var{buflen})
- at deftypefunx void R_WriteConsole (char *@var{buf}, int @var{buflen}, 
int @var{otype})
+ at deftypefunx void R_WriteConsoleEx (char *@var{buf}, int @var{buflen}, 
int @var{otype})
  @deftypefunx void R_ResetConsole ()
  @deftypefunx void R_FlushConsole ()
  @deftypefunx void R_ClearErrConsole ()

Jeff
-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner


From ripley at stats.ox.ac.uk  Thu Apr 26 00:34:42 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Thu, 26 Apr 2007 00:34:42 +0200 (CEST)
Subject: [Rd] identify() and metafile copies under Windows XP (PR#9634)
Message-ID: <20070425223442.DF32462667@slim.kubism.ku.dk>

This seems not specific to metafiles, nor even to Windows (but the use of 
Esc is specific to Rgui).  As I understand it you expected the results of 
a graphics operation you interrupted to be copied.

I don't see anything on the help page explaining what happens if you 
interrupt during identify(), so in the words of the POSIX standards I 
would expect this to be 'undefined'.  The help page does explain how to 
terminate an identify() call, and what puzzles me is why you did not do as 
it suggests.

What a 'copy' means depends on the 'from' and 'to' devices, and how you 
copy.  It seems reasonable that saving a bitmap might be different from 
copying the plot to a device at a different resolution.


On Wed, 25 Apr 2007, jgvcqa at rit.edu wrote:

> I am running R version as follows under Windows XP.
>
>
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status
> major          2
> minor          5.0
> year           2007
> month          04
> day            23
> svn rev        41293
> language       R
> version.string R version 2.5.0 (2007-04-23)
>
>
> Consider the following R commands and comments
>
> x<-1:10
> plot(x)
> identify(x,n=1)
> # I click under the 4th data point (and "4" appears on the graph). I
> save as a Metafile and paste into Word. The original plot and "4" are
> copied. This is good.
>
> identify(x)
> # I click under the 5th data point (and "5" also now appears on the
> graph) and then use the Esc key to stop the processing. I save as a
> Metafile and paste into Word. The original plot and "4" are copied, but
> "5" is not copied. This is not good.

But as no point was returned to the console, why did you think it has been 
successfully marked?

> identify(x,n=1)
> # I click under the 6th data point. I save as a Metafile and paste into
> Word. The original plot and "4" and "6" are copied, but "5" is not
> copied
>
>
> If I save as a bitmap the "5" is also copied.
>
> The same problem occurred in 2.4.0.
>
> Regards,
>
> Joseph G. Voelkel, Ph.D.
> Associate Professor and Chair, Graduate Statistics Program
> Center for Quality and Applied Statistics
> Kate Gleason College of Engineering
> Rochester Institute of Technology
> V 585-475-2231
> F 585-475-5959
> joseph.voelkel at rit.edu
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ml-it-r-devel at epigenomics.com  Thu Apr 26 15:53:25 2007
From: ml-it-r-devel at epigenomics.com (ml-it-r-devel at epigenomics.com)
Date: Thu, 26 Apr 2007 15:53:25 +0200
Subject: [Rd] ifelse behaviour
Message-ID: <f0qasl$j79$1@perl.epigenomics.epi>


Hi!

I'm puzzled by the return value of ifelse

consider

x<-integer(0)
ifelse(is(x, "character"), paste(x), x)
[1] NA

whereas
if (is(x, "character")) return(paste(x)) else x
[1] integer(0)

or
x<-integer(1)
ifelse(is(x, "character"), paste(x), x)
[1] 0

work as I had anticipated. Is this correct behaviour?

Regards,

   Matthias


 >sessionInfo()
R version 2.5.0 (2007-04-23)
i686-pc-linux-gnu

locale:
C

attached base packages:
[1] "stats"     "graphics"  "grDevices" "datasets"  "utils"     "methods"
[7] "base"

other attached packages:
rcompletion    rcompgen
     "0.1-2"    "0.1-10"


-- 
Matthias Burger                     Project Manager/ Biostatistician
Epigenomics AG    Kleine Praesidentenstr. 1    10178 Berlin, Germany
phone:+49-30-24345-371                          fax:+49-30-24345-555
http://www.epigenomics.com           matthias.burger at epigenomics.com
--
Epigenomics AG Berlin           Amtsgericht Charlottenburg HRB 75861
Vorstand:   Geert Nygaard (CEO/Vorsitzender),  Dr. Kurt Berlin (CSO)
               Oliver Schacht PhD (CFO),  Christian Piepenbrock (COO)
Aufsichtsrat:   Prof. Dr. Dr. hc. Rolf Krebs (Chairman/Vorsitzender)


From murdoch at stats.uwo.ca  Thu Apr 26 16:05:15 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 26 Apr 2007 10:05:15 -0400
Subject: [Rd] ifelse behaviour
In-Reply-To: <f0qasl$j79$1@perl.epigenomics.epi>
References: <f0qasl$j79$1@perl.epigenomics.epi>
Message-ID: <4630B19B.1070103@stats.uwo.ca>

On 4/26/2007 9:53 AM, ml-it-r-devel at epigenomics.com wrote:
> Hi!
> 
> I'm puzzled by the return value of ifelse
> 
> consider
> 
> x<-integer(0)
> ifelse(is(x, "character"), paste(x), x)
> [1] NA

The test evaluates to a length 1 logical vector containing FALSE.  So 
ifelse() tries to return the first entry of x.  But x[1] doesn't exist, 
so it evaluates to NA, and that's what ifelse() returns.
> 
> whereas
> if (is(x, "character")) return(paste(x)) else x
> [1] integer(0)

This is quite different. It says to return the expression in the else 
clause, which is x.
> 
> or
> x<-integer(1)
> ifelse(is(x, "character"), paste(x), x)
> [1] 0
> 
> work as I had anticipated. Is this correct behaviour?

Yes, this is correct.

Duncan Murdoch


From tplate at acm.org  Thu Apr 26 16:07:26 2007
From: tplate at acm.org (Tony Plate)
Date: Thu, 26 Apr 2007 08:07:26 -0600
Subject: [Rd] ifelse behaviour
In-Reply-To: <f0qasl$j79$1@perl.epigenomics.epi>
References: <f0qasl$j79$1@perl.epigenomics.epi>
Message-ID: <4630B21E.9010801@acm.org>

A simpler version of your "puzzling call to ifelse" is

ifelse(FALSE, character(0), integer(0))

The most obvious way to satisfy the requirements stated in the 
documentation is to extend integer(0) to length 1 by creating an NA 
value, and that's what you get as a return value (here the 'test' 
argument has length 1, and the 'no' argument has length 0).

-- Tony Plate


ml-it-r-devel at epigenomics.com wrote:
> Hi!
>
> I'm puzzled by the return value of ifelse
>
> consider
>
> x<-integer(0)
> ifelse(is(x, "character"), paste(x), x)
> [1] NA
>
> whereas
> if (is(x, "character")) return(paste(x)) else x
> [1] integer(0)
>
> or
> x<-integer(1)
> ifelse(is(x, "character"), paste(x), x)
> [1] 0
>
> work as I had anticipated. Is this correct behaviour?
>
> Regards,
>
>    Matthias
>
>
>  >sessionInfo()
> R version 2.5.0 (2007-04-23)
> i686-pc-linux-gnu
>
> locale:
> C
>
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "datasets"  "utils"     "methods"
> [7] "base"
>
> other attached packages:
> rcompletion    rcompgen
>      "0.1-2"    "0.1-10"
>
>
>


From ml-it-r-devel at epigenomics.com  Thu Apr 26 17:53:09 2007
From: ml-it-r-devel at epigenomics.com (ml-it-r-devel at epigenomics.com)
Date: Thu, 26 Apr 2007 17:53:09 +0200
Subject: [Rd] ifelse behaviour
In-Reply-To: <4630B19B.1070103@stats.uwo.ca>
References: <f0qasl$j79$1@perl.epigenomics.epi> <4630B19B.1070103@stats.uwo.ca>
Message-ID: <4630CAE5.5000904@epigenomics.com>

Duncan Murdoch wrote:
> On 4/26/2007 9:53 AM, ml-it-r-devel at epigenomics.com wrote:
>> Hi!
>>
>> I'm puzzled by the return value of ifelse
>>
>> consider
>>
>> x<-integer(0)
>> ifelse(is(x, "character"), paste(x), x)
>> [1] NA
> 
> The test evaluates to a length 1 logical vector containing FALSE.  So 
> ifelse() tries to return the first entry of x.  But x[1] doesn't exist, 
> so it evaluates to NA, and that's what ifelse() returns.

Thank you for the explanation!

Regards,

   Matthias

>>
>> whereas
>> if (is(x, "character")) return(paste(x)) else x
>> [1] integer(0)
> 
> This is quite different. It says to return the expression in the else 
> clause, which is x.
>>
>> or
>> x<-integer(1)
>> ifelse(is(x, "character"), paste(x), x)
>> [1] 0
>>
>> work as I had anticipated. Is this correct behaviour?
> 
> Yes, this is correct.
> 
> Duncan Murdoch
> 


-- 
Matthias Burger                     Project Manager/ Biostatistician
Epigenomics AG    Kleine Praesidentenstr. 1    10178 Berlin, Germany
phone:+49-30-24345-371                          fax:+49-30-24345-555
http://www.epigenomics.com           matthias.burger at epigenomics.com
--
Epigenomics AG Berlin           Amtsgericht Charlottenburg HRB 75861
Vorstand:   Geert Nygaard (CEO/Vorsitzender),  Dr. Kurt Berlin (CSO)
               Oliver Schacht PhD (CFO),  Christian Piepenbrock (COO)
Aufsichtsrat:   Prof. Dr. Dr. hc. Rolf Krebs (Chairman/Vorsitzender)


From ernest.turro at ic.ac.uk  Thu Apr 26 18:19:31 2007
From: ernest.turro at ic.ac.uk (Ernest Turro)
Date: Thu, 26 Apr 2007 17:19:31 +0100
Subject: [Rd] path autocompletion in 2.5.0
Message-ID: <BBE5F8EB-510B-453C-B30B-51693899E79A@ic.ac.uk>

Hi,

R 2.5.0 isn't auto-completing paths properly as it used to. E.g.  
suppose I have:

 > dir("CEL/choe")
[1] "chipC-rep1.CEL" "chipC-rep2.CEL" "chipC-rep3.CEL" "chipS-rep1.CEL"
[5] "chipS-rep2.CEL" "chipS-rep3.CEL"

Now if I do:

ReadAffy("CEL/choe/ch<tab> # => ReadAffy("CEL/choe/chip
ReadAffy("CEL/choe/chipC<tab> # => ReadAffy("CEL/choe/chipC-rep
ReadAffy("CEL/choe/chipC-rep1<tab> # Nothing happens.

in 2.4.1 that final line auto-completes properly to:

ReadAffy("CEL/choe/chipC-rep1.CEL"

Cheers,

Ernest


From ripley at stats.ox.ac.uk  Thu Apr 26 18:30:29 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 26 Apr 2007 17:30:29 +0100 (BST)
Subject: [Rd] path autocompletion in 2.5.0
In-Reply-To: <BBE5F8EB-510B-453C-B30B-51693899E79A@ic.ac.uk>
References: <BBE5F8EB-510B-453C-B30B-51693899E79A@ic.ac.uk>
Message-ID: <Pine.LNX.4.64.0704261723340.23447@gannet.stats.ox.ac.uk>

Did you actually look at the NEWS file?

     o	The Unix-alike readline terminal interface now does
 	command-completion for R objects, incorporating the
 	functionality formerly in package 'rcompletion' by Deepayan
 	Sarkar.  This can be disabled by setting the environment
 	variable R_COMPLETION=FALSE when starting R (e.g. in
 	~/.Renviron).  (Note that when this is enabled, filename
 	completion no longer works for file paths containing R
 	operators such as '+' and '-'.)

What 'properly' means is of course a matter of taste, but I am very 
surprised that you posted such a comment about something highlighted under 
USER-VISIBLE CHANGES as a configurable option.

R-devel has an option to fine-tune this behaviour.


On Thu, 26 Apr 2007, Ernest Turro wrote:

> Hi,
>
> R 2.5.0 isn't auto-completing paths properly as it used to. E.g.
> suppose I have:
>
> > dir("CEL/choe")
> [1] "chipC-rep1.CEL" "chipC-rep2.CEL" "chipC-rep3.CEL" "chipS-rep1.CEL"
> [5] "chipS-rep2.CEL" "chipS-rep3.CEL"
>
> Now if I do:
>
> ReadAffy("CEL/choe/ch<tab> # => ReadAffy("CEL/choe/chip
> ReadAffy("CEL/choe/chipC<tab> # => ReadAffy("CEL/choe/chipC-rep
> ReadAffy("CEL/choe/chipC-rep1<tab> # Nothing happens.
>
> in 2.4.1 that final line auto-completes properly to:
>
> ReadAffy("CEL/choe/chipC-rep1.CEL"
>
> Cheers,
>
> Ernest
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hin-tak.leung at cimr.cam.ac.uk  Thu Apr 26 18:31:57 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Thu, 26 Apr 2007 17:31:57 +0100
Subject: [Rd] path autocompletion in 2.5.0
In-Reply-To: <BBE5F8EB-510B-453C-B30B-51693899E79A@ic.ac.uk>
References: <BBE5F8EB-510B-453C-B30B-51693899E79A@ic.ac.uk>
Message-ID: <4630D3FD.6080507@cimr.cam.ac.uk>

Read release note of 2.5.0. It is mentioned there.

Ernest Turro wrote:
> Hi,
> 
> R 2.5.0 isn't auto-completing paths properly as it used to. E.g.  
> suppose I have:
> 
>  > dir("CEL/choe")
> [1] "chipC-rep1.CEL" "chipC-rep2.CEL" "chipC-rep3.CEL" "chipS-rep1.CEL"
> [5] "chipS-rep2.CEL" "chipS-rep3.CEL"
> 
> Now if I do:
> 
> ReadAffy("CEL/choe/ch<tab> # => ReadAffy("CEL/choe/chip
> ReadAffy("CEL/choe/chipC<tab> # => ReadAffy("CEL/choe/chipC-rep
> ReadAffy("CEL/choe/chipC-rep1<tab> # Nothing happens.
> 
> in 2.4.1 that final line auto-completes properly to:
> 
> ReadAffy("CEL/choe/chipC-rep1.CEL"
> 
> Cheers,
> 
> Ernest
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ernest.turro at ic.ac.uk  Thu Apr 26 18:45:17 2007
From: ernest.turro at ic.ac.uk (Ernest Turro)
Date: Thu, 26 Apr 2007 17:45:17 +0100
Subject: [Rd] path autocompletion in 2.5.0
In-Reply-To: <Pine.LNX.4.64.0704261723340.23447@gannet.stats.ox.ac.uk>
References: <BBE5F8EB-510B-453C-B30B-51693899E79A@ic.ac.uk>
	<Pine.LNX.4.64.0704261723340.23447@gannet.stats.ox.ac.uk>
Message-ID: <987A5640-483B-457B-ACA5-CD104CCA5F10@ic.ac.uk>

Apologies for missing that in NEWS.

Apart  for auto-completion breaking for paths with '-', this sounds  
very convenient.

E

On 26 Apr 2007, at 17:30, Prof Brian Ripley wrote:

> Did you actually look at the NEWS file?
>
>     o	The Unix-alike readline terminal interface now does
> 	command-completion for R objects, incorporating the
> 	functionality formerly in package 'rcompletion' by Deepayan
> 	Sarkar.  This can be disabled by setting the environment
> 	variable R_COMPLETION=FALSE when starting R (e.g. in
> 	~/.Renviron).  (Note that when this is enabled, filename
> 	completion no longer works for file paths containing R
> 	operators such as '+' and '-'.)
>
> What 'properly' means is of course a matter of taste, but I am very  
> surprised that you posted such a comment about something  
> highlighted under USER-VISIBLE CHANGES as a configurable option.
>
> R-devel has an option to fine-tune this behaviour.
>
>
> On Thu, 26 Apr 2007, Ernest Turro wrote:
>
>> Hi,
>>
>> R 2.5.0 isn't auto-completing paths properly as it used to. E.g.
>> suppose I have:
>>
>> > dir("CEL/choe")
>> [1] "chipC-rep1.CEL" "chipC-rep2.CEL" "chipC-rep3.CEL" "chipS- 
>> rep1.CEL"
>> [5] "chipS-rep2.CEL" "chipS-rep3.CEL"
>>
>> Now if I do:
>>
>> ReadAffy("CEL/choe/ch<tab> # => ReadAffy("CEL/choe/chip
>> ReadAffy("CEL/choe/chipC<tab> # => ReadAffy("CEL/choe/chipC-rep
>> ReadAffy("CEL/choe/chipC-rep1<tab> # Nothing happens.
>>
>> in 2.4.1 that final line auto-completes properly to:
>>
>> ReadAffy("CEL/choe/chipC-rep1.CEL"
>>
>> Cheers,
>>
>> Ernest
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sfalcon at fhcrc.org  Thu Apr 26 23:04:27 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Thu, 26 Apr 2007 14:04:27 -0700
Subject: [Rd] Problem with R-2.5.0 patched and Matrix package
Message-ID: <m2bqhargo4.fsf@ziti.fhcrc.org>

Hi,

Using latest R 2.5.0 Patched, I'm unable to install the Matrix package
from cran.fhcrc.org.

I get:

Creating a new generic function for "isSymmetric" in "Matrix"
Creating a new generic function for "unname" in "Matrix"
Error in conformMethod(signature, mnames, fnames, f) :
        In method for function "!": formal arguments omitted in the method definition cannot be in the signature (x = "Matrix")
Error: unable to load R code in package 'Matrix'
Execution halted
ERROR: lazy loading failed for package 'Matrix'
** Removing '/home/sfalcon/RLIBS/2.5/Matrix'
** Restoring previous '/home/sfalcon/RLIBS/2.5/Matrix'

The downloaded packages are in
        /tmp/RtmpcEQJjw/downloaded_packages
Warning message:
installation of package 'Matrix' had non-zero exit status in: install.packages(pkgs = pkgs, repos = repos, dependencies = dependencies,

I don't have this problem when using a recent R-devel.  And I'm
guessing that Matrix works with the release, but haven't had time to
check this.

+ seth

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From ripley at stats.ox.ac.uk  Thu Apr 26 23:57:11 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 26 Apr 2007 22:57:11 +0100 (BST)
Subject: [Rd] Signature of '!' (was Problem with R-2.5.0 patched and
 Matrix package)
In-Reply-To: <m2bqhargo4.fsf@ziti.fhcrc.org>
References: <m2bqhargo4.fsf@ziti.fhcrc.org>
Message-ID: <Pine.LNX.4.64.0704262211250.27404@gannet.stats.ox.ac.uk>

Yes, it works in the release.

The essence of the problem is that Matrix defines an S4 method for '!' 
with dispatch on 'e1', but the documentation for '!' (and many S3 methods) 
says the argument is 'x'.  As '!' is a primitive the argument matching of 
the base function might be expected to be positional only, but that is not 
what happens with methods.

This needs some juggling, and clearly two patches in R-patched have 
conflicted.  I've reverted one of them and this seems to work again (but 
something else no longer works: see below).

Longer term, I don't know what the right way forward is.  Consider

> setClass("foo", "logical")
[1] "foo"
> setMethod("!", "foo", function(e1) NA)
[1] "!"
> x <- new("foo", TRUE)
> !x
[1] NA
> `!`(x)
[1] NA
> `!`(x=x)
Error in !x : unused argument(s) (x = TRUE)
> `!`(e1=x)
[1] NA

which is not what the reader of the help for '!' might expect.  But it 
gets worse:

> x2 <- structure(TRUE, class="bar")
> `!.bar` <- function(x) NA
(and there are several S3 methods like that in CRAN packages)
> !x2
[1] NA
> `!`(x2)
[1] NA
> `!`(x=x2)
Error in !x2 : unused argument(s) (x = TRUE)
> `!`(e1=x2)
Error in `!.bar`(e1 = x2) : unused argument(s) (e1 = TRUE)

whereas `!`(x=x2) does work if you do not set an S4 method on '!'.
This may seem artificial, but this sort of thing can happen if you use 
operators as functions in lapply().

Since there are in packages S3 methods on 'x' and S4 methods on 'e1', we 
have a conflict.

My gut feeling is that the inconsistency is the S4 signature, and 
certainly that seems the easier one to change.  I knew about this because 
the behind-the-scenes S4 generics in R-devel are auto-generated from the 
descriptions of the primitives.  Now in 2.5.0 you will see

> `!`
function (x)  .Primitive("!")

and hence there needed to be an exclusion list (which now includes '!' and 
'c')  to have Matrix work in R-devel.  An alternative is to make the 
internal method dispatch on operators ignore the argument names.

(I can guess where this comes from.  '!' is a member of the S3 Ops group, 
and as part of a group method you define Ops(e1, e2) and ignore e2.  But 
'!' is not part of the S4 group generic Logic in R.)

Thanks for the report.


On Thu, 26 Apr 2007, Seth Falcon wrote:

> Hi,
>
> Using latest R 2.5.0 Patched, I'm unable to install the Matrix package
> from cran.fhcrc.org.
>
> I get:
>
> Creating a new generic function for "isSymmetric" in "Matrix"
> Creating a new generic function for "unname" in "Matrix"
> Error in conformMethod(signature, mnames, fnames, f) :
>        In method for function "!": formal arguments omitted in the method definition cannot be in the signature (x = "Matrix")
> Error: unable to load R code in package 'Matrix'
> Execution halted
> ERROR: lazy loading failed for package 'Matrix'
> ** Removing '/home/sfalcon/RLIBS/2.5/Matrix'
> ** Restoring previous '/home/sfalcon/RLIBS/2.5/Matrix'
>
> The downloaded packages are in
>        /tmp/RtmpcEQJjw/downloaded_packages
> Warning message:
> installation of package 'Matrix' had non-zero exit status in: install.packages(pkgs = pkgs, repos = repos, dependencies = dependencies,
>
> I don't have this problem when using a recent R-devel.  And I'm
> guessing that Matrix works with the release, but haven't had time to
> check this.
>
> + seth
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From deepayan.sarkar at gmail.com  Fri Apr 27 01:39:01 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Thu, 26 Apr 2007 16:39:01 -0700
Subject: [Rd] evaluation in unattached namespace
Message-ID: <eb555e660704261639h531c7c0fk968283b961b0f504@mail.gmail.com>

Hi,

I recently discovered this buglet in lattice: If lattice is _not_
attached, I get

> lattice::dotplot(~1:10)
Error in eval(expr, envir, enclos) : could not find function "bwplot"

This happens because of this:

> lattice:::dotplot.formula
function (x, data = NULL, panel = "panel.dotplot", ...)
{
    ocall <- ccall <- match.call()
    ccall$data <- data
    ccall$panel <- panel
    ccall[[1]] <- as.name("bwplot")
    ans <- eval.parent(ccall)
    ans$call <- ocall
    ans
}
<environment: namespace:lattice>

That is, ccall is eval()-ed in the global environment where bwplot is
not visible. While this example is somewhat silly, similar things
happen when I try to import lattice from another package.

Are there any simple alternatives? I tried

    ccall[[1]] <- as.name("lattice::bwplot")

but that didn't work either.

-Deepayan


From murdoch at stats.uwo.ca  Fri Apr 27 02:29:55 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 26 Apr 2007 20:29:55 -0400
Subject: [Rd] evaluation in unattached namespace
In-Reply-To: <eb555e660704261639h531c7c0fk968283b961b0f504@mail.gmail.com>
References: <eb555e660704261639h531c7c0fk968283b961b0f504@mail.gmail.com>
Message-ID: <46314403.2070701@stats.uwo.ca>

On 4/26/2007 7:39 PM, Deepayan Sarkar wrote:
> Hi,
> 
> I recently discovered this buglet in lattice: If lattice is _not_
> attached, I get
> 
>> lattice::dotplot(~1:10)
> Error in eval(expr, envir, enclos) : could not find function "bwplot"
> 
> This happens because of this:
> 
>> lattice:::dotplot.formula
> function (x, data = NULL, panel = "panel.dotplot", ...)
> {
>     ocall <- ccall <- match.call()
>     ccall$data <- data
>     ccall$panel <- panel
>     ccall[[1]] <- as.name("bwplot")
>     ans <- eval.parent(ccall)
>     ans$call <- ocall
>     ans
> }
> <environment: namespace:lattice>
> 
> That is, ccall is eval()-ed in the global environment where bwplot is
> not visible. While this example is somewhat silly, similar things
> happen when I try to import lattice from another package.
> 
> Are there any simple alternatives? I tried
> 
>     ccall[[1]] <- as.name("lattice::bwplot")
> 
> but that didn't work either.

One way would be to create a new environment with the caller's 
environment as the parent, and put a copy of bwplot in it, i.e. 
something like the following untested code:

  function (x, data = NULL, panel = "panel.dotplot", ...)
  {
      ocall <- ccall <- match.call()
      ccall$data <- data
      ccall$panel <- panel
      ccall[[1]] <- as.name("bwplot")
      evalenv <- new.env(parent = parent.frame())
      assign("bwplot", bwplot, envir=evalenv)
      ans <- eval(ccall, envir=evalenv)
      ans$call <- ocall
      ans
  }

Duncan Murdoch


From deepayan.sarkar at gmail.com  Fri Apr 27 02:44:07 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Thu, 26 Apr 2007 17:44:07 -0700
Subject: [Rd] evaluation in unattached namespace
In-Reply-To: <46314403.2070701@stats.uwo.ca>
References: <eb555e660704261639h531c7c0fk968283b961b0f504@mail.gmail.com>
	<46314403.2070701@stats.uwo.ca>
Message-ID: <eb555e660704261744q4034f4a4lc32b3a2cdf87ea5b@mail.gmail.com>

On 4/26/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 4/26/2007 7:39 PM, Deepayan Sarkar wrote:
> > Hi,
> >
> > I recently discovered this buglet in lattice: If lattice is _not_
> > attached, I get
> >
> >> lattice::dotplot(~1:10)
> > Error in eval(expr, envir, enclos) : could not find function "bwplot"
> >
> > This happens because of this:
> >
> >> lattice:::dotplot.formula
> > function (x, data = NULL, panel = "panel.dotplot", ...)
> > {
> >     ocall <- ccall <- match.call()
> >     ccall$data <- data
> >     ccall$panel <- panel
> >     ccall[[1]] <- as.name("bwplot")
> >     ans <- eval.parent(ccall)
> >     ans$call <- ocall
> >     ans
> > }
> > <environment: namespace:lattice>
> >
> > That is, ccall is eval()-ed in the global environment where bwplot is
> > not visible. While this example is somewhat silly, similar things
> > happen when I try to import lattice from another package.
> >
> > Are there any simple alternatives? I tried
> >
> >     ccall[[1]] <- as.name("lattice::bwplot")

Seth suggested

ccall[[1]] <- quote(lattice::bwplot)

which makes more sense and seems to work too.

-Deepayan


From sfalcon at fhcrc.org  Fri Apr 27 02:51:53 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Thu, 26 Apr 2007 17:51:53 -0700
Subject: [Rd] evaluation in unattached namespace
In-Reply-To: <46314403.2070701@stats.uwo.ca> (Duncan Murdoch's message of "Thu,
	26 Apr 2007 20:29:55 -0400")
References: <eb555e660704261639h531c7c0fk968283b961b0f504@mail.gmail.com>
	<46314403.2070701@stats.uwo.ca>
Message-ID: <m2vefiod06.fsf@ziti.fhcrc.org>

Duncan Murdoch <murdoch at stats.uwo.ca> writes:

> On 4/26/2007 7:39 PM, Deepayan Sarkar wrote:
>> Hi,
>> 
>> I recently discovered this buglet in lattice: If lattice is _not_
>> attached, I get
>> 
>>> lattice::dotplot(~1:10)
>> Error in eval(expr, envir, enclos) : could not find function "bwplot"
>> 
>> This happens because of this:
>> 
>>> lattice:::dotplot.formula
>> function (x, data = NULL, panel = "panel.dotplot", ...)
>> {
>>     ocall <- ccall <- match.call()
>>     ccall$data <- data
>>     ccall$panel <- panel
>>     ccall[[1]] <- as.name("bwplot")
>>     ans <- eval.parent(ccall)
>>     ans$call <- ocall
>>     ans
>> }
>> <environment: namespace:lattice>
>> 
>> That is, ccall is eval()-ed in the global environment where bwplot is
>> not visible. While this example is somewhat silly, similar things
>> happen when I try to import lattice from another package.
>> 
>> Are there any simple alternatives? I tried
>> 
>>     ccall[[1]] <- as.name("lattice::bwplot")
>> 
>> but that didn't work either.
>
> One way would be to create a new environment with the caller's 
> environment as the parent, and put a copy of bwplot in it, i.e. 
> something like the following untested code:
>
>   function (x, data = NULL, panel = "panel.dotplot", ...)
>   {
>       ocall <- ccall <- match.call()
>       ccall$data <- data
>       ccall$panel <- panel
>       ccall[[1]] <- as.name("bwplot")
>       evalenv <- new.env(parent = parent.frame())
>       assign("bwplot", bwplot, envir=evalenv)
>       ans <- eval(ccall, envir=evalenv)
>       ans$call <- ocall
>       ans
>   }
>

quote(lattice::bwplot) also seems to work.

+ seth

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From rfrancois at mango-solutions.com  Fri Apr 27 11:30:16 2007
From: rfrancois at mango-solutions.com (Romain Francois)
Date: Fri, 27 Apr 2007 10:30:16 +0100
Subject: [Rd] a taste of regex in `[.data.frame`
Message-ID: <4631C2A8.7030000@mango-solutions.com>

Hello,

I am often asked how to filter lines from a data frame, like for example
get all the Mazda cars from mtcars, so that usually does the trick:

R> mtcars[ grep("Mazda", rownames(mtcars)) ,  ]

but, what about using a formula in `[.data.frame` to make that sort of
code meaningful:

# rownames matching "Mazda"
R> mtcars[~Mazda, ]
               mpg cyl  disp  hp drat    wt  qsec vs am gear carb
Mazda RX4     21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag 21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4

# two first lines of iris, with the columns matching the regex "Sep"
R> iris[1:2, ~Sep]
  Sepal.Length Sepal.Width
1          5.1         3.5
2          4.9         3.0

# two first lines of iris, with the columns matching the regex "\\."
R> iris[1:2, ~"\\."]
  Sepal.Length Sepal.Width Petal.Length Petal.Width
1          5.1         3.5          1.4         0.2
2          4.9         3.0          1.4         0.2



It is just a matter of adding these lines to `[.data.frame` after the
second line :

<code>
    if(!missing(j) && inherits(j, "formula")) 
       j <- grep( j[[length(j)]], names(x) )
   
    if(!missing(i) && inherits(i, "formula")) 
       i <- grep( i[[length(i)]], if(Narg>=3) rownames(x) else names(x))  
</code>

I realize that there are also other places where this could be used, an
obvious one being `[<-.data.frame`, but i wanted to ask first if it can
be interesting, or if it is dangerous, confusing, ....

Cheers,

Romain

PS: .. can also imagine to add a minus before the regex to drop
(rows|columns) instead of keeping them.

-- 
Mango Solutions
data analysis that delivers

Tel:  +44(0) 1249 467 467
Fax:  +44(0) 1249 467 468
Mob:  +44(0) 7813 526 123


From Bernhard_Pfaff at fra.invesco.com  Fri Apr 27 13:24:30 2007
From: Bernhard_Pfaff at fra.invesco.com (Pfaff, Bernhard Dr.)
Date: Fri, 27 Apr 2007 12:24:30 +0100
Subject: [Rd] Problem with formatted xtable in R 2.5.0
Message-ID: <E4A9111DA23BA048B9A46686BF727CF4010BCA29@DEFRAXMB01.corp.amvescap.net>

Dear R-Devel subscriber,

I encountered the following problem for tex-formatted table with xtable(). Suppose I do want the following matrix as a table in LaTeX:

library(xtable)
a11 <- "\\color{green}\\textbf{big green}"
a21 <- "\\color{red}\\textbf{big red}"
a12 <- "\\color{green}green"
a22 <- "\\color{red}red"
A <- matrix(c(a11, a21, a12, a22), nrow = 2, ncol = 2)
colnames(A) <- c("big", "normal")
rownames(A) <- c("green", "red")
A
xtable(A, vsep=c('@{\\hspace{0.1cm}}', rep('@{\\hspace{0.4cm}}', 6), '@{\\hspace{0.1cm}}'))

I do get the following output:

% latex table generated in R 2.5.0 by xtable 1.4-3 package
% Fri Apr 27 13:19:43 2007
\begin{table}[ht]
\begin{center}
\begin{tabular}{rll}
  \hline
 & big & normal \\
  \hline
green & $\backslash$color\{green\}$\backslash$textbf\{big green\} & $\backslash$color\{green\}green \\
  red & $\backslash$color\{red\}$\backslash$textbf\{big red\} & $\backslash$color\{red\}red \\
   \hline
\end{tabular}
\end{center}
\end{table}


Please, note that the curly braces are prefixed with a backslash and the double backslashes are interpreted as math backslashes. The above code snippet worked fine in R 2.4.1 and I reckon that this behaviour might be due to:

 o	There is a warning if \ is used unnecessarily in a string when
	being parsed, e.g. "\." where probably "\\." was intended.
	("\." is valid, but the same as ".".)  Thanks to Bill Dunlap
	for the suggestion.

Anyway, has somebody else encountered this problem and/or is so kind and give me some hints/pointers to circumvent this problem?

Many thanks in advance,
Bernhard


> version
               _                           
platform       i386-pc-mingw32             
arch           i386                        
os             mingw32                     
system         i386, mingw32               
status                                     
major          2                           
minor          5.0                         
year           2007                        
month          04                          
day            23                          
svn rev        41293                       
language       R                           
version.string R version 2.5.0 (2007-04-23)

Dr. Bernhard Pfaff
Global Structured Products Group
(Europe)
Senior Analyst

Invesco Asset Management Deutschland GmbH
Bleichstrasse 60-62
D-60313 Frankfurt am Main

Tel: +49(0)69 29807 230
Fax: +49(0)69 29807 178
Email: bernhard_pfaff at fra.invesco.com

Gesch?ftsf?hrer: Karl Georg Bayer, Bernhard Langer, Alexander Lehmann, Christian Puschmann
Handelsregister: Frankfurt am Main, HRB 28469
Sitz der Gesellschaft: Frankfurt am Main
 
*****************************************************************
Confidentiality Note: The information contained in this mess...{{dropped}}


From ripley at stats.ox.ac.uk  Fri Apr 27 14:06:55 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 27 Apr 2007 13:06:55 +0100 (BST)
Subject: [Rd] Problem with formatted xtable in R 2.5.0
In-Reply-To: <E4A9111DA23BA048B9A46686BF727CF4010BCA29@DEFRAXMB01.corp.amvescap.net>
References: <E4A9111DA23BA048B9A46686BF727CF4010BCA29@DEFRAXMB01.corp.amvescap.net>
Message-ID: <Pine.LNX.4.64.0704271243460.16553@gannet.stats.ox.ac.uk>

On Fri, 27 Apr 2007, Pfaff, Bernhard Dr. wrote:

> Dear R-Devel subscriber,
>
> I encountered the following problem for tex-formatted table with 
> xtable(). Suppose I do want the following matrix as a table in LaTeX:
>
> library(xtable)
> a11 <- "\\color{green}\\textbf{big green}"
> a21 <- "\\color{red}\\textbf{big red}"
> a12 <- "\\color{green}green"
> a22 <- "\\color{red}red"
> A <- matrix(c(a11, a21, a12, a22), nrow = 2, ncol = 2)
> colnames(A) <- c("big", "normal")
> rownames(A) <- c("green", "red")
> A
> xtable(A, vsep=c('@{\\hspace{0.1cm}}', rep('@{\\hspace{0.4cm}}', 6), '@{\\hspace{0.1cm}}'))
>
> I do get the following output:
>
> % latex table generated in R 2.5.0 by xtable 1.4-3 package
> % Fri Apr 27 13:19:43 2007
> \begin{table}[ht]
> \begin{center}
> \begin{tabular}{rll}
>  \hline
> & big & normal \\
>  \hline
> green & $\backslash$color\{green\}$\backslash$textbf\{big green\} & $\backslash$color\{green\}green \\
>  red & $\backslash$color\{red\}$\backslash$textbf\{big red\} & $\backslash$color\{red\}red \\
>   \hline
> \end{tabular}
> \end{center}
> \end{table}
>
>
> Please, note that the curly braces are prefixed with a backslash and the 
> double backslashes are interpreted as math backslashes. The above code 
> snippet worked fine in R 2.4.1 and I reckon that this behaviour might be 
> due to:
>
> o	There is a warning if \ is used unnecessarily in a string when
> 	being parsed, e.g. "\." where probably "\\." was intended.
> 	("\." is valid, but the same as ".".)  Thanks to Bill Dunlap
> 	for the suggestion.

How can a warning that you are not showing (and I don't see when running 
your code) have anything to do with this?  That change is just to add a 
warning: there is no change in the parsed code.

I get the same behaviour in 2.4.1 with xtable 1.4-3.  Have you 
perhaps updated 'xtable' as well as R and are blaming R for an 'xtable' 
change?  As ?print.xtable says

      From version 1.4-3, all non-numeric columns are sanitized, and all
      LaTeX special characters are sanitised for LaTeX output. See the
      vignette for an example of customising the sanitization.

[...]

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Bernhard_Pfaff at fra.invesco.com  Fri Apr 27 14:42:38 2007
From: Bernhard_Pfaff at fra.invesco.com (Pfaff, Bernhard Dr.)
Date: Fri, 27 Apr 2007 13:42:38 +0100
Subject: [Rd] Problem with formatted xtable in R 2.5.0
In-Reply-To: <Pine.LNX.4.64.0704271243460.16553@gannet.stats.ox.ac.uk>
References: <E4A9111DA23BA048B9A46686BF727CF4010BCA29@DEFRAXMB01.corp.amvescap.net>
	<Pine.LNX.4.64.0704271243460.16553@gannet.stats.ox.ac.uk>
Message-ID: <E4A9111DA23BA048B9A46686BF727CF4010BCA77@DEFRAXMB01.corp.amvescap.net>

>I get the same behaviour in 2.4.1 with xtable 1.4-3.  Have you 
>perhaps updated 'xtable' as well as R and are blaming R for an 
>'xtable' 
>change?  As ?print.xtable says
>
>      From version 1.4-3, all non-numeric columns are 
>sanitized, and all
>      LaTeX special characters are sanitised for LaTeX output. See the
>      vignette for an example of customising the sanitization.
>

Dear Prof. Ripley,

many thanks for your swift reply and - as usual - you are dead right
about your conclusion: 
I was not aware of sanitization introduced in 1.4-3 and prior to 2.5.0 I
used an older version of xtable with 2.4.1, although it was not my
intention to blame anybody, except myself now for not having done my
homework properly - flush.

Best,
Bernhard 


>[...]
>
>-- 
>Brian D. Ripley,                  ripley at stats.ox.ac.uk
>Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>University of Oxford,             Tel:  +44 1865 272861 (self)
>1 South Parks Road,                     +44 1865 272866 (PA)
>Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
*****************************************************************
Confidentiality Note: The information contained in this mess...{{dropped}}


From edd at debian.org  Fri Apr 27 15:35:35 2007
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 27 Apr 2007 08:35:35 -0500
Subject: [Rd] How to suppress 'Loading required package ...' via
	Depends/Imports
Message-ID: <17969.64551.962449.586155@basebud.nulle.part>


I tend to run batch jobs via littler. These often start with a single line
loading one or two in-house packages.  Now, most the Depends of these
in-house packages now use Depends: entries in DESCRIPTION, rather than
require() in R/zzz.R.  This seems to have at least one undesirable side
effect: noise.

Using require(), I can choose the 'quietly=TRUE, warn.conflict=FALSE'
arguments, and additionally I can wrap the require call in stopfifnot()
making it both quiet and failure proof. 

But I cannot figure out how to tell R via DESCRIPTION how to 
  a) not tell me its loading a package
  b) keep quiet about the conflicts

In other words, how do I get rid of all this:

  foo:~s> ./someLittlerScript
  Loading required package: MASS
  Loading required package: grDevices
  Loading required package: graphics
  Loading required package: stats
  Loading required package: utils
  Loading required package: zoo

  Attaching package: 'zoo'


          The following object(s) are masked from package:base :

           rapply

Thanks, Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From ripley at stats.ox.ac.uk  Fri Apr 27 16:10:42 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 27 Apr 2007 15:10:42 +0100 (BST)
Subject: [Rd] How to suppress 'Loading required package ...' via
 Depends/Imports
In-Reply-To: <17969.64551.962449.586155@basebud.nulle.part>
References: <17969.64551.962449.586155@basebud.nulle.part>
Message-ID: <Pine.LNX.4.64.0704271506170.29708@gannet.stats.ox.ac.uk>

See ?suppressMessages

I did:

> suppressPackageStartupMessages(library("mboost"))

and saw no messages at all in 2.5.0.  (And that is one of the noisiest.)


On Fri, 27 Apr 2007, Dirk Eddelbuettel wrote:

>
> I tend to run batch jobs via littler. These often start with a single line
> loading one or two in-house packages.  Now, most the Depends of these
> in-house packages now use Depends: entries in DESCRIPTION, rather than
> require() in R/zzz.R.  This seems to have at least one undesirable side
> effect: noise.
>
> Using require(), I can choose the 'quietly=TRUE, warn.conflict=FALSE'
> arguments, and additionally I can wrap the require call in stopfifnot()
> making it both quiet and failure proof.
>
> But I cannot figure out how to tell R via DESCRIPTION how to
>  a) not tell me its loading a package
>  b) keep quiet about the conflicts
>
> In other words, how do I get rid of all this:
>
>  foo:~s> ./someLittlerScript
>  Loading required package: MASS
>  Loading required package: grDevices
>  Loading required package: graphics
>  Loading required package: stats
>  Loading required package: utils
>  Loading required package: zoo
>
>  Attaching package: 'zoo'
>
>
>          The following object(s) are masked from package:base :
>
>           rapply
>
> Thanks, Dirk
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From r.hankin at noc.soton.ac.uk  Fri Apr 27 16:13:09 2007
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Fri, 27 Apr 2007 15:13:09 +0100
Subject: [Rd] system() in packages
Message-ID: <3E7A71D7-49A5-4C2E-A365-9D2387D76D3B@soc.soton.ac.uk>

Hello

Quite often I need higher precision, or larger numbers,
  than IEEE double precision allows.  One strategy I sometimes
use is to use system() to call pari/gp, which is not constrained by  
IEEE.

[pari/gp is a GPL high-level mathematical programming language
geared towards pure mathematics]

Two of my packages contain lines like the following:

 > system(" echo '1.12^66' | gp -q f",intern=TRUE)
[1]  
"1771.697189476241729649767636564084681203806302318041262248838950177194 
116346432205160921568393661760"

Note the high precision of the answer.

My question is, how to deal with the possibility that pari/gp is not
installed?

If the system cannot find gp for some reason, I get:

 > system(" echo '1.12^66' | gp -q f",intern=TRUE)
sh: line 1: gp: command not found
character(0)
 >

What's the recommended way to handle this eventuality gracefully?  The
functions that do use pari/gp have "pure" R equivalents (but much
slower and less accurate)  so I want users to be able to install the
package without pari/gp.


--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From ripley at stats.ox.ac.uk  Fri Apr 27 16:20:24 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 27 Apr 2007 15:20:24 +0100 (BST)
Subject: [Rd] system() in packages
In-Reply-To: <3E7A71D7-49A5-4C2E-A365-9D2387D76D3B@soc.soton.ac.uk>
References: <3E7A71D7-49A5-4C2E-A365-9D2387D76D3B@soc.soton.ac.uk>
Message-ID: <Pine.LNX.4.64.0704271517120.29708@gannet.stats.ox.ac.uk>

The first comment is that will only work on Unix-alikes, since '|' needs a 
shell.

So, if this is on a Unix-alike you need to establish if the program is in 
the path at run time and cache the result.  I have no idea if this would 
actually work, but for example system('gp --version') might provide a 
suitable test.

On Fri, 27 Apr 2007, Robin Hankin wrote:

> Hello
>
> Quite often I need higher precision, or larger numbers,
>  than IEEE double precision allows.  One strategy I sometimes
> use is to use system() to call pari/gp, which is not constrained by
> IEEE.
>
> [pari/gp is a GPL high-level mathematical programming language
> geared towards pure mathematics]
>
> Two of my packages contain lines like the following:
>
> > system(" echo '1.12^66' | gp -q f",intern=TRUE)
> [1]
> "1771.697189476241729649767636564084681203806302318041262248838950177194
> 116346432205160921568393661760"
>
> Note the high precision of the answer.
>
> My question is, how to deal with the possibility that pari/gp is not
> installed?
>
> If the system cannot find gp for some reason, I get:
>
> > system(" echo '1.12^66' | gp -q f",intern=TRUE)
> sh: line 1: gp: command not found
> character(0)
> >
>
> What's the recommended way to handle this eventuality gracefully?  The
> functions that do use pari/gp have "pure" R equivalents (but much
> slower and less accurate)  so I want users to be able to install the
> package without pari/gp.
>
>
> --
> Robin Hankin
> Uncertainty Analyst
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>  tel  023-8059-7743
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From edd at debian.org  Fri Apr 27 16:47:19 2007
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 27 Apr 2007 09:47:19 -0500
Subject: [Rd] How to suppress 'Loading required package ...' via
	Depends/Imports
In-Reply-To: <Pine.LNX.4.64.0704271506170.29708@gannet.stats.ox.ac.uk>
References: <17969.64551.962449.586155@basebud.nulle.part>
	<Pine.LNX.4.64.0704271506170.29708@gannet.stats.ox.ac.uk>
Message-ID: <20070427144719.GA24236@eddelbuettel.com>

On Fri, Apr 27, 2007 at 03:10:42PM +0100, Prof Brian Ripley wrote:
> See ?suppressMessages
> 
> I did:
> 
> >suppressPackageStartupMessages(library("mboost"))
> 
> and saw no messages at all in 2.5.0.  (And that is one of the noisiest.)

Oh, dang, and I know you had in fact told me about this before. Sorry
for my additional noise.  I still have R 2.4.1 on my main server as a
co-worker wants to wait for 2.5.1 before upgrading that box ...

One additional request if I may: some sort of pointer from the
library(), require(), INSTALL, ... manual page so that I'll find this
next time I forget.

Lastly, a nit:  it doesn't _fully_ do it as it still issues a 

  Loading required package: methods

when invoked...  But I guess I may as well load methods from my R
startup files.

Thanks, Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From edd at debian.org  Fri Apr 27 16:54:18 2007
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 27 Apr 2007 09:54:18 -0500
Subject: [Rd] How to suppress 'Loading required package ...' via
	Depends/Imports
In-Reply-To: <20070427144719.GA24236@eddelbuettel.com>
References: <17969.64551.962449.586155@basebud.nulle.part>
	<Pine.LNX.4.64.0704271506170.29708@gannet.stats.ox.ac.uk>
	<20070427144719.GA24236@eddelbuettel.com>
Message-ID: <20070427145418.GA24349@eddelbuettel.com>

On Fri, Apr 27, 2007 at 09:47:19AM -0500, Dirk Eddelbuettel wrote:
> On Fri, Apr 27, 2007 at 03:10:42PM +0100, Prof Brian Ripley wrote:
> Lastly, a nit:  it doesn't _fully_ do it as it still issues a 
> 
>   Loading required package: methods
> 
> when invoked...  But I guess I may as well load methods from my R
> startup files.

Correction: This appears to be an undocumented littler 'feature' Jeff
and I will have to address by making littler load methods...

Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From sfalcon at fhcrc.org  Fri Apr 27 17:01:53 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Fri, 27 Apr 2007 08:01:53 -0700
Subject: [Rd] system() in packages
In-Reply-To: <3E7A71D7-49A5-4C2E-A365-9D2387D76D3B@soc.soton.ac.uk> (Robin
	Hankin's message of "Fri, 27 Apr 2007 15:13:09 +0100")
References: <3E7A71D7-49A5-4C2E-A365-9D2387D76D3B@soc.soton.ac.uk>
Message-ID: <m2ejm5oo7y.fsf@ziti.fhcrc.org>

Robin Hankin <r.hankin at noc.soton.ac.uk> writes:
> My question is, how to deal with the possibility that pari/gp is not
> installed?

You could add a configure script to your package to detect the
availability of the tools you want to rely on.

On package load, you could try a simple call and determine whether it
errored out or not and set action based on that.

+ seth

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From tplate at acm.org  Fri Apr 27 17:08:21 2007
From: tplate at acm.org (Tony Plate)
Date: Fri, 27 Apr 2007 09:08:21 -0600
Subject: [Rd] system() in packages
In-Reply-To: <Pine.LNX.4.64.0704271517120.29708@gannet.stats.ox.ac.uk>
References: <3E7A71D7-49A5-4C2E-A365-9D2387D76D3B@soc.soton.ac.uk>
	<Pine.LNX.4.64.0704271517120.29708@gannet.stats.ox.ac.uk>
Message-ID: <463211E5.6030208@acm.org>

With cygwin bash installed under Windows, one can use pipes in system(), 
e.g., like this:

R 2.5.0 under Windows XP:
 > system("echo foo | sed s/foo/bar/") # this doesn't work under windows
foo | sed s/foo/bar/
 > # but using 'bash -c' does:
 > system("bash -c \"echo foo | sed s/foo/bar/\"")
bar
 > # and some use of quotes within the command actually works!
 > system("bash -c \"echo foo | sed 's/foo/bar rrr/'\"")
bar rrr
 >

[Beware: complex quoting inside the -c command can be difficult to get 
right.]

-- Tony Plate


Prof Brian Ripley wrote:
> The first comment is that will only work on Unix-alikes, since '|' needs a 
> shell.
> 
> So, if this is on a Unix-alike you need to establish if the program is in 
> the path at run time and cache the result.  I have no idea if this would 
> actually work, but for example system('gp --version') might provide a 
> suitable test.
> 
> On Fri, 27 Apr 2007, Robin Hankin wrote:
> 
>> Hello
>>
>> Quite often I need higher precision, or larger numbers,
>>  than IEEE double precision allows.  One strategy I sometimes
>> use is to use system() to call pari/gp, which is not constrained by
>> IEEE.
>>
>> [pari/gp is a GPL high-level mathematical programming language
>> geared towards pure mathematics]
>>
>> Two of my packages contain lines like the following:
>>
>>> system(" echo '1.12^66' | gp -q f",intern=TRUE)
>> [1]
>> "1771.697189476241729649767636564084681203806302318041262248838950177194
>> 116346432205160921568393661760"
>>
>> Note the high precision of the answer.
>>
>> My question is, how to deal with the possibility that pari/gp is not
>> installed?
>>
>> If the system cannot find gp for some reason, I get:
>>
>>> system(" echo '1.12^66' | gp -q f",intern=TRUE)
>> sh: line 1: gp: command not found
>> character(0)
>> What's the recommended way to handle this eventuality gracefully?  The
>> functions that do use pari/gp have "pure" R equivalents (but much
>> slower and less accurate)  so I want users to be able to install the
>> package without pari/gp.
>>
>>
>> --
>> Robin Hankin
>> Uncertainty Analyst
>> National Oceanography Centre, Southampton
>> European Way, Southampton SO14 3ZH, UK
>>  tel  023-8059-7743
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From a.lobley at ucl.ac.uk  Fri Apr 27 16:24:25 2007
From: a.lobley at ucl.ac.uk (Anna Lobley)
Date: Fri, 27 Apr 2007 15:24:25 +0100
Subject: [Rd] R-2.5.0 install
Message-ID: <46320799.8010606@ucl.ac.uk>

I am receiving the following errors when trying to install
gcrma and a number of other Bioconductor packages when
the installWithVers flag is set to be TRUE.

 >source("http://www.bioconductor.org/getBioC.R");
 >getBioC("gcrma", installWithVers=T);
Running biocinstall version 2.0.7 with R version 2.5.0
Your version of R requires version 2.0 of Bioconductor.

Loading required package: affy
Loading required package: Biobase
Loading required package: affy
Loading required package: Biobase
Loading required package: affy
Loading required package: Biobase
Loading required package: affy
Loading required package: Biobase
Loading required package: affy
Loading required package: Biobase
Loading required package: affy
Loading required package: Biobase.... etc etc.....

Error: evaluation nested too deeply: infinite recursion / 
options(expressions=)?
Execution halted
ERROR: lazy loading failed for package 'gcrma'
** Removing 'R-2.5.0/library/gcrma_2.8.0'


Session Info below:
R version 2.5.0 (2007-04-23)
i686-pc-linux-gnu
 
locale:
LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;LC_COLLATE=en_GB.UTF-8;LC_MONETARY=en_GB.UTF-8;LC_MESSAGES=en_GB.UTF-8;LC_PAPER=en_GB.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_GB.UTF-8;LC_IDENTIFICATION=C

any help appreciated..
Anna


From g.abraham at ms.unimelb.edu.au  Fri Apr 27 10:37:10 2007
From: g.abraham at ms.unimelb.edu.au (Gad Abraham)
Date: Fri, 27 Apr 2007 18:37:10 +1000
Subject: [Rd] Error: An unusual circumstance has arisen in the nesting of
 readline input
Message-ID: <4631B636.6000005@ms.unimelb.edu.au>

Hi,

If I have warnings converted to errors, and if I plot a simple plot and 
then resize and move the plot's window many times, I eventually get an 
error "Display list redraw incomplete", and after a while an endlessly 
repeating error "An unusual circumstance has arisen in the nesting of 
readline input".

I cannot stop it using Ctrl-C (Ctrl-Z works though).

I'm using R 2.5.0 inside a gnome-terminal on Ubuntu Dapper. See more 
details below.

Thanks,
Gad



 > options(warn=2)
 >
 > sessionInfo()
R version 2.5.0 (2007-04-23)
i486-pc-linux-gnu

locale:
LC_CTYPE=en_AU.UTF-8;LC_NUMERIC=C;LC_TIME=en_AU.UTF-8;LC_COLLATE=en_AU.UTF-8;LC_MONETARY=en_AU.UTF-8;LC_MESSAGES=en_AU.UTF-8;LC_PAPER=en_AU.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_AU.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
[7] "base"
 >
 > plot(rnorm(1000))
 > Error: (converted from warning) Display list redraw incomplete
 > Error: (converted from warning) Display list redraw incomplete
 > Error: (converted from warning) Display list redraw incomplete
 > Error: (converted from warning) Display list redraw incomplete
 > Error: (converted from warning) Display list redraw incomplete
 > Error: (converted from warning) Display list redraw incomplete
 > Error: (converted from warning) Display list redraw incomplete
 > Error: (converted from warning) Display list redraw incomplete
 > Error: (converted from warning) Display list redraw incomplete
 > Error: (converted from warning) Display list redraw incomplete
Error: (converted from warning) An unusual circumstance has arisen in 
the nesting of readline input. Please report using bug.report()
Error: (converted from warning) An unusual circumstance has arisen in 
the nesting of readline input. Please report using bug.report()
Error: (converted from warning) An unusual circumstance has arisen in 
the nesting of readline input. Please report using bug.report()
Error: (converted from warning) An unusual circumstance has arisen in 
the nesting of readline input. Please report using bug.report()
Error: (converted from warning) An unusual circumstance has arisen in 
the nesting of readline input. Please report using bug.report()

...

-- 
Gad Abraham
Department of Mathematics and Statistics
The University of Melbourne
Parkville 3010, Victoria, Australia
email: g.abraham at ms.unimelb.edu.au
web: http://www.ms.unimelb.edu.au/~gabraham


From sdavis2 at mail.nih.gov  Fri Apr 27 17:13:31 2007
From: sdavis2 at mail.nih.gov (Sean Davis)
Date: Fri, 27 Apr 2007 11:13:31 -0400
Subject: [Rd] R-2.5.0 install
In-Reply-To: <46320799.8010606@ucl.ac.uk>
References: <46320799.8010606@ucl.ac.uk>
Message-ID: <4632131B.2020607@mail.nih.gov>

Anna Lobley wrote:
> I am receiving the following errors when trying to install
> gcrma and a number of other Bioconductor packages when
> the installWithVers flag is set to be TRUE.
>
>  >source("http://www.bioconductor.org/getBioC.R");
>  >getBioC("gcrma", installWithVers=T);
>   
Hi, Anna.  You will probably want to follow the instructions here:

http://bioconductor.org/docs/install-howto.html

Sean


From ggrothendieck at gmail.com  Fri Apr 27 17:34:21 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 27 Apr 2007 11:34:21 -0400
Subject: [Rd] parsing difference between 2.4.1 and 2.5.0
Message-ID: <971536df0704270834o35b9b7f4vd769b477f8b06b50@mail.gmail.com>

I noticed the following difference in parse(text = ...) between R
2.4.1 and R 2.5.0.

===

> parse(text = "\"^\" (x ,2 )")
expression(x^2)
> R.version.string
[1] "R version 2.4.1 Patched (2006-12-30 r40331)"


====

> parse(text = "\"^\" (x ,2 )")
expression("^" (x ,2 ))
> R.version.string
[1] "R version 2.5.0 RC (2007-04-16 r41194)"

====

Ryacas was depending on the behavior in R 2.4.1 so the new
behavior breaks it.

Is this intentional?  a bug?  How do I get the R 2.4.1 output
from R 2.5.0 ?


From ggrothendieck at gmail.com  Fri Apr 27 17:38:34 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 27 Apr 2007 11:38:34 -0400
Subject: [Rd] system() in packages
In-Reply-To: <463211E5.6030208@acm.org>
References: <3E7A71D7-49A5-4C2E-A365-9D2387D76D3B@soc.soton.ac.uk>
	<Pine.LNX.4.64.0704271517120.29708@gannet.stats.ox.ac.uk>
	<463211E5.6030208@acm.org>
Message-ID: <971536df0704270838j4cf3abb3p768ec6b26beff76b@mail.gmail.com>

One can use the R shell on Windows:

   shell("echo foo.bar | findstr foo")

or an explicit call to the Windows cmd console:

  system("cmd /c echo foo.bar | findstr foo")


On 4/27/07, Tony Plate <tplate at acm.org> wrote:
> With cygwin bash installed under Windows, one can use pipes in system(),
> e.g., like this:
>
> R 2.5.0 under Windows XP:
>  > system("echo foo | sed s/foo/bar/") # this doesn't work under windows
> foo | sed s/foo/bar/
>  > # but using 'bash -c' does:
>  > system("bash -c \"echo foo | sed s/foo/bar/\"")
> bar
>  > # and some use of quotes within the command actually works!
>  > system("bash -c \"echo foo | sed 's/foo/bar rrr/'\"")
> bar rrr
>  >
>
> [Beware: complex quoting inside the -c command can be difficult to get
> right.]
>
> -- Tony Plate
>
>
> Prof Brian Ripley wrote:
> > The first comment is that will only work on Unix-alikes, since '|' needs a
> > shell.
> >
> > So, if this is on a Unix-alike you need to establish if the program is in
> > the path at run time and cache the result.  I have no idea if this would
> > actually work, but for example system('gp --version') might provide a
> > suitable test.
> >
> > On Fri, 27 Apr 2007, Robin Hankin wrote:
> >
> >> Hello
> >>
> >> Quite often I need higher precision, or larger numbers,
> >>  than IEEE double precision allows.  One strategy I sometimes
> >> use is to use system() to call pari/gp, which is not constrained by
> >> IEEE.
> >>
> >> [pari/gp is a GPL high-level mathematical programming language
> >> geared towards pure mathematics]
> >>
> >> Two of my packages contain lines like the following:
> >>
> >>> system(" echo '1.12^66' | gp -q f",intern=TRUE)
> >> [1]
> >> "1771.697189476241729649767636564084681203806302318041262248838950177194
> >> 116346432205160921568393661760"
> >>
> >> Note the high precision of the answer.
> >>
> >> My question is, how to deal with the possibility that pari/gp is not
> >> installed?
> >>
> >> If the system cannot find gp for some reason, I get:
> >>
> >>> system(" echo '1.12^66' | gp -q f",intern=TRUE)
> >> sh: line 1: gp: command not found
> >> character(0)
> >> What's the recommended way to handle this eventuality gracefully?  The
> >> functions that do use pari/gp have "pure" R equivalents (but much
> >> slower and less accurate)  so I want users to be able to install the
> >> package without pari/gp.
> >>
> >>
> >> --
> >> Robin Hankin
> >> Uncertainty Analyst
> >> National Oceanography Centre, Southampton
> >> European Way, Southampton SO14 3ZH, UK
> >>  tel  023-8059-7743
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Fri Apr 27 18:14:22 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 27 Apr 2007 17:14:22 +0100 (BST)
Subject: [Rd] system() in packages
In-Reply-To: <463211E5.6030208@acm.org>
References: <3E7A71D7-49A5-4C2E-A365-9D2387D76D3B@soc.soton.ac.uk>
	<Pine.LNX.4.64.0704271517120.29708@gannet.stats.ox.ac.uk>
	<463211E5.6030208@acm.org>
Message-ID: <Pine.LNX.4.64.0704271707160.24554@gannet.stats.ox.ac.uk>

You have missed the point completely.

There is no way you can use the same command on a Unix-alike and Windows,
so using system() in packages always needs to be conditionalized on OS.

If you want to use a shell on Windows, use shell(): you can even use bash 
with it (but startup will be really slow on Windows): the sh.exe in the 
Rtools toolkit is much lighter weight.


On Fri, 27 Apr 2007, Tony Plate wrote:

> With cygwin bash installed under Windows, one can use pipes in system(),
> e.g., like this:
>
> R 2.5.0 under Windows XP:
> > system("echo foo | sed s/foo/bar/") # this doesn't work under windows
> foo | sed s/foo/bar/
> > # but using 'bash -c' does:
> > system("bash -c \"echo foo | sed s/foo/bar/\"")
> bar
> > # and some use of quotes within the command actually works!
> > system("bash -c \"echo foo | sed 's/foo/bar rrr/'\"")
> bar rrr
> >
>
> [Beware: complex quoting inside the -c command can be difficult to get
> right.]
>
> -- Tony Plate
>
>
> Prof Brian Ripley wrote:
>> The first comment is that will only work on Unix-alikes, since '|' needs a
>> shell.
>>
>> So, if this is on a Unix-alike you need to establish if the program is in
>> the path at run time and cache the result.  I have no idea if this would
>> actually work, but for example system('gp --version') might provide a
>> suitable test.
>>
>> On Fri, 27 Apr 2007, Robin Hankin wrote:
>>
>>> Hello
>>>
>>> Quite often I need higher precision, or larger numbers,
>>>  than IEEE double precision allows.  One strategy I sometimes
>>> use is to use system() to call pari/gp, which is not constrained by
>>> IEEE.
>>>
>>> [pari/gp is a GPL high-level mathematical programming language
>>> geared towards pure mathematics]
>>>
>>> Two of my packages contain lines like the following:
>>>
>>>> system(" echo '1.12^66' | gp -q f",intern=TRUE)
>>> [1]
>>> "1771.697189476241729649767636564084681203806302318041262248838950177194
>>> 116346432205160921568393661760"
>>>
>>> Note the high precision of the answer.
>>>
>>> My question is, how to deal with the possibility that pari/gp is not
>>> installed?
>>>
>>> If the system cannot find gp for some reason, I get:
>>>
>>>> system(" echo '1.12^66' | gp -q f",intern=TRUE)
>>> sh: line 1: gp: command not found
>>> character(0)
>>> What's the recommended way to handle this eventuality gracefully?  The
>>> functions that do use pari/gp have "pure" R equivalents (but much
>>> slower and less accurate)  so I want users to be able to install the
>>> package without pari/gp.
>>>
>>>
>>> --
>>> Robin Hankin
>>> Uncertainty Analyst
>>> National Oceanography Centre, Southampton
>>> European Way, Southampton SO14 3ZH, UK
>>>  tel  023-8059-7743
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sfalcon at fhcrc.org  Fri Apr 27 18:40:10 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Fri, 27 Apr 2007 09:40:10 -0700
Subject: [Rd] R-2.5.0 install
In-Reply-To: <4632131B.2020607@mail.nih.gov> (Sean Davis's message of "Fri,
	27 Apr 2007 11:13:31 -0400")
References: <46320799.8010606@ucl.ac.uk> <4632131B.2020607@mail.nih.gov>
Message-ID: <m21wi5ojo5.fsf@ziti.fhcrc.org>

Sean Davis <sdavis2 at mail.nih.gov> writes:

> Anna Lobley wrote:
>> I am receiving the following errors when trying to install
>> gcrma and a number of other Bioconductor packages when
>> the installWithVers flag is set to be TRUE.
>>
>>  >source("http://www.bioconductor.org/getBioC.R");
>>  >getBioC("gcrma", installWithVers=T);
>>   
> Hi, Anna.  You will probably want to follow the instructions here:
>
> http://bioconductor.org/docs/install-howto.html

Actually, getBioC and biocLite are fairly straight forward wrappers to
install.packages.  They pass '...' arguments to install.packages and
so Anna's use of installWithVers is valid and expected to work.

And for me it does.

Anna, can you try the following:

      rep = "http://bioconductor.org/packages/2.0/bioc"
      install.packages("Biobase", repos=rep, installWithVers=TRUE)

I would also be curious to understand your motivation for wanting
installWithVers.  BioC packages are developed for a particular R
release and in general I would not expect BioC packages developed
older R's to work with current R's.

+ seth

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From murdoch at stats.uwo.ca  Fri Apr 27 18:55:10 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 27 Apr 2007 12:55:10 -0400
Subject: [Rd] parsing difference between 2.4.1 and 2.5.0
In-Reply-To: <971536df0704270834o35b9b7f4vd769b477f8b06b50@mail.gmail.com>
References: <971536df0704270834o35b9b7f4vd769b477f8b06b50@mail.gmail.com>
Message-ID: <46322AEE.60100@stats.uwo.ca>

On 4/27/2007 11:34 AM, Gabor Grothendieck wrote:
> I noticed the following difference in parse(text = ...) between R
> 2.4.1 and R 2.5.0.
> 
> ===
> 
>> parse(text = "\"^\" (x ,2 )")
> expression(x^2)
>> R.version.string
> [1] "R version 2.4.1 Patched (2006-12-30 r40331)"
> 
> 
> ====
> 
>> parse(text = "\"^\" (x ,2 )")
> expression("^" (x ,2 ))
>> R.version.string
> [1] "R version 2.5.0 RC (2007-04-16 r41194)"
> 
> ====
> 
> Ryacas was depending on the behavior in R 2.4.1 so the new
> behavior breaks it.
> 
> Is this intentional?  a bug?  How do I get the R 2.4.1 output
> from R 2.5.0 ?

There's no difference in the parsing, the difference is in the printing. 
  By default 2.5.0 will echo what you typed, whereas 2.4.1 will deparse. 
  You can get the 2.4.1 behaviour using options(keep.source=F) or 
parse(text = "\"^\" (x ,2 )", srcfile=NULL) (as ?parse says).

Duncan Murdoch


From sfalcon at fhcrc.org  Fri Apr 27 19:03:36 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Fri, 27 Apr 2007 10:03:36 -0700
Subject: [Rd] R-2.5.0 install
In-Reply-To: <m21wi5ojo5.fsf@ziti.fhcrc.org> (Seth Falcon's message of "Fri,
	27 Apr 2007 09:40:10 -0700")
References: <46320799.8010606@ucl.ac.uk> <4632131B.2020607@mail.nih.gov>
	<m21wi5ojo5.fsf@ziti.fhcrc.org>
Message-ID: <m2fy6ln40n.fsf@ziti.fhcrc.org>

Update:

Seth Falcon <sfalcon at fhcrc.org> writes:
> And for me it does.

Almost.  With a clean package library, I end up with an error
installing matchprobes because library.dynam can't find a shared
library called matchprobes_1.8.0.  Since other packages that have
native code are installing with version ok, I suspect this is a
fixable bug in matchprobes.

Anna, if you still are having problems, we need more detail about what
packages are already installed, loaded, etc.  It might make sense to
try this with fresh library... on Linux this might look like:

      mkdir TMPLIB1
      export R_LIBS=`pwd`/TMPLIB1
      R
      source("http://biocondcutor.org/biocLite.R")
      biocLite("gcrma", installWithVers=TRUE)

But depending on your setup, you may want to instect the output of
.libPaths() to see if you are picking up other libraries.

+ seth

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From murdoch at stats.uwo.ca  Fri Apr 27 19:06:10 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 27 Apr 2007 13:06:10 -0400
Subject: [Rd] parsing difference between 2.4.1 and 2.5.0
In-Reply-To: <46322AEE.60100@stats.uwo.ca>
References: <971536df0704270834o35b9b7f4vd769b477f8b06b50@mail.gmail.com>
	<46322AEE.60100@stats.uwo.ca>
Message-ID: <46322D82.6030108@stats.uwo.ca>

On 4/27/2007 12:55 PM, Duncan Murdoch wrote:
> On 4/27/2007 11:34 AM, Gabor Grothendieck wrote:
>> I noticed the following difference in parse(text = ...) between R
>> 2.4.1 and R 2.5.0.
>> 
>> ===
>> 
>>> parse(text = "\"^\" (x ,2 )")
>> expression(x^2)
>>> R.version.string
>> [1] "R version 2.4.1 Patched (2006-12-30 r40331)"
>> 
>> 
>> ====
>> 
>>> parse(text = "\"^\" (x ,2 )")
>> expression("^" (x ,2 ))
>>> R.version.string
>> [1] "R version 2.5.0 RC (2007-04-16 r41194)"
>> 
>> ====
>> 
>> Ryacas was depending on the behavior in R 2.4.1 so the new
>> behavior breaks it.
>> 
>> Is this intentional?  a bug?  How do I get the R 2.4.1 output
>> from R 2.5.0 ?
> 
> There's no difference in the parsing, 

This isn't quite true, of course:  in 2.5.0 the default parse output 
includes an attribute that references the original source.  I think the 
rest of what I wrote is right:

the difference is in the printing.
>   By default 2.5.0 will echo what you typed, whereas 2.4.1 will deparse. 
>   You can get the 2.4.1 behaviour using options(keep.source=F) or 
> parse(text = "\"^\" (x ,2 )", srcfile=NULL) (as ?parse says).
> 
> Duncan Murdoch
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ggrothendieck at gmail.com  Fri Apr 27 19:51:30 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 27 Apr 2007 13:51:30 -0400
Subject: [Rd] parsing difference between 2.4.1 and 2.5.0
In-Reply-To: <46322AEE.60100@stats.uwo.ca>
References: <971536df0704270834o35b9b7f4vd769b477f8b06b50@mail.gmail.com>
	<46322AEE.60100@stats.uwo.ca>
Message-ID: <971536df0704271051q6a4307f2k90d0e7415699d255@mail.gmail.com>

Thanks, that did it.

On 4/27/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 4/27/2007 11:34 AM, Gabor Grothendieck wrote:
> > I noticed the following difference in parse(text = ...) between R
> > 2.4.1 and R 2.5.0.
> >
> > ===
> >
> >> parse(text = "\"^\" (x ,2 )")
> > expression(x^2)
> >> R.version.string
> > [1] "R version 2.4.1 Patched (2006-12-30 r40331)"
> >
> >
> > ====
> >
> >> parse(text = "\"^\" (x ,2 )")
> > expression("^" (x ,2 ))
> >> R.version.string
> > [1] "R version 2.5.0 RC (2007-04-16 r41194)"
> >
> > ====
> >
> > Ryacas was depending on the behavior in R 2.4.1 so the new
> > behavior breaks it.
> >
> > Is this intentional?  a bug?  How do I get the R 2.4.1 output
> > from R 2.5.0 ?
>
> There's no difference in the parsing, the difference is in the printing.
>  By default 2.5.0 will echo what you typed, whereas 2.4.1 will deparse.
>  You can get the 2.4.1 behaviour using options(keep.source=F) or
> parse(text = "\"^\" (x ,2 )", srcfile=NULL) (as ?parse says).
>
> Duncan Murdoch
>


From ripley at stats.ox.ac.uk  Fri Apr 27 19:52:03 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 27 Apr 2007 18:52:03 +0100 (BST)
Subject: [Rd] R-2.5.0 install
In-Reply-To: <m2fy6ln40n.fsf@ziti.fhcrc.org>
References: <46320799.8010606@ucl.ac.uk> <4632131B.2020607@mail.nih.gov>
	<m21wi5ojo5.fsf@ziti.fhcrc.org> <m2fy6ln40n.fsf@ziti.fhcrc.org>
Message-ID: <Pine.LNX.4.64.0704271839510.25586@gannet.stats.ox.ac.uk>

On Fri, 27 Apr 2007, Seth Falcon wrote:

> Update:
>
> Seth Falcon <sfalcon at fhcrc.org> writes:
>> And for me it does.
>
> Almost.  With a clean package library, I end up with an error
> installing matchprobes because library.dynam can't find a shared
> library called matchprobes_1.8.0.  Since other packages that have
> native code are installing with version ok, I suspect this is a
> fixable bug in matchprobes.

Indeed it is.  The package has

.First.lib <- function(lib, pkgname, where) {
   ## load the compiled code
   library.dynam(pkgname, pkgname, lib)

and that should be

   library.dynam("matchprobes", pkgname, lib)

(That's not an uncommon mistake, BTW: EBarrays, puma and twilight of BioC 
seem to share it.)

Also, .First.lib will only ever tbe called with two args, and 'where' is 
unused.

BTW, I have BioC-1.9 and BioC-2.0 in separate library trees rather than 
use versioned installs: although the idea and code for the latter came 
from the BioC group, they are little used and have some rough edges.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From pgilbert at bank-banque-canada.ca  Fri Apr 27 20:42:00 2007
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 27 Apr 2007 14:42:00 -0400
Subject: [Rd] Namespace dependencies not required:
Message-ID: <463243F8.6040402@bank-banque-canada.ca>

I would like to suggest a wording change in the message

* checking package dependencies ... ERROR
Namespace dependencies not required:
  DBI methods

Since the intended meaning seem to be almost exactly the opposite (I 
think, judging by what seems to work), it would be better to say

Namespace dependencies required in Imports:
or
Namespace dependencies not indicated in Imports:

or, perhaps one of these is necessary:

Namespace dependencies not indicated in Depends:
or
Namespace dependencies not indicated by Depends, Suggests, or Imports:

Paul Gilbert
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From sfalcon at fhcrc.org  Fri Apr 27 20:58:48 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Fri, 27 Apr 2007 11:58:48 -0700
Subject: [Rd] R-2.5.0 install
In-Reply-To: <Pine.LNX.4.64.0704271839510.25586@gannet.stats.ox.ac.uk> (Brian
	Ripley's message of "Fri, 27 Apr 2007 18:52:03 +0100 (BST)")
References: <46320799.8010606@ucl.ac.uk> <4632131B.2020607@mail.nih.gov>
	<m21wi5ojo5.fsf@ziti.fhcrc.org> <m2fy6ln40n.fsf@ziti.fhcrc.org>
	<Pine.LNX.4.64.0704271839510.25586@gannet.stats.ox.ac.uk>
Message-ID: <m27irxk5jr.fsf@ziti.fhcrc.org>

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
> Indeed it is.  The package has
>
> .First.lib <- function(lib, pkgname, where) {
>   ## load the compiled code
>   library.dynam(pkgname, pkgname, lib)
>
> and that should be
>
>   library.dynam("matchprobes", pkgname, lib)

Thanks!  I've fixed this for the release and devel versions of
matchprobes.

> (That's not an uncommon mistake, BTW: EBarrays, puma and twilight of
> BioC seem to share it.)

Indeed.  I will contact the maintainers of those packages.

+ seth

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From edd at debian.org  Sat Apr 28 04:32:18 2007
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 27 Apr 2007 21:32:18 -0500
Subject: [Rd] How to suppress 'Loading required package ...' via
	Depends/Imports
In-Reply-To: <20070427145418.GA24349@eddelbuettel.com>
References: <17969.64551.962449.586155@basebud.nulle.part>
	<Pine.LNX.4.64.0704271506170.29708@gannet.stats.ox.ac.uk>
	<20070427144719.GA24236@eddelbuettel.com>
	<20070427145418.GA24349@eddelbuettel.com>
Message-ID: <17970.45618.570618.33153@basebud.nulle.part>


On 27 April 2007 at 09:54, Dirk Eddelbuettel wrote:
| On Fri, Apr 27, 2007 at 09:47:19AM -0500, Dirk Eddelbuettel wrote:
| > On Fri, Apr 27, 2007 at 03:10:42PM +0100, Prof Brian Ripley wrote:
| > Lastly, a nit:  it doesn't _fully_ do it as it still issues a 
| > 
| >   Loading required package: methods
| > 
| > when invoked...  But I guess I may as well load methods from my R
| > startup files.
| 
| Correction: This appears to be an undocumented littler 'feature' Jeff
| and I will have to address by making littler load methods...

And neither Jeff nor I could replicate it. May have been a spurious oddity
with the local package I was loading.  All well now thanks to
suppressMessages().

Thanks, Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From maechler at stat.math.ethz.ch  Sat Apr 28 15:35:29 2007
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 28 Apr 2007 15:35:29 +0200
Subject: [Rd] Signature of '!' (was Problem with R-2.5.0 patched and
	Matrix package)
In-Reply-To: <Pine.LNX.4.64.0704262211250.27404@gannet.stats.ox.ac.uk>
References: <m2bqhargo4.fsf@ziti.fhcrc.org>
	<Pine.LNX.4.64.0704262211250.27404@gannet.stats.ox.ac.uk>
Message-ID: <17971.19873.309790.77341@stat.math.ethz.ch>

>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>>>     on Thu, 26 Apr 2007 22:57:11 +0100 (BST) writes:

    BDR> Yes, it works in the release.  The essence of the
    BDR> problem is that Matrix defines an S4 method for '!'
    BDR> with dispatch on 'e1', but the documentation for '!'
    BDR> (and many S3 methods) says the argument is 'x'.  As '!'
    BDR> is a primitive the argument matching of the base
    BDR> function might be expected to be positional only, but
    BDR> that is not what happens with methods.

    BDR> This needs some juggling, and clearly two patches in
    BDR> R-patched have conflicted.  I've reverted one of them
    BDR> and this seems to work again (but something else no
    BDR> longer works: see below).

    BDR> Longer term, I don't know what the right way forward
    BDR> is.  Consider

    >> setClass("foo", "logical")
    BDR> [1] "foo"
    >> setMethod("!", "foo", function(e1) NA)
    BDR> [1] "!"
    >> x <- new("foo", TRUE) !x
    BDR> [1] NA
    >> `!`(x)
    BDR> [1] NA
    >> `!`(x=x)
    BDR> Error in !x : unused argument(s) (x = TRUE)
    >> `!`(e1=x)
    BDR> [1] NA

    BDR> which is not what the reader of the help for '!' might
    BDR> expect.  But it gets worse:

    >> x2 <- structure(TRUE, class="bar") `!.bar` <- function(x)
    >> NA
    BDR> (and there are several S3 methods like that in CRAN
    BDR> packages)
    >> !x2
    BDR> [1] NA
    >> `!`(x2)
    BDR> [1] NA
    >> `!`(x=x2)
    BDR> Error in !x2 : unused argument(s) (x = TRUE)
    >> `!`(e1=x2)
    BDR> Error in `!.bar`(e1 = x2) : unused argument(s) (e1 =
    BDR> TRUE)

    BDR> whereas `!`(x=x2) does work if you do not set an S4
    BDR> method on '!'.  This may seem artificial, but this sort
    BDR> of thing can happen if you use operators as functions
    BDR> in lapply().

    BDR> Since there are in packages S3 methods on 'x' and S4
    BDR> methods on 'e1', we have a conflict.

    BDR> My gut feeling is that the inconsistency is the S4
    BDR> signature, and certainly that seems the easier one to
    BDR> change.  I knew about this because the
    BDR> behind-the-scenes S4 generics in R-devel are
    BDR> auto-generated from the descriptions of the primitives.
    BDR> Now in 2.5.0 you will see

    >> `!`
    BDR> function (x) .Primitive("!")

    BDR> and hence there needed to be an exclusion list (which
    BDR> now includes '!' and 'c') to have Matrix work in
    BDR> R-devel.  An alternative is to make the internal method
    BDR> dispatch on operators ignore the argument names.

    BDR> (I can guess where this comes from.  '!' is a member of
    BDR> the S3 Ops group, and as part of a group method you
    BDR> define Ops(e1, e2) and ignore e2.  But '!' is not part
    BDR> of the S4 group generic Logic in R.)

 Yes, indeed (and that was made so very consciously after
 discussion between John and me (and maybe more people)) in
 order to at least keep the signature precise for the (S4)Logic group.

I agree with you (Brian) that the inconsistency between 
'(x)' and '(e1)' is ugly and I agree that we 
make the signature into  '(x)' and we (I) have to change Matrix
subsequently.
If possible (easily enough), we should try to keep 'e1' working
in  setMethod("!", .)  with a deprecation warning

Martin


    BDR> On Thu, 26 Apr 2007, Seth Falcon wrote:

    >> Hi,
    >> 
    >> Using latest R 2.5.0 Patched, I'm unable to install the
    >> Matrix package from cran.fhcrc.org.
    >> 
    >> I get:
    >> 
    >> Creating a new generic function for "isSymmetric" in
    >> "Matrix" Creating a new generic function for "unname" in
    >> "Matrix" Error in conformMethod(signature, mnames,
    >> fnames, f) : In method for function "!": formal arguments
    >> omitted in the method definition cannot be in the
    >> signature (x = "Matrix") Error: unable to load R code in
    >> package 'Matrix' Execution halted ERROR: lazy loading
    >> failed for package 'Matrix' ** Removing
    >> '/home/sfalcon/RLIBS/2.5/Matrix' ** Restoring previous
    >> '/home/sfalcon/RLIBS/2.5/Matrix'
    >> 
    >> The downloaded packages are in
    >> /tmp/RtmpcEQJjw/downloaded_packages Warning message:
    >> installation of package 'Matrix' had non-zero exit status
    >> in: install.packages(pkgs = pkgs, repos = repos,
    >> dependencies = dependencies,
    >> 
    >> I don't have this problem when using a recent R-devel.
    >> And I'm guessing that Matrix works with the release, but
    >> haven't had time to check this.
    >> 
    >> + seth
    >> 
    >> 

    BDR> -- Brian D. Ripley, ripley at stats.ox.ac.uk Professor of
    BDR> Applied Statistics, http://www.stats.ox.ac.uk/~ripley/
    BDR> University of Oxford, Tel: +44 1865 272861 (self) 1
    BDR> South Parks Road, +44 1865 272866 (PA) Oxford OX1 3TG,
    BDR> UK Fax: +44 1865 272595

    BDR> ______________________________________________
    BDR> R-devel at r-project.org mailing list
    BDR> https://stat.ethz.ch/mailman/listinfo/r-devel


From savicky at cs.cas.cz  Sat Apr 28 13:50:09 2007
From: savicky at cs.cas.cz (Petr Savicky)
Date: Sat, 28 Apr 2007 13:50:09 +0200
Subject: [Rd] pure R code package for Windows
Message-ID: <20070428114959.GA25723@cs.cas.cz>

Dear R developers,

I am using R under Linux, but I would like to share
an extension package with some Windows users. The package
contains only data and .R scripts. There is no src directory.

So, I think I do not need a Windows machine with C compiler,
"make", "sh" and "perl". If I am wrong, please tell me.

I tried the following approaches (after verifying the package
using R CMD check - 1 warning concerning the missing documentation
for some of the R-functions.)

1. Installing the source package (with no C, C++ or F files)
   directly on Windows XP. Installation complains that
   "make" command is mising. OK, it is a source package.

2. Building binary package using R CMD build --binary --use-zip
   on Linux and try to install it under Windows XP. Installation
   complains that "make" command is missing. (Why, if it is 
   a binary package?).

3. Build the package from source on Windows XP using
   R CMD build <package>. Installation complains that "sh"
   is missing. (Why is it looking for "sh", if it is a properly
   working R installation under Windows?)

4. Install the package under Linux and zip the directory
   library/<package> and unzip it in the library directory
   on Windows machine. This works. The package behaves
   correctly. However, I do not think that this is a suggested
   method.

Could you help me?

Thank you in advance. Petr Savicky.


From ripley at stats.ox.ac.uk  Sat Apr 28 16:35:54 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 28 Apr 2007 15:35:54 +0100 (BST)
Subject: [Rd] pure R code package for Windows
In-Reply-To: <20070428114959.GA25723@cs.cas.cz>
References: <20070428114959.GA25723@cs.cas.cz>
Message-ID: <Pine.LNX.4.64.0704281523300.11209@gannet.stats.ox.ac.uk>

On Sat, 28 Apr 2007, Petr Savicky wrote:

> Dear R developers,
>
> I am using R under Linux, but I would like to share
> an extension package with some Windows users. The package
> contains only data and .R scripts. There is no src directory.
>
> So, I think I do not need a Windows machine with C compiler,
> "make", "sh" and "perl". If I am wrong, please tell me.
>
> I tried the following approaches (after verifying the package
> using R CMD check - 1 warning concerning the missing documentation
> for some of the R-functions.)
>
> 1. Installing the source package (with no C, C++ or F files)
>   directly on Windows XP. Installation complains that
>   "make" command is mising. OK, it is a source package.
>
> 2. Building binary package using R CMD build --binary --use-zip
>   on Linux and try to install it under Windows XP. Installation
>   complains that "make" command is missing. (Why, if it is
>   a binary package?).

How did you try to install it?  It is not a Windows binary package, but a 
Linux binary package.

> 3. Build the package from source on Windows XP using
>   R CMD build <package>. Installation complains that "sh"
>   is missing. (Why is it looking for "sh", if it is a properly
>   working R installation under Windows?)

Because you need more than R to install source packages on any platform. 
See the R-admin manual.

> 4. Install the package under Linux and zip the directory
>   library/<package> and unzip it in the library directory
>   on Windows machine. This works. The package behaves
>   correctly. However, I do not think that this is a suggested
>   method.

Well, it _is_ a suggested method: see README.packages.

Another method open to you is to cross-build on Linux, also described in 
that document and in R-admin.html.  You would need to do that is there is 
anything Windows-specific about the package.

Note that none of these methods produce Windows-specific forms of help 
(and one of those is the default). The only way to do that is under 
Windows (including using Windows tools under emulations such as Wine on 
other OSes).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch at stats.uwo.ca  Sat Apr 28 16:39:18 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 28 Apr 2007 10:39:18 -0400
Subject: [Rd] pure R code package for Windows
In-Reply-To: <20070428114959.GA25723@cs.cas.cz>
References: <20070428114959.GA25723@cs.cas.cz>
Message-ID: <46335C96.1000605@stats.uwo.ca>

On 4/28/2007 7:50 AM, Petr Savicky wrote:
> Dear R developers,
> 
> I am using R under Linux, but I would like to share
> an extension package with some Windows users. The package
> contains only data and .R scripts. There is no src directory.
> 
> So, I think I do not need a Windows machine with C compiler,
> "make", "sh" and "perl". If I am wrong, please tell me.

Yes, you need the R tools and Perl.  See the R Admin manual; it 
describes the necessary tools in the "Windows Toolset" appendix.

Duncan Murdoch


From ggrothendieck at gmail.com  Sat Apr 28 16:51:43 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 28 Apr 2007 10:51:43 -0400
Subject: [Rd] pure R code package for Windows
In-Reply-To: <20070428114959.GA25723@cs.cas.cz>
References: <20070428114959.GA25723@cs.cas.cz>
Message-ID: <971536df0704280751r5fd2d4a7p48880f3a6b4dc261@mail.gmail.com>

If you want to build it on Windows (rather than do a cross build) there are
links to HowTo's in the Links section of this page regarding various
Windows tasks:

   http://code.google.com/p/batchfiles/

On 4/28/07, Petr Savicky <savicky at cs.cas.cz> wrote:
> Dear R developers,
>
> I am using R under Linux, but I would like to share
> an extension package with some Windows users. The package
> contains only data and .R scripts. There is no src directory.
>
> So, I think I do not need a Windows machine with C compiler,
> "make", "sh" and "perl". If I am wrong, please tell me.
>
> I tried the following approaches (after verifying the package
> using R CMD check - 1 warning concerning the missing documentation
> for some of the R-functions.)
>
> 1. Installing the source package (with no C, C++ or F files)
>   directly on Windows XP. Installation complains that
>   "make" command is mising. OK, it is a source package.
>
> 2. Building binary package using R CMD build --binary --use-zip
>   on Linux and try to install it under Windows XP. Installation
>   complains that "make" command is missing. (Why, if it is
>   a binary package?).
>
> 3. Build the package from source on Windows XP using
>   R CMD build <package>. Installation complains that "sh"
>   is missing. (Why is it looking for "sh", if it is a properly
>   working R installation under Windows?)
>
> 4. Install the package under Linux and zip the directory
>   library/<package> and unzip it in the library directory
>   on Windows machine. This works. The package behaves
>   correctly. However, I do not think that this is a suggested
>   method.
>
> Could you help me?
>
> Thank you in advance. Petr Savicky.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ligges at statistik.uni-dortmund.de  Sat Apr 28 19:01:21 2007
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Sat, 28 Apr 2007 19:01:21 +0200
Subject: [Rd] pure R code package for Windows
In-Reply-To: <20070428114959.GA25723@cs.cas.cz>
References: <20070428114959.GA25723@cs.cas.cz>
Message-ID: <46337DE1.5030607@statistik.uni-dortmund.de>

You can also use the Windows binary build and check service at 
http://129.217.207.166 after reading its disclaimer...

Uwe Ligges


Petr Savicky wrote:
> Dear R developers,
> 
> I am using R under Linux, but I would like to share
> an extension package with some Windows users. The package
> contains only data and .R scripts. There is no src directory.
> 
> So, I think I do not need a Windows machine with C compiler,
> "make", "sh" and "perl". If I am wrong, please tell me.
> 
> I tried the following approaches (after verifying the package
> using R CMD check - 1 warning concerning the missing documentation
> for some of the R-functions.)
> 
> 1. Installing the source package (with no C, C++ or F files)
>    directly on Windows XP. Installation complains that
>    "make" command is mising. OK, it is a source package.
> 
> 2. Building binary package using R CMD build --binary --use-zip
>    on Linux and try to install it under Windows XP. Installation
>    complains that "make" command is missing. (Why, if it is 
>    a binary package?).
> 
> 3. Build the package from source on Windows XP using
>    R CMD build <package>. Installation complains that "sh"
>    is missing. (Why is it looking for "sh", if it is a properly
>    working R installation under Windows?)
> 
> 4. Install the package under Linux and zip the directory
>    library/<package> and unzip it in the library directory
>    on Windows machine. This works. The package behaves
>    correctly. However, I do not think that this is a suggested
>    method.
> 
> Could you help me?
> 
> Thank you in advance. Petr Savicky.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Sun Apr 29 15:12:08 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sun, 29 Apr 2007 09:12:08 -0400
Subject: [Rd] Mouse handling in Rgui console
Message-ID: <463499A8.3090503@stats.uwo.ca>

I've just committed some changes to R-devel to make the mouse handling 
in the R console more consistent with Windows conventions:

- insert vs overwrite mode is now indicated by a vertical line/solid 
block cursor
- the mouse can be used to move the cursor (only within the input line)
- if part of the input line is highlighted and text is entered, it will 
replace the highlighted section.

It's not fully consistent with other Windows programs:  e.g. Ctrl-X 
still does "copy and paste".  I tried to add missing functionality while 
making minimal changes to existing behaviour, but some changes were 
unavoidable.

Input handling in Rgui is complicated by the support for multi-byte 
character sets and double-width characters (e.g. Chinese, Japanese), 
which I can't easily test, so I'd appreciate it if others could take a 
look and let me know of any bugs.  This should show up in Windows builds 
of 2.6.0dev on CRAN of revision 41380 or later.

Duncan Murdoch


From apjaworski at mmm.com  Mon Apr 30 04:36:08 2007
From: apjaworski at mmm.com (apjaworski at mmm.com)
Date: Sun, 29 Apr 2007 21:36:08 -0500
Subject: [Rd] Compilation problem
Message-ID: <OFD86DF193.1C5B7B15-ON862572CD.000B6BAF-862572CD.000E4B6B@mmm.com>


Hello,

I apologize in advance for this question being a little off the main thrust
of this list.  I am not sure what the problem is and this seems like the
most logical place to ask.

Here is my problem.  I have been compiling daily snapshots of R (both
patched and devel) for some time now on my work machine.  This machine is a
3-year old IBM Intellistation with 1Gbyte of memory running Windows 2000
Pro.  My setup for compiling is fairly standard:  cygwin environment, R
tools, MinGW development system (recently switched to the Rtools package),
MiKTeX, current Tcl/Tk, ActivePerl, libpng and Jpeg libraries and the most
recent Inno Setup.  I have no problem with this system.

Recently I bought a new home machine:  Core2Duo processor, 3Gbyte of RAM
and WindowsXP Pro SP2.  I duplicated the above development environment on
this machine and everything seems to work fine (I can compile test C/C++
programs and I can install and run R).  However when I try to compile R
from sources (make distribution) I get the following:

3 [main] ? (43448) c:\local\Rtools\bin\make.exe: *** fatal error - couldn't
allocate heap, Win32 error 487, base 0x680000, top 0x6A0000, reserve_size
126976, allocsize 131072, page_const 4096
5 [main] make 33392 fork: child -1 - died waiting for longjmp before
initialization, retry 0, exit code 0x100, errno 11
make[3]: vfork: Resource temporarily unavailable

Now this error occurs at different times during the compilation process.
Usually it comes at the very beginning right after making Rpwd.exe (the the
error is attributed to sh.exe) but sometimes the compilation goes for a
while before the error pops up (like the example above).  It always
complains about allocating heap and the longjmp thing.

It looks to me like this is some kind of system/compiler problem but I do
not know enough about them to figure it out.  Perhaps it is something
simple that I overlooked.  Did anybody see anything similar?  I will
appreciate any hint.

Thanks in advance for your time,

Andy


PS.  I ran memtest86 on my RAM for about 8 hours and it did not detect a
single memory error so I think (hope) my physical memory is OK.  XP is
running quite smoothly with ordinary tasks and I am not experiencing any
problems, reboots or "blue screens of death".

__________________________________
Andy Jaworski
518-1-01
Process Laboratory
3M Corporate Research Laboratory
-----
E-mail: apjaworski at mmm.com
Tel:  (651) 733-6092
Fax:  (651) 736-3122


From r.darnell at uq.edu.au  Mon Apr 30 12:16:07 2007
From: r.darnell at uq.edu.au (r.darnell at uq.edu.au)
Date: Mon, 30 Apr 2007 12:16:07 +0200 (CEST)
Subject: [Rd] [Fwd: Re: [R-downunder] Beware unclass(factor)] (PR#9641)
Message-ID: <20070430101607.5EDEB5AB4C@slim.kubism.ku.dk>

This is a multi-part message in MIME format.
--------------040101030901070905010208
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

The following "issue" was found using

 > version
               _                          
platform       i386-pc-mingw32            
arch           i386                       
os             mingw32                    
system         i386, mingw32              
status                                    
major          2                          
minor          4.1                        
year           2006                       
month          12                         
day            18                         
svn rev        40228                      
language       R                          
version.string R version 2.4.1 (2006-12-18)
 >


and discussed on the R-downunder mailing list.

I hope I have provided enough info.  I tried to look at the Bugs 
Tracking page but got---


The system encountered a fatal error

*

cannot open config file /home/sfe/r-bugs/jitterbug/R : No such file or directory

*

The last error code was: No such file or directory

uid/gid=30/8


Regards

Ross Darnell

--------------040101030901070905010208
Content-Type: message/rfc822;
 name="Re: [R-downunder] Beware unclass(factor)"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="Re: [R-downunder] Beware unclass(factor)"

Return-path: <john.maindonald at anu.edu.au>
Received: from mail2a.soe.uq.edu.au (mail2a.soe.uq.edu.au [130.102.3.87])
 by MAILSTORE (The University of Queensland Central Mail System)
 with ESMTP id <0JHB00BUB0WHC0 at anode.soe.uq.edu.au> for r.darnell at uq.edu.au;
 Mon, 30 Apr 2007 19:26:41 +1000 (EST)
Received: from mailhub4.uq.edu.au (mailhub4.uq.edu.au [130.102.149.131])
 by MAILSTORE (The University of Queensland Central Mail System)
 with ESMTP id <0JHB009DL0WH43 at positive.soe.uq.edu.au> for r.darnell at uq.edu.au;
 Mon, 30 Apr 2007 19:26:41 +1000 (EST)
Received: from customer-domains.icp-qv1-irony10.iinet.net.au
 (customer-domains.icp-qv1-irony10.iinet.net.au [203.59.1.145])
	by mailhub4.uq.edu.au (8.13.8/8.13.8) with ESMTP id l3U9QcOd021380	for
 <r.darnell at uq.edu.au>; Mon, 30 Apr 2007 19:26:41 +1000
Received: from 203-173-2-10.dyn.iinet.net.au (HELO [192.168.0.2])
 ([203.173.2.10]) by iinet-mail.icp-qv1-irony10.iinet.net.au with ESMTP; Mon,
 30 Apr 2007 17:25:10 +0800
Date: Mon, 30 Apr 2007 19:25:09 +1000
From: John Maindonald <john.maindonald at anu.edu.au>
Subject: Re: [R-downunder] Beware unclass(factor)
In-reply-to: <46359373.50504 at uq.edu.au>
To: Ross Darnell <r.darnell at uq.edu.au>
Cc: r-downunder at stat.auckland.ac.nz
Message-id: <68935773-EB35-4B4F-9970-0D241FDFF73C at anu.edu.au>
MIME-version: 1.0 (Apple Message framework v752.3)
X-Mailer: Apple Mail (2.752.3)
Content-type: text/plain; charset=US-ASCII; delsp=yes; format=flowed
Content-transfer-encoding: 7bit
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: AgAAAARTNUbLrQIKUGdsb2JhbAANj3wBASo
X-IronPort-AV: i="4.14,469,1170601200";   d="scan'208";
 a="80792155:sNHT7461584868"
X-Sorbs: not_in_sorbs
X-Spam-Score: 0 (), 5 = high
X-UQ-Spam-Score: UQ-Spam-Score (0), 5 = high
X-UQ-FilterTime: 1177925201
X-Scanned-By: MIMEDefang 2.58 on UQ Mailhub on 130.102.149.131
References: <46359373.50504 at uq.edu.au>
Original-recipient: rfc822;r.darnell at uq.edu.au

Observe the following

 > z <- model.frame(cbind(moths,(20-moths)) ~sex+ doselin,data=worms)
 > class(z$doselin)
[1] "other"
 > levels(z$doselin)
[1] "1"  "2"  "4"  "8"  "16" "32"
 > attributes(z$doselin)
$levels
[1] "1"  "2"  "4"  "8"  "16" "32"

$class
[1] "other"

The problem surfaces in the call for model.frame() from predict.lm()
when it is called by predict.glm().  This call is jumping to conclusions
when it uses the presence of a levels attribute as an indication that
doselin is a factor, ironic as it was the call that was initiated by glm
that seems to have given the column doselin of the object returned
by model.frame() the class "other".

This seems to me to be a bug. The call to unclass() does not
strip the levels attribute from doselin.  (This is not, I think, the
bug; rather the problem is in the model matrix that is created.)
The column worms$doselin does though have class "integer",
at least as far as the function class() is concerned.

You can fix the problem by setting:

   worms$doselin <- as.vector(unclass(worms$Dose))

This strips off the levels attribute.

In my view model.frame ought to have stripped the levels
attribute from the column doselin in the object that it
returned.

I consider that this should be reported as a bug, or at least
as an undesirable feature.

John Maindonald             email: john.maindonald at anu.edu.au
phone : +61 2 (6125)3473    fax  : +61 2(6125)5549
Centre for Mathematics & Its Applications, Room 1194,
John Dedman Mathematical Sciences Building (Building 27)
Australian National University, Canberra ACT 0200.


On 30 Apr 2007, at 4:57 PM, Ross Darnell wrote:

> Just an observation about the use of unclass() to generate codes  
> for factors.
>
> As an example take the  dataset from the MASS4 book
>
> > worms <- data.frame(sex=gl(2,6),Dose=factor(rep(2^(0:5), 
> 2)),moths=c(1,4,9,13,18,20,0,2,6,10,12,16))
>
> > worms$doselin <- unclass(worms$Dose)
>
> > worms.glm <- glm(cbind(moths,(20-moths)) ~sex+  
> doselin,data=worms,family=binomial)
>
> > predict(worms.glm,new=data.frame(sex="1",doselin=6))
> Error: variable 'doselin' was fitted with class "other" but class  
> "numeric" was supplied
> In addition: Warning message:
> variable 'doselin' is not a factor in: model.frame.default(Terms,  
> newdata, na.action = na.action, xlev = object$xlevels)
> >
>
>
> The /doselin/ vector is "atomic" --- good enough for the glm()  
> function but not acceptable by predict()
>
> > str(worms$doselin)
> atomic [1:12] 1 2 3 4 5 6 1 2 3 4 ...
> - attr(*, "levels")= chr [1:6] "1" "2" "4" "8" ...
> >
>
> Cheers
>
> Ross Darnell
>
> -- 
> R-downunder at stat.auckland.ac.nz
> http://www.stat.auckland.ac.nz/r-downunder
>
> To unsubscribe send an email to R-downunder- 
> unsubscribe at stat.auckland.ac.nz

--------------040101030901070905010208--


From ripley at stats.ox.ac.uk  Mon Apr 30 12:52:23 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 30 Apr 2007 11:52:23 +0100 (BST)
Subject: [Rd] Signature of '!' (was Problem with R-2.5.0 patched and
 Matrix package)
In-Reply-To: <17971.19873.309790.77341@stat.math.ethz.ch>
References: <m2bqhargo4.fsf@ziti.fhcrc.org>
	<Pine.LNX.4.64.0704262211250.27404@gannet.stats.ox.ac.uk>
	<17971.19873.309790.77341@stat.math.ethz.ch>
Message-ID: <Pine.LNX.4.64.0704301055170.6178@gannet.stats.ox.ac.uk>

I think I have a workaround for this in R-devel now, but obviously it will 
be better to change Matrix in due course.

I believe this requires Matrix to be re-installed (again) under R-devel.


On Sat, 28 Apr 2007, Martin Maechler wrote:

>>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>>>>     on Thu, 26 Apr 2007 22:57:11 +0100 (BST) writes:
>
>    BDR> Yes, it works in the release.  The essence of the
>    BDR> problem is that Matrix defines an S4 method for '!'
>    BDR> with dispatch on 'e1', but the documentation for '!'
>    BDR> (and many S3 methods) says the argument is 'x'.  As '!'
>    BDR> is a primitive the argument matching of the base
>    BDR> function might be expected to be positional only, but
>    BDR> that is not what happens with methods.
>
>    BDR> This needs some juggling, and clearly two patches in
>    BDR> R-patched have conflicted.  I've reverted one of them
>    BDR> and this seems to work again (but something else no
>    BDR> longer works: see below).
>
>    BDR> Longer term, I don't know what the right way forward
>    BDR> is.  Consider
>
>    >> setClass("foo", "logical")
>    BDR> [1] "foo"
>    >> setMethod("!", "foo", function(e1) NA)
>    BDR> [1] "!"
>    >> x <- new("foo", TRUE) !x
>    BDR> [1] NA
>    >> `!`(x)
>    BDR> [1] NA
>    >> `!`(x=x)
>    BDR> Error in !x : unused argument(s) (x = TRUE)
>    >> `!`(e1=x)
>    BDR> [1] NA
>
>    BDR> which is not what the reader of the help for '!' might
>    BDR> expect.  But it gets worse:
>
>    >> x2 <- structure(TRUE, class="bar") `!.bar` <- function(x)
>    >> NA
>    BDR> (and there are several S3 methods like that in CRAN
>    BDR> packages)
>    >> !x2
>    BDR> [1] NA
>    >> `!`(x2)
>    BDR> [1] NA
>    >> `!`(x=x2)
>    BDR> Error in !x2 : unused argument(s) (x = TRUE)
>    >> `!`(e1=x2)
>    BDR> Error in `!.bar`(e1 = x2) : unused argument(s) (e1 =
>    BDR> TRUE)
>
>    BDR> whereas `!`(x=x2) does work if you do not set an S4
>    BDR> method on '!'.  This may seem artificial, but this sort
>    BDR> of thing can happen if you use operators as functions
>    BDR> in lapply().
>
>    BDR> Since there are in packages S3 methods on 'x' and S4
>    BDR> methods on 'e1', we have a conflict.
>
>    BDR> My gut feeling is that the inconsistency is the S4
>    BDR> signature, and certainly that seems the easier one to
>    BDR> change.  I knew about this because the
>    BDR> behind-the-scenes S4 generics in R-devel are
>    BDR> auto-generated from the descriptions of the primitives.
>    BDR> Now in 2.5.0 you will see
>
>    >> `!`
>    BDR> function (x) .Primitive("!")
>
>    BDR> and hence there needed to be an exclusion list (which
>    BDR> now includes '!' and 'c') to have Matrix work in
>    BDR> R-devel.  An alternative is to make the internal method
>    BDR> dispatch on operators ignore the argument names.
>
>    BDR> (I can guess where this comes from.  '!' is a member of
>    BDR> the S3 Ops group, and as part of a group method you
>    BDR> define Ops(e1, e2) and ignore e2.  But '!' is not part
>    BDR> of the S4 group generic Logic in R.)
>
> Yes, indeed (and that was made so very consciously after
> discussion between John and me (and maybe more people)) in
> order to at least keep the signature precise for the (S4)Logic group.
>
> I agree with you (Brian) that the inconsistency between
> '(x)' and '(e1)' is ugly and I agree that we
> make the signature into  '(x)' and we (I) have to change Matrix
> subsequently.
> If possible (easily enough), we should try to keep 'e1' working
> in  setMethod("!", .)  with a deprecation warning
>
> Martin
>
>
>    BDR> On Thu, 26 Apr 2007, Seth Falcon wrote:
>
>    >> Hi,
>    >>
>    >> Using latest R 2.5.0 Patched, I'm unable to install the
>    >> Matrix package from cran.fhcrc.org.
>    >>
>    >> I get:
>    >>
>    >> Creating a new generic function for "isSymmetric" in
>    >> "Matrix" Creating a new generic function for "unname" in
>    >> "Matrix" Error in conformMethod(signature, mnames,
>    >> fnames, f) : In method for function "!": formal arguments
>    >> omitted in the method definition cannot be in the
>    >> signature (x = "Matrix") Error: unable to load R code in
>    >> package 'Matrix' Execution halted ERROR: lazy loading
>    >> failed for package 'Matrix' ** Removing
>    >> '/home/sfalcon/RLIBS/2.5/Matrix' ** Restoring previous
>    >> '/home/sfalcon/RLIBS/2.5/Matrix'
>    >>
>    >> The downloaded packages are in
>    >> /tmp/RtmpcEQJjw/downloaded_packages Warning message:
>    >> installation of package 'Matrix' had non-zero exit status
>    >> in: install.packages(pkgs = pkgs, repos = repos,
>    >> dependencies = dependencies,
>    >>
>    >> I don't have this problem when using a recent R-devel.
>    >> And I'm guessing that Matrix works with the release, but
>    >> haven't had time to check this.
>    >>
>    >> + seth
>    >>
>    >>
>
>    BDR> -- Brian D. Ripley, ripley at stats.ox.ac.uk Professor of
>    BDR> Applied Statistics, http://www.stats.ox.ac.uk/~ripley/
>    BDR> University of Oxford, Tel: +44 1865 272861 (self) 1
>    BDR> South Parks Road, +44 1865 272866 (PA) Oxford OX1 3TG,
>    BDR> UK Fax: +44 1865 272595
>
>    BDR> ______________________________________________
>    BDR> R-devel at r-project.org mailing list
>    BDR> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ken.mailinglist at mac.com  Mon Apr 30 14:12:11 2007
From: ken.mailinglist at mac.com (ken.mailinglist at mac.com)
Date: Mon, 30 Apr 2007 14:12:11 +0200 (CEST)
Subject: [Rd] mirror's choice when installing a package for R-2.5.0 (PR#9643)
Message-ID: <20070430121211.5C4AF5ABD4@slim.kubism.ku.dk>



Hello,

Just a quick message to say that,

------------------------------------------------------------------------ 
-------

when choosing (with or without the tcltk window) "Bern 1 (swiss)" as  
CRAN mirror to install
a package (function install.packages) for R-2.5.0, the list of  
available packages
for osx seems not complete:

AMORE, AdaptFit, AlgDesign, AnalyzeFMRI, SemiPar, cluster, nlme,  
survival

------------------------------------------------------------------------ 
-------

when choosing "Bern 2 (swiss)" as CRAN mirror to install a package  
for R-2.5.0,
I get the following warning:

 > install.packages()
--- Please select a CRAN mirror for use in this session ---
CRAN mirror

1: Australia (QLD)              2: Australia (VIC)
3: Austria                      4: Brazil (PR)
...
51: Spain (Alicante)            52: Spain (Madrid)
53: Sweden                      54: Switzerland (Zuerich)
55: Switzerland (Bern 1)        56: Switzerland (Bern 2)
57: Turkey                      58: Taiwan (Taichung)
59: Taiwan (Taipeh)             60: UK (Bristol)
...
73: USA (WA)

Selection: 56
Warning: unable to access index for repository http://cran.prokmu.com/ 
bin/macosx/universal/contrib/2.5
Error in install.packages() : argument "pkgs" is missing, with no  
default

------------------------------------------------------------------------ 
-------

--> when choosing "Z?rich (swiss)" as CRAN mirror to install a  
package for R-2.5.0, it works well.

------------------------------------------------------------------------ 
-------

Greetings, Ken








------------------------------------------------------------------------ 
-------

PS 1:

when trying to open "http://bugs.r-project.org/cgi-bin/R", I obtain  
the following message:

The system encountered a fatal error
cannot open config file /home/sfe/r-bugs/jitterbug/R : No such file  
or directory
The last error code was: No such file or directory

uid/gid=30/8



------------------------------------------------------------------------ 
-------
PS 2:

 > sessionInfo()
R version 2.5.0 (2007-04-23)
powerpc-apple-darwin8.9.1

locale:
C

attached base packages:
[1] "tcltk"     "stats"     "graphics"  "grDevices" "utils"      
"datasets"
[7] "methods"   "base"


From savicky at cs.cas.cz  Sun Apr 29 15:53:48 2007
From: savicky at cs.cas.cz (Petr Savicky)
Date: Sun, 29 Apr 2007 15:53:48 +0200
Subject: [Rd] pure R code package for Windows
In-Reply-To: <46337DE1.5030607@statistik.uni-dortmund.de>
References: <20070428114959.GA25723@cs.cas.cz>
	<46337DE1.5030607@statistik.uni-dortmund.de>
Message-ID: <20070429135347.GA4690@cs.cas.cz>

> You can also use the Windows binary build and check service at 
> http://129.217.207.166 after reading its disclaimer...

Thank you very much. This worked including generating .chm file. The resulting
package is installable under R GUI on Windows XP, which is sufficient for me.

Let me point out that I did not succeed to install any package
(including the standard ones like rpart) on Windows using R CMD INSTALL <package>,
although I have Rtools and perl installed, running and in the path.

The error message for windows binary package rpart from CRAN is:
  Error in Rdinfo(RdFiles[i]) : missing/empty \name field in 'E:/R/rpart/man/rpart.Rd.gz
  Rd files must have a non-empty \name.

> >4. Install the package under Linux and zip the directory
> >  library/<package> and unzip it in the library directory
> >  on Windows machine. This works. The package behaves
> >  correctly. However, I do not think that this is a suggested
> >  method.
> 
> Well, it _is_ a suggested method: see README.packages.

This also produced a package installable by the standard procedure under
Windows GUI. Thank you for pointing this out. (Again, R CMD INSTALL does
not work for the resulting package.)

All the best, Petr.


From Piotr.Zuraniewski at agh.edu.pl  Sun Apr 29 20:43:17 2007
From: Piotr.Zuraniewski at agh.edu.pl (Piotr.Zuraniewski at agh.edu.pl)
Date: Sun, 29 Apr 2007 20:43:17 +0200 (CEST)
Subject: [Rd] [debug] package - Error in all.levs (PR#9638)
Message-ID: <20070429184317.E792CBB06@slim.kubism.ku.dk>

Dear All,

I encountered the following problem:

fun1 <- function(x){
2*cos(x)
}

>library(debug)
> mtrace(fun1)
> fun1(0.1)
Error in all.levs[[j]] : subscript out of bounds

> sessionInfo()
R version 2.5.0 (2007-04-23)
i386-pc-mingw32

locale:
LC_COLLATE=Polish_Poland.1250;LC_CTYPE=Polish_Poland.1250;
LC_MONETARY=Polish_Poland.1250;LC_NUMERIC=C;LC_TIME=Polish_Poland.1250

attached base packages:
[1] "tcltk"     "stats"     "graphics"  "grDevices" "utils"     "datasets"
"methods"   "base"

other attached packages:
   debug mvbutils waveslim  polynom
 "1.1.0"  "1.1.1"    "1.6"  "1.3-2"


OS: WinXPSP1

Regards

Piotrek Z


From ligges at statistik.uni-dortmund.de  Mon Apr 30 14:48:31 2007
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Mon, 30 Apr 2007 14:48:31 +0200
Subject: [Rd] pure R code package for Windows
In-Reply-To: <20070429135347.GA4690@cs.cas.cz>
References: <20070428114959.GA25723@cs.cas.cz>	<46337DE1.5030607@statistik.uni-dortmund.de>
	<20070429135347.GA4690@cs.cas.cz>
Message-ID: <4635E59F.80909@statistik.uni-dortmund.de>



Petr Savicky wrote:
>> You can also use the Windows binary build and check service at 
>> http://129.217.207.166 after reading its disclaimer...
> 
> Thank you very much. This worked including generating .chm file. The resulting
> package is installable under R GUI on Windows XP, which is sufficient for me.
> 
> Let me point out that I did not succeed to install any package
> (including the standard ones like rpart) on Windows using R CMD INSTALL <package>,
> although I have Rtools and perl installed, running and in the path.
> 
> The error message for windows binary package rpart from CRAN is:
>   Error in Rdinfo(RdFiles[i]) : missing/empty \name field in 'E:/R/rpart/man/rpart.Rd.gz
>   Rd files must have a non-empty \name.


R CMD INSTALL is intended to install source packages, not binary packages.

Uwe Ligges



>>> 4. Install the package under Linux and zip the directory
>>>  library/<package> and unzip it in the library directory
>>>  on Windows machine. This works. The package behaves
>>>  correctly. However, I do not think that this is a suggested
>>>  method.
>> Well, it _is_ a suggested method: see README.packages.
> 
> This also produced a package installable by the standard procedure under
> Windows GUI. Thank you for pointing this out. (Again, R CMD INSTALL does
> not work for the resulting package.)
> 
> All the best, Petr.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Mon Apr 30 14:51:12 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 30 Apr 2007 08:51:12 -0400
Subject: [Rd] pure R code package for Windows
In-Reply-To: <20070429135347.GA4690@cs.cas.cz>
References: <20070428114959.GA25723@cs.cas.cz>	<46337DE1.5030607@statistik.uni-dortmund.de>
	<20070429135347.GA4690@cs.cas.cz>
Message-ID: <4635E640.9070306@stats.uwo.ca>

On 4/29/2007 9:53 AM, Petr Savicky wrote:
>> You can also use the Windows binary build and check service at 
>> http://129.217.207.166 after reading its disclaimer...
> 
> Thank you very much. This worked including generating .chm file. The resulting
> package is installable under R GUI on Windows XP, which is sufficient for me.
> 
> Let me point out that I did not succeed to install any package
> (including the standard ones like rpart) on Windows using R CMD INSTALL <package>,
> although I have Rtools and perl installed, running and in the path.

On Windows, INSTALL is for installing source packages and is documented 
this way, but you may not have read the Windows-specific docs.  The 
normal way to install binary packages in Windows is to use the 
install.packages() function (or the menu item, which calls it).

It should be a simple modification of the INSTALL script to recognize a 
.zip file, and do a binary install.  I wouldn't put this at a high 
priority:  people who are using R CMD INSTALL tend to be package 
developers, and want to install the source; people who want to install 
the binaries tend not to have the necessary tools to use R CMD INSTALL.

Duncan Murdoch

> 
> The error message for windows binary package rpart from CRAN is:
>   Error in Rdinfo(RdFiles[i]) : missing/empty \name field in 'E:/R/rpart/man/rpart.Rd.gz
>   Rd files must have a non-empty \name.
> 
>> >4. Install the package under Linux and zip the directory
>> >  library/<package> and unzip it in the library directory
>> >  on Windows machine. This works. The package behaves
>> >  correctly. However, I do not think that this is a suggested
>> >  method.
>> 
>> Well, it _is_ a suggested method: see README.packages.
> 
> This also produced a package installable by the standard procedure under
> Windows GUI. Thank you for pointing this out. (Again, R CMD INSTALL does
> not work for the resulting package.)
> 
> All the best, Petr.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ligges at statistik.uni-dortmund.de  Mon Apr 30 14:53:12 2007
From: ligges at statistik.uni-dortmund.de (ligges at statistik.uni-dortmund.de)
Date: Mon, 30 Apr 2007 14:53:12 +0200 (CEST)
Subject: [Rd] mirror's choice when installing a package for R-2.5.0
	(PR#9643)
Message-ID: <20070430125312.209495ABF7@slim.kubism.ku.dk>

These are no bugs in R, but with mirrors (hence CCing to CRAN at ...) and 
with bug tracking itself (hence CCing Peter Dalgaard):


1. Unfortunately, some mirror maintainers are currently doing quite a 
bad job: A couple of mirrors are either out of sync or syncing 
incorrectly by not updating links etc.
I know that checking mirrors and contacting mirror maintainers is on 
Fritz Leisch's ToDo list.

For the meantime, you might want to use the Austrian mirror.


2. Peter is certainly already working to fix the bug tracking system's 
web frontend ...


Uwe Ligges




ken.mailinglist at mac.com wrote:
> 
> Hello,
> 
> Just a quick message to say that,
> 
> ------------------------------------------------------------------------ 
> -------
> 
> when choosing (with or without the tcltk window) "Bern 1 (swiss)" as  
> CRAN mirror to install
> a package (function install.packages) for R-2.5.0, the list of  
> available packages
> for osx seems not complete:
> 
> AMORE, AdaptFit, AlgDesign, AnalyzeFMRI, SemiPar, cluster, nlme,  
> survival
> 
> ------------------------------------------------------------------------ 
> -------
> 
> when choosing "Bern 2 (swiss)" as CRAN mirror to install a package  
> for R-2.5.0,
> I get the following warning:
> 
>  > install.packages()
> --- Please select a CRAN mirror for use in this session ---
> CRAN mirror
> 
> 1: Australia (QLD)              2: Australia (VIC)
> 3: Austria                      4: Brazil (PR)
> ...
> 51: Spain (Alicante)            52: Spain (Madrid)
> 53: Sweden                      54: Switzerland (Zuerich)
> 55: Switzerland (Bern 1)        56: Switzerland (Bern 2)
> 57: Turkey                      58: Taiwan (Taichung)
> 59: Taiwan (Taipeh)             60: UK (Bristol)
> ...
> 73: USA (WA)
> 
> Selection: 56
> Warning: unable to access index for repository http://cran.prokmu.com/ 
> bin/macosx/universal/contrib/2.5
> Error in install.packages() : argument "pkgs" is missing, with no  
> default
> 
> ------------------------------------------------------------------------ 
> -------
> 
> --> when choosing "Z?rich (swiss)" as CRAN mirror to install a  
> package for R-2.5.0, it works well.
> 
> ------------------------------------------------------------------------ 
> -------
> 
> Greetings, Ken
> 
> 
> 
> 
> 
> 
> 
> 
> ------------------------------------------------------------------------ 
> -------
> 
> PS 1:
> 
> when trying to open "http://bugs.r-project.org/cgi-bin/R", I obtain  
> the following message:
> 
> The system encountered a fatal error
> cannot open config file /home/sfe/r-bugs/jitterbug/R : No such file  
> or directory
> The last error code was: No such file or directory
> 
> uid/gid=30/8
> 
> 
> 
> ------------------------------------------------------------------------ 
> -------
> PS 2:
> 
>  > sessionInfo()
> R version 2.5.0 (2007-04-23)
> powerpc-apple-darwin8.9.1
> 
> locale:
> C
> 
> attached base packages:
> [1] "tcltk"     "stats"     "graphics"  "grDevices" "utils"      
> "datasets"
> [7] "methods"   "base"
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Mon Apr 30 15:10:17 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 30 Apr 2007 14:10:17 +0100 (BST)
Subject: [Rd] [debug] package - Error in all.levs (PR#9638)
In-Reply-To: <20070429184317.E792CBB06@slim.kubism.ku.dk>
References: <20070429184317.E792CBB06@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0704301406090.24793@gannet.stats.ox.ac.uk>

>From the FAQ:

   Finally, check carefully whether the bug is with R, or a contributed
   package.  Bug reports on contributed packages should be sent first to
   the package maintainer, and only submitted to the R-bugs repository by
   package maintainers, mentioning the package in the subject line.

'debug' is a contributed package, and does not name you as the maintainer.

Please do as we ask.


On Sun, 29 Apr 2007, Piotr.Zuraniewski at agh.edu.pl wrote:

> Dear All,
>
> I encountered the following problem:
>
> fun1 <- function(x){
> 2*cos(x)
> }
>
>> library(debug)
>> mtrace(fun1)
>> fun1(0.1)
> Error in all.levs[[j]] : subscript out of bounds
>
>> sessionInfo()
> R version 2.5.0 (2007-04-23)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=Polish_Poland.1250;LC_CTYPE=Polish_Poland.1250;
> LC_MONETARY=Polish_Poland.1250;LC_NUMERIC=C;LC_TIME=Polish_Poland.1250
>
> attached base packages:
> [1] "tcltk"     "stats"     "graphics"  "grDevices" "utils"     "datasets"
> "methods"   "base"
>
> other attached packages:
>   debug mvbutils waveslim  polynom
> "1.1.0"  "1.1.1"    "1.6"  "1.3-2"
>
>
> OS: WinXPSP1
>
> Regards
>
> Piotrek Z
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ernesto at ipimar.pt  Mon Apr 30 15:20:04 2007
From: ernesto at ipimar.pt (ernesto)
Date: Mon, 30 Apr 2007 14:20:04 +0100
Subject: [Rd] Cross compiling with R250
Message-ID: <4635ED04.4020908@ipimar.pt>

Hi,

I'm cross compiling win R in a linux Ubuntu Edgy and I'm getting an 
error with the utils package. Sys.setenv exists on my R 2.5.0 ...

I'm using the tools provided for R250 in 
http://www.stats.ox.ac.uk/pub/Rtools/i586-cross-tools.tar.bz2

Any ideas ?

Regards

EJ


---------- Making package utils ------------
  adding build stamp to DESCRIPTION
  installing NAMESPACE file and metadata
  preparing package utils for lazy loading
Error: could not find function "Sys.setenv"
Execution halted
make[5]: *** [lazyload] Error 1
make[4]: *** [all] Error 2
make[3]: *** [pkg-utils] Error 2
make[2]: *** [rpackage] Error 1
make[1]: *** [all] Error 2
make[1]: Leaving directory 
`/home/ernesto/ipimar/devel/R/ccompile250/WinR/R-2.5.0/src/gnuwin32'


From S.J.Eglen at damtp.cam.ac.uk  Mon Apr 30 16:07:26 2007
From: S.J.Eglen at damtp.cam.ac.uk (S.J.Eglen at damtp.cam.ac.uk)
Date: Mon, 30 Apr 2007 16:07:26 +0200 (CEST)
Subject: [Rd] Rscript.Rd example (PR#9644)
Message-ID: <20070430140726.A04085ABF9@slim.kubism.ku.dk>

One of the examples in Rscript.Rd seems mis-formatted, in that the
format statement is incomplete:

     ## Not run: 
     Rscript -e 'date()' -e 'format(Sys.time(), "

Both Rscript.Rd in R 2.5.0 and the version at:
https://svn.r-project.org/R/trunk/src/library/utils/man/Rscript.Rd
have 

Rscript -e 'date()' -e 'format(Sys.time(), "%a %b %d %X %Y")'

Do the % need replacing with \% ?

Stephen



> sessionInfo()
R version 2.5.0 (2007-04-23) 
i686-pc-linux-gnu 

locale:
C

attached base packages:
[1] "stats"     "grDevices" "utils"     "datasets"  "graphics"  "methods"  
[7] "base"     
>


From mhanby at uab.edu  Mon Apr 30 16:19:26 2007
From: mhanby at uab.edu (Mike Hanby)
Date: Mon, 30 Apr 2007 09:19:26 -0500
Subject: [Rd] R on an IBM Blue Gene/L (BGL)?
Message-ID: <42D8C30759A99B4F926167BFEC117E73475633@UABEXMB5.ad.uab.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070430/c85fe0f5/attachment.pl 

From ripley at stats.ox.ac.uk  Mon Apr 30 16:24:52 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 30 Apr 2007 15:24:52 +0100 (BST)
Subject: [Rd] Cross compiling with R250
In-Reply-To: <4635ED04.4020908@ipimar.pt>
References: <4635ED04.4020908@ipimar.pt>
Message-ID: <Pine.LNX.4.64.0704301522040.22525@gannet.stats.ox.ac.uk>

You are pretty clearly not cross-compiling 'with R 2.5.0' (sic), as R 
2.5.0 does contain Sys.setenv.

Looks like the R on Linux you are using is not R 2.5.0, and please 
cross-check the instructions.

This has been tested.

On Mon, 30 Apr 2007, ernesto wrote:

> Hi,
>
> I'm cross compiling win R in a linux Ubuntu Edgy and I'm getting an
> error with the utils package. Sys.setenv exists on my R 2.5.0 ...
>
> I'm using the tools provided for R250 in
> http://www.stats.ox.ac.uk/pub/Rtools/i586-cross-tools.tar.bz2
>
> Any ideas ?
>
> Regards
>
> EJ
>
>
> ---------- Making package utils ------------
>  adding build stamp to DESCRIPTION
>  installing NAMESPACE file and metadata
>  preparing package utils for lazy loading
> Error: could not find function "Sys.setenv"
> Execution halted
> make[5]: *** [lazyload] Error 1
> make[4]: *** [all] Error 2
> make[3]: *** [pkg-utils] Error 2
> make[2]: *** [rpackage] Error 1
> make[1]: *** [all] Error 2
> make[1]: Leaving directory
> `/home/ernesto/ipimar/devel/R/ccompile250/WinR/R-2.5.0/src/gnuwin32'
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From simon.urbanek at r-project.org  Mon Apr 30 17:01:26 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 30 Apr 2007 11:01:26 -0400
Subject: [Rd] Rscript again
In-Reply-To: <20070430140726.A04085ABF9@slim.kubism.ku.dk>
References: <20070430140726.A04085ABF9@slim.kubism.ku.dk>
Message-ID: <C936E941-3B16-41EE-B063-50C2FB2AB491@r-project.org>

On a similar note the example doesn't seem to work, either, due to  
escaping issues:

$ Rscript -e 'format(Sys.time(), "%a %b %d %X %Y")'
ARGUMENT '"%a' __ignored__

ARGUMENT '%b' __ignored__

ARGUMENT '%d' __ignored__

ARGUMENT '%X' __ignored__

ARGUMENT '%Y")' __ignored__

It works only if you remove all spaces from the expression:
$ Rscript -e 'format(Sys.time(),paste("%a","%b","%d","%X","%Y"))'
[1] "Mon Apr 30 10:45:47 AM 2007"

(Tested on i686 Debian etch Linux and Mac OS X 10.4.9 i686; bash,  
dash and csh show the same behavior; R 2.5.0 and R-devel 41383).


Although Rscript tries hard to pass the expression as one argument,  
it apparently doesn't prevent the shell from not taking it apart when  
calling Rexec from R.sh :/

Cheers,
Simon

On Apr 30, 2007, at 10:07 AM, S.J.Eglen at damtp.cam.ac.uk wrote:

> One of the examples in Rscript.Rd seems mis-formatted, in that the
> format statement is incomplete:
>
>      ## Not run:
>      Rscript -e 'date()' -e 'format(Sys.time(), "
>
> Both Rscript.Rd in R 2.5.0 and the version at:
> https://svn.r-project.org/R/trunk/src/library/utils/man/Rscript.Rd
> have
>
> Rscript -e 'date()' -e 'format(Sys.time(), "%a %b %d %X %Y")'
>
> Do the % need replacing with \% ?
>
> Stephen
>
>
>
>> sessionInfo()
> R version 2.5.0 (2007-04-23)
> i686-pc-linux-gnu
>
> locale:
> C
>
> attached base packages:
> [1] "stats"     "grDevices" "utils"     "datasets"  "graphics"   
> "methods"
> [7] "base"
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From ripley at stats.ox.ac.uk  Mon Apr 30 17:03:46 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon, 30 Apr 2007 17:03:46 +0200 (CEST)
Subject: [Rd] Rscript.Rd example (PR#9644)
Message-ID: <20070430150346.7DDB75ABF9@slim.kubism.ku.dk>


On Mon, 30 Apr 2007, S.J.Eglen at damtp.cam.ac.uk wrote:

> One of the examples in Rscript.Rd seems mis-formatted, in that the
> format statement is incomplete:
>
>     ## Not run:
>     Rscript -e 'date()' -e 'format(Sys.time(), "
>
> Both Rscript.Rd in R 2.5.0 and the version at:
> https://svn.r-project.org/R/trunk/src/library/utils/man/Rscript.Rd
> have
>
> Rscript -e 'date()' -e 'format(Sys.time(), "%a %b %d %X %Y")'
>
> Do the % need replacing with \% ?

Yes, thank you.  The other example needs updating, too.

>
> Stephen
>
>
>
>> sessionInfo()
> R version 2.5.0 (2007-04-23)
> i686-pc-linux-gnu
>
> locale:
> C
>
> attached base packages:
> [1] "stats"     "grDevices" "utils"     "datasets"  "graphics"  "methods"
> [7] "base"
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ernesto at ipimar.pt  Mon Apr 30 18:09:29 2007
From: ernesto at ipimar.pt (ernesto)
Date: Mon, 30 Apr 2007 17:09:29 +0100
Subject: [Rd] Cross compiling with R250
In-Reply-To: <Pine.LNX.4.64.0704301522040.22525@gannet.stats.ox.ac.uk>
References: <4635ED04.4020908@ipimar.pt>
	<Pine.LNX.4.64.0704301522040.22525@gannet.stats.ox.ac.uk>
Message-ID: <463614B9.2010306@ipimar.pt>

Hi,

I wrongly assumed it would use R in the cross compiling directory and I 
did not found any reference to it on documentation. Obviously my fault, 
as you say.

Regards

EJ

Prof Brian Ripley wrote:
> You are pretty clearly not cross-compiling 'with R 2.5.0' (sic), as R 
> 2.5.0 does contain Sys.setenv.
>
> Looks like the R on Linux you are using is not R 2.5.0, and please 
> cross-check the instructions.
>
> This has been tested.
>
> On Mon, 30 Apr 2007, ernesto wrote:
>
>> Hi,
>>
>> I'm cross compiling win R in a linux Ubuntu Edgy and I'm getting an
>> error with the utils package. Sys.setenv exists on my R 2.5.0 ...
>>
>> I'm using the tools provided for R250 in
>> http://www.stats.ox.ac.uk/pub/Rtools/i586-cross-tools.tar.bz2
>>
>> Any ideas ?
>>
>> Regards
>>
>> EJ
>>
>>
>> ---------- Making package utils ------------
>>  adding build stamp to DESCRIPTION
>>  installing NAMESPACE file and metadata
>>  preparing package utils for lazy loading
>> Error: could not find function "Sys.setenv"
>> Execution halted
>> make[5]: *** [lazyload] Error 1
>> make[4]: *** [all] Error 2
>> make[3]: *** [pkg-utils] Error 2
>> make[2]: *** [rpackage] Error 1
>> make[1]: *** [all] Error 2
>> make[1]: Leaving directory
>> `/home/ernesto/ipimar/devel/R/ccompile250/WinR/R-2.5.0/src/gnuwin32'
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From hin-tak.leung at cimr.cam.ac.uk  Mon Apr 30 18:39:13 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Mon, 30 Apr 2007 17:39:13 +0100
Subject: [Rd] Cross compiling with R250
In-Reply-To: <463614B9.2010306@ipimar.pt>
References: <4635ED04.4020908@ipimar.pt>	<Pine.LNX.4.64.0704301522040.22525@gannet.stats.ox.ac.uk>
	<463614B9.2010306@ipimar.pt>
Message-ID: <46361BB1.2060604@cimr.cam.ac.uk>

ernesto wrote:
> Hi,
> 
> I wrongly assumed it would use R in the cross compiling directory and I 
> did not found any reference to it on documentation. Obviously my fault, 
> as you say.

The cross-compile section of the admin manual did mention this:

"You also need a working copy of this version of R on Linux: uncomment
                                  ^^^^^^^^^^^^
and set R_EXE in MkRules to point to it."

and "this version" is in italic. IMHO, this point isn't emphased or 
prominent enough though. (I would put an underline or set that in bold, 
for example...) I did make the mistake some times ago
of assuming that cross-compile would take the version of R as much
as possible from the cross directory rather than from that of native R.

Can I suggest this information be repeated a few more times, and/or 
given more emphasis in that section? :-).

HTL

> Prof Brian Ripley wrote:
>> You are pretty clearly not cross-compiling 'with R 2.5.0' (sic), as R 
>> 2.5.0 does contain Sys.setenv.
>>
>> Looks like the R on Linux you are using is not R 2.5.0, and please 
>> cross-check the instructions.
>>
>> This has been tested.
>>
>> On Mon, 30 Apr 2007, ernesto wrote:
>>
>>> Hi,
>>>
>>> I'm cross compiling win R in a linux Ubuntu Edgy and I'm getting an
>>> error with the utils package. Sys.setenv exists on my R 2.5.0 ...
>>>
>>> I'm using the tools provided for R250 in
>>> http://www.stats.ox.ac.uk/pub/Rtools/i586-cross-tools.tar.bz2
>>>
>>> Any ideas ?
>>>
>>> Regards
>>>
>>> EJ
>>>
>>>
>>> ---------- Making package utils ------------
>>>  adding build stamp to DESCRIPTION
>>>  installing NAMESPACE file and metadata
>>>  preparing package utils for lazy loading
>>> Error: could not find function "Sys.setenv"
>>> Execution halted
>>> make[5]: *** [lazyload] Error 1
>>> make[4]: *** [all] Error 2
>>> make[3]: *** [pkg-utils] Error 2
>>> make[2]: *** [rpackage] Error 1
>>> make[1]: *** [all] Error 2
>>> make[1]: Leaving directory
>>> `/home/ernesto/ipimar/devel/R/ccompile250/WinR/R-2.5.0/src/gnuwin32'
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Mon Apr 30 19:08:45 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 30 Apr 2007 18:08:45 +0100 (BST)
Subject: [Rd] Cross compiling with R250
In-Reply-To: <46361BB1.2060604@cimr.cam.ac.uk>
References: <4635ED04.4020908@ipimar.pt>
	<Pine.LNX.4.64.0704301522040.22525@gannet.stats.ox.ac.uk>
	<463614B9.2010306@ipimar.pt> <46361BB1.2060604@cimr.cam.ac.uk>
Message-ID: <Pine.LNX.4.64.0704301754370.16404@gannet.stats.ox.ac.uk>

Have you actually tried this recently? If you don't set R_EXE you get
a fatal error:

---------- Making package base ------------
   adding build stamp to DESCRIPTION
/bin/sh: I failed to read the instructions to set R_EXE in MkRules: 
command not found

And MkRules says

# path (possibly full path) to same version of R on the host system
R_EXE='I failed to read the instructions to set R_EXE in MkRules'


On Mon, 30 Apr 2007, Hin-Tak Leung wrote:

> ernesto wrote:
>> Hi,
>>
>> I wrongly assumed it would use R in the cross compiling directory and I
>> did not found any reference to it on documentation. Obviously my fault,
>> as you say.
>
> The cross-compile section of the admin manual did mention this:
>
> "You also need a working copy of this version of R on Linux: uncomment
>                                  ^^^^^^^^^^^^
> and set R_EXE in MkRules to point to it."
>
> and "this version" is in italic. IMHO, this point isn't emphased or
> prominent enough though. (I would put an underline or set that in bold,
> for example...) I did make the mistake some times ago
> of assuming that cross-compile would take the version of R as much
> as possible from the cross directory rather than from that of native R.
>
> Can I suggest this information be repeated a few more times, and/or
> given more emphasis in that section? :-).
>
> HTL
>
>> Prof Brian Ripley wrote:
>>> You are pretty clearly not cross-compiling 'with R 2.5.0' (sic), as R
>>> 2.5.0 does contain Sys.setenv.
>>>
>>> Looks like the R on Linux you are using is not R 2.5.0, and please
>>> cross-check the instructions.
>>>
>>> This has been tested.
>>>
>>> On Mon, 30 Apr 2007, ernesto wrote:
>>>
>>>> Hi,
>>>>
>>>> I'm cross compiling win R in a linux Ubuntu Edgy and I'm getting an
>>>> error with the utils package. Sys.setenv exists on my R 2.5.0 ...
>>>>
>>>> I'm using the tools provided for R250 in
>>>> http://www.stats.ox.ac.uk/pub/Rtools/i586-cross-tools.tar.bz2
>>>>
>>>> Any ideas ?
>>>>
>>>> Regards
>>>>
>>>> EJ
>>>>
>>>>
>>>> ---------- Making package utils ------------
>>>>  adding build stamp to DESCRIPTION
>>>>  installing NAMESPACE file and metadata
>>>>  preparing package utils for lazy loading
>>>> Error: could not find function "Sys.setenv"
>>>> Execution halted
>>>> make[5]: *** [lazyload] Error 1
>>>> make[4]: *** [all] Error 2
>>>> make[3]: *** [pkg-utils] Error 2
>>>> make[2]: *** [rpackage] Error 1
>>>> make[1]: *** [all] Error 2
>>>> make[1]: Leaving directory
>>>> `/home/ernesto/ipimar/devel/R/ccompile250/WinR/R-2.5.0/src/gnuwin32'
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hin-tak.leung at cimr.cam.ac.uk  Mon Apr 30 19:27:55 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Mon, 30 Apr 2007 18:27:55 +0100
Subject: [Rd] Cross compiling with R250
In-Reply-To: <Pine.LNX.4.64.0704301754370.16404@gannet.stats.ox.ac.uk>
References: <4635ED04.4020908@ipimar.pt>
	<Pine.LNX.4.64.0704301522040.22525@gannet.stats.ox.ac.uk>
	<463614B9.2010306@ipimar.pt> <46361BB1.2060604@cimr.cam.ac.uk>
	<Pine.LNX.4.64.0704301754370.16404@gannet.stats.ox.ac.uk>
Message-ID: <4636271B.7040801@cimr.cam.ac.uk>

Prof Brian Ripley wrote:
> Have you actually tried this recently? If you don't set R_EXE you get
> a fatal error:
> 
> ---------- Making package base ------------
>   adding build stamp to DESCRIPTION
> /bin/sh: I failed to read the instructions to set R_EXE in MkRules: 
> command not found
> 
> And MkRules says
> 
> # path (possibly full path) to same version of R on the host system
> R_EXE='I failed to read the instructions to set R_EXE in MkRules'

Sorry, haven't tried cross-compile under 2.5.x yet. I stand corrected
:-). Can I suggest _same_ or *same* in the comment above please, just
to drive the message home? (it is a matter of taste, and how often
one needs to repeat this, of course...)

HTL


From bill at insightful.com  Mon Apr 30 21:22:23 2007
From: bill at insightful.com (Bill Dunlap)
Date: Mon, 30 Apr 2007 12:22:23 -0700 (PDT)
Subject: [Rd] R CMD Rdconv drops sections: arguments, seealso,
 examples (PR#9606)
In-Reply-To: <20070410182622.1610B5ABC4@slim.kubism.ku.dk>
References: <20070410182622.1610B5ABC4@slim.kubism.ku.dk>
Message-ID: <Pine.GSO.4.56.0704301152370.9565@durian.statsci.com>

On Tue, 10 Apr 2007 timh at insightful.com wrote:

> I've created a .Rd file (below), then converted that to .sgml using
> 	R CMD Rdconv --type=Ssgm combn.Rd  > combn.sgml
> The output (shown below) is missing some of the sections:
> 	arguments
> 	seealso
> 	examples
> If instead I convert to .d (below), the same sections are missing,
> and the "note" section is included but without the necessary newline.

The underlying problem was that there were some unmatched open-braces.
(or 'brackets'?) The attached patch to share/perl/R/Rdconv.pm:mark_brackets()
seems to detect unmatched open and close braces and throw an error:

   % R CMD INSTALL -l /tmp/Rlib timhPackage
   * Installing *source* package 'timhPackage' ...
   ** help
    >>> Building/Updating help pages for package 'timhPackage'
        Formats: text html latex example
   Rdconv(): mismatched braces in help file timh.Rd on or after line 12
   ERROR: building help failed for package 'timhPackage'
   ** Removing '/tmp/Rlib/timhPackage'
   ** Restoring previous '/tmp/Rlib/timhPackage'

The code to report the line number doesn't work quite right
since any "% comment" lines in the Rd file have been removed
from $complete_text by the time we get here.  I fudged by
putting 'on or after line XXX' in the error message.

I tried this on 650 packages from CRAN and didn't get any
false alarms, but I'm not convinced that none are possible.

*** R-2.5.0/share/perl/R/Rdconv.pm~	2007-03-29 19:05:08.000000000 -0700
--- R-2.5.0/share/perl/R/Rdconv.pm	2007-04-30 12:18:12.000000000 -0700
***************
*** 254,259 ****
--- 254,271 ----
  	$complete_text =~ s/{([^{}]*)}/$id$1$id/s;
  	print STDERR "." if $debug;
      }
+     # Any remaining brackets must be unmatched ones, hence report error.
+     if ($complete_text =~ /[{}]/s) {
+         # Would like to tell which which line has unmatched { or },
+         # but lines starting with % have already been removed.
+         # Hence the 'on or after' in the message.
+         my $badlineno=0 ;
+         foreach my $line (split /\n/, $complete_text) {
+             $badlineno++;
+             last if ($line =~ /[{}]/) ;
+         }
+         die "Rdconv(): mismatched braces in help file $Rdname on or after line $badlineno\n" ;
+     }
  }

  sub unmark_brackets {

> \name{combn}
> \alias{combn}
> \title{ Generate combinations of m elements out of x }
> \description{
>   Generate all combinations of \code{m} elements out of \code{x} or
>   \code{1:n}, and optionally apply a function to each, and return
>   a list or simplify to a matrix or array.
> }
> \usage{
> combn(x, m, FUN = NULL, simplify = TRUE, ...)
> }
> \arguments{
>   \item{x}{ This is normally an integer \code{n}, in which case
>     combinations of elemnents from \code{1:n} are returned.
>     Otherwise this is a a vector, and elements of the vector are returned.
>   \item{m}{ Number of elements in each combination. }
>   \item{FUN}{ function to apply to each combination.  If \code{NULL},
>     the combinations themselves are returned, one in each column of the
>     result. }
>   \item{simplify}{ If \code{FALSE}, the results are returned as a list,
>     one combination or function value in each element.  If \code{TRUE},
>     if possible the results are simplified to a matrix or array.
>   }
>   \item{\dots}{ Optional argument to pass to \code{FUN}
>   }
> }
> \details{
>   The case where \code{FUN} is supplied are handled by calling
>   \code{\link{sapply}}, so \code{...}
>   should not include argument to \code{\link{sapply}} -- in particular avoid
>     \code{X} and \code{FUN}.
> }
> \value{
>   Normally, a matrix with \code{m} rows and \code{choose(n,m)} columns.
>   If \code{simplify=FALSE} a list is returned instead, with
>   \code{choose(n,m)} elements.  If \code{FUN} is supplied then the
>   results of calling the function replace the combinations.
> }
> \note{This is similar to the R function \code{combn}.  However,
>   this version returns a list if simplification is not possible, e.g.
>   because the \code{FUN} returns objects with varying lengths.
> }
> \seealso{ \code{\link{combinations}} is used to create the combinations.
>   It is faster to call function directly (note that it gives the combinations
>   in a different order).
>   \code{\link{sapply}} is used when \code{FUN} is supplied.
> \examples{
> combn(5, 3)
> combinations(5, 3)
> combn(letters[1:5], 3)
> combn(5, 3, simplify = FALSE)
> combn(5, 3, FUN = max)
> \keyword{ math }
>
> --------------------------------------------------
> <!doctype s-function-doc system "s-function-doc.dtd" [
> <!entity % S-OLD "INCLUDE">
> ]
> >
> <s-function-doc>
> <s-topics>
>   <s-topic>combn</s-topic>
> </s-topics>
>
> <s-title>
> Generate combinations of m elements out of x
> </s-title>
>
> <s-description>
> Generate all combinations of <code>m</code> elements out of <code>x</code> or
> <code>1:n</code>, and optionally apply a function to each, and return
> a list or simplify to a matrix or array.
> </s-description>
>
> <s-usage>
> <s-old-style-usage>
> combn(x, m, FUN = NULL, simplify = TRUE, ...)
> </s-old-style-usage>
> </s-usage>
>
> <s-details>
> The case where <code>FUN</code> is supplied are handled by calling
> <s-function name="sapply">sapply</s-function>, so <code>...</code>
> should not include argument to <s-function name="sapply">sapply</s-function> &ndash; in particular avoid
> <code>X</code> and <code>FUN</code>.
> </s-details>
>
> <s-value>
> Normally, a matrix with <code>m</code> rows and <code>choose(n,m)</code> columns.
> If <code>simplify=FALSE</code> a list is returned instead, with
> <code>choose(n,m)</code> elements.  If <code>FUN</code> is supplied then the
> results of calling the function replace the combinations.
> </s-value>
>
> <s-section name="NOTE">
> This is similar to the R function <code>combn</code>.  However,
> this version returns a list if simplification is not possible, e.g.
> because the <code>FUN</code> returns objects with varying lengths.
> </s-section>
>
> <s-keywords>
> <s-keyword>math</s-keyword>
> </s-keywords>
> <s-docclass>
> function
> </s-docclass>
> </s-function-doc>
>
> --------------------------------------------------
> .\" -*- nroff -*- generated from .Rd format
> .de PF
> ,br
> .ne 2
> .ft 3
> .nf
> ..
> .de FP
> .br
> .ne 2
> .ft 1
> .fi
> ..
> .BG
> .FN combn
> .TL
> Generate combinations of m elements out of x
> .DN
> Generate all combinations of 'm' elements out of 'x' or
> '1:n', and optionally apply a function to each, and return
> a list or simplify to a matrix or array.
> .CS
>
> combn(x, m, FUN = NULL, simplify = TRUE, ...)
>
> .RT
> Normally, a matrix with 'm' rows and 'choose(n,m)' columns.
> If 'simplify=FALSE' a list is returned instead, with
> 'choose(n,m)' elements.  If 'FUN' is supplied then the
> results of calling the function replace the combinations.
> .DT
> The case where 'FUN' is supplied are handled by calling
> 'sapply', so '\&...'
> should not include argument to 'sapply' - in particular avoid
> 'X' and 'FUN'.Note
> This is similar to the R function 'combn'.  However,
> this version returns a list if simplification is not possible, e.g.
> because the 'FUN' returns objects with varying lengths.
>
> .KW math
> .WR
>
>
>
>
>
>
> --please do not edit the information below--
>
> Version:
>  platform = i686-pc-linux-gnu
>  arch = i686
>  os = linux-gnu
>  system = i686, linux-gnu
>  status =
>  major = 2
>  minor = 4.1
>  year = 2006
>  month = 12
>  day = 18
>  svn rev = 40228
>  language = R
>  version.string = R version 2.4.1 (2006-12-18)
>
> Locale:
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>
> Search Path:
>  .GlobalEnv, package:combinat, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, package:methods, Autoloads, package:base
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From bill at insightful.com  Mon Apr 30 21:22:44 2007
From: bill at insightful.com (bill at insightful.com)
Date: Mon, 30 Apr 2007 21:22:44 +0200 (CEST)
Subject: [Rd] R CMD Rdconv drops sections: arguments, seealso,
	examples (PR#9645)
Message-ID: <20070430192244.DDF145ACBC@slim.kubism.ku.dk>

On Tue, 10 Apr 2007 timh at insightful.com wrote:

> I've created a .Rd file (below), then converted that to .sgml using
> 	R CMD Rdconv --type=Ssgm combn.Rd  > combn.sgml
> The output (shown below) is missing some of the sections:
> 	arguments
> 	seealso
> 	examples
> If instead I convert to .d (below), the same sections are missing,
> and the "note" section is included but without the necessary newline.

The underlying problem was that there were some unmatched open-braces.
(or 'brackets'?) The attached patch to share/perl/R/Rdconv.pm:mark_brackets()
seems to detect unmatched open and close braces and throw an error:

   % R CMD INSTALL -l /tmp/Rlib timhPackage
   * Installing *source* package 'timhPackage' ...
   ** help
    >>> Building/Updating help pages for package 'timhPackage'
        Formats: text html latex example
   Rdconv(): mismatched braces in help file timh.Rd on or after line 12
   ERROR: building help failed for package 'timhPackage'
   ** Removing '/tmp/Rlib/timhPackage'
   ** Restoring previous '/tmp/Rlib/timhPackage'

The code to report the line number doesn't work quite right
since any "% comment" lines in the Rd file have been removed
from $complete_text by the time we get here.  I fudged by
putting 'on or after line XXX' in the error message.

I tried this on 650 packages from CRAN and didn't get any
false alarms, but I'm not convinced that none are possible.

*** R-2.5.0/share/perl/R/Rdconv.pm~	2007-03-29 19:05:08.000000000 -0700
--- R-2.5.0/share/perl/R/Rdconv.pm	2007-04-30 12:18:12.000000000 -0700
***************
*** 254,259 ****
--- 254,271 ----
  	$complete_text =~ s/{([^{}]*)}/$id$1$id/s;
  	print STDERR "." if $debug;
      }
+     # Any remaining brackets must be unmatched ones, hence report error.
+     if ($complete_text =~ /[{}]/s) {
+         # Would like to tell which which line has unmatched { or },
+         # but lines starting with % have already been removed.
+         # Hence the 'on or after' in the message.
+         my $badlineno=0 ;
+         foreach my $line (split /\n/, $complete_text) {
+             $badlineno++;
+             last if ($line =~ /[{}]/) ;
+         }
+         die "Rdconv(): mismatched braces in help file $Rdname on or after line $badlineno\n" ;
+     }
  }

  sub unmark_brackets {

> \name{combn}
> \alias{combn}
> \title{ Generate combinations of m elements out of x }
> \description{
>   Generate all combinations of \code{m} elements out of \code{x} or
>   \code{1:n}, and optionally apply a function to each, and return
>   a list or simplify to a matrix or array.
> }
> \usage{
> combn(x, m, FUN = NULL, simplify = TRUE, ...)
> }
> \arguments{
>   \item{x}{ This is normally an integer \code{n}, in which case
>     combinations of elemnents from \code{1:n} are returned.
>     Otherwise this is a a vector, and elements of the vector are returned.
>   \item{m}{ Number of elements in each combination. }
>   \item{FUN}{ function to apply to each combination.  If \code{NULL},
>     the combinations themselves are returned, one in each column of the
>     result. }
>   \item{simplify}{ If \code{FALSE}, the results are returned as a list,
>     one combination or function value in each element.  If \code{TRUE},
>     if possible the results are simplified to a matrix or array.
>   }
>   \item{\dots}{ Optional argument to pass to \code{FUN}
>   }
> }
> \details{
>   The case where \code{FUN} is supplied are handled by calling
>   \code{\link{sapply}}, so \code{...}
>   should not include argument to \code{\link{sapply}} -- in particular avoid
>     \code{X} and \code{FUN}.
> }
> \value{
>   Normally, a matrix with \code{m} rows and \code{choose(n,m)} columns.
>   If \code{simplify=FALSE} a list is returned instead, with
>   \code{choose(n,m)} elements.  If \code{FUN} is supplied then the
>   results of calling the function replace the combinations.
> }
> \note{This is similar to the R function \code{combn}.  However,
>   this version returns a list if simplification is not possible, e.g.
>   because the \code{FUN} returns objects with varying lengths.
> }
> \seealso{ \code{\link{combinations}} is used to create the combinations.
>   It is faster to call function directly (note that it gives the combinations
>   in a different order).
>   \code{\link{sapply}} is used when \code{FUN} is supplied.
> \examples{
> combn(5, 3)
> combinations(5, 3)
> combn(letters[1:5], 3)
> combn(5, 3, simplify = FALSE)
> combn(5, 3, FUN = max)
> \keyword{ math }
>
> --------------------------------------------------
> <!doctype s-function-doc system "s-function-doc.dtd" [
> <!entity % S-OLD "INCLUDE">
> ]
> >
> <s-function-doc>
> <s-topics>
>   <s-topic>combn</s-topic>
> </s-topics>
>
> <s-title>
> Generate combinations of m elements out of x
> </s-title>
>
> <s-description>
> Generate all combinations of <code>m</code> elements out of <code>x</code> or
> <code>1:n</code>, and optionally apply a function to each, and return
> a list or simplify to a matrix or array.
> </s-description>
>
> <s-usage>
> <s-old-style-usage>
> combn(x, m, FUN = NULL, simplify = TRUE, ...)
> </s-old-style-usage>
> </s-usage>
>
> <s-details>
> The case where <code>FUN</code> is supplied are handled by calling
> <s-function name="sapply">sapply</s-function>, so <code>...</code>
> should not include argument to <s-function name="sapply">sapply</s-function> &ndash; in particular avoid
> <code>X</code> and <code>FUN</code>.
> </s-details>
>
> <s-value>
> Normally, a matrix with <code>m</code> rows and <code>choose(n,m)</code> columns.
> If <code>simplify=FALSE</code> a list is returned instead, with
> <code>choose(n,m)</code> elements.  If <code>FUN</code> is supplied then the
> results of calling the function replace the combinations.
> </s-value>
>
> <s-section name="NOTE">
> This is similar to the R function <code>combn</code>.  However,
> this version returns a list if simplification is not possible, e.g.
> because the <code>FUN</code> returns objects with varying lengths.
> </s-section>
>
> <s-keywords>
> <s-keyword>math</s-keyword>
> </s-keywords>
> <s-docclass>
> function
> </s-docclass>
> </s-function-doc>
>
> --------------------------------------------------
> .\" -*- nroff -*- generated from .Rd format
> .de PF
> ,br
> .ne 2
> .ft 3
> .nf
> ..
> .de FP
> .br
> .ne 2
> .ft 1
> .fi
> ..
> .BG
> .FN combn
> .TL
> Generate combinations of m elements out of x
> .DN
> Generate all combinations of 'm' elements out of 'x' or
> '1:n', and optionally apply a function to each, and return
> a list or simplify to a matrix or array.
> .CS
>
> combn(x, m, FUN = NULL, simplify = TRUE, ...)
>
> .RT
> Normally, a matrix with 'm' rows and 'choose(n,m)' columns.
> If 'simplify=FALSE' a list is returned instead, with
> 'choose(n,m)' elements.  If 'FUN' is supplied then the
> results of calling the function replace the combinations.
> .DT
> The case where 'FUN' is supplied are handled by calling
> 'sapply', so '\&...'
> should not include argument to 'sapply' - in particular avoid
> 'X' and 'FUN'.Note
> This is similar to the R function 'combn'.  However,
> this version returns a list if simplification is not possible, e.g.
> because the 'FUN' returns objects with varying lengths.
>
> .KW math
> .WR
>
>
>
>
>
>
> --please do not edit the information below--
>
> Version:
>  platform = i686-pc-linux-gnu
>  arch = i686
>  os = linux-gnu
>  system = i686, linux-gnu
>  status =
>  major = 2
>  minor = 4.1
>  year = 2006
>  month = 12
>  day = 18
>  svn rev = 40228
>  language = R
>  version.string = R version 2.4.1 (2006-12-18)
>
> Locale:
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>
> Search Path:
>  .GlobalEnv, package:combinat, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, package:methods, Autoloads, package:base
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


