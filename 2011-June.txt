From thomas.friedrichsmeier at ruhr-uni-bochum.de  Wed Jun  1 08:44:56 2011
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: 1 Jun 2011 08:44:56 +0200
Subject: [Rd] assignInNamespace and new bindings
In-Reply-To: <alpine.DEB.2.00.1105311353280.2045@luke-inspiron>
References: <4DE4A82E.7060803@r-enthusiasts.com>
	<201105312016.44472.thomas.friedrichsmeier@ruhr-uni-bochum.de>
	<alpine.DEB.2.00.1105311353280.2045@luke-inspiron>
Message-ID: <201106010845.00351.thomas.friedrichsmeier@ruhr-uni-bochum.de>

Hi,

On Tuesday 31 May 2011, luke-tierney at uiowa.edu wrote:
> Yes you should. Changing things in other people's packages is not a
> safe thing to do.

sorry to insist, but I was hoping for a slightly more specific pointer. I'll 
try asking it another way:

Suppose I was using assignInNamespace() entirely bona fide, i.e. to develop and 
test patches with the intent to offer them to the package maintainer(s) for 
inclusion. What sort of gotchas should I be looking out for, specifically with 
respect to the compiler? Also, if the package that I'm trying to improve is a 
base package?

Regards
Thomas

P.S.: Just to let you know, why I do not feel too much ashamed or scared of 
changing things in other people's packages, here's (slighlty simplified) the 
pattern that I'm following:

backup <- original
replacement <- function() {
      call.my.hook()
      eval(body(backup))
}
formals(replacement) <- formals(backup)
environment(replacement) <- environment(backup)
assignInNamespace(...)

I know that leaves subtle differences beyond anything the compiler may be 
doing, such as in the sys.calls(). I am also pretty certain that these subtle 
differences are completely irrelevant *in those functions that I modify* this 
way. And I have a bunch of automated tests to make me sleep better, too.

Ok, and for a select few functions, my replacements are more "radical", such 
as for utils::savehistory(). But then, that is essentially non-functional in 
my use-case in its original incarnation, in the first place, so I'm not really 
scared of making things worse, there, either.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part.
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110601/553724cf/attachment.bin>

From janko.thyson.rstuff at googlemail.com  Wed Jun  1 09:49:04 2011
From: janko.thyson.rstuff at googlemail.com (Janko Thyson)
Date: Wed, 01 Jun 2011 09:49:04 +0200
Subject: [Rd] Query super- and subclasses of a class: is there a better
 way than to use 'completeClassDefinition()'
In-Reply-To: <4DE51438.6030109@fhcrc.org>
References: <4DE3BDC4.8050009@googlemail.com> <4DE51438.6030109@fhcrc.org>
Message-ID: <4DE5EEF0.70205@googlemail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110601/9820aad7/attachment.pl>

From iago.mosqueira at gmail.com  Wed Jun  1 13:39:26 2011
From: iago.mosqueira at gmail.com (Iago Mosqueira)
Date: Wed, 1 Jun 2011 13:39:26 +0200
Subject: [Rd] Overloading S4 methods
Message-ID: <BANLkTi=KwUzxy+3YA+HWmP-PPozD-g7zkg@mail.gmail.com>

Dear all,

I am experiencing some problems with S4 method overloading. I have
defined a generic for graphics:plot, using

setGeneric("plot", useAsDefault = plot)

and with

importFrom('graphics', 'plot') and

exportMethods('plot') in the NAMESPACE file of pkg A.

I then proceed to define a method for signature c('myS4class',
'missing'). This works as expected: selectMethod('plot',
c('myS4class', 'missing')) returns the newly defined method, and the
method gets called when invoked.

Another pkg, B, wishes to overload this and redefines the method for
the same signature. A method is defined for c('myS4class', 'missing'),
and exported on the NAMESPACE. The new method is shown by
selectMethod() after pkg B has been loaded, but a call to

plot(anobjectofmyS4class)

comes up with the result of running the first method, from pkg A. I
have tried importing 'plot' in B's NAMESPACE from both graphics or A,
but the end result is the same.

Package B does the same thing for a method created by pkg A, myMethod,
and that works fine.

Any pointers or where this might be going wrong? How is it that a
different method than the one shown by selectMethod() is being run?
Something to do with the 'missing' part of the signature?

Many thanks,



Iago Mosqueira


From simon.urbanek at r-project.org  Wed Jun  1 15:50:52 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 1 Jun 2011 09:50:52 -0400
Subject: [Rd] GUI hooks in R [Was: assignInNamespace and new bindings]
In-Reply-To: <201105312323.40199.thomas.friedrichsmeier@ruhr-uni-bochum.de>
References: <4DE4A82E.7060803@r-enthusiasts.com>
	<201105312211.41716.thomas.friedrichsmeier@ruhr-uni-bochum.de>
	<42ECBCC7-B920-444A-9BA4-014B994A0C38@r-project.org>
	<201105312323.40199.thomas.friedrichsmeier@ruhr-uni-bochum.de>
Message-ID: <8B0E89F3-1074-46FC-B80A-3E0111D234D2@r-project.org>


On May 31, 2011, at 5:23 PM, Thomas Friedrichsmeier wrote:

> On Tuesday 31 May 2011, Simon Urbanek wrote:
>> The history entries are somewhat in a grey area, because most GUIs use
>> their own implementation of history (and thus they are irrelevant) and the
>> *history() commands are documented to only use readline-backend. That
>> said, they could be easily used by all GUIs if the Windows code is
>> amended.
> 
> Actually, I would suggest to use a different solution, though: This is not 
> really a problem that needs to be addressed on a low level of pointers to C 
> functions. Perhaps it would make more sense to allow to set some R function(s) 
> to handle these via options() (or perhaps via a dedicated gui.options()).
> 

I suppose, yes, it's possible, but I see somewhat of an asymmetry if done that way : GUIs are like plug-ins in that there is a set of functions they have to implement to work properly. In the current state this is done using the C-level hooks, but they are incomplete in that some of the required hooks are not available on all platforms. However, if you introduce an additional layer of R function hooks, there will be two sets of competing ways for the GUI so register and some of them are simply not feasible on the R level (console handling, for example, which is why we have C-level hooks). It also makes the GUI unnecessary messy, since they will need to provide both C code and R code, where the R code essentially just points to C code, practically replicating what the C-level hooks would do (just more complicated as it requires embedded symbol registrations etc.).

Currently I'm more inclined to make the hooks cross-platform (maybe conditional on the GUI type set to "custom" or something like that). But if someone wants to devise some nice way of customizing parts using R callback, I won't oppose it.


>>> - utils::select.list() and utils::menu(): I want to show my own UI if
>>> graphics==TRUE. Currently, select.list() has special code for windows,
>>> "aqua" and tcltk; menu() essentially assumes the same code. Give me a
>>> way to run register my own UI.
>> 
>> ptr_do_selectlist provides the customization and could be extended to other
>> platforms.
> 
> See above. But yes, if at least it was cross-platform, that would be nice.
> 
>>> - base::system(), base::system2(): As you will be aware, capturing the
>>> output of system commands in a GUI is tricky on Unix. I do have a
>>> solution for that, but I need to run synchronization code at the start
>>> and end of system() and system2(), in order to get interleaving right.
>>> Give me a hook, each, at the start and end of these functions.
>> 
>> I'm not sure I understand your concern here. What exactly is your worry?
>> Capturing output is trivial since it simply involves creating a pipe when
>> you initialize R which you can read while R is running and the
>> synchronization is provided by the OS, no magic involved.
> 
> Is that pipe buffered?

No (although you could buffer it if you wanted).


> In my setup it is. And so consider code like this:
>   for (i in 1:10) {
>       print (i)
>       system (paste ("echo", i)) 
>   }
> How do you ensure that this results in
> 1
> 1
> 2
> 2
> ...
> rather than e.g.
> 1
> 2
> 3
> 1
> 2
> 4
> 3
> 5
> 6
> ...
> 

In R the output will be 
1
1
2
2
by design - system() is synchronous, so stdout will arrive between the WriteConsole calls - try in the the R for Mac GUI and you'll see:

>   for (i in 1:10) {
+       print (i)
+       system (paste ("echo", i)) 
+   }
[1] 1
1
[1] 2
2
[1] 3
3
[1] 4
4
[1] 5
5
[1] 6
6
[1] 7
7
[1] 8
8
[1] 9
9
[1] 10
10
> 

Obviously, for wait=FALSE all bets are off. [Note: although the Mac GUI uses a hook for system, it is to run commands as root, not to do any special handling of I/O].


> I could not get it to work for RKWard without adding code to make sure the "other" output is flushed.

If you have issues with stdout buffer before the pipe, use can use setvbuf() to disable buffering.


> (Note: I'm capturing regular R output via 
> R_WriteConsoleEx, since I am interested in the differentiation between output 
> types that this provides. So I cannot simply push that down the same pipe.).
> 
>>> - graphics::plot.new(): I need a hook *before* the new plot is started,
>>> in order to properly implement device-independent plot history. I would
>>> appreciate not having to implement my own graphics device just to be
>>> able to run some code at this point.
>>> 
>>> - grDevices::dev.off(): I need a hook before the device is closed. Also
>>> for plot history.
>>> 
>>> - grDevices::dev.set(): I need a hook after the new device has been set.
>>> Also for plot history.
>>> 
>>> - grid::newpage(): See graphics::plot.new(). Of course, even better, I
>>> would like to have a hook that is called every time before a new page /
>>> frame is started on a device.
>> 
>> For all of the above: all of them are already available a device callbacks
>> (newPage, close, activate and newPage again).
> 
> Quoting myself: I would appreciate not having to implement my own graphics 
> device just to be able to run some code at [these] point[s].
> 

Cautiously I would argue you have to the moment you're outside R, essentially since the built-in graphics devices are not guaranteed to work when embedded. In practice, I think if you write a GUI, you have to provide a GD - that is the only reasonable way you can seamlessly incorporate R graphics into your GUI.

That said, there is a precedent for graphics hooks. The problem I see is the same that became apparent with grid last time we added hooks - there are potentially multiple ways to get to the same C level point, and they are either easily forgotten, or even hard to enumerate. For example, dev.set() is not the only way to activate a device - it can be activated from the menu and other means via selectDevice() which is at C level, so there is no R code involved at all, thus setting a hook on dev.set() is will work only in a  subset of cases and thus you cannot expect consistency in your GUI.

(Note: none of my comments are specific to RKWard, since it is not even available for OS X so I don't know anything about it)

Cheers,
Simon


From lawrence.michael at gene.com  Wed Jun  1 18:15:10 2011
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Wed, 1 Jun 2011 09:15:10 -0700
Subject: [Rd] possibly invalid assertion in setRefClass?
Message-ID: <BANLkTi=zosXhcfDav-Ov69MKdKAXgf8dtw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110601/3b4c2f8b/attachment.pl>

From wdunlap at tibco.com  Wed Jun  1 18:21:07 2011
From: wdunlap at tibco.com (William Dunlap)
Date: Wed, 1 Jun 2011 09:21:07 -0700
Subject: [Rd] possibly invalid assertion in setRefClass?
In-Reply-To: <BANLkTi=zosXhcfDav-Ov69MKdKAXgf8dtw@mail.gmail.com>
References: <BANLkTi=zosXhcfDav-Ov69MKdKAXgf8dtw@mail.gmail.com>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D7000442FAFD@NA-PA-VBE03.na.tibco.com>

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Michael Lawrence
> Sent: Wednesday, June 01, 2011 9:15 AM
> To: r-devel at r-project.org
> Subject: [Rd] possibly invalid assertion in setRefClass?
> 
> > setRefClass("Foo", fields = list())
> Error in setRefClass("Foo", fields = list()) :
>   A list argument for fields must have nonempty names for all 
> the fields
> 
> In my opinion, the above should not fail. There are no fields.

You can work around it by attaching an empty names attribute
to fields:
  > setRefClass("Foo", fields = structure(list(), names=character()))
  Generator object for class "Foo":
  
  No fields defined
  
   Class Methods:
      "callSuper", "copy", "export", "field", "getClass", "getRefClass",
"import", "initFields"


   Reference Superclasses:
      "envRefClass"

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com  


> 
> Thanks,
> Michael
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From thomas.friedrichsmeier at ruhr-uni-bochum.de  Wed Jun  1 19:50:01 2011
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: 1 Jun 2011 19:50:01 +0200
Subject: [Rd] GUI hooks in R [Was: assignInNamespace and new bindings]
In-Reply-To: <8B0E89F3-1074-46FC-B80A-3E0111D234D2@r-project.org>
References: <4DE4A82E.7060803@r-enthusiasts.com>
	<201105312323.40199.thomas.friedrichsmeier@ruhr-uni-bochum.de>
	<8B0E89F3-1074-46FC-B80A-3E0111D234D2@r-project.org>
Message-ID: <201106011950.05889.thomas.friedrichsmeier@ruhr-uni-bochum.de>

On Wednesday 01 June 2011, Simon Urbanek wrote:
> I suppose, yes, it's possible, but I see somewhat of an asymmetry if done
> that way : GUIs are like plug-ins in that there is a set of functions they
> have to implement to work properly. In the current state this is done
> using the C-level hooks, but they are incomplete in that some of the
> required hooks are not available on all platforms. However, if you
> introduce an additional layer of R function hooks, there will be two sets
> of competing ways for the GUI so register and some of them are simply not
> feasible on the R level (console handling, for example, which is why we
> have C-level hooks).

Well we already have both, at least in some parts. See e.g. options() "pager" 
and "editor" (which have dupes on the C level, some of which are not cross-
platform, again), and "browser" (which is a likely candidate for GUI-
customization, and does not have a C equivalent). Possibly options("error"), 
too, and perhaps some others.

Options on the R level have some obvious advantages, e.g. it is not quite as 
impossible to change the function signature at a later point of time. Also 
keep in mind that GUIs will almost certainly comprise some R code, but do not 
necessarily have to have C code. Think tcltk or RGtk based UIs, for instance. 
Why shouldn't these have an easy way to customize select.list(), for instance. 
Finally, having this in options() will allow power-users to utilize selected 
GUI elements, whereever they like (or to disable their GUIs graphical dialogs 
for some features).

Also, I can give you a bunch more UI functions that I would like to be able to 
customize cross-platform. From the top of my head:
- Yes / no / cancel questions (graphical only on Windows, currently, but why 
not let the hosting GUI decide?)
- readline()
- Progress bars
- Adding menus (several GUIs bring their own functions for this, but there is 
no standard API. Thus packages have a hard time integrating with more than 
just one GUI.)

Do you seriously want to have a C API for all of these?

> It also makes the GUI unnecessary messy, since they
> will need to provide both C code and R code, where the R code essentially
> just points to C code, practically replicating what the C-level hooks
> would do (just more complicated as it requires embedded symbol
> registrations etc.).

Personally, I find that easier than even setting the C pointers cross-platform 
(because the way to set these is platform specific).
 
> Currently I'm more inclined to make the hooks cross-platform (maybe
> conditional on the GUI type set to "custom" or something like that). But
> if someone wants to devise some nice way of customizing parts using R
> callback, I won't oppose it.

Well, if that stands *real* chances of being included, I will happily make a 
start (and take the discussion to R-SIG-GUI).

> If you have issues with stdout buffer before the pipe, use can use
> setvbuf() to disable buffering.

Well, actually I capture the stdout in a separate process (RKWard uses two 
processes, anyway). Perhaps moving all output capturing to one process might 
fix my interleaving issues without the need to mess with system[2](). I'll give 
that a try.
 
> Cautiously I would argue you have to the moment you're outside R,
> essentially since the built-in graphics devices are not guaranteed to work
> when embedded. In practice, I think if you write a GUI, you have to
> provide a GD - that is the only reasonable way you can seamlessly
> incorporate R graphics into your GUI.

Not on Windows and X11, at least. Try RKWard on one of these platforms, and 
see if you can find any seams. Then check your dev.list() to see the underlying 
devices.

Admittedly, we do not have support for the Quartz device, yet, and this may be 
harder than Windows and X11, but I'm still optimistic.
 
> That said, there is a precedent for graphics hooks. The problem I see is
> the same that became apparent with grid last time we added hooks - there
> are potentially multiple ways to get to the same C level point, and they
> are either easily forgotten, or even hard to enumerate. For example,
> dev.set() is not the only way to activate a device - it can be activated
> from the menu and other means via selectDevice() which is at C level, so
> there is no R code involved at all, thus setting a hook on dev.set() is
> will work only in a  subset of cases and thus you cannot expect
> consistency in your GUI.

Well, in our particular use case, we can query the window manager for 
everything else we need to know. But of course there are several more use-
cases, where adding hooks at the R level would not be good enough (one would 
be multi-device plot history feature).

However, *if* such hooks are going to be integrated into base R, then it 
_think_, it should be no problem to root these hooks at the C level, rather 
than the R level.

> (Note: none of my comments are specific to RKWard, since it is not even
> available for OS X so I don't know anything about it)

Well, I can't blame you for not trying it, since compilation on the Mac does 
take ages, and we don't promise the result is any useful, ATM. We simply don't 
have a developer with a Mac in the project. But most of the time, you *can* 
compile RKWard on Mac OS X, and it is known to work at least some of the time.

Regards
Thomas
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part.
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110601/00a96ee3/attachment.bin>

From luke-tierney at uiowa.edu  Wed Jun  1 20:44:48 2011
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Wed, 1 Jun 2011 13:44:48 -0500
Subject: [Rd] assignInNamespace and new bindings
In-Reply-To: <201106010845.00351.thomas.friedrichsmeier@ruhr-uni-bochum.de>
References: <4DE4A82E.7060803@r-enthusiasts.com>
	<201105312016.44472.thomas.friedrichsmeier@ruhr-uni-bochum.de>
	<alpine.DEB.2.00.1105311353280.2045@luke-inspiron>
	<201106010845.00351.thomas.friedrichsmeier@ruhr-uni-bochum.de>
Message-ID: <alpine.LFD.2.00.1106011337500.28708@itasca.stat.uiowa.edu>

On Wed, 1 Jun 2011, Thomas Friedrichsmeier wrote:

> Hi,
>
> On Tuesday 31 May 2011, luke-tierney at uiowa.edu wrote:
>> Yes you should. Changing things in other people's packages is not a
>> safe thing to do.
>
> sorry to insist, but I was hoping for a slightly more specific pointer. I'll
> try asking it another way:
>
> Suppose I was using assignInNamespace() entirely bona fide, i.e. to develop and
> test patches with the intent to offer them to the package maintainer(s) for
> inclusion. What sort of gotchas should I be looking out for, specifically with
> respect to the compiler? Also, if the package that I'm trying to improve is a
> base package?

At the moment the main issue is that the assignment may not have any
effect on compiled code because the compiled code accesses the
finctionality known to be provided by these funcions in some more
direct way.  Examples are BUILTIN functions, which are called directly
through the internal table, and some functions that are simple
wrappers around .Internal calls where the compiled code in effect goes
directly to the .Internal call.  At the moment this applies only to
some functions in base packages but may in the future extend to other
packages.

Best,

luke

>
> Regards
> Thomas
>
> P.S.: Just to let you know, why I do not feel too much ashamed or scared of
> changing things in other people's packages, here's (slighlty simplified) the
> pattern that I'm following:
>
> backup <- original
> replacement <- function() {
>      call.my.hook()
>      eval(body(backup))
> }
> formals(replacement) <- formals(backup)
> environment(replacement) <- environment(backup)
> assignInNamespace(...)
>
> I know that leaves subtle differences beyond anything the compiler may be
> doing, such as in the sys.calls(). I am also pretty certain that these subtle
> differences are completely irrelevant *in those functions that I modify* this
> way. And I have a bunch of automated tests to make me sleep better, too.
>
> Ok, and for a select few functions, my replacements are more "radical", such
> as for utils::savehistory(). But then, that is essentially non-functional in
> my use-case in its original incarnation, in the first place, so I'm not really
> scared of making things worse, there, either.
>

-- 
Luke Tierney
Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From simon.urbanek at r-project.org  Wed Jun  1 22:02:16 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 1 Jun 2011 16:02:16 -0400
Subject: [Rd] GUI hooks in R [Was: assignInNamespace and new bindings]
In-Reply-To: <201106011950.05889.thomas.friedrichsmeier@ruhr-uni-bochum.de>
References: <4DE4A82E.7060803@r-enthusiasts.com>
	<201105312323.40199.thomas.friedrichsmeier@ruhr-uni-bochum.de>
	<8B0E89F3-1074-46FC-B80A-3E0111D234D2@r-project.org>
	<201106011950.05889.thomas.friedrichsmeier@ruhr-uni-bochum.de>
Message-ID: <79B7D126-C680-4F5F-9366-B96C1D4AAD34@r-project.org>


On Jun 1, 2011, at 1:50 PM, Thomas Friedrichsmeier wrote:

> On Wednesday 01 June 2011, Simon Urbanek wrote:
>> I suppose, yes, it's possible, but I see somewhat of an asymmetry if done
>> that way : GUIs are like plug-ins in that there is a set of functions they
>> have to implement to work properly. In the current state this is done
>> using the C-level hooks, but they are incomplete in that some of the
>> required hooks are not available on all platforms. However, if you
>> introduce an additional layer of R function hooks, there will be two sets
>> of competing ways for the GUI so register and some of them are simply not
>> feasible on the R level (console handling, for example, which is why we
>> have C-level hooks).
> 
> Well we already have both, at least in some parts. See e.g. options() "pager" 
> and "editor" (which have dupes on the C level, some of which are not cross-
> platform, again), and "browser" (which is a likely candidate for GUI-
> customization, and does not have a C equivalent). Possibly options("error"), 
> too, and perhaps some others.
> 
> Options on the R level have some obvious advantages, e.g. it is not quite as 
> impossible to change the function signature at a later point of time. Also 
> keep in mind that GUIs will almost certainly comprise some R code, but do not 
> necessarily have to have C code.

This is a whole different story. So far I have been talking about embedding GUIs which use Read/WriteConsole and that is also what the original question was about. Obviously you can add toolkit packages, but I don't consider those GUIs in the discussed sense. My argument was that we should clean up the embedding GUIs facilities first by making them consistent across platforms. Those should not need to require separate R code.


> Think tcltk or RGtk based UIs, for instance. 

Those are fairly special in that there are embedding GUIs available as examples (although I'm not sure how functional). However you may not have meant that aspect of it so the above applies.


> Why shouldn't these have an easy way to customize select.list(), for instance. 
> Finally, having this in options() will allow power-users to utilize selected 
> GUI elements, whereever they like (or to disable their GUIs graphical dialogs 
> for some features).
> 

Agreed, but this is a separate question and consideration. But I take your point about "pager" option, for example. It would be nice to have concise list of UI-customization in the non-embedded sense that can be used by any UI packages. 


> Also, I can give you a bunch more UI functions that I would like to be able to 
> customize cross-platform. From the top of my head:
> - Yes / no / cancel questions (graphical only on Windows, currently, but why 
> not let the hosting GUI decide?)
> - readline()
> - Progress bars



> - Adding menus (several GUIs bring their own functions for this, but there is 
> no standard API. Thus packages have a hard time integrating with more than 
> just one GUI.)
> 

I definitely agree with this one - each GUI has its own functions for menu handling which is annoying to say the least.


> Do you seriously want to have a C API for all of these?
> 

Not all, see above. However, menus are an interesting example - it can't be quite a vanilla customization, because the implementation of the menu backend is heavily dependent on what embedding GUI is running R, so it is not really a customization as there may not be any choices (e.g., you can't use JGR's menu functions in the Mac GUI)

A while ago I was proposing a different approach when working on iWidgets - there would be a global GUI object that would be used for UI functions so they can dispatch on it. Then methods could be written for the various GUI object classes implementing different GUIs and behaviors so the R-side code would be very simple - just calling generics - whereas the actual implementation of those methods could be in any package that is providing the current GUI. This would leverage method dispatch as the natural selection of behavior. I still like this the best - you could even have packages that specialize other GUIs and create subclasses etc. Also now we actually have the object system supporting GUI-style semantics (reference) in R... Again, this is not for user-side customization but to link UI provides with R's UI functions.


>> It also makes the GUI unnecessary messy, since they
>> will need to provide both C code and R code, where the R code essentially
>> just points to C code, practically replicating what the C-level hooks
>> would do (just more complicated as it requires embedded symbol
>> registrations etc.).
> 
> Personally, I find that easier than even setting the C pointers cross-platform 
> (because the way to set these is platform specific).
> 

Well, it should be consistent :).


>> Currently I'm more inclined to make the hooks cross-platform (maybe
>> conditional on the GUI type set to "custom" or something like that). But
>> if someone wants to devise some nice way of customizing parts using R
>> callback, I won't oppose it.
> 
> Well, if that stands *real* chances of being included, I will happily make a 
> start (and take the discussion to R-SIG-GUI).
> 

I suppose it is a good idea (I'll need to subscribe to SIG-GUI, though ;)).
 

>> If you have issues with stdout buffer before the pipe, use can use
>> setvbuf() to disable buffering.
> 
> Well, actually I capture the stdout in a separate process (RKWard uses two 
> processes, anyway). Perhaps moving all output capturing to one process might 
> fix my interleaving issues without the need to mess with system[2](). I'll give 
> that a try.
> 

I guess then your issue may be in IPC since your second process may not be in sync with the R process event loop ... Also if you use separate file descriptors then they are by default block-bufferend which won't work so synchronization issues aside you'll need setvbuf() to make them unbuffered.


>> Cautiously I would argue you have to the moment you're outside R,
>> essentially since the built-in graphics devices are not guaranteed to work
>> when embedded. In practice, I think if you write a GUI, you have to
>> provide a GD - that is the only reasonable way you can seamlessly
>> incorporate R graphics into your GUI.
> 
> Not on Windows and X11, at least. Try RKWard on one of these platforms, and 
> see if you can find any seams. Then check your dev.list() to see the underlying 
> devices.
> 
> Admittedly, we do not have support for the Quartz device, yet, and this may be 
> harder than Windows and X11, but I'm still optimistic.
> 

Quartz is fairly nice in that you can provide additional back-ends fairly quickly - see R_ext/QuartzDevice.h - so you could embed it directly into your GUI. (But then I suppose the Mac support is too far away from reality for this to be relevant ;))


>> That said, there is a precedent for graphics hooks. The problem I see is
>> the same that became apparent with grid last time we added hooks - there
>> are potentially multiple ways to get to the same C level point, and they
>> are either easily forgotten, or even hard to enumerate. For example,
>> dev.set() is not the only way to activate a device - it can be activated
>> from the menu and other means via selectDevice() which is at C level, so
>> there is no R code involved at all, thus setting a hook on dev.set() is
>> will work only in a  subset of cases and thus you cannot expect
>> consistency in your GUI.
> 
> Well, in our particular use case, we can query the window manager for 
> everything else we need to know. But of course there are several more use-
> cases, where adding hooks at the R level would not be good enough (one would 
> be multi-device plot history feature).
> 
> However, *if* such hooks are going to be integrated into base R, then it 
> _think_, it should be no problem to root these hooks at the C level, rather 
> than the R level.
> 
>> (Note: none of my comments are specific to RKWard, since it is not even
>> available for OS X so I don't know anything about it)
> 
> Well, I can't blame you for not trying it, since compilation on the Mac does 
> take ages, and we don't promise the result is any useful, ATM. We simply don't 
> have a developer with a Mac in the project. But most of the time, you *can* 
> compile RKWard on Mac OS X, and it is known to work at least some of the time.
> 

I consider it theoretical, because you actually require KDE which doesn't exist natively so far (and building it in X11 is like requiring Linux ;) - it's in fact much easier to run Linux VM than to try to build KDE on OS X :P I did try at some point...). This is OT so feel free to reply in private if you wish -- but why don't you abstract out the interface so that you can use native toolkits (like RStudio does - that's one thing they did well)?

Cheers,
Simon


From thomas.friedrichsmeier at ruhr-uni-bochum.de  Wed Jun  1 22:52:32 2011
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: 1 Jun 2011 22:52:32 +0200
Subject: [Rd] GUI hooks in R [Was: assignInNamespace and new bindings]
In-Reply-To: <79B7D126-C680-4F5F-9366-B96C1D4AAD34@r-project.org>
References: <4DE4A82E.7060803@r-enthusiasts.com>
	<201106011950.05889.thomas.friedrichsmeier@ruhr-uni-bochum.de>
	<79B7D126-C680-4F5F-9366-B96C1D4AAD34@r-project.org>
Message-ID: <201106012252.36918.thomas.friedrichsmeier@ruhr-uni-bochum.de>

On Wednesday 01 June 2011, Simon Urbanek wrote:
> This is a whole different story. So far I have been talking about embedding
> GUIs which use Read/WriteConsole and that is also what the original
> question was about. Obviously you can add toolkit packages, but I don't
> consider those GUIs in the discussed sense. 

To the degree that we were talking about RKWard: No, this is not, what the 
original question was about. But I would be very reluctant about trying to 
distinguish between different types of GUIs. IMO, GUIs are pieces of software 
that do GUI stuff.

True, some sets of features go hand in hand. E.g. it seems unlikely, that a 
GUI will want to provide custom history()-handling, without using 
Read/WriteConsole on the C level. But many other features could be interesting 
to a much wider range of use-cases. Why not make it easily possible to write a 
mini-GUI package, which simply moves some user interaction (yes/no questions, 
selection from lists, readline()) from the console to graphical dialogs. This 
does not in any way require embedding, conceptually.
 
> My argument was that we should
> clean up the embedding GUIs facilities first by making them consistent
> across platforms. Those should not need to require separate R code.

Very much agreed about making these facilities consistent across platforms. 
But again, the second point can also be looked at from the other side: Writing 
a "slim" GUI package should not need to require separate C code.

> > Think tcltk or RGtk based UIs, for instance.
> 
> Those are fairly special in that there are embedding GUIs available as
> examples (although I'm not sure how functional). However you may not have
> meant that aspect of it so the above applies.

No, I meant, you can write GUI functionality entirely in R using these 
packages, as they already wrap all the C.

> > Why shouldn't these have an easy way to customize select.list(), for
> > instance. Finally, having this in options() will allow power-users to
> > utilize selected GUI elements, whereever they like (or to disable their
> > GUIs graphical dialogs for some features).
> 
> Agreed, but this is a separate question and consideration.

True. But I think it may be possible to enable this within a single solution.

> Not all, see above. However, menus are an interesting example - it can't be
> quite a vanilla customization, because the implementation of the menu
> backend is heavily dependent on what embedding GUI is running R, so it is
> not really a customization as there may not be any choices (e.g., you
> can't use JGR's menu functions in the Mac GUI)

No, but still the GUI can provide functions, whether or not it is an embedding 
one. Think Rcmdr, which does not embed, but does provide menus, which third 
party packages may want to add to.
 
> A while ago I was proposing a different approach when working on iWidgets -
> there would be a global GUI object that would be used for UI functions so
> they can dispatch on it. Then methods could be written for the various GUI
> object classes implementing different GUIs and behaviors so the R-side
> code would be very simple - just calling generics - whereas the actual
> implementation of those methods could be in any package that is providing
> the current GUI. This would leverage method dispatch as the natural
> selection of behavior. I still like this the best - you could even have
> packages that specialize other GUIs and create subclasses etc. Also now we
> actually have the object system supporting GUI-style semantics (reference)
> in R... Again, this is not for user-side customization but to link UI
> provides with R's UI functions.

Well, on the outcome side, that's not too far from what I have in mind. Let 
the GUI provide a set of R functions to call for various tasks. I could 
certainly get along with such a solution, although admittedly, I fail to see 
the practical point, here. To me, easy user-side customization (starting from 
scratch or from any particular GUIs defaults) would easily trump the ability 
to sub-class GUIs.

> Quartz is fairly nice in that you can provide additional back-ends fairly
> quickly - see R_ext/QuartzDevice.h - so you could embed it directly into
> your GUI. (But then I suppose the Mac support is too far away from reality
> for this to be relevant ;))

Well, that's good to know. Practical Mac support is roughly one Mac posession 
away.

Regards
Thomas

---------------- OT below this line ----------------

> This is OT so feel free to reply in
> private if you wish -- but why don't you abstract out the interface so
> that you can use native toolkits (like RStudio does - that's one thing
> they did well)?

Two short points:
- The abstraction is there. KDE *can* be compiled natively on Mac (but that's 
not much less heavy than the X11 variant). We don't recommend this option for 
RKWard, ATM, because we still lack a solution for the Quartz device (see 
above), and because I never found the time to test it at all.
- Abstracting KDE away from 50.000+ lines of code, much of which *is* 
precisely about the interface? Yeah, good one. But see, I don't even wish to 
do away with it. Yes, it is quite a heavy dependency, esp. on the Mac. But it 
also provides a whole lot of really good features, which are central to 
RKWard. Trust me, I have taken the time to evaluate my options.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part.
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110601/40bb3bed/attachment.bin>

From APeterhansl at GAINCapital.com  Thu Jun  2 00:00:30 2011
From: APeterhansl at GAINCapital.com (Alexander Peterhansl)
Date: Wed, 1 Jun 2011 22:00:30 +0000
Subject: [Rd] read.csv and FileEncoding in Windows version of R 2.13.0
Message-ID: <FD59D3740610AB4388AA1BDC7FC9531D79474D@CRP11EXHMBS01.GAINCapital.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110601/9af788e6/attachment.pl>

From murdoch.duncan at gmail.com  Thu Jun  2 01:34:54 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 01 Jun 2011 19:34:54 -0400
Subject: [Rd] read.csv and FileEncoding in Windows version of R 2.13.0
In-Reply-To: <FD59D3740610AB4388AA1BDC7FC9531D79474D@CRP11EXHMBS01.GAINCapital.com>
References: <FD59D3740610AB4388AA1BDC7FC9531D79474D@CRP11EXHMBS01.GAINCapital.com>
Message-ID: <4DE6CC9E.8000407@gmail.com>

On 01/06/2011 6:00 PM, Alexander Peterhansl wrote:
>
> Dear R-devel List:
>
> read.csv() seems to have changed in R version 2.13.0 as compared to version 2.12.2 when reading in simple CSV files.
>
> Suppose I read in a 2-column CSV file ("test.csv"), say
> 1, a
> 2, b
>
> If file is encoded as UTF-8 (on Windows 7), then under R 2.13.0

That file could be pure ASCII, or could include a byte order mark.  I 
tried both, and I didn't get the error your saw.  So I think I need to 
see the file to diagnose this.

Could you put it in a .zip file and email it to me?

Duncan Murdoch


> read.csv("test.csv",fileEncoding="UTF-8",header=FALSE) yields the following output
>    V1
> 1  ?
> Warning messages:
> 1: In read.table(file = file, header = header, sep = sep, quote = quote,  :
>    invalid input found on input connection 'test.csv'
> 2: In read.table(file = file, header = header, sep = sep, quote = quote,  :
>    incomplete final line found by readTableHeader on 'test.csv'
>
> Under R 2.12.2 it runs problem-free and yields the expected:
>    V1 V2
> 1  1  a
> 2  2  b
>
> Please help.
>
> Regards,
> Alex
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From D.Strbenac at garvan.org.au  Thu Jun  2 02:00:09 2011
From: D.Strbenac at garvan.org.au (Dario Strbenac)
Date: Thu,  2 Jun 2011 10:00:09 +1000 (EST)
Subject: [Rd] Exiting R Gracefully
Message-ID: <20110602100009.BLX33957@gimr.garvan.unsw.edu.au>

Hello,

I thought I'd add this to the mailing list, in case it could be handled smoother in a future release of R.

> q()
Save workspace image? [y/n/c]: n

 *** caught segfault ***
address (nil), cause 'unknown'

Possible actions:
1: abort (with core dump, if enabled)
2: normal R exit
3: exit R without saving workspace
4: exit R saving workspace
Selection: 3
Error: no graphics system to unregister
>  
> q("no", runLast = FALSE)
Error in q("no", runLast = FALSE) : no graphics system to unregister

--------------------------------------
Dario Strbenac
Research Assistant
Cancer Epigenetics
Garvan Institute of Medical Research
Darlinghurst NSW 2010
Australia


From ripley at stats.ox.ac.uk  Thu Jun  2 07:51:57 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 2 Jun 2011 06:51:57 +0100 (BST)
Subject: [Rd] Exiting R Gracefully
In-Reply-To: <20110602100009.BLX33957@gimr.garvan.unsw.edu.au>
References: <20110602100009.BLX33957@gimr.garvan.unsw.edu.au>
Message-ID: <alpine.LFD.2.02.1106020649260.9433@gannet.stats.ox.ac.uk>

On Thu, 2 Jun 2011, Dario Strbenac wrote:

> Hello,
>
> I thought I'd add this to the mailing list, in case it could be handled smoother in a future release of R.

Impossible without a reliably reproducible example (see the posting 
guide).  But it does look as if you have managed to corrupt R's 
internals too badly to 'exit gracefully'.

>
>> q()
> Save workspace image? [y/n/c]: n
>
> *** caught segfault ***
> address (nil), cause 'unknown'
>
> Possible actions:
> 1: abort (with core dump, if enabled)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
> Selection: 3
> Error: no graphics system to unregister
>>
>> q("no", runLast = FALSE)
> Error in q("no", runLast = FALSE) : no graphics system to unregister
>
> --------------------------------------
> Dario Strbenac
> Research Assistant
> Cancer Epigenetics
> Garvan Institute of Medical Research
> Darlinghurst NSW 2010
> Australia
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Pauline.Ferrouillat at hutton.ac.uk  Thu Jun  2 13:11:15 2011
From: Pauline.Ferrouillat at hutton.ac.uk (Po)
Date: Thu, 2 Jun 2011 04:11:15 -0700 (PDT)
Subject: [Rd] Problem to execute a function loading by my package that I
	created
Message-ID: <1307013075220-3568081.post@n4.nabble.com>

Hello,

I'm a beginner on R.

I should create a package on R. The name of my package is SGeMS.
In my package, I have a big program writed in C++. This program compiles in
C++. I put this program in SGeMS/src.
In my program, I added a header file and a source file named respectively
CreateFile.h and CreateFile.cpp.
CreateFile contains 5 functions : File, FileGeneral, FileData, FileVariogram
and FileDistribution.

I use the package Rcpp to compile this. So in CreateFile.h, I added
'RcppExport' in front of all the functions.
I compiled my package with R CMD INSTALL SGeMS. The compilation works.

In R, I put :
> library("SGeMS")
Loading required package: Rcpp
> is.loaded("File")
[1] TRUE
> is.loaded("FileGeneral")
[1] TRUE
> is.loaded("FileData")
[1] TRUE
> is.loaded("FileVariogram")
[1] TRUE
> is.loaded("FileDistribution")
[1] TRUE
> FileGeneral("parameters.par",general,3.0)
Error in .Call("FileGeneral", NameFile, general, SK_mean, PACKAGE = "SGeMS")
: 
  C symbol name "FileGeneral" not in DLL for package "SGeMS"

So I have a mistake. But I didn't know why.
Is it possible to put folders and subfolders in /src ?

Awaiting reply,

Pauline

--
View this message in context: http://r.789695.n4.nabble.com/Problem-to-execute-a-function-loading-by-my-package-that-I-created-tp3568081p3568081.html
Sent from the R devel mailing list archive at Nabble.com.


From bbolker at gmail.com  Thu Jun  2 15:06:17 2011
From: bbolker at gmail.com (Ben Bolker)
Date: Thu, 02 Jun 2011 09:06:17 -0400
Subject: [Rd] [R-SIG-Mac] check leads to .o files and to packagename-Ex.R
In-Reply-To: <BANLkTinvZG=LCadGAienYSRpZu+4BvwV8w@mail.gmail.com>
References: <4A83757C-12EB-4F53-8C26-D23BC7C256D8@web.de>
	<BANLkTinvZG=LCadGAienYSRpZu+4BvwV8w@mail.gmail.com>
Message-ID: <4DE78AC9.7000809@gmail.com>

On 06/02/2011 06:47 AM, Benilton Carvalho wrote:
> 'R CMD check' should be applied on the .tar.gz, not on the source directory.

  Why?  The help says: "Check R packages from package sources, which can
be directories or package 'tar' archives with extension '.tar.gz',
'.tar.bz2' or '.tgz'."  I just skimmed through the relevant section
(1.3.1) in the R Extensions manual, and it doesn't say anything about
running on tarballs being preferred.

  Add my vote to the wishlist that the src directory should get cleaned
after R CMD check.

  Ben Bolker

> 
> So, it'd be something like:
> 
> R CMD build pkg
> R CMD check pkg_version.tar.gz
> 
> b



> 
> On 2 June 2011 06:54, Marius Hofert <m_hofert at web.de> wrote:
>> Dear expeRts,
>>
>> I work on the R package "nacopula" (https://r-forge.r-project.org/projects/nacopula/) under Mac OS X 10.6.7 (MacBook Pro). The session info is:
>> R version 2.14.0 Under development (unstable) (2011-05-02 r55730)
>> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
>>
>> When I apply "R CMD check nacopula" my source directory is filled with .o files (which leads to
>> a warning for the next check). Further, if I use R 2.14.0, the check produces a file "nacopula-Ex.R"
>> on the top level, i.e., where folders like R, src, tests, man, inst, and demo reside.
>> Shouldn't the source directory stay nice-and-clean, without being filled with .o
>> files and example files?
>>
>> Cheers,
>>
>> Marius
>>
>> Attachment: screen shot
>>
>>
>> _______________________________________________
>> R-SIG-Mac mailing list
>> R-SIG-Mac at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>>
>>
> 
> 
>


From murdoch.duncan at gmail.com  Thu Jun  2 15:12:23 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 02 Jun 2011 09:12:23 -0400
Subject: [Rd] [R-SIG-Mac] check leads to .o files and to packagename-Ex.R
In-Reply-To: <4DE78AC9.7000809@gmail.com>
References: <4A83757C-12EB-4F53-8C26-D23BC7C256D8@web.de>	<BANLkTinvZG=LCadGAienYSRpZu+4BvwV8w@mail.gmail.com>
	<4DE78AC9.7000809@gmail.com>
Message-ID: <4DE78C37.2080101@gmail.com>

On 11-06-02 9:06 AM, Ben Bolker wrote:
> On 06/02/2011 06:47 AM, Benilton Carvalho wrote:
>> 'R CMD check' should be applied on the .tar.gz, not on the source directory.
>
>    Why?

Because that is what you will send to others.  The reason to check a 
directory instead of a tar file is to save time:  you don't need to 
recompile all the files, as a normal check does.

   The help says: "Check R packages from package sources, which can
> be directories or package 'tar' archives with extension '.tar.gz',
> '.tar.bz2' or '.tgz'."  I just skimmed through the relevant section
> (1.3.1) in the R Extensions manual, and it doesn't say anything about
> running on tarballs being preferred.
>
>    Add my vote to the wishlist that the src directory should get cleaned
> after R CMD check.

Then the advantage of checking a directory would be lost.

Duncan Murdoch

>
>    Ben Bolker
>
>>
>> So, it'd be something like:
>>
>> R CMD build pkg
>> R CMD check pkg_version.tar.gz
>>
>> b
>
>
>
>>
>> On 2 June 2011 06:54, Marius Hofert<m_hofert at web.de>  wrote:
>>> Dear expeRts,
>>>
>>> I work on the R package "nacopula" (https://r-forge.r-project.org/projects/nacopula/) under Mac OS X 10.6.7 (MacBook Pro). The session info is:
>>> R version 2.14.0 Under development (unstable) (2011-05-02 r55730)
>>> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
>>>
>>> When I apply "R CMD check nacopula" my source directory is filled with .o files (which leads to
>>> a warning for the next check). Further, if I use R 2.14.0, the check produces a file "nacopula-Ex.R"
>>> on the top level, i.e., where folders like R, src, tests, man, inst, and demo reside.
>>> Shouldn't the source directory stay nice-and-clean, without being filled with .o
>>> files and example files?
>>>
>>> Cheers,
>>>
>>> Marius
>>>
>>> Attachment: screen shot
>>>
>>>
>>> _______________________________________________
>>> R-SIG-Mac mailing list
>>> R-SIG-Mac at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>>>
>>>
>>
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From bbolker at gmail.com  Thu Jun  2 16:13:59 2011
From: bbolker at gmail.com (Ben Bolker)
Date: Thu, 02 Jun 2011 10:13:59 -0400
Subject: [Rd] [R-SIG-Mac] check leads to .o files and to packagename-Ex.R
In-Reply-To: <4DE78C37.2080101@gmail.com>
References: <4A83757C-12EB-4F53-8C26-D23BC7C256D8@web.de>	<BANLkTinvZG=LCadGAienYSRpZu+4BvwV8w@mail.gmail.com>
	<4DE78AC9.7000809@gmail.com> <4DE78C37.2080101@gmail.com>
Message-ID: <4DE79AA7.9040706@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 06/02/2011 09:12 AM, Duncan Murdoch wrote:
> On 11-06-02 9:06 AM, Ben Bolker wrote:
>> On 06/02/2011 06:47 AM, Benilton Carvalho wrote:
>>> 'R CMD check' should be applied on the .tar.gz, not on the source
>>> directory.
>>
>>    Why?
> 
> Because that is what you will send to others.  The reason to check a
> directory instead of a tar file is to save time:  you don't need to
> recompile all the files, as a normal check does.
> 
>   The help says: "Check R packages from package sources, which can
>> be directories or package 'tar' archives with extension '.tar.gz',
>> '.tar.bz2' or '.tgz'."  I just skimmed through the relevant section
>> (1.3.1) in the R Extensions manual, and it doesn't say anything about
>> running on tarballs being preferred.
>>
>>    Add my vote to the wishlist that the src directory should get cleaned
>> after R CMD check.
> 
> Then the advantage of checking a directory would be lost.
> 
> Duncan Murdoch

  OK, that makes sense.  The logic was not clear to me.
  Do you know offhand if R CMD check uses "make"-like logic to determine
whether the sources should be recompiled even if there are existing
.o/.so files, or is that up to the user ... ?

  Ben
> 
>>
>>    Ben Bolker
>>
>>>
>>> So, it'd be something like:
>>>
>>> R CMD build pkg
>>> R CMD check pkg_version.tar.gz
>>>
>>> b
>>
>>
>>
>>>
>>> On 2 June 2011 06:54, Marius Hofert<m_hofert at web.de>  wrote:
>>>> Dear expeRts,
>>>>
>>>> I work on the R package "nacopula"
>>>> (https://r-forge.r-project.org/projects/nacopula/) under Mac OS X
>>>> 10.6.7 (MacBook Pro). The session info is:
>>>> R version 2.14.0 Under development (unstable) (2011-05-02 r55730)
>>>> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
>>>>
>>>> When I apply "R CMD check nacopula" my source directory is filled
>>>> with .o files (which leads to
>>>> a warning for the next check). Further, if I use R 2.14.0, the check
>>>> produces a file "nacopula-Ex.R"
>>>> on the top level, i.e., where folders like R, src, tests, man, inst,
>>>> and demo reside.
>>>> Shouldn't the source directory stay nice-and-clean, without being
>>>> filled with .o
>>>> files and example files?
>>>>
>>>> Cheers,
>>>>
>>>> Marius
>>>>
>>>> Attachment: screen shot
>>>>
>>>>
>>>> _______________________________________________
>>>> R-SIG-Mac mailing list
>>>> R-SIG-Mac at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>>>>
>>>>
>>>
>>>
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk3nmqcACgkQc5UpGjwzenOP7wCeJ/qoUed60giuBeBrJm3jiHhm
DRUAoIXl8cZE9f3TMpJ909puSgSgE8ZJ
=9zaZ
-----END PGP SIGNATURE-----


From murdoch.duncan at gmail.com  Thu Jun  2 16:25:04 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 02 Jun 2011 10:25:04 -0400
Subject: [Rd] [R-SIG-Mac] check leads to .o files and to packagename-Ex.R
In-Reply-To: <4DE79AA7.9040706@gmail.com>
References: <4A83757C-12EB-4F53-8C26-D23BC7C256D8@web.de>	<BANLkTinvZG=LCadGAienYSRpZu+4BvwV8w@mail.gmail.com>
	<4DE78AC9.7000809@gmail.com> <4DE78C37.2080101@gmail.com>
	<4DE79AA7.9040706@gmail.com>
Message-ID: <4DE79D40.4060206@gmail.com>

On 02/06/2011 10:13 AM, Ben Bolker wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 06/02/2011 09:12 AM, Duncan Murdoch wrote:
> >  On 11-06-02 9:06 AM, Ben Bolker wrote:
> >>  On 06/02/2011 06:47 AM, Benilton Carvalho wrote:
> >>>  'R CMD check' should be applied on the .tar.gz, not on the source
> >>>  directory.
> >>
> >>     Why?
> >
> >  Because that is what you will send to others.  The reason to check a
> >  directory instead of a tar file is to save time:  you don't need to
> >  recompile all the files, as a normal check does.
> >
> >    The help says: "Check R packages from package sources, which can
> >>  be directories or package 'tar' archives with extension '.tar.gz',
> >>  '.tar.bz2' or '.tgz'."  I just skimmed through the relevant section
> >>  (1.3.1) in the R Extensions manual, and it doesn't say anything about
> >>  running on tarballs being preferred.
> >>
> >>     Add my vote to the wishlist that the src directory should get cleaned
> >>  after R CMD check.
> >
> >  Then the advantage of checking a directory would be lost.
> >
> >  Duncan Murdoch
>
>    OK, that makes sense.  The logic was not clear to me.
>    Do you know offhand if R CMD check uses "make"-like logic to determine
> whether the sources should be recompiled even if there are existing
> .o/.so files, or is that up to the user ... ?

It uses make, with some cleverly written default rules.  For Windows, 
that's GNU make, but other systems might have a different make involved.

Duncan Murdoch


From jmc at r-project.org  Thu Jun  2 18:29:06 2011
From: jmc at r-project.org (John Chambers)
Date: Thu, 02 Jun 2011 09:29:06 -0700
Subject: [Rd] possibly invalid assertion in setRefClass?
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D7000442FAFD@NA-PA-VBE03.na.tibco.com>
References: <BANLkTi=zosXhcfDav-Ov69MKdKAXgf8dtw@mail.gmail.com>
	<77EB52C6DD32BA4D87471DCD70C8D7000442FAFD@NA-PA-VBE03.na.tibco.com>
Message-ID: <4DE7BA52.4090904@r-project.org>

Right, but Michael's point is valid.  It's the standard bug from having 
to explicitly check for a non-empty list before taking names(x).

Will fix.  Thanks for the catch.

John

On 6/1/11 9:21 AM, William Dunlap wrote:
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org
>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Michael Lawrence
>> Sent: Wednesday, June 01, 2011 9:15 AM
>> To: r-devel at r-project.org
>> Subject: [Rd] possibly invalid assertion in setRefClass?
>>
>>> setRefClass("Foo", fields = list())
>> Error in setRefClass("Foo", fields = list()) :
>>    A list argument for fields must have nonempty names for all
>> the fields
>>
>> In my opinion, the above should not fail. There are no fields.
>
> You can work around it by attaching an empty names attribute
> to fields:
>    >  setRefClass("Foo", fields = structure(list(), names=character()))
>    Generator object for class "Foo":
>
>    No fields defined
>
>     Class Methods:
>        "callSuper", "copy", "export", "field", "getClass", "getRefClass",
> "import", "initFields"
>
>
>     Reference Superclasses:
>        "envRefClass"
>
> Bill Dunlap
> Spotfire, TIBCO Software
> wdunlap tibco.com
>
>
>>
>> Thanks,
>> Michael
>>
>> 	[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From Pauline.Ferrouillat at hutton.ac.uk  Fri Jun  3 10:41:35 2011
From: Pauline.Ferrouillat at hutton.ac.uk (Po)
Date: Fri, 3 Jun 2011 01:41:35 -0700 (PDT)
Subject: [Rd] Problem to execute a function loading by my package that I
 created
In-Reply-To: <1307013075220-3568081.post@n4.nabble.com>
References: <1307013075220-3568081.post@n4.nabble.com>
Message-ID: <1307090495485-3570314.post@n4.nabble.com>

I still look for my problem.
I think that maybe my Makefile is not good.

In my folder src of my package, I put an existing program. In this program,
I had already a makefile.
So I kept this makefile and I changed.

I saw that it's better to have a file Makevars to compile. But I don't know
what is a file Makevars and I don't know how I can gather the files Makefile
and Makevars together.

Thank you in advance,

Pauline

--
View this message in context: http://r.789695.n4.nabble.com/Problem-to-execute-a-function-loading-by-my-package-that-I-created-tp3568081p3570314.html
Sent from the R devel mailing list archive at Nabble.com.


From oliver at first.in-berlin.de  Fri Jun  3 12:17:12 2011
From: oliver at first.in-berlin.de (oliver)
Date: Fri, 3 Jun 2011 12:17:12 +0200
Subject: [Rd] C-Side: Applying a function (given as param) to data (given as
 param)
Message-ID: <20110603101712.GD6048@siouxsie>

Hello,

I'm implementing a package (C-extension),
where one function gets data and a function
that needs to be applied to the data.

I want to apply the function to (parts of)
the data on the C-side.

1) how do I apply a function (given via SEXP) to data
2) how do I select parts of the data (also provided via SEXP)?

Comment on 2: I want to implement a moving/rolling/running
apply on the data, so I want to select a data window.
How can this be done, and how can it be done efficiently?

For example on page 101 of "Writing R extensions" there was a trick
on how to use REAL on the result, before using it in a loop.
Can this be used for efficiency reasons in general?


 Ciao,
    Oliver


P.S.: What do these macros (like REAL()) do? Do they convert data
      or rather cast datatypes?


From janko.thyson.rstuff at googlemail.com  Fri Jun  3 15:53:59 2011
From: janko.thyson.rstuff at googlemail.com (Janko Thyson)
Date: Fri, 03 Jun 2011 15:53:59 +0200
Subject: [Rd] Bug or feature: using "ANY" as a generic field class (was:
 '[R] Is there a (virtual) class that all R objects inherit from?)
Message-ID: <4DE8E777.7090008@googlemail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110603/d64a8dd6/attachment.pl>

From simon.urbanek at r-project.org  Fri Jun  3 16:02:17 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 3 Jun 2011 10:02:17 -0400
Subject: [Rd] Problem to execute a function loading by my package that I
	created
In-Reply-To: <1307090495485-3570314.post@n4.nabble.com>
References: <1307013075220-3568081.post@n4.nabble.com>
	<1307090495485-3570314.post@n4.nabble.com>
Message-ID: <C873B9CB-EC7C-47AC-B194-2C8B5CB91910@r-project.org>

Pauline,

since you mentioned Rcpp, you're on the wrong list. I have put some comments below but they assume you're using regular R packaging and not Rcpp.

On Jun 3, 2011, at 4:41 AM, Po wrote:

> I still look for my problem.
> I think that maybe my Makefile is not good.
> 
> In my folder src of my package, I put an existing program. In this program,
> I had already a makefile.
> So I kept this makefile and I changed.
> 

Thats generally not a safe idea, because R has its own ways of compiling and linking so you would have to replicate that. If what you have is a stand-alone library, you can put it in a separate directory in your package and have it build itself so src will consist of the interface between R and you library only.

If what you have is essentially the package code in C++ then you don't need a Makefile at all - R will simply compile all sources you put in src and create a shared object for the package from it. You don't need to do anything, just remove your Makefile.


> I saw that it's better to have a file Makevars to compile. But I don't know what is a file Makevars and I don't know how I can gather the files Makefile and Makevars together.
> 

Makevars is simply a makefile without compilation and linking rules as those are provided by R automatically. See recent posts about it on this list.

Cheers,
Simon


> Thank you in advance,
> 
> Pauline
> 
> --
> View this message in context: http://r.789695.n4.nabble.com/Problem-to-execute-a-function-loading-by-my-package-that-I-created-tp3568081p3570314.html
> Sent from the R devel mailing list archive at Nabble.com.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From Pauline.Ferrouillat at hutton.ac.uk  Fri Jun  3 17:55:03 2011
From: Pauline.Ferrouillat at hutton.ac.uk (Po)
Date: Fri, 3 Jun 2011 08:55:03 -0700 (PDT)
Subject: [Rd] Problem to execute a function loading by my package that I
 created
In-Reply-To: <C873B9CB-EC7C-47AC-B194-2C8B5CB91910@r-project.org>
References: <1307013075220-3568081.post@n4.nabble.com>
	<1307090495485-3570314.post@n4.nabble.com>
	<C873B9CB-EC7C-47AC-B194-2C8B5CB91910@r-project.org>
Message-ID: <27BD3271BDEFC94BAADFAEBE8F9831CD0D988A98@ABEXC01.ad.hutton.ac.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110603/48e5c52b/attachment.pl>

From bates at stat.wisc.edu  Fri Jun  3 18:14:39 2011
From: bates at stat.wisc.edu (Douglas Bates)
Date: Fri, 3 Jun 2011 11:14:39 -0500
Subject: [Rd] C-Side: Applying a function (given as param) to data
 (given as param)
In-Reply-To: <20110603101712.GD6048@siouxsie>
References: <20110603101712.GD6048@siouxsie>
Message-ID: <BANLkTi=DkQzC74HP5WEiN-eyBiBV0yUDew@mail.gmail.com>

On Fri, Jun 3, 2011 at 5:17 AM, oliver <oliver at first.in-berlin.de> wrote:
> Hello,
>
> I'm implementing a package (C-extension),
> where one function gets data and a function
> that needs to be applied to the data.
>
> I want to apply the function to (parts of)
> the data on the C-side.
>
> 1) how do I apply a function (given via SEXP) to data
> 2) how do I select parts of the data (also provided via SEXP)?

Not to be facetious but you begin by reading the "Writing R Extensions" manual.

An alternative is to read the vignette Rcpp-Introduction available as
http://dirk.eddelbuettel.com/code/rcpp/Rcpp-introduction.pdf and soon
to be in The R Journal.  They show an explicit example of apply in
compiled code (C++ using the Rcpp structures, in their case).

> Comment on 2: I want to implement a moving/rolling/running
> apply on the data, so I want to select a data window.
> How can this be done, and how can it be done efficiently?
>
> For example on page 101 of "Writing R extensions" there was a trick
> on how to use REAL on the result, before using it in a loop.
> Can this be used for efficiency reasons in general?
>
>
> ?Ciao,
> ? ?Oliver
>
>
> P.S.: What do these macros (like REAL()) do? Do they convert data
> ? ? ?or rather cast datatypes?
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From jmc at r-project.org  Fri Jun  3 19:13:28 2011
From: jmc at r-project.org (John Chambers)
Date: Fri, 03 Jun 2011 10:13:28 -0700
Subject: [Rd] Bug or feature: using "ANY" as a generic field class (was:
 '[R] Is there a (virtual) class that all R objects inherit from?)
In-Reply-To: <4DE8E777.7090008@googlemail.com>
References: <4DE8E777.7090008@googlemail.com>
Message-ID: <4DE91638.3060503@r-project.org>

Well, your mail is unclear as to what you expected, but there is one bug 
shown by your example.

The behavior of S4 classes is sensible, at least as far as the example 
shows:


 > setClass("A", representation(x="ANY"))
[1] "A"
 > setClass("B", contains="A", representation(x="character"))
[1] "B"
 > new("B", x=1:3)
Error in validObject(.Object) :
   invalid class "B" object: invalid object for slot "x" in class "B": 
got class "integer", should be or extend class "character"

You couldn't expect the new() call to work, as the error message clearly 
explains.  A legitimate call does work:

 > new("B", x = "abc")
An object of class "B"
Slot "x":
[1] "abc"

The reference classes should work the same way, but don't, as your 
example shows.

A <- setRefClass(
+ Class="A",
+ fields=list(
+ .PRIMARYDATA="ANY"
+ ),
+ contains=c("VIRTUAL")
+ )
 > B <- setRefClass(
+ Class="B",
+ fields=list(
+ .PRIMARYDATA="character"
+ ),
+ contains=c("A")
+ )
Error in `insertFields<-`(`*tmp*`, value = "character") :
   The overriding class("character") of field ".PRIMARYDATA" is not a 
subclass of the existing field definition ("ANY")

We'll fix that.  And, yes, "ANY" is intended as a universal superclass, 
but is usually not mentioned explicitly.


On 6/3/11 6:53 AM, Janko Thyson wrote:
> Dear list,
>
> I was wondering if you could help me out in clarifying something:
> Is it possible to use class "ANY" in slots/fields of formal classes if you
>     a) do not want to restrict valid classes of that field and
>     b) if you are making explicit use of class inheritance?
>
> It seems to work in simple scenarios but produces errors when class
> inheritance comes into play. So I was wondering if that's a feature or a
> bug.
>
> If using "ANY" is not the right way, I'd appreciate a pointer to how you
> can to this.
>
> See previous post with an example below.
>
> Regards,
> Janko
>
> On 06/03/2011 01:53 AM, Janko Thyson wrote:
>> On 31.05.2011 18:17, Martin Morgan wrote:
>>> On 05/30/2011 07:02 AM, Janko Thyson wrote:
>>>> Dear list,
>>>>
>>>> I would like to set one specific Reference Class field to be of an
>>>> arbitrary class. Is there a class that all R objects inherit from? I
>>>> thought that "ANY" was something like this, but obviously that's not
>>>> true:
>>>>
>>>>> inherits(1:3, "ANY")
>>>> [1] FALSE
>>>
>>> I can't speak to the implementation, but ANY functions as a base class
>>> in terms of slot / field assignment and inheritance, e.g.,
>>>
>>> setClass("A", representation(x="ANY"))
>>> new("A", x=1:3)
>>>
>>> Martin
>>
>> Hi Martin,
>>
>> sorry for the late response. The way you do it works. Yet, when you
>> declare dependencies more explicitly (contains=XY), then R complains. Is
>> this a feature or a bug (with respect to the "less explicit" way working
>> just fine)? See the example below:
>>
>> # S4
>> setClass("A", representation(x="ANY"))
>> new("A", x=1:3)
>>
>> setClass("A", representation(x="ANY"))
>> setClass("B", contains="A", representation(x="character"))
>> new("B", x=1:3)
>>
>> # Reference Classes
>> setRefClass(
>> Class="A",
>> fields=list(
>> .PRIMARYDATA="ANY"
>> ),
>> contains=c("VIRTUAL")
>> )
>> B<- setRefClass(
>> Class="B",
>> fields=list(
>> .PRIMARYDATA="character"
>> ),
>> contains=c("A")
>> )
>
> Bug, I'd say. Martin
>
>>
>> Regards,
>> Janko
>>>>
>>>> Regards,
>>>> Janko
>>>>
>>>> [[alternative HTML version deleted]]
>>>>
>>>> ______________________________________________
>>>> R-help at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>>> PLEASE do read the posting guide
>>>> http://www.R-project.org/posting-guide.html
>>>> and provide commented, minimal, self-contained, reproducible code.
>>>
>>>
>
>


From soeren.vogel at uzh.ch  Sat Jun  4 12:07:00 2011
From: soeren.vogel at uzh.ch (soeren.vogel at uzh.ch)
Date: Sat, 4 Jun 2011 12:07:00 +0200
Subject: [Rd] S4 class, passing argument names to function, modify original
Message-ID: <C6C4A88B-761A-46F0-90E3-24260973F699@uzh.ch>

Hello, an S4 class "Foo" is defined with a setter, $. For several reasons, the setter calls a function, .foo.update(). However, bypassing the argument names of the setter does not work. Question 1: Why not and how can I fix this? Question 2: What is the way to define either the function or the setter to modify the original object (not returning the modified copy of it an overwrite the original by assignment)? Thanks, S?ren

setClass("Foo",
  representation(
    N = "numeric"
  ),
  prototype(
    N = 10000
  )
)

.foo.update <- function(object, ...) {
  args <- list(...)
  for (i in slotNames("Foo")[pmatch(names(args), slotNames("Foo"), nomatch=0)]) {
    slot(object, i) <- args[[i]]
    # indeed more to do here
    return(object)
  }
}

setReplaceMethod("$", "Foo",
  function(x, name, value) {
    x <- .foo.update(x, name=value)
    x
  }
)

x <- new("Foo")
x
x$N <- 99
x # NULL????


From oliver at first.in-berlin.de  Fri Jun  3 22:19:55 2011
From: oliver at first.in-berlin.de (oliver)
Date: Fri, 3 Jun 2011 22:19:55 +0200
Subject: [Rd] C-Side: Applying a function (given as param) to data
 (given as param)
In-Reply-To: <BANLkTi=DkQzC74HP5WEiN-eyBiBV0yUDew@mail.gmail.com>
References: <20110603101712.GD6048@siouxsie>
	<BANLkTi=DkQzC74HP5WEiN-eyBiBV0yUDew@mail.gmail.com>
Message-ID: <20110603201955.GA2058@siouxsie>

On Fri, Jun 03, 2011 at 11:14:39AM -0500, Douglas Bates wrote:
> On Fri, Jun 3, 2011 at 5:17 AM, oliver <oliver at first.in-berlin.de> wrote:
> > Hello,
> >
> > I'm implementing a package (C-extension),
> > where one function gets data and a function
> > that needs to be applied to the data.
> >
> > I want to apply the function to (parts of)
> > the data on the C-side.
> >
> > 1) how do I apply a function (given via SEXP) to data
> > 2) how do I select parts of the data (also provided via SEXP)?
> 
> Not to be facetious but you begin by reading the "Writing R Extensions" manual.

I already read inside it.
If there would be no question open i would not have registered to this mailing list
and woulod not have asked that question.
Obviously my question was not answered in the "Writing R Extensions",
so if you can give me a hint this would be nice.


> 
> An alternative is to read the vignette Rcpp-Introduction available as
> http://dirk.eddelbuettel.com/code/rcpp/Rcpp-introduction.pdf and soon

I use C, not C++.

But maybe it helps too.

I already created my own package with R and C successfully some days ago.

But so far I did not used fucntion pointers coming in via SEXP parameters.

And that was my specific question.




> to be in The R Journal.  They show an explicit example of apply in
> compiled code (C++ using the Rcpp structures, in their case).


As just mentioned: I already created successfully a C-extension for R.

But I would like to know, how to call a function that I get via
SEXP as parameter. How can I find out the function definition,
for example the arity of the function and which arguments
a function uses.

The problem is, that the C-standard (at least the first ANSI-C standard)
does not guarantee portability for C-pointers.
To be portable, for example the function pointer you use must
definitely be of same type as the function you use.

So I need to know how I can use the SEXP-function pointers.


To be more concrete, this is how my function's API looks like
at the moment:

SEXP movapply( SEXP data, SEXP width, SEXP func )
{
  /* some code */

  return ( result );
}



  data   will be vector or list or matrix
  width  will be int value (I think vector of length 1)
  func   will be a function pointer of the type that is given as argument

I don't know on which kind of pointer to cast.
I think I will cast to a pure C-type, but then all data also must
match to the function definition.

What if the function wants to work on integer, but the data is double?

Somehow this must be handled, and I think the experts here can just point me
directly to some kind of docs or maybe older postinmgs here, which explain this?


Ciao,
   Oliver


From mcguirebc at gmail.com  Fri Jun  3 23:03:36 2011
From: mcguirebc at gmail.com (mcguirebc)
Date: Fri, 3 Jun 2011 14:03:36 -0700 (PDT)
Subject: [Rd] S4 Slot assignment within function
Message-ID: <1307135016628-3572077.post@n4.nabble.com>

Is there a simple way to assign values to S4 slots from within a function? 

Doing this doesn't work:

> assign_slot<-function(x){

assign("OBJECT at slot",x,envir=parent.env(environment())

}

>assign_slot(x)

All I get from this is a new object with the name OBJECT at slot, the slot
assignment of OBJECT doesn't change.

I have thought about solutions such as eval(parse()) to pull this off, but
would prefer not to ugly up the code.

Thoughts??

I have searched rather thoroughly, but it is possible I overlooked
something. If I did, apologies.

-Brian







--
View this message in context: http://r.789695.n4.nabble.com/S4-Slot-assignment-within-function-tp3572077p3572077.html
Sent from the R devel mailing list archive at Nabble.com.


From murdoch.duncan at gmail.com  Sat Jun  4 13:26:08 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 04 Jun 2011 07:26:08 -0400
Subject: [Rd] S4 Slot assignment within function
In-Reply-To: <1307135016628-3572077.post@n4.nabble.com>
References: <1307135016628-3572077.post@n4.nabble.com>
Message-ID: <4DEA1650.50602@gmail.com>

On 11-06-03 5:03 PM, mcguirebc wrote:
> Is there a simple way to assign values to S4 slots from within a function?
>
> Doing this doesn't work:
>
>> assign_slot<-function(x){
>
> assign("OBJECT at slot",x,envir=parent.env(environment())
>
> }
>
>> assign_slot(x)
>
> All I get from this is a new object with the name OBJECT at slot, the slot
> assignment of OBJECT doesn't change.
>
> I have thought about solutions such as eval(parse()) to pull this off, but
> would prefer not to ugly up the code.
>
> Thoughts??
>
> I have searched rather thoroughly, but it is possible I overlooked
> something. If I did, apologies.

I haven't tried this, but I would expect

OBJECT at slot <<- x

to work, assuming OBJECT already exists somewhere outside the function 
but in its environment.

Duncan Murdoch


From murdoch.duncan at gmail.com  Sat Jun  4 13:51:08 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 04 Jun 2011 07:51:08 -0400
Subject: [Rd] C-Side: Applying a function (given as param) to data
 (given as param)
In-Reply-To: <20110603201955.GA2058@siouxsie>
References: <20110603101712.GD6048@siouxsie>	<BANLkTi=DkQzC74HP5WEiN-eyBiBV0yUDew@mail.gmail.com>
	<20110603201955.GA2058@siouxsie>
Message-ID: <4DEA1C2C.6060504@gmail.com>

On 11-06-03 4:19 PM, oliver wrote:
> On Fri, Jun 03, 2011 at 11:14:39AM -0500, Douglas Bates wrote:
>> On Fri, Jun 3, 2011 at 5:17 AM, oliver<oliver at first.in-berlin.de>  wrote:
>>> Hello,
>>>
>>> I'm implementing a package (C-extension),
>>> where one function gets data and a function
>>> that needs to be applied to the data.
>>>
>>> I want to apply the function to (parts of)
>>> the data on the C-side.
>>>
>>> 1) how do I apply a function (given via SEXP) to data
>>> 2) how do I select parts of the data (also provided via SEXP)?
>>
>> Not to be facetious but you begin by reading the "Writing R Extensions" manual.
>
> I already read inside it.
> If there would be no question open i would not have registered to this mailing list
> and woulod not have asked that question.
> Obviously my question was not answered in the "Writing R Extensions",
> so if you can give me a hint this would be nice.
>
>
>>
>> An alternative is to read the vignette Rcpp-Introduction available as
>> http://dirk.eddelbuettel.com/code/rcpp/Rcpp-introduction.pdf and soon
>
> I use C, not C++.
>
> But maybe it helps too.
>
> I already created my own package with R and C successfully some days ago.
>
> But so far I did not used fucntion pointers coming in via SEXP parameters.
>
> And that was my specific question.
>
>
>
>
>> to be in The R Journal.  They show an explicit example of apply in
>> compiled code (C++ using the Rcpp structures, in their case).
>
>
> As just mentioned: I already created successfully a C-extension for R.
>
> But I would like to know, how to call a function that I get via
> SEXP as parameter. How can I find out the function definition,
> for example the arity of the function and which arguments
> a function uses.

You should almost certainly do this in R, not in C.  If you are doing it 
in C code you'll just be duplicating the implementation from R, and your 
code will break if that implementation ever changes.

In R you use formals(fn) to extract the function header.

>
> The problem is, that the C-standard (at least the first ANSI-C standard)
> does not guarantee portability for C-pointers.
> To be portable, for example the function pointer you use must
> definitely be of same type as the function you use.
>
> So I need to know how I can use the SEXP-function pointers.

They are not function pointers, they are pointers to R objects.

Duncan Murdoch

>
>
> To be more concrete, this is how my function's API looks like
> at the moment:
>
> SEXP movapply( SEXP data, SEXP width, SEXP func )
> {
>    /* some code */
>
>    return ( result );
> }
>
>
>
>    data   will be vector or list or matrix
>    width  will be int value (I think vector of length 1)
>    func   will be a function pointer of the type that is given as argument
>
> I don't know on which kind of pointer to cast.
> I think I will cast to a pure C-type, but then all data also must
> match to the function definition.
>
> What if the function wants to work on integer, but the data is double?
>
> Somehow this must be handled, and I think the experts here can just point me
> directly to some kind of docs or maybe older postinmgs here, which explain this?
>
>
> Ciao,
>     Oliver
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jeff.a.ryan at gmail.com  Sat Jun  4 14:29:58 2011
From: jeff.a.ryan at gmail.com (Jeff Ryan)
Date: Sat, 4 Jun 2011 07:29:58 -0500
Subject: [Rd] C-Side: Applying a function (given as param) to data
	(given as param)
In-Reply-To: <20110603201955.GA2058@siouxsie>
References: <20110603101712.GD6048@siouxsie>
	<BANLkTi=DkQzC74HP5WEiN-eyBiBV0yUDew@mail.gmail.com>
	<20110603201955.GA2058@siouxsie>
Message-ID: <E7790C02-6D25-415D-A7E3-E59717FAA71E@gmail.com>

Oliver,

For an example of moving averages, take a look at the C source of the xts and TTR packages. The sources are browsable on R-forge. 

In short, REAL etc are functions to extract the data of an SEXP. They need to match the types coming in. So your C needs to check the type and branch accordingly. 

It is all in the guide as well as in working example code in R sources as well as many hundreds of package sources. You have access to it all, so spend the time just reading the sources is my recommendation.  

Best,
Jeff

Jeffrey Ryan    |    Founder    |    jeffrey.ryan at lemnica.com

www.lemnica.com

On Jun 3, 2011, at 3:19 PM, oliver <oliver at first.in-berlin.de> wrote:

> On Fri, Jun 03, 2011 at 11:14:39AM -0500, Douglas Bates wrote:
>> On Fri, Jun 3, 2011 at 5:17 AM, oliver <oliver at first.in-berlin.de> wrote:
>>> Hello,
>>> 
>>> I'm implementing a package (C-extension),
>>> where one function gets data and a function
>>> that needs to be applied to the data.
>>> 
>>> I want to apply the function to (parts of)
>>> the data on the C-side.
>>> 
>>> 1) how do I apply a function (given via SEXP) to data
>>> 2) how do I select parts of the data (also provided via SEXP)?
>> 
>> Not to be facetious but you begin by reading the "Writing R Extensions" manual.
> 
> I already read inside it.
> If there would be no question open i would not have registered to this mailing list
> and woulod not have asked that question.
> Obviously my question was not answered in the "Writing R Extensions",
> so if you can give me a hint this would be nice.
> 
> 
>> 
>> An alternative is to read the vignette Rcpp-Introduction available as
>> http://dirk.eddelbuettel.com/code/rcpp/Rcpp-introduction.pdf and soon
> 
> I use C, not C++.
> 
> But maybe it helps too.
> 
> I already created my own package with R and C successfully some days ago.
> 
> But so far I did not used fucntion pointers coming in via SEXP parameters.
> 
> And that was my specific question.
> 
> 
> 
> 
>> to be in The R Journal.  They show an explicit example of apply in
>> compiled code (C++ using the Rcpp structures, in their case).
> 
> 
> As just mentioned: I already created successfully a C-extension for R.
> 
> But I would like to know, how to call a function that I get via
> SEXP as parameter. How can I find out the function definition,
> for example the arity of the function and which arguments
> a function uses.
> 
> The problem is, that the C-standard (at least the first ANSI-C standard)
> does not guarantee portability for C-pointers.
> To be portable, for example the function pointer you use must
> definitely be of same type as the function you use.
> 
> So I need to know how I can use the SEXP-function pointers.
> 
> 
> To be more concrete, this is how my function's API looks like
> at the moment:
> 
> SEXP movapply( SEXP data, SEXP width, SEXP func )
> {
>  /* some code */
> 
>  return ( result );
> }
> 
> 
> 
>  data   will be vector or list or matrix
>  width  will be int value (I think vector of length 1)
>  func   will be a function pointer of the type that is given as argument
> 
> I don't know on which kind of pointer to cast.
> I think I will cast to a pure C-type, but then all data also must
> match to the function definition.
> 
> What if the function wants to work on integer, but the data is double?
> 
> Somehow this must be handled, and I think the experts here can just point me
> directly to some kind of docs or maybe older postinmgs here, which explain this?
> 
> 
> Ciao,
>   Oliver
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From mtmorgan at fhcrc.org  Sat Jun  4 15:21:28 2011
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Sat, 04 Jun 2011 06:21:28 -0700
Subject: [Rd] S4 Slot assignment within function
In-Reply-To: <1307135016628-3572077.post@n4.nabble.com>
References: <1307135016628-3572077.post@n4.nabble.com>
Message-ID: <4DEA3158.7040805@fhcrc.org>

On 06/03/2011 02:03 PM, mcguirebc wrote:
> Is there a simple way to assign values to S4 slots from within a function?
>
> Doing this doesn't work:
>
>> assign_slot<-function(x){
>
> assign("OBJECT at slot",x,envir=parent.env(environment())
>
> }
>
>> assign_slot(x)
>
> All I get from this is a new object with the name OBJECT at slot, the slot
> assignment of OBJECT doesn't change.
>
> I have thought about solutions such as eval(parse()) to pull this off, but
> would prefer not to ugly up the code.
>
> Thoughts??
>
> I have searched rather thoroughly, but it is possible I overlooked
> something. If I did, apologies.

Maybe you're looking for ?ReferenceClasses rather then S4 classes?

Martin

>
> -Brian
>
>
>
>
>
>
>
> --
> View this message in context: http://r.789695.n4.nabble.com/S4-Slot-assignment-within-function-tp3572077p3572077.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Computational Biology
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109

Location: M1-B861
Telephone: 206 667-2793


From mtmorgan at fhcrc.org  Sat Jun  4 15:41:05 2011
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Sat, 04 Jun 2011 06:41:05 -0700
Subject: [Rd] S4 class, passing argument names to function,
	modify original
In-Reply-To: <C6C4A88B-761A-46F0-90E3-24260973F699@uzh.ch>
References: <C6C4A88B-761A-46F0-90E3-24260973F699@uzh.ch>
Message-ID: <4DEA35F1.7020208@fhcrc.org>

On 06/04/2011 03:07 AM, soeren.vogel at uzh.ch wrote:
> Hello, an S4 class "Foo" is defined with a setter, $. For several reasons, the setter calls a function, .foo.update(). However, bypassing the argument names of the setter does not work. Question 1: Why not and how can I fix this? Question 2: What is the way to define either the function or the setter to modify the original object (not returning the modified copy of it an overwrite the original by assignment)? Thanks, S?ren
>
> setClass("Foo",
>    representation(
>      N = "numeric"
>    ),
>    prototype(
>      N = 10000
>    )
> )
>
> .foo.update<- function(object, ...) {
>    args<- list(...)
>    for (i in slotNames("Foo")[pmatch(names(args), slotNames("Foo"), nomatch=0)]) {
>      slot(object, i)<- args[[i]]
>      # indeed more to do here
>      return(object)
>    }
> }

Since names(args) is 'name', and 'name' is not a slot of 'Foo', the 
return of pmatch is 0 and .foo.update returns NULL. Put return(object) 
outside the for loop.

> setReplaceMethod("$", "Foo",
>    function(x, name, value) {
>      x<- .foo.update(x, name=value)

here your intention is that name=value to be substituted with N=99, but 
you end up with name=99. You could arrange to parse this correctly, but 
this isn't usually what you _want_ to do and I don't really understand 
what you're trying to accomplish. Maybe

.foo.update <- function(object, name, value, ...)
{
     slot(object, name) <- value
     ## some other stuff
     object
}

Hope that helps a bit.

Martin

>      x
>    }
> )
>
> x<- new("Foo")
> x
> x$N<- 99
> x # NULL????
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Computational Biology
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109

Location: M1-B861
Telephone: 206 667-2793


From soeren.vogel at uzh.ch  Sat Jun  4 16:31:30 2011
From: soeren.vogel at uzh.ch (soeren.vogel at uzh.ch)
Date: Sat, 4 Jun 2011 16:31:30 +0200
Subject: [Rd] Interfacing a C++ class
Message-ID: <14F4FFAE-88F5-4C1E-A5BC-4F34E7ACD826@uzh.ch>

Hello

Apologies for cross-posting, the discussion should (if) go to R-devel, but I also want to reach the rcpp-devel people.

My C++ class FOO is a module available through Rcpp, and it works fine and is -- so far -- bug free. With trying to further develop my R package, I thought it was a good idea to interface my C++ workhorse FOO with an S4 class Foo. After some long and not always insightful trip through S4 classes and methods, I am not sure if I am on the right way of thinking and designing. Since there is no local assistance available, could you help to make things clearer?

Just a brief outline:

FOO is the C++ object, and Foo should be the S4 class. If the user creates an object, say bar, from class Foo, the creation process automatically makes a new FOO object relating to bar in that a unique name of the FOO instance is stored in a slot of bar. All the user then has to do is modify bar by simple assignments. The getters and setters ("$", "[") are set up and work. Each modification goes in hand with assigning new values to bar as well as updating the FOO object through available setters from FOO.

So far, this way has brought me to about 100 lines, but now I read about ReferenceClasses and was wondering, if there is a much easier way of achieving my goals. Moreover, I was not sure any longer if my goals make sense or if a more advanced programmer would do it totally different (and could share some structural thinking on their approach).

The idea behind my way of doing was based upon several considerations. First, a "classical" R object would not confuse users, as I assume users of my package to be rather non-skilled (and not willing to change that). Second, I want to create a properly programmed package for distribution on CRAN and publication, eventually. Third, I want to save objects across sessions. So if a user restores a session, a simple command, say, restore(), would do the trick to build all the related C++ objects again. However, I admit that I still have not figured out how to automatically clean up the workspace correctly before leaving a session, wanted or unwanted, that is, clean up memory before leaving home. Fourth, pure arithmetic check is done in C++, however, semantic check *should* be left to R, and the validity and class routines seem to be perfect for this. Fifth, some work should be done in R, such as the passing of data frames or samples from distributions.

I hope to get some structured ideas and hints how to start and/or proceed.

Thank you in advance,
S?ren


From soeren.vogel at uzh.ch  Sat Jun  4 16:54:46 2011
From: soeren.vogel at uzh.ch (soeren.vogel at uzh.ch)
Date: Sat, 4 Jun 2011 16:54:46 +0200
Subject: [Rd] S4 class, passing argument names to function,
	modify original
In-Reply-To: <4DEA35F1.7020208@fhcrc.org>
References: <C6C4A88B-761A-46F0-90E3-24260973F699@uzh.ch>
	<4DEA35F1.7020208@fhcrc.org>
Message-ID: <BD4BEC8E-6A02-4B9B-AFA9-9796008A4A56@uzh.ch>

On 04.06.2011, at 15:41, Martin Morgan wrote:

> On 06/04/2011 03:07 AM, soeren.vogel at uzh.ch wrote:
> 
>> Hello, an S4 class "Foo" is defined with a setter, $. For several reasons, the setter calls a function, .foo.update(). However, bypassing the argument names of the setter does not work. Question 1: Why not and how can I fix this? Question 2: What is the way to define either the function or the setter to modify the original object (not returning the modified copy of it an overwrite the original by assignment)? Thanks, S?ren
>> 
>> setClass("Foo",
>>   representation(
>>     N = "numeric"
>>   ),
>>   prototype(
>>     N = 10000
>>   )
>> )
>> 
>> .foo.update<- function(object, ...) {
>>   args<- list(...)
>>   for (i in slotNames("Foo")[pmatch(names(args), slotNames("Foo"), nomatch=0)]) {
>>     slot(object, i)<- args[[i]]
>>     # indeed more to do here
>>     return(object)
>>   }
>> }
> 
> Since names(args) is 'name', and 'name' is not a slot of 'Foo', the return of pmatch is 0 and .foo.update returns NULL. Put return(object) outside the for loop.
> 
>> setReplaceMethod("$", "Foo",
>>   function(x, name, value) {
>>     x<- .foo.update(x, name=value)
>>     x
>>   }
>> )
>> 
>> x<- new("Foo")
>> x
>> x$N<- 99
>> x # NULL????
> 
> here your intention is that name=value to be substituted with N=99, but you end up with name=99. You could arrange to parse this correctly, but this isn't usually what you _want_ to do and I don't really understand what you're trying to accomplish.

Exactly, what I want to parse is "N"=99. To clarify, .foo.update should be the "one" workhorse to do a couple of things depending on arguments on more than one object (see my post on interfacing a C++ class, just some minutes ago). Thus, assigning x at N = 10 (x$N, x["N"]) should not only end up in x (object of class Foo) with value 10, but also should invoke FOO$setN(10) (a setter for the C++ object, not shown here). So far, .foo.update works perfectly and indeed alters the object x, but the setter does not parse the argument name. I tried with quote, substitute, deparse ..., but got none working ...

> Maybe
> 
> .foo.update <- function(object, name, value, ...)
> {
>    slot(object, name) <- value
>    ## some other stuff
>    object
> }
> 
> Hope that helps a bit.
> 
> Martin

Thanks, S?ren


From simon.urbanek at r-project.org  Sat Jun  4 17:22:07 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Sat, 4 Jun 2011 11:22:07 -0400
Subject: [Rd] Interfacing a C++ class
In-Reply-To: <14F4FFAE-88F5-4C1E-A5BC-4F34E7ACD826@uzh.ch>
References: <14F4FFAE-88F5-4C1E-A5BC-4F34E7ACD826@uzh.ch>
Message-ID: <0B6E7316-B679-4FB0-85D6-1CEA1CA68DCF@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110604/e99936bb/attachment.pl>

From guxiaobo1982 at gmail.com  Sat Jun  4 07:16:33 2011
From: guxiaobo1982 at gmail.com (Xiaobo Gu)
Date: Sat, 4 Jun 2011 13:16:33 +0800
Subject: [Rd] Does anybody successfully built latest R on AIX 5.3?
Message-ID: <BANLkTi=UUtL3rHRKKmQiPO5gUR+Tje9Yig@mail.gmail.com>


From jeroenooms at gmail.com  Sun Jun  5 00:49:16 2011
From: jeroenooms at gmail.com (Jeroen Ooms)
Date: Sat, 4 Jun 2011 15:49:16 -0700 (PDT)
Subject: [Rd] call / do.call expression too big
Message-ID: <1307227756588-3574335.post@n4.nabble.com>

I am designing a remote procedure protocol for R, which basically performs a
do.call on data and arguments supplied by a client. However, I am
experiencing unfortunate behavior of the do.call function. The function
do.call seems to serialize all objects in the args list, resulting in an
enormous expression, that is then in some way or another returned by many
functions. A short example:

args <- list(data=cars, formula=dist~speed);
do.call("lm",args);

One can see that for this small example, the returned 'call' attribute is
already huge. Another example:

eval(call("cor.test", x=rnorm(100), y=rnorm(100)))

I completely understand why this happens, yet I was wondering if there is an
alternative to call/do.call that constructs the call in an different way so
that the actual call object is somewhat more compact and does not contain
all the data that was involved in the function. For example one that
attaches the args list in an environment and constructs a call that refers
to these objects or something similar.


--
View this message in context: http://r.789695.n4.nabble.com/call-do-call-expression-too-big-tp3574335p3574335.html
Sent from the R devel mailing list archive at Nabble.com.


From wwwhsd at gmail.com  Sun Jun  5 02:33:50 2011
From: wwwhsd at gmail.com (Henrique Dallazuanna)
Date: Sat, 4 Jun 2011 21:33:50 -0300
Subject: [Rd] call / do.call expression too big
In-Reply-To: <1307227756588-3574335.post@n4.nabble.com>
References: <1307227756588-3574335.post@n4.nabble.com>
Message-ID: <BANLkTimgHRZEmiXLWBuzpKuK3f+oT7MChw@mail.gmail.com>

Try this:

args <- list(data=quote(cars), formula=dist~speed)

On Sat, Jun 4, 2011 at 7:49 PM, Jeroen Ooms <jeroenooms at gmail.com> wrote:
> I am designing a remote procedure protocol for R, which basically performs a
> do.call on data and arguments supplied by a client. However, I am
> experiencing unfortunate behavior of the do.call function. The function
> do.call seems to serialize all objects in the args list, resulting in an
> enormous expression, that is then in some way or another returned by many
> functions. A short example:
>
> args <- list(data=cars, formula=dist~speed);
> do.call("lm",args);
>
> One can see that for this small example, the returned 'call' attribute is
> already huge. Another example:
>
> eval(call("cor.test", x=rnorm(100), y=rnorm(100)))
>
> I completely understand why this happens, yet I was wondering if there is an
> alternative to call/do.call that constructs the call in an different way so
> that the actual call object is somewhat more compact and does not contain
> all the data that was involved in the function. For example one that
> attaches the args list in an environment and constructs a call that refers
> to these objects or something similar.
>
>
> --
> View this message in context: http://r.789695.n4.nabble.com/call-do-call-expression-too-big-tp3574335p3574335.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Henrique Dallazuanna
Curitiba-Paran?-Brasil
25? 25' 40" S 49? 16' 22" O


From hadley at rice.edu  Sun Jun  5 05:53:03 2011
From: hadley at rice.edu (Hadley Wickham)
Date: Sat, 4 Jun 2011 20:53:03 -0700
Subject: [Rd] call / do.call expression too big
In-Reply-To: <1307227756588-3574335.post@n4.nabble.com>
References: <1307227756588-3574335.post@n4.nabble.com>
Message-ID: <BANLkTinsGyUwiCiXMiOJLY9H0PfV5016Dw@mail.gmail.com>

> I completely understand why this happens, yet I was wondering if there is an
> alternative to call/do.call that constructs the call in an different way so
> that the actual call object is somewhat more compact and does not contain
> all the data that was involved in the function. For example one that
> attaches the args list in an environment and constructs a call that refers
> to these objects or something similar.

Like this?

argn <- lapply(names(args), as.name)
names(argn) <- names(args)

call <- as.call(c(list(as.name("lm")), argn))
eval(call, args)

Hadley


-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From notoriousnoah at gmail.com  Sun Jun  5 05:53:22 2011
From: notoriousnoah at gmail.com (notoriousnoah)
Date: Sat, 4 Jun 2011 20:53:22 -0700 (PDT)
Subject: [Rd] Use of R in C#
In-Reply-To: <4DDA3155.7080103@univie.ac.at>
References: <C3D16A4C8BD3F843860C73573C70DD952E255192@TK5EX14MBXC103.redmond.corp.microsoft.com>
	<loom.20110522T142600-449@post.gmane.org>
	<4DDA3155.7080103@univie.ac.at>
Message-ID: <1307246002794-3574601.post@n4.nabble.com>

Everyone refs 3 names spaces.  I can ref STATCONNECTORCLNTLib and
StatConnectorCommonLib but 

I don't have the DLL to ref STATCONNECTORSRVLib??


Can you let me know where I cann download StatConnectorCommonLib.DLL?

I tried R_SCILab_DCom3.0-1B.exe, and statConnDCom.lastest.exe and
RAndFriendsSetup213.EXE.  Not one of these has this DLL. 

Best,
Noah


--
View this message in context: http://r.789695.n4.nabble.com/Use-of-R-in-C-tp2165189p3574601.html
Sent from the R devel mailing list archive at Nabble.com.


From patrick.giraudoux at univ-fcomte.fr  Sun Jun  5 16:56:25 2011
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Sun, 05 Jun 2011 16:56:25 +0200
Subject: [Rd] tag \href not recognised in rd doc
Message-ID: <4DEB9919.8030809@univ-fcomte.fr>

Hi,

I have a trouble trying to use \href in a rd doc. See example below:

\references{

\href{http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2702787/}{Vaniscotte 
A., Pleydell D., Raoul F., Quere J.P., Coeurdassier M., Delattre P., Li 
T., Qian W., Takahashi K., Weidmann J.C., Qiu J., Giraudoux P. 2009 
Modelling and spatial discrimination of small mammal assemblages: an 
example from western Sichuan (China). Ecological Modelling, 220: 1218-1231.}

}


The Rcmd check gives:

* checking R code for possible problems ... OK
* checking Rd files ... WARNING
checkRd: (7) multignome.Rd:38: Tag \href not recognized

I saw there is already a link on the issue 
http://bugs.r-project.org/bugzilla3/show_bug.cgi?id=14535, but I hardly 
understand if it is a real bug, if so if it have been fixed, or if I am 
misusing the tag...

Any hint appreciated,

Best,

Patrick


From erich.neuwirth at univie.ac.at  Sun Jun  5 18:16:30 2011
From: erich.neuwirth at univie.ac.at (Erich Neuwirth)
Date: Sun, 5 Jun 2011 18:16:30 +0200
Subject: [Rd] Use of R in C#
In-Reply-To: <1307246002794-3574601.post@n4.nabble.com>
References: <C3D16A4C8BD3F843860C73573C70DD952E255192@TK5EX14MBXC103.redmond.corp.microsoft.com>
	<loom.20110522T142600-449@post.gmane.org>
	<4DDA3155.7080103@univie.ac.at>
	<1307246002794-3574601.post@n4.nabble.com>
Message-ID: <46865867-7DBD-4FEF-9C06-3A1BAECAC886@univie.ac.at>

statconnDCOM (and RExcel) have their own mailing list.
Please subscribe at rcom.univie.ac.at and post your questions on that list.

On Jun 5, 2011, at 5:53 AM, notoriousnoah wrote:

> Everyone refs 3 names spaces.  I can ref STATCONNECTORCLNTLib and
> StatConnectorCommonLib but 
> 
> I don't have the DLL to ref STATCONNECTORSRVLib??
> 
> 
> Can you let me know where I cann download StatConnectorCommonLib.DLL?
> 
> I tried R_SCILab_DCom3.0-1B.exe, and statConnDCom.lastest.exe and
> RAndFriendsSetup213.EXE.  Not one of these has this DLL. 
> 
> Best,
> Noah
> 
> 
> --
> View this message in context: http://r.789695.n4.nabble.com/Use-of-R-in-C-tp2165189p3574601.html
> Sent from the R devel mailing list archive at Nabble.com.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From murdoch.duncan at gmail.com  Sun Jun  5 22:30:51 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sun, 05 Jun 2011 16:30:51 -0400
Subject: [Rd] tag \href not recognised in rd doc
In-Reply-To: <4DEB9919.8030809@univ-fcomte.fr>
References: <4DEB9919.8030809@univ-fcomte.fr>
Message-ID: <4DEBE77B.4040800@gmail.com>

I don't get any error when I insert that code into a .Rd file in R 
2.13.0 patched.  The NEWS file says this was fixed in 2.12.2 patched. 
What version are you using?

Duncan Murdoch

On 11-06-05 10:56 AM, Patrick Giraudoux wrote:
> Hi,
>
> I have a trouble trying to use \href in a rd doc. See example below:
>
> \references{
>
> \href{http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2702787/}{Vaniscotte
> A., Pleydell D., Raoul F., Quere J.P., Coeurdassier M., Delattre P., Li
> T., Qian W., Takahashi K., Weidmann J.C., Qiu J., Giraudoux P. 2009
> Modelling and spatial discrimination of small mammal assemblages: an
> example from western Sichuan (China). Ecological Modelling, 220: 1218-1231.}
>
> }
>
>
> The Rcmd check gives:
>
> * checking R code for possible problems ... OK
> * checking Rd files ... WARNING
> checkRd: (7) multignome.Rd:38: Tag \href not recognized
>
> I saw there is already a link on the issue
> http://bugs.r-project.org/bugzilla3/show_bug.cgi?id=14535, but I hardly
> understand if it is a real bug, if so if it have been fixed, or if I am
> misusing the tag...
>
> Any hint appreciated,
>
> Best,
>
> Patrick
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jeroen.ooms at stat.ucla.edu  Mon Jun  6 01:25:08 2011
From: jeroen.ooms at stat.ucla.edu (Jeroen Ooms)
Date: Sun, 5 Jun 2011 16:25:08 -0700
Subject: [Rd] call / do.call expression too big
In-Reply-To: <BANLkTinsGyUwiCiXMiOJLY9H0PfV5016Dw@mail.gmail.com>
References: <1307227756588-3574335.post@n4.nabble.com>
	<BANLkTinsGyUwiCiXMiOJLY9H0PfV5016Dw@mail.gmail.com>
Message-ID: <BANLkTi=KZ9RWr1+S_yMOCVoDgFgC2uNpKw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110605/5db68efc/attachment.pl>

From hadley at rice.edu  Mon Jun  6 01:27:40 2011
From: hadley at rice.edu (Hadley Wickham)
Date: Sun, 5 Jun 2011 16:27:40 -0700
Subject: [Rd] call / do.call expression too big
In-Reply-To: <BANLkTi=KZ9RWr1+S_yMOCVoDgFgC2uNpKw@mail.gmail.com>
References: <1307227756588-3574335.post@n4.nabble.com>
	<BANLkTinsGyUwiCiXMiOJLY9H0PfV5016Dw@mail.gmail.com>
	<BANLkTi=KZ9RWr1+S_yMOCVoDgFgC2uNpKw@mail.gmail.com>
Message-ID: <BANLkTim19incxwCFLSo-dq3tiPQQ6+n2qg@mail.gmail.com>

On Sun, Jun 5, 2011 at 4:25 PM, Jeroen Ooms <jeroen.ooms at stat.ucla.edu> wrote:
>> argn <- lapply(names(args), as.name)
>> names(argn) <- names(args)
>>
>> call <- as.call(c(list(as.name("lm")), argn))
>> eval(call, args)
>
> Great, almost! Is there any way I can explicitly specify the package of the
> function in this way? I tried replacing "lm" with "stats::lm" but that did
> not work.

Hmmm, not sure.  Maybe something like: call("::", as.name("stats"),
as.name("lm"))

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From patrick.giraudoux at univ-fcomte.fr  Mon Jun  6 06:41:11 2011
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Mon, 06 Jun 2011 06:41:11 +0200
Subject: [Rd] tag \href not recognised in rd doc
In-Reply-To: <4DEBE77B.4040800@gmail.com>
References: <4DEB9919.8030809@univ-fcomte.fr> <4DEBE77B.4040800@gmail.com>
Message-ID: <4DEC5A67.5020305@univ-fcomte.fr>

Le 05/06/2011 22:30, Duncan Murdoch a ?crit :
> I don't get any error when I insert that code into a .Rd file in R 
> 2.13.0 patched.  The NEWS file says this was fixed in 2.12.2 patched. 
> What version are you using?
>
> Duncan Murdoch
>

Currently R version 2.12.2 (2011-02-25) binary

Suppose I should move to the 2.13.0 ?

Patrick

> On 11-06-05 10:56 AM, Patrick Giraudoux wrote:
>> Hi,
>>
>> I have a trouble trying to use \href in a rd doc. See example below:
>>
>> \references{
>>
>> \href{http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2702787/}{Vaniscotte
>> A., Pleydell D., Raoul F., Quere J.P., Coeurdassier M., Delattre P., Li
>> T., Qian W., Takahashi K., Weidmann J.C., Qiu J., Giraudoux P. 2009
>> Modelling and spatial discrimination of small mammal assemblages: an
>> example from western Sichuan (China). Ecological Modelling, 220: 
>> 1218-1231.}
>>
>> }
>>
>>
>> The Rcmd check gives:
>>
>> * checking R code for possible problems ... OK
>> * checking Rd files ... WARNING
>> checkRd: (7) multignome.Rd:38: Tag \href not recognized
>>
>> I saw there is already a link on the issue
>> http://bugs.r-project.org/bugzilla3/show_bug.cgi?id=14535, but I hardly
>> understand if it is a real bug, if so if it have been fixed, or if I am
>> misusing the tag...
>>
>> Any hint appreciated,
>>
>> Best,
>>
>> Patrick
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From oliver at first.in-berlin.de  Sun Jun  5 18:22:20 2011
From: oliver at first.in-berlin.de (oliver)
Date: Sun, 5 Jun 2011 18:22:20 +0200
Subject: [Rd] C-Side: Applying a function (given as param) to data
 (given as param)
In-Reply-To: <4DEA1C2C.6060504@gmail.com>
References: <20110603101712.GD6048@siouxsie>
	<BANLkTi=DkQzC74HP5WEiN-eyBiBV0yUDew@mail.gmail.com>
	<20110603201955.GA2058@siouxsie> <4DEA1C2C.6060504@gmail.com>
Message-ID: <20110605162220.GJ4328@siouxsie>

On Sat, Jun 04, 2011 at 07:51:08AM -0400, Duncan Murdoch wrote:
> On 11-06-03 4:19 PM, oliver wrote:
> >On Fri, Jun 03, 2011 at 11:14:39AM -0500, Douglas Bates wrote:
> >>On Fri, Jun 3, 2011 at 5:17 AM, oliver<oliver at first.in-berlin.de>  wrote:
> >>>Hello,
> >>>
> >>>I'm implementing a package (C-extension),
> >>>where one function gets data and a function
[...]

[...]
> >>to be in The R Journal.  They show an explicit example of apply in
> >>compiled code (C++ using the Rcpp structures, in their case).
> >
> >
> >As just mentioned: I already created successfully a C-extension for R.
> >
> >But I would like to know, how to call a function that I get via
> >SEXP as parameter. How can I find out the function definition,
> >for example the arity of the function and which arguments
> >a function uses.
> 
> You should almost certainly do this in R, not in C.  If you are
> doing it in C code you'll just be duplicating the implementation
> from R, and your code will break if that implementation ever
> changes.
[...]

The reason why I wanted to do this in C, not in R,
is speed as well as consistency.

I have about 700 MB data that I want to analyse....

And loops might be to slow in R.
Some of the apply functions might help and I already implemented
some stuff in R, but the result values that some of the apply functions give me,
are changing under certain circumstances, for example list or matrix or vector.
Also a lot of conversions and value-extracting is needed.
It looked to me as if doing in C would be the better way.

So I want to have the possibility to do that in C,
then loops are no problem, and I can create a certain
result value type, as well as some other features I have in mind.
Also in R the automatic coercion to some types sometimes
is not necessary, and working on the raw values might be
better, it seems to me.

Also I want to learn the C-interface, so that in later cases
I know how to use it.

For simple values I already know how to use it.
But the problem is there, when functions are given as parameters.
That is a very powerful feature. If that only is manageable easy in
R, it might always be a performance bottleneck.


> 
> In R you use formals(fn) to extract the function header.

OK, thanks.


> 
> >
> >The problem is, that the C-standard (at least the first ANSI-C standard)
> >does not guarantee portability for C-pointers.
> >To be portable, for example the function pointer you use must
> >definitely be of same type as the function you use.
> >
> >So I need to know how I can use the SEXP-function pointers.
> 
> They are not function pointers, they are pointers to R objects.
[...]

Aha, good to know.

Do I have to look at S3 and S4 methods and classses, if I wish to
make it in C?

Ciao,
   Oliver


From oliver at first.in-berlin.de  Sun Jun  5 19:00:05 2011
From: oliver at first.in-berlin.de (oliver)
Date: Sun, 5 Jun 2011 19:00:05 +0200
Subject: [Rd] C-Side: Applying a function (given as param) to data
 (given as param)
In-Reply-To: <E7790C02-6D25-415D-A7E3-E59717FAA71E@gmail.com>
References: <20110603101712.GD6048@siouxsie>
	<BANLkTi=DkQzC74HP5WEiN-eyBiBV0yUDew@mail.gmail.com>
	<20110603201955.GA2058@siouxsie>
	<E7790C02-6D25-415D-A7E3-E59717FAA71E@gmail.com>
Message-ID: <20110605170004.GL4328@siouxsie>

Hello Jeff,

thanks for the hints and details.

I just downloaded xts-sources and hope it shows me the
dark secrets of R ;)

Ciao,
   Oliver


From murdoch.duncan at gmail.com  Mon Jun  6 10:59:18 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 06 Jun 2011 04:59:18 -0400
Subject: [Rd] tag \href not recognised in rd doc
In-Reply-To: <4DEC5A67.5020305@univ-fcomte.fr>
References: <4DEB9919.8030809@univ-fcomte.fr> <4DEBE77B.4040800@gmail.com>
	<4DEC5A67.5020305@univ-fcomte.fr>
Message-ID: <4DEC96E6.1050209@gmail.com>

On 11-06-06 12:41 AM, Patrick Giraudoux wrote:
> Le 05/06/2011 22:30, Duncan Murdoch a ?crit :
>> I don't get any error when I insert that code into a .Rd file in R
>> 2.13.0 patched.  The NEWS file says this was fixed in 2.12.2 patched.
>> What version are you using?
>>
>> Duncan Murdoch
>>
>
> Currently R version 2.12.2 (2011-02-25) binary
>
> Suppose I should move to the 2.13.0 ?

Yes, please do.

Duncan Murdoch

>
> Patrick
>
>> On 11-06-05 10:56 AM, Patrick Giraudoux wrote:
>>> Hi,
>>>
>>> I have a trouble trying to use \href in a rd doc. See example below:
>>>
>>> \references{
>>>
>>> \href{http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2702787/}{Vaniscotte
>>> A., Pleydell D., Raoul F., Quere J.P., Coeurdassier M., Delattre P., Li
>>> T., Qian W., Takahashi K., Weidmann J.C., Qiu J., Giraudoux P. 2009
>>> Modelling and spatial discrimination of small mammal assemblages: an
>>> example from western Sichuan (China). Ecological Modelling, 220:
>>> 1218-1231.}
>>>
>>> }
>>>
>>>
>>> The Rcmd check gives:
>>>
>>> * checking R code for possible problems ... OK
>>> * checking Rd files ... WARNING
>>> checkRd: (7) multignome.Rd:38: Tag \href not recognized
>>>
>>> I saw there is already a link on the issue
>>> http://bugs.r-project.org/bugzilla3/show_bug.cgi?id=14535, but I hardly
>>> understand if it is a real bug, if so if it have been fixed, or if I am
>>> misusing the tag...
>>>
>>> Any hint appreciated,
>>>
>>> Best,
>>>
>>> Patrick
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>


From iago.mosqueira at gmail.com  Mon Jun  6 13:11:54 2011
From: iago.mosqueira at gmail.com (Iago Mosqueira)
Date: Mon, 6 Jun 2011 13:11:54 +0200
Subject: [Rd] Overloading S4 methods
In-Reply-To: <4DE6631A.9010104@fhcrc.org>
References: <BANLkTi=KwUzxy+3YA+HWmP-PPozD-g7zkg@mail.gmail.com>
	<4DE6631A.9010104@fhcrc.org>
Message-ID: <BANLkTimCFhkqPq=3XowmiZVKDtwXhM4V3g@mail.gmail.com>

On Wed, Jun 1, 2011 at 6:04 PM, Martin Morgan <mtmorgan at fhcrc.org> wrote:
> On 06/01/2011 04:39 AM, Iago Mosqueira wrote:
>>
>> Dear all,
>>
>> I am experiencing some problems with S4 method overloading. I have
>> defined a generic for graphics:plot, using
>>
>> setGeneric("plot", useAsDefault = plot)
>>
>> and with
>>
>> importFrom('graphics', 'plot') and
>>
>> exportMethods('plot') in the NAMESPACE file of pkg A.
>
> I'd guess you were creating two generics (explicitly in pkgA, implicitly in
> pkgB). Maybe
>
> ?export(plot)
>
> in NAMESPACE of pkg A,
>
> ?importFrom('pkgA', plot)
> ?exportMethods(plot)
>
> in pkg B. Feel free to post to the list if that's helpful.
>
> Martin
>
>>
>> I then proceed to define a method for signature c('myS4class',
>> 'missing'). This works as expected: selectMethod('plot',
>> c('myS4class', 'missing')) returns the newly defined method, and the
>> method gets called when invoked.
>>
>> Another pkg, B, wishes to overload this and redefines the method for
>> the same signature. A method is defined for c('myS4class', 'missing'),
>> and exported on the NAMESPACE. The new method is shown by
>> selectMethod() after pkg B has been loaded, but a call to
>>
>> plot(anobjectofmyS4class)
>>
>> comes up with the result of running the first method, from pkg A. I
>> have tried importing 'plot' in B's NAMESPACE from both graphics or A,
>> but the end result is the same.
>>
>> Package B does the same thing for a method created by pkg A, myMethod,
>> and that works fine.
>>
>> Any pointers or where this might be going wrong? How is it that a
>> different method than the one shown by selectMethod() is being run?
>> Something to do with the 'missing' part of the signature?
>>
>> Many thanks,
>>
>>
>>
>> Iago Mosqueira

Dear all,

I have tried Martin's suggestion, but the problem persists. It seems
to be related to having 'missing' in the signature, as doing the same
kind of overloading for c('myclass', 'ANY') work as expected.

I am attaching 2 simple packages where I attempt this repeated
overloading of plot for the same class. Script below, also found in
Bpkg/tests.test.R, shows what I have encountered so far:
plot('myclass', 'ANY') can be re-overloaded, but plot('myclass',
'missing') cannot in the same way. If I run

trace("plot", browser, exit=browser, signature = c("mynum", "missing"))

the  new method is actually called.

Any hint on what I am doing wrong or where to look for an explanation
will be much appreciated.

Best regards,


Iago Mosqueira
-------------- next part --------------
A non-text attachment was scrubbed...
Name: plot_pkgs.tar.gz
Type: application/x-gzip
Size: 1178 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110606/b35855a1/attachment.gz>

From romain at r-enthusiasts.com  Mon Jun  6 13:42:48 2011
From: romain at r-enthusiasts.com (Romain Francois)
Date: Mon, 06 Jun 2011 13:42:48 +0200
Subject: [Rd] Interfacing a C++ class
In-Reply-To: <14F4FFAE-88F5-4C1E-A5BC-4F34E7ACD826@uzh.ch>
References: <14F4FFAE-88F5-4C1E-A5BC-4F34E7ACD826@uzh.ch>
Message-ID: <4DECBD38.3020105@r-enthusiasts.com>

Le 04/06/11 16:31, soeren.vogel at uzh.ch a ?crit :
>
> Hello
>
> Apologies for cross-posting, the discussion should (if) go to R-devel, but I also want to reach the rcpp-devel people.
>
> My C++ class FOO is a module available through Rcpp, and it works fine and is -- so far -- bug free. With trying to further develop my R package, I thought it was a good idea to interface my C++ workhorse FOO with an S4 class Foo. After some long and not always insightful trip through S4 classes and methods, I am not sure if I am on the right way of thinking and designing. Since there is no local assistance available, could you help to make things clearer?
>
> Just a brief outline:
>
> FOO is the C++ object, and Foo should be the S4 class. If the user creates an object, say bar, from class Foo, the creation process automatically makes a new FOO object relating to bar in that a unique name of the FOO instance is stored in a slot of bar. All the user then has to do is modify bar by simple assignments. The getters and setters ("$", "[") are set up and work. Each modification goes in hand with assigning new values to bar as well as updating the FOO object through available setters from FOO.
>
> So far, this way has brought me to about 100 lines, but now I read about ReferenceClasses and was wondering, if there is a much easier way of achieving my goals. Moreover, I was not sure any longer if my goals make sense or if a more advanced programmer would do it totally different (and could share some structural thinking on their approach).
>
> The idea behind my way of doing was based upon several considerations. First, a "classical" R object would not confuse users, as I assume users of my package to be rather non-skilled (and not willing to change that). Second, I want to create a properly programmed package for distribution on CRAN and publication, eventually. Third, I want to save objects across sessions. So if a user restores a session, a simple command, say, restore(), would do the trick to build all the related C++ objects again. However, I admit that I still have not figured out how to automatically clean up the workspace correctly before leaving a session, wanted or unwanted, that is, clean up memory before leaving home. Fourth, pure arithmetic check is done in C++, however, semantic check *should* be left to R, and the validity and class routines seem to be perfect for this. Fifth, some work should be done in R, such as the passing of data frames or samples from distributions.
>
> I hope to get some structured ideas and hints how to start and/or proceed.
>
> Thank you in advance,
> S?ren

Hello,

A C++ class that is exposed through an Rcpp module is already a 
reference class, and so you can add methods, etc ...

Consider this example :

require(inline)
require(Rcpp)

fx <- cxxfunction( , '', includes = '

class FOO{
public:
     FOO( double x_, double y_): x(x_), y(y_){}

     double x ;
     double y ;

     void move( double dx, double dy){
         x += dx ;
         y += dy ;
     }
} ;

RCPP_MODULE(mod){

     class_<FOO>("FOO" )

         .constructor<double,double>()

         .field( "x", &FOO::x )
         .field( "y", &FOO::y )

         .method( "move", &FOO::move )
         ;
}


', plugin = "Rcpp" )
mod <- Module( "mod", getDynLib(fx),mustStart = TRUE )

# grab the exposed C++ class
FOO <- mod$FOO

# add R methods
FOO$methods(
     bla = function() x+y,
     reset = function() {
         x <<- 0.0
         y <<- 0.0
     }
)
# create an instance
f <- new( FOO, 2.0, 3.0 )

# call an R method
f$reset()

# call a C++ method
f$move( 2.0, 2.0 )

# call an R method
f$bla()


Hope this helps.

Romain

-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
http://romain-francois.com
|- http://bit.ly/hdKhCy : Rcpp article in JSS
|- http://bit.ly/elZJRJ : Montpellier Comedie Club - Avril 2011
`- http://bit.ly/fhqbRC : Rcpp workshop in Chicago on April 28th


From janko.thyson.rstuff at googlemail.com  Mon Jun  6 15:28:31 2011
From: janko.thyson.rstuff at googlemail.com (Janko Thyson)
Date: Mon, 06 Jun 2011 15:28:31 +0200
Subject: [Rd] Bug or feature: using "ANY" as a generic field class (was:
 '[R] Is there a (virtual) class that all R objects inherit from?)
In-Reply-To: <4DE91638.3060503@r-project.org>
References: <4DE8E777.7090008@googlemail.com> <4DE91638.3060503@r-project.org>
Message-ID: <4DECD5FF.402@googlemail.com>

Thanks a lot for your reply and I'm sorry if I didn't make it quite 
clear what I expected, but you got it right:

I'd simply like to see the same behavior for Reference Classes as for S4 
classes when extending classes with "ANY" fields as featured in the 
example below.

 > setClass("A", representation(x="ANY"))
[1] "A"
 > setClass("B", contains="A", representation(x="character"))
[1] "B"
 > new("B", x = "abc")
An object of class "B"
Slot "x":
[1] "abc"

Thanks for addressing this!

Regards,
Janko

On 03.06.2011 19:13, John Chambers wrote:
> Well, your mail is unclear as to what you expected, but there is one 
> bug shown by your example.
>
> The behavior of S4 classes is sensible, at least as far as the example 
> shows:
>
>
> > setClass("A", representation(x="ANY"))
> [1] "A"
> > setClass("B", contains="A", representation(x="character"))
> [1] "B"
> > new("B", x=1:3)
> Error in validObject(.Object) :
>   invalid class "B" object: invalid object for slot "x" in class "B": 
> got class "integer", should be or extend class "character"
>
> You couldn't expect the new() call to work, as the error message 
> clearly explains.  A legitimate call does work:
>
> > new("B", x = "abc")
> An object of class "B"
> Slot "x":
> [1] "abc"
>
> The reference classes should work the same way, but don't, as your 
> example shows.
>
> A <- setRefClass(
> + Class="A",
> + fields=list(
> + .PRIMARYDATA="ANY"
> + ),
> + contains=c("VIRTUAL")
> + )
> > B <- setRefClass(
> + Class="B",
> + fields=list(
> + .PRIMARYDATA="character"
> + ),
> + contains=c("A")
> + )
> Error in `insertFields<-`(`*tmp*`, value = "character") :
>   The overriding class("character") of field ".PRIMARYDATA" is not a 
> subclass of the existing field definition ("ANY")
>
> We'll fix that.  And, yes, "ANY" is intended as a universal 
> superclass, but is usually not mentioned explicitly.
>
>
> On 6/3/11 6:53 AM, Janko Thyson wrote:
>> Dear list,
>>
>> I was wondering if you could help me out in clarifying something:
>> Is it possible to use class "ANY" in slots/fields of formal classes 
>> if you
>>     a) do not want to restrict valid classes of that field and
>>     b) if you are making explicit use of class inheritance?
>>
>> It seems to work in simple scenarios but produces errors when class
>> inheritance comes into play. So I was wondering if that's a feature or a
>> bug.
>>
>> If using "ANY" is not the right way, I'd appreciate a pointer to how you
>> can to this.
>>
>> See previous post with an example below.
>>
>> Regards,
>> Janko
>>
>> On 06/03/2011 01:53 AM, Janko Thyson wrote:
>>> On 31.05.2011 18:17, Martin Morgan wrote:
>>>> On 05/30/2011 07:02 AM, Janko Thyson wrote:
>>>>> Dear list,
>>>>>
>>>>> I would like to set one specific Reference Class field to be of an
>>>>> arbitrary class. Is there a class that all R objects inherit from? I
>>>>> thought that "ANY" was something like this, but obviously that's not
>>>>> true:
>>>>>
>>>>>> inherits(1:3, "ANY")
>>>>> [1] FALSE
>>>>
>>>> I can't speak to the implementation, but ANY functions as a base class
>>>> in terms of slot / field assignment and inheritance, e.g.,
>>>>
>>>> setClass("A", representation(x="ANY"))
>>>> new("A", x=1:3)
>>>>
>>>> Martin
>>>
>>> Hi Martin,
>>>
>>> sorry for the late response. The way you do it works. Yet, when you
>>> declare dependencies more explicitly (contains=XY), then R 
>>> complains. Is
>>> this a feature or a bug (with respect to the "less explicit" way 
>>> working
>>> just fine)? See the example below:
>>>
>>> # S4
>>> setClass("A", representation(x="ANY"))
>>> new("A", x=1:3)
>>>
>>> setClass("A", representation(x="ANY"))
>>> setClass("B", contains="A", representation(x="character"))
>>> new("B", x=1:3)
>>>
>>> # Reference Classes
>>> setRefClass(
>>> Class="A",
>>> fields=list(
>>> .PRIMARYDATA="ANY"
>>> ),
>>> contains=c("VIRTUAL")
>>> )
>>> B<- setRefClass(
>>> Class="B",
>>> fields=list(
>>> .PRIMARYDATA="character"
>>> ),
>>> contains=c("A")
>>> )
>>
>> Bug, I'd say. Martin
>>
>>>
>>> Regards,
>>> Janko
>>>>>
>>>>> Regards,
>>>>> Janko
>>>>>
>>>>> [[alternative HTML version deleted]]
>>>>>
>>>>> ______________________________________________
>>>>> R-help at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>>>> PLEASE do read the posting guide
>>>>> http://www.R-project.org/posting-guide.html
>>>>> and provide commented, minimal, self-contained, reproducible code.
>>>>
>>>>
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From simon.urbanek at r-project.org  Mon Jun  6 16:21:52 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 6 Jun 2011 10:21:52 -0400
Subject: [Rd] C-Side: Applying a function (given as param) to data
	(given as param)
In-Reply-To: <20110605162220.GJ4328@siouxsie>
References: <20110603101712.GD6048@siouxsie>
	<BANLkTi=DkQzC74HP5WEiN-eyBiBV0yUDew@mail.gmail.com>
	<20110603201955.GA2058@siouxsie> <4DEA1C2C.6060504@gmail.com>
	<20110605162220.GJ4328@siouxsie>
Message-ID: <7EB6D92E-9A5C-459A-B4DB-66FC7BEC1AF4@r-project.org>


On Jun 5, 2011, at 12:22 PM, oliver wrote:

> On Sat, Jun 04, 2011 at 07:51:08AM -0400, Duncan Murdoch wrote:
>> On 11-06-03 4:19 PM, oliver wrote:
>>> On Fri, Jun 03, 2011 at 11:14:39AM -0500, Douglas Bates wrote:
>>>> On Fri, Jun 3, 2011 at 5:17 AM, oliver<oliver at first.in-berlin.de>  wrote:
>>>>> Hello,
>>>>> 
>>>>> I'm implementing a package (C-extension),
>>>>> where one function gets data and a function
> [...]
> 
> [...]
>>>> to be in The R Journal.  They show an explicit example of apply in
>>>> compiled code (C++ using the Rcpp structures, in their case).
>>> 
>>> 
>>> As just mentioned: I already created successfully a C-extension for R.
>>> 
>>> But I would like to know, how to call a function that I get via
>>> SEXP as parameter. How can I find out the function definition,
>>> for example the arity of the function and which arguments
>>> a function uses.
>> 
>> You should almost certainly do this in R, not in C.  If you are
>> doing it in C code you'll just be duplicating the implementation
>> from R, and your code will break if that implementation ever
>> changes.
> [...]
> 
> The reason why I wanted to do this in C, not in R,
> is speed as well as consistency.
> 
> I have about 700 MB data that I want to analyse....
> 
> And loops might be to slow in R.
> Some of the apply functions might help and I already implemented
> some stuff in R, but the result values that some of the apply functions give me,
> are changing under certain circumstances, for example list or matrix or vector.
> Also a lot of conversions and value-extracting is needed.
> It looked to me as if doing in C would be the better way.
> 
> So I want to have the possibility to do that in C,
> then loops are no problem, and I can create a certain
> result value type, as well as some other features I have in mind.
> Also in R the automatic coercion to some types sometimes
> is not necessary, and working on the raw values might be
> better, it seems to me.
> 
> Also I want to learn the C-interface, so that in later cases
> I know how to use it.
> 
> For simple values I already know how to use it.
> But the problem is there, when functions are given as parameters.
> That is a very powerful feature. If that only is manageable easy in
> R, it might always be a performance bottleneck.
> 

One thing you should realize is that when you pass a function it is a *R* function (closure) so you are already leaving the C level the moment you need to use it (=evaluate it). Note that loops are not slow in general in R, they are slow compared to scalar computations but that's not the case here so I don't expect much difference in speed, either.

That said, if you get something like function(x) passed via .Call as SEXP the way to use it is simply:

SEXP useMe(SEXP myFun) {
	SEXP xValue = ... /* value to pass ... */
	SEXP env = ... /* where to eval ...* /
	SEXP result = eval(lang2(myFun, xValue), env);
}

so a trivial sort of lapply for a sequence would be something like

SEXP lapply10(SEXP myFun) {
	SEXP sIndex = PROTECT(allocVector(INTSXP, 1));
	SEXP result = PROTECT(allocVector(VECSXP, 10));
	int *index = INTEGER(sIndex);
	for (int i = 0; i < 10; i++) {
		index[0] = i + 1;
		SET_VECTOR_ELT(result, i, eval(lang2(myFun, sIndex), R_GlobalEnv));
	}
	UNPROTECT(2);
	return result;
}

Cheers,
Simon


> 
>> 
>> In R you use formals(fn) to extract the function header.
> 
> OK, thanks.
> 
> 
>> 
>>> 
>>> The problem is, that the C-standard (at least the first ANSI-C standard)
>>> does not guarantee portability for C-pointers.
>>> To be portable, for example the function pointer you use must
>>> definitely be of same type as the function you use.
>>> 
>>> So I need to know how I can use the SEXP-function pointers.
>> 
>> They are not function pointers, they are pointers to R objects.
> [...]
> 
> Aha, good to know.
> 
> Do I have to look at S3 and S4 methods and classses, if I wish to
> make it in C?
> 
> Ciao,
>   Oliver
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From jorismeys at gmail.com  Mon Jun  6 17:15:05 2011
From: jorismeys at gmail.com (Joris Meys)
Date: Mon, 6 Jun 2011 17:15:05 +0200
Subject: [Rd] Possible bug in termplot function (stats package) ?
Message-ID: <BANLkTikkDxdR_1+TJNX5LMkr23spvOJ4+A@mail.gmail.com>

Hi all,

I noticed some very odd behaviour in the termplot function of the
stats package due to the following lines :

18.    if (is.null(data))
19.       data <- eval(model$call$data, envir)

This one will look in the global environment, and renders the two
lines after this

20.   if (is.null(data))
21.        data <- mf

completely obsolete. If nothing is found, an error is returned. If
anything is found, data won't be NULL, so line 20, when reached, will
always return FALSE. Can it be that lines 18 and 19 should be removed
from the function?

This gives especially problems when called from other plot functions
on models made with wrapper functions. One example :

Data <- data.frame(
 x1=rnorm(100),
 x2=rnorm(100,3,2),
 y=rnorm(100)
)
form <- as.formula(y~x1+x2)
test <- lm(form, data=Data)
termplot(test)

wrapper <- function(ff,x){
 tt <- lm(ff,data=x)
}
test2 <- wrapper(form,Data)
termplot(test2)

For the non-smooth terms, termplot is called. In the first example,
this works perfectly well. In the second example, it either returns "x
not found" (when there is no x variable in the global) or "x2 not
found" when there is an x variable.

If both lines mentioned earlier are erased from the function, it works
as expected in this example code. Using the model frame seems the
logic choice here, I have no clue why one would want to look in the
global environment for the data related to a model.

Cheers
Joris

-- 
Joris Meys
Statistical consultant

Ghent University
Faculty of Bioscience Engineering
Department of Applied mathematics, biometrics and process control

tel : +32 9 264 59 87
Joris.Meys at Ugent.be
-------------------------------
Disclaimer : http://helpdesk.ugent.be/e-maildisclaimer.php


From Stefan.Hoj-Edwards at agrsci.dk  Mon Jun  6 15:30:15 2011
From: Stefan.Hoj-Edwards at agrsci.dk (=?iso-8859-1?Q?Stefan_McKinnon_H=F8j-Edwards?=)
Date: Mon, 6 Jun 2011 15:30:15 +0200
Subject: [Rd] Log file of building vignette in RCMD check
Message-ID: <1C56F3EE22DF4F458FE02F58B96D4150555EA9FD3B@DJFEXMBX01.djf.agrsci.dk>

Hello,

I am trying to run "RCMD check" on a package. It performs OK, with the exception of a single warning:
* checking package vignettes in 'inst/doc' ... WARNING
Package vignette(s) without corresponding PDF:
   AnnotationFuncsUserguide.Rnw

As I understand the problem, the vignette is not built. However, I have no problems in doing so manually.
How do I fix this problem? I cannot find any logs for building the vignette, however the output from building the pdf-file of the manual is found in the .Rcheck folder. 

On a similar note, as my vignette includes a biblio, I have to run "latex" twice to get the citations referenced properly with a number. Is this an issue? How can I work around it? (The package is submitted to BioC, so there might be other rules there?)

Thank you in advanced.
Yours sincerely,

Stefan McKinnon H?j-Edwards     Dept. of Genetics and Biotechnology
PhD student                     Faculty of Agricultural Sciences
stefan.hoj-edwards at agrsci.dk    Aarhus University
Tel.: +45 8999 1291             Blichers All? 20, Postboks 50
Web: www.iysik.com              DK-8830?Tjele
                                Tel.: +45 8999 1900
                                Web: www.agrsci.au.dk


From APeterhansl at GAINCapital.com  Mon Jun  6 16:22:58 2011
From: APeterhansl at GAINCapital.com (Alexander Peterhansl)
Date: Mon, 6 Jun 2011 14:22:58 +0000
Subject: [Rd] read.csv and FileEncoding in Windows version of R 2.13.0
In-Reply-To: <4DE6CC9E.8000407@gmail.com>
References: <FD59D3740610AB4388AA1BDC7FC9531D79474D@CRP11EXHMBS01.GAINCapital.com>
	<4DE6CC9E.8000407@gmail.com>
Message-ID: <FD59D3740610AB4388AA1BDC7FC9531D795BA2@CRP11EXHMBS01.GAINCapital.com>


Hello Duncan, thank you very much for your reply.  The file is attached.

Again, the issue is that opening this UTF-8 encoded file under R 2.13.0 yields an error, but opening it under R 2.12.2 works without any issues.

The command I used to open the file is:
read.csv("test.csv",fileEncoding="UTF-8",header=FALSE)

(As you'll see, the file does have a byte order mark.)

Regards,
Alex


-----Original Message-----
From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com] 
Sent: Wednesday, June 01, 2011 7:35 PM
To: Alexander Peterhansl
Cc: R-devel at r-project.org
Subject: Re: [Rd] read.csv and FileEncoding in Windows version of R 2.13.0

On 01/06/2011 6:00 PM, Alexander Peterhansl wrote:
>
> Dear R-devel List:
>
> read.csv() seems to have changed in R version 2.13.0 as compared to version 2.12.2 when reading in simple CSV files.
>
> Suppose I read in a 2-column CSV file ("test.csv"), say 1, a 2, b
>
> If file is encoded as UTF-8 (on Windows 7), then under R 2.13.0

That file could be pure ASCII, or could include a byte order mark.  I tried both, and I didn't get the error your saw.  So I think I need to see the file to diagnose this.

Could you put it in a .zip file and email it to me?

Duncan Murdoch


> read.csv("test.csv",fileEncoding="UTF-8",header=FALSE) yields the following output
>    V1
> 1  ?
> Warning messages:
> 1: In read.table(file = file, header = header, sep = sep, quote = quote,  :
>    invalid input found on input connection 'test.csv'
> 2: In read.table(file = file, header = header, sep = sep, quote = quote,  :
>    incomplete final line found by readTableHeader on 'test.csv'
>
> Under R 2.12.2 it runs problem-free and yields the expected:
>    V1 V2
> 1  1  a
> 2  2  b
>
> Please help.
>
> Regards,
> Alex
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ligges at statistik.tu-dortmund.de  Mon Jun  6 18:15:42 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Mon, 06 Jun 2011 18:15:42 +0200
Subject: [Rd] Log file of building vignette in RCMD check
In-Reply-To: <1C56F3EE22DF4F458FE02F58B96D4150555EA9FD3B@DJFEXMBX01.djf.agrsci.dk>
References: <1C56F3EE22DF4F458FE02F58B96D4150555EA9FD3B@DJFEXMBX01.djf.agrsci.dk>
Message-ID: <4DECFD2E.2030800@statistik.tu-dortmund.de>



On 06.06.2011 15:30, Stefan McKinnon H?j-Edwards wrote:
> Hello,
>
> I am trying to run "RCMD check" on a package. It performs OK, with the exception of a single warning:
> * checking package vignettes in 'inst/doc' ... WARNING
> Package vignette(s) without corresponding PDF:
>     AnnotationFuncsUserguide.Rnw

R CMD build should build the vignettes. If it did not succeed, see its 
output for details.

Uwe Ligges



>
> As I understand the problem, the vignette is not built. However, I have no problems in doing so manually.
> How do I fix this problem? I cannot find any logs for building the vignette, however the output from building the pdf-file of the manual is found in the .Rcheck folder.
>
> On a similar note, as my vignette includes a biblio, I have to run "latex" twice to get the citations referenced properly with a number. Is this an issue? How can I work around it? (The package is submitted to BioC, so there might be other rules there?)
>
> Thank you in advanced.
> Yours sincerely,
>
> Stefan McKinnon H?j-Edwards     Dept. of Genetics and Biotechnology
> PhD student                     Faculty of Agricultural Sciences
> stefan.hoj-edwards at agrsci.dk    Aarhus University
> Tel.: +45 8999 1291             Blichers All? 20, Postboks 50
> Web: www.iysik.com              DK-8830 Tjele
>                                  Tel.: +45 8999 1900
>                                  Web: www.agrsci.au.dk
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jmc at r-project.org  Mon Jun  6 18:29:17 2011
From: jmc at r-project.org (John Chambers)
Date: Mon, 06 Jun 2011 09:29:17 -0700
Subject: [Rd] Bug or feature: using "ANY" as a generic field class (was:
 '[R] Is there a (virtual) class that all R objects inherit from?)
In-Reply-To: <4DECD5C1.7010903@ku-eichstaett.de>
References: <4DE8E777.7090008@googlemail.com> <4DE91638.3060503@r-project.org>
	<4DECD5C1.7010903@ku-eichstaett.de>
Message-ID: <4DED005D.4070401@r-project.org>

Should now behave as expected in r-devel and 2.13 patched, as of SVN 
56045, June 4.  (noted in the NEWS file.)


On 6/6/11 6:27 AM, Janko Thyson wrote:
> Thanks a lot for your reply and I'm sorry if I didn't make it quite
> clear what I expected, but you got it right:
>
> I'd simply like to see the same behavior for Reference Classes as for S4
> classes when extending classes with "ANY" fields as featured in the
> example below.
>
>  > setClass("A", representation(x="ANY"))
> [1] "A"
>  > setClass("B", contains="A", representation(x="character"))
> [1] "B"
>  > new("B", x = "abc")
> An object of class "B"
> Slot "x":
> [1] "abc"
>
> Thanks for addressing this!
>
> Regards,
> Janko
>
> On 03.06.2011 19:13, John Chambers wrote:
>> Well, your mail is unclear as to what you expected, but there is one
>> bug shown by your example.
>>
>> The behavior of S4 classes is sensible, at least as far as the example
>> shows:
>>
>>
>> > setClass("A", representation(x="ANY"))
>> [1] "A"
>> > setClass("B", contains="A", representation(x="character"))
>> [1] "B"
>> > new("B", x=1:3)
>> Error in validObject(.Object) :
>> invalid class "B" object: invalid object for slot "x" in class "B":
>> got class "integer", should be or extend class "character"
>>
>> You couldn't expect the new() call to work, as the error message
>> clearly explains. A legitimate call does work:
>>
>> > new("B", x = "abc")
>> An object of class "B"
>> Slot "x":
>> [1] "abc"
>>
>> The reference classes should work the same way, but don't, as your
>> example shows.
>>
>> A <- setRefClass(
>> + Class="A",
>> + fields=list(
>> + .PRIMARYDATA="ANY"
>> + ),
>> + contains=c("VIRTUAL")
>> + )
>> > B <- setRefClass(
>> + Class="B",
>> + fields=list(
>> + .PRIMARYDATA="character"
>> + ),
>> + contains=c("A")
>> + )
>> Error in `insertFields<-`(`*tmp*`, value = "character") :
>> The overriding class("character") of field ".PRIMARYDATA" is not a
>> subclass of the existing field definition ("ANY")
>>
>> We'll fix that. And, yes, "ANY" is intended as a universal superclass,
>> but is usually not mentioned explicitly.
>>
>>
>> On 6/3/11 6:53 AM, Janko Thyson wrote:
>>> Dear list,
>>>
>>> I was wondering if you could help me out in clarifying something:
>>> Is it possible to use class "ANY" in slots/fields of formal classes
>>> if you
>>> a) do not want to restrict valid classes of that field and
>>> b) if you are making explicit use of class inheritance?
>>>
>>> It seems to work in simple scenarios but produces errors when class
>>> inheritance comes into play. So I was wondering if that's a feature or a
>>> bug.
>>>
>>> If using "ANY" is not the right way, I'd appreciate a pointer to how you
>>> can to this.
>>>
>>> See previous post with an example below.
>>>
>>> Regards,
>>> Janko
>>>
>>> On 06/03/2011 01:53 AM, Janko Thyson wrote:
>>>> On 31.05.2011 18:17, Martin Morgan wrote:
>>>>> On 05/30/2011 07:02 AM, Janko Thyson wrote:
>>>>>> Dear list,
>>>>>>
>>>>>> I would like to set one specific Reference Class field to be of an
>>>>>> arbitrary class. Is there a class that all R objects inherit from? I
>>>>>> thought that "ANY" was something like this, but obviously that's not
>>>>>> true:
>>>>>>
>>>>>>> inherits(1:3, "ANY")
>>>>>> [1] FALSE
>>>>>
>>>>> I can't speak to the implementation, but ANY functions as a base class
>>>>> in terms of slot / field assignment and inheritance, e.g.,
>>>>>
>>>>> setClass("A", representation(x="ANY"))
>>>>> new("A", x=1:3)
>>>>>
>>>>> Martin
>>>>
>>>> Hi Martin,
>>>>
>>>> sorry for the late response. The way you do it works. Yet, when you
>>>> declare dependencies more explicitly (contains=XY), then R
>>>> complains. Is
>>>> this a feature or a bug (with respect to the "less explicit" way
>>>> working
>>>> just fine)? See the example below:
>>>>
>>>> # S4
>>>> setClass("A", representation(x="ANY"))
>>>> new("A", x=1:3)
>>>>
>>>> setClass("A", representation(x="ANY"))
>>>> setClass("B", contains="A", representation(x="character"))
>>>> new("B", x=1:3)
>>>>
>>>> # Reference Classes
>>>> setRefClass(
>>>> Class="A",
>>>> fields=list(
>>>> .PRIMARYDATA="ANY"
>>>> ),
>>>> contains=c("VIRTUAL")
>>>> )
>>>> B<- setRefClass(
>>>> Class="B",
>>>> fields=list(
>>>> .PRIMARYDATA="character"
>>>> ),
>>>> contains=c("A")
>>>> )
>>>
>>> Bug, I'd say. Martin
>>>
>>>>
>>>> Regards,
>>>> Janko
>>>>>>
>>>>>> Regards,
>>>>>> Janko
>>>>>>
>>>>>> [[alternative HTML version deleted]]
>>>>>>
>>>>>> ______________________________________________
>>>>>> R-help at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>>>>> PLEASE do read the posting guide
>>>>>> http://www.R-project.org/posting-guide.html
>>>>>> and provide commented, minimal, self-contained, reproducible code.
>>>>>
>>>>>
>>>
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
> --
> ------------------------------------------------------------------------
>
> *Janko Thyson*
> janko.thyson at ku-eichstaett.de <mailto:janko.thyson at ku-eichstaett.de>
>
> Catholic University of Eichst?tt-Ingolstadt
> Ingolstadt School of Management
> Statistics and Quantitative Methods
> Auf der Schanz 49
> D-85049 Ingolstadt
>
> www.wfi.edu/lsqm <http://www.wfi.edu/lsqm>
>
> Fon: +49 841 937-1923
> Fax: +49 841 937-1965
>
> This e-mail and any attachment is for authorized use by the intended
> recipient(s) only. It may contain proprietary material, confidential
> information and/or be subject to legal privilege. It should not be
> copied, disclosed to, retained or used by any other party.
> If you are not an intended recipient then please promptly delete this
> e-mail and any attachment and all copies and inform the sender.
>


From pdalgd at gmail.com  Mon Jun  6 18:29:36 2011
From: pdalgd at gmail.com (peter dalgaard)
Date: Mon, 6 Jun 2011 18:29:36 +0200
Subject: [Rd] Possible bug in termplot function (stats package) ?
In-Reply-To: <BANLkTikkDxdR_1+TJNX5LMkr23spvOJ4+A@mail.gmail.com>
References: <BANLkTikkDxdR_1+TJNX5LMkr23spvOJ4+A@mail.gmail.com>
Message-ID: <9B2E15B5-AE4F-4849-96D5-A5DE8896DC80@gmail.com>


On Jun 6, 2011, at 17:15 , Joris Meys wrote:

> Hi all,
> 
> I noticed some very odd behaviour in the termplot function of the
> stats package due to the following lines :
> 
> 18.    if (is.null(data))
> 19.       data <- eval(model$call$data, envir)
> 
> This one will look in the global environment, and renders the two
> lines after this
> 
> 20.   if (is.null(data))
> 21.        data <- mf
> 
> completely obsolete. If nothing is found, an error is returned. If
> anything is found, data won't be NULL, so line 20, when reached, will
> always return FALSE. Can it be that lines 18 and 19 should be removed
> from the function?


I think this is a false assumption. What keeps model$call$data from being NULL? 

No comments on the remainder, except that it wouldn't be the first time a wrapper function got into trouble with environments and modelling functions... 

> 
> This gives especially problems when called from other plot functions
> on models made with wrapper functions. One example :
> 
> Data <- data.frame(
> x1=rnorm(100),
> x2=rnorm(100,3,2),
> y=rnorm(100)
> )
> form <- as.formula(y~x1+x2)
> test <- lm(form, data=Data)
> termplot(test)
> 
> wrapper <- function(ff,x){
> tt <- lm(ff,data=x)
> }
> test2 <- wrapper(form,Data)
> termplot(test2)
> 
> For the non-smooth terms, termplot is called. In the first example,
> this works perfectly well. In the second example, it either returns "x
> not found" (when there is no x variable in the global) or "x2 not
> found" when there is an x variable.
> 
> If both lines mentioned earlier are erased from the function, it works
> as expected in this example code. Using the model frame seems the
> logic choice here, I have no clue why one would want to look in the
> global environment for the data related to a model.
> 
> Cheers
> Joris
> 
> -- 
> Joris Meys
> Statistical consultant
> 
> Ghent University
> Faculty of Bioscience Engineering
> Department of Applied mathematics, biometrics and process control
> 
> tel : +32 9 264 59 87
> Joris.Meys at Ugent.be
> -------------------------------
> Disclaimer : http://helpdesk.ugent.be/e-maildisclaimer.php
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From karl.forner at gmail.com  Mon Jun  6 18:34:48 2011
From: karl.forner at gmail.com (Karl Forner)
Date: Mon, 6 Jun 2011 18:34:48 +0200
Subject: [Rd] Fwd: Error in svg() : cairo-based devices are not supported on
 this build
In-Reply-To: <BANLkTi=AKHqS8yq+dWnG8U64fO31ZTvTQg@mail.gmail.com>
References: <BANLkTikOvmxNV_-oJ9kLqO5J-CN35dWN2A@mail.gmail.com>
	<7DA13B0C-B551-472A-9EB1-EE40A05E107D@r-project.org>
	<BANLkTinQNr1OOYC9vkpViHYjfcwtU1D7EQ@mail.gmail.com>
	<8BDD8E8E-1440-4886-8E87-98CBEAC07C04@r-project.org>
	<BANLkTi=AKHqS8yq+dWnG8U64fO31ZTvTQg@mail.gmail.com>
Message-ID: <BANLkTik6qvL-c59C0QQMua4V9RH9E6oGiw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110606/a0faa618/attachment.pl>

From janko.thyson.rstuff at googlemail.com  Mon Jun  6 18:35:52 2011
From: janko.thyson.rstuff at googlemail.com (Janko Thyson)
Date: Mon, 06 Jun 2011 18:35:52 +0200
Subject: [Rd] Bug or feature: using "ANY" as a generic field class
In-Reply-To: <4DED005D.4070401@r-project.org>
References: <4DE8E777.7090008@googlemail.com> <4DE91638.3060503@r-project.org>
	<4DECD5C1.7010903@ku-eichstaett.de>
	<4DED005D.4070401@r-project.org>
Message-ID: <4DED01E8.3020202@googlemail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110606/6c03873d/attachment.pl>

From janko.thyson.rstuff at googlemail.com  Mon Jun  6 18:48:49 2011
From: janko.thyson.rstuff at googlemail.com (Janko Thyson)
Date: Mon, 06 Jun 2011 18:48:49 +0200
Subject: [Rd] Reference Classes: shortcut like 'isS4' for Ref Classes?
Message-ID: <4DED04F1.9040200@googlemail.com>

Dear list,

is there a shortcut-function to check whether a class is a Reference 
Class or not? There's something like this for S4 classes 
('isS4(object)'), but I couldn't find anything regarding Ref Classes.

Currently, I'm doing it this way, which is a bit clumsy:

A <- setRefClass("A", fields=list(X="numeric"))
a <- A$new()

isRefClass <- function(object, ...){
     return(getClass(class(object))@class == "refClassRepresentation")
#    getRefClass(class(object))@class == "refObjectGenerator"
}

isRefClass(a)
[1] TRUE

Regards,
Janko


From ripley at stats.ox.ac.uk  Mon Jun  6 18:59:17 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 6 Jun 2011 17:59:17 +0100 (BST)
Subject: [Rd] Log file of building vignette in RCMD check
In-Reply-To: <4DECFD2E.2030800@statistik.tu-dortmund.de>
References: <1C56F3EE22DF4F458FE02F58B96D4150555EA9FD3B@DJFEXMBX01.djf.agrsci.dk>
	<4DECFD2E.2030800@statistik.tu-dortmund.de>
Message-ID: <alpine.LFD.2.02.1106061755400.15375@gannet.stats.ox.ac.uk>

On Mon, 6 Jun 2011, Uwe Ligges wrote:

>
>
> On 06.06.2011 15:30, Stefan McKinnon H?j-Edwards wrote:
>> Hello,
>> 
>> I am trying to run "RCMD check" on a package. It performs OK, with the 
>> exception of a single warning:
>> * checking package vignettes in 'inst/doc' ... WARNING
>> Package vignette(s) without corresponding PDF:
>>     AnnotationFuncsUserguide.Rnw
>
> R CMD build should build the vignettes. If it did not succeed, see its output 
> for details.

You can also use tools::buildVignettes to do it manually.  But R CMD 
check is reporting that you failed to do it at all: it is not the job 
of R CMD check and the PDF of the vignette should be in the 
tarball/directory you supply to be checked.

>
> Uwe Ligges
>
>
>
>> 
>> As I understand the problem, the vignette is not built. However, I have no 
>> problems in doing so manually.
>> How do I fix this problem? I cannot find any logs for building the 
>> vignette, however the output from building the pdf-file of the manual is 
>> found in the .Rcheck folder.
>> 
>> On a similar note, as my vignette includes a biblio, I have to run "latex" 
>> twice to get the citations referenced properly with a number. Is this an 
>> issue? How can I work around it? (The package is submitted to BioC, so 
>> there might be other rules there?)

It indicates that you failed to use the tools we provided, R CMD 
build, tools::buildVignettes() and tools::texi2dvi().

>> Thank you in advanced.
>> Yours sincerely,
>> 
>> Stefan McKinnon H?j-Edwards     Dept. of Genetics and Biotechnology
>> PhD student                     Faculty of Agricultural Sciences
>> stefan.hoj-edwards at agrsci.dk    Aarhus University
>> Tel.: +45 8999 1291             Blichers All? 20, Postboks 50
>> Web: www.iysik.com              DK-8830 Tjele
>>                                  Tel.: +45 8999 1900
>>                                  Web: www.agrsci.au.dk

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From jorismeys at gmail.com  Mon Jun  6 20:38:48 2011
From: jorismeys at gmail.com (Joris Meys)
Date: Mon, 6 Jun 2011 20:38:48 +0200
Subject: [Rd] Possible bug in termplot function (stats package) ?
In-Reply-To: <9B2E15B5-AE4F-4849-96D5-A5DE8896DC80@gmail.com>
References: <BANLkTikkDxdR_1+TJNX5LMkr23spvOJ4+A@mail.gmail.com>
	<9B2E15B5-AE4F-4849-96D5-A5DE8896DC80@gmail.com>
Message-ID: <BANLkTi=uHfZ62TSfLa-a+E-n9RU47_vS5A@mail.gmail.com>

On Mon, Jun 6, 2011 at 6:29 PM, peter dalgaard <pdalgd at gmail.com> wrote:
>
> On Jun 6, 2011, at 17:15 , Joris Meys wrote:
>
**snip**
>> If nothing is found, an error is returned. If
>> anything is found, data won't be NULL, so line 20, when reached, will
>> always return FALSE. Can it be that lines 18 and 19 should be removed
>> from the function?
>
>
> I think this is a false assumption. What keeps model$call$data from being NULL?
>
Apart from a dataframe that is explicitly assigned NULL, I can't
imagine a case where model$call$data would be NULL. If it's not found,
the statement returns an error. If it is found and it is NULL, your
model call will have thrown an error earlier, so you won't even have
an object to plot. If you can give me one example where that code
actually makes sense, I'll be very happy. But right now, it doesn't
make any sense at all to me.

> No comments on the remainder, except that it wouldn't be the first time a wrapper function got into trouble with environments and modelling functions...
>
My wrapper function returns a completely sound lm-object. Why wouldn't
I expect a function built to work on lm-objects to work on an
lm-object? At least the help files should note that the dataframe will
be sought in the calling environment, or it won't work on your fitted
objects.

Right now I have to do something like :

termplot.wrapper <- function(x,...){
    x$call$data <- NULL
    termplot(x)
}

which seems at least a tiny bit awkward...

Cheers
Joris


-- 
Joris Meys
Statistical consultant

Ghent University
Faculty of Bioscience Engineering
Department of Applied mathematics, biometrics and process control

tel : +32 9 264 59 87
Joris.Meys at Ugent.be
-------------------------------
Disclaimer : http://helpdesk.ugent.be/e-maildisclaimer.php


From pdalgd at gmail.com  Mon Jun  6 21:15:25 2011
From: pdalgd at gmail.com (peter dalgaard)
Date: Mon, 6 Jun 2011 21:15:25 +0200
Subject: [Rd] Possible bug in termplot function (stats package) ?
In-Reply-To: <BANLkTi=uHfZ62TSfLa-a+E-n9RU47_vS5A@mail.gmail.com>
References: <BANLkTikkDxdR_1+TJNX5LMkr23spvOJ4+A@mail.gmail.com>
	<9B2E15B5-AE4F-4849-96D5-A5DE8896DC80@gmail.com>
	<BANLkTi=uHfZ62TSfLa-a+E-n9RU47_vS5A@mail.gmail.com>
Message-ID: <94E402C0-10C7-4770-9AB0-B1E33A1779E1@gmail.com>


On Jun 6, 2011, at 20:38 , Joris Meys wrote:

> On Mon, Jun 6, 2011 at 6:29 PM, peter dalgaard <pdalgd at gmail.com> wrote:
>> 
>> On Jun 6, 2011, at 17:15 , Joris Meys wrote:
>> 
> **snip**
>>> If nothing is found, an error is returned. If
>>> anything is found, data won't be NULL, so line 20, when reached, will
>>> always return FALSE. Can it be that lines 18 and 19 should be removed
>>> from the function?
>> 
>> 
>> I think this is a false assumption. What keeps model$call$data from being NULL?
>> 
> Apart from a dataframe that is explicitly assigned NULL, I can't
> imagine a case where model$call$data would be NULL. If it's not found,
> the statement returns an error. If it is found and it is NULL, your
> model call will have thrown an error earlier, so you won't even have
> an object to plot. If you can give me one example where that code
> actually makes sense, I'll be very happy. But right now, it doesn't
> make any sense at all to me.

I'd say that the burden of proof is really on your side, but how hard can it be:

> x <- 1:10
> y <- rnorm(10)
> m <- lm(y~x)
> m$call
lm(formula = y ~ x)
> m$call$data
NULL


-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From jorismeys at gmail.com  Mon Jun  6 21:30:29 2011
From: jorismeys at gmail.com (Joris Meys)
Date: Mon, 6 Jun 2011 21:30:29 +0200
Subject: [Rd] Possible bug in termplot function (stats package) ?
In-Reply-To: <94E402C0-10C7-4770-9AB0-B1E33A1779E1@gmail.com>
References: <BANLkTikkDxdR_1+TJNX5LMkr23spvOJ4+A@mail.gmail.com>
	<9B2E15B5-AE4F-4849-96D5-A5DE8896DC80@gmail.com>
	<BANLkTi=uHfZ62TSfLa-a+E-n9RU47_vS5A@mail.gmail.com>
	<94E402C0-10C7-4770-9AB0-B1E33A1779E1@gmail.com>
Message-ID: <BANLkTi=3HyRwGXTEp2mTv=kZS-oy64ctTw@mail.gmail.com>

On Mon, Jun 6, 2011 at 9:15 PM, peter dalgaard <pdalgd at gmail.com> wrote:
>
> I'd say that the burden of proof is really on your side, but how hard can it be:
>
>> x <- 1:10
>> y <- rnorm(10)
>> m <- lm(y~x)
>> m$call
> lm(formula = y ~ x)
>> m$call$data
> NULL
>
I see... indeed, thx for the answer and sorry for my stupidity. Should
have thought about that case. Still, I wonder why it is necessary to
go look for the data in a calling environment if it should be
contained in the model frame of the fitted object. Or am I again wrong
in assuming that's always the case?

Cheers
Joris



-- 
Joris Meys
Statistical consultant

Ghent University
Faculty of Bioscience Engineering
Department of Applied mathematics, biometrics and process control

tel : +32 9 264 59 87
Joris.Meys at Ugent.be
-------------------------------
Disclaimer : http://helpdesk.ugent.be/e-maildisclaimer.php


From tlumley at uw.edu  Mon Jun  6 22:16:21 2011
From: tlumley at uw.edu (Thomas Lumley)
Date: Tue, 7 Jun 2011 08:16:21 +1200
Subject: [Rd] Possible bug in termplot function (stats package) ?
In-Reply-To: <BANLkTi=3HyRwGXTEp2mTv=kZS-oy64ctTw@mail.gmail.com>
References: <BANLkTikkDxdR_1+TJNX5LMkr23spvOJ4+A@mail.gmail.com>
	<9B2E15B5-AE4F-4849-96D5-A5DE8896DC80@gmail.com>
	<BANLkTi=uHfZ62TSfLa-a+E-n9RU47_vS5A@mail.gmail.com>
	<94E402C0-10C7-4770-9AB0-B1E33A1779E1@gmail.com>
	<BANLkTi=3HyRwGXTEp2mTv=kZS-oy64ctTw@mail.gmail.com>
Message-ID: <BANLkTin_-qZ8nmC2GCmKPa-HFC0XAd4Xuw@mail.gmail.com>

On Tue, Jun 7, 2011 at 7:30 AM, Joris Meys <jorismeys at gmail.com> wrote:
> On Mon, Jun 6, 2011 at 9:15 PM, peter dalgaard <pdalgd at gmail.com> wrote:
>>
>> I'd say that the burden of proof is really on your side, but how hard can it be:
>>
>>> x <- 1:10
>>> y <- rnorm(10)
>>> m <- lm(y~x)
>>> m$call
>> lm(formula = y ~ x)
>>> m$call$data
>> NULL
>>
> I see... indeed, thx for the answer and sorry for my stupidity. Should
> have thought about that case. Still, I wonder why it is necessary to
> go look for the data in a calling environment if it should be
> contained in the model frame of the fitted object. Or am I again wrong
> in assuming that's always the case?

You are again wrong.   Life would be much simpler if the data were
always available like that, but there are at least two problems.

1) There need not be a model frame in the fitted object. (it's optional)

2) More importantly, if you have y~sin(x), the model frame will
contain sin(x), not x. For what termplot() does, it has to be able to
reconstruct 'x', which isn't possible without the original data.

It's quite possible that termplot() could be rewritten to be simpler
and more general, but I don't think minor editing will do it.

    -thomas

-- 
Thomas Lumley
Professor of Biostatistics
University of Auckland


From jmc at r-project.org  Mon Jun  6 23:28:31 2011
From: jmc at r-project.org (John Chambers)
Date: Mon, 06 Jun 2011 14:28:31 -0700
Subject: [Rd] Overloading S4 methods
In-Reply-To: <BANLkTimCFhkqPq=3XowmiZVKDtwXhM4V3g@mail.gmail.com>
References: <BANLkTi=KwUzxy+3YA+HWmP-PPozD-g7zkg@mail.gmail.com>	<4DE6631A.9010104@fhcrc.org>
	<BANLkTimCFhkqPq=3XowmiZVKDtwXhM4V3g@mail.gmail.com>
Message-ID: <4DED467F.1080006@r-project.org>

This is a bug, medium-subtle, but also raises an interesting software 
design point.

The Bug:

Nothing specific about "ANY" and "missing", but the issue is whether the 
method was inherited (the "ANY" case) or defined directly (the "missing" 
case).

Generic functions keep a cached table of dispatched methods, to save 
determining inherited methods repeatedly for calls with the same 
signature.  When pkg B is loaded, the inherited methods are reset, but 
apparently the directly defined ones were not (but should have been if 
pkg B overrides the method).

It's interesting that this bug seems not to have been reported before, 
which leads to:

The Software Design Point:

When a package (B) extends the class/method software in another package 
(A), typically B adds new classes and perhaps new generic functions with 
methods for previous classes in A as well as classes in B.  It might 
also extend the behavior for classes in A to other generic functions.

What is less usual is to directly override an existing method for a 
class that belongs to A.  Notice that there can be side-effects, such as 
behavior of examples or tests in package A depending on whether B has 
been loaded or not.  And objects created entirely from A could have 
their computations change after B was loaded.

Nothing at all illegal here, and we'll make it work.  But a more 
predictable implementation for most applications would, say, define a 
new class in B that extended the class in A.  In your example (very 
helpful, by the way) one might have a class "mynumB", perhaps with the 
same slots as "mynum" but with modified behavior.

If you want to keep the current implementation, though, a workaround 
until the bug is fixed would be something like:

setMethod("plot", c("mynum", "missing"), getMethod("plot", c("mynum", 
"missing")))

executed after B is attached (I think it could be in the .onLoad 
function for B, but have not tested that).

John


On 6/6/11 4:11 AM, Iago Mosqueira wrote:
> On Wed, Jun 1, 2011 at 6:04 PM, Martin Morgan<mtmorgan at fhcrc.org>  wrote:
>> On 06/01/2011 04:39 AM, Iago Mosqueira wrote:
>>>
>>> Dear all,
>>>
>>> I am experiencing some problems with S4 method overloading. I have
>>> defined a generic for graphics:plot, using
>>>
>>> setGeneric("plot", useAsDefault = plot)
>>>
>>> and with
>>>
>>> importFrom('graphics', 'plot') and
>>>
>>> exportMethods('plot') in the NAMESPACE file of pkg A.
>>
>> I'd guess you were creating two generics (explicitly in pkgA, implicitly in
>> pkgB). Maybe
>>
>>   export(plot)
>>
>> in NAMESPACE of pkg A,
>>
>>   importFrom('pkgA', plot)
>>   exportMethods(plot)
>>
>> in pkg B. Feel free to post to the list if that's helpful.
>>
>> Martin
>>
>>>
>>> I then proceed to define a method for signature c('myS4class',
>>> 'missing'). This works as expected: selectMethod('plot',
>>> c('myS4class', 'missing')) returns the newly defined method, and the
>>> method gets called when invoked.
>>>
>>> Another pkg, B, wishes to overload this and redefines the method for
>>> the same signature. A method is defined for c('myS4class', 'missing'),
>>> and exported on the NAMESPACE. The new method is shown by
>>> selectMethod() after pkg B has been loaded, but a call to
>>>
>>> plot(anobjectofmyS4class)
>>>
>>> comes up with the result of running the first method, from pkg A. I
>>> have tried importing 'plot' in B's NAMESPACE from both graphics or A,
>>> but the end result is the same.
>>>
>>> Package B does the same thing for a method created by pkg A, myMethod,
>>> and that works fine.
>>>
>>> Any pointers or where this might be going wrong? How is it that a
>>> different method than the one shown by selectMethod() is being run?
>>> Something to do with the 'missing' part of the signature?
>>>
>>> Many thanks,
>>>
>>>
>>>
>>> Iago Mosqueira
>
> Dear all,
>
> I have tried Martin's suggestion, but the problem persists. It seems
> to be related to having 'missing' in the signature, as doing the same
> kind of overloading for c('myclass', 'ANY') work as expected.
>
> I am attaching 2 simple packages where I attempt this repeated
> overloading of plot for the same class. Script below, also found in
> Bpkg/tests.test.R, shows what I have encountered so far:
> plot('myclass', 'ANY') can be re-overloaded, but plot('myclass',
> 'missing') cannot in the same way. If I run
>
> trace("plot", browser, exit=browser, signature = c("mynum", "missing"))
>
> the  new method is actually called.
>
> Any hint on what I am doing wrong or where to look for an explanation
> will be much appreciated.
>
> Best regards,
>
>
> Iago Mosqueira
>
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jmc at r-project.org  Mon Jun  6 23:38:02 2011
From: jmc at r-project.org (John Chambers)
Date: Mon, 06 Jun 2011 14:38:02 -0700
Subject: [Rd] Reference Classes: shortcut like 'isS4' for Ref Classes?
In-Reply-To: <4DED04F1.9040200@googlemail.com>
References: <4DED04F1.9040200@googlemail.com>
Message-ID: <4DED48BA.9050707@r-project.org>

As it says on the help page ?ReferenceClasses:

All reference classes inherit from the class "envRefClass"

So,
   is(x, "envRefClass")

And, less well documented but less typing:

   is(x, "refClass")
also works.

On 6/6/11 9:48 AM, Janko Thyson wrote:
> Dear list,
>
> is there a shortcut-function to check whether a class is a Reference
> Class or not? There's something like this for S4 classes
> ('isS4(object)'), but I couldn't find anything regarding Ref Classes.
>
> Currently, I'm doing it this way, which is a bit clumsy:
>
> A <- setRefClass("A", fields=list(X="numeric"))
> a <- A$new()
>
> isRefClass <- function(object, ...){
> return(getClass(class(object))@class == "refClassRepresentation")
> # getRefClass(class(object))@class == "refObjectGenerator"
> }
>
> isRefClass(a)
> [1] TRUE
>
> Regards,
> Janko
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From iago.mosqueira at gmail.com  Tue Jun  7 09:42:19 2011
From: iago.mosqueira at gmail.com (Iago Mosqueira)
Date: Tue, 7 Jun 2011 09:42:19 +0200
Subject: [Rd] Overloading S4 methods
In-Reply-To: <4DED467F.1080006@r-project.org>
References: <BANLkTi=KwUzxy+3YA+HWmP-PPozD-g7zkg@mail.gmail.com>
	<4DE6631A.9010104@fhcrc.org>
	<BANLkTimCFhkqPq=3XowmiZVKDtwXhM4V3g@mail.gmail.com>
	<4DED467F.1080006@r-project.org>
Message-ID: <BANLkTi=RRJCCBvLjfVO62A=uG8R9wm-6Nw@mail.gmail.com>

On Mon, Jun 6, 2011 at 11:28 PM, John Chambers <jmc at r-project.org> wrote:
> This is a bug, medium-subtle, but also raises an interesting software design
> point.
>
> The Bug:
>
> Nothing specific about "ANY" and "missing", but the issue is whether the
> method was inherited (the "ANY" case) or defined directly (the "missing"
> case).
>
> Generic functions keep a cached table of dispatched methods, to save
> determining inherited methods repeatedly for calls with the same signature.
> ?When pkg B is loaded, the inherited methods are reset, but apparently the
> directly defined ones were not (but should have been if pkg B overrides the
> method).
>
> It's interesting that this bug seems not to have been reported before, which
> leads to:
>
> The Software Design Point:
>
> When a package (B) extends the class/method software in another package (A),
> typically B adds new classes and perhaps new generic functions with methods
> for previous classes in A as well as classes in B. ?It might also extend the
> behavior for classes in A to other generic functions.
>
> What is less usual is to directly override an existing method for a class
> that belongs to A. ?Notice that there can be side-effects, such as behavior
> of examples or tests in package A depending on whether B has been loaded or
> not. ?And objects created entirely from A could have their computations
> change after B was loaded.
>
> Nothing at all illegal here, and we'll make it work. ?But a more predictable
> implementation for most applications would, say, define a new class in B
> that extended the class in A. ?In your example (very helpful, by the way)
> one might have a class "mynumB", perhaps with the same slots as "mynum" but
> with modified behavior.
>
> If you want to keep the current implementation, though, a workaround until
> the bug is fixed would be something like:
>
> setMethod("plot", c("mynum", "missing"), getMethod("plot", c("mynum",
> "missing")))
>
> executed after B is attached (I think it could be in the .onLoad function
> for B, but have not tested that).
>
> John

Many thanks for the very complete explanation. We are using this
mechanism to provide ggplot2-based plot for some classes, to
substitute the initial lattice-based ones, so the effects are limited
to visual output and not results of computation, but it is good you
reminded me of the possible side effects of this strategy. Is maybe a
warning during R CMD check appropriate here?


Adding the call to setMethod(..., getMethod()) did not work if placed
inside .onLoad, and in fact had the effect of getMethod() now
returning the Apkg method after Bpkg was loaded.

Running the line after Bpkg has loaded did sort it out. What would
then be the best way of adding this command to the pkg loading
process? I have also tried adding it to a zzz.R file on iuts own but
that did not work, I still need to re-run it after loading has
finished.

Many thanks,


Iago

>
>
> On 6/6/11 4:11 AM, Iago Mosqueira wrote:
>>
>> On Wed, Jun 1, 2011 at 6:04 PM, Martin Morgan<mtmorgan at fhcrc.org> ?wrote:
>>>
>>> On 06/01/2011 04:39 AM, Iago Mosqueira wrote:
>>>>
>>>> Dear all,
>>>>
>>>> I am experiencing some problems with S4 method overloading. I have
>>>> defined a generic for graphics:plot, using
>>>>
>>>> setGeneric("plot", useAsDefault = plot)
>>>>
>>>> and with
>>>>
>>>> importFrom('graphics', 'plot') and
>>>>
>>>> exportMethods('plot') in the NAMESPACE file of pkg A.
>>>
>>> I'd guess you were creating two generics (explicitly in pkgA, implicitly
>>> in
>>> pkgB). Maybe
>>>
>>> ?export(plot)
>>>
>>> in NAMESPACE of pkg A,
>>>
>>> ?importFrom('pkgA', plot)
>>> ?exportMethods(plot)
>>>
>>> in pkg B. Feel free to post to the list if that's helpful.
>>>
>>> Martin
>>>
>>>>
>>>> I then proceed to define a method for signature c('myS4class',
>>>> 'missing'). This works as expected: selectMethod('plot',
>>>> c('myS4class', 'missing')) returns the newly defined method, and the
>>>> method gets called when invoked.
>>>>
>>>> Another pkg, B, wishes to overload this and redefines the method for
>>>> the same signature. A method is defined for c('myS4class', 'missing'),
>>>> and exported on the NAMESPACE. The new method is shown by
>>>> selectMethod() after pkg B has been loaded, but a call to
>>>>
>>>> plot(anobjectofmyS4class)
>>>>
>>>> comes up with the result of running the first method, from pkg A. I
>>>> have tried importing 'plot' in B's NAMESPACE from both graphics or A,
>>>> but the end result is the same.
>>>>
>>>> Package B does the same thing for a method created by pkg A, myMethod,
>>>> and that works fine.
>>>>
>>>> Any pointers or where this might be going wrong? How is it that a
>>>> different method than the one shown by selectMethod() is being run?
>>>> Something to do with the 'missing' part of the signature?
>>>>
>>>> Many thanks,
>>>>
>>>>
>>>>
>>>> Iago Mosqueira
>>
>> Dear all,
>>
>> I have tried Martin's suggestion, but the problem persists. It seems
>> to be related to having 'missing' in the signature, as doing the same
>> kind of overloading for c('myclass', 'ANY') work as expected.
>>
>> I am attaching 2 simple packages where I attempt this repeated
>> overloading of plot for the same class. Script below, also found in
>> Bpkg/tests.test.R, shows what I have encountered so far:
>> plot('myclass', 'ANY') can be re-overloaded, but plot('myclass',
>> 'missing') cannot in the same way. If I run
>>
>> trace("plot", browser, exit=browser, signature = c("mynum", "missing"))
>>
>> the ?new method is actually called.
>>
>> Any hint on what I am doing wrong or where to look for an explanation
>> will be much appreciated.
>>
>> Best regards,
>>
>>
>> Iago Mosqueira
>>
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From soeren.vogel at uzh.ch  Tue Jun  7 10:10:51 2011
From: soeren.vogel at uzh.ch (soeren.vogel at uzh.ch)
Date: Tue, 7 Jun 2011 10:10:51 +0200
Subject: [Rd] Interfacing a C++ class
In-Reply-To: <4DECBD38.3020105@r-enthusiasts.com>
References: <14F4FFAE-88F5-4C1E-A5BC-4F34E7ACD826@uzh.ch>
	<4DECBD38.3020105@r-enthusiasts.com>
Message-ID: <CE3ECCB8-D437-4527-9F23-7EFE73E7BECC@uzh.ch>

On 06.06.2011, at 13:42, Romain Francois wrote:

> Le 04/06/11 16:31, soeren.vogel at uzh.ch a ?crit :
> 
>> FOO is the C++ object, and Foo should be the S4 class. If the user creates an object, say bar, from class Foo, the creation process automatically makes a new FOO object relating to bar in that a unique name of the FOO instance is stored in a slot of bar. All the user then has to do is modify bar by simple assignments. The getters and setters ("$", "[") are set up and work. Each modification goes in hand with assigning new values to bar as well as updating the FOO object through available setters from FOO.
>> 
>> So far, this way has brought me to about 100 lines, but now I read about ReferenceClasses and was wondering, if there is a much easier way of achieving my goals. Moreover, I was not sure any longer if my goals make sense or if a more advanced programmer would do it totally different (and could share some structural thinking on their approach).
>> 
>> The idea behind my way of doing was based upon several considerations. First, a "classical" R object would not confuse users, as I assume users of my package to be rather non-skilled (and not willing to change that). Second, I want to create a properly programmed package for distribution on CRAN and publication, eventually. Third, I want to save objects across sessions. So if a user restores a session, a simple command, say, restore(), would do the trick to build all the related C++ objects again. However, I admit that I still have not figured out how to automatically clean up the workspace correctly before leaving a session, wanted or unwanted, that is, clean up memory before leaving home. Fourth, pure arithmetic check is done in C++, however, semantic check *should* be left to R, and the validity and class routines seem to be perfect for this. Fifth, some work should be done in R, such as the passing of data frames or samples from distributions.
> 
> Hello,
> 
> A C++ class that is exposed through an Rcpp module is already a reference class, and so you can add methods, etc ...
> 
> Consider this example :
> 
> require(inline)
> require(Rcpp)
> 
> fx <- cxxfunction( , '', includes = '
> 
> class FOO{
> public:
>    FOO( double x_, double y_): x(x_), y(y_){}
> 
>    double x ;
>    double y ;
> 
>    void move( double dx, double dy){
>        x += dx ;
>        y += dy ;
>    }
> } ;
> 
> RCPP_MODULE(mod){
> 
>    class_<FOO>("FOO" )
> 
>        .constructor<double,double>()
> 
>        .field( "x", &FOO::x )
>        .field( "y", &FOO::y )
> 
>        .method( "move", &FOO::move )
>        ;
> }
> 
> 
> ', plugin = "Rcpp" )
> mod <- Module( "mod", getDynLib(fx),mustStart = TRUE )
> 
> # grab the exposed C++ class
> FOO <- mod$FOO
> 
> # add R methods
> FOO$methods(
>    bla = function() x+y,
>    reset = function() {
>        x <<- 0.0
>        y <<- 0.0
>    }
> )
> # create an instance
> f <- new( FOO, 2.0, 3.0 )
> 
> # call an R method
> f$reset()
> 
> # call a C++ method
> f$move( 2.0, 2.0 )
> 
> # call an R method
> f$bla()

Thanks Simon and Romain for your great help! That C++ classes exposed via Rcpp-modules are already reference classes helps a lot and saves time for unnecessary mirroring. According to Romain saving class objects across sessions remains to be implemented in Rcpp. I have not browsed the rJava package extensively, but I found serialize() (base) and this function seems to provide a workaround. Yet, I do not know how to use it in practice with my package. Some thoughts: consider the small FOO example below. Then, on accidental crash or quit(save="yes"), or whatever users may do, R "should" know that it has to serialise all existing FOO objects. Note, that in my package these objects are "sort of lists" that can become quite large (say, a vector of 15,000 numeric values plus a character string). After restoring a previously saved image, R "should know" to load my package, and that in turn should deserialise every FOO object present in the image. Sounds like a not too complicated task, something like .dofirst()/.dolast() -- but that again exceeds my R and C++ programming skills, and I hope that you experts may share an idea. Thanks, S?ren


From hb at biostat.ucsf.edu  Tue Jun  7 10:19:39 2011
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Tue, 7 Jun 2011 04:19:39 -0400
Subject: [Rd] Cases of TAB-completion that hang Rterm
Message-ID: <BANLkTikY2OD5JL2DC0JoHCVsH4wBAWDMOg@mail.gmail.com>

FYI,

via a bug report of one of my packages, I discovered that the
following cases will hang Rterm when using TAB completion:

CASE #1:
Adding an empty default function for tail() causes Rterm on Windows to
hang if one press TAB at the prompt:

% Rterm -vanilla
> tail.default <- function(...) {}
> [PRESS TAB]
Error in specialOpLocs(text) :
  (list) object cannot be coerced to type 'double'

After this Rterm becomes completely unresponsive.  The same error
message will show up with Rgui, but R remains responsive.


CASE #2:
While troubleshooting the above, I discovered that if one does:

> debug(utils:::.guessTokenFromLine)
> [PRESS TAB]

or

> debug(utils:::.win32consoleCompletion)
> [PRESS TAB]

then Rterm hangs too (not Rgui).

This happens with R v2.13.0 patched (2011-05-30 r56020) and R v2.14.0
devel (2011-05-30 r56020) on Windows.

/Henrik


From guxiaobo1982 at gmail.com  Tue Jun  7 05:26:25 2011
From: guxiaobo1982 at gmail.com (Xiaobo Gu)
Date: Tue, 7 Jun 2011 11:26:25 +0800
Subject: [Rd] Does anybody successfully built latest R on AIX 5.3?
In-Reply-To: <BANLkTi=UUtL3rHRKKmQiPO5gUR+Tje9Yig@mail.gmail.com>
References: <BANLkTi=UUtL3rHRKKmQiPO5gUR+Tje9Yig@mail.gmail.com>
Message-ID: <BANLkTikMW4e9iDRNYD2LGO1308kPda0rcg@mail.gmail.com>

I am trying to install
http://www.oss4aix.org/download/RPMS/gcc/gcc-4.2.4-2.aix5.3.ppc.rpm

but it dependents on package info, which I can't find a version for
AIX 5.3, can anyone who success fully built R on AIX 5.3 share which
version of gcc and the related packages to use, and where to download
them,thanks, following are the error messages:

# rpm -i ./libgcc-4.2.4-2.aix5.3.ppc.rpm
package libgcc-4.2.4-2 is already installed
# rpm -i ./gcc-4.2.4-2.aix5.3.ppc.rpm
error: failed dependencies:
        info is needed by gcc-4.2.4-2
# rpm -i ./info-4.13a-2.aix5.1.ppc.rpm
error: ./info-4.13a-2.aix5.1.ppc.rpm does not appear to be a RPM package



On Sat, Jun 4, 2011 at 1:16 PM, Xiaobo Gu <guxiaobo1982 at gmail.com> wrote:
>
>


From oliver at first.in-berlin.de  Tue Jun  7 15:03:15 2011
From: oliver at first.in-berlin.de (oliver)
Date: Tue, 7 Jun 2011 15:03:15 +0200
Subject: [Rd] Packages for R-CRAN (organizing aspects)
Message-ID: <20110607130315.GA4434@siouxsie>

Hello,

I have some ideas for packages that I want to provide on R-CRAN.

One package alreads is working, but I have some warnings in
when compiling. Also I don't know if the libraries in use are only
working on Unix/Linux.

So I have some general questions:

  - If I'm not sure if the code would also work on windows
    (needing some ceratain libraries or tools),
    would it be better to mark it as Unix-like only?

    Would other people, who are interested in using the package
    on Windows, then look for the other issues?

    (I'm just interested in providing the functionality, and I don't use Windows,
     so compatibility would not be my main goal, if it's using certain libraries;
     but if the code is not relying on certain libs or tools I of course write
     code ANSI-conform, so that it *should* compile on windows too.)

    I mean: I just want to have the work for Unix/Linux, but in general like the
    platform-independent approach. I just have no interest, looking at the windows
    side too much. Are there people from R-CRAN team, who help at that point to make
    things available on many platforms?


  - I have in mind packages for reading a lot of different files / fileformat.
    How to name them?
    it would be consequent to name them
    read.<fileformat>
    but I'm not sure if this naming style is reserved for OO-methods only,
    and that topic I will learn later in detail, so that at the moment
    I just would provide the raw functionality.

    Maybe the name of the reading function should then better be named
    read<filefomat> or <fileformat>read ?

  - There are a lot of different fileformats that I want to read in.

    Would it be better to make for each format one different package,
    or rather put them all together as a package "Readmisc"?

    For example the following formats I have in mind:

      - jpeg (libjpeg62)                     => already working, I want to
                                                clean up the code and documentation
                                                soon and then provide on R-CRAN

      - bvh   (maybe (f)lex or yacc or pcre) => want to start this soon

      - apachelogfile /maybe using pcre)     => starting date not planned

      - some other formats also


  - Other package ideas: rolling application (which uses R's built in types,
    not like zoo() using special types)


Can you give me some general advice on how to organize this best,
so that it also fits into the R / R-CRAN philosophy?!


Ciao,
   Oliver


From oliver at first.in-berlin.de  Tue Jun  7 15:08:54 2011
From: oliver at first.in-berlin.de (oliver)
Date: Tue, 7 Jun 2011 15:08:54 +0200
Subject: [Rd] "warning: assignment discards qualifiers from pointer target
	type"
Message-ID: <20110607130854.GA4510@siouxsie>


Hello,

following an advice here from the list I looked into sources of other
packages (xts) and found the TYPEOF() macro/function, which really is
helpful.

I iused the follwong code snippet:


  switch( TYPEOF( filename_sexp ) )
  {
        case STRSXP: filename = CHAR( STRING_ELT(filename_sexp, 0) );
                     break;

        default:     error("filename argument must be a string");
                     break;
  }


Here, filename is of type char*
and one function opens a file with that name.
So it is purely intended to just grab out the char* from the
String-Expression.

Am I doing something wrong here, or is it ok, but I have somehow
to say the extracting macros/functions, that it is really intended
to throw away information and that a warning is not necessary?

Ciao,
   Oliver


From luke-tierney at uiowa.edu  Tue Jun  7 15:15:15 2011
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Tue, 7 Jun 2011 08:15:15 -0500
Subject: [Rd] Overloading S4 methods
In-Reply-To: <4DED467F.1080006@r-project.org>
References: <BANLkTi=KwUzxy+3YA+HWmP-PPozD-g7zkg@mail.gmail.com>
	<4DE6631A.9010104@fhcrc.org>
	<BANLkTimCFhkqPq=3XowmiZVKDtwXhM4V3g@mail.gmail.com>
	<4DED467F.1080006@r-project.org>
Message-ID: <alpine.DEB.2.00.1106070812100.1796@luke-inspiron>

On Mon, 6 Jun 2011, John Chambers wrote:

> This is a bug, medium-subtle, but also raises an interesting software design 
> point.
>
> The Bug:
>
> Nothing specific about "ANY" and "missing", but the issue is whether the 
> method was inherited (the "ANY" case) or defined directly (the "missing" 
> case).
>
> Generic functions keep a cached table of dispatched methods, to save 
> determining inherited methods repeatedly for calls with the same signature. 
> When pkg B is loaded, the inherited methods are reset, but apparently the 
> directly defined ones were not (but should have been if pkg B overrides the 
> method).
>
> It's interesting that this bug seems not to have been reported before, which 
> leads to:
>
> The Software Design Point:
>
> When a package (B) extends the class/method software in another package (A), 
> typically B adds new classes and perhaps new generic functions with methods 
> for previous classes in A as well as classes in B.  It might also extend the 
> behavior for classes in A to other generic functions.
>
> What is less usual is to directly override an existing method for a class 
> that belongs to A.  Notice that there can be side-effects, such as behavior 
> of examples or tests in package A depending on whether B has been loaded or 
> not.  And objects created entirely from A could have their computations 
> change after B was loaded.

Dylan is simliar in using a generic funciton model. One of the Dylan
books -- I forget which one -- strongly recomends that a library only
define a method if either it also defines the generic or if it defines
one of the classes the method is specialized on.  THis isn't an enforced
requirement but a strong recommendation.

Best,

luke

>
> Nothing at all illegal here, and we'll make it work.  But a more predictable 
> implementation for most applications would, say, define a new class in B that 
> extended the class in A.  In your example (very helpful, by the way) one 
> might have a class "mynumB", perhaps with the same slots as "mynum" but with 
> modified behavior.
>
> If you want to keep the current implementation, though, a workaround until 
> the bug is fixed would be something like:
>
> setMethod("plot", c("mynum", "missing"), getMethod("plot", c("mynum", 
> "missing")))
>
> executed after B is attached (I think it could be in the .onLoad function for 
> B, but have not tested that).
>
> John
>
>
> On 6/6/11 4:11 AM, Iago Mosqueira wrote:
>> On Wed, Jun 1, 2011 at 6:04 PM, Martin Morgan<mtmorgan at fhcrc.org>  wrote:
>>> On 06/01/2011 04:39 AM, Iago Mosqueira wrote:
>>>> 
>>>> Dear all,
>>>> 
>>>> I am experiencing some problems with S4 method overloading. I have
>>>> defined a generic for graphics:plot, using
>>>> 
>>>> setGeneric("plot", useAsDefault = plot)
>>>> 
>>>> and with
>>>> 
>>>> importFrom('graphics', 'plot') and
>>>> 
>>>> exportMethods('plot') in the NAMESPACE file of pkg A.
>>> 
>>> I'd guess you were creating two generics (explicitly in pkgA, implicitly 
>>> in
>>> pkgB). Maybe
>>>
>>>   export(plot)
>>> 
>>> in NAMESPACE of pkg A,
>>>
>>>   importFrom('pkgA', plot)
>>>   exportMethods(plot)
>>> 
>>> in pkg B. Feel free to post to the list if that's helpful.
>>> 
>>> Martin
>>> 
>>>> 
>>>> I then proceed to define a method for signature c('myS4class',
>>>> 'missing'). This works as expected: selectMethod('plot',
>>>> c('myS4class', 'missing')) returns the newly defined method, and the
>>>> method gets called when invoked.
>>>> 
>>>> Another pkg, B, wishes to overload this and redefines the method for
>>>> the same signature. A method is defined for c('myS4class', 'missing'),
>>>> and exported on the NAMESPACE. The new method is shown by
>>>> selectMethod() after pkg B has been loaded, but a call to
>>>> 
>>>> plot(anobjectofmyS4class)
>>>> 
>>>> comes up with the result of running the first method, from pkg A. I
>>>> have tried importing 'plot' in B's NAMESPACE from both graphics or A,
>>>> but the end result is the same.
>>>> 
>>>> Package B does the same thing for a method created by pkg A, myMethod,
>>>> and that works fine.
>>>> 
>>>> Any pointers or where this might be going wrong? How is it that a
>>>> different method than the one shown by selectMethod() is being run?
>>>> Something to do with the 'missing' part of the signature?
>>>> 
>>>> Many thanks,
>>>> 
>>>> 
>>>> 
>>>> Iago Mosqueira
>> 
>> Dear all,
>> 
>> I have tried Martin's suggestion, but the problem persists. It seems
>> to be related to having 'missing' in the signature, as doing the same
>> kind of overloading for c('myclass', 'ANY') work as expected.
>> 
>> I am attaching 2 simple packages where I attempt this repeated
>> overloading of plot for the same class. Script below, also found in
>> Bpkg/tests.test.R, shows what I have encountered so far:
>> plot('myclass', 'ANY') can be re-overloaded, but plot('myclass',
>> 'missing') cannot in the same way. If I run
>> 
>> trace("plot", browser, exit=browser, signature = c("mynum", "missing"))
>> 
>> the  new method is actually called.
>> 
>> Any hint on what I am doing wrong or where to look for an explanation
>> will be much appreciated.
>> 
>> Best regards,
>> 
>> 
>> Iago Mosqueira
>> 
>> 
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From ggrothendieck at gmail.com  Tue Jun  7 16:30:12 2011
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 7 Jun 2011 10:30:12 -0400
Subject: [Rd] Packages for R-CRAN (organizing aspects)
In-Reply-To: <20110607130315.GA4434@siouxsie>
References: <20110607130315.GA4434@siouxsie>
Message-ID: <BANLkTinyqqJ_vePukrN5jnNyw6dpXj6YEg@mail.gmail.com>

On Tue, Jun 7, 2011 at 9:03 AM, oliver <oliver at first.in-berlin.de> wrote:
> Hello,
>
> I have some ideas for packages that I want to provide on R-CRAN.
>
> One package alreads is working, but I have some warnings in
> when compiling. Also I don't know if the libraries in use are only
> working on Unix/Linux.
>
> So I have some general questions:
>
> ?- If I'm not sure if the code would also work on windows
> ? ?(needing some ceratain libraries or tools),
> ? ?would it be better to mark it as Unix-like only?
>
> ? ?Would other people, who are interested in using the package
> ? ?on Windows, then look for the other issues?
>
> ? ?(I'm just interested in providing the functionality, and I don't use Windows,
> ? ? so compatibility would not be my main goal, if it's using certain libraries;
> ? ? but if the code is not relying on certain libs or tools I of course write
> ? ? code ANSI-conform, so that it *should* compile on windows too.)
>
> ? ?I mean: I just want to have the work for Unix/Linux, but in general like the
> ? ?platform-independent approach. I just have no interest, looking at the windows
> ? ?side too much. Are there people from R-CRAN team, who help at that point to make
> ? ?things available on many platforms?
>
>
> ?- I have in mind packages for reading a lot of different files / fileformat.
> ? ?How to name them?
> ? ?it would be consequent to name them
> ? ?read.<fileformat>
> ? ?but I'm not sure if this naming style is reserved for OO-methods only,
> ? ?and that topic I will learn later in detail, so that at the moment
> ? ?I just would provide the raw functionality.
>
> ? ?Maybe the name of the reading function should then better be named
> ? ?read<filefomat> or <fileformat>read ?
>
> ?- There are a lot of different fileformats that I want to read in.
>
> ? ?Would it be better to make for each format one different package,
> ? ?or rather put them all together as a package "Readmisc"?
>
> ? ?For example the following formats I have in mind:
>
> ? ? ?- jpeg (libjpeg62) ? ? ? ? ? ? ? ? ? ? => already working, I want to
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?clean up the code and documentation
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?soon and then provide on R-CRAN
>

Note existence of read.jpeg in the rimage package, read.gif in the
caTools package and readPNG in the png package.

> ? ? ?- bvh ? (maybe (f)lex or yacc or pcre) => want to start this soon
>
> ? ? ?- apachelogfile /maybe using pcre) ? ? => starting date not planned
>
> ? ? ?- some other formats also
>
>
> ?- Other package ideas: rolling application (which uses R's built in types,
> ? ?not like zoo() using special types)

rollapply and related functions in the development version of zoo do
work with ordinary vectors and matrices:

> # install development version of zoo
> install.packages("zoo", repos = "http://r-forge.r-project.org")
>
> library(zoo)
> rollmean(1:10, 2)
[1] 1.5 2.5 3.5 4.5 5.5 6.5 7.5 8.5 9.5
> rollapply(1:10, 2, sum)
[1]  3  5  7  9 11 13 15 17 19
> rollmean(1:10, 2)
[1] 1.5 2.5 3.5 4.5 5.5 6.5 7.5 8.5 9.5
> rollapply(cbind(a = 1:10, b = 11:20), 3, sum)
      a  b
[1,]  6 36
[2,]  9 39
[3,] 12 42
[4,] 15 45
[5,] 18 48
[6,] 21 51
[7,] 24 54
[8,] 27 57


-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From murdoch.duncan at gmail.com  Tue Jun  7 16:36:54 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 07 Jun 2011 10:36:54 -0400
Subject: [Rd] "warning: assignment discards qualifiers from pointer
 target type"
In-Reply-To: <20110607130854.GA4510@siouxsie>
References: <20110607130854.GA4510@siouxsie>
Message-ID: <4DEE3786.5000800@gmail.com>

On 07/06/2011 9:08 AM, oliver wrote:
> Hello,
>
> following an advice here from the list I looked into sources of other
> packages (xts) and found the TYPEOF() macro/function, which really is
> helpful.
>
> I iused the follwong code snippet:
>
>
>    switch( TYPEOF( filename_sexp ) )
>    {
>          case STRSXP: filename = CHAR( STRING_ELT(filename_sexp, 0) );
>                       break;
>
>          default:     error("filename argument must be a string");
>                       break;
>    }
>
>
> Here, filename is of type char*
> and one function opens a file with that name.
> So it is purely intended to just grab out the char* from the
> String-Expression.
>
> Am I doing something wrong here, or is it ok, but I have somehow
> to say the extracting macros/functions, that it is really intended
> to throw away information and that a warning is not necessary?

The result of calling CHAR should be a "const char *".  You are not 
allowed to touch the string it points to.

Duncan Murdoch


From janko.thyson.rstuff at googlemail.com  Tue Jun  7 16:56:40 2011
From: janko.thyson.rstuff at googlemail.com (Janko Thyson)
Date: Tue, 07 Jun 2011 16:56:40 +0200
Subject: [Rd] Reference Classes: shortcut like 'isS4' for Ref Classes?
In-Reply-To: <4DED48BA.9050707@r-project.org>
References: <4DED04F1.9040200@googlemail.com> <4DED48BA.9050707@r-project.org>
Message-ID: <4DEE3C28.4070403@googlemail.com>

Thanks for the answer! Sorry, must have missed that part of the help 
page. Your second approach is exactly what I was looking for.

Regards,
Janko

On 06.06.2011 23:38, John Chambers wrote:
> As it says on the help page ?ReferenceClasses:
>
> All reference classes inherit from the class "envRefClass"
>
> So,
>   is(x, "envRefClass")
>
> And, less well documented but less typing:
>
>   is(x, "refClass")
> also works.
>
> On 6/6/11 9:48 AM, Janko Thyson wrote:
>> Dear list,
>>
>> is there a shortcut-function to check whether a class is a Reference
>> Class or not? There's something like this for S4 classes
>> ('isS4(object)'), but I couldn't find anything regarding Ref Classes.
>>
>> Currently, I'm doing it this way, which is a bit clumsy:
>>
>> A <- setRefClass("A", fields=list(X="numeric"))
>> a <- A$new()
>>
>> isRefClass <- function(object, ...){
>> return(getClass(class(object))@class == "refClassRepresentation")
>> # getRefClass(class(object))@class == "refObjectGenerator"
>> }
>>
>> isRefClass(a)
>> [1] TRUE
>>
>> Regards,
>> Janko
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From oliver at first.in-berlin.de  Tue Jun  7 18:00:25 2011
From: oliver at first.in-berlin.de (oliver)
Date: Tue, 7 Jun 2011 18:00:25 +0200
Subject: [Rd] Packages for R-CRAN (organizing aspects)
In-Reply-To: <BANLkTinyqqJ_vePukrN5jnNyw6dpXj6YEg@mail.gmail.com>
References: <20110607130315.GA4434@siouxsie>
	<BANLkTinyqqJ_vePukrN5jnNyw6dpXj6YEg@mail.gmail.com>
Message-ID: <20110607160025.GA2007@siouxsie>

On Tue, Jun 07, 2011 at 10:30:12AM -0400, Gabor Grothendieck wrote:
> On Tue, Jun 7, 2011 at 9:03 AM, oliver <oliver at first.in-berlin.de> wrote:
> > Hello,
> >
> > I have some ideas for packages that I want to provide on R-CRAN.
> >
> > One package alreads is working, but I have some warnings in
> > when compiling. Also I don't know if the libraries in use are only
> > working on Unix/Linux.
> >
> > So I have some general questions:
> >
> > ?- If I'm not sure if the code would also work on windows
> > ? ?(needing some ceratain libraries or tools),
> > ? ?would it be better to mark it as Unix-like only?
> >
> > ? ?Would other people, who are interested in using the package
> > ? ?on Windows, then look for the other issues?
> >
> > ? ?(I'm just interested in providing the functionality, and I don't use Windows,
> > ? ? so compatibility would not be my main goal, if it's using certain libraries;
> > ? ? but if the code is not relying on certain libs or tools I of course write
> > ? ? code ANSI-conform, so that it *should* compile on windows too.)
> >
> > ? ?I mean: I just want to have the work for Unix/Linux, but in general like the
> > ? ?platform-independent approach. I just have no interest, looking at the windows
> > ? ?side too much. Are there people from R-CRAN team, who help at that point to make
> > ? ?things available on many platforms?
> >
> >
> > ?- I have in mind packages for reading a lot of different files / fileformat.
> > ? ?How to name them?
> > ? ?it would be consequent to name them
> > ? ?read.<fileformat>
> > ? ?but I'm not sure if this naming style is reserved for OO-methods only,
> > ? ?and that topic I will learn later in detail, so that at the moment
> > ? ?I just would provide the raw functionality.
> >
> > ? ?Maybe the name of the reading function should then better be named
> > ? ?read<filefomat> or <fileformat>read ?
> >
> > ?- There are a lot of different fileformats that I want to read in.
> >
> > ? ?Would it be better to make for each format one different package,
> > ? ?or rather put them all together as a package "Readmisc"?
> >
> > ? ?For example the following formats I have in mind:
> >
> > ? ? ?- jpeg (libjpeg62) ? ? ? ? ? ? ? ? ? ? => already working, I want to
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?clean up the code and documentation
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?soon and then provide on R-CRAN
> >
> 
> Note existence of read.jpeg in the rimage package, read.gif in the
> caTools package and readPNG in the png package.

read.jpeg in rimage does not give me a matrix like I would extpect in R,
for further working with the data.
It gives me an imagmatrix, which's value I can't access directly.
I only have a data structure that is closed to the functionality that the
rimage module provides.

Maybe I have overseen something,
but how would I plot a histogram
of R, G and B values and the according
grayvalue's histogram?

With my libjpeg reader it would be:

      library(libjpeg)
      pic <- readjpeg( picfilename )
      par(mfrof=c(4,1))
      hist( pic$r, breaks = 256, col="red")
      hist( pic$g, breaks = 256, col="green")
      hist( pic$b, breaks = 256, col="blue")
      hist( pic$bw, breaks = 256)

How would that be possible with rimage?


read.gif in caTools is giving back a matrix, and hence it's a fine function.
caTools btw. offers a lot of very interesting functions. :-)

readPNG of png package is agood hint,
I didn't knew that.


> 
> > ? ? ?- bvh ? (maybe (f)lex or yacc or pcre) => want to start this soon
> >
> > ? ? ?- apachelogfile /maybe using pcre) ? ? => starting date not planned
> >
> > ? ? ?- some other formats also
> >
> >
> > ?- Other package ideas: rolling application (which uses R's built in types,
> > ? ?not like zoo() using special types)
> 
> rollapply and related functions in the development version of zoo do
> work with ordinary vectors and matrices:

Ah the it's a new feature, which is not offered in the packages I can install
with install.packages and the default settings for this.

I had to use as.zoo() around my data to use rollapply from zoo-package.



> # install development version of zoo
> install.packages("zoo", repos = "http://r-forge.r-project.org")


Aha.
OK, thanks.

What about the documentation.
if I look for it on r-cran, but the module is form r-forge there will
be a mismatch.




> >
> > library(zoo)
> > rollmean(1:10, 2)
> [1] 1.5 2.5 3.5 4.5 5.5 6.5 7.5 8.5 9.5
> > rollapply(1:10, 2, sum)
> [1]  3  5  7  9 11 13 15 17 19
> > rollmean(1:10, 2)
> [1] 1.5 2.5 3.5 4.5 5.5 6.5 7.5 8.5 9.5
> > rollapply(cbind(a = 1:10, b = 11:20), 3, sum)

Yes, with that version it works. :-)


Ciao,
   Oliver


From ggrothendieck at gmail.com  Tue Jun  7 18:10:47 2011
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 7 Jun 2011 12:10:47 -0400
Subject: [Rd] Packages for R-CRAN (organizing aspects)
In-Reply-To: <20110607160025.GA2007@siouxsie>
References: <20110607130315.GA4434@siouxsie>
	<BANLkTinyqqJ_vePukrN5jnNyw6dpXj6YEg@mail.gmail.com>
	<20110607160025.GA2007@siouxsie>
Message-ID: <BANLkTik8NBPvHvynzvYHz8yvQKHbjbFTQA@mail.gmail.com>

On Tue, Jun 7, 2011 at 12:00 PM, oliver <oliver at first.in-berlin.de> wrote:
>
> What about the documentation.
> if I look for it on r-cran, but the module is form r-forge there will
> be a mismatch.

?, vignette(...) and library(help=...) will give help that corresponds
to the package you installed.

-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From jmc at r-project.org  Tue Jun  7 19:06:03 2011
From: jmc at r-project.org (John Chambers)
Date: Tue, 07 Jun 2011 10:06:03 -0700
Subject: [Rd] Overloading S4 methods
In-Reply-To: <alpine.DEB.2.00.1106070812100.1796@luke-inspiron>
References: <BANLkTi=KwUzxy+3YA+HWmP-PPozD-g7zkg@mail.gmail.com>
	<4DE6631A.9010104@fhcrc.org>
	<BANLkTimCFhkqPq=3XowmiZVKDtwXhM4V3g@mail.gmail.com>
	<4DED467F.1080006@r-project.org>
	<alpine.DEB.2.00.1106070812100.1796@luke-inspiron>
Message-ID: <4DEE5A7B.8030903@r-project.org>

Yes, Dylan is in many ways more authoritarian than R!  Possibly also 
with fewer users to be annoyed.

We might go to a warning as Iago suggests.  If we did add a warning, it 
would be likely be more useful in the setMethod() call than at CMD check 
time, after the package has been designed and implemented.

John

On 6/7/11 6:15 AM, luke-tierney at uiowa.edu wrote:
> On Mon, 6 Jun 2011, John Chambers wrote:
>
>> This is a bug, medium-subtle, but also raises an interesting software
>> design point.
>>
>> The Bug:
>>
>> Nothing specific about "ANY" and "missing", but the issue is whether
>> the method was inherited (the "ANY" case) or defined directly (the
>> "missing" case).
>>
>> Generic functions keep a cached table of dispatched methods, to save
>> determining inherited methods repeatedly for calls with the same
>> signature. When pkg B is loaded, the inherited methods are reset, but
>> apparently the directly defined ones were not (but should have been if
>> pkg B overrides the method).
>>
>> It's interesting that this bug seems not to have been reported before,
>> which leads to:
>>
>> The Software Design Point:
>>
>> When a package (B) extends the class/method software in another
>> package (A), typically B adds new classes and perhaps new generic
>> functions with methods for previous classes in A as well as classes in
>> B. It might also extend the behavior for classes in A to other generic
>> functions.
>>
>> What is less usual is to directly override an existing method for a
>> class that belongs to A. Notice that there can be side-effects, such
>> as behavior of examples or tests in package A depending on whether B
>> has been loaded or not. And objects created entirely from A could have
>> their computations change after B was loaded.
>
> Dylan is simliar in using a generic funciton model. One of the Dylan
> books -- I forget which one -- strongly recomends that a library only
> define a method if either it also defines the generic or if it defines
> one of the classes the method is specialized on. THis isn't an enforced
> requirement but a strong recommendation.
>
> Best,
>
> luke
>
>>
>> Nothing at all illegal here, and we'll make it work. But a more
>> predictable implementation for most applications would, say, define a
>> new class in B that extended the class in A. In your example (very
>> helpful, by the way) one might have a class "mynumB", perhaps with the
>> same slots as "mynum" but with modified behavior.
>>
>> If you want to keep the current implementation, though, a workaround
>> until the bug is fixed would be something like:
>>
>> setMethod("plot", c("mynum", "missing"), getMethod("plot", c("mynum",
>> "missing")))
>>
>> executed after B is attached (I think it could be in the .onLoad
>> function for B, but have not tested that).
>>
>> John
>>
>>
>> On 6/6/11 4:11 AM, Iago Mosqueira wrote:
>>> On Wed, Jun 1, 2011 at 6:04 PM, Martin Morgan<mtmorgan at fhcrc.org> wrote:
>>>> On 06/01/2011 04:39 AM, Iago Mosqueira wrote:
>>>>>
>>>>> Dear all,
>>>>>
>>>>> I am experiencing some problems with S4 method overloading. I have
>>>>> defined a generic for graphics:plot, using
>>>>>
>>>>> setGeneric("plot", useAsDefault = plot)
>>>>>
>>>>> and with
>>>>>
>>>>> importFrom('graphics', 'plot') and
>>>>>
>>>>> exportMethods('plot') in the NAMESPACE file of pkg A.
>>>>
>>>> I'd guess you were creating two generics (explicitly in pkgA,
>>>> implicitly in
>>>> pkgB). Maybe
>>>>
>>>> export(plot)
>>>>
>>>> in NAMESPACE of pkg A,
>>>>
>>>> importFrom('pkgA', plot)
>>>> exportMethods(plot)
>>>>
>>>> in pkg B. Feel free to post to the list if that's helpful.
>>>>
>>>> Martin
>>>>
>>>>>
>>>>> I then proceed to define a method for signature c('myS4class',
>>>>> 'missing'). This works as expected: selectMethod('plot',
>>>>> c('myS4class', 'missing')) returns the newly defined method, and the
>>>>> method gets called when invoked.
>>>>>
>>>>> Another pkg, B, wishes to overload this and redefines the method for
>>>>> the same signature. A method is defined for c('myS4class', 'missing'),
>>>>> and exported on the NAMESPACE. The new method is shown by
>>>>> selectMethod() after pkg B has been loaded, but a call to
>>>>>
>>>>> plot(anobjectofmyS4class)
>>>>>
>>>>> comes up with the result of running the first method, from pkg A. I
>>>>> have tried importing 'plot' in B's NAMESPACE from both graphics or A,
>>>>> but the end result is the same.
>>>>>
>>>>> Package B does the same thing for a method created by pkg A, myMethod,
>>>>> and that works fine.
>>>>>
>>>>> Any pointers or where this might be going wrong? How is it that a
>>>>> different method than the one shown by selectMethod() is being run?
>>>>> Something to do with the 'missing' part of the signature?
>>>>>
>>>>> Many thanks,
>>>>>
>>>>>
>>>>>
>>>>> Iago Mosqueira
>>>
>>> Dear all,
>>>
>>> I have tried Martin's suggestion, but the problem persists. It seems
>>> to be related to having 'missing' in the signature, as doing the same
>>> kind of overloading for c('myclass', 'ANY') work as expected.
>>>
>>> I am attaching 2 simple packages where I attempt this repeated
>>> overloading of plot for the same class. Script below, also found in
>>> Bpkg/tests.test.R, shows what I have encountered so far:
>>> plot('myclass', 'ANY') can be re-overloaded, but plot('myclass',
>>> 'missing') cannot in the same way. If I run
>>>
>>> trace("plot", browser, exit=browser, signature = c("mynum", "missing"))
>>>
>>> the new method is actually called.
>>>
>>> Any hint on what I am doing wrong or where to look for an explanation
>>> will be much appreciated.
>>>
>>> Best regards,
>>>
>>>
>>> Iago Mosqueira
>>>
>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From luke-tierney at uiowa.edu  Tue Jun  7 19:36:42 2011
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Tue, 7 Jun 2011 12:36:42 -0500
Subject: [Rd] Overloading S4 methods
In-Reply-To: <4DEE5A7B.8030903@r-project.org>
References: <BANLkTi=KwUzxy+3YA+HWmP-PPozD-g7zkg@mail.gmail.com>
	<4DE6631A.9010104@fhcrc.org>
	<BANLkTimCFhkqPq=3XowmiZVKDtwXhM4V3g@mail.gmail.com>
	<4DED467F.1080006@r-project.org>
	<alpine.DEB.2.00.1106070812100.1796@luke-inspiron>
	<4DEE5A7B.8030903@r-project.org>
Message-ID: <alpine.DEB.2.00.1106071231360.1796@luke-inspiron>

On Tue, 7 Jun 2011, John Chambers wrote:

> Yes, Dylan is in many ways more authoritarian than R!  Possibly also with 
> fewer users to be annoyed.

Huh? A convention in a programming book is more authoritarian than a
warning as you are proposing (not that I am opposed to that -- I think
it's probably idea)?

Number of users of Dylan is definitely smaller, especially now, but
level of academic-level CS involvement in language design is
not. There is a lot of work in that literature that really is worth
looking at.

Best,

luke

> We might go to a warning as Iago suggests.  If we did add a warning, it would 
> be likely be more useful in the setMethod() call than at CMD check time, 
> after the package has been designed and implemented.
>
> John
>
> On 6/7/11 6:15 AM, luke-tierney at uiowa.edu wrote:
>> On Mon, 6 Jun 2011, John Chambers wrote:
>> 
>>> This is a bug, medium-subtle, but also raises an interesting software
>>> design point.
>>> 
>>> The Bug:
>>> 
>>> Nothing specific about "ANY" and "missing", but the issue is whether
>>> the method was inherited (the "ANY" case) or defined directly (the
>>> "missing" case).
>>> 
>>> Generic functions keep a cached table of dispatched methods, to save
>>> determining inherited methods repeatedly for calls with the same
>>> signature. When pkg B is loaded, the inherited methods are reset, but
>>> apparently the directly defined ones were not (but should have been if
>>> pkg B overrides the method).
>>> 
>>> It's interesting that this bug seems not to have been reported before,
>>> which leads to:
>>> 
>>> The Software Design Point:
>>> 
>>> When a package (B) extends the class/method software in another
>>> package (A), typically B adds new classes and perhaps new generic
>>> functions with methods for previous classes in A as well as classes in
>>> B. It might also extend the behavior for classes in A to other generic
>>> functions.
>>> 
>>> What is less usual is to directly override an existing method for a
>>> class that belongs to A. Notice that there can be side-effects, such
>>> as behavior of examples or tests in package A depending on whether B
>>> has been loaded or not. And objects created entirely from A could have
>>> their computations change after B was loaded.
>> 
>> Dylan is simliar in using a generic funciton model. One of the Dylan
>> books -- I forget which one -- strongly recomends that a library only
>> define a method if either it also defines the generic or if it defines
>> one of the classes the method is specialized on. THis isn't an enforced
>> requirement but a strong recommendation.
>> 
>> Best,
>> 
>> luke
>> 
>>> 
>>> Nothing at all illegal here, and we'll make it work. But a more
>>> predictable implementation for most applications would, say, define a
>>> new class in B that extended the class in A. In your example (very
>>> helpful, by the way) one might have a class "mynumB", perhaps with the
>>> same slots as "mynum" but with modified behavior.
>>> 
>>> If you want to keep the current implementation, though, a workaround
>>> until the bug is fixed would be something like:
>>> 
>>> setMethod("plot", c("mynum", "missing"), getMethod("plot", c("mynum",
>>> "missing")))
>>> 
>>> executed after B is attached (I think it could be in the .onLoad
>>> function for B, but have not tested that).
>>> 
>>> John
>>> 
>>> 
>>> On 6/6/11 4:11 AM, Iago Mosqueira wrote:
>>>> On Wed, Jun 1, 2011 at 6:04 PM, Martin Morgan<mtmorgan at fhcrc.org> wrote:
>>>>> On 06/01/2011 04:39 AM, Iago Mosqueira wrote:
>>>>>> 
>>>>>> Dear all,
>>>>>> 
>>>>>> I am experiencing some problems with S4 method overloading. I have
>>>>>> defined a generic for graphics:plot, using
>>>>>> 
>>>>>> setGeneric("plot", useAsDefault = plot)
>>>>>> 
>>>>>> and with
>>>>>> 
>>>>>> importFrom('graphics', 'plot') and
>>>>>> 
>>>>>> exportMethods('plot') in the NAMESPACE file of pkg A.
>>>>> 
>>>>> I'd guess you were creating two generics (explicitly in pkgA,
>>>>> implicitly in
>>>>> pkgB). Maybe
>>>>> 
>>>>> export(plot)
>>>>> 
>>>>> in NAMESPACE of pkg A,
>>>>> 
>>>>> importFrom('pkgA', plot)
>>>>> exportMethods(plot)
>>>>> 
>>>>> in pkg B. Feel free to post to the list if that's helpful.
>>>>> 
>>>>> Martin
>>>>> 
>>>>>> 
>>>>>> I then proceed to define a method for signature c('myS4class',
>>>>>> 'missing'). This works as expected: selectMethod('plot',
>>>>>> c('myS4class', 'missing')) returns the newly defined method, and the
>>>>>> method gets called when invoked.
>>>>>> 
>>>>>> Another pkg, B, wishes to overload this and redefines the method for
>>>>>> the same signature. A method is defined for c('myS4class', 'missing'),
>>>>>> and exported on the NAMESPACE. The new method is shown by
>>>>>> selectMethod() after pkg B has been loaded, but a call to
>>>>>> 
>>>>>> plot(anobjectofmyS4class)
>>>>>> 
>>>>>> comes up with the result of running the first method, from pkg A. I
>>>>>> have tried importing 'plot' in B's NAMESPACE from both graphics or A,
>>>>>> but the end result is the same.
>>>>>> 
>>>>>> Package B does the same thing for a method created by pkg A, myMethod,
>>>>>> and that works fine.
>>>>>> 
>>>>>> Any pointers or where this might be going wrong? How is it that a
>>>>>> different method than the one shown by selectMethod() is being run?
>>>>>> Something to do with the 'missing' part of the signature?
>>>>>> 
>>>>>> Many thanks,
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> Iago Mosqueira
>>>> 
>>>> Dear all,
>>>> 
>>>> I have tried Martin's suggestion, but the problem persists. It seems
>>>> to be related to having 'missing' in the signature, as doing the same
>>>> kind of overloading for c('myclass', 'ANY') work as expected.
>>>> 
>>>> I am attaching 2 simple packages where I attempt this repeated
>>>> overloading of plot for the same class. Script below, also found in
>>>> Bpkg/tests.test.R, shows what I have encountered so far:
>>>> plot('myclass', 'ANY') can be re-overloaded, but plot('myclass',
>>>> 'missing') cannot in the same way. If I run
>>>> 
>>>> trace("plot", browser, exit=browser, signature = c("mynum", "missing"))
>>>> 
>>>> the new method is actually called.
>>>> 
>>>> Any hint on what I am doing wrong or where to look for an explanation
>>>> will be much appreciated.
>>>> 
>>>> Best regards,
>>>> 
>>>> 
>>>> Iago Mosqueira
>>>> 
>>>> 
>>>> 
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>> 
>

-- 
Luke Tierney
Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From iago.mosqueira at gmail.com  Tue Jun  7 23:02:56 2011
From: iago.mosqueira at gmail.com (Iago Mosqueira)
Date: Tue, 7 Jun 2011 23:02:56 +0200
Subject: [Rd] Overloading S4 methods
In-Reply-To: <4DEE5A7B.8030903@r-project.org>
References: <BANLkTi=KwUzxy+3YA+HWmP-PPozD-g7zkg@mail.gmail.com>
	<4DE6631A.9010104@fhcrc.org>
	<BANLkTimCFhkqPq=3XowmiZVKDtwXhM4V3g@mail.gmail.com>
	<4DED467F.1080006@r-project.org>
	<alpine.DEB.2.00.1106070812100.1796@luke-inspiron>
	<4DEE5A7B.8030903@r-project.org>
Message-ID: <BANLkTi=EZozootp3Jc7EirNFxqm=wFpFSg@mail.gmail.com>

Can then the warning be turned off in any way to avoid it showing up
on check? Maybe an argument to confirm 'I know what I am doing so I
need no warning, thank you very much'.


Iago

On Tue, Jun 7, 2011 at 7:06 PM, John Chambers <jmc at r-project.org> wrote:
> Yes, Dylan is in many ways more authoritarian than R! ?Possibly also with
> fewer users to be annoyed.
>
> We might go to a warning as Iago suggests. ?If we did add a warning, it
> would be likely be more useful in the setMethod() call than at CMD check
> time, after the package has been designed and implemented.
>
> John
>
> On 6/7/11 6:15 AM, luke-tierney at uiowa.edu wrote:
>>
>> On Mon, 6 Jun 2011, John Chambers wrote:
>>
>>> This is a bug, medium-subtle, but also raises an interesting software
>>> design point.
>>>
>>> The Bug:
>>>
>>> Nothing specific about "ANY" and "missing", but the issue is whether
>>> the method was inherited (the "ANY" case) or defined directly (the
>>> "missing" case).
>>>
>>> Generic functions keep a cached table of dispatched methods, to save
>>> determining inherited methods repeatedly for calls with the same
>>> signature. When pkg B is loaded, the inherited methods are reset, but
>>> apparently the directly defined ones were not (but should have been if
>>> pkg B overrides the method).
>>>
>>> It's interesting that this bug seems not to have been reported before,
>>> which leads to:
>>>
>>> The Software Design Point:
>>>
>>> When a package (B) extends the class/method software in another
>>> package (A), typically B adds new classes and perhaps new generic
>>> functions with methods for previous classes in A as well as classes in
>>> B. It might also extend the behavior for classes in A to other generic
>>> functions.
>>>
>>> What is less usual is to directly override an existing method for a
>>> class that belongs to A. Notice that there can be side-effects, such
>>> as behavior of examples or tests in package A depending on whether B
>>> has been loaded or not. And objects created entirely from A could have
>>> their computations change after B was loaded.
>>
>> Dylan is simliar in using a generic funciton model. One of the Dylan
>> books -- I forget which one -- strongly recomends that a library only
>> define a method if either it also defines the generic or if it defines
>> one of the classes the method is specialized on. THis isn't an enforced
>> requirement but a strong recommendation.
>>
>> Best,
>>
>> luke
>>
>>>
>>> Nothing at all illegal here, and we'll make it work. But a more
>>> predictable implementation for most applications would, say, define a
>>> new class in B that extended the class in A. In your example (very
>>> helpful, by the way) one might have a class "mynumB", perhaps with the
>>> same slots as "mynum" but with modified behavior.
>>>
>>> If you want to keep the current implementation, though, a workaround
>>> until the bug is fixed would be something like:
>>>
>>> setMethod("plot", c("mynum", "missing"), getMethod("plot", c("mynum",
>>> "missing")))
>>>
>>> executed after B is attached (I think it could be in the .onLoad
>>> function for B, but have not tested that).
>>>
>>> John
>>>
>>>
>>> On 6/6/11 4:11 AM, Iago Mosqueira wrote:
>>>>
>>>> On Wed, Jun 1, 2011 at 6:04 PM, Martin Morgan<mtmorgan at fhcrc.org> wrote:
>>>>>
>>>>> On 06/01/2011 04:39 AM, Iago Mosqueira wrote:
>>>>>>
>>>>>> Dear all,
>>>>>>
>>>>>> I am experiencing some problems with S4 method overloading. I have
>>>>>> defined a generic for graphics:plot, using
>>>>>>
>>>>>> setGeneric("plot", useAsDefault = plot)
>>>>>>
>>>>>> and with
>>>>>>
>>>>>> importFrom('graphics', 'plot') and
>>>>>>
>>>>>> exportMethods('plot') in the NAMESPACE file of pkg A.
>>>>>
>>>>> I'd guess you were creating two generics (explicitly in pkgA,
>>>>> implicitly in
>>>>> pkgB). Maybe
>>>>>
>>>>> export(plot)
>>>>>
>>>>> in NAMESPACE of pkg A,
>>>>>
>>>>> importFrom('pkgA', plot)
>>>>> exportMethods(plot)
>>>>>
>>>>> in pkg B. Feel free to post to the list if that's helpful.
>>>>>
>>>>> Martin
>>>>>
>>>>>>
>>>>>> I then proceed to define a method for signature c('myS4class',
>>>>>> 'missing'). This works as expected: selectMethod('plot',
>>>>>> c('myS4class', 'missing')) returns the newly defined method, and the
>>>>>> method gets called when invoked.
>>>>>>
>>>>>> Another pkg, B, wishes to overload this and redefines the method for
>>>>>> the same signature. A method is defined for c('myS4class', 'missing'),
>>>>>> and exported on the NAMESPACE. The new method is shown by
>>>>>> selectMethod() after pkg B has been loaded, but a call to
>>>>>>
>>>>>> plot(anobjectofmyS4class)
>>>>>>
>>>>>> comes up with the result of running the first method, from pkg A. I
>>>>>> have tried importing 'plot' in B's NAMESPACE from both graphics or A,
>>>>>> but the end result is the same.
>>>>>>
>>>>>> Package B does the same thing for a method created by pkg A, myMethod,
>>>>>> and that works fine.
>>>>>>
>>>>>> Any pointers or where this might be going wrong? How is it that a
>>>>>> different method than the one shown by selectMethod() is being run?
>>>>>> Something to do with the 'missing' part of the signature?
>>>>>>
>>>>>> Many thanks,
>>>>>>
>>>>>>
>>>>>>
>>>>>> Iago Mosqueira
>>>>
>>>> Dear all,
>>>>
>>>> I have tried Martin's suggestion, but the problem persists. It seems
>>>> to be related to having 'missing' in the signature, as doing the same
>>>> kind of overloading for c('myclass', 'ANY') work as expected.
>>>>
>>>> I am attaching 2 simple packages where I attempt this repeated
>>>> overloading of plot for the same class. Script below, also found in
>>>> Bpkg/tests.test.R, shows what I have encountered so far:
>>>> plot('myclass', 'ANY') can be re-overloaded, but plot('myclass',
>>>> 'missing') cannot in the same way. If I run
>>>>
>>>> trace("plot", browser, exit=browser, signature = c("mynum", "missing"))
>>>>
>>>> the new method is actually called.
>>>>
>>>> Any hint on what I am doing wrong or where to look for an explanation
>>>> will be much appreciated.
>>>>
>>>> Best regards,
>>>>
>>>>
>>>> Iago Mosqueira
>>>>
>>>>
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>


From jmc at r-project.org  Tue Jun  7 23:10:16 2011
From: jmc at r-project.org (John Chambers)
Date: Tue, 07 Jun 2011 14:10:16 -0700
Subject: [Rd] Overloading S4 methods
In-Reply-To: <BANLkTi=EZozootp3Jc7EirNFxqm=wFpFSg@mail.gmail.com>
References: <BANLkTi=KwUzxy+3YA+HWmP-PPozD-g7zkg@mail.gmail.com>	<4DE6631A.9010104@fhcrc.org>	<BANLkTimCFhkqPq=3XowmiZVKDtwXhM4V3g@mail.gmail.com>	<4DED467F.1080006@r-project.org>	<alpine.DEB.2.00.1106070812100.1796@luke-inspiron>	<4DEE5A7B.8030903@r-project.org>
	<BANLkTi=EZozootp3Jc7EirNFxqm=wFpFSg@mail.gmail.com>
Message-ID: <4DEE93B8.2030507@r-project.org>

On 6/7/11 2:02 PM, Iago Mosqueira wrote:
> Can then the warning be turned off in any way to avoid it showing up
> on check? Maybe an argument to confirm 'I know what I am doing so I
> need no warning, thank you very much'.

Well, this is still new territory since the bug didn't seem to have been 
encountered before your example.  We won't add the warning in the 
immediate future, and as Luke pointed out, even Dylan just advises. 
This may be more a matter for a "code tools" approach.  So not to worry 
just yet!

John

>
>
> Iago
>
> On Tue, Jun 7, 2011 at 7:06 PM, John Chambers<jmc at r-project.org>  wrote:
>> Yes, Dylan is in many ways more authoritarian than R!  Possibly also with
>> fewer users to be annoyed.
>>
>> We might go to a warning as Iago suggests.  If we did add a warning, it
>> would be likely be more useful in the setMethod() call than at CMD check
>> time, after the package has been designed and implemented.
>>
>> John
>>
>> On 6/7/11 6:15 AM, luke-tierney at uiowa.edu wrote:
>>>
>>> On Mon, 6 Jun 2011, John Chambers wrote:
>>>
>>>> This is a bug, medium-subtle, but also raises an interesting software
>>>> design point.
>>>>
>>>> The Bug:
>>>>
>>>> Nothing specific about "ANY" and "missing", but the issue is whether
>>>> the method was inherited (the "ANY" case) or defined directly (the
>>>> "missing" case).
>>>>
>>>> Generic functions keep a cached table of dispatched methods, to save
>>>> determining inherited methods repeatedly for calls with the same
>>>> signature. When pkg B is loaded, the inherited methods are reset, but
>>>> apparently the directly defined ones were not (but should have been if
>>>> pkg B overrides the method).
>>>>
>>>> It's interesting that this bug seems not to have been reported before,
>>>> which leads to:
>>>>
>>>> The Software Design Point:
>>>>
>>>> When a package (B) extends the class/method software in another
>>>> package (A), typically B adds new classes and perhaps new generic
>>>> functions with methods for previous classes in A as well as classes in
>>>> B. It might also extend the behavior for classes in A to other generic
>>>> functions.
>>>>
>>>> What is less usual is to directly override an existing method for a
>>>> class that belongs to A. Notice that there can be side-effects, such
>>>> as behavior of examples or tests in package A depending on whether B
>>>> has been loaded or not. And objects created entirely from A could have
>>>> their computations change after B was loaded.
>>>
>>> Dylan is simliar in using a generic funciton model. One of the Dylan
>>> books -- I forget which one -- strongly recomends that a library only
>>> define a method if either it also defines the generic or if it defines
>>> one of the classes the method is specialized on. THis isn't an enforced
>>> requirement but a strong recommendation.
>>>
>>> Best,
>>>
>>> luke
>>>
>>>>
>>>> Nothing at all illegal here, and we'll make it work. But a more
>>>> predictable implementation for most applications would, say, define a
>>>> new class in B that extended the class in A. In your example (very
>>>> helpful, by the way) one might have a class "mynumB", perhaps with the
>>>> same slots as "mynum" but with modified behavior.
>>>>
>>>> If you want to keep the current implementation, though, a workaround
>>>> until the bug is fixed would be something like:
>>>>
>>>> setMethod("plot", c("mynum", "missing"), getMethod("plot", c("mynum",
>>>> "missing")))
>>>>
>>>> executed after B is attached (I think it could be in the .onLoad
>>>> function for B, but have not tested that).
>>>>
>>>> John
>>>>
>>>>
>>>> On 6/6/11 4:11 AM, Iago Mosqueira wrote:
>>>>>
>>>>> On Wed, Jun 1, 2011 at 6:04 PM, Martin Morgan<mtmorgan at fhcrc.org>  wrote:
>>>>>>
>>>>>> On 06/01/2011 04:39 AM, Iago Mosqueira wrote:
>>>>>>>
>>>>>>> Dear all,
>>>>>>>
>>>>>>> I am experiencing some problems with S4 method overloading. I have
>>>>>>> defined a generic for graphics:plot, using
>>>>>>>
>>>>>>> setGeneric("plot", useAsDefault = plot)
>>>>>>>
>>>>>>> and with
>>>>>>>
>>>>>>> importFrom('graphics', 'plot') and
>>>>>>>
>>>>>>> exportMethods('plot') in the NAMESPACE file of pkg A.
>>>>>>
>>>>>> I'd guess you were creating two generics (explicitly in pkgA,
>>>>>> implicitly in
>>>>>> pkgB). Maybe
>>>>>>
>>>>>> export(plot)
>>>>>>
>>>>>> in NAMESPACE of pkg A,
>>>>>>
>>>>>> importFrom('pkgA', plot)
>>>>>> exportMethods(plot)
>>>>>>
>>>>>> in pkg B. Feel free to post to the list if that's helpful.
>>>>>>
>>>>>> Martin
>>>>>>
>>>>>>>
>>>>>>> I then proceed to define a method for signature c('myS4class',
>>>>>>> 'missing'). This works as expected: selectMethod('plot',
>>>>>>> c('myS4class', 'missing')) returns the newly defined method, and the
>>>>>>> method gets called when invoked.
>>>>>>>
>>>>>>> Another pkg, B, wishes to overload this and redefines the method for
>>>>>>> the same signature. A method is defined for c('myS4class', 'missing'),
>>>>>>> and exported on the NAMESPACE. The new method is shown by
>>>>>>> selectMethod() after pkg B has been loaded, but a call to
>>>>>>>
>>>>>>> plot(anobjectofmyS4class)
>>>>>>>
>>>>>>> comes up with the result of running the first method, from pkg A. I
>>>>>>> have tried importing 'plot' in B's NAMESPACE from both graphics or A,
>>>>>>> but the end result is the same.
>>>>>>>
>>>>>>> Package B does the same thing for a method created by pkg A, myMethod,
>>>>>>> and that works fine.
>>>>>>>
>>>>>>> Any pointers or where this might be going wrong? How is it that a
>>>>>>> different method than the one shown by selectMethod() is being run?
>>>>>>> Something to do with the 'missing' part of the signature?
>>>>>>>
>>>>>>> Many thanks,
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> Iago Mosqueira
>>>>>
>>>>> Dear all,
>>>>>
>>>>> I have tried Martin's suggestion, but the problem persists. It seems
>>>>> to be related to having 'missing' in the signature, as doing the same
>>>>> kind of overloading for c('myclass', 'ANY') work as expected.
>>>>>
>>>>> I am attaching 2 simple packages where I attempt this repeated
>>>>> overloading of plot for the same class. Script below, also found in
>>>>> Bpkg/tests.test.R, shows what I have encountered so far:
>>>>> plot('myclass', 'ANY') can be re-overloaded, but plot('myclass',
>>>>> 'missing') cannot in the same way. If I run
>>>>>
>>>>> trace("plot", browser, exit=browser, signature = c("mynum", "missing"))
>>>>>
>>>>> the new method is actually called.
>>>>>
>>>>> Any hint on what I am doing wrong or where to look for an explanation
>>>>> will be much appreciated.
>>>>>
>>>>> Best regards,
>>>>>
>>>>>
>>>>> Iago Mosqueira
>>>>>
>>>>>
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From stefan.theussl at wu.ac.at  Wed Jun  8 13:06:36 2011
From: stefan.theussl at wu.ac.at (Stefan Theussl)
Date: Wed, 08 Jun 2011 13:06:36 +0200
Subject: [Rd] Does anybody successfully built latest R on AIX 5.3?
Message-ID: <4DEF57BC.5040900@wu.ac.at>

We successfully built R on AIX 6.1 but the following instructions should 
also work for 5.3.

We mainly used the software from OSS4AIX but also from the "AIX Toolbox 
for Linux Applications" obtainable directly from IBM. Attached you'll 
find our list of installed rpms. This and the instructions provided in 
the "R Installation and Administration" manual should be all you need to 
build R on AIX systems.

hth,
st
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: aixrpmlist.txt
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110608/c6505bda/attachment.txt>

From ripley at stats.ox.ac.uk  Wed Jun  8 13:22:10 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 8 Jun 2011 12:22:10 +0100 (BST)
Subject: [Rd] "warning: assignment discards qualifiers from pointer
 target type"
In-Reply-To: <4DEE3786.5000800@gmail.com>
References: <20110607130854.GA4510@siouxsie> <4DEE3786.5000800@gmail.com>
Message-ID: <alpine.LFD.2.02.1106071606010.26985@gannet.stats.ox.ac.uk>

On Tue, 7 Jun 2011, Duncan Murdoch wrote:

> On 07/06/2011 9:08 AM, oliver wrote:
>> Hello,
>> 
>> following an advice here from the list I looked into sources of other
>> packages (xts) and found the TYPEOF() macro/function, which really is
>> helpful.

It is documented, of course, but actually better alternatives are 
described in 'Writing R Extensions'.

We would urge you to study the R sources rather than copy bad habits 
from randomly chosen package sources.

>> I iused the follwong code snippet:
>> 
>>
>>    switch( TYPEOF( filename_sexp ) )
>>    {
>>          case STRSXP: filename = CHAR( STRING_ELT(filename_sexp, 0) );
>>                       break;
>>
>>          default:     error("filename argument must be a string");
>>                       break;
>>    }
>> 
>> 
>> Here, filename is of type char*
>> and one function opens a file with that name.
>> So it is purely intended to just grab out the char* from the
>> String-Expression.
>> 
>> Am I doing something wrong here, or is it ok, but I have somehow
>> to say the extracting macros/functions, that it is really intended
>> to throw away information and that a warning is not necessary?
>
> The result of calling CHAR should be a "const char *".  You are not allowed 
> to touch the string it points to.

Note too that isString() exists for this purpose, and there is no 
check in that code that LENGTH(filename_sexp) > 0 (or == 1).  In the R 
sources you will often see things like

     if(!isString(sfile) || LENGTH(sfile) < 1)
         error("invalid '%s' argument", "description");

Then, reading on,

     file = translateChar(STRING_ELT(sfile, 0));

for you cannot (in general) assume that the character vector passed is 
in the native encoding.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From stefan.theussl at wu.ac.at  Wed Jun  8 14:39:40 2011
From: stefan.theussl at wu.ac.at (Stefan Theussl)
Date: Wed, 08 Jun 2011 14:39:40 +0200
Subject: [Rd] Does anybody successfully built latest R on AIX 5.3?
In-Reply-To: <001501cc25d3$f49563a0$ddc02ae0$@com>
References: <4DEF57BC.5040900@wu.ac.at> <001501cc25d3$f49563a0$ddc02ae0$@com>
Message-ID: <4DEF6D8C.6030908@wu.ac.at>

On 06/08/2011 02:02 PM, XiaoboGu wrote:
> Hi Stefan,
> 	Thanks for replying!
>
> 	I have just managed to installed gcc 4.2.4.2 on AIX this evening, and will try to install gfortran tomorrow, there are a few more questions
>    
great.
> 1. Are you running R 2.13.0
>    
Currently we are running 2.12.0 (works with both GNU and IBM compilers). 
I was not able to compile 2.13 with GNU compilers yet, IBM compilers 
work though (are preferable anyway, since performance is higher):

R version 2.13.0 Patched (2011-06-08 r56086)
Copyright (C) 2011 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: powerpc-ibm-aix6.1.0.0 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

 > sessionInfo()
R version 2.13.0 Patched (2011-06-08 r56086)
Platform: powerpc-ibm-aix6.1.0.0 (64-bit)

locale:
[1] EN_US.UTF-8 EN_US.UTF-8 C C EN_US.UTF-8 EN_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base
 >

However recommended package Matrix gives an error upon loading.
> 2. Can you share all the environment variables we have to set before running the configure script.
>    
See the manual and 
https://r-forge.r-project.org/scm/viewvc.php/install_scripts/install_R_AIX.sh?view=markup&root=aix 

You may download this script (and patches), modify the paths 
accordingly, run it (e.g., ./install_R_AIX.sh --ibm for 2.13) and R 
should build fine.
There are a couple of notes and patches provided in the R/AIX repository 
on R-Forge (e.g., how to get IBM BLAS linked etc., missing third-party 
libs installed, etc.).

> 3. Can you share the full command line of configure script.
>    
see above.
> 4. According to your experience, is there a huge performance lift compared to X86 CPUS, what's the clock speed of you Power CPU?
>    
No there isn't. One can use the IBM BLAS library (ESSL), then one will 
observe a significant speedup for linear algebra tasks. Note however, 
ESSL does not incorporate the full BLAS specification (thus the patch). 
In general, R  runs slower on the power architecture than on x86.
We have a Power 6 8core CPU @ 3.5 GHz. Actually, we use our system 
mainly for memory-demanding applications (<=128GB RAM).

Best,
st
>
> Regards,
>
> Xiaobo Gu
>
>
>    
>> -----Original Message-----
>> From: Stefan Theussl [mailto:stefan.theussl at wu.ac.at]
>> Sent: Wednesday, June 08, 2011 7:07 PM
>> To: guxiaobo1982 at gmail.com
>> Cc: r-devel at r-project.org
>> Subject: Re: [Rd] Does anybody successfully built latest R on AIX 5.3?
>>
>> We successfully built R on AIX 6.1 but the following instructions should also work for 5.3.
>>
>> We mainly used the software from OSS4AIX but also from the "AIX Toolbox for Linux
>> Applications" obtainable directly from IBM. Attached you'll find our list of installed rpms.
>> This and the instructions provided in the "R Installation and Administration" manual should
>> be all you need to build R on AIX systems.
>>
>> hth,
>> st
>>      
>


From guxiaobo1982 at gmail.com  Wed Jun  8 14:02:31 2011
From: guxiaobo1982 at gmail.com (XiaoboGu)
Date: Wed, 8 Jun 2011 20:02:31 +0800
Subject: [Rd] Does anybody successfully built latest R on AIX 5.3?
In-Reply-To: <4DEF57BC.5040900@wu.ac.at>
References: <4DEF57BC.5040900@wu.ac.at>
Message-ID: <001501cc25d3$f49563a0$ddc02ae0$@com>

Hi Stefan,
	Thanks for replying!

	I have just managed to installed gcc 4.2.4.2 on AIX this evening, and will try to install gfortran tomorrow, there are a few more questions

1. Are you running R 2.13.0
2. Can you share all the environment variables we have to set before running the configure script.
3. Can you share the full command line of configure script.
4. According to your experience, is there a huge performance lift compared to X86 CPUS, what's the clock speed of you Power CPU?


Regards,

Xiaobo Gu


> -----Original Message-----
> From: Stefan Theussl [mailto:stefan.theussl at wu.ac.at]
> Sent: Wednesday, June 08, 2011 7:07 PM
> To: guxiaobo1982 at gmail.com
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] Does anybody successfully built latest R on AIX 5.3?
> 
> We successfully built R on AIX 6.1 but the following instructions should also work for 5.3.
> 
> We mainly used the software from OSS4AIX but also from the "AIX Toolbox for Linux
> Applications" obtainable directly from IBM. Attached you'll find our list of installed rpms.
> This and the instructions provided in the "R Installation and Administration" manual should
> be all you need to build R on AIX systems.
> 
> hth,
> st


From guxiaobo1982 at gmail.com  Wed Jun  8 16:14:11 2011
From: guxiaobo1982 at gmail.com (XiaoboGu)
Date: Wed, 8 Jun 2011 22:14:11 +0800
Subject: [Rd] Does anybody successfully built latest R on AIX 5.3?
In-Reply-To: <4DEF6D8C.6030908@wu.ac.at>
References: <4DEF57BC.5040900@wu.ac.at> <001501cc25d3$f49563a0$ddc02ae0$@com>
	<4DEF6D8C.6030908@wu.ac.at>
Message-ID: <001901cc25e6$59ba2920$0d2e7b60$@com>



> -----Original Message-----
> From: Stefan Theussl [mailto:stefan.theussl at wu.ac.at]
> Sent: Wednesday, June 08, 2011 8:40 PM
> To: XiaoboGu
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] Does anybody successfully built latest R on AIX 5.3?
> 
> On 06/08/2011 02:02 PM, XiaoboGu wrote:
> > Hi Stefan,
> > 	Thanks for replying!
> >
> > 	I have just managed to installed gcc 4.2.4.2 on AIX this evening, and will try to install
> gfortran tomorrow, there are a few more questions
> >
> great.
> > 1. Are you running R 2.13.0
> >
> Currently we are running 2.12.0 (works with both GNU and IBM compilers).
> I was not able to compile 2.13 with GNU compilers yet, IBM compilers
> work though (are preferable anyway, since performance is higher):
> 
> R version 2.13.0 Patched (2011-06-08 r56086)
> Copyright (C) 2011 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
> Platform: powerpc-ibm-aix6.1.0.0 (64-bit)
> 
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
> 
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
> 
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
> 
>  > sessionInfo()
> R version 2.13.0 Patched (2011-06-08 r56086)
> Platform: powerpc-ibm-aix6.1.0.0 (64-bit)
> 
> locale:
> [1] EN_US.UTF-8 EN_US.UTF-8 C C EN_US.UTF-8 EN_US.UTF-8
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>  >
> 
> However recommended package Matrix gives an error upon loading.
> > 2. Can you share all the environment variables we have to set before running the configure
> script.
> >
> See the manual and
> https://r-forge.r-project.org/scm/viewvc.php/install_scripts/install_R_AIX.sh?view=markup
> &root=aix
> 
> You may download this script (and patches), modify the paths
> accordingly, run it (e.g., ./install_R_AIX.sh --ibm for 2.13) and R
> should build fine.
> There are a couple of notes and patches provided in the R/AIX repository
> on R-Forge (e.g., how to get IBM BLAS linked etc., missing third-party
> libs installed, etc.).
> 
> > 3. Can you share the full command line of configure script.
> >
> see above.
> > 4. According to your experience, is there a huge performance lift compared to X86 CPUS,
> what's the clock speed of you Power CPU?
> >
> No there isn't. One can use the IBM BLAS library (ESSL), then one will
> observe a significant speedup for linear algebra tasks. Note however,
> ESSL does not incorporate the full BLAS specification (thus the patch).
> In general, R  runs slower on the power architecture than on x86.

This is strange, we are hoping to improve R performance through high clock speed Power CPU(4.0 GHz above), 
Now I think we should take more considerations, RAM is also cheaper for X86 than Power :)




> We have a Power 6 8core CPU @ 3.5 GHz. Actually, we use our system
> mainly for memory-demanding applications (<=128GB RAM).
> 
> Best,
> st
> >
> > Regards,
> >
> > Xiaobo Gu
> >
> >
> >
> >> -----Original Message-----
> >> From: Stefan Theussl [mailto:stefan.theussl at wu.ac.at]
> >> Sent: Wednesday, June 08, 2011 7:07 PM
> >> To: guxiaobo1982 at gmail.com
> >> Cc: r-devel at r-project.org
> >> Subject: Re: [Rd] Does anybody successfully built latest R on AIX 5.3?
> >>
> >> We successfully built R on AIX 6.1 but the following instructions should also work for
> 5.3.
> >>
> >> We mainly used the software from OSS4AIX but also from the "AIX Toolbox for Linux
> >> Applications" obtainable directly from IBM. Attached you'll find our list of installed
> rpms.
> >> This and the instructions provided in the "R Installation and Administration" manual
> should
> >> be all you need to build R on AIX systems.
> >>
> >> hth,
> >> st
> >>
> >


From oliver at first.in-berlin.de  Wed Jun  8 18:08:39 2011
From: oliver at first.in-berlin.de (oliver)
Date: Wed, 8 Jun 2011 18:08:39 +0200
Subject: [Rd] "warning: assignment discards qualifiers from pointer
 target type"
In-Reply-To: <alpine.LFD.2.02.1106071606010.26985@gannet.stats.ox.ac.uk>
References: <20110607130854.GA4510@siouxsie> <4DEE3786.5000800@gmail.com>
	<alpine.LFD.2.02.1106071606010.26985@gannet.stats.ox.ac.uk>
Message-ID: <20110608160839.GA11746@siouxsie>

On Wed, Jun 08, 2011 at 12:22:10PM +0100, Prof Brian Ripley wrote:
> On Tue, 7 Jun 2011, Duncan Murdoch wrote:
> 
> >On 07/06/2011 9:08 AM, oliver wrote:
> >>Hello,
> >>
> >>following an advice here from the list I looked into sources of other
> >>packages (xts) and found the TYPEOF() macro/function, which really is
> >>helpful.
> 
> It is documented, of course, but actually better alternatives are
> described in 'Writing R Extensions'.
> 
> We would urge you to study the R sources rather than copy bad habits
> from randomly chosen package sources.
[...]

Hmhh, it was not randomly chosen, it was, what I got as a hint here on the list.


> 
> >>I iused the follwong code snippet:
> >>
> >>
> >>   switch( TYPEOF( filename_sexp ) )
> >>   {
> >>         case STRSXP: filename = CHAR( STRING_ELT(filename_sexp, 0) );
> >>                      break;
> >>
> >>         default:     error("filename argument must be a string");
> >>                      break;
> >>   }
> >>
> >>
> >>Here, filename is of type char*
> >>and one function opens a file with that name.
> >>So it is purely intended to just grab out the char* from the
> >>String-Expression.
> >>
> >>Am I doing something wrong here, or is it ok, but I have somehow
> >>to say the extracting macros/functions, that it is really intended
> >>to throw away information and that a warning is not necessary?
> >
> >The result of calling CHAR should be a "const char *".  You are
> >not allowed to touch the string it points to.
> 
> Note too that isString() exists for this purpose,
[...]

OK, I also sometimes used that (maybe I threw it out or used it in other
modules).



> and there is no
> check in that code that LENGTH(filename_sexp) > 0 (or == 1).  In the
> R sources you will often see things like
> 
>     if(!isString(sfile) || LENGTH(sfile) < 1)
>         error("invalid '%s' argument", "description");
[...]

If it's a vector, I can just pic the first element.
Or does   LENGTH(sfile)  give the length of the string itself
(like strlen(3))?

If the latter, then my file-opeing operation would faile with an error.
Of course I check if my fopen() gibves back NULL.



> 
> Then, reading on,
> 
>     file = translateChar(STRING_ELT(sfile, 0));

translateChar is explained on page 120 of the extension writing do.

I'm not in this point of the documentation.

And I often need to look around, when I want to find a function,
as they are documented/explained somewhere during the flow of the text.

Something like a API description that is brief would help.

For example something like in the manuals of the OCaml language:

  http://caml.inria.fr/pub/docs/manual-ocaml/libref/Pervasives.html


That's very brief.

Chapter 6 of the  "Writing R Extensions" is rather in this style
and gives a good overview.
Something like that for the macros would be helpful.


> 
> for you cannot (in general) assume that the character vector passed
> is in the native encoding.

I try to do some coercions (e.g. as.integer())
when I need integer in the C-code and then
in the C-part rigidly check on integer.

About the char-encodings I have not thought much.


Ciao,
   Oliver


From jmc at r-project.org  Wed Jun  8 18:57:46 2011
From: jmc at r-project.org (John Chambers)
Date: Wed, 08 Jun 2011 09:57:46 -0700
Subject: [Rd] Overloading S4 methods
In-Reply-To: <BANLkTi=RRJCCBvLjfVO62A=uG8R9wm-6Nw@mail.gmail.com>
References: <BANLkTi=KwUzxy+3YA+HWmP-PPozD-g7zkg@mail.gmail.com>	<4DE6631A.9010104@fhcrc.org>	<BANLkTimCFhkqPq=3XowmiZVKDtwXhM4V3g@mail.gmail.com>	<4DED467F.1080006@r-project.org>
	<BANLkTi=RRJCCBvLjfVO62A=uG8R9wm-6Nw@mail.gmail.com>
Message-ID: <4DEFAA0A.8000405@r-project.org>

The bug should be fixed in r-devel and 2.13 patched, as of svn rev. 56090.

John

On 6/7/11 12:42 AM, Iago Mosqueira wrote:
> On Mon, Jun 6, 2011 at 11:28 PM, John Chambers<jmc at r-project.org>  wrote:
>> This is a bug, medium-subtle, but also raises an interesting software design
>> point.
>>
>> The Bug:
>>
>> Nothing specific about "ANY" and "missing", but the issue is whether the
>> method was inherited (the "ANY" case) or defined directly (the "missing"
>> case).
>>
>> Generic functions keep a cached table of dispatched methods, to save
>> determining inherited methods repeatedly for calls with the same signature.
>>   When pkg B is loaded, the inherited methods are reset, but apparently the
>> directly defined ones were not (but should have been if pkg B overrides the
>> method).
>>
>> It's interesting that this bug seems not to have been reported before, which
>> leads to:
>>
>> The Software Design Point:
>>
>> When a package (B) extends the class/method software in another package (A),
>> typically B adds new classes and perhaps new generic functions with methods
>> for previous classes in A as well as classes in B.  It might also extend the
>> behavior for classes in A to other generic functions.
>>
>> What is less usual is to directly override an existing method for a class
>> that belongs to A.  Notice that there can be side-effects, such as behavior
>> of examples or tests in package A depending on whether B has been loaded or
>> not.  And objects created entirely from A could have their computations
>> change after B was loaded.
>>
>> Nothing at all illegal here, and we'll make it work.  But a more predictable
>> implementation for most applications would, say, define a new class in B
>> that extended the class in A.  In your example (very helpful, by the way)
>> one might have a class "mynumB", perhaps with the same slots as "mynum" but
>> with modified behavior.
>>
>> If you want to keep the current implementation, though, a workaround until
>> the bug is fixed would be something like:
>>
>> setMethod("plot", c("mynum", "missing"), getMethod("plot", c("mynum",
>> "missing")))
>>
>> executed after B is attached (I think it could be in the .onLoad function
>> for B, but have not tested that).
>>
>> John
>
> Many thanks for the very complete explanation. We are using this
> mechanism to provide ggplot2-based plot for some classes, to
> substitute the initial lattice-based ones, so the effects are limited
> to visual output and not results of computation, but it is good you
> reminded me of the possible side effects of this strategy. Is maybe a
> warning during R CMD check appropriate here?
>
>
> Adding the call to setMethod(..., getMethod()) did not work if placed
> inside .onLoad, and in fact had the effect of getMethod() now
> returning the Apkg method after Bpkg was loaded.
>
> Running the line after Bpkg has loaded did sort it out. What would
> then be the best way of adding this command to the pkg loading
> process? I have also tried adding it to a zzz.R file on iuts own but
> that did not work, I still need to re-run it after loading has
> finished.
>
> Many thanks,
>
>
> Iago
>
>>
>>
>> On 6/6/11 4:11 AM, Iago Mosqueira wrote:
>>>
>>> On Wed, Jun 1, 2011 at 6:04 PM, Martin Morgan<mtmorgan at fhcrc.org>    wrote:
>>>>
>>>> On 06/01/2011 04:39 AM, Iago Mosqueira wrote:
>>>>>
>>>>> Dear all,
>>>>>
>>>>> I am experiencing some problems with S4 method overloading. I have
>>>>> defined a generic for graphics:plot, using
>>>>>
>>>>> setGeneric("plot", useAsDefault = plot)
>>>>>
>>>>> and with
>>>>>
>>>>> importFrom('graphics', 'plot') and
>>>>>
>>>>> exportMethods('plot') in the NAMESPACE file of pkg A.
>>>>
>>>> I'd guess you were creating two generics (explicitly in pkgA, implicitly
>>>> in
>>>> pkgB). Maybe
>>>>
>>>>   export(plot)
>>>>
>>>> in NAMESPACE of pkg A,
>>>>
>>>>   importFrom('pkgA', plot)
>>>>   exportMethods(plot)
>>>>
>>>> in pkg B. Feel free to post to the list if that's helpful.
>>>>
>>>> Martin
>>>>
>>>>>
>>>>> I then proceed to define a method for signature c('myS4class',
>>>>> 'missing'). This works as expected: selectMethod('plot',
>>>>> c('myS4class', 'missing')) returns the newly defined method, and the
>>>>> method gets called when invoked.
>>>>>
>>>>> Another pkg, B, wishes to overload this and redefines the method for
>>>>> the same signature. A method is defined for c('myS4class', 'missing'),
>>>>> and exported on the NAMESPACE. The new method is shown by
>>>>> selectMethod() after pkg B has been loaded, but a call to
>>>>>
>>>>> plot(anobjectofmyS4class)
>>>>>
>>>>> comes up with the result of running the first method, from pkg A. I
>>>>> have tried importing 'plot' in B's NAMESPACE from both graphics or A,
>>>>> but the end result is the same.
>>>>>
>>>>> Package B does the same thing for a method created by pkg A, myMethod,
>>>>> and that works fine.
>>>>>
>>>>> Any pointers or where this might be going wrong? How is it that a
>>>>> different method than the one shown by selectMethod() is being run?
>>>>> Something to do with the 'missing' part of the signature?
>>>>>
>>>>> Many thanks,
>>>>>
>>>>>
>>>>>
>>>>> Iago Mosqueira
>>>
>>> Dear all,
>>>
>>> I have tried Martin's suggestion, but the problem persists. It seems
>>> to be related to having 'missing' in the signature, as doing the same
>>> kind of overloading for c('myclass', 'ANY') work as expected.
>>>
>>> I am attaching 2 simple packages where I attempt this repeated
>>> overloading of plot for the same class. Script below, also found in
>>> Bpkg/tests.test.R, shows what I have encountered so far:
>>> plot('myclass', 'ANY') can be re-overloaded, but plot('myclass',
>>> 'missing') cannot in the same way. If I run
>>>
>>> trace("plot", browser, exit=browser, signature = c("mynum", "missing"))
>>>
>>> the  new method is actually called.
>>>
>>> Any hint on what I am doing wrong or where to look for an explanation
>>> will be much appreciated.
>>>
>>> Best regards,
>>>
>>>
>>> Iago Mosqueira
>>>
>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From simon.urbanek at r-project.org  Wed Jun  8 20:23:29 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 8 Jun 2011 14:23:29 -0400
Subject: [Rd] "warning: assignment discards qualifiers from pointer
	target type"
In-Reply-To: <20110608160839.GA11746@siouxsie>
References: <20110607130854.GA4510@siouxsie> <4DEE3786.5000800@gmail.com>
	<alpine.LFD.2.02.1106071606010.26985@gannet.stats.ox.ac.uk>
	<20110608160839.GA11746@siouxsie>
Message-ID: <B68723F7-F66B-40FD-AE38-0A88C0C51B82@r-project.org>


On Jun 8, 2011, at 12:08 PM, oliver wrote:

> On Wed, Jun 08, 2011 at 12:22:10PM +0100, Prof Brian Ripley wrote:
>> On Tue, 7 Jun 2011, Duncan Murdoch wrote:
>> 
>>> On 07/06/2011 9:08 AM, oliver wrote:
>>>> Hello,
>>>> 
>>>> following an advice here from the list I looked into sources of other
>>>> packages (xts) and found the TYPEOF() macro/function, which really is
>>>> helpful.
>> 
>> It is documented, of course, but actually better alternatives are
>> described in 'Writing R Extensions'.
>> 
>> We would urge you to study the R sources rather than copy bad habits
>> from randomly chosen package sources.
> [...]
> 
> Hmhh, it was not randomly chosen, it was, what I got as a hint here on the list.
> 

It was not provided to you to look at how it checks arguments. For basic usage it's better to look at the R code. The coding styles vary a lot in packages (and so does the quality of packages) - some of them are really bad, but you have to remember that most people write packages in their free time and are not programmers...


> 
>> 
>>>> I iused the follwong code snippet:
>>>> 
>>>> 
>>>>  switch( TYPEOF( filename_sexp ) )
>>>>  {
>>>>        case STRSXP: filename = CHAR( STRING_ELT(filename_sexp, 0) );
>>>>                     break;
>>>> 
>>>>        default:     error("filename argument must be a string");
>>>>                     break;
>>>>  }
>>>> 
>>>> 
>>>> Here, filename is of type char*
>>>> and one function opens a file with that name.
>>>> So it is purely intended to just grab out the char* from the
>>>> String-Expression.
>>>> 
>>>> Am I doing something wrong here, or is it ok, but I have somehow
>>>> to say the extracting macros/functions, that it is really intended
>>>> to throw away information and that a warning is not necessary?
>>> 
>>> The result of calling CHAR should be a "const char *".  You are
>>> not allowed to touch the string it points to.
>> 
>> Note too that isString() exists for this purpose,
> [...]
> 
> OK, I also sometimes used that (maybe I threw it out or used it in other
> modules).
> 
> 
> 
>> and there is no
>> check in that code that LENGTH(filename_sexp) > 0 (or == 1).  In the
>> R sources you will often see things like
>> 
>>    if(!isString(sfile) || LENGTH(sfile) < 1)
>>        error("invalid '%s' argument", "description");
> [...]
> 
> If it's a vector, I can just pic the first element.

Yes, but only if it's not a vector of length zero - hence the necessary check.


> Or does   LENGTH(sfile)  give the length of the string itself
> (like strlen(3))?
> 

No.


> If the latter, then my file-opeing operation would faile with an error.
> Of course I check if my fopen() gibves back NULL.
> 
> 
> 
>> 
>> Then, reading on,
>> 
>>    file = translateChar(STRING_ELT(sfile, 0));
> 
> translateChar is explained on page 120 of the extension writing do.
> 
> I'm not in this point of the documentation.
> 
> And I often need to look around, when I want to find a function,
> as they are documented/explained somewhere during the flow of the text.
> 
> Something like a API description that is brief would help.
> 
> For example something like in the manuals of the OCaml language:
> 
>  http://caml.inria.fr/pub/docs/manual-ocaml/libref/Pervasives.html
> 
> 
> That's very brief.
> 
> Chapter 6 of the  "Writing R Extensions" is rather in this style
> and gives a good overview.
> Something like that for the macros would be helpful.
> 
> 
>> 
>> for you cannot (in general) assume that the character vector passed
>> is in the native encoding.
> 
> I try to do some coercions (e.g. as.integer())
> when I need integer in the C-code and then
> in the C-part rigidly check on integer.
> 

It's usually more efficient to use coerceVector() on the C side since that guarantees no copy is made for matching types (this matters for passing data, not so much for passing arguments). You can do either - check on R side or check on C side, usually you don't need both (but you certainly can).

Cheers,
Simon


> About the char-encodings I have not thought much.
> 
> 
> Ciao,
>   Oliver
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From yintengfei at gmail.com  Thu Jun  9 01:38:52 2011
From: yintengfei at gmail.com (Tengfei Yin)
Date: Wed, 8 Jun 2011 16:38:52 -0700
Subject: [Rd] Reference Class error message: may be caused by lazy
	evaluation?
Message-ID: <BANLkTimEJ=S-rk=QhidM8qEGQETmupr7kw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110608/74a787d4/attachment.pl>

From oliver at first.in-berlin.de  Thu Jun  9 02:06:27 2011
From: oliver at first.in-berlin.de (oliver)
Date: Thu, 9 Jun 2011 02:06:27 +0200
Subject: [Rd] Ctrl-C of functions that allocated mem
Message-ID: <20110609000627.GA3482@siouxsie>


Hello,


what happens, when a function (R-extension in C), that allocated memory
(strdup(), malloc()/calloc() and so on), and is used in interactive mode, then
will be stopped via Ctrl-C?

I would assume that there remains allocated memory,
which is not usable and also not accessable (hence no
way to free it).

Are there any mechanisms in R that could help in rolling
back the allocation?

Normally in an interactive session "some memory" might not be a problem,
because it will be run shortly; but I prefer clean solutions.
And also, if it's much mem, which is allocated each time, and one does many
trials and Ctr-C's, even an interactive session might eat a lot of mem.

So I would be interested in a solution to this (potential) problem.


Ciao,
   Oliver


From oliver at first.in-berlin.de  Thu Jun  9 02:17:31 2011
From: oliver at first.in-berlin.de (oliver)
Date: Thu, 9 Jun 2011 02:17:31 +0200
Subject: [Rd] "warning: assignment discards qualifiers from pointer
 target type"
In-Reply-To: <B68723F7-F66B-40FD-AE38-0A88C0C51B82@r-project.org>
References: <20110607130854.GA4510@siouxsie> <4DEE3786.5000800@gmail.com>
	<alpine.LFD.2.02.1106071606010.26985@gannet.stats.ox.ac.uk>
	<20110608160839.GA11746@siouxsie>
	<B68723F7-F66B-40FD-AE38-0A88C0C51B82@r-project.org>
Message-ID: <20110609001731.GA3565@siouxsie>

On Wed, Jun 08, 2011 at 02:23:29PM -0400, Simon Urbanek wrote:
> 
> On Jun 8, 2011, at 12:08 PM, oliver wrote:
> 
> > On Wed, Jun 08, 2011 at 12:22:10PM +0100, Prof Brian Ripley wrote:
> >> On Tue, 7 Jun 2011, Duncan Murdoch wrote:
> >> 
> >>> On 07/06/2011 9:08 AM, oliver wrote:
> >>>> Hello,
> >>>> 
> >>>> following an advice here from the list I looked into sources of other
> >>>> packages (xts) and found the TYPEOF() macro/function, which really is
> >>>> helpful.
> >> 
> >> It is documented, of course, but actually better alternatives are
> >> described in 'Writing R Extensions'.
> >> 
> >> We would urge you to study the R sources rather than copy bad habits
> >> from randomly chosen package sources.
> > [...]
> > 
> > Hmhh, it was not randomly chosen, it was, what I got as a hint here on the list.
> > 
> 
> It was not provided to you to look at how it checks arguments. For basic
> usage it's better to look at the R code. The coding styles vary a lot in
> packages (and so does the quality of packages) - some of them are really bad,
> but you have to remember that most people write packages in their free time and
> are not programmers...

OK, I see.


[...]
> >> and there is no
> >> check in that code that LENGTH(filename_sexp) > 0 (or == 1).  In the
> >> R sources you will often see things like
> >> 
> >>    if(!isString(sfile) || LENGTH(sfile) < 1)
> >>        error("invalid '%s' argument", "description");
> > [...]
> > 
> > If it's a vector, I can just pic the first element.
> 
> Yes, but only if it's not a vector of length zero - hence the necessary check.
> 
> 
> > Or does   LENGTH(sfile)  give the length of the string itself
> > (like strlen(3))?
> > 
> 
> No.
[...]

OK, I looked at this now.

LENGTH() checks the length of the vector.

Good to know this.

So the problem of a vector of length 0 can be with any arguments of type SEXP,
hence I will need to check ANY arg on it's length.

This is vital to stability under any situation.

Thanks for this valuable hint!

I will add checks for all my SEXP-args.


Ciao,
   Oliver


From oliver at first.in-berlin.de  Thu Jun  9 02:32:09 2011
From: oliver at first.in-berlin.de (oliver)
Date: Thu, 9 Jun 2011 02:32:09 +0200
Subject: [Rd] "warning: assignment discards qualifiers from pointer
 target type"
In-Reply-To: <20110609001731.GA3565@siouxsie>
References: <20110607130854.GA4510@siouxsie> <4DEE3786.5000800@gmail.com>
	<alpine.LFD.2.02.1106071606010.26985@gannet.stats.ox.ac.uk>
	<20110608160839.GA11746@siouxsie>
	<B68723F7-F66B-40FD-AE38-0A88C0C51B82@r-project.org>
	<20110609001731.GA3565@siouxsie>
Message-ID: <20110609003209.GA4839@siouxsie>

On Thu, Jun 09, 2011 at 02:17:31AM +0200, oliver wrote:
[...]
> OK, I looked at this now.
> 
> LENGTH() checks the length of the vector.
> 
> Good to know this.
> 
> So the problem of a vector of length 0 can be with any arguments of type SEXP,
> hence I will need to check ANY arg on it's length.
> 
> This is vital to stability under any situation.
> 
> Thanks for this valuable hint!
> 
> I will add checks for all my SEXP-args.
[...]

Hey, LENGTH() does not work with String-vectors! :(



Ciao,
   Oliver


From simon.urbanek at r-project.org  Thu Jun  9 02:35:34 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 8 Jun 2011 20:35:34 -0400
Subject: [Rd] "warning: assignment discards qualifiers from pointer
	target type"
In-Reply-To: <20110609003209.GA4839@siouxsie>
References: <20110607130854.GA4510@siouxsie> <4DEE3786.5000800@gmail.com>
	<alpine.LFD.2.02.1106071606010.26985@gannet.stats.ox.ac.uk>
	<20110608160839.GA11746@siouxsie>
	<B68723F7-F66B-40FD-AE38-0A88C0C51B82@r-project.org>
	<20110609001731.GA3565@siouxsie> <20110609003209.GA4839@siouxsie>
Message-ID: <86C9E656-BCF4-48C8-8016-877DFAA0D158@r-project.org>


On Jun 8, 2011, at 8:32 PM, oliver wrote:

> On Thu, Jun 09, 2011 at 02:17:31AM +0200, oliver wrote:
> [...]
>> OK, I looked at this now.
>> 
>> LENGTH() checks the length of the vector.
>> 
>> Good to know this.
>> 
>> So the problem of a vector of length 0 can be with any arguments of type SEXP,
>> hence I will need to check ANY arg on it's length.
>> 
>> This is vital to stability under any situation.
>> 
>> Thanks for this valuable hint!
>> 
>> I will add checks for all my SEXP-args.
> [...]
> 
> Hey, LENGTH() does not work with String-vectors! :(
> 

Of course it does ...


From simon.urbanek at r-project.org  Thu Jun  9 02:40:21 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 8 Jun 2011 20:40:21 -0400
Subject: [Rd] Ctrl-C of functions that allocated mem
In-Reply-To: <20110609000627.GA3482@siouxsie>
References: <20110609000627.GA3482@siouxsie>
Message-ID: <FF0548F3-A51E-426E-8D18-367E34FD61E2@r-project.org>


On Jun 8, 2011, at 8:06 PM, oliver wrote:

> 
> Hello,
> 
> 
> what happens, when a function (R-extension in C), that allocated memory
> (strdup(), malloc()/calloc() and so on), and is used in interactive mode, then
> will be stopped via Ctrl-C?
> 
> I would assume that there remains allocated memory,
> which is not usable and also not accessable (hence no
> way to free it).
> 
> Are there any mechanisms in R that could help in rolling
> back the allocation?
> 

Yes, if you read R-exts:
http://r.research.att.com/man/R-exts.html#Memory-allocation
you would know that you're not supposed to use malloc/calloc at all and if you allow interruption ("regular" C code does not) R_alloc does what you asked about.

Cheers,
Simon


> Normally in an interactive session "some memory" might not be a problem,
> because it will be run shortly; but I prefer clean solutions.
> And also, if it's much mem, which is allocated each time, and one does many
> trials and Ctr-C's, even an interactive session might eat a lot of mem.
> 
> So I would be interested in a solution to this (potential) problem.
> 
> 
> Ciao,
>   Oliver
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From jeffrey.ryan at lemnica.com  Thu Jun  9 04:11:00 2011
From: jeffrey.ryan at lemnica.com (Jeffrey Ryan)
Date: Wed, 8 Jun 2011 21:11:00 -0500
Subject: [Rd] "warning: assignment discards qualifiers from pointer
	target type"
In-Reply-To: <20110609001731.GA3565@siouxsie>
References: <20110607130854.GA4510@siouxsie> <4DEE3786.5000800@gmail.com>
	<alpine.LFD.2.02.1106071606010.26985@gannet.stats.ox.ac.uk>
	<20110608160839.GA11746@siouxsie>
	<B68723F7-F66B-40FD-AE38-0A88C0C51B82@r-project.org>
	<20110609001731.GA3565@siouxsie>
Message-ID: <BANLkTinDGtXTY-mffe7APQTG+w94U-M07w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110608/5af00b4c/attachment.pl>

From D.Strbenac at garvan.org.au  Thu Jun  9 09:00:45 2011
From: D.Strbenac at garvan.org.au (Dario Strbenac)
Date: Thu,  9 Jun 2011 17:00:45 +1000 (EST)
Subject: [Rd] Install R 2.14 From Source : lattice Error
Message-ID: <20110609170045.BLZ20101@gimr.garvan.unsw.edu.au>

I'm installing the latest development version of R on Ubuntu 10.04 

Revision: 56096
Last Changed Date: 2011-06-08

and the make command runs for a while, then I get :

** testing if installed package can be loaded
Error in dyn.load(file, DLLpath = DLLpath, ...) : 
  unable to load shared object '/usr/local/lib64/R/library/lattice/libs/lattice.so':
  libR.so: cannot open shared object file: No such file or directory
Error : package 'lattice' could not be loaded
Error: loading failed
Execution halted

I'm not sure why it is referring to a file in /usr/local since I did 
./configure --prefix=/home/darstr/tmp/R-devel
before make.

Also, the file mentioned in the error exists and is readable.
$ ls -l /usr/local/lib64/R/library/lattice/libs/lattice.so
-rwxr-xr-x 1 root root 31813 2011-06-07 13:17 /usr/local/lib64/R/library/lattice/libs/lattice.so

What should I try next ?

--------------------------------------
Dario Strbenac
Research Assistant
Cancer Epigenetics
Garvan Institute of Medical Research
Darlinghurst NSW 2010
Australia


From oliver at first.in-berlin.de  Thu Jun  9 13:27:15 2011
From: oliver at first.in-berlin.de (oliver)
Date: Thu, 9 Jun 2011 13:27:15 +0200
Subject: [Rd] "warning: assignment discards qualifiers from pointer
 target type"
In-Reply-To: <86C9E656-BCF4-48C8-8016-877DFAA0D158@r-project.org>
References: <20110607130854.GA4510@siouxsie> <4DEE3786.5000800@gmail.com>
	<alpine.LFD.2.02.1106071606010.26985@gannet.stats.ox.ac.uk>
	<20110608160839.GA11746@siouxsie>
	<B68723F7-F66B-40FD-AE38-0A88C0C51B82@r-project.org>
	<20110609001731.GA3565@siouxsie> <20110609003209.GA4839@siouxsie>
	<86C9E656-BCF4-48C8-8016-877DFAA0D158@r-project.org>
Message-ID: <20110609112715.GA3855@siouxsie>

On Wed, Jun 08, 2011 at 08:35:34PM -0400, Simon Urbanek wrote:
> 
> On Jun 8, 2011, at 8:32 PM, oliver wrote:
> 
> > On Thu, Jun 09, 2011 at 02:17:31AM +0200, oliver wrote:
> > [...]
> >> OK, I looked at this now.
> >> 
> >> LENGTH() checks the length of the vector.
> >> 
> >> Good to know this.
> >> 
> >> So the problem of a vector of length 0 can be with any arguments of type SEXP,
> >> hence I will need to check ANY arg on it's length.
> >> 
> >> This is vital to stability under any situation.
> >> 
> >> Thanks for this valuable hint!
> >> 
> >> I will add checks for all my SEXP-args.
> > [...]
> > 
> > Hey, LENGTH() does not work with String-vectors! :(
> > 
> 
> Of course it does ...
> 
> 

It does not so on my R 2.10.1 installation.


In the R-Shell I get:

  ==============================
  > length(c())
  [1] 0
  > 
  ==============================

So c() is vec of length 0.

When I feed my readjpeg() with c() as filename arg,

testing with:
====================================================
  if( LENGTH( filename_sexp ) < 1 )
  {
    error("LENGTH( filename_sexp ) < 1");
    //error("filename can't be vector of length 0");
  }
  else
  {
    error("LENGTH( filename_sexp ) is not < 1");
  }
====================================================


I got:
  Error in readjpeg(filename = c()) : LENGTH( filename_sexp ) is not < 1


You can explain why?


Ciao,
   Oliver


From oliver at first.in-berlin.de  Thu Jun  9 13:32:52 2011
From: oliver at first.in-berlin.de (oliver)
Date: Thu, 9 Jun 2011 13:32:52 +0200
Subject: [Rd] Ctrl-C of functions that allocated mem
In-Reply-To: <FF0548F3-A51E-426E-8D18-367E34FD61E2@r-project.org>
References: <20110609000627.GA3482@siouxsie>
	<FF0548F3-A51E-426E-8D18-367E34FD61E2@r-project.org>
Message-ID: <20110609113252.GB3855@siouxsie>

On Wed, Jun 08, 2011 at 08:40:21PM -0400, Simon Urbanek wrote:
> 
> On Jun 8, 2011, at 8:06 PM, oliver wrote:
> 
> > 
> > Hello,
> > 
> > 
> > what happens, when a function (R-extension in C), that allocated memory
> > (strdup(), malloc()/calloc() and so on), and is used in interactive mode, then
> > will be stopped via Ctrl-C?
> > 
> > I would assume that there remains allocated memory,
> > which is not usable and also not accessable (hence no
> > way to free it).
> > 
> > Are there any mechanisms in R that could help in rolling
> > back the allocation?
> > 
> 
> Yes, if you read R-exts:
> http://r.research.att.com/man/R-exts.html#Memory-allocation
> you would know that you're not supposed to use malloc/calloc at all and if you allow interruption ("regular" C code does not) R_alloc does what you asked about.

OK.

There are some pages I didn't read so far.

I'm just too unpatient....
...maybe should go on reading ;)

Thanks for the hint to the R-exts.html.

.... I hope there I also will find a solution for my
filename-problem: want a char* on a filename, must use
const char* (strdup() would match that issue), and
I should not use my own allocation mechanisms.
Then there must be something to address this.

Ciao,
   Oliver


From murdoch.duncan at gmail.com  Thu Jun  9 13:43:20 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 09 Jun 2011 07:43:20 -0400
Subject: [Rd] "warning: assignment discards qualifiers from pointer
 target type"
In-Reply-To: <20110609112715.GA3855@siouxsie>
References: <20110607130854.GA4510@siouxsie>
	<4DEE3786.5000800@gmail.com>	<alpine.LFD.2.02.1106071606010.26985@gannet.stats.ox.ac.uk>	<20110608160839.GA11746@siouxsie>	<B68723F7-F66B-40FD-AE38-0A88C0C51B82@r-project.org>	<20110609001731.GA3565@siouxsie>
	<20110609003209.GA4839@siouxsie>	<86C9E656-BCF4-48C8-8016-877DFAA0D158@r-project.org>
	<20110609112715.GA3855@siouxsie>
Message-ID: <4DF0B1D8.4080605@gmail.com>

On 11-06-09 7:27 AM, oliver wrote:
> On Wed, Jun 08, 2011 at 08:35:34PM -0400, Simon Urbanek wrote:
>>
>> On Jun 8, 2011, at 8:32 PM, oliver wrote:
>>
>>> On Thu, Jun 09, 2011 at 02:17:31AM +0200, oliver wrote:
>>> [...]
>>>> OK, I looked at this now.
>>>>
>>>> LENGTH() checks the length of the vector.
>>>>
>>>> Good to know this.
>>>>
>>>> So the problem of a vector of length 0 can be with any arguments of type SEXP,
>>>> hence I will need to check ANY arg on it's length.
>>>>
>>>> This is vital to stability under any situation.
>>>>
>>>> Thanks for this valuable hint!
>>>>
>>>> I will add checks for all my SEXP-args.
>>> [...]
>>>
>>> Hey, LENGTH() does not work with String-vectors! :(
>>>
>>
>> Of course it does ...
>>
>>
>
> It does not so on my R 2.10.1 installation.
>
>
> In the R-Shell I get:
>
>    ==============================
>    >  length(c())
>    [1] 0
>    >
>    ==============================
>
> So c() is vec of length 0.
>
> When I feed my readjpeg() with c() as filename arg,
>
> testing with:
> ====================================================
>    if( LENGTH( filename_sexp )<  1 )
>    {
>      error("LENGTH( filename_sexp )<  1");
>      //error("filename can't be vector of length 0");
>    }
>    else
>    {
>      error("LENGTH( filename_sexp ) is not<  1");
>    }
> ====================================================
>
>
> I got:
>    Error in readjpeg(filename = c()) : LENGTH( filename_sexp ) is not<  1
>
>
> You can explain why?

c() doesn't create a STRSXP, it is NULL, which is a NILSXP.  LENGTH() 
doesn't work on that object.  (I'd recommend using length() rather than 
LENGTH(); it's a function, not a macro, and it does give the expected 
answer.)

Duncan Murdoch


From janko.thyson.rstuff at googlemail.com  Thu Jun  9 15:07:30 2011
From: janko.thyson.rstuff at googlemail.com (Janko Thyson)
Date: Thu, 09 Jun 2011 15:07:30 +0200
Subject: [Rd] Rtools (Windows XP): what dir is meant by "R source directory"?
Message-ID: <4DF0C592.30105@googlemail.com>

Dear list,

thanks for providing such a great thing as the Rtools! Everytime I 
install it, though, I'm somewhat "puzzled" when it comes to the section 
"Select R Source Home Directory" (32 bit and 64 builds).
Is the folder that I need to specify here
a) simply the root folder of my R installation (e.g. C:/R/R-2.13.0),
b) a subfolder of the above R installation folder (e.g. 
C:/R/R-2.13.0/src, C:/R/R-2-13.0/bin/src or C:/R/R-2-13.0/bin/i386/src),
c) or does this just come into play when I try to build R from source, 
i.e. the folder where I would put the R tar.gz file?

I always choose the paths C:\R\R-2.13.0\bin\i386\src (32 bit) and 
C:\R\R-2.13.0\bin\src (64 bit). Would this be okay?

Thanks a lot for helping me out on this,
Janko


From oliver at first.in-berlin.de  Thu Jun  9 15:28:18 2011
From: oliver at first.in-berlin.de (oliver)
Date: Thu, 9 Jun 2011 15:28:18 +0200
Subject: [Rd] "warning: assignment discards qualifiers from pointer
 target type"
In-Reply-To: <4DF0B1D8.4080605@gmail.com>
References: <20110607130854.GA4510@siouxsie> <4DEE3786.5000800@gmail.com>
	<alpine.LFD.2.02.1106071606010.26985@gannet.stats.ox.ac.uk>
	<20110608160839.GA11746@siouxsie>
	<B68723F7-F66B-40FD-AE38-0A88C0C51B82@r-project.org>
	<20110609001731.GA3565@siouxsie> <20110609003209.GA4839@siouxsie>
	<86C9E656-BCF4-48C8-8016-877DFAA0D158@r-project.org>
	<20110609112715.GA3855@siouxsie> <4DF0B1D8.4080605@gmail.com>
Message-ID: <20110609132817.GA5438@siouxsie>

On Thu, Jun 09, 2011 at 07:43:20AM -0400, Duncan Murdoch wrote:
> On 11-06-09 7:27 AM, oliver wrote:
> >On Wed, Jun 08, 2011 at 08:35:34PM -0400, Simon Urbanek wrote:
> >>
> >>On Jun 8, 2011, at 8:32 PM, oliver wrote:
> >>
> >>>On Thu, Jun 09, 2011 at 02:17:31AM +0200, oliver wrote:
> >>>[...]
> >>>>OK, I looked at this now.
> >>>>
> >>>>LENGTH() checks the length of the vector.
> >>>>
> >>>>Good to know this.
> >>>>
> >>>>So the problem of a vector of length 0 can be with any arguments of type SEXP,
> >>>>hence I will need to check ANY arg on it's length.
> >>>>
> >>>>This is vital to stability under any situation.
> >>>>
> >>>>Thanks for this valuable hint!
> >>>>
> >>>>I will add checks for all my SEXP-args.
> >>>[...]
> >>>
> >>>Hey, LENGTH() does not work with String-vectors! :(
> >>>
> >>
> >>Of course it does ...
> >>
> >>
> >
> >It does not so on my R 2.10.1 installation.
> >
> >
> >In the R-Shell I get:
> >
> >   ==============================
> >   >  length(c())
> >   [1] 0
> >   >
> >   ==============================
> >
> >So c() is vec of length 0.
> >
> >When I feed my readjpeg() with c() as filename arg,
> >
> >testing with:
> >====================================================
> >   if( LENGTH( filename_sexp )<  1 )
> >   {
> >     error("LENGTH( filename_sexp )<  1");
> >     //error("filename can't be vector of length 0");
> >   }
> >   else
> >   {
> >     error("LENGTH( filename_sexp ) is not<  1");
> >   }
> >====================================================
> >
> >
> >I got:
> >   Error in readjpeg(filename = c()) : LENGTH( filename_sexp ) is not<  1
> >
> >
> >You can explain why?
> 
> c() doesn't create a STRSXP, it is NULL, which is a NILSXP.
> LENGTH() doesn't work on that object.  (I'd recommend using length()
> rather than LENGTH(); it's a function, not a macro, and it does give
> the expected answer.)
[...]

Interestingly, c() as value for an integer value
can be testes correctly with LENGTH().

So the question arises: is c() always creating NILSXP,
or is it NILSXP only for STRSXP, and 0 otherwise?

NILSXP, as it might be close to a NULL might be interpreted as 0
length by LENGTH...

Nevertheless it's a littlebid confusing for people who don't know the
internals of R.

Will try length() soon.

Ciao,
   Oliver



P.S.: To be picky: NOT knowing the internals and nevertheless using the available
      functions/macros is called encapsulation in OO or the difference between
      interface and implementation... which is good style of programming.


From ligges at statistik.tu-dortmund.de  Thu Jun  9 15:58:42 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Thu, 09 Jun 2011 15:58:42 +0200
Subject: [Rd] Rtools (Windows XP): what dir is meant by "R source
	directory"?
In-Reply-To: <4DF0C592.30105@googlemail.com>
References: <4DF0C592.30105@googlemail.com>
Message-ID: <4DF0D192.6090506@statistik.tu-dortmund.de>



On 09.06.2011 15:07, Janko Thyson wrote:
> Dear list,
>
> thanks for providing such a great thing as the Rtools! Everytime I
> install it, though, I'm somewhat "puzzled" when it comes to the section
> "Select R Source Home Directory" (32 bit and 64 builds).
> Is the folder that I need to specify here
> a) simply the root folder of my R installation (e.g. C:/R/R-2.13.0),
> b) a subfolder of the above R installation folder (e.g.
> C:/R/R-2.13.0/src, C:/R/R-2-13.0/bin/src or C:/R/R-2-13.0/bin/i386/src),
> c) or does this just come into play when I try to build R from source,
> i.e. the folder where I would put the R tar.gz file?


Yes, c) is the answer.

Uwe

> I always choose the paths C:\R\R-2.13.0\bin\i386\src (32 bit) and
> C:\R\R-2.13.0\bin\src (64 bit). Would this be okay?
>
> Thanks a lot for helping me out on this,
> Janko
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From oliver at first.in-berlin.de  Thu Jun  9 16:42:33 2011
From: oliver at first.in-berlin.de (oliver)
Date: Thu, 9 Jun 2011 16:42:33 +0200
Subject: [Rd] Ctrl-C of functions that allocated mem
In-Reply-To: <FF0548F3-A51E-426E-8D18-367E34FD61E2@r-project.org>
References: <20110609000627.GA3482@siouxsie>
	<FF0548F3-A51E-426E-8D18-367E34FD61E2@r-project.org>
Message-ID: <20110609144233.GA5957@siouxsie>

On Wed, Jun 08, 2011 at 08:40:21PM -0400, Simon Urbanek wrote:
> 
> On Jun 8, 2011, at 8:06 PM, oliver wrote:
> 
> > 
> > Hello,
> > 
> > 
> > what happens, when a function (R-extension in C), that allocated memory
> > (strdup(), malloc()/calloc() and so on), and is used in interactive mode, then
> > will be stopped via Ctrl-C?
> > 
> > I would assume that there remains allocated memory,
> > which is not usable and also not accessable (hence no
> > way to free it).
> > 
> > Are there any mechanisms in R that could help in rolling
> > back the allocation?
> > 
> 
> Yes, if you read R-exts:
> http://r.research.att.com/man/R-exts.html#Memory-allocation
> you would know that you're not supposed to use malloc/calloc at all and if
> you allow interruption ("regular" C code does not) R_alloc does what you asked
> about.
[...]

In the printed (pdf) version of R-exts I found that
R_alloc()  and S_alloc() and some other functions
from section 6.1.1 have return type char*.

This seesm to be a relict from the K&R era,
because since ANSI C  void*  is the type for generic pointers.

will it be changed in the future, so that
R_alloc() will be  void* R_alloc() one day?


Ciao,
   Oliver


From oliver at first.in-berlin.de  Thu Jun  9 16:52:09 2011
From: oliver at first.in-berlin.de (oliver)
Date: Thu, 9 Jun 2011 16:52:09 +0200
Subject: [Rd] Ctrl-C of functions that allocated mem
In-Reply-To: <20110609144233.GA5957@siouxsie>
References: <20110609000627.GA3482@siouxsie>
	<FF0548F3-A51E-426E-8D18-367E34FD61E2@r-project.org>
	<20110609144233.GA5957@siouxsie>
Message-ID: <20110609145209.GA6936@siouxsie>

On Thu, Jun 09, 2011 at 04:42:33PM +0200, oliver wrote:
> On Wed, Jun 08, 2011 at 08:40:21PM -0400, Simon Urbanek wrote:
> > 
> > On Jun 8, 2011, at 8:06 PM, oliver wrote:
> > 
> > > 
> > > Hello,
> > > 
> > > 
> > > what happens, when a function (R-extension in C), that allocated memory
> > > (strdup(), malloc()/calloc() and so on), and is used in interactive mode, then
> > > will be stopped via Ctrl-C?
> > > 
> > > I would assume that there remains allocated memory,
> > > which is not usable and also not accessable (hence no
> > > way to free it).
> > > 
> > > Are there any mechanisms in R that could help in rolling
> > > back the allocation?
> > > 
> > 
> > Yes, if you read R-exts:
> > http://r.research.att.com/man/R-exts.html#Memory-allocation
> > you would know that you're not supposed to use malloc/calloc at all and if
> > you allow interruption ("regular" C code does not) R_alloc does what you asked
> > about.
> [...]
> 
> In the printed (pdf) version of R-exts I found that
> R_alloc()  and S_alloc() and some other functions
> from section 6.1.1 have return type char*.
> 
> This seesm to be a relict from the K&R era,
> because since ANSI C  void*  is the type for generic pointers.
> 
> will it be changed in the future, so that
> R_alloc() will be  void* R_alloc() one day?
[...]


..and btw: when casting to (void*)  instead of mytype*
(as is seen on page 122 of "Writing R Extensions" (2011-04-13)
t's much better.

The the pointer is generic and will automatically be correctly
assigned to the left hand side.

But better would be of course to avoid any casts and make the
return type of the alloc-functions void*.


Ciao,
  Oliver


From murdoch.duncan at gmail.com  Thu Jun  9 16:54:28 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 09 Jun 2011 10:54:28 -0400
Subject: [Rd] "warning: assignment discards qualifiers from pointer
 target type"
In-Reply-To: <20110609132817.GA5438@siouxsie>
References: <20110607130854.GA4510@siouxsie> <4DEE3786.5000800@gmail.com>
	<alpine.LFD.2.02.1106071606010.26985@gannet.stats.ox.ac.uk>
	<20110608160839.GA11746@siouxsie>
	<B68723F7-F66B-40FD-AE38-0A88C0C51B82@r-project.org>
	<20110609001731.GA3565@siouxsie> <20110609003209.GA4839@siouxsie>
	<86C9E656-BCF4-48C8-8016-877DFAA0D158@r-project.org>
	<20110609112715.GA3855@siouxsie> <4DF0B1D8.4080605@gmail.com>
	<20110609132817.GA5438@siouxsie>
Message-ID: <4DF0DEA4.9000602@gmail.com>

On 09/06/2011 9:28 AM, oliver wrote:
> On Thu, Jun 09, 2011 at 07:43:20AM -0400, Duncan Murdoch wrote:
> >  On 11-06-09 7:27 AM, oliver wrote:
> >  >On Wed, Jun 08, 2011 at 08:35:34PM -0400, Simon Urbanek wrote:
> >  >>
> >  >>On Jun 8, 2011, at 8:32 PM, oliver wrote:
> >  >>
> >  >>>On Thu, Jun 09, 2011 at 02:17:31AM +0200, oliver wrote:
> >  >>>[...]
> >  >>>>OK, I looked at this now.
> >  >>>>
> >  >>>>LENGTH() checks the length of the vector.
> >  >>>>
> >  >>>>Good to know this.
> >  >>>>
> >  >>>>So the problem of a vector of length 0 can be with any arguments of type SEXP,
> >  >>>>hence I will need to check ANY arg on it's length.
> >  >>>>
> >  >>>>This is vital to stability under any situation.
> >  >>>>
> >  >>>>Thanks for this valuable hint!
> >  >>>>
> >  >>>>I will add checks for all my SEXP-args.
> >  >>>[...]
> >  >>>
> >  >>>Hey, LENGTH() does not work with String-vectors! :(
> >  >>>
> >  >>
> >  >>Of course it does ...
> >  >>
> >  >>
> >  >
> >  >It does not so on my R 2.10.1 installation.
> >  >
> >  >
> >  >In the R-Shell I get:
> >  >
> >  >    ==============================
> >  >    >   length(c())
> >  >    [1] 0
> >  >    >
> >  >    ==============================
> >  >
> >  >So c() is vec of length 0.
> >  >
> >  >When I feed my readjpeg() with c() as filename arg,
> >  >
> >  >testing with:
> >  >====================================================
> >  >    if( LENGTH( filename_sexp )<   1 )
> >  >    {
> >  >      error("LENGTH( filename_sexp )<   1");
> >  >      //error("filename can't be vector of length 0");
> >  >    }
> >  >    else
> >  >    {
> >  >      error("LENGTH( filename_sexp ) is not<   1");
> >  >    }
> >  >====================================================
> >  >
> >  >
> >  >I got:
> >  >    Error in readjpeg(filename = c()) : LENGTH( filename_sexp ) is not<   1
> >  >
> >  >
> >  >You can explain why?
> >
> >  c() doesn't create a STRSXP, it is NULL, which is a NILSXP.
> >  LENGTH() doesn't work on that object.  (I'd recommend using length()
> >  rather than LENGTH(); it's a function, not a macro, and it does give
> >  the expected answer.)
> [...]
>
> Interestingly, c() as value for an integer value
> can be testes correctly with LENGTH().

Presumably you converted it to an INTSXP.  c() is NULL.

> So the question arises: is c() always creating NILSXP,
> or is it NILSXP only for STRSXP, and 0 otherwise?

That question makes no sense at all.

Duncan Murdoch

> NILSXP, as it might be close to a NULL might be interpreted as 0
> length by LENGTH...
>
> Nevertheless it's a littlebid confusing for people who don't know the
> internals of R.
>
> Will try length() soon.
>
> Ciao,
>     Oliver
>
>
>
> P.S.: To be picky: NOT knowing the internals and nevertheless using the available
>        functions/macros is called encapsulation in OO or the difference between
>        interface and implementation... which is good style of programming.
>


From oliver at first.in-berlin.de  Thu Jun  9 17:04:37 2011
From: oliver at first.in-berlin.de (oliver)
Date: Thu, 9 Jun 2011 17:04:37 +0200
Subject: [Rd] success of R_alloc (Re: Ctrl-C of functions that allocated mem)
In-Reply-To: <20110609145209.GA6936@siouxsie>
References: <20110609000627.GA3482@siouxsie>
	<FF0548F3-A51E-426E-8D18-367E34FD61E2@r-project.org>
	<20110609144233.GA5957@siouxsie> <20110609145209.GA6936@siouxsie>
Message-ID: <20110609150437.GA7827@siouxsie>


In section 6.1.2 of Writing R Extensions, it is mentioned that
if the function returns, success can be assumed.

In section 6.1.1 this is not mentioned, but I assume the same holds true there too,
even it is not mentioned there.


Ciao,
   Oliver


From oliver at first.in-berlin.de  Thu Jun  9 17:15:04 2011
From: oliver at first.in-berlin.de (oliver)
Date: Thu, 9 Jun 2011 17:15:04 +0200
Subject: [Rd] "warning: assignment discards qualifiers from pointer
 target type"
In-Reply-To: <4DF0DEA4.9000602@gmail.com>
References: <alpine.LFD.2.02.1106071606010.26985@gannet.stats.ox.ac.uk>
	<20110608160839.GA11746@siouxsie>
	<B68723F7-F66B-40FD-AE38-0A88C0C51B82@r-project.org>
	<20110609001731.GA3565@siouxsie> <20110609003209.GA4839@siouxsie>
	<86C9E656-BCF4-48C8-8016-877DFAA0D158@r-project.org>
	<20110609112715.GA3855@siouxsie> <4DF0B1D8.4080605@gmail.com>
	<20110609132817.GA5438@siouxsie> <4DF0DEA4.9000602@gmail.com>
Message-ID: <20110609151504.GB7827@siouxsie>

On Thu, Jun 09, 2011 at 10:54:28AM -0400, Duncan Murdoch wrote:
> On 09/06/2011 9:28 AM, oliver wrote:
> >On Thu, Jun 09, 2011 at 07:43:20AM -0400, Duncan Murdoch wrote:
> >>  On 11-06-09 7:27 AM, oliver wrote:
> >>  >On Wed, Jun 08, 2011 at 08:35:34PM -0400, Simon Urbanek wrote:
> >>  >>
> >>  >>On Jun 8, 2011, at 8:32 PM, oliver wrote:
> >>  >>
> >>  >>>On Thu, Jun 09, 2011 at 02:17:31AM +0200, oliver wrote:
> >>  >>>[...]
> >>  >>>>OK, I looked at this now.
> >>  >>>>
> >>  >>>>LENGTH() checks the length of the vector.
> >>  >>>>
> >>  >>>>Good to know this.
> >>  >>>>
> >>  >>>>So the problem of a vector of length 0 can be with any arguments of type SEXP,
> >>  >>>>hence I will need to check ANY arg on it's length.
> >>  >>>>
> >>  >>>>This is vital to stability under any situation.
> >>  >>>>
> >>  >>>>Thanks for this valuable hint!
> >>  >>>>
> >>  >>>>I will add checks for all my SEXP-args.
> >>  >>>[...]
> >>  >>>
> >>  >>>Hey, LENGTH() does not work with String-vectors! :(
> >>  >>>
> >>  >>
> >>  >>Of course it does ...
> >>  >>
> >>  >>
> >>  >
> >>  >It does not so on my R 2.10.1 installation.
> >>  >
> >>  >
> >>  >In the R-Shell I get:
> >>  >
> >>  >    ==============================
> >>  >    >   length(c())
> >>  >    [1] 0
> >>  >    >
> >>  >    ==============================
> >>  >
> >>  >So c() is vec of length 0.
> >>  >
> >>  >When I feed my readjpeg() with c() as filename arg,
> >>  >
> >>  >testing with:
> >>  >====================================================
> >>  >    if( LENGTH( filename_sexp )<   1 )
> >>  >    {
> >>  >      error("LENGTH( filename_sexp )<   1");
> >>  >      //error("filename can't be vector of length 0");
> >>  >    }
> >>  >    else
> >>  >    {
> >>  >      error("LENGTH( filename_sexp ) is not<   1");
> >>  >    }
> >>  >====================================================
> >>  >
> >>  >
> >>  >I got:
> >>  >    Error in readjpeg(filename = c()) : LENGTH( filename_sexp ) is not<   1
> >>  >
> >>  >
> >>  >You can explain why?
> >>
> >>  c() doesn't create a STRSXP, it is NULL, which is a NILSXP.
> >>  LENGTH() doesn't work on that object.  (I'd recommend using length()
> >>  rather than LENGTH(); it's a function, not a macro, and it does give
> >>  the expected answer.)
> >[...]
> >
> >Interestingly, c() as value for an integer value
> >can be testes correctly with LENGTH().
> 
> Presumably you converted it to an INTSXP.  c() is NULL.
[...]

Ooops, yes. In the R-part. :-)
I did it, because when I don't get an int from the user's call,
I have set it to NA (default in the R-function definition).

I made
  width <- as.integer(width)
for easy check inside the C-part, on integer.

(I really only need int, no floating point values.)

I thought this makes the C-code easier at that part.

Or I may check on NA inside the C-part.

How would I do that correctly?

After so much different opinions I read here, I'm rather puzzled on that now.

If there is already a R-extensions-FAQ I could collect the informations
from the mail sof the last days, so that the different opinions and the discussion
can result in a some answers...


> 
> >So the question arises: is c() always creating NILSXP,
> >or is it NILSXP only for STRSXP, and 0 otherwise?
> 
> That question makes no sense at all.

It make sense for the picky.
As NULL is rather (void*)0  and a pointer is not an int (just can be coerced normally) ;)


Ciao,
  Oliver


From janko.thyson.rstuff at googlemail.com  Thu Jun  9 17:29:32 2011
From: janko.thyson.rstuff at googlemail.com (Janko Thyson)
Date: Thu, 09 Jun 2011 17:29:32 +0200
Subject: [Rd] Rtools (Windows XP): what dir is meant by "R source
	directory"?
In-Reply-To: <4DF0D192.6090506@statistik.tu-dortmund.de>
References: <4DF0C592.30105@googlemail.com>
	<4DF0D192.6090506@statistik.tu-dortmund.de>
Message-ID: <4DF0E6DC.70509@googlemail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110609/e9265aca/attachment.pl>

From proebuck at mdanderson.org  Thu Jun  9 17:39:15 2011
From: proebuck at mdanderson.org (Roebuck,Paul L)
Date: Thu, 9 Jun 2011 10:39:15 -0500
Subject: [Rd] Data package questions
Message-ID: <CA165353.1B3D6%proebuck@mdanderson.org>

In process of creating data package from an existing one.
The current package has both raw data files and the associated
RData objects created from them. Currently, the data subdirectory
is 1.5Mb and the extdata is 5.4Mb.

Never having created a data package before, how is this best
done? Should the data package contain only the raw data, or
the RData objects too (tightly coupled)? If the later, what
(if anything) is added to the DESCRIPTION meta-information
to denote the dependency? Should both packages suggest each
other?


From simon.urbanek at r-project.org  Thu Jun  9 18:42:40 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 9 Jun 2011 12:42:40 -0400
Subject: [Rd] Install R 2.14 From Source : lattice Error
In-Reply-To: <20110609170045.BLZ20101@gimr.garvan.unsw.edu.au>
References: <20110609170045.BLZ20101@gimr.garvan.unsw.edu.au>
Message-ID: <001C059A-ED72-4E22-AC01-ED894B4411F3@r-project.org>


On Jun 9, 2011, at 3:00 AM, Dario Strbenac wrote:

> I'm installing the latest development version of R on Ubuntu 10.04 
> 
> Revision: 56096
> Last Changed Date: 2011-06-08
> 
> and the make command runs for a while, then I get :
> 
> ** testing if installed package can be loaded
> Error in dyn.load(file, DLLpath = DLLpath, ...) : 
>  unable to load shared object '/usr/local/lib64/R/library/lattice/libs/lattice.so':
>  libR.so: cannot open shared object file: No such file or directory
> Error : package 'lattice' could not be loaded
> Error: loading failed
> Execution halted
> 
> I'm not sure why it is referring to a file in /usr/local since I did 
> ./configure --prefix=/home/darstr/tmp/R-devel
> before make.
> 
> Also, the file mentioned in the error exists and is readable.
> $ ls -l /usr/local/lib64/R/library/lattice/libs/lattice.so
> -rwxr-xr-x 1 root root 31813 2011-06-07 13:17 /usr/local/lib64/R/library/lattice/libs/lattice.so
> 

Yes, but it's the wrong file.


> What should I try next ?
> 

You're apparently using the wrong R and/or have packages from different R installations around. The lattice you see is from another R that was compiled with --enable-R-shlib while you configured R without it so they are incompatible. Make sure you installed your compiled R properly and don't mix packages between the R installations (see .libPaths() in R).

Cheers,
Simon


From simon.urbanek at r-project.org  Thu Jun  9 18:56:09 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 9 Jun 2011 12:56:09 -0400
Subject: [Rd] "warning: assignment discards qualifiers from pointer
	target type"
In-Reply-To: <20110609151504.GB7827@siouxsie>
References: <alpine.LFD.2.02.1106071606010.26985@gannet.stats.ox.ac.uk>
	<20110608160839.GA11746@siouxsie>
	<B68723F7-F66B-40FD-AE38-0A88C0C51B82@r-project.org>
	<20110609001731.GA3565@siouxsie> <20110609003209.GA4839@siouxsie>
	<86C9E656-BCF4-48C8-8016-877DFAA0D158@r-project.org>
	<20110609112715.GA3855@siouxsie> <4DF0B1D8.4080605@gmail.com>
	<20110609132817.GA5438@siouxsie> <4DF0DEA4.9000602@gmail.com>
	<20110609151504.GB7827@siouxsie>
Message-ID: <D8A04905-36D7-4898-867B-2F76F66CA1BB@r-project.org>


On Jun 9, 2011, at 11:15 AM, oliver wrote:

> On Thu, Jun 09, 2011 at 10:54:28AM -0400, Duncan Murdoch wrote:
>> On 09/06/2011 9:28 AM, oliver wrote:
>>> On Thu, Jun 09, 2011 at 07:43:20AM -0400, Duncan Murdoch wrote:
>>>> On 11-06-09 7:27 AM, oliver wrote:
>>>>> On Wed, Jun 08, 2011 at 08:35:34PM -0400, Simon Urbanek wrote:
>>>>>> 
>>>>>> On Jun 8, 2011, at 8:32 PM, oliver wrote:
>>>>>> 
>>>>>>> On Thu, Jun 09, 2011 at 02:17:31AM +0200, oliver wrote:
>>>>>>> [...]
>>>>>>>> OK, I looked at this now.
>>>>>>>> 
>>>>>>>> LENGTH() checks the length of the vector.
>>>>>>>> 
>>>>>>>> Good to know this.
>>>>>>>> 
>>>>>>>> So the problem of a vector of length 0 can be with any arguments of type SEXP,
>>>>>>>> hence I will need to check ANY arg on it's length.
>>>>>>>> 
>>>>>>>> This is vital to stability under any situation.
>>>>>>>> 
>>>>>>>> Thanks for this valuable hint!
>>>>>>>> 
>>>>>>>> I will add checks for all my SEXP-args.
>>>>>>> [...]
>>>>>>> 
>>>>>>> Hey, LENGTH() does not work with String-vectors! :(
>>>>>>> 
>>>>>> 
>>>>>> Of course it does ...
>>>>>> 
>>>>>> 
>>>>> 
>>>>> It does not so on my R 2.10.1 installation.
>>>>> 
>>>>> 
>>>>> In the R-Shell I get:
>>>>> 
>>>>>   ==============================
>>>>>>  length(c())
>>>>>   [1] 0
>>>>>> 
>>>>>   ==============================
>>>>> 
>>>>> So c() is vec of length 0.
>>>>> 
>>>>> When I feed my readjpeg() with c() as filename arg,
>>>>> 
>>>>> testing with:
>>>>> ====================================================
>>>>>   if( LENGTH( filename_sexp )<   1 )
>>>>>   {
>>>>>     error("LENGTH( filename_sexp )<   1");
>>>>>     //error("filename can't be vector of length 0");
>>>>>   }
>>>>>   else
>>>>>   {
>>>>>     error("LENGTH( filename_sexp ) is not<   1");
>>>>>   }
>>>>> ====================================================
>>>>> 
>>>>> 
>>>>> I got:
>>>>>   Error in readjpeg(filename = c()) : LENGTH( filename_sexp ) is not<   1
>>>>> 
>>>>> 
>>>>> You can explain why?
>>>> 
>>>> c() doesn't create a STRSXP, it is NULL, which is a NILSXP.
>>>> LENGTH() doesn't work on that object.  (I'd recommend using length()
>>>> rather than LENGTH(); it's a function, not a macro, and it does give
>>>> the expected answer.)
>>> [...]
>>> 
>>> Interestingly, c() as value for an integer value
>>> can be testes correctly with LENGTH().
>> 
>> Presumably you converted it to an INTSXP.  c() is NULL.
> [...]
> 
> Ooops, yes. In the R-part. :-)
> I did it, because when I don't get an int from the user's call,
> I have set it to NA (default in the R-function definition).
> 
> I made
>  width <- as.integer(width)
> for easy check inside the C-part, on integer.
> 
> (I really only need int, no floating point values.)
> 
> I thought this makes the C-code easier at that part.
> 
> Or I may check on NA inside the C-part.
> 
> How would I do that correctly?
> 
> After so much different opinions I read here, I'm rather puzzled on that now.
> 
> If there is already a R-extensions-FAQ I could collect the informations
> from the mail sof the last days, so that the different opinions and the discussion
> can result in a some answers...
> 

So far you were creating the confusion, the facts are fairly simple if you have some clue about C and R. I would like to ask you to, please, read and understand C standard and R-exts *before* posting further questions since it's pointless if we provide answers that you don't understand. The fact that you are impatient (as you said yourself) doesn't entitle you to waste other people's time to explain things to you while you are unwilling to take the time yourself. If you have serious question beyond what is documented, feel free to ask, but make sure you have spent the time to think about it before you do so.


>> 
>>> So the question arises: is c() always creating NILSXP,
>>> or is it NILSXP only for STRSXP, and 0 otherwise?
>> 
>> That question makes no sense at all.
> 
> It make sense for the picky.
> As NULL is rather (void*)0  and a pointer is not an int (just can be coerced normally) ;)
> 

It's not - you're confusing NULL in R with NULL in C.
Both NILSXP and STRSXP are SEXP types - and obviously distinct ones. R will never return a null pointer for a SEXP.

Cheers,
Simon


From jmc at r-project.org  Thu Jun  9 19:11:21 2011
From: jmc at r-project.org (John Chambers)
Date: Thu, 09 Jun 2011 10:11:21 -0700
Subject: [Rd] Reference Class error message: may be caused by
	lazy	evaluation?
In-Reply-To: <BANLkTimEJ=S-rk=QhidM8qEGQETmupr7kw@mail.gmail.com>
References: <BANLkTimEJ=S-rk=QhidM8qEGQETmupr7kw@mail.gmail.com>
Message-ID: <4DF0FEB9.3050208@r-project.org>

Good catch.

Here's the problem.  To save space and time, reference methods are not 
all copied to every object in the class.  Instead, the methods are 
copied in when first accessed.   Methods are functions which use the 
object as their environment.  So that is the sense in which "lazy 
evaluation" is involved.

If a method calls another method (add() calling addOne() in your 
example), then the method for the `$` operator knows to copy over that 
method (addOne).  (The second of my examples below shows this.)  But if 
the method _refers_ to another method without calling it, the code 
analysis does not currently catch the reference.

We can fix that, although it's a little subtle. Meanwhile, your 
showself() is a good workaround.

For anyone interested, the code below illustrates.

One point of style.  I would suggest saving the generator object and 
calling its $new() method, as below, rather than treating the reference 
class as an S4 class.  The result is identical AFAIK, but the style is 
more typical of such OOP languages.

John

---------------------------
 > tc <-  setRefClass("testclass", fields = list(a = "numeric"),
+             methods = list(
....
+               ))
 > t1 <- tc$new(a=1)
 > ss = t1$show
 > ss
Class method definition for method show()
function ()
{
     print(addOne)
}
<environment: 0x10188d5f8>
 > ev = environment(ss)
 > ev
<environment: 0x10188d5f8>
 > t1
An object of class "testclass"
<environment: 0x10188d5f8>  # <<<< same environment
 > objects(ev)
[1] "a"    "show"  #<<<< not addOne, though
 > t1$addOne
Class method definition for method addOne()
function ()
{
     a <<- a + 1
     print(a)
}
<environment: 0x10188d5f8>
 > objects(ev)
[1] "a"      "addOne" "show"  # <<<< now addOne is there


On 6/8/11 4:38 PM, Tengfei Yin wrote:
> Dear All,
>
> I came across an error message recently when constructing a reference class,
> an example is attached below, it looks like only if I call a specific method
> in advance, otherwise it cannot be found in defined method without using
> .self, this make it difficulty that sometimes in my initialize method, I
> need to call other method defined in the same reference class, the
> workaround for this is add .sef to it.
>
>
> ###############  example begin ############################
> setRefClass("testclass", fields = list(a = "numeric"),
>              methods = list(
>                addOne = function(){
>                  a<<- a+1
>                  print(a)
>                },
>                add = function(){
>                  addOne()
>                },
>                show = function(){
>                  print(addOne)
>                },
>                showself = function(){
>                  print(.self$addOne)
>                }
>                ))
>
> obj<- new("testclass", a = 1)
> obj$show()                                                              #
> Error in print(addOne) : object 'addOne' not found
> obj$addOne()                                                           #
> return 2, works
> obj$show()                                                              #
> after calling addOne(), show() works
>
> ## works if use .self$...
> obj2<- new("testclass", a = 1)
> obj2$showself()
>
> ## works when call the method directly within another method
> obj3<- new("testclass", a = 1)
> obj3$add()
>
> ################ end ##########################################
>
> I am still learning this new technique, if I made any mistake I didn't
> notice before, please let me know, I will really appreciate that.
>
> Thanks a lot!
>
> Tengfei
>


From mtmorgan at fhcrc.org  Thu Jun  9 19:28:57 2011
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Thu, 09 Jun 2011 10:28:57 -0700
Subject: [Rd] Reference Class error message: may be caused
	by	lazy	evaluation?
In-Reply-To: <4DF0FEB9.3050208@r-project.org>
References: <BANLkTimEJ=S-rk=QhidM8qEGQETmupr7kw@mail.gmail.com>
	<4DF0FEB9.3050208@r-project.org>
Message-ID: <4DF102D9.5080201@fhcrc.org>

On 06/09/2011 10:11 AM, John Chambers wrote:
> Good catch.
>
> Here's the problem. To save space and time, reference methods are not
> all copied to every object in the class. Instead, the methods are copied
> in when first accessed. Methods are functions which use the object as
> their environment. So that is the sense in which "lazy evaluation" is
> involved.
>
> If a method calls another method (add() calling addOne() in your
> example), then the method for the `$` operator knows to copy over that
> method (addOne). (The second of my examples below shows this.) But if
> the method _refers_ to another method without calling it, the code
> analysis does not currently catch the reference.
>
> We can fix that, although it's a little subtle. Meanwhile, your
> showself() is a good workaround.
>
> For anyone interested, the code below illustrates.
>
> One point of style. I would suggest saving the generator object and
> calling its $new() method, as below, rather than treating the reference
> class as an S4 class. The result is identical AFAIK, but the style is
> more typical of such OOP languages.

I wonder if this is an opportunity to be more authoritarian? It seems to 
be a common temptation to call S4 new() and, for me, introduces a 
source of uncertainty / confusion when trying to understand why code 
does not work.

Martin

>
> John
>
> ---------------------------
>  > tc <- setRefClass("testclass", fields = list(a = "numeric"),
> + methods = list(
> ....
> + ))
>  > t1 <- tc$new(a=1)
>  > ss = t1$show
>  > ss
> Class method definition for method show()
> function ()
> {
> print(addOne)
> }
> <environment: 0x10188d5f8>
>  > ev = environment(ss)
>  > ev
> <environment: 0x10188d5f8>
>  > t1
> An object of class "testclass"
> <environment: 0x10188d5f8> # <<<< same environment
>  > objects(ev)
> [1] "a" "show" #<<<< not addOne, though
>  > t1$addOne
> Class method definition for method addOne()
> function ()
> {
> a <<- a + 1
> print(a)
> }
> <environment: 0x10188d5f8>
>  > objects(ev)
> [1] "a" "addOne" "show" # <<<< now addOne is there
>
>
> On 6/8/11 4:38 PM, Tengfei Yin wrote:
>> Dear All,
>>
>> I came across an error message recently when constructing a reference
>> class,
>> an example is attached below, it looks like only if I call a specific
>> method
>> in advance, otherwise it cannot be found in defined method without using
>> .self, this make it difficulty that sometimes in my initialize method, I
>> need to call other method defined in the same reference class, the
>> workaround for this is add .sef to it.
>>
>>
>> ############### example begin ############################
>> setRefClass("testclass", fields = list(a = "numeric"),
>> methods = list(
>> addOne = function(){
>> a<<- a+1
>> print(a)
>> },
>> add = function(){
>> addOne()
>> },
>> show = function(){
>> print(addOne)
>> },
>> showself = function(){
>> print(.self$addOne)
>> }
>> ))
>>
>> obj<- new("testclass", a = 1)
>> obj$show() #
>> Error in print(addOne) : object 'addOne' not found
>> obj$addOne() #
>> return 2, works
>> obj$show() #
>> after calling addOne(), show() works
>>
>> ## works if use .self$...
>> obj2<- new("testclass", a = 1)
>> obj2$showself()
>>
>> ## works when call the method directly within another method
>> obj3<- new("testclass", a = 1)
>> obj3$add()
>>
>> ################ end ##########################################
>>
>> I am still learning this new technique, if I made any mistake I didn't
>> notice before, please let me know, I will really appreciate that.
>>
>> Thanks a lot!
>>
>> Tengfei
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Computational Biology
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109

Location: M1-B861
Telephone: 206 667-2793


From yintengfei at gmail.com  Thu Jun  9 19:49:42 2011
From: yintengfei at gmail.com (Tengfei Yin)
Date: Thu, 9 Jun 2011 10:49:42 -0700
Subject: [Rd] Reference Class error message: may be caused by lazy
	evaluation?
In-Reply-To: <4DF102D9.5080201@fhcrc.org>
References: <BANLkTimEJ=S-rk=QhidM8qEGQETmupr7kw@mail.gmail.com>
	<4DF0FEB9.3050208@r-project.org> <4DF102D9.5080201@fhcrc.org>
Message-ID: <BANLkTimL0gjpSOW3ZMF+ZnFvheso0F3kEw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110609/469c7997/attachment.pl>

From radford at cs.toronto.edu  Thu Jun  9 21:11:20 2011
From: radford at cs.toronto.edu (Radford Neal)
Date: Thu, 9 Jun 2011 15:11:20 -0400
Subject: [Rd] Patches to speed up R 2.13.0
Message-ID: <20110609191120.GA2658@cs.toronto.edu>

I have created a collection of patches to the R 2.13.0 source that
speed up many operations substantially.  Some of these are related to
the patches I posted in September 2010, though often with additional
improvements.  Other patches are new.  

The patches, along with detailed documentation, are available from

  http://www.cs.utoronto.ca/~radford/R-mods-2.13.0.html

For some discussion of these patches and their benefits, see my blog
post, at 

  http://radfordneal.wordpress.com/2011/06/09/new-patches-to-speed-up-r-2-13-0

I believe that these improvements to the R implementation should be of
substantial benefit to the R community.  The R core team is welcome to
incorporate them into versions of R that they release in the future.

   Radford Neal


From oliver at first.in-berlin.de  Thu Jun  9 23:55:50 2011
From: oliver at first.in-berlin.de (oliver)
Date: Thu, 9 Jun 2011 23:55:50 +0200
Subject: [Rd] "warning: assignment discards qualifiers from pointer
 target type"
In-Reply-To: <D8A04905-36D7-4898-867B-2F76F66CA1BB@r-project.org>
References: <B68723F7-F66B-40FD-AE38-0A88C0C51B82@r-project.org>
	<20110609001731.GA3565@siouxsie> <20110609003209.GA4839@siouxsie>
	<86C9E656-BCF4-48C8-8016-877DFAA0D158@r-project.org>
	<20110609112715.GA3855@siouxsie> <4DF0B1D8.4080605@gmail.com>
	<20110609132817.GA5438@siouxsie> <4DF0DEA4.9000602@gmail.com>
	<20110609151504.GB7827@siouxsie>
	<D8A04905-36D7-4898-867B-2F76F66CA1BB@r-project.org>
Message-ID: <20110609215549.GA1660@siouxsie>

On Thu, Jun 09, 2011 at 12:56:09PM -0400, Simon Urbanek wrote:
> 
> On Jun 9, 2011, at 11:15 AM, oliver wrote:
> 
> > On Thu, Jun 09, 2011 at 10:54:28AM -0400, Duncan Murdoch wrote:
> >> On 09/06/2011 9:28 AM, oliver wrote:
> >>> On Thu, Jun 09, 2011 at 07:43:20AM -0400, Duncan Murdoch wrote:
> >>>> On 11-06-09 7:27 AM, oliver wrote:
> >>>>> On Wed, Jun 08, 2011 at 08:35:34PM -0400, Simon Urbanek wrote:
> >>>>>> 
> >>>>>> On Jun 8, 2011, at 8:32 PM, oliver wrote:
> >>>>>> 
> >>>>>>> On Thu, Jun 09, 2011 at 02:17:31AM +0200, oliver wrote:
> >>>>>>> [...]
> >>>>>>>> OK, I looked at this now.
> >>>>>>>> 
> >>>>>>>> LENGTH() checks the length of the vector.
> >>>>>>>> 
> >>>>>>>> Good to know this.
> >>>>>>>> 
> >>>>>>>> So the problem of a vector of length 0 can be with any arguments of type SEXP,
> >>>>>>>> hence I will need to check ANY arg on it's length.
> >>>>>>>> 
> >>>>>>>> This is vital to stability under any situation.
> >>>>>>>> 
> >>>>>>>> Thanks for this valuable hint!
> >>>>>>>> 
> >>>>>>>> I will add checks for all my SEXP-args.
> >>>>>>> [...]
> >>>>>>> 
> >>>>>>> Hey, LENGTH() does not work with String-vectors! :(
> >>>>>>> 
> >>>>>> 
> >>>>>> Of course it does ...
> >>>>>> 
> >>>>>> 
> >>>>> 
> >>>>> It does not so on my R 2.10.1 installation.
> >>>>> 
> >>>>> 
> >>>>> In the R-Shell I get:
> >>>>> 
> >>>>>   ==============================
> >>>>>>  length(c())
> >>>>>   [1] 0
> >>>>>> 
> >>>>>   ==============================
> >>>>> 
> >>>>> So c() is vec of length 0.
> >>>>> 
> >>>>> When I feed my readjpeg() with c() as filename arg,
> >>>>> 
> >>>>> testing with:
> >>>>> ====================================================
> >>>>>   if( LENGTH( filename_sexp )<   1 )
> >>>>>   {
> >>>>>     error("LENGTH( filename_sexp )<   1");
> >>>>>     //error("filename can't be vector of length 0");
> >>>>>   }
> >>>>>   else
> >>>>>   {
> >>>>>     error("LENGTH( filename_sexp ) is not<   1");
> >>>>>   }
> >>>>> ====================================================
> >>>>> 
> >>>>> 
> >>>>> I got:
> >>>>>   Error in readjpeg(filename = c()) : LENGTH( filename_sexp ) is not<   1
> >>>>> 
> >>>>> 
> >>>>> You can explain why?
> >>>> 
> >>>> c() doesn't create a STRSXP, it is NULL, which is a NILSXP.
> >>>> LENGTH() doesn't work on that object.  (I'd recommend using length()
> >>>> rather than LENGTH(); it's a function, not a macro, and it does give
> >>>> the expected answer.)
> >>> [...]
> >>> 
> >>> Interestingly, c() as value for an integer value
> >>> can be testes correctly with LENGTH().
> >> 
> >> Presumably you converted it to an INTSXP.  c() is NULL.
> > [...]
> > 
> > Ooops, yes. In the R-part. :-)
> > I did it, because when I don't get an int from the user's call,
> > I have set it to NA (default in the R-function definition).
> > 
> > I made
> >  width <- as.integer(width)
> > for easy check inside the C-part, on integer.
> > 
> > (I really only need int, no floating point values.)
> > 
> > I thought this makes the C-code easier at that part.
> > 
> > Or I may check on NA inside the C-part.
> > 
> > How would I do that correctly?
> > 
> > After so much different opinions I read here, I'm rather puzzled on that now.
> > 
> > If there is already a R-extensions-FAQ I could collect the informations
> > from the mail sof the last days, so that the different opinions and the discussion
> > can result in a some answers...
> > 
> 
> So far you were creating the confusion, the facts are fairly simple if you
> have some clue about C and R. I would like to ask you to, please, read and
> understand C standard and R-exts *before* posting further questions since it's
> pointless if we provide answers that you don't understand.
[...]

I understand the answers if it's about C, but I'm new to R.
If you think I did wrote something about C, that is not correct,
please show me.


On the R-usage: Regarding the LENGTH() vs. length(),
both are used in the examples of "Writing R Extensions"
and somewhere it was mentioned that either macros or functions can be used.

Here on the  list I read different opinions about that, coming from  different people.
As there are also different usages in the "Writing R Extensions" it's confusing.

Macro or function?
Should I include Rinternals.h or Rdefines.h?

It's not clear, what I should prefer, or when.



> The fact that you
> are impatient (as you said yourself) doesn't entitle you to waste other
> people's time to explain things to you while you are unwilling to take the time
> yourself.


That the memory allocation part was coming in chapter six,
which at first glance rather looked like a reference of convenience or mathematical
functions that can be called, I didn't awaited.
(And so I missed it in chapter 5, hence my questions.)

So I just can apologize that I didn't read that before asking,
but also can mention that the memory allocation issue also might make sense to be
mentioned in chapter 5.

And on the other hand I think "wasting time of others" makes no sense.
I also would invest time to help others on topics, even it might be documented
somewhere. (Thats why there are mailing lists, IMHO.)
It could even be the case that people read something but didn't remember
anything after first reading.

For example I had to look at the "Writing R extensions" more than once,
and some things I already read, I had not saved immediately.
(That's normal, that people need repitition to learn, btw.)

There always is a tradeoff between "first-read-long-documentations and do not practice"
and "read in the docs, try it out, read more, try it out" (and in between ask).

I learn things better with the second attempt.
And if the docs have a different direction in which things are explained,
questions arise during the process.

To answer them immediately will make people learn faster,
and IMHO this will pay back for the whole project,
in quality and quantity.

Some people here on the list mentioned some packages lacking
quality. This might in part be how people program, and in part also,
how (if) questions are answered (or not).



> If you have serious question beyond what is documented, feel free to
> ask, but make sure you have spent the time to think about it before you do so.

I will read further in the "Writing R Extensions", maybe some things there pop up
at pages, where I didn't expected it.
One question about error() already was answered now in section 6.2 (format strings
can be used like in printf(), or at least similar). (I was tempted to ask that too ;))


> 
> 
> >> 
> >>> So the question arises: is c() always creating NILSXP,
> >>> or is it NILSXP only for STRSXP, and 0 otherwise?
> >> 
> >> That question makes no sense at all.
> > 
> > It make sense for the picky.
> > As NULL is rather (void*)0  and a pointer is not an int (just can be coerced normally) ;)
> > 
> 
> It's not - you're confusing NULL in R with NULL in C.
[...]

I just don't know what is behind those macros.
Thats why I'm asking.... (or guessing).


> Both NILSXP and STRSXP are SEXP types - and obviously distinct ones. R will never return a null pointer for a SEXP.

As SEXP seems to be a general type, I would assume SEXP to be a union,
which can hold REALSXP, STRSXP, and some others.
(And NILSXP, which seem to be R-NULL, may or may not be C-NULL.)

But this is only an assumption.

Maybe it is necessary to read the R sources.
I normally think reading the sources might be interesting but not necessary.
And following the encapsulation issue and inteface-vs-implementation issue
(black box), IMHO it would be better if there is no necessity for "reading the sources". 

But maybe it is necessary.


Ciao,
   Oliver


From soeren.vogel at uzh.ch  Fri Jun 10 11:10:48 2011
From: soeren.vogel at uzh.ch (soeren.vogel at uzh.ch)
Date: Fri, 10 Jun 2011 11:10:48 +0200
Subject: [Rd] Reference Classes, Generator Object
Message-ID: <DF31719B-E5DC-4BD2-AB55-FE3114D5F397@uzh.ch>

Hello, I am working with a reference class:

Foo <- setRefClass("Bar",
  fields = list( a = "numeric"),
  methods = list( baz = function( xa ) a <<- xa )
)
x <- Foo$new()
x$baz(2)
x$a
y <- new("Bar")
y$baz(4)
y$a

But that might be confusing, since new(Foo) does not work and neither does Bar$new() (which is both clear to me but -- maybe -- not to the user). So my idea was to:

Bar <- setRefClass("Bar",
  fields = list( a = "numeric"),
  methods = list( baz = function( xa ) a <<- xa )
)
x <- Bar$new()
x$baz(2)
x$a
y <- new("Bar")
y$baz(4)
y$a

However, this is not the way it is usually done (e.g., with Rcpp modules), why not? Thanks, S?ren


From janko.thyson.rstuff at googlemail.com  Fri Jun 10 12:04:49 2011
From: janko.thyson.rstuff at googlemail.com (Janko Thyson)
Date: Fri, 10 Jun 2011 12:04:49 +0200
Subject: [Rd] Require of gWidgetsRGtk2 fails: RGtk2.dll can't be found,
 but it's there
Message-ID: <4DF1EC41.3090507@googlemail.com>

Dear list,

I've been trying to get gWidgets/gWidgetsRGtk2 to run every other month 
for a while, but somehow I simply can't figure out what's going wrong.

I tried several distributions of the GTK runtime environment for Windows 
(http://downloads.sourceforge.net/gladewin32/gtk-2.12.9-win32-1.exe as 
described in the package's vignette, 
http://ftp.gnome.org/pub/gnome/binaries/win32/gtk+/2.22/gtk+-bundle_2.22.1-20101227_win32.zip)

I also included GTK in my Windows PATH.

Yet, when I run 'require(gWidgetsRGtk2)', R complains that the RGtk2.dll 
can't be found/loaded (see below). But this file definitely exists. I'm 
running R-2.13.0 from a USB Device but made sure that args 'destdir' and 
'lib' are set propperly in 'install.packages'.

Loading required package: gWidgetsRGtk2
Loading required package: gWidgets
Error in inDL(x, as.logical(local), as.logical(now), ...) :
   unable to load shared object 
'R:/Apps/R/R-2.13.0/library/RGtk2/libs/i386/RGtk2.dll':
   LoadLibrary failure:  Das angegebene Modul wurde nicht gefunden.

Failed to load RGtk2 dynamic library, attempting to install it.
Learn more about GTK+ at http://www.gtk.org
If the package still does not load, please ensure that GTK+ is installed 
and that it is on your PATH environment variable
IN ANY CASE, RESTART R BEFORE TRYING TO LOAD THE PACKAGE AGAIN
Error : .onAttach failed in attachNamespace() for 'gWidgetsRGtk2', details:
   call: .Call(name, ..., PACKAGE = PACKAGE)
   error: C symbol name "S_gtk_icon_factory_new" not in DLL for package 
"RGtk2"

Best regards,
Janko

R version 2.13.0 (2011-04-13)
Platform: i386-pc-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=German_Germany.1252  LC_CTYPE=German_Germany.1252
[3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C
[5] LC_TIME=German_Germany.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] gWidgets_0.0-44

loaded via a namespace (and not attached):
[1] gWidgetsRGtk2_0.0-74 RGtk2_2.20.12        tools_2.13.0
 >


From ggrothendieck at gmail.com  Fri Jun 10 13:00:10 2011
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 10 Jun 2011 07:00:10 -0400
Subject: [Rd] Require of gWidgetsRGtk2 fails: RGtk2.dll can't be found,
 but it's there
In-Reply-To: <4DF1EC41.3090507@googlemail.com>
References: <4DF1EC41.3090507@googlemail.com>
Message-ID: <BANLkTimEjG_xN6Edj=wWPruaH7ry33bPrQ@mail.gmail.com>

On Fri, Jun 10, 2011 at 6:04 AM, Janko Thyson
<janko.thyson.rstuff at googlemail.com> wrote:
> Dear list,
>
> I've been trying to get gWidgets/gWidgetsRGtk2 to run every other month for
> a while, but somehow I simply can't figure out what's going wrong.
>

1. Use the automatically installed GTk2, not some other version.

2. Note that the automatically installed one will be at
...\GTk2-runtime\bin and that will be put at the *end* of your PATH.
Change it so that its at the beginning of your PATH to be sure its not
picking up something else.

3. If you are changing the path through the control panel and starting
R from the command line note that your new path won't be picked up in
old command line sessions so start a new command line session to start
R.

4. When you start a new R session double check that the automatically
installed ...\GTk2-runtime\bin is at the beginning of your path:

         strsplit(Sys.getenv("PATH"), ";")[[1]]


-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From ripley at stats.ox.ac.uk  Fri Jun 10 13:18:02 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 10 Jun 2011 12:18:02 +0100 (BST)
Subject: [Rd] Require of gWidgetsRGtk2 fails: RGtk2.dll can't be found,
 but it's there
In-Reply-To: <4DF1EC41.3090507@googlemail.com>
References: <4DF1EC41.3090507@googlemail.com>
Message-ID: <alpine.LFD.2.02.1106101215220.4009@toucan.stats.ox.ac.uk>

On Fri, 10 Jun 2011, Janko Thyson wrote:

> Dear list,
>
> I've been trying to get gWidgets/gWidgetsRGtk2 to run every other month for a 
> while, but somehow I simply can't figure out what's going wrong.

Your subject line indicates your confusion.  It does not say RGtk2.dll 
cannot be found (at least, the English version of the message does not 
say so).

What it means is that RGtk2.dll or one of the DLLs it depends on 
cannot be found.  See the instructions at
http://cran.r-project.org/bin/windows/contrib/2.13/@ReadMe

It is Microsoft's error message, not ours.

>
> I tried several distributions of the GTK runtime environment for Windows 
> (http://downloads.sourceforge.net/gladewin32/gtk-2.12.9-win32-1.exe as 
> described in the package's vignette, 
> http://ftp.gnome.org/pub/gnome/binaries/win32/gtk+/2.22/gtk+-bundle_2.22.1-20101227_win32.zip)
>
> I also included GTK in my Windows PATH.
>
> Yet, when I run 'require(gWidgetsRGtk2)', R complains that the RGtk2.dll 
> can't be found/loaded (see below). But this file definitely exists. I'm 
> running R-2.13.0 from a USB Device but made sure that args 'destdir' and 
> 'lib' are set propperly in 'install.packages'.
>
> Loading required package: gWidgetsRGtk2
> Loading required package: gWidgets
> Error in inDL(x, as.logical(local), as.logical(now), ...) :
>  unable to load shared object 
> 'R:/Apps/R/R-2.13.0/library/RGtk2/libs/i386/RGtk2.dll':
>  LoadLibrary failure:  Das angegebene Modul wurde nicht gefunden.
>
> Failed to load RGtk2 dynamic library, attempting to install it.
> Learn more about GTK+ at http://www.gtk.org
> If the package still does not load, please ensure that GTK+ is installed and 
> that it is on your PATH environment variable
> IN ANY CASE, RESTART R BEFORE TRYING TO LOAD THE PACKAGE AGAIN
> Error : .onAttach failed in attachNamespace() for 'gWidgetsRGtk2', details:
>  call: .Call(name, ..., PACKAGE = PACKAGE)
>  error: C symbol name "S_gtk_icon_factory_new" not in DLL for package 
> "RGtk2"
>
> Best regards,
> Janko
>
> R version 2.13.0 (2011-04-13)
> Platform: i386-pc-mingw32/i386 (32-bit)
>
> locale:
> [1] LC_COLLATE=German_Germany.1252  LC_CTYPE=German_Germany.1252
> [3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C
> [5] LC_TIME=German_Germany.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] gWidgets_0.0-44
>
> loaded via a namespace (and not attached):
> [1] gWidgetsRGtk2_0.0-74 RGtk2_2.20.12        tools_2.13.0
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From claudia.beleites at ipht-jena.de  Fri Jun 10 13:33:12 2011
From: claudia.beleites at ipht-jena.de (Claudia Beleites)
Date: Fri, 10 Jun 2011 13:33:12 +0200
Subject: [Rd] Data package questions
In-Reply-To: <CA165353.1B3D6%proebuck@mdanderson.org>
References: <CA165353.1B3D6%proebuck@mdanderson.org>
Message-ID: <4DF200F8.5060507@ipht-jena.de>

Dear Paul,

> In process of creating data package from an existing one.
> The current package has both raw data files and the associated
> RData objects created from them. Currently, the data subdirectory
> is 1.5Mb and the extdata is 5.4Mb.
>
> Never having created a data package before, how is this best
> done? Should the data package contain only the raw data, or
> the RData objects too (tightly coupled)? If the later, what
> (if anything) is added to the DESCRIPTION meta-information
> to denote the dependency? Should both packages suggest each
> other?

I have one data set that I ship as a few principal components and 
reconstruct it by a function. The result is then assigned to the 
exported variable by delayedAssign.

That way, you'd need to ship the raw data only, but can provide a 
ready-to-use R object as well.

For my example data, I don't ship the raw data as it is too big (30 MB 
toy example is really unpolite on CRAN), but I provide it at r-forge and 
give the link on the help page and in the vignette.

Claudia

-- 
Claudia Beleites
Spectroscopy/Imaging
Institute of Photonic Technology
Albert-Einstein-Str. 9
07745 Jena
Germany

email: claudia.beleites at ipht-jena.de
phone: +49 3641 206-133
fax:   +49 2641 206-399


From janko.thyson.rstuff at googlemail.com  Fri Jun 10 14:24:12 2011
From: janko.thyson.rstuff at googlemail.com (Janko Thyson)
Date: Fri, 10 Jun 2011 14:24:12 +0200
Subject: [Rd] Require of gWidgetsRGtk2 fails: RGtk2.dll can't be found,
 but it's there
In-Reply-To: <alpine.LFD.2.02.1106101215220.4009@toucan.stats.ox.ac.uk>
References: <4DF1EC41.3090507@googlemail.com>
	<alpine.LFD.2.02.1106101215220.4009@toucan.stats.ox.ac.uk>
Message-ID: <4DF20CEC.5000701@googlemail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110610/f45641b3/attachment.pl>

From janko.thyson.rstuff at googlemail.com  Fri Jun 10 14:31:01 2011
From: janko.thyson.rstuff at googlemail.com (Janko Thyson)
Date: Fri, 10 Jun 2011 14:31:01 +0200
Subject: [Rd] Require of gWidgetsRGtk2 fails: RGtk2.dll can't be found,
 but it's there
In-Reply-To: <BANLkTimEjG_xN6Edj=wWPruaH7ry33bPrQ@mail.gmail.com>
References: <4DF1EC41.3090507@googlemail.com>
	<BANLkTimEjG_xN6Edj=wWPruaH7ry33bPrQ@mail.gmail.com>
Message-ID: <4DF20E85.601@googlemail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110610/201d95ae/attachment.pl>

From ripley at stats.ox.ac.uk  Fri Jun 10 14:36:29 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 10 Jun 2011 13:36:29 +0100 (BST)
Subject: [Rd] Require of gWidgetsRGtk2 fails: RGtk2.dll can't be found,
 but it's there
In-Reply-To: <4DF20CEC.5000701@googlemail.com>
References: <4DF1EC41.3090507@googlemail.com>
	<alpine.LFD.2.02.1106101215220.4009@toucan.stats.ox.ac.uk>
	<4DF20CEC.5000701@googlemail.com>
Message-ID: <alpine.LFD.2.02.1106101332370.9756@toucan.stats.ox.ac.uk>

It is a Microsoft error message, so your Windows is translating it, 
not R.  It does say 'The specified module' in English Windows, without 
saying who specified the module (but it does often produce a popup 
naming the module).

I've no better idea what your problem is: the @ReadMe instructions 
work for me, Uwe on winbuilder and in our teaching lab (and the advice 
in RGtk2 does not).

On Fri, 10 Jun 2011, Janko Thyson wrote:

> On 10.06.2011 13:18, Prof Brian Ripley wrote:
>       On Fri, 10 Jun 2011, Janko Thyson wrote:
>
>             Dear list,
>
>             I've been trying to get gWidgets/gWidgetsRGtk2 to run
>             every other month for a while, but somehow I simply can't
>             figure out what's going wrong.
> 
>
>       Your subject line indicates your confusion.? It does not say
>       RGtk2.dll cannot be found (at least, the English version of the
>       message does not say so).
>
>       What it means is that RGtk2.dll or one of the DLLs it depends on
>       cannot be found.? See the instructions at
>       http://cran.r-project.org/bin/windows/contrib/2.13/@ReadMe
>
>       It is Microsoft's error message, not ours.
> 
> 
> Thanks for your answer. I followed the advice in the readme file and installed
> 
> http://ftp.gnome.org/pub/gnome/binaries/win32/gtk+/2.22/gtk+-bundle_2.22.0-201010
> 16_win32.zip
> Previously I made sure that all other previously installed GTK+ runtime
> environments were removed and that the windows PATH reflects the correct path to
> the "new" GTK+ files. I also made sure I started a new R session before trying
> 'require(gWidgetsRGtk2)' again. Yet, the same error. More precisely, a dialog box
> pops up asking me to install GTK+ or not. That's what's confusing me as well: the
> package's recommendation with respect to the version of an GTK+ runtime
> environment is somewhat out-of-sync with the advice in the readme, even though it
> the version is fairly recent (2011-04-30)
> 
> Sorry for the german part in the error message, but I wasn't able to get it all
> to English (tried language = en in Rconsole file, setting up a Renviron.site with
> LANGUAGE=en, setting Sys.setenv("LANGUAGE"="en") and Sys.setenv("LC_ALL"="en") to
> no avail; not a good R day today ;-)). I freely translated it for you:
> 
> Loading required package: gWidgetsRGtk2
> Loading required package: gWidgets
> Error in inDL(x, as.logical(local), as.logical(now), ...) :
> ?unable to load shared object
> 'R:/Apps/R/R-2.13.0/library/RGtk2/libs/i386/RGtk2.dll':
> ?LoadLibrary failure:? the specified module could not be found.
> 
> Failed to load RGtk2 dynamic library, attempting to install it.
> Learn more about GTK+ at http://www.gtk.org
> If the package still does not load, please ensure that GTK+ is installed and that
> it is on your PATH environment variable
> IN ANY CASE, RESTART R BEFORE TRYING TO LOAD THE PACKAGE AGAIN
> Error : .onAttach failed in attachNamespace() for 'gWidgetsRGtk2', details:
> ?call: .Call(name, ..., PACKAGE = PACKAGE)
> ?error: C symbol name "S_gtk_icon_factory_new" not in DLL for package "RGtk2"
> 
> Do you have any other idea what I might be doing wrong?
> 
> Regards,
> Janko
> 
> 
>
>             I tried several distributions of the GTK runtime
>             environment for Windows
>             (http://downloads.sourceforge.net/gladewin32/gtk-2.12.9-win32-1.exe
>             as described in the package's vignette,http://ftp.gnome.org/pub/gnome/binaries/win32/gtk+/2.22/gtk+-bundle_2.22.1-20101
>             227_win32.zip)
>
>             I also included GTK in my Windows PATH.
>
>             Yet, when I run 'require(gWidgetsRGtk2)', R complains
>             that the RGtk2.dll can't be found/loaded (see below). But
>             this file definitely exists. I'm running R-2.13.0 from a
>             USB Device but made sure that args 'destdir' and 'lib'
>             are set propperly in 'install.packages'.
>
>             Loading required package: gWidgetsRGtk2
>             Loading required package: gWidgets
>             Error in inDL(x, as.logical(local), as.logical(now), ...)
>             :
>             ?unable to load shared object
>             'R:/Apps/R/R-2.13.0/library/RGtk2/libs/i386/RGtk2.dll':
>             ?LoadLibrary failure:? Das angegebene Modul wurde nicht
>             gefunden.
>
>             Failed to load RGtk2 dynamic library, attempting to
>             install it.
>             Learn more about GTK+ at http://www.gtk.org
>             If the package still does not load, please ensure that
>             GTK+ is installed and that it is on your PATH environment
>             variable
>             IN ANY CASE, RESTART R BEFORE TRYING TO LOAD THE PACKAGE
>             AGAIN
>             Error : .onAttach failed in attachNamespace() for
>             'gWidgetsRGtk2', details:
>             ?call: .Call(name, ..., PACKAGE = PACKAGE)
>             ?error: C symbol name "S_gtk_icon_factory_new" not in DLL
>             for package "RGtk2"
>
>             Best regards,
>             Janko
>
>             R version 2.13.0 (2011-04-13)
>             Platform: i386-pc-mingw32/i386 (32-bit)
>
>             locale:
>             [1] LC_COLLATE=German_Germany.1252?
>             LC_CTYPE=German_Germany.1252
>             [3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C
>             [5] LC_TIME=German_Germany.1252
>
>             attached base packages:
>             [1] stats???? graphics? grDevices utils???? datasets?
>             methods?? base
>
>             other attached packages:
>             [1] gWidgets_0.0-44
>
>             loaded via a namespace (and not attached):
>             [1] gWidgetsRGtk2_0.0-74 RGtk2_2.20.12???????
>             tools_2.13.0
> 
>
>             ______________________________________________
>             R-devel at r-project.org mailing list
>             https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 
> 
> 
> --
> 
> _________________________________________________________________________________
> 
> Janko Thyson
> janko.thyson at googlemail.com
> 
> Jesuitenstra?e 3
> D-85049 Ingolstadt
> 
> Mobile: +49 (0)176 83294257
> 
> This e-mail and any attachment is for authorized use by the intended
> recipient(s) only. It may contain proprietary material, confidential
> information and/or be subject to legal privilege. It should not be
> copied, disclosed to, retained or used by any other party.
> If you are not an intended recipient then please promptly delete this
> e-mail and any attachment and all copies and inform the sender.
> 
> 
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ggrothendieck at gmail.com  Fri Jun 10 14:40:06 2011
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 10 Jun 2011 08:40:06 -0400
Subject: [Rd] Require of gWidgetsRGtk2 fails: RGtk2.dll can't be found,
 but it's there
In-Reply-To: <4DF20E85.601@googlemail.com>
References: <4DF1EC41.3090507@googlemail.com>
	<BANLkTimEjG_xN6Edj=wWPruaH7ry33bPrQ@mail.gmail.com>
	<4DF20E85.601@googlemail.com>
Message-ID: <BANLkTinBAJbJsJ+DQ0kakA9MzSfpTz0KCw@mail.gmail.com>

On Fri, Jun 10, 2011 at 8:31 AM, Janko Thyson
<janko.thyson.rstuff at googlemail.com> wrote:
> On 10.06.2011 13:00, Gabor Grothendieck wrote:
>
> On Fri, Jun 10, 2011 at 6:04 AM, Janko Thyson
> <janko.thyson.rstuff at googlemail.com> wrote:
>
> Dear list,
>
> I've been trying to get gWidgets/gWidgetsRGtk2 to run every other month for
> a while, but somehow I simply can't figure out what's going wrong.
>
> 1. Use the automatically installed GTk2, not some other version.
>
> Thanks for answering. I didn't even know there GTk2 already ships with R.
> Prof. Brian Ripley linked me to the readme file with recommendations with
> respect to an GTK2 distribution to use:
>
> "What it means is that RGtk2.dll or one of the DLLs it depends on cannot be
> found.? See the instructions at
> http://cran.r-project.org/bin/windows/contrib/2.13/@ReadMe "
>
> 2. Note that the automatically installed one will be at
> ...\GTk2-runtime\bin and that will be put at the *end* of your PATH.
> Change it so that its at the beginning of your PATH to be sure its not
> picking up something else.
>
> My R distribution does not seem to have such a directory (standard windows
> R-2.13.0 installer from CRAN)
> How do I manage to have this ...\GTk2-runtime\bin directory available?

#1 is referring to the fact that when you run RGTk2 it will ask you if
you want it to install GTk2.  Say yes and let it install that version
to be sure you are using the right one.  If you install it yourself
manually instead you could very easily install the wrong version.

The only problem with the automatic installation is that it puts the
GTk2 dll's at the end of your PATH so you can't be sure that something
else on your path (such as graphviz which has its own potentially
conflicting dll's) won't interfere.  To fix that change the PATH so
that GTk2 is at the beginning (or at least before anything else that
could interere).

>
> Thanks a lot,
> Janko
>
> 3. If you are changing the path through the control panel and starting
> R from the command line note that your new path won't be picked up in
> old command line sessions so start a new command line session to start
> R.
>
> 4. When you start a new R session double check that the automatically
> installed ...\GTk2-runtime\bin is at the beginning of your path:
>
>          strsplit(Sys.getenv("PATH"), ";")[[1]]
>
>
>
>
> --
> ________________________________
>
> Janko Thyson
> janko.thyson at googlemail.com
>
> Jesuitenstra?e 3
> D-85049 Ingolstadt
>
> Mobile: +49 (0)176 83294257
>
> This e-mail and any attachment is for authorized use by the intended
> recipient(s) only. It may contain proprietary material, confidential
> information and/or be subject to legal privilege. It should not be
> copied, disclosed to, retained or used by any other party.
> If you are not an intended recipient then please promptly delete this
> e-mail and any attachment and all copies and inform the sender.
>



-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From janko.thyson.rstuff at googlemail.com  Fri Jun 10 15:05:45 2011
From: janko.thyson.rstuff at googlemail.com (Janko Thyson)
Date: Fri, 10 Jun 2011 15:05:45 +0200
Subject: [Rd] Require of gWidgetsRGtk2 fails: RGtk2.dll can't be found,
 but it's there
In-Reply-To: <BANLkTinBAJbJsJ+DQ0kakA9MzSfpTz0KCw@mail.gmail.com>
References: <4DF1EC41.3090507@googlemail.com>
	<BANLkTimEjG_xN6Edj=wWPruaH7ry33bPrQ@mail.gmail.com>
	<4DF20E85.601@googlemail.com>
	<BANLkTinBAJbJsJ+DQ0kakA9MzSfpTz0KCw@mail.gmail.com>
Message-ID: <4DF216A9.4040209@googlemail.com>

On 10.06.2011 14:40, Gabor Grothendieck wrote:
> On Fri, Jun 10, 2011 at 8:31 AM, Janko Thyson
> <janko.thyson.rstuff at googlemail.com>  wrote:
>> On 10.06.2011 13:00, Gabor Grothendieck wrote:
>>
>> On Fri, Jun 10, 2011 at 6:04 AM, Janko Thyson
>> <janko.thyson.rstuff at googlemail.com>  wrote:
>>
>> Dear list,
>>
>> I've been trying to get gWidgets/gWidgetsRGtk2 to run every other month for
>> a while, but somehow I simply can't figure out what's going wrong.
>>
>> 1. Use the automatically installed GTk2, not some other version.
>>
>> Thanks for answering. I didn't even know there GTk2 already ships with R.
>> Prof. Brian Ripley linked me to the readme file with recommendations with
>> respect to an GTK2 distribution to use:
>>
>> "What it means is that RGtk2.dll or one of the DLLs it depends on cannot be
>> found.  See the instructions at
>> http://cran.r-project.org/bin/windows/contrib/2.13/@ReadMe "
>>
>> 2. Note that the automatically installed one will be at
>> ...\GTk2-runtime\bin and that will be put at the *end* of your PATH.
>> Change it so that its at the beginning of your PATH to be sure its not
>> picking up something else.
>>
>> My R distribution does not seem to have such a directory (standard windows
>> R-2.13.0 installer from CRAN)
>> How do I manage to have this ...\GTk2-runtime\bin directory available?
> #1 is referring to the fact that when you run RGTk2 it will ask you if
> you want it to install GTk2.  Say yes and let it install that version
> to be sure you are using the right one.  If you install it yourself
> manually instead you could very easily install the wrong version.
>
> The only problem with the automatic installation is that it puts the
> GTk2 dll's at the end of your PATH so you can't be sure that something
> else on your path (such as graphviz which has its own potentially
> conflicting dll's) won't interfere.  To fix that change the PATH so
> that GTk2 is at the beginning (or at least before anything else that
> could interere).
>
Hm, I did install GTK2 via the automatic installation now (choosing to 
put the DLLs in the /bin directory). The problem is, that R keeps asking 
me to repeat this step (the dialog box) every time I try to load (in new 
R sessions) either RGTk2 or gWidgetsRGtk2 displaying the same error:

Loading required package: gWidgetsRGtk2
Loading required package: gWidgets
Error in inDL(x, as.logical(local), as.logical(now), ...) :
   unable to load shared object 
'R:/Apps/R/R-2.13.0/library/RGtk2/libs/i386/RGtk2.dll':
   LoadLibrary failure:  The specified module could not be found.

Failed to load RGtk2 dynamic library, attempting to install it.
Learn more about GTK+ at http://www.gtk.org
If the package still does not load, please ensure that GTK+ is installed 
and that it is on your PATH environment variable
IN ANY CASE, RESTART R BEFORE TRYING TO LOAD THE PACKAGE AGAIN
Error : .onAttach failed in attachNamespace() for 'gWidgetsRGtk2', details:
   call: .Call(name, ..., PACKAGE = PACKAGE)
   error: C symbol name "S_gtk_icon_factory_new" not in DLL for package 
"RGtk2"

I also tried it on a different machine running Windows 7 and R-2.13.0.

:-/

Do you have any other idea?
Thanks a lot,
Janko

>> Thanks a lot,
>> Janko
>>
>> 3. If you are changing the path through the control panel and starting
>> R from the command line note that your new path won't be picked up in
>> old command line sessions so start a new command line session to start
>> R.
>>
>> 4. When you start a new R session double check that the automatically
>> installed ...\GTk2-runtime\bin is at the beginning of your path:
>>
>>           strsplit(Sys.getenv("PATH"), ";")[[1]]
>>
>>
>>
>>
>> --
>> ________________________________
>>
>> Janko Thyson
>> janko.thyson at googlemail.com
>>
>> Jesuitenstra?e 3
>> D-85049 Ingolstadt
>>
>> Mobile: +49 (0)176 83294257
>>
>> This e-mail and any attachment is for authorized use by the intended
>> recipient(s) only. It may contain proprietary material, confidential
>> information and/or be subject to legal privilege. It should not be
>> copied, disclosed to, retained or used by any other party.
>> If you are not an intended recipient then please promptly delete this
>> e-mail and any attachment and all copies and inform the sender.
>>


From janko.thyson.rstuff at googlemail.com  Fri Jun 10 15:07:00 2011
From: janko.thyson.rstuff at googlemail.com (Janko Thyson)
Date: Fri, 10 Jun 2011 15:07:00 +0200
Subject: [Rd] Require of gWidgetsRGtk2 fails: RGtk2.dll can't be found,
 but it's there
In-Reply-To: <alpine.LFD.2.02.1106101332370.9756@toucan.stats.ox.ac.uk>
References: <4DF1EC41.3090507@googlemail.com>
	<alpine.LFD.2.02.1106101215220.4009@toucan.stats.ox.ac.uk>
	<4DF20CEC.5000701@googlemail.com>
	<alpine.LFD.2.02.1106101332370.9756@toucan.stats.ox.ac.uk>
Message-ID: <4DF216F4.3050205@googlemail.com>

Okay, at least some positive result today (language issue ;-))

Thanks for trying. Seems like GTK2 and me are not meant to be ...

Regards,
Janko

On 10.06.2011 14:36, Prof Brian Ripley wrote:
> It is a Microsoft error message, so your Windows is translating it, 
> not R.  It does say 'The specified module' in English Windows, without 
> saying who specified the module (but it does often produce a popup 
> naming the module).
>
> I've no better idea what your problem is: the @ReadMe instructions 
> work for me, Uwe on winbuilder and in our teaching lab (and the advice 
> in RGtk2 does not).
>
> On Fri, 10 Jun 2011, Janko Thyson wrote:
>
>> On 10.06.2011 13:18, Prof Brian Ripley wrote:
>>       On Fri, 10 Jun 2011, Janko Thyson wrote:
>>
>>             Dear list,
>>
>>             I've been trying to get gWidgets/gWidgetsRGtk2 to run
>>             every other month for a while, but somehow I simply can't
>>             figure out what's going wrong.
>>
>>
>>       Your subject line indicates your confusion.  It does not say
>>       RGtk2.dll cannot be found (at least, the English version of the
>>       message does not say so).
>>
>>       What it means is that RGtk2.dll or one of the DLLs it depends on
>>       cannot be found.  See the instructions at
>>       http://cran.r-project.org/bin/windows/contrib/2.13/@ReadMe
>>
>>       It is Microsoft's error message, not ours.
>>
>>
>> Thanks for your answer. I followed the advice in the readme file and 
>> installed
>>
>> http://ftp.gnome.org/pub/gnome/binaries/win32/gtk+/2.22/gtk+-bundle_2.22.0-201010 
>>
>> 16_win32.zip
>> Previously I made sure that all other previously installed GTK+ runtime
>> environments were removed and that the windows PATH reflects the 
>> correct path to
>> the "new" GTK+ files. I also made sure I started a new R session 
>> before trying
>> 'require(gWidgetsRGtk2)' again. Yet, the same error. More precisely, 
>> a dialog box
>> pops up asking me to install GTK+ or not. That's what's confusing me 
>> as well: the
>> package's recommendation with respect to the version of an GTK+ runtime
>> environment is somewhat out-of-sync with the advice in the readme, 
>> even though it
>> the version is fairly recent (2011-04-30)
>>
>> Sorry for the german part in the error message, but I wasn't able to 
>> get it all
>> to English (tried language = en in Rconsole file, setting up a 
>> Renviron.site with
>> LANGUAGE=en, setting Sys.setenv("LANGUAGE"="en") and 
>> Sys.setenv("LC_ALL"="en") to
>> no avail; not a good R day today ;-)). I freely translated it for you:
>>
>> Loading required package: gWidgetsRGtk2
>> Loading required package: gWidgets
>> Error in inDL(x, as.logical(local), as.logical(now), ...) :
>>  unable to load shared object
>> 'R:/Apps/R/R-2.13.0/library/RGtk2/libs/i386/RGtk2.dll':
>>  LoadLibrary failure:  the specified module could not be found.
>>
>> Failed to load RGtk2 dynamic library, attempting to install it.
>> Learn more about GTK+ at http://www.gtk.org
>> If the package still does not load, please ensure that GTK+ is 
>> installed and that
>> it is on your PATH environment variable
>> IN ANY CASE, RESTART R BEFORE TRYING TO LOAD THE PACKAGE AGAIN
>> Error : .onAttach failed in attachNamespace() for 'gWidgetsRGtk2', 
>> details:
>>  call: .Call(name, ..., PACKAGE = PACKAGE)
>>  error: C symbol name "S_gtk_icon_factory_new" not in DLL for package 
>> "RGtk2"
>>
>> Do you have any other idea what I might be doing wrong?
>>
>> Regards,
>> Janko
>>
>>
>>
>>             I tried several distributions of the GTK runtime
>>             environment for Windows
>>             
>> (http://downloads.sourceforge.net/gladewin32/gtk-2.12.9-win32-1.exe
>>             as described in the package's 
>> vignette,http://ftp.gnome.org/pub/gnome/binaries/win32/gtk+/2.22/gtk+-bundle_2.22.1-20101
>>             227_win32.zip)
>>
>>             I also included GTK in my Windows PATH.
>>
>>             Yet, when I run 'require(gWidgetsRGtk2)', R complains
>>             that the RGtk2.dll can't be found/loaded (see below). But
>>             this file definitely exists. I'm running R-2.13.0 from a
>>             USB Device but made sure that args 'destdir' and 'lib'
>>             are set propperly in 'install.packages'.
>>
>>             Loading required package: gWidgetsRGtk2
>>             Loading required package: gWidgets
>>             Error in inDL(x, as.logical(local), as.logical(now), ...)
>>             :
>>              unable to load shared object
>>             'R:/Apps/R/R-2.13.0/library/RGtk2/libs/i386/RGtk2.dll':
>>              LoadLibrary failure:  Das angegebene Modul wurde nicht
>>             gefunden.
>>
>>             Failed to load RGtk2 dynamic library, attempting to
>>             install it.
>>             Learn more about GTK+ at http://www.gtk.org
>>             If the package still does not load, please ensure that
>>             GTK+ is installed and that it is on your PATH environment
>>             variable
>>             IN ANY CASE, RESTART R BEFORE TRYING TO LOAD THE PACKAGE
>>             AGAIN
>>             Error : .onAttach failed in attachNamespace() for
>>             'gWidgetsRGtk2', details:
>>              call: .Call(name, ..., PACKAGE = PACKAGE)
>>              error: C symbol name "S_gtk_icon_factory_new" not in DLL
>>             for package "RGtk2"
>>
>>             Best regards,
>>             Janko
>>
>>             R version 2.13.0 (2011-04-13)
>>             Platform: i386-pc-mingw32/i386 (32-bit)
>>
>>             locale:
>>             [1] LC_COLLATE=German_Germany.1252
>>             LC_CTYPE=German_Germany.1252
>>             [3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C
>>             [5] LC_TIME=German_Germany.1252
>>
>>             attached base packages:
>>             [1] stats     graphics  grDevices utils     datasets
>>             methods   base
>>
>>             other attached packages:
>>             [1] gWidgets_0.0-44
>>
>>             loaded via a namespace (and not attached):
>>             [1] gWidgetsRGtk2_0.0-74 RGtk2_2.20.12
>>             tools_2.13.0
>>
>>
>>             ______________________________________________
>>             R-devel at r-project.org mailing list
>>             https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>>
>>
>> -- 
>>
>> _________________________________________________________________________________ 
>>
>>
>> Janko Thyson
>> janko.thyson at googlemail.com
>>
>> Jesuitenstra?e 3
>> D-85049 Ingolstadt
>>
>> Mobile: +49 (0)176 83294257
>>
>> This e-mail and any attachment is for authorized use by the intended
>> recipient(s) only. It may contain proprietary material, confidential
>> information and/or be subject to legal privilege. It should not be
>> copied, disclosed to, retained or used by any other party.
>> If you are not an intended recipient then please promptly delete this
>> e-mail and any attachment and all copies and inform the sender.
>>
>>
>>
>


From bajaj141003 at gmail.com  Fri Jun 10 20:54:39 2011
From: bajaj141003 at gmail.com (Nipesh Bajaj)
Date: Sat, 11 Jun 2011 00:24:39 +0530
Subject: [Rd] How to add a welcome message in Package development?
Message-ID: <BANLkTikFL8LuPkX6SSEp-yNqNhYpt-zrWg@mail.gmail.com>

Dear all, it is my first post in R-devel list, and hope that this is
the right place to ask question related to package development.

I have created my first package in Windows through the usual route.
Now I want to add some ***Welcome message*** as soon as user loads my
package into their R console, using library() function. However I
could not figure out where and how should I add this functionality in
entire package development procedure, and the "Writing R Exts"
document also seem to be mum on this issue.

Can somebody help me how to add this functionality in the development
route of package. I believe this is possible as in many existing
packages that functionality is present.

Thanks,


From simon.urbanek at r-project.org  Fri Jun 10 21:10:09 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 10 Jun 2011 15:10:09 -0400
Subject: [Rd] How to add a welcome message in Package development?
In-Reply-To: <BANLkTikFL8LuPkX6SSEp-yNqNhYpt-zrWg@mail.gmail.com>
References: <BANLkTikFL8LuPkX6SSEp-yNqNhYpt-zrWg@mail.gmail.com>
Message-ID: <EC3D7B97-9AAD-4626-BC5E-3372344AB155@r-project.org>


On Jun 10, 2011, at 2:54 PM, Nipesh Bajaj wrote:

> Dear all, it is my first post in R-devel list, and hope that this is
> the right place to ask question related to package development.
> 
> I have created my first package in Windows through the usual route.
> Now I want to add some ***Welcome message*** as soon as user loads my
> package into their R console, using library() function. However I
> could not figure out where and how should I add this functionality in
> entire package development procedure, and the "Writing R Exts"
> document also seem to be mum on this issue.
> 

Personally, I find "welcome messages" extremely annoying, because if you load a dependency chain of 20 packages and each has something silly to say, you get pages of completely useless output (since you can't read all of them anyway) that tend to interfere with automated scripts. Also anything people tend to say in those is pertinent only once (when the user first sees the message) so the message is pointless most of the time that it's shown. But that's just my opinion.

That said, you can simply use cat() in .First.lib (if your packages has no namespace) or .onAttach or .onLoad (if your packages has a namespace).

Cheers,
Simon


> Can somebody help me how to add this functionality in the development
> route of package. I believe this is possible as in many existing
> packages that functionality is present.
> 
> Thanks,
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From edd at debian.org  Fri Jun 10 21:36:05 2011
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 10 Jun 2011 14:36:05 -0500
Subject: [Rd] How to add a welcome message in Package development?
In-Reply-To: <EC3D7B97-9AAD-4626-BC5E-3372344AB155@r-project.org>
References: <BANLkTikFL8LuPkX6SSEp-yNqNhYpt-zrWg@mail.gmail.com>
	<EC3D7B97-9AAD-4626-BC5E-3372344AB155@r-project.org>
Message-ID: <19954.29221.228372.585633@max.nulle.part>


On 10 June 2011 at 15:10, Simon Urbanek wrote:
| 
| On Jun 10, 2011, at 2:54 PM, Nipesh Bajaj wrote:
| 
| > Dear all, it is my first post in R-devel list, and hope that this is
| > the right place to ask question related to package development.
| > 
| > I have created my first package in Windows through the usual route.
| > Now I want to add some ***Welcome message*** as soon as user loads my
| > package into their R console, using library() function. However I
| > could not figure out where and how should I add this functionality in
| > entire package development procedure, and the "Writing R Exts"
| > document also seem to be mum on this issue.
| > 
| 
| Personally, I find "welcome messages" extremely annoying, because if you load a dependency chain of 20 packages and each has something silly to say, you get pages of completely useless output (since you can't read all of them anyway) that tend to interfere with automated scripts. Also anything people tend to say in those is pertinent only once (when the user first sees the message) so the message is pointless most of the time that it's shown. But that's just my opinion.
| 
| That said, you can simply use cat() in .First.lib (if your packages has no namespace) or .onAttach or .onLoad (if your packages has a namespace).

No, not cat() --- please use   packageStartupMessage()   as that can actually 
be suppressed easily.

Dirk, who also finds them annoying

-- 
Gauss once played himself in a zero-sum game and won $50.
                      -- #11 at http://www.gaussfacts.com


From wdunlap at tibco.com  Fri Jun 10 21:40:51 2011
From: wdunlap at tibco.com (William Dunlap)
Date: Fri, 10 Jun 2011 12:40:51 -0700
Subject: [Rd] How to add a welcome message in Package development?
In-Reply-To: <EC3D7B97-9AAD-4626-BC5E-3372344AB155@r-project.org>
References: <BANLkTikFL8LuPkX6SSEp-yNqNhYpt-zrWg@mail.gmail.com>
	<EC3D7B97-9AAD-4626-BC5E-3372344AB155@r-project.org>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D700044AD3D4@NA-PA-VBE03.na.tibco.com>

I agree with Simon that package startup messages
are often annoying and not often helpful.  However,
I think they should be generated with
   packageStartupMessage("your message")
instead of
   cat("your message\n")
The former may be suppressed by wrapping the call to
library() with suppressPackageStartupMessages(), just
as messages generated by message("your message") may
be suppressed with suppressMessages().

You can suppress cat()'s output with capture.output()
but you may throw out things that should be seen.

E.g., if a package with a NAMESPACE file contains
the following .onXXX functions
  % more testPkgWithNamespace/R/zzz.R
  .onAttach <- function(...) {
      cat("message from .onAttach via cat\n")
      message("message from .onAttach via message")
      packageStartupMessage("message from .onAttach via
packageStartupMessage\n")
  }
  .onLoad <- function(...) {
      cat("message from .onLoad via cat\n")
      message("message from .onLoad via message")
      packageStartupMessage("message from .onLoad via
packageStartupMessage\n")
  }
we get:
  > library(testPkgWithNamespace, lib.loc="Rlib")
  message from .onLoad via cat
  message from .onLoad via message
  message from .onLoad via packageStartupMessage
  message from .onAttach via cat
  message from .onAttach via message
  message from .onAttach via packageStartupMessage
  >
  > detach("package:testPkgWithNamespace", unload=TRUE)
  > suppressMessages(library(testPkgWithNamespace, lib.loc="Rlib"))
  message from .onLoad via cat
  message from .onAttach via cat
  >
  > detach("package:testPkgWithNamespace", unload=TRUE)
  > suppressPackageStartupMessages(library(testPkgWithNamespace,
lib.loc="Rlib"))
  message from .onLoad via cat
  message from .onLoad via message
  message from .onAttach via cat
  message from .onAttach via message

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com  

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Simon Urbanek
> Sent: Friday, June 10, 2011 12:10 PM
> To: Nipesh Bajaj
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] How to add a welcome message in Package development?
> 
> 
> On Jun 10, 2011, at 2:54 PM, Nipesh Bajaj wrote:
> 
> > Dear all, it is my first post in R-devel list, and hope that this is
> > the right place to ask question related to package development.
> > 
> > I have created my first package in Windows through the usual route.
> > Now I want to add some ***Welcome message*** as soon as 
> user loads my
> > package into their R console, using library() function. However I
> > could not figure out where and how should I add this 
> functionality in
> > entire package development procedure, and the "Writing R Exts"
> > document also seem to be mum on this issue.
> > 
> 
> Personally, I find "welcome messages" extremely annoying, 
> because if you load a dependency chain of 20 packages and 
> each has something silly to say, you get pages of completely 
> useless output (since you can't read all of them anyway) that 
> tend to interfere with automated scripts. Also anything 
> people tend to say in those is pertinent only once (when the 
> user first sees the message) so the message is pointless most 
> of the time that it's shown. But that's just my opinion.
> 
> That said, you can simply use cat() in .First.lib (if your 
> packages has no namespace) or .onAttach or .onLoad (if your 
> packages has a namespace).
> 
> Cheers,
> Simon
> 
> 
> > Can somebody help me how to add this functionality in the 
> development
> > route of package. I believe this is possible as in many existing
> > packages that functionality is present.
> > 
> > Thanks,
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> > 
> > 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From simon.urbanek at r-project.org  Fri Jun 10 22:04:29 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 10 Jun 2011 16:04:29 -0400
Subject: [Rd] How to add a welcome message in Package development?
In-Reply-To: <19954.29221.228372.585633@max.nulle.part>
References: <BANLkTikFL8LuPkX6SSEp-yNqNhYpt-zrWg@mail.gmail.com>
	<EC3D7B97-9AAD-4626-BC5E-3372344AB155@r-project.org>
	<19954.29221.228372.585633@max.nulle.part>
Message-ID: <7A15D454-E03A-442B-9912-83EDEABEDA93@r-project.org>


On Jun 10, 2011, at 3:36 PM, Dirk Eddelbuettel wrote:

> 
> On 10 June 2011 at 15:10, Simon Urbanek wrote:
> | 
> | On Jun 10, 2011, at 2:54 PM, Nipesh Bajaj wrote:
> | 
> | > Dear all, it is my first post in R-devel list, and hope that this is
> | > the right place to ask question related to package development.
> | > 
> | > I have created my first package in Windows through the usual route.
> | > Now I want to add some ***Welcome message*** as soon as user loads my
> | > package into their R console, using library() function. However I
> | > could not figure out where and how should I add this functionality in
> | > entire package development procedure, and the "Writing R Exts"
> | > document also seem to be mum on this issue.
> | > 
> | 
> | Personally, I find "welcome messages" extremely annoying, because if you load a dependency chain of 20 packages and each has something silly to say, you get pages of completely useless output (since you can't read all of them anyway) that tend to interfere with automated scripts. Also anything people tend to say in those is pertinent only once (when the user first sees the message) so the message is pointless most of the time that it's shown. But that's just my opinion.
> | 
> | That said, you can simply use cat() in .First.lib (if your packages has no namespace) or .onAttach or .onLoad (if your packages has a namespace).
> 
> No, not cat() --- please use   packageStartupMessage()   as that can actually 
> be suppressed easily.
> 

Thanks, very, very good point -- that many package authors did not get (I actually checked a few packages before replying and they all use cat() ... eek).

Thanks,
Simon


From edd at debian.org  Fri Jun 10 22:13:17 2011
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 10 Jun 2011 15:13:17 -0500
Subject: [Rd] How to add a welcome message in Package development?
In-Reply-To: <7A15D454-E03A-442B-9912-83EDEABEDA93@r-project.org>
References: <BANLkTikFL8LuPkX6SSEp-yNqNhYpt-zrWg@mail.gmail.com>
	<EC3D7B97-9AAD-4626-BC5E-3372344AB155@r-project.org>
	<19954.29221.228372.585633@max.nulle.part>
	<7A15D454-E03A-442B-9912-83EDEABEDA93@r-project.org>
Message-ID: <19954.31453.458383.962582@max.nulle.part>


On 10 June 2011 at 16:04, Simon Urbanek wrote:
| On Jun 10, 2011, at 3:36 PM, Dirk Eddelbuettel wrote:
| > | That said, you can simply use cat() in .First.lib (if your packages has no namespace) or .onAttach or .onLoad (if your packages has a namespace).
| > 
| > No, not cat() --- please use   packageStartupMessage()   as that can actually 
| > be suppressed easily.
| > 
| 
| Thanks, very, very good point -- that many package authors did not get (I actually checked a few packages before replying and they all use cat() ... eek).

Yup :)  I have over the years contacted a few fellow package authors to get
this changes.  

Lots to do still.  Maybe R CMD check should look into .onLoad() et al?

Dirk

-- 
Gauss once played himself in a zero-sum game and won $50.
                      -- #11 at http://www.gaussfacts.com


From kornelius.rohmeyer at small-projects.de  Sat Jun 11 00:52:52 2011
From: kornelius.rohmeyer at small-projects.de (Kornelius Rohmeyer)
Date: Sat, 11 Jun 2011 00:52:52 +0200
Subject: [Rd] CRAN package with dependencies on Bioconductor
Message-ID: <BANLkTinzAC44xnkHzVk+=BK3qaPYPQqtkA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110611/5cd9153c/attachment.pl>

From kornelius.rohmeyer at small-projects.de  Sat Jun 11 01:04:52 2011
From: kornelius.rohmeyer at small-projects.de (Kornelius Rohmeyer)
Date: Sat, 11 Jun 2011 01:04:52 +0200
Subject: [Rd] CRAN package with dependencies on Bioconductor
In-Reply-To: <BANLkTinzAC44xnkHzVk+=BK3qaPYPQqtkA@mail.gmail.com>
References: <BANLkTinzAC44xnkHzVk+=BK3qaPYPQqtkA@mail.gmail.com>
Message-ID: <BANLkTi=aOE4hPt9YRw=PqXkpk2Jcv8rRqA@mail.gmail.com>

I'm sorry for sending a wrongly formated mail before. This is the missing text:

Dear all,

for a CRAN-package that depends on another Bioconductor-package I find
two things annoying and would like to know whether there are some
workarounds:

1) Is there some inevitable problem that install.packages does not
install uninstalled packages (on which the specified package depends)
also from Bioconductor (in the correct version)?

2) In my understanding (please correct me if I'm wrong!) CRAN uses
bioconductor packages in another version than biocLite would install.
For example:

Our package gMCP depends on the package graph that has recently
switched to the bioconductor repositories. But even the following
commands will fail (i.e. install incompatible versions) for R 2.12
under Windows (and most likely MacOS):

source("http://www.bioconductor.org/biocLite.R")
biocLite("graph")
install.packages("gMCP")

This results in errors like the following:

> BonferroniHolmGraph(2)
Error in validObject(.Object) :
  invalid class "graphMCP" object: superclass "graphBase" not defined
in the environment of the object's class

The superclass graphBase is introduced in graph 1.30. In my
understanding the problem is that our package gMCP is build on CRAN
for R 2.12 with the package graph in version 1.30. Unfortunately
biocLite installs graph_1.28.0.zip for R 2.12.

Are there ways to make dependencies on Bioconductor less complicated?

Thanks and best regards, Kornelius


From mtmorgan at fhcrc.org  Sat Jun 11 01:37:03 2011
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Fri, 10 Jun 2011 16:37:03 -0700
Subject: [Rd] CRAN package with dependencies on Bioconductor
In-Reply-To: <BANLkTi=aOE4hPt9YRw=PqXkpk2Jcv8rRqA@mail.gmail.com>
References: <BANLkTinzAC44xnkHzVk+=BK3qaPYPQqtkA@mail.gmail.com>
	<BANLkTi=aOE4hPt9YRw=PqXkpk2Jcv8rRqA@mail.gmail.com>
Message-ID: <4DF2AA9F.60907@fhcrc.org>

On 06/10/2011 04:04 PM, Kornelius Rohmeyer wrote:
> I'm sorry for sending a wrongly formated mail before. This is the missing text:
>
> Dear all,
>
> for a CRAN-package that depends on another Bioconductor-package I find
> two things annoying and would like to know whether there are some
> workarounds:
>
> 1) Is there some inevitable problem that install.packages does not
> install uninstalled packages (on which the specified package depends)
> also from Bioconductor (in the correct version)?

I don't understand what you are asking; a previously installed but then 
uninstalled package will not influence the ability of R to reinstall it.

> 2) In my understanding (please correct me if I'm wrong!) CRAN uses
> bioconductor packages in another version than biocLite would install.
> For example:

Usually, if you

   setRepositories()

and choose BioCsoft, then you will have chosen the correct (i.e., 'same 
as biocLite') bioc repository for your version of R (this can be 
scripted by inspecting

   read.table(file.path(R.home("etc"), "repositories"),
              header=TRUE, sep="\t")

and using appropriate row indexes as the 'ind' argument to setRepositories).

> Our package gMCP depends on the package graph that has recently
> switched to the bioconductor repositories. But even the following
> commands will fail (i.e. install incompatible versions) for R 2.12
> under Windows (and most likely MacOS):
>
> source("http://www.bioconductor.org/biocLite.R")
> biocLite("graph")
> install.packages("gMCP")

> This results in errors like the following:
>
>> BonferroniHolmGraph(2)
> Error in validObject(.Object) :
>    invalid class "graphMCP" object: superclass "graphBase" not defined
> in the environment of the object's class
>
> The superclass graphBase is introduced in graph 1.30. In my
> understanding the problem is that our package gMCP is build on CRAN
> for R 2.12 with the package graph in version 1.30. Unfortunately
> biocLite installs graph_1.28.0.zip for R 2.12.

biocLite is returning the correct package -- graph 1.28.0. graph 1.30 
did not come in to existence until the most recent release, 2011-04-13, 
approximately when R-2.13 became the current release version.

CRAN is building packages with the current release, R-2.13, for which 
biocLite and install.packages both (correctly) return graph 1.30.

> Are there ways to make dependencies on Bioconductor less complicated?

Use the current version of R.

FWIW, part of the motivation for hosting graph only on Bioconductor 
(previously it was dual-hosted) is to simplify version problems -- prior 
to the change, the CRAN version was several releases out of date!

Martin

>
> Thanks and best regards, Kornelius
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Computational Biology
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109

Location: M1-B861
Telephone: 206 667-2793


From murdoch.duncan at gmail.com  Sat Jun 11 02:02:26 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 10 Jun 2011 20:02:26 -0400
Subject: [Rd] CRAN package with dependencies on Bioconductor
In-Reply-To: <BANLkTi=aOE4hPt9YRw=PqXkpk2Jcv8rRqA@mail.gmail.com>
References: <BANLkTinzAC44xnkHzVk+=BK3qaPYPQqtkA@mail.gmail.com>
	<BANLkTi=aOE4hPt9YRw=PqXkpk2Jcv8rRqA@mail.gmail.com>
Message-ID: <4DF2B092.4080402@gmail.com>

On 11-06-10 7:04 PM, Kornelius Rohmeyer wrote:
> I'm sorry for sending a wrongly formated mail before. This is the missing text:
>
> Dear all,
>
> for a CRAN-package that depends on another Bioconductor-package I find
> two things annoying and would like to know whether there are some
> workarounds:
>
> 1) Is there some inevitable problem that install.packages does not
> install uninstalled packages (on which the specified package depends)
> also from Bioconductor (in the correct version)?
>
> 2) In my understanding (please correct me if I'm wrong!) CRAN uses
> bioconductor packages in another version than biocLite would install.
> For example:
>
> Our package gMCP depends on the package graph that has recently
> switched to the bioconductor repositories. But even the following
> commands will fail (i.e. install incompatible versions) for R 2.12
> under Windows (and most likely MacOS):
>
> source("http://www.bioconductor.org/biocLite.R")
> biocLite("graph")
> install.packages("gMCP")
>
> This results in errors like the following:
>
>> BonferroniHolmGraph(2)
> Error in validObject(.Object) :
>    invalid class "graphMCP" object: superclass "graphBase" not defined
> in the environment of the object's class
>
> The superclass graphBase is introduced in graph 1.30. In my
> understanding the problem is that our package gMCP is build on CRAN
> for R 2.12 with the package graph in version 1.30. Unfortunately
> biocLite installs graph_1.28.0.zip for R 2.12.
>
> Are there ways to make dependencies on Bioconductor less complicated?

Users of your package are likely to have issues; make sure you document 
that they need to include the Bioconductor repository as well as CRAN.

You can specify a version in a dependency (or a version range).  I don't 
know if BioC will make old versions available in binary formats, but 
they will probably make source versions available.

Duncan Murdoch


From kornelius.rohmeyer at small-projects.de  Sat Jun 11 02:46:07 2011
From: kornelius.rohmeyer at small-projects.de (Kornelius Rohmeyer)
Date: Sat, 11 Jun 2011 02:46:07 +0200
Subject: [Rd] CRAN package with dependencies on Bioconductor
In-Reply-To: <4DF2AA9F.60907@fhcrc.org>
References: <BANLkTinzAC44xnkHzVk+=BK3qaPYPQqtkA@mail.gmail.com>
	<BANLkTi=aOE4hPt9YRw=PqXkpk2Jcv8rRqA@mail.gmail.com>
	<4DF2AA9F.60907@fhcrc.org>
Message-ID: <BANLkTi=0m40VwTFcbbyLtw4pjLQwbNwMeA@mail.gmail.com>

Dear Martin,

thanks for your response.

>> The superclass graphBase is introduced in graph 1.30. In my
>> understanding the problem is that our package gMCP is build on CRAN
>> for R 2.12 with the package graph in version 1.30. Unfortunately
>> biocLite installs graph_1.28.0.zip for R 2.12.
>
> biocLite is returning the correct package -- graph 1.28.0. graph 1.30 did
> not come in to existence until the most recent release, 2011-04-13,
> approximately when R-2.13 became the current release version.
>
> CRAN is building packages with the current release, R-2.13, for which
> biocLite and install.packages both (correctly) return graph 1.30.

I doubt this, i.e. CRAN is also still building packages for R 2.12 -
and is using graph 1.30 for this as far as I understand it (instead of
1.28).

>> Are there ways to make dependencies on Bioconductor less complicated?
>
> Use the current version of R.

So you agree that it is impossible to give a reasonable instruction to
install such binary packages for older versions of R like the four
month old R 2.12? (Reasonable means without manual installation of
packages in the correct versions - where the correct versions have to
be found out by the maintainer.)

Best regards, Kornelius.


From mtmorgan at fhcrc.org  Sat Jun 11 05:50:53 2011
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Fri, 10 Jun 2011 20:50:53 -0700
Subject: [Rd] CRAN package with dependencies on Bioconductor
In-Reply-To: <BANLkTi=0m40VwTFcbbyLtw4pjLQwbNwMeA@mail.gmail.com>
References: <BANLkTinzAC44xnkHzVk+=BK3qaPYPQqtkA@mail.gmail.com>	<BANLkTi=aOE4hPt9YRw=PqXkpk2Jcv8rRqA@mail.gmail.com>	<4DF2AA9F.60907@fhcrc.org>
	<BANLkTi=0m40VwTFcbbyLtw4pjLQwbNwMeA@mail.gmail.com>
Message-ID: <4DF2E61D.8080009@fhcrc.org>

On 06/10/2011 05:46 PM, Kornelius Rohmeyer wrote:
> Dear Martin,
>
> thanks for your response.
>
>>> The superclass graphBase is introduced in graph 1.30. In my
>>> understanding the problem is that our package gMCP is build on CRAN
>>> for R 2.12 with the package graph in version 1.30. Unfortunately
>>> biocLite installs graph_1.28.0.zip for R 2.12.
>>
>> biocLite is returning the correct package -- graph 1.28.0. graph 1.30 did
>> not come in to existence until the most recent release, 2011-04-13,
>> approximately when R-2.13 became the current release version.
>>
>> CRAN is building packages with the current release, R-2.13, for which
>> biocLite and install.packages both (correctly) return graph 1.30.
>
> I doubt this, i.e. CRAN is also still building packages for R 2.12 -
> and is using graph 1.30 for this as far as I understand it (instead of
> 1.28).

I'm not intimately familiar with CRAN's build system, so perhaps I 
mis-spoke; Bioconductor packages are versioned in synchrony with R 
releases. If your package requires graph >= 1.30, specify that in the 
DESCRIPTION. If your users want features introduced when your package 
requires graph >= 1.30, direct them to use R >= 2.13.

Martin

>>> Are there ways to make dependencies on Bioconductor less complicated?
>>
>> Use the current version of R.
>
> So you agree that it is impossible to give a reasonable instruction
> install such binary packages for older versions of R like the four
> month old R 2.12? (Reasonable means without manual installation of
> packages in the correct versions - where the correct versions have to
> be found out by the maintainer.)
>
> Best regards, Kornelius.


-- 
Computational Biology
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109

Location: M1-B861
Telephone: 206 667-2793


From kornelius.rohmeyer at small-projects.de  Sat Jun 11 06:29:27 2011
From: kornelius.rohmeyer at small-projects.de (Kornelius Rohmeyer)
Date: Sat, 11 Jun 2011 06:29:27 +0200
Subject: [Rd] CRAN package with dependencies on Bioconductor
In-Reply-To: <4DF2E61D.8080009@fhcrc.org>
References: <BANLkTinzAC44xnkHzVk+=BK3qaPYPQqtkA@mail.gmail.com>
	<BANLkTi=aOE4hPt9YRw=PqXkpk2Jcv8rRqA@mail.gmail.com>
	<4DF2AA9F.60907@fhcrc.org>
	<BANLkTi=0m40VwTFcbbyLtw4pjLQwbNwMeA@mail.gmail.com>
	<4DF2E61D.8080009@fhcrc.org>
Message-ID: <BANLkTikYttQ7PXdvDYfoETu3iXaX5e-o6Q@mail.gmail.com>

2011/6/11 Martin Morgan <mtmorgan at fhcrc.org>:
> On 06/10/2011 05:46 PM, Kornelius Rohmeyer wrote:
>>
>> Dear Martin,
>>
>> thanks for your response.
>>
>>>> The superclass graphBase is introduced in graph 1.30. In my
>>>> understanding the problem is that our package gMCP is build on CRAN
>>>> for R 2.12 with the package graph in version 1.30. Unfortunately
>>>> biocLite installs graph_1.28.0.zip for R 2.12.
>>>
>>> biocLite is returning the correct package -- graph 1.28.0. graph 1.30 did
>>> not come in to existence until the most recent release, 2011-04-13,
>>> approximately when R-2.13 became the current release version.
>>>
>>> CRAN is building packages with the current release, R-2.13, for which
>>> biocLite and install.packages both (correctly) return graph 1.30.
>>
>> I doubt this, i.e. CRAN is also still building packages for R 2.12 -
>> and is using graph 1.30 for this as far as I understand it (instead of
>> 1.28).
>
> I'm not intimately familiar with CRAN's build system, so perhaps I
> mis-spoke; Bioconductor packages are versioned in synchrony with R releases.
> If your package requires graph >= 1.30, specify that in the DESCRIPTION. If
> your users want features introduced when your package requires graph >=
> 1.30, direct them to use R >= 2.13.

I understand this. But my package does not require graph >= 1.30.
(And if I install the source packages everything is always fine.)
The problem is again that R 2.12 installs graph 1.28
but the CRAN packages for R 2.12 are build for graph 1.30.
So the default binary packages are incompatible for R 2.12.

Best regards, Kornelius.

>
> Martin
>
>>>> Are there ways to make dependencies on Bioconductor less complicated?
>>>
>>> Use the current version of R.
>>
>> So you agree that it is impossible to give a reasonable instruction
>> install such binary packages for older versions of R like the four
>> month old R 2.12? (Reasonable means without manual installation of
>> packages in the correct versions - where the correct versions have to
>> be found out by the maintainer.)
>>
>> Best regards, Kornelius.
>
>
> --
> Computational Biology
> Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109
>
> Location: M1-B861
> Telephone: 206 667-2793
>


From kornelius.rohmeyer at small-projects.de  Sat Jun 11 07:09:44 2011
From: kornelius.rohmeyer at small-projects.de (Kornelius Rohmeyer)
Date: Sat, 11 Jun 2011 07:09:44 +0200
Subject: [Rd] CRAN package with dependencies on Bioconductor
In-Reply-To: <4DF2B092.4080402@gmail.com>
References: <BANLkTinzAC44xnkHzVk+=BK3qaPYPQqtkA@mail.gmail.com>
	<BANLkTi=aOE4hPt9YRw=PqXkpk2Jcv8rRqA@mail.gmail.com>
	<4DF2B092.4080402@gmail.com>
Message-ID: <BANLkTikru+-6VfNcdkU13+x0WSoVkBgqAg@mail.gmail.com>

2011/6/11 Duncan Murdoch <murdoch.duncan at gmail.com>:
> On 11-06-10 7:04 PM, Kornelius Rohmeyer wrote:
>> Dear all,
>>
>> for a CRAN-package that depends on another Bioconductor-package I find
>> two things annoying and would like to know whether there are some
>> workarounds:
>>
>> 1) Is there some inevitable problem that install.packages does not
>> install uninstalled packages (on which the specified package depends)
>> also from Bioconductor (in the correct version)?
>>
>> 2) In my understanding (please correct me if I'm wrong!) CRAN uses
>> bioconductor packages in another version than biocLite would install.
>> For example:
>>
>> Our package gMCP depends on the package graph that has recently
>> switched to the bioconductor repositories. But even the following
>> commands will fail (i.e. install incompatible versions) for R 2.12
>> under Windows (and most likely MacOS):
>>
>> source("http://www.bioconductor.org/biocLite.R")
>> biocLite("graph")
>> install.packages("gMCP")
>>
>> This results in errors like the following:
>>
>>> BonferroniHolmGraph(2)
>>
>> Error in validObject(.Object) :
>> ? invalid class "graphMCP" object: superclass "graphBase" not defined
>> in the environment of the object's class
>>
>> The superclass graphBase is introduced in graph 1.30. In my
>> understanding the problem is that our package gMCP is build on CRAN
>> for R 2.12 with the package graph in version 1.30. Unfortunately
>> biocLite installs graph_1.28.0.zip for R 2.12.
>>
>> Are there ways to make dependencies on Bioconductor less complicated?
>
> Users of your package are likely to have issues; make sure you document that
> they need to include the Bioconductor repository as well as CRAN.
>
> You can specify a version in a dependency (or a version range). ?I don't
> know if BioC will make old versions available in binary formats, but they
> will probably make source versions available.
>
> Duncan Murdoch
>

Dear Duncan,

the main problem is not addressed by specifying a certain version (or
at least I do not see how), since it's not the case that the package
requires certain versions. The problem is that the default binary
packages of the CRAN package and the Bioconductor package it depends
on are incompatible for R 2.12, since CRAN uses a different version of
the Bioconductor package for building. (For the source packages of
course no problem exists.) Btw. is there a way to find out which
versions of the dependent packages were used for building a certain
binary package? (I guess in the moment, that CRAN uses always the
newest available source packages.)
These kind of incompatibilities are extremely hard to track for the
package developer. So if there is not a way to install the correct
corresponding compatible binary packages from CRAN and Bioconductor,
may I suggest that CRAN uses the same versions of dependent
Bioconductor packages for the build of binary packages as Bioconductor
is providing in binary form by default for the respective R versions?

Or am totally on the wrong track?

Thank you very much and best regards, Kornelius.


From ripley at stats.ox.ac.uk  Sat Jun 11 08:07:19 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 11 Jun 2011 07:07:19 +0100 (BST)
Subject: [Rd] CRAN package with dependencies on Bioconductor
In-Reply-To: <4DF2E61D.8080009@fhcrc.org>
References: <BANLkTinzAC44xnkHzVk+=BK3qaPYPQqtkA@mail.gmail.com>
	<BANLkTi=aOE4hPt9YRw=PqXkpk2Jcv8rRqA@mail.gmail.com>
	<4DF2AA9F.60907@fhcrc.org>
	<BANLkTi=0m40VwTFcbbyLtw4pjLQwbNwMeA@mail.gmail.com>
	<4DF2E61D.8080009@fhcrc.org>
Message-ID: <alpine.LFD.2.02.1106110702420.24811@gannet.stats.ox.ac.uk>

Note that until May 8 graph was a CRAN packge and the current version 
was 1.30.0.  So of course CRAN binary packages built between April 26 
and May 8 were built against the current CRAN version of graph, for 
any version of R.

On Fri, 10 Jun 2011, Martin Morgan wrote:

> On 06/10/2011 05:46 PM, Kornelius Rohmeyer wrote:
>> Dear Martin,
>> 
>> thanks for your response.
>> 
>>>> The superclass graphBase is introduced in graph 1.30. In my
>>>> understanding the problem is that our package gMCP is build on CRAN
>>>> for R 2.12 with the package graph in version 1.30. Unfortunately
>>>> biocLite installs graph_1.28.0.zip for R 2.12.
>>> 
>>> biocLite is returning the correct package -- graph 1.28.0. graph 1.30 did
>>> not come in to existence until the most recent release, 2011-04-13,
>>> approximately when R-2.13 became the current release version.
>>> 
>>> CRAN is building packages with the current release, R-2.13, for which
>>> biocLite and install.packages both (correctly) return graph 1.30.
>> 
>> I doubt this, i.e. CRAN is also still building packages for R 2.12 -
>> and is using graph 1.30 for this as far as I understand it (instead of
>> 1.28).
>
> I'm not intimately familiar with CRAN's build system, so perhaps I mis-spoke; 
> Bioconductor packages are versioned in synchrony with R releases. If your 
> package requires graph >= 1.30, specify that in the DESCRIPTION. If your 
> users want features introduced when your package requires graph >= 1.30, 
> direct them to use R >= 2.13.
>
> Martin
>
>>>> Are there ways to make dependencies on Bioconductor less complicated?
>>> 
>>> Use the current version of R.
>> 
>> So you agree that it is impossible to give a reasonable instruction
>> install such binary packages for older versions of R like the four
>> month old R 2.12? (Reasonable means without manual installation of
>> packages in the correct versions - where the correct versions have to
>> be found out by the maintainer.)
>> 
>> Best regards, Kornelius.
>
>
> -- 
> Computational Biology
> Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109
>
> Location: M1-B861
> Telephone: 206 667-2793
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From kornelius.rohmeyer at small-projects.de  Sat Jun 11 09:10:28 2011
From: kornelius.rohmeyer at small-projects.de (Kornelius Rohmeyer)
Date: Sat, 11 Jun 2011 09:10:28 +0200
Subject: [Rd] CRAN package with dependencies on Bioconductor
In-Reply-To: <alpine.LFD.2.02.1106110702420.24811@gannet.stats.ox.ac.uk>
References: <BANLkTinzAC44xnkHzVk+=BK3qaPYPQqtkA@mail.gmail.com>
	<BANLkTi=aOE4hPt9YRw=PqXkpk2Jcv8rRqA@mail.gmail.com>
	<4DF2AA9F.60907@fhcrc.org>
	<BANLkTi=0m40VwTFcbbyLtw4pjLQwbNwMeA@mail.gmail.com>
	<4DF2E61D.8080009@fhcrc.org>
	<alpine.LFD.2.02.1106110702420.24811@gannet.stats.ox.ac.uk>
Message-ID: <BANLkTi=teaNJnVQXGXcdLCd1c7dDnp=7bA@mail.gmail.com>

2011/6/11 Prof Brian Ripley <ripley at stats.ox.ac.uk>:
> Note that until May 8 graph was a CRAN packge and the current version was
> 1.30.0. ?So of course CRAN binary packages built between April 26 and May 8
> were built against the current CRAN version of graph, for any version of R.

Thanks for the notice! But if I am not wrong, a version of my package
that was published on May 26 and build therefore after the time period
specified by you still suffers from these version incompatibilities.
(Nevertheless it is of course possible that the problem is only caused
by the migration to Bioconductor and in this case less problematic and
only unfortunate in this one case). Perhaps the version downgrade of
the graph package caused problems?

So you say that the versions of Bioconductor packages on CRAN for
binary builds are already normally the same as you would get by
installing them as binaries from Bioconductor? (And btw. is there a
way to find out which versions of the dependent packages were used for
building a certain binary package?)

Thanks and best regards, Kornelius.

>
> On Fri, 10 Jun 2011, Martin Morgan wrote:
>
>> On 06/10/2011 05:46 PM, Kornelius Rohmeyer wrote:
>>>
>>> Dear Martin,
>>>
>>> thanks for your response.
>>>
>>>>> The superclass graphBase is introduced in graph 1.30. In my
>>>>> understanding the problem is that our package gMCP is build on CRAN
>>>>> for R 2.12 with the package graph in version 1.30. Unfortunately
>>>>> biocLite installs graph_1.28.0.zip for R 2.12.
>>>>
>>>> biocLite is returning the correct package -- graph 1.28.0. graph 1.30
>>>> did
>>>> not come in to existence until the most recent release, 2011-04-13,
>>>> approximately when R-2.13 became the current release version.
>>>>
>>>> CRAN is building packages with the current release, R-2.13, for which
>>>> biocLite and install.packages both (correctly) return graph 1.30.
>>>
>>> I doubt this, i.e. CRAN is also still building packages for R 2.12 -
>>> and is using graph 1.30 for this as far as I understand it (instead of
>>> 1.28).
>>
>> I'm not intimately familiar with CRAN's build system, so perhaps I
>> mis-spoke; Bioconductor packages are versioned in synchrony with R releases.
>> If your package requires graph >= 1.30, specify that in the DESCRIPTION. If
>> your users want features introduced when your package requires graph >=
>> 1.30, direct them to use R >= 2.13.
>>
>> Martin
>>
>>>>> Are there ways to make dependencies on Bioconductor less complicated?
>>>>
>>>> Use the current version of R.
>>>
>>> So you agree that it is impossible to give a reasonable instruction
>>> install such binary packages for older versions of R like the four
>>> month old R 2.12? (Reasonable means without manual installation of
>>> packages in the correct versions - where the correct versions have to
>>> be found out by the maintainer.)
>>>
>>> Best regards, Kornelius.
>>
>>
>> --
>> Computational Biology
>> Fred Hutchinson Cancer Research Center
>> 1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109
>>
>> Location: M1-B861
>> Telephone: 206 667-2793
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> --
> Brian D. Ripley, ? ? ? ? ? ? ? ? ?ripley at stats.ox.ac.uk
> Professor of Applied Statistics, ?http://www.stats.ox.ac.uk/~ripley/
> University of Oxford, ? ? ? ? ? ? Tel: ?+44 1865 272861 (self)
> 1 South Parks Road, ? ? ? ? ? ? ? ? ? ? +44 1865 272866 (PA)
> Oxford OX1 3TG, UK ? ? ? ? ? ? ? ?Fax: ?+44 1865 272595
>


From ripley at stats.ox.ac.uk  Sat Jun 11 09:50:21 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 11 Jun 2011 08:50:21 +0100 (BST)
Subject: [Rd] CRAN package with dependencies on Bioconductor
In-Reply-To: <BANLkTi=teaNJnVQXGXcdLCd1c7dDnp=7bA@mail.gmail.com>
References: <BANLkTinzAC44xnkHzVk+=BK3qaPYPQqtkA@mail.gmail.com>
	<BANLkTi=aOE4hPt9YRw=PqXkpk2Jcv8rRqA@mail.gmail.com>
	<4DF2AA9F.60907@fhcrc.org>
	<BANLkTi=0m40VwTFcbbyLtw4pjLQwbNwMeA@mail.gmail.com>
	<4DF2E61D.8080009@fhcrc.org>
	<alpine.LFD.2.02.1106110702420.24811@gannet.stats.ox.ac.uk>
	<BANLkTi=teaNJnVQXGXcdLCd1c7dDnp=7bA@mail.gmail.com>
Message-ID: <alpine.LFD.2.02.1106110828190.10877@gannet.stats.ox.ac.uk>

On Sat, 11 Jun 2011, Kornelius Rohmeyer wrote:

> 2011/6/11 Prof Brian Ripley <ripley at stats.ox.ac.uk>:
>> Note that until May 8 graph was a CRAN packge and the current version was
>> 1.30.0. ?So of course CRAN binary packages built between April 26 and May 8
>> were built against the current CRAN version of graph, for any version of R.
>
> Thanks for the notice! But if I am not wrong, a version of my package
> that was published on May 26 and build therefore after the time period
> specified by you still suffers from these version incompatibilities.
> (Nevertheless it is of course possible that the problem is only caused
> by the migration to Bioconductor and in this case less problematic and
> only unfortunate in this one case). Perhaps the version downgrade of
> the graph package caused problems?

> So you say that the versions of Bioconductor packages on CRAN for
> binary builds are already normally the same as you would get by
> installing them as binaries from Bioconductor?

No, I did not say that.

[...]

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From kornelius.rohmeyer at small-projects.de  Sat Jun 11 10:20:35 2011
From: kornelius.rohmeyer at small-projects.de (Kornelius Rohmeyer)
Date: Sat, 11 Jun 2011 10:20:35 +0200
Subject: [Rd] CRAN package with dependencies on Bioconductor
In-Reply-To: <alpine.LFD.2.02.1106110828190.10877@gannet.stats.ox.ac.uk>
References: <BANLkTinzAC44xnkHzVk+=BK3qaPYPQqtkA@mail.gmail.com>
	<BANLkTi=aOE4hPt9YRw=PqXkpk2Jcv8rRqA@mail.gmail.com>
	<4DF2AA9F.60907@fhcrc.org>
	<BANLkTi=0m40VwTFcbbyLtw4pjLQwbNwMeA@mail.gmail.com>
	<4DF2E61D.8080009@fhcrc.org>
	<alpine.LFD.2.02.1106110702420.24811@gannet.stats.ox.ac.uk>
	<BANLkTi=teaNJnVQXGXcdLCd1c7dDnp=7bA@mail.gmail.com>
	<alpine.LFD.2.02.1106110828190.10877@gannet.stats.ox.ac.uk>
Message-ID: <BANLkTi=D0+7QbCs2KEk2Vy0-midK56vKiA@mail.gmail.com>

2011/6/11 Prof Brian Ripley <ripley at stats.ox.ac.uk>:
> On Sat, 11 Jun 2011, Kornelius Rohmeyer wrote:
>> 2011/6/11 Prof Brian Ripley <ripley at stats.ox.ac.uk>:
>>> Note that until May 8 graph was a CRAN packge and the current version was
>>> 1.30.0.  So of course CRAN binary packages built between April 26 and May
>>> 8
>>> were built against the current CRAN version of graph, for any version of
>>> R.
>>
>> Thanks for the notice! But if I am not wrong, a version of my package
>> that was published on May 26 and build therefore after the time period
>> specified by you still suffers from these version incompatibilities.
>> (Nevertheless it is of course possible that the problem is only caused
>> by the migration to Bioconductor and in this case less problematic and
>> only unfortunate in this one case). Perhaps the version downgrade of
>> the graph package caused problems?
>
>> So you say that the versions of Bioconductor packages on CRAN for
>> binary builds are already normally the same as you would get by
>> installing them as binaries from Bioconductor?
>
> No, I did not say that.

That means that for a binary package that depends on Bioconductor
packages you sometimes need a bit of luck to select the correct
versions of binary Bioconductor packages? Or is there a way to tell
which (and an easy way to install them)?

Thanks and best regards, Kornelius.


From ligges at statistik.tu-dortmund.de  Sat Jun 11 14:15:46 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sat, 11 Jun 2011 14:15:46 +0200
Subject: [Rd] CRAN package with dependencies on Bioconductor
In-Reply-To: <BANLkTi=D0+7QbCs2KEk2Vy0-midK56vKiA@mail.gmail.com>
References: <BANLkTinzAC44xnkHzVk+=BK3qaPYPQqtkA@mail.gmail.com>	<BANLkTi=aOE4hPt9YRw=PqXkpk2Jcv8rRqA@mail.gmail.com>	<4DF2AA9F.60907@fhcrc.org>	<BANLkTi=0m40VwTFcbbyLtw4pjLQwbNwMeA@mail.gmail.com>	<4DF2E61D.8080009@fhcrc.org>	<alpine.LFD.2.02.1106110702420.24811@gannet.stats.ox.ac.uk>	<BANLkTi=teaNJnVQXGXcdLCd1c7dDnp=7bA@mail.gmail.com>	<alpine.LFD.2.02.1106110828190.10877@gannet.stats.ox.ac.uk>
	<BANLkTi=D0+7QbCs2KEk2Vy0-midK56vKiA@mail.gmail.com>
Message-ID: <4DF35C72.6080601@statistik.tu-dortmund.de>

Actually I do not understand what is so hard to understand with CRAN policy.

This is:
Any source package on CRAN is build in binary form with 
R-release/patched and R-oldrelease. This does not happen if you tell 
your package it requires a particular R version - such as the 
declaration R (>= 2.13.0) in the Depends field will cause the package 
not to be build as a binary. Anotehr exception would be if the package 
does not longer pass the checks and gives an ERROR, in that case we also 
keep the old version in the binary repository.

On CRAN we assume that R-2.12.x users may want to get a bugfix release 
of a package without the requirement to upgrade R, hence we distribute 
new or updates packages for the oldrelease version (which is current 
R-2.12.x). And if BioC has a different policy, that is fine with us.


Uwe Ligges



On 11.06.2011 10:20, Kornelius Rohmeyer wrote:
> 2011/6/11 Prof Brian Ripley<ripley at stats.ox.ac.uk>:
>> On Sat, 11 Jun 2011, Kornelius Rohmeyer wrote:
>>> 2011/6/11 Prof Brian Ripley<ripley at stats.ox.ac.uk>:
>>>> Note that until May 8 graph was a CRAN packge and the current version was
>>>> 1.30.0.  So of course CRAN binary packages built between April 26 and May
>>>> 8
>>>> were built against the current CRAN version of graph, for any version of
>>>> R.
>>>
>>> Thanks for the notice! But if I am not wrong, a version of my package
>>> that was published on May 26 and build therefore after the time period
>>> specified by you still suffers from these version incompatibilities.
>>> (Nevertheless it is of course possible that the problem is only caused
>>> by the migration to Bioconductor and in this case less problematic and
>>> only unfortunate in this one case). Perhaps the version downgrade of
>>> the graph package caused problems?
>>
>>> So you say that the versions of Bioconductor packages on CRAN for
>>> binary builds are already normally the same as you would get by
>>> installing them as binaries from Bioconductor?
>>
>> No, I did not say that.
>
> That means that for a binary package that depends on Bioconductor
> packages you sometimes need a bit of luck to select the correct
> versions of binary Bioconductor packages? Or is there a way to tell
> which (and an easy way to install them)?
>
> Thanks and best regards, Kornelius.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Sat Jun 11 15:15:58 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 11 Jun 2011 09:15:58 -0400
Subject: [Rd] CRAN package with dependencies on Bioconductor
In-Reply-To: <BANLkTikru+-6VfNcdkU13+x0WSoVkBgqAg@mail.gmail.com>
References: <BANLkTinzAC44xnkHzVk+=BK3qaPYPQqtkA@mail.gmail.com>	<BANLkTi=aOE4hPt9YRw=PqXkpk2Jcv8rRqA@mail.gmail.com>	<4DF2B092.4080402@gmail.com>
	<BANLkTikru+-6VfNcdkU13+x0WSoVkBgqAg@mail.gmail.com>
Message-ID: <4DF36A8E.20902@gmail.com>

On 11-06-11 1:09 AM, Kornelius Rohmeyer wrote:
> 2011/6/11 Duncan Murdoch<murdoch.duncan at gmail.com>:
>> On 11-06-10 7:04 PM, Kornelius Rohmeyer wrote:
>>> Dear all,
>>>
>>> for a CRAN-package that depends on another Bioconductor-package I find
>>> two things annoying and would like to know whether there are some
>>> workarounds:
>>>
>>> 1) Is there some inevitable problem that install.packages does not
>>> install uninstalled packages (on which the specified package depends)
>>> also from Bioconductor (in the correct version)?
>>>
>>> 2) In my understanding (please correct me if I'm wrong!) CRAN uses
>>> bioconductor packages in another version than biocLite would install.
>>> For example:
>>>
>>> Our package gMCP depends on the package graph that has recently
>>> switched to the bioconductor repositories. But even the following
>>> commands will fail (i.e. install incompatible versions) for R 2.12
>>> under Windows (and most likely MacOS):
>>>
>>> source("http://www.bioconductor.org/biocLite.R")
>>> biocLite("graph")
>>> install.packages("gMCP")
>>>
>>> This results in errors like the following:
>>>
>>>> BonferroniHolmGraph(2)
>>>
>>> Error in validObject(.Object) :
>>>    invalid class "graphMCP" object: superclass "graphBase" not defined
>>> in the environment of the object's class
>>>
>>> The superclass graphBase is introduced in graph 1.30. In my
>>> understanding the problem is that our package gMCP is build on CRAN
>>> for R 2.12 with the package graph in version 1.30. Unfortunately
>>> biocLite installs graph_1.28.0.zip for R 2.12.
>>>
>>> Are there ways to make dependencies on Bioconductor less complicated?
>>
>> Users of your package are likely to have issues; make sure you document that
>> they need to include the Bioconductor repository as well as CRAN.
>>
>> You can specify a version in a dependency (or a version range).  I don't
>> know if BioC will make old versions available in binary formats, but they
>> will probably make source versions available.
>>
>> Duncan Murdoch
>>
>
> Dear Duncan,
>
> the main problem is not addressed by specifying a certain version (or
> at least I do not see how), since it's not the case that the package
> requires certain versions.

I don't understand.  It sounds as though you're saying these two 
contradictory things:

  - your package works with any version of graph
  - CRAN builds a version of graph that is incompatible with your package.



The problem is that the default binary
> packages of the CRAN package and the Bioconductor package it depends
> on are incompatible for R 2.12, since CRAN uses a different version of
> the Bioconductor package for building. (For the source packages of
> course no problem exists.) Btw. is there a way to find out which
> versions of the dependent packages were used for building a certain
> binary package? (I guess in the moment, that CRAN uses always the
> newest available source packages.)
> These kind of incompatibilities are extremely hard to track for the
> package developer. So if there is not a way to install the correct
> corresponding compatible binary packages from CRAN and Bioconductor,
> may I suggest that CRAN uses the same versions of dependent
> Bioconductor packages for the build of binary packages as Bioconductor
> is providing in binary form by default for the respective R versions?

I am not involved with setting CRAN policy, but their current policy 
(build the most recent version of a package that declares itself 
compatible with the relevant version of R) seems reasonable.

If for whatever reason this doesn't work for your package with R 2.12.x, 
I see two possible solutions:

  - Declare that your package now depends on R 2.13.0 or better.
  - Move your package to Bioconductor, if its policy for binary builds 
better matches your needs.

Duncan Murdoch

> Or am totally on the wrong track?
>
> Thank you very much and best regards, Kornelius.


From lawrence.michael at gene.com  Sun Jun 12 02:59:56 2011
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Sat, 11 Jun 2011 17:59:56 -0700
Subject: [Rd] Require of gWidgetsRGtk2 fails: RGtk2.dll can't be found,
 but it's there
In-Reply-To: <4DF216F4.3050205@googlemail.com>
References: <4DF1EC41.3090507@googlemail.com>
	<alpine.LFD.2.02.1106101215220.4009@toucan.stats.ox.ac.uk>
	<4DF20CEC.5000701@googlemail.com>
	<alpine.LFD.2.02.1106101332370.9756@toucan.stats.ox.ac.uk>
	<4DF216F4.3050205@googlemail.com>
Message-ID: <BANLkTinhy3rdf7=7uzxg0f8MW8C5sUhBzw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110611/3bc60f33/attachment.pl>

From marchywka at hotmail.com  Sat Jun 11 14:42:03 2011
From: marchywka at hotmail.com (Mike Marchywka)
Date: Sat, 11 Jun 2011 08:42:03 -0400
Subject: [Rd] arbitrary size data frame or other stcucts,
 curious about issues invovled.
Message-ID: <BLU166-w61D6720CE7F09FA60769EBE670@phx.gbl>


We keep getting questions on r-help about memory limits  and
I was curious to know what issues are involved in making 
common classes like dataframe work with disk and intelligent
swapping? That is, sure you can always rely on OS for VM 
but in theory it should be possible to make a data structure
that somehow knows what pieces you will access next and
can keep thos somewhere fast. Now of course algorithms 
"should" act locally and be block oriented but in any case
could communicate with data structures on upcoming 
access patterns, see a few ms into the future and have the 
right stuff prefetched.
 
I think things like "bigmemory" exist but perhaps one
issue was that this could not just drop in for data.frame
or does it already solve all the problems?
 
Is memory management just a non-issue or is there something
that needs to be done  to make large data structures work well?
 
 
Thanks.
 
 
-------------------

415-264-8477
marchywka at phluant.com

Online Advertising and Analytics for Mobile
http://www.phluant.com 		 	   		  

From tplate at acm.org  Sun Jun 12 16:57:33 2011
From: tplate at acm.org (Tony Plate)
Date: Sun, 12 Jun 2011 10:57:33 -0400
Subject: [Rd] Require of gWidgetsRGtk2 fails: RGtk2.dll can't be found,
 but it's there
In-Reply-To: <BANLkTinhy3rdf7=7uzxg0f8MW8C5sUhBzw@mail.gmail.com>
References: <4DF1EC41.3090507@googlemail.com>	<alpine.LFD.2.02.1106101215220.4009@toucan.stats.ox.ac.uk>	<4DF20CEC.5000701@googlemail.com>	<alpine.LFD.2.02.1106101332370.9756@toucan.stats.ox.ac.uk>	<4DF216F4.3050205@googlemail.com>
	<BANLkTinhy3rdf7=7uzxg0f8MW8C5sUhBzw@mail.gmail.com>
Message-ID: <4DF4D3DD.1060909@acm.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110612/00d59ce0/attachment.pl>

From sylvain.loiseau at unicaen.fr  Sun Jun 12 18:57:40 2011
From: sylvain.loiseau at unicaen.fr (Sylvain Loiseau)
Date: Sun, 12 Jun 2011 18:57:40 +0200
Subject: [Rd] Cross-compiling package
Message-ID: <08E4504D-914B-4AE3-A40B-A46DB6648D8D@unicaen.fr>

Hello,

I'm facing problems with compiling a package (containing only R-code and dataset) under OSX for Windows.

Is there a command line producing a zip archive that can be installed on Windows using the windows R GUI ?

Best,
Sylvain

From ligges at statistik.tu-dortmund.de  Sun Jun 12 19:04:14 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sun, 12 Jun 2011 19:04:14 +0200
Subject: [Rd] Cross-compiling package
In-Reply-To: <08E4504D-914B-4AE3-A40B-A46DB6648D8D@unicaen.fr>
References: <08E4504D-914B-4AE3-A40B-A46DB6648D8D@unicaen.fr>
Message-ID: <4DF4F18E.7080505@statistik.tu-dortmund.de>



On 12.06.2011 18:57, Sylvain Loiseau wrote:
> Hello,
>
> I'm facing problems with compiling a package (containing only R-code and dataset) under OSX for Windows.
>
> Is there a command line producing a zip archive that can be installed on Windows using the windows R GUI ?

Well, cross compiling was always rather difficult.  Why not just you the 
winbuilder service, if you do not have access to a Windows box:
http://win-builder.r-project.org/
It also provides you with check results for the Windows platform.

Best,
Uwe Ligges



> Best,
> Sylvain
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Sun Jun 12 20:28:27 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 12 Jun 2011 19:28:27 +0100 (BST)
Subject: [Rd] Cross-compiling package
In-Reply-To: <4DF4F18E.7080505@statistik.tu-dortmund.de>
References: <08E4504D-914B-4AE3-A40B-A46DB6648D8D@unicaen.fr>
	<4DF4F18E.7080505@statistik.tu-dortmund.de>
Message-ID: <alpine.LFD.2.02.1106121921580.2673@gannet.stats.ox.ac.uk>

On Sun, 12 Jun 2011, Uwe Ligges wrote:

> On 12.06.2011 18:57, Sylvain Loiseau wrote:
>> Hello,
>> 
>> I'm facing problems with compiling a package (containing only R-code and 
>> dataset) under OSX for Windows.

Packages are 'installed': compilation is only involved if they contain 
C/Fortran/C++/... source code.  It seems using the wrong term has 
misled people.

>> Is there a command line producing a zip archive that can be installed on 
>> Windows using the windows R GUI ?
>
> Well, cross compiling was always rather difficult.  Why not just you the 
> winbuilder service, if you do not have access to a Windows box:
> http://win-builder.r-project.org/
> It also provides you with check results for the Windows platform.

Good point, but there is no 'cross-compiling' involved here.

Suppose I have a package 'mypkg' installed on Mac OS X (to give it the 
correct name).  Then in a Terminal window

cd <directory above mypkg>
zip -r9X mypkg_ver.zip mypkg

where you need to set 'ver' to be the version number of the package, 
read from mypkg/DESCRIPTION.

>
> Best,
> Uwe Ligges
>
>
>
>> Best,
>> Sylvain
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From patrick.giraudoux at univ-fcomte.fr  Mon Jun 13 09:01:40 2011
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Mon, 13 Jun 2011 09:01:40 +0200
Subject: [Rd] tag \href not recognised in rd doc
In-Reply-To: <4DEC96E6.1050209@gmail.com>
References: <4DEB9919.8030809@univ-fcomte.fr> <4DEBE77B.4040800@gmail.com>
	<4DEC5A67.5020305@univ-fcomte.fr> <4DEC96E6.1050209@gmail.com>
Message-ID: <4DF5B5D4.4070202@univ-fcomte.fr>


Back from the field, I have been capable to update to R 2.13.0 today.  
\href is well recognised with this version and package check run OK.

Best,

Patrick


Le 06/06/2011 10:59, Duncan Murdoch a ?crit :
> On 11-06-06 12:41 AM, Patrick Giraudoux wrote:
>> Le 05/06/2011 22:30, Duncan Murdoch a ?crit :
>>> I don't get any error when I insert that code into a .Rd file in R
>>> 2.13.0 patched.  The NEWS file says this was fixed in 2.12.2 patched.
>>> What version are you using?
>>>
>>> Duncan Murdoch
>>>
>>
>> Currently R version 2.12.2 (2011-02-25) binary
>>
>> Suppose I should move to the 2.13.0 ?
>
> Yes, please do.
>
> Duncan Murdoch
>
>>
>> Patrick
>>
>>> On 11-06-05 10:56 AM, Patrick Giraudoux wrote:
>>>> Hi,
>>>>
>>>> I have a trouble trying to use \href in a rd doc. See example below:
>>>>
>>>> \references{
>>>>
>>>> \href{http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2702787/}{Vaniscotte
>>>> A., Pleydell D., Raoul F., Quere J.P., Coeurdassier M., Delattre 
>>>> P., Li
>>>> T., Qian W., Takahashi K., Weidmann J.C., Qiu J., Giraudoux P. 2009
>>>> Modelling and spatial discrimination of small mammal assemblages: an
>>>> example from western Sichuan (China). Ecological Modelling, 220:
>>>> 1218-1231.}
>>>>
>>>> }
>>>>
>>>>
>>>> The Rcmd check gives:
>>>>
>>>> * checking R code for possible problems ... OK
>>>> * checking Rd files ... WARNING
>>>> checkRd: (7) multignome.Rd:38: Tag \href not recognized
>>>>
>>>> I saw there is already a link on the issue
>>>> http://bugs.r-project.org/bugzilla3/show_bug.cgi?id=14535, but I 
>>>> hardly
>>>> understand if it is a real bug, if so if it have been fixed, or if 
>>>> I am
>>>> misusing the tag...
>>>>
>>>> Any hint appreciated,
>>>>
>>>> Best,
>>>>
>>>> Patrick
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
>
>


From hadley at rice.edu  Mon Jun 13 16:21:07 2011
From: hadley at rice.edu (Hadley Wickham)
Date: Mon, 13 Jun 2011 09:21:07 -0500
Subject: [Rd] Detecting development environment
Message-ID: <BANLkTi=+=sr5Xa=_L9cFSj_fP0XiHgohsA@mail.gmail.com>

Hi all,

Is there a straight-forward, cross-platform way of determining if a
user has all the tools needed to develop R packages (i.e. gcc etc)?
It doesn't need to be 100%, but should give a rough idea.  One idea I
had was simply to see if system("R CMD install --help") worked.

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From marchywka at hotmail.com  Mon Jun 13 16:32:05 2011
From: marchywka at hotmail.com (Mike Marchywka)
Date: Mon, 13 Jun 2011 10:32:05 -0400
Subject: [Rd] Detecting development environment
In-Reply-To: <BANLkTi=+=sr5Xa=_L9cFSj_fP0XiHgohsA@mail.gmail.com>
References: <BANLkTi=+=sr5Xa=_L9cFSj_fP0XiHgohsA@mail.gmail.com>
Message-ID: <BLU166-w3313DB99511AB561872656BE690@phx.gbl>





----------------------------------------
> From: hadley at rice.edu
> Date: Mon, 13 Jun 2011 09:21:07 -0500
> To: r-devel at r-project.org
> Subject: [Rd] Detecting development environment
>
> Hi all,
>
> Is there a straight-forward, cross-platform way of determining if a
> user has all the tools needed to develop R packages (i.e. gcc etc)?
> It doesn't need to be 100%, but should give a rough idea. One idea I
> had was simply to see if system("R CMD install --help") worked.


You could copy a configure script from just about anywhere and
adapt it. Not sure what you would do on 'dohs but the script
should be  able to support cygwin pretty easily.



>
> Hadley
>
> --
> Assistant Professor / Dobelman Family Junior Chair
> Department of Statistics / Rice University
> http://had.co.nz/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel 		 	   		  

From simon.urbanek at r-project.org  Mon Jun 13 16:36:11 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 13 Jun 2011 10:36:11 -0400
Subject: [Rd] Detecting development environment
In-Reply-To: <BANLkTi=+=sr5Xa=_L9cFSj_fP0XiHgohsA@mail.gmail.com>
References: <BANLkTi=+=sr5Xa=_L9cFSj_fP0XiHgohsA@mail.gmail.com>
Message-ID: <0D1AAABC-17B9-43A1-879D-3DA1BE7F4B51@r-project.org>


On Jun 13, 2011, at 10:21 AM, Hadley Wickham wrote:

> Hi all,
> 
> Is there a straight-forward, cross-platform way of determining if a
> user has all the tools needed to develop R packages (i.e. gcc etc)?
> It doesn't need to be 100%, but should give a rough idea.  One idea I
> had was simply to see if system("R CMD install --help") worked.
> 

That's not really checking pretty much anything (even if you used INSTALL ;)) since all it does is to run R.

More reasonable quick check may be R CMD SHLIB, though, since that involves both make and gcc:

echo 'void foo(int *bar) { *bar=1; }' > foo.c && R CMD SHLIB foo.c

And you could even check feasibility with something like

dyn.load(paste("foo",.Platform$dynlib.ext,sep=''))
stopifnot(.C("foo",0L)[[1]] == 1L)


From r.ted.byers at gmail.com  Mon Jun 13 16:56:37 2011
From: r.ted.byers at gmail.com (Ted Byers)
Date: Mon, 13 Jun 2011 10:56:37 -0400
Subject: [Rd] Detecting development environment
In-Reply-To: <BANLkTi=+=sr5Xa=_L9cFSj_fP0XiHgohsA@mail.gmail.com>
References: <BANLkTi=+=sr5Xa=_L9cFSj_fP0XiHgohsA@mail.gmail.com>
Message-ID: <051901cc29da$1966ab30$4c340190$@gmail.com>

One option would be to use autoconf and automake, and related tools.  That
is exactly what they're designed for, in the simplest case.  In more
advanced cases, I have seen them used to verify not only the existance of
selected tools and libraries, but also whether or not the implementation of
selected functions is buggy (as you may be aware, some implementations of
the standard C library leave a bit to be desired, at least for some
functions).  But you do have a little work to do to write some of the input
files they need; and you can make them flexible in terms of supporting
telling them were certain resources are located.  That said, the
documentation for them is pretty good relative to the norm for unix like
platforms.

As for being cross platform, I know they're available (or can be built) for
unix like platforms, and on Windows via cygwin (which I suppose counts as
unix-like).  I don't know about other platforms, and I don't know if you can
get them to work on Windows without cygwin (maybe as an addition to
RTools?).

As for being "straight-forward", I had directed a student to begin studying
autoconf/automake upon finishing a study of Gnu make, and the first day he
did so, he met with success and asked me, " was it supposed to be this
straightforward?"  This, from a guy that has only begun studying
programming!  BTW: he told me he planned to study R once he had mastered C++
and QuantLib.  He has a strong interest in quantitative finance, and so
would be looking at those R packages related to quantitative finance.

I suppose whether or not it is 100% depends on the quality of inputs you
provide.

HTH

Ted

> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
> project.org] On Behalf Of Hadley Wickham
> Sent: June-13-11 10:21 AM
> To: r-devel at r-project.org
> Subject: [Rd] Detecting development environment
> 
> Hi all,
> 
> Is there a straight-forward, cross-platform way of determining if a user
has all
> the tools needed to develop R packages (i.e. gcc etc)?
> It doesn't need to be 100%, but should give a rough idea.  One idea I had
was
> simply to see if system("R CMD install --help") worked.
> 
> Hadley
> 
> --
> Assistant Professor / Dobelman Family Junior Chair Department of
Statistics /
> Rice University http://had.co.nz/
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From opensourcesurvey at cs.ua.edu  Mon Jun 13 18:40:39 2011
From: opensourcesurvey at cs.ua.edu (Jeffrey Carver)
Date: Mon, 13 Jun 2011 11:40:39 -0500
Subject: [Rd] Participation Requested: Survey about Open-Source Software
	Development
Message-ID: <00bc01cc29e8$a0dde570$e299b050$@cs.ua.edu>

Hi,

Drs. Jeffrey Carver, Rosanna Guadagno, Debra McCallum, and Mr. Amiangshu
Bosu,  University of Alabama, and Dr. Lorin Hochstein, University of
Southern California, are conducting a survey of open-source software
developers. This survey seeks to understand how developers on distributed,
virtual teams, like open-source projects, interact with each other to
accomplish their tasks. You must be at least 19 years of age to complete the
survey. The survey should take approximately 15 minutes to complete.

If you are actively participating as a developer, please consider completing
our survey.
 
Here is the link to the survey:   http://goo.gl/HQnux

We apologize for inconvenience and if you receive multiple copies of this
email. This survey has been approved by The University of Alabama IRB board.

Thanks,

Dr. Jeffrey Carver
Assistant Professor
University of Alabama
(v) 205-348-9829  (f) 205-348-0219
http://www.cs.ua.edu/~carver


From hadley at rice.edu  Mon Jun 13 23:57:45 2011
From: hadley at rice.edu (Hadley Wickham)
Date: Mon, 13 Jun 2011 16:57:45 -0500
Subject: [Rd] Detecting development environment
In-Reply-To: <0D1AAABC-17B9-43A1-879D-3DA1BE7F4B51@r-project.org>
References: <BANLkTi=+=sr5Xa=_L9cFSj_fP0XiHgohsA@mail.gmail.com>
	<0D1AAABC-17B9-43A1-879D-3DA1BE7F4B51@r-project.org>
Message-ID: <BANLkTinZSLr2uJXr63hA0ZRCkWstp5-wzA@mail.gmail.com>

>> Is there a straight-forward, cross-platform way of determining if a
>> user has all the tools needed to develop R packages (i.e. gcc etc)?
>> It doesn't need to be 100%, but should give a rough idea. ?One idea I
>> had was simply to see if system("R CMD install --help") worked.
>>
>
> That's not really checking pretty much anything (even if you used INSTALL ;)) since all it does is to run R.

Well I guess it checks that you have your path set up right.  But this
is why I asked ;)

> More reasonable quick check may be R CMD SHLIB, though, since that involves both make and gcc:
>
> echo 'void foo(int *bar) { *bar=1; }' > foo.c && R CMD SHLIB foo.c
>
> And you could even check feasibility with something like
>
> dyn.load(paste("foo",.Platform$dynlib.ext,sep=''))
> stopifnot(.C("foo",0L)[[1]] == 1L)

Perfect - thanks!

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From janko.thyson.rstuff at googlemail.com  Tue Jun 14 09:27:08 2011
From: janko.thyson.rstuff at googlemail.com (Janko Thyson)
Date: Tue, 14 Jun 2011 09:27:08 +0200
Subject: [Rd] Require of gWidgetsRGtk2 fails: RGtk2.dll can't be found,
 but it's there
In-Reply-To: <4DF4D3DD.1060909@acm.org>
References: <4DF1EC41.3090507@googlemail.com>	<alpine.LFD.2.02.1106101215220.4009@toucan.stats.ox.ac.uk>	<4DF20CEC.5000701@googlemail.com>	<alpine.LFD.2.02.1106101332370.9756@toucan.stats.ox.ac.uk>	<4DF216F4.3050205@googlemail.com>
	<BANLkTinhy3rdf7=7uzxg0f8MW8C5sUhBzw@mail.gmail.com>
	<4DF4D3DD.1060909@acm.org>
Message-ID: <4DF70D4C.2060508@googlemail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110614/3a82cfe0/attachment.pl>

From kornelius.rohmeyer at small-projects.de  Wed Jun 15 01:21:34 2011
From: kornelius.rohmeyer at small-projects.de (Kornelius Rohmeyer)
Date: Wed, 15 Jun 2011 01:21:34 +0200
Subject: [Rd] CRAN package with dependencies on Bioconductor
In-Reply-To: <4DF36A8E.20902@gmail.com>
References: <BANLkTinzAC44xnkHzVk+=BK3qaPYPQqtkA@mail.gmail.com>
	<BANLkTi=aOE4hPt9YRw=PqXkpk2Jcv8rRqA@mail.gmail.com>
	<4DF2B092.4080402@gmail.com>
	<BANLkTikru+-6VfNcdkU13+x0WSoVkBgqAg@mail.gmail.com>
	<4DF36A8E.20902@gmail.com>
Message-ID: <BANLkTin_Gq997fWrs32X1C-LEBg6mNyfSw@mail.gmail.com>

2011/6/11 Duncan Murdoch <murdoch.duncan at gmail.com>:
[...]
> I don't understand.  It sounds as though you're saying these two
> contradictory things:
>
>  - your package works with any version of graph
>  - CRAN builds a version of graph that is incompatible with your package.

No, the first statement is correct but not the second:

- Installed from source my package works with any version of graph and also:
  - A binary of my package built with graph 1.28 will work with graph 1.28.
  - A binary of my package built with graph 1.30 will work with graph 1.30.

- But a binary of my package built with graph 1.30 will not work with
graph 1.28.
  (If it is surprising for anyone, that this can happen, we can go
into detail here.
   I doubt that this is the place to fix things, but maybe I am wrong?)

I personally found it unfortunate, that due to different policies of
CRAN and Bioconductor for R 2.12 there are (up to my knowledge) no
more any binary packages of gMCP and graph available for R 2.12 that
are compatible. (In this case the problem can be solved manually by
installing the graph package binary from Bioconductor for R 2.13 that
works also for R 2.12.)

> I am not involved with setting CRAN policy, but their current policy (build
> the most recent version of a package that declares itself compatible with
> the relevant version of R) seems reasonable.

Personally I find it more reasonable to apply the Bioconductor policy
to Bioconductor packages that are installed on CRAN for building
packages that depend on those. But you and Uwe seem to disagree. Since
this is (IMHO) a matter of taste and where one assigns priorities and
these seem to differ, there is not much to discuss?

Thanks for the clear advise and also thanks to all CRAN maintainers
for the great services nevertheless!

Best regards, Kornelius.


From ligges at statistik.tu-dortmund.de  Wed Jun 15 09:19:00 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Wed, 15 Jun 2011 09:19:00 +0200
Subject: [Rd] CRAN package with dependencies on Bioconductor
In-Reply-To: <BANLkTin_Gq997fWrs32X1C-LEBg6mNyfSw@mail.gmail.com>
References: <BANLkTinzAC44xnkHzVk+=BK3qaPYPQqtkA@mail.gmail.com>	<BANLkTi=aOE4hPt9YRw=PqXkpk2Jcv8rRqA@mail.gmail.com>	<4DF2B092.4080402@gmail.com>	<BANLkTikru+-6VfNcdkU13+x0WSoVkBgqAg@mail.gmail.com>	<4DF36A8E.20902@gmail.com>
	<BANLkTin_Gq997fWrs32X1C-LEBg6mNyfSw@mail.gmail.com>
Message-ID: <4DF85CE4.5010402@statistik.tu-dortmund.de>



On 15.06.2011 01:21, Kornelius Rohmeyer wrote:
> 2011/6/11 Duncan Murdoch<murdoch.duncan at gmail.com>:
> [...]
>> I don't understand.  It sounds as though you're saying these two
>> contradictory things:
>>
>>   - your package works with any version of graph
>>   - CRAN builds a version of graph that is incompatible with your package.
>
> No, the first statement is correct but not the second:
>
> - Installed from source my package works with any version of graph and also:
>    - A binary of my package built with graph 1.28 will work with graph 1.28.
>    - A binary of my package built with graph 1.30 will work with graph 1.30.
>
> - But a binary of my package built with graph 1.30 will not work with
> graph 1.28.
>    (If it is surprising for anyone, that this can happen, we can go
> into detail here.
>     I doubt that this is the place to fix things, but maybe I am wrong?)


Sure, this can happen, particularly with compiled code or S4 stuff in 
the packages.


> I personally found it unfortunate, that due to different policies of
> CRAN and Bioconductor for R 2.12 there are (up to my knowledge) no
> more any binary packages of gMCP and graph available for R 2.12 that
> are compatible. (In this case the problem can be solved manually by
> installing the graph package binary from Bioconductor for R 2.13 that
> works also for R 2.12.)


Your package has been recompiled against graph 1.28.

Triggering an install.packages(yourpackage) will install a version that 
works, even for R-2.12.x


>
>> I am not involved with setting CRAN policy, but their current policy (build
>> the most recent version of a package that declares itself compatible with
>> the relevant version of R) seems reasonable.
>
> Personally I find it more reasonable to apply the Bioconductor policy
> to Bioconductor packages that are installed on CRAN for building
> packages that depend on those.

No no no! graph was a CRAN package up to few weeks ago. AAnd as a CRAN 
package the CRAN policy applied. Now that it was removed, it is fine and 
handled as a BioC package anayway. It was just the case that graph 1.30 
was a CRAN package once and hence your package was built against that 
one. Now that you told us we rebuilt your package after graph 1.30 was 
removed from CRAN and it should be fine. But it looks like you have not 
even tested!

Uwe


> But you and Uwe seem to disagree. Since
> this is (IMHO) a matter of taste and where one assigns priorities and
> these seem to differ, there is not much to discuss?
>
> Thanks for the clear advise and also thanks to all CRAN maintainers
> for the great services nevertheless!
>
> Best regards, Kornelius.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From kornelius.rohmeyer at small-projects.de  Wed Jun 15 11:04:27 2011
From: kornelius.rohmeyer at small-projects.de (Kornelius Rohmeyer)
Date: Wed, 15 Jun 2011 11:04:27 +0200
Subject: [Rd] CRAN package with dependencies on Bioconductor
In-Reply-To: <4DF85CE4.5010402@statistik.tu-dortmund.de>
References: <BANLkTinzAC44xnkHzVk+=BK3qaPYPQqtkA@mail.gmail.com>
	<BANLkTi=aOE4hPt9YRw=PqXkpk2Jcv8rRqA@mail.gmail.com>
	<4DF2B092.4080402@gmail.com>
	<BANLkTikru+-6VfNcdkU13+x0WSoVkBgqAg@mail.gmail.com>
	<4DF36A8E.20902@gmail.com>
	<BANLkTin_Gq997fWrs32X1C-LEBg6mNyfSw@mail.gmail.com>
	<4DF85CE4.5010402@statistik.tu-dortmund.de>
Message-ID: <BANLkTik_azJWrkHW-yRMOnakVY4dcMcA0w@mail.gmail.com>

Am 15. Juni 2011 09:19 schrieb Uwe Ligges <ligges at statistik.tu-dortmund.de>:
>
>
> On 15.06.2011 01:21, Kornelius Rohmeyer wrote:
>>
>> 2011/6/11 Duncan Murdoch<murdoch.duncan at gmail.com>:
>> [...]
>>>
>>> I don't understand. ?It sounds as though you're saying these two
>>> contradictory things:
>>>
>>> ?- your package works with any version of graph
>>> ?- CRAN builds a version of graph that is incompatible with your package.
>>
>> No, the first statement is correct but not the second:
>>
>> - Installed from source my package works with any version of graph and
>> also:
>> ? - A binary of my package built with graph 1.28 will work with graph
>> 1.28.
>> ? - A binary of my package built with graph 1.30 will work with graph
>> 1.30.
>>
>> - But a binary of my package built with graph 1.30 will not work with
>> graph 1.28.
>> ? (If it is surprising for anyone, that this can happen, we can go
>> into detail here.
>> ? ?I doubt that this is the place to fix things, but maybe I am wrong?)
>
>
> Sure, this can happen, particularly with compiled code or S4 stuff in the
> packages.
>
>
>> I personally found it unfortunate, that due to different policies of
>> CRAN and Bioconductor for R 2.12 there are (up to my knowledge) no
>> more any binary packages of gMCP and graph available for R 2.12 that
>> are compatible. (In this case the problem can be solved manually by
>> installing the graph package binary from Bioconductor for R 2.13 that
>> works also for R 2.12.)
>
>
> Your package has been recompiled against graph 1.28.
>
> Triggering an install.packages(yourpackage) will install a version that
> works, even for R-2.12.x
>
>
>>
>>> I am not involved with setting CRAN policy, but their current policy
>>> (build
>>> the most recent version of a package that declares itself compatible with
>>> the relevant version of R) seems reasonable.
>>
>> Personally I find it more reasonable to apply the Bioconductor policy
>> to Bioconductor packages that are installed on CRAN for building
>> packages that depend on those.
>
> No no no! graph was a CRAN package up to few weeks ago. AAnd as a CRAN
> package the CRAN policy applied. Now that it was removed, it is fine and
> handled as a BioC package anayway. It was just the case that graph 1.30 was
> a CRAN package once and hence your package was built against that one. Now
> that you told us we rebuilt your package after graph 1.30 was removed from
> CRAN and it should be fine. But it looks like you have not even tested!
>

The package was already built 18 days after graph was removed from CRAN?
I'll try to ignore the "But it looks like you have not even tested!"
since I tested it 4 days ago, when it did not work. And since I had no
notice up to today that it was rebuilt with a new (i.e. old) version
of the graph package, I did not expect that it had changed already
(also my computer is not a Windows machine, which makes testing more
complicated).

Nevertheless a big, big thank you and I'm sorry that such a small
problem caused such a lengthy conservation.

Thanks and best regards, Kornelius.

> Uwe
>
>
>> But you and Uwe seem to disagree. Since
>> this is (IMHO) a matter of taste and where one assigns priorities and
>> these seem to differ, there is not much to discuss?
>>
>> Thanks for the clear advise and also thanks to all CRAN maintainers
>> for the great services nevertheless!
>>
>> Best regards, Kornelius.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From stephen.ellison at lgcgroup.com  Tue Jun 14 16:24:31 2011
From: stephen.ellison at lgcgroup.com (Stephen Ellison)
Date: Tue, 14 Jun 2011 15:24:31 +0100
Subject: [Rd] Loose code in R package files
In-Reply-To: <BANLkTinZSLr2uJXr63hA0ZRCkWstp5-wzA@mail.gmail.com>
References: <BANLkTi=+=sr5Xa=_L9cFSj_fP0XiHgohsA@mail.gmail.com>
	<0D1AAABC-17B9-43A1-879D-3DA1BE7F4B51@r-project.org>
	<BANLkTinZSLr2uJXr63hA0ZRCkWstp5-wzA@mail.gmail.com>
Message-ID: <98B156BB22D11342A931E823798D434852D599D392@GOLD.corp.lgc-group.com>

I'm sure i've seen the answer to this, but can't find it:

If there is executable code in an R package .R file that does not return a function (that is, something like x <- rnorm(5), outside any function body ), what will actually happens at build and load time?

And (more importantly, so I can point a colleague to documented guidance on the matter) is there somewhere in R's docs that says why this is not likely to be a good idea and suggests the sort of things it is sensible - or not sensible - to include in .R files? 


S Ellison
*******************************************************************
This email and any attachments are confidential. Any use...{{dropped:8}}


From bajaj141003 at gmail.com  Tue Jun 14 19:50:29 2011
From: bajaj141003 at gmail.com (Nipesh Bajaj)
Date: Tue, 14 Jun 2011 23:20:29 +0530
Subject: [Rd] How to see source Rd files from the html help pages for R
	functions
Message-ID: <BANLkTik5A-aNOxoLZebNjq=+SGrXa37bAA@mail.gmail.com>

Hello again, I am wondering wherether it is possible to get the source
Rd file, looking at the html help page, for any r function. I am
fighting hard to put few mathematical expressions in my help files for
my custom package. Therefore I would like to learn from some existing
html help pages how to put those expressions.

Any help will be highly appreciated.

Thanks,


From ligges at statistik.tu-dortmund.de  Wed Jun 15 13:47:35 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Wed, 15 Jun 2011 13:47:35 +0200
Subject: [Rd] How to see source Rd files from the html help pages for
 R	functions
In-Reply-To: <BANLkTik5A-aNOxoLZebNjq=+SGrXa37bAA@mail.gmail.com>
References: <BANLkTik5A-aNOxoLZebNjq=+SGrXa37bAA@mail.gmail.com>
Message-ID: <4DF89BD7.3050308@statistik.tu-dortmund.de>



On 14.06.2011 19:50, Nipesh Bajaj wrote:
> Hello again, I am wondering wherether it is possible to get the source
> Rd file, looking at the html help page, for any r function. I am
> fighting hard to put few mathematical expressions in my help files for
> my custom package. Therefore I would like to learn from some existing
> html help pages how to put those expressions.
>

Just download the corresponding source package which contains the Rd files.

Uwe Ligges

> Any help will be highly appreciated.
>
> Thanks,
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Wed Jun 15 16:22:26 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 15 Jun 2011 15:22:26 +0100 (BST)
Subject: [Rd] Loose code in R package files
In-Reply-To: <98B156BB22D11342A931E823798D434852D599D392@GOLD.corp.lgc-group.com>
References: <BANLkTi=+=sr5Xa=_L9cFSj_fP0XiHgohsA@mail.gmail.com>
	<0D1AAABC-17B9-43A1-879D-3DA1BE7F4B51@r-project.org>
	<BANLkTinZSLr2uJXr63hA0ZRCkWstp5-wzA@mail.gmail.com>
	<98B156BB22D11342A931E823798D434852D599D392@GOLD.corp.lgc-group.com>
Message-ID: <alpine.LFD.2.02.1106151514530.26318@gannet.stats.ox.ac.uk>

On Tue, 14 Jun 2011, Stephen Ellison wrote:

> I'm sure i've seen the answer to this, but can't find it:
>
> If there is executable code in an R package .R file that does not 
> return a function (that is, something like x <- rnorm(5), outside 
> any function body ), what will actually happens at build and load 
> time?
>
> And (more importantly, so I can point a colleague to documented 
> guidance on the matter) is there somewhere in R's docs that says why 
> this is not likely to be a good idea and suggests the sort of things 
> it is sensible - or not sensible - to include in .R files?

It is documented in 'Writing R Extensions':

The R subdirectory contains R code files, only.
...
It should be possible to read in the files using source(), so R 
objects must be created by assignments. Note that there need be no 
connection between the name of the file and the R objects created by 
it. Ideally, the R code files should only directly assign R objects 
and definitely should not call functions with side effects such as 
require and options. If computations are required to create objects 
these can use code `earlier' in the package (see the `Collate' field) 
plus, only if lazyloading is used, functions in the `Depends' packages 
provided that the objects created do not depend on those packages 
except via name space imports. (Packages without name spaces will work 
under somewhat less restrictive assumptions.)

So your example creates an object 'x' in the package or name space. 
Which is perfectly legal, but maybe not intentional.  For example, R's 
base package does

## needs to run after paste()
.leap.seconds <- local({
     .leap.seconds <-
         c("1972-6-30", "1972-12-31", "1973-12-31", "1974-12-31",
           "1975-12-31", "1976-12-31", "1977-12-31", "1978-12-31",
           "1979-12-31", "1981-6-30", "1982-6-30", "1983-6-30",
           "1985-6-30", "1987-12-31", "1989-12-31", "1990-12-31",
           "1992-6-30", "1993-6-30", "1994-6-30","1995-12-31",
           "1997-6-30", "1998-12-31", "2005-12-31", "2008-12-31")
     .leap.seconds <- strptime(paste(.leap.seconds , "23:59:60"),
                               "%Y-%m-%d %H:%M:%S")
     c(as.POSIXct(.leap.seconds, "GMT")) # lose the timezone
})


S Ellison
-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From PDalgd at gmail.com  Wed Jun 15 18:06:22 2011
From: PDalgd at gmail.com (peter dalgaard)
Date: Wed, 15 Jun 2011 18:06:22 +0200
Subject: [Rd] Loose code in R package files
In-Reply-To: <alpine.LFD.2.02.1106151514530.26318@gannet.stats.ox.ac.uk>
References: <BANLkTi=+=sr5Xa=_L9cFSj_fP0XiHgohsA@mail.gmail.com>
	<0D1AAABC-17B9-43A1-879D-3DA1BE7F4B51@r-project.org>
	<BANLkTinZSLr2uJXr63hA0ZRCkWstp5-wzA@mail.gmail.com>
	<98B156BB22D11342A931E823798D434852D599D392@GOLD.corp.lgc-group.com>
	<alpine.LFD.2.02.1106151514530.26318@gannet.stats.ox.ac.uk>
Message-ID: <AB67C4D9-AC51-4508-B4D4-5C6A8C254D66@gmail.com>


On Jun 15, 2011, at 16:22 , Prof Brian Ripley wrote:

> 
> So your example creates an object 'x' in the package or name space. Which is perfectly legal, but maybe not intentional.  For example, R's base package does
> ...

Yes. Nothing illegal about it, but might be worth noticing that if LazyLoading is used, then the object will be computed only once, while building the package. 

So "today <- date()" or "calibrate <- system.time(for(i in 1:1e6)...))" or is a bad idea unless you really want the value at build time on the build computer. 

Having results depending on whether or not LazyLoading is being used is probably not a good idea in any case. To have things happen on load, use .onLoad and relatives. 

-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From ripley at stats.ox.ac.uk  Thu Jun 16 10:15:43 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 16 Jun 2011 09:15:43 +0100 (BST)
Subject: [Rd] Loose code in R package files
In-Reply-To: <alpine.LFD.2.02.1106151514530.26318@gannet.stats.ox.ac.uk>
References: <BANLkTi=+=sr5Xa=_L9cFSj_fP0XiHgohsA@mail.gmail.com>
	<0D1AAABC-17B9-43A1-879D-3DA1BE7F4B51@r-project.org>
	<BANLkTinZSLr2uJXr63hA0ZRCkWstp5-wzA@mail.gmail.com>
	<98B156BB22D11342A931E823798D434852D599D392@GOLD.corp.lgc-group.com>
	<alpine.LFD.2.02.1106151514530.26318@gannet.stats.ox.ac.uk>
Message-ID: <alpine.LFD.2.02.1106160857080.9318@gannet.stats.ox.ac.uk>

Peter Dalgaard's reply made me wonder if you were looking for a 
precise answer to

> what will actually happens at build and load time?

The best way to answer such questions is to read the source code (and 
now this is all in R, it should be accessible to all).

Nothing happens at 'build time', i.e. when R CMD build is run.

How things are split between install and load time depends on whether 
the package uses lazy loading.  Some of us think that maybe all 
packages should, not least to simplify code and explanations like 
this.

No lazy loading:

The R source files are concatenated at install time (in an order 
described in 'Writing R Extensions'), and the resulting file stored as 
<pkg>/R/<pkg>.  When the package (or its name space) is loaded, that 
file is effectively source()d into an environment.  (There are some 
small differences as sys.source() is used.)  So side effects may 
affect the current R session, and some options (such as 
'keep.source.pkgs') are acted on at load time, which is when the R 
objects are created.

Lazy loading:

The R source files are concatenated at install time (in an order
described in 'Writing R Extensions'), to a single file <pkg>/R/<pkg> 
[as before].

That file is then (at install time) effectively source()d into an 
environment and that environment is dumped to a lazy-load database, 
and <pkg>/R/<pkg> replaced by a stub loader.  So any side effects 
apply only to the R process which does the loading and dumping, and 
the objects are created at install time.

At load time, the stub loader creates promises to objects in the
database in an environment in the current session.

There is rather more to it, e.g. for lazydata and packages with 
sysdata.rda, but that is gist.

On Wed, 15 Jun 2011, Prof Brian Ripley wrote:

> On Tue, 14 Jun 2011, Stephen Ellison wrote:
>
>> I'm sure i've seen the answer to this, but can't find it:
>> 
>> If there is executable code in an R package .R file that does not return a 
>> function (that is, something like x <- rnorm(5), outside any function body 
>> ), what will actually happens at build and load time?
>> 
>> And (more importantly, so I can point a colleague to documented guidance on 
>> the matter) is there somewhere in R's docs that says why this is not likely 
>> to be a good idea and suggests the sort of things it is sensible - or not 
>> sensible - to include in .R files?
>
> It is documented in 'Writing R Extensions':
>
> The R subdirectory contains R code files, only.
> ...
> It should be possible to read in the files using source(), so R objects must 
> be created by assignments. Note that there need be no connection between the 
> name of the file and the R objects created by it. Ideally, the R code files 
> should only directly assign R objects and definitely should not call 
> functions with side effects such as require and options. If computations are 
> required to create objects these can use code `earlier' in the package (see 
> the `Collate' field) plus, only if lazyloading is used, functions in the 
> `Depends' packages provided that the objects created do not depend on those 
> packages except via name space imports. (Packages without name spaces will 
> work under somewhat less restrictive assumptions.)
>
> So your example creates an object 'x' in the package or name space. Which is 
> perfectly legal, but maybe not intentional.  For example, R's base package 
> does
>
> ## needs to run after paste()
> .leap.seconds <- local({
>    .leap.seconds <-
>        c("1972-6-30", "1972-12-31", "1973-12-31", "1974-12-31",
>          "1975-12-31", "1976-12-31", "1977-12-31", "1978-12-31",
>          "1979-12-31", "1981-6-30", "1982-6-30", "1983-6-30",
>          "1985-6-30", "1987-12-31", "1989-12-31", "1990-12-31",
>          "1992-6-30", "1993-6-30", "1994-6-30","1995-12-31",
>          "1997-6-30", "1998-12-31", "2005-12-31", "2008-12-31")
>    .leap.seconds <- strptime(paste(.leap.seconds , "23:59:60"),
>                              "%Y-%m-%d %H:%M:%S")
>    c(as.POSIXct(.leap.seconds, "GMT")) # lose the timezone
> })
>
>
> S Ellison
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch.duncan at gmail.com  Thu Jun 16 10:56:37 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 16 Jun 2011 04:56:37 -0400
Subject: [Rd] CRAN package with dependencies on Bioconductor
In-Reply-To: <BANLkTin_Gq997fWrs32X1C-LEBg6mNyfSw@mail.gmail.com>
References: <BANLkTinzAC44xnkHzVk+=BK3qaPYPQqtkA@mail.gmail.com>	<BANLkTi=aOE4hPt9YRw=PqXkpk2Jcv8rRqA@mail.gmail.com>	<4DF2B092.4080402@gmail.com>	<BANLkTikru+-6VfNcdkU13+x0WSoVkBgqAg@mail.gmail.com>	<4DF36A8E.20902@gmail.com>
	<BANLkTin_Gq997fWrs32X1C-LEBg6mNyfSw@mail.gmail.com>
Message-ID: <4DF9C545.2010205@gmail.com>

On 11-06-14 7:21 PM, Kornelius Rohmeyer wrote:
> 2011/6/11 Duncan Murdoch<murdoch.duncan at gmail.com>:
> [...]
>> I don't understand.  It sounds as though you're saying these two
>> contradictory things:
>>
>>   - your package works with any version of graph
>>   - CRAN builds a version of graph that is incompatible with your package.
>
> No, the first statement is correct but not the second:
>
> - Installed from source my package works with any version of graph and also:
>    - A binary of my package built with graph 1.28 will work with graph 1.28.
>    - A binary of my package built with graph 1.30 will work with graph 1.30.
>
> - But a binary of my package built with graph 1.30 will not work with
> graph 1.28.

Thanks, now I understand the issue.  It sounds as though it has been 
solved, but while it is in your mind, it might be worth adding some 
defensive code in case something similar happens in the future.  Can you 
check on version numbers at load time to give a helpful error message 
about the problem if it arises again?

Duncan Murdoch


>    (If it is surprising for anyone, that this can happen, we can go
> into detail here.
>     I doubt that this is the place to fix things, but maybe I am wrong?)
>
> I personally found it unfortunate, that due to different policies of
> CRAN and Bioconductor for R 2.12 there are (up to my knowledge) no
> more any binary packages of gMCP and graph available for R 2.12 that
> are compatible. (In this case the problem can be solved manually by
> installing the graph package binary from Bioconductor for R 2.13 that
> works also for R 2.12.)
>
>> I am not involved with setting CRAN policy, but their current policy (build
>> the most recent version of a package that declares itself compatible with
>> the relevant version of R) seems reasonable.
>
> Personally I find it more reasonable to apply the Bioconductor policy
> to Bioconductor packages that are installed on CRAN for building
> packages that depend on those. But you and Uwe seem to disagree. Since
> this is (IMHO) a matter of taste and where one assigns priorities and
> these seem to differ, there is not much to discuss?
>
> Thanks for the clear advise and also thanks to all CRAN maintainers
> for the great services nevertheless!
>
> Best regards, Kornelius.


From David.Kreil at boku.ac.at  Thu Jun 16 17:45:48 2011
From: David.Kreil at boku.ac.at (Dr. D. P. Kreil (Boku))
Date: Thu, 16 Jun 2011 17:45:48 +0200
Subject: [Rd] Update: Is there an implementation of loess with more than 3
 parametric predictors or a trick to a similar effect?
Message-ID: <BANLkTinLCCUUPn3JK7kb7ncxn-M5PQUN9w@mail.gmail.com>

Dear R developers!

Considering I got no response or comments in the general r-help forum
so far, perhaps my question is actually better suited for this list? I
have added some more hopefully relevant technical details to my
original post (edited below).

Any comments gratefully received!

Best regards,
David Kreil.


----------

Dear R experts,

I have a problem that is a related to the question raised in this earlier post
??? https://stat.ethz.ch/pipermail/r-help/2007-January/124064.html

My situation is different in that I have only 2 predictors
(coordinates x,y) for local regression but a number of global
("parametric") offsets that I need to consider.

Essentially, we have a spatial distortion s(x,y) overlaid over a
number of measurements z:
    z_i = s(x_i,y_i) + v_{g_i}
These measurements z can be grouped by the same underlying undistorted
measurement value v for each group g. The group membership g_i is
known for each measurement, but the underlying undistorted measurement
values v_g for the groups are not known and should be determined by
(global, not local) regression.

We need to estimate the two-dimensional spatial trend s(x,y), which we
then want to remove. In our application, say there are 20 groups of at
least 35 measurements each, in the most simple scenario. The
measurements are randomly placed. Taking the first group as reference,
there are thus 19 unknown offsets.


The below code for toy data (spatial trend in one dimension x) works
for two or three offset groups.

Unfortunately, the loess call fails for four or more offset groups
with the error message
"Error in simpleLoess(y, x, w, span, degree, parametric, drop.square,
normalize,? :
? only 1-4 predictors are allowed"
See comment #1

I tried overriding the restriction (see lower section of code example) and got
"k>d2MAX in ehg136.? Need to recompile with increased dimensions."

How easy would that be to do? I cannot find a definition of d2MAX
anywhere, and it seems this might be hardcoded -- the error is
apparently triggered by line #1359 in loessf.f
????? if(k .gt. 15)?? call ehg182(105)

Alternatively, does anyone know of an implementation of local
regression with global (parametric) offset groups that could be
applied here?

Or is there a better way of dealing with this? I tried lme with
correlation structures but that seems to be much, much slower.

Any comments would be greatly appreciated!

Best regards,
David Kreil.



###
#
# loess with parametric offsets - toy data demo
#

x<-seq(0,9,.1);
x.N<-length(x);

# Comment #1:
# These are the offsets ("unknown", to be revovered by the regression):
o<-c(0.4,-0.8,1.2);  # three parametric variables --> total of four, works
o<-c(0.4,-0.8,1.2,-0.2);  # four par.variables --> total of 5 > 4 --> error:
# "... only 1-4 predictors are allowed"

o.N<-length(o);
f<-sapply(seq(o.N),
????????? function(n){
??????????? ifelse((seq(x.N)<= n?? *x.N/(o.N+1) &
??????????????????? seq(x.N)> (n-1)*x.N/(o.N+1)),
??????????????????? 1,0);
????????? });
f<-f[sample(NROW(f)),];

y<-sin(x)+rnorm(length(x),0,.1)+f%*%o;
s.fs<-sapply(seq(NCOL(f)),function(i){paste('f',i,sep='')});
s<-paste(c('y~x',s.fs),collapse='+');
d<-data.frame(x,y,f)
names(d)<-c('x','y',s.fs);

l<-loess(formula(s),parametric=s.fs,drop.square=s.fs,normalize=F,data=d,
???????? span=0.4);
yp<-predict(l,newdata=d);
plot(x,y,pch='+',ylim=c(-3,3),col='red');? # input data
points(x,yp,pch='o',col='blue');?????????? # fit of that

d0<-d; d0$f1<-d0$f2<-d0$f3<-0;
yp0<-predict(l,newdata=d0);
points(x,y-f%*%o);???? # spatial distortion
lines(x,yp0,pch='+');? # estimate of that

op<-sapply(seq(NCOL(f)),function(i){(yp-yp0)[!!f[,i]][1]});

cat("Demo offsets:",o,"\n");
cat("Estimated offsets:",format(op,digits=1),"\n");


#
# to test if the underlying implementation has a limit of 4 (it does):
#

# copied from loess.R, and modified as indicated by ###***###
simpleLoess <-
  function(y, x, weights, span = 0.75, degree = 2, parametric = FALSE,
	   drop.square = FALSE, normalize = TRUE,
	   statistics = "approximate", surface = "interpolate",
	   cell = 0.2, iterations = 1, trace.hat = "exact")
{
    ## loess_ translated to R.
    D <- NCOL(x)
###***###    if(D > 4) stop("only 1-4 predictors are allowed")
    N <- NROW(x)
    if(!N || !D)	stop("invalid 'x'")
    if(!length(y))	stop("invalid 'y'")
    x <- as.matrix(x)
    max.kd <-  max(N, 200)
    robust <- rep(1, N)
    divisor<- rep(1, D)
    if(normalize && D > 1L) {
	trim <- ceiling(0.1 * N)
	divisor <-
	    sqrt(apply(apply(x, 2L, sort)[seq(trim+1, N-trim), , drop = FALSE],
		       2L, var))
	x <- x/rep(divisor, rep(N, D))
    }
    sum.drop.sqr <- sum(drop.square)
    sum.parametric <- sum(parametric)
    nonparametric <- sum(!parametric)
    order.parametric <- order(parametric)
    x <- x[, order.parametric]
    order.drop.sqr <- (2 - drop.square)[order.parametric]
    if(degree==1 && sum.drop.sqr)
	stop("specified the square of a factor predictor to be dropped when
degree = 1")
    if(D == 1 && sum.drop.sqr)
	stop("specified the square of a predictor to be dropped with only one
numeric predictor")
    if(sum.parametric == D) stop("specified parametric for all predictors")
    if(iterations)
    for(j in 1L:iterations) {
	robust <- weights * robust
	if(j > 1) statistics <- "none"
	else if(surface == "interpolate" && statistics == "approximate")
	    statistics <- if(trace.hat == "exact") "1.approx"
            else "2.approx" # trace.hat == "approximate"
	surf.stat <- paste(surface, statistics, sep="/")
	z <- .C(R_loess_raw, # ../src/loessc.c
		as.double(y),
		as.double(x),
		as.double(weights),
		as.double(robust),
		as.integer(D),
		as.integer(N),
		as.double(span),
		as.integer(degree),
		as.integer(nonparametric),
		as.integer(order.drop.sqr),
		as.integer(sum.drop.sqr),
		as.double(span*cell),
		as.character(surf.stat),
		fitted.values = double(N),
		parameter = integer(7),
		a = integer(max.kd),
		xi = double(max.kd),
		vert = double(2*D),
		vval = double((D+1)*max.kd),
		diagonal = double(N),
		trL = double(1),
		delta1 = double(1),
		delta2 = double(1),
		as.integer(surf.stat == "interpolate/exact"))
	if(j==1) {
	    trace.hat.out <- z$trL
	    one.delta <- z$delta1
	    two.delta <- z$delta2
	}
	fitted.residuals <- y - z$fitted.values
	if(j < iterations)
	    robust <- .Fortran(R_lowesw,
			       as.double(fitted.residuals),
			       as.integer(N),
			       robust = double(N),
			       integer(N))$robust
    }
    if(surface == "interpolate")
    {
	pars <- z$parameter
	names(pars) <- c("d", "n", "vc", "nc", "nv", "liv", "lv")
	enough <- (D + 1) * pars["nv"]
	fit.kd <- list(parameter=pars, a=z$a[1L:pars[4L]], xi=z$xi[1L:pars[4L]],
		       vert=z$vert, vval=z$vval[1L:enough])
    }
    if(iterations > 1) {
	pseudovalues <- .Fortran(R_lowesp,
				 as.integer(N),
				 as.double(y),
				 as.double(z$fitted.values),
				 as.double(weights),
				 as.double(robust),
				 integer(N),
				 pseudovalues = double(N))$pseudovalues
	zz <- .C(R_loess_raw,
		as.double(pseudovalues),
		as.double(x),
		as.double(weights),
		as.double(weights),
		as.integer(D),
		as.integer(N),
		as.double(span),
		as.integer(degree),
		as.integer(nonparametric),
		as.integer(order.drop.sqr),
		as.integer(sum.drop.sqr),
		as.double(span*cell),
		as.character(surf.stat),
		temp = double(N),
		parameter = integer(7),
		a = integer(max.kd),
		xi = double(max.kd),
		vert = double(2*D),
		vval = double((D+1)*max.kd),
		diagonal = double(N),
		trL = double(1),
		delta1 = double(1),
		delta2 = double(1),
		as.integer(0L))
	pseudo.resid <- pseudovalues - zz$temp
    }
    sum.squares <- if(iterations <= 1) sum(weights * fitted.residuals^2)
    else sum(weights * pseudo.resid^2)
    enp <- one.delta + 2*trace.hat.out - N
    s <- sqrt(sum.squares/one.delta)
    pars <- list(robust=robust, span=span, degree=degree, normalize=normalize,
		 parametric=parametric, drop.square=drop.square,
		 surface=surface, cell=cell, family=
		 if(iterations <= 1) "gaussian" else "symmetric",
		 iterations=iterations)
    fit <- list(n=N, fitted=z$fitted.values, residuals=fitted.residuals,
		enp=enp, s=s, one.delta=one.delta, two.delta=two.delta,
		trace.hat=trace.hat.out, divisor=divisor)
    fit$pars <- pars
    if(surface == "interpolate") fit$kd <- fit.kd
    class(fit) <- "loess"
    fit
}
environment(simpleLoess)<-environment(loess);  # to make it find private funcs
environment(loess)<-.GlobalEnv;         # to make it use our simpleLoess!
environment(loess.smooth)<-.GlobalEnv;  # to make it use our simpleLoess!

# now run the demo with four parametric variables --> total 5.> 4
triggers error:
# k>d2MAX in ehg136.  Need to recompile with increased dimensions.
# but there is no obvious d2MAX to configure that I can find...


From ajfrank at ics.uci.edu  Fri Jun 17 01:53:12 2011
From: ajfrank at ics.uci.edu (Drew Frank)
Date: Thu, 16 Jun 2011 16:53:12 -0700
Subject: [Rd] X11 device windows are spawned with empty WM_NAME property
Message-ID: <BANLkTimCr6aF6O8DyY+mfTpLr+8MMuvmkA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110616/f57724f6/attachment.pl>

From msonsini at harmonia.com  Fri Jun 17 00:47:43 2011
From: msonsini at harmonia.com (Mike Sonsini)
Date: Thu, 16 Jun 2011 18:47:43 -0400
Subject: [Rd] Controlling stdin and stdout in an embedded R instance
Message-ID: <4DFA880F.4000802@harmonia.com>

Hello,

I am very new to R but my question is with respect to the C API for 
working with an embedded R console. I have been able to start and stop 
an embedded R console from within a C program as well as use the API to 
execute commands in it. I am seeking a mechanism to individually send 
native R commands to an embedded console and then consume the output of 
these commands. Specifically, I cannot send a set of commands to the 
embedded console and then consume all of the output after the execution 
completes. I have unsuccessfully attempted to assign values to the 
ptr_R_ReadConsole and ptr_R_WriteConsole function pointers defined in 
Rinterface.h but do not know if this is a valid approach. I am working 
in Ubuntu 10.04 and thus the Windows example at the following address is 
not applicable.

http://cran.r-project.org/doc/manuals/R-exts.html#Calling-R_002edll-directly

Does anyone on this list have experience or an example of communicating 
with an embedded R console using native R commands and consuming the 
output one command at a time in a "Unix-alike" environment?

Thank you,
Mike Sonsini


From renaud at mancala.cbio.uct.ac.za  Fri Jun 17 13:35:38 2011
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Fri, 17 Jun 2011 13:35:38 +0200
Subject: [Rd] Why does slot<- duplicate its argument?
Message-ID: <4DFB3C0A.4030701@cbio.uct.ac.za>

Hi,

is there a reason why `slot<-` should duplicate its argument?
I am under R 2.12.1.

Thank you,
Renaud

For example:

setClass('A', representation(data='matrix'))
a <- new('A')
x <- matrix(1,2,3)
tracemem(x)
slot(a, 'data') <- x


 

###
UNIVERSITY OF CAPE TOWN 

This e-mail is subject to the UCT ICT policies and e-mai...{{dropped:5}}


From pdalgd at gmail.com  Fri Jun 17 14:27:44 2011
From: pdalgd at gmail.com (peter dalgaard)
Date: Fri, 17 Jun 2011 14:27:44 +0200
Subject: [Rd] X11 device windows are spawned with empty WM_NAME property
In-Reply-To: <BANLkTimCr6aF6O8DyY+mfTpLr+8MMuvmkA@mail.gmail.com>
References: <BANLkTimCr6aF6O8DyY+mfTpLr+8MMuvmkA@mail.gmail.com>
Message-ID: <F3337C24-FAB7-49CB-AC0D-8270BD3FF7B6@gmail.com>


On Jun 17, 2011, at 01:53 , Drew Frank wrote:

> Hello,
> 
> I've noticed that X11 device windows (the ones that pop up when I plot
> something on Linux) aren't assigned any WM_NAME property until after they've
> been spawned.  This causes problems for users of tiling window managers, who
> may wish to use the WM_NAME property to decide whether to float or tile the
> window.
> 
> If I create a plot and then examine the window properties with xprop, I see
> something like the following: WM_NAME(STRING) = "R Graphics: Device 2
> (ACTIVE)".  However, by instructing my window manager (xmonad) to float all
> windows with a matching name, I can tell that when the window was created
> its WM_NAME property was empty.
> 
> Is this behavior intended?  Would be it be reasonable to instead create
> windows with a generic name like "R Graphics" prior to updating them with
> the device number and active/inactive status?
> 
> I'm not familiar with the R code base, but I found that creating a plot
> results in a call to the function in_do_X11 in the file
> src/modules/X11/devX11.c.  In that function (around like 2869) there is code
> to parse out the window title from the SEXP args parameter, and it always
> seems to parse out an empty string.  If I manually assign title="R Graphics"
> at that point, I am able to successfully float R plot windows based on their
> WM_NAME. (line numbers based on SVN revision 56131)
> 
> Is this actually an issue that needs fixing?  Should I create a bug report
> for this?
> 

A well-tested patch might be considered, but beware of the demons...

Notice that you can actually set the title via X11(title="Foo's bar"). If you do that, it won't display the device number. So (a) you wouldn't want to destroy that feature, and (b) how does the code that inserts the "Device 2" bit know that it can do so? By checking for an empty title? (Yup).
 
I notice that the initial title string could contain formatting characters, so possibly, what you really want to do is to default it to "R Graphics: Device %d"). Something of the sort is already happening with the quartz() device. 

> Thanks,
> Drew
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From ripley at stats.ox.ac.uk  Fri Jun 17 15:32:58 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 17 Jun 2011 14:32:58 +0100 (BST)
Subject: [Rd] X11 device windows are spawned with empty WM_NAME property
In-Reply-To: <F3337C24-FAB7-49CB-AC0D-8270BD3FF7B6@gmail.com>
References: <BANLkTimCr6aF6O8DyY+mfTpLr+8MMuvmkA@mail.gmail.com>
	<F3337C24-FAB7-49CB-AC0D-8270BD3FF7B6@gmail.com>
Message-ID: <alpine.LFD.2.02.1106171424170.19460@gannet.stats.ox.ac.uk>

On Fri, 17 Jun 2011, peter dalgaard wrote:

>
> On Jun 17, 2011, at 01:53 , Drew Frank wrote:
>
>> Hello,
>>
>> I've noticed that X11 device windows (the ones that pop up when I plot
>> something on Linux) aren't assigned any WM_NAME property until after they've
>> been spawned.  This causes problems for users of tiling window managers, who
>> may wish to use the WM_NAME property to decide whether to float or tile the
>> window.

That is what the window class property is for .... X11 windows can 
(and R allows) have different names chosen by the user.

>> If I create a plot and then examine the window properties with xprop, I see
>> something like the following: WM_NAME(STRING) = "R Graphics: Device 2
>> (ACTIVE)".  However, by instructing my window manager (xmonad) to float all
>> windows with a matching name, I can tell that when the window was created
>> its WM_NAME property was empty.
>>
>> Is this behavior intended?  Would be it be reasonable to instead create
>> windows with a generic name like "R Graphics" prior to updating them with
>> the device number and active/inactive status?

Yes, no.

>> I'm not familiar with the R code base, but I found that creating a plot
>> results in a call to the function in_do_X11 in the file
>> src/modules/X11/devX11.c.  In that function (around like 2869) there is code

In which version of R?  The codebase for the development version is 
quite different from that in the 2.13.x series ....

>> to parse out the window title from the SEXP args parameter, and it always
>> seems to parse out an empty string.  If I manually assign title="R Graphics"
>> at that point, I am able to successfully float R plot windows based on their
>> WM_NAME. (line numbers based on SVN revision 56131)
>>
>> Is this actually an issue that needs fixing?  Should I create a bug report
>> for this?
>
> A well-tested patch might be considered, but beware of the demons...
>
> Notice that you can actually set the title via X11(title="Foo's 
> bar"). If you do that, it won't display the device number. So (a) 
> you wouldn't want to destroy that feature, and (b) how does the code 
> that inserts the "Device 2" bit know that it can do so? By checking 
> for an empty title? (Yup).
>
> I notice that the initial title string could contain formatting 
> characters, so possibly, what you really want to do is to default it 
> to "R Graphics: Device %d"). Something of the sort is already 
> happening with the quartz() device.
>
>> Thanks,
>> Drew
>>
>> 	[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> -- 
> Peter Dalgaard
> Center for Statistics, Copenhagen Business School
> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
> Phone: (+45)38153501
> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From oliver at first.in-berlin.de  Fri Jun 17 16:01:39 2011
From: oliver at first.in-berlin.de (oliver)
Date: Fri, 17 Jun 2011 16:01:39 +0200
Subject: [Rd] Controlling stdin and stdout in an embedded R instance
In-Reply-To: <4DFA880F.4000802@harmonia.com>
References: <4DFA880F.4000802@harmonia.com>
Message-ID: <20110617140139.GA9169@siouxsie>

Hello,

I'm new in exploring R-internals,
and also did not explored embedding R into C.
I did some C-extensions for packages so far.

Nevertheless I can give you a hint,
which might be helpful; the example which you linked to,
uses R.dll.

DLL means: Dynamic linked library.
On Unix and Linux the aequivalent is shared libraries,
or also dynamic linked libraries;
another term that is used here is "dynamic linking loader",
which provides the possibilities to "load" those libraries,
which means, make them available in your application.

To use a shared library on Unix/Linux you can use the functions

  dlopen()
  dlerror()
  dlsym()
  dlclose()

The manpages will explain you the details.

Hope that helps.


Ciao,
   Oliver


From pdalgd at gmail.com  Fri Jun 17 16:26:57 2011
From: pdalgd at gmail.com (peter dalgaard)
Date: Fri, 17 Jun 2011 16:26:57 +0200
Subject: [Rd] X11 device windows are spawned with empty WM_NAME property
In-Reply-To: <alpine.LFD.2.02.1106171424170.19460@gannet.stats.ox.ac.uk>
References: <BANLkTimCr6aF6O8DyY+mfTpLr+8MMuvmkA@mail.gmail.com>
	<F3337C24-FAB7-49CB-AC0D-8270BD3FF7B6@gmail.com>
	<alpine.LFD.2.02.1106171424170.19460@gannet.stats.ox.ac.uk>
Message-ID: <5907E42F-9E7D-4FE2-A98D-16CEF712AEBB@gmail.com>


On Jun 17, 2011, at 15:32 , Prof Brian Ripley wrote:
>>> 
>>> Is this behavior intended?  Would be it be reasonable to instead create
>>> windows with a generic name like "R Graphics" prior to updating them with
>>> the device number and active/inactive status?
> 
> Yes, no.
> 

Well, "yes, maybe", I'd say. If the WM insists on looking at the title, it makes some pragmatic sense for the user to set it to a generic name that the WM can recognize.

However, on revisiting this, the obvious fix/workaround is just to set 

X11.options(title="R Graphics: Device %d")

and the user can do this in his/her startup files. No need to inflict it on every user with any WM.

-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From simon.urbanek at r-project.org  Fri Jun 17 16:29:53 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 17 Jun 2011 10:29:53 -0400
Subject: [Rd] Controlling stdin and stdout in an embedded R instance
In-Reply-To: <4DFA880F.4000802@harmonia.com>
References: <4DFA880F.4000802@harmonia.com>
Message-ID: <3354124D-8F54-4AD5-BA04-2393F8F03056@r-project.org>

Mike,

there are many examples of embedding R, one of them is rJava/JRI and you can see how to initialize R with custom callbacks at
http://svn.rforge.net/org/trunk/rosuda/JRI/src/Rinit.c

Cheers,
Simon



On Jun 16, 2011, at 6:47 PM, Mike Sonsini wrote:

> Hello,
> 
> I am very new to R but my question is with respect to the C API for working with an embedded R console. I have been able to start and stop an embedded R console from within a C program as well as use the API to execute commands in it. I am seeking a mechanism to individually send native R commands to an embedded console and then consume the output of these commands. Specifically, I cannot send a set of commands to the embedded console and then consume all of the output after the execution completes. I have unsuccessfully attempted to assign values to the ptr_R_ReadConsole and ptr_R_WriteConsole function pointers defined in Rinterface.h but do not know if this is a valid approach. I am working in Ubuntu 10.04 and thus the Windows example at the following address is not applicable.
> 
> http://cran.r-project.org/doc/manuals/R-exts.html#Calling-R_002edll-directly
> 
> Does anyone on this list have experience or an example of communicating with an embedded R console using native R commands and consuming the output one command at a time in a "Unix-alike" environment?
> 
> Thank you,
> Mike Sonsini
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From edd at debian.org  Fri Jun 17 16:34:57 2011
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 17 Jun 2011 09:34:57 -0500
Subject: [Rd] Controlling stdin and stdout in an embedded R instance
In-Reply-To: <4DFA880F.4000802@harmonia.com>
References: <4DFA880F.4000802@harmonia.com>
Message-ID: <19963.26129.868639.219647@max.nulle.part>


On 16 June 2011 at 18:47, Mike Sonsini wrote:
| Hello,
| 
| I am very new to R but my question is with respect to the C API for 
| working with an embedded R console. I have been able to start and stop 
| an embedded R console from within a C program as well as use the API to 
| execute commands in it. I am seeking a mechanism to individually send 
| native R commands to an embedded console and then consume the output of 
| these commands. Specifically, I cannot send a set of commands to the 
| embedded console and then consume all of the output after the execution 
| completes. I have unsuccessfully attempted to assign values to the 
| ptr_R_ReadConsole and ptr_R_WriteConsole function pointers defined in 
| Rinterface.h but do not know if this is a valid approach. I am working 
| in Ubuntu 10.04 and thus the Windows example at the following address is 
| not applicable.
| 
| http://cran.r-project.org/doc/manuals/R-exts.html#Calling-R_002edll-directly
| 
| Does anyone on this list have experience or an example of communicating 
| with an embedded R console using native R commands and consuming the 
| output one command at a time in a "Unix-alike" environment?

Let me see if I understood this correctly:

 - you have managed to embed R in your own application 

 - you now want to control the embedded R instance

and for the latter you want to use stdin and stdout?  Why not use R commands
and consuming R output?

Examples are e.g.

 - littler (available in Ubuntu) which sends R commands line by line to R;
   implemented in plain C. Commands can come from the command-line, from a
   script or from stdin: R still sees them line by line in REPL fashion.

 - RInside which builds on top of the littler experience and the Rcpp API
   (Rcpp is also in Ubuntu) to embed R via a much nicer C++ abstraction
   which, coupled with Rcpp, gives you real easy communication via full blown
   R objects accessible from C++. There are well over a dozen examples in the
   RInside sources

Hope this helps, Dirk

-- 
Gauss once played himself in a zero-sum game and won $50.
                      -- #11 at http://www.gaussfacts.com


From matthew.p.hausmann at gmail.com  Fri Jun 17 21:46:26 2011
From: matthew.p.hausmann at gmail.com (Matthew Hausmann)
Date: Fri, 17 Jun 2011 14:46:26 -0500
Subject: [Rd] Annotating a decision tree with categorical variables with a
 large number of categories
Message-ID: <BANLkTim3SYsFPpKVoJh1GQdC8OnDA05j3A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110617/caa300cb/attachment.pl>

From ajfrank at ics.uci.edu  Fri Jun 17 23:05:01 2011
From: ajfrank at ics.uci.edu (Drew Frank)
Date: Fri, 17 Jun 2011 14:05:01 -0700
Subject: [Rd] X11 device windows are spawned with empty WM_NAME property
In-Reply-To: <BANLkTikkv5WMv2nLfBhrMYWTNgJmitOnJw@mail.gmail.com>
References: <BANLkTimCr6aF6O8DyY+mfTpLr+8MMuvmkA@mail.gmail.com>
	<F3337C24-FAB7-49CB-AC0D-8270BD3FF7B6@gmail.com>
	<alpine.LFD.2.02.1106171424170.19460@gannet.stats.ox.ac.uk>
	<5907E42F-9E7D-4FE2-A98D-16CEF712AEBB@gmail.com>
	<BANLkTikkv5WMv2nLfBhrMYWTNgJmitOnJw@mail.gmail.com>
Message-ID: <BANLkTi=cq34kSPsW66NY9HANrNTnf5zzKw@mail.gmail.com>

On Fri, Jun 17, 2011 at 1:57 PM, Drew Frank <ajfrank at ics.uci.edu> wrote:
> On Fri, Jun 17, 2011 at 7:26 AM, peter dalgaard <pdalgd at gmail.com> wrote:
>>
>> On Jun 17, 2011, at 15:32 , Prof Brian Ripley wrote:
>> >>>
>> >>> Is this behavior intended? ?Would be it be reasonable to instead create
>> >>> windows with a generic name like "R Graphics" prior to updating them with
>> >>> the device number and active/inactive status?
>> >
>> > Yes, no.
>> >
>>
>> Well, "yes, maybe", I'd say. If the WM insists on looking at the title, it makes some pragmatic sense for the user to set it to a generic name that the WM can recognize.
>>
>> However, on revisiting this, the obvious fix/workaround is just to set
>>
>> X11.options(title="R Graphics: Device %d")
>>
>> and the user can do this in his/her startup files. No need to inflict it on every user with any WM.
>>
>> --
>> Peter Dalgaard
>> Center for Statistics, Copenhagen Business School
>> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
>> Phone: (+45)38153501
>> Email: pd.mes at cbs.dk ?Priv: PDalgd at gmail.com
>>

Thank you Peter and Brian for your replies.? The X11.options
workaround is effective, and I'd be happy to make use of it.

That said, after reading your replies I agree that the "correct" thing
to do would be for the WM to match on WM_CLASS, which is currently not
set.? I checked out the R-devel trunk and was preparing a patch to set
WM_CLASS when I noticed that Brian already committed code to do this
in r56008. ?However, the code is wrapped in an "#ifndef USE_Xt", with
the comment "/* For those too idle to make use of Xt (PR#14588) */".
When I compile, USE_Xt is set so this code isn't executed and WM_CLASS
is never set. ?Is it supposed to be set somewhere else?

Thank you,
Drew


From soeren.vogel at uzh.ch  Sun Jun 19 20:17:53 2011
From: soeren.vogel at uzh.ch (soeren.vogel at uzh.ch)
Date: Sun, 19 Jun 2011 20:17:53 +0200
Subject: [Rd] R CMD check on CRAN
Message-ID: <924E5B3F-DAB7-4764-BD6A-39EEDECC9375@uzh.ch>

Hello

I have a package with a configure script (--include-something). How does the package pass the check on CRAN, that is, how should I signalise that check and install may need options?

Thanks
S?ren


From ligges at statistik.tu-dortmund.de  Sun Jun 19 20:34:02 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sun, 19 Jun 2011 20:34:02 +0200
Subject: [Rd] R CMD check on CRAN
In-Reply-To: <924E5B3F-DAB7-4764-BD6A-39EEDECC9375@uzh.ch>
References: <924E5B3F-DAB7-4764-BD6A-39EEDECC9375@uzh.ch>
Message-ID: <4DFE411A.9050003@statistik.tu-dortmund.de>



On 19.06.2011 20:17, soeren.vogel at uzh.ch wrote:
> Hello
>
> I have a package with a configure script (--include-something). How does the package pass the check on CRAN, that is, how should I signalise that check and install may need options?

Which options are you talking about? You need to be more specific here, 
I think.

Uwe Ligges


>
> Thanks
> S?ren
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Sun Jun 19 21:24:31 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 19 Jun 2011 20:24:31 +0100 (BST)
Subject: [Rd] R CMD check on CRAN
In-Reply-To: <4DFE411A.9050003@statistik.tu-dortmund.de>
References: <924E5B3F-DAB7-4764-BD6A-39EEDECC9375@uzh.ch>
	<4DFE411A.9050003@statistik.tu-dortmund.de>
Message-ID: <alpine.LFD.2.02.1106192012400.22148@gannet.stats.ox.ac.uk>

On Sun, 19 Jun 2011, Uwe Ligges wrote:

>
>
> On 19.06.2011 20:17, soeren.vogel at uzh.ch wrote:
>> Hello
>> 
>> I have a package with a configure script (--include-something). How does 
>> the package pass the check on CRAN, that is, how should I signalise that 
>> check and install may need options?
>
> Which options are you talking about? You need to be more specific here, I 
> think.

Well, there is --configure-args and --configure-vars

Such packages are very rare (and has better remain so or the automated 
systems will grind to their knees).  I have, e.g.

RNetCDF-OPTS = 
--install-args='--configure-args=--with-netcdf-include=/usr/include/udunits2'
Rserve-OPTS = --install-args='--configure-args=--without-server'
udunits2-OPTS = 
--install-args='--configure-args=--with-udunits2-include=/usr/include/udunits2'

I don't believe any of these 3 should be needed: they indicate a lack 
of responsiveness/dogmatism from the package maintainers.  (I have 
some sympathy with resistance to non-standard layout, but it should be 
able to be specified by environment variables, as discussed in 
'Writing R Extensions'.)


>
> Uwe Ligges
>
>
>> 
>> Thanks
>> S?ren
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From nakama at ki.rim.or.jp  Mon Jun 20 05:24:21 2011
From: nakama at ki.rim.or.jp (Ei-ji Nakama)
Date: Mon, 20 Jun 2011 12:24:21 +0900
Subject: [Rd] Does anybody successfully built latest R on AIX 5.3?
In-Reply-To: <001901cc25e6$59ba2920$0d2e7b60$@com>
References: <4DEF57BC.5040900@wu.ac.at> <001501cc25d3$f49563a0$ddc02ae0$@com>
	<4DEF6D8C.6030908@wu.ac.at> <001901cc25e6$59ba2920$0d2e7b60$@com>
Message-ID: <BANLkTinVsA6BsWEvDVsNXM9JpaK-_Lv9PQ@mail.gmail.com>

Hi,

> This is strange, we are hoping to improve R performance through high clock speed Power CPU(4.0 GHz above),
> Now I think we should take more considerations, RAM is also cheaper for X86 than Power :)

power is no good CPU.

$ lsdev -C | grep proc
proc0      Available 00-00    Processor
proc2      Available 00-02    Processor
$ lsattr -El proc0
frequency   4204000000     Processor Speed       False
smt_enabled true           Processor SMT enabled False
smt_threads 2              Processor SMT threads False
state       enable         Processor state       False
type        PowerPC_POWER6 Processor type        False
$ lsattr -El proc2
frequency   4204000000     Processor Speed       False
smt_enabled true           Processor SMT enabled False
smt_threads 2              Processor SMT threads False
state       enable         Processor state       False
type        PowerPC_POWER6 Processor type        False

As a result of DGEMM by GotoBLAS(http://prs.ism.ac.jp/~nakama/SurviveGotoBLAS2).
$ GOTO_NUM_THREADS=1 ./bm 2000
   12.954 GFLOPS (N x N : N=2000 1.23517sec)
   12.719 GFLOPS (N x T : N=2000 1.25796sec)
   13.118 GFLOPS (T x N : N=2000 1.21965sec)
   12.726 GFLOPS (T x T : N=2000 1.25732sec)
$ GOTO_NUM_THREADS=2 ./bm 2000
   25.259 GFLOPS (N x N : N=2000 0.633444sec)
   24.050 GFLOPS (N x T : N=2000 0.665272sec)
   25.710 GFLOPS (T x N : N=2000 0.622316sec)
   24.075 GFLOPS (T x T : N=2000 0.664595sec)
$ GOTO_NUM_THREADS=4 ./bm 2000
   21.311 GFLOPS (N x N : N=2000 0.750802sec)
   25.778 GFLOPS (N x T : N=2000 0.620694sec)
   26.398 GFLOPS (T x N : N=2000 0.60611sec)
   25.826 GFLOPS (T x T : N=2000 0.619536sec)

It's fast with the structure (L2 shared cache) of the CPU to 2CPU.

Best Regards,
--
EI-JI Nakama? <nakama (a) ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb"? <nakama (a) ki.rim.or.jp>


From pauljohn32 at gmail.com  Mon Jun 20 18:30:20 2011
From: pauljohn32 at gmail.com (Paul Johnson)
Date: Mon, 20 Jun 2011 11:30:20 -0500
Subject: [Rd] requesting a mentor for R development
Message-ID: <BANLkTi=eHgitd8d==e18hpXvZTPTTdZgJg@mail.gmail.com>

I'd like to learn the process of revising R functions & packages and
then submitting proposed patches to the R Core team.  Would someone be
willing to mentor me through one example?

For starters, consider an example.  I'd like to revise the t.test
function to return the stderr value to the user.  We only need to
change the "rval" in the third-from-the end line of
stats:::t.test.default.

Change this:

 rval <- list(statistic = tstat, parameter = df, p.value = pval,
        conf.int = cint, estimate = estimate, null.value = mu,
        alternative = alternative, method = method, data.name = dname)
    class(rval) <- "htest"
    return(rval)

To this:

 rval <- list(statistic = tstat, parameter = df, stderr=stderr, p.value = pval,
        conf.int = cint, estimate = estimate, null.value = mu,
        alternative = alternative, method = method, data.name = dname)
    class(rval) <- "htest"
    return(rval)

Here is where I need help.

1. What other changes in the R code & documents would be required for
consistency?

2. How does R Core Team expect/accept patches?
I do understand a bit about SVN and CVS.  I think I could mark this up
and make a diff, but I'm uncertain about the details.

3. How would I best  prepare a suggestion like this so as to get it
accepted into R?

If somebody will raise a hand, I'm willing to do the work to learn.

pj
-- 
Paul E. Johnson
Professor, Political Science
1541 Lilac Lane, Room 504
University of Kansas


From jayemerson at gmail.com  Mon Jun 20 21:12:56 2011
From: jayemerson at gmail.com (Jay Emerson)
Date: Mon, 20 Jun 2011 15:12:56 -0400
Subject: [Rd] arbitrary size data frame or other stcucts,
	curious about issues invovled.
Message-ID: <BANLkTi=V9rOo6N-jFBh3EoSF=k0KyU6C8w@mail.gmail.com>

Mike,


Neither bigmemory nor ff are "drop in" solutions -- though useful,
they are primarily for data storage and management and allowing
convenient access to subsets of the data.  Direct analysis of the full
objects via most R functions is not possible.  There are many issues
that could be discussed here (and have, previously), including the use
of 32-bit integer indexing.  There is a nice section "Future
Directions" in the R Internals manual that you might want to look at.

Jay


-------------------------------------  Original message:

We keep getting questions on r-help about memory limits  and
I was curious to know what issues are involved in making
common classes like dataframe work with disk and intelligent
swapping? That is, sure you can always rely on OS for VM
but in theory it should be possible to make a data structure
that somehow knows what pieces you will access next and
can keep thos somewhere fast. Now of course algorithms
"should" act locally and be block oriented but in any case
could communicate with data structures on upcoming
access patterns, see a few ms into the future and have the
right stuff prefetched.

I think things like "bigmemory" exist but perhaps one
issue was that this could not just drop in for data.frame
or does it already solve all the problems?

Is memory management just a non-issue or is there something
that needs to be done  to make large data structures work well?


-- 
John W. Emerson (Jay)
Associate Professor of Statistics
Department of Statistics
Yale University
http://www.stat.yale.edu/~jay


From xie at yihui.name  Mon Jun 20 23:57:12 2011
From: xie at yihui.name (Yihui Xie)
Date: Mon, 20 Jun 2011 16:57:12 -0500
Subject: [Rd] Quote the path of graphics output in Sweave when it contains
	spaces
Message-ID: <BANLkTimwL+GEmXWBe4nroEJWTvF4uFStWA@mail.gmail.com>

Hi,

I'm aware of the definition of a "valid filename" in
.SweaveValidFilenameRegexp, but I think it might be better to quote
the filename when it contains spaces instead of just giving a warning.
This should bring us safer LaTeX code (although I never use spaces in
paths).

Here is the simple patch:

Index: src/library/utils/R/SweaveDrivers.R
===================================================================
--- src/library/utils/R/SweaveDrivers.R	(revision 56193)
+++ src/library/utils/R/SweaveDrivers.R	(working copy)
@@ -390,6 +390,8 @@
             }

             if (options$include) {
+                if (grepl("[[:space:]]", chunkprefix))
+                    chunkprefix = shQuote(chunkprefix, type = "cmd")
                 cat("\\includegraphics{", chunkprefix, "}\n", sep = "",
                     file = object$output)
                 linesout[thisline + 1L] <- srcline

Thanks!

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Phone: 515-294-2465 Web: http://yihui.name
Department of Statistics, Iowa State University
2215 Snedecor Hall, Ames, IA


From murdoch.duncan at gmail.com  Tue Jun 21 00:58:03 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 20 Jun 2011 18:58:03 -0400
Subject: [Rd] Quote the path of graphics output in Sweave when it
 contains spaces
In-Reply-To: <BANLkTimwL+GEmXWBe4nroEJWTvF4uFStWA@mail.gmail.com>
References: <BANLkTimwL+GEmXWBe4nroEJWTvF4uFStWA@mail.gmail.com>
Message-ID: <4DFFD07B.6040507@gmail.com>

On 11-06-20 5:57 PM, Yihui Xie wrote:
> Hi,
>
> I'm aware of the definition of a "valid filename" in
> .SweaveValidFilenameRegexp, but I think it might be better to quote
> the filename when it contains spaces instead of just giving a warning.
> This should bring us safer LaTeX code (although I never use spaces in
> paths).

That works in MikTeX 2.9's version of pdflatex, but not in latex.  I 
imagine in 5 years it's possible all the different latex versions will 
consistently handle quotes, but it hasn't happened yet.

Duncan Murdoch

>
> Here is the simple patch:
>
> Index: src/library/utils/R/SweaveDrivers.R
> ===================================================================
> --- src/library/utils/R/SweaveDrivers.R	(revision 56193)
> +++ src/library/utils/R/SweaveDrivers.R	(working copy)
> @@ -390,6 +390,8 @@
>               }
>
>               if (options$include) {
> +                if (grepl("[[:space:]]", chunkprefix))
> +                    chunkprefix = shQuote(chunkprefix, type = "cmd")
>                   cat("\\includegraphics{", chunkprefix, "}\n", sep = "",
>                       file = object$output)
>                   linesout[thisline + 1L]<- srcline
>
> Thanks!
>
> Regards,
> Yihui
> --
> Yihui Xie<xieyihui at gmail.com>
> Phone: 515-294-2465 Web: http://yihui.name
> Department of Statistics, Iowa State University
> 2215 Snedecor Hall, Ames, IA
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From marchywka at hotmail.com  Tue Jun 21 12:33:23 2011
From: marchywka at hotmail.com (Mike Marchywka)
Date: Tue, 21 Jun 2011 06:33:23 -0400
Subject: [Rd] arbitrary size data frame or other stcucts,
 curious about issues invovled.
In-Reply-To: <BANLkTi=V9rOo6N-jFBh3EoSF=k0KyU6C8w@mail.gmail.com>
References: <BANLkTi=V9rOo6N-jFBh3EoSF=k0KyU6C8w@mail.gmail.com>
Message-ID: <BLU166-w3AFE88377629907A8586ABE510@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110621/95f83063/attachment.pl>

From oyvfos at yahoo.no  Tue Jun 21 11:11:44 2011
From: oyvfos at yahoo.no (oyvfos)
Date: Tue, 21 Jun 2011 02:11:44 -0700 (PDT)
Subject: [Rd] Error using RcppGSL
Message-ID: <1308647504270-3613535.post@n4.nabble.com>

Hi, I get an error using RcppGSL: fatal error: gsl/gsl_vector.h:No such file
or directory.  What is the best way to install these files as they seem to
be missing?
Thanks,
Oyvind


--
View this message in context: http://r.789695.n4.nabble.com/Error-using-RcppGSL-tp3613535p3613535.html
Sent from the R devel mailing list archive at Nabble.com.


From bbolker at gmail.com  Tue Jun 21 16:19:15 2011
From: bbolker at gmail.com (Ben Bolker)
Date: Tue, 21 Jun 2011 14:19:15 +0000
Subject: [Rd] requesting a mentor for R development
References: <BANLkTi=eHgitd8d==e18hpXvZTPTTdZgJg@mail.gmail.com>
Message-ID: <loom.20110621T155400-797@post.gmane.org>

Paul Johnson <pauljohn32 <at> gmail.com> writes:

> 
> I'd like to learn the process of revising R functions & packages and
> then submitting proposed patches to the R Core team.  Would someone be
> willing to mentor me through one example?

  I don't know about mentoring, but I'll give my two cents (some
specific and some general thoughts, and some of my own questions).

> For starters, consider an example.  I'd like to revise the t.test
> function to return the stderr value to the user.  We only need to
> change the "rval" in the third-from-the end line of
> stats:::t.test.default.
> 
> Change this:
> 
>  rval <- list(statistic = tstat, parameter = df, p.value = pval,
>         conf.int = cint, estimate = estimate, null.value = mu,
>         alternative = alternative, method = method, data.name = dname)
>     class(rval) <- "htest"
>     return(rval)
> 
> To this:
> 
>  rval <- list(statistic = tstat, parameter = df, stderr=stderr, p.value = pval,
>         conf.int = cint, estimate = estimate, null.value = mu,
>         alternative = alternative, method = method, data.name = dname)
>     class(rval) <- "htest"
>     return(rval)
> 
> Here is where I need help.
> 
> 1. What other changes in the R code & documents would be required for
> consistency?

  You would certainly want to modify the corresponding manual page.
  
  There is an issue with fitting this specific change into the existing
R framework.  't.test' returns an object of class 'htest', which is
printed using 'stats:::print.htest'.  I haven't actually tried it,
but it looks to me as though print.htest (which is intended to
be a generic class for statistical test -- maybe h stands for
"hypothesis", I don't know) will simply ignore "stderr" or
any other non-default components of an 'htest' object.
There is a '...' argument to 'print.htest', but it functions
to pass options to print() for the estimate and the null values.

  I haven't been able to find any specific documentation about
htest.  print.htest() is used for a wide range of tests (in the
stats package and many contributed packages), so obviously it
would be bad to make non-backward-compatible changes.  I think
it might be best to modify print.htest() so it looked
for any additional/non-standard components of the object and
printed them after all the other output (they would need to
have reasonable labels incorporated somehow too).


> 
> 2. How does R Core Team expect/accept patches?
> I do understand a bit about SVN and CVS.  I think I could mark this up
> and make a diff, but I'm uncertain about the details.

  I think that patches via "svn diff" against the latest SVN are
preferred. The only routes I know for submission are (1) sending
patch files to R-devel or (2) submitting them to the R bugs system
as a "wishlist" item.  I don't know which is preferred.

> 3. How would I best  prepare a suggestion like this so as to get it
> accepted into R?

  I think the accepted method (although I don't know whether this
is documented anywhere) is to do what you have done, submitting a
"request for discussion" on r-devel, getting it discussed, posting
patches for comment, and hoping for the best.


From bates at stat.wisc.edu  Tue Jun 21 16:50:20 2011
From: bates at stat.wisc.edu (Douglas Bates)
Date: Tue, 21 Jun 2011 09:50:20 -0500
Subject: [Rd] Error using RcppGSL
In-Reply-To: <1308647504270-3613535.post@n4.nabble.com>
References: <1308647504270-3613535.post@n4.nabble.com>
Message-ID: <BANLkTinQ-UG+j=Ux_HbjciF7PuuwRJC2XQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110621/7c67225c/attachment.pl>

From simon.urbanek at r-project.org  Tue Jun 21 18:26:12 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 21 Jun 2011 12:26:12 -0400
Subject: [Rd] arbitrary size data frame or other stcucts,
	curious about issues invovled.
In-Reply-To: <BLU166-w3AFE88377629907A8586ABE510@phx.gbl>
References: <BANLkTi=V9rOo6N-jFBh3EoSF=k0KyU6C8w@mail.gmail.com>
	<BLU166-w3AFE88377629907A8586ABE510@phx.gbl>
Message-ID: <6E7CC325-E5F6-4B18-88C4-5E1BF54814BE@r-project.org>

Mike,

this is all nice, but AFAICS the first part misses the point that there is no 64-bit integer type in the API so there is simply no alternative at the moment. You just said that you don't like it, but you failed to provide a solution ... As for the second part, the idea is not new and is noble, but AFAIK no one so far was able to draft any good proposal as of what the API would look like. It would be very desirable if someone did, though. (BTW your link is useless - linking google searches is pointless as the results vary by request location, user setting etc.).

Cheers,
Simon


On Jun 21, 2011, at 6:33 AM, Mike Marchywka wrote:

> Thanks,
> 
> http://cran.r-project.org/doc/manuals/R-ints.html#Future-directions
> 
> Normally I'd take more time to digest these things before commenting but
> a few things struck me right away. First, use of floating point or double 
> as a replacement for int strikes me as "going the wrong way" as often
> to get predictable performance you try to tell the compiler you have
> ints rather than any floating time for which it is free to "round."  This
> is even ignoring any performance issue. The other thing is that scaling
> should not just be an issue of "make everything bigger" as the growth in
> both data needs and computer resources is not uniform. 
> 
> I guess my first thought to these constraints and resource issues
> is to consider a paged dataframe depending upon the point at which
> the 32-bit int constraint is imposed. A random access data struct 
> does not always get accessed randomly, and often it is purely sequential.
> Further down the road, it would be nice if algorithms were implemented in a
> block mode or could communicate their access patterns to the ds or
> at least tell it to prefetch things that should be needed soon. 
> 
> I guess I'm thinking mostly along the lines of things I've seen from Intel
> such as ( first things I could find on their site as I have not looked in detail
> in quite a while),
> 
> 
> http://www.google.com/search?hl=en&source=hp&q=site%3Aintel.com+performance+optimization
> 
> as once you get around thrashing virtual memory, you'd like to preserve the
> lower level memory cache hit rates too etc. These are probably not just niceities, 
> at least with VM, as personally I've seen impl related speed issues make simple analyses impractical.
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
>> Subject: RE: arbitrary size data frame or other stcucts, curious about issues invovled.
>> From: jayemerson at gmail.com
>> To: marchywka at hotmail.com; r-devel at r-project.org
>> 
>> Mike,
>> 
>> 
>> Neither bigmemory nor ff are "drop in" solutions -- though useful,
>> they are primarily for data storage and management and allowing
>> convenient access to subsets of the data.  Direct analysis of the full
>> objects via most R functions is not possible.  There are many issues
>> that could be discussed here (and have, previously), including the use
>> of 32-bit integer indexing.  There is a nice section "Future
>> Directions" in the R Internals manual that you might want to look at.
>> 
>> Jay
>> 
>> 
>> -------------------------------------  Original message:
>> 
>> We keep getting questions on r-help about memory limits  and
>> I was curious to know what issues are involved in making
>> common classes like dataframe work with disk and intelligent
>> swapping? That is, sure you can always rely on OS for VM
>> but in theory it should be possible to make a data structure
>> that somehow knows what pieces you will access next and
>> can keep thos somewhere fast. Now of course algorithms
>> "should" act locally and be block oriented but in any case
>> could communicate with data structures on upcoming
>> access patterns, see a few ms into the future and have the
>> right stuff prefetched.
>> 
>> I think things like "bigmemory" exist but perhaps one
>> issue was that this could not just drop in for data.frame
>> or does it already solve all the problems?
>> 
>> Is memory management just a non-issue or is there something
>> that needs to be done  to make large data structures work well?
>> 
>> 
>> -- 
>> John W. Emerson (Jay)
>> Associate Professor of Statistics
>> Department of Statistics
>> Yale University
>> http://www.stat.yale.edu/~jay
> 		 	   		  
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From marchywka at hotmail.com  Tue Jun 21 19:10:51 2011
From: marchywka at hotmail.com (Mike Marchywka)
Date: Tue, 21 Jun 2011 13:10:51 -0400
Subject: [Rd] arbitrary size data frame or other stcucts,
 curious about issues invovled.
In-Reply-To: <6E7CC325-E5F6-4B18-88C4-5E1BF54814BE@r-project.org>
References: <BANLkTi=V9rOo6N-jFBh3EoSF=k0KyU6C8w@mail.gmail.com>
	<BLU166-w3AFE88377629907A8586ABE510@phx.gbl>,
	<6E7CC325-E5F6-4B18-88C4-5E1BF54814BE@r-project.org>
Message-ID: <BLU166-w332ADC6F0F30894FC0B512BE510@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110621/c6a2ac47/attachment.pl>

From edd at debian.org  Wed Jun 22 01:12:13 2011
From: edd at debian.org (Dirk Eddelbuettel)
Date: Tue, 21 Jun 2011 18:12:13 -0500
Subject: [Rd] [Rcpp-devel]  Error using RcppGSL
In-Reply-To: <BANLkTinQ-UG+j=Ux_HbjciF7PuuwRJC2XQ@mail.gmail.com>
References: <1308647504270-3613535.post@n4.nabble.com>
	<BANLkTinQ-UG+j=Ux_HbjciF7PuuwRJC2XQ@mail.gmail.com>
Message-ID: <19969.9549.511306.812363@max.nulle.part>


On 21 June 2011 at 09:50, Douglas Bates wrote:
| Questions like this would get a faster response on the Rcpp-devel list, to
| which I am copying this reply.

Quite right.  Dropping r-devel now.  You need to subscribe to rcpp-devel if
you want to post there.
 
| On Jun 21, 2011 6:35 AM, "oyvfos" <oyvfos at yahoo.no> wrote:
| > Hi, I get an error using RcppGSL: fatal error: gsl/gsl_vector.h:No such file
| > or directory. What is the best way to install these files as they seem to
| > be missing?

What platform, ie what operating system?

Do you have GSL installed?  Including development headers and libraries?  Did
you _ever_ compile anything against GSL?

Dirk

| > Thanks,
| > Oyvind
| >
| >
| > --
| > View this message in context: http://r.789695.n4.nabble.com/
| Error-using-RcppGSL-tp3613535p3613535.html
| > Sent from the R devel mailing list archive at Nabble.com.
| >
| > ______________________________________________
| > R-devel at r-project.org mailing list
| > https://stat.ethz.ch/mailman/listinfo/r-devel
| 
| ----------------------------------------------------------------------
| _______________________________________________
| Rcpp-devel mailing list
| Rcpp-devel at lists.r-forge.r-project.org
| https://lists.r-forge.r-project.org/cgi-bin/mailman/listinfo/rcpp-devel

-- 
Gauss once played himself in a zero-sum game and won $50.
                      -- #11 at http://www.gaussfacts.com


From deepayan.sarkar at gmail.com  Wed Jun 22 12:10:38 2011
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Wed, 22 Jun 2011 15:40:38 +0530
Subject: [Rd] Cases of TAB-completion that hang Rterm
In-Reply-To: <BANLkTikY2OD5JL2DC0JoHCVsH4wBAWDMOg@mail.gmail.com>
References: <BANLkTikY2OD5JL2DC0JoHCVsH4wBAWDMOg@mail.gmail.com>
Message-ID: <BANLkTi=c3-G2EC8UM5Kf4C88EvxTknX42g@mail.gmail.com>

On Tue, Jun 7, 2011 at 1:49 PM, Henrik Bengtsson <hb at biostat.ucsf.edu> wrote:
> FYI,
>
> via a bug report of one of my packages, I discovered that the
> following cases will hang Rterm when using TAB completion:
>
> CASE #1:
> Adding an empty default function for tail() causes Rterm on Windows to
> hang if one press TAB at the prompt:
>
> % Rterm -vanilla
>> tail.default <- function(...) {}
>> [PRESS TAB]
> Error in specialOpLocs(text) :
> ?(list) object cannot be coerced to type 'double'
>
> After this Rterm becomes completely unresponsive. ?The same error
> message will show up with Rgui, but R remains responsive.
>
>
> CASE #2:
> While troubleshooting the above, I discovered that if one does:
>
>> debug(utils:::.guessTokenFromLine)
>> [PRESS TAB]
>
> or
>
>> debug(utils:::.win32consoleCompletion)
>> [PRESS TAB]
>
> then Rterm hangs too (not Rgui).
>
> This happens with R v2.13.0 patched (2011-05-30 r56020) and R v2.14.0
> devel (2011-05-30 r56020) on Windows.

This should now be fixed in both r-devel (for a few days now) and r-patched.

-Deepayan


From oyvfos at yahoo.no  Wed Jun 22 09:02:16 2011
From: oyvfos at yahoo.no (=?iso-8859-1?Q?=D8yvind_Foshaug?=)
Date: Wed, 22 Jun 2011 08:02:16 +0100 (BST)
Subject: [Rd] [Rcpp-devel]  Error using RcppGSL
In-Reply-To: <19969.9549.511306.812363@max.nulle.part>
References: <1308647504270-3613535.post@n4.nabble.com>
	<BANLkTinQ-UG+j=Ux_HbjciF7PuuwRJC2XQ@mail.gmail.com>
	<19969.9549.511306.812363@max.nulle.part>
Message-ID: <671496.3424.qm@web24601.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110622/2f796a3f/attachment.pl>

From msonsini at harmonia.com  Wed Jun 22 15:36:39 2011
From: msonsini at harmonia.com (Mike Sonsini)
Date: Wed, 22 Jun 2011 09:36:39 -0400
Subject: [Rd] Controlling stdin and stdout in an embedded R instance
In-Reply-To: <3354124D-8F54-4AD5-BA04-2393F8F03056@r-project.org>
References: <4DFA880F.4000802@harmonia.com>
	<3354124D-8F54-4AD5-BA04-2393F8F03056@r-project.org>
Message-ID: <4E01EFE7.8090300@harmonia.com>

Thank you, this example helped.

Mike Sonsini

On 6/17/2011 10:29 AM, Simon Urbanek wrote:
> Mike,
>
> there are many examples of embedding R, one of them is rJava/JRI and you can see how to initialize R with custom callbacks at
> http://svn.rforge.net/org/trunk/rosuda/JRI/src/Rinit.c
>
> Cheers,
> Simon


From stephen.ellison at lgcgroup.com  Wed Jun 22 18:03:00 2011
From: stephen.ellison at lgcgroup.com (Stephen Ellison)
Date: Wed, 22 Jun 2011 17:03:00 +0100
Subject: [Rd] Checking R manual build
In-Reply-To: <4E01EFE7.8090300@harmonia.com>
References: <4DFA880F.4000802@harmonia.com>
	<3354124D-8F54-4AD5-BA04-2393F8F03056@r-project.org>
	<4E01EFE7.8090300@harmonia.com>
Message-ID: <98B156BB22D11342A931E823798D434853E97274E6@GOLD.corp.lgc-group.com>

Is there a quick way of checking the R manuals built from the .texi files in ../doc/manual without building the rest of R?

Going from a vanilla checkout, some included files are missing (eg version.texi) and created by the makefiles, so it looks like the complete make script needs to be run at least once ... and then one has a number of make-generated changes to one's R sources to worry about in any subsequent diff. 

Is the only route to export the svn copy, build from the exported copy and then use texinfo to check the manual pages using the make-built includes and rules?


Steve Ellison
*******************************************************************
This email and any attachments are confidential. Any use...{{dropped:8}}


From moshersteven at gmail.com  Wed Jun 22 22:12:41 2011
From: moshersteven at gmail.com (steven mosher)
Date: Wed, 22 Jun 2011 13:12:41 -0700
Subject: [Rd] First package submission to CRAN
Message-ID: <BANLkTinqaRAj8_beryiprZR_-ZVhyPTgUQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110622/24869bef/attachment.pl>

From dutangc at gmail.com  Wed Jun 22 22:34:36 2011
From: dutangc at gmail.com (Christophe Dutang)
Date: Wed, 22 Jun 2011 22:34:36 +0200
Subject: [Rd] First package submission to CRAN
In-Reply-To: <BANLkTinqaRAj8_beryiprZR_-ZVhyPTgUQ@mail.gmail.com>
References: <BANLkTinqaRAj8_beryiprZR_-ZVhyPTgUQ@mail.gmail.com>
Message-ID: <29E8CF0F-7862-4B72-860C-16305EC45CFA@gmail.com>

Hi,

By default, R CMD build makes sources, you have to use --binary if you want to get binaries. But you have to submit sources to the CRAN ftp server (and not binary). So just run a R CMD build.

C

--
Christophe Dutang
Ph.D. student at ISFA, Lyon, France
website: http://dutangc.free.fr

Le 22 juin 2011 ? 22:12, steven mosher a ?crit :

> I'm preparing to submit my first package to CRAN, thanks to the help of too
> many people to mention.
> 
> I've built and checked the package on Windows  ( making a zip) and my path
> points to the 64 bit version of R.
> 
> Everything builds and checks and the final warnings have been fixed. My
> package is pure R with no source from
> 
> other languages.  My questions are  as follows. I've read the docs and just
> need a bit of clarification.
> 
> 1. For submission I should just build source  R CMD build mypkg  which
> outputs a tar.gz
> 2. Do I have to/ how do I build for 32 bit?
> 
> Thanks,
> 
> Steve
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From moshersteven at gmail.com  Wed Jun 22 22:51:49 2011
From: moshersteven at gmail.com (steven mosher)
Date: Wed, 22 Jun 2011 13:51:49 -0700
Subject: [Rd] First package submission to CRAN
In-Reply-To: <29E8CF0F-7862-4B72-860C-16305EC45CFA@gmail.com>
References: <BANLkTinqaRAj8_beryiprZR_-ZVhyPTgUQ@mail.gmail.com>
	<29E8CF0F-7862-4B72-860C-16305EC45CFA@gmail.com>
Message-ID: <BANLkTinK-a7w+j0cG2JAPNrtWLZreu_RTg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110622/3af39d7d/attachment.pl>

From d.scott at auckland.ac.nz  Thu Jun 23 01:51:10 2011
From: d.scott at auckland.ac.nz (David Scott)
Date: Thu, 23 Jun 2011 11:51:10 +1200
Subject: [Rd] First package submission to CRAN
In-Reply-To: <29E8CF0F-7862-4B72-860C-16305EC45CFA@gmail.com>
References: <BANLkTinqaRAj8_beryiprZR_-ZVhyPTgUQ@mail.gmail.com>
	<29E8CF0F-7862-4B72-860C-16305EC45CFA@gmail.com>
Message-ID: <4E027FEE.3050707@auckland.ac.nz>

  On 23/06/11 08:34, Christophe Dutang wrote:
> Hi,
>
> By default, R CMD build makes sources, you have to use --binary if you want to get binaries. But you have to submit sources to the CRAN ftp server (and not binary). So just run a R CMD build.
>
> C
>
> --
> Christophe Dutang
> Ph.D. student at ISFA, Lyon, France
> website: http://dutangc.free.fr

That is now deprecated Christophe. Recommended now is

R CMD INSTALL --build

to get a binary. See the recent thread with the subject

Porting "unmaintained" packages to post R 2.10.0 era

David Scott

> Le 22 juin 2011 ? 22:12, steven mosher a ?crit :
>
>> I'm preparing to submit my first package to CRAN, thanks to the help of too
>> many people to mention.
>>
>> I've built and checked the package on Windows  ( making a zip) and my path
>> points to the 64 bit version of R.
>>
>> Everything builds and checks and the final warnings have been fixed. My
>> package is pure R with no source from
>>
>> other languages.  My questions are  as follows. I've read the docs and just
>> need a bit of clarification.
>>
>> 1. For submission I should just build source  R CMD build mypkg  which
>> outputs a tar.gz
>> 2. Do I have to/ how do I build for 32 bit?
>>
>> Thanks,
>>
>> Steve
>>
>> 	[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
_________________________________________________________________
David Scott	Department of Statistics
		The University of Auckland, PB 92019
		Auckland 1142,    NEW ZEALAND
Phone: +64 9 923 5055, or +64 9 373 7599 ext 85055
Email:	d.scott at auckland.ac.nz,  Fax: +64 9 373 7018


From btyner at gmail.com  Thu Jun 23 03:55:04 2011
From: btyner at gmail.com (Benjamin Tyner)
Date: Wed, 22 Jun 2011 21:55:04 -0400
Subject: [Rd] suggestion for subset.data.frame()
Message-ID: <4E029CF8.3000404@gmail.com>

Hello,

Currently, subset.data.frame() does

    if (missing(subset))
            r <- TRUE
        else {

perhaps better might be:

    if (missing(subset))
            r <- rep(TRUE, nrow(x))
        else {

The rationale being, if 'x' has zero rows and 'subset' is missing, we 
don't want to end up with more rows than we started with:

     > subset(head(iris, 0), select = -Species)
       Sepal.Length Sepal.Width Petal.Length Petal.Width
    NA           NA          NA           NA          NA

Thoughts?
-Ben

From ripley at stats.ox.ac.uk  Thu Jun 23 06:48:38 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 23 Jun 2011 05:48:38 +0100 (BST)
Subject: [Rd] Checking R manual build
In-Reply-To: <98B156BB22D11342A931E823798D434853E97274E6@GOLD.corp.lgc-group.com>
References: <4DFA880F.4000802@harmonia.com>
	<3354124D-8F54-4AD5-BA04-2393F8F03056@r-project.org>
	<4E01EFE7.8090300@harmonia.com>
	<98B156BB22D11342A931E823798D434853E97274E6@GOLD.corp.lgc-group.com>
Message-ID: <alpine.LFD.2.02.1106230541181.15732@gannet.stats.ox.ac.uk>

On Wed, 22 Jun 2011, Stephen Ellison wrote:

> Is there a quick way of checking the R manuals built from the .texi 
> files in ../doc/manual without building the rest of R?

What does 'check' mean?

> Going from a vanilla checkout, some included files are missing (eg 
> version.texi) and created by the makefiles, so it looks like the 
> complete make script needs to be run at least once ... and then one 
> has a number of make-generated changes to one's R sources to worry 
> about in any subsequent diff.

You haven't told us your OS (pace the posting guide).  On all systems 
the first step is to run configure (but that has already been done for 
you on Windows, but you do need to create MkRules from MkRules.local). 
Again except on Windows, we recommend working in a build directory 
other than the sources.  Even on Windows there will be *no* 
'make-generated changes to one's R sources': no files are changed but 
some are generated.  make distclean will clean up ..

> Is the only route to export the svn copy, build from the exported 
> copy and then use texinfo to check the manual pages using the 
> make-built includes and rules?

Possibly, depending on the meaning of 'check'.

R-core (as the only people changing these manuals) also need to use a 
pdflatex system, to check that the PDF version can be made as the 
manuals have PDF-specific (and HTML-specific) sections.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From renaud at mancala.cbio.uct.ac.za  Thu Jun 23 13:22:06 2011
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Thu, 23 Jun 2011 13:22:06 +0200
Subject: [Rd] Class not found when search in .onLoad
Message-ID: <4E0321DE.2020601@cbio.uct.ac.za>

Hi,

I am facing with a strange behaviour of isClass and extends when these 
are called in .onLoad in both R 2.12.1 and R 2.13.0. This is preventing 
my package from doing some object initializations at a proper place 
(i.e. in .onLoad).

Suppose one defines two S4 classes in a package, and that one needs to 
check the inheritance between these two when loading the package (e.g. 
to validate slots in objects).
See package attached or code below (not sure attachments can go through).

in R 2.13.0:
At the loading check after installation, the classes are not found by 
`isClass` and `extends` when these are called in .onLoad, but are 
correctly found when called in .onAttach.
However findClass correctly finds the class in both case, as well as 
isClass if it is called with the argument 
`where=asNamespace('<THE.PACKAGE.NAME>')`.
When the package is loaded from an open R session, the behaviour is the 
same.

in R 2.12.1:
the classes are correctly found by isClass and extends when these are 
called in .onLoad or .onAttach, but only at installation (i.e. at the 
loading check after R CMD INSTALL).
When the package is loaded from an open R session, one fails to find the 
classes only in .onLoad while in .onAttach they are correctly found.

This is really an issue as up to now I was using .onAttach to do my 
checks and initialization, but it is not a wise thing as package that 
would only need to import my package (load and not attach) will not get 
internal objects properly initialized. All this should be done in 
.onLoad, but I cannot do it due to this behaviour of `extends`.

Can someone provide some explanations or work around.

Thank you,
Renaud


############
# script.R
############

setClass('A', representation(data='numeric'))

setClass('B', contain='A')

check.classes <- function(){

a <- new('A')
b <- new('B')

message("isClass('A'): ", methods::isClass('A'))
message("isClass('A') in namespace: ", methods::isClass('A', 
where=asNamespace('anRpackage')))
message("findClass('A'): ")
print(methods::findClass('A'))

message("isClass('B'): ", methods::isClass('B'))
message("isClass('B') in namespace: ", methods::isClass('B', 
where=asNamespace('anRpackage')))
message("findClass('B'): ")
print(methods::findClass('B'))

message("extends('B', 'A'): ", methods::extends('B', 'A'))
message("is(a, 'A'): ", is(a, 'A'))
message("inherits(a, 'A'): ", inherits(a, 'A'))
message("is(b, 'A'): ", is(b, 'A'))
}

.onLoad <- function(libname, pkgname=NULL){
cat("\n## .onLoad ##\n")
check.classes()
}

.onAttach <- function(libname, pkgname){
cat("\n## .onAttach ##\n")
check.classes()
}
############



################################################
################################################
# Output
################################################
################################################

################################################
# R-2.13.0 CMD INSTALL anRpackage_1.0.tar.gz
################################################

* installing *source* package ?anRpackage? ...
** R
** preparing package for lazy loading
** help
*** installing help indices
** building package indices ...
** testing if installed package can be loaded

## .onLoad ##
isClass('A'): FALSE
isClass('A') in namespace: TRUE
findClass('A'):
[[1]]
<environment: namespace:anRpackage>

isClass('B'): FALSE
isClass('B') in namespace: TRUE
findClass('B'):
[[1]]
<environment: namespace:anRpackage>

extends('B', 'A'): FALSE
is(a, 'A'): TRUE
inherits(a, 'A'): TRUE
is(b, 'A'): TRUE

## .onAttach ##
isClass('A'): TRUE
isClass('A') in namespace: TRUE
findClass('A'):
[[1]]
<environment: namespace:anRpackage>

isClass('B'): TRUE
isClass('B') in namespace: TRUE
findClass('B'):
[[1]]
<environment: namespace:anRpackage>

extends('B', 'A'): TRUE
is(a, 'A'): TRUE
inherits(a, 'A'): TRUE
is(b, 'A'): TRUE

* DONE (anRpackage)


################################################
# From a R-2.12.1 Console
################################################

## .onLoad ##
isClass('A'): FALSE
isClass('A') in namespace: TRUE
findClass('A'):
[[1]]
<environment: namespace:anRpackage>

isClass('B'): FALSE
isClass('B') in namespace: TRUE
findClass('B'):
[[1]]
<environment: namespace:anRpackage>

extends('B', 'A'): FALSE
is(a, 'A'): TRUE
inherits(a, 'A'): TRUE
is(b, 'A'): TRUE

## .onAttach ##
isClass('A'): TRUE
isClass('A') in namespace: TRUE
findClass('A'):
[[1]]
<environment: namespace:anRpackage>

isClass('B'): TRUE
isClass('B') in namespace: TRUE
findClass('B'):
[[1]]
<environment: namespace:anRpackage>

extends('B', 'A'): TRUE
is(a, 'A'): TRUE
inherits(a, 'A'): TRUE
is(b, 'A'): TRUE


################################################
# R-2.12.1 CMD INSTALL anRpackage_1.0.tar.gz
################################################

* installing *source* package ?anRpackage? ...
** R
** preparing package for lazy loading
** help
*** installing help indices
** building package indices ...
** testing if installed package can be loaded

## .onLoad ##
isClass('A'): TRUE
isClass('A') in namespace: TRUE
findClass('A'):
[[1]]
<environment: namespace:anRpackage>

isClass('B'): TRUE
isClass('B') in namespace: TRUE
findClass('B'):
[[1]]
<environment: namespace:anRpackage>

extends('B', 'A'): TRUE
is(a, 'A'): TRUE
inherits(a, 'A'): TRUE
is(b, 'A'): TRUE

## .onAttach ##
isClass('A'): TRUE
isClass('A') in namespace: TRUE
findClass('A'):
[[1]]
<environment: namespace:anRpackage>

isClass('B'): TRUE
isClass('B') in namespace: TRUE
findClass('B'):
[[1]]
<environment: namespace:anRpackage>

extends('B', 'A'): TRUE
is(a, 'A'): TRUE
inherits(a, 'A'): TRUE
is(b, 'A'): TRUE

* DONE (anRpackage)

################################################
# From a R-2.12.1 Console
################################################

## .onLoad ##
isClass('A'): FALSE
isClass('A') in namespace: TRUE
findClass('A'):
[[1]]
<environment: namespace:anRpackage>

isClass('B'): FALSE
isClass('B') in namespace: TRUE
findClass('B'):
[[1]]
<environment: namespace:anRpackage>

extends('B', 'A'): FALSE
is(a, 'A'): TRUE
inherits(a, 'A'): TRUE
is(b, 'A'): TRUE

## .onAttach ##
isClass('A'): TRUE
isClass('A') in namespace: TRUE
findClass('A'):
[[1]]
<environment: namespace:anRpackage>

isClass('B'): TRUE
isClass('B') in namespace: TRUE
findClass('B'):
[[1]]
<environment: namespace:anRpackage>

extends('B', 'A'): TRUE
is(a, 'A'): TRUE
inherits(a, 'A'): TRUE
is(b, 'A'): TRUE





 

###
UNIVERSITY OF CAPE TOWN 

This e-mail is subject to the UCT ICT policies and e-mail disclaimer published on our website at http://www.uct.ac.za/about/policies/emaildisclaimer/ or obtainable from +27 21 650 9111. This e-mail is intended only for the person(s) to whom it is addressed. If the e-mail has reached you in error, please notify the author. If you are not the intended recipient of the e-mail you may not use, disclose, copy, redirect or print the content. If this e-mail is not related to the business of UCT it is sent by the sender in the sender's individual capacity.

###
 

-------------- next part --------------
A non-text attachment was scrubbed...
Name: anRpackage_1.0.tar.gz
Type: application/x-gzip
Size: 1722 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110623/fd2ae106/attachment.gz>

From moshersteven at gmail.com  Thu Jun 23 07:04:39 2011
From: moshersteven at gmail.com (steven mosher)
Date: Wed, 22 Jun 2011 22:04:39 -0700
Subject: [Rd] First package submission to CRAN
In-Reply-To: <4E027FEE.3050707@auckland.ac.nz>
References: <BANLkTinqaRAj8_beryiprZR_-ZVhyPTgUQ@mail.gmail.com>
	<29E8CF0F-7862-4B72-860C-16305EC45CFA@gmail.com>
	<4E027FEE.3050707@auckland.ac.nz>
Message-ID: <BANLkTik_i9aGQ0cGNHhspmaD-7dd1V_H5A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110622/fd2fe109/attachment.pl>

From jmc at r-project.org  Thu Jun 23 18:44:30 2011
From: jmc at r-project.org (John Chambers)
Date: Thu, 23 Jun 2011 09:44:30 -0700
Subject: [Rd] Class not found when search in .onLoad
In-Reply-To: <4E0321DE.2020601@cbio.uct.ac.za>
References: <4E0321DE.2020601@cbio.uct.ac.za>
Message-ID: <4E036D6E.3000509@r-project.org>

The workaround is to use the package's namespace, as you did.  That's 
one of the reasons why pkgname is an argument to .onLoad().

Depending on what you want to do, you can either use the namespace as an 
argument where= or get the class definition from the namespace and use 
it in place of the class name.

A side advantage is that such checks work regardless of whether or not 
the classes, etc. are exported from the package.  Also, on the remote 
chance there is another class of the same name, the check works 
unambiguously on your package's version.

The relevant part of your script, modified accordingly, seems to work as 
desired.

John

############
# script.R
############

setClass('A', representation(data='numeric'))

setClass('B', contains='A') # the argument is contains=

check.classes <- function(where){

message("isClass('A', where = where): ", methods::isClass('A', where = 
where))

message("isClass('B', where = where): ", methods::isClass('B', where = 
where))

classA <- getClass('A', where = where)
classB <- getClass('B', where = where)
message("extends(classB, classA): ", methods::extends(classB, classA))
}

.onLoad <- function(libname, pkgname=NULL){
cat("\n## .onLoad ##\n")
check.classes(asNamespace(pkgname))
}

.onAttach <- function(libname, pkgname){
cat("\n## .onAttach ##\n")
check.classes(asNamespace(pkgname))
}




On 6/23/11 4:22 AM, Renaud Gaujoux wrote:
> Hi,
>
> I am facing with a strange behaviour of isClass and extends when these
> are called in .onLoad in both R 2.12.1 and R 2.13.0. This is preventing
> my package from doing some object initializations at a proper place
> (i.e. in .onLoad).
>
> Suppose one defines two S4 classes in a package, and that one needs to
> check the inheritance between these two when loading the package (e.g.
> to validate slots in objects).
> See package attached or code below (not sure attachments can go through).
>
> in R 2.13.0:
> At the loading check after installation, the classes are not found by
> `isClass` and `extends` when these are called in .onLoad, but are
> correctly found when called in .onAttach.
> However findClass correctly finds the class in both case, as well as
> isClass if it is called with the argument
> `where=asNamespace('<THE.PACKAGE.NAME>')`.
> When the package is loaded from an open R session, the behaviour is the
> same.
>
> in R 2.12.1:
> the classes are correctly found by isClass and extends when these are
> called in .onLoad or .onAttach, but only at installation (i.e. at the
> loading check after R CMD INSTALL).
> When the package is loaded from an open R session, one fails to find the
> classes only in .onLoad while in .onAttach they are correctly found.
>
> This is really an issue as up to now I was using .onAttach to do my
> checks and initialization, but it is not a wise thing as package that
> would only need to import my package (load and not attach) will not get
> internal objects properly initialized. All this should be done in
> .onLoad, but I cannot do it due to this behaviour of `extends`.
>
> Can someone provide some explanations or work around.
>
> Thank you,
> Renaud
>
>
> ############
> # script.R
> ############
>
> setClass('A', representation(data='numeric'))
>
> setClass('B', contain='A')
>
> check.classes <- function(){
>
> a <- new('A')
> b <- new('B')
>
> message("isClass('A'): ", methods::isClass('A'))
> message("isClass('A') in namespace: ", methods::isClass('A',
> where=asNamespace('anRpackage')))
> message("findClass('A'): ")
> print(methods::findClass('A'))
>
> message("isClass('B'): ", methods::isClass('B'))
> message("isClass('B') in namespace: ", methods::isClass('B',
> where=asNamespace('anRpackage')))
> message("findClass('B'): ")
> print(methods::findClass('B'))
>
> message("extends('B', 'A'): ", methods::extends('B', 'A'))
> message("is(a, 'A'): ", is(a, 'A'))
> message("inherits(a, 'A'): ", inherits(a, 'A'))
> message("is(b, 'A'): ", is(b, 'A'))
> }
>
> .onLoad <- function(libname, pkgname=NULL){
> cat("\n## .onLoad ##\n")
> check.classes()
> }
>
> .onAttach <- function(libname, pkgname){
> cat("\n## .onAttach ##\n")
> check.classes()
> }
> ############
>
>
..............
>
> ###
> UNIVERSITY OF CAPE TOWN
> This e-mail is subject to the UCT ICT policies and e-mail disclaimer
> published on our website at
> http://www.uct.ac.za/about/policies/emaildisclaimer/ or obtainable from
> +27 21 650 9111. This e-mail is intended only for the person(s) to whom
> it is addressed. If the e-mail has reached you in error, please notify
> the author. If you are not the intended recipient of the e-mail you may
> not use, disclose, copy, redirect or print the content. If this e-mail
> is not related to the business of UCT it is sent by the sender in the
> sender's individual capacity.
>
> ###
>
>
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From saschaview at gmail.com  Thu Jun 23 19:16:26 2011
From: saschaview at gmail.com (Sascha Vieweg)
Date: Thu, 23 Jun 2011 19:16:26 +0200 (CEST)
Subject: [Rd] First package submission to CRAN
In-Reply-To: <BANLkTinqaRAj8_beryiprZR_-ZVhyPTgUQ@mail.gmail.com>
References: <BANLkTinqaRAj8_beryiprZR_-ZVhyPTgUQ@mail.gmail.com>
Message-ID: <alpine.OSX.2.02.1106231913180.37969@vyvhz>

On 11-06-22 22:12, steven mosher wrote:

> I'm preparing to submit my first package to CRAN, thanks to the 
> help of too many people to mention.

[...]

> My package is pure R with no source from other languages.  My 
> questions are as follows. I've read the docs and just need a bit 
> of clarification.
>
> 1. For submission I should just build source R CMD build mypkg
>    which outputs a tar.gz
>
> 2. Do I have to/ how do I build for 32 bit?

AFAIK there is no need to care about 32/64 bit as long as your 
package is pure R code.

Congrats to your new package!

*S*

-- 
Sascha Vieweg, saschaview at gmail.com


From moshersteven at gmail.com  Thu Jun 23 19:45:17 2011
From: moshersteven at gmail.com (steven mosher)
Date: Thu, 23 Jun 2011 10:45:17 -0700
Subject: [Rd] First package submission to CRAN
In-Reply-To: <alpine.OSX.2.02.1106231913180.37969@vyvhz>
References: <BANLkTinqaRAj8_beryiprZR_-ZVhyPTgUQ@mail.gmail.com>
	<alpine.OSX.2.02.1106231913180.37969@vyvhz>
Message-ID: <BANLkTi=XLafDjYDgzyy59Fk1x2QojpA3Bg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110623/17aa5ca8/attachment.pl>

From stephen.ellison at lgcgroup.com  Fri Jun 24 02:34:35 2011
From: stephen.ellison at lgcgroup.com (Stephen Ellison)
Date: Fri, 24 Jun 2011 01:34:35 +0100
Subject: [Rd] Unexpected email address change - and maybe a missing manual
	patch
Message-ID: <98B156BB22D11342A931E823798D434853E9718185@GOLD.corp.lgc-group.com>

Please forgive the unorthodox posting, but some marketing genius here has decided I need a new corporate email address and has duly changed my outgoing email without adequate notice to amend listserve subscriptions. The result is a lot of unexpected bounces from R-help and R-devel. I'll try to fix that in time, but more importantly a couple of you have been corresponding with me re a proposed patch for a manual. I sent the patch a couple of days back, so if it hasn;t arrived, it's probably got stuck behind a spam trap. If so, please let me know, add the correct address to your spam filter and I'll try again ...


In the mean time I'll try to sort out the resulting listserve subscription mess.


Steve Ellison
LGC
*******************************************************************
This email and any attachments are confidential. Any use...{{dropped:8}}


From renaud at mancala.cbio.uct.ac.za  Fri Jun 24 09:53:26 2011
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Fri, 24 Jun 2011 09:53:26 +0200
Subject: [Rd] Class not found when search in .onLoad
In-Reply-To: <4E036D6E.3000509@r-project.org>
References: <4E0321DE.2020601@cbio.uct.ac.za> <4E036D6E.3000509@r-project.org>
Message-ID: <4E044276.1070002@cbio.uct.ac.za>

Thank you John for your response.

Things are a little bit more complicated though. The inheritance checks 
are not only made in .onLoad, they are part of a class validity method, 
which is called in .onLoad because some objects from this class are 
created at this stage. Such objects can also be created at any moment, 
not in a call from .onLoad.

More or less briefly:
class 'A' is in fact a virtual class defined in the package's namespace, 
with the purpose of defining a common interface. While the package does 
provide some derived classes (i.e. defined within the namespace), users 
too must be able to define derived classes from 'A' (i.e. not defined 
within the namespace).
In another class from the namespace, the validity method checks that one 
of its character slot contains the name of a class that inherits from 
interface 'A'.

I was just expecting `isClass` and `extends` to also work in .onLoad 
without specifying the argument `where` (i.e. searching everywhere, 
starting by the package's namespace if called within a namespace). The 
argument `where` being there to allow finer search.

There is no argument pkgname to the validity method, to directly apply 
the work around. I guess I can always check the presence of the class in 
the some-how hard-coded namespace, and if it is not found there look for 
the class elsewhere:

#...
clref <- getClass('A', .Force=TRUE, where=THE.NAMESPACE)
cl <- getClass(name, .Force=TRUE, where=THE.NAMESPACE)
if( is.null(cl) )
     cl <- getClass(name, .Force=TRUE)

if( !extends(cl, clref) )
     return('invalid slot')
#...

I will use this, in last resort, although it feels strange as it will 
only be to deal with the case where objects are created within a call to 
.onLoad.

I am really interested in understanding why all this:

- what makes this call so different?
In my sample package, if I add a call `check.classes()` directly in 
script.R, the classes are correctly found when the installation sources 
the script prepare the package for lazy loading.
- why things seemed to work ok in R-2.12.1 at the installation loading 
check, but do not work when loading the package from an R session?

Could you please briefly give some explanations or pointers?

Thank you.

Bests,
Renaud

On 23/06/2011 18:44, John Chambers wrote:
> The workaround is to use the package's namespace, as you did.  That's 
> one of the reasons why pkgname is an argument to .onLoad().
>
> Depending on what you want to do, you can either use the namespace as 
> an argument where= or get the class definition from the namespace and 
> use it in place of the class name.
>
> A side advantage is that such checks work regardless of whether or not 
> the classes, etc. are exported from the package.  Also, on the remote 
> chance there is another class of the same name, the check works 
> unambiguously on your package's version.
>
> The relevant part of your script, modified accordingly, seems to work 
> as desired.
>
> John
>
> ############
> # script.R
> ############
>
> setClass('A', representation(data='numeric'))
>
> setClass('B', contains='A') # the argument is contains=
>
> check.classes <- function(where){
>
> message("isClass('A', where = where): ", methods::isClass('A', where = 
> where))
>
> message("isClass('B', where = where): ", methods::isClass('B', where = 
> where))
>
> classA <- getClass('A', where = where)
> classB <- getClass('B', where = where)
> message("extends(classB, classA): ", methods::extends(classB, classA))
> }
>
> .onLoad <- function(libname, pkgname=NULL){
> cat("\n## .onLoad ##\n")
> check.classes(asNamespace(pkgname))
> }
>
> .onAttach <- function(libname, pkgname){
> cat("\n## .onAttach ##\n")
> check.classes(asNamespace(pkgname))
> }
>
>
>
>
> On 6/23/11 4:22 AM, Renaud Gaujoux wrote:
>> Hi,
>>
>> I am facing with a strange behaviour of isClass and extends when these
>> are called in .onLoad in both R 2.12.1 and R 2.13.0. This is preventing
>> my package from doing some object initializations at a proper place
>> (i.e. in .onLoad).
>>
>> Suppose one defines two S4 classes in a package, and that one needs to
>> check the inheritance between these two when loading the package (e.g.
>> to validate slots in objects).
>> See package attached or code below (not sure attachments can go 
>> through).
>>
>> in R 2.13.0:
>> At the loading check after installation, the classes are not found by
>> `isClass` and `extends` when these are called in .onLoad, but are
>> correctly found when called in .onAttach.
>> However findClass correctly finds the class in both case, as well as
>> isClass if it is called with the argument
>> `where=asNamespace('<THE.PACKAGE.NAME>')`.
>> When the package is loaded from an open R session, the behaviour is the
>> same.
>>
>> in R 2.12.1:
>> the classes are correctly found by isClass and extends when these are
>> called in .onLoad or .onAttach, but only at installation (i.e. at the
>> loading check after R CMD INSTALL).
>> When the package is loaded from an open R session, one fails to find the
>> classes only in .onLoad while in .onAttach they are correctly found.
>>
>> This is really an issue as up to now I was using .onAttach to do my
>> checks and initialization, but it is not a wise thing as package that
>> would only need to import my package (load and not attach) will not get
>> internal objects properly initialized. All this should be done in
>> .onLoad, but I cannot do it due to this behaviour of `extends`.
>>
>> Can someone provide some explanations or work around.
>>
>> Thank you,
>> Renaud
>>
>>
>> ############
>> # script.R
>> ############
>>
>> setClass('A', representation(data='numeric'))
>>
>> setClass('B', contain='A')
>>
>> check.classes <- function(){
>>
>> a <- new('A')
>> b <- new('B')
>>
>> message("isClass('A'): ", methods::isClass('A'))
>> message("isClass('A') in namespace: ", methods::isClass('A',
>> where=asNamespace('anRpackage')))
>> message("findClass('A'): ")
>> print(methods::findClass('A'))
>>
>> message("isClass('B'): ", methods::isClass('B'))
>> message("isClass('B') in namespace: ", methods::isClass('B',
>> where=asNamespace('anRpackage')))
>> message("findClass('B'): ")
>> print(methods::findClass('B'))
>>
>> message("extends('B', 'A'): ", methods::extends('B', 'A'))
>> message("is(a, 'A'): ", is(a, 'A'))
>> message("inherits(a, 'A'): ", inherits(a, 'A'))
>> message("is(b, 'A'): ", is(b, 'A'))
>> }
>>
>> .onLoad <- function(libname, pkgname=NULL){
>> cat("\n## .onLoad ##\n")
>> check.classes()
>> }
>>
>> .onAttach <- function(libname, pkgname){
>> cat("\n## .onAttach ##\n")
>> check.classes()
>> }
>> ############
>>
>>
> ..............
>>
>> ###
>> UNIVERSITY OF CAPE TOWN
>> This e-mail is subject to the UCT ICT policies and e-mail disclaimer
>> published on our website at
>> http://www.uct.ac.za/about/policies/emaildisclaimer/ or obtainable from
>> +27 21 650 9111. This e-mail is intended only for the person(s) to whom
>> it is addressed. If the e-mail has reached you in error, please notify
>> the author. If you are not the intended recipient of the e-mail you may
>> not use, disclose, copy, redirect or print the content. If this e-mail
>> is not related to the business of UCT it is sent by the sender in the
>> sender's individual capacity.
>>
>> ###
>>
>>
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel

 

###
UNIVERSITY OF CAPE TOWN 

This e-mail is subject to the UCT ICT policies and e-mai...{{dropped:5}}


From David.Kreil at boku.ac.at  Fri Jun 24 17:03:33 2011
From: David.Kreil at boku.ac.at (Dr. D. P. Kreil (Boku))
Date: Fri, 24 Jun 2011 17:03:33 +0200
Subject: [Rd] Is there an implementation of loess with more than 3
	parametric ...
In-Reply-To: <9C83044E-C107-4F77-AD1D-4042A679C54B@anu.edu.au>
References: <9C83044E-C107-4F77-AD1D-4042A679C54B@anu.edu.au>
Message-ID: <BANLkTikBYNqH5uhf4CzDOcPyQpKTYZZQDA@mail.gmail.com>

Dear John,

> I suggest that you look at the abilities of the mgcv package.
> There are notes of mine at
>
> http://www.maths.anu.edu.au/%7Ejohnm/r-book/xtras/autosmooth.pdf
>
> that may help you get started.

Thank?you very much for the suggestion and the link to your write-up,
it was indeed very helpful!

I have experimented with this library for a while now and am really
happy about its flexibility. For my immediate applied problem, I will
now go with a gam fit ("z~te(x,y)+fa-1").

I note, however, that this is much, much slower than loess, and is
thus limited to smaller numbers of data points. (I could not fit the
full model to 50,000 data points in a reasonable time.)
I am therefore wondering if you knew of a way of also fixing the
implementation of loess in R?

>From the error message (recompile with larger d2MAX) it seems that the
underlying Fortran library was perfectly happy to fit a larger number
of parametric variables. So is there a way one could remove the
restriction to 4 parameters in the R interface/compilation? I have not
found an obvious place where d2MAX is defined or configured, I suspect
it might be hard-coded...

With best regards,
David.


From jmc at r-project.org  Fri Jun 24 22:04:01 2011
From: jmc at r-project.org (John Chambers)
Date: Fri, 24 Jun 2011 13:04:01 -0700
Subject: [Rd] Class not found when search in .onLoad
In-Reply-To: <4E044276.1070002@cbio.uct.ac.za>
References: <4E0321DE.2020601@cbio.uct.ac.za> <4E036D6E.3000509@r-project.org>
	<4E044276.1070002@cbio.uct.ac.za>
Message-ID: <4E04EDB1.70105@r-project.org>

On 6/24/11 12:53 AM, Renaud Gaujoux wrote:
> Thank you John for your response.
>
> Things are a little bit more complicated though. The inheritance checks
> are not only made in .onLoad, they are part of a class validity method,
> which is called in .onLoad because some objects from this class are
> created at this stage. Such objects can also be created at any moment,
> not in a call from .onLoad.
>
> More or less briefly:
> class 'A' is in fact a virtual class defined in the package's namespace,
> with the purpose of defining a common interface. While the package does
> provide some derived classes (i.e. defined within the namespace), users
> too must be able to define derived classes from 'A' (i.e. not defined
> within the namespace).
> In another class from the namespace, the validity method checks that one
> of its character slot contains the name of a class that inherits from
> interface 'A'.

Strictly speaking, that is not meaningful.  A class (like any R object) 
is uniquely referenced by a name *and an environment*.  The name of a 
package can be used to construct the environment, but your "character 
slot" won't identify a class reliably unless the character string has a 
"package" attribute.

Look at class(x), for example, from an object from one of these classes. 
  It will have a "package" attribute identifying the package.
The character string with the package attribute is what you should be 
storing in the slot (or else store the class definition---takes more 
space but is slightly more efficient).

>
> I was just expecting `isClass` and `extends` to also work in .onLoad
> without specifying the argument `where` (i.e. searching everywhere,
> starting by the package's namespace if called within a namespace). The
> argument `where` being there to allow finer search.
>
> There is no argument pkgname to the validity method, to directly apply
> the work around. I guess I can always check the presence of the class in
> the some-how hard-coded namespace, and if it is not found there look for
> the class elsewhere:
>
> #...
> clref <- getClass('A', .Force=TRUE, where=THE.NAMESPACE)
> cl <- getClass(name, .Force=TRUE, where=THE.NAMESPACE)
> if( is.null(cl) )
> cl <- getClass(name, .Force=TRUE)
>
> if( !extends(cl, clref) )
> return('invalid slot')
> #...
>
> I will use this, in last resort, although it feels strange as it will
> only be to deal with the case where objects are created within a call to
> .onLoad.
>
> I am really interested in understanding why all this:
>
> - what makes this call so different?
> In my sample package, if I add a call `check.classes()` directly in
> script.R, the classes are correctly found when the installation sources
> the script prepare the package for lazy loading.
> - why things seemed to work ok in R-2.12.1 at the installation loading
> check, but do not work when loading the package from an R session?
>
> Could you please briefly give some explanations or pointers?
>
> Thank you.
>
> Bests,
> Renaud
>
> On 23/06/2011 18:44, John Chambers wrote:
>> The workaround is to use the package's namespace, as you did. That's
>> one of the reasons why pkgname is an argument to .onLoad().
>>
>> Depending on what you want to do, you can either use the namespace as
>> an argument where= or get the class definition from the namespace and
>> use it in place of the class name.
>>
>> A side advantage is that such checks work regardless of whether or not
>> the classes, etc. are exported from the package. Also, on the remote
>> chance there is another class of the same name, the check works
>> unambiguously on your package's version.
>>
>> The relevant part of your script, modified accordingly, seems to work
>> as desired.
>>
>> John
>>
>> ############
>> # script.R
>> ############
>>
>> setClass('A', representation(data='numeric'))
>>
>> setClass('B', contains='A') # the argument is contains=
>>
>> check.classes <- function(where){
>>
>> message("isClass('A', where = where): ", methods::isClass('A', where =
>> where))
>>
>> message("isClass('B', where = where): ", methods::isClass('B', where =
>> where))
>>
>> classA <- getClass('A', where = where)
>> classB <- getClass('B', where = where)
>> message("extends(classB, classA): ", methods::extends(classB, classA))
>> }
>>
>> .onLoad <- function(libname, pkgname=NULL){
>> cat("\n## .onLoad ##\n")
>> check.classes(asNamespace(pkgname))
>> }
>>
>> .onAttach <- function(libname, pkgname){
>> cat("\n## .onAttach ##\n")
>> check.classes(asNamespace(pkgname))
>> }
>>
>>
>>
>>
>> On 6/23/11 4:22 AM, Renaud Gaujoux wrote:
>>> Hi,
>>>
>>> I am facing with a strange behaviour of isClass and extends when these
>>> are called in .onLoad in both R 2.12.1 and R 2.13.0. This is preventing
>>> my package from doing some object initializations at a proper place
>>> (i.e. in .onLoad).
>>>
>>> Suppose one defines two S4 classes in a package, and that one needs to
>>> check the inheritance between these two when loading the package (e.g.
>>> to validate slots in objects).
>>> See package attached or code below (not sure attachments can go
>>> through).
>>>
>>> in R 2.13.0:
>>> At the loading check after installation, the classes are not found by
>>> `isClass` and `extends` when these are called in .onLoad, but are
>>> correctly found when called in .onAttach.
>>> However findClass correctly finds the class in both case, as well as
>>> isClass if it is called with the argument
>>> `where=asNamespace('<THE.PACKAGE.NAME>')`.
>>> When the package is loaded from an open R session, the behaviour is the
>>> same.
>>>
>>> in R 2.12.1:
>>> the classes are correctly found by isClass and extends when these are
>>> called in .onLoad or .onAttach, but only at installation (i.e. at the
>>> loading check after R CMD INSTALL).
>>> When the package is loaded from an open R session, one fails to find the
>>> classes only in .onLoad while in .onAttach they are correctly found.
>>>
>>> This is really an issue as up to now I was using .onAttach to do my
>>> checks and initialization, but it is not a wise thing as package that
>>> would only need to import my package (load and not attach) will not get
>>> internal objects properly initialized. All this should be done in
>>> .onLoad, but I cannot do it due to this behaviour of `extends`.
>>>
>>> Can someone provide some explanations or work around.
>>>
>>> Thank you,
>>> Renaud
>>>
>>>
>>> ############
>>> # script.R
>>> ############
>>>
>>> setClass('A', representation(data='numeric'))
>>>
>>> setClass('B', contain='A')
>>>
>>> check.classes <- function(){
>>>
>>> a <- new('A')
>>> b <- new('B')
>>>
>>> message("isClass('A'): ", methods::isClass('A'))
>>> message("isClass('A') in namespace: ", methods::isClass('A',
>>> where=asNamespace('anRpackage')))
>>> message("findClass('A'): ")
>>> print(methods::findClass('A'))
>>>
>>> message("isClass('B'): ", methods::isClass('B'))
>>> message("isClass('B') in namespace: ", methods::isClass('B',
>>> where=asNamespace('anRpackage')))
>>> message("findClass('B'): ")
>>> print(methods::findClass('B'))
>>>
>>> message("extends('B', 'A'): ", methods::extends('B', 'A'))
>>> message("is(a, 'A'): ", is(a, 'A'))
>>> message("inherits(a, 'A'): ", inherits(a, 'A'))
>>> message("is(b, 'A'): ", is(b, 'A'))
>>> }
>>>
>>> .onLoad <- function(libname, pkgname=NULL){
>>> cat("\n## .onLoad ##\n")
>>> check.classes()
>>> }
>>>
>>> .onAttach <- function(libname, pkgname){
>>> cat("\n## .onAttach ##\n")
>>> check.classes()
>>> }
>>> ############
>>>
>>>
>> ..............
>>>
>>> ###
>>> UNIVERSITY OF CAPE TOWN
>>> This e-mail is subject to the UCT ICT policies and e-mail disclaimer
>>> published on our website at
>>> http://www.uct.ac.za/about/policies/emaildisclaimer/ or obtainable from
>>> +27 21 650 9111. This e-mail is intended only for the person(s) to whom
>>> it is addressed. If the e-mail has reached you in error, please notify
>>> the author. If you are not the intended recipient of the e-mail you may
>>> not use, disclose, copy, redirect or print the content. If this e-mail
>>> is not related to the business of UCT it is sent by the sender in the
>>> sender's individual capacity.
>>>
>>> ###
>>>
>>>
>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>
> ###
> UNIVERSITY OF CAPE TOWN
> This e-mail is subject to the UCT ICT policies and e-mai...{{dropped:5}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From David.Kreil at boku.ac.at  Sat Jun 25 03:17:37 2011
From: David.Kreil at boku.ac.at (Dr. D. P. Kreil (Boku))
Date: Sat, 25 Jun 2011 03:17:37 +0200
Subject: [Rd] Is there an implementation of loess with more than 3
	parametric ...
In-Reply-To: <D357EA1D-D980-4473-952A-AD68C8755065@anu.edu.au>
References: <9C83044E-C107-4F77-AD1D-4042A679C54B@anu.edu.au>
	<BANLkTikBYNqH5uhf4CzDOcPyQpKTYZZQDA@mail.gmail.com>
	<D357EA1D-D980-4473-952A-AD68C8755065@anu.edu.au>
Message-ID: <BANLkTimEfahK+zqkW7=kusfQO=gdmQ4MLQ@mail.gmail.com>

Dear John,

> With loess, I regret that I cannot help. I have not looked
> into the code. ?I'd not been aware that there was such a
> speed difference. ? Are you sure that you are comparing
> like with like? ?loess does not optimise the choice of 'span',
> whereas (unless you fix it), mgcv does optimise the
> smoothing parameter.

I am aware that mgcv is the much more flexible package, so it is hard
to do a fair comparison but I have run loess in a cross-validation
loop to set the span parameter, and this runs in a few minutes on 50k
data points, while I aborted the gam attempt after several hours.

> You might at some point resubmit your question re the
> loess limitation to 4 parameters to CRAN, now with more
> background information.

Ok, what additional information can I provide that might be helpful?

Many thanks again for
your help and support,

David.


From bajaj141003 at gmail.com  Sat Jun 25 12:20:20 2011
From: bajaj141003 at gmail.com (Nipesh Bajaj)
Date: Sat, 25 Jun 2011 15:50:20 +0530
Subject: [Rd] How to put indentation in Rd documentation?
Message-ID: <BANLkTimRHgY79f+yB++s9edp-it5+94HUA@mail.gmail.com>

Dear all, can somebody please guide me on, if I want to put some
**indentation** in my .Rd documentation then, what is the correct
syntax? I have tried with "\tab" but with that the corresponding HTML
help paged is not openning, saying can not recognize \tab.

Thanks for your help.


From nashjc at uottawa.ca  Sun Jun 26 03:21:58 2011
From: nashjc at uottawa.ca (Prof. John C Nash)
Date: Sat, 25 Jun 2011 21:21:58 -0400
Subject: [Rd] Default values in control list of function
Message-ID: <4E0689B6.6090103@uottawa.ca>

In building a function for a package, I'd like to set the defaults in a control list,

e.g.,

makeg<-function(parameters, eps = 1.0e-7, control=list(showwork=TRUE, rubbish=1.0e+101)){

    etc.
}

This does not provide showwork or rubbish within the function if control() is not fully
specified. Copying others, I've previously set the control defaults within the function
then matched names, and that certainly works. I'm happy to keep using that approach, but
would like to have a pointer to good practice for doing this (I'm prepared to write or
help write a short tutorial if none exists).

I can understand that trying to do the default replacement at a second or greater level
could give problems. A search through the language definition and some googling didn't
show up any obvious warning about this, but I'm sure there are some comments somewhere.
Can anyone suggest some URLs?

One gets used to the nicety of being able to specify defaults and forgets that even R has
some limits.

JN


From ggrothendieck at gmail.com  Sun Jun 26 04:38:35 2011
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 25 Jun 2011 22:38:35 -0400
Subject: [Rd] Default values in control list of function
In-Reply-To: <4E0689B6.6090103@uottawa.ca>
References: <4E0689B6.6090103@uottawa.ca>
Message-ID: <BANLkTimsuvKOOaV+Btzbqp8QuhSHcxe7JA@mail.gmail.com>

On Sat, Jun 25, 2011 at 9:21 PM, Prof. John C Nash <nashjc at uottawa.ca> wrote:
> In building a function for a package, I'd like to set the defaults in a control list,
>
> e.g.,
>
> makeg<-function(parameters, eps = 1.0e-7, control=list(showwork=TRUE, rubbish=1.0e+101)){
>
> ? ?etc.
> }
>
> This does not provide showwork or rubbish within the function if control() is not fully
> specified. Copying others, I've previously set the control defaults within the function
> then matched names, and that certainly works. I'm happy to keep using that approach, but
> would like to have a pointer to good practice for doing this (I'm prepared to write or
> help write a short tutorial if none exists).
>
> I can understand that trying to do the default replacement at a second or greater level
> could give problems. A search through the language definition and some googling didn't
> show up any obvious warning about this, but I'm sure there are some comments somewhere.
> Can anyone suggest some URLs?
>
> One gets used to the nicety of being able to specify defaults and forgets that even R has
> some limits.
>

See ?modifyList



-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From renaud at mancala.cbio.uct.ac.za  Mon Jun 27 09:17:23 2011
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Mon, 27 Jun 2011 09:17:23 +0200
Subject: [Rd] Class not found when search in .onLoad
In-Reply-To: <4E04EDB1.70105@r-project.org>
References: <4E0321DE.2020601@cbio.uct.ac.za> <4E036D6E.3000509@r-project.org>
	<4E044276.1070002@cbio.uct.ac.za> <4E04EDB1.70105@r-project.org>
Message-ID: <4E082E83.3060204@cbio.uct.ac.za>


On 24/06/2011 22:04, John Chambers wrote:
>
> Strictly speaking, that is not meaningful.  A class (like any R 
> object) is uniquely referenced by a name *and an environment*.  The 
> name of a package can be used to construct the environment, but your 
> "character slot" won't identify a class reliably unless the character 
> string has a "package" attribute.
>
> Look at class(x), for example, from an object from one of these 
> classes.  It will have a "package" attribute identifying the package.
> The character string with the package attribute is what you should be 
> storing in the slot (or else store the class definition---takes more 
> space but is slightly more efficient).
>

Thank you for this clarification, I will make my factory method for the 
relevant class add the package attribute to the slot.
Storing the class would require recreating the object if the user makes 
changes in the class definition. These objects are meant to be used when 
developing new algorithms. In this context one expects the user to do 
multiple tries and modifications, and I want to ease the process, by 
using dynamic links to classes (a character slot) rather than static 
links (result of getClass).

However, this does not explain why .onLoad does not find the class while 
.onAttach finds it, does it?
Is .onLoad evaluated outside the namespace environment, while .onAttach 
is evaluated within the namespace?

Thank you.
Renaud

 

###
UNIVERSITY OF CAPE TOWN 

This e-mail is subject to the UCT ICT policies and e-mai...{{dropped:5}}


From simon.urbanek at r-project.org  Mon Jun 27 14:27:41 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 27 Jun 2011 08:27:41 -0400
Subject: [Rd] Class not found when search in .onLoad
In-Reply-To: <4E082E83.3060204@cbio.uct.ac.za>
References: <4E0321DE.2020601@cbio.uct.ac.za> <4E036D6E.3000509@r-project.org>
	<4E044276.1070002@cbio.uct.ac.za> <4E04EDB1.70105@r-project.org>
	<4E082E83.3060204@cbio.uct.ac.za>
Message-ID: <A0A00B86-D685-443A-9CF2-AFBA7F260940@r-project.org>

On Jun 27, 2011, at 3:17 AM, Renaud Gaujoux wrote:

> 
> On 24/06/2011 22:04, John Chambers wrote:
>> 
>> Strictly speaking, that is not meaningful.  A class (like any R object) is uniquely referenced by a name *and an environment*.  The name of a package can be used to construct the environment, but your "character slot" won't identify a class reliably unless the character string has a "package" attribute.
>> 
>> Look at class(x), for example, from an object from one of these classes.  It will have a "package" attribute identifying the package.
>> The character string with the package attribute is what you should be storing in the slot (or else store the class definition---takes more space but is slightly more efficient).
>> 
> 
> Thank you for this clarification, I will make my factory method for the relevant class add the package attribute to the slot.
> Storing the class would require recreating the object if the user makes changes in the class definition. These objects are meant to be used when developing new algorithms. In this context one expects the user to do multiple tries and modifications, and I want to ease the process, by using dynamic links to classes (a character slot) rather than static links (result of getClass).
> 
> However, this does not explain why .onLoad does not find the class while .onAttach finds it, does it?
> Is .onLoad evaluated outside the namespace environment, while .onAttach is evaluated within the namespace?
> 

Look at the default of where - it is the top environment, not the evaluated one, and in .onLoad the namespace is not attached yet while it is in .onAttach.

Cheers,
S

Possibly @John: it's a bit puzzling that isClass has a default for where yet it is entirely ignored as getClassDef is called without where. If anyone changes the default in getDeffClass() then isClass signature will be misleading - is there a practical reason for this construct? Thanks, S.

From renaud at mancala.cbio.uct.ac.za  Mon Jun 27 14:43:05 2011
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Mon, 27 Jun 2011 14:43:05 +0200
Subject: [Rd] Class not found when search in .onLoad
In-Reply-To: <A0A00B86-D685-443A-9CF2-AFBA7F260940@r-project.org>
References: <4E0321DE.2020601@cbio.uct.ac.za> <4E036D6E.3000509@r-project.org>
	<4E044276.1070002@cbio.uct.ac.za> <4E04EDB1.70105@r-project.org>
	<4E082E83.3060204@cbio.uct.ac.za>
	<A0A00B86-D685-443A-9CF2-AFBA7F260940@r-project.org>
Message-ID: <4E087AD9.4010206@cbio.uct.ac.za>


On 27/06/2011 14:27, Simon Urbanek wrote:
> On Jun 27, 2011, at 3:17 AM, Renaud Gaujoux wrote:
>
>> On 24/06/2011 22:04, John Chambers wrote:
>>> Strictly speaking, that is not meaningful.  A class (like any R object) is uniquely referenced by a name *and an environment*.  The name of a package can be used to construct the environment, but your "character slot" won't identify a class reliably unless the character string has a "package" attribute.
>>>
>>> Look at class(x), for example, from an object from one of these classes.  It will have a "package" attribute identifying the package.
>>> The character string with the package attribute is what you should be storing in the slot (or else store the class definition---takes more space but is slightly more efficient).
>>>
>> Thank you for this clarification, I will make my factory method for the relevant class add the package attribute to the slot.
>> Storing the class would require recreating the object if the user makes changes in the class definition. These objects are meant to be used when developing new algorithms. In this context one expects the user to do multiple tries and modifications, and I want to ease the process, by using dynamic links to classes (a character slot) rather than static links (result of getClass).
>>
>> However, this does not explain why .onLoad does not find the class while .onAttach finds it, does it?
>> Is .onLoad evaluated outside the namespace environment, while .onAttach is evaluated within the namespace?
>>
> Look at the default of where - it is the top environment, not the evaluated one, and in .onLoad the namespace is not attached yet while it is in .onAttach.
Ok, but .onLoad is defined in the source of the package (i.e. within the 
package's namespace, am I correct?).
So from what I get from the docs (copy/pasted below), isn't the 
top-environment supposed to be the package's namepsace, even if the 
package is not yet attached, and its namepace not yet in the search path?

from ?isClass
" where: The environment in which to modify or remove the definition.
Defaults to the top-level environment of the calling function
(the global environment for ordinary computations, but the
environment or name space of a package in the source for a
package).

When searching for class definitions, ?where? defines where
to do the search, and the default is to search from the
top-level environment or name space of the caller to this
function."

from ?topenv
"?topenv? returns the first top level environment found when
searching ?envir? and its enclosing environments. An environment
is considered top level if it is the internal environment of a
name space, a package environment in the search path, or
?.GlobalEnv?."

> Cheers,
> S
>
> Possibly @John: it's a bit puzzling that isClass has a default for where yet it is entirely ignored as getClassDef is called without where. If anyone changes the default in getDeffClass() then isClass signature will be misleading - is there a practical reason for this construct? Thanks, S.

 

###
UNIVERSITY OF CAPE TOWN 

This e-mail is subject to the UCT ICT policies and e-mai...{{dropped:5}}


From simon.urbanek at r-project.org  Mon Jun 27 15:38:27 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 27 Jun 2011 09:38:27 -0400
Subject: [Rd] Class not found when search in .onLoad
In-Reply-To: <4E087AD9.4010206@cbio.uct.ac.za>
References: <4E0321DE.2020601@cbio.uct.ac.za> <4E036D6E.3000509@r-project.org>
	<4E044276.1070002@cbio.uct.ac.za> <4E04EDB1.70105@r-project.org>
	<4E082E83.3060204@cbio.uct.ac.za>
	<A0A00B86-D685-443A-9CF2-AFBA7F260940@r-project.org>
	<4E087AD9.4010206@cbio.uct.ac.za>
Message-ID: <52F232CF-8D74-4854-B6F5-C2CBB439FF2C@r-project.org>


On Jun 27, 2011, at 8:43 AM, Renaud Gaujoux wrote:

> 
> On 27/06/2011 14:27, Simon Urbanek wrote:
>> On Jun 27, 2011, at 3:17 AM, Renaud Gaujoux wrote:
>> 
>>> On 24/06/2011 22:04, John Chambers wrote:
>>>> Strictly speaking, that is not meaningful.  A class (like any R object) is uniquely referenced by a name *and an environment*.  The name of a package can be used to construct the environment, but your "character slot" won't identify a class reliably unless the character string has a "package" attribute.
>>>> 
>>>> Look at class(x), for example, from an object from one of these classes.  It will have a "package" attribute identifying the package.
>>>> The character string with the package attribute is what you should be storing in the slot (or else store the class definition---takes more space but is slightly more efficient).
>>>> 
>>> Thank you for this clarification, I will make my factory method for the relevant class add the package attribute to the slot.
>>> Storing the class would require recreating the object if the user makes changes in the class definition. These objects are meant to be used when developing new algorithms. In this context one expects the user to do multiple tries and modifications, and I want to ease the process, by using dynamic links to classes (a character slot) rather than static links (result of getClass).
>>> 
>>> However, this does not explain why .onLoad does not find the class while .onAttach finds it, does it?
>>> Is .onLoad evaluated outside the namespace environment, while .onAttach is evaluated within the namespace?
>>> 
>> Look at the default of where - it is the top environment, not the evaluated one, and in .onLoad the namespace is not attached yet while it is in .onAttach.
> Ok, but .onLoad is defined in the source of the package (i.e. within the package's namespace, am I correct?).
> So from what I get from the docs (copy/pasted below), isn't the top-environment supposed to be the package's namepsace, even if the package is not yet attached, and its namepace not yet in the search path?
> 

Not in this case, because where is the methods namespace (see the bottom of my last e-mail - where is not evaluated in environment of your package but in methods due to the default being removed by isClass). I would say this is a bug - changing isClass to the trivial

isClass <- function(Class, formal=TRUE, where = topenv(parent.frame())) !is.null(getClassDef(Class, where))

has the desired effect.

Cheers,
Simon


> from ?isClass
> " where: The environment in which to modify or remove the definition.
> Defaults to the top-level environment of the calling function
> (the global environment for ordinary computations, but the
> environment or name space of a package in the source for a
> package).
> 
> When searching for class definitions, ?where? defines where
> to do the search, and the default is to search from the
> top-level environment or name space of the caller to this
> function."
> 
> from ?topenv
> "?topenv? returns the first top level environment found when
> searching ?envir? and its enclosing environments. An environment
> is considered top level if it is the internal environment of a
> name space, a package environment in the search path, or
> ?.GlobalEnv?."
> 
>> Cheers,
>> S
>> 
>> Possibly @John: it's a bit puzzling that isClass has a default for where yet it is entirely ignored as getClassDef is called without where. If anyone changes the default in getDeffClass() then isClass signature will be misleading - is there a practical reason for this construct? Thanks, S.
> 
> 
> ###
> UNIVERSITY OF CAPE TOWN 
> This e-mail is subject to the UCT ICT policies and e-mail disclaimer published on our website at http://www.uct.ac.za/about/policies/emaildisclaimer/ or obtainable from +27 21 650 9111. This e-mail is intended only for the person(s) to whom it is addressed. If the e-mail has reached you in error, please notify the author. If you are not the intended recipient of the e-mail you may not use, disclose, copy, redirect or print the content. If this e-mail is not related to the business of UCT it is sent by the sender in the sender's individual capacity.
> 
> ###
> 
> 


From renaud at mancala.cbio.uct.ac.za  Mon Jun 27 16:04:14 2011
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Mon, 27 Jun 2011 16:04:14 +0200
Subject: [Rd] Class not found when search in .onLoad
In-Reply-To: <52F232CF-8D74-4854-B6F5-C2CBB439FF2C@r-project.org>
References: <4E0321DE.2020601@cbio.uct.ac.za> <4E036D6E.3000509@r-project.org>
	<4E044276.1070002@cbio.uct.ac.za> <4E04EDB1.70105@r-project.org>
	<4E082E83.3060204@cbio.uct.ac.za>
	<A0A00B86-D685-443A-9CF2-AFBA7F260940@r-project.org>
	<4E087AD9.4010206@cbio.uct.ac.za>
	<52F232CF-8D74-4854-B6F5-C2CBB439FF2C@r-project.org>
Message-ID: <4E088DDE.7050707@cbio.uct.ac.za>

All is clear now.
Thank you for this clarification.

Cheers,
Renaud

On 27/06/2011 15:38, Simon Urbanek wrote:
> On Jun 27, 2011, at 8:43 AM, Renaud Gaujoux wrote:
>
>> On 27/06/2011 14:27, Simon Urbanek wrote:
>>> On Jun 27, 2011, at 3:17 AM, Renaud Gaujoux wrote:
>>>
>>>> On 24/06/2011 22:04, John Chambers wrote:
>>>>> Strictly speaking, that is not meaningful.  A class (like any R object) is uniquely referenced by a name *and an environment*.  The name of a package can be used to construct the environment, but your "character slot" won't identify a class reliably unless the character string has a "package" attribute.
>>>>>
>>>>> Look at class(x), for example, from an object from one of these classes.  It will have a "package" attribute identifying the package.
>>>>> The character string with the package attribute is what you should be storing in the slot (or else store the class definition---takes more space but is slightly more efficient).
>>>>>
>>>> Thank you for this clarification, I will make my factory method for the relevant class add the package attribute to the slot.
>>>> Storing the class would require recreating the object if the user makes changes in the class definition. These objects are meant to be used when developing new algorithms. In this context one expects the user to do multiple tries and modifications, and I want to ease the process, by using dynamic links to classes (a character slot) rather than static links (result of getClass).
>>>>
>>>> However, this does not explain why .onLoad does not find the class while .onAttach finds it, does it?
>>>> Is .onLoad evaluated outside the namespace environment, while .onAttach is evaluated within the namespace?
>>>>
>>> Look at the default of where - it is the top environment, not the evaluated one, and in .onLoad the namespace is not attached yet while it is in .onAttach.
>> Ok, but .onLoad is defined in the source of the package (i.e. within the package's namespace, am I correct?).
>> So from what I get from the docs (copy/pasted below), isn't the top-environment supposed to be the package's namepsace, even if the package is not yet attached, and its namepace not yet in the search path?
>>
> Not in this case, because where is the methods namespace (see the bottom of my last e-mail - where is not evaluated in environment of your package but in methods due to the default being removed by isClass). I would say this is a bug - changing isClass to the trivial
>
> isClass<- function(Class, formal=TRUE, where = topenv(parent.frame())) !is.null(getClassDef(Class, where))
>
> has the desired effect.
>
> Cheers,
> Simon
>
>
>> from ?isClass
>> " where: The environment in which to modify or remove the definition.
>> Defaults to the top-level environment of the calling function
>> (the global environment for ordinary computations, but the
>> environment or name space of a package in the source for a
>> package).
>>
>> When searching for class definitions, ?where? defines where
>> to do the search, and the default is to search from the
>> top-level environment or name space of the caller to this
>> function."
>>
>> from ?topenv
>> "?topenv? returns the first top level environment found when
>> searching ?envir? and its enclosing environments. An environment
>> is considered top level if it is the internal environment of a
>> name space, a package environment in the search path, or
>> ?.GlobalEnv?."
>>
>>> Cheers,
>>> S
>>>
>>> Possibly @John: it's a bit puzzling that isClass has a default for where yet it is entirely ignored as getClassDef is called without where. If anyone changes the default in getDeffClass() then isClass signature will be misleading - is there a practical reason for this construct? Thanks, S.
>>
>> ###
>> UNIVERSITY OF CAPE TOWN
>> This e-mail is subject to the UCT ICT policies and e-mail disclaimer published on our website at http://www.uct.ac.za/about/policies/emaildisclaimer/ or obtainable from +27 21 650 9111. This e-mail is intended only for the person(s) to whom it is addressed. If the e-mail has reached you in error, please notify the author. If you are not the intended recipient of the e-mail you may not use, disclose, copy, redirect or print the content. If this e-mail is not related to the business of UCT it is sent by the sender in the sender's individual capacity.
>>
>> ###
>>
>>

 

###
UNIVERSITY OF CAPE TOWN 

This e-mail is subject to the UCT ICT policies and e-mai...{{dropped:5}}


From bbolker at gmail.com  Mon Jun 27 17:19:55 2011
From: bbolker at gmail.com (Ben Bolker)
Date: Mon, 27 Jun 2011 15:19:55 +0000
Subject: [Rd]
	=?utf-8?q?Is_there_an_implementation_of_loess_with_more_than?=
	=?utf-8?b?IDMJcGFyYW1ldHJpYyAuLi4=?=
References: <9C83044E-C107-4F77-AD1D-4042A679C54B@anu.edu.au>
	<BANLkTikBYNqH5uhf4CzDOcPyQpKTYZZQDA@mail.gmail.com>
Message-ID: <loom.20110627T171349-521@post.gmane.org>

Dr. D. P. Kreil (Boku <David.Kreil <at> boku.ac.at> writes:

> 
> Dear John,
> 
> > I suggest that you look at the abilities of the mgcv package.
> > There are notes of mine at
> >
> > http://www.maths.anu.edu.au/%7Ejohnm/r-book/xtras/autosmooth.pdf
> >
> > that may help you get started.
> 
> Thank?you very much for the suggestion and the link to your write-up,
> it was indeed very helpful!
> 
> I have experimented with this library for a while now and am really
> happy about its flexibility. For my immediate applied problem, I will
> now go with a gam fit ("z~te(x,y)+fa-1").
> 
> I note, however, that this is much, much slower than loess, and is
> thus limited to smaller numbers of data points. (I could not fit the
> full model to 50,000 data points in a reasonable time.)
> I am therefore wondering if you knew of a way of also fixing the
> implementation of loess in R?
> 
> >From the error message (recompile with larger d2MAX) it seems that the
> underlying Fortran library was perfectly happy to fit a larger number
> of parametric variables. So is there a way one could remove the
> restriction to 4 parameters in the R interface/compilation? I have not
> found an obvious place where d2MAX is defined or configured, I suspect
> it might be hard-coded...
> 

  If you go looking for d2MAX in the R code (i.e. download the entire
source or get a copy of the SVN tree) you will proceed as follows:

 find . -name "*.c" -exec grep -l d2MAX {} \;


takes you to ./src/library/stats/src/loessc.c

Looking therein finds:

 case 105:MSG("k>d2MAX in ehg136.  Need to recompile with increased dimensions.")

  grep 105 *.f finds loessf.f

within which we find two lines (1240 and 1361)

      if(k .gt. 15)   call ehg182(105)

Searching for "15" then finds a *lot* of places where "15" is 
hardcoded in the file.

 To modify the file you could either blindly change all the hard-coded
"15" dimensions to something larger and hope that it worked (i.e., use
a good test suite to make sure you didn't screw something up) or dig
through the code and understand it in detail to know what should
be changed ...


From hpages at fhcrc.org  Tue Jun 28 01:31:58 2011
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Mon, 27 Jun 2011 16:31:58 -0700
Subject: [Rd] R CMD check --force-multiarch does not install all the archs
 for testing
Message-ID: <4E0912EE.7020105@fhcrc.org>

Hi,

Why isn't 'R CMD check --force-multiarch' installing the package
for all the architectures that are going to be checked?
For some packages, it only installs for the default arch ('i386').
Then testing the package for 'x64' fails.

For example,

Output of R CMD check --force-multiarch fabia_1.5.0.tar.gz:
-----------------------------------------------------------
* using log directory 'D:/biocbld/bbs-2.9-bioc/meat/fabia.Rcheck'
* using R version 2.14.0 Under development (unstable) (2011-05-30 r56020)
* using platform: i386-pc-mingw32 (32-bit)
* using session charset: ISO8859-1
* using option '--no-vignettes'
* checking for file 'fabia/DESCRIPTION' ... OK
* this is package 'fabia' version '1.5.0'
* checking package name space information ... OK
* checking package dependencies ... OK
* checking if this is a source package ... OK
* checking whether package 'fabia' can be installed ... OK
* checking installed package size ... OK
* checking package directory ... OK
* checking for portable file names ... OK
* checking DESCRIPTION meta-information ... OK
* checking top-level files ... OK
* checking index information ... OK
* checking package subdirectories ... OK
* checking R files for non-ASCII characters ... OK
* checking R files for syntax errors ... OK
* loading checks for arch 'i386'
** checking whether the package can be loaded ... OK
** checking whether the package can be loaded with stated dependencies 
... OK
** checking whether the package can be unloaded cleanly ... OK
** checking whether the name space can be loaded with stated 
dependencies ... OK
** checking whether the name space can be unloaded cleanly ... OK
* loading checks for arch 'x64'
** checking whether the package can be loaded ...Warning: running 
command '"D:/biocbld/bbs-2.9-bioc/R/bin/x64/Rterm.exe" 
R_ENVIRON_USER='no_such_file' --no-site-file --no-init-file --no-save 
--no-restore --slave -f 
D:\biocbld\bbs-2.9-bioc\tmpdir\RtmpO65p5H\Rin57456988' had status 1
  ERROR
Error: package 'fabia' is not installed for 'arch=x64'
Execution halted

It looks like this package has a loading problem: see the messages for
details.

Content of fabia.Rcheck\00install.out:
--------------------------------------

* installing *source* package 'fabia' ...
Building libRcpp.a in RcppSrc...
rm -f Rcpp.o  libRcpp.a
g++  -c Rcpp.cpp -o Rcpp.o -I"D:/biocbld/BBS-2?1.9-B/R/include" 
-I"D:/biocbld/BBS-2?1.9-B/R/src/include"  -Wall -O2
ar r libRcpp.a Rcpp.o
C:\Rtools213\MinGW\bin\ar.exe: creating libRcpp.a
ranlib  libRcpp.a
rm -f Rcpp.o
rm -f Rcpp.o
** libs
   running src/Makefile.win ...
rm -f fabia.o fabia.dll *.a *.o *.so *.dll
g++  -c fabiac.cpp -o fabia.o -I../RcppSrc 
-I"D:/biocbld/BBS-2?1.9-B/R/include" -Wall -O2
g++  -shared -s -static-libgcc fabia.o -L../RcppSrc -lRcpp 
-L"D:/biocbld/BBS-2?1.9-B/R/bin/i386"  -lR  -o fabia.dll
rm -f fabia.o *.a *.o *.so
installing to D:/biocbld/bbs-2.9-bioc/meat/fabia.Rcheck/fabia/libs/i386
** R
** demo
** inst
** preparing package for lazy loading
Creating a generic function for "plot" from package "graphics" in 
package "fabia"
** help
*** installing help indices
** building package indices ...
*** tangling vignette sources ...
    'fabia.Rnw'
** testing if installed package can be loaded

* DONE (fabia)

The source tarball for this package is available here:
   http://bioconductor.org/packages/2.9/bioc/html/fabia.html

What command should be used to perform a multiarch check of this
package?

This is on a 64-bit Windows Server 2008 R2 Enterprise machine using a
recent combined Windows 32/64 bit binary of R-devel from CRAN.

Thanks!
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From ligges at statistik.tu-dortmund.de  Tue Jun 28 10:44:40 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Tue, 28 Jun 2011 10:44:40 +0200
Subject: [Rd] R CMD check --force-multiarch does not install all the
 archs for testing
In-Reply-To: <4E0912EE.7020105@fhcrc.org>
References: <4E0912EE.7020105@fhcrc.org>
Message-ID: <4E099478.4030609@statistik.tu-dortmund.de>



On 28.06.2011 01:31, Herv? Pag?s wrote:
> Hi,
>
> Why isn't 'R CMD check --force-multiarch' installing the package
> for all the architectures that are going to be checked?

Herv?,

no, since it cannot know that that you need

--merge-multiarch

as an additional install flag for this particular package.

You will have to check it in repository maintainer's mode (as the CRAN 
maintainers do everywhere). Essentially this is for me (when also 
producing WIndows binaries):


Step 1: Installation

R CMD INSTALL --pkglock --compact-docs --build --merge-multiarch 
--library="D:/path/to/library" fabia_1.5.0.tar.gz > fabia-install.out 2>&1

(where the merge-multiarch part applies only to this package, of course)



Step 2: Check (without installation, since that happened before already, 
using the install log from step 1)

R CMD check --library="D:/path/to/library" --force-multiarch 
--install="check:fabia-install.out" fabia

Best wishes,
Uwe








> For some packages, it only installs for the default arch ('i386').
> Then testing the package for 'x64' fails.
>
> For example,
>
> Output of R CMD check --force-multiarch fabia_1.5.0.tar.gz:
> -----------------------------------------------------------
> * using log directory 'D:/biocbld/bbs-2.9-bioc/meat/fabia.Rcheck'
> * using R version 2.14.0 Under development (unstable) (2011-05-30 r56020)
> * using platform: i386-pc-mingw32 (32-bit)
> * using session charset: ISO8859-1
> * using option '--no-vignettes'
> * checking for file 'fabia/DESCRIPTION' ... OK
> * this is package 'fabia' version '1.5.0'
> * checking package name space information ... OK
> * checking package dependencies ... OK
> * checking if this is a source package ... OK
> * checking whether package 'fabia' can be installed ... OK
> * checking installed package size ... OK
> * checking package directory ... OK
> * checking for portable file names ... OK
> * checking DESCRIPTION meta-information ... OK
> * checking top-level files ... OK
> * checking index information ... OK
> * checking package subdirectories ... OK
> * checking R files for non-ASCII characters ... OK
> * checking R files for syntax errors ... OK
> * loading checks for arch 'i386'
> ** checking whether the package can be loaded ... OK
> ** checking whether the package can be loaded with stated dependencies
> ... OK
> ** checking whether the package can be unloaded cleanly ... OK
> ** checking whether the name space can be loaded with stated
> dependencies ... OK
> ** checking whether the name space can be unloaded cleanly ... OK
> * loading checks for arch 'x64'
> ** checking whether the package can be loaded ...Warning: running
> command '"D:/biocbld/bbs-2.9-bioc/R/bin/x64/Rterm.exe"
> R_ENVIRON_USER='no_such_file' --no-site-file --no-init-file --no-save
> --no-restore --slave -f
> D:\biocbld\bbs-2.9-bioc\tmpdir\RtmpO65p5H\Rin57456988' had status 1
> ERROR
> Error: package 'fabia' is not installed for 'arch=x64'
> Execution halted
>
> It looks like this package has a loading problem: see the messages for
> details.
>
> Content of fabia.Rcheck\00install.out:
> --------------------------------------
>
> * installing *source* package 'fabia' ...
> Building libRcpp.a in RcppSrc...
> rm -f Rcpp.o libRcpp.a
> g++ -c Rcpp.cpp -o Rcpp.o -I"D:/biocbld/BBS-2?1.9-B/R/include"
> -I"D:/biocbld/BBS-2?1.9-B/R/src/include" -Wall -O2
> ar r libRcpp.a Rcpp.o
> C:\Rtools213\MinGW\bin\ar.exe: creating libRcpp.a
> ranlib libRcpp.a
> rm -f Rcpp.o
> rm -f Rcpp.o
> ** libs
> running src/Makefile.win ...
> rm -f fabia.o fabia.dll *.a *.o *.so *.dll
> g++ -c fabiac.cpp -o fabia.o -I../RcppSrc
> -I"D:/biocbld/BBS-2?1.9-B/R/include" -Wall -O2
> g++ -shared -s -static-libgcc fabia.o -L../RcppSrc -lRcpp
> -L"D:/biocbld/BBS-2?1.9-B/R/bin/i386" -lR -o fabia.dll
> rm -f fabia.o *.a *.o *.so
> installing to D:/biocbld/bbs-2.9-bioc/meat/fabia.Rcheck/fabia/libs/i386
> ** R
> ** demo
> ** inst
> ** preparing package for lazy loading
> Creating a generic function for "plot" from package "graphics" in
> package "fabia"
> ** help
> *** installing help indices
> ** building package indices ...
> *** tangling vignette sources ...
> 'fabia.Rnw'
> ** testing if installed package can be loaded
>
> * DONE (fabia)
>
> The source tarball for this package is available here:
> http://bioconductor.org/packages/2.9/bioc/html/fabia.html
>
> What command should be used to perform a multiarch check of this
> package?
>
> This is on a 64-bit Windows Server 2008 R2 Enterprise machine using a
> recent combined Windows 32/64 bit binary of R-devel from CRAN.
>
> Thanks!
> H.
>


From Roger.Bivand at nhh.no  Tue Jun 28 11:35:37 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 28 Jun 2011 11:35:37 +0200 (CEST)
Subject: [Rd] R CMD check --configure-args?
Message-ID: <alpine.LRH.2.00.1106281129130.3637@reclus.nhh.no>

R CMD INSTALL takes a --configure-args argument, but I cannot see how to 
pass the same values in R CMD check, which returns a:

Warning: unknown option ?--configure-args=...

(R 2.13.0). What am I missing?

Roger

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From renaud at mancala.cbio.uct.ac.za  Tue Jun 28 11:58:05 2011
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Tue, 28 Jun 2011 11:58:05 +0200
Subject: [Rd] doMC - compiler - concatenate an expression vector into a
 single expression?
Message-ID: <4E09A5AD.5020209@cbio.uct.ac.za>

Hi,

this post is about foreach operators, the compiler package and the last 
update of doMC that includes support for the compiler functionality.

I am using a home-made %dopar%-like operator that adds some custom 
expression to be executed before the foreach loop expression itself (see 
sample code below).
It used to work perfectly with doMC 1.2.1, but with the introduction of 
the compiler functionality, things do not work properly.
The change in the doMC package consists in evaluating a compiled 
expression instead of the original R expression:

# from doMC:::doMC ...
c.expr <- comp(expr, env = envir, options = list(suppressUndefined = TRUE))

and for R >= 2.13.0 comp is defined as compiler::compile:
function (e, env = .GlobalEnv, options = NULL)
{
     cenv <- makeCenv(env)
     cntxt <- make.toplevelContext(cenv, options)
     cntxt$env <- addCenvVars(cenv, findLocals(e, cntxt))
     genCode(e, cntxt)
}
<environment: namespace:compiler>

My guess is that the function findLocals or genCode can not handle a 
2-length expression vector.

Maybe somebody who knows the internals of these functions could explain 
better this behaviour?
How can I concatenate two expressions into a single one?

Thank you,
Renaud


##################################################
# Sample code
##################################################

`%dopar2%` <- function(obj, ex){

     # append custom code to the expression
     ex <- c(expression({ a <- i; message("Custom ", a);}), substitute(ex))

     # call the standard %dopar% operator
     do.call(`%dopar%`, list(obj, ex), envir=parent.frame() )
}
res <- foreach(i=1:3) %dopar2% { print(i); i*2; }
res


#########################
# Output with doSEQ or doMC 1.2.1
#########################
Custom 1
[1] 1
Custom 2
[1] 2
Custom 3
[1] 3
 > res
[[1]]
[1] 2

[[2]]
[1] 4

[[3]]
[1] 6


#########################
# Output with doMC 1.2.2
#########################

[[1]]
expression({
     a <- i
     message("Custom ", a)
}, {
     print(i)
     i * 2
})

[[2]]
expression({
     a <- i
     message("Custom ", a)
}, {
     print(i)
     i * 2
})

[[3]]
expression({
     a <- i
     message("Custom ", a)
}, {
     print(i)
     i * 2
})



-- 
Renaud Gaujoux
Computational Biology - University of Cape Town
South Africa


 

###
UNIVERSITY OF CAPE TOWN 

This e-mail is subject to the UCT ICT policies and e-mai...{{dropped:5}}


From ligges at statistik.tu-dortmund.de  Tue Jun 28 12:10:16 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Tue, 28 Jun 2011 12:10:16 +0200
Subject: [Rd] R CMD check --configure-args?
In-Reply-To: <alpine.LRH.2.00.1106281129130.3637@reclus.nhh.no>
References: <alpine.LRH.2.00.1106281129130.3637@reclus.nhh.no>
Message-ID: <4E09A888.7050407@statistik.tu-dortmund.de>



On 28.06.2011 11:35, Roger Bivand wrote:
> R CMD INSTALL takes a --configure-args argument, but I cannot see how to
> pass the same values in R CMD check, which returns a:
>
> Warning: unknown option ?--configure-args=...
>
> (R 2.13.0). What am I missing?


Untested: Can't you pass it via --install-args=.... ?

Uwe


> Roger
>
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From Roger.Bivand at nhh.no  Tue Jun 28 12:13:40 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 28 Jun 2011 12:13:40 +0200 (CEST)
Subject: [Rd] R CMD check --configure-args?
In-Reply-To: <4E09A888.7050407@statistik.tu-dortmund.de>
References: <alpine.LRH.2.00.1106281129130.3637@reclus.nhh.no>
	<4E09A888.7050407@statistik.tu-dortmund.de>
Message-ID: <alpine.LRH.2.00.1106281213140.3637@reclus.nhh.no>

On Tue, 28 Jun 2011, Uwe Ligges wrote:

>
>
> On 28.06.2011 11:35, Roger Bivand wrote:
>> R CMD INSTALL takes a --configure-args argument, but I cannot see how to
>> pass the same values in R CMD check, which returns a:
>> 
>> Warning: unknown option ?--configure-args=...
>> 
>> (R 2.13.0). What am I missing?
>
>
> Untested: Can't you pass it via --install-args=.... ?

Yes, I see it now, thanks very much!

Roger

>
> Uwe
>
>
>> Roger
>> 
>> 
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From ZHOU at email.chop.edu  Mon Jun 27 16:37:38 2011
From: ZHOU at email.chop.edu (Zhou, Hong)
Date: Mon, 27 Jun 2011 10:37:38 -0400
Subject: [Rd] Download R package on HP-UX ia64 Server
Message-ID: <DC66636A8EC9744C8B8588DAE774DCD82877392B09@EX7CCRPW03V1.chop.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110627/8494f4fc/attachment.pl>

From Michelle.Carey at ul.ie  Tue Jun 28 15:58:57 2011
From: Michelle.Carey at ul.ie (Michelle.Carey)
Date: Tue, 28 Jun 2011 14:58:57 +0100
Subject: [Rd] (no subject)
Message-ID: <23FB7F0C9B136E42B87064C97EAD4991809381@staffexchange3.ul.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110628/d4d412e4/attachment.pl>

From richcalaway at revolutionanalytics.com  Tue Jun 28 17:30:08 2011
From: richcalaway at revolutionanalytics.com (Rich Calaway)
Date: Tue, 28 Jun 2011 08:30:08 -0700
Subject: [Rd] doMC - compiler - concatenate an expression vector into a
	single expression?
In-Reply-To: <4E09A5AD.5020209@cbio.uct.ac.za>
References: <4E09A5AD.5020209@cbio.uct.ac.za>
Message-ID: <BANLkTikWxgOJFFxCgjE=3b1J8ZW9iDSPYg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110628/16dc29b1/attachment.pl>

From simon.urbanek at r-project.org  Tue Jun 28 17:31:58 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 28 Jun 2011 11:31:58 -0400
Subject: [Rd] (no subject)
In-Reply-To: <23FB7F0C9B136E42B87064C97EAD4991809381@staffexchange3.ul.campus>
References: <23FB7F0C9B136E42B87064C97EAD4991809381@staffexchange3.ul.campus>
Message-ID: <16AC753F-32F8-4060-BD37-F94883AD8CA4@r-project.org>


On Jun 28, 2011, at 9:58 AM, Michelle.Carey wrote:

> Hi,
> 
> 
> 
> I am trying to write code in C for an R package. I need high precision
> in the form of the mpfr and gmp packages.

gmp is available as R package
http://cran.r-project.org/web/packages/gmp/index.html
do you really need it at a lower level than that?


> I have installed mpfr and gmp
> under the instructions of the following website
> http://pauillac.inria.fr/cdrom_a_graver/prog/pc/mpfr/eng.htm and I get
> no errors. I have put the header files (mpfr.h and gmp.h) in the folder
> C:\Program Files\R\R-2.13.0\include;

That doesn't sound right - the instructions you quote install in the default location which is presumably /usr/local so you should simply set your flags to use that location.


> allowing my c code to identify the
> header files by incorporating include<gmp.h> and include<mpfr.h>.
> Unfortunately when I try to include any of the functions listed in the
> header file I get compile error stating that these functions are
> undeclared,

That doesn't sound plausible, either - undeclared function don't cause errors (not in C). Undefined functions do and you have to make sure you link the libraries installed above.


> even though the source code is in the same directory as my c
> code that I am trying to compile.

That bears no meaning - as you said you installed the libraries, so you have to use those. Source code of gmp/mpfr has no effect on your code and should not be anywhere near it.

Cheers,
Simon


> Any help on this matter would be
> greatly appreciated. 
> 
> 
> 
> Kind Regards,
> 
> Michelle Carey
> 
> 
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From hpages at fhcrc.org  Tue Jun 28 21:01:27 2011
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 28 Jun 2011 12:01:27 -0700
Subject: [Rd] R CMD check --force-multiarch does not install all the
 archs for testing
In-Reply-To: <4E099478.4030609@statistik.tu-dortmund.de>
References: <4E0912EE.7020105@fhcrc.org>
	<4E099478.4030609@statistik.tu-dortmund.de>
Message-ID: <4E0A2507.1010904@fhcrc.org>

Hi Uwe,

On 11-06-28 01:44 AM, Uwe Ligges wrote:
>
>
> On 28.06.2011 01:31, Herv? Pag?s wrote:
>> Hi,
>>
>> Why isn't 'R CMD check --force-multiarch' installing the package
>> for all the architectures that are going to be checked?
>
> Herv?,
>
> no, since it cannot know that that you need
>
> --merge-multiarch
>
> as an additional install flag for this particular package.

Why not just use this flag anyway? Does it hurt to use it on packages
that don't strictly need it?

>
> You will have to check it in repository maintainer's mode (as the CRAN
> maintainers do everywhere). Essentially this is for me (when also
> producing WIndows binaries):
>
>
> Step 1: Installation
>
> R CMD INSTALL --pkglock --compact-docs --build --merge-multiarch
> --library="D:/path/to/library" fabia_1.5.0.tar.gz > fabia-install.out 2>&1
>
> (where the merge-multiarch part applies only to this package, of course)
>
>
>
> Step 2: Check (without installation, since that happened before already,
> using the install log from step 1)
>
> R CMD check --library="D:/path/to/library" --force-multiarch
> --install="check:fabia-install.out" fabia

Whaoooo! Would be nice if there was a plan to make 'R CMD check' also
usable by normal people (including the package developer), not just
by a few privileged people that know about those undocumented tricks.

Thanks,
H.

>
> Best wishes,
> Uwe
>
>
>
>
>
>
>
>
>> For some packages, it only installs for the default arch ('i386').
>> Then testing the package for 'x64' fails.
>>
>> For example,
>>
>> Output of R CMD check --force-multiarch fabia_1.5.0.tar.gz:
>> -----------------------------------------------------------
>> * using log directory 'D:/biocbld/bbs-2.9-bioc/meat/fabia.Rcheck'
>> * using R version 2.14.0 Under development (unstable) (2011-05-30 r56020)
>> * using platform: i386-pc-mingw32 (32-bit)
>> * using session charset: ISO8859-1
>> * using option '--no-vignettes'
>> * checking for file 'fabia/DESCRIPTION' ... OK
>> * this is package 'fabia' version '1.5.0'
>> * checking package name space information ... OK
>> * checking package dependencies ... OK
>> * checking if this is a source package ... OK
>> * checking whether package 'fabia' can be installed ... OK
>> * checking installed package size ... OK
>> * checking package directory ... OK
>> * checking for portable file names ... OK
>> * checking DESCRIPTION meta-information ... OK
>> * checking top-level files ... OK
>> * checking index information ... OK
>> * checking package subdirectories ... OK
>> * checking R files for non-ASCII characters ... OK
>> * checking R files for syntax errors ... OK
>> * loading checks for arch 'i386'
>> ** checking whether the package can be loaded ... OK
>> ** checking whether the package can be loaded with stated dependencies
>> ... OK
>> ** checking whether the package can be unloaded cleanly ... OK
>> ** checking whether the name space can be loaded with stated
>> dependencies ... OK
>> ** checking whether the name space can be unloaded cleanly ... OK
>> * loading checks for arch 'x64'
>> ** checking whether the package can be loaded ...Warning: running
>> command '"D:/biocbld/bbs-2.9-bioc/R/bin/x64/Rterm.exe"
>> R_ENVIRON_USER='no_such_file' --no-site-file --no-init-file --no-save
>> --no-restore --slave -f
>> D:\biocbld\bbs-2.9-bioc\tmpdir\RtmpO65p5H\Rin57456988' had status 1
>> ERROR
>> Error: package 'fabia' is not installed for 'arch=x64'
>> Execution halted
>>
>> It looks like this package has a loading problem: see the messages for
>> details.
>>
>> Content of fabia.Rcheck\00install.out:
>> --------------------------------------
>>
>> * installing *source* package 'fabia' ...
>> Building libRcpp.a in RcppSrc...
>> rm -f Rcpp.o libRcpp.a
>> g++ -c Rcpp.cpp -o Rcpp.o -I"D:/biocbld/BBS-2?1.9-B/R/include"
>> -I"D:/biocbld/BBS-2?1.9-B/R/src/include" -Wall -O2
>> ar r libRcpp.a Rcpp.o
>> C:\Rtools213\MinGW\bin\ar.exe: creating libRcpp.a
>> ranlib libRcpp.a
>> rm -f Rcpp.o
>> rm -f Rcpp.o
>> ** libs
>> running src/Makefile.win ...
>> rm -f fabia.o fabia.dll *.a *.o *.so *.dll
>> g++ -c fabiac.cpp -o fabia.o -I../RcppSrc
>> -I"D:/biocbld/BBS-2?1.9-B/R/include" -Wall -O2
>> g++ -shared -s -static-libgcc fabia.o -L../RcppSrc -lRcpp
>> -L"D:/biocbld/BBS-2?1.9-B/R/bin/i386" -lR -o fabia.dll
>> rm -f fabia.o *.a *.o *.so
>> installing to D:/biocbld/bbs-2.9-bioc/meat/fabia.Rcheck/fabia/libs/i386
>> ** R
>> ** demo
>> ** inst
>> ** preparing package for lazy loading
>> Creating a generic function for "plot" from package "graphics" in
>> package "fabia"
>> ** help
>> *** installing help indices
>> ** building package indices ...
>> *** tangling vignette sources ...
>> 'fabia.Rnw'
>> ** testing if installed package can be loaded
>>
>> * DONE (fabia)
>>
>> The source tarball for this package is available here:
>> http://bioconductor.org/packages/2.9/bioc/html/fabia.html
>>
>> What command should be used to perform a multiarch check of this
>> package?
>>
>> This is on a 64-bit Windows Server 2008 R2 Enterprise machine using a
>> recent combined Windows 32/64 bit binary of R-devel from CRAN.
>>
>> Thanks!
>> H.
>>


-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From hadley at rice.edu  Tue Jun 28 21:03:49 2011
From: hadley at rice.edu (Hadley Wickham)
Date: Tue, 28 Jun 2011 14:03:49 -0500
Subject: [Rd] Small bug in install.packages?
Message-ID: <BANLkTinuHoNi4oQaaC9B1hhMgpdACyfKOw@mail.gmail.com>

When capturing the path to the current R binary, install.packages does:

  cmd0 <- paste(file.path(R.home("bin"), "R"), "CMD INSTALL")

shouldn't that be

  cmd0 <- shQuote(paste(file.path(R.home("bin"), "R"), "CMD INSTALL"))

to allow paths with spaces in them (which would be very common on windows)?

Hadley


-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From simon.urbanek at r-project.org  Tue Jun 28 21:19:59 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 28 Jun 2011 15:19:59 -0400
Subject: [Rd] R CMD check --force-multiarch does not install all the
	archs for testing
In-Reply-To: <4E0A2507.1010904@fhcrc.org>
References: <4E0912EE.7020105@fhcrc.org>
	<4E099478.4030609@statistik.tu-dortmund.de>
	<4E0A2507.1010904@fhcrc.org>
Message-ID: <CA592CAB-B8DB-49C6-9AFD-9DB2C2087806@r-project.org>


On Jun 28, 2011, at 3:01 PM, Herv? Pag?s wrote:

> Hi Uwe,
> 
> On 11-06-28 01:44 AM, Uwe Ligges wrote:
>> 
>> 
>> On 28.06.2011 01:31, Herv? Pag?s wrote:
>>> Hi,
>>> 
>>> Why isn't 'R CMD check --force-multiarch' installing the package
>>> for all the architectures that are going to be checked?
>> 
>> Herv?,
>> 
>> no, since it cannot know that that you need
>> 
>> --merge-multiarch
>> 
>> as an additional install flag for this particular package.
> 
> Why not just use this flag anyway? Does it hurt to use it on packages that don't strictly need it?
> 

It does for two reasons: a) everything is built twice and b) package authors don't expect the necessity to support --libs-only if the package doesn't require separate build runs.

The cross-platform way is to not use --merge-multiarch but use --libs-only instead as needed (easy to check after the first arch run which will tell you whether it's needed or not). I suspect that --merge-multiarch is just a convenience shortcut (and it's unclear to me why it's Windows-only...).

Cheers,
Simon


>> You will have to check it in repository maintainer's mode (as the CRAN
>> maintainers do everywhere). Essentially this is for me (when also
>> producing WIndows binaries):
>> 
>> 
>> Step 1: Installation
>> 
>> R CMD INSTALL --pkglock --compact-docs --build --merge-multiarch
>> --library="D:/path/to/library" fabia_1.5.0.tar.gz > fabia-install.out 2>&1
>> 
>> (where the merge-multiarch part applies only to this package, of course)
>> 
>> 
>> 
>> Step 2: Check (without installation, since that happened before already,
>> using the install log from step 1)
>> 
>> R CMD check --library="D:/path/to/library" --force-multiarch
>> --install="check:fabia-install.out" fabia
> 
> Whaoooo! Would be nice if there was a plan to make 'R CMD check' also
> usable by normal people (including the package developer), not just
> by a few privileged people that know about those undocumented tricks.
> 
> Thanks,
> H.
> 
>> 
>> Best wishes,
>> Uwe
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>>> For some packages, it only installs for the default arch ('i386').
>>> Then testing the package for 'x64' fails.
>>> 
>>> For example,
>>> 
>>> Output of R CMD check --force-multiarch fabia_1.5.0.tar.gz:
>>> -----------------------------------------------------------
>>> * using log directory 'D:/biocbld/bbs-2.9-bioc/meat/fabia.Rcheck'
>>> * using R version 2.14.0 Under development (unstable) (2011-05-30 r56020)
>>> * using platform: i386-pc-mingw32 (32-bit)
>>> * using session charset: ISO8859-1
>>> * using option '--no-vignettes'
>>> * checking for file 'fabia/DESCRIPTION' ... OK
>>> * this is package 'fabia' version '1.5.0'
>>> * checking package name space information ... OK
>>> * checking package dependencies ... OK
>>> * checking if this is a source package ... OK
>>> * checking whether package 'fabia' can be installed ... OK
>>> * checking installed package size ... OK
>>> * checking package directory ... OK
>>> * checking for portable file names ... OK
>>> * checking DESCRIPTION meta-information ... OK
>>> * checking top-level files ... OK
>>> * checking index information ... OK
>>> * checking package subdirectories ... OK
>>> * checking R files for non-ASCII characters ... OK
>>> * checking R files for syntax errors ... OK
>>> * loading checks for arch 'i386'
>>> ** checking whether the package can be loaded ... OK
>>> ** checking whether the package can be loaded with stated dependencies
>>> ... OK
>>> ** checking whether the package can be unloaded cleanly ... OK
>>> ** checking whether the name space can be loaded with stated
>>> dependencies ... OK
>>> ** checking whether the name space can be unloaded cleanly ... OK
>>> * loading checks for arch 'x64'
>>> ** checking whether the package can be loaded ...Warning: running
>>> command '"D:/biocbld/bbs-2.9-bioc/R/bin/x64/Rterm.exe"
>>> R_ENVIRON_USER='no_such_file' --no-site-file --no-init-file --no-save
>>> --no-restore --slave -f
>>> D:\biocbld\bbs-2.9-bioc\tmpdir\RtmpO65p5H\Rin57456988' had status 1
>>> ERROR
>>> Error: package 'fabia' is not installed for 'arch=x64'
>>> Execution halted
>>> 
>>> It looks like this package has a loading problem: see the messages for
>>> details.
>>> 
>>> Content of fabia.Rcheck\00install.out:
>>> --------------------------------------
>>> 
>>> * installing *source* package 'fabia' ...
>>> Building libRcpp.a in RcppSrc...
>>> rm -f Rcpp.o libRcpp.a
>>> g++ -c Rcpp.cpp -o Rcpp.o -I"D:/biocbld/BBS-2?1.9-B/R/include"
>>> -I"D:/biocbld/BBS-2?1.9-B/R/src/include" -Wall -O2
>>> ar r libRcpp.a Rcpp.o
>>> C:\Rtools213\MinGW\bin\ar.exe: creating libRcpp.a
>>> ranlib libRcpp.a
>>> rm -f Rcpp.o
>>> rm -f Rcpp.o
>>> ** libs
>>> running src/Makefile.win ...
>>> rm -f fabia.o fabia.dll *.a *.o *.so *.dll
>>> g++ -c fabiac.cpp -o fabia.o -I../RcppSrc
>>> -I"D:/biocbld/BBS-2?1.9-B/R/include" -Wall -O2
>>> g++ -shared -s -static-libgcc fabia.o -L../RcppSrc -lRcpp
>>> -L"D:/biocbld/BBS-2?1.9-B/R/bin/i386" -lR -o fabia.dll
>>> rm -f fabia.o *.a *.o *.so
>>> installing to D:/biocbld/bbs-2.9-bioc/meat/fabia.Rcheck/fabia/libs/i386
>>> ** R
>>> ** demo
>>> ** inst
>>> ** preparing package for lazy loading
>>> Creating a generic function for "plot" from package "graphics" in
>>> package "fabia"
>>> ** help
>>> *** installing help indices
>>> ** building package indices ...
>>> *** tangling vignette sources ...
>>> 'fabia.Rnw'
>>> ** testing if installed package can be loaded
>>> 
>>> * DONE (fabia)
>>> 
>>> The source tarball for this package is available here:
>>> http://bioconductor.org/packages/2.9/bioc/html/fabia.html
>>> 
>>> What command should be used to perform a multiarch check of this
>>> package?
>>> 
>>> This is on a 64-bit Windows Server 2008 R2 Enterprise machine using a
>>> recent combined Windows 32/64 bit binary of R-devel from CRAN.
>>> 
>>> Thanks!
>>> H.
>>> 
> 
> 
> -- 
> Herv? Pag?s
> 
> Program in Computational Biology
> Division of Public Health Sciences
> Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N, M1-B514
> P.O. Box 19024
> Seattle, WA 98109-1024
> 
> E-mail: hpages at fhcrc.org
> Phone:  (206) 667-5791
> Fax:    (206) 667-1319
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From simon.urbanek at r-project.org  Tue Jun 28 21:22:50 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 28 Jun 2011 15:22:50 -0400
Subject: [Rd] Small bug in install.packages?
In-Reply-To: <BANLkTinuHoNi4oQaaC9B1hhMgpdACyfKOw@mail.gmail.com>
References: <BANLkTinuHoNi4oQaaC9B1hhMgpdACyfKOw@mail.gmail.com>
Message-ID: <D7C3B3C4-5ED9-4170-8E4A-BD9EFD00A6BF@r-project.org>


On Jun 28, 2011, at 3:03 PM, Hadley Wickham wrote:

> When capturing the path to the current R binary, install.packages does:
> 
>  cmd0 <- paste(file.path(R.home("bin"), "R"), "CMD INSTALL")
> 
> shouldn't that be
> 
>  cmd0 <- shQuote(paste(file.path(R.home("bin"), "R"), "CMD INSTALL"))
> 
> to allow paths with spaces in them (which would be very common on windows)?
> 

Isn't R.home() 8.3 path anyway?

BTW: I think you probably meant more something like paste(shQuote(file.path(R.home("bin"), "R")), "CMD INSTALL") since the above won't work ..

Cheers,
S


From hpages at fhcrc.org  Tue Jun 28 21:45:08 2011
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 28 Jun 2011 12:45:08 -0700
Subject: [Rd] R CMD check --force-multiarch does not install all the
 archs for testing
In-Reply-To: <CA592CAB-B8DB-49C6-9AFD-9DB2C2087806@r-project.org>
References: <4E0912EE.7020105@fhcrc.org>
	<4E099478.4030609@statistik.tu-dortmund.de>
	<4E0A2507.1010904@fhcrc.org>
	<CA592CAB-B8DB-49C6-9AFD-9DB2C2087806@r-project.org>
Message-ID: <4E0A2F44.3010109@fhcrc.org>

Hi Simon,

On 11-06-28 12:19 PM, Simon Urbanek wrote:
>
> On Jun 28, 2011, at 3:01 PM, Herv? Pag?s wrote:
>
>> Hi Uwe,
>>
>> On 11-06-28 01:44 AM, Uwe Ligges wrote:
>>>
>>>
>>> On 28.06.2011 01:31, Herv? Pag?s wrote:
>>>> Hi,
>>>>
>>>> Why isn't 'R CMD check --force-multiarch' installing the package
>>>> for all the architectures that are going to be checked?
>>>
>>> Herv?,
>>>
>>> no, since it cannot know that that you need
>>>
>>> --merge-multiarch
>>>
>>> as an additional install flag for this particular package.
>>
>> Why not just use this flag anyway? Does it hurt to use it on packages that don't strictly need it?
>>
>
> It does for two reasons: a) everything is built twice

That's exactly what I want when I do 'R CMD check --force-multiarch'

> and b) package authors don't expect the necessity to support --libs-only if the package doesn't require separate build runs.

When specifying --force-multiarch, the user really expects the package
to be installed for all sub-archs.

>
> The cross-platform way is to not use --merge-multiarch but use --libs-only instead as needed (easy to check after the first arch run which will tell you whether it's needed or not). I suspect that --merge-multiarch is just a convenience shortcut (and it's unclear to me why it's Windows-only...).

A great convenience indeed as it allows to do the multiarch install in
a single step. And it's unclear to me too why it's Windows-only but I
would have hoped you would know...

Thanks,
H.


>
> Cheers,
> Simon
>
>
>>> You will have to check it in repository maintainer's mode (as the CRAN
>>> maintainers do everywhere). Essentially this is for me (when also
>>> producing WIndows binaries):
>>>
>>>
>>> Step 1: Installation
>>>
>>> R CMD INSTALL --pkglock --compact-docs --build --merge-multiarch
>>> --library="D:/path/to/library" fabia_1.5.0.tar.gz>  fabia-install.out 2>&1
>>>
>>> (where the merge-multiarch part applies only to this package, of course)
>>>
>>>
>>>
>>> Step 2: Check (without installation, since that happened before already,
>>> using the install log from step 1)
>>>
>>> R CMD check --library="D:/path/to/library" --force-multiarch
>>> --install="check:fabia-install.out" fabia
>>
>> Whaoooo! Would be nice if there was a plan to make 'R CMD check' also
>> usable by normal people (including the package developer), not just
>> by a few privileged people that know about those undocumented tricks.
>>
>> Thanks,
>> H.
>>
>>>
>>> Best wishes,
>>> Uwe
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>> For some packages, it only installs for the default arch ('i386').
>>>> Then testing the package for 'x64' fails.
>>>>
>>>> For example,
>>>>
>>>> Output of R CMD check --force-multiarch fabia_1.5.0.tar.gz:
>>>> -----------------------------------------------------------
>>>> * using log directory 'D:/biocbld/bbs-2.9-bioc/meat/fabia.Rcheck'
>>>> * using R version 2.14.0 Under development (unstable) (2011-05-30 r56020)
>>>> * using platform: i386-pc-mingw32 (32-bit)
>>>> * using session charset: ISO8859-1
>>>> * using option '--no-vignettes'
>>>> * checking for file 'fabia/DESCRIPTION' ... OK
>>>> * this is package 'fabia' version '1.5.0'
>>>> * checking package name space information ... OK
>>>> * checking package dependencies ... OK
>>>> * checking if this is a source package ... OK
>>>> * checking whether package 'fabia' can be installed ... OK
>>>> * checking installed package size ... OK
>>>> * checking package directory ... OK
>>>> * checking for portable file names ... OK
>>>> * checking DESCRIPTION meta-information ... OK
>>>> * checking top-level files ... OK
>>>> * checking index information ... OK
>>>> * checking package subdirectories ... OK
>>>> * checking R files for non-ASCII characters ... OK
>>>> * checking R files for syntax errors ... OK
>>>> * loading checks for arch 'i386'
>>>> ** checking whether the package can be loaded ... OK
>>>> ** checking whether the package can be loaded with stated dependencies
>>>> ... OK
>>>> ** checking whether the package can be unloaded cleanly ... OK
>>>> ** checking whether the name space can be loaded with stated
>>>> dependencies ... OK
>>>> ** checking whether the name space can be unloaded cleanly ... OK
>>>> * loading checks for arch 'x64'
>>>> ** checking whether the package can be loaded ...Warning: running
>>>> command '"D:/biocbld/bbs-2.9-bioc/R/bin/x64/Rterm.exe"
>>>> R_ENVIRON_USER='no_such_file' --no-site-file --no-init-file --no-save
>>>> --no-restore --slave -f
>>>> D:\biocbld\bbs-2.9-bioc\tmpdir\RtmpO65p5H\Rin57456988' had status 1
>>>> ERROR
>>>> Error: package 'fabia' is not installed for 'arch=x64'
>>>> Execution halted
>>>>
>>>> It looks like this package has a loading problem: see the messages for
>>>> details.
>>>>
>>>> Content of fabia.Rcheck\00install.out:
>>>> --------------------------------------
>>>>
>>>> * installing *source* package 'fabia' ...
>>>> Building libRcpp.a in RcppSrc...
>>>> rm -f Rcpp.o libRcpp.a
>>>> g++ -c Rcpp.cpp -o Rcpp.o -I"D:/biocbld/BBS-2?1.9-B/R/include"
>>>> -I"D:/biocbld/BBS-2?1.9-B/R/src/include" -Wall -O2
>>>> ar r libRcpp.a Rcpp.o
>>>> C:\Rtools213\MinGW\bin\ar.exe: creating libRcpp.a
>>>> ranlib libRcpp.a
>>>> rm -f Rcpp.o
>>>> rm -f Rcpp.o
>>>> ** libs
>>>> running src/Makefile.win ...
>>>> rm -f fabia.o fabia.dll *.a *.o *.so *.dll
>>>> g++ -c fabiac.cpp -o fabia.o -I../RcppSrc
>>>> -I"D:/biocbld/BBS-2?1.9-B/R/include" -Wall -O2
>>>> g++ -shared -s -static-libgcc fabia.o -L../RcppSrc -lRcpp
>>>> -L"D:/biocbld/BBS-2?1.9-B/R/bin/i386" -lR -o fabia.dll
>>>> rm -f fabia.o *.a *.o *.so
>>>> installing to D:/biocbld/bbs-2.9-bioc/meat/fabia.Rcheck/fabia/libs/i386
>>>> ** R
>>>> ** demo
>>>> ** inst
>>>> ** preparing package for lazy loading
>>>> Creating a generic function for "plot" from package "graphics" in
>>>> package "fabia"
>>>> ** help
>>>> *** installing help indices
>>>> ** building package indices ...
>>>> *** tangling vignette sources ...
>>>> 'fabia.Rnw'
>>>> ** testing if installed package can be loaded
>>>>
>>>> * DONE (fabia)
>>>>
>>>> The source tarball for this package is available here:
>>>> http://bioconductor.org/packages/2.9/bioc/html/fabia.html
>>>>
>>>> What command should be used to perform a multiarch check of this
>>>> package?
>>>>
>>>> This is on a 64-bit Windows Server 2008 R2 Enterprise machine using a
>>>> recent combined Windows 32/64 bit binary of R-devel from CRAN.
>>>>
>>>> Thanks!
>>>> H.
>>>>
>>
>>
>> --
>> Herv? Pag?s
>>
>> Program in Computational Biology
>> Division of Public Health Sciences
>> Fred Hutchinson Cancer Research Center
>> 1100 Fairview Ave. N, M1-B514
>> P.O. Box 19024
>> Seattle, WA 98109-1024
>>
>> E-mail: hpages at fhcrc.org
>> Phone:  (206) 667-5791
>> Fax:    (206) 667-1319
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>


-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From simon.urbanek at r-project.org  Tue Jun 28 22:44:56 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 28 Jun 2011 16:44:56 -0400
Subject: [Rd] R CMD check --force-multiarch does not install all the
	archs for testing
In-Reply-To: <4E0A2F44.3010109@fhcrc.org>
References: <4E0912EE.7020105@fhcrc.org>
	<4E099478.4030609@statistik.tu-dortmund.de>
	<4E0A2507.1010904@fhcrc.org>
	<CA592CAB-B8DB-49C6-9AFD-9DB2C2087806@r-project.org>
	<4E0A2F44.3010109@fhcrc.org>
Message-ID: <EBE00C6D-476A-4DA5-9CB8-A0F320D2B042@r-project.org>


On Jun 28, 2011, at 3:45 PM, Herv? Pag?s wrote:

> Hi Simon,
> 
> On 11-06-28 12:19 PM, Simon Urbanek wrote:
>> 
>> On Jun 28, 2011, at 3:01 PM, Herv? Pag?s wrote:
>> 
>>> Hi Uwe,
>>> 
>>> On 11-06-28 01:44 AM, Uwe Ligges wrote:
>>>> 
>>>> 
>>>> On 28.06.2011 01:31, Herv? Pag?s wrote:
>>>>> Hi,
>>>>> 
>>>>> Why isn't 'R CMD check --force-multiarch' installing the package
>>>>> for all the architectures that are going to be checked?
>>>> 
>>>> Herv?,
>>>> 
>>>> no, since it cannot know that that you need
>>>> 
>>>> --merge-multiarch
>>>> 
>>>> as an additional install flag for this particular package.
>>> 
>>> Why not just use this flag anyway? Does it hurt to use it on packages that don't strictly need it?
>>> 
>> 
>> It does for two reasons: a) everything is built twice
> 
> That's exactly what I want when I do 'R CMD check --force-multiarch'
> 

No, that's not what it does (and I assume you mean --force-biarch). It builds the package just once, you're simply overriding the default behavior of checking for configure.win, that's all. The two flags are orthogonal, --force-biarch makes no sense with --merge-multiarch, they are for all practical purposes mutually exclusive by definition of what they do.


>> and b) package authors don't expect the necessity to support --libs-only if the package doesn't require separate build runs.
> 
> When specifying --force-multiarch, the user really expects the package to be installed for all sub-archs.
> 

... with the assumption that the package supports it even though it has a configure script which may to may not work unlike --merge-multiarch which will always work. --force-biarch is just a way to flag packages that have configure.win that has no effect on the binary settings (flags etc.). It forces R to try multi-arch build in one flight, but it may or may not work depending on the package. It is a way to save time by not running --merge-multiarch (and thus building the package twice).

Cheers,
Simon


>> 
>> The cross-platform way is to not use --merge-multiarch but use --libs-only instead as needed (easy to check after the first arch run which will tell you whether it's needed or not). I suspect that --merge-multiarch is just a convenience shortcut (and it's unclear to me why it's Windows-only...).
> 
> A great convenience indeed as it allows to do the multiarch install in
> a single step. And it's unclear to me too why it's Windows-only but I
> would have hoped you would know...
> 
> Thanks,
> H.
> 
> 
>> 
>> Cheers,
>> Simon
>> 
>> 
>>>> You will have to check it in repository maintainer's mode (as the CRAN
>>>> maintainers do everywhere). Essentially this is for me (when also
>>>> producing WIndows binaries):
>>>> 
>>>> 
>>>> Step 1: Installation
>>>> 
>>>> R CMD INSTALL --pkglock --compact-docs --build --merge-multiarch
>>>> --library="D:/path/to/library" fabia_1.5.0.tar.gz>  fabia-install.out 2>&1
>>>> 
>>>> (where the merge-multiarch part applies only to this package, of course)
>>>> 
>>>> 
>>>> 
>>>> Step 2: Check (without installation, since that happened before already,
>>>> using the install log from step 1)
>>>> 
>>>> R CMD check --library="D:/path/to/library" --force-multiarch
>>>> --install="check:fabia-install.out" fabia
>>> 
>>> Whaoooo! Would be nice if there was a plan to make 'R CMD check' also
>>> usable by normal people (including the package developer), not just
>>> by a few privileged people that know about those undocumented tricks.
>>> 
>>> Thanks,
>>> H.
>>> 
>>>> 
>>>> Best wishes,
>>>> Uwe
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>>> For some packages, it only installs for the default arch ('i386').
>>>>> Then testing the package for 'x64' fails.
>>>>> 
>>>>> For example,
>>>>> 
>>>>> Output of R CMD check --force-multiarch fabia_1.5.0.tar.gz:
>>>>> -----------------------------------------------------------
>>>>> * using log directory 'D:/biocbld/bbs-2.9-bioc/meat/fabia.Rcheck'
>>>>> * using R version 2.14.0 Under development (unstable) (2011-05-30 r56020)
>>>>> * using platform: i386-pc-mingw32 (32-bit)
>>>>> * using session charset: ISO8859-1
>>>>> * using option '--no-vignettes'
>>>>> * checking for file 'fabia/DESCRIPTION' ... OK
>>>>> * this is package 'fabia' version '1.5.0'
>>>>> * checking package name space information ... OK
>>>>> * checking package dependencies ... OK
>>>>> * checking if this is a source package ... OK
>>>>> * checking whether package 'fabia' can be installed ... OK
>>>>> * checking installed package size ... OK
>>>>> * checking package directory ... OK
>>>>> * checking for portable file names ... OK
>>>>> * checking DESCRIPTION meta-information ... OK
>>>>> * checking top-level files ... OK
>>>>> * checking index information ... OK
>>>>> * checking package subdirectories ... OK
>>>>> * checking R files for non-ASCII characters ... OK
>>>>> * checking R files for syntax errors ... OK
>>>>> * loading checks for arch 'i386'
>>>>> ** checking whether the package can be loaded ... OK
>>>>> ** checking whether the package can be loaded with stated dependencies
>>>>> ... OK
>>>>> ** checking whether the package can be unloaded cleanly ... OK
>>>>> ** checking whether the name space can be loaded with stated
>>>>> dependencies ... OK
>>>>> ** checking whether the name space can be unloaded cleanly ... OK
>>>>> * loading checks for arch 'x64'
>>>>> ** checking whether the package can be loaded ...Warning: running
>>>>> command '"D:/biocbld/bbs-2.9-bioc/R/bin/x64/Rterm.exe"
>>>>> R_ENVIRON_USER='no_such_file' --no-site-file --no-init-file --no-save
>>>>> --no-restore --slave -f
>>>>> D:\biocbld\bbs-2.9-bioc\tmpdir\RtmpO65p5H\Rin57456988' had status 1
>>>>> ERROR
>>>>> Error: package 'fabia' is not installed for 'arch=x64'
>>>>> Execution halted
>>>>> 
>>>>> It looks like this package has a loading problem: see the messages for
>>>>> details.
>>>>> 
>>>>> Content of fabia.Rcheck\00install.out:
>>>>> --------------------------------------
>>>>> 
>>>>> * installing *source* package 'fabia' ...
>>>>> Building libRcpp.a in RcppSrc...
>>>>> rm -f Rcpp.o libRcpp.a
>>>>> g++ -c Rcpp.cpp -o Rcpp.o -I"D:/biocbld/BBS-2?1.9-B/R/include"
>>>>> -I"D:/biocbld/BBS-2?1.9-B/R/src/include" -Wall -O2
>>>>> ar r libRcpp.a Rcpp.o
>>>>> C:\Rtools213\MinGW\bin\ar.exe: creating libRcpp.a
>>>>> ranlib libRcpp.a
>>>>> rm -f Rcpp.o
>>>>> rm -f Rcpp.o
>>>>> ** libs
>>>>> running src/Makefile.win ...
>>>>> rm -f fabia.o fabia.dll *.a *.o *.so *.dll
>>>>> g++ -c fabiac.cpp -o fabia.o -I../RcppSrc
>>>>> -I"D:/biocbld/BBS-2?1.9-B/R/include" -Wall -O2
>>>>> g++ -shared -s -static-libgcc fabia.o -L../RcppSrc -lRcpp
>>>>> -L"D:/biocbld/BBS-2?1.9-B/R/bin/i386" -lR -o fabia.dll
>>>>> rm -f fabia.o *.a *.o *.so
>>>>> installing to D:/biocbld/bbs-2.9-bioc/meat/fabia.Rcheck/fabia/libs/i386
>>>>> ** R
>>>>> ** demo
>>>>> ** inst
>>>>> ** preparing package for lazy loading
>>>>> Creating a generic function for "plot" from package "graphics" in
>>>>> package "fabia"
>>>>> ** help
>>>>> *** installing help indices
>>>>> ** building package indices ...
>>>>> *** tangling vignette sources ...
>>>>> 'fabia.Rnw'
>>>>> ** testing if installed package can be loaded
>>>>> 
>>>>> * DONE (fabia)
>>>>> 
>>>>> The source tarball for this package is available here:
>>>>> http://bioconductor.org/packages/2.9/bioc/html/fabia.html
>>>>> 
>>>>> What command should be used to perform a multiarch check of this
>>>>> package?
>>>>> 
>>>>> This is on a 64-bit Windows Server 2008 R2 Enterprise machine using a
>>>>> recent combined Windows 32/64 bit binary of R-devel from CRAN.
>>>>> 
>>>>> Thanks!
>>>>> H.
>>>>> 
>>> 
>>> 
>>> --
>>> Herv? Pag?s
>>> 
>>> Program in Computational Biology
>>> Division of Public Health Sciences
>>> Fred Hutchinson Cancer Research Center
>>> 1100 Fairview Ave. N, M1-B514
>>> P.O. Box 19024
>>> Seattle, WA 98109-1024
>>> 
>>> E-mail: hpages at fhcrc.org
>>> Phone:  (206) 667-5791
>>> Fax:    (206) 667-1319
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>>> 
>> 
> 
> 
> -- 
> Herv? Pag?s
> 
> Program in Computational Biology
> Division of Public Health Sciences
> Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N, M1-B514
> P.O. Box 19024
> Seattle, WA 98109-1024
> 
> E-mail: hpages at fhcrc.org
> Phone:  (206) 667-5791
> Fax:    (206) 667-1319
> 
> 


From hpages at fhcrc.org  Tue Jun 28 23:11:29 2011
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 28 Jun 2011 14:11:29 -0700
Subject: [Rd] R CMD check --force-multiarch does not install all the
 archs for testing
In-Reply-To: <EBE00C6D-476A-4DA5-9CB8-A0F320D2B042@r-project.org>
References: <4E0912EE.7020105@fhcrc.org>
	<4E099478.4030609@statistik.tu-dortmund.de>
	<4E0A2507.1010904@fhcrc.org>
	<CA592CAB-B8DB-49C6-9AFD-9DB2C2087806@r-project.org>
	<4E0A2F44.3010109@fhcrc.org>
	<EBE00C6D-476A-4DA5-9CB8-A0F320D2B042@r-project.org>
Message-ID: <4E0A4381.6020506@fhcrc.org>

Simon,

On 11-06-28 01:44 PM, Simon Urbanek wrote:
>
> On Jun 28, 2011, at 3:45 PM, Herv? Pag?s wrote:
>
>> Hi Simon,
>>
>> On 11-06-28 12:19 PM, Simon Urbanek wrote:
>>>
>>> On Jun 28, 2011, at 3:01 PM, Herv? Pag?s wrote:
>>>
>>>> Hi Uwe,
>>>>
>>>> On 11-06-28 01:44 AM, Uwe Ligges wrote:
>>>>>
>>>>>
>>>>> On 28.06.2011 01:31, Herv? Pag?s wrote:
>>>>>> Hi,
>>>>>>
>>>>>> Why isn't 'R CMD check --force-multiarch' installing the package
>>>>>> for all the architectures that are going to be checked?
>>>>>
>>>>> Herv?,
>>>>>
>>>>> no, since it cannot know that that you need
>>>>>
>>>>> --merge-multiarch
>>>>>
>>>>> as an additional install flag for this particular package.
>>>>
>>>> Why not just use this flag anyway? Does it hurt to use it on packages that don't strictly need it?
>>>>
>>>
>>> It does for two reasons: a) everything is built twice
>>
>> That's exactly what I want when I do 'R CMD check --force-multiarch'
>>
>
> No, that's not what it does (and I assume you mean --force-biarch). It builds the package just once, you're simply overriding the default behavior of checking for configure.win, that's all. The two flags are orthogonal, --force-biarch makes no sense with --merge-multiarch, they are for all practical purposes mutually exclusive by definition of what they do.

I really mean --force-multiarch, not --force-biarch. AFAIK 'R CMD check'
has no --force-biarch option.

>
>
>>> and b) package authors don't expect the necessity to support --libs-only if the package doesn't require separate build runs.
>>
>> When specifying --force-multiarch, the user really expects the package to be installed for all sub-archs.
>>
>
> ... with the assumption that the package supports it even though it has a configure script which may to may not work unlike --merge-multiarch which will always work.

Just to clarify:

--force-multiarch is an 'R CMD check' option, not an 'R CMD INSTALL'
option

--merge-multiarch is an 'R CMD INSTALL' option, not an 'R CMD check'
option

Now you are saying that --merge-multiarch will always work (on Windows
of course, all this discussion is about how to achieve multiarch check
on Windows). Great, this is what I've been observing too so far!
On packages with or without native codes, with or without configure.win
scripts, etc... It always seems to work. So, again, why isn't
'R CMD check --force-multiarch' installing with --merge-multiarch?
Note that I'm not attached to that solution in particular, just trying
to suggest an easy fix for 'R CMD check --force-multiarch' (which right
now is broken on some packages).

> --force-biarch is just a way to flag packages that have configure.win that has no effect on the binary settings (flags etc.). It forces R to try multi-arch build in one flight, but it may or may not work depending on the package. It is a way to save time by not running --merge-multiarch (and thus building the package twice).

--force-biarch is an 'R CMD INSTALL' option that I don't use. Why would
I use something that might fail when I can use --merge-multiarch which
always works.

Thanks,
H.

>
> Cheers,
> Simon
>
>
>>>
>>> The cross-platform way is to not use --merge-multiarch but use --libs-only instead as needed (easy to check after the first arch run which will tell you whether it's needed or not). I suspect that --merge-multiarch is just a convenience shortcut (and it's unclear to me why it's Windows-only...).
>>
>> A great convenience indeed as it allows to do the multiarch install in
>> a single step. And it's unclear to me too why it's Windows-only but I
>> would have hoped you would know...
>>
>> Thanks,
>> H.
>>
>>
>>>
>>> Cheers,
>>> Simon
>>>
>>>
>>>>> You will have to check it in repository maintainer's mode (as the CRAN
>>>>> maintainers do everywhere). Essentially this is for me (when also
>>>>> producing WIndows binaries):
>>>>>
>>>>>
>>>>> Step 1: Installation
>>>>>
>>>>> R CMD INSTALL --pkglock --compact-docs --build --merge-multiarch
>>>>> --library="D:/path/to/library" fabia_1.5.0.tar.gz>   fabia-install.out 2>&1
>>>>>
>>>>> (where the merge-multiarch part applies only to this package, of course)
>>>>>
>>>>>
>>>>>
>>>>> Step 2: Check (without installation, since that happened before already,
>>>>> using the install log from step 1)
>>>>>
>>>>> R CMD check --library="D:/path/to/library" --force-multiarch
>>>>> --install="check:fabia-install.out" fabia
>>>>
>>>> Whaoooo! Would be nice if there was a plan to make 'R CMD check' also
>>>> usable by normal people (including the package developer), not just
>>>> by a few privileged people that know about those undocumented tricks.
>>>>
>>>> Thanks,
>>>> H.
>>>>
>>>>>
>>>>> Best wishes,
>>>>> Uwe
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>> For some packages, it only installs for the default arch ('i386').
>>>>>> Then testing the package for 'x64' fails.
>>>>>>
>>>>>> For example,
>>>>>>
>>>>>> Output of R CMD check --force-multiarch fabia_1.5.0.tar.gz:
>>>>>> -----------------------------------------------------------
>>>>>> * using log directory 'D:/biocbld/bbs-2.9-bioc/meat/fabia.Rcheck'
>>>>>> * using R version 2.14.0 Under development (unstable) (2011-05-30 r56020)
>>>>>> * using platform: i386-pc-mingw32 (32-bit)
>>>>>> * using session charset: ISO8859-1
>>>>>> * using option '--no-vignettes'
>>>>>> * checking for file 'fabia/DESCRIPTION' ... OK
>>>>>> * this is package 'fabia' version '1.5.0'
>>>>>> * checking package name space information ... OK
>>>>>> * checking package dependencies ... OK
>>>>>> * checking if this is a source package ... OK
>>>>>> * checking whether package 'fabia' can be installed ... OK
>>>>>> * checking installed package size ... OK
>>>>>> * checking package directory ... OK
>>>>>> * checking for portable file names ... OK
>>>>>> * checking DESCRIPTION meta-information ... OK
>>>>>> * checking top-level files ... OK
>>>>>> * checking index information ... OK
>>>>>> * checking package subdirectories ... OK
>>>>>> * checking R files for non-ASCII characters ... OK
>>>>>> * checking R files for syntax errors ... OK
>>>>>> * loading checks for arch 'i386'
>>>>>> ** checking whether the package can be loaded ... OK
>>>>>> ** checking whether the package can be loaded with stated dependencies
>>>>>> ... OK
>>>>>> ** checking whether the package can be unloaded cleanly ... OK
>>>>>> ** checking whether the name space can be loaded with stated
>>>>>> dependencies ... OK
>>>>>> ** checking whether the name space can be unloaded cleanly ... OK
>>>>>> * loading checks for arch 'x64'
>>>>>> ** checking whether the package can be loaded ...Warning: running
>>>>>> command '"D:/biocbld/bbs-2.9-bioc/R/bin/x64/Rterm.exe"
>>>>>> R_ENVIRON_USER='no_such_file' --no-site-file --no-init-file --no-save
>>>>>> --no-restore --slave -f
>>>>>> D:\biocbld\bbs-2.9-bioc\tmpdir\RtmpO65p5H\Rin57456988' had status 1
>>>>>> ERROR
>>>>>> Error: package 'fabia' is not installed for 'arch=x64'
>>>>>> Execution halted
>>>>>>
>>>>>> It looks like this package has a loading problem: see the messages for
>>>>>> details.
>>>>>>
>>>>>> Content of fabia.Rcheck\00install.out:
>>>>>> --------------------------------------
>>>>>>
>>>>>> * installing *source* package 'fabia' ...
>>>>>> Building libRcpp.a in RcppSrc...
>>>>>> rm -f Rcpp.o libRcpp.a
>>>>>> g++ -c Rcpp.cpp -o Rcpp.o -I"D:/biocbld/BBS-2?1.9-B/R/include"
>>>>>> -I"D:/biocbld/BBS-2?1.9-B/R/src/include" -Wall -O2
>>>>>> ar r libRcpp.a Rcpp.o
>>>>>> C:\Rtools213\MinGW\bin\ar.exe: creating libRcpp.a
>>>>>> ranlib libRcpp.a
>>>>>> rm -f Rcpp.o
>>>>>> rm -f Rcpp.o
>>>>>> ** libs
>>>>>> running src/Makefile.win ...
>>>>>> rm -f fabia.o fabia.dll *.a *.o *.so *.dll
>>>>>> g++ -c fabiac.cpp -o fabia.o -I../RcppSrc
>>>>>> -I"D:/biocbld/BBS-2?1.9-B/R/include" -Wall -O2
>>>>>> g++ -shared -s -static-libgcc fabia.o -L../RcppSrc -lRcpp
>>>>>> -L"D:/biocbld/BBS-2?1.9-B/R/bin/i386" -lR -o fabia.dll
>>>>>> rm -f fabia.o *.a *.o *.so
>>>>>> installing to D:/biocbld/bbs-2.9-bioc/meat/fabia.Rcheck/fabia/libs/i386
>>>>>> ** R
>>>>>> ** demo
>>>>>> ** inst
>>>>>> ** preparing package for lazy loading
>>>>>> Creating a generic function for "plot" from package "graphics" in
>>>>>> package "fabia"
>>>>>> ** help
>>>>>> *** installing help indices
>>>>>> ** building package indices ...
>>>>>> *** tangling vignette sources ...
>>>>>> 'fabia.Rnw'
>>>>>> ** testing if installed package can be loaded
>>>>>>
>>>>>> * DONE (fabia)
>>>>>>
>>>>>> The source tarball for this package is available here:
>>>>>> http://bioconductor.org/packages/2.9/bioc/html/fabia.html
>>>>>>
>>>>>> What command should be used to perform a multiarch check of this
>>>>>> package?
>>>>>>
>>>>>> This is on a 64-bit Windows Server 2008 R2 Enterprise machine using a
>>>>>> recent combined Windows 32/64 bit binary of R-devel from CRAN.
>>>>>>
>>>>>> Thanks!
>>>>>> H.
>>>>>>
>>>>
>>>>
>>>> --
>>>> Herv? Pag?s
>>>>
>>>> Program in Computational Biology
>>>> Division of Public Health Sciences
>>>> Fred Hutchinson Cancer Research Center
>>>> 1100 Fairview Ave. N, M1-B514
>>>> P.O. Box 19024
>>>> Seattle, WA 98109-1024
>>>>
>>>> E-mail: hpages at fhcrc.org
>>>> Phone:  (206) 667-5791
>>>> Fax:    (206) 667-1319
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>
>>>
>>
>>
>> --
>> Herv? Pag?s
>>
>> Program in Computational Biology
>> Division of Public Health Sciences
>> Fred Hutchinson Cancer Research Center
>> 1100 Fairview Ave. N, M1-B514
>> P.O. Box 19024
>> Seattle, WA 98109-1024
>>
>> E-mail: hpages at fhcrc.org
>> Phone:  (206) 667-5791
>> Fax:    (206) 667-1319
>>
>>
>


-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From simon.urbanek at r-project.org  Tue Jun 28 23:20:32 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 28 Jun 2011 17:20:32 -0400
Subject: [Rd] R CMD check --force-multiarch does not install all the
	archs for testing
In-Reply-To: <4E0A4381.6020506@fhcrc.org>
References: <4E0912EE.7020105@fhcrc.org>
	<4E099478.4030609@statistik.tu-dortmund.de>
	<4E0A2507.1010904@fhcrc.org>
	<CA592CAB-B8DB-49C6-9AFD-9DB2C2087806@r-project.org>
	<4E0A2F44.3010109@fhcrc.org>
	<EBE00C6D-476A-4DA5-9CB8-A0F320D2B042@r-project.org>
	<4E0A4381.6020506@fhcrc.org>
Message-ID: <832A77AE-D195-413E-97D1-E26314F664E2@r-project.org>


On Jun 28, 2011, at 5:11 PM, Herv? Pag?s wrote:

> Simon,
> 
> On 11-06-28 01:44 PM, Simon Urbanek wrote:
>> 
>> On Jun 28, 2011, at 3:45 PM, Herv? Pag?s wrote:
>> 
>>> Hi Simon,
>>> 
>>> On 11-06-28 12:19 PM, Simon Urbanek wrote:
>>>> 
>>>> On Jun 28, 2011, at 3:01 PM, Herv? Pag?s wrote:
>>>> 
>>>>> Hi Uwe,
>>>>> 
>>>>> On 11-06-28 01:44 AM, Uwe Ligges wrote:
>>>>>> 
>>>>>> 
>>>>>> On 28.06.2011 01:31, Herv? Pag?s wrote:
>>>>>>> Hi,
>>>>>>> 
>>>>>>> Why isn't 'R CMD check --force-multiarch' installing the package
>>>>>>> for all the architectures that are going to be checked?
>>>>>> 
>>>>>> Herv?,
>>>>>> 
>>>>>> no, since it cannot know that that you need
>>>>>> 
>>>>>> --merge-multiarch
>>>>>> 
>>>>>> as an additional install flag for this particular package.
>>>>> 
>>>>> Why not just use this flag anyway? Does it hurt to use it on packages that don't strictly need it?
>>>>> 
>>>> 
>>>> It does for two reasons: a) everything is built twice
>>> 
>>> That's exactly what I want when I do 'R CMD check --force-multiarch'
>>> 
>> 
>> No, that's not what it does (and I assume you mean --force-biarch). It builds the package just once, you're simply overriding the default behavior of checking for configure.win, that's all. The two flags are orthogonal, --force-biarch makes no sense with --merge-multiarch, they are for all practical purposes mutually exclusive by definition of what they do.
> 
> I really mean --force-multiarch, not --force-biarch. AFAIK 'R CMD check'
> has no --force-biarch option.
> 
>> 
>> 
>>>> and b) package authors don't expect the necessity to support --libs-only if the package doesn't require separate build runs.
>>> 
>>> When specifying --force-multiarch, the user really expects the package to be installed for all sub-archs.
>>> 
>> 
>> ... with the assumption that the package supports it even though it has a configure script which may to may not work unlike --merge-multiarch which will always work.
> 
> Just to clarify:
> 
> --force-multiarch is an 'R CMD check' option, not an 'R CMD INSTALL'
> option
> 
> --merge-multiarch is an 'R CMD INSTALL' option, not an 'R CMD check'
> option
> 
> Now you are saying that --merge-multiarch will always work (on Windows
> of course, all this discussion is about how to achieve multiarch check
> on Windows). Great, this is what I've been observing too so far!
> On packages with or without native codes, with or without configure.win
> scripts, etc... It always seems to work. So, again, why isn't
> 'R CMD check --force-multiarch' installing with --merge-multiarch?
> Note that I'm not attached to that solution in particular, just trying
> to suggest an easy fix for 'R CMD check --force-multiarch' (which right
> now is broken on some packages).
> 
>> --force-biarch is just a way to flag packages that have configure.win that has no effect on the binary settings (flags etc.). It forces R to try multi-arch build in one flight, but it may or may not work depending on the package. It is a way to save time by not running --merge-multiarch (and thus building the package twice).
> 
> --force-biarch is an 'R CMD INSTALL' option that I don't use. Why would
> I use something that might fail when I can use --merge-multiarch which
> always works.
> 

Ok, never mind then, I was talking exclusively about R CMD INSTALL.

Cheers,
Simon


> Thanks,
> H.
> 
>> 
>> Cheers,
>> Simon
>> 
>> 
>>>> 
>>>> The cross-platform way is to not use --merge-multiarch but use --libs-only instead as needed (easy to check after the first arch run which will tell you whether it's needed or not). I suspect that --merge-multiarch is just a convenience shortcut (and it's unclear to me why it's Windows-only...).
>>> 
>>> A great convenience indeed as it allows to do the multiarch install in
>>> a single step. And it's unclear to me too why it's Windows-only but I
>>> would have hoped you would know...
>>> 
>>> Thanks,
>>> H.
>>> 
>>> 
>>>> 
>>>> Cheers,
>>>> Simon
>>>> 
>>>> 
>>>>>> You will have to check it in repository maintainer's mode (as the CRAN
>>>>>> maintainers do everywhere). Essentially this is for me (when also
>>>>>> producing WIndows binaries):
>>>>>> 
>>>>>> 
>>>>>> Step 1: Installation
>>>>>> 
>>>>>> R CMD INSTALL --pkglock --compact-docs --build --merge-multiarch
>>>>>> --library="D:/path/to/library" fabia_1.5.0.tar.gz>   fabia-install.out 2>&1
>>>>>> 
>>>>>> (where the merge-multiarch part applies only to this package, of course)
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> Step 2: Check (without installation, since that happened before already,
>>>>>> using the install log from step 1)
>>>>>> 
>>>>>> R CMD check --library="D:/path/to/library" --force-multiarch
>>>>>> --install="check:fabia-install.out" fabia
>>>>> 
>>>>> Whaoooo! Would be nice if there was a plan to make 'R CMD check' also
>>>>> usable by normal people (including the package developer), not just
>>>>> by a few privileged people that know about those undocumented tricks.
>>>>> 
>>>>> Thanks,
>>>>> H.
>>>>> 
>>>>>> 
>>>>>> Best wishes,
>>>>>> Uwe
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>>> For some packages, it only installs for the default arch ('i386').
>>>>>>> Then testing the package for 'x64' fails.
>>>>>>> 
>>>>>>> For example,
>>>>>>> 
>>>>>>> Output of R CMD check --force-multiarch fabia_1.5.0.tar.gz:
>>>>>>> -----------------------------------------------------------
>>>>>>> * using log directory 'D:/biocbld/bbs-2.9-bioc/meat/fabia.Rcheck'
>>>>>>> * using R version 2.14.0 Under development (unstable) (2011-05-30 r56020)
>>>>>>> * using platform: i386-pc-mingw32 (32-bit)
>>>>>>> * using session charset: ISO8859-1
>>>>>>> * using option '--no-vignettes'
>>>>>>> * checking for file 'fabia/DESCRIPTION' ... OK
>>>>>>> * this is package 'fabia' version '1.5.0'
>>>>>>> * checking package name space information ... OK
>>>>>>> * checking package dependencies ... OK
>>>>>>> * checking if this is a source package ... OK
>>>>>>> * checking whether package 'fabia' can be installed ... OK
>>>>>>> * checking installed package size ... OK
>>>>>>> * checking package directory ... OK
>>>>>>> * checking for portable file names ... OK
>>>>>>> * checking DESCRIPTION meta-information ... OK
>>>>>>> * checking top-level files ... OK
>>>>>>> * checking index information ... OK
>>>>>>> * checking package subdirectories ... OK
>>>>>>> * checking R files for non-ASCII characters ... OK
>>>>>>> * checking R files for syntax errors ... OK
>>>>>>> * loading checks for arch 'i386'
>>>>>>> ** checking whether the package can be loaded ... OK
>>>>>>> ** checking whether the package can be loaded with stated dependencies
>>>>>>> ... OK
>>>>>>> ** checking whether the package can be unloaded cleanly ... OK
>>>>>>> ** checking whether the name space can be loaded with stated
>>>>>>> dependencies ... OK
>>>>>>> ** checking whether the name space can be unloaded cleanly ... OK
>>>>>>> * loading checks for arch 'x64'
>>>>>>> ** checking whether the package can be loaded ...Warning: running
>>>>>>> command '"D:/biocbld/bbs-2.9-bioc/R/bin/x64/Rterm.exe"
>>>>>>> R_ENVIRON_USER='no_such_file' --no-site-file --no-init-file --no-save
>>>>>>> --no-restore --slave -f
>>>>>>> D:\biocbld\bbs-2.9-bioc\tmpdir\RtmpO65p5H\Rin57456988' had status 1
>>>>>>> ERROR
>>>>>>> Error: package 'fabia' is not installed for 'arch=x64'
>>>>>>> Execution halted
>>>>>>> 
>>>>>>> It looks like this package has a loading problem: see the messages for
>>>>>>> details.
>>>>>>> 
>>>>>>> Content of fabia.Rcheck\00install.out:
>>>>>>> --------------------------------------
>>>>>>> 
>>>>>>> * installing *source* package 'fabia' ...
>>>>>>> Building libRcpp.a in RcppSrc...
>>>>>>> rm -f Rcpp.o libRcpp.a
>>>>>>> g++ -c Rcpp.cpp -o Rcpp.o -I"D:/biocbld/BBS-2?1.9-B/R/include"
>>>>>>> -I"D:/biocbld/BBS-2?1.9-B/R/src/include" -Wall -O2
>>>>>>> ar r libRcpp.a Rcpp.o
>>>>>>> C:\Rtools213\MinGW\bin\ar.exe: creating libRcpp.a
>>>>>>> ranlib libRcpp.a
>>>>>>> rm -f Rcpp.o
>>>>>>> rm -f Rcpp.o
>>>>>>> ** libs
>>>>>>> running src/Makefile.win ...
>>>>>>> rm -f fabia.o fabia.dll *.a *.o *.so *.dll
>>>>>>> g++ -c fabiac.cpp -o fabia.o -I../RcppSrc
>>>>>>> -I"D:/biocbld/BBS-2?1.9-B/R/include" -Wall -O2
>>>>>>> g++ -shared -s -static-libgcc fabia.o -L../RcppSrc -lRcpp
>>>>>>> -L"D:/biocbld/BBS-2?1.9-B/R/bin/i386" -lR -o fabia.dll
>>>>>>> rm -f fabia.o *.a *.o *.so
>>>>>>> installing to D:/biocbld/bbs-2.9-bioc/meat/fabia.Rcheck/fabia/libs/i386
>>>>>>> ** R
>>>>>>> ** demo
>>>>>>> ** inst
>>>>>>> ** preparing package for lazy loading
>>>>>>> Creating a generic function for "plot" from package "graphics" in
>>>>>>> package "fabia"
>>>>>>> ** help
>>>>>>> *** installing help indices
>>>>>>> ** building package indices ...
>>>>>>> *** tangling vignette sources ...
>>>>>>> 'fabia.Rnw'
>>>>>>> ** testing if installed package can be loaded
>>>>>>> 
>>>>>>> * DONE (fabia)
>>>>>>> 
>>>>>>> The source tarball for this package is available here:
>>>>>>> http://bioconductor.org/packages/2.9/bioc/html/fabia.html
>>>>>>> 
>>>>>>> What command should be used to perform a multiarch check of this
>>>>>>> package?
>>>>>>> 
>>>>>>> This is on a 64-bit Windows Server 2008 R2 Enterprise machine using a
>>>>>>> recent combined Windows 32/64 bit binary of R-devel from CRAN.
>>>>>>> 
>>>>>>> Thanks!
>>>>>>> H.
>>>>>>> 
>>>>> 
>>>>> 
>>>>> --
>>>>> Herv? Pag?s
>>>>> 
>>>>> Program in Computational Biology
>>>>> Division of Public Health Sciences
>>>>> Fred Hutchinson Cancer Research Center
>>>>> 1100 Fairview Ave. N, M1-B514
>>>>> P.O. Box 19024
>>>>> Seattle, WA 98109-1024
>>>>> 
>>>>> E-mail: hpages at fhcrc.org
>>>>> Phone:  (206) 667-5791
>>>>> Fax:    (206) 667-1319
>>>>> 
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>> 
>>>>> 
>>>> 
>>> 
>>> 
>>> --
>>> Herv? Pag?s
>>> 
>>> Program in Computational Biology
>>> Division of Public Health Sciences
>>> Fred Hutchinson Cancer Research Center
>>> 1100 Fairview Ave. N, M1-B514
>>> P.O. Box 19024
>>> Seattle, WA 98109-1024
>>> 
>>> E-mail: hpages at fhcrc.org
>>> Phone:  (206) 667-5791
>>> Fax:    (206) 667-1319
>>> 
>>> 
>> 
> 
> 
> -- 
> Herv? Pag?s
> 
> Program in Computational Biology
> Division of Public Health Sciences
> Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N, M1-B514
> P.O. Box 19024
> Seattle, WA 98109-1024
> 
> E-mail: hpages at fhcrc.org
> Phone:  (206) 667-5791
> Fax:    (206) 667-1319
> 
> 


From hadley at rice.edu  Tue Jun 28 23:42:49 2011
From: hadley at rice.edu (Hadley Wickham)
Date: Tue, 28 Jun 2011 16:42:49 -0500
Subject: [Rd] Small bug in install.packages?
In-Reply-To: <D7C3B3C4-5ED9-4170-8E4A-BD9EFD00A6BF@r-project.org>
References: <BANLkTinuHoNi4oQaaC9B1hhMgpdACyfKOw@mail.gmail.com>
	<D7C3B3C4-5ED9-4170-8E4A-BD9EFD00A6BF@r-project.org>
Message-ID: <BANLkTi=1W9+d1GO6vHgaZOjxMFaOqzQDTA@mail.gmail.com>

> Isn't R.home() 8.3 path anyway?

I don't think so:

> R.home("bin")
[1] "C:/Program Files/R/R-2.13.0/bin/i386"
> sessionInfo()
R version 2.13.0 Patched (2011-06-09 r56106)
Platform: i386-pc-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] grDevices datasets  utils     stats     graphics  methods   base

other attached packages:
[1] RMark_2.0.5     rj_0.5.0-5      devtools_0.2    codetools_0.2-8
[5] plotrix_3.2-2   nlme_3.1-101    msm_1.0.1

loaded via a namespace (and not attached):
[1] grid_2.13.0      lattice_0.19-26  mvtnorm_0.9-9991 rJava_0.8-8
[5] splines_2.13.0   survival_2.36-9  tools_2.13.0

> BTW: I think you probably meant more something like paste(shQuote(file.path(R.home("bin"), "R")), "CMD INSTALL") since the above won't work ..

Ooops, yes.

Hadley


-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From josh.m.ulrich at gmail.com  Wed Jun 29 00:04:06 2011
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Tue, 28 Jun 2011 17:04:06 -0500
Subject: [Rd] Small bug in install.packages?
In-Reply-To: <BANLkTi=1W9+d1GO6vHgaZOjxMFaOqzQDTA@mail.gmail.com>
References: <BANLkTinuHoNi4oQaaC9B1hhMgpdACyfKOw@mail.gmail.com>
	<D7C3B3C4-5ED9-4170-8E4A-BD9EFD00A6BF@r-project.org>
	<BANLkTi=1W9+d1GO6vHgaZOjxMFaOqzQDTA@mail.gmail.com>
Message-ID: <BANLkTikd=KOec8pow_h3L4zf5MdY3O9UTQ@mail.gmail.com>

It is 8.3 on my install of 2.13.0 (release) and I get the same results
with the current R-patched.

> R.home("bin")
[1] "C:/PROGRA~1/R/R-213~1.0PA/bin/i386"
> sessionInfo()
R version 2.13.0 Patched (2011-06-20 r56188)
Platform: i386-pc-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

--
Joshua Ulrich ?| ?FOSS Trading: www.fosstrading.com



On Tue, Jun 28, 2011 at 4:42 PM, Hadley Wickham <hadley at rice.edu> wrote:
>> Isn't R.home() 8.3 path anyway?
>
> I don't think so:
>
>> R.home("bin")
> [1] "C:/Program Files/R/R-2.13.0/bin/i386"
>> sessionInfo()
> R version 2.13.0 Patched (2011-06-09 r56106)
> Platform: i386-pc-mingw32/i386 (32-bit)
>
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] grDevices datasets ?utils ? ? stats ? ? graphics ?methods ? base
>
> other attached packages:
> [1] RMark_2.0.5 ? ? rj_0.5.0-5 ? ? ?devtools_0.2 ? ?codetools_0.2-8
> [5] plotrix_3.2-2 ? nlme_3.1-101 ? ?msm_1.0.1
>
> loaded via a namespace (and not attached):
> [1] grid_2.13.0 ? ? ?lattice_0.19-26 ?mvtnorm_0.9-9991 rJava_0.8-8
> [5] splines_2.13.0 ? survival_2.36-9 ?tools_2.13.0
>
>> BTW: I think you probably meant more something like paste(shQuote(file.path(R.home("bin"), "R")), "CMD INSTALL") since the above won't work ..
>
> Ooops, yes.
>
> Hadley
>
>
> --
> Assistant Professor / Dobelman Family Junior Chair
> Department of Statistics / Rice University
> http://had.co.nz/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From murdoch.duncan at gmail.com  Wed Jun 29 02:17:46 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 28 Jun 2011 20:17:46 -0400
Subject: [Rd] Small bug in install.packages?
In-Reply-To: <BANLkTi=1W9+d1GO6vHgaZOjxMFaOqzQDTA@mail.gmail.com>
References: <BANLkTinuHoNi4oQaaC9B1hhMgpdACyfKOw@mail.gmail.com>	<D7C3B3C4-5ED9-4170-8E4A-BD9EFD00A6BF@r-project.org>
	<BANLkTi=1W9+d1GO6vHgaZOjxMFaOqzQDTA@mail.gmail.com>
Message-ID: <4E0A6F2A.20704@gmail.com>

On 28/06/2011 5:42 PM, Hadley Wickham wrote:
>> Isn't R.home() 8.3 path anyway?
>
> I don't think so:
>
>> R.home("bin")
> [1] "C:/Program Files/R/R-2.13.0/bin/i386"

Weird.  Like others, I see 8.3 pathnames.  R gets those from a Windows 
call; what version of Windows are you using?

Duncan Murdoch

>> sessionInfo()
> R version 2.13.0 Patched (2011-06-09 r56106)
> Platform: i386-pc-mingw32/i386 (32-bit)
>
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] grDevices datasets  utils     stats     graphics  methods   base
>
> other attached packages:
> [1] RMark_2.0.5     rj_0.5.0-5      devtools_0.2    codetools_0.2-8
> [5] plotrix_3.2-2   nlme_3.1-101    msm_1.0.1
>
> loaded via a namespace (and not attached):
> [1] grid_2.13.0      lattice_0.19-26  mvtnorm_0.9-9991 rJava_0.8-8
> [5] splines_2.13.0   survival_2.36-9  tools_2.13.0
>
>> BTW: I think you probably meant more something like paste(shQuote(file.path(R.home("bin"), "R")), "CMD INSTALL") since the above won't work ..
>
> Ooops, yes.
>
> Hadley
>
>


From murdoch.duncan at gmail.com  Wed Jun 29 02:31:22 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 28 Jun 2011 20:31:22 -0400
Subject: [Rd] Small bug in install.packages?
In-Reply-To: <4E0A6F2A.20704@gmail.com>
References: <BANLkTinuHoNi4oQaaC9B1hhMgpdACyfKOw@mail.gmail.com>	<D7C3B3C4-5ED9-4170-8E4A-BD9EFD00A6BF@r-project.org>
	<BANLkTi=1W9+d1GO6vHgaZOjxMFaOqzQDTA@mail.gmail.com>
	<4E0A6F2A.20704@gmail.com>
Message-ID: <4E0A725A.9090206@gmail.com>

On 28/06/2011 8:17 PM, Duncan Murdoch wrote:
> On 28/06/2011 5:42 PM, Hadley Wickham wrote:
>>> Isn't R.home() 8.3 path anyway?
>>
>> I don't think so:
>>
>>> R.home("bin")
>> [1] "C:/Program Files/R/R-2.13.0/bin/i386"
>
> Weird.  Like others, I see 8.3 pathnames.  R gets those from a Windows
> call; what version of Windows are you using?

... and how are you starting R?  Startup goes through some contortions 
to handle all the different possibilities; maybe one of them is missing 
the path-shortening step.

Duncan Murdoch

>
> Duncan Murdoch
>
>>> sessionInfo()
>> R version 2.13.0 Patched (2011-06-09 r56106)
>> Platform: i386-pc-mingw32/i386 (32-bit)
>>
>> locale:
>> [1] LC_COLLATE=English_United States.1252
>> [2] LC_CTYPE=English_United States.1252
>> [3] LC_MONETARY=English_United States.1252
>> [4] LC_NUMERIC=C
>> [5] LC_TIME=English_United States.1252
>>
>> attached base packages:
>> [1] grDevices datasets  utils     stats     graphics  methods   base
>>
>> other attached packages:
>> [1] RMark_2.0.5     rj_0.5.0-5      devtools_0.2    codetools_0.2-8
>> [5] plotrix_3.2-2   nlme_3.1-101    msm_1.0.1
>>
>> loaded via a namespace (and not attached):
>> [1] grid_2.13.0      lattice_0.19-26  mvtnorm_0.9-9991 rJava_0.8-8
>> [5] splines_2.13.0   survival_2.36-9  tools_2.13.0
>>
>>> BTW: I think you probably meant more something like paste(shQuote(file.path(R.home("bin"), "R")), "CMD INSTALL") since the above won't work ..
>>
>> Ooops, yes.
>>
>> Hadley
>>
>>
>


From renaud at mancala.cbio.uct.ac.za  Wed Jun 29 09:03:52 2011
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Wed, 29 Jun 2011 09:03:52 +0200
Subject: [Rd] [R-sig-hpc] doMC - compiler - concatenate an expression
 vector into a single expression?
In-Reply-To: <BANLkTimeQhSMo=zrAO8whDnAeHKRU2ZsiQ@mail.gmail.com>
References: <4E09C885.4050108@cbio.uct.ac.za>
	<BANLkTimeQhSMo=zrAO8whDnAeHKRU2ZsiQ@mail.gmail.com>
Message-ID: <4E0ACE58.6020204@cbio.uct.ac.za>

Thank you very much Steve.
Your suggestion works perfectly -- at least with doSEQ, doMC and doMPI.

Bests,
Renaud


On 28/06/2011 15:35, Stephen Weston wrote:
> I think that the result of the concatenation should be a call object,
> rather than an expression object.  How about something along the
> lines of:
>
> '%dopar2%'<- function(obj, ex) {
>    ex<- as.call(list(as.name('{'),
>                            quote({ a<- i; message("Custom ", a) }),
>                            substitute(ex)))
>    do.call('%dopar%', list(obj, ex), envir=parent.frame())
> }
>
> - Steve
>
>
> On Tue, Jun 28, 2011 at 8:26 AM, Renaud Gaujoux
> <renaud at mancala.cbio.uct.ac.za>  wrote:
>> Hi,
>>
>> this post is about foreach operators, the compiler package and the last
>> update of doMC that includes support for the compiler functionality.
>>
>> I am using a home-made %dopar%-like operator that adds some custom
>> expression to be executed before the foreach loop expression itself (see
>> sample code below).
>> It used to work perfectly with doMC 1.2.1, but with the introduction of
>> the compiler functionality, things do not work properly.
>> The change in the doMC package consists in evaluating a compiled
>> expression instead of the original R expression:
>>
>> # from doMC:::doMC ...
>> c.expr<- comp(expr, env = envir, options = list(suppressUndefined = TRUE))
>>
>> and for R>= 2.13.0 comp is defined as compiler::compile:
>> function (e, env = .GlobalEnv, options = NULL)
>> {
>>     cenv<- makeCenv(env)
>>     cntxt<- make.toplevelContext(cenv, options)
>>     cntxt$env<- addCenvVars(cenv, findLocals(e, cntxt))
>>     genCode(e, cntxt)
>> }
>> <environment: namespace:compiler>
>>
>> My guess is that the function findLocals or genCode can not handle a
>> 2-length expression vector.
>>
>> Maybe somebody who knows the internals of these functions could explain
>> better this behaviour?
>> How can I concatenate two expressions into a single one?
>>
>> Thank you,
>> Renaud
>>
>>
>> ##################################################
>> # Sample code
>> ##################################################
>>
>> `%dopar2%`<- function(obj, ex){
>>
>>     # append custom code to the expression
>>     ex<- c(expression({ a<- i; message("Custom ", a);}), substitute(ex))
>>
>>     # call the standard %dopar% operator
>>     do.call(`%dopar%`, list(obj, ex), envir=parent.frame() )
>> }
>> res<- foreach(i=1:3) %dopar2% { print(i); i*2; }
>> res
>>
>>
>> #########################
>> # Output with doSEQ or doMC 1.2.1
>> #########################
>> Custom 1
>> [1] 1
>> Custom 2
>> [1] 2
>> Custom 3
>> [1] 3
>>>   res
>> [[1]]
>> [1] 2
>>
>> [[2]]
>> [1] 4
>>
>> [[3]]
>> [1] 6
>>
>>
>> #########################
>> # Output with doMC 1.2.2
>> #########################
>>
>> [[1]]
>> expression({
>>     a<- i
>>     message("Custom ", a)
>> }, {
>>     print(i)
>>     i * 2
>> })
>>
>> [[2]]
>> expression({
>>     a<- i
>>     message("Custom ", a)
>> }, {
>>     print(i)
>>     i * 2
>> })
>>
>> [[3]]
>> expression({
>>     a<- i
>>     message("Custom ", a)
>> }, {
>>     print(i)
>>     i * 2
>> })
>>
>>
>>
>>
>>
>> ###
>> UNIVERSITY OF CAPE TOWN
>> This e-mail is subject to the UCT ICT policies and e-mai...{{dropped:5}}
>>
>> _______________________________________________
>> R-sig-hpc mailing list
>> R-sig-hpc at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-hpc
>>

 

###
UNIVERSITY OF CAPE TOWN 

This e-mail is subject to the UCT ICT policies and e-mai...{{dropped:5}}


From soeren.vogel at uzh.ch  Wed Jun 29 11:33:44 2011
From: soeren.vogel at uzh.ch (soeren.vogel at uzh.ch)
Date: Wed, 29 Jun 2011 11:33:44 +0200
Subject: [Rd] Compilation error Mac binary
Message-ID: <F6167619-EE98-4827-8D74-FF50AED840AB@uzh.ch>

Hello, the compilation of the GUTS package on CRAN for Mac produces the following error messages:

http://www.r-project.org/nosvn/R.check/r-release-macosx-ix86/GUTS-00install.html

I guess it is some namespace collision, but I can not reproduce it on my machine, it compiles fine here. What is the cause and which setup do I need to reproduce the errors?

R: version
platform       i386-apple-darwin9.8.0
arch           i386
os             darwin9.8.0
system         i386, darwin9.8.0
status
major          2
minor          13.0
year           2011
month          04
day            13
svn rev        55427
language       R
version.string R version 2.13.0 (2011-04-13)

I ~ $: gcc --version
i686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5666) (dot 3)
Copyright (C) 2007 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

I ~ $: less /opt/local/include/boost/version.hpp
//  Boost version.hpp configuration header file  ------------------------------//
[...]
#define BOOST_VERSION 104601
#define BOOST_LIB_VERSION "1_46_1"
[...]


From john.maindonald at anu.edu.au  Wed Jun 29 13:41:32 2011
From: john.maindonald at anu.edu.au (John Maindonald)
Date: Wed, 29 Jun 2011 21:41:32 +1000
Subject: [Rd] R-devel Digest, Vol 100, Issue 28
In-Reply-To: <mailman.14.1309341605.28247.r-devel@r-project.org>
References: <mailman.14.1309341605.28247.r-devel@r-project.org>
Message-ID: <A77F9796-2F95-41AA-86B1-BA7F05018EFF@anu.edu.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110629/c23688f9/attachment.pl>

From dwinsemius at comcast.net  Wed Jun 29 15:56:26 2011
From: dwinsemius at comcast.net (David Winsemius)
Date: Wed, 29 Jun 2011 09:56:26 -0400
Subject: [Rd] Compilation error Mac binary
In-Reply-To: <F6167619-EE98-4827-8D74-FF50AED840AB@uzh.ch>
References: <F6167619-EE98-4827-8D74-FF50AED840AB@uzh.ch>
Message-ID: <BEE8EEB7-4A4E-4AC7-A8FB-437E20EDB81B@comcast.net>


On Jun 29, 2011, at 5:33 AM, soeren.vogel at uzh.ch wrote:

> Hello, the compilation of the GUTS package on CRAN for Mac produces  
> the following error messages:
>
> http://www.r-project.org/nosvn/R.check/r-release-macosx-ix86/GUTS-00install.html
>
> I guess it is some namespace collision, but I can not reproduce it  
> on my machine, it compiles fine here. What is the cause and which  
> setup do I need to reproduce the errors?


I was going to suggest you take this up with the maintainers... but  
you _are_ one of the maintainers.

Here is the output from an attempt to compile from source, version  
0.1.45, with a relatively recent version of R 2.13.0 (but not the most  
recent and I still use Mac OSX 10.5.8). Perhaps its brevity will be  
helpful, and the fact that it seems to identify different error than  
those flagged in the log at CRAN.

trying URL 'http://lib.stat.cmu.edu/R/CRAN/src/contrib/GUTS_0.1.45.tar.gz'
Content type 'application/x-gzip' length 9842 bytes
opened URL
==================================================
downloaded 9842 bytes

Loading required package: lattice
Loading required package: sos
Loading required package: brew
[1] "2011-06-29 09:40:18 EDT"
* installing *source* package ?GUTS? ...
** libs
*** arch - i386
g++ -arch i386 -I/Library/Frameworks/R.framework/Resources/include -I/ 
Library/Frameworks/R.framework/Resources/include/i386 -I/opt/local/ 
include -I/usr/local/include -I"/Library/Frameworks/R.framework/ 
Versions/2.13/Resources/library/Rcpp/include"   -fPIC  -g -O2 -c  
GUTS.cpp -o GUTS.o
In file included from GUTS.cpp:12:
GUTS.h:21:28: error: boost/random.hpp: No such file or directory
GUTS.h:22:40: error: boost/math/distributions.hpp: No such file or  
directory
GUTS.cpp: In function ?void to_print(double)?:
GUTS.cpp:277: error: ?cout? was not declared in this scope
GUTS.cpp: In member function ?void GUTS::showObject()?:
GUTS.cpp:281: error: ?cout? is not a member of ?std?
GUTS.cpp:284: error: ?cout? was not declared in this scope
make: *** [GUTS.o] Error 1
ERROR: compilation failed for package ?GUTS?
* removing ?/Library/Frameworks/R.framework/Versions/2.13/Resources/ 
library/GUTS?

 > sessionInfo()
R version 2.13.0 beta (2011-04-04 r55296)
Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)

locale:
[1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] mgcv_1.7-6      sos_1.3-0       brew_1.0-6      lattice_0.19-26

loaded via a namespace (and not attached):
[1] grid_2.13.0        Matrix_0.999375-50 nlme_3.1-101        
tools_2.13.0

-- 
David.


>
> R: version
> platform       i386-apple-darwin9.8.0
> arch           i386
> os             darwin9.8.0
> system         i386, darwin9.8.0
> status
> major          2
> minor          13.0
> year           2011
> month          04
> day            13
> svn rev        55427
> language       R
> version.string R version 2.13.0 (2011-04-13)
>
> I ~ $: gcc --version
> i686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5666)  
> (dot 3)
> Copyright (C) 2007 Free Software Foundation, Inc.
> This is free software; see the source for copying conditions.  There  
> is NO
> warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR  
> PURPOSE.
>
> I ~ $: less /opt/local/include/boost/version.hpp
> //  Boost version.hpp configuration header file   
> ------------------------------//
> [...]
> #define BOOST_VERSION 104601
> #define BOOST_LIB_VERSION "1_46_1"
> [...]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

David Winsemius, MD
West Hartford, CT


From soeren.vogel at uzh.ch  Wed Jun 29 17:14:29 2011
From: soeren.vogel at uzh.ch (soeren.vogel at uzh.ch)
Date: Wed, 29 Jun 2011 17:14:29 +0200
Subject: [Rd] Compilation error Mac binary
In-Reply-To: <BEE8EEB7-4A4E-4AC7-A8FB-437E20EDB81B@comcast.net>
References: <F6167619-EE98-4827-8D74-FF50AED840AB@uzh.ch>
	<BEE8EEB7-4A4E-4AC7-A8FB-437E20EDB81B@comcast.net>
Message-ID: <EE02A6DC-5371-4775-8EF6-686750FB0527@uzh.ch>

Hello David

On 29.06.2011, at 15:56, David Winsemius wrote:

> On Jun 29, 2011, at 5:33 AM, soeren.vogel at uzh.ch wrote:
> 
>> Hello, the compilation of the GUTS package on CRAN for Mac produces the following error messages:
>> 
>> http://www.r-project.org/nosvn/R.check/r-release-macosx-ix86/GUTS-00install.html
>> 
>> I guess it is some namespace collision, but I can not reproduce it on my machine, it compiles fine here. What is the cause and which setup do I need to reproduce the errors?
> 
> I was going to suggest you take this up with the maintainers... but you _are_ one of the maintainers.

:-)

> Here is the output from an attempt to compile from source, version 0.1.45, with a relatively recent version of R 2.13.0 (but not the most recent and I still use Mac OSX 10.5.8). Perhaps its brevity will be helpful, and the fact that it seems to identify different error than those flagged in the log at CRAN.

Thanks for your answer. The failure on your side is clear to me: there is no installation of the boost C++ library in any of the standard include locations. I have added /opt/local/include in Makevars (Mac Ports installation of C source packages), however, I know I should but still I am reluctant to write a configure script that could circumvent non-standard installations of boost on UNIX machines.

So thanks for the output, but the CRAN messages must point to something different...

Regards
S?ren

> trying URL 'http://lib.stat.cmu.edu/R/CRAN/src/contrib/GUTS_0.1.45.tar.gz'
> Content type 'application/x-gzip' length 9842 bytes
> opened URL
> ==================================================
> downloaded 9842 bytes
> 
> Loading required package: lattice
> Loading required package: sos
> Loading required package: brew
> [1] "2011-06-29 09:40:18 EDT"
> * installing *source* package ?GUTS? ...
> ** libs
> *** arch - i386
> g++ -arch i386 -I/Library/Frameworks/R.framework/Resources/include -I/Library/Frameworks/R.framework/Resources/include/i386 -I/opt/local/include -I/usr/local/include -I"/Library/Frameworks/R.framework/Versions/2.13/Resources/library/Rcpp/include"   -fPIC  -g -O2 -c GUTS.cpp -o GUTS.o
> In file included from GUTS.cpp:12:
> GUTS.h:21:28: error: boost/random.hpp: No such file or directory
> GUTS.h:22:40: error: boost/math/distributions.hpp: No such file or directory
> GUTS.cpp: In function ?void to_print(double)?:
> GUTS.cpp:277: error: ?cout? was not declared in this scope
> GUTS.cpp: In member function ?void GUTS::showObject()?:
> GUTS.cpp:281: error: ?cout? is not a member of ?std?
> GUTS.cpp:284: error: ?cout? was not declared in this scope
> make: *** [GUTS.o] Error 1
> ERROR: compilation failed for package ?GUTS?
> * removing ?/Library/Frameworks/R.framework/Versions/2.13/Resources/library/GUTS?
> 
> > sessionInfo()
> R version 2.13.0 beta (2011-04-04 r55296)
> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
> 
> locale:
> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> other attached packages:
> [1] mgcv_1.7-6      sos_1.3-0       brew_1.0-6      lattice_0.19-26
> 
> loaded via a namespace (and not attached):
> [1] grid_2.13.0        Matrix_0.999375-50 nlme_3.1-101       tools_2.13.0
> 
> -- 
> David.
> 
> 
>> 
>> R: version
>> platform       i386-apple-darwin9.8.0
>> arch           i386
>> os             darwin9.8.0
>> system         i386, darwin9.8.0
>> status
>> major          2
>> minor          13.0
>> year           2011
>> month          04
>> day            13
>> svn rev        55427
>> language       R
>> version.string R version 2.13.0 (2011-04-13)
>> 
>> I ~ $: gcc --version
>> i686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5666) (dot 3)
>> Copyright (C) 2007 Free Software Foundation, Inc.
>> This is free software; see the source for copying conditions.  There is NO
>> warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
>> 
>> I ~ $: less /opt/local/include/boost/version.hpp
>> //  Boost version.hpp configuration header file  ------------------------------//
>> [...]
>> #define BOOST_VERSION 104601
>> #define BOOST_LIB_VERSION "1_46_1"
>> [...]
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> David Winsemius, MD
> West Hartford, CT
> 
> 


From janko.thyson.rstuff at googlemail.com  Wed Jun 29 18:36:24 2011
From: janko.thyson.rstuff at googlemail.com (Janko Thyson)
Date: Wed, 29 Jun 2011 18:36:24 +0200
Subject: [Rd] Ref Classes: bug with using '.self' within initialize methods?
Message-ID: <4E0B5488.4030604@googlemail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110629/7c80d298/attachment.pl>

From hadley at rice.edu  Wed Jun 29 18:47:18 2011
From: hadley at rice.edu (Hadley Wickham)
Date: Wed, 29 Jun 2011 11:47:18 -0500
Subject: [Rd] Small bug in install.packages?
In-Reply-To: <4E0A725A.9090206@gmail.com>
References: <BANLkTinuHoNi4oQaaC9B1hhMgpdACyfKOw@mail.gmail.com>
	<D7C3B3C4-5ED9-4170-8E4A-BD9EFD00A6BF@r-project.org>
	<BANLkTi=1W9+d1GO6vHgaZOjxMFaOqzQDTA@mail.gmail.com>
	<4E0A6F2A.20704@gmail.com> <4E0A725A.9090206@gmail.com>
Message-ID: <BANLkTim-J0__2JcO0TwvM64+BXM6g0uEdw@mail.gmail.com>

>>>> R.home("bin")
>>>
>>> [1] "C:/Program Files/R/R-2.13.0/bin/i386"
>>
>> Weird. ?Like others, I see 8.3 pathnames. ?R gets those from a Windows
>> call; what version of Windows are you using?
>
> ... and how are you starting R? ?Startup goes through some contortions to
> handle all the different possibilities; maybe one of them is missing the
> path-shortening step.

Ok, this was coming from R running within eclipse, via rj.  (This is
not my setup, but a collaborator's)

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From ligges at statistik.tu-dortmund.de  Wed Jun 29 19:09:46 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Wed, 29 Jun 2011 19:09:46 +0200
Subject: [Rd] R-devel Digest, Vol 100, Issue 28
In-Reply-To: <A77F9796-2F95-41AA-86B1-BA7F05018EFF@anu.edu.au>
References: <mailman.14.1309341605.28247.r-devel@r-project.org>
	<A77F9796-2F95-41AA-86B1-BA7F05018EFF@anu.edu.au>
Message-ID: <4E0B5C5A.5030603@statistik.tu-dortmund.de>



On 29.06.2011 13:41, John Maindonald wrote:
> I get the same style of path as Hadley.  This is on Windows 7 Home Premium with SP1.
> I start R by clicking on the R-2.31.0 icon.
>
> I'd assumed that it was a change that came with R-2.13.0!
> (On 32-bit Windows XP, which I have just checked, I do indeed get the 8.3 paths.)
>
>> R.home()
> [1] "C:/Programs/R/R-2.13.0"


No, you got the same as Duncan: This is 8.3 compatible.

Uwe


>> sessionInfo()
> R version 2.13.0 (2011-04-13)
> Platform: x86_64-pc-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=English_Australia.1252
> [2] LC_CTYPE=English_Australia.1252
> [3] LC_MONETARY=English_Australia.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_Australia.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets
> [6] methods   base
>
> John Maindonald             email: john.maindonald at anu.edu.au
> phone : +61 2 (6125)3473    fax  : +61 2(6125)5549
> Centre for Mathematics&  Its Applications, Room 1194,
> John Dedman Mathematical Sciences Building (Building 27)
> Australian National University, Canberra ACT 0200.
> http://www.maths.anu.edu.au/~johnm
>
>> From: Duncan Murdoch<murdoch.duncan at gmail.com>
>> Date: 29 June 2011 10:17:46 AM AEST
>> To: Hadley Wickham<hadley at rice.edu>
>> Cc: Simon Urbanek<simon.urbanek at r-project.org>, r-devel at r-project.org
>> Subject: Re: [Rd] Small bug in install.packages?
>>
>>
>> On 28/06/2011 5:42 PM, Hadley Wickham wrote:
>>>> Isn't R.home() 8.3 path anyway?
>>>
>>> I don't think so:
>>>
>>>> R.home("bin")
>>> [1] "C:/Program Files/R/R-2.13.0/bin/i386"
>>
>> Weird.  Like others, I see 8.3 pathnames.  R gets those from a Windows call; what version of Windows are you using?
>>
>> Duncan Murdoch
>>
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ligges at statistik.tu-dortmund.de  Wed Jun 29 19:12:38 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Wed, 29 Jun 2011 19:12:38 +0200
Subject: [Rd] Compilation error Mac binary
In-Reply-To: <EE02A6DC-5371-4775-8EF6-686750FB0527@uzh.ch>
References: <F6167619-EE98-4827-8D74-FF50AED840AB@uzh.ch>	<BEE8EEB7-4A4E-4AC7-A8FB-437E20EDB81B@comcast.net>
	<EE02A6DC-5371-4775-8EF6-686750FB0527@uzh.ch>
Message-ID: <4E0B5D06.5030209@statistik.tu-dortmund.de>

Looks like a different boost version than the one you require.
I'd suggest to talk to the Mac maintainer, Simon Urbanek (CCing).

Best,
Uwe Ligges





On 29.06.2011 17:14, soeren.vogel at uzh.ch wrote:
> Hello David
>
> On 29.06.2011, at 15:56, David Winsemius wrote:
>
>> On Jun 29, 2011, at 5:33 AM, soeren.vogel at uzh.ch wrote:
>>
>>> Hello, the compilation of the GUTS package on CRAN for Mac produces the following error messages:
>>>
>>> http://www.r-project.org/nosvn/R.check/r-release-macosx-ix86/GUTS-00install.html
>>>
>>> I guess it is some namespace collision, but I can not reproduce it on my machine, it compiles fine here. What is the cause and which setup do I need to reproduce the errors?
>>
>> I was going to suggest you take this up with the maintainers... but you _are_ one of the maintainers.
>
> :-)
>
>> Here is the output from an attempt to compile from source, version 0.1.45, with a relatively recent version of R 2.13.0 (but not the most recent and I still use Mac OSX 10.5.8). Perhaps its brevity will be helpful, and the fact that it seems to identify different error than those flagged in the log at CRAN.
>
> Thanks for your answer. The failure on your side is clear to me: there is no installation of the boost C++ library in any of the standard include locations. I have added /opt/local/include in Makevars (Mac Ports installation of C source packages), however, I know I should but still I am reluctant to write a configure script that could circumvent non-standard installations of boost on UNIX machines.
>
> So thanks for the output, but the CRAN messages must point to something different...
>
> Regards
> S?ren
>
>> trying URL 'http://lib.stat.cmu.edu/R/CRAN/src/contrib/GUTS_0.1.45.tar.gz'
>> Content type 'application/x-gzip' length 9842 bytes
>> opened URL
>> ==================================================
>> downloaded 9842 bytes
>>
>> Loading required package: lattice
>> Loading required package: sos
>> Loading required package: brew
>> [1] "2011-06-29 09:40:18 EDT"
>> * installing *source* package ?GUTS? ...
>> ** libs
>> *** arch - i386
>> g++ -arch i386 -I/Library/Frameworks/R.framework/Resources/include -I/Library/Frameworks/R.framework/Resources/include/i386 -I/opt/local/include -I/usr/local/include -I"/Library/Frameworks/R.framework/Versions/2.13/Resources/library/Rcpp/include"   -fPIC  -g -O2 -c GUTS.cpp -o GUTS.o
>> In file included from GUTS.cpp:12:
>> GUTS.h:21:28: error: boost/random.hpp: No such file or directory
>> GUTS.h:22:40: error: boost/math/distributions.hpp: No such file or directory
>> GUTS.cpp: In function ?void to_print(double)?:
>> GUTS.cpp:277: error: ?cout? was not declared in this scope
>> GUTS.cpp: In member function ?void GUTS::showObject()?:
>> GUTS.cpp:281: error: ?cout? is not a member of ?std?
>> GUTS.cpp:284: error: ?cout? was not declared in this scope
>> make: *** [GUTS.o] Error 1
>> ERROR: compilation failed for package ?GUTS?
>> * removing ?/Library/Frameworks/R.framework/Versions/2.13/Resources/library/GUTS?
>>
>>> sessionInfo()
>> R version 2.13.0 beta (2011-04-04 r55296)
>> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
>>
>> locale:
>> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> other attached packages:
>> [1] mgcv_1.7-6      sos_1.3-0       brew_1.0-6      lattice_0.19-26
>>
>> loaded via a namespace (and not attached):
>> [1] grid_2.13.0        Matrix_0.999375-50 nlme_3.1-101       tools_2.13.0
>>
>> --
>> David.
>>
>>
>>>
>>> R: version
>>> platform       i386-apple-darwin9.8.0
>>> arch           i386
>>> os             darwin9.8.0
>>> system         i386, darwin9.8.0
>>> status
>>> major          2
>>> minor          13.0
>>> year           2011
>>> month          04
>>> day            13
>>> svn rev        55427
>>> language       R
>>> version.string R version 2.13.0 (2011-04-13)
>>>
>>> I ~ $: gcc --version
>>> i686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5666) (dot 3)
>>> Copyright (C) 2007 Free Software Foundation, Inc.
>>> This is free software; see the source for copying conditions.  There is NO
>>> warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
>>>
>>> I ~ $: less /opt/local/include/boost/version.hpp
>>> //  Boost version.hpp configuration header file  ------------------------------//
>>> [...]
>>> #define BOOST_VERSION 104601
>>> #define BOOST_LIB_VERSION "1_46_1"
>>> [...]
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>> David Winsemius, MD
>> West Hartford, CT
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Wed Jun 29 19:44:10 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 29 Jun 2011 13:44:10 -0400
Subject: [Rd] R-devel Digest, Vol 100, Issue 28
In-Reply-To: <4E0B5C5A.5030603@statistik.tu-dortmund.de>
References: <mailman.14.1309341605.28247.r-devel@r-project.org>	<A77F9796-2F95-41AA-86B1-BA7F05018EFF@anu.edu.au>
	<4E0B5C5A.5030603@statistik.tu-dortmund.de>
Message-ID: <4E0B646A.9050508@gmail.com>

On 29/06/2011 1:09 PM, Uwe Ligges wrote:
>
> On 29.06.2011 13:41, John Maindonald wrote:
> >  I get the same style of path as Hadley.  This is on Windows 7 Home Premium with SP1.
> >  I start R by clicking on the R-2.31.0 icon.
> >
> >  I'd assumed that it was a change that came with R-2.13.0!
> >  (On 32-bit Windows XP, which I have just checked, I do indeed get the 8.3 paths.)
> >
> >>  R.home()
> >  [1] "C:/Programs/R/R-2.13.0"
>
>
> No, you got the same as Duncan: This is 8.3 compatible.


Yes, that's right.  The documentation is pretty inaccurate.  What 
actually is supposed to happen is that you get the actual path, with 
forward slashes in it, unless it contains spaces:  then you get the 8.3 
version.  So John's path has no spaces, and doesn't get converted to 
8.3.  True 8.3 would also have uppercase PROGRAMS, and only one dot in 
R-2.13.0 (I forget how that is converted).

Duncan Murdoch


From ligges at statistik.tu-dortmund.de  Wed Jun 29 19:50:47 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Wed, 29 Jun 2011 19:50:47 +0200
Subject: [Rd] R CMD check --force-multiarch does not install all the
 archs for testing
In-Reply-To: <4E0A4381.6020506@fhcrc.org>
References: <4E0912EE.7020105@fhcrc.org>
	<4E099478.4030609@statistik.tu-dortmund.de>
	<4E0A2507.1010904@fhcrc.org>
	<CA592CAB-B8DB-49C6-9AFD-9DB2C2087806@r-project.org>
	<4E0A2F44.3010109@fhcrc.org>
	<EBE00C6D-476A-4DA5-9CB8-A0F320D2B042@r-project.org>
	<4E0A4381.6020506@fhcrc.org>
Message-ID: <4E0B65F7.7080701@statistik.tu-dortmund.de>



On 28.06.2011 23:11, Herv? Pag?s wrote:
> Simon,
>
> On 11-06-28 01:44 PM, Simon Urbanek wrote:
>>
>> On Jun 28, 2011, at 3:45 PM, Herv? Pag?s wrote:
>>
>>> Hi Simon,
>>>
>>> On 11-06-28 12:19 PM, Simon Urbanek wrote:
>>>>
>>>> On Jun 28, 2011, at 3:01 PM, Herv? Pag?s wrote:
>>>>
>>>>> Hi Uwe,
>>>>>
>>>>> On 11-06-28 01:44 AM, Uwe Ligges wrote:
>>>>>>
>>>>>>
>>>>>> On 28.06.2011 01:31, Herv? Pag?s wrote:
>>>>>>> Hi,
>>>>>>>
>>>>>>> Why isn't 'R CMD check --force-multiarch' installing the package
>>>>>>> for all the architectures that are going to be checked?
>>>>>>
>>>>>> Herv?,
>>>>>>
>>>>>> no, since it cannot know that that you need
>>>>>>
>>>>>> --merge-multiarch
>>>>>>
>>>>>> as an additional install flag for this particular package.
>>>>>
>>>>> Why not just use this flag anyway? Does it hurt to use it on
>>>>> packages that don't strictly need it?
>>>>>
>>>>
>>>> It does for two reasons: a) everything is built twice
>>>
>>> That's exactly what I want when I do 'R CMD check --force-multiarch'
>>>
>>
>> No, that's not what it does (and I assume you mean --force-biarch). It
>> builds the package just once, you're simply overriding the default
>> behavior of checking for configure.win, that's all. The two flags are
>> orthogonal, --force-biarch makes no sense with --merge-multiarch, they
>> are for all practical purposes mutually exclusive by definition of
>> what they do.
>
> I really mean --force-multiarch, not --force-biarch. AFAIK 'R CMD check'
> has no --force-biarch option.
>
>>
>>
>>>> and b) package authors don't expect the necessity to support
>>>> --libs-only if the package doesn't require separate build runs.
>>>
>>> When specifying --force-multiarch, the user really expects the
>>> package to be installed for all sub-archs.
>>>
>>
>> ... with the assumption that the package supports it even though it
>> has a configure script which may to may not work unlike
>> --merge-multiarch which will always work.
>
> Just to clarify:
>
> --force-multiarch is an 'R CMD check' option, not an 'R CMD INSTALL'
> option
>
> --merge-multiarch is an 'R CMD INSTALL' option, not an 'R CMD check'
> option
>
> Now you are saying that --merge-multiarch will always work (on Windows
> of course, all this discussion is about how to achieve multiarch check
> on Windows). Great, this is what I've been observing too so far!


It does not "always work", unfortunately. We need force-biarch on CRAN for:

RGtk2
rgdal
rphast
SQLiteMap



> On packages with or without native codes, with or without configure.win
> scripts, etc... It always seems to work. So, again, why isn't
> 'R CMD check --force-multiarch' installing with --merge-multiarch?
> Note that I'm not attached to that solution in particular, just trying
> to suggest an easy fix for 'R CMD check --force-multiarch' (which right
> now is broken on some packages).

Well, merge-multiarch will result in small overhead. It will try to 
compile the code in ./src  for the other architecture and merge that 
into the same package. For packages without any compiled code, it does 
not make sense to ask R to do that since the packages are identical 
under 32-bit and 64-bit, hence you don't want the overhead. For packages 
that include compiled code, you still do not want it, since R does it 
automatically - unless there is a configure.win file.

Therefore, the option is just an add on that is necessary for only 18 
out of roughly 3000 CRAN packages.

So we have 4 packages that require --force-biarch and 18 requiring 
--merge-multiarch on CRAN. All the others build automatically for both 
architectures if they need to. So no reason to do that all the time.

Best wishes,
Uwe



>> --force-biarch is just a way to flag packages that have configure.win
>> that has no effect on the binary settings (flags etc.). It forces R to
>> try multi-arch build in one flight, but it may or may not work
>> depending on the package. It is a way to save time by not running
>> --merge-multiarch (and thus building the package twice).
>
> --force-biarch is an 'R CMD INSTALL' option that I don't use. Why would
> I use something that might fail when I can use --merge-multiarch which
> always works.
 >
> Thanks,
> H.
>
>>
>> Cheers,
>> Simon
>>
>>
>>>>
>>>> The cross-platform way is to not use --merge-multiarch but use
>>>> --libs-only instead as needed (easy to check after the first arch
>>>> run which will tell you whether it's needed or not). I suspect that
>>>> --merge-multiarch is just a convenience shortcut (and it's unclear
>>>> to me why it's Windows-only...).
>>>
>>> A great convenience indeed as it allows to do the multiarch install in
>>> a single step. And it's unclear to me too why it's Windows-only but I
>>> would have hoped you would know...
>>>
>>> Thanks,
>>> H.
>>>
>>>
>>>>
>>>> Cheers,
>>>> Simon
>>>>
>>>>
>>>>>> You will have to check it in repository maintainer's mode (as the
>>>>>> CRAN
>>>>>> maintainers do everywhere). Essentially this is for me (when also
>>>>>> producing WIndows binaries):
>>>>>>
>>>>>>
>>>>>> Step 1: Installation
>>>>>>
>>>>>> R CMD INSTALL --pkglock --compact-docs --build --merge-multiarch
>>>>>> --library="D:/path/to/library" fabia_1.5.0.tar.gz>
>>>>>> fabia-install.out 2>&1
>>>>>>
>>>>>> (where the merge-multiarch part applies only to this package, of
>>>>>> course)
>>>>>>
>>>>>>
>>>>>>
>>>>>> Step 2: Check (without installation, since that happened before
>>>>>> already,
>>>>>> using the install log from step 1)
>>>>>>
>>>>>> R CMD check --library="D:/path/to/library" --force-multiarch
>>>>>> --install="check:fabia-install.out" fabia
>>>>>
>>>>> Whaoooo! Would be nice if there was a plan to make 'R CMD check' also
>>>>> usable by normal people (including the package developer), not just
>>>>> by a few privileged people that know about those undocumented tricks.
>>>>>
>>>>> Thanks,
>>>>> H.
>>>>>
>>>>>>
>>>>>> Best wishes,
>>>>>> Uwe
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>> For some packages, it only installs for the default arch ('i386').
>>>>>>> Then testing the package for 'x64' fails.
>>>>>>>
>>>>>>> For example,
>>>>>>>
>>>>>>> Output of R CMD check --force-multiarch fabia_1.5.0.tar.gz:
>>>>>>> -----------------------------------------------------------
>>>>>>> * using log directory 'D:/biocbld/bbs-2.9-bioc/meat/fabia.Rcheck'
>>>>>>> * using R version 2.14.0 Under development (unstable) (2011-05-30
>>>>>>> r56020)
>>>>>>> * using platform: i386-pc-mingw32 (32-bit)
>>>>>>> * using session charset: ISO8859-1
>>>>>>> * using option '--no-vignettes'
>>>>>>> * checking for file 'fabia/DESCRIPTION' ... OK
>>>>>>> * this is package 'fabia' version '1.5.0'
>>>>>>> * checking package name space information ... OK
>>>>>>> * checking package dependencies ... OK
>>>>>>> * checking if this is a source package ... OK
>>>>>>> * checking whether package 'fabia' can be installed ... OK
>>>>>>> * checking installed package size ... OK
>>>>>>> * checking package directory ... OK
>>>>>>> * checking for portable file names ... OK
>>>>>>> * checking DESCRIPTION meta-information ... OK
>>>>>>> * checking top-level files ... OK
>>>>>>> * checking index information ... OK
>>>>>>> * checking package subdirectories ... OK
>>>>>>> * checking R files for non-ASCII characters ... OK
>>>>>>> * checking R files for syntax errors ... OK
>>>>>>> * loading checks for arch 'i386'
>>>>>>> ** checking whether the package can be loaded ... OK
>>>>>>> ** checking whether the package can be loaded with stated
>>>>>>> dependencies
>>>>>>> ... OK
>>>>>>> ** checking whether the package can be unloaded cleanly ... OK
>>>>>>> ** checking whether the name space can be loaded with stated
>>>>>>> dependencies ... OK
>>>>>>> ** checking whether the name space can be unloaded cleanly ... OK
>>>>>>> * loading checks for arch 'x64'
>>>>>>> ** checking whether the package can be loaded ...Warning: running
>>>>>>> command '"D:/biocbld/bbs-2.9-bioc/R/bin/x64/Rterm.exe"
>>>>>>> R_ENVIRON_USER='no_such_file' --no-site-file --no-init-file
>>>>>>> --no-save
>>>>>>> --no-restore --slave -f
>>>>>>> D:\biocbld\bbs-2.9-bioc\tmpdir\RtmpO65p5H\Rin57456988' had status 1
>>>>>>> ERROR
>>>>>>> Error: package 'fabia' is not installed for 'arch=x64'
>>>>>>> Execution halted
>>>>>>>
>>>>>>> It looks like this package has a loading problem: see the
>>>>>>> messages for
>>>>>>> details.
>>>>>>>
>>>>>>> Content of fabia.Rcheck\00install.out:
>>>>>>> --------------------------------------
>>>>>>>
>>>>>>> * installing *source* package 'fabia' ...
>>>>>>> Building libRcpp.a in RcppSrc...
>>>>>>> rm -f Rcpp.o libRcpp.a
>>>>>>> g++ -c Rcpp.cpp -o Rcpp.o -I"D:/biocbld/BBS-2?1.9-B/R/include"
>>>>>>> -I"D:/biocbld/BBS-2?1.9-B/R/src/include" -Wall -O2
>>>>>>> ar r libRcpp.a Rcpp.o
>>>>>>> C:\Rtools213\MinGW\bin\ar.exe: creating libRcpp.a
>>>>>>> ranlib libRcpp.a
>>>>>>> rm -f Rcpp.o
>>>>>>> rm -f Rcpp.o
>>>>>>> ** libs
>>>>>>> running src/Makefile.win ...
>>>>>>> rm -f fabia.o fabia.dll *.a *.o *.so *.dll
>>>>>>> g++ -c fabiac.cpp -o fabia.o -I../RcppSrc
>>>>>>> -I"D:/biocbld/BBS-2?1.9-B/R/include" -Wall -O2
>>>>>>> g++ -shared -s -static-libgcc fabia.o -L../RcppSrc -lRcpp
>>>>>>> -L"D:/biocbld/BBS-2?1.9-B/R/bin/i386" -lR -o fabia.dll
>>>>>>> rm -f fabia.o *.a *.o *.so
>>>>>>> installing to
>>>>>>> D:/biocbld/bbs-2.9-bioc/meat/fabia.Rcheck/fabia/libs/i386
>>>>>>> ** R
>>>>>>> ** demo
>>>>>>> ** inst
>>>>>>> ** preparing package for lazy loading
>>>>>>> Creating a generic function for "plot" from package "graphics" in
>>>>>>> package "fabia"
>>>>>>> ** help
>>>>>>> *** installing help indices
>>>>>>> ** building package indices ...
>>>>>>> *** tangling vignette sources ...
>>>>>>> 'fabia.Rnw'
>>>>>>> ** testing if installed package can be loaded
>>>>>>>
>>>>>>> * DONE (fabia)
>>>>>>>
>>>>>>> The source tarball for this package is available here:
>>>>>>> http://bioconductor.org/packages/2.9/bioc/html/fabia.html
>>>>>>>
>>>>>>> What command should be used to perform a multiarch check of this
>>>>>>> package?
>>>>>>>
>>>>>>> This is on a 64-bit Windows Server 2008 R2 Enterprise machine
>>>>>>> using a
>>>>>>> recent combined Windows 32/64 bit binary of R-devel from CRAN.
>>>>>>>
>>>>>>> Thanks!
>>>>>>> H.
>>>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> Herv? Pag?s
>>>>>
>>>>> Program in Computational Biology
>>>>> Division of Public Health Sciences
>>>>> Fred Hutchinson Cancer Research Center
>>>>> 1100 Fairview Ave. N, M1-B514
>>>>> P.O. Box 19024
>>>>> Seattle, WA 98109-1024
>>>>>
>>>>> E-mail: hpages at fhcrc.org
>>>>> Phone: (206) 667-5791
>>>>> Fax: (206) 667-1319
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>>
>>>>
>>>
>>>
>>> --
>>> Herv? Pag?s
>>>
>>> Program in Computational Biology
>>> Division of Public Health Sciences
>>> Fred Hutchinson Cancer Research Center
>>> 1100 Fairview Ave. N, M1-B514
>>> P.O. Box 19024
>>> Seattle, WA 98109-1024
>>>
>>> E-mail: hpages at fhcrc.org
>>> Phone: (206) 667-5791
>>> Fax: (206) 667-1319
>>>
>>>
>>
>
>


From Simon.Urbanek at R-Project.org  Wed Jun 29 20:05:58 2011
From: Simon.Urbanek at R-Project.org (Simon Urbanek)
Date: Wed, 29 Jun 2011 14:05:58 -0400
Subject: [Rd] Compilation error Mac binary
In-Reply-To: <4E0B5D06.5030209@statistik.tu-dortmund.de>
References: <F6167619-EE98-4827-8D74-FF50AED840AB@uzh.ch>	<BEE8EEB7-4A4E-4AC7-A8FB-437E20EDB81B@comcast.net>
	<EE02A6DC-5371-4775-8EF6-686750FB0527@uzh.ch>
	<4E0B5D06.5030209@statistik.tu-dortmund.de>
Message-ID: <9E4D59BC-CA18-4798-A924-D8C9859D7E3D@R-Project.org>


On Jun 29, 2011, at 1:12 PM, Uwe Ligges wrote:

> Looks like a different boost version than the one you require.
> I'd suggest to talk to the Mac maintainer, Simon Urbanek (CCing).
> 

GUTS doesn't specify any system requirements, so obviously it has no business trying to use boost from the system. Also note boost is inlined in the vast majority of cases, so most packages simply supply the headers inside as to guarantee the required version is used (which I would certainly expect GUTS to do since it doesn't depend on boost according to the DESCRIPTION).

Cheers,
Simon


> 
> On 29.06.2011 17:14, soeren.vogel at uzh.ch wrote:
>> Hello David
>> 
>> On 29.06.2011, at 15:56, David Winsemius wrote:
>> 
>>> On Jun 29, 2011, at 5:33 AM, soeren.vogel at uzh.ch wrote:
>>> 
>>>> Hello, the compilation of the GUTS package on CRAN for Mac produces the following error messages:
>>>> 
>>>> http://www.r-project.org/nosvn/R.check/r-release-macosx-ix86/GUTS-00install.html
>>>> 
>>>> I guess it is some namespace collision, but I can not reproduce it on my machine, it compiles fine here. What is the cause and which setup do I need to reproduce the errors?
>>> 
>>> I was going to suggest you take this up with the maintainers... but you _are_ one of the maintainers.
>> 
>> :-)
>> 
>>> Here is the output from an attempt to compile from source, version 0.1.45, with a relatively recent version of R 2.13.0 (but not the most recent and I still use Mac OSX 10.5.8). Perhaps its brevity will be helpful, and the fact that it seems to identify different error than those flagged in the log at CRAN.
>> 
>> Thanks for your answer. The failure on your side is clear to me: there is no installation of the boost C++ library in any of the standard include locations. I have added /opt/local/include in Makevars (Mac Ports installation of C source packages), however, I know I should but still I am reluctant to write a configure script that could circumvent non-standard installations of boost on UNIX machines.
>> 
>> So thanks for the output, but the CRAN messages must point to something different...
>> 
>> Regards
>> S?ren
>> 
>>> trying URL 'http://lib.stat.cmu.edu/R/CRAN/src/contrib/GUTS_0.1.45.tar.gz'
>>> Content type 'application/x-gzip' length 9842 bytes
>>> opened URL
>>> ==================================================
>>> downloaded 9842 bytes
>>> 
>>> Loading required package: lattice
>>> Loading required package: sos
>>> Loading required package: brew
>>> [1] "2011-06-29 09:40:18 EDT"
>>> * installing *source* package ?GUTS? ...
>>> ** libs
>>> *** arch - i386
>>> g++ -arch i386 -I/Library/Frameworks/R.framework/Resources/include -I/Library/Frameworks/R.framework/Resources/include/i386 -I/opt/local/include -I/usr/local/include -I"/Library/Frameworks/R.framework/Versions/2.13/Resources/library/Rcpp/include"   -fPIC  -g -O2 -c GUTS.cpp -o GUTS.o
>>> In file included from GUTS.cpp:12:
>>> GUTS.h:21:28: error: boost/random.hpp: No such file or directory
>>> GUTS.h:22:40: error: boost/math/distributions.hpp: No such file or directory
>>> GUTS.cpp: In function ?void to_print(double)?:
>>> GUTS.cpp:277: error: ?cout? was not declared in this scope
>>> GUTS.cpp: In member function ?void GUTS::showObject()?:
>>> GUTS.cpp:281: error: ?cout? is not a member of ?std?
>>> GUTS.cpp:284: error: ?cout? was not declared in this scope
>>> make: *** [GUTS.o] Error 1
>>> ERROR: compilation failed for package ?GUTS?
>>> * removing ?/Library/Frameworks/R.framework/Versions/2.13/Resources/library/GUTS?
>>> 
>>>> sessionInfo()
>>> R version 2.13.0 beta (2011-04-04 r55296)
>>> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
>>> 
>>> locale:
>>> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>>> 
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>> 
>>> other attached packages:
>>> [1] mgcv_1.7-6      sos_1.3-0       brew_1.0-6      lattice_0.19-26
>>> 
>>> loaded via a namespace (and not attached):
>>> [1] grid_2.13.0        Matrix_0.999375-50 nlme_3.1-101       tools_2.13.0
>>> 
>>> --
>>> David.
>>> 
>>> 
>>>> 
>>>> R: version
>>>> platform       i386-apple-darwin9.8.0
>>>> arch           i386
>>>> os             darwin9.8.0
>>>> system         i386, darwin9.8.0
>>>> status
>>>> major          2
>>>> minor          13.0
>>>> year           2011
>>>> month          04
>>>> day            13
>>>> svn rev        55427
>>>> language       R
>>>> version.string R version 2.13.0 (2011-04-13)
>>>> 
>>>> I ~ $: gcc --version
>>>> i686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5666) (dot 3)
>>>> Copyright (C) 2007 Free Software Foundation, Inc.
>>>> This is free software; see the source for copying conditions.  There is NO
>>>> warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
>>>> 
>>>> I ~ $: less /opt/local/include/boost/version.hpp
>>>> //  Boost version.hpp configuration header file  ------------------------------//
>>>> [...]
>>>> #define BOOST_VERSION 104601
>>>> #define BOOST_LIB_VERSION "1_46_1"
>>>> [...]
>>>> 
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>>> David Winsemius, MD
>>> West Hartford, CT
>>> 
>>> 
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From murdoch.duncan at gmail.com  Wed Jun 29 20:08:08 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 29 Jun 2011 14:08:08 -0400
Subject: [Rd] R-devel Digest, Vol 100, Issue 28
In-Reply-To: <4E0B646A.9050508@gmail.com>
References: <mailman.14.1309341605.28247.r-devel@r-project.org>	<A77F9796-2F95-41AA-86B1-BA7F05018EFF@anu.edu.au>
	<4E0B5C5A.5030603@statistik.tu-dortmund.de>
	<4E0B646A.9050508@gmail.com>
Message-ID: <4E0B6A08.2070400@gmail.com>

On 29/06/2011 1:44 PM, Duncan Murdoch wrote:
> On 29/06/2011 1:09 PM, Uwe Ligges wrote:
> >
> >  On 29.06.2011 13:41, John Maindonald wrote:
> >  >   I get the same style of path as Hadley.  This is on Windows 7 Home Premium with SP1.
> >  >   I start R by clicking on the R-2.31.0 icon.
> >  >
> >  >   I'd assumed that it was a change that came with R-2.13.0!
> >  >   (On 32-bit Windows XP, which I have just checked, I do indeed get the 8.3 paths.)
> >  >
> >  >>   R.home()
> >  >   [1] "C:/Programs/R/R-2.13.0"
> >
> >
> >  No, you got the same as Duncan: This is 8.3 compatible.
>
>
> Yes, that's right.  The documentation is pretty inaccurate.  What
> actually is supposed to happen is that you get the actual path, with
> forward slashes in it, unless it contains spaces:  then you get the 8.3
> version.  So John's path has no spaces, and doesn't get converted to
> 8.3.  True 8.3 would also have uppercase PROGRAMS, and only one dot in
> R-2.13.0 (I forget how that is converted).

I've now clarified the help page.  R.home() just looks up the 
environment variable R_HOME, and then possibly adds some subdir to it.
If your front end (e.g. Hadley's rj/Eclipse setup) doesn't initialize 
R_HOME properly, then you'll get whatever it put there.  You can also 
mess with it using Sys.setenv(R_HOME="junk").

Duncan Murdoch


From simon.urbanek at r-project.org  Wed Jun 29 20:17:05 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 29 Jun 2011 14:17:05 -0400
Subject: [Rd] Compilation error Mac binary
In-Reply-To: <9E4D59BC-CA18-4798-A924-D8C9859D7E3D@R-Project.org>
References: <F6167619-EE98-4827-8D74-FF50AED840AB@uzh.ch>	<BEE8EEB7-4A4E-4AC7-A8FB-437E20EDB81B@comcast.net>
	<EE02A6DC-5371-4775-8EF6-686750FB0527@uzh.ch>
	<4E0B5D06.5030209@statistik.tu-dortmund.de>
	<9E4D59BC-CA18-4798-A924-D8C9859D7E3D@R-Project.org>
Message-ID: <AFFE7410-B248-459B-92C5-525DA02897F6@r-project.org>

BTW: the build result is at

http://www.r-project.org/nosvn/R.check/r-release-macosx-ix86/GUTS-00install.html

so you may want to have a look. I'm not a C++ expert so you may want to ask on the Rcpp list since it appears to be some issue triggered by Rcpp includes - as if boost and tr1 and somehow define the same things but differently ... Since Dirk uses the same boost (1.43 here) successfully in QuantLib he may know more ...

Cheers,
Simon


On Jun 29, 2011, at 2:05 PM, Simon Urbanek wrote:

> 
> On Jun 29, 2011, at 1:12 PM, Uwe Ligges wrote:
> 
>> Looks like a different boost version than the one you require.
>> I'd suggest to talk to the Mac maintainer, Simon Urbanek (CCing).
>> 
> 
> GUTS doesn't specify any system requirements, so obviously it has no business trying to use boost from the system. Also note boost is inlined in the vast majority of cases, so most packages simply supply the headers inside as to guarantee the required version is used (which I would certainly expect GUTS to do since it doesn't depend on boost according to the DESCRIPTION).
> 
> Cheers,
> Simon
> 
> 
>> 
>> On 29.06.2011 17:14, soeren.vogel at uzh.ch wrote:
>>> Hello David
>>> 
>>> On 29.06.2011, at 15:56, David Winsemius wrote:
>>> 
>>>> On Jun 29, 2011, at 5:33 AM, soeren.vogel at uzh.ch wrote:
>>>> 
>>>>> Hello, the compilation of the GUTS package on CRAN for Mac produces the following error messages:
>>>>> 
>>>>> http://www.r-project.org/nosvn/R.check/r-release-macosx-ix86/GUTS-00install.html
>>>>> 
>>>>> I guess it is some namespace collision, but I can not reproduce it on my machine, it compiles fine here. What is the cause and which setup do I need to reproduce the errors?
>>>> 
>>>> I was going to suggest you take this up with the maintainers... but you _are_ one of the maintainers.
>>> 
>>> :-)
>>> 
>>>> Here is the output from an attempt to compile from source, version 0.1.45, with a relatively recent version of R 2.13.0 (but not the most recent and I still use Mac OSX 10.5.8). Perhaps its brevity will be helpful, and the fact that it seems to identify different error than those flagged in the log at CRAN.
>>> 
>>> Thanks for your answer. The failure on your side is clear to me: there is no installation of the boost C++ library in any of the standard include locations. I have added /opt/local/include in Makevars (Mac Ports installation of C source packages), however, I know I should but still I am reluctant to write a configure script that could circumvent non-standard installations of boost on UNIX machines.
>>> 
>>> So thanks for the output, but the CRAN messages must point to something different...
>>> 
>>> Regards
>>> S?ren
>>> 
>>>> trying URL 'http://lib.stat.cmu.edu/R/CRAN/src/contrib/GUTS_0.1.45.tar.gz'
>>>> Content type 'application/x-gzip' length 9842 bytes
>>>> opened URL
>>>> ==================================================
>>>> downloaded 9842 bytes
>>>> 
>>>> Loading required package: lattice
>>>> Loading required package: sos
>>>> Loading required package: brew
>>>> [1] "2011-06-29 09:40:18 EDT"
>>>> * installing *source* package ?GUTS? ...
>>>> ** libs
>>>> *** arch - i386
>>>> g++ -arch i386 -I/Library/Frameworks/R.framework/Resources/include -I/Library/Frameworks/R.framework/Resources/include/i386 -I/opt/local/include -I/usr/local/include -I"/Library/Frameworks/R.framework/Versions/2.13/Resources/library/Rcpp/include"   -fPIC  -g -O2 -c GUTS.cpp -o GUTS.o
>>>> In file included from GUTS.cpp:12:
>>>> GUTS.h:21:28: error: boost/random.hpp: No such file or directory
>>>> GUTS.h:22:40: error: boost/math/distributions.hpp: No such file or directory
>>>> GUTS.cpp: In function ?void to_print(double)?:
>>>> GUTS.cpp:277: error: ?cout? was not declared in this scope
>>>> GUTS.cpp: In member function ?void GUTS::showObject()?:
>>>> GUTS.cpp:281: error: ?cout? is not a member of ?std?
>>>> GUTS.cpp:284: error: ?cout? was not declared in this scope
>>>> make: *** [GUTS.o] Error 1
>>>> ERROR: compilation failed for package ?GUTS?
>>>> * removing ?/Library/Frameworks/R.framework/Versions/2.13/Resources/library/GUTS?
>>>> 
>>>>> sessionInfo()
>>>> R version 2.13.0 beta (2011-04-04 r55296)
>>>> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
>>>> 
>>>> locale:
>>>> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>>>> 
>>>> attached base packages:
>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>> 
>>>> other attached packages:
>>>> [1] mgcv_1.7-6      sos_1.3-0       brew_1.0-6      lattice_0.19-26
>>>> 
>>>> loaded via a namespace (and not attached):
>>>> [1] grid_2.13.0        Matrix_0.999375-50 nlme_3.1-101       tools_2.13.0
>>>> 
>>>> --
>>>> David.
>>>> 
>>>> 
>>>>> 
>>>>> R: version
>>>>> platform       i386-apple-darwin9.8.0
>>>>> arch           i386
>>>>> os             darwin9.8.0
>>>>> system         i386, darwin9.8.0
>>>>> status
>>>>> major          2
>>>>> minor          13.0
>>>>> year           2011
>>>>> month          04
>>>>> day            13
>>>>> svn rev        55427
>>>>> language       R
>>>>> version.string R version 2.13.0 (2011-04-13)
>>>>> 
>>>>> I ~ $: gcc --version
>>>>> i686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5666) (dot 3)
>>>>> Copyright (C) 2007 Free Software Foundation, Inc.
>>>>> This is free software; see the source for copying conditions.  There is NO
>>>>> warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
>>>>> 
>>>>> I ~ $: less /opt/local/include/boost/version.hpp
>>>>> //  Boost version.hpp configuration header file  ------------------------------//
>>>>> [...]
>>>>> #define BOOST_VERSION 104601
>>>>> #define BOOST_LIB_VERSION "1_46_1"
>>>>> [...]
>>>>> 
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>> 
>>>> David Winsemius, MD
>>>> West Hartford, CT
>>>> 
>>>> 
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 
> 


From tobias.verbeke at openanalytics.eu  Wed Jun 29 20:23:04 2011
From: tobias.verbeke at openanalytics.eu (Tobias Verbeke)
Date: Wed, 29 Jun 2011 20:23:04 +0200
Subject: [Rd] R-devel Digest, Vol 100, Issue 28
In-Reply-To: <4E0B6A08.2070400@gmail.com>
References: <mailman.14.1309341605.28247.r-devel@r-project.org>	<A77F9796-2F95-41AA-86B1-BA7F05018EFF@anu.edu.au>	<4E0B5C5A.5030603@statistik.tu-dortmund.de>	<4E0B646A.9050508@gmail.com>
	<4E0B6A08.2070400@gmail.com>
Message-ID: <4E0B6D88.4050701@openanalytics.eu>

On 06/29/2011 08:08 PM, Duncan Murdoch wrote:
> On 29/06/2011 1:44 PM, Duncan Murdoch wrote:
>> On 29/06/2011 1:09 PM, Uwe Ligges wrote:
>> >
>> > On 29.06.2011 13:41, John Maindonald wrote:
>> > > I get the same style of path as Hadley. This is on Windows 7 Home
>> Premium with SP1.
>> > > I start R by clicking on the R-2.31.0 icon.
>> > >
>> > > I'd assumed that it was a change that came with R-2.13.0!
>> > > (On 32-bit Windows XP, which I have just checked, I do indeed get
>> the 8.3 paths.)
>> > >
>> > >> R.home()
>> > > [1] "C:/Programs/R/R-2.13.0"
>> >
>> >
>> > No, you got the same as Duncan: This is 8.3 compatible.
>>
>>
>> Yes, that's right. The documentation is pretty inaccurate. What
>> actually is supposed to happen is that you get the actual path, with
>> forward slashes in it, unless it contains spaces: then you get the 8.3
>> version. So John's path has no spaces, and doesn't get converted to
>> 8.3. True 8.3 would also have uppercase PROGRAMS, and only one dot in
>> R-2.13.0 (I forget how that is converted).
>
> I've now clarified the help page. R.home() just looks up the environment
> variable R_HOME, and then possibly adds some subdir to it.
> If your front end (e.g. Hadley's rj/Eclipse setup) doesn't initialize
> R_HOME properly, then you'll get whatever it put there. You can also

For the record, Eclipse/StatET makes use of an R_HOME variable
as set by the user (not as initialized by the front-end)
in a so called 'R Environment' under

Window > Preferences > StatET > Run/Debug > R Environments

Best,
Tobias

> mess with it using Sys.setenv(R_HOME="junk").
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From soeren.vogel at uzh.ch  Wed Jun 29 20:39:11 2011
From: soeren.vogel at uzh.ch (soeren.vogel at uzh.ch)
Date: Wed, 29 Jun 2011 20:39:11 +0200
Subject: [Rd] Compilation error Mac binary
In-Reply-To: <9E4D59BC-CA18-4798-A924-D8C9859D7E3D@R-Project.org>
References: <F6167619-EE98-4827-8D74-FF50AED840AB@uzh.ch>	<BEE8EEB7-4A4E-4AC7-A8FB-437E20EDB81B@comcast.net>
	<EE02A6DC-5371-4775-8EF6-686750FB0527@uzh.ch>
	<4E0B5D06.5030209@statistik.tu-dortmund.de>
	<9E4D59BC-CA18-4798-A924-D8C9859D7E3D@R-Project.org>
Message-ID: <92C92753-576D-4834-B78A-901FBD189054@uzh.ch>

Thanks Simon, Uwe and David for your helpful answers. English is not my primary language, so I was hypothesising a bit about the correct interpretation of "inlining" and "supply inside". I thought it meant copying the headers inside the package. I was already inspecting RQuantlib but I did, so far, not get smarter. I think I will setup a VMware OS X 10.5 with an older boost. This approach seems more reliable to me than just trying around with a configure script which, eventually, I don't understand fully. Yet, interesting that GUTS builds on Win and Linux, but not on the CRAN OS X. Anyway, thanks for your help.

Best
S?ren


On 29.06.2011, at 20:05, Simon Urbanek wrote:


> On Jun 29, 2011, at 1:12 PM, Uwe Ligges wrote:
> 
>> Looks like a different boost version than the one you require.
>> I'd suggest to talk to the Mac maintainer, Simon Urbanek (CCing).
>> 
> 
> GUTS doesn't specify any system requirements, so obviously it has no business trying to use boost from the system. Also note boost is inlined in the vast majority of cases, so most packages simply supply the headers inside as to guarantee the required version is used (which I would certainly expect GUTS to do since it doesn't depend on boost according to the DESCRIPTION).
> 
> Cheers,
> Simon
> 
> 
>> 
>> On 29.06.2011 17:14, soeren.vogel at uzh.ch wrote:
>>> Hello David
>>> 
>>> On 29.06.2011, at 15:56, David Winsemius wrote:
>>> 
>>>> On Jun 29, 2011, at 5:33 AM, soeren.vogel at uzh.ch wrote:
>>>> 
>>>>> Hello, the compilation of the GUTS package on CRAN for Mac produces the following error messages:
>>>>> 
>>>>> http://www.r-project.org/nosvn/R.check/r-release-macosx-ix86/GUTS-00install.html
>>>>> 
>>>>> I guess it is some namespace collision, but I can not reproduce it on my machine, it compiles fine here. What is the cause and which setup do I need to reproduce the errors?
>>>> 
>>>> I was going to suggest you take this up with the maintainers... but you _are_ one of the maintainers.
>>> 
>>> :-)
>>> 
>>>> Here is the output from an attempt to compile from source, version 0.1.45, with a relatively recent version of R 2.13.0 (but not the most recent and I still use Mac OSX 10.5.8). Perhaps its brevity will be helpful, and the fact that it seems to identify different error than those flagged in the log at CRAN.
>>> 
>>> Thanks for your answer. The failure on your side is clear to me: there is no installation of the boost C++ library in any of the standard include locations. I have added /opt/local/include in Makevars (Mac Ports installation of C source packages), however, I know I should but still I am reluctant to write a configure script that could circumvent non-standard installations of boost on UNIX machines.
>>> 
>>> So thanks for the output, but the CRAN messages must point to something different...
>>> 
>>> Regards
>>> S?ren
>>> 
>>>> trying URL 'http://lib.stat.cmu.edu/R/CRAN/src/contrib/GUTS_0.1.45.tar.gz'
>>>> Content type 'application/x-gzip' length 9842 bytes
>>>> opened URL
>>>> ==================================================
>>>> downloaded 9842 bytes
>>>> 
>>>> Loading required package: lattice
>>>> Loading required package: sos
>>>> Loading required package: brew
>>>> [1] "2011-06-29 09:40:18 EDT"
>>>> * installing *source* package ?GUTS? ...
>>>> ** libs
>>>> *** arch - i386
>>>> g++ -arch i386 -I/Library/Frameworks/R.framework/Resources/include -I/Library/Frameworks/R.framework/Resources/include/i386 -I/opt/local/include -I/usr/local/include -I"/Library/Frameworks/R.framework/Versions/2.13/Resources/library/Rcpp/include"   -fPIC  -g -O2 -c GUTS.cpp -o GUTS.o
>>>> In file included from GUTS.cpp:12:
>>>> GUTS.h:21:28: error: boost/random.hpp: No such file or directory
>>>> GUTS.h:22:40: error: boost/math/distributions.hpp: No such file or directory
>>>> GUTS.cpp: In function ?void to_print(double)?:
>>>> GUTS.cpp:277: error: ?cout? was not declared in this scope
>>>> GUTS.cpp: In member function ?void GUTS::showObject()?:
>>>> GUTS.cpp:281: error: ?cout? is not a member of ?std?
>>>> GUTS.cpp:284: error: ?cout? was not declared in this scope
>>>> make: *** [GUTS.o] Error 1
>>>> ERROR: compilation failed for package ?GUTS?
>>>> * removing ?/Library/Frameworks/R.framework/Versions/2.13/Resources/library/GUTS?
>>>> 
>>>>> sessionInfo()
>>>> R version 2.13.0 beta (2011-04-04 r55296)
>>>> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
>>>> 
>>>> locale:
>>>> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>>>> 
>>>> attached base packages:
>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>> 
>>>> other attached packages:
>>>> [1] mgcv_1.7-6      sos_1.3-0       brew_1.0-6      lattice_0.19-26
>>>> 
>>>> loaded via a namespace (and not attached):
>>>> [1] grid_2.13.0        Matrix_0.999375-50 nlme_3.1-101       tools_2.13.0
>>>> 
>>>> --
>>>> David.
>>>> 
>>>> 
>>>>> 
>>>>> R: version
>>>>> platform       i386-apple-darwin9.8.0
>>>>> arch           i386
>>>>> os             darwin9.8.0
>>>>> system         i386, darwin9.8.0
>>>>> status
>>>>> major          2
>>>>> minor          13.0
>>>>> year           2011
>>>>> month          04
>>>>> day            13
>>>>> svn rev        55427
>>>>> language       R
>>>>> version.string R version 2.13.0 (2011-04-13)
>>>>> 
>>>>> I ~ $: gcc --version
>>>>> i686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5666) (dot 3)
>>>>> Copyright (C) 2007 Free Software Foundation, Inc.
>>>>> This is free software; see the source for copying conditions.  There is NO
>>>>> warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
>>>>> 
>>>>> I ~ $: less /opt/local/include/boost/version.hpp
>>>>> //  Boost version.hpp configuration header file  ------------------------------//
>>>>> [...]
>>>>> #define BOOST_VERSION 104601
>>>>> #define BOOST_LIB_VERSION "1_46_1"
>>>>> [...]
>>>>> 
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>> 
>>>> David Winsemius, MD
>>>> West Hartford, CT
>>>> 
>>>> 
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 
> 
> 


From Simon.Urbanek at R-Project.org  Wed Jun 29 21:14:48 2011
From: Simon.Urbanek at R-Project.org (Simon Urbanek)
Date: Wed, 29 Jun 2011 15:14:48 -0400
Subject: [Rd] Compilation error Mac binary
In-Reply-To: <92C92753-576D-4834-B78A-901FBD189054@uzh.ch>
References: <F6167619-EE98-4827-8D74-FF50AED840AB@uzh.ch>	<BEE8EEB7-4A4E-4AC7-A8FB-437E20EDB81B@comcast.net>
	<EE02A6DC-5371-4775-8EF6-686750FB0527@uzh.ch>
	<4E0B5D06.5030209@statistik.tu-dortmund.de>
	<9E4D59BC-CA18-4798-A924-D8C9859D7E3D@R-Project.org>
	<92C92753-576D-4834-B78A-901FBD189054@uzh.ch>
Message-ID: <E1947759-F2C6-424E-A2C3-9758E4354FED@R-Project.org>

On Jun 29, 2011, at 2:39 PM, soeren.vogel at uzh.ch wrote:

> Thanks Simon, Uwe and David for your helpful answers. English is not my primary language, so I was hypothesising a bit about the correct interpretation of "inlining" and "supply inside". I thought it meant copying the headers inside the package.

Yes, that is what I meant- pick the part of boost that you use and include it (boost has many parts so that's another reason to do that).


> I was already inspecting RQuantlib but I did, so far, not get smarter.

The two comments were unrelated ;). I was just pointing out that Dirk has C++ expertise, uses boots himself and is the author of Rcpp so he may possibly know what the error is about.

I did not have RQuantLib in mind for you to look at the boost inclusion - RQuantLib needs QuantLib in addition to boost, so it is not surprising that he doesn't include boost inside as he has additional dependencies (and he does declare them correctly).


> I think I will setup a VMware OS X 10.5 with an older boost. This approach seems more reliable to me than just trying around with a configure script which, eventually, I don't understand fully. Yet, interesting that GUTS builds on Win and Linux, but not on the CRAN OS X. Anyway, thanks for your help.
> 

It is a side-effect that GUTS builds at all, because the only reason it does is that some other package has probably required boost before. If that was not the case, your package would fail everywhere. [That is not the answer to the Mac error since the same applies - your failure to declare the dependency is masked by the fact that other packages do need boost. I suspect the answer will be in the interaction of tr1/boost/Rcpp, but your should fix GUTS regardless]

Cheers,
Simon


> 
> On 29.06.2011, at 20:05, Simon Urbanek wrote:
> 
> 
>> On Jun 29, 2011, at 1:12 PM, Uwe Ligges wrote:
>> 
>>> Looks like a different boost version than the one you require.
>>> I'd suggest to talk to the Mac maintainer, Simon Urbanek (CCing).
>>> 
>> 
>> GUTS doesn't specify any system requirements, so obviously it has no business trying to use boost from the system. Also note boost is inlined in the vast majority of cases, so most packages simply supply the headers inside as to guarantee the required version is used (which I would certainly expect GUTS to do since it doesn't depend on boost according to the DESCRIPTION).
>> 
>> Cheers,
>> Simon
>> 
>> 
>>> 
>>> On 29.06.2011 17:14, soeren.vogel at uzh.ch wrote:
>>>> Hello David
>>>> 
>>>> On 29.06.2011, at 15:56, David Winsemius wrote:
>>>> 
>>>>> On Jun 29, 2011, at 5:33 AM, soeren.vogel at uzh.ch wrote:
>>>>> 
>>>>>> Hello, the compilation of the GUTS package on CRAN for Mac produces the following error messages:
>>>>>> 
>>>>>> http://www.r-project.org/nosvn/R.check/r-release-macosx-ix86/GUTS-00install.html
>>>>>> 
>>>>>> I guess it is some namespace collision, but I can not reproduce it on my machine, it compiles fine here. What is the cause and which setup do I need to reproduce the errors?
>>>>> 
>>>>> I was going to suggest you take this up with the maintainers... but you _are_ one of the maintainers.
>>>> 
>>>> :-)
>>>> 
>>>>> Here is the output from an attempt to compile from source, version 0.1.45, with a relatively recent version of R 2.13.0 (but not the most recent and I still use Mac OSX 10.5.8). Perhaps its brevity will be helpful, and the fact that it seems to identify different error than those flagged in the log at CRAN.
>>>> 
>>>> Thanks for your answer. The failure on your side is clear to me: there is no installation of the boost C++ library in any of the standard include locations. I have added /opt/local/include in Makevars (Mac Ports installation of C source packages), however, I know I should but still I am reluctant to write a configure script that could circumvent non-standard installations of boost on UNIX machines.
>>>> 
>>>> So thanks for the output, but the CRAN messages must point to something different...
>>>> 
>>>> Regards
>>>> S?ren
>>>> 
>>>>> trying URL 'http://lib.stat.cmu.edu/R/CRAN/src/contrib/GUTS_0.1.45.tar.gz'
>>>>> Content type 'application/x-gzip' length 9842 bytes
>>>>> opened URL
>>>>> ==================================================
>>>>> downloaded 9842 bytes
>>>>> 
>>>>> Loading required package: lattice
>>>>> Loading required package: sos
>>>>> Loading required package: brew
>>>>> [1] "2011-06-29 09:40:18 EDT"
>>>>> * installing *source* package ?GUTS? ...
>>>>> ** libs
>>>>> *** arch - i386
>>>>> g++ -arch i386 -I/Library/Frameworks/R.framework/Resources/include -I/Library/Frameworks/R.framework/Resources/include/i386 -I/opt/local/include -I/usr/local/include -I"/Library/Frameworks/R.framework/Versions/2.13/Resources/library/Rcpp/include"   -fPIC  -g -O2 -c GUTS.cpp -o GUTS.o
>>>>> In file included from GUTS.cpp:12:
>>>>> GUTS.h:21:28: error: boost/random.hpp: No such file or directory
>>>>> GUTS.h:22:40: error: boost/math/distributions.hpp: No such file or directory
>>>>> GUTS.cpp: In function ?void to_print(double)?:
>>>>> GUTS.cpp:277: error: ?cout? was not declared in this scope
>>>>> GUTS.cpp: In member function ?void GUTS::showObject()?:
>>>>> GUTS.cpp:281: error: ?cout? is not a member of ?std?
>>>>> GUTS.cpp:284: error: ?cout? was not declared in this scope
>>>>> make: *** [GUTS.o] Error 1
>>>>> ERROR: compilation failed for package ?GUTS?
>>>>> * removing ?/Library/Frameworks/R.framework/Versions/2.13/Resources/library/GUTS?
>>>>> 
>>>>>> sessionInfo()
>>>>> R version 2.13.0 beta (2011-04-04 r55296)
>>>>> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
>>>>> 
>>>>> locale:
>>>>> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>>>>> 
>>>>> attached base packages:
>>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>>> 
>>>>> other attached packages:
>>>>> [1] mgcv_1.7-6      sos_1.3-0       brew_1.0-6      lattice_0.19-26
>>>>> 
>>>>> loaded via a namespace (and not attached):
>>>>> [1] grid_2.13.0        Matrix_0.999375-50 nlme_3.1-101       tools_2.13.0
>>>>> 
>>>>> --
>>>>> David.
>>>>> 
>>>>> 
>>>>>> 
>>>>>> R: version
>>>>>> platform       i386-apple-darwin9.8.0
>>>>>> arch           i386
>>>>>> os             darwin9.8.0
>>>>>> system         i386, darwin9.8.0
>>>>>> status
>>>>>> major          2
>>>>>> minor          13.0
>>>>>> year           2011
>>>>>> month          04
>>>>>> day            13
>>>>>> svn rev        55427
>>>>>> language       R
>>>>>> version.string R version 2.13.0 (2011-04-13)
>>>>>> 
>>>>>> I ~ $: gcc --version
>>>>>> i686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5666) (dot 3)
>>>>>> Copyright (C) 2007 Free Software Foundation, Inc.
>>>>>> This is free software; see the source for copying conditions.  There is NO
>>>>>> warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
>>>>>> 
>>>>>> I ~ $: less /opt/local/include/boost/version.hpp
>>>>>> //  Boost version.hpp configuration header file  ------------------------------//
>>>>>> [...]
>>>>>> #define BOOST_VERSION 104601
>>>>>> #define BOOST_LIB_VERSION "1_46_1"
>>>>>> [...]
>>>>>> 
>>>>>> ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>> 
>>>>> David Winsemius, MD
>>>>> West Hartford, CT
>>>>> 
>>>>> 
>>>> 
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>>> 
>> 
>> 
> 
> 


From edd at debian.org  Wed Jun 29 21:19:26 2011
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 29 Jun 2011 14:19:26 -0500
Subject: [Rd] Compilation error Mac binary
In-Reply-To: <AFFE7410-B248-459B-92C5-525DA02897F6@r-project.org>
References: <F6167619-EE98-4827-8D74-FF50AED840AB@uzh.ch>
	<BEE8EEB7-4A4E-4AC7-A8FB-437E20EDB81B@comcast.net>
	<EE02A6DC-5371-4775-8EF6-686750FB0527@uzh.ch>
	<4E0B5D06.5030209@statistik.tu-dortmund.de>
	<9E4D59BC-CA18-4798-A924-D8C9859D7E3D@R-Project.org>
	<AFFE7410-B248-459B-92C5-525DA02897F6@r-project.org>
Message-ID: <19979.31422.968209.149059@max.nulle.part>


On 29 June 2011 at 14:17, Simon Urbanek wrote:
| BTW: the build result is at
| 
| http://www.r-project.org/nosvn/R.check/r-release-macosx-ix86/GUTS-00install.html
| 
| so you may want to have a look. I'm not a C++ expert so you may want to ask on the Rcpp list since it appears to be some issue triggered by Rcpp includes - as if boost and tr1 and somehow define the same things but differently ... Since Dirk uses the same boost (1.43 here) successfully in QuantLib he may know more ...

Well, I already told Soeren over there on rcpp-devel that his issues are

  a) totally homegrown (as he continues to ignore configure issues and just
     assumes things would work because they do on his),

  b) hence unrelated to Rcpp (as he just throws '#include <boost/...>' in his
     code without testing

  c) almost entirely solvable by copy-and-paste as e.g. my RQuantLib has a
     configure script using boost-config he could copy (but I acknowldged
     that the configure script does more and is hence not the easiest
     possible).

Now, I do admit that learning configure is a bit of a pain, but that is the
price of admission of CRAN if you use Boost -- or you choose the frequently
done but very inelegant route of copying all your Boost headers into your
package.  My RcppBDT package does that too.  Some of us have talked about
creating a 'boost-headers' package for CRAN that the couple of Boost-using
packages could have a 'Depends:' and 'LinkingTo:' on.  Then his issues would
be solved -- but we're not there yet.

Soeren just shown resilience and persistence in getting his package
written, built and now onto CRAN.  The remaining step is to learn more about
cross-platform build issues.  Because that is the (high) standard of CRAN,
and if you want to be part of it, you are expected to conform.  No shortcuts.

Dirk

 
| Cheers,
| Simon
| 
| 
| On Jun 29, 2011, at 2:05 PM, Simon Urbanek wrote:
| 
| > 
| > On Jun 29, 2011, at 1:12 PM, Uwe Ligges wrote:
| > 
| >> Looks like a different boost version than the one you require.
| >> I'd suggest to talk to the Mac maintainer, Simon Urbanek (CCing).
| >> 
| > 
| > GUTS doesn't specify any system requirements, so obviously it has no business trying to use boost from the system. Also note boost is inlined in the vast majority of cases, so most packages simply supply the headers inside as to guarantee the required version is used (which I would certainly expect GUTS to do since it doesn't depend on boost according to the DESCRIPTION).
| > 
| > Cheers,
| > Simon
| > 
| > 
| >> 
| >> On 29.06.2011 17:14, soeren.vogel at uzh.ch wrote:
| >>> Hello David
| >>> 
| >>> On 29.06.2011, at 15:56, David Winsemius wrote:
| >>> 
| >>>> On Jun 29, 2011, at 5:33 AM, soeren.vogel at uzh.ch wrote:
| >>>> 
| >>>>> Hello, the compilation of the GUTS package on CRAN for Mac produces the following error messages:
| >>>>> 
| >>>>> http://www.r-project.org/nosvn/R.check/r-release-macosx-ix86/GUTS-00install.html
| >>>>> 
| >>>>> I guess it is some namespace collision, but I can not reproduce it on my machine, it compiles fine here. What is the cause and which setup do I need to reproduce the errors?
| >>>> 
| >>>> I was going to suggest you take this up with the maintainers... but you _are_ one of the maintainers.
| >>> 
| >>> :-)
| >>> 
| >>>> Here is the output from an attempt to compile from source, version 0.1.45, with a relatively recent version of R 2.13.0 (but not the most recent and I still use Mac OSX 10.5.8). Perhaps its brevity will be helpful, and the fact that it seems to identify different error than those flagged in the log at CRAN.
| >>> 
| >>> Thanks for your answer. The failure on your side is clear to me: there is no installation of the boost C++ library in any of the standard include locations. I have added /opt/local/include in Makevars (Mac Ports installation of C source packages), however, I know I should but still I am reluctant to write a configure script that could circumvent non-standard installations of boost on UNIX machines.
| >>> 
| >>> So thanks for the output, but the CRAN messages must point to something different...
| >>> 
| >>> Regards
| >>> S?ren
| >>> 
| >>>> trying URL 'http://lib.stat.cmu.edu/R/CRAN/src/contrib/GUTS_0.1.45.tar.gz'
| >>>> Content type 'application/x-gzip' length 9842 bytes
| >>>> opened URL
| >>>> ==================================================
| >>>> downloaded 9842 bytes
| >>>> 
| >>>> Loading required package: lattice
| >>>> Loading required package: sos
| >>>> Loading required package: brew
| >>>> [1] "2011-06-29 09:40:18 EDT"
| >>>> * installing *source* package ?GUTS? ...
| >>>> ** libs
| >>>> *** arch - i386
| >>>> g++ -arch i386 -I/Library/Frameworks/R.framework/Resources/include -I/Library/Frameworks/R.framework/Resources/include/i386 -I/opt/local/include -I/usr/local/include -I"/Library/Frameworks/R.framework/Versions/2.13/Resources/library/Rcpp/include"   -fPIC  -g -O2 -c GUTS.cpp -o GUTS.o
| >>>> In file included from GUTS.cpp:12:
| >>>> GUTS.h:21:28: error: boost/random.hpp: No such file or directory
| >>>> GUTS.h:22:40: error: boost/math/distributions.hpp: No such file or directory
| >>>> GUTS.cpp: In function ?void to_print(double)?:
| >>>> GUTS.cpp:277: error: ?cout? was not declared in this scope
| >>>> GUTS.cpp: In member function ?void GUTS::showObject()?:
| >>>> GUTS.cpp:281: error: ?cout? is not a member of ?std?
| >>>> GUTS.cpp:284: error: ?cout? was not declared in this scope
| >>>> make: *** [GUTS.o] Error 1
| >>>> ERROR: compilation failed for package ?GUTS?
| >>>> * removing ?/Library/Frameworks/R.framework/Versions/2.13/Resources/library/GUTS?
| >>>> 
| >>>>> sessionInfo()
| >>>> R version 2.13.0 beta (2011-04-04 r55296)
| >>>> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
| >>>> 
| >>>> locale:
| >>>> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
| >>>> 
| >>>> attached base packages:
| >>>> [1] stats     graphics  grDevices utils     datasets  methods   base
| >>>> 
| >>>> other attached packages:
| >>>> [1] mgcv_1.7-6      sos_1.3-0       brew_1.0-6      lattice_0.19-26
| >>>> 
| >>>> loaded via a namespace (and not attached):
| >>>> [1] grid_2.13.0        Matrix_0.999375-50 nlme_3.1-101       tools_2.13.0
| >>>> 
| >>>> --
| >>>> David.
| >>>> 
| >>>> 
| >>>>> 
| >>>>> R: version
| >>>>> platform       i386-apple-darwin9.8.0
| >>>>> arch           i386
| >>>>> os             darwin9.8.0
| >>>>> system         i386, darwin9.8.0
| >>>>> status
| >>>>> major          2
| >>>>> minor          13.0
| >>>>> year           2011
| >>>>> month          04
| >>>>> day            13
| >>>>> svn rev        55427
| >>>>> language       R
| >>>>> version.string R version 2.13.0 (2011-04-13)
| >>>>> 
| >>>>> I ~ $: gcc --version
| >>>>> i686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5666) (dot 3)
| >>>>> Copyright (C) 2007 Free Software Foundation, Inc.
| >>>>> This is free software; see the source for copying conditions.  There is NO
| >>>>> warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
| >>>>> 
| >>>>> I ~ $: less /opt/local/include/boost/version.hpp
| >>>>> //  Boost version.hpp configuration header file  ------------------------------//
| >>>>> [...]
| >>>>> #define BOOST_VERSION 104601
| >>>>> #define BOOST_LIB_VERSION "1_46_1"
| >>>>> [...]
| >>>>> 
| >>>>> ______________________________________________
| >>>>> R-devel at r-project.org mailing list
| >>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
| >>>> 
| >>>> David Winsemius, MD
| >>>> West Hartford, CT
| >>>> 
| >>>> 
| >>> 
| >>> ______________________________________________
| >>> R-devel at r-project.org mailing list
| >>> https://stat.ethz.ch/mailman/listinfo/r-devel
| >> 
| >> 
| > 
| 

-- 
Gauss once played himself in a zero-sum game and won $50.
                      -- #11 at http://www.gaussfacts.com


From soeren.vogel at uzh.ch  Wed Jun 29 21:26:26 2011
From: soeren.vogel at uzh.ch (soeren.vogel at uzh.ch)
Date: Wed, 29 Jun 2011 21:26:26 +0200
Subject: [Rd] Compilation error Mac binary
In-Reply-To: <19979.31422.968209.149059@max.nulle.part>
References: <F6167619-EE98-4827-8D74-FF50AED840AB@uzh.ch>
	<BEE8EEB7-4A4E-4AC7-A8FB-437E20EDB81B@comcast.net>
	<EE02A6DC-5371-4775-8EF6-686750FB0527@uzh.ch>
	<4E0B5D06.5030209@statistik.tu-dortmund.de>
	<9E4D59BC-CA18-4798-A924-D8C9859D7E3D@R-Project.org>
	<AFFE7410-B248-459B-92C5-525DA02897F6@r-project.org>
	<19979.31422.968209.149059@max.nulle.part>
Message-ID: <7AAAEA21-D8E9-4BD8-945A-F3CCAD024665@uzh.ch>

On 29.06.2011, at 21:19, Dirk Eddelbuettel wrote:

> Soeren just shown resilience and persistence in getting his package
> written, built and now onto CRAN.  The remaining step is to learn more about
> cross-platform build issues.  Because that is the (high) standard of CRAN,
> and if you want to be part of it, you are expected to conform.  No shortcuts.

Hehehe :-D Okay, Dirk, I'll try my best :-)!

Cheers
S?ren


From lawrence.michael at gene.com  Thu Jun 30 03:09:53 2011
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Wed, 29 Jun 2011 18:09:53 -0700
Subject: [Rd] invalid body argument for function
Message-ID: <BANLkTi=BhB-Qg_S_=MRKpdKg3q+-F=EGxA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110629/2e8ba5e4/attachment.pl>

From S.J.Eglen at damtp.cam.ac.uk  Thu Jun 30 16:38:16 2011
From: S.J.Eglen at damtp.cam.ac.uk (Stephen Eglen)
Date: Thu, 30 Jun 2011 15:38:16 +0100
Subject: [Rd] suggestion for small change to pdf.Rd
Message-ID: <22823.1309444696@maps>

Here is a patch against 
https://svn.r-project.org/R/trunk/src/library/grDevices/man/pdf.Rd
to make description of defaults more consistent.

Stephen

--- pdf.Rd~	2011-06-30 15:24:30.000000000 +0100
+++ pdf.Rd	2011-06-30 15:35:18.000000000 +0100
@@ -64,7 +64,7 @@
     points.  Defaults to \code{12}.}
   \item{pagecentre}{logical: should the device region be centred on the
     page? -- is only relevant for \code{paper != "special"}.  Defaults
-    to true.}
+    to \code{TRUE}.}
   \item{colormodel}{a character string describing the color model:
     currently allowed values are \code{"rgb"}, \code{"gray"} and
     \code{"cmyk"}.  Defaults to \code{"rgb"}.}
@@ -79,7 +79,7 @@
   \item{useKerning}{logical.  Should kerning corrections be included in
     setting text and calculating string widths?  Defaults to \code{TRUE}.}
   \item{fillOddEven}{logical controlling the polygon fill mode:  see
-    \code{\link{polygon}} for details.  Default \code{FALSE}.}
+    \code{\link{polygon}} for details.  Defaults to \code{FALSE}.}
   \item{maxRasters}{integer.  The maximum number of raster images that
     can be stored in this PDF document.  Defaults to \code{64L}.}
   \item{compress}{logical.  Should PDF streams be generated with Flate


From murdoch.duncan at gmail.com  Thu Jun 30 17:25:59 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 30 Jun 2011 11:25:59 -0400
Subject: [Rd] suggestion for small change to pdf.Rd
In-Reply-To: <22823.1309444696@maps>
References: <22823.1309444696@maps>
Message-ID: <4E0C9587.6050302@gmail.com>

Done.

On 30/06/2011 10:38 AM, Stephen Eglen wrote:
> Here is a patch against
> https://svn.r-project.org/R/trunk/src/library/grDevices/man/pdf.Rd
> to make description of defaults more consistent.
>
> Stephen
>
> --- pdf.Rd~	2011-06-30 15:24:30.000000000 +0100
> +++ pdf.Rd	2011-06-30 15:35:18.000000000 +0100
> @@ -64,7 +64,7 @@
>       points.  Defaults to \code{12}.}
>     \item{pagecentre}{logical: should the device region be centred on the
>       page? -- is only relevant for \code{paper != "special"}.  Defaults
> -    to true.}
> +    to \code{TRUE}.}
>     \item{colormodel}{a character string describing the color model:
>       currently allowed values are \code{"rgb"}, \code{"gray"} and
>       \code{"cmyk"}.  Defaults to \code{"rgb"}.}
> @@ -79,7 +79,7 @@
>     \item{useKerning}{logical.  Should kerning corrections be included in
>       setting text and calculating string widths?  Defaults to \code{TRUE}.}
>     \item{fillOddEven}{logical controlling the polygon fill mode:  see
> -    \code{\link{polygon}} for details.  Default \code{FALSE}.}
> +    \code{\link{polygon}} for details.  Defaults to \code{FALSE}.}
>     \item{maxRasters}{integer.  The maximum number of raster images that
>       can be stored in this PDF document.  Defaults to \code{64L}.}
>     \item{compress}{logical.  Should PDF streams be generated with Flate
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Thu Jun 30 18:35:46 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 30 Jun 2011 12:35:46 -0400
Subject: [Rd] invalid body argument for function
In-Reply-To: <BANLkTi=BhB-Qg_S_=MRKpdKg3q+-F=EGxA@mail.gmail.com>
References: <BANLkTi=BhB-Qg_S_=MRKpdKg3q+-F=EGxA@mail.gmail.com>
Message-ID: <4E0CA5E2.9040307@gmail.com>

On 29/06/2011 9:09 PM, Michael Lawrence wrote:
> Hi guys,
>
> Looks like mkCLOSXP cannot handle external pointers as the function body.
> Work around is obvious, but I guess it's a bug nonetheless.

I don't know if it's a bug.  The mkCLOSXP code has a list of types that 
it accepts; external pointers and environments aren't in that list, so 
you get the same error you saw with

fun<- eval(substitute(function() x, list(x = environment())))

There's a comment

/* This is called by function() {}, where an invalid
    body should be impossible. When called from
    other places (eg do_asfunction) they
    should do this checking in advance */


I don't know whether there's any reason for the restriction, but I'd 
want to look closely at what gets done with the body to make sure that 
putting an environment or external pointer or other weird type there 
doesn't cause other problems.

Duncan Murdoch

> >  library(RGtk2)
> >  fun<- eval(substitute(function() x, list(x = gtkWindow())))
> Error in eval(expr, envir, enclos) : invalid body argument for "function"
> Should NEVER happen; please bug.report() [mkCLOSXP]
>
> >  sessionInfo()
> R version 2.14.0 Under development (unstable) (--)
> Platform: i686-pc-linux-gnu (32-bit)
>
> locale:
> [1] C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] RGtk2_2.20.13 qtbase_0.8-16 visnab_0.0.1
>
> loaded via a namespace (and not attached):
>   [1] BSgenome_1.21.3       Biobase_2.11.10       Biostrings_2.21.6
>   [4] DBI_0.2-5             GenomicFeatures_1.5.5 GenomicRanges_1.3.39
>   [7] IRanges_1.11.11       MutableRanges_0.2.0   RColorBrewer_1.0-2
> [10] RCurl_1.5-0           RSQLite_0.9-4         Rsamtools_1.5.13
> [13] XML_3.2-0             biomaRt_2.7.2         colorspace_1.0-1
> [16] dichromat_1.2-3       munsell_0.2           objectSignals_0.5.1
> [19] plumbr_0.6.2          plyr_1.4.1            qtpaint_0.7.22
> [22] rtracklayer_1.13.3    scales_0.1.0          stringr_0.4
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From dushoff at mcmaster.ca  Thu Jun 30 20:09:30 2011
From: dushoff at mcmaster.ca (Jonathan Dushoff)
Date: Thu, 30 Jun 2011 14:09:30 -0400
Subject: [Rd] heatmap documentation typo
Message-ID: <BANLkTin_kDuhnpkQzJSFgrPVe8PZTdk3kA@mail.gmail.com>

Under Details, the documentation says "[if Rowv or Colv] is 'NULL',
_no reordering_ will be done for the corresponding side."  In fact, as
explained elsewhere in the documentation, 'NA' is required, not
'NULL'.

An anonymous expert suggested that I should attach an svn diff file to
this report, so I will.

JD
-------------- next part --------------
Index: heatmap.Rd
===================================================================
--- heatmap.Rd	(revision 56237)
+++ heatmap.Rd	(working copy)
@@ -94,7 +94,7 @@
   If either is missing, as by default, then the ordering of the
   corresponding dendrogram is by the mean value of the rows/columns,
   i.e., in the case of rows, \code{Rowv <- rowMeans(x, na.rm=na.rm)}.
-  If either is \code{\link{NULL}}, \emph{no reordering} will be done for
+  If either is \code{\link{NA}}, \emph{no reordering} will be done for
   the corresponding side.
 
   By default (\code{scale = "row"}) the rows are scaled to have mean

From hadley at rice.edu  Thu Jun 30 22:37:57 2011
From: hadley at rice.edu (Hadley Wickham)
Date: Thu, 30 Jun 2011 15:37:57 -0500
Subject: [Rd] Syntactically valid names
Message-ID: <BANLkTimg=TM0hYA1=Obknb+486Hv8T7Fdw@mail.gmail.com>

Hi all,

Is there any easy way to tell if a string is a syntactically valid name?

e.g.

is.syntactic("X123")
# TRUE
is.syntactic("[[")
# FALSE

One implementation would be:

is.syntactic <- function(x) x == make.names(x)

but I wonder if there's a more elegant way.

Thanks!

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From pdalgd at gmail.com  Thu Jun 30 23:48:12 2011
From: pdalgd at gmail.com (peter dalgaard)
Date: Thu, 30 Jun 2011 23:48:12 +0200
Subject: [Rd] Syntactically valid names
In-Reply-To: <BANLkTimg=TM0hYA1=Obknb+486Hv8T7Fdw@mail.gmail.com>
References: <BANLkTimg=TM0hYA1=Obknb+486Hv8T7Fdw@mail.gmail.com>
Message-ID: <2698F67A-DDF9-4EAF-B7A8-A4FAAE9CCC6B@gmail.com>


On Jun 30, 2011, at 22:37 , Hadley Wickham wrote:

> Hi all,
> 
> Is there any easy way to tell if a string is a syntactically valid name?
> 
> e.g.
> 
> is.syntactic("X123")
> # TRUE
> is.syntactic("[[")
> # FALSE
> 
> One implementation would be:
> 
> is.syntactic <- function(x) x == make.names(x)
> 
> but I wonder if there's a more elegant way.

I wouldn't expect so. The basic structure might be handled using a regexp of sorts, but even that is tricky because of the "dot not followed by number" rule, and then there's the stop list of reserved words, which would make your code clumsy whatever you do.

How on Earth would you expect anything to be significantly more elegant than your

function(x) x == make.names(x) 

anyway??! (OK, if there was a wrapper for the C level isValidName() function...)

-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


