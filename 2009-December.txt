From p.murrell at auckland.ac.nz  Tue Dec  1 02:17:58 2009
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Tue, 01 Dec 2009 14:17:58 +1300
Subject: [Rd] raster support in graphics devices
Message-ID: <4B146EC6.2000502@auckland.ac.nz>

Hi

This is for developers of extension packages that provide extra 
*graphics devices* for R.

In the *development* version of R, support has been added to the 
graphics engine for sending raster images (bitmaps) to a graphics 
device.  This consists mainly of two new device functions:  dev_Raster() 
and dev_Cap().

The R_GE_version constant (in GraphicsEngine.h) has been bumped up to 6 
as a marker of this change.

This means that, at a minimum, all graphics devices should be updated to 
provide dummy implementations of these new functions that just say the 
feature is not yet implemented (see for example the PicTeX and XFig 
devices in the 'grDevices' package).

A full implementation of dev_Raster() should be able to draw a raster 
image (provided as an array of 32-bit R colors) at any size, possibly 
(bilinear) interpolated (otherwise nearest-neighbour), at any 
orientation, and with a per-pixel alpha channel.  Where these are not 
natively supported by a device, the graphics engine provides some 
routines for scaling and rotating raster images (see for example the X11 
device).  The dev_Cap() function should return a representation of a 
raster image captured from the current device.  This will only make 
sense for some devices (see for example the Cairo device in the 
'grDevices' package).

A little more information and a couple of small examples are provided at
http://developer.r-project.org/Raster/raster-RFC.html

Paul
-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From tplate at acm.org  Tue Dec  1 04:59:25 2009
From: tplate at acm.org (Tony Plate)
Date: Mon, 30 Nov 2009 21:59:25 -0600
Subject: [Rd] documentation omission in Extract.Rd?
Message-ID: <4B14949D.4010007@acm.org>

The help file for "[<-" (and "[[<-" doesn't contain those functions in 
it's usage section ( .../src/library/base/man/Extract.Rd ).  Although 
that file lists "[<-" and "[[<-" as aliases, it doesn't document them in 
a formal manner (consequently, the "value" argument is not described in 
the "arguments" section.)

Is this an oversight, or are those documented elsewhere?  In contrast, 
src/library/base/man/Extract.factor.Rd does contain the replacement 
forms in its usage section (as does Extract.data.frame.Rd)

Also, Extract.Rd uses forms like "x[i, j, \dots , drop = TRUE]" in the 
usage section, while Extract.factor.Rd uses the "method" syntax: 
"\method{[}{factor}(x, \dots, drop = FALSE)".  Is this because the 
"method" syntax is not appropriate for the default methods that are 
documented in Extract.Rd, or is the source of the docs not up-to-date 
with the latest Rd syntax?  I ask because I was looking for examples of 
how to write documentation for extraction and replacement functions.

This is based on looking at the source code at 
http://svn.r-project.org/R/trunk/src/library/base/man/Extract.Rd and I 
see the same in R-2.10.0 for Linux.

-- Tony Plate


From maiagx at gmail.com  Tue Dec  1 05:48:33 2009
From: maiagx at gmail.com (Charlotte Maia)
Date: Tue, 1 Dec 2009 17:48:33 +1300
Subject: [Rd] raster support in graphics devices
Message-ID: <b7bfe54e0911302048y4ccebeb6n8f87584cb9b91ced@mail.gmail.com>

Hi,

I consider raster graphics highly problematic in statistics.
People get caught up in the idea of creating pretty pictures, rather
than effectively visualising information.

Plus a lot of people (who should know better) needlessly put raster
images inside reports and articles (even books), which either makes
the files large (and very difficult to view), or creates blurry
images, or both.

It's always good to have more functionality.
However, I certainly hope that most of the R community stick to vector
graphics (with conservative colour use), unless it is absolutely
necessary to do otherwise (and the only example I can think of, is
modelling images themselves).

On a side issue, I have found that R plots tend to be getting slower
over the years.
I think cairo was a bad move, however that's just my opinion...


regards
-- 
Charlotte Maia
http://sites.google.com/site/maiagx/home


From guillaume.yziquel at citycable.ch  Tue Dec  1 10:33:46 2009
From: guillaume.yziquel at citycable.ch (Guillaume Yziquel)
Date: Tue, 01 Dec 2009 10:33:46 +0100
Subject: [Rd] PROTECT and OCaml GC.
In-Reply-To: <7971A8AF-189B-4955-9E62-4E118E594792@r-project.org>
References: <4B11B75C.9070806@citycable.ch>
	<8ec76080911281625q5d5b8824hefb14af9b23d29f0@mail.gmail.com>
	<4B11C55E.2060909@citycable.ch>
	<F11B6C18-26EC-41F8-9EEB-A614D16945AC@r-project.org>
	<4B12C417.1050308@citycable.ch>
	<65D411CD-34C3-4B89-8FF0-98C9BD7613FB@r-project.org>
	<4B13FC0F.40604@citycable.ch>
	<F60B92C3-5989-404C-8FEB-1B6002824449@r-project.org>
	<4B140B7A.2080102@citycable.ch>
	<0A1D8E9D-0BD6-40F7-B98C-59075CE04E49@r-project.org>
	<4B143401.4050607@citycable.ch>
	<7971A8AF-189B-4955-9E62-4E118E594792@r-project.org>
Message-ID: <4B14E2FA.8000302@citycable.ch>

Simon Urbanek a ?crit :
> 
> On Nov 30, 2009, at 16:07 , Guillaume Yziquel wrote:
> 
>> Simon Urbanek a ?crit :
>>>>
>>>> And it goes then to my other question: How can you pass to eval a 
>>>> LANGSXP where the CAR is an *anonymous* function, no SYMSXP involved?
>>> You just pass it as value of the call. I suspect the reason it 
>>> doesn't work is in your code, not in the facility (note that the link 
>>> above is useless since the construction is mystery - if you were 
>>> constructing it right, it would work ;)).

The small example you gave just works out fine with the framework I've 
been building so far:

> yziquel at seldon:~$ ocaml-batteries
>         Objective Caml version 3.11.1
> 
>       _________________________________
>      |       | |                       |
>     [| +     | | Batteries Included  - |
>      |_______|_|_______________________|
>       _________________________________
>      |                       | |       |
>      | -    Type '#help;;'   | |     + |]
>      |_______________________|_|_______|
> 
> 
> # #require "R.interpreter";;
> # let show x = R.Pretty.t_of_sexp x;;
> val show : R.sexp -> R.PrettyTypes.t = <fun>
> # open R.PrettyTypes;;

This is administrativia.

> # let r_f_unevaluated = R.parse_sexp "function(x) x + 1";;
> val r_f_unevaluated : R.sexp = <abstr>
> # let r_f = R.eval_langsxp r_f_unevaluated;;
> val r_f : R.sexp = <abstr>
> # show r_f_unevaluated;;
> - : R.PrettyTypes.t =
> CALL (SYMBOL (Some ("function", SPECIAL)),
>  [(NULL, LIST [(ARG "x", PLACE)]);
>   (NULL,
>    CALL (SYMBOL (Some ("+", BUILTIN)), [(NULL, ARG "x"); (NULL, Unknown)]));
>   (NULL, STRINGS ["function(x) x + 1"])])
> # show r_f;;
> - : R.PrettyTypes.t =
> CLOSURE
>  {formals = LIST [(ARG "x", PLACE)];
>   clos_env = ENV {frame = NULL; hashtab = NULL}}

So after evaluating the parsed output of "function(x) x + 1", you indeed 
get a pure closure. So far so good.

> # let x = R.parse_sexp "11";;
> val x : R.sexp = <abstr>
> # R.sexptype x;;
> - : R.sexptype = R.RealSxp

Here's the argument, 11.

> # let call = R.langsxp_of_list [r_f; x] 2;;
> val call : R.lang R.sxp = <abstr>
> # show call;;
> - : R.PrettyTypes.t =
> CALL
>  (CLOSURE
>    {formals = LIST [(ARG "x", PLACE)];
>     clos_env = ENV {frame = NULL; hashtab = NULL}},
>  [(NULL, Unknown)])

Here's the call that is built out of the closure and 11. For 
construction details, the C function is given at the bottom.

> # let y = R.eval_langsxp call;;
> val y : R.sexp = <abstr>

And it gets correctly evaluated. So this is fine. In fact, it works on 
the majority of the things I try. So I guess I've been building it fine. 
What's not fine is the following, from the quantmod package:

> # let s = R.string "YHOO";;
> val s : string R.t = <abstr>

s is a STRSXP vector containing only one string: "YHOO".

> # let g = R.force (R.symbol "getSymbols");;
> val g : 'a R.t = <abstr>

g is the getSymbols function from quantmod. From the help(getSymbols) 
invocation:

> Usage:
> 
>      getSymbols(Symbols = NULL, 
>                 env = .GlobalEnv,
>                 reload.Symbols = FALSE,
>                 verbose = FALSE,
>                 warnings = TRUE,
>                 src = "yahoo",
>                 symbol.lookup = TRUE,
>                 auto.assign = TRUE,
>                 ...)

So I try out getSymbols("YHOO"). It works out fine, and returns silently 
in the R toplevel.

But, from my binding:

> # R.eval_langsxp (R.langsxp_of_list [g; s] 2);;
> Erreur dans as.character(sc[[1]]) : 
>   cannot coerce type 'closure' to vector of type 'character'
> Exception: Failure "OCaml-R error in r_eval_sxp C stub.".

Here are the values of s and g:

> # show s;;
> - : R.PrettyTypes.t = STRINGS ["YHOO"]
> # show g;;
> - : R.PrettyTypes.t =
> CLOSURE
>  {formals =
>    LIST
>     [(ARG "Symbols", NULL); (ARG "env", Unknown);
>      (ARG "reload.Symbols", Unknown); (ARG "verbose", Unknown);
>      (Unknown, Unknown); (ARG "src", STRINGS ["yahoo"]);
>      (ARG "symbol.lookup", Unknown); (ARG "auto.assign", Unknown);
>      (ARG "...", PLACE)];
>   clos_env = ENV {frame = NULL; hashtab = Unknown}}

For the sake of exhaustivity, here's the C functions that I wrote to 
make function calls:

> CAMLprim value r_eval_sxp (value sexp_list) {
>   CAMLparam1(sexp_list);
>   SEXP e;
>   int error = 0;
>   PROTECT(e = R_tryEval(Sexp_val(sexp_list), R_GlobalEnv, &error));
>   UNPROTECT(1);
>   if (error) caml_failwith("OCaml-R error in r_eval_sxp C stub.");
>   CAMLreturn(Val_sexp(e));
> }

and

> CAMLprim value r_langsxp_of_list (value l, value n) {
>   CAMLparam2(l, n);
>   CAMLlocal1(l_cursor);
>   SEXP s, t;
>   PROTECT(t = s = Rf_allocList(Int_val(n)));
>   SET_TYPEOF(s, LANGSXP);
>   int first_time = 1;
>   l_cursor = l;
>   while (l_cursor && Is_block(l_cursor)) {
>     if (first_time) {first_time = 0;} else {t = CDR(t);}
>     SETCAR(t, Sexp_val(Field(l_cursor, 0)));
>     l_cursor = Field(l_cursor, 1);
>   }
>   UNPROTECT(1);
>   CAMLreturn(Val_sexp(s));
> }

So I'm almost constructing LANGSXP lists in the way you do.

One last thing, concerning the use of promises. If I do install, 
findVar, without forcing the resulting promise, and then construct the 
call, I get a failure:

> # R.eval_langsxp (R.langsxp_of_list [(R.symbol "str"); (R.symbol "lm")] 2);;
> Erreur dans function (object, ...)  : 
>   function g?n?rique incorrecte dans 'UseMethod'
> Exception: Failure "OCaml-R error in r_eval_sxp C stub.".

If I force the promises:

> # R.eval_langsxp (R.langsxp_of_list [(R.force (R.symbol "str")); (R.force (R.symbol "lm"))] 2);;
> function (formula, data, subset, weights, na.action, method = "qr", 
>     model = TRUE, x = FALSE, y = FALSE, qr = TRUE, singular.ok = TRUE, 
>     contrasts = NULL, offset, ...)  
> - : R.sexp = <abstr>

It works.

So you may say that "I'm not constructing it right", I still believe 
that describing precisely what kind of arguments is accepted by eval 
would a good thing.

All the best,

-- 
      Guillaume Yziquel
http://yziquel.homelinux.org/


From couteau at codelutin.com  Tue Dec  1 06:50:41 2009
From: couteau at codelutin.com (Jean Couteau)
Date: Tue, 01 Dec 2009 06:50:41 +0100
Subject: [Rd] Bug in R evaluating a huge instruction (PR#14096)
In-Reply-To: <4B144659.6090702@stats.uwo.ca>
References: <20091130155010.4EFF1282EFE3@mail.pubhealth.ku.dk>
	<4B144659.6090702@stats.uwo.ca>
Message-ID: <4B14AEB1.9090206@codelutin.com>

Thanks for your time Duncan,

I join here the instruction that is not correct, hoping that might help 
you. The file is encoded in utf-8 so you should not have any problem 
reading it.

I doubt to that it is an R bug too, but with all my tests i am less and 
less sure of that.

Best regards,
Jean Couteau
>
> Your message has encoding problems, so it's not readable.  Could you 
> put the code online somewhere where we could download it in its 
> original form?  I doubt if this is an R bug, but I can't point out the 
> problem in your code (or confirm that it really is an R bug) without 
> an undamaged copy of the code.
>
> Duncan Murdoch
>
>
>

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: morrisError.R
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091201/091d2a71/attachment.pl>

From maechler at stat.math.ethz.ch  Tue Dec  1 10:47:23 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 1 Dec 2009 10:47:23 +0100
Subject: [Rd] raster support in graphics devices
In-Reply-To: <b7bfe54e0911302048y4ccebeb6n8f87584cb9b91ced@mail.gmail.com>
References: <b7bfe54e0911302048y4ccebeb6n8f87584cb9b91ced@mail.gmail.com>
Message-ID: <19220.58923.284417.785545@lynne.math.ethz.ch>

>>>>> "CM" == Charlotte Maia <maiagx at gmail.com>
>>>>>     on Tue, 1 Dec 2009 17:48:33 +1300 writes:

    CM> Hi,
    CM> I consider raster graphics highly problematic in statistics.
    CM> People get caught up in the idea of creating pretty pictures, rather
    CM> than effectively visualising information.

    CM> Plus a lot of people (who should know better) needlessly put raster
    CM> images inside reports and articles (even books), which either makes
    CM> the files large (and very difficult to view), or creates blurry
    CM> images, or both.

    CM> It's always good to have more functionality.

Yes indeed, and Paul has to be thanked loudly and heartfully and
very much for providing it in the realm of graphics !!!

    CM> However, I certainly hope that most of the R community stick to vector
    CM> graphics (with conservative colour use), unless it is absolutely
    CM> necessary to do otherwise

I agree with your reasoning *pro* using vector graphics
as much as possible, and warning against the overuse of raster
graphics in scientific work !

    CM> necessary to do otherwise (and the only example I can think of, is
    CM> modelling images themselves).

Did you look at the interesting page Paul sent the URL for,
http://developer.r-project.org/Raster/raster-RFC.html ?

Yes, modelling images is probably *the* most important
application area, but *fast* direct plotting of a large matrix,
mapping one matrix entry A_{i,j} to one pixel is also quite
attractive, and the Matrix package authors (me being one) are
quite interested to eventually see a version of 
  lattice::levelplot()  that builds on Paul's new
  grid::grid.raster() or grid::rasterGrob()  functions.


    CM> On a side issue, I have found that R plots tend to be getting slower
    CM> over the years.

    CM> I think cairo was a bad move, however that's just my opinion...

Dear me...  
using Cairo features for X11 graphics is just the new default,
so users notice the nice new possibilities !
If you want the very fast (but not so very nice looking)
previous default X11() graphics, please do read the help pages:
-->  ?X11  
-->  ?X11.options
and then either  X11.options(type = "Xlib")
or               X11(        type = "Xlib")

will give you the very fast (non-aliased, no alpha blending)
X11 graphics that used to be the only one in R originally.

Martin Maechler, ETH Zurich

    CM> regards
    CM> -- 
    CM> Charlotte Maia
    CM> http://sites.google.com/site/maiagx/home


From romain.francois at dbmail.com  Tue Dec  1 10:59:46 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Tue, 01 Dec 2009 10:59:46 +0100
Subject: [Rd] Bug in R evaluating a huge instruction (PR#14096)
In-Reply-To: <4B14AEB1.9090206@codelutin.com>
References: <20091130155010.4EFF1282EFE3@mail.pubhealth.ku.dk>	<4B144659.6090702@stats.uwo.ca>
	<4B14AEB1.9090206@codelutin.com>
Message-ID: <4B14E912.7090505@dbmail.com>


Hello,

Since we don't have the morris function, I have tested using this one:

 > morris <- function(...) lapply(list(...), str )

If I just copy and paste into the console, R waits for more input, but 
if I parse the file, it is fine:

 > eval( parse( "morrisError.R" ) )
  NULL
  chr [1:86] "PecheAmateurs d?cembre.proportionMetier" ...
  num 10
List of 3
  $ type     : chr "oat"
  $ levels   : num [1:86] 5 5 5 5 5 5 5 5 5 5 ...
  $ grid.jump: num [1:86] 2 2 2 2 2 2 2 2 2 2 ...
  num [1:86] 0 0 0 11 10 12 0.06 10 11 0 ...
  num [1:86] 1 1 1 15 14 16 0.09 14 15 2 ...


Also fine if I source the file:

 > a<-morris(model=NULL,factors=c("PecheAmateurs 
d?cembre.proportionMetier","PechePetitMetierMer 
mai.proportionMetier","PecheAmateurs mai.proportionMet ..." ... [TRUNCATED]
  NULL
  chr [1:86] "PecheAmateurs d?cembre.proportionMetier" ...
  num 10
List of 3
  $ type     : chr "oat"
  $ levels   : num [1:86] 5 5 5 5 5 5 5 5 5 5 ...
  $ grid.jump: num [1:86] 2 2 2 2 2 2 2 2 2 2 ...
  num [1:86] 0 0 0 11 10 12 0.06 10 11 0 ...
  num [1:86] 1 1 1 15 14 16 0.09 14 15 2 ...


I think the limit imposed by the R_ParseBuffer function (in gram.y) is 
1024 characters.

Romain


On 12/01/2009 06:50 AM, Jean Couteau wrote:
> Thanks for your time Duncan,
>
> I join here the instruction that is not correct, hoping that might help
> you. The file is encoded in utf-8 so you should not have any problem
> reading it.
>
> I doubt to that it is an R bug too, but with all my tests i am less and
> less sure of that.
>
> Best regards,
> Jean Couteau
>>
>> Your message has encoding problems, so it's not readable. Could you
>> put the code online somewhere where we could download it in its
>> original form? I doubt if this is an R bug, but I can't point out the
>> problem in your code (or confirm that it really is an R bug) without
>> an undamaged copy of the code.
>>
>> Duncan Murdoch


-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/FtUu : new package : highlight
|- http://tr.im/EAD5 : LondonR slides
`- http://tr.im/BcPw : celebrating R commit #50000


From guillaume.yziquel at citycable.ch  Tue Dec  1 11:48:54 2009
From: guillaume.yziquel at citycable.ch (Guillaume Yziquel)
Date: Tue, 01 Dec 2009 11:48:54 +0100
Subject: [Rd] PROTECT and OCaml GC.
In-Reply-To: <4B14E2FA.8000302@citycable.ch>
References: <4B11B75C.9070806@citycable.ch>
	<8ec76080911281625q5d5b8824hefb14af9b23d29f0@mail.gmail.com>
	<4B11C55E.2060909@citycable.ch>
	<F11B6C18-26EC-41F8-9EEB-A614D16945AC@r-project.org>
	<4B12C417.1050308@citycable.ch>
	<65D411CD-34C3-4B89-8FF0-98C9BD7613FB@r-project.org>
	<4B13FC0F.40604@citycable.ch>
	<F60B92C3-5989-404C-8FEB-1B6002824449@r-project.org>
	<4B140B7A.2080102@citycable.ch>
	<0A1D8E9D-0BD6-40F7-B98C-59075CE04E49@r-project.org>
	<4B143401.4050607@citycable.ch>
	<7971A8AF-189B-4955-9E62-4E118E594792@r-project.org>
	<4B14E2FA.8000302@citycable.ch>
Message-ID: <4B14F496.5000001@citycable.ch>

Guillaume Yziquel a ?crit :
> 
> One last thing, concerning the use of promises. If I do install, 
> findVar, without forcing the resulting promise, and then construct the 
> call, I get a failure:
> 
>> # R.eval_langsxp (R.langsxp_of_list [(R.symbol "str"); (R.symbol 
>> "lm")] 2);;
>> Erreur dans function (object, ...)  :   function g?n?rique incorrecte 
>> dans 'UseMethod'
>> Exception: Failure "OCaml-R error in r_eval_sxp C stub.".
> 
> If I force the promises:
> 
>> # R.eval_langsxp (R.langsxp_of_list [(R.force (R.symbol "str")); 
>> (R.force (R.symbol "lm"))] 2);;
>> function (formula, data, subset, weights, na.action, method = "qr", 
>>     model = TRUE, x = FALSE, y = FALSE, qr = TRUE, singular.ok = TRUE, 
>>     contrasts = NULL, offset, ...)  - : R.sexp = <abstr>
> 
> It works.
> 
> So you may say that "I'm not constructing it right", I still believe 
> that describing precisely what kind of arguments is accepted by eval 
> would a good thing.

It seems that Matjaz Kukar had the same kind of issue that I have with 
usemethod:

	http://tolstoy.newcastle.edu.au/R/devel/04/10/0902.html

I just remark two things from the resulting thread:

-1- He asks where to find a more precise documentation of the R API, 
which is also something I'd be looking for,

-2- He has been suggested to use findVar1, which doesn't seem to be part 
of the API.

Will be looking into findVar1, findFun, findVar, though I do not 
understand why this fails in my case. Please feel free to enlighten me.

All the best,

-- 
      Guillaume Yziquel
http://yziquel.homelinux.org/


From guillaume.yziquel at citycable.ch  Tue Dec  1 12:58:44 2009
From: guillaume.yziquel at citycable.ch (Guillaume Yziquel)
Date: Tue, 01 Dec 2009 12:58:44 +0100
Subject: [Rd] PROTECT and OCaml GC.
In-Reply-To: <4B14F496.5000001@citycable.ch>
References: <4B11B75C.9070806@citycable.ch>
	<8ec76080911281625q5d5b8824hefb14af9b23d29f0@mail.gmail.com>
	<4B11C55E.2060909@citycable.ch>
	<F11B6C18-26EC-41F8-9EEB-A614D16945AC@r-project.org>
	<4B12C417.1050308@citycable.ch>
	<65D411CD-34C3-4B89-8FF0-98C9BD7613FB@r-project.org>
	<4B13FC0F.40604@citycable.ch>
	<F60B92C3-5989-404C-8FEB-1B6002824449@r-project.org>
	<4B140B7A.2080102@citycable.ch>
	<0A1D8E9D-0BD6-40F7-B98C-59075CE04E49@r-project.org>
	<4B143401.4050607@citycable.ch>
	<7971A8AF-189B-4955-9E62-4E118E594792@r-project.org>
	<4B14E2FA.8000302@citycable.ch> <4B14F496.5000001@citycable.ch>
Message-ID: <4B1504F4.9040606@citycable.ch>

Guillaume Yziquel a ?crit :
> Guillaume Yziquel a ?crit :
>>
>> One last thing, concerning the use of promises. If I do install, 
>> findVar, without forcing the resulting promise, and then construct the 
>> call, I get a failure:

Replacing findfun by findvar works in this specific case. See below.

Could someone explain why findfun works while findvar doesn't? I've been 
looking at the source code in envir.c, and it isn't really clear why one 
way works while the other doesn't.

Is it possible, given a variable/function name, to determine if it 
should use findFun or findVar? This would be helpful for the polymorphic 
static typing of R values.

> yziquel at seldon:~/git/ocamlr-quantmod$ ocaml-batteries
>         Objective Caml version 3.11.1
> 
>       _________________________________
>      |       | |                       |
>     [| +     | | Batteries Included  - |
>      |_______|_|_______________________|
>       _________________________________
>      |                       | |       |
>      | -    Type '#help;;'   | |     + |]
>      |_______________________|_|_______|
> 
> 
> # #require "R.interpreter";;
> # let show = R.Pretty.t_of_sexp;;
> val show : R.sexp -> R.PrettyTypes.t = <fun>

findFun works.

> # let str = R.findfun (R.install "str");;
> val str : ('_a -> 'b) R.t = <abstr>
> # let lm = R.findvar (R.install "lm");;
> val lm : 'a R.promise = <abstr>
> # R.eval [str; lm];;
> function (formula, data, subset, weights, na.action, method = "qr", 
>     model = TRUE, x = FALSE, y = FALSE, qr = TRUE, singular.ok = TRUE, 
>     contrasts = NULL, offset, ...)  
> - : R.sexp = <abstr>

findVar doesn't.

> # let str = R.findvar (R.install "str");;
> val str : 'a R.promise = <abstr>
> # R.eval [str; lm];;
> Erreur dans function (object, ...)  : 
>   function g?n?rique incorrecte dans 'UseMethod'
> Exception: Failure "OCaml-R error in r_eval_sxp C stub.".
> # 

All the best,

-- 
      Guillaume Yziquel
http://yziquel.homelinux.org/


From simon.urbanek at r-project.org  Tue Dec  1 15:16:32 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 1 Dec 2009 09:16:32 -0500
Subject: [Rd] raster support in graphics devices
In-Reply-To: <b7bfe54e0911302048y4ccebeb6n8f87584cb9b91ced@mail.gmail.com>
References: <b7bfe54e0911302048y4ccebeb6n8f87584cb9b91ced@mail.gmail.com>
Message-ID: <C9CDC645-4FCF-4652-99B2-AF1A091111DB@r-project.org>

Charlotte,

On Nov 30, 2009, at 23:48 , Charlotte Maia wrote:

> I consider raster graphics highly problematic in statistics.
> People get caught up in the idea of creating pretty pictures, rather
> than effectively visualising information.
>
> Plus a lot of people (who should know better) needlessly put raster
> images inside reports and articles (even books), which either makes
> the files large (and very difficult to view), or creates blurry
> images, or both.
>

I would like to point out that implicitly you have been already using  
raster graphics all the time in very inefficient form in heatmaps etc.  
The point here is not really about added functionality for the user  
but efficiency, because now we can finally use efficient encoding of  
heatmaps, matrix visualizations, overlay data over satellite images  
etc. Although all this was always possible in R, it was very  
inefficient and caused unwanted side effects (see the constant anti- 
aliasing discussions).

Cheers,
Simon


> It's always good to have more functionality.
> However, I certainly hope that most of the R community stick to vector
> graphics (with conservative colour use), unless it is absolutely
> necessary to do otherwise (and the only example I can think of, is
> modelling images themselves).
>
> On a side issue, I have found that R plots tend to be getting slower
> over the years.
> I think cairo was a bad move, however that's just my opinion...
>
>
> regards
> -- 
> Charlotte Maia
> http://sites.google.com/site/maiagx/home
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From murdoch at stats.uwo.ca  Tue Dec  1 15:58:42 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 01 Dec 2009 09:58:42 -0500
Subject: [Rd] Bug in R evaluating a huge instruction (PR#14096)
In-Reply-To: <4B14AEB1.9090206@codelutin.com>
References: <20091130155010.4EFF1282EFE3@mail.pubhealth.ku.dk>
	<4B144659.6090702@stats.uwo.ca> <4B14AEB1.9090206@codelutin.com>
Message-ID: <4B152F22.9000506@stats.uwo.ca>

On 01/12/2009 12:50 AM, Jean Couteau wrote:
> Thanks for your time Duncan,
> 
> I join here the instruction that is not correct, hoping that might help 
> you. The file is encoded in utf-8 so you should not have any problem 
> reading it.
> 
> I doubt to that it is an R bug too, but with all my tests i am less and 
> less sure of that.

I have no problem sourcing that file, but I do get an error if I try to 
cut and paste it, because it's a single line of 4890 characters, and 
that's too long.  So this is an R limitation, but it's one with an easy 
workaround:  just add some line breaks into your source.

Duncan Murdoch


> 
> Best regards,
> Jean Couteau
>> Your message has encoding problems, so it's not readable.  Could you 
>> put the code online somewhere where we could download it in its 
>> original form?  I doubt if this is an R bug, but I can't point out the 
>> problem in your code (or confirm that it really is an R bug) without 
>> an undamaged copy of the code.
>>
>> Duncan Murdoch
>>
>>
>>
>


From pengyu.ut at gmail.com  Tue Dec  1 17:04:09 2009
From: pengyu.ut at gmail.com (Peng Yu)
Date: Tue, 1 Dec 2009 10:04:09 -0600
Subject: [Rd] [R] How to quit unwanted execution immediately?
In-Reply-To: <4AFDB151.7070608@statistik.tu-dortmund.de>
References: <366c6f340910271301j43f36278w7b8fbca65cc8dcb@mail.gmail.com>
	<4AFDB151.7070608@statistik.tu-dortmund.de>
Message-ID: <366c6f340912010804sb68eaf2xf7135ddc9476ed21@mail.gmail.com>

The delay that I observe is when I type ctrl+C after I str() a long
list. Since str() comes from the core R installation, maybe it should
be improved?

> R can or cannot response immediately depending on the underlying C sources.
> If the underlying source code is written carefully enough, there are more or
> less regular checks for events such as this one.
> If you are using some contributed package, it may be an issue in this
> package's source code.
>
> Best wishes,
> Uwe Ligges
>
>
>
>
> Peng Yu wrote:
>>
>> Occasionally, I start a command (taking long time to finish) that I
>> did not really want to start. I type 'ctrl+C' to try to quit the
>> execution. However, R does not quit the execution of the command
>> immediately. I'm wondering if R could response to ctrl+C immediately.
>>
>> ______________________________________________
>> R-help at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide
>> http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
>


From steve.kalke at uni-rostock.de  Tue Dec  1 18:08:09 2009
From: steve.kalke at uni-rostock.de (Steve Kalke)
Date: Tue, 1 Dec 2009 18:08:09 +0100
Subject: [Rd] p-generalized normal distribution
In-Reply-To: <loom.20091128T024128-643@post.gmane.org>
References: <4B0C0FA2.2020104@uni-rostock.de>
	<loom.20091128T024128-643@post.gmane.org>
Message-ID: <4B154D79.9060501@uni-rostock.de>

Ben Bolker schrieb:
> Steve Kalke <steve.kalke <at> uni-rostock.de> writes:
>
>   
>> I would like to know if there is an R-package available for 
>> computing the density, distribution function,
>> quantiles and random 
>> numbers of the p-generalized normal distribution or 
>> if somebody is already working on it.
>>     
>
>   I haven't been able to find out what the p-generalized normal
> distribution is: the only paper I can find is
>
> Sinz, F., and M. Bethge$. 2009. Characterization of the p-generalized 
> normal distribution. Journal of Multivariate Analysis 100:817-820. 
> doi: 10.1016/j.jmva.2008.07.006.
>
> and I don't have access to it at the moment (although it does
> at least hint that the required distribution is multivariate;
> maybe p-dimensional?).  
>
>  Is it the same as this?
>
> Goodman, I. R., and S. Kotz. 1973. Multivariate ?-generalized normal
> distributions. Journal of Multivariate Analysis 3:204-219. doi:
> 10.1016/0047-259X(73)90023-7.
>
>   Where can we find a description?
>
>   (Short answer: as far as I can tell, it doesn't exist in
> R, but it would be good to have more information ...)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   

The p-generalized normal distribution was introduced in M.T. Subbotin's 
"On the law of frequency of errors" (1923), later studied in e.g. 
"Distributions in Statistics-Continous Univariate Distributions-2" from 
Johnson and Kotz (1970) or in "Continous l_n,p-symmetric distributions" 
from W.-D. Richter (2009), Lithuanian Math. J. 49.

A vector X=(X_1,...,X_n) is said to be p-generalized nomal distributed, 
if it's density function satisfies the reprensentation  f(x)=C^n * exp[-( 
|x_1|^p+...+|x_n|^p ) / p ] with C=p^(1-1/p)/(2*GAMMA(1/p)).


From baptiste.auguie at googlemail.com  Tue Dec  1 19:38:21 2009
From: baptiste.auguie at googlemail.com (baptiste auguie)
Date: Tue, 1 Dec 2009 19:38:21 +0100
Subject: [Rd] raster support in graphics devices
In-Reply-To: <4B146EC6.2000502@auckland.ac.nz>
References: <4B146EC6.2000502@auckland.ac.nz>
Message-ID: <de4e29f50912011038v33c3503dmb732dbd0d8ffd456@mail.gmail.com>

Very nice, thank you for this great addition to R graphics! I can't
wait to see lattice and ggplot2 functions that use rasterGrob to
display images. The pdf output is so much better in every way!

Incidentally, I ran into a segfault with grid.cap on the quartz
device, but maybe it's normal at this stage.

This works fine:

library(grid)
x11()
grid.text("test")
cap <- grid.cap()

This doesn't:

library(grid)
quartz()
grid.text("test")
cap <- grid.cap()

 *** caught segfault ***
address 0x18330001, cause 'memory not mapped'

Traceback:
 1: .Call(fnname, ..., PACKAGE = "grid")
 2: grid.Call("L_cap")
 3: grid.cap()

Possible actions:
1: abort (with core dump, if enabled)
2: normal R exit
3: exit R without saving workspace
4: exit R saving workspace

[R.app GUI 1.30 (5527) i386-apple-darwin9.8.0]

> sessionInfo()
R version 2.11.0 Under development (unstable) (2009-11-30 r50622)
i386-apple-darwin9.8.0

locale:
[1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

Best regards,

baptiste

2009/12/1 Paul Murrell <p.murrell at auckland.ac.nz>:
> Hi
>
> This is for developers of extension packages that provide extra *graphics
> devices* for R.
>
> In the *development* version of R, support has been added to the graphics
> engine for sending raster images (bitmaps) to a graphics device. ?This
> consists mainly of two new device functions: ?dev_Raster() and dev_Cap().
>
> The R_GE_version constant (in GraphicsEngine.h) has been bumped up to 6 as a
> marker of this change.
>
> This means that, at a minimum, all graphics devices should be updated to
> provide dummy implementations of these new functions that just say the
> feature is not yet implemented (see for example the PicTeX and XFig devices
> in the 'grDevices' package).
>
> A full implementation of dev_Raster() should be able to draw a raster image
> (provided as an array of 32-bit R colors) at any size, possibly (bilinear)
> interpolated (otherwise nearest-neighbour), at any orientation, and with a
> per-pixel alpha channel. ?Where these are not natively supported by a
> device, the graphics engine provides some routines for scaling and rotating
> raster images (see for example the X11 device). ?The dev_Cap() function
> should return a representation of a raster image captured from the current
> device. ?This will only make sense for some devices (see for example the
> Cairo device in the 'grDevices' package).
>
> A little more information and a couple of small examples are provided at
> http://developer.r-project.org/Raster/raster-RFC.html
>
> Paul
> --
> Dr Paul Murrell
> Department of Statistics
> The University of Auckland
> Private Bag 92019
> Auckland
> New Zealand
> 64 9 3737599 x85392
> paul at stat.auckland.ac.nz
> http://www.stat.auckland.ac.nz/~paul/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From violetlock at gmail.com  Tue Dec  1 20:57:29 2009
From: violetlock at gmail.com (violet lock)
Date: Tue, 1 Dec 2009 14:57:29 -0500
Subject: [Rd] barplot: auto sizing for ylim variable
Message-ID: <bb3f839b0912011157k20690fa6s47ab693d85d77caf@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091201/96b604b1/attachment.pl>

From p.murrell at auckland.ac.nz  Wed Dec  2 00:24:48 2009
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Wed, 02 Dec 2009 12:24:48 +1300
Subject: [Rd] raster support in graphics devices
In-Reply-To: <de4e29f50912011038v33c3503dmb732dbd0d8ffd456@mail.gmail.com>
References: <4B146EC6.2000502@auckland.ac.nz>
	<de4e29f50912011038v33c3503dmb732dbd0d8ffd456@mail.gmail.com>
Message-ID: <4B15A5C0.4060400@auckland.ac.nz>

Hi


baptiste auguie wrote:
> Very nice, thank you for this great addition to R graphics! I can't
> wait to see lattice and ggplot2 functions that use rasterGrob to
> display images. The pdf output is so much better in every way!
> 
> Incidentally, I ran into a segfault with grid.cap on the quartz
> device, but maybe it's normal at this stage.


This may be due to the fact that I tested the changes on Mac OS X 10.6 
(looks like you have 10.5 ?), plus the fact that I am feeling my way a 
bit on the Mac.  I have access to a 10.4 machine so I will try to take a 
look there.  Thanks for the report.

Paul


> This works fine:
> 
> library(grid)
> x11()
> grid.text("test")
> cap <- grid.cap()
> 
> This doesn't:
> 
> library(grid)
> quartz()
> grid.text("test")
> cap <- grid.cap()
> 
>  *** caught segfault ***
> address 0x18330001, cause 'memory not mapped'
> 
> Traceback:
>  1: .Call(fnname, ..., PACKAGE = "grid")
>  2: grid.Call("L_cap")
>  3: grid.cap()
> 
> Possible actions:
> 1: abort (with core dump, if enabled)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
> 
> [R.app GUI 1.30 (5527) i386-apple-darwin9.8.0]
> 
>> sessionInfo()
> R version 2.11.0 Under development (unstable) (2009-11-30 r50622)
> i386-apple-darwin9.8.0
> 
> locale:
> [1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> Best regards,
> 
> baptiste
> 
> 2009/12/1 Paul Murrell <p.murrell at auckland.ac.nz>:
>> Hi
>>
>> This is for developers of extension packages that provide extra *graphics
>> devices* for R.
>>
>> In the *development* version of R, support has been added to the graphics
>> engine for sending raster images (bitmaps) to a graphics device.  This
>> consists mainly of two new device functions:  dev_Raster() and dev_Cap().
>>
>> The R_GE_version constant (in GraphicsEngine.h) has been bumped up to 6 as a
>> marker of this change.
>>
>> This means that, at a minimum, all graphics devices should be updated to
>> provide dummy implementations of these new functions that just say the
>> feature is not yet implemented (see for example the PicTeX and XFig devices
>> in the 'grDevices' package).
>>
>> A full implementation of dev_Raster() should be able to draw a raster image
>> (provided as an array of 32-bit R colors) at any size, possibly (bilinear)
>> interpolated (otherwise nearest-neighbour), at any orientation, and with a
>> per-pixel alpha channel.  Where these are not natively supported by a
>> device, the graphics engine provides some routines for scaling and rotating
>> raster images (see for example the X11 device).  The dev_Cap() function
>> should return a representation of a raster image captured from the current
>> device.  This will only make sense for some devices (see for example the
>> Cairo device in the 'grDevices' package).
>>
>> A little more information and a couple of small examples are provided at
>> http://developer.r-project.org/Raster/raster-RFC.html
>>
>> Paul
>> --
>> Dr Paul Murrell
>> Department of Statistics
>> The University of Auckland
>> Private Bag 92019
>> Auckland
>> New Zealand
>> 64 9 3737599 x85392
>> paul at stat.auckland.ac.nz
>> http://www.stat.auckland.ac.nz/~paul/
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>

-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From maiagx at gmail.com  Wed Dec  2 01:36:18 2009
From: maiagx at gmail.com (Charlotte Maia)
Date: Wed, 2 Dec 2009 12:36:18 +1200
Subject: [Rd] raster support in graphics devices
In-Reply-To: <C9CDC645-4FCF-4652-99B2-AF1A091111DB@r-project.org>
References: <b7bfe54e0911302048y4ccebeb6n8f87584cb9b91ced@mail.gmail.com>
	<C9CDC645-4FCF-4652-99B2-AF1A091111DB@r-project.org>
Message-ID: <b7bfe54e0912011636n4cb4636i587caab5bc5e6b68@mail.gmail.com>

On 12/2/09, Simon Urbanek <simon.urbanek at r-project.org> wrote:
> Charlotte,
>
>
> I would like to point out that implicitly you have been already using raster
> graphics all the time in very inefficient form in heatmaps etc. The point
> here is not really about added functionality for the user but efficiency,
> because now we can finally use efficient encoding of heatmaps, matrix
> visualizations, overlay data over satellite images etc. Although all this
> was always possible in R, it was very inefficient and caused unwanted side
> effects (see the constant anti-aliasing discussions).
>
> Cheers,
> Simon

I might be unpopular for saying this, heatmaps are horrible things.
The first time I created a heatmap, I thought this is pretty, I've
since learnt better.

If I wasn't unpopular for saying that, this will certainly make me
unpopular, what is with that image at the top of JSS? There is bad
typesetting, and then there is bad typesetting...

I think many users are getting caught up in creating pretty images,
and the impression I'm getting is that various software (not just R)
is making this easier.
Whenever I'm reading an article and I see a heatmap, I say a few curse
words and then just settle for reading the abstract, and maybe the
first page of the introduction, if I've had a good day...

There are still substantial problems with R's vector graphics,
creating curves and circles for example. On evince, my plots just look
like a bunch of "q"s (not sure whether it's evince's fault or R's
fault). Plus including figures in sweave is relatively difficult in my
opinion.

Regarding Martins comments on changing the graphics device, I have
noticed some errors in doing so, hence have been (reluctantly)
sticking to cairo. What that saying, if you can't beat them, joint
them... or something like that...

Then there's all those people (have no idea if this is correct or not)
that say creating plots in SAS and Matlab is faster than R.

Overall, I think there is substantial room for improvement both in the
use and implementation of vector graphics, especially static 2D vector
graphics, however trends for implementing  interactive graphics, 3d
graphics, and raster images seem to be getting too much precedence.

In regards to Simon's comments, if we are going to focus on
efficiency, shouldn't we make the useful things efficient first, and
not gett too distracted.

I don't know anything about matrix visualisation, however I'm
sceptical that it is a good idea to take a giant matrix, and map one
element to one pixel, say with colour indexing (essentially just
another heatmap).

Noting my opinions here are in regards to the entire R community
(really the entire statistical community), not just the original post.


regards
-- 
Charlotte Maia
http://sites.google.com/site/maiagx/home


From guillaume.yziquel at citycable.ch  Wed Dec  2 02:32:55 2009
From: guillaume.yziquel at citycable.ch (Guillaume Yziquel)
Date: Wed, 02 Dec 2009 02:32:55 +0100
Subject: [Rd] PROTECT and OCaml GC.
In-Reply-To: <0A1D8E9D-0BD6-40F7-B98C-59075CE04E49@r-project.org>
References: <4B11B75C.9070806@citycable.ch>
	<8ec76080911281625q5d5b8824hefb14af9b23d29f0@mail.gmail.com>
	<4B11C55E.2060909@citycable.ch>
	<F11B6C18-26EC-41F8-9EEB-A614D16945AC@r-project.org>
	<4B12C417.1050308@citycable.ch>
	<65D411CD-34C3-4B89-8FF0-98C9BD7613FB@r-project.org>
	<4B13FC0F.40604@citycable.ch>
	<F60B92C3-5989-404C-8FEB-1B6002824449@r-project.org>
	<4B140B7A.2080102@citycable.ch>
	<0A1D8E9D-0BD6-40F7-B98C-59075CE04E49@r-project.org>
Message-ID: <4B15C3C7.5010809@citycable.ch>

Simon Urbanek a ?crit :
> 
> You just pass it as value of the call. I suspect the reason it doesn't 
> work is in your code, not in the facility (note that the link above is 
> useless since the construction is mystery - if you were constructing it 
> right, it would work ;)).
> 
> Small example:
> 
> SEXP myEval(SEXP FN, SEXP first_arg) {
>   return eval(LCONS(FN, CONS(first_arg, R_NilValue)), R_GlobalEnv);
> }
> 
> ... or reading R-ext:
> 
> "There are a series of small macros/functions to help construct 
> pairlists and language objects (whose internal structures just differ by 
> SEXPTYPE. Function CONS(u, v) is the basic building block: is constructs 
> a pairlist from u followed by v (which is a pairlist or R_NilValue). 
> LCONS is a variant that constructs a language object. Functions list1 to 
> list4 construct a pairlist from one to four items, andlang1 to lang4 do 
> the same for a language object (a function to call plus zero to three 
> arguments). Function elt and lastElt find the ith element and the last 
> element of a pairlist, and nthcdr returns a pointer to the nth position 
> in the pairlist (whose CAR is the nth item)."

Reading R-exts,

-1- I believe it would be a good idea to put an example with CONS and 
LCONS in section 5.11.

-2- Building a LANGSXP list with tags from arguments needs invocations 
of CONS LCONS SET_TAG and install. While this is not exactly to my 
taste, using install is really not to my taste since it checks the 
symbol table and eventually creates a symbol. Isn't there a way to 
create a tag without using install over and over? A macro that simply 
sets the tag to whatever CHARSXP might be useful?

-- 
      Guillaume Yziquel
http://yziquel.homelinux.org/


From simon.urbanek at r-project.org  Wed Dec  2 02:49:04 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 1 Dec 2009 20:49:04 -0500
Subject: [Rd] PROTECT and OCaml GC.
In-Reply-To: <4B15C3C7.5010809@citycable.ch>
References: <4B11B75C.9070806@citycable.ch>
	<8ec76080911281625q5d5b8824hefb14af9b23d29f0@mail.gmail.com>
	<4B11C55E.2060909@citycable.ch>
	<F11B6C18-26EC-41F8-9EEB-A614D16945AC@r-project.org>
	<4B12C417.1050308@citycable.ch>
	<65D411CD-34C3-4B89-8FF0-98C9BD7613FB@r-project.org>
	<4B13FC0F.40604@citycable.ch>
	<F60B92C3-5989-404C-8FEB-1B6002824449@r-project.org>
	<4B140B7A.2080102@citycable.ch>
	<0A1D8E9D-0BD6-40F7-B98C-59075CE04E49@r-project.org>
	<4B15C3C7.5010809@citycable.ch>
Message-ID: <B038D42D-B495-4D37-B8EB-655A8F2B1711@r-project.org>


On Dec 1, 2009, at 8:32 PM, Guillaume Yziquel wrote:

> Simon Urbanek a ?crit :
>> You just pass it as value of the call. I suspect the reason it doesn't work is in your code, not in the facility (note that the link above is useless since the construction is mystery - if you were constructing it right, it would work ;)).
>> Small example:
>> SEXP myEval(SEXP FN, SEXP first_arg) {
>>  return eval(LCONS(FN, CONS(first_arg, R_NilValue)), R_GlobalEnv);
>> }
>> ... or reading R-ext:
>> "There are a series of small macros/functions to help construct pairlists and language objects (whose internal structures just differ by SEXPTYPE. Function CONS(u, v) is the basic building block: is constructs a pairlist from u followed by v (which is a pairlist or R_NilValue). LCONS is a variant that constructs a language object. Functions list1 to list4 construct a pairlist from one to four items, andlang1 to lang4 do the same for a language object (a function to call plus zero to three arguments). Function elt and lastElt find the ith element and the last element of a pairlist, and nthcdr returns a pointer to the nth position in the pairlist (whose CAR is the nth item)."
> 
> Reading R-exts,
> 
> -1- I believe it would be a good idea to put an example with CONS and LCONS in section 5.11.
> 
> -2- Building a LANGSXP list with tags from arguments needs invocations of CONS LCONS SET_TAG and install. While this is not exactly to my taste, using install is really not to my taste since it checks the symbol table and eventually creates a symbol. Isn't there a way to create a tag without using install over and over? A macro that simply sets the tag to whatever CHARSXP might be useful?
> 

No, because you cannot use CHARSXP as a TAG. TAGs are always symbols. Therefore, logically, you must register it first in (or obtain from) the symbol table using install.

Cheers,
Simon


From guillaume.yziquel at citycable.ch  Wed Dec  2 03:31:25 2009
From: guillaume.yziquel at citycable.ch (Guillaume Yziquel)
Date: Wed, 02 Dec 2009 03:31:25 +0100
Subject: [Rd] PROTECT and OCaml GC.
In-Reply-To: <B038D42D-B495-4D37-B8EB-655A8F2B1711@r-project.org>
References: <4B11B75C.9070806@citycable.ch>
	<8ec76080911281625q5d5b8824hefb14af9b23d29f0@mail.gmail.com>
	<4B11C55E.2060909@citycable.ch>
	<F11B6C18-26EC-41F8-9EEB-A614D16945AC@r-project.org>
	<4B12C417.1050308@citycable.ch>
	<65D411CD-34C3-4B89-8FF0-98C9BD7613FB@r-project.org>
	<4B13FC0F.40604@citycable.ch>
	<F60B92C3-5989-404C-8FEB-1B6002824449@r-project.org>
	<4B140B7A.2080102@citycable.ch>
	<0A1D8E9D-0BD6-40F7-B98C-59075CE04E49@r-project.org>
	<4B15C3C7.5010809@citycable.ch>
	<B038D42D-B495-4D37-B8EB-655A8F2B1711@r-project.org>
Message-ID: <4B15D17D.7040308@citycable.ch>

Simon Urbanek a ?crit :
> 
> No, because you cannot use CHARSXP as a TAG. TAGs are always symbols. Therefore, logically, you must register it first in (or obtain from) the symbol table using install.

OK. That's R side.

OCaml side, I need to have as little side-effects as possible. Symbol 
assignment is a side-effect.

Is there an API-compliant way to handle this, and make data structures 
as immutable as possible?

-- 
      Guillaume Yziquel
http://yziquel.homelinux.org/


From maiagx at gmail.com  Wed Dec  2 03:34:36 2009
From: maiagx at gmail.com (Charlotte Maia)
Date: Wed, 2 Dec 2009 14:34:36 +1200
Subject: [Rd]  re: documentation omission in Extract.Rd?
Message-ID: <b7bfe54e0912011834l333eec6euc61080d0ae7d6d75@mail.gmail.com>

Hi Tony,

I don't know the answer to your question. The base package in R is
constantly full of pleasant surprises.

However I would image that the Rd files you have mentioned are
sufficient examples of how to write documentation for extraction and
replacement functions.


kind regards
-- 
Charlotte Maia
http://sites.google.com/site/maiagx/home


From ulrich.keller at uni.lu  Tue Dec  1 13:40:10 2009
From: ulrich.keller at uni.lu (ulrich.keller at uni.lu)
Date: Tue,  1 Dec 2009 13:40:10 +0100 (CET)
Subject: [Rd] Data viewer window not drawn properly with Compiz (PR#14099)
Message-ID: <20091201124010.D3F252831FED@mail.pubhealth.ku.dk>

Full_Name: Ulrich Keller
Version: 2.10.0
OS: Ubuntu Karmic i386
Submission from: (NULL) (158.64.77.254)


When Compiz is switched on in Ubuntu Karmic R's data editor is unusable. The
window contents are garbled from the start, and when scrolling through the data
using the arrow keys the contents of the editor window are not redrawn properly.
I have verified that the problem exists on two different machines with different
video hardware (Intel and ATI).

This might be an Ubuntu-specific problem (but I doubt it). I can't test this
since I don't have any non-Ubuntu machines.

Steps to reproduce:
1. Make sure Compiz is enabled.
2. Start R
3. Type:
View(matrix(rnorm(100), ncol = 5))
4. In the editor window that appears, use the arrow keys to scroll around.
Notice how the contents of the window get increasingly garbled.

I have already posted an Ubuntu bug report on Launchpad here:
https://bugs.launchpad.net/ubuntu/+source/r-base/+bug/472408

The Ubuntu bug report contains a screenshot of the broken editor window.



--please do not edit the information below--

Version:
 platform = i486-pc-linux-gnu
 arch = i486
 os = linux-gnu
 system = i486, linux-gnu
 status = 
 major = 2
 minor = 10.0
 year = 2009
 month = 10
 day = 26
 svn rev = 50208
 language = R
 version.string = R version 2.10.0 (2009-10-26)

Locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_GB.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

Search Path:
 .GlobalEnv, package:stats, package:graphics, package:grDevices, package:utils,
package:datasets, package:methods, Autoloads, package:base


From abstewart2 at bsu.edu  Tue Dec  1 18:10:14 2009
From: abstewart2 at bsu.edu (abstewart2 at bsu.edu)
Date: Tue,  1 Dec 2009 18:10:14 +0100 (CET)
Subject: [Rd] Macintosh R.app crashing (PR#14100)
Message-ID: <20091201171014.784CE282EF59@mail.pubhealth.ku.dk>

Full_Name: Ariel Stewart
Version: 2.10.0
OS: Mac OSX Tiger - v10.4.11
Submission from: (NULL) (147.226.161.33)


R.app crashes whenever I misspell anything, including variable names
(user-created variable names), but especially function names (default functions
such as plot() or package-provided functions such ade4's triangle.plot()) and
variable names that are sent to the function (such as mistyping xlab into
plot()).  It will also crash if I call a function from a package that is not
loaded, but I only did this once, so this is NOT the main problem.

It would be better if I just got an error message for each mistake rather than
the whole program crashing :-)

I just got R yesterday and I crashed it at least 50 times over a 4 hour period. 
By crash I mean the program stops responding and I either have to force quit it,
or my operating system brings up a popup telling me the program appears to have
"quit unexpectedly" and would I like to restart it.  Since I am using R.app I
don't know if it is R.app that is the problem or the underlying R, sorry!


From violetlock at gmail.com  Tue Dec  1 20:34:15 2009
From: violetlock at gmail.com (violet lock)
Date: Tue, 1 Dec 2009 14:34:15 -0500
Subject: [Rd] boxplot: auto sizing for ylim variable
Message-ID: <bb3f839b0912011134o50c0cff6lae004116ea32cd08@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091201/c3ca93b6/attachment.pl>

From couteau at codelutin.com  Wed Dec  2 08:27:14 2009
From: couteau at codelutin.com (Jean Couteau)
Date: Wed, 02 Dec 2009 08:27:14 +0100
Subject: [Rd] Bug in R evaluating a huge instruction (PR#14096)
In-Reply-To: <4B152F22.9000506@stats.uwo.ca>
References: <20091130155010.4EFF1282EFE3@mail.pubhealth.ku.dk>
	<4B144659.6090702@stats.uwo.ca> <4B14AEB1.9090206@codelutin.com>
	<4B152F22.9000506@stats.uwo.ca>
Message-ID: <4B1616D2.70908@codelutin.com>

Thank you very much for your input Duncan and Romain.

I will try to do what you are advising. The R instruction is generated 
from java using jri (and an abstraction layer we built upon it : 
nuiton-j2r), i will try add this limitation to nuiton-j2r so that it 
split the instruction if it is too long.

Best regards,
Jean

Duncan Murdoch wrote:
> On 01/12/2009 12:50 AM, Jean Couteau wrote:
>> Thanks for your time Duncan,
>>
>> I join here the instruction that is not correct, hoping that might 
>> help you. The file is encoded in utf-8 so you should not have any 
>> problem reading it.
>>
>> I doubt to that it is an R bug too, but with all my tests i am less 
>> and less sure of that.
>
> I have no problem sourcing that file, but I do get an error if I try 
> to cut and paste it, because it's a single line of 4890 characters, 
> and that's too long.  So this is an R limitation, but it's one with an 
> easy workaround:  just add some line breaks into your source.
>
> Duncan Murdoch
>
>
>>
>> Best regards,
>> Jean Couteau
>>> Your message has encoding problems, so it's not readable.  Could you 
>>> put the code online somewhere where we could download it in its 
>>> original form?  I doubt if this is an R bug, but I can't point out 
>>> the problem in your code (or confirm that it really is an R bug) 
>>> without an undamaged copy of the code.
>>>
>>> Duncan Murdoch
>>>
>>>
>>>
>>
>
>


From g.russell at eos-solutions.com  Wed Dec  2 10:55:12 2009
From: g.russell at eos-solutions.com (g.russell at eos-solutions.com)
Date: Wed,  2 Dec 2009 10:55:12 +0100 (CET)
Subject: [Rd] read.csv confused by newline characters in header (PR#14103)
Message-ID: <20091202095512.7F00E2831FFB@mail.pubhealth.ku.dk>

Full_Name: George Russell
Version: 2.10.0
OS: Microsoft Windows XP Service Pack 2
Submission from: (NULL) (217.111.3.131)


The following code (typed into R --vanilla)

testString <- '"B1\nB2"\n1\n'
con <- textConnection(testString)
tab <- read.csv(con,stringsAsFactors = FALSE)

produces a data frame with with one row and one column; the name of the column
is "B1.B2" (alright so far). However according to
print(tab[[1,1]])

the value of the entry in the first row and first column is

"B2\n1\n"

So B2 has somehow got into both the names of the data frame and its entry.
Either R is confused or I am. What is going on?


From P.Dalgaard at biostat.ku.dk  Wed Dec  2 13:55:40 2009
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 02 Dec 2009 13:55:40 +0100
Subject: [Rd] read.csv confused by newline characters in header
	(PR#14103)
In-Reply-To: <20091202095512.7F00E2831FFB@mail.pubhealth.ku.dk>
References: <20091202095512.7F00E2831FFB@mail.pubhealth.ku.dk>
Message-ID: <4B1663CC.4060206@biostat.ku.dk>

g.russell at eos-solutions.com wrote:
> Full_Name: George Russell
> Version: 2.10.0
> OS: Microsoft Windows XP Service Pack 2
> Submission from: (NULL) (217.111.3.131)
> 
> 
> The following code (typed into R --vanilla)
> 
> testString <- '"B1\nB2"\n1\n'
> con <- textConnection(testString)
> tab <- read.csv(con,stringsAsFactors = FALSE)
> 
> produces a data frame with with one row and one column; the name of the column
> is "B1.B2" (alright so far). However according to
> print(tab[[1,1]])
> 
> the value of the entry in the first row and first column is
> 
> "B2\n1\n"
> 
> So B2 has somehow got into both the names of the data frame and its entry.
> Either R is confused or I am. What is going on?

Presumably, read.table is not obeying quotes when removing what it
thinks is the header line. Another variation is this:

> tab <- read.table(stdin(), head=T)
0: "B1
0: B2"
1: 1
2:
> tab
  B1.B2
1   B2"
2     1


It's somehow connected to the

pushBack(c(lines, lines), file)

bits in readtable.R, but I don't quite get it.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From simon.urbanek at r-project.org  Wed Dec  2 15:07:39 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 2 Dec 2009 09:07:39 -0500
Subject: [Rd] Bug in R evaluating a huge instruction (PR#14096)
In-Reply-To: <4B1616D2.70908@codelutin.com>
References: <20091130155010.4EFF1282EFE3@mail.pubhealth.ku.dk>
	<4B144659.6090702@stats.uwo.ca> <4B14AEB1.9090206@codelutin.com>
	<4B152F22.9000506@stats.uwo.ca> <4B1616D2.70908@codelutin.com>
Message-ID: <53F62762-1611-4445-97E1-A3B3BA2AB0D4@r-project.org>


On Dec 2, 2009, at 2:27 , Jean Couteau wrote:

> Thank you very much for your input Duncan and Romain.
>
> I will try to do what you are advising. The R instruction is  
> generated from java using jri (and an abstraction layer we built  
> upon it : nuiton-j2r), i will try add this limitation to nuiton-j2r  
> so that it split the instruction if it is too long.
>

FWIW the restriction is only on the console input - if you send it  
directly, there is no limit (I have never heard of nuiton-j2r but if  
you use rJava to interface from Java to R there is no limit - the  
string you parse+evaluate can be of any length).

Cheers,
Simon


> Duncan Murdoch wrote:
>> On 01/12/2009 12:50 AM, Jean Couteau wrote:
>>> Thanks for your time Duncan,
>>>
>>> I join here the instruction that is not correct, hoping that might  
>>> help you. The file is encoded in utf-8 so you should not have any  
>>> problem reading it.
>>>
>>> I doubt to that it is an R bug too, but with all my tests i am  
>>> less and less sure of that.
>>
>> I have no problem sourcing that file, but I do get an error if I  
>> try to cut and paste it, because it's a single line of 4890  
>> characters, and that's too long.  So this is an R limitation, but  
>> it's one with an easy workaround:  just add some line breaks into  
>> your source.
>>
>> Duncan Murdoch
>>
>>
>>>
>>> Best regards,
>>> Jean Couteau
>>>> Your message has encoding problems, so it's not readable.  Could  
>>>> you put the code online somewhere where we could download it in  
>>>> its original form?  I doubt if this is an R bug, but I can't  
>>>> point out the problem in your code (or confirm that it really is  
>>>> an R bug) without an undamaged copy of the code.
>>>>
>>>> Duncan Murdoch
>>>>
>>>>
>>>>
>>>
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From simon.urbanek at r-project.org  Wed Dec  2 15:13:28 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 2 Dec 2009 09:13:28 -0500
Subject: [Rd] Macintosh R.app crashing (PR#14100)
In-Reply-To: <20091201171014.784CE282EF59@mail.pubhealth.ku.dk>
References: <20091201171014.784CE282EF59@mail.pubhealth.ku.dk>
Message-ID: <CA69076A-E3CF-47C1-AE67-71A6EA48C0FF@r-project.org>


On Dec 1, 2009, at 12:10 , abstewart2 at bsu.edu wrote:

> Full_Name: Ariel Stewart
> Version: 2.10.0
> OS: Mac OSX Tiger - v10.4.11
> Submission from: (NULL) (147.226.161.33)
>
>
> R.app crashes whenever I misspell anything, including variable names
> (user-created variable names), but especially function names  
> (default functions
> such as plot() or package-provided functions such ade4's  
> triangle.plot()) and
> variable names that are sent to the function (such as mistyping xlab  
> into
> plot()).  It will also crash if I call a function from a package  
> that is not
> loaded, but I only did this once, so this is NOT the main problem.
>
> It would be better if I just got an error message for each mistake  
> rather than
> the whole program crashing :-)
>
> I just got R yesterday and I crashed it at least 50 times over a 4  
> hour period.
> By crash I mean the program stops responding and I either have to  
> force quit it,
> or my operating system brings up a popup telling me the program  
> appears to have
> "quit unexpectedly" and would I like to restart it.  Since I am  
> using R.app I
> don't know if it is R.app that is the problem or the underlying R,  
> sorry!
>

I would expect you to have the time to start R once given that you  
started R.app 50 times ;). If what you say is true it takes 5 seconds  
to verify that it crashes at the same point...

Please use the R-SIG-Mac list as you are asked to and supply details  
(at the least the crash report, sessionInfo() and version of the GUI).

Thanks,
Simon


From nikko at hailmail.net  Wed Dec  2 17:57:32 2009
From: nikko at hailmail.net (Nicholas Lewin-Koh)
Date: Wed, 02 Dec 2009 08:57:32 -0800
Subject: [Rd] raster support in graphics devices
In-Reply-To: <mailman.27.1259751606.22148.r-devel@r-project.org>
References: <mailman.27.1259751606.22148.r-devel@r-project.org>
Message-ID: <1259773052.5674.1348091557@webmail.messagingengine.com>

Hi Charlotte,
I think I would have to respectfully disagree with you on many points.
While we all sigh when we see heatmaps used as data to explain
everything,
they do have their uses. But beyond heat maps, the nature and demands of
modern
statistical graphics has changed. Plotting huge data sets requires
generalization,
eg binning. Plotting binned data is more efficient in raster form.
Further, 
information visualization often requires blending raster images with
vector graphics.
There is as great many more examples where efficient use of raster
graphics in an R
device is a step forward. 

With regards to the X11 device I think we can safely say that it is a
legacy device. We
have all hit up on the limitations of what can be done on the x11
device, and hence
the slew of new devices that have been introduced to fill the void.
Cairo is slower,
but I think we can safely assume that speed will improve as
optimizations are added and
Moores law kicks in. 

Paul has added many interesting 2d vector graphics tools. Look at the
svn commits
over the years, xsplines, line joining (mitre), fonts, plotmath, ...
There is plenty of work on refining 2d graphics. 3d graphics and
interactive
graphics are also important. R is a flexible tool for prototyping new
graphical methods.
Why shoot ourselves in the foot?

Anyway, nough said.

Nicholas

> ------------------------------
> 
> Message: 9
> Date: Wed, 2 Dec 2009 12:36:18 +1200
> From: Charlotte Maia <maiagx at gmail.com>
> Subject: Re: [Rd] raster support in graphics devices
> To: Simon Urbanek <simon.urbanek at r-project.org>
> Cc: r-devel at r-project.org
> Message-ID:
> 	<b7bfe54e0912011636n4cb4636i587caab5bc5e6b68 at mail.gmail.com>
> Content-Type: text/plain; charset=ISO-8859-1
> 
> On 12/2/09, Simon Urbanek <simon.urbanek at r-project.org> wrote:
> > Charlotte,
> >
> >
> > I would like to point out that implicitly you have been already using raster
> > graphics all the time in very inefficient form in heatmaps etc. The point
> > here is not really about added functionality for the user but efficiency,
> > because now we can finally use efficient encoding of heatmaps, matrix
> > visualizations, overlay data over satellite images etc. Although all this
> > was always possible in R, it was very inefficient and caused unwanted side
> > effects (see the constant anti-aliasing discussions).
> >
> > Cheers,
> > Simon
> 
> I might be unpopular for saying this, heatmaps are horrible things.
> The first time I created a heatmap, I thought this is pretty, I've
> since learnt better.
> 
> If I wasn't unpopular for saying that, this will certainly make me
> unpopular, what is with that image at the top of JSS? There is bad
> typesetting, and then there is bad typesetting...
> 
> I think many users are getting caught up in creating pretty images,
> and the impression I'm getting is that various software (not just R)
> is making this easier.
> Whenever I'm reading an article and I see a heatmap, I say a few curse
> words and then just settle for reading the abstract, and maybe the
> first page of the introduction, if I've had a good day...
> 
> There are still substantial problems with R's vector graphics,
> creating curves and circles for example. On evince, my plots just look
> like a bunch of "q"s (not sure whether it's evince's fault or R's
> fault). Plus including figures in sweave is relatively difficult in my
> opinion.
> 
> Regarding Martins comments on changing the graphics device, I have
> noticed some errors in doing so, hence have been (reluctantly)
> sticking to cairo. What that saying, if you can't beat them, joint
> them... or something like that...
> 
> Then there's all those people (have no idea if this is correct or not)
> that say creating plots in SAS and Matlab is faster than R.
> 
> Overall, I think there is substantial room for improvement both in the
> use and implementation of vector graphics, especially static 2D vector
> graphics, however trends for implementing  interactive graphics, 3d
> graphics, and raster images seem to be getting too much precedence.
> 
> In regards to Simon's comments, if we are going to focus on
> efficiency, shouldn't we make the useful things efficient first, and
> not gett too distracted.
> 
> I don't know anything about matrix visualisation, however I'm
> sceptical that it is a good idea to take a giant matrix, and map one
> element to one pixel, say with colour indexing (essentially just
> another heatmap).
> 
> Noting my opinions here are in regards to the entire R community
> (really the entire statistical community), not just the original post.
> 
> 
> regards
> -- 
> Charlotte Maia
> http://sites.google.com/site/maiagx/home
> 
> 
>


From Greg.Snow at imail.org  Wed Dec  2 21:02:45 2009
From: Greg.Snow at imail.org (Greg Snow)
Date: Wed, 2 Dec 2009 13:02:45 -0700
Subject: [Rd] boxplot: auto sizing for ylim variable
In-Reply-To: <bb3f839b0912011134o50c0cff6lae004116ea32cd08@mail.gmail.com>
References: <bb3f839b0912011134o50c0cff6lae004116ea32cd08@mail.gmail.com>
Message-ID: <B37C0A15B8FB3C468B5BC7EBC7DA14CC62F710A1C0@LP-EXMBVS10.CO.IHC.COM>

I don't understand your question.  Are you trying to create a boxplot or barplot (you mention both), what scaling is not happening automatically that you would like?

Can you give a simple example of what you have tried, what results you are seeing and what results you would like to see instead?

-- 
Gregory (Greg) L. Snow Ph.D.
Statistical Data Center
Intermountain Healthcare
greg.snow at imail.org
801.408.8111


> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
> project.org] On Behalf Of violet lock
> Sent: Tuesday, December 01, 2009 12:34 PM
> To: r-devel at r-project.org
> Subject: [Rd] boxplot: auto sizing for ylim variable
> 
> Dear R-Devel,
> I am trying to create a boxplot for a large dataset (about 1500
> entries)
>  and was wondering if there was away to do auto sizing for the y-axis
> of a
> horizontal bar plot?  I know I could use a control structure to loop
> through
> the data instead, but as I know SAS has something does this
> automatically I
> thought R might as well.
> 
> Thanks,
> VL
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From pengyu.ut at gmail.com  Wed Dec  2 22:39:01 2009
From: pengyu.ut at gmail.com (Peng Yu)
Date: Wed, 2 Dec 2009 15:39:01 -0600
Subject: [Rd] [R] go back a block of code in history
In-Reply-To: <4B169D88.2090202@statistik.tu-dortmund.de>
References: <366c6f340911302015xc2c5e3bkd188b7cc8a77b425@mail.gmail.com>
	<4B169D88.2090202@statistik.tu-dortmund.de>
Message-ID: <366c6f340912021339y67f773d6w9ce63235ccc3b2fd@mail.gmail.com>

2009/12/2 Uwe Ligges <ligges at statistik.tu-dortmund.de>:
>
>
> Peng Yu wrote:
>>
>> Suppose I run the following code in the R session. At the last prompt
>> '>', I want to retrieve the second command (staring with 'y'). But I
>> have to type up arrow many times, which is very inconvenient. I'm
>> wondering if there is a way to configure R to skip block of code in
>> the history?
>
> I don't think so, but since you are writing your code in an editor
> (hopefully), it is probably easier to submit the relevant part of the code
> from the editor to R again.

It would be more convenient if there is a way to roll back a block of
code in the history. Could the development team add this feature to
the to-do list?

>>> x=list(a=c(1,2),b=c(3,4,5))
>>> y=list(a=c(1,2),b=c(3,4,5))
>>> lapply(seq(along=x)
>>
>> + ? ? ,function(i){
>> + ? ? ? cbind(
>> + ? ? ? ? ? x[[i]]
>> + ? ? ? ? ? ,y[[i]]
>> + ? ? ? ? ? )
>> + ? ? }
>> + ? ? )
>> [[1]]
>> ? ? [,1] [,2]
>> [1,] ? ?1 ? ?1
>> [2,] ? ?2 ? ?2
>>
>> [[2]]
>> ? ? [,1] [,2]
>> [1,] ? ?3 ? ?3
>> [2,] ? ?4 ? ?4
>> [3,] ? ?5 ? ?5
>>
>>
>> ______________________________________________
>> R-help at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide
>> http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
>


From lawremi at gmail.com  Thu Dec  3 00:17:12 2009
From: lawremi at gmail.com (Michael Lawrence)
Date: Wed, 2 Dec 2009 15:17:12 -0800
Subject: [Rd] combine UserDefinedDatabase and regular environments
In-Reply-To: <4B059464.2020003@dbmail.com>
References: <4AF31246.1060004@dbmail.com>
	<509e0620911190914g3cd6838eyd91b049680d737e7@mail.gmail.com>
	<4B059464.2020003@dbmail.com>
Message-ID: <509e0620912021517i1b972dbnba89fbd9a15165e7@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091202/3b126485/attachment.pl>

From romain.francois at dbmail.com  Thu Dec  3 08:11:25 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Thu, 03 Dec 2009 08:11:25 +0100
Subject: [Rd] combine UserDefinedDatabase and regular environments
In-Reply-To: <509e0620912021517i1b972dbnba89fbd9a15165e7@mail.gmail.com>
References: <4AF31246.1060004@dbmail.com>	
	<509e0620911190914g3cd6838eyd91b049680d737e7@mail.gmail.com>	
	<4B059464.2020003@dbmail.com>
	<509e0620912021517i1b972dbnba89fbd9a15165e7@mail.gmail.com>
Message-ID: <4B17649D.6050507@dbmail.com>

On 12/03/2009 12:17 AM, Michael Lawrence wrote:
>
>
> On Thu, Nov 19, 2009 at 10:54 AM, Romain Francois
> <romain.francois at dbmail.com <mailto:romain.francois at dbmail.com>> wrote:
>
>     On 11/19/2009 06:14 PM, Michael Lawrence wrote:
>
>
>
>         On Thu, Nov 5, 2009 at 9:58 AM, Romain Francois
>         <romain.francois at dbmail.com <mailto:romain.francois at dbmail.com>
>         <mailto:romain.francois at dbmail.com
>         <mailto:romain.francois at dbmail.com>>> wrote:
>
>             Hello,
>
>             Is it possible to have the effect of UserDefinedDatabase
>         outside of
>         "attached" environments ? Can I disguise an environment of the
>             sys.frames() as a UserDefinedDatabase ?
>
>             This seems to suggest that it might be possible :
>
>          > f <- function(){ e <- environment(); class(e) <-
>         "UserDefinedDatabase"; ff }
>          > f()
>
>
>         The UserDefinedDatabase support expects an R_ObjectTable C structure
>         embedded within an externalptr as the HASHTAB of the environment. So
>         it's really only possible from C.
>
>
>     Sure. Too bad both environments and user defined database use
>     HASHTAB with completely different meanings.
>
>     What I would want is something like this:
>
>     f <- function(){
>             attachLocally( getSomeUserDefinedDatabaseFromC()  )
>             HELLO
>     }
>
>     and the variable associated with the binding "HELLO" would come
>     dynamically from the user defined database.
>
>
>     A more concrete example : rJava now has javaImport, that combined
>     with attach allows dynamic lookup for class names within a set of
>     imported java package paths:
>
>     attach( javaImport( "java.util" ), name = "java:java.util" )
>     v <- new( Vector )
>     m <- new( HashMap )
>
>     This is nice, but then as usual with attach, you forget to detach,
>     ... this question is about to find a way to have this instead:
>
>     f <- function(){
>             import( "java.util" )
>             v <- new( Vector )
>             v$add( 1 )
>             v
>     }
>
>     where the "java.util" is no more looked up when f returns.
>
>
>
> Probably no clean way to accomplish that. But you could always use
> with() if you can get that Java package as an environment.

Thanks for keeping this live. This would work if there was a way to 
enumerate classes from a java package, which is not always possible 
because of the flexibility of the java class loader mechanism. You can 
for example quite easily create a class loader that generates an 
infinity of classes ...

Romain

> Or use
> environment<-() to enclose your function in it. That's actually fairly
> Java-like, as normally the import has file scope and your classes are
> enclosed within that file.
>
> Michael


-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/Gq7i : ohloh
|- http://tr.im/FtUu : new package : highlight
`- http://tr.im/EAD5 : LondonR slides


From couteau at codelutin.com  Wed Dec  2 15:26:27 2009
From: couteau at codelutin.com (Jean Couteau)
Date: Wed, 02 Dec 2009 15:26:27 +0100
Subject: [Rd] Bug in R evaluating a huge instruction (PR#14096)
In-Reply-To: <53F62762-1611-4445-97E1-A3B3BA2AB0D4@r-project.org>
References: <20091130155010.4EFF1282EFE3@mail.pubhealth.ku.dk>
	<4B144659.6090702@stats.uwo.ca> <4B14AEB1.9090206@codelutin.com>
	<4B152F22.9000506@stats.uwo.ca> <4B1616D2.70908@codelutin.com>
	<53F62762-1611-4445-97E1-A3B3BA2AB0D4@r-project.org>
Message-ID: <4B167913.4030407@codelutin.com>


> FWIW the restriction is only on the console input - if you send it 
> directly, there is no limit (I have never heard of nuiton-j2r but if 
> you use rJava to interface from Java to R there is no limit - the 
> string you parse+evaluate can be of any length).
Hi Simon,

nuiton-j2r is in fact an abstraction layer to rjava or rserve so that it 
can switch between one or other implementation using simple 
configuration (http://maven-site.nuiton.org/nuiton-j2r/ sorry but this 
is in french). And in fact I encounter the problem using it.

What is done is basically creating the R instruction from java and 
sending it to R using the eval method from the Rengine object (as we use 
jri in this specific application). The R instruction should create an 
object a of class morris, and I try then to get back the a$X object (the 
X item of the morris object) but I get back a null object without any 
reason, that is why I tried copying the instruction directly in R and 
thus getting this problem.

So that is strange if you say that there is no limit using rjava/jri.

Cheers,
Jean
>
> Cheers,
> Simon
>
>
>> Duncan Murdoch wrote:
>>> On 01/12/2009 12:50 AM, Jean Couteau wrote:
>>>> Thanks for your time Duncan,
>>>>
>>>> I join here the instruction that is not correct, hoping that might 
>>>> help you. The file is encoded in utf-8 so you should not have any 
>>>> problem reading it.
>>>>
>>>> I doubt to that it is an R bug too, but with all my tests i am less 
>>>> and less sure of that.
>>>
>>> I have no problem sourcing that file, but I do get an error if I try 
>>> to cut and paste it, because it's a single line of 4890 characters, 
>>> and that's too long.  So this is an R limitation, but it's one with 
>>> an easy workaround:  just add some line breaks into your source.
>>>
>>> Duncan Murdoch
>>>
>>>
>>>>
>>>> Best regards,
>>>> Jean Couteau
>>>>> Your message has encoding problems, so it's not readable.  Could 
>>>>> you put the code online somewhere where we could download it in 
>>>>> its original form?  I doubt if this is an R bug, but I can't point 
>>>>> out the problem in your code (or confirm that it really is an R 
>>>>> bug) without an undamaged copy of the code.
>>>>>
>>>>> Duncan Murdoch
>>>>>
>>>>>
>>>>>
>>>>
>>>
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
>


From Jerry.Lewis at biogenidec.com  Wed Dec  2 17:55:12 2009
From: Jerry.Lewis at biogenidec.com (Jerry.Lewis at biogenidec.com)
Date: Wed,  2 Dec 2009 17:55:12 +0100 (CET)
Subject: [Rd] dchisq tail accuracy (PR#14105)
Message-ID: <20091202165512.E0EB12832002@mail.pubhealth.ku.dk>

Full_Name: Jerry W. Lewis
Version: 2.10.0
OS: Windows XP Professional
Submission from: (NULL) (198.180.131.16)


dchisq is inaccurate in the extreme tails.  For instance, dchisq(1510,2,952)
returns 4.871004e-18 which is almost 15 times smaller than the correct value of
7.053889e-17.  A better approach for ncp>0 would be
  besselI(sxn,d2,TRUE) * (x/ncp)^(d2/2) * exp(sxn-(x+ncp)/2)/2
where logs may prevent over/underflow in extreme calculations.


From jerry.lewis at biogenidec.com  Wed Dec  2 18:35:32 2009
From: jerry.lewis at biogenidec.com (jerry.lewis at biogenidec.com)
Date: Wed,  2 Dec 2009 18:35:32 +0100 (CET)
Subject: [Rd] dchisq tail accuracy (PR#14105)
Message-ID: <20091202173532.149F4282EFC6@mail.pubhealth.ku.dk>

The undefined variables in the original post are
   d2 <- df/2-1
   sxn <- sqrt(x*ncp)

Jerry
	[[alternative HTML version deleted]]


From thoralf.dassler at gmail.com  Wed Dec  2 15:05:11 2009
From: thoralf.dassler at gmail.com (thoralf.dassler at gmail.com)
Date: Wed,  2 Dec 2009 15:05:11 +0100 (CET)
Subject: [Rd] ./configure warning (PR#14104)
Message-ID: <20091202140511.662362831FFB@mail.pubhealth.ku.dk>

Full_Name: 
Version: devel_2009-12-01
OS: Linux
Submission from: (NULL) (146.87.149.164)


Can ./configure be made/told to look in

/usr/share/texmf/bin
instead of
/usr/bin or /usr/local/bin

for pdftex and pdflatex?

This saves me from creating symlinks, which, once there, create issues with
other programmes I am trying to compile.

Thanks


From rksh1 at cam.ac.uk  Thu Dec  3 12:04:03 2009
From: rksh1 at cam.ac.uk (Robin Hankin)
Date: Thu, 03 Dec 2009 11:04:03 +0000
Subject: [Rd] S4 and head() problems
Message-ID: <4B179B23.3030903@cam.ac.uk>

Hi

I am having difficulty defining an S4 method for head() and tail().

I can't quite provide minimal self-contained code
because the problem appears to require the whole corpus
of my package; and there also appears to be a difference
between sourcing the lines directly, and having them
installed in a package.

The lines in question (I think) are:

setClass("mdm",
         representation = representation(
           xold  = "matrix",
           types = "factor"
           )
         )

"mdm" <- function(xold, types){
  new("mdm", xold=xold, types=types)
}

setGeneric("head",function(x,...){standardGeneric("head")})
setMethod("head",signature="mdm",function(x,n=6,...){
  mdm(head(x at xold,n=n,...) , types=factor(head(x at types,n=n,...)))
} )


If the above lines are part of the package source, and I install the package
then sometimes  I get errors like

 > head(toy_mm())
Error in function (classes, fdef, mtable)  :
  unable to find an inherited method for function "head", for signature 
"matrix"
 >

and sometimes it works as desired.

Why should head() not be able to take the first few lines of a matrix?
It seems to be "forgetting" that head.matrix() exists.

Can anyone give me some pointers for debugging this problem?

rksh







-- 
Robin K. S. Hankin
Uncertainty Analyst
University of Cambridge
19 Silver Street
Cambridge CB3 9EP
01223-764877


From ripley at stats.ox.ac.uk  Thu Dec  3 13:00:51 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 3 Dec 2009 12:00:51 +0000 (GMT)
Subject: [Rd] ./configure warning (PR#14104)
In-Reply-To: <20091202140511.662362831FFB@mail.pubhealth.ku.dk>
References: <20091202140511.662362831FFB@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0912031156200.6400@gannet.stats.ox.ac.uk>

It's odd to have a architecture-specific directory (bin) under a 
no-architecture one (/usr/share).

But why have you filed a question as a bug report?  See the section 
BUGS in the FAQ.

Simply, configure looks along your path for executables, so set the 
path suitably when running configure: it captures the full paths of 
the selected exectuables.  E.g. I have

R_LATEXCMD=${R_LATEXCMD-${LATEX-'/usr/texbin/latex'}}

because I had /usr/texbin in my path when I configured R.


On Wed, 2 Dec 2009, thoralf.dassler at gmail.com wrote:

> Full_Name:
> Version: devel_2009-12-01
> OS: Linux
> Submission from: (NULL) (146.87.149.164)
>
>
> Can ./configure be made/told to look in
>
> /usr/share/texmf/bin
> instead of
> /usr/bin or /usr/local/bin
>
> for pdftex and pdflatex?
>
> This saves me from creating symlinks, which, once there, create issues with
> other programmes I am trying to compile.
>
> Thanks
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From romain.francois at dbmail.com  Thu Dec  3 13:50:33 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Thu, 03 Dec 2009 13:50:33 +0100
Subject: [Rd] Bug in R evaluating a huge instruction (PR#14096)
In-Reply-To: <4B167913.4030407@codelutin.com>
References: <20091130155010.4EFF1282EFE3@mail.pubhealth.ku.dk>	<4B144659.6090702@stats.uwo.ca>
	<4B14AEB1.9090206@codelutin.com>	<4B152F22.9000506@stats.uwo.ca>
	<4B1616D2.70908@codelutin.com>	<53F62762-1611-4445-97E1-A3B3BA2AB0D4@r-project.org>
	<4B167913.4030407@codelutin.com>
Message-ID: <4B17B419.9050300@dbmail.com>

Hi,

You really should use the REngine API, which lets you control jri and 
Rserve using the same api. See the org.rosuda.REngine package in 
http://www.rforge.net/org/docs/

Either wayn, I have no problem evaluating the problematic string with 
both apis.

Romain

On 12/02/2009 03:26 PM, Jean Couteau wrote:
>> FWIW the restriction is only on the console input - if you send it
>> directly, there is no limit (I have never heard of nuiton-j2r but if
>> you use rJava to interface from Java to R there is no limit - the
>> string you parse+evaluate can be of any length).
> Hi Simon,
>
> nuiton-j2r is in fact an abstraction layer to rjava or rserve so that it
> can switch between one or other implementation using simple
> configuration (http://maven-site.nuiton.org/nuiton-j2r/ sorry but this
> is in french). And in fact I encounter the problem using it.
>
> What is done is basically creating the R instruction from java and
> sending it to R using the eval method from the Rengine object (as we use
> jri in this specific application). The R instruction should create an
> object a of class morris, and I try then to get back the a$X object (the
> X item of the morris object) but I get back a null object without any
> reason, that is why I tried copying the instruction directly in R and
> thus getting this problem.
>
> So that is strange if you say that there is no limit using rjava/jri.
>
> Cheers,
> Jean
>>
>> Cheers,
>> Simon
>>
>>
>>> Duncan Murdoch wrote:
>>>> On 01/12/2009 12:50 AM, Jean Couteau wrote:
>>>>> Thanks for your time Duncan,
>>>>>
>>>>> I join here the instruction that is not correct, hoping that might
>>>>> help you. The file is encoded in utf-8 so you should not have any
>>>>> problem reading it.
>>>>>
>>>>> I doubt to that it is an R bug too, but with all my tests i am less
>>>>> and less sure of that.
>>>>
>>>> I have no problem sourcing that file, but I do get an error if I try
>>>> to cut and paste it, because it's a single line of 4890 characters,
>>>> and that's too long. So this is an R limitation, but it's one with
>>>> an easy workaround: just add some line breaks into your source.
>>>>
>>>> Duncan Murdoch
>>>>
>>>>
>>>>>
>>>>> Best regards,
>>>>> Jean Couteau
>>>>>> Your message has encoding problems, so it's not readable. Could
>>>>>> you put the code online somewhere where we could download it in
>>>>>> its original form? I doubt if this is an R bug, but I can't point
>>>>>> out the problem in your code (or confirm that it really is an R
>>>>>> bug) without an undamaged copy of the code.
>>>>>>
>>>>>> Duncan Murdoch

-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/Gq7i : ohloh
|- http://tr.im/FtUu : new package : highlight
`- http://tr.im/EAD5 : LondonR slides

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: MorrisREngine.java
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091203/b0119e79/attachment.pl>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: Morris.java
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091203/b0119e79/attachment-0001.pl>

From maechler at stat.math.ethz.ch  Thu Dec  3 15:06:42 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 3 Dec 2009 15:06:42 +0100
Subject: [Rd] S4 and head() problems
In-Reply-To: <4B179B23.3030903@cam.ac.uk>
References: <4B179B23.3030903@cam.ac.uk>
Message-ID: <19223.50674.540343.510370@lynne.math.ethz.ch>

Hi Robin,

>>>>> "Robin" == Robin Hankin <rksh1 at cam.ac.uk>
>>>>>     on Thu, 03 Dec 2009 11:04:03 +0000 writes:

    > Hi
    > I am having difficulty defining an S4 method for head() and tail().

    > I can't quite provide minimal self-contained code
    > because the problem appears to require the whole corpus
    > of my package; and there also appears to be a difference
    > between sourcing the lines directly, and having them
    > installed in a package.

    > The lines in question (I think) are:

    > setClass("mdm",
    > representation = representation(
    > xold  = "matrix",
    > types = "factor"
    > )
    > )

    > "mdm" <- function(xold, types){
    > new("mdm", xold=xold, types=types)
    > }

    > setGeneric("head",function(x,...){standardGeneric("head")})

I would not use setGeneric() here
rather only setMethod() :

    > setMethod("head",signature="mdm",function(x,n=6,...){
    > mdm(head(x at xold,n=n,...) , types=factor(head(x at types,n=n,...)))
    > } )


    > If the above lines are part of the package source, and I install the package
    > then sometimes  I get errors like

    >> head(toy_mm())
    > Error in function (classes, fdef, mtable)  :
    > unable to find an inherited method for function "head", for signature 
    > "matrix"
    >> 

    > and sometimes it works as desired.

    > Why should head() not be able to take the first few lines of a matrix?
    > It seems to be "forgetting" that head.matrix() exists.

    > Can anyone give me some pointers for debugging this problem?

    > rksh

you did not mention if your package uses a NAMESPACE
and if yes, what exactly you import and export,
and that can matter quite a bit.

In the Matrix package, we do *not* call setGeneric() for head,
just setMethod(), and I'd advise you to do that too.

Why you get different behavior depending on how exactly you load
the code seems very had to diagnose from a distance.

Regards,
Martin


From violetlock at gmail.com  Thu Dec  3 19:40:09 2009
From: violetlock at gmail.com (violet lock)
Date: Thu, 3 Dec 2009 13:40:09 -0500
Subject: [Rd] boxplot: auto sizing for ylim variable
In-Reply-To: <B37C0A15B8FB3C468B5BC7EBC7DA14CC62F710A1C0@LP-EXMBVS10.CO.IHC.COM>
References: <bb3f839b0912011134o50c0cff6lae004116ea32cd08@mail.gmail.com>
	<B37C0A15B8FB3C468B5BC7EBC7DA14CC62F710A1C0@LP-EXMBVS10.CO.IHC.COM>
Message-ID: <bb3f839b0912031040p7e011dacm73682fa24774c5e9@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091203/69904ba8/attachment.pl>

From pengyu.ut at gmail.com  Thu Dec  3 20:40:18 2009
From: pengyu.ut at gmail.com (pengyu.ut at gmail.com)
Date: Thu,  3 Dec 2009 20:40:18 +0100 (CET)
Subject: [Rd] documentation of intersect() on string vector and num vector
	and on duplicated elements (PR#14107)
Message-ID: <20091203194018.DD9D0282EF51@mail.pubhealth.ku.dk>

Full_Name: 
Version: 2.10.0
OS: 
Submission from: (NULL) (128.249.106.234)


The document on intersect()'s argument are spread into Arguments and Details
sections (see ?intersect). 

The following description is on the arguments (but from Details section). So I
think that it makes more sense to bring it to the Arguments section. May I
recommend such modification in future releases of R.

"Each of union, intersect, setdiff and setequal will discard any duplicated
values in the arguments, and they apply as.vector to their arguments (and so in
particular coerce factors to character vectors)."


From mwkimpel at gmail.com  Thu Dec  3 21:33:23 2009
From: mwkimpel at gmail.com (Mark Kimpel)
Date: Thu, 3 Dec 2009 15:33:23 -0500
Subject: [Rd] question about differences in behavior with NA subscripts in
	matrix vs. data.frame
Message-ID: <6b93d1830912031233t60bff260x3239d6470fc2fcd4@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091203/9dc41a0a/attachment.pl>

From mtmorgan at fhcrc.org  Thu Dec  3 22:00:28 2009
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Thu, 03 Dec 2009 13:00:28 -0800
Subject: [Rd] group generics
In-Reply-To: <4B144DC4.3020904@biostat.ucsf.edu>
References: <1259109265.8792.22.camel@markov.biostat.ucsf.edu>
	<6ph3a428z2r.fsf@gopher4.fhcrc.org>
	<4B144DC4.3020904@biostat.ucsf.edu>
Message-ID: <4B1826EC.5090504@fhcrc.org>

Hi Ross --

Ross Boylan wrote:
> 
> 
> Martin Morgan wrote:
>> Hi Ross -- 
> 
>> Ross Boylan <ross at biostat.ucsf.edu> writes:
> 
>>> I have classes A and B, where B contains A.  In the implementation of
>>> the group generic for B I would like to use the corresponding group
>>> generic for A.  Is there a way to do that?
> 
>>> setMethod("Arith", signature(e1="numeric", e2="B"), function(e1, e2) {
>>> 	# the next line does not work right
>>>   v <- selectMethod("callGeneric", signature=c("numeric", "A"))(e1, e2)
>>     v <- callGeneric(e1, as(e2, "A"))
> 
>> or probably
> 
>>    v <- callNextMethod(e1, e2)
> 
>> Martin
> 
> A different error this time, one that looks a lot like the report from
> Stephen.Pope at ubs.com on 2007-12-24 concerning callNextMethod:, except
> this is with
> callGeneric.
> 
> HOWEVER, the problem is erratic; when I started from scratch and took
> this code into a workspace and executed the commands, they worked as
> expected.  I had various false starts and revisions, as well as the real
> code on which the example is based, when the error occurred.  I tried
> taking in the real code (which defines generics with Arith from my
> actual classes, and which also fails as below), and the example still
> worked.
> 
> 
> My revised code:
> 
> setClass("A",
>          representation=representation(xa="numeric")
>          )
> 
> setMethod("Arith", signature(e1="numeric", e2="A"), function(e1, e2) {
>   new("A", xa=callGeneric(e1, e2 at xa))
> }
>          )
> 
> setClass("B",
>          representation=representation(xb="numeric"),
>          contains=c("A")
>          )
> 
> setMethod("Arith", signature(e1="numeric", e2="B"), function(e1, e2) {
>   new("B", xb=e1*e2 at xb, callNextMethod())
> }
> )
> 
> Results:
>> options(error=recover)
>> tb <- new("B", xb=1:3, new("A", xa=10))
>> 3*tb
> Error in get(fname, envir = envir) : object '.nextMethod' not found

I feel obliged to respond, since you were following my original
suggestion, but I don't really have a clear answer. I think the error
message is really an issue in the S4 infrastructure, arising from
combining callNextMethod, callGeneric, and group generics; I don't have
further insight on solving the underlying problem, and perhaps I have
misplaced expectations on how these elements are supposed to play
together. A work around is to stick with callGeneric

setClass("A", representation=representation(xa="numeric"))

setMethod("Arith", signature(e1="numeric", e2="A"), function(e1, e2) {
    new("A", xa=callGeneric(e1, e2 at xa))
})

setClass("B",
         representation=representation(xb="numeric"),
         contains=c("A"))

setMethod("Arith", signature(e1="numeric", e2="B"), function(e1, e2) {
    new("B", xb=e1*e2 at xb, callGeneric(e1, as(e2, "A")))
})

tb <- new("B", xb=1:3, new("A", xa=10)); 3 * tb

Martin

> 
> Enter a frame number, or 0 to exit
> 
>  1: 3 * tb
>  2: 3 * tb
>  3: test.R#16: new("B", xb = e1 * e2 at xb, callNextMethod())
>  4: initialize(value, ...)
>  5: initialize(value, ...)
>  6: callNextMethod()
>  7: .nextMethod(e1 = e1, e2 = e2)
>  8: test.R#6: new("A", xa = callGeneric(e1, e2 at xa))
>  9: initialize(value, ...)
> 10: initialize(value, ...)
> 11: callGeneric(e1, e2 at xa)
> 12: get(fname, envir = envir)
> 
> Selection: 0
> 
> The callGeneric in frame 11 is trying to get the primitive for
> multiplying numeric times numeric.  Quoting from Pope's analysis:
> [The primitive...]
>> does not get the various "magic" variables such as .Generic, .Method,
>> etc. defined in its frame. Thus, callGeneric() fails when, failing to
>> find ".Generic" then takes the function symbol for the call (which
>> callNextMethod() has constructed to be ".nextMethod") and attempts to
>> look it up, which of course also fails, leading to the resulting error
>> seen above.
> 
> I'm baffled, and hoping someone on the list has an idea.
> I'm running R 2.10 under ESS (in particular, I use c-c c-l in the code
> file to read in the code) on XP.

-- 
Martin Morgan
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From baptiste.auguie at googlemail.com  Thu Dec  3 22:10:10 2009
From: baptiste.auguie at googlemail.com (baptiste auguie)
Date: Thu, 3 Dec 2009 22:10:10 +0100
Subject: [Rd] raster support in graphics devices
In-Reply-To: <4B15A5C0.4060400@auckland.ac.nz>
References: <4B146EC6.2000502@auckland.ac.nz>
	<de4e29f50912011038v33c3503dmb732dbd0d8ffd456@mail.gmail.com>
	<4B15A5C0.4060400@auckland.ac.nz>
Message-ID: <de4e29f50912031310j598729f3g9a188d6a270cb91c@mail.gmail.com>

Hi again,

I found two possible bugs related to grid.raster, one with the quartz
device and the other with pdf.

In my example I was playing with the idea of using grid.raster to
create a filling pattern for rectangles. The pdf output does not seem
to respect the clipping (it may have nothing to do with grid.raster
though), whilst the quartz device with pdf file output often crashes
for more than 4 different raster objects (but not always). I'm afraid
I couldn't pinpoint the exact circumstance of the crash with a more
concise example.

Thanks in advance for any insights,

baptiste

### Start example ###

library(grid)

## create a motif
grid45 <- function(..., width=0.5, height=0.5){
  x11(width=width, height=height)
  grid.polygon(...)
  m <- grid.cap()
  dev.off()
  invisible(m)
}

.grid45 <- grid45()
## grid.raster(.grid45)

tile.motif <- function(m, nx=10, ny=nx){
  cols <- matrix(rep(m, nx), ncol=ncol(m)*nx, byrow=F)
  matrix(rep(t(cols), ny), nrow=nrow(cols)*ny, byrow=T)
}

## quartz()
## grid.raster(tile.motif(.grid45, 2, 3))

patternGrob <- function(x=unit(0.5, "npc"), y=unit(0.5, "npc"),
                        width=unit(1, "npc"), height=unit(1, "npc"),
                        motif=matrix("white"), AR=1,
                        motif.width=unit(5, "mm"),
                        motif.height=AR*motif.width,
                        pattern.offset=c(0, 0), # unimplemented
                        default.units="npc",
                        clip=TRUE, # testing purposes
                        gp=gpar(fill=NA), ...)
  {
    grob(x=x, y=y, width=width, height=height,
         motif=motif, motif.width=motif.width,
         motif.height=motif.height, clip=clip, gp=gp, ..., cl="pattern")
  }

widthDetails.pattern <- function(x) x$width
heightDetails.pattern <- function(x) x$height

drawDetails.pattern <- function(x, recording=TRUE){

##   calculate the number of tiles
  nx <- ceiling(convertUnit(x$width, "in", value=TRUE) /
                convertUnit(x$motif.width, "in", value=TRUE)) + 1
  ny <- ceiling(convertUnit(x$height, "in", axisFrom = "y", value=TRUE) /
                convertUnit(x$motif.height, "in", axisFrom = "y",
value=TRUE)) + 1

  width <- convertUnit(x$width, "in")
  height <- convertUnit(x$height, "in", axisFrom = "y")

##   clip the raster
  pushViewport(viewport(x=x$x, y=x$y,
          width=x$width, height=x$height, clip=x$clip))

  grid.raster(tile.motif(x$motif, nx, ny), width=nx*x$motif.width,
                         height=ny*x$motif.height)
  upViewport()

##   overlay the rectangle
  grid.rect(x=x$x, y=x$y,
          width=x$width, height=x$height,
          just="center", gp=x$gp)
}


g <- patternGrob(x=0.7, width=unit(0.3, "npc"),
                  height=unit(5.2, "cm"),
                  clip=TRUE, motif=.grid45)

## interactive use: OK
quartz()
grid.newpage()
grid.draw(g)

## png: OK
png(file="pngClip.png")
grid.newpage()
grid.draw(g)
dev.off()

## pdf: clipping does not occur
pdf(file="pdfClip.pdf")
grid.newpage()
grid.draw(g)
dev.off()

## quartz pdf: OK, but see below
quartz(file="quartzClip.pdf", type="pdf")
grid.newpage()
grid.draw(g)
dev.off()

g1 <- patternGrob(x=0.2, width=unit(0.2, "npc"),
                  height=unit(5.2, "cm"),
                  clip=TRUE, motif=.grid45)

g2 <- patternGrob(x=0.4, width=unit(0.2, "npc"),
                  height=unit(5.2, "cm"),
                  clip=TRUE, motif=.grid45)

g3 <- patternGrob(x=0.6, width=unit(0.2, "npc"),
                  height=unit(5.2, "cm"),
                  clip=TRUE, motif=.grid45)

g4 <- patternGrob(x=0.8, width=unit(0.2, "npc"),
                  height=unit(5.2, "cm"),
                  clip=TRUE, motif=.grid45)

quartz(file="quartzClip2.pdf", type="pdf")
grid.newpage()
grid.draw(g1)
grid.draw(g2)
grid.draw(g3)
grid.draw(g4)
dev.off()

 *** caught segfault ***
address 0x15dda018, cause 'memory not mapped'

Traceback:
 1: dev.off()

 sessionInfo()
R version 2.11.0 Under development (unstable) (2009-11-30 r50622)
i386-apple-darwin9.8.0

locale:
[1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets  methods
[8] base



2009/12/2 Paul Murrell <p.murrell at auckland.ac.nz>:
> Hi
>
>
> baptiste auguie wrote:
>>
>> Very nice, thank you for this great addition to R graphics! I can't
>> wait to see lattice and ggplot2 functions that use rasterGrob to
>> display images. The pdf output is so much better in every way!
>>
>> Incidentally, I ran into a segfault with grid.cap on the quartz
>> device, but maybe it's normal at this stage.
>
>
> This may be due to the fact that I tested the changes on Mac OS X 10.6
> (looks like you have 10.5 ?), plus the fact that I am feeling my way a bit
> on the Mac. ?I have access to a 10.4 machine so I will try to take a look
> there. ?Thanks for the report.
>
> Paul
>
>
>> This works fine:
>>
>> library(grid)
>> x11()
>> grid.text("test")
>> cap <- grid.cap()
>>
>> This doesn't:
>>
>> library(grid)
>> quartz()
>> grid.text("test")
>> cap <- grid.cap()
>>
>> ?*** caught segfault ***
>> address 0x18330001, cause 'memory not mapped'
>>
>> Traceback:
>> ?1: .Call(fnname, ..., PACKAGE = "grid")
>> ?2: grid.Call("L_cap")
>> ?3: grid.cap()
>>
>> Possible actions:
>> 1: abort (with core dump, if enabled)
>> 2: normal R exit
>> 3: exit R without saving workspace
>> 4: exit R saving workspace
>>
>> [R.app GUI 1.30 (5527) i386-apple-darwin9.8.0]
>>
>>> sessionInfo()
>>
>> R version 2.11.0 Under development (unstable) (2009-11-30 r50622)
>> i386-apple-darwin9.8.0
>>
>> locale:
>> [1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8
>>
>> attached base packages:
>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>
>> Best regards,
>>
>> baptiste
>>
>> 2009/12/1 Paul Murrell <p.murrell at auckland.ac.nz>:
>>>
>>> Hi
>>>
>>> This is for developers of extension packages that provide extra *graphics
>>> devices* for R.
>>>
>>> In the *development* version of R, support has been added to the graphics
>>> engine for sending raster images (bitmaps) to a graphics device. ?This
>>> consists mainly of two new device functions: ?dev_Raster() and dev_Cap().
>>>
>>> The R_GE_version constant (in GraphicsEngine.h) has been bumped up to 6
>>> as a
>>> marker of this change.
>>>
>>> This means that, at a minimum, all graphics devices should be updated to
>>> provide dummy implementations of these new functions that just say the
>>> feature is not yet implemented (see for example the PicTeX and XFig
>>> devices
>>> in the 'grDevices' package).
>>>
>>> A full implementation of dev_Raster() should be able to draw a raster
>>> image
>>> (provided as an array of 32-bit R colors) at any size, possibly
>>> (bilinear)
>>> interpolated (otherwise nearest-neighbour), at any orientation, and with
>>> a
>>> per-pixel alpha channel. ?Where these are not natively supported by a
>>> device, the graphics engine provides some routines for scaling and
>>> rotating
>>> raster images (see for example the X11 device). ?The dev_Cap() function
>>> should return a representation of a raster image captured from the
>>> current
>>> device. ?This will only make sense for some devices (see for example the
>>> Cairo device in the 'grDevices' package).
>>>
>>> A little more information and a couple of small examples are provided at
>>> http://developer.r-project.org/Raster/raster-RFC.html
>>>
>>> Paul
>>> --
>>> Dr Paul Murrell
>>> Department of Statistics
>>> The University of Auckland
>>> Private Bag 92019
>>> Auckland
>>> New Zealand
>>> 64 9 3737599 x85392
>>> paul at stat.auckland.ac.nz
>>> http://www.stat.auckland.ac.nz/~paul/
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>
> --
> Dr Paul Murrell
> Department of Statistics
> The University of Auckland
> Private Bag 92019
> Auckland
> New Zealand
> 64 9 3737599 x85392
> paul at stat.auckland.ac.nz
> http://www.stat.auckland.ac.nz/~paul/
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: quartzClip.pdf
Type: application/pdf
Size: 26671 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091203/cd012176/attachment-0002.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pdfClip.pdf
Type: application/pdf
Size: 1950816 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091203/cd012176/attachment-0003.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pngClip.png
Type: image/png
Size: 30763 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091203/cd012176/attachment-0001.png>

From ross at biostat.ucsf.edu  Thu Dec  3 22:35:02 2009
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Thu, 03 Dec 2009 13:35:02 -0800
Subject: [Rd] group generics
In-Reply-To: <4B1826EC.5090504@fhcrc.org>
References: <1259109265.8792.22.camel@markov.biostat.ucsf.edu>
	<6ph3a428z2r.fsf@gopher4.fhcrc.org> <4B144DC4.3020904@biostat.ucsf.edu>
	<4B1826EC.5090504@fhcrc.org>
Message-ID: <1259876102.9331.1.camel@markov.biostat.ucsf.edu>

Thanks for your help.  I had two concerns about using as: that it would
impose some overhead, and that it would require me to code an explicit
conversion function.  I see now that the latter is not true; I don't
know if the overhead makes much difference.

On Thu, 2009-12-03 at 13:00 -0800, Martin Morgan wrote:
> setMethod("Arith", signature(e1="numeric", e2="B"), function(e1, e2) {
>     new("B", xb=e1*e2 at xb, callGeneric(e1, as(e2, "A")))
> })

Things were getting too weird, so I punted and used explicitly named
function calls for the multiplication operation that was causing
trouble.

Ross


From jmc at r-project.org  Thu Dec  3 23:25:17 2009
From: jmc at r-project.org (John Chambers)
Date: Thu, 03 Dec 2009 14:25:17 -0800
Subject: [Rd] group generics
In-Reply-To: <1259876102.9331.1.camel@markov.biostat.ucsf.edu>
References: <1259109265.8792.22.camel@markov.biostat.ucsf.edu>	<6ph3a428z2r.fsf@gopher4.fhcrc.org>
	<4B144DC4.3020904@biostat.ucsf.edu>	<4B1826EC.5090504@fhcrc.org>
	<1259876102.9331.1.camel@markov.biostat.ucsf.edu>
Message-ID: <4B183ACD.6000003@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091203/475df026/attachment.pl>

From ross at biostat.ucsf.edu  Thu Dec  3 23:59:29 2009
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Thu, 03 Dec 2009 14:59:29 -0800
Subject: [Rd] group generics
In-Reply-To: <4B183ACD.6000003@r-project.org>
References: <1259109265.8792.22.camel@markov.biostat.ucsf.edu>
	<6ph3a428z2r.fsf@gopher4.fhcrc.org> <4B144DC4.3020904@biostat.ucsf.edu>
	<4B1826EC.5090504@fhcrc.org>
	<1259876102.9331.1.camel@markov.biostat.ucsf.edu>
	<4B183ACD.6000003@r-project.org>
Message-ID: <1259881169.9331.15.camel@markov.biostat.ucsf.edu>

On Thu, 2009-12-03 at 14:25 -0800, John Chambers wrote:
> I missed the earlier round of this discussion and only am commenting
> now to say that this doesn't seem weird at all, if I understand what
> you're trying to do.
> 
> Martin's basic suggestion,
> v <- callGeneric(e1, as(e2, "A"))
> seems the simplest solution.
> 
> You just want to make another call to the actual generic function,
> with new arguments, and let method selection take place.  In fact,
> it's pretty much the standard way to use group generics.  
> 
> John
There were 2 weird parts.  Mainly I was referring to the fact that
identical code (posted earlier) worked sometimes and not others.  I
could not figure out what the differences were between the 2 scenarios,
nor could I create a non-working scenario reliably.

The second part that seemed weird was that the code looked as if it
should work all the time (the last full version I posted, which used
callNextMethod() rather than callGeneric()).

Finally, I felt somewhat at sea with the group generics, since I wasn't
sure exactly how they worked, how they interacted with primitives, or
how they interacted with callNextMethod, selectMethod, etc.  I did study
what I thought were the relevant help entries.

Ross
> 
> 
> Ross Boylan wrote: 
> > Thanks for your help.  I had two concerns about using as: that it would
> > impose some overhead, and that it would require me to code an explicit
> > conversion function.  I see now that the latter is not true; I don't
> > know if the overhead makes much difference.
> > 
> > On Thu, 2009-12-03 at 13:00 -0800, Martin Morgan wrote:
> >   
> > > setMethod("Arith", signature(e1="numeric", e2="B"), function(e1, e2) {
> > >     new("B", xb=e1*e2 at xb, callGeneric(e1, as(e2, "A")))
> > > })
> > >     
> > 
> > Things were getting too weird, so I punted and used explicitly named
> > function calls for the multiplication operation that was causing
> > trouble.
> > 
> > Ross
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> > 
> >


From dasmailinglists at gmail.com  Fri Dec  4 00:10:04 2009
From: dasmailinglists at gmail.com (David Scherrer)
Date: Thu, 3 Dec 2009 18:10:04 -0500
Subject: [Rd] Error in namespaceExport(ns, exports) :
Message-ID: <1a3e78310912031510x41065f04t55c33697459e69b5@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091203/be71cd1b/attachment.pl>

From pengyu.ut at gmail.com  Fri Dec  4 03:20:11 2009
From: pengyu.ut at gmail.com (pengyu.ut at gmail.com)
Date: Fri,  4 Dec 2009 03:20:11 +0100 (CET)
Subject: [Rd] Error read.table()'s help page and put the distinction between
	(PR#14109)
Message-ID: <20091204022011.AC6BB282EF51@mail.pubhealth.ku.dk>

The word 'be' is missing after 'will' in the following sentence from
?read.table.

"Note that in either case the columns will logical unless =91colClasses=92
was supplied."

Another suggestion:

I think that it is make more sense to put at the begining the
description of the difference between the methods listed in on the
help page of read.table.

Currently, the document put the description of the arguments at the
beginning. But a new user would first want to figure out which method
to use before knowing what the arguments are.


From pengyu.ut at gmail.com  Fri Dec  4 03:38:52 2009
From: pengyu.ut at gmail.com (Peng Yu)
Date: Thu, 3 Dec 2009 20:38:52 -0600
Subject: [Rd] Tabs in R source code
In-Reply-To: <4B12ACDF.2030506@stats.uwo.ca>
References: <366c6f340911290758t71dd256dtd7975a49ae9155a7@mail.gmail.com>
	<4B12A3FD.9010006@stats.uwo.ca>
	<366c6f340911290850o3d4e16dfg3e2318339f0b0f92@mail.gmail.com>
	<4B12ACDF.2030506@stats.uwo.ca>
Message-ID: <366c6f340912031838i36fbcc56l533a927e194caa12@mail.gmail.com>

On Sun, Nov 29, 2009 at 11:18 AM, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 29/11/2009 11:50 AM, Peng Yu wrote:
>>
>> On Sun, Nov 29, 2009 at 10:40 AM, Duncan Murdoch <murdoch at stats.uwo.ca>
>> wrote:
>>>
>>> On 29/11/2009 10:58 AM, Peng Yu wrote:
>>>>
>>>> Some lines are indented by tabs and some lines are indented by spaces,
>>>> in R source code. This might due to the fact that the source code is
>>>> not from a single person. But I think that it is better to enforce a
>>>> single convention.
>>>>
>>>> My editor defaults a tab to 8 spaces. So some source doesn't seem to
>>>> be indented correctly in my editor. Since tab may be displayed
>>>> differently in different editor, I recommend to replace all the tabs
>>>> by the appropriate number of spaces to ensure the same indentation
>>>> display.
>>>
>>> The R source code assumes that tabs occur every 8 columns, so if your
>>> editor
>>> is working properly, it should display files as intended.
>>>
>>>> Could somebody update the source code in the future version by
>>>> replacing tabs by spaces and enforce such a coding convention in the
>>>> future?
>>>
>>> No, that would not be feasible, for the reason you give in the second
>>> sentence of your post.
>>
>> I don't understand why it is not feasible. The spaces are displayed
>> the same in all editors. If there are no tabs, the code should display
>> the same in all editors. I know some languages that are recommended to
>> have spaces rather than tabs for this reason.
>
> It is not feasible because it would require everyone who edits the source
> code to change the configuration of their editors. ?In my case, that would
> require changing about 3 different types of editors (I work on several
> different platforms). ?I would probably miss one, and re-introduce tabs the
> next time I edited a file on that editor.

http://google-styleguide.googlecode.com/svn/trunk/google-r-style.html

Here is the R style, which does not recommend using tabs. Although it
might take some time to forbidden the use of tabs, it will eventually
be a good practice that benefits everyone in the future.

> I've already seen problems in the NEWS and CHANGES files, which have
> recently changed to UTF-8 encoding. ?It's very irritating that my editor
> switches back to the Windows default if it doesn't see a byte-order mark,
> and that some editors that I use automatically delete the BOM. Requiring a
> particular "encoding" for tabs (i.e. converting them to spaces) would lead
> to the same problems, but on a much bigger scale.
>
> Duncan Murdoch
>


From chuck at sharpsteen.net  Fri Dec  4 04:44:59 2009
From: chuck at sharpsteen.net (Sharpie)
Date: Thu, 3 Dec 2009 19:44:59 -0800 (PST)
Subject: [Rd] Tabs in R source code
In-Reply-To: <366c6f340912031838i36fbcc56l533a927e194caa12@mail.gmail.com>
References: <366c6f340911290758t71dd256dtd7975a49ae9155a7@mail.gmail.com>
	<4B12A3FD.9010006@stats.uwo.ca>
	<366c6f340911290850o3d4e16dfg3e2318339f0b0f92@mail.gmail.com>
	<4B12ACDF.2030506@stats.uwo.ca>
	<366c6f340912031838i36fbcc56l533a927e194caa12@mail.gmail.com>
Message-ID: <1259898299849-948240.post@n4.nabble.com>



pengyu.ut wrote:
> 
> http://google-styleguide.googlecode.com/svn/trunk/google-r-style.html
> 
> Here is the R style, which does not recommend using tabs. Although it
> might take some time to forbidden the use of tabs, it will eventually
> be a good practice that benefits everyone in the future.
> 

Whoa, put the kibosh on that thought. 

That is Google's style guide for R code written at Google by Google
employees.  It is by no means the style guide adopted by the R core team. 
Representing it as the "official" R style guide is just inviting a torrent
of flaming email.

-- 
View this message in context: http://n4.nabble.com/Tabs-in-R-source-code-tp930751p948240.html
Sent from the R devel mailing list archive at Nabble.com.


From maechler at stat.math.ethz.ch  Fri Dec  4 11:57:35 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 4 Dec 2009 11:57:35 +0100
Subject: [Rd] Tabs in R source code
In-Reply-To: <1259898299849-948240.post@n4.nabble.com>
References: <366c6f340911290758t71dd256dtd7975a49ae9155a7@mail.gmail.com>
	<4B12A3FD.9010006@stats.uwo.ca>
	<366c6f340911290850o3d4e16dfg3e2318339f0b0f92@mail.gmail.com>
	<4B12ACDF.2030506@stats.uwo.ca>
	<366c6f340912031838i36fbcc56l533a927e194caa12@mail.gmail.com>
	<1259898299849-948240.post@n4.nabble.com>
Message-ID: <19224.60191.947906.876292@lynne.math.ethz.ch>

>>>>> "S" == Sharpie  <chuck at sharpsteen.net>
>>>>>     on Thu, 3 Dec 2009 19:44:59 -0800 (PST) writes:

    S> pengyu.ut wrote:
    >> 
    >> http://google-styleguide.googlecode.com/svn/trunk/google-r-style.html
    >> 
    >> Here is the R style, which does not recommend using tabs. Although it
    >> might take some time to forbidden the use of tabs, it will eventually
    >> be a good practice that benefits everyone in the future.
    >> 

    S> Whoa, put the kibosh on that thought. 

    S> That is Google's style guide for R code written at Google by Google
    S> employees.  It is by no means the style guide adopted by the R core team. 
    S> Representing it as the "official" R style guide is just inviting a torrent
    S> of flaming email.

Yes, indeed, thank you Sharpie.
You have given a wise and balanced answer earlier in this
thread, and that *was* close to probably most R core
members opinions.
Can we please, Peng, close this thread now?

Martin Maechler, ETH Zurich (and R-core).


From jeszenszky.peter at inf.unideb.hu  Fri Dec  4 13:24:43 2009
From: jeszenszky.peter at inf.unideb.hu (Jeszenszky Peter)
Date: Fri, 4 Dec 2009 13:24:43 +0100
Subject: [Rd] tm and e1071 question
Message-ID: <OF5751D6BE.EA403F72-ONC1257682.00442E85-C1257682.00442E88@inf.unideb.hu>


Dear Developers,

I would like to use the svm function of the e1071 package for text
classification tasks. Preprocessing can be carried out by using the
excellent tm text mining package.

TermDocumentMatrix and DocumentTermMatrix objects of the package tm
are currently implemented based on the sparse matrix data structures
provided by the slam package.

Unfortunately, the svm function of the e1071 package accepts only sparse
matrices of class Matrix provided by the Matrix package, or of class
matrix.csr as provided by the package SparseM.

In order to train an SVM with a DocumentTermMatrix object the latter
must be converted to a matrix.csr sparse matrix structure. However, none
of the publicly available packages of CRAN provides such a conversion
function. It is quite straightforward to write the conversion function,
but it would be much confortable to pass slam sparse matrix objects
directly to the svm function.

Do you plan to add slam sparse matrix support to the e1071 package?

Best regards,

Peter Jeszenszky


From ripley at stats.ox.ac.uk  Fri Dec  4 13:39:13 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 4 Dec 2009 12:39:13 +0000 (GMT)
Subject: [Rd] (PR#14103) read.csv confused by newline characters in
 header
In-Reply-To: <4B1663CC.4060206@biostat.ku.dk>
References: <20091202095512.7F00E2831FFB@mail.pubhealth.ku.dk>
	<4B1663CC.4060206@biostat.ku.dk>
Message-ID: <alpine.LFD.2.00.0912041211140.18586@gannet.stats.ox.ac.uk>

It's not to do with pushback per se.  The works as one might expect, 
e.g.

f <- file("test.txt", "r")
pushBack('"A1\nA2"', f)
pushBackLength(f)
scan(f, "", quote='"')

gives "A1\nA2" on a single line, then whatever was in test.txt.
Rather, the issue is

         if (header) {
             readLines(file, 1L)          # skip over header

and that stops at the embedded newline.  The fix is to read the header 
again the same way as before.

It seems to me that this is esoteric and the fix could tickle similar 
esoteric constructions, so I am only going to put the fix into R-devel 
and not the upcoming 2.10.1.


On Wed, 2 Dec 2009, Peter Dalgaard wrote:

> g.russell at eos-solutions.com wrote:
>> Full_Name: George Russell
>> Version: 2.10.0
>> OS: Microsoft Windows XP Service Pack 2
>> Submission from: (NULL) (217.111.3.131)
>>
>>
>> The following code (typed into R --vanilla)
>>
>> testString <- '"B1\nB2"\n1\n'
>> con <- textConnection(testString)
>> tab <- read.csv(con,stringsAsFactors = FALSE)
>>
>> produces a data frame with with one row and one column; the name of the column
>> is "B1.B2" (alright so far). However according to
>> print(tab[[1,1]])
>>
>> the value of the entry in the first row and first column is
>>
>> "B2\n1\n"
>>
>> So B2 has somehow got into both the names of the data frame and its entry.
>> Either R is confused or I am. What is going on?
>
> Presumably, read.table is not obeying quotes when removing what it
> thinks is the header line. Another variation is this:
>
>> tab <- read.table(stdin(), head=T)
> 0: "B1
> 0: B2"
> 1: 1
> 2:
>> tab
>  B1.B2
> 1   B2"
> 2     1
>
>
> It's somehow connected to the
>
> pushBack(c(lines, lines), file)
>
> bits in readtable.R, but I don't quite get it.
>
> --
>   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Fri Dec  4 13:40:25 2009
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Fri,  4 Dec 2009 13:40:25 +0100 (CET)
Subject: [Rd] (PR#14103) read.csv confused by newline characters in
Message-ID: <20091204124025.24B122832016@mail.pubhealth.ku.dk>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--27464147-536455723-1259929222=:18586
Content-Type: TEXT/PLAIN; CHARSET=ISO-8859-15; format=flowed
Content-Transfer-Encoding: 8BIT
Content-ID: <alpine.LFD.2.00.0912041222341.18586 at gannet.stats.ox.ac.uk>

It's not to do with pushback per se.  The works as one might expect, 
e.g.

f <- file("test.txt", "r")
pushBack('"A1\nA2"', f)
pushBackLength(f)
scan(f, "", quote='"')

gives "A1\nA2" on a single line, then whatever was in test.txt.
Rather, the issue is

         if (header) {
             readLines(file, 1L)          # skip over header

and that stops at the embedded newline.  The fix is to read the header 
again the same way as before.

It seems to me that this is esoteric and the fix could tickle similar 
esoteric constructions, so I am only going to put the fix into R-devel 
and not the upcoming 2.10.1.


On Wed, 2 Dec 2009, Peter Dalgaard wrote:

> g.russell at eos-solutions.com wrote:
>> Full_Name: George Russell
>> Version: 2.10.0
>> OS: Microsoft Windows XP Service Pack 2
>> Submission from: (NULL) (217.111.3.131)
>>
>>
>> The following code (typed into R --vanilla)
>>
>> testString <- '"B1\nB2"\n1\n'
>> con <- textConnection(testString)
>> tab <- read.csv(con,stringsAsFactors = FALSE)
>>
>> produces a data frame with with one row and one column; the name of the column
>> is "B1.B2" (alright so far). However according to
>> print(tab[[1,1]])
>>
>> the value of the entry in the first row and first column is
>>
>> "B2\n1\n"
>>
>> So B2 has somehow got into both the names of the data frame and its entry.
>> Either R is confused or I am. What is going on?
>
> Presumably, read.table is not obeying quotes when removing what it
> thinks is the header line. Another variation is this:
>
>> tab <- read.table(stdin(), head=T)
> 0: "B1
> 0: B2"
> 1: 1
> 2:
>> tab
>  B1.B2
> 1   B2"
> 2     1
>
>
> It's somehow connected to the
>
> pushBack(c(lines, lines), file)
>
> bits in readtable.R, but I don't quite get it.
>
> --
>   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595
--27464147-536455723-1259929222=:18586--


From ggrothendieck at gmail.com  Fri Dec  4 14:28:41 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 4 Dec 2009 08:28:41 -0500
Subject: [Rd] raster support in graphics devices
In-Reply-To: <4B146EC6.2000502@auckland.ac.nz>
References: <4B146EC6.2000502@auckland.ac.nz>
Message-ID: <971536df0912040528w4226179el7f833c736941406d@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091204/c1ad53f3/attachment.pl>

From baptiste.auguie at googlemail.com  Fri Dec  4 15:06:52 2009
From: baptiste.auguie at googlemail.com (baptiste auguie)
Date: Fri, 4 Dec 2009 15:06:52 +0100
Subject: [Rd] raster support in graphics devices
In-Reply-To: <971536df0912040528w4226179el7f833c736941406d@mail.gmail.com>
References: <4B146EC6.2000502@auckland.ac.nz>
	<971536df0912040528w4226179el7f833c736941406d@mail.gmail.com>
Message-ID: <de4e29f50912040606r365a932by697fd500460773aa@mail.gmail.com>

Hi,

You can use grid.cap,

x11()
plot(1:10)
g = grid.cap()
dev.off()
str(g)
# chr [1:672, 1:671] "white" "white" "white" "white" "white" ...

but as far as I understand in ?grid.cap and the underlying code there
is no "capGrob" equivalent that wouldn't require opening a new device
before capturing the output.

 I hope I'm mistaken.

Best,

baptiste

2009/12/4 Gabor Grothendieck <ggrothendieck at gmail.com>:
> Currently I have an application that saves the current graphics image (that
> was created with classic graphics or grid graphics) to a file and then reads
> the file back in using readBin:
>
> png("my.png")
> plot(1:10)
> dev.off()
> raw.img <- readBin("my.png", "raw", size = 1, n = 100000000)
>
> (I am doing this on Windows but would like to be able to do it on any
> platform.)
>
> Does the new raster functionality give me any way to get the object raw.img
> without creating the intermediate file, my.png? ?If so what is the
> corresponding code?
>
>
> On Mon, Nov 30, 2009 at 8:17 PM, Paul Murrell <p.murrell at auckland.ac.nz>wrote:
>
>> Hi
>>
>> This is for developers of extension packages that provide extra *graphics
>> devices* for R.
>>
>> In the *development* version of R, support has been added to the graphics
>> engine for sending raster images (bitmaps) to a graphics device. ?This
>> consists mainly of two new device functions: ?dev_Raster() and dev_Cap().
>>
>> The R_GE_version constant (in GraphicsEngine.h) has been bumped up to 6 as
>> a marker of this change.
>>
>> This means that, at a minimum, all graphics devices should be updated to
>> provide dummy implementations of these new functions that just say the
>> feature is not yet implemented (see for example the PicTeX and XFig devices
>> in the 'grDevices' package).
>>
>> A full implementation of dev_Raster() should be able to draw a raster image
>> (provided as an array of 32-bit R colors) at any size, possibly (bilinear)
>> interpolated (otherwise nearest-neighbour), at any orientation, and with a
>> per-pixel alpha channel. ?Where these are not natively supported by a
>> device, the graphics engine provides some routines for scaling and rotating
>> raster images (see for example the X11 device). ?The dev_Cap() function
>> should return a representation of a raster image captured from the current
>> device. ?This will only make sense for some devices (see for example the
>> Cairo device in the 'grDevices' package).
>>
>> A little more information and a couple of small examples are provided at
>> http://developer.r-project.org/Raster/raster-RFC.html
>>
>> Paul
>> --
>> Dr Paul Murrell
>> Department of Statistics
>> The University of Auckland
>> Private Bag 92019
>> Auckland
>> New Zealand
>> 64 9 3737599 x85392
>> paul at stat.auckland.ac.nz
>> http://www.stat.auckland.ac.nz/~paul/<http://www.stat.auckland.ac.nz/%7Epaul/>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ggrothendieck at gmail.com  Fri Dec  4 15:19:39 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 4 Dec 2009 09:19:39 -0500
Subject: [Rd] raster support in graphics devices
In-Reply-To: <de4e29f50912040606r365a932by697fd500460773aa@mail.gmail.com>
References: <4B146EC6.2000502@auckland.ac.nz>
	<971536df0912040528w4226179el7f833c736941406d@mail.gmail.com> 
	<de4e29f50912040606r365a932by697fd500460773aa@mail.gmail.com>
Message-ID: <971536df0912040619r13f7d79bj340e8c2f7718b61f@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091204/ab37398f/attachment.pl>

From ggrothendieck at gmail.com  Fri Dec  4 16:17:18 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 4 Dec 2009 10:17:18 -0500
Subject: [Rd] raster support in graphics devices
In-Reply-To: <971536df0912040528w4226179el7f833c736941406d@mail.gmail.com>
References: <4B146EC6.2000502@auckland.ac.nz>
	<971536df0912040528w4226179el7f833c736941406d@mail.gmail.com>
Message-ID: <971536df0912040717i4ab73a0aga0be2347d7f7d225@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091204/ffb158e4/attachment.pl>

From h.wickham at gmail.com  Fri Dec  4 16:53:48 2009
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 4 Dec 2009 09:53:48 -0600
Subject: [Rd] raster support in graphics devices
In-Reply-To: <971536df0912040717i4ab73a0aga0be2347d7f7d225@mail.gmail.com>
References: <4B146EC6.2000502@auckland.ac.nz>
	<971536df0912040528w4226179el7f833c736941406d@mail.gmail.com> 
	<971536df0912040717i4ab73a0aga0be2347d7f7d225@mail.gmail.com>
Message-ID: <f8e6ff050912040753p35165d28ge8168c02ef728d3c@mail.gmail.com>

> Just to explain a bit more I am thinking about something like this:
>
> con <- graphicsConnection() # I've just made this up
> png(con)
> plot(1:10)
> dev.off()
> raw.img <- readBin(con, "raw", size = 1, n = 100000000)

It seems to me what you actually want is for graphics devices to
support connections:

rc <- rawConnection("raw.img", "w")
png(rc)
plot(1:10)
dev.off()
close(rc)

Hadley

-- 
http://had.co.nz/


From ggrothendieck at gmail.com  Fri Dec  4 16:59:14 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 4 Dec 2009 10:59:14 -0500
Subject: [Rd] raster support in graphics devices
In-Reply-To: <f8e6ff050912040753p35165d28ge8168c02ef728d3c@mail.gmail.com>
References: <4B146EC6.2000502@auckland.ac.nz>
	<971536df0912040528w4226179el7f833c736941406d@mail.gmail.com> 
	<971536df0912040717i4ab73a0aga0be2347d7f7d225@mail.gmail.com> 
	<f8e6ff050912040753p35165d28ge8168c02ef728d3c@mail.gmail.com>
Message-ID: <971536df0912040759x23db08f7k1d4e4f1320417e1e@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091204/0b51b0aa/attachment.pl>

From romain.francois at dbmail.com  Fri Dec  4 17:01:58 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Fri, 04 Dec 2009 17:01:58 +0100
Subject: [Rd] raster support in graphics devices
In-Reply-To: <971536df0912040619r13f7d79bj340e8c2f7718b61f@mail.gmail.com>
References: <4B146EC6.2000502@auckland.ac.nz>	<971536df0912040528w4226179el7f833c736941406d@mail.gmail.com>
	<de4e29f50912040606r365a932by697fd500460773aa@mail.gmail.com>
	<971536df0912040619r13f7d79bj340e8c2f7718b61f@mail.gmail.com>
Message-ID: <4B193276.5010001@dbmail.com>

On 12/04/2009 03:19 PM, Gabor Grothendieck wrote:
>
> Thanks.
>
> I am looking for the data to be just as if I had read in the png file (or
> wmf file or whatever).

Hi,

You are after the binary payload of the rendered graph as a png file. So 
you are going to have to go through a png file.

It would be nice to be able to render to a binary connection, like a 
rawConnection, but it seems like an expensive "nice to have"

> grid.cap seems to give a bitmap and then would
> require some sort of processing to get the png or wmf, etc. form.  Also note
> that I need it for classic graphics and not just grid graphics.

grid.cap does not seem to care, baptiste code uses traditional graphics

> What I have right now works just as I want it _except_ I have to create a
> file and then read it back in which seems a waste.

Can you measure the time it takes to do dev.off() and readBin ?

> On Fri, Dec 4, 2009 at 9:06 AM, baptiste auguie<
> baptiste.auguie at googlemail.com>  wrote:
>
>> Hi,
>>
>> You can use grid.cap,
>>
>> x11()
>> plot(1:10)
>> g = grid.cap()
>> dev.off()
>> str(g)
>> # chr [1:672, 1:671] "white" "white" "white" "white" "white" ...
>>
>> but as far as I understand in ?grid.cap and the underlying code there
>> is no "capGrob" equivalent that wouldn't require opening a new device
>> before capturing the output.
>>
>>   I hope I'm mistaken.
>>
>> Best,
>>
>> baptiste
>>
>> 2009/12/4 Gabor Grothendieck<ggrothendieck at gmail.com>:
>>> Currently I have an application that saves the current graphics image
>> (that
>>> was created with classic graphics or grid graphics) to a file and then
>> reads
>>> the file back in using readBin:
>>>
>>> png("my.png")
>>> plot(1:10)
>>> dev.off()
>>> raw.img<- readBin("my.png", "raw", size = 1, n = 100000000)
>>>
>>> (I am doing this on Windows but would like to be able to do it on any
>>> platform.)
>>>
>>> Does the new raster functionality give me any way to get the object
>> raw.img
>>> without creating the intermediate file, my.png?  If so what is the
>>> corresponding code?
>>>
>>>
>>> On Mon, Nov 30, 2009 at 8:17 PM, Paul Murrell<p.murrell at auckland.ac.nz
>>> wrote:
>>>
>>>> Hi
>>>>
>>>> This is for developers of extension packages that provide extra
>> *graphics
>>>> devices* for R.
>>>>
>>>> In the *development* version of R, support has been added to the
>> graphics
>>>> engine for sending raster images (bitmaps) to a graphics device.  This
>>>> consists mainly of two new device functions:  dev_Raster() and
>> dev_Cap().
>>>>
>>>> The R_GE_version constant (in GraphicsEngine.h) has been bumped up to 6
>> as
>>>> a marker of this change.
>>>>
>>>> This means that, at a minimum, all graphics devices should be updated to
>>>> provide dummy implementations of these new functions that just say the
>>>> feature is not yet implemented (see for example the PicTeX and XFig
>> devices
>>>> in the 'grDevices' package).
>>>>
>>>> A full implementation of dev_Raster() should be able to draw a raster
>> image
>>>> (provided as an array of 32-bit R colors) at any size, possibly
>> (bilinear)
>>>> interpolated (otherwise nearest-neighbour), at any orientation, and with
>> a
>>>> per-pixel alpha channel.  Where these are not natively supported by a
>>>> device, the graphics engine provides some routines for scaling and
>> rotating
>>>> raster images (see for example the X11 device).  The dev_Cap() function
>>>> should return a representation of a raster image captured from the
>> current
>>>> device.  This will only make sense for some devices (see for example the
>>>> Cairo device in the 'grDevices' package).
>>>>
>>>> A little more information and a couple of small examples are provided at
>>>> http://developer.r-project.org/Raster/raster-RFC.html
>>>>
>>>> Paul
>>>> --
>>>> Dr Paul Murrell
>>>> Department of Statistics
>>>> The University of Auckland
>>>> Private Bag 92019
>>>> Auckland
>>>> New Zealand
>>>> 64 9 3737599 x85392
>>>> paul at stat.auckland.ac.nz
>>>> http://www.stat.auckland.ac.nz/~paul/<http://www.stat.auckland.ac.nz/%7Epaul/>
>> <http://www.stat.auckland.ac.nz/%7Epaul/>

-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/Gq7i : ohloh
|- http://tr.im/FtUu : new package : highlight
`- http://tr.im/EAD5 : LondonR slides


From ggrothendieck at gmail.com  Fri Dec  4 17:06:34 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 4 Dec 2009 11:06:34 -0500
Subject: [Rd] raster support in graphics devices
In-Reply-To: <4B193276.5010001@dbmail.com>
References: <4B146EC6.2000502@auckland.ac.nz>
	<971536df0912040528w4226179el7f833c736941406d@mail.gmail.com> 
	<de4e29f50912040606r365a932by697fd500460773aa@mail.gmail.com> 
	<971536df0912040619r13f7d79bj340e8c2f7718b61f@mail.gmail.com> 
	<4B193276.5010001@dbmail.com>
Message-ID: <971536df0912040806v57bf8c5p3cb36e634208a9dc@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091204/7eac5df7/attachment.pl>

From h.wickham at gmail.com  Fri Dec  4 17:19:12 2009
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 4 Dec 2009 10:19:12 -0600
Subject: [Rd] raster support in graphics devices
In-Reply-To: <971536df0912040806v57bf8c5p3cb36e634208a9dc@mail.gmail.com>
References: <4B146EC6.2000502@auckland.ac.nz>
	<971536df0912040528w4226179el7f833c736941406d@mail.gmail.com> 
	<de4e29f50912040606r365a932by697fd500460773aa@mail.gmail.com> 
	<971536df0912040619r13f7d79bj340e8c2f7718b61f@mail.gmail.com> 
	<4B193276.5010001@dbmail.com>
	<971536df0912040806v57bf8c5p3cb36e634208a9dc@mail.gmail.com>
Message-ID: <f8e6ff050912040819x1b847172kfbc0fde7492b7c4e@mail.gmail.com>

> Its not just the time. ?Its also the nuisance of having to manage files that
> I never needed in the first place.

In general, it's much easier to create output from a R object than
create an R object from output.

It's good programming practice to minimise the number of functions
with side-effects - if all input and output went through connections,
many parts of R would be much easier to program against.

Hadley

-- 
http://had.co.nz/


From ligges at statistik.tu-dortmund.de  Fri Dec  4 18:31:21 2009
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Fri, 04 Dec 2009 18:31:21 +0100
Subject: [Rd] boxplot: auto sizing for ylim variable
In-Reply-To: <bb3f839b0912031040p7e011dacm73682fa24774c5e9@mail.gmail.com>
References: <bb3f839b0912011134o50c0cff6lae004116ea32cd08@mail.gmail.com>	<B37C0A15B8FB3C468B5BC7EBC7DA14CC62F710A1C0@LP-EXMBVS10.CO.IHC.COM>
	<bb3f839b0912031040p7e011dacm73682fa24774c5e9@mail.gmail.com>
Message-ID: <4B194769.2090002@statistik.tu-dortmund.de>



violet lock wrote:
> Sorry, I though I had reposted the question-  I was trying to create a
> barplot- I just solved it by looping and setting the program to graph as
> subset of the data.  The size is a parameter so the user can reset it if
> needed
> 
> bargraph <- function(table) {
> barplot(table,  main="Title", xlim=c(0,120), horiz=TRUE, las=2)
> }
> ...calc of j and end...
> smaller_table=bigtable[j:end]
> bargraph(smaller_table)


Still not reproducible, hence not helpful - we cannot see anything...

Uwe Ligges


> 
> 
> 
> 
> On Wed, Dec 2, 2009 at 3:02 PM, Greg Snow <Greg.Snow at imail.org> wrote:
> 
>> I don't understand your question.  Are you trying to create a boxplot or
>> barplot (you mention both), what scaling is not happening automatically that
>> you would like?
>>
>> Can you give a simple example of what you have tried, what results you are
>> seeing and what results you would like to see instead?
>>
>> --
>> Gregory (Greg) L. Snow Ph.D.
>> Statistical Data Center
>> Intermountain Healthcare
>> greg.snow at imail.org
>> 801.408.8111
>>
>>
>>> -----Original Message-----
>>> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
>>> project.org] On Behalf Of violet lock
>>> Sent: Tuesday, December 01, 2009 12:34 PM
>>> To: r-devel at r-project.org
>>> Subject: [Rd] boxplot: auto sizing for ylim variable
>>>
>>> Dear R-Devel,
>>> I am trying to create a boxplot for a large dataset (about 1500
>>> entries)
>>>  and was wondering if there was away to do auto sizing for the y-axis
>>> of a
>>> horizontal bar plot?  I know I could use a control structure to loop
>>> through
>>> the data instead, but as I know SAS has something does this
>>> automatically I
>>> thought R might as well.
>>>
>>> Thanks,
>>> VL
>>>
>>>       [[alternative HTML version deleted]]
>>  >
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From lawremi at gmail.com  Fri Dec  4 20:12:42 2009
From: lawremi at gmail.com (Michael Lawrence)
Date: Fri, 4 Dec 2009 11:12:42 -0800
Subject: [Rd] combine UserDefinedDatabase and regular environments
In-Reply-To: <4B17649D.6050507@dbmail.com>
References: <4AF31246.1060004@dbmail.com>
	<509e0620911190914g3cd6838eyd91b049680d737e7@mail.gmail.com>
	<4B059464.2020003@dbmail.com>
	<509e0620912021517i1b972dbnba89fbd9a15165e7@mail.gmail.com>
	<4B17649D.6050507@dbmail.com>
Message-ID: <509e0620912041112m493707a6n520ae3f41989e02f@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091204/da65a2b8/attachment.pl>

From maiagx at gmail.com  Sat Dec  5 04:03:53 2009
From: maiagx at gmail.com (Charlotte Maia)
Date: Sat, 5 Dec 2009 15:03:53 +1200
Subject: [Rd] Task View for Marketing
Message-ID: <b7bfe54e0912041903u773b26d6yf455949294fba3e@mail.gmail.com>

Hi

I was wondering if a task view for marketing would be a good idea????

I realise that it would have some overlap with other task views.
Social science, cluster and multivariate are the most obvious ones.

There seem to be a lot of packages (quite in your face, if I may say
so) for finance and econometrics (however this is a good thing,
mostly...). However, marketing focused packages seem to be more
obscure.

I don't know how it works overseas, however in my country, of all the
mainstream business disciplines, marketing seems to use the most
statistics. Plus most of the employment opportunities I see for
statisticians in the commercial sector, are in market research, where
database marketing and market segmentation seem to be the hot topics.

I can see how R might be less attractive to marketing graduates than
graduates of finance and economics. However at the same time, I know a
lot of people who have graduated in statistics, who are interested in
marketing...


regards
-- 
Charlotte Maia
http://sites.google.com/site/maiagx/home


From Achim.Zeileis at wu-wien.ac.at  Sat Dec  5 04:20:36 2009
From: Achim.Zeileis at wu-wien.ac.at (Achim Zeileis)
Date: Sat, 5 Dec 2009 04:20:36 +0100 (CET)
Subject: [Rd] Task View for Marketing
In-Reply-To: <b7bfe54e0912041903u773b26d6yf455949294fba3e@mail.gmail.com>
References: <b7bfe54e0912041903u773b26d6yf455949294fba3e@mail.gmail.com>
Message-ID: <alpine.DEB.2.00.0912050416090.13249@paninaro.stat-math.wu-wien.ac.at>

Charlotte:

> I was wondering if a task view for marketing would be a good idea????

Maybe, do you want to volunteer to maintain it?

> I realise that it would have some overlap with other task views.
> Social science, cluster and multivariate are the most obvious ones.

Yes. I'm not sure how a new "Marketing" view would fit in the mix but 
maybe you have some more precise ideas.

If you would be willing to write such a view and maintain it in the 
future, then I suggest that you put together a list of packages and some 
rough ideas for text and how the marketing view would add to the views 
named above. Send me the ideas (off-list) and then we can decide whether 
to go on or not.

Thanks for the suggestion.
Best,
Z

> There seem to be a lot of packages (quite in your face, if I may say
> so) for finance and econometrics (however this is a good thing,
> mostly...). However, marketing focused packages seem to be more
> obscure.
>
> I don't know how it works overseas, however in my country, of all the
> mainstream business disciplines, marketing seems to use the most
> statistics. Plus most of the employment opportunities I see for
> statisticians in the commercial sector, are in market research, where
> database marketing and market segmentation seem to be the hot topics.
>
> I can see how R might be less attractive to marketing graduates than
> graduates of finance and economics. However at the same time, I know a
> lot of people who have graduated in statistics, who are interested in
> marketing...
>
>
> regards
> -- 
> Charlotte Maia
> http://sites.google.com/site/maiagx/home
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From chris.jackson at mrc-bsu.cam.ac.uk  Fri Dec  4 16:45:09 2009
From: chris.jackson at mrc-bsu.cam.ac.uk (chris.jackson at mrc-bsu.cam.ac.uk)
Date: Fri,  4 Dec 2009 16:45:09 +0100 (CET)
Subject: [Rd] Typo in help(Special) (PR#14111)
Message-ID: <20091204154510.0FB5D282EF29@mail.pubhealth.ku.dk>

There's a typo in the definition of the Gamma function in help(Special)
i.e. the file

src/library/base/man/Special.Rd

Looks like "a" should be replaced by "x" in the equation on line 63:

\deqn{\Gamma(x) = \int_0^\infty t^{a-1} e^{-t} dt}{integral_0^Inf 
t^(a-1) exp(-t) dt}

I checked this is still in current r-patched and r-devel.

Chris



--please do not edit the information below--

Version:
  platform = sparc-sun-solaris2.10
  arch = sparc
  os = solaris2.10
  system = sparc, solaris2.10
  status =
  major = 2
  minor = 10.0
  year = 2009
  month = 10
  day = 26
  svn rev = 50208
  language = R
  version.string = R version 2.10.0 (2009-10-26)

Locale:
/en_GB.ISO8859-1/C/en_GB.ISO8859-1/en_GB.ISO8859-1/C/C

Search Path:
  .GlobalEnv, package:stats, package:graphics, package:grDevices, 
package:datasets, package:utils, package:methods, Autoloads, package:base

-- 
Christopher Jackson <chris.jackson at mrc-bsu.cam.ac.uk>
Research Statistician, MRC Biostatistics Unit, Institute of Public
Health, Robinson Way, Cambridge, UK, CB2 0SR. +44 (1223) 330381


From sfalcon at fhcrc.org  Fri Dec  4 20:43:14 2009
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Fri, 04 Dec 2009 11:43:14 -0800
Subject: [Rd] Error in namespaceExport(ns, exports) :
In-Reply-To: <1a3e78310912031510x41065f04t55c33697459e69b5@mail.gmail.com>
References: <1a3e78310912031510x41065f04t55c33697459e69b5@mail.gmail.com>
Message-ID: <4B196652.9040808@fhcrc.org>

On 12/3/09 3:10 PM, David Scherrer wrote:
> Dear all,
>
> I get the error
>
> "Error in namespaceExport(ns, exports) :
>    undefined exports function1 , function2"
>
> when compiling or even when I roxygen my package. The two function I once
> had in my package but I deleted them including their .Rd files. I also can't
> find them in any other function or help file.
>
> So does anybody know where these functions are still listed that causes this
> error?
>

Are you sure they are not in your NAMESPACE file?

-- 
Seth Falcon
Program in Computational Biology | Fred Hutchinson Cancer Research Center


From dgrove at fhcrc.org  Fri Dec  4 23:40:12 2009
From: dgrove at fhcrc.org (dgrove at fhcrc.org)
Date: Fri,  4 Dec 2009 23:40:12 +0100 (CET)
Subject: [Rd] error in help.search (PR#14113)
Message-ID: <20091204224012.64047282EFC3@mail.pubhealth.ku.dk>

Full_Name: Doug Grove
Version: 2.10.0   10-26-2009
OS: x86_64-unknown-linux-gnu
Submission from: (NULL) (140.107.164.65)


Hi,

Looks like the revisions to help.search didn't get completely finished.

When the user specifies the argument 'package' the code doesn't define the
variable 'paths' prior to trying to use it, which obviously produces an error.

The code dies when it reaches the line: 
   tot <- length(paths)

Just search on any string and specify and package and you'll get the error.

Thanks,
Doug


From feinerer at logic.at  Sat Dec  5 10:43:39 2009
From: feinerer at logic.at (Ingo Feinerer)
Date: Sat, 5 Dec 2009 10:43:39 +0100
Subject: [Rd] tm and e1071 question
In-Reply-To: <alpine.DEB.2.00.0912041421260.28183@paninaro.stat-math.wu-wien.ac.at>
References: <alpine.DEB.2.00.0912041421260.28183@paninaro.stat-math.wu-wien.ac.at>
Message-ID: <20091205094339.GA25171@gamma.logic.tuwien.ac.at>

On Fri, Dec 04, 2009 at 02:21:52PM +0100, Achim Zeileis wrote:
> I would like to use the svm function of the e1071 package for text
> classification tasks. Preprocessing can be carried out by using the
> excellent tm text mining package.

:-)

> TermDocumentMatrix and DocumentTermMatrix objects of the package tm
> are currently implemented based on the sparse matrix data structures
> provided by the slam package.
>
> Unfortunately, the svm function of the e1071 package accepts only sparse
> matrices of class Matrix provided by the Matrix package, or of class
> matrix.csr as provided by the package SparseM.
>
> In order to train an SVM with a DocumentTermMatrix object the latter
> must be converted to a matrix.csr sparse matrix structure. However, none
> of the publicly available packages of CRAN provides such a conversion
> function. It is quite straightforward to write the conversion function,
> but it would be much confortable to pass slam sparse matrix objects
> directly to the svm function.

You are right. If you have small matrices as(as.matrix(m), "Matrix")
will work. Then there exists some (non published experimental) code in
the slam package for conversion to Matrix format (located in
slam/work/Matrix.R):

setAs("simple_triplet_matrix", "dgTMatrix",
      function(from) {
          new("dgTMatrix",
              i = as.integer(from$i - 1L),
              j = as.integer(from$j - 1L),
              x = from$v,
              Dim = c(from$nrow, from$ncol),
              Dimnames = from$dimnames)
      })

setAs("simple_triplet_matrix", "dgCMatrix",
      function(from) {
          ind <- order(from$j, from$i)
          new("dgCMatrix",
              i = from$i[ind] - 1L,
              p = c(0L, cumsum(tabulate(from$j[ind], from$ncol))),
              x = from$v[ind],
              Dim = c(from$nrow, from$ncol),
              Dimnames = from$dimnames)
      })

which allows then:

class(m) <- "simple_triplet_matrix"
as(m, "dgTMatrix")
as(m, "dgCMatrix")

> Do you plan to add slam sparse matrix support to the e1071 package?

I cannot answer this since I am neither directly involved in the e1071
nor in the slam package.

Best regards, Ingo Feinerer

-- 
Ingo Feinerer
Vienna University of Technology
http://www.dbai.tuwien.ac.at/staff/feinerer


From murdoch at stats.uwo.ca  Sat Dec  5 17:24:25 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 05 Dec 2009 11:24:25 -0500
Subject: [Rd] error in help.search (PR#14113)
In-Reply-To: <20091204224012.64047282EFC3@mail.pubhealth.ku.dk>
References: <20091204224012.64047282EFC3@mail.pubhealth.ku.dk>
Message-ID: <4B1A8939.6020408@stats.uwo.ca>

On 04/12/2009 5:40 PM, dgrove at fhcrc.org wrote:
> Full_Name: Doug Grove
> Version: 2.10.0   10-26-2009
> OS: x86_64-unknown-linux-gnu
> Submission from: (NULL) (140.107.164.65)
> 
> 
> Hi,
> 
> Looks like the revisions to help.search didn't get completely finished.
> 
> When the user specifies the argument 'package' the code doesn't define the
> variable 'paths' prior to trying to use it, which obviously produces an error.

That was a typo:  it should have been looking at package_paths, not paths.

> 
> The code dies when it reaches the line: 
>    tot <- length(paths)
> 
> Just search on any string and specify and package and you'll get the error.

Will fix.

Duncan Murdoch


From tobias.verbeke at gmail.com  Sat Dec  5 19:06:06 2009
From: tobias.verbeke at gmail.com (Tobias Verbeke)
Date: Sat, 05 Dec 2009 19:06:06 +0100
Subject: [Rd] raster support in graphics devices
In-Reply-To: <971536df0912040806v57bf8c5p3cb36e634208a9dc@mail.gmail.com>
References: <4B146EC6.2000502@auckland.ac.nz>	<971536df0912040528w4226179el7f833c736941406d@mail.gmail.com>
	<de4e29f50912040606r365a932by697fd500460773aa@mail.gmail.com>
	<971536df0912040619r13f7d79bj340e8c2f7718b61f@mail.gmail.com>
	<4B193276.5010001@dbmail.com>
	<971536df0912040806v57bf8c5p3cb36e634208a9dc@mail.gmail.com>
Message-ID: <4B1AA10E.3090004@gmail.com>

Hi,

Gabor Grothendieck wrote:

> Its not just the time.  Its also the nuisance of having to manage files that
> I never needed in the first place.

I agree with Gabor that it is more than a 'nice to have'.

There are situations (when integrating R with other
applications) you don't want to touch a disk and
manage files afterwards (e.g. when one wants to pass
a byte string).

A recent question on the topic can be found here:

http://tolstoy.newcastle.edu.au/R/e8/help/09/11/5902.html

Best,
Tobias

> On Fri, Dec 4, 2009 at 11:01 AM, Romain Francois <romain.francois at dbmail.com
>> wrote:
> 
>> On 12/04/2009 03:19 PM, Gabor Grothendieck wrote:
>>
>>> Thanks.
>>>
>>> I am looking for the data to be just as if I had read in the png file (or
>>> wmf file or whatever).
>>>
>> Hi,
>>
>> You are after the binary payload of the rendered graph as a png file. So
>> you are going to have to go through a png file.
>>
>> It would be nice to be able to render to a binary connection, like a
>> rawConnection, but it seems like an expensive "nice to have"
>>
>>
>>  grid.cap seems to give a bitmap and then would
>>> require some sort of processing to get the png or wmf, etc. form.  Also
>>> note
>>> that I need it for classic graphics and not just grid graphics.
>>>
>> grid.cap does not seem to care, baptiste code uses traditional graphics
>>
>>
>>  What I have right now works just as I want it _except_ I have to create a
>>> file and then read it back in which seems a waste.
>>>
>> Can you measure the time it takes to do dev.off() and readBin ?
>>
>>
>>  On Fri, Dec 4, 2009 at 9:06 AM, baptiste auguie<
>>> baptiste.auguie at googlemail.com>  wrote:
>>>
>>>  Hi,
>>>> You can use grid.cap,
>>>>
>>>> x11()
>>>> plot(1:10)
>>>> g = grid.cap()
>>>> dev.off()
>>>> str(g)
>>>> # chr [1:672, 1:671] "white" "white" "white" "white" "white" ...
>>>>
>>>> but as far as I understand in ?grid.cap and the underlying code there
>>>> is no "capGrob" equivalent that wouldn't require opening a new device
>>>> before capturing the output.
>>>>
>>>>  I hope I'm mistaken.
>>>>
>>>> Best,
>>>>
>>>> baptiste
>>>>
>>>> 2009/12/4 Gabor Grothendieck<ggrothendieck at gmail.com>:
>>>>
>>>>> Currently I have an application that saves the current graphics image
>>>>>
>>>> (that
>>>>
>>>>> was created with classic graphics or grid graphics) to a file and then
>>>>>
>>>> reads
>>>>
>>>>> the file back in using readBin:
>>>>>
>>>>> png("my.png")
>>>>> plot(1:10)
>>>>> dev.off()
>>>>> raw.img<- readBin("my.png", "raw", size = 1, n = 100000000)
>>>>>
>>>>> (I am doing this on Windows but would like to be able to do it on any
>>>>> platform.)
>>>>>
>>>>> Does the new raster functionality give me any way to get the object
>>>>>
>>>> raw.img
>>>>
>>>>> without creating the intermediate file, my.png?  If so what is the
>>>>> corresponding code?
>>>>>
>>>>>
>>>>> On Mon, Nov 30, 2009 at 8:17 PM, Paul Murrell<p.murrell at auckland.ac.nz
>>>>> wrote:
>>>>>
>>>>>  Hi
>>>>>> This is for developers of extension packages that provide extra
>>>>>>
>>>>> *graphics
>>>>> devices* for R.
>>>>>> In the *development* version of R, support has been added to the
>>>>>>
>>>>> graphics
>>>>> engine for sending raster images (bitmaps) to a graphics device.  This
>>>>>> consists mainly of two new device functions:  dev_Raster() and
>>>>>>
>>>>> dev_Cap().
>>>>>> The R_GE_version constant (in GraphicsEngine.h) has been bumped up to 6
>>>>>>
>>>>> as
>>>>> a marker of this change.
>>>>>> This means that, at a minimum, all graphics devices should be updated
>>>>>> to
>>>>>> provide dummy implementations of these new functions that just say the
>>>>>> feature is not yet implemented (see for example the PicTeX and XFig
>>>>>>
>>>>> devices
>>>>> in the 'grDevices' package).
>>>>>> A full implementation of dev_Raster() should be able to draw a raster
>>>>>>
>>>>> image
>>>>> (provided as an array of 32-bit R colors) at any size, possibly
>>>>> (bilinear)
>>>>> interpolated (otherwise nearest-neighbour), at any orientation, and with
>>>>> a
>>>>> per-pixel alpha channel.  Where these are not natively supported by a
>>>>>> device, the graphics engine provides some routines for scaling and
>>>>>>
>>>>> rotating
>>>>> raster images (see for example the X11 device).  The dev_Cap() function
>>>>>> should return a representation of a raster image captured from the
>>>>>>
>>>>> current
>>>>> device.  This will only make sense for some devices (see for example the
>>>>>> Cairo device in the 'grDevices' package).
>>>>>>
>>>>>> A little more information and a couple of small examples are provided
>>>>>> at
>>>>>> http://developer.r-project.org/Raster/raster-RFC.html
>>>>>>
>>>>>> Paul
>>>>>> --
>>>>>> Dr Paul Murrell
>>>>>> Department of Statistics
>>>>>> The University of Auckland
>>>>>> Private Bag 92019
>>>>>> Auckland
>>>>>> New Zealand
>>>>>> 64 9 3737599 x85392
>>>>>> paul at stat.auckland.ac.nz
>>>>>> http://www.stat.auckland.ac.nz/~paul/<http://www.stat.auckland.ac.nz/%7Epaul/>
>>>>>> <http://www.stat.auckland.ac.nz/%7Epaul/>
>>>>>>
>>>>> <http://www.stat.auckland.ac.nz/%7Epaul/>
>> --
>> Romain Francois
>> Professional R Enthusiast
>> +33(0) 6 28 91 30 30
>> http://romainfrancois.blog.free.fr
>> |- http://tr.im/Gq7i : ohloh
>> |- http://tr.im/FtUu : new package : highlight
>> `- http://tr.im/EAD5 : LondonR slides
>>
>>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From baptiste.auguie at googlemail.com  Sat Dec  5 21:05:31 2009
From: baptiste.auguie at googlemail.com (baptiste auguie)
Date: Sat, 5 Dec 2009 21:05:31 +0100
Subject: [Rd] raster support in graphics devices
In-Reply-To: <4B146EC6.2000502@auckland.ac.nz>
References: <4B146EC6.2000502@auckland.ac.nz>
Message-ID: <de4e29f50912051205u53dc2269w35a99d65a57b4d74@mail.gmail.com>

Dear all,

It seems to me that grid.raster is a special case of grid.rect as far
as the intended visual output is concerned. The example below
illustrates how both can be used to produce an image of the volcano
data,

d <- volcano

cols <- grey(t(d)/max(c(d)))
xy <- expand.grid(x=seq(0, 1, length=ncol(d)), y=seq(0, 1, length=nrow(d)))

pdf("comparison.pdf", width=10, height=10/2*ncol(d)/nrow(d))
pushViewport(viewport(layout=grid.layout(1, 2)))

pushViewport(viewport(layout.pos.r=1, layout.pos.c=1))
grid.rect(xy$y, rev(xy$x), 1/(nrow(d)), 1/(ncol(d)),  gp=gpar(col=NA,
fill=cols))
grid.text("grid.rect")
upViewport()

pushViewport(viewport(layout.pos.r=1, layout.pos.c=2))
cols.mat <- matrix(cols, ncol=ncol(d), byrow=T)
grid.raster(t(cols.mat))
grid.text("grid.raster")
dev.off()

Of course grid.raster provides a much better output in terms of file
size, speed, visualisation artifacts, and interpolation. My question
though: is it necessary to have a distinct grob for raster output?
Couldn't "raster" be an option in grid.rect when the width and height
are constant?

Alternatively, it might be useful to provide a function that converts
a rectGrob into a rasterGrob,

rect2raster <- function(g){

  with(g,
       rasterGrob(matrix(gp$fill, ncol=length(unique(x))), mean(x),mean(y)))
}

This way, much of the existing code relying on grid.rect (e.g in
lattice or ggplot2) could easily be adapted to work with grid.raster
in favorable cases.

Best regards,

baptiste



2009/12/1 Paul Murrell <p.murrell at auckland.ac.nz>:
> Hi
>
> This is for developers of extension packages that provide extra *graphics
> devices* for R.
>
> In the *development* version of R, support has been added to the graphics
> engine for sending raster images (bitmaps) to a graphics device. ?This
> consists mainly of two new device functions: ?dev_Raster() and dev_Cap().
>
> The R_GE_version constant (in GraphicsEngine.h) has been bumped up to 6 as a
> marker of this change.
>
> This means that, at a minimum, all graphics devices should be updated to
> provide dummy implementations of these new functions that just say the
> feature is not yet implemented (see for example the PicTeX and XFig devices
> in the 'grDevices' package).
>
> A full implementation of dev_Raster() should be able to draw a raster image
> (provided as an array of 32-bit R colors) at any size, possibly (bilinear)
> interpolated (otherwise nearest-neighbour), at any orientation, and with a
> per-pixel alpha channel. ?Where these are not natively supported by a
> device, the graphics engine provides some routines for scaling and rotating
> raster images (see for example the X11 device). ?The dev_Cap() function
> should return a representation of a raster image captured from the current
> device. ?This will only make sense for some devices (see for example the
> Cairo device in the 'grDevices' package).
>
> A little more information and a couple of small examples are provided at
> http://developer.r-project.org/Raster/raster-RFC.html
>
> Paul
> --
> Dr Paul Murrell
> Department of Statistics
> The University of Auckland
> Private Bag 92019
> Auckland
> New Zealand
> 64 9 3737599 x85392
> paul at stat.auckland.ac.nz
> http://www.stat.auckland.ac.nz/~paul/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From romain.francois at dbmail.com  Sat Dec  5 22:11:21 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Sat, 05 Dec 2009 22:11:21 +0100
Subject: [Rd] raster support in graphics devices
In-Reply-To: <4B1AA10E.3090004@gmail.com>
References: <4B146EC6.2000502@auckland.ac.nz>	<971536df0912040528w4226179el7f833c736941406d@mail.gmail.com>
	<de4e29f50912040606r365a932by697fd500460773aa@mail.gmail.com>
	<971536df0912040619r13f7d79bj340e8c2f7718b61f@mail.gmail.com>
	<4B193276.5010001@dbmail.com>
	<971536df0912040806v57bf8c5p3cb36e634208a9dc@mail.gmail.com>
	<4B1AA10E.3090004@gmail.com>
Message-ID: <4B1ACC79.90805@dbmail.com>

I agree too, I was just trying to put on the balance the amount of work 
that would require graphics supporting connections.

Who's willing to do it ?

On 12/05/2009 07:06 PM, Tobias Verbeke wrote:
>
> Hi,
>
> Gabor Grothendieck wrote:
>
>> Its not just the time. Its also the nuisance of having to manage files
>> that
>> I never needed in the first place.
>
> I agree with Gabor that it is more than a 'nice to have'.
>
> There are situations (when integrating R with other
> applications) you don't want to touch a disk and
> manage files afterwards (e.g. when one wants to pass
> a byte string).
>
> A recent question on the topic can be found here:
>
> http://tolstoy.newcastle.edu.au/R/e8/help/09/11/5902.html
>
> Best,
> Tobias
>
>> On Fri, Dec 4, 2009 at 11:01 AM, Romain Francois
>> <romain.francois at dbmail.com
>>> wrote:
>>
>>> On 12/04/2009 03:19 PM, Gabor Grothendieck wrote:
>>>
>>>> Thanks.
>>>>
>>>> I am looking for the data to be just as if I had read in the png
>>>> file (or
>>>> wmf file or whatever).
>>>>
>>> Hi,
>>>
>>> You are after the binary payload of the rendered graph as a png file. So
>>> you are going to have to go through a png file.
>>>
>>> It would be nice to be able to render to a binary connection, like a
>>> rawConnection, but it seems like an expensive "nice to have"
>>>
>>>
>>> grid.cap seems to give a bitmap and then would
>>>> require some sort of processing to get the png or wmf, etc. form. Also
>>>> note
>>>> that I need it for classic graphics and not just grid graphics.
>>>>
>>> grid.cap does not seem to care, baptiste code uses traditional graphics
>>>
>>>
>>> What I have right now works just as I want it _except_ I have to
>>> create a
>>>> file and then read it back in which seems a waste.
>>>>
>>> Can you measure the time it takes to do dev.off() and readBin ?
>>>
>>>
>>> On Fri, Dec 4, 2009 at 9:06 AM, baptiste auguie<
>>>> baptiste.auguie at googlemail.com> wrote:
>>>>
>>>> Hi,
>>>>> You can use grid.cap,
>>>>>
>>>>> x11()
>>>>> plot(1:10)
>>>>> g = grid.cap()
>>>>> dev.off()
>>>>> str(g)
>>>>> # chr [1:672, 1:671] "white" "white" "white" "white" "white" ...
>>>>>
>>>>> but as far as I understand in ?grid.cap and the underlying code there
>>>>> is no "capGrob" equivalent that wouldn't require opening a new device
>>>>> before capturing the output.
>>>>>
>>>>> I hope I'm mistaken.
>>>>>
>>>>> Best,
>>>>>
>>>>> baptiste
>>>>>
>>>>> 2009/12/4 Gabor Grothendieck<ggrothendieck at gmail.com>:
>>>>>
>>>>>> Currently I have an application that saves the current graphics image
>>>>>>
>>>>> (that
>>>>>
>>>>>> was created with classic graphics or grid graphics) to a file and
>>>>>> then
>>>>>>
>>>>> reads
>>>>>
>>>>>> the file back in using readBin:
>>>>>>
>>>>>> png("my.png")
>>>>>> plot(1:10)
>>>>>> dev.off()
>>>>>> raw.img<- readBin("my.png", "raw", size = 1, n = 100000000)
>>>>>>
>>>>>> (I am doing this on Windows but would like to be able to do it on any
>>>>>> platform.)
>>>>>>
>>>>>> Does the new raster functionality give me any way to get the object
>>>>>>
>>>>> raw.img
>>>>>
>>>>>> without creating the intermediate file, my.png? If so what is the
>>>>>> corresponding code?
>>>>>>
>>>>>>
>>>>>> On Mon, Nov 30, 2009 at 8:17 PM, Paul
>>>>>> Murrell<p.murrell at auckland.ac.nz
>>>>>> wrote:
>>>>>>
>>>>>> Hi
>>>>>>> This is for developers of extension packages that provide extra
>>>>>>>
>>>>>> *graphics
>>>>>> devices* for R.
>>>>>>> In the *development* version of R, support has been added to the
>>>>>>>
>>>>>> graphics
>>>>>> engine for sending raster images (bitmaps) to a graphics device. This
>>>>>>> consists mainly of two new device functions: dev_Raster() and
>>>>>>>
>>>>>> dev_Cap().
>>>>>>> The R_GE_version constant (in GraphicsEngine.h) has been bumped
>>>>>>> up to 6
>>>>>>>
>>>>>> as
>>>>>> a marker of this change.
>>>>>>> This means that, at a minimum, all graphics devices should be
>>>>>>> updated
>>>>>>> to
>>>>>>> provide dummy implementations of these new functions that just
>>>>>>> say the
>>>>>>> feature is not yet implemented (see for example the PicTeX and XFig
>>>>>>>
>>>>>> devices
>>>>>> in the 'grDevices' package).
>>>>>>> A full implementation of dev_Raster() should be able to draw a
>>>>>>> raster
>>>>>>>
>>>>>> image
>>>>>> (provided as an array of 32-bit R colors) at any size, possibly
>>>>>> (bilinear)
>>>>>> interpolated (otherwise nearest-neighbour), at any orientation,
>>>>>> and with
>>>>>> a
>>>>>> per-pixel alpha channel. Where these are not natively supported by a
>>>>>>> device, the graphics engine provides some routines for scaling and
>>>>>>>
>>>>>> rotating
>>>>>> raster images (see for example the X11 device). The dev_Cap()
>>>>>> function
>>>>>>> should return a representation of a raster image captured from the
>>>>>>>
>>>>>> current
>>>>>> device. This will only make sense for some devices (see for
>>>>>> example the
>>>>>>> Cairo device in the 'grDevices' package).
>>>>>>>
>>>>>>> A little more information and a couple of small examples are
>>>>>>> provided
>>>>>>> at
>>>>>>> http://developer.r-project.org/Raster/raster-RFC.html
>>>>>>>
>>>>>>> Paul
>>>>>>> --
>>>>>>> Dr Paul Murrell
>>>>>>> Department of Statistics
>>>>>>> The University of Auckland
>>>>>>> Private Bag 92019
>>>>>>> Auckland
>>>>>>> New Zealand
>>>>>>> 64 9 3737599 x85392
>>>>>>> paul at stat.auckland.ac.nz
>>>>>>> http://www.stat.auckland.ac.nz/~paul/<http://www.stat.auckland.ac.nz/%7Epaul/>
>>>>>>>
>>>>>>> <http://www.stat.auckland.ac.nz/%7Epaul/>
>>>>>>>
>>>>>> <http://www.stat.auckland.ac.nz/%7Epaul/>
>>> --


-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/Gq7i : ohloh
|- http://tr.im/FtUu : new package : highlight
`- http://tr.im/EAD5 : LondonR slides


From baron at psych.upenn.edu  Sat Dec  5 22:36:39 2009
From: baron at psych.upenn.edu (Jonathan Baron)
Date: Sat, 5 Dec 2009 16:36:39 -0500
Subject: [Rd] request to make --enable-prebuilt-html the default build on
	linux
Message-ID: <20091205213639.GA31919@psych.upenn.edu>

I don't understand the advantages of generating html help dynamically,
but I have found some clear disadvantages.

One is that I can no longer use a bookmark in my browser to access the
list of packages and go from there to individual help pages.

The other is that, if I try to use ESS instead (using
options(help_type="html") in .Rprofile) - it is a mess.  ESS splits
the emacs frame (which then must be closed by hand) and opens a new
window (or at best a new tab) for every request, requiring these to be
closed too.

You could say that this is a problem with ESS, which is true, but,
again, I don't see the down side of having static html help pages.
(Maybe there is one.  But it certainly isn't disk space: all together
these take about as much of that as a couple of digital photos.)

Jon
-- 
Jonathan Baron, Professor of Psychology, University of Pennsylvania
Home page: http://www.sas.upenn.edu/~baron


From murdoch at stats.uwo.ca  Sat Dec  5 23:58:30 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 05 Dec 2009 17:58:30 -0500
Subject: [Rd] request to make --enable-prebuilt-html the default build
 on	linux
In-Reply-To: <20091205213639.GA31919@psych.upenn.edu>
References: <20091205213639.GA31919@psych.upenn.edu>
Message-ID: <4B1AE596.1030401@stats.uwo.ca>

On 05/12/2009 4:36 PM, Jonathan Baron wrote:
> I don't understand the advantages of generating html help dynamically,
> but I have found some clear disadvantages.
> 
> One is that I can no longer use a bookmark in my browser to access the
> list of packages and go from there to individual help pages.

If you leave a copy of R running to serve them, you can.  Tell it to use 
a particular port (via options(help.ports=12345), for example) and then 
set your bookmark to work with that.
> 
> The other is that, if I try to use ESS instead (using
> options(help_type="html") in .Rprofile) - it is a mess.  ESS splits
> the emacs frame (which then must be closed by hand) and opens a new
> window (or at best a new tab) for every request, requiring these to be
> closed too.
> 
> You could say that this is a problem with ESS, which is true, but,

Obviously that is a problem with ESS.  Why would it care at all where 
the HTML is coming from???

Duncan Murdoch

> again, I don't see the down side of having static html help pages.
> (Maybe there is one.  But it certainly isn't disk space: all together
> these take about as much of that as a couple of digital photos.)
> 
> Jon


From simon.urbanek at r-project.org  Sun Dec  6 01:20:38 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Sat, 5 Dec 2009 19:20:38 -0500
Subject: [Rd] raster support in graphics devices
In-Reply-To: <4B1ACC79.90805@dbmail.com>
References: <4B146EC6.2000502@auckland.ac.nz>	<971536df0912040528w4226179el7f833c736941406d@mail.gmail.com>
	<de4e29f50912040606r365a932by697fd500460773aa@mail.gmail.com>
	<971536df0912040619r13f7d79bj340e8c2f7718b61f@mail.gmail.com>
	<4B193276.5010001@dbmail.com>
	<971536df0912040806v57bf8c5p3cb36e634208a9dc@mail.gmail.com>
	<4B1AA10E.3090004@gmail.com> <4B1ACC79.90805@dbmail.com>
Message-ID: <56EBD53C-DB97-4EF0-BB28-BD57E2BA4BFD@r-project.org>


On Dec 5, 2009, at 4:11 PM, Romain Francois wrote:

> I agree too, I was just trying to put on the balance the amount of work that would require graphics supporting connections.
> 
> Who's willing to do it ?
> 

The issue is not the will nor complexity on the GD side, but connections are not exposed outside of R (or at the C level), so there is currently no way to do it (AFAIR). Jeff Horner has proposed a patch long ago and Cairo works with connections if you patch R, but connections are to date still not part of the API. So I suspect the real issue is to create a connection API so packages (and devices) can use it.

Cheers,
Simon



> On 12/05/2009 07:06 PM, Tobias Verbeke wrote:
>> 
>> Hi,
>> 
>> Gabor Grothendieck wrote:
>> 
>>> Its not just the time. Its also the nuisance of having to manage files
>>> that
>>> I never needed in the first place.
>> 
>> I agree with Gabor that it is more than a 'nice to have'.
>> 
>> There are situations (when integrating R with other
>> applications) you don't want to touch a disk and
>> manage files afterwards (e.g. when one wants to pass
>> a byte string).
>> 
>> A recent question on the topic can be found here:
>> 
>> http://tolstoy.newcastle.edu.au/R/e8/help/09/11/5902.html
>> 
>> Best,
>> Tobias
>> 
>>> On Fri, Dec 4, 2009 at 11:01 AM, Romain Francois
>>> <romain.francois at dbmail.com
>>>> wrote:
>>> 
>>>> On 12/04/2009 03:19 PM, Gabor Grothendieck wrote:
>>>> 
>>>>> Thanks.
>>>>> 
>>>>> I am looking for the data to be just as if I had read in the png
>>>>> file (or
>>>>> wmf file or whatever).
>>>>> 
>>>> Hi,
>>>> 
>>>> You are after the binary payload of the rendered graph as a png file. So
>>>> you are going to have to go through a png file.
>>>> 
>>>> It would be nice to be able to render to a binary connection, like a
>>>> rawConnection, but it seems like an expensive "nice to have"
>>>> 
>>>> 
>>>> grid.cap seems to give a bitmap and then would
>>>>> require some sort of processing to get the png or wmf, etc. form. Also
>>>>> note
>>>>> that I need it for classic graphics and not just grid graphics.
>>>>> 
>>>> grid.cap does not seem to care, baptiste code uses traditional graphics
>>>> 
>>>> 
>>>> What I have right now works just as I want it _except_ I have to
>>>> create a
>>>>> file and then read it back in which seems a waste.
>>>>> 
>>>> Can you measure the time it takes to do dev.off() and readBin ?
>>>> 
>>>> 
>>>> On Fri, Dec 4, 2009 at 9:06 AM, baptiste auguie<
>>>>> baptiste.auguie at googlemail.com> wrote:
>>>>> 
>>>>> Hi,
>>>>>> You can use grid.cap,
>>>>>> 
>>>>>> x11()
>>>>>> plot(1:10)
>>>>>> g = grid.cap()
>>>>>> dev.off()
>>>>>> str(g)
>>>>>> # chr [1:672, 1:671] "white" "white" "white" "white" "white" ...
>>>>>> 
>>>>>> but as far as I understand in ?grid.cap and the underlying code there
>>>>>> is no "capGrob" equivalent that wouldn't require opening a new device
>>>>>> before capturing the output.
>>>>>> 
>>>>>> I hope I'm mistaken.
>>>>>> 
>>>>>> Best,
>>>>>> 
>>>>>> baptiste
>>>>>> 
>>>>>> 2009/12/4 Gabor Grothendieck<ggrothendieck at gmail.com>:
>>>>>> 
>>>>>>> Currently I have an application that saves the current graphics image
>>>>>>> 
>>>>>> (that
>>>>>> 
>>>>>>> was created with classic graphics or grid graphics) to a file and
>>>>>>> then
>>>>>>> 
>>>>>> reads
>>>>>> 
>>>>>>> the file back in using readBin:
>>>>>>> 
>>>>>>> png("my.png")
>>>>>>> plot(1:10)
>>>>>>> dev.off()
>>>>>>> raw.img<- readBin("my.png", "raw", size = 1, n = 100000000)
>>>>>>> 
>>>>>>> (I am doing this on Windows but would like to be able to do it on any
>>>>>>> platform.)
>>>>>>> 
>>>>>>> Does the new raster functionality give me any way to get the object
>>>>>>> 
>>>>>> raw.img
>>>>>> 
>>>>>>> without creating the intermediate file, my.png? If so what is the
>>>>>>> corresponding code?
>>>>>>> 
>>>>>>> 
>>>>>>> On Mon, Nov 30, 2009 at 8:17 PM, Paul
>>>>>>> Murrell<p.murrell at auckland.ac.nz
>>>>>>> wrote:
>>>>>>> 
>>>>>>> Hi
>>>>>>>> This is for developers of extension packages that provide extra
>>>>>>>> 
>>>>>>> *graphics
>>>>>>> devices* for R.
>>>>>>>> In the *development* version of R, support has been added to the
>>>>>>>> 
>>>>>>> graphics
>>>>>>> engine for sending raster images (bitmaps) to a graphics device. This
>>>>>>>> consists mainly of two new device functions: dev_Raster() and
>>>>>>>> 
>>>>>>> dev_Cap().
>>>>>>>> The R_GE_version constant (in GraphicsEngine.h) has been bumped
>>>>>>>> up to 6
>>>>>>>> 
>>>>>>> as
>>>>>>> a marker of this change.
>>>>>>>> This means that, at a minimum, all graphics devices should be
>>>>>>>> updated
>>>>>>>> to
>>>>>>>> provide dummy implementations of these new functions that just
>>>>>>>> say the
>>>>>>>> feature is not yet implemented (see for example the PicTeX and XFig
>>>>>>>> 
>>>>>>> devices
>>>>>>> in the 'grDevices' package).
>>>>>>>> A full implementation of dev_Raster() should be able to draw a
>>>>>>>> raster
>>>>>>>> 
>>>>>>> image
>>>>>>> (provided as an array of 32-bit R colors) at any size, possibly
>>>>>>> (bilinear)
>>>>>>> interpolated (otherwise nearest-neighbour), at any orientation,
>>>>>>> and with
>>>>>>> a
>>>>>>> per-pixel alpha channel. Where these are not natively supported by a
>>>>>>>> device, the graphics engine provides some routines for scaling and
>>>>>>>> 
>>>>>>> rotating
>>>>>>> raster images (see for example the X11 device). The dev_Cap()
>>>>>>> function
>>>>>>>> should return a representation of a raster image captured from the
>>>>>>>> 
>>>>>>> current
>>>>>>> device. This will only make sense for some devices (see for
>>>>>>> example the
>>>>>>>> Cairo device in the 'grDevices' package).
>>>>>>>> 
>>>>>>>> A little more information and a couple of small examples are
>>>>>>>> provided
>>>>>>>> at
>>>>>>>> http://developer.r-project.org/Raster/raster-RFC.html
>>>>>>>> 
>>>>>>>> Paul
>>>>>>>> --
>>>>>>>> Dr Paul Murrell
>>>>>>>> Department of Statistics
>>>>>>>> The University of Auckland
>>>>>>>> Private Bag 92019
>>>>>>>> Auckland
>>>>>>>> New Zealand
>>>>>>>> 64 9 3737599 x85392
>>>>>>>> paul at stat.auckland.ac.nz
>>>>>>>> http://www.stat.auckland.ac.nz/~paul/<http://www.stat.auckland.ac.nz/%7Epaul/>
>>>>>>>> 
>>>>>>>> <http://www.stat.auckland.ac.nz/%7Epaul/>
>>>>>>>> 
>>>>>>> <http://www.stat.auckland.ac.nz/%7Epaul/>
>>>> --
> 
> 
> -- 
> Romain Francois
> Professional R Enthusiast
> +33(0) 6 28 91 30 30
> http://romainfrancois.blog.free.fr
> |- http://tr.im/Gq7i : ohloh
> |- http://tr.im/FtUu : new package : highlight
> `- http://tr.im/EAD5 : LondonR slides
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From maiagx at gmail.com  Sun Dec  6 11:14:44 2009
From: maiagx at gmail.com (Charlotte Maia)
Date: Sun, 6 Dec 2009 23:14:44 +1300
Subject: [Rd] Task View for Marketing
In-Reply-To: <alpine.DEB.2.00.0912050416090.13249@paninaro.stat-math.wu-wien.ac.at>
References: <b7bfe54e0912041903u773b26d6yf455949294fba3e@mail.gmail.com>
	<alpine.DEB.2.00.0912050416090.13249@paninaro.stat-math.wu-wien.ac.at>
Message-ID: <b7bfe54e0912060214v40fe92d2x21d6018419e62747@mail.gmail.com>

On Sat, Dec 5, 2009 at 4:20 PM, Achim Zeileis
<Achim.Zeileis at wu-wien.ac.at> wrote:
> Charlotte:
>
>> I was wondering if a task view for marketing would be a good idea????
>
> Maybe, do you want to volunteer to maintain it?
>
>> I realise that it would have some overlap with other task views.
>> Social science, cluster and multivariate are the most obvious ones.
>
> Yes. I'm not sure how a new "Marketing" view would fit in the mix but maybe
> you have some more precise ideas.
>
> If you would be willing to write such a view and maintain it in the future,
> then I suggest that you put together a list of packages and some rough ideas
> for text and how the marketing view would add to the views named above. Send
> me the ideas (off-list) and then we can decide whether to go on or not.
>
> Thanks for the suggestion.
> Best,
> Z

Achim

I'm really honoured by the mere notion that I could ever maintain a
CRAN task view.
However honestly, I doubt that I have sufficient expertise for such a role.

I will investigate the idea of a marketing view further, and if
appropriate, get back to you.
In the meantime, if others are interested...?


kind regards
-- 
Charlotte Maia
http://sites.google.com/site/maiagx/home


From lgautier at gmail.com  Sun Dec  6 12:18:50 2009
From: lgautier at gmail.com (Laurent Gautier)
Date: Sun, 06 Dec 2009 12:18:50 +0100
Subject: [Rd] raster support in graphics devices
Message-ID: <4B1B931A.1090709@gmail.com>


I can confirm. Last time I checked (that is recently), there was no way 
to do it at the C level (beside possibly extreme hacks trying to work 
around what R does not want to expose, or go for patched source trees 
and builds).

What is the status of this patch (accepted ? rejected ? else ?)
This subject keeps appearing on the list, with the existence of a patch 
once contributed (3 years ago) acknowledged:
http://www.mail-archive.com/r-help at r-project.org/msg67172.html


L.


> ------------------------------
>
> On Dec 5, 2009, at 4:11 PM, Romain Francois wrote:
>
>>> I agree too, I was just trying to put on the balance the amount
>>> of work that would require graphics supporting connections.
>>>
>>> Who's willing to do it ?
>>>
> The issue is not the will nor complexity on the GD side, but
> connections are not exposed outside of R (or at the C level), so
> there is currently no way to do it (AFAIR). Jeff Horner has proposed
> a patch long ago and Cairo works with connections if you patch R, but
> connections are to date still not part of the API. So I suspect the
> real issue is to create a connection API so packages (and devices)
> can use it.
>
> Cheers, Simon
>
>
>


From romain.francois at dbmail.com  Sun Dec  6 14:24:17 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Sun, 06 Dec 2009 14:24:17 +0100
Subject: [Rd] raster support in graphics devices
In-Reply-To: <56EBD53C-DB97-4EF0-BB28-BD57E2BA4BFD@r-project.org>
References: <4B146EC6.2000502@auckland.ac.nz>	<971536df0912040528w4226179el7f833c736941406d@mail.gmail.com>
	<de4e29f50912040606r365a932by697fd500460773aa@mail.gmail.com>
	<971536df0912040619r13f7d79bj340e8c2f7718b61f@mail.gmail.com>
	<4B193276.5010001@dbmail.com>
	<971536df0912040806v57bf8c5p3cb36e634208a9dc@mail.gmail.com>
	<4B1AA10E.3090004@gmail.com> <4B1ACC79.90805@dbmail.com>
	<56EBD53C-DB97-4EF0-BB28-BD57E2BA4BFD@r-project.org>
Message-ID: <4B1BB081.4040300@dbmail.com>

On 12/06/2009 01:20 AM, Simon Urbanek wrote:
> On Dec 5, 2009, at 4:11 PM, Romain Francois wrote:
>
>> I agree too, I was just trying to put on the balance the amount of work that would require graphics supporting connections.
>>
>> Who's willing to do it ?
>>
>
> The issue is not the will nor complexity on the GD side, but connections are not exposed outside of R (or at the C level), so there is currently no way to do it (AFAIR). Jeff Horner has proposed a patch long ago and Cairo works with connections if you patch R, but connections are to date still not part of the API. So I suspect the real issue is to create a connection API so packages (and devices) can use it.
>
> Cheers,
> Simon

As much as I'd love a C API for connections, streaming graphics out to 
connections don't necessarily have to depend on a C api. The trick we 
use in the RProtoBuf package to stream out to a binary connection is to 
call the R function writeBin several times. Something like:

/* next element is some raw vector we want to stream out */
SEXP nextElement = PROTECT( getNextElement() ) ;

/* con is the INTSXP connection number */
/* create the call : writeBin( nextElement, con ) */
SEXP call = PROTECT( lang3( "writeBin", nextElement, con ) );
SEXP res  = PROTECT( eval( call, R_GlobalEnv) ) ;

/* grab the number of bytes actually sent out */
int n = INTEGER(res)[0] ;

UNPROTECT(3) ; /* res, call, nextElement */

We do the same with "readBin" to read from a binary connection chunk by 
chunk.

Romain


>> On 12/05/2009 07:06 PM, Tobias Verbeke wrote:
>>>
>>> Hi,
>>>
>>> Gabor Grothendieck wrote:
>>>
>>>> Its not just the time. Its also the nuisance of having to manage files
>>>> that
>>>> I never needed in the first place.
>>>
>>> I agree with Gabor that it is more than a 'nice to have'.
>>>
>>> There are situations (when integrating R with other
>>> applications) you don't want to touch a disk and
>>> manage files afterwards (e.g. when one wants to pass
>>> a byte string).
>>>
>>> A recent question on the topic can be found here:
>>>
>>> http://tolstoy.newcastle.edu.au/R/e8/help/09/11/5902.html
>>>
>>> Best,
>>> Tobias
>>>
>>>> On Fri, Dec 4, 2009 at 11:01 AM, Romain Francois
>>>> <romain.francois at dbmail.com
>>>>> wrote:
>>>>
>>>>> On 12/04/2009 03:19 PM, Gabor Grothendieck wrote:
>>>>>
>>>>>> Thanks.
>>>>>>
>>>>>> I am looking for the data to be just as if I had read in the png
>>>>>> file (or
>>>>>> wmf file or whatever).
>>>>>>
>>>>> Hi,
>>>>>
>>>>> You are after the binary payload of the rendered graph as a png file. So
>>>>> you are going to have to go through a png file.
>>>>>
>>>>> It would be nice to be able to render to a binary connection, like a
>>>>> rawConnection, but it seems like an expensive "nice to have"
>>>>>
>>>>>
>>>>> grid.cap seems to give a bitmap and then would
>>>>>> require some sort of processing to get the png or wmf, etc. form. Also
>>>>>> note
>>>>>> that I need it for classic graphics and not just grid graphics.
>>>>>>
>>>>> grid.cap does not seem to care, baptiste code uses traditional graphics
>>>>>
>>>>>
>>>>> What I have right now works just as I want it _except_ I have to
>>>>> create a
>>>>>> file and then read it back in which seems a waste.
>>>>>>
>>>>> Can you measure the time it takes to do dev.off() and readBin ?
>>>>>
>>>>>
>>>>> On Fri, Dec 4, 2009 at 9:06 AM, baptiste auguie<
>>>>>> baptiste.auguie at googlemail.com>  wrote:
>>>>>>
>>>>>> Hi,
>>>>>>> You can use grid.cap,
>>>>>>>
>>>>>>> x11()
>>>>>>> plot(1:10)
>>>>>>> g = grid.cap()
>>>>>>> dev.off()
>>>>>>> str(g)
>>>>>>> # chr [1:672, 1:671] "white" "white" "white" "white" "white" ...
>>>>>>>
>>>>>>> but as far as I understand in ?grid.cap and the underlying code there
>>>>>>> is no "capGrob" equivalent that wouldn't require opening a new device
>>>>>>> before capturing the output.
>>>>>>>
>>>>>>> I hope I'm mistaken.
>>>>>>>
>>>>>>> Best,
>>>>>>>
>>>>>>> baptiste
>>>>>>>
>>>>>>> 2009/12/4 Gabor Grothendieck<ggrothendieck at gmail.com>:
>>>>>>>
>>>>>>>> Currently I have an application that saves the current graphics image
>>>>>>>>
>>>>>>> (that
>>>>>>>
>>>>>>>> was created with classic graphics or grid graphics) to a file and
>>>>>>>> then
>>>>>>>>
>>>>>>> reads
>>>>>>>
>>>>>>>> the file back in using readBin:
>>>>>>>>
>>>>>>>> png("my.png")
>>>>>>>> plot(1:10)
>>>>>>>> dev.off()
>>>>>>>> raw.img<- readBin("my.png", "raw", size = 1, n = 100000000)
>>>>>>>>
>>>>>>>> (I am doing this on Windows but would like to be able to do it on any
>>>>>>>> platform.)
>>>>>>>>
>>>>>>>> Does the new raster functionality give me any way to get the object
>>>>>>>>
>>>>>>> raw.img
>>>>>>>
>>>>>>>> without creating the intermediate file, my.png? If so what is the
>>>>>>>> corresponding code?
>>>>>>>>
>>>>>>>>
>>>>>>>> On Mon, Nov 30, 2009 at 8:17 PM, Paul
>>>>>>>> Murrell<p.murrell at auckland.ac.nz
>>>>>>>> wrote:
>>>>>>>>
>>>>>>>> Hi
>>>>>>>>> This is for developers of extension packages that provide extra
>>>>>>>>>
>>>>>>>> *graphics
>>>>>>>> devices* for R.
>>>>>>>>> In the *development* version of R, support has been added to the
>>>>>>>>>
>>>>>>>> graphics
>>>>>>>> engine for sending raster images (bitmaps) to a graphics device. This
>>>>>>>>> consists mainly of two new device functions: dev_Raster() and
>>>>>>>>>
>>>>>>>> dev_Cap().
>>>>>>>>> The R_GE_version constant (in GraphicsEngine.h) has been bumped
>>>>>>>>> up to 6
>>>>>>>>>
>>>>>>>> as
>>>>>>>> a marker of this change.
>>>>>>>>> This means that, at a minimum, all graphics devices should be
>>>>>>>>> updated
>>>>>>>>> to
>>>>>>>>> provide dummy implementations of these new functions that just
>>>>>>>>> say the
>>>>>>>>> feature is not yet implemented (see for example the PicTeX and XFig
>>>>>>>>>
>>>>>>>> devices
>>>>>>>> in the 'grDevices' package).
>>>>>>>>> A full implementation of dev_Raster() should be able to draw a
>>>>>>>>> raster
>>>>>>>>>
>>>>>>>> image
>>>>>>>> (provided as an array of 32-bit R colors) at any size, possibly
>>>>>>>> (bilinear)
>>>>>>>> interpolated (otherwise nearest-neighbour), at any orientation,
>>>>>>>> and with
>>>>>>>> a
>>>>>>>> per-pixel alpha channel. Where these are not natively supported by a
>>>>>>>>> device, the graphics engine provides some routines for scaling and
>>>>>>>>>
>>>>>>>> rotating
>>>>>>>> raster images (see for example the X11 device). The dev_Cap()
>>>>>>>> function
>>>>>>>>> should return a representation of a raster image captured from the
>>>>>>>>>
>>>>>>>> current
>>>>>>>> device. This will only make sense for some devices (see for
>>>>>>>> example the
>>>>>>>>> Cairo device in the 'grDevices' package).
>>>>>>>>>
>>>>>>>>> A little more information and a couple of small examples are
>>>>>>>>> provided
>>>>>>>>> at
>>>>>>>>> http://developer.r-project.org/Raster/raster-RFC.html
>>>>>>>>>
>>>>>>>>> Paul
>>>>>>>>> --
>>>>>>>>> Dr Paul Murrell
>>>>>>>>> Department of Statistics
>>>>>>>>> The University of Auckland
>>>>>>>>> Private Bag 92019
>>>>>>>>> Auckland
>>>>>>>>> New Zealand
>>>>>>>>> 64 9 3737599 x85392
>>>>>>>>> paul at stat.auckland.ac.nz
>>>>>>>>> http://www.stat.auckland.ac.nz/~paul/<http://www.stat.auckland.ac.nz/%7Epaul/>
>>>>>>>>>
>>>>>>>>> <http://www.stat.auckland.ac.nz/%7Epaul/>
>>>>>>>>>
>>>>>>>> <http://www.stat.auckland.ac.nz/%7Epaul/>
>>>>> --

-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/Gq7i : ohloh
|- http://tr.im/FtUu : new package : highlight
`- http://tr.im/EAD5 : LondonR slides


From romain.francois at dbmail.com  Sun Dec  6 14:27:54 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Sun, 06 Dec 2009 14:27:54 +0100
Subject: [Rd] raster support in graphics devices
In-Reply-To: <4B1BB081.4040300@dbmail.com>
References: <4B146EC6.2000502@auckland.ac.nz>	<971536df0912040528w4226179el7f833c736941406d@mail.gmail.com>
	<de4e29f50912040606r365a932by697fd500460773aa@mail.gmail.com>
	<971536df0912040619r13f7d79bj340e8c2f7718b61f@mail.gmail.com>
	<4B193276.5010001@dbmail.com>
	<971536df0912040806v57bf8c5p3cb36e634208a9dc@mail.gmail.com>
	<4B1AA10E.3090004@gmail.com> <4B1ACC79.90805@dbmail.com>
	<56EBD53C-DB97-4EF0-BB28-BD57E2BA4BFD@r-project.org>
	<4B1BB081.4040300@dbmail.com>
Message-ID: <4B1BB15A.4000604@dbmail.com>

On 12/06/2009 02:24 PM, Romain Francois wrote:
> On 12/06/2009 01:20 AM, Simon Urbanek wrote:
>> On Dec 5, 2009, at 4:11 PM, Romain Francois wrote:
>>
>>> I agree too, I was just trying to put on the balance the amount of
>>> work that would require graphics supporting connections.
>>>
>>> Who's willing to do it ?
>>>
>>
>> The issue is not the will nor complexity on the GD side, but
>> connections are not exposed outside of R (or at the C level), so there
>> is currently no way to do it (AFAIR). Jeff Horner has proposed a patch
>> long ago and Cairo works with connections if you patch R, but
>> connections are to date still not part of the API. So I suspect the
>> real issue is to create a connection API so packages (and devices) can
>> use it.
>>
>> Cheers,
>> Simon
>
> As much as I'd love a C API for connections, streaming graphics out to
> connections don't necessarily have to depend on a C api. The trick we
> use in the RProtoBuf package to stream out to a binary connection is to
> call the R function writeBin several times. Something like:
>
> /* next element is some raw vector we want to stream out */
> SEXP nextElement = PROTECT( getNextElement() ) ;
>
> /* con is the INTSXP connection number */
> /* create the call : writeBin( nextElement, con ) */
> SEXP call = PROTECT( lang3( "writeBin", nextElement, con ) );

I meant : lang3( install( "writeBin"), nextElement, con )

> SEXP res = PROTECT( eval( call, R_GlobalEnv) ) ;
>
> /* grab the number of bytes actually sent out */
> int n = INTEGER(res)[0] ;
>
> UNPROTECT(3) ; /* res, call, nextElement */
>
> We do the same with "readBin" to read from a binary connection chunk by
> chunk.
>
> Romain
>
>
>>> On 12/05/2009 07:06 PM, Tobias Verbeke wrote:
>>>>
>>>> Hi,
>>>>
>>>> Gabor Grothendieck wrote:
>>>>
>>>>> Its not just the time. Its also the nuisance of having to manage files
>>>>> that
>>>>> I never needed in the first place.
>>>>
>>>> I agree with Gabor that it is more than a 'nice to have'.
>>>>
>>>> There are situations (when integrating R with other
>>>> applications) you don't want to touch a disk and
>>>> manage files afterwards (e.g. when one wants to pass
>>>> a byte string).
>>>>
>>>> A recent question on the topic can be found here:
>>>>
>>>> http://tolstoy.newcastle.edu.au/R/e8/help/09/11/5902.html
>>>>
>>>> Best,
>>>> Tobias
>>>>
>>>>> On Fri, Dec 4, 2009 at 11:01 AM, Romain Francois
>>>>> <romain.francois at dbmail.com
>>>>>> wrote:
>>>>>
>>>>>> On 12/04/2009 03:19 PM, Gabor Grothendieck wrote:
>>>>>>
>>>>>>> Thanks.
>>>>>>>
>>>>>>> I am looking for the data to be just as if I had read in the png
>>>>>>> file (or
>>>>>>> wmf file or whatever).
>>>>>>>
>>>>>> Hi,
>>>>>>
>>>>>> You are after the binary payload of the rendered graph as a png
>>>>>> file. So
>>>>>> you are going to have to go through a png file.
>>>>>>
>>>>>> It would be nice to be able to render to a binary connection, like a
>>>>>> rawConnection, but it seems like an expensive "nice to have"
>>>>>>
>>>>>>
>>>>>> grid.cap seems to give a bitmap and then would
>>>>>>> require some sort of processing to get the png or wmf, etc. form.
>>>>>>> Also
>>>>>>> note
>>>>>>> that I need it for classic graphics and not just grid graphics.
>>>>>>>
>>>>>> grid.cap does not seem to care, baptiste code uses traditional
>>>>>> graphics
>>>>>>
>>>>>>
>>>>>> What I have right now works just as I want it _except_ I have to
>>>>>> create a
>>>>>>> file and then read it back in which seems a waste.
>>>>>>>
>>>>>> Can you measure the time it takes to do dev.off() and readBin ?
>>>>>>
>>>>>>
>>>>>> On Fri, Dec 4, 2009 at 9:06 AM, baptiste auguie<
>>>>>>> baptiste.auguie at googlemail.com> wrote:
>>>>>>>
>>>>>>> Hi,
>>>>>>>> You can use grid.cap,
>>>>>>>>
>>>>>>>> x11()
>>>>>>>> plot(1:10)
>>>>>>>> g = grid.cap()
>>>>>>>> dev.off()
>>>>>>>> str(g)
>>>>>>>> # chr [1:672, 1:671] "white" "white" "white" "white" "white" ...
>>>>>>>>
>>>>>>>> but as far as I understand in ?grid.cap and the underlying code
>>>>>>>> there
>>>>>>>> is no "capGrob" equivalent that wouldn't require opening a new
>>>>>>>> device
>>>>>>>> before capturing the output.
>>>>>>>>
>>>>>>>> I hope I'm mistaken.
>>>>>>>>
>>>>>>>> Best,
>>>>>>>>
>>>>>>>> baptiste
>>>>>>>>
>>>>>>>> 2009/12/4 Gabor Grothendieck<ggrothendieck at gmail.com>:
>>>>>>>>
>>>>>>>>> Currently I have an application that saves the current graphics
>>>>>>>>> image
>>>>>>>>>
>>>>>>>> (that
>>>>>>>>
>>>>>>>>> was created with classic graphics or grid graphics) to a file and
>>>>>>>>> then
>>>>>>>>>
>>>>>>>> reads
>>>>>>>>
>>>>>>>>> the file back in using readBin:
>>>>>>>>>
>>>>>>>>> png("my.png")
>>>>>>>>> plot(1:10)
>>>>>>>>> dev.off()
>>>>>>>>> raw.img<- readBin("my.png", "raw", size = 1, n = 100000000)
>>>>>>>>>
>>>>>>>>> (I am doing this on Windows but would like to be able to do it
>>>>>>>>> on any
>>>>>>>>> platform.)
>>>>>>>>>
>>>>>>>>> Does the new raster functionality give me any way to get the
>>>>>>>>> object
>>>>>>>>>
>>>>>>>> raw.img
>>>>>>>>
>>>>>>>>> without creating the intermediate file, my.png? If so what is the
>>>>>>>>> corresponding code?
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> On Mon, Nov 30, 2009 at 8:17 PM, Paul
>>>>>>>>> Murrell<p.murrell at auckland.ac.nz
>>>>>>>>> wrote:
>>>>>>>>>
>>>>>>>>> Hi
>>>>>>>>>> This is for developers of extension packages that provide extra
>>>>>>>>>>
>>>>>>>>> *graphics
>>>>>>>>> devices* for R.
>>>>>>>>>> In the *development* version of R, support has been added to the
>>>>>>>>>>
>>>>>>>>> graphics
>>>>>>>>> engine for sending raster images (bitmaps) to a graphics
>>>>>>>>> device. This
>>>>>>>>>> consists mainly of two new device functions: dev_Raster() and
>>>>>>>>>>
>>>>>>>>> dev_Cap().
>>>>>>>>>> The R_GE_version constant (in GraphicsEngine.h) has been bumped
>>>>>>>>>> up to 6
>>>>>>>>>>
>>>>>>>>> as
>>>>>>>>> a marker of this change.
>>>>>>>>>> This means that, at a minimum, all graphics devices should be
>>>>>>>>>> updated
>>>>>>>>>> to
>>>>>>>>>> provide dummy implementations of these new functions that just
>>>>>>>>>> say the
>>>>>>>>>> feature is not yet implemented (see for example the PicTeX and
>>>>>>>>>> XFig
>>>>>>>>>>
>>>>>>>>> devices
>>>>>>>>> in the 'grDevices' package).
>>>>>>>>>> A full implementation of dev_Raster() should be able to draw a
>>>>>>>>>> raster
>>>>>>>>>>
>>>>>>>>> image
>>>>>>>>> (provided as an array of 32-bit R colors) at any size, possibly
>>>>>>>>> (bilinear)
>>>>>>>>> interpolated (otherwise nearest-neighbour), at any orientation,
>>>>>>>>> and with
>>>>>>>>> a
>>>>>>>>> per-pixel alpha channel. Where these are not natively supported
>>>>>>>>> by a
>>>>>>>>>> device, the graphics engine provides some routines for scaling
>>>>>>>>>> and
>>>>>>>>>>
>>>>>>>>> rotating
>>>>>>>>> raster images (see for example the X11 device). The dev_Cap()
>>>>>>>>> function
>>>>>>>>>> should return a representation of a raster image captured from
>>>>>>>>>> the
>>>>>>>>>>
>>>>>>>>> current
>>>>>>>>> device. This will only make sense for some devices (see for
>>>>>>>>> example the
>>>>>>>>>> Cairo device in the 'grDevices' package).
>>>>>>>>>>
>>>>>>>>>> A little more information and a couple of small examples are
>>>>>>>>>> provided
>>>>>>>>>> at
>>>>>>>>>> http://developer.r-project.org/Raster/raster-RFC.html
>>>>>>>>>>
>>>>>>>>>> Paul
>>>>>>>>>> --
>>>>>>>>>> Dr Paul Murrell
>>>>>>>>>> Department of Statistics
>>>>>>>>>> The University of Auckland
>>>>>>>>>> Private Bag 92019
>>>>>>>>>> Auckland
>>>>>>>>>> New Zealand
>>>>>>>>>> 64 9 3737599 x85392
>>>>>>>>>> paul at stat.auckland.ac.nz
>>>>>>>>>> http://www.stat.auckland.ac.nz/~paul/<http://www.stat.auckland.ac.nz/%7Epaul/>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> <http://www.stat.auckland.ac.nz/%7Epaul/>
>>>>>>>>>>
>>>>>>>>> <http://www.stat.auckland.ac.nz/%7Epaul/>
>>>>>> --
>


-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/Gq7i : ohloh
|- http://tr.im/FtUu : new package : highlight
`- http://tr.im/EAD5 : LondonR slides


From simon.urbanek at r-project.org  Sun Dec  6 14:49:54 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Sun, 6 Dec 2009 08:49:54 -0500
Subject: [Rd] raster support in graphics devices
In-Reply-To: <4B1BB081.4040300@dbmail.com>
References: <4B146EC6.2000502@auckland.ac.nz>	<971536df0912040528w4226179el7f833c736941406d@mail.gmail.com>
	<de4e29f50912040606r365a932by697fd500460773aa@mail.gmail.com>
	<971536df0912040619r13f7d79bj340e8c2f7718b61f@mail.gmail.com>
	<4B193276.5010001@dbmail.com>
	<971536df0912040806v57bf8c5p3cb36e634208a9dc@mail.gmail.com>
	<4B1AA10E.3090004@gmail.com> <4B1ACC79.90805@dbmail.com>
	<56EBD53C-DB97-4EF0-BB28-BD57E2BA4BFD@r-project.org>
	<4B1BB081.4040300@dbmail.com>
Message-ID: <F68F099F-5824-455B-8DC7-CF388C1433A3@r-project.org>


On Dec 6, 2009, at 8:24 AM, Romain Francois wrote:

> On 12/06/2009 01:20 AM, Simon Urbanek wrote:
>> On Dec 5, 2009, at 4:11 PM, Romain Francois wrote:
>> 
>>> I agree too, I was just trying to put on the balance the amount of work that would require graphics supporting connections.
>>> 
>>> Who's willing to do it ?
>>> 
>> 
>> The issue is not the will nor complexity on the GD side, but connections are not exposed outside of R (or at the C level), so there is currently no way to do it (AFAIR). Jeff Horner has proposed a patch long ago and Cairo works with connections if you patch R, but connections are to date still not part of the API. So I suspect the real issue is to create a connection API so packages (and devices) can use it.
>> 
>> Cheers,
>> Simon
> 
> As much as I'd love a C API for connections, streaming graphics out to connections don't necessarily have to depend on a C api. The trick we use in the RProtoBuf package to stream out to a binary connection is to call the R function writeBin several times. Something like:
> 
> /* next element is some raw vector we want to stream out */
> SEXP nextElement = PROTECT( getNextElement() ) ;
> 
> /* con is the INTSXP connection number */
> /* create the call : writeBin( nextElement, con ) */
> SEXP call = PROTECT( lang3( "writeBin", nextElement, con ) );
> SEXP res  = PROTECT( eval( call, R_GlobalEnv) ) ;
> 
> /* grab the number of bytes actually sent out */
> int n = INTEGER(res)[0] ;
> 
> UNPROTECT(3) ; /* res, call, nextElement */
> 
> We do the same with "readBin" to read from a binary connection chunk by chunk.
> 

Well, that's a hack like any other and error handling will be a pain. Of course you can always use the evaluator, but I would not want to write or maintain a hack like that :)

Cheers,
Simon


> 
> 
> 
>>> On 12/05/2009 07:06 PM, Tobias Verbeke wrote:
>>>> 
>>>> Hi,
>>>> 
>>>> Gabor Grothendieck wrote:
>>>> 
>>>>> Its not just the time. Its also the nuisance of having to manage files
>>>>> that
>>>>> I never needed in the first place.
>>>> 
>>>> I agree with Gabor that it is more than a 'nice to have'.
>>>> 
>>>> There are situations (when integrating R with other
>>>> applications) you don't want to touch a disk and
>>>> manage files afterwards (e.g. when one wants to pass
>>>> a byte string).
>>>> 
>>>> A recent question on the topic can be found here:
>>>> 
>>>> http://tolstoy.newcastle.edu.au/R/e8/help/09/11/5902.html
>>>> 
>>>> Best,
>>>> Tobias
>>>> 
>>>>> On Fri, Dec 4, 2009 at 11:01 AM, Romain Francois
>>>>> <romain.francois at dbmail.com
>>>>>> wrote:
>>>>> 
>>>>>> On 12/04/2009 03:19 PM, Gabor Grothendieck wrote:
>>>>>> 
>>>>>>> Thanks.
>>>>>>> 
>>>>>>> I am looking for the data to be just as if I had read in the png
>>>>>>> file (or
>>>>>>> wmf file or whatever).
>>>>>>> 
>>>>>> Hi,
>>>>>> 
>>>>>> You are after the binary payload of the rendered graph as a png file. So
>>>>>> you are going to have to go through a png file.
>>>>>> 
>>>>>> It would be nice to be able to render to a binary connection, like a
>>>>>> rawConnection, but it seems like an expensive "nice to have"
>>>>>> 
>>>>>> 
>>>>>> grid.cap seems to give a bitmap and then would
>>>>>>> require some sort of processing to get the png or wmf, etc. form. Also
>>>>>>> note
>>>>>>> that I need it for classic graphics and not just grid graphics.
>>>>>>> 
>>>>>> grid.cap does not seem to care, baptiste code uses traditional graphics
>>>>>> 
>>>>>> 
>>>>>> What I have right now works just as I want it _except_ I have to
>>>>>> create a
>>>>>>> file and then read it back in which seems a waste.
>>>>>>> 
>>>>>> Can you measure the time it takes to do dev.off() and readBin ?
>>>>>> 
>>>>>> 
>>>>>> On Fri, Dec 4, 2009 at 9:06 AM, baptiste auguie<
>>>>>>> baptiste.auguie at googlemail.com>  wrote:
>>>>>>> 
>>>>>>> Hi,
>>>>>>>> You can use grid.cap,
>>>>>>>> 
>>>>>>>> x11()
>>>>>>>> plot(1:10)
>>>>>>>> g = grid.cap()
>>>>>>>> dev.off()
>>>>>>>> str(g)
>>>>>>>> # chr [1:672, 1:671] "white" "white" "white" "white" "white" ...
>>>>>>>> 
>>>>>>>> but as far as I understand in ?grid.cap and the underlying code there
>>>>>>>> is no "capGrob" equivalent that wouldn't require opening a new device
>>>>>>>> before capturing the output.
>>>>>>>> 
>>>>>>>> I hope I'm mistaken.
>>>>>>>> 
>>>>>>>> Best,
>>>>>>>> 
>>>>>>>> baptiste
>>>>>>>> 
>>>>>>>> 2009/12/4 Gabor Grothendieck<ggrothendieck at gmail.com>:
>>>>>>>> 
>>>>>>>>> Currently I have an application that saves the current graphics image
>>>>>>>>> 
>>>>>>>> (that
>>>>>>>> 
>>>>>>>>> was created with classic graphics or grid graphics) to a file and
>>>>>>>>> then
>>>>>>>>> 
>>>>>>>> reads
>>>>>>>> 
>>>>>>>>> the file back in using readBin:
>>>>>>>>> 
>>>>>>>>> png("my.png")
>>>>>>>>> plot(1:10)
>>>>>>>>> dev.off()
>>>>>>>>> raw.img<- readBin("my.png", "raw", size = 1, n = 100000000)
>>>>>>>>> 
>>>>>>>>> (I am doing this on Windows but would like to be able to do it on any
>>>>>>>>> platform.)
>>>>>>>>> 
>>>>>>>>> Does the new raster functionality give me any way to get the object
>>>>>>>>> 
>>>>>>>> raw.img
>>>>>>>> 
>>>>>>>>> without creating the intermediate file, my.png? If so what is the
>>>>>>>>> corresponding code?
>>>>>>>>> 
>>>>>>>>> 
>>>>>>>>> On Mon, Nov 30, 2009 at 8:17 PM, Paul
>>>>>>>>> Murrell<p.murrell at auckland.ac.nz
>>>>>>>>> wrote:
>>>>>>>>> 
>>>>>>>>> Hi
>>>>>>>>>> This is for developers of extension packages that provide extra
>>>>>>>>>> 
>>>>>>>>> *graphics
>>>>>>>>> devices* for R.
>>>>>>>>>> In the *development* version of R, support has been added to the
>>>>>>>>>> 
>>>>>>>>> graphics
>>>>>>>>> engine for sending raster images (bitmaps) to a graphics device. This
>>>>>>>>>> consists mainly of two new device functions: dev_Raster() and
>>>>>>>>>> 
>>>>>>>>> dev_Cap().
>>>>>>>>>> The R_GE_version constant (in GraphicsEngine.h) has been bumped
>>>>>>>>>> up to 6
>>>>>>>>>> 
>>>>>>>>> as
>>>>>>>>> a marker of this change.
>>>>>>>>>> This means that, at a minimum, all graphics devices should be
>>>>>>>>>> updated
>>>>>>>>>> to
>>>>>>>>>> provide dummy implementations of these new functions that just
>>>>>>>>>> say the
>>>>>>>>>> feature is not yet implemented (see for example the PicTeX and XFig
>>>>>>>>>> 
>>>>>>>>> devices
>>>>>>>>> in the 'grDevices' package).
>>>>>>>>>> A full implementation of dev_Raster() should be able to draw a
>>>>>>>>>> raster
>>>>>>>>>> 
>>>>>>>>> image
>>>>>>>>> (provided as an array of 32-bit R colors) at any size, possibly
>>>>>>>>> (bilinear)
>>>>>>>>> interpolated (otherwise nearest-neighbour), at any orientation,
>>>>>>>>> and with
>>>>>>>>> a
>>>>>>>>> per-pixel alpha channel. Where these are not natively supported by a
>>>>>>>>>> device, the graphics engine provides some routines for scaling and
>>>>>>>>>> 
>>>>>>>>> rotating
>>>>>>>>> raster images (see for example the X11 device). The dev_Cap()
>>>>>>>>> function
>>>>>>>>>> should return a representation of a raster image captured from the
>>>>>>>>>> 
>>>>>>>>> current
>>>>>>>>> device. This will only make sense for some devices (see for
>>>>>>>>> example the
>>>>>>>>>> Cairo device in the 'grDevices' package).
>>>>>>>>>> 
>>>>>>>>>> A little more information and a couple of small examples are
>>>>>>>>>> provided
>>>>>>>>>> at
>>>>>>>>>> http://developer.r-project.org/Raster/raster-RFC.html
>>>>>>>>>> 
>>>>>>>>>> Paul
>>>>>>>>>> --
>>>>>>>>>> Dr Paul Murrell
>>>>>>>>>> Department of Statistics
>>>>>>>>>> The University of Auckland
>>>>>>>>>> Private Bag 92019
>>>>>>>>>> Auckland
>>>>>>>>>> New Zealand
>>>>>>>>>> 64 9 3737599 x85392
>>>>>>>>>> paul at stat.auckland.ac.nz
>>>>>>>>>> http://www.stat.auckland.ac.nz/~paul/<http://www.stat.auckland.ac.nz/%7Epaul/>
>>>>>>>>>> 
>>>>>>>>>> <http://www.stat.auckland.ac.nz/%7Epaul/>
>>>>>>>>>> 
>>>>>>>>> <http://www.stat.auckland.ac.nz/%7Epaul/>
>>>>>> --
> 
> -- 
> Romain Francois
> Professional R Enthusiast
> +33(0) 6 28 91 30 30
> http://romainfrancois.blog.free.fr
> |- http://tr.im/Gq7i : ohloh
> |- http://tr.im/FtUu : new package : highlight
> `- http://tr.im/EAD5 : LondonR slides
> 
> 


From ulrich.keller at uni.lu  Sun Dec  6 07:25:21 2009
From: ulrich.keller at uni.lu (ulrich.keller at uni.lu)
Date: Sun,  6 Dec 2009 07:25:21 +0100 (CET)
Subject: [Rd] PR#14099
Message-ID: <20091206062522.0387D282EF2D@mail.pubhealth.ku.dk>

The notes asked why an Ubuntu/Compiz problem is being reported on
R-bugs. Answer: because the fact that no other application exhibits
these redrawing problems seems to indicate that R is to blame, not
Compiz. Furthermore, the data editor is not drawn properly with Metacity
either (some row names missing until cursor is moved). Should I make a
new bug report that does not mention Compiz?


From romain.francois at dbmail.com  Sun Dec  6 17:26:52 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Sun, 06 Dec 2009 17:26:52 +0100
Subject: [Rd] raster support in graphics devices
In-Reply-To: <F68F099F-5824-455B-8DC7-CF388C1433A3@r-project.org>
References: <4B146EC6.2000502@auckland.ac.nz>	<971536df0912040528w4226179el7f833c736941406d@mail.gmail.com>
	<de4e29f50912040606r365a932by697fd500460773aa@mail.gmail.com>
	<971536df0912040619r13f7d79bj340e8c2f7718b61f@mail.gmail.com>
	<4B193276.5010001@dbmail.com>
	<971536df0912040806v57bf8c5p3cb36e634208a9dc@mail.gmail.com>
	<4B1AA10E.3090004@gmail.com> <4B1ACC79.90805@dbmail.com>
	<56EBD53C-DB97-4EF0-BB28-BD57E2BA4BFD@r-project.org>
	<4B1BB081.4040300@dbmail.com>
	<F68F099F-5824-455B-8DC7-CF388C1433A3@r-project.org>
Message-ID: <4B1BDB4C.5040601@dbmail.com>

On 12/06/2009 02:49 PM, Simon Urbanek wrote:
> On Dec 6, 2009, at 8:24 AM, Romain Francois wrote:
>
>> On 12/06/2009 01:20 AM, Simon Urbanek wrote:
>>> On Dec 5, 2009, at 4:11 PM, Romain Francois wrote:
>>>
>>>> I agree too, I was just trying to put on the balance the amount of work that would require graphics supporting connections.
>>>>
>>>> Who's willing to do it ?
>>>>
>>>
>>> The issue is not the will nor complexity on the GD side, but connections are not exposed outside of R (or at the C level), so there is currently no way to do it (AFAIR). Jeff Horner has proposed a patch long ago and Cairo works with connections if you patch R, but connections are to date still not part of the API. So I suspect the real issue is to create a connection API so packages (and devices) can use it.
>>>
>>> Cheers,
>>> Simon
>>
>> As much as I'd love a C API for connections, streaming graphics out to connections don't necessarily have to depend on a C api. The trick we use in the RProtoBuf package to stream out to a binary connection is to call the R function writeBin several times. Something like:
>>
>> /* next element is some raw vector we want to stream out */
>> SEXP nextElement = PROTECT( getNextElement() ) ;
>>
>> /* con is the INTSXP connection number */
>> /* create the call : writeBin( nextElement, con ) */
>> SEXP call = PROTECT( lang3( "writeBin", nextElement, con ) );
>> SEXP res  = PROTECT( eval( call, R_GlobalEnv) ) ;
>>
>> /* grab the number of bytes actually sent out */
>> int n = INTEGER(res)[0] ;
>>
>> UNPROTECT(3) ; /* res, call, nextElement */
>>
>> We do the same with "readBin" to read from a binary connection chunk by chunk.
>>
>
> Well, that's a hack like any other and error handling will be a pain. Of course you can always use the evaluator, but I would not want to write or maintain a hack like that :)
>
> Cheers,
> Simon

Fair enough, so back to square one with Jeff's patch. Since jeff's 
original post or other reminders did not get replied (at least 
publicly), it is not clear what one can do to help moving to the 
direction of a C api for connection: a patch providing a higher level 
api, testing, documentation ?

>>>> On 12/05/2009 07:06 PM, Tobias Verbeke wrote:
>>>>>
>>>>> Hi,
>>>>>
>>>>> Gabor Grothendieck wrote:
>>>>>
>>>>>> Its not just the time. Its also the nuisance of having to manage files
>>>>>> that
>>>>>> I never needed in the first place.
>>>>>
>>>>> I agree with Gabor that it is more than a 'nice to have'.
>>>>>
>>>>> There are situations (when integrating R with other
>>>>> applications) you don't want to touch a disk and
>>>>> manage files afterwards (e.g. when one wants to pass
>>>>> a byte string).
>>>>>
>>>>> A recent question on the topic can be found here:
>>>>>
>>>>> http://tolstoy.newcastle.edu.au/R/e8/help/09/11/5902.html
>>>>>
>>>>> Best,
>>>>> Tobias
>>>>>
>>>>>> On Fri, Dec 4, 2009 at 11:01 AM, Romain Francois
>>>>>> <romain.francois at dbmail.com
>>>>>>> wrote:
>>>>>>
>>>>>>> On 12/04/2009 03:19 PM, Gabor Grothendieck wrote:
>>>>>>>
>>>>>>>> Thanks.
>>>>>>>>
>>>>>>>> I am looking for the data to be just as if I had read in the png
>>>>>>>> file (or
>>>>>>>> wmf file or whatever).
>>>>>>>>
>>>>>>> Hi,
>>>>>>>
>>>>>>> You are after the binary payload of the rendered graph as a png file. So
>>>>>>> you are going to have to go through a png file.
>>>>>>>
>>>>>>> It would be nice to be able to render to a binary connection, like a
>>>>>>> rawConnection, but it seems like an expensive "nice to have"
>>>>>>>
>>>>>>>
>>>>>>> grid.cap seems to give a bitmap and then would
>>>>>>>> require some sort of processing to get the png or wmf, etc. form. Also
>>>>>>>> note
>>>>>>>> that I need it for classic graphics and not just grid graphics.
>>>>>>>>
>>>>>>> grid.cap does not seem to care, baptiste code uses traditional graphics
>>>>>>>
>>>>>>>
>>>>>>> What I have right now works just as I want it _except_ I have to
>>>>>>> create a
>>>>>>>> file and then read it back in which seems a waste.
>>>>>>>>
>>>>>>> Can you measure the time it takes to do dev.off() and readBin ?
>>>>>>>
>>>>>>>
>>>>>>> On Fri, Dec 4, 2009 at 9:06 AM, baptiste auguie<
>>>>>>>> baptiste.auguie at googlemail.com>   wrote:
>>>>>>>>
>>>>>>>> Hi,
>>>>>>>>> You can use grid.cap,
>>>>>>>>>
>>>>>>>>> x11()
>>>>>>>>> plot(1:10)
>>>>>>>>> g = grid.cap()
>>>>>>>>> dev.off()
>>>>>>>>> str(g)
>>>>>>>>> # chr [1:672, 1:671] "white" "white" "white" "white" "white" ...
>>>>>>>>>
>>>>>>>>> but as far as I understand in ?grid.cap and the underlying code there
>>>>>>>>> is no "capGrob" equivalent that wouldn't require opening a new device
>>>>>>>>> before capturing the output.
>>>>>>>>>
>>>>>>>>> I hope I'm mistaken.
>>>>>>>>>
>>>>>>>>> Best,
>>>>>>>>>
>>>>>>>>> baptiste
>>>>>>>>>
>>>>>>>>> 2009/12/4 Gabor Grothendieck<ggrothendieck at gmail.com>:
>>>>>>>>>
>>>>>>>>>> Currently I have an application that saves the current graphics image
>>>>>>>>>>
>>>>>>>>> (that
>>>>>>>>>
>>>>>>>>>> was created with classic graphics or grid graphics) to a file and
>>>>>>>>>> then
>>>>>>>>>>
>>>>>>>>> reads
>>>>>>>>>
>>>>>>>>>> the file back in using readBin:
>>>>>>>>>>
>>>>>>>>>> png("my.png")
>>>>>>>>>> plot(1:10)
>>>>>>>>>> dev.off()
>>>>>>>>>> raw.img<- readBin("my.png", "raw", size = 1, n = 100000000)
>>>>>>>>>>
>>>>>>>>>> (I am doing this on Windows but would like to be able to do it on any
>>>>>>>>>> platform.)
>>>>>>>>>>
>>>>>>>>>> Does the new raster functionality give me any way to get the object
>>>>>>>>>>
>>>>>>>>> raw.img
>>>>>>>>>
>>>>>>>>>> without creating the intermediate file, my.png? If so what is the
>>>>>>>>>> corresponding code?
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> On Mon, Nov 30, 2009 at 8:17 PM, Paul
>>>>>>>>>> Murrell<p.murrell at auckland.ac.nz
>>>>>>>>>> wrote:
>>>>>>>>>>
>>>>>>>>>> Hi
>>>>>>>>>>> This is for developers of extension packages that provide extra
>>>>>>>>>>>
>>>>>>>>>> *graphics
>>>>>>>>>> devices* for R.
>>>>>>>>>>> In the *development* version of R, support has been added to the
>>>>>>>>>>>
>>>>>>>>>> graphics
>>>>>>>>>> engine for sending raster images (bitmaps) to a graphics device. This
>>>>>>>>>>> consists mainly of two new device functions: dev_Raster() and
>>>>>>>>>>>
>>>>>>>>>> dev_Cap().
>>>>>>>>>>> The R_GE_version constant (in GraphicsEngine.h) has been bumped
>>>>>>>>>>> up to 6
>>>>>>>>>>>
>>>>>>>>>> as
>>>>>>>>>> a marker of this change.
>>>>>>>>>>> This means that, at a minimum, all graphics devices should be
>>>>>>>>>>> updated
>>>>>>>>>>> to
>>>>>>>>>>> provide dummy implementations of these new functions that just
>>>>>>>>>>> say the
>>>>>>>>>>> feature is not yet implemented (see for example the PicTeX and XFig
>>>>>>>>>>>
>>>>>>>>>> devices
>>>>>>>>>> in the 'grDevices' package).
>>>>>>>>>>> A full implementation of dev_Raster() should be able to draw a
>>>>>>>>>>> raster
>>>>>>>>>>>
>>>>>>>>>> image
>>>>>>>>>> (provided as an array of 32-bit R colors) at any size, possibly
>>>>>>>>>> (bilinear)
>>>>>>>>>> interpolated (otherwise nearest-neighbour), at any orientation,
>>>>>>>>>> and with
>>>>>>>>>> a
>>>>>>>>>> per-pixel alpha channel. Where these are not natively supported by a
>>>>>>>>>>> device, the graphics engine provides some routines for scaling and
>>>>>>>>>>>
>>>>>>>>>> rotating
>>>>>>>>>> raster images (see for example the X11 device). The dev_Cap()
>>>>>>>>>> function
>>>>>>>>>>> should return a representation of a raster image captured from the
>>>>>>>>>>>
>>>>>>>>>> current
>>>>>>>>>> device. This will only make sense for some devices (see for
>>>>>>>>>> example the
>>>>>>>>>>> Cairo device in the 'grDevices' package).
>>>>>>>>>>>
>>>>>>>>>>> A little more information and a couple of small examples are
>>>>>>>>>>> provided
>>>>>>>>>>> at
>>>>>>>>>>> http://developer.r-project.org/Raster/raster-RFC.html
>>>>>>>>>>>
>>>>>>>>>>> Paul
>>>>>>>>>>> --
>>>>>>>>>>> Dr Paul Murrell
>>>>>>>>>>> Department of Statistics
>>>>>>>>>>> The University of Auckland
>>>>>>>>>>> Private Bag 92019
>>>>>>>>>>> Auckland
>>>>>>>>>>> New Zealand
>>>>>>>>>>> 64 9 3737599 x85392
>>>>>>>>>>> paul at stat.auckland.ac.nz
>>>>>>>>>>> http://www.stat.auckland.ac.nz/~paul/<http://www.stat.auckland.ac.nz/%7Epaul/>
>>>>>>>>>>>
>>>>>>>>>>> <http://www.stat.auckland.ac.nz/%7Epaul/>
>>>>>>>>>>>
>>>>>>>>>> <http://www.stat.auckland.ac.nz/%7Epaul/>
>>>>>>> --
>>
>> --
>> Romain Francois
>> Professional R Enthusiast
>> +33(0) 6 28 91 30 30
>> http://romainfrancois.blog.free.fr
>> |- http://tr.im/Gq7i : ohloh
>> |- http://tr.im/FtUu : new package : highlight
>> `- http://tr.im/EAD5 : LondonR slides
>>
>>
>
>
>


-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/Gq7i : ohloh
|- http://tr.im/FtUu : new package : highlight
`- http://tr.im/EAD5 : LondonR slides


From p.dalgaard at biostat.ku.dk  Sun Dec  6 18:39:27 2009
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sun, 06 Dec 2009 18:39:27 +0100
Subject: [Rd] PR#14099
In-Reply-To: <20091206062522.0387D282EF2D@mail.pubhealth.ku.dk>
References: <20091206062522.0387D282EF2D@mail.pubhealth.ku.dk>
Message-ID: <4B1BEC4F.7030209@biostat.ku.dk>

ulrich.keller at uni.lu wrote:
> The notes asked why an Ubuntu/Compiz problem is being reported on
> R-bugs. Answer: because the fact that no other application exhibits
> these redrawing problems seems to indicate that R is to blame, not
> Compiz. 

Wrong logic. And just because you have "the only" system that displays 
such behaviour does not imply that R is bug-free, nor that a workaround 
is necessarily impossible.

> Furthermore, the data editor is not drawn properly with Metacity
> either (some row names missing until cursor is moved). 

That's not true for Metacity on Fedora, it seems.

> Should I make a
> new bug report that does not mention Compiz?

Certainly not! Hiding the fact that this is system-specific does not 
resolve the issue any faster. To the contrary, since it is 
system-specific, it is most likely to be analyzed and eventually fixed 
by someone with access to the specific system.

However, R is an application that has worked across multiple X11 based 
platforms for many years. If R doesn't work on a new platform, I think 
it is fair to ask what is being done different on that platform, by 
filing a bug report for the system, if necessary.



-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From p.murrell at auckland.ac.nz  Sun Dec  6 21:26:52 2009
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Mon, 07 Dec 2009 09:26:52 +1300
Subject: [Rd] raster support in graphics devices
In-Reply-To: <de4e29f50912031310j598729f3g9a188d6a270cb91c@mail.gmail.com>
References: <4B146EC6.2000502@auckland.ac.nz>	
	<de4e29f50912011038v33c3503dmb732dbd0d8ffd456@mail.gmail.com>	
	<4B15A5C0.4060400@auckland.ac.nz>
	<de4e29f50912031310j598729f3g9a188d6a270cb91c@mail.gmail.com>
Message-ID: <4B1C138C.5080204@auckland.ac.nz>

Hi


baptiste auguie wrote:
> Hi again,
> 
> I found two possible bugs related to grid.raster, one with the quartz
> device and the other with pdf.
> 
> In my example I was playing with the idea of using grid.raster to
> create a filling pattern for rectangles. The pdf output does not seem
> to respect the clipping (it may have nothing to do with grid.raster
> though), whilst the quartz device with pdf file output often crashes
> for more than 4 different raster objects (but not always). I'm afraid
> I couldn't pinpoint the exact circumstance of the crash with a more
> concise example.


Thanks again for the report.

I have committed a fix for the PDF clipping.

Still looking at the Quartz crashes.

Paul


> Thanks in advance for any insights,
> 
> baptiste
> 
> ### Start example ###
> 
> library(grid)
> 
> ## create a motif
> grid45 <- function(..., width=0.5, height=0.5){
>   x11(width=width, height=height)
>   grid.polygon(...)
>   m <- grid.cap()
>   dev.off()
>   invisible(m)
> }
> 
> .grid45 <- grid45()
> ## grid.raster(.grid45)
> 
> tile.motif <- function(m, nx=10, ny=nx){
>   cols <- matrix(rep(m, nx), ncol=ncol(m)*nx, byrow=F)
>   matrix(rep(t(cols), ny), nrow=nrow(cols)*ny, byrow=T)
> }
> 
> ## quartz()
> ## grid.raster(tile.motif(.grid45, 2, 3))
> 
> patternGrob <- function(x=unit(0.5, "npc"), y=unit(0.5, "npc"),
>                         width=unit(1, "npc"), height=unit(1, "npc"),
>                         motif=matrix("white"), AR=1,
>                         motif.width=unit(5, "mm"),
>                         motif.height=AR*motif.width,
>                         pattern.offset=c(0, 0), # unimplemented
>                         default.units="npc",
>                         clip=TRUE, # testing purposes
>                         gp=gpar(fill=NA), ...)
>   {
>     grob(x=x, y=y, width=width, height=height,
>          motif=motif, motif.width=motif.width,
>          motif.height=motif.height, clip=clip, gp=gp, ..., cl="pattern")
>   }
> 
> widthDetails.pattern <- function(x) x$width
> heightDetails.pattern <- function(x) x$height
> 
> drawDetails.pattern <- function(x, recording=TRUE){
> 
> ##   calculate the number of tiles
>   nx <- ceiling(convertUnit(x$width, "in", value=TRUE) /
>                 convertUnit(x$motif.width, "in", value=TRUE)) + 1
>   ny <- ceiling(convertUnit(x$height, "in", axisFrom = "y", value=TRUE) /
>                 convertUnit(x$motif.height, "in", axisFrom = "y",
> value=TRUE)) + 1
> 
>   width <- convertUnit(x$width, "in")
>   height <- convertUnit(x$height, "in", axisFrom = "y")
> 
> ##   clip the raster
>   pushViewport(viewport(x=x$x, y=x$y,
>           width=x$width, height=x$height, clip=x$clip))
> 
>   grid.raster(tile.motif(x$motif, nx, ny), width=nx*x$motif.width,
>                          height=ny*x$motif.height)
>   upViewport()
> 
> ##   overlay the rectangle
>   grid.rect(x=x$x, y=x$y,
>           width=x$width, height=x$height,
>           just="center", gp=x$gp)
> }
> 
> 
> g <- patternGrob(x=0.7, width=unit(0.3, "npc"),
>                   height=unit(5.2, "cm"),
>                   clip=TRUE, motif=.grid45)
> 
> ## interactive use: OK
> quartz()
> grid.newpage()
> grid.draw(g)
> 
> ## png: OK
> png(file="pngClip.png")
> grid.newpage()
> grid.draw(g)
> dev.off()
> 
> ## pdf: clipping does not occur
> pdf(file="pdfClip.pdf")
> grid.newpage()
> grid.draw(g)
> dev.off()
> 
> ## quartz pdf: OK, but see below
> quartz(file="quartzClip.pdf", type="pdf")
> grid.newpage()
> grid.draw(g)
> dev.off()
> 
> g1 <- patternGrob(x=0.2, width=unit(0.2, "npc"),
>                   height=unit(5.2, "cm"),
>                   clip=TRUE, motif=.grid45)
> 
> g2 <- patternGrob(x=0.4, width=unit(0.2, "npc"),
>                   height=unit(5.2, "cm"),
>                   clip=TRUE, motif=.grid45)
> 
> g3 <- patternGrob(x=0.6, width=unit(0.2, "npc"),
>                   height=unit(5.2, "cm"),
>                   clip=TRUE, motif=.grid45)
> 
> g4 <- patternGrob(x=0.8, width=unit(0.2, "npc"),
>                   height=unit(5.2, "cm"),
>                   clip=TRUE, motif=.grid45)
> 
> quartz(file="quartzClip2.pdf", type="pdf")
> grid.newpage()
> grid.draw(g1)
> grid.draw(g2)
> grid.draw(g3)
> grid.draw(g4)
> dev.off()
> 
>  *** caught segfault ***
> address 0x15dda018, cause 'memory not mapped'
> 
> Traceback:
>  1: dev.off()
> 
>  sessionInfo()
> R version 2.11.0 Under development (unstable) (2009-11-30 r50622)
> i386-apple-darwin9.8.0
> 
> locale:
> [1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8
> 
> attached base packages:
> [1] grid      stats     graphics  grDevices utils     datasets  methods
> [8] base
> 
> 
> 
> 2009/12/2 Paul Murrell <p.murrell at auckland.ac.nz>:
>> Hi
>>
>>
>> baptiste auguie wrote:
>>> Very nice, thank you for this great addition to R graphics! I can't
>>> wait to see lattice and ggplot2 functions that use rasterGrob to
>>> display images. The pdf output is so much better in every way!
>>>
>>> Incidentally, I ran into a segfault with grid.cap on the quartz
>>> device, but maybe it's normal at this stage.
>>
>> This may be due to the fact that I tested the changes on Mac OS X 10.6
>> (looks like you have 10.5 ?), plus the fact that I am feeling my way a bit
>> on the Mac.  I have access to a 10.4 machine so I will try to take a look
>> there.  Thanks for the report.
>>
>> Paul
>>
>>
>>> This works fine:
>>>
>>> library(grid)
>>> x11()
>>> grid.text("test")
>>> cap <- grid.cap()
>>>
>>> This doesn't:
>>>
>>> library(grid)
>>> quartz()
>>> grid.text("test")
>>> cap <- grid.cap()
>>>
>>>  *** caught segfault ***
>>> address 0x18330001, cause 'memory not mapped'
>>>
>>> Traceback:
>>>  1: .Call(fnname, ..., PACKAGE = "grid")
>>>  2: grid.Call("L_cap")
>>>  3: grid.cap()
>>>
>>> Possible actions:
>>> 1: abort (with core dump, if enabled)
>>> 2: normal R exit
>>> 3: exit R without saving workspace
>>> 4: exit R saving workspace
>>>
>>> [R.app GUI 1.30 (5527) i386-apple-darwin9.8.0]
>>>
>>>> sessionInfo()
>>> R version 2.11.0 Under development (unstable) (2009-11-30 r50622)
>>> i386-apple-darwin9.8.0
>>>
>>> locale:
>>> [1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>
>>> Best regards,
>>>
>>> baptiste
>>>
>>> 2009/12/1 Paul Murrell <p.murrell at auckland.ac.nz>:
>>>> Hi
>>>>
>>>> This is for developers of extension packages that provide extra *graphics
>>>> devices* for R.
>>>>
>>>> In the *development* version of R, support has been added to the graphics
>>>> engine for sending raster images (bitmaps) to a graphics device.  This
>>>> consists mainly of two new device functions:  dev_Raster() and dev_Cap().
>>>>
>>>> The R_GE_version constant (in GraphicsEngine.h) has been bumped up to 6
>>>> as a
>>>> marker of this change.
>>>>
>>>> This means that, at a minimum, all graphics devices should be updated to
>>>> provide dummy implementations of these new functions that just say the
>>>> feature is not yet implemented (see for example the PicTeX and XFig
>>>> devices
>>>> in the 'grDevices' package).
>>>>
>>>> A full implementation of dev_Raster() should be able to draw a raster
>>>> image
>>>> (provided as an array of 32-bit R colors) at any size, possibly
>>>> (bilinear)
>>>> interpolated (otherwise nearest-neighbour), at any orientation, and with
>>>> a
>>>> per-pixel alpha channel.  Where these are not natively supported by a
>>>> device, the graphics engine provides some routines for scaling and
>>>> rotating
>>>> raster images (see for example the X11 device).  The dev_Cap() function
>>>> should return a representation of a raster image captured from the
>>>> current
>>>> device.  This will only make sense for some devices (see for example the
>>>> Cairo device in the 'grDevices' package).
>>>>
>>>> A little more information and a couple of small examples are provided at
>>>> http://developer.r-project.org/Raster/raster-RFC.html
>>>>
>>>> Paul
>>>> --
>>>> Dr Paul Murrell
>>>> Department of Statistics
>>>> The University of Auckland
>>>> Private Bag 92019
>>>> Auckland
>>>> New Zealand
>>>> 64 9 3737599 x85392
>>>> paul at stat.auckland.ac.nz
>>>> http://www.stat.auckland.ac.nz/~paul/
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>> --
>> Dr Paul Murrell
>> Department of Statistics
>> The University of Auckland
>> Private Bag 92019
>> Auckland
>> New Zealand
>> 64 9 3737599 x85392
>> paul at stat.auckland.ac.nz
>> http://www.stat.auckland.ac.nz/~paul/
>>

-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From p.murrell at auckland.ac.nz  Sun Dec  6 21:35:49 2009
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Mon, 07 Dec 2009 09:35:49 +1300
Subject: [Rd] raster support in graphics devices
In-Reply-To: <de4e29f50912051205u53dc2269w35a99d65a57b4d74@mail.gmail.com>
References: <4B146EC6.2000502@auckland.ac.nz>
	<de4e29f50912051205u53dc2269w35a99d65a57b4d74@mail.gmail.com>
Message-ID: <4B1C15A5.2060602@auckland.ac.nz>

Hi


baptiste auguie wrote:
> Dear all,
> 
> It seems to me that grid.raster is a special case of grid.rect as far
> as the intended visual output is concerned. The example below
> illustrates how both can be used to produce an image of the volcano
> data,


I disagree.  A "rect" grob is a vector object and a "raster" grob is a 
raster object and I think they should be kept distinct.  You could 
possibly create a higher-level "image" object that is agnostic with 
respect to how it is implemented and have both "rect"-based and 
"raster"-based versions of that, but "rect" and "raster" are graphical 
primitives and at that level I think the distinction is useful.

Paul


> d <- volcano
> 
> cols <- grey(t(d)/max(c(d)))
> xy <- expand.grid(x=seq(0, 1, length=ncol(d)), y=seq(0, 1, length=nrow(d)))
> 
> pdf("comparison.pdf", width=10, height=10/2*ncol(d)/nrow(d))
> pushViewport(viewport(layout=grid.layout(1, 2)))
> 
> pushViewport(viewport(layout.pos.r=1, layout.pos.c=1))
> grid.rect(xy$y, rev(xy$x), 1/(nrow(d)), 1/(ncol(d)),  gp=gpar(col=NA,
> fill=cols))
> grid.text("grid.rect")
> upViewport()
> 
> pushViewport(viewport(layout.pos.r=1, layout.pos.c=2))
> cols.mat <- matrix(cols, ncol=ncol(d), byrow=T)
> grid.raster(t(cols.mat))
> grid.text("grid.raster")
> dev.off()
> 
> Of course grid.raster provides a much better output in terms of file
> size, speed, visualisation artifacts, and interpolation. My question
> though: is it necessary to have a distinct grob for raster output?
> Couldn't "raster" be an option in grid.rect when the width and height
> are constant?
> 
> Alternatively, it might be useful to provide a function that converts
> a rectGrob into a rasterGrob,
> 
> rect2raster <- function(g){
> 
>   with(g,
>        rasterGrob(matrix(gp$fill, ncol=length(unique(x))), mean(x),mean(y)))
> }
> 
> This way, much of the existing code relying on grid.rect (e.g in
> lattice or ggplot2) could easily be adapted to work with grid.raster
> in favorable cases.
> 
> Best regards,
> 
> baptiste
> 
> 
> 
> 2009/12/1 Paul Murrell <p.murrell at auckland.ac.nz>:
>> Hi
>>
>> This is for developers of extension packages that provide extra *graphics
>> devices* for R.
>>
>> In the *development* version of R, support has been added to the graphics
>> engine for sending raster images (bitmaps) to a graphics device.  This
>> consists mainly of two new device functions:  dev_Raster() and dev_Cap().
>>
>> The R_GE_version constant (in GraphicsEngine.h) has been bumped up to 6 as a
>> marker of this change.
>>
>> This means that, at a minimum, all graphics devices should be updated to
>> provide dummy implementations of these new functions that just say the
>> feature is not yet implemented (see for example the PicTeX and XFig devices
>> in the 'grDevices' package).
>>
>> A full implementation of dev_Raster() should be able to draw a raster image
>> (provided as an array of 32-bit R colors) at any size, possibly (bilinear)
>> interpolated (otherwise nearest-neighbour), at any orientation, and with a
>> per-pixel alpha channel.  Where these are not natively supported by a
>> device, the graphics engine provides some routines for scaling and rotating
>> raster images (see for example the X11 device).  The dev_Cap() function
>> should return a representation of a raster image captured from the current
>> device.  This will only make sense for some devices (see for example the
>> Cairo device in the 'grDevices' package).
>>
>> A little more information and a couple of small examples are provided at
>> http://developer.r-project.org/Raster/raster-RFC.html
>>
>> Paul
>> --
>> Dr Paul Murrell
>> Department of Statistics
>> The University of Auckland
>> Private Bag 92019
>> Auckland
>> New Zealand
>> 64 9 3737599 x85392
>> paul at stat.auckland.ac.nz
>> http://www.stat.auckland.ac.nz/~paul/
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>

-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From baptiste.auguie at googlemail.com  Sun Dec  6 21:52:42 2009
From: baptiste.auguie at googlemail.com (baptiste auguie)
Date: Sun, 6 Dec 2009 21:52:42 +0100
Subject: [Rd] raster support in graphics devices
In-Reply-To: <4B1C15A5.2060602@auckland.ac.nz>
References: <4B146EC6.2000502@auckland.ac.nz>
	<de4e29f50912051205u53dc2269w35a99d65a57b4d74@mail.gmail.com>
	<4B1C15A5.2060602@auckland.ac.nz>
Message-ID: <de4e29f50912061252h68ed3cd9rad4e7951b24a918e@mail.gmail.com>

Hi,

2009/12/6 Paul Murrell <p.murrell at auckland.ac.nz>:
> Hi
>
>
> baptiste auguie wrote:
>>
>> Dear all,
>>
>> It seems to me that grid.raster is a special case of grid.rect as far
>> as the intended visual output is concerned. The example below
>> illustrates how both can be used to produce an image of the volcano
>> data,
>
>
> I disagree. ?A "rect" grob is a vector object and a "raster" grob is a
> raster object and I think they should be kept distinct. ?You could possibly
> create a higher-level "image" object that is agnostic with respect to how it
> is implemented and have both "rect"-based and "raster"-based versions of
> that, but "rect" and "raster" are graphical primitives and at that level I
> think the distinction is useful.

Fair point. I raised this question when trying to convert some ggplot2
code from grid.rect to grid.raster (for large images) and I came to
the conclusions that a) it wasn't completely trivial (for me anyway);
b) such conversion would probably be done over and over in the next
few months by several different people.

Your suggestion of a higher-level grob is interesting, and probably
more elegant than a function that converts one grob to the other as I
first envisaged.

Thanks,

baptiste




>
> Paul
>
>
>> d <- volcano
>>
>> cols <- grey(t(d)/max(c(d)))
>> xy <- expand.grid(x=seq(0, 1, length=ncol(d)), y=seq(0, 1,
>> length=nrow(d)))
>>
>> pdf("comparison.pdf", width=10, height=10/2*ncol(d)/nrow(d))
>> pushViewport(viewport(layout=grid.layout(1, 2)))
>>
>> pushViewport(viewport(layout.pos.r=1, layout.pos.c=1))
>> grid.rect(xy$y, rev(xy$x), 1/(nrow(d)), 1/(ncol(d)), ?gp=gpar(col=NA,
>> fill=cols))
>> grid.text("grid.rect")
>> upViewport()
>>
>> pushViewport(viewport(layout.pos.r=1, layout.pos.c=2))
>> cols.mat <- matrix(cols, ncol=ncol(d), byrow=T)
>> grid.raster(t(cols.mat))
>> grid.text("grid.raster")
>> dev.off()
>>
>> Of course grid.raster provides a much better output in terms of file
>> size, speed, visualisation artifacts, and interpolation. My question
>> though: is it necessary to have a distinct grob for raster output?
>> Couldn't "raster" be an option in grid.rect when the width and height
>> are constant?
>>
>> Alternatively, it might be useful to provide a function that converts
>> a rectGrob into a rasterGrob,
>>
>> rect2raster <- function(g){
>>
>> ?with(g,
>> ? ? ? rasterGrob(matrix(gp$fill, ncol=length(unique(x))),
>> mean(x),mean(y)))
>> }
>>
>> This way, much of the existing code relying on grid.rect (e.g in
>> lattice or ggplot2) could easily be adapted to work with grid.raster
>> in favorable cases.
>>
>> Best regards,
>>
>> baptiste
>>
>>
>>
>> 2009/12/1 Paul Murrell <p.murrell at auckland.ac.nz>:
>>>
>>> Hi
>>>
>>> This is for developers of extension packages that provide extra *graphics
>>> devices* for R.
>>>
>>> In the *development* version of R, support has been added to the graphics
>>> engine for sending raster images (bitmaps) to a graphics device. ?This
>>> consists mainly of two new device functions: ?dev_Raster() and dev_Cap().
>>>
>>> The R_GE_version constant (in GraphicsEngine.h) has been bumped up to 6
>>> as a
>>> marker of this change.
>>>
>>> This means that, at a minimum, all graphics devices should be updated to
>>> provide dummy implementations of these new functions that just say the
>>> feature is not yet implemented (see for example the PicTeX and XFig
>>> devices
>>> in the 'grDevices' package).
>>>
>>> A full implementation of dev_Raster() should be able to draw a raster
>>> image
>>> (provided as an array of 32-bit R colors) at any size, possibly
>>> (bilinear)
>>> interpolated (otherwise nearest-neighbour), at any orientation, and with
>>> a
>>> per-pixel alpha channel. ?Where these are not natively supported by a
>>> device, the graphics engine provides some routines for scaling and
>>> rotating
>>> raster images (see for example the X11 device). ?The dev_Cap() function
>>> should return a representation of a raster image captured from the
>>> current
>>> device. ?This will only make sense for some devices (see for example the
>>> Cairo device in the 'grDevices' package).
>>>
>>> A little more information and a couple of small examples are provided at
>>> http://developer.r-project.org/Raster/raster-RFC.html
>>>
>>> Paul
>>> --
>>> Dr Paul Murrell
>>> Department of Statistics
>>> The University of Auckland
>>> Private Bag 92019
>>> Auckland
>>> New Zealand
>>> 64 9 3737599 x85392
>>> paul at stat.auckland.ac.nz
>>> http://www.stat.auckland.ac.nz/~paul/
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>
> --
> Dr Paul Murrell
> Department of Statistics
> The University of Auckland
> Private Bag 92019
> Auckland
> New Zealand
> 64 9 3737599 x85392
> paul at stat.auckland.ac.nz
> http://www.stat.auckland.ac.nz/~paul/
>


From baptiste.auguie at googlemail.com  Sun Dec  6 21:59:12 2009
From: baptiste.auguie at googlemail.com (baptiste auguie)
Date: Sun, 6 Dec 2009 21:59:12 +0100
Subject: [Rd] raster support in graphics devices
In-Reply-To: <4B1C138C.5080204@auckland.ac.nz>
References: <4B146EC6.2000502@auckland.ac.nz>
	<de4e29f50912011038v33c3503dmb732dbd0d8ffd456@mail.gmail.com>
	<4B15A5C0.4060400@auckland.ac.nz>
	<de4e29f50912031310j598729f3g9a188d6a270cb91c@mail.gmail.com>
	<4B1C138C.5080204@auckland.ac.nz>
Message-ID: <de4e29f50912061259y283eb4abp14bb3f1637d6113@mail.gmail.com>

Hi,

Thanks for the fix. I hope the quartz bugs are not related to a bad
configuration on my side (I don't have access to another Mac to test
it).

I was quite happy with this proof-of-concept of filling patterns for
rectangles, and I was wondering if perhaps you had considered adding a
similar tiling option to grid.raster (at the C level)?

Best regards,

baptiste

2009/12/6 Paul Murrell <p.murrell at auckland.ac.nz>:
> Hi
>
>
> baptiste auguie wrote:
>>
>> Hi again,
>>
>> I found two possible bugs related to grid.raster, one with the quartz
>> device and the other with pdf.
>>
>> In my example I was playing with the idea of using grid.raster to
>> create a filling pattern for rectangles. The pdf output does not seem
>> to respect the clipping (it may have nothing to do with grid.raster
>> though), whilst the quartz device with pdf file output often crashes
>> for more than 4 different raster objects (but not always). I'm afraid
>> I couldn't pinpoint the exact circumstance of the crash with a more
>> concise example.
>
>
> Thanks again for the report.
>
> I have committed a fix for the PDF clipping.
>
> Still looking at the Quartz crashes.
>
> Paul
>
>
>> Thanks in advance for any insights,
>>
>> baptiste
>>
>> ### Start example ###
>>
>> library(grid)
>>
>> ## create a motif
>> grid45 <- function(..., width=0.5, height=0.5){
>> ?x11(width=width, height=height)
>> ?grid.polygon(...)
>> ?m <- grid.cap()
>> ?dev.off()
>> ?invisible(m)
>> }
>>
>> .grid45 <- grid45()
>> ## grid.raster(.grid45)
>>
>> tile.motif <- function(m, nx=10, ny=nx){
>> ?cols <- matrix(rep(m, nx), ncol=ncol(m)*nx, byrow=F)
>> ?matrix(rep(t(cols), ny), nrow=nrow(cols)*ny, byrow=T)
>> }
>>
>> ## quartz()
>> ## grid.raster(tile.motif(.grid45, 2, 3))
>>
>> patternGrob <- function(x=unit(0.5, "npc"), y=unit(0.5, "npc"),
>> ? ? ? ? ? ? ? ? ? ? ? ?width=unit(1, "npc"), height=unit(1, "npc"),
>> ? ? ? ? ? ? ? ? ? ? ? ?motif=matrix("white"), AR=1,
>> ? ? ? ? ? ? ? ? ? ? ? ?motif.width=unit(5, "mm"),
>> ? ? ? ? ? ? ? ? ? ? ? ?motif.height=AR*motif.width,
>> ? ? ? ? ? ? ? ? ? ? ? ?pattern.offset=c(0, 0), # unimplemented
>> ? ? ? ? ? ? ? ? ? ? ? ?default.units="npc",
>> ? ? ? ? ? ? ? ? ? ? ? ?clip=TRUE, # testing purposes
>> ? ? ? ? ? ? ? ? ? ? ? ?gp=gpar(fill=NA), ...)
>> ?{
>> ? ?grob(x=x, y=y, width=width, height=height,
>> ? ? ? ? motif=motif, motif.width=motif.width,
>> ? ? ? ? motif.height=motif.height, clip=clip, gp=gp, ..., cl="pattern")
>> ?}
>>
>> widthDetails.pattern <- function(x) x$width
>> heightDetails.pattern <- function(x) x$height
>>
>> drawDetails.pattern <- function(x, recording=TRUE){
>>
>> ## ? calculate the number of tiles
>> ?nx <- ceiling(convertUnit(x$width, "in", value=TRUE) /
>> ? ? ? ? ? ? ? ?convertUnit(x$motif.width, "in", value=TRUE)) + 1
>> ?ny <- ceiling(convertUnit(x$height, "in", axisFrom = "y", value=TRUE) /
>> ? ? ? ? ? ? ? ?convertUnit(x$motif.height, "in", axisFrom = "y",
>> value=TRUE)) + 1
>>
>> ?width <- convertUnit(x$width, "in")
>> ?height <- convertUnit(x$height, "in", axisFrom = "y")
>>
>> ## ? clip the raster
>> ?pushViewport(viewport(x=x$x, y=x$y,
>> ? ? ? ? ?width=x$width, height=x$height, clip=x$clip))
>>
>> ?grid.raster(tile.motif(x$motif, nx, ny), width=nx*x$motif.width,
>> ? ? ? ? ? ? ? ? ? ? ? ? height=ny*x$motif.height)
>> ?upViewport()
>>
>> ## ? overlay the rectangle
>> ?grid.rect(x=x$x, y=x$y,
>> ? ? ? ? ?width=x$width, height=x$height,
>> ? ? ? ? ?just="center", gp=x$gp)
>> }
>>
>>
>> g <- patternGrob(x=0.7, width=unit(0.3, "npc"),
>> ? ? ? ? ? ? ? ? ?height=unit(5.2, "cm"),
>> ? ? ? ? ? ? ? ? ?clip=TRUE, motif=.grid45)
>>
>> ## interactive use: OK
>> quartz()
>> grid.newpage()
>> grid.draw(g)
>>
>> ## png: OK
>> png(file="pngClip.png")
>> grid.newpage()
>> grid.draw(g)
>> dev.off()
>>
>> ## pdf: clipping does not occur
>> pdf(file="pdfClip.pdf")
>> grid.newpage()
>> grid.draw(g)
>> dev.off()
>>
>> ## quartz pdf: OK, but see below
>> quartz(file="quartzClip.pdf", type="pdf")
>> grid.newpage()
>> grid.draw(g)
>> dev.off()
>>
>> g1 <- patternGrob(x=0.2, width=unit(0.2, "npc"),
>> ? ? ? ? ? ? ? ? ?height=unit(5.2, "cm"),
>> ? ? ? ? ? ? ? ? ?clip=TRUE, motif=.grid45)
>>
>> g2 <- patternGrob(x=0.4, width=unit(0.2, "npc"),
>> ? ? ? ? ? ? ? ? ?height=unit(5.2, "cm"),
>> ? ? ? ? ? ? ? ? ?clip=TRUE, motif=.grid45)
>>
>> g3 <- patternGrob(x=0.6, width=unit(0.2, "npc"),
>> ? ? ? ? ? ? ? ? ?height=unit(5.2, "cm"),
>> ? ? ? ? ? ? ? ? ?clip=TRUE, motif=.grid45)
>>
>> g4 <- patternGrob(x=0.8, width=unit(0.2, "npc"),
>> ? ? ? ? ? ? ? ? ?height=unit(5.2, "cm"),
>> ? ? ? ? ? ? ? ? ?clip=TRUE, motif=.grid45)
>>
>> quartz(file="quartzClip2.pdf", type="pdf")
>> grid.newpage()
>> grid.draw(g1)
>> grid.draw(g2)
>> grid.draw(g3)
>> grid.draw(g4)
>> dev.off()
>>
>> ?*** caught segfault ***
>> address 0x15dda018, cause 'memory not mapped'
>>
>> Traceback:
>> ?1: dev.off()
>>
>> ?sessionInfo()
>> R version 2.11.0 Under development (unstable) (2009-11-30 r50622)
>> i386-apple-darwin9.8.0
>>
>> locale:
>> [1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8
>>
>> attached base packages:
>> [1] grid ? ? ?stats ? ? graphics ?grDevices utils ? ? datasets ?methods
>> [8] base
>>
>>
>>
>> 2009/12/2 Paul Murrell <p.murrell at auckland.ac.nz>:
>>>
>>> Hi
>>>
>>>
>>> baptiste auguie wrote:
>>>>
>>>> Very nice, thank you for this great addition to R graphics! I can't
>>>> wait to see lattice and ggplot2 functions that use rasterGrob to
>>>> display images. The pdf output is so much better in every way!
>>>>
>>>> Incidentally, I ran into a segfault with grid.cap on the quartz
>>>> device, but maybe it's normal at this stage.
>>>
>>> This may be due to the fact that I tested the changes on Mac OS X 10.6
>>> (looks like you have 10.5 ?), plus the fact that I am feeling my way a
>>> bit
>>> on the Mac. ?I have access to a 10.4 machine so I will try to take a look
>>> there. ?Thanks for the report.
>>>
>>> Paul
>>>
>>>
>>>> This works fine:
>>>>
>>>> library(grid)
>>>> x11()
>>>> grid.text("test")
>>>> cap <- grid.cap()
>>>>
>>>> This doesn't:
>>>>
>>>> library(grid)
>>>> quartz()
>>>> grid.text("test")
>>>> cap <- grid.cap()
>>>>
>>>> ?*** caught segfault ***
>>>> address 0x18330001, cause 'memory not mapped'
>>>>
>>>> Traceback:
>>>> ?1: .Call(fnname, ..., PACKAGE = "grid")
>>>> ?2: grid.Call("L_cap")
>>>> ?3: grid.cap()
>>>>
>>>> Possible actions:
>>>> 1: abort (with core dump, if enabled)
>>>> 2: normal R exit
>>>> 3: exit R without saving workspace
>>>> 4: exit R saving workspace
>>>>
>>>> [R.app GUI 1.30 (5527) i386-apple-darwin9.8.0]
>>>>
>>>>> sessionInfo()
>>>>
>>>> R version 2.11.0 Under development (unstable) (2009-11-30 r50622)
>>>> i386-apple-darwin9.8.0
>>>>
>>>> locale:
>>>> [1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8
>>>>
>>>> attached base packages:
>>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>>
>>>> Best regards,
>>>>
>>>> baptiste
>>>>
>>>> 2009/12/1 Paul Murrell <p.murrell at auckland.ac.nz>:
>>>>>
>>>>> Hi
>>>>>
>>>>> This is for developers of extension packages that provide extra
>>>>> *graphics
>>>>> devices* for R.
>>>>>
>>>>> In the *development* version of R, support has been added to the
>>>>> graphics
>>>>> engine for sending raster images (bitmaps) to a graphics device. ?This
>>>>> consists mainly of two new device functions: ?dev_Raster() and
>>>>> dev_Cap().
>>>>>
>>>>> The R_GE_version constant (in GraphicsEngine.h) has been bumped up to 6
>>>>> as a
>>>>> marker of this change.
>>>>>
>>>>> This means that, at a minimum, all graphics devices should be updated
>>>>> to
>>>>> provide dummy implementations of these new functions that just say the
>>>>> feature is not yet implemented (see for example the PicTeX and XFig
>>>>> devices
>>>>> in the 'grDevices' package).
>>>>>
>>>>> A full implementation of dev_Raster() should be able to draw a raster
>>>>> image
>>>>> (provided as an array of 32-bit R colors) at any size, possibly
>>>>> (bilinear)
>>>>> interpolated (otherwise nearest-neighbour), at any orientation, and
>>>>> with
>>>>> a
>>>>> per-pixel alpha channel. ?Where these are not natively supported by a
>>>>> device, the graphics engine provides some routines for scaling and
>>>>> rotating
>>>>> raster images (see for example the X11 device). ?The dev_Cap() function
>>>>> should return a representation of a raster image captured from the
>>>>> current
>>>>> device. ?This will only make sense for some devices (see for example
>>>>> the
>>>>> Cairo device in the 'grDevices' package).
>>>>>
>>>>> A little more information and a couple of small examples are provided
>>>>> at
>>>>> http://developer.r-project.org/Raster/raster-RFC.html
>>>>>
>>>>> Paul
>>>>> --
>>>>> Dr Paul Murrell
>>>>> Department of Statistics
>>>>> The University of Auckland
>>>>> Private Bag 92019
>>>>> Auckland
>>>>> New Zealand
>>>>> 64 9 3737599 x85392
>>>>> paul at stat.auckland.ac.nz
>>>>> http://www.stat.auckland.ac.nz/~paul/
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>> --
>>> Dr Paul Murrell
>>> Department of Statistics
>>> The University of Auckland
>>> Private Bag 92019
>>> Auckland
>>> New Zealand
>>> 64 9 3737599 x85392
>>> paul at stat.auckland.ac.nz
>>> http://www.stat.auckland.ac.nz/~paul/
>>>
>
> --
> Dr Paul Murrell
> Department of Statistics
> The University of Auckland
> Private Bag 92019
> Auckland
> New Zealand
> 64 9 3737599 x85392
> paul at stat.auckland.ac.nz
> http://www.stat.auckland.ac.nz/~paul/
>


From landronimirc at gmail.com  Mon Dec  7 08:58:23 2009
From: landronimirc at gmail.com (Liviu Andronic)
Date: Mon, 7 Dec 2009 07:58:23 +0000
Subject: [Rd] options(width=100) ignored on start-up: bug or feature?
Message-ID: <68b1e2610912062358i219d1b9drbbd5c496a073fb10@mail.gmail.com>

Dear developers
I've tried this a couple of days ago on r-help, unfortunately with no
feedback. Could you please take a look and confirm whether it's a bug,
feature, or bad eye-sight when reading Help:

 Is it normal that R ignores options("width"=100) at start-up? Although
 liviu at debian-liv:~$ cat /usr/lib/R/etc/Rprofile.site | grep width
 options(width = 100)

 , R will start with
 [Previously saved workspace restored]

 > options()$width
 [1] 80

 Am I doing something wrong?
 Liviu


 > sessionInfo()
 R version 2.10.0 (2009-10-26)
 x86_64-pc-linux-gnu

 locale:
  [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8
  [5] LC_MONETARY=C              LC_MESSAGES=en_GB.UTF-8
  [7] LC_PAPER=en_GB.UTF-8       LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
 [11] LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C

 attached base packages:
  [1] datasets  grid      splines   graphics  stats     utils     grDevices
  [8] tcltk     methods   base

 other attached packages:
  [1] fortunes_1.3-6           RcmdrPlugin.HH_1.1-25    HH_2.1-32
  [4] leaps_2.9                multcomp_1.1-2           mvtnorm_0.9-8
  [7] lattice_0.17-26          RcmdrPlugin.sos_0.1-0    RcmdrPlugin.Export_0.3-0
 [10] Hmisc_3.7-0              survival_2.35-7          xtable_1.5-6
 [13] Rcmdr_1.5-4              car_1.2-16               relimp_1.0-1
 [16] sos_1.1-7                brew_1.0-3               hints_1.0.1-1

 loaded via a namespace (and not attached):
 [1] cluster_1.12.1


From g.russell at eos-solutions.com  Mon Dec  7 12:15:11 2009
From: g.russell at eos-solutions.com (g.russell at eos-solutions.com)
Date: Mon,  7 Dec 2009 12:15:11 +0100 (CET)
Subject: [Rd] Crash with Unicode and sub (PR#14114)
Message-ID: <20091207111511.90985283031F@mail.pubhealth.ku.dk>

Full_Name: George Russell
Version: 2.10.0
OS: Windows XP Version 2002 SP 2
Submission from: (NULL) (217.111.3.131)


The following typed into R --vanilla induces a crash:
-- cut here --
gctorture()
u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
v <- rep(u,1e2)
v <- sub(" ","",v)
v %in% ""
-- cut here --

sessionInfo() says:

-- cut here --
R version 2.10.0 (2009-10-26) 
i386-pc-mingw32 

locale:
[1] LC_COLLATE=German_Germany.1252  LC_CTYPE=German_Germany.1252   
[3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C                   
[5] LC_TIME=German_Germany.1252    

attached base packages:
[1] stats     graphics  grDevices datasets  utils     methods   base
-- cut here --

I apologise for not testing this with R-2.10.1 but as far as I can see there are
only source releases available so far, which I am not able to compile.

Best wishes and thanks,

George Russell


From landronimirc at gmail.com  Mon Dec  7 14:37:18 2009
From: landronimirc at gmail.com (Liviu Andronic)
Date: Mon, 7 Dec 2009 13:37:18 +0000
Subject: [Rd] options(width=100) ignored on start-up: bug or feature?
In-Reply-To: <68b1e2610912062358i219d1b9drbbd5c496a073fb10@mail.gmail.com>
References: <68b1e2610912062358i219d1b9drbbd5c496a073fb10@mail.gmail.com>
Message-ID: <68b1e2610912070537g2f7ba2b0sc01ad59971d1e3e9@mail.gmail.com>

On 12/7/09, Liviu Andronic <landronimirc at gmail.com> wrote:
>   Is it normal that R ignores options("width"=100) at start-up? Although
>   liviu at debian-liv:~$ cat /usr/lib/R/etc/Rprofile.site | grep width
>   options(width = 100)
>
Found the issues. In the config, Rcmdr was starting after the
options() call. Setting them in the following order
library(Rcmdr)
options(width = 100)

solved the issue.

Liviu


From jeszenszky.peter at inf.unideb.hu  Mon Dec  7 22:12:43 2009
From: jeszenszky.peter at inf.unideb.hu (Jeszenszky Peter)
Date: Mon, 7 Dec 2009 22:12:43 +0100
Subject: [Rd] =?iso-8859-1?q?V=E1lasz=3A_Re=3A_tm_and_e1071_question?=
In-Reply-To: <20091205094339.GA25171@gamma.logic.tuwien.ac.at>
References: <alpine.DEB.2.00.0912041421260.28183@paninaro.stat-math.wu-wien.ac.at>,
	<20091205094339.GA25171@gamma.logic.tuwien.ac.at>
Message-ID: <OF8C9CE0F3.A2EBC366-ONC1257685.00748576-C1257685.00748579@inf.unideb.hu>

Hello,

Thank you for your reply. The suggested conversion trick with a slight
modification does the job.

I hope, the svm function of the e1071 package will support slam sparse
matrices directly. I think that this would be quite a reasonable feature.

Furthermore, there are developers who participate in the development of
both the slam and the e1071 packages.

Best regards,

Peter Jeszenszky

-----Ingo Feinerer <feinerer at logic.at> ezt ?rta: -----

C?mzett: r-devel at r-project.org
Felad?: Ingo Feinerer <feinerer at logic.at>
D?tum: 2009/12/05 10:43de.
M?solat: Jeszenszky Peter <jeszenszky.peter at inf.unideb.hu>
T?rgy: Re: tm and e1071 question

On Fri, Dec 04, 2009 at 02:21:52PM +0100, Achim Zeileis wrote:
> I would like to use the svm function of the e1071 package for text
> classification tasks. Preprocessing can be carried out by using the
> excellent tm text mining package.

:-)

> TermDocumentMatrix and DocumentTermMatrix objects of the package tm
> are currently implemented based on the sparse matrix data structures
> provided by the slam package.
>
> Unfortunately, the svm function of the e1071 package accepts only sparse
> matrices of class Matrix provided by the Matrix package, or of class
> matrix.csr as provided by the package SparseM.
>
> In order to train an SVM with a DocumentTermMatrix object the latter
> must be converted to a matrix.csr sparse matrix structure. However, none
> of the publicly available packages of CRAN provides such a conversion
> function. It is quite straightforward to write the conversion function,
> but it would be much confortable to pass slam sparse matrix objects
> directly to the svm function.

You are right. If you have small matrices as(as.matrix(m), "Matrix")
will work. Then there exists some (non published experimental) code in
the slam package for conversion to Matrix format (located in
slam/work/Matrix.R):

setAs("simple_triplet_matrix", "dgTMatrix",
      function(from) {
          new("dgTMatrix",
              i = as.integer(from$i - 1L),
              j = as.integer(from$j - 1L),
              x = from$v,
              Dim = c(from$nrow, from$ncol),
              Dimnames = from$dimnames)
      })

setAs("simple_triplet_matrix", "dgCMatrix",
      function(from) {
          ind <- order(from$j, from$i)
          new("dgCMatrix",
              i = from$i[ind] - 1L,
              p = c(0L, cumsum(tabulate(from$j[ind], from$ncol))),
              x = from$v[ind],
              Dim = c(from$nrow, from$ncol),
              Dimnames = from$dimnames)
      })

which allows then:

class(m) <- "simple_triplet_matrix"
as(m, "dgTMatrix")
as(m, "dgCMatrix")

> Do you plan to add slam sparse matrix support to the e1071 package?

I cannot answer this since I am neither directly involved in the e1071
nor in the slam package.

Best regards, Ingo Feinerer

--
Ingo Feinerer
Vienna University of Technology
http://www.dbai.tuwien.ac.at/staff/feinerer


From P.Dalgaard at biostat.ku.dk  Tue Dec  8 11:24:50 2009
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 08 Dec 2009 11:24:50 +0100
Subject: [Rd] Crash with Unicode and sub (PR#14114)
In-Reply-To: <20091207111511.90985283031F@mail.pubhealth.ku.dk>
References: <20091207111511.90985283031F@mail.pubhealth.ku.dk>
Message-ID: <4B1E2972.5010301@biostat.ku.dk>

g.russell at eos-solutions.com wrote:
> Full_Name: George Russell
> Version: 2.10.0
> OS: Windows XP Version 2002 SP 2
> Submission from: (NULL) (217.111.3.131)
> 
> 
> The following typed into R --vanilla induces a crash:
> -- cut here --
> gctorture()
> u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
> v <- rep(u,1e2)
> v <- sub(" ","",v)
> v %in% ""
> -- cut here --
> 
> sessionInfo() says:
> 
> -- cut here --
> R version 2.10.0 (2009-10-26) 
> i386-pc-mingw32 
> 
> locale:
> [1] LC_COLLATE=German_Germany.1252  LC_CTYPE=German_Germany.1252   
> [3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C                   
> [5] LC_TIME=German_Germany.1252    
> 
> attached base packages:
> [1] stats     graphics  grDevices datasets  utils     methods   base
> -- cut here --
> 
> I apologise for not testing this with R-2.10.1 but as far as I can see there are
> only source releases available so far, which I am not able to compile.
>

2.10.1 RC is available now. Please check. It does seem to be
reproducible in the Windows version, or at least it takes a very long
time, but that means running under Wine on SUSE for me. I don't see the
effect with the Linux build.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From maechler at stat.math.ethz.ch  Tue Dec  8 15:35:29 2009
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Tue,  8 Dec 2009 15:35:29 +0100 (CET)
Subject: [Rd] Crash with Unicode and sub (PR#14114)
Message-ID: <20091208143529.909C1282EF4E@mail.pubhealth.ku.dk>

>>>>> "PD" == Peter Dalgaard <P.Dalgaard at biostat.ku.dk>
>>>>>     on Tue, 08 Dec 2009 11:24:50 +0100 writes:

    PD> g.russell at eos-solutions.com wrote:
    >> Full_Name: George Russell
    >> Version: 2.10.0
    >> OS: Windows XP Version 2002 SP 2
    >> Submission from: (NULL) (217.111.3.131)
    >> 
    >> 
    >> The following typed into R --vanilla induces a crash:
    >> -- cut here --
    >> gctorture()
    >> u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
    >> v <- rep(u,1e2)
    >> v <- sub(" ","",v)
    >> v %in% ""
    >> -- cut here --
    >> 
    >> sessionInfo() says:
    >> 
    >> -- cut here --
    >> R version 2.10.0 (2009-10-26) 
    >> i386-pc-mingw32 
    >> 
    >> locale:
    >> [1] LC_COLLATE=German_Germany.1252  LC_CTYPE=German_Germany.1252   
    >> [3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C                   
    >> [5] LC_TIME=German_Germany.1252    
    >> 
    >> attached base packages:
    >> [1] stats     graphics  grDevices datasets  utils     methods   base
    >> -- cut here --
    >> 
    >> I apologise for not testing this with R-2.10.1 but as far as I can see there are
    >> only source releases available so far, which I am not able to compile.
    >> 

    PD> 2.10.1 RC is available now. Please check. 

I just did, on our
 "Windows Server 2003 R2 \\ Standard x64 edition" 

with 
   > sessionInfo()
   R version 2.10.1 RC (2009-12-06 r50684) 
   i386-pc-mingw32 

   locale:
   [1] LC_COLLATE=German_Switzerland.1252  LC_CTYPE=German_Switzerland.1252   
   [3] LC_MONETARY=German_Switzerland.1252 LC_NUMERIC=C                       
   [5] LC_TIME=German_Switzerland.1252    

   attached base packages:
   [1] stats     graphics  grDevices utils     datasets  methods   base     
   > 

It does "crash" i.e. you get a popup window about an exception
with a hex code.
And indeed, I don't see a problem in Linux.

Martin Maechler, ETH Zurich

    PD> It does seem to be
    PD> reproducible in the Windows version, or at least it takes a very long
    PD> time, but that means running under Wine on SUSE for me. I don't see the
    PD> effect with the Linux build.

    PD> -- 
    PD> O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
    PD> c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
    PD> (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
    PD> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907

    PD> ______________________________________________
    PD> R-devel at r-project.org mailing list
    PD> https://stat.ethz.ch/mailman/listinfo/r-devel


From ken.knoblauch at inserm.fr  Tue Dec  8 16:36:21 2009
From: ken.knoblauch at inserm.fr (Ken Knoblauch)
Date: Tue, 08 Dec 2009 16:36:21 +0100
Subject: [Rd] lower.tail option in pnorm
Message-ID: <20091208163621.f60fi66mhw0co44o@imp.inserm.fr>

Hi,

I would have thought that these two constructions would
produce the same result but they do not.

Resp <- rbinom(10, 1, 0.5)
Stim <- rep(0:1, 5)
mm <- model.matrix(~ Stim)
Xb <- mm %*% c(0, 1)
ifelse(Resp, log(pnorm(Xb)), log(1 - pnorm(Xb)))
pnorm(as.vector(Xb), lower.tail = Resp, log.p = TRUE)

> ifelse(Resp, log(pnorm(Xb)), log(1 - pnorm(Xb)))
  [1] -0.6931472 -1.8410216 -0.6931472 -0.1727538 -0.6931472
  [6] -0.1727538 -0.6931472 -1.8410216 -0.6931472 -1.8410216
> pnorm(as.vector(Xb), lower.tail = Resp, log.p = TRUE)
  [1] -0.6931472 -1.8410216 -0.6931472 -1.8410216 -0.6931472
  [6] -1.8410216 -0.6931472 -1.8410216 -0.6931472 -1.8410216

If I have missed something obvious, I would be grateful
to have it pointed out.

> sessionInfo()
R version 2.10.1 beta (2009-12-04 r50668)
i386-apple-darwin9.8.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods
[7] base

loaded via a namespace (and not attached):
[1] tools_2.10.1

Thanks for any enlightenment.

best,

Ken

-- 
Ken Knoblauch
Inserm U846
Stem-cell and Brain Research Institute
Department of Integrative Neurosciences
18 avenue du Doyen L?pine
69500 Bron
France
tel: +33 (0)4 72 91 34 77
fax: +33 (0)4 72 91 34 61
portable: +33 (0)6 84 10 64 10
http://www.sbri.fr/members/kenneth-knoblauch.html


From ripley at stats.ox.ac.uk  Tue Dec  8 17:20:26 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 8 Dec 2009 16:20:26 +0000 (GMT)
Subject: [Rd] lower.tail option in pnorm
In-Reply-To: <20091208163621.f60fi66mhw0co44o@imp.inserm.fr>
References: <20091208163621.f60fi66mhw0co44o@imp.inserm.fr>
Message-ID: <alpine.LFD.2.00.0912081617220.30643@gannet.stats.ox.ac.uk>

>From the help page:

      pnorm(q, mean = 0, sd = 1, lower.tail = TRUE, log.p = FALSE)

      x,q: vector of quantiles.

lower.tail: logical; if TRUE (default), probabilities are P[X <= x],
           otherwise, P[X > x].

Note that lower.tail is not said to be a vector, and the first value 
is taken (what it is is random in your example).


On Tue, 8 Dec 2009, Ken Knoblauch wrote:

> Hi,
>
> I would have thought that these two constructions would
> produce the same result but they do not.
>
> Resp <- rbinom(10, 1, 0.5)
> Stim <- rep(0:1, 5)
> mm <- model.matrix(~ Stim)
> Xb <- mm %*% c(0, 1)
> ifelse(Resp, log(pnorm(Xb)), log(1 - pnorm(Xb)))
> pnorm(as.vector(Xb), lower.tail = Resp, log.p = TRUE)
>
>> ifelse(Resp, log(pnorm(Xb)), log(1 - pnorm(Xb)))
> [1] -0.6931472 -1.8410216 -0.6931472 -0.1727538 -0.6931472
> [6] -0.1727538 -0.6931472 -1.8410216 -0.6931472 -1.8410216
>> pnorm(as.vector(Xb), lower.tail = Resp, log.p = TRUE)
> [1] -0.6931472 -1.8410216 -0.6931472 -1.8410216 -0.6931472
> [6] -1.8410216 -0.6931472 -1.8410216 -0.6931472 -1.8410216
>
> If I have missed something obvious, I would be grateful
> to have it pointed out.
>
>> sessionInfo()
> R version 2.10.1 beta (2009-12-04 r50668)
> i386-apple-darwin9.8.0
>
> locale:
> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods
> [7] base
>
> loaded via a namespace (and not attached):
> [1] tools_2.10.1
>
> Thanks for any enlightenment.
>
> best,
>
> Ken
>
> -- 
> Ken Knoblauch
> Inserm U846
> Stem-cell and Brain Research Institute
> Department of Integrative Neurosciences
> 18 avenue du Doyen L?pine
> 69500 Bron
> France
> tel: +33 (0)4 72 91 34 77
> fax: +33 (0)4 72 91 34 61
> portable: +33 (0)6 84 10 64 10
> http://www.sbri.fr/members/kenneth-knoblauch.html
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From bolker at ufl.edu  Tue Dec  8 17:23:50 2009
From: bolker at ufl.edu (Ben Bolker)
Date: Tue, 8 Dec 2009 16:23:50 +0000 (UTC)
Subject: [Rd] lower.tail option in pnorm
References: <20091208163621.f60fi66mhw0co44o@imp.inserm.fr>
Message-ID: <loom.20091208T171116-478@post.gmane.org>

Ken Knoblauch <ken.knoblauch <at> inserm.fr> writes:

> 
> Hi,
> 
> I would have thought that these two constructions would
> produce the same result but they do not.
> 
> Resp <- rbinom(10, 1, 0.5)
> Stim <- rep(0:1, 5)
> mm <- model.matrix(~ Stim)
> Xb <- mm %*% c(0, 1)
> ifelse(Resp, log(pnorm(Xb)), log(1 - pnorm(Xb)))
> pnorm(as.vector(Xb), lower.tail = Resp, log.p = TRUE)
> 

  [snip]

> If I have missed something obvious, I would be grateful
> to have it pointed out.
> 

 lower.tail is not vectorized.  All elements but the
first are ignored.  This seems fairly obvious to me
from reading ?pnorm (e.g. "mean" is described a
"vector of means", "sd" is described as "vector of
standard deviations", but lower.tail is described
as "logical", but 'obvious' is certainly in the eye
of the beholder.

You can do what you want with

mapply(pnorm,q=c(-1,1),lower.tail=c(0,1))
.


From ken.knoblauch at inserm.fr  Tue Dec  8 17:30:59 2009
From: ken.knoblauch at inserm.fr (Ken Knoblauch)
Date: Tue, 08 Dec 2009 17:30:59 +0100
Subject: [Rd] lower.tail option in pnorm
In-Reply-To: <alpine.LFD.2.00.0912081617220.30643@gannet.stats.ox.ac.uk>
References: <20091208163621.f60fi66mhw0co44o@imp.inserm.fr>
	<alpine.LFD.2.00.0912081617220.30643@gannet.stats.ox.ac.uk>
Message-ID: <20091208173059.wcrhx22isgsw0wkw@imp.inserm.fr>

Thank you.  That explains it.  I didn't read closely enough.

best,

Ken

Quoting Prof Brian Ripley <ripley at stats.ox.ac.uk>:

> From the help page:
>
>      pnorm(q, mean = 0, sd = 1, lower.tail = TRUE, log.p = FALSE)
>
>      x,q: vector of quantiles.
>
> lower.tail: logical; if TRUE (default), probabilities are P[X <= x],
>           otherwise, P[X > x].
>
> Note that lower.tail is not said to be a vector, and the first value is
> taken (what it is is random in your example).
>
>
> On Tue, 8 Dec 2009, Ken Knoblauch wrote:
>
>> Hi,
>>
>> I would have thought that these two constructions would
>> produce the same result but they do not.
>>
>> Resp <- rbinom(10, 1, 0.5)
>> Stim <- rep(0:1, 5)
>> mm <- model.matrix(~ Stim)
>> Xb <- mm %*% c(0, 1)
>> ifelse(Resp, log(pnorm(Xb)), log(1 - pnorm(Xb)))
>> pnorm(as.vector(Xb), lower.tail = Resp, log.p = TRUE)
>>
>>> ifelse(Resp, log(pnorm(Xb)), log(1 - pnorm(Xb)))
>> [1] -0.6931472 -1.8410216 -0.6931472 -0.1727538 -0.6931472
>> [6] -0.1727538 -0.6931472 -1.8410216 -0.6931472 -1.8410216
>>> pnorm(as.vector(Xb), lower.tail = Resp, log.p = TRUE)
>> [1] -0.6931472 -1.8410216 -0.6931472 -1.8410216 -0.6931472
>> [6] -1.8410216 -0.6931472 -1.8410216 -0.6931472 -1.8410216
>>
>> If I have missed something obvious, I would be grateful
>> to have it pointed out.
>>
>>> sessionInfo()
>> R version 2.10.1 beta (2009-12-04 r50668)
>> i386-apple-darwin9.8.0
>>
>> locale:
>> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods
>> [7] base
>>
>> loaded via a namespace (and not attached):
>> [1] tools_2.10.1
>>
>> Thanks for any enlightenment.
>>
>> best,
>>
>> Ken
>>
>> -- 
>> Ken Knoblauch
>> Inserm U846
>> Stem-cell and Brain Research Institute
>> Department of Integrative Neurosciences
>> 18 avenue du Doyen L?pine
>> 69500 Bron
>> France
>> tel: +33 (0)4 72 91 34 77
>> fax: +33 (0)4 72 91 34 61
>> portable: +33 (0)6 84 10 64 10
>> http://www.sbri.fr/members/kenneth-knoblauch.html
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595



-- 
Ken Knoblauch
Inserm U846
Stem-cell and Brain Research Institute
Department of Integrative Neurosciences
18 avenue du Doyen L?pine
69500 Bron
France
tel: +33 (0)4 72 91 34 77
fax: +33 (0)4 72 91 34 61
portable: +33 (0)6 84 10 64 10
http://www.sbri.fr/members/kenneth-knoblauch.html


From rvaradhan at jhmi.edu  Tue Dec  8 17:32:13 2009
From: rvaradhan at jhmi.edu (Ravi Varadhan)
Date: Tue, 08 Dec 2009 11:32:13 -0500
Subject: [Rd] lower.tail option in pnorm
In-Reply-To: <20091208163621.f60fi66mhw0co44o@imp.inserm.fr>
References: <20091208163621.f60fi66mhw0co44o@imp.inserm.fr>
Message-ID: <f68f8c70d141.4b1e393d@johnshopkins.edu>


They will not be the same.  The problem is that the `lower.tail' argument is not vectorized.  Therefore, it is always set equal to the first element of `Resp', which in your example is FALSE.

If you want to obtain same results, this will do the trick:

ans1 <- ifelse(Resp, log(pnorm(Xb)), log(1 - pnorm(Xb)))
ans2 <- apply(cbind(Xb, Resp), 1, function(x) pnorm(x[1], lower.tail=x[2], log.p=TRUE))

all.equal(ans1, as.numeric(ans2))


Ravi.

____________________________________________________________________

Ravi Varadhan, Ph.D.
Assistant Professor,
Division of Geriatric Medicine and Gerontology
School of Medicine
Johns Hopkins University

Ph. (410) 502-2619
email: rvaradhan at jhmi.edu


----- Original Message -----
From: Ken Knoblauch <ken.knoblauch at inserm.fr>
Date: Tuesday, December 8, 2009 10:37 am
Subject: [Rd] lower.tail option in pnorm
To: r-devel at r-project.org


> Hi,
> 
> I would have thought that these two constructions would
> produce the same result but they do not.
> 
> Resp <- rbinom(10, 1, 0.5)
> Stim <- rep(0:1, 5)
> mm <- model.matrix(~ Stim)
> Xb <- mm %*% c(0, 1)
> ifelse(Resp, log(pnorm(Xb)), log(1 - pnorm(Xb)))
> pnorm(as.vector(Xb), lower.tail = Resp, log.p = TRUE)
> 
> > ifelse(Resp, log(pnorm(Xb)), log(1 - pnorm(Xb)))
>   [1] -0.6931472 -1.8410216 -0.6931472 -0.1727538 -0.6931472
>   [6] -0.1727538 -0.6931472 -1.8410216 -0.6931472 -1.8410216
> > pnorm(as.vector(Xb), lower.tail = Resp, log.p = TRUE)
>   [1] -0.6931472 -1.8410216 -0.6931472 -1.8410216 -0.6931472
>   [6] -1.8410216 -0.6931472 -1.8410216 -0.6931472 -1.8410216
> 
> If I have missed something obvious, I would be grateful
> to have it pointed out.
> 
> > sessionInfo()
> R version 2.10.1 beta (2009-12-04 r50668)
> i386-apple-darwin9.8.0
> 
> locale:
> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods
> [7] base
> 
> loaded via a namespace (and not attached):
> [1] tools_2.10.1
> 
> Thanks for any enlightenment.
> 
> best,
> 
> Ken
> 
> -- 
> Ken Knoblauch
> Inserm U846
> Stem-cell and Brain Research Institute
> Department of Integrative Neurosciences
> 18 avenue du Doyen L?pine
> 69500 Bron
> France
> tel: +33 (0)4 72 91 34 77
> fax: +33 (0)4 72 91 34 61
> portable: +33 (0)6 84 10 64 10
> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
>


From wdunlap at tibco.com  Tue Dec  8 17:46:47 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Tue, 8 Dec 2009 08:46:47 -0800
Subject: [Rd] lower.tail option in pnorm
In-Reply-To: <20091208163621.f60fi66mhw0co44o@imp.inserm.fr>
References: <20091208163621.f60fi66mhw0co44o@imp.inserm.fr>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D700023AB15F@NA-PA-VBE03.na.tibco.com>

A more direct way to reproduce this is
  > pbinom(q=0:4, size=4, prob=.25, lower.tail=FALSE)
  [1] 0.68359375 0.26171875 0.05078125 0.00390625 0.00000000
  > pbinom(q=0:4, size=4, prob=.25, lower.tail=c(FALSE,TRUE,TRUE,TRUE))
  [1] 0.68359375 0.26171875 0.05078125 0.00390625 0.00000000
  > pbinom(q=0:4, size=4, prob=.25, lower.tail=c(TRUE,TRUE,TRUE,TRUE))
  [1] 0.31640625 0.73828125 0.94921875 0.99609375 1.00000000
which shows that the lower.tail argument is not not vectorized.
While this fact may be documented, it would be nice if functions
that expected a scalar argument would complain if they got a
nonscalar argument.  Some do complain, as in
  > seq(1, 1:4)
  [1] 1
  Warning message:
    In from:to : numerical expression has 4 elements: only the first used
but lots silently take the first element of a vector when its length
is more than 1, as above, and use the default value if the length is 0,
as in
  > pbinom(q=0:4, size=4, prob=.25, lower.tail=logical())
  [1] 0.31640625 0.73828125 0.94921875 0.99609375 1.00000000

Should the C functions Rf_asReal, Rf_asInteger, etc., warn
if the argument has length more than 1?  If so, they probably
need another argument, a string, to put into the warning message,
so the user knows which argument is causing the complaint.

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com  

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Ken Knoblauch
> Sent: Tuesday, December 08, 2009 7:36 AM
> To: r-devel at r-project.org
> Subject: [Rd] lower.tail option in pnorm
> 
> Hi,
> 
> I would have thought that these two constructions would
> produce the same result but they do not.
> 
> Resp <- rbinom(10, 1, 0.5)
> Stim <- rep(0:1, 5)
> mm <- model.matrix(~ Stim)
> Xb <- mm %*% c(0, 1)
> ifelse(Resp, log(pnorm(Xb)), log(1 - pnorm(Xb)))
> pnorm(as.vector(Xb), lower.tail = Resp, log.p = TRUE)
> 
> > ifelse(Resp, log(pnorm(Xb)), log(1 - pnorm(Xb)))
>   [1] -0.6931472 -1.8410216 -0.6931472 -0.1727538 -0.6931472
>   [6] -0.1727538 -0.6931472 -1.8410216 -0.6931472 -1.8410216
> > pnorm(as.vector(Xb), lower.tail = Resp, log.p = TRUE)
>   [1] -0.6931472 -1.8410216 -0.6931472 -1.8410216 -0.6931472
>   [6] -1.8410216 -0.6931472 -1.8410216 -0.6931472 -1.8410216
> 
> If I have missed something obvious, I would be grateful
> to have it pointed out.
> 
> > sessionInfo()
> R version 2.10.1 beta (2009-12-04 r50668)
> i386-apple-darwin9.8.0
> 
> locale:
> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods
> [7] base
> 
> loaded via a namespace (and not attached):
> [1] tools_2.10.1
> 
> Thanks for any enlightenment.
> 
> best,
> 
> Ken
> 
> -- 
> Ken Knoblauch
> Inserm U846
> Stem-cell and Brain Research Institute
> Department of Integrative Neurosciences
> 18 avenue du Doyen L?pine
> 69500 Bron
> France
> tel: +33 (0)4 72 91 34 77
> fax: +33 (0)4 72 91 34 61
> portable: +33 (0)6 84 10 64 10
> http://www.sbri.fr/members/kenneth-knoblauch.html
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From i.aoultchenko at erasmusmc.nl  Tue Dec  8 18:04:34 2009
From: i.aoultchenko at erasmusmc.nl (Yurii Aulchenko)
Date: Tue, 8 Dec 2009 18:04:34 +0100
Subject: [Rd] extraction of sub-matrix by name
Message-ID: <7B217AE0-D867-472D-B985-1FD9212E5238@erasmusmc.nl>

Dear all,

sorry to bother you with potentially known issue --

we have noticed that if we select data frame rows by rownames, we get  
some results back if the match can be done unambiguously, though the  
match is not perfect (see example), e.g. x{"2",] will return a row if  
there is a unique row with name starting with "2" (but may be  
"2375745"!)

is that a planned behavior of R which will be maintained? for us it  
was a bit unexpected...

Yurii

-----------------------------
 > a <- data.frame(x=1:3, y=1:3)
 > rownames(a) <- c("2535","59617","555")
 > a
       x y
2535  1 1
59617 2 2
555   3 3
 > a["5",]
     x  y
NA NA NA
 > a["555",]
     x y
555 3 3
 > a["2",]
      x y
2535 1 1
 > version
                _
platform       i386-apple-darwin9.8.0
arch           i386
os             darwin9.8.0
system         i386, darwin9.8.0
status         Under development (unstable)
major          2
minor          11.0
year           2009
month          12
day            07
svn rev        50688
language       R
version.string R version 2.11.0 Under development (unstable)  
(2009-12-07 r50688)

-----------------------------------------------------------
Yurii Aulchenko
Erasmus MC Rotterdam
Department of Epidemiology, Ee 2200
Postbus 2040, 3000 CA Rotterdam
The Netherlands

phone: +31107043486
fax: +31107044657


From tplate at acm.org  Tue Dec  8 22:24:28 2009
From: tplate at acm.org (Tony Plate)
Date: Tue, 08 Dec 2009 14:24:28 -0700
Subject: [Rd] extraction of sub-matrix by name
In-Reply-To: <7B217AE0-D867-472D-B985-1FD9212E5238@erasmusmc.nl>
References: <7B217AE0-D867-472D-B985-1FD9212E5238@erasmusmc.nl>
Message-ID: <4B1EC40C.6080403@acm.org>

This is documented behavior. From ?"[.data.frame":

Both ?[? and ?[[? extraction methods partially match row
names. By default neither partially match column names, but
?[[? will unless ?exact=TRUE?. If you want to do exact
matching on row names use ?match? as in the examples.

In the history of S, S-PLUS and R partial matching for subscripts and 
indices has been used in many places, but over time it has been removed 
from some. Some methods for "[[" have an "exact" argument that allows 
specification of whether you want exact or prefix matches. However, as 
the docs indicate, this doesn't apply to "[" for rownames in data 
frames. At this point, the behavior is unlikely to change -- it risks 
breaking too much old code (that's just my opinion based on observation 
of the evolution of R -- I have no control over that evolution). Follow 
the suggestion in the help for [.data.frame to get exact matching.

-- Tony Plate

Yurii Aulchenko wrote:
> Dear all,
>
> sorry to bother you with potentially known issue --
>
> we have noticed that if we select data frame rows by rownames, we get 
> some results back if the match can be done unambiguously, though the 
> match is not perfect (see example), e.g. x{"2",] will return a row if 
> there is a unique row with name starting with "2" (but may be "2375745"!)
>
> is that a planned behavior of R which will be maintained? for us it 
> was a bit unexpected...
>
> Yurii
>
> -----------------------------
> > a <- data.frame(x=1:3, y=1:3)
> > rownames(a) <- c("2535","59617","555")
> > a
> x y
> 2535 1 1
> 59617 2 2
> 555 3 3
> > a["5",]
> x y
> NA NA NA
> > a["555",]
> x y
> 555 3 3
> > a["2",]
> x y
> 2535 1 1
> > version
> _
> platform i386-apple-darwin9.8.0
> arch i386
> os darwin9.8.0
> system i386, darwin9.8.0
> status Under development (unstable)
> major 2
> minor 11.0
> year 2009
> month 12
> day 07
> svn rev 50688
> language R
> version.string R version 2.11.0 Under development (unstable) 
> (2009-12-07 r50688)
>
> -----------------------------------------------------------
> Yurii Aulchenko
> Erasmus MC Rotterdam
> Department of Epidemiology, Ee 2200
> Postbus 2040, 3000 CA Rotterdam
> The Netherlands
>
> phone: +31107043486
> fax: +31107044657
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From baptiste.auguie at googlemail.com  Tue Dec  8 23:07:44 2009
From: baptiste.auguie at googlemail.com (baptiste auguie)
Date: Tue, 8 Dec 2009 23:07:44 +0100
Subject: [Rd] lty parameter not respected by pdf device
Message-ID: <de4e29f50912081407v15853b57u269f8e6b7d6b57bd@mail.gmail.com>

Dear all,

Several of us ggplot2 users noticed the disappearance of some dashed
lines in the pdf output produced with the pdf device. They looked fine
on screen or with quartz() output. When opening the file with
Illustrator I noted that the missing line was in fact present, but
with a dashed pattern that contained zero solid length. It appears
that if you specify lty in the form lty=xy, pdf() produces a line with
lty=(x-1)(y+1) and some lines may disappear. Here is a minimal
example,

pdf("test.pdf")
grid.polyline(gp=gpar(lty="13"))#, lineend = "butt"))
dev.off()

The line is invisible, and has pattern (according to Illustrator) lty=04.

Similarly,

pdf("test.pdf")
grid.polyline(gp=gpar(lty="5555"))#, lineend = "butt"))
dev.off()

produces a visible line with pattern lty=4646

Best regards,

baptiste

sessionInfo()
R version 2.11.0 Under development (unstable) (2009-11-30 r50622)
i386-apple-darwin9.8.0

locale:
[1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets  methods
[8] base

other attached packages:
[1] ggplot2_0.8.3 reshape_0.8.3 plyr_0.1.9    proto_0.3-8

loaded via a namespace (and not attached):
[1] tools_2.11.0


From hb at stat.berkeley.edu  Wed Dec  9 02:44:48 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Tue, 8 Dec 2009 17:44:48 -0800
Subject: [Rd] x[c()] <- value sets the mode to mode(value)
Message-ID: <59d7961d0912081744m115639eey980adc50d57ac0fb@mail.gmail.com>

Only for the record,

an unnecessary overhead when nothing is assigned:

> x <- integer(10)
> str(x)
 int [1:10] 0 0 0 0 0 0 0 0 0 0
> x[c()] <- 1.0;
> str(x)
 num [1:10] 0 0 0 0 0 0 0 0 0 0

'x' could equally well have renamed untouched.

/Henrik


From wdunlap at tibco.com  Wed Dec  9 02:54:28 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Tue, 8 Dec 2009 17:54:28 -0800
Subject: [Rd] x[c()] <- value sets the mode to mode(value)
In-Reply-To: <59d7961d0912081744m115639eey980adc50d57ac0fb@mail.gmail.com>
References: <59d7961d0912081744m115639eey980adc50d57ac0fb@mail.gmail.com>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D700023AB391@NA-PA-VBE03.na.tibco.com>

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Henrik Bengtsson
> Sent: Tuesday, December 08, 2009 5:45 PM
> To: R-devel
> Subject: [Rd] x[c()] <- value sets the mode to mode(value)
> 
> Only for the record,
> 
> an unnecessary overhead when nothing is assigned:
> 
> > x <- integer(10)
> > str(x)
>  int [1:10] 0 0 0 0 0 0 0 0 0 0
> > x[c()] <- 1.0;
> > str(x)
>  num [1:10] 0 0 0 0 0 0 0 0 0 0
> 
> 'x' could equally well have renamed untouched.

I disagree.  I think the language is more predictable,
hence easier to use, if the class of the output of a
function depends only on the classes of the inputs,
not on the classes and lengths of the inputs.

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com  

> 
> /Henrik
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From abelikoff at gmail.com  Wed Dec  9 08:35:11 2009
From: abelikoff at gmail.com (abelikoff at gmail.com)
Date: Wed,  9 Dec 2009 08:35:11 +0100 (CET)
Subject: [Rd] reshape() makes R run out of memory (PR#14121)
Message-ID: <20091209073511.4E6B2282EFC0@mail.pubhealth.ku.dk>

Full_Name: Alexander L. Belikoff
Version: 2.8.1
OS: Ubuntu 9.04 (x86_64)
Submission from: (NULL) (67.244.71.200)


I'm trying to reshape the following data frame:

ID                     DATE1             DATE2      VALUE_TYPE        VALUE
'abcd1233'         2009-11-12        2009-12-23     'TYPE1'           123.45
...

VALUE_TYPE is a string and is a factor with only 2 values (say TYPE1 and TYPE2).
I need to transform it into the following data frame ("wide" transpose) based on
common ID and DATEs:

ID                     DATE1             DATE2      VALUE.TYPE1   VALUE.TYPE2
'abcd1233'         2009-11-12       2009-12-23      123.45        NA
...

Using stock reshape() as follows:

    tbl2 <- reshape(tbl, direction = "wide", idvar = c("ID", "DATE1", "DATE2"),
timevar = "VALUE_TYPE");

On a toy data frame this works fine. On a real one with 4.7 million entries
(although about 70% of VALUEs are NA) it runs out of memory:

    Error: cannot allocate vector of size 4.8 Gb

When the real data frame is loaded the R process takes about 200Mb of virtual
memory. The machine has 4 Gb of RAM.

I've posted a .Rdata file with the data frame in question at
http://belikoff.net/stuff/other/reshape_test.Rdata.gz


P.S. Just checked R 2.10.0 using an Intel PC with 2Gb RAM running Xp Pro (32
bit):

> tbl2 <- reshape(tbl, direction = "wide", idvar = c("ID", "DATE1", "DATE2"),
timevar = "VALUE_TYPE");
Error: cannot allocate vector of size 53.9 Mb
In addition: Warning messages:
1: In format.POSIXlt(as.POSIXlt(x), ...) :
  Reached total allocation of 1535Mb: see help(memory.size)
2: In format.POSIXlt(as.POSIXlt(x), ...) :
  Reached total allocation of 1535Mb: see help(memory.size)
3: In format.POSIXlt(as.POSIXlt(x), ...) :
  Reached total allocation of 1535Mb: see help(memory.size)
4: In format.POSIXlt(as.POSIXlt(x), ...) :
  Reached total allocation of 1535Mb: see help(memory.size)
5: In format.POSIXlt(as.POSIXlt(x), ...) :
  Reached total allocation of 1535Mb: see help(memory.size)
6: In format.POSIXlt(as.POSIXlt(x), ...) :
  Reached total allocation of 1535Mb: see help(memory.size)
>


From brglez at ncsu.edu  Wed Dec  9 05:35:12 2009
From: brglez at ncsu.edu (brglez at ncsu.edu)
Date: Wed,  9 Dec 2009 05:35:12 +0100 (CET)
Subject: [Rd] binary string conversion to a vector (PR#14120)
Message-ID: <20091209043512.109702831FEE@mail.pubhealth.ku.dk>

Full_Name: Franc Brglez
Version: R 2.9.1 GUI 1.28 Tiger build 32-bit (5444)
OS: MacOSX -- 10.6.2
Submission from: (NULL) (24.148.163.114)


I am demonstrating what may be a bug or my lack of experience. Please review as
it would help to hear from someone.
MANY THANKS -- Franc Brglez

The function "binS2binV" returns what I consider a wrong value -- see the
terminal output

binS2binV = function(string="0001101", sep="") 
# this procedure is expected to convert a binary string to a binary vector ...
# but does it?? Why do we get a vector with quoted binary values??
{   
    qlist = strsplit(string, sep)
    qvector = qlist[[1]]
    cat("\n  string=", string)
    cat("\n qvector=", qvector)
    n = length(qvector) ; xvector = NULL
    for (i in 1:n) {
	tmp = noquote(qvector[i])
	cat("\n", i,",     tmp=", tmp)
	xvector = c(xvector, tmp)
	cat("\n", i,", xvector=", xvector)
    }
    cat("\n")
    return(xvector)
}

> print(binS2binV("10101100"))

  string= 10101100
 qvector= 1 0 1 0 1 1 0 0
 1 ,     tmp= 1
 1 , xvector= 1
 2 ,     tmp= 0
 2 , xvector= 1 0
 3 ,     tmp= 1
 3 , xvector= 1 0 1
 4 ,     tmp= 0
 4 , xvector= 1 0 1 0
 5 ,     tmp= 1
 5 , xvector= 1 0 1 0 1
 6 ,     tmp= 1
 6 , xvector= 1 0 1 0 1 1
 7 ,     tmp= 0
 7 , xvector= 1 0 1 0 1 1 0
 8 ,     tmp= 0
 8 , xvector= 1 0 1 0 1 1 0 0
[1] "1" "0" "1" "0" "1" "1" "0" "0"  <== what I want is "unquoted" binary
values

on the other hand, similar, NOT-THE-SAME but related, "conversions" are working,
e.g.
# seq = "1 0 0 1 0"
#> seq
# [1] "1 0 0 1 0"
#> strsplit(paste(seq), " ")
# [[1]]
# [1] "1" "0" "0" "1" "0"
#> paste(strsplit(paste(seq), " ")[[1]], collapse="")
# [1] "10010"
#       
#> seq=c(0,0,0,1,1,0,1)
#> seq
# [1] 0 0 0 1 1 0 1
#> paste(strsplit(paste(seq), " "), collapse="")
# [1] "0001101"


From karl.schilling at uni-bonn.de  Wed Dec  9 00:25:11 2009
From: karl.schilling at uni-bonn.de (karl.schilling at uni-bonn.de)
Date: Wed,  9 Dec 2009 00:25:11 +0100 (CET)
Subject: [Rd] umlaut in path name (PR#14119)
Message-ID: <20091208232511.63D202831FEE@mail.pubhealth.ku.dk>

Full_Name: Karl Schilling
Version: 2.10.0 patched
OS: Win XP
Submission from: (NULL) (131.220.251.8)


I am running R 2.10.0 patched under WinXP (German version).
When I use the command file.choose() and try to navigate to a target with an
umlaut
(?, ?, ?) in the pathway, I get an error message "file not found". Also, in the
path name reproduced in the error message, the umlauts are replaced by sign
combinations.

If I tray to target files with no umlauts in the path name, everything is ok.

Any suggestions?

Thank you so much for your attention to this.

KArl Schilling


From maechler at stat.math.ethz.ch  Wed Dec  9 09:40:41 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 9 Dec 2009 09:40:41 +0100
Subject: [Rd] =?iso-8859-1?q?V=E1lasz=3A_Re=3A_tm_and_e1071_question?=
In-Reply-To: <OF8C9CE0F3.A2EBC366-ONC1257685.00748576-C1257685.00748579@inf.unideb.hu>
References: <alpine.DEB.2.00.0912041421260.28183@paninaro.stat-math.wu-wien.ac.at>
	<20091205094339.GA25171@gamma.logic.tuwien.ac.at>
	<OF8C9CE0F3.A2EBC366-ONC1257685.00748576-C1257685.00748579@inf.unideb.hu>
Message-ID: <19231.25225.479863.193354@lynne.math.ethz.ch>

>>>>> "JP" == Jeszenszky Peter <jeszenszky.peter at inf.unideb.hu>
>>>>>     on Mon, 7 Dec 2009 22:12:43 +0100 writes:

    JP> Hello,
    JP> Thank you for your reply. The suggested conversion trick with a slight
    JP> modification does the job.

    JP> I hope, the svm function of the e1071 package will support slam sparse
    JP> matrices directly. I think that this would be quite a reasonable feature.

I strongly disagree.

'Matrix' is a recommended package and most feature-complete for
sparse matrices and their arithmetic.   While it is known that
parts of its functionality could and maybe should be rendered to
work more efficiently,
it is very reasonable and sensible that other sparse matrix
formats --- if needed at all (they may make sense in a limited
context) --- have utilities to convert from and to  the
"sparseMatrix" (sub)classes in 'Matrix'.

Ingo provided code to do exactly that.

Regards,
Martin Maechler, ETH Zurich

    JP> Furthermore, there are developers who participate in the development of
    JP> both the slam and the e1071 packages.

    JP> Best regards,

    JP> Peter Jeszenszky

    JP> -----Ingo Feinerer <feinerer at logic.at> ezt ?rta: -----

    JP> C?mzett: r-devel at r-project.org
    JP> Felad?: Ingo Feinerer <feinerer at logic.at>
    JP> D?tum: 2009/12/05 10:43de.
    JP> M?solat: Jeszenszky Peter <jeszenszky.peter at inf.unideb.hu>
    JP> T?rgy: Re: tm and e1071 question

    JP> On Fri, Dec 04, 2009 at 02:21:52PM +0100, Achim Zeileis wrote:
    >> I would like to use the svm function of the e1071 package for text
    >> classification tasks. Preprocessing can be carried out by using the
    >> excellent tm text mining package.

    JP> :-)

    >> TermDocumentMatrix and DocumentTermMatrix objects of the package tm
    >> are currently implemented based on the sparse matrix data structures
    >> provided by the slam package.
    >> 
    >> Unfortunately, the svm function of the e1071 package accepts only sparse
    >> matrices of class Matrix provided by the Matrix package, or of class
    >> matrix.csr as provided by the package SparseM.
    >> 
    >> In order to train an SVM with a DocumentTermMatrix object the latter
    >> must be converted to a matrix.csr sparse matrix structure. However, none
    >> of the publicly available packages of CRAN provides such a conversion
    >> function. It is quite straightforward to write the conversion function,
    >> but it would be much confortable to pass slam sparse matrix objects
    >> directly to the svm function.

    JP> You are right. If you have small matrices as(as.matrix(m), "Matrix")
    JP> will work. Then there exists some (non published experimental) code in
    JP> the slam package for conversion to Matrix format (located in
    JP> slam/work/Matrix.R):

    JP> setAs("simple_triplet_matrix", "dgTMatrix",
    JP> function(from) {
    JP> new("dgTMatrix",
    JP> i = as.integer(from$i - 1L),
    JP> j = as.integer(from$j - 1L),
    JP> x = from$v,
    JP> Dim = c(from$nrow, from$ncol),
    JP> Dimnames = from$dimnames)
    JP> })

    JP> setAs("simple_triplet_matrix", "dgCMatrix",
    JP> function(from) {
    JP> ind <- order(from$j, from$i)
    JP> new("dgCMatrix",
    JP> i = from$i[ind] - 1L,
    JP> p = c(0L, cumsum(tabulate(from$j[ind], from$ncol))),
    JP> x = from$v[ind],
    JP> Dim = c(from$nrow, from$ncol),
    JP> Dimnames = from$dimnames)
    JP> })

    JP> which allows then:

    JP> class(m) <- "simple_triplet_matrix"
    JP> as(m, "dgTMatrix")
    JP> as(m, "dgCMatrix")

    >> Do you plan to add slam sparse matrix support to the e1071 package?

    JP> I cannot answer this since I am neither directly involved in the e1071
    JP> nor in the slam package.

    JP> Best regards, Ingo Feinerer

    JP> --
    JP> Ingo Feinerer
    JP> Vienna University of Technology
    JP> http://www.dbai.tuwien.ac.at/staff/feinerer

    JP> ______________________________________________
    JP> R-devel at r-project.org mailing list
    JP> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Wed Dec  9 12:23:55 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 9 Dec 2009 11:23:55 +0000 (GMT)
Subject: [Rd] binary string conversion to a vector (PR#14120)
In-Reply-To: <20091209043512.109702831FEE@mail.pubhealth.ku.dk>
References: <20091209043512.109702831FEE@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0912091110010.10599@gannet.stats.ox.ac.uk>

On Wed, 9 Dec 2009, brglez at ncsu.edu wrote:

> Full_Name: Franc Brglez
> Version: R 2.9.1 GUI 1.28 Tiger build 32-bit (5444)
> OS: MacOSX -- 10.6.2
> Submission from: (NULL) (24.148.163.114)
>
>
> I am demonstrating what may be a bug or my lack of experience. Please review as
> it would help to hear from someone.
> MANY THANKS -- Franc Brglez

Please review the section 'BUGS' in the FAQ to work out why you have 
just annoyed the developers who will have to clear up after you.  You 
were asked only to use R-bugs when you 'know for certain', and only to 
report on current versions of R.

You started xvector as NULL: concatentating NULL and an object of 
noquote dispatches on the first argument, NULL, and uses the default 
method.  So xvector correctly does not have class "noquote". A simple 
way to do this would be

binS2binV <- function(string="0001101", sep="")
     noquote(strsplit(string, sep)[[1]])

or replace noquote by as.integer.

Note too the cat() and paste() print things differently, so using 
cat() to debug is not telling you anything useful about the eventual 
output.

>
> The function "binS2binV" returns what I consider a wrong value -- see the
> terminal output
>
> binS2binV = function(string="0001101", sep="")
> # this procedure is expected to convert a binary string to a binary vector ...
> # but does it?? Why do we get a vector with quoted binary values??
> {
>    qlist = strsplit(string, sep)
>    qvector = qlist[[1]]
>    cat("\n  string=", string)
>    cat("\n qvector=", qvector)
>    n = length(qvector) ; xvector = NULL
>    for (i in 1:n) {
> 	tmp = noquote(qvector[i])
> 	cat("\n", i,",     tmp=", tmp)
> 	xvector = c(xvector, tmp)
> 	cat("\n", i,", xvector=", xvector)
>    }
>    cat("\n")
>    return(xvector)
> }
>
>> print(binS2binV("10101100"))
>
>  string= 10101100
> qvector= 1 0 1 0 1 1 0 0
> 1 ,     tmp= 1
> 1 , xvector= 1
> 2 ,     tmp= 0
> 2 , xvector= 1 0
> 3 ,     tmp= 1
> 3 , xvector= 1 0 1
> 4 ,     tmp= 0
> 4 , xvector= 1 0 1 0
> 5 ,     tmp= 1
> 5 , xvector= 1 0 1 0 1
> 6 ,     tmp= 1
> 6 , xvector= 1 0 1 0 1 1
> 7 ,     tmp= 0
> 7 , xvector= 1 0 1 0 1 1 0
> 8 ,     tmp= 0
> 8 , xvector= 1 0 1 0 1 1 0 0
> [1] "1" "0" "1" "0" "1" "1" "0" "0"  <== what I want is "unquoted" binary
> values
>
> on the other hand, similar, NOT-THE-SAME but related, "conversions" are working,
> e.g.
> # seq = "1 0 0 1 0"
> #> seq
> # [1] "1 0 0 1 0"
> #> strsplit(paste(seq), " ")
> # [[1]]
> # [1] "1" "0" "0" "1" "0"
> #> paste(strsplit(paste(seq), " ")[[1]], collapse="")
> # [1] "10010"
> #
> #> seq=c(0,0,0,1,1,0,1)
> #> seq
> # [1] 0 0 0 1 1 0 1
> #> paste(strsplit(paste(seq), " "), collapse="")
> # [1] "0001101"
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch at stats.uwo.ca  Wed Dec  9 12:34:32 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 09 Dec 2009 06:34:32 -0500
Subject: [Rd] binary string conversion to a vector (PR#14120)
In-Reply-To: <20091209043512.109702831FEE@mail.pubhealth.ku.dk>
References: <20091209043512.109702831FEE@mail.pubhealth.ku.dk>
Message-ID: <4B1F8B48.1000708@stats.uwo.ca>

brglez at ncsu.edu wrote:
> Full_Name: Franc Brglez
> Version: R 2.9.1 GUI 1.28 Tiger build 32-bit (5444)
> OS: MacOSX -- 10.6.2
> Submission from: (NULL) (24.148.163.114)
>
>
> I am demonstrating what may be a bug or my lack of experience. Please review as
> it would help to hear from someone.
>   

It is your lack of experience.  Please do not abuse the bug reporting 
system.

Duncan Murdoch
> MANY THANKS -- Franc Brglez
>
> The function "binS2binV" returns what I consider a wrong value -- see the
> terminal output
>
> binS2binV = function(string="0001101", sep="") 
> # this procedure is expected to convert a binary string to a binary vector ...
> # but does it?? Why do we get a vector with quoted binary values??
> {   
>     qlist = strsplit(string, sep)
>     qvector = qlist[[1]]
>     cat("\n  string=", string)
>     cat("\n qvector=", qvector)
>     n = length(qvector) ; xvector = NULL
>     for (i in 1:n) {
> 	tmp = noquote(qvector[i])
> 	cat("\n", i,",     tmp=", tmp)
> 	xvector = c(xvector, tmp)
> 	cat("\n", i,", xvector=", xvector)
>     }
>     cat("\n")
>     return(xvector)
> }
>
>   
>> print(binS2binV("10101100"))
>>     
>
>   string= 10101100
>  qvector= 1 0 1 0 1 1 0 0
>  1 ,     tmp= 1
>  1 , xvector= 1
>  2 ,     tmp= 0
>  2 , xvector= 1 0
>  3 ,     tmp= 1
>  3 , xvector= 1 0 1
>  4 ,     tmp= 0
>  4 , xvector= 1 0 1 0
>  5 ,     tmp= 1
>  5 , xvector= 1 0 1 0 1
>  6 ,     tmp= 1
>  6 , xvector= 1 0 1 0 1 1
>  7 ,     tmp= 0
>  7 , xvector= 1 0 1 0 1 1 0
>  8 ,     tmp= 0
>  8 , xvector= 1 0 1 0 1 1 0 0
> [1] "1" "0" "1" "0" "1" "1" "0" "0"  <== what I want is "unquoted" binary
> values
>
> on the other hand, similar, NOT-THE-SAME but related, "conversions" are working,
> e.g.
> # seq = "1 0 0 1 0"
> #> seq
> # [1] "1 0 0 1 0"
> #> strsplit(paste(seq), " ")
> # [[1]]
> # [1] "1" "0" "0" "1" "0"
> #> paste(strsplit(paste(seq), " ")[[1]], collapse="")
> # [1] "10010"
> #       
> #> seq=c(0,0,0,1,1,0,1)
> #> seq
> # [1] 0 0 0 1 1 0 1
> #> paste(strsplit(paste(seq), " "), collapse="")
> # [1] "0001101"
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Wed Dec  9 14:42:55 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 9 Dec 2009 13:42:55 +0000 (GMT)
Subject: [Rd] Recent TeX changes and R/package manuals
Message-ID: <alpine.LFD.2.00.0912091253370.27460@gannet.stats.ox.ac.uk>

As some of you will be aware, TeXLive 2009 was released last month 
having blocked updates on earlier versions since May.  This has lead 
to a flood of updates of LaTeX packages, as a result of which the 
PDF manuals of R 2.10.0 and earlier will no longer build, for two 
separate reasons.

For MiKTeX users: at least version 2.8 (the current one) has the same 
updates (a week or so later) and has the same issues.

After some workarounds, 2.10.1 RC and R-devel do build their manuals 
for me on TL2009 on Linux, MacTeX 2009 (a TL2009 derivative) on Mac OS 
X and current MiKTeX 2.8 on Windows.

As far as I can tell, the following CRAN package manuals have been 
affected:

   distrMod, RCurl, RGtk2, SparseM, VIM, bit, ggplot2, operators,
   relations, spam, tensorA

(and only distrMod fatally).

Given the current pace of change (ca 100 updates/week on 'only' 2000 
TL packages), more things may pop out of the woodwork.


For the curious and cognescenti:

(i) hyperref is having problems with markup in \section titles, which 
'methods' and 'distrMod' had.  I've added a warning to the R-exts 
manual.


(ii) there have been intermittent problems with (LaTeX) special 
characters in indices.  But (hyperref 6.79d)

   Full support of makeindex?s encap feature (e.g.
   \index{alpha|textbf}). \hyperpage and the formatting command are
   cascaded via \hyperindexformat. Internally \index{alpha|textbf} is
   transferred to \index{alpha|hyperindexformat{\textbf}}.
   \hyperindexformat calls the formatting command in its first argument
   with the page range as argument that is put into \hyperpage. The
   formatting command may call \hyperpage itself, it will be disabled
   automatically to prevent nested \hyperpage commands.

has broken '|' as an index item ('||' was already broken) so I added 
some special-casing (this does look like a bug in hyperref).  Also 
some uses of '%' (ggplot2, operators, relations).


(iii) some LaTeX style files are no longer in TL2009. e.g. 
floatflt.sty (used by packages EffectiveDose, gWidgets, gWidgetsWWW, 
monoProc, pmg).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From chiefmurphy at gmail.com  Wed Dec  9 19:55:45 2009
From: chiefmurphy at gmail.com (Daniel Murphy)
Date: Wed, 9 Dec 2009 10:55:45 -0800
Subject: [Rd] choose.files() latent highlighting in console
Message-ID: <48f8cced0912091055w102c2230x7b7cc62496f6db6b@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091209/4cb5a872/attachment.pl>

From p.dalgaard at biostat.ku.dk  Wed Dec  9 21:45:00 2009
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 09 Dec 2009 21:45:00 +0100
Subject: [Rd] reshape() makes R run out of memory (PR#14121)
In-Reply-To: <20091209073511.4E6B2282EFC0@mail.pubhealth.ku.dk>
References: <20091209073511.4E6B2282EFC0@mail.pubhealth.ku.dk>
Message-ID: <4B200C4C.2000506@biostat.ku.dk>

abelikoff at gmail.com wrote:
> Full_Name: Alexander L. Belikoff
> Version: 2.8.1
> OS: Ubuntu 9.04 (x86_64)
> Submission from: (NULL) (67.244.71.200)
> 
> 
> I'm trying to reshape the following data frame:
> 
> ID                     DATE1             DATE2      VALUE_TYPE        VALUE
> 'abcd1233'         2009-11-12        2009-12-23     'TYPE1'           123.45
> ...
> 
> VALUE_TYPE is a string and is a factor with only 2 values (say TYPE1 and TYPE2).
> I need to transform it into the following data frame ("wide" transpose) based on
> common ID and DATEs:
> 
> ID                     DATE1             DATE2      VALUE.TYPE1   VALUE.TYPE2
> 'abcd1233'         2009-11-12       2009-12-23      123.45        NA
> ...
> 
> Using stock reshape() as follows:
> 
>     tbl2 <- reshape(tbl, direction = "wide", idvar = c("ID", "DATE1", "DATE2"),
> timevar = "VALUE_TYPE");
> 
> On a toy data frame this works fine. On a real one with 4.7 million entries
> (although about 70% of VALUEs are NA) it runs out of memory:
> 
>     Error: cannot allocate vector of size 4.8 Gb
> 
> When the real data frame is loaded the R process takes about 200Mb of virtual
> memory. The machine has 4 Gb of RAM.
> 
> I've posted a .Rdata file with the data frame in question at
> http://belikoff.net/stuff/other/reshape_test.Rdata.gz
> 
> 
> P.S. Just checked R 2.10.0 using an Intel PC with 2Gb RAM running Xp Pro (32
> bit):
> 
>> tbl2 <- reshape(tbl, direction = "wide", idvar = c("ID", "DATE1", "DATE2")c("ID", "DATE1", "DATE2"),
> timevar = "VALUE_TYPE");
> Error: cannot allocate vector of size 53.9 Mb
> In addition: Warning messages:
....

Yes. The culprit would seem to be interaction(), as in

 > x <- y <- z <- 1:999
 > i <- interaction(x,y,z, drop=TRUE)
Error: cannot allocate vector of size 3.7 Gb

which is happening due to the occurrence of three idvar variables. This 
works basically as interaction(x,y,z)[,drop=TRUE], i.e. it first creates 
a factor with 999^3 levels, and removes the empty levels afterward.

In the absense of a better interaction(), you might try making your own 
single idvar as do.call("paste",tbl[,c("ID", "DATE1", "DATE2")]) or so.

-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From g.russell at eos-solutions.com  Wed Dec  9 10:35:09 2009
From: g.russell at eos-solutions.com (g.russell at eos-solutions.com)
Date: Wed, 9 Dec 2009 10:35:09 +0100
Subject: [Rd] Antwort: Re:  Crash with Unicode and sub (PR#14114)
In-Reply-To: <4B1E2972.5010301@biostat.ku.dk>
Message-ID: <OF0B94AA00.4DC7A5D5-ONC1257687.00341C48-C1257687.0034A852@DFD-Hamburg>

Hello Peter,

I have now installed R-2.10.1 RC (sessionInfo() says "R version 2.10.1 RC 
(2009-12-06 r50684)", the rest I believe is as before). The following code 
always brings R --vanilla down (with a crash, not a normal exit):
-- cut here --
gctorture()
u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
v <- rep(u,1e2)
v <- sub(" ","",v)
v %in% ""
q()
-- cut here --

I've tried this several times now, with different effects. Sometimes R 
crashes after 'v %in% ""'. Sometimes it survives that command, but crashes 
during the q(). I have also had the error message "Fehler in match(x, 
table, nomatch = 0L) > 0L : Vergleich (6) ist nur f?r atomare und 
Listentypen m?glich" from that command (the match seems to be the 
problem), when I type q() R still crashes. 

Best wishes,

George Russell | KG EOS Holding GmbH & Co

Tel: +49 40 2850 ? 1574  | g.russell at eos-solutions.com

EOS. With head and heart in finance

KG EOS Holding GmbH & Co | Steindamm 71, 20099 Hamburg | AG Hamburg HRA 95 
748
Pers?nlich haftend | EOS Holding GmbH | AG Hamburg HRB 78 748
Gesch?ftsf?hrer | Hans-Werner Scherer, Klaus Engberding, Justus 
Hecking-Veltman, Paul Leary sen., Christos Savvides, Dr. Andreas Witzig
Vorsitzender des Beirates | J?rgen Schulte-Laggenbeck 

Save a tree. Don?t print this email unless it?s really necessary.

Diese E-Mail enth?lt vertrauliche und/oder rechtlich gesch?tzte 
Informationen. Wenn Sie nicht der richtige Adressat sind oder diese E-Mail 
irrt?mlich erhalten haben, informieren Sie bitte sofort den Absender und 
vernichten Sie diese Mail. Das unerlaubte Kopieren sowie die unbefugte 
Weitergabe dieser Mail ist nicht gestattet.

This email may contain confidential and/or privileged information.
If you are not the intended recipient or have received this email in 
error, please notify the sender immediately and destroy this email.
Any unauthorized copying, disclosure or distribution of the material in 
this email is strictly forbidden.

Peter Dalgaard <P.Dalgaard at biostat.ku.dk> schrieb am 08.12.2009 11:24:50:

> g.russell at eos-solutions.com wrote:
> > Full_Name: George Russell
> > Version: 2.10.0
> > OS: Windows XP Version 2002 SP 2
> > Submission from: (NULL) (217.111.3.131)
> > 
> > 
> > The following typed into R --vanilla induces a crash:
> > -- cut here --
> > gctorture()
> > u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
> > v <- rep(u,1e2)
> > v <- sub(" ","",v)
> > v %in% ""
> > -- cut here --
> > 
> > sessionInfo() says:
> > 
> > -- cut here --
> > R version 2.10.0 (2009-10-26) 
> > i386-pc-mingw32 
> > 
> > locale:
> > [1] LC_COLLATE=German_Germany.1252  LC_CTYPE=German_Germany.1252 
> > [3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C 
> > [5] LC_TIME=German_Germany.1252 
> > 
> > attached base packages:
> > [1] stats     graphics  grDevices datasets  utils     methods   base
> > -- cut here --
> > 
> > I apologise for not testing this with R-2.10.1 but as far as I can
> see there are
> > only source releases available so far, which I am not able to compile.
> >
> 
> 2.10.1 RC is available now. Please check. It does seem to be
> reproducible in the Windows version, or at least it takes a very long
> time, but that means running under Wine on SUSE for me. I don't see the
> effect with the Linux build.
> 
> -- 
>    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
>  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907
> 


From pengyu.ut at gmail.com  Wed Dec  9 23:10:09 2009
From: pengyu.ut at gmail.com (pengyu.ut at gmail.com)
Date: Wed,  9 Dec 2009 23:10:09 +0100 (CET)
Subject: [Rd] split() is slow on data.frame (PR#14123)
Message-ID: <20091209221009.B544F283200C@mail.pubhealth.ku.dk>

Please see the following code for the runtime comparison between
split() and mysplit.data.frame() (they do the same thing
semantically). mysplit.data.frame() is a fix of split() in term of
performance. Could somebody include this fix (with possible checking
for corner cases) in future version of R and let me know the inclusion
of the fix?

m=300000
n=6
k=30000

set.seed(0)
x=replicate(n,rnorm(m))
f=sample(1:k, size=m, replace=T)

mysplit.data.frame<-function(x,f) {
  print('processing data.frame')
  v=lapply(
      1:dim(x)[[2]]
      , function(i) {
        split(x[,i],f)
      }
      )

  w=lapply(
      seq(along=v[[1]])
      , function(i) {
        result=do.call(
            cbind
            , lapply(v,
                function(vj) {
                  vj[[i]]
                }
                )
            )
        colnames(result)=colnames(x)
        return(result)
      }
      )
  names(w)=names(v[[1]])
  return(w)
}

system.time(split(as.data.frame(x),f))
system.time(mysplit.data.frame(as.data.frame(x),f))


From wdunlap at tibco.com  Wed Dec  9 23:26:15 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Wed, 9 Dec 2009 14:26:15 -0800
Subject: [Rd] split() is slow on data.frame (PR#14123)
In-Reply-To: <20091209221009.B544F283200C@mail.pubhealth.ku.dk>
References: <20091209221009.B544F283200C@mail.pubhealth.ku.dk>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D700023AB587@NA-PA-VBE03.na.tibco.com>

Here are some differences between the current and proposed
split.data.frame.

> d<-data.frame(Matrix=I(matrix(1:10, ncol=2)),
Named=c(one=1,two=2,three=3,four=4,five=5),
row.names=as.character(1001:1005))
> group<-c("A","B","A","A","B")
> split.data.frame(d,group)
$A
     Matrix.1 Matrix.2 Named
1001        1        6     1
1003        3        8     3
1004        4        9     4

$B
     Matrix.1 Matrix.2 Named
1002        2        7     2
1005        5       10     5

> mysplit.data.frame(d,group) # lost row.names and 2nd column of Matrix
[1] "processing data.frame"
$A
     Matrix Named
[1,]      1     1
[2,]      3     3
[3,]      4     4

$B
     Matrix Named
[1,]      2     2
[2,]      5     5


Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com  

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of 
> pengyu.ut at gmail.com
> Sent: Wednesday, December 09, 2009 2:10 PM
> To: r-devel at stat.math.ethz.ch
> Cc: R-bugs at r-project.org
> Subject: [Rd] split() is slow on data.frame (PR#14123)
> 
> Please see the following code for the runtime comparison between
> split() and mysplit.data.frame() (they do the same thing
> semantically). mysplit.data.frame() is a fix of split() in term of
> performance. Could somebody include this fix (with possible checking
> for corner cases) in future version of R and let me know the inclusion
> of the fix?
> 
> m=300000
> n=6
> k=30000
> 
> set.seed(0)
> x=replicate(n,rnorm(m))
> f=sample(1:k, size=m, replace=T)
> 
> mysplit.data.frame<-function(x,f) {
>   print('processing data.frame')
>   v=lapply(
>       1:dim(x)[[2]]
>       , function(i) {
>         split(x[,i],f)
>       }
>       )
> 
>   w=lapply(
>       seq(along=v[[1]])
>       , function(i) {
>         result=do.call(
>             cbind
>             , lapply(v,
>                 function(vj) {
>                   vj[[i]]
>                 }
>                 )
>             )
>         colnames(result)=colnames(x)
>         return(result)
>       }
>       )
>   names(w)=names(v[[1]])
>   return(w)
> }
> 
> system.time(split(as.data.frame(x),f))
> system.time(mysplit.data.frame(as.data.frame(x),f))
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From cberry at tajo.ucsd.edu  Thu Dec 10 00:44:29 2009
From: cberry at tajo.ucsd.edu (Charles C. Berry)
Date: Wed, 9 Dec 2009 15:44:29 -0800
Subject: [Rd] split() is slow on data.frame (PR#14123)
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D700023AB587@NA-PA-VBE03.na.tibco.com>
References: <20091209221009.B544F283200C@mail.pubhealth.ku.dk>
	<77EB52C6DD32BA4D87471DCD70C8D700023AB587@NA-PA-VBE03.na.tibco.com>
Message-ID: <Pine.LNX.4.64.0912091541560.26818@tajo.ucsd.edu>

On Wed, 9 Dec 2009, William Dunlap wrote:

> Here are some differences between the current and proposed
> split.data.frame.

Adding 'drop=FALSE' fixes this case. See in line correction below.

Chuck

>
>> d<-data.frame(Matrix=I(matrix(1:10, ncol=2)),
> Named=c(one=1,two=2,three=3,four=4,five=5),
> row.names=as.character(1001:1005))
>> group<-c("A","B","A","A","B")
>> split.data.frame(d,group)
> $A
>     Matrix.1 Matrix.2 Named
> 1001        1        6     1
> 1003        3        8     3
> 1004        4        9     4
>
> $B
>     Matrix.1 Matrix.2 Named
> 1002        2        7     2
> 1005        5       10     5
>
>> mysplit.data.frame(d,group) # lost row.names and 2nd column of Matrix
> [1] "processing data.frame"
> $A
>     Matrix Named
> [1,]      1     1
> [2,]      3     3
> [3,]      4     4
>
> $B
>     Matrix Named
> [1,]      2     2
> [2,]      5     5
>
>
> Bill Dunlap
> Spotfire, TIBCO Software
> wdunlap tibco.com
>
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org
>> [mailto:r-devel-bounces at r-project.org] On Behalf Of
>> pengyu.ut at gmail.com
>> Sent: Wednesday, December 09, 2009 2:10 PM
>> To: r-devel at stat.math.ethz.ch
>> Cc: R-bugs at r-project.org
>> Subject: [Rd] split() is slow on data.frame (PR#14123)
>>
>> Please see the following code for the runtime comparison between
>> split() and mysplit.data.frame() (they do the same thing
>> semantically). mysplit.data.frame() is a fix of split() in term of
>> performance. Could somebody include this fix (with possible checking
>> for corner cases) in future version of R and let me know the inclusion
>> of the fix?
>>
>> m=300000
>> n=6
>> k=30000
>>
>> set.seed(0)
>> x=replicate(n,rnorm(m))
>> f=sample(1:k, size=m, replace=T)
>>
>> mysplit.data.frame<-function(x,f) {
>>   print('processing data.frame')
>>   v=lapply(
>>       1:dim(x)[[2]]
>>       , function(i) {
>>         split(x[,i],f)

Change to:

          split(x[,i,drop=FALSE],f)


>>       }
>>       )
>>
>>   w=lapply(
>>       seq(along=v[[1]])
>>       , function(i) {
>>         result=do.call(
>>             cbind
>>             , lapply(v,
>>                 function(vj) {
>>                   vj[[i]]
>>                 }
>>                 )
>>             )
>>         colnames(result)=colnames(x)
>>         return(result)
>>       }
>>       )
>>   names(w)=names(v[[1]])
>>   return(w)
>> }
>>
>> system.time(split(as.data.frame(x),f))
>> system.time(mysplit.data.frame(as.data.frame(x),f))
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Charles C. Berry                            (858) 534-2098
                                             Dept of Family/Preventive Medicine
E mailto:cberry at tajo.ucsd.edu	            UC San Diego
http://famprevmed.ucsd.edu/faculty/cberry/  La Jolla, San Diego 92093-0901


From pengyu.ut at gmail.com  Thu Dec 10 00:54:59 2009
From: pengyu.ut at gmail.com (Peng Yu)
Date: Wed, 9 Dec 2009 17:54:59 -0600
Subject: [Rd] split() is slow on data.frame (PR#14123)
In-Reply-To: <Pine.LNX.4.64.0912091541560.26818@tajo.ucsd.edu>
References: <20091209221009.B544F283200C@mail.pubhealth.ku.dk>
	<77EB52C6DD32BA4D87471DCD70C8D700023AB587@NA-PA-VBE03.na.tibco.com>
	<Pine.LNX.4.64.0912091541560.26818@tajo.ucsd.edu>
Message-ID: <366c6f340912091554x7d42ce4fn80c669a1402b9f2a@mail.gmail.com>

On Wed, Dec 9, 2009 at 5:44 PM, Charles C. Berry <cberry at tajo.ucsd.edu> wrote:
> On Wed, 9 Dec 2009, William Dunlap wrote:
>
>> Here are some differences between the current and proposed
>> split.data.frame.
>
> Adding 'drop=FALSE' fixes this case. See in line correction below.

Thank you for the correction.

>>> d<-data.frame(Matrix=I(matrix(1:10, ncol=2)),
>>
>> Named=c(one=1,two=2,three=3,four=4,five=5),
>> row.names=as.character(1001:1005))
>>>
>>> group<-c("A","B","A","A","B")
>>> split.data.frame(d,group)
>>
>> $A
>> ? ?Matrix.1 Matrix.2 Named
>> 1001 ? ? ? ?1 ? ? ? ?6 ? ? 1
>> 1003 ? ? ? ?3 ? ? ? ?8 ? ? 3
>> 1004 ? ? ? ?4 ? ? ? ?9 ? ? 4
>>
>> $B
>> ? ?Matrix.1 Matrix.2 Named
>> 1002 ? ? ? ?2 ? ? ? ?7 ? ? 2
>> 1005 ? ? ? ?5 ? ? ? 10 ? ? 5
>>
>>> mysplit.data.frame(d,group) # lost row.names and 2nd column of Matrix
>>
>> [1] "processing data.frame"
>> $A
>> ? ?Matrix Named
>> [1,] ? ? ?1 ? ? 1
>> [2,] ? ? ?3 ? ? 3
>> [3,] ? ? ?4 ? ? 4
>>
>> $B
>> ? ?Matrix Named
>> [1,] ? ? ?2 ? ? 2
>> [2,] ? ? ?5 ? ? 5
>>
>>
>> Bill Dunlap
>> Spotfire, TIBCO Software
>> wdunlap tibco.com
>>
>>> -----Original Message-----
>>> From: r-devel-bounces at r-project.org
>>> [mailto:r-devel-bounces at r-project.org] On Behalf Of
>>> pengyu.ut at gmail.com
>>> Sent: Wednesday, December 09, 2009 2:10 PM
>>> To: r-devel at stat.math.ethz.ch
>>> Cc: R-bugs at r-project.org
>>> Subject: [Rd] split() is slow on data.frame (PR#14123)
>>>
>>> Please see the following code for the runtime comparison between
>>> split() and mysplit.data.frame() (they do the same thing
>>> semantically). mysplit.data.frame() is a fix of split() in term of
>>> performance. Could somebody include this fix (with possible checking
>>> for corner cases) in future version of R and let me know the inclusion
>>> of the fix?
>>>
>>> m=300000
>>> n=6
>>> k=30000
>>>
>>> set.seed(0)
>>> x=replicate(n,rnorm(m))
>>> f=sample(1:k, size=m, replace=T)
>>>
>>> mysplit.data.frame<-function(x,f) {
>>> ?print('processing data.frame')
>>> ?v=lapply(
>>> ? ? ?1:dim(x)[[2]]
>>> ? ? ?, function(i) {
>>> ? ? ? ?split(x[,i],f)
>
> Change to:
>
> ? ? ? ? split(x[,i,drop=FALSE],f)
>
>
>>> ? ? ?}
>>> ? ? ?)
>>>
>>> ?w=lapply(
>>> ? ? ?seq(along=v[[1]])
>>> ? ? ?, function(i) {
>>> ? ? ? ?result=do.call(
>>> ? ? ? ? ? ?cbind
>>> ? ? ? ? ? ?, lapply(v,
>>> ? ? ? ? ? ? ? ?function(vj) {
>>> ? ? ? ? ? ? ? ? ?vj[[i]]
>>> ? ? ? ? ? ? ? ?}
>>> ? ? ? ? ? ? ? ?)
>>> ? ? ? ? ? ?)
>>> ? ? ? ?colnames(result)=colnames(x)
>>> ? ? ? ?return(result)
>>> ? ? ?}
>>> ? ? ?)
>>> ?names(w)=names(v[[1]])
>>> ?return(w)
>>> }
>>>
>>> system.time(split(as.data.frame(x),f))
>>> system.time(mysplit.data.frame(as.data.frame(x),f))
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> Charles C. Berry ? ? ? ? ? ? ? ? ? ? ? ? ? ?(858) 534-2098
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?Dept of Family/Preventive
> Medicine
> E mailto:cberry at tajo.ucsd.edu ? ? ? ? ? ? ? UC San Diego
> http://famprevmed.ucsd.edu/faculty/cberry/ ?La Jolla, San Diego 92093-0901
>
>
>


From h.wickham at gmail.com  Thu Dec 10 01:10:45 2009
From: h.wickham at gmail.com (hadley wickham)
Date: Wed, 9 Dec 2009 18:10:45 -0600
Subject: [Rd] reshape() makes R run out of memory (PR#14121)
In-Reply-To: <4B200C4C.2000506@biostat.ku.dk>
References: <20091209073511.4E6B2282EFC0@mail.pubhealth.ku.dk> 
	<4B200C4C.2000506@biostat.ku.dk>
Message-ID: <f8e6ff050912091610n2e8b56bcn8eb1f03b0f264d30@mail.gmail.com>

> Yes. The culprit would seem to be interaction(), as in
>
>> x <- y <- z <- 1:999
>> i <- interaction(x,y,z, drop=TRUE)
> Error: cannot allocate vector of size 3.7 Gb
>
> which is happening due to the occurrence of three idvar variables. This
> works basically as interaction(x,y,z)[,drop=TRUE], i.e. it first creates a
> factor with 999^3 levels, and removes the empty levels afterward.
>
> In the absense of a better interaction(), you might try making your own
> single idvar as do.call("paste",tbl[,c("ID", "DATE1", "DATE2")]) or so.

There's also ninteraction in the plyr package, which has been designed
to generate a unique integer for each combination (while maintaining
the original order of the data and any missing combinations) as
efficiently as possible.  It's much faster than interaction(..., drop
= T) and I hope it would be faster than paste since it works with
integers rather than strings.

Hadley

-- 
http://had.co.nz/


From pengyu.ut at gmail.com  Thu Dec 10 04:30:23 2009
From: pengyu.ut at gmail.com (Peng Yu)
Date: Wed, 9 Dec 2009 21:30:23 -0600
Subject: [Rd] split() is slow on data.frame (PR#14123)
In-Reply-To: <366c6f340912091929r513ff51dq254de52dd55983c@mail.gmail.com>
References: <20091209221009.B544F283200C@mail.pubhealth.ku.dk>
	<77EB52C6DD32BA4D87471DCD70C8D700023AB587@NA-PA-VBE03.na.tibco.com>
	<Pine.LNX.4.64.0912091541560.26818@tajo.ucsd.edu>
	<366c6f340912091929r513ff51dq254de52dd55983c@mail.gmail.com>
Message-ID: <366c6f340912091930y1ccf698cp295822492b5de3a7@mail.gmail.com>

I make a version for matrix. Because, it would be more efficient to
split each column of a matrix than to convert a matrix to a data.frame
then call split() on the data.frame. Note that the version for a
matrix and a data.frame is slightly different. Would somebody add this
in R as well?

split.matrix<-function(x,f) {
?#print('processing matrix')
?v=lapply(
? ? ?1:dim(x)[[2]]
? ? ?, function(i) {
? ? ? ?base:::split.default(x[,i],f)#the difference is here
? ? ?}
? ? ?)

?w=lapply(
? ? ?seq(along=v[[1]])
? ? ?, function(i) {
? ? ? ?result=do.call(
? ? ? ? ? ?cbind
? ? ? ? ? ?, lapply(v,
? ? ? ? ? ? ? ?function(vj) {
? ? ? ? ? ? ? ? ?vj[[i]]
? ? ? ? ? ? ? ?}
? ? ? ? ? ? ? ?)
? ? ? ? ? ?)
? ? ? ?colnames(result)=colnames(x)
? ? ? ?return(result)
? ? ?}
? ? ?)
?names(w)=names(v[[1]])
?return(w)
}


On Wed, Dec 9, 2009 at 5:44 PM, Charles C. Berry <cberry at tajo.ucsd.edu> wrote:
> On Wed, 9 Dec 2009, William Dunlap wrote:
>
>> Here are some differences between the current and proposed
>> split.data.frame.
>
> Adding 'drop=FALSE' fixes this case. See in line correction below.
>
> Chuck
>
>>
>>> d<-data.frame(Matrix=I(matrix(1:10, ncol=2)),
>>
>> Named=c(one=1,two=2,three=3,four=4,five=5),
>> row.names=as.character(1001:1005))
>>>
>>> group<-c("A","B","A","A","B")
>>> split.data.frame(d,group)
>>
>> $A
>> ? ?Matrix.1 Matrix.2 Named
>> 1001 ? ? ? ?1 ? ? ? ?6 ? ? 1
>> 1003 ? ? ? ?3 ? ? ? ?8 ? ? 3
>> 1004 ? ? ? ?4 ? ? ? ?9 ? ? 4
>>
>> $B
>> ? ?Matrix.1 Matrix.2 Named
>> 1002 ? ? ? ?2 ? ? ? ?7 ? ? 2
>> 1005 ? ? ? ?5 ? ? ? 10 ? ? 5
>>
>>> mysplit.data.frame(d,group) # lost row.names and 2nd column of Matrix
>>
>> [1] "processing data.frame"
>> $A
>> ? ?Matrix Named
>> [1,] ? ? ?1 ? ? 1
>> [2,] ? ? ?3 ? ? 3
>> [3,] ? ? ?4 ? ? 4
>>
>> $B
>> ? ?Matrix Named
>> [1,] ? ? ?2 ? ? 2
>> [2,] ? ? ?5 ? ? 5
>>
>>
>> Bill Dunlap
>> Spotfire, TIBCO Software
>> wdunlap tibco.com
>>
>>> -----Original Message-----
>>> From: r-devel-bounces at r-project.org
>>> [mailto:r-devel-bounces at r-project.org] On Behalf Of
>>> pengyu.ut at gmail.com
>>> Sent: Wednesday, December 09, 2009 2:10 PM
>>> To: r-devel at stat.math.ethz.ch
>>> Cc: R-bugs at r-project.org
>>> Subject: [Rd] split() is slow on data.frame (PR#14123)
>>>
>>> Please see the following code for the runtime comparison between
>>> split() and mysplit.data.frame() (they do the same thing
>>> semantically). mysplit.data.frame() is a fix of split() in term of
>>> performance. Could somebody include this fix (with possible checking
>>> for corner cases) in future version of R and let me know the inclusion
>>> of the fix?
>>>
>>> m=300000
>>> n=6
>>> k=30000
>>>
>>> set.seed(0)
>>> x=replicate(n,rnorm(m))
>>> f=sample(1:k, size=m, replace=T)
>>>
>>> mysplit.data.frame<-function(x,f) {
>>> ?print('processing data.frame')
>>> ?v=lapply(
>>> ? ? ?1:dim(x)[[2]]
>>> ? ? ?, function(i) {
>>> ? ? ? ?split(x[,i],f)
>
> Change to:
>
> ? ? ? ? split(x[,i,drop=FALSE],f)
>
>
>>> ? ? ?}
>>> ? ? ?)
>>>
>>> ?w=lapply(
>>> ? ? ?seq(along=v[[1]])
>>> ? ? ?, function(i) {
>>> ? ? ? ?result=do.call(
>>> ? ? ? ? ? ?cbind
>>> ? ? ? ? ? ?, lapply(v,
>>> ? ? ? ? ? ? ? ?function(vj) {
>>> ? ? ? ? ? ? ? ? ?vj[[i]]
>>> ? ? ? ? ? ? ? ?}
>>> ? ? ? ? ? ? ? ?)
>>> ? ? ? ? ? ?)
>>> ? ? ? ?colnames(result)=colnames(x)
>>> ? ? ? ?return(result)
>>> ? ? ?}
>>> ? ? ?)
>>> ?names(w)=names(v[[1]])
>>> ?return(w)
>>> }
>>>
>>> system.time(split(as.data.frame(x),f))
>>> system.time(mysplit.data.frame(as.data.frame(x),f))
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> Charles C. Berry ? ? ? ? ? ? ? ? ? ? ? ? ? ?(858) 534-2098
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?Dept of Family/Preventive
> Medicine
> E mailto:cberry at tajo.ucsd.edu ? ? ? ? ? ? ? UC San Diego
> http://famprevmed.ucsd.edu/faculty/cberry/ ?La Jolla, San Diego 92093-0901
>
>
>


From ripley at stats.ox.ac.uk  Thu Dec 10 08:00:36 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 10 Dec 2009 07:00:36 +0000 (GMT)
Subject: [Rd] Crash with Unicode and sub (PR#14114)
In-Reply-To: <OF0B94AA00.4DC7A5D5-ONC1257687.00341C48-C1257687.0034A852@DFD-Hamburg>
References: <OF0B94AA00.4DC7A5D5-ONC1257687.00341C48-C1257687.0034A852@DFD-Hamburg>
Message-ID: <alpine.LFD.2.00.0912092133390.548@gannet.stats.ox.ac.uk>

It seems (from the debugger output) that this is corruption in the R 
memory allocation routines.  Such things can usually be tracked down 
via valgrind and a valgrind-instrumented build of R, but I cannot 
trigger this on any system with valgrind.  I've tried 64- and 32-bit 
versions, and Latin-1 locales as well as UTF-8.

So I am inclining to think this is Windows-specific.  One thing that 
is specific to Windows is UCS-2 (16-bit) wide characters, which might 
be the issue.  But we simply don't have the tools on Windows that we 
do on other platforms.

On Wed, 9 Dec 2009, g.russell at eos-solutions.com wrote:

> Hello Peter,
>
> I have now installed R-2.10.1 RC (sessionInfo() says "R version 2.10.1 RC
> (2009-12-06 r50684)", the rest I believe is as before). The following code
> always brings R --vanilla down (with a crash, not a normal exit):
> -- cut here --
> gctorture()
> u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
> v <- rep(u,1e2)
> v <- sub(" ","",v)
> v %in% ""
> q()
> -- cut here --
>
> I've tried this several times now, with different effects. Sometimes R
> crashes after 'v %in% ""'. Sometimes it survives that command, but crashes
> during the q(). I have also had the error message "Fehler in match(x,
> table, nomatch = 0L) > 0L : Vergleich (6) ist nur f?r atomare und
> Listentypen m?glich" from that command (the match seems to be the
> problem), when I type q() R still crashes.
>
> Best wishes,
>
> George Russell | KG EOS Holding GmbH & Co
>
> Tel: +49 40 2850 ? 1574  | g.russell at eos-solutions.com
>
> EOS. With head and heart in finance
>
> KG EOS Holding GmbH & Co | Steindamm 71, 20099 Hamburg | AG Hamburg HRA 95
> 748
> Pers?nlich haftend | EOS Holding GmbH | AG Hamburg HRB 78 748
> Gesch?ftsf?hrer | Hans-Werner Scherer, Klaus Engberding, Justus
> Hecking-Veltman, Paul Leary sen., Christos Savvides, Dr. Andreas Witzig
> Vorsitzender des Beirates | J?rgen Schulte-Laggenbeck
>
> Save a tree. Don?t print this email unless it?s really necessary.
>
> Diese E-Mail enth?lt vertrauliche und/oder rechtlich gesch?tzte
> Informationen. Wenn Sie nicht der richtige Adressat sind oder diese E-Mail
> irrt?mlich erhalten haben, informieren Sie bitte sofort den Absender und
> vernichten Sie diese Mail. Das unerlaubte Kopieren sowie die unbefugte
> Weitergabe dieser Mail ist nicht gestattet.
>
> This email may contain confidential and/or privileged information.
> If you are not the intended recipient or have received this email in
> error, please notify the sender immediately and destroy this email.
> Any unauthorized copying, disclosure or distribution of the material in
> this email is strictly forbidden.
>
> Peter Dalgaard <P.Dalgaard at biostat.ku.dk> schrieb am 08.12.2009 11:24:50:
>
>> g.russell at eos-solutions.com wrote:
>>> Full_Name: George Russell
>>> Version: 2.10.0
>>> OS: Windows XP Version 2002 SP 2
>>> Submission from: (NULL) (217.111.3.131)
>>>
>>>
>>> The following typed into R --vanilla induces a crash:
>>> -- cut here --
>>> gctorture()
>>> u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
>>> v <- rep(u,1e2)
>>> v <- sub(" ","",v)
>>> v %in% ""
>>> -- cut here --
>>>
>>> sessionInfo() says:
>>>
>>> -- cut here --
>>> R version 2.10.0 (2009-10-26)
>>> i386-pc-mingw32
>>>
>>> locale:
>>> [1] LC_COLLATE=German_Germany.1252  LC_CTYPE=German_Germany.1252
>>> [3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C
>>> [5] LC_TIME=German_Germany.1252
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices datasets  utils     methods   base
>>> -- cut here --
>>>
>>> I apologise for not testing this with R-2.10.1 but as far as I can
>> see there are
>>> only source releases available so far, which I am not able to compile.
>>>
>>
>> 2.10.1 RC is available now. Please check. It does seem to be
>> reproducible in the Windows version, or at least it takes a very long
>> time, but that means running under Wine on SUSE for me. I don't see the
>> effect with the Linux build.
>>
>> --
>>    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>>   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
>>  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
>> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Thu Dec 10 08:05:26 2009
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Thu, 10 Dec 2009 08:05:26 +0100 (CET)
Subject: [Rd] Crash with Unicode and sub (PR#14114)
Message-ID: <20091210070526.1E12B282EFC5@mail.pubhealth.ku.dk>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--27464147-153156736-1260394708=:548
Content-Type: TEXT/PLAIN; CHARSET=UTF-8; format=flowed
Content-Transfer-Encoding: 8BIT
Content-ID: <alpine.LFD.2.00.0912092139001.548 at gannet.stats.ox.ac.uk>

It seems (from the debugger output) that this is corruption in the R 
memory allocation routines.  Such things can usually be tracked down 
via valgrind and a valgrind-instrumented build of R, but I cannot 
trigger this on any system with valgrind.  I've tried 64- and 32-bit 
versions, and Latin-1 locales as well as UTF-8.

So I am inclining to think this is Windows-specific.  One thing that 
is specific to Windows is UCS-2 (16-bit) wide characters, which might 
be the issue.  But we simply don't have the tools on Windows that we 
do on other platforms.

On Wed, 9 Dec 2009, g.russell at eos-solutions.com wrote:

> Hello Peter,
>
> I have now installed R-2.10.1 RC (sessionInfo() says "R version 2.10.1 RC
> (2009-12-06 r50684)", the rest I believe is as before). The following code
> always brings R --vanilla down (with a crash, not a normal exit):
> -- cut here --
> gctorture()
> u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
> v <- rep(u,1e2)
> v <- sub(" ","",v)
> v %in% ""
> q()
> -- cut here --
>
> I've tried this several times now, with different effects. Sometimes R
> crashes after 'v %in% ""'. Sometimes it survives that command, but crashes
> during the q(). I have also had the error message "Fehler in match(x,
> table, nomatch = 0L) > 0L : Vergleich (6) ist nur f??r atomare und
> Listentypen m??glich" from that command (the match seems to be the
> problem), when I type q() R still crashes.
>
> Best wishes,
>
> George Russell | KG EOS Holding GmbH & Co
>
> Tel: +49 40 2850 ??? 1574  | g.russell at eos-solutions.com
>
> EOS. With head and heart in finance
>
> KG EOS Holding GmbH & Co | Steindamm 71, 20099 Hamburg | AG Hamburg HRA 95
> 748
> Pers??nlich haftend | EOS Holding GmbH | AG Hamburg HRB 78 748
> Gesch??ftsf??hrer | Hans-Werner Scherer, Klaus Engberding, Justus
> Hecking-Veltman, Paul Leary sen., Christos Savvides, Dr. Andreas Witzig
> Vorsitzender des Beirates | J??rgen Schulte-Laggenbeck
>
> Save a tree. Don???t print this email unless it???s really necessary.
>
> Diese E-Mail enth??lt vertrauliche und/oder rechtlich gesch??tzte
> Informationen. Wenn Sie nicht der richtige Adressat sind oder diese E-Mail
> irrt??mlich erhalten haben, informieren Sie bitte sofort den Absender und
> vernichten Sie diese Mail. Das unerlaubte Kopieren sowie die unbefugte
> Weitergabe dieser Mail ist nicht gestattet.
>
> This email may contain confidential and/or privileged information.
> If you are not the intended recipient or have received this email in
> error, please notify the sender immediately and destroy this email.
> Any unauthorized copying, disclosure or distribution of the material in
> this email is strictly forbidden.
>
> Peter Dalgaard <P.Dalgaard at biostat.ku.dk> schrieb am 08.12.2009 11:24:50:
>
>> g.russell at eos-solutions.com wrote:
>>> Full_Name: George Russell
>>> Version: 2.10.0
>>> OS: Windows XP Version 2002 SP 2
>>> Submission from: (NULL) (217.111.3.131)
>>>
>>>
>>> The following typed into R --vanilla induces a crash:
>>> -- cut here --
>>> gctorture()
>>> u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
>>> v <- rep(u,1e2)
>>> v <- sub(" ","",v)
>>> v %in% ""
>>> -- cut here --
>>>
>>> sessionInfo() says:
>>>
>>> -- cut here --
>>> R version 2.10.0 (2009-10-26)
>>> i386-pc-mingw32
>>>
>>> locale:
>>> [1] LC_COLLATE=German_Germany.1252  LC_CTYPE=German_Germany.1252
>>> [3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C
>>> [5] LC_TIME=German_Germany.1252
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices datasets  utils     methods   base
>>> -- cut here --
>>>
>>> I apologise for not testing this with R-2.10.1 but as far as I can
>> see there are
>>> only source releases available so far, which I am not able to compile.
>>>
>>
>> 2.10.1 RC is available now. Please check. It does seem to be
>> reproducible in the Windows version, or at least it takes a very long
>> time, but that means running under Wine on SUSE for me. I don't see the
>> effect with the Linux build.
>>
>> --
>>    O__  ---- Peter Dalgaard             ??ster Farimagsgade 5, Entr.B
>>   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
>>  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
>> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595
--27464147-153156736-1260394708=:548--


From ripley at stats.ox.ac.uk  Thu Dec 10 09:16:44 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 10 Dec 2009 08:16:44 +0000 (GMT)
Subject: [Rd] Recent TeX changes and R/package manuals
In-Reply-To: <alpine.LFD.2.00.0912091253370.27460@gannet.stats.ox.ac.uk>
References: <alpine.LFD.2.00.0912091253370.27460@gannet.stats.ox.ac.uk>
Message-ID: <alpine.LFD.2.00.0912100812260.4482@gannet.stats.ox.ac.uk>

I've managed to find a workaround for point (ii) in the Rd processing, 
so that will make 2.10.1.  (In all cases the primary cause was an 
alias containing |, although in some cases that cascaded to a 
different LaTeX error.)

On Wed, 9 Dec 2009, Prof Brian Ripley wrote:

> As some of you will be aware, TeXLive 2009 was released last month having 
> blocked updates on earlier versions since May.  This has lead to a flood of 
> updates of LaTeX packages, as a result of which the PDF manuals of R 2.10.0 
> and earlier will no longer build, for two separate reasons.
>
> For MiKTeX users: at least version 2.8 (the current one) has the same updates 
> (a week or so later) and has the same issues.
>
> After some workarounds, 2.10.1 RC and R-devel do build their manuals for me 
> on TL2009 on Linux, MacTeX 2009 (a TL2009 derivative) on Mac OS X and current 
> MiKTeX 2.8 on Windows.
>
> As far as I can tell, the following CRAN package manuals have been affected:
>
>  distrMod, RCurl, RGtk2, SparseM, VIM, bit, ggplot2, operators,
>  relations, spam, tensorA
>
> (and only distrMod fatally).
>
> Given the current pace of change (ca 100 updates/week on 'only' 2000 TL 
> packages), more things may pop out of the woodwork.
>
> For the curious and cognescenti:
>
> (i) hyperref is having problems with markup in \section titles, which 
> 'methods' and 'distrMod' had.  I've added a warning to the R-exts manual.
>
>
> (ii) there have been intermittent problems with (LaTeX) special characters in 
> indices.  But (hyperref 6.79d)
>
>  Full support of makeindex?s encap feature (e.g.
>  \index{alpha|textbf}). \hyperpage and the formatting command are
>  cascaded via \hyperindexformat. Internally \index{alpha|textbf} is
>  transferred to \index{alpha|hyperindexformat{\textbf}}.
>  \hyperindexformat calls the formatting command in its first argument
>  with the page range as argument that is put into \hyperpage. The
>  formatting command may call \hyperpage itself, it will be disabled
>  automatically to prevent nested \hyperpage commands.
>
> has broken '|' as an index item ('||' was already broken) so I added some 
> special-casing (this does look like a bug in hyperref).  Also some uses of 
> '%' (ggplot2, operators, relations).
>
>
> (iii) some LaTeX style files are no longer in TL2009. e.g. floatflt.sty (used 
> by packages EffectiveDose, gWidgets, gWidgetsWWW, monoProc, pmg).
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From sgiannerini at gmail.com  Thu Dec 10 09:30:10 2009
From: sgiannerini at gmail.com (sgiannerini at gmail.com)
Date: Thu, 10 Dec 2009 09:30:10 +0100 (CET)
Subject: [Rd] switch() called with just the EXPR argument causes R to hang
	(PR#14124)
Message-ID: <20091210083010.477662832010@mail.pubhealth.ku.dk>

Dear all,

switch() called with just the EXPR argument causes R to hang so that the
only way to stop it is to kill R.

Reproducible example:

> switch(EXPR="a")

the internal C subroutine behind switch is do_switch located in
R/src/main/builtin.c
For convenience I reproduce it below.

*****************************************************************************
SEXP attribute_hidden do_switch(SEXP call, SEXP op, SEXP args, SEXP rho)
{
    int argval;
    SEXP x, y, w;
    x = eval(CAR(args), rho);
    if (!isVector(x) || length(x) != 1)
    error(_("switch: EXPR must return a length 1 vector"));
    PROTECT(w = switchList(CDR(args), rho));
    if (isString(x)) {
    for (y = w; y != R_NilValue; y = CDR(y))
        if (TAG(y) != R_NilValue && pmatch(STRING_ELT(x, 0), TAG(y), 1)) {
        while (CAR(y) == R_MissingArg && y != R_NilValue)
            y = CDR(y);
        UNPROTECT(1);
        return (eval(CAR(y), rho));
        }
    for (y = w; y != R_NilValue; y = CDR(y))
        if (TAG(y) == R_NilValue) {
        UNPROTECT(1);
        return (eval(CAR(y), rho));
        }
    UNPROTECT(1);
    return R_NilValue;
    }
    argval = asInteger(x);
    if (argval <= 0 || argval > (length(w))) {
    UNPROTECT(1);
    return R_NilValue;
    }
    x = eval(CAR(nthcdr(w, argval - 1)), rho);
    UNPROTECT(1);
    return x;
}
**************************************************************************

I do not know C but it seems to me that do_switch expects two arguments.

regards

Simone

tested both on Windows VISTA 32 bit

platform       i386-pc-mingw32
arch           i386
os             mingw32
system         i386, mingw32
status
major          2
minor          10.0
year           2009
month          10
day            26
svn rev        50208
language       R
version.string R version 2.10.0 (2009-10-26)

and on Linux OpenSuSE 11.0 64bit

> R.version
               _
platform       x86_64-unknown-linux-gnu
arch           x86_64
os             linux-gnu
system         x86_64, linux-gnu
status         Patched
major          2
minor          10.0
year           2009
month          11
day            19
svn rev        50499
language       R
version.string R version 2.10.0 Patched (2009-11-19 r50499)


-- 
______________________________________________________

Simone Giannerini
Dipartimento di Scienze Statistiche "Paolo Fortunati"
Universita' di Bologna
Via delle belle arti 41 - 40126  Bologna,  ITALY
Tel: +39 051 2098262  Fax: +39 051 232153
http://www2.stat.unibo.it/giannerini/
______________________________________________________

	[[alternative HTML version deleted]]


From karl at huftis.org  Thu Dec 10 10:20:09 2009
From: karl at huftis.org (karl at huftis.org)
Date: Thu, 10 Dec 2009 10:20:09 +0100 (CET)
Subject: [Rd] R on Windows crashes when using certain characters in strings
	in data frames (PR#14125)
Message-ID: <20091210092009.D1A7A282EFC8@mail.pubhealth.ku.dk>

Full_Name: Karl Ove Hufthammer
Version: 2.10.0
OS: Windows XP
Submission from: (NULL) (93.124.134.66)


I have found a rather strange bug in R 2.10.0 on Windows, where the choice of
characters used in a string make R crash (i.e., Windows shows a dialogue saying
that the application has a problem, and must be closed).

I can reproduce the bug on two separate systems running Windows XP, and with
both R 2.10.0 and the latest R.2.10.1 RC.

The following commands trigger the crash for me:

n=1e5
k=10
x=sample(k,n,replace=TRUE)
y=sample(k,n,replace=TRUE)
xy=paste(x,y,sep=" ? ")
z=sample(n)
d=data.frame(xy,z)

The last step takes very long time, and R crashes before it's finished. Note
that if I reduce n, the problem disappears. Also, if I change the ? (a
multiplication symbol) to a x (a letter), the problem also disappears (and the
last command takes almost no time to run).

I originally discovered this (or a related?) bug while using 'unique' on a data
frame similar to the 'd' data frame defined above, where R would often, but not
always, crash. 

> sessionInfo()
R version 2.10.0 (2009-10-26) 
i386-pc-mingw32 

locale:
[1] LC_COLLATE=Norwegian-Nynorsk_Norway.1252 
[2] LC_CTYPE=Norwegian-Nynorsk_Norway.1252   
[3] LC_MONETARY=Norwegian-Nynorsk_Norway.1252
[4] LC_NUMERIC=C                             
[5] LC_TIME=Norwegian-Nynorsk_Norway.1252    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


From g.russell at eos-solutions.com  Thu Dec 10 09:43:41 2009
From: g.russell at eos-solutions.com (g.russell at eos-solutions.com)
Date: Thu, 10 Dec 2009 09:43:41 +0100
Subject: [Rd] Antwort: Re:  Crash with Unicode and sub (PR#14114)
In-Reply-To: <alpine.LFD.2.00.0912092133390.548@gannet.stats.ox.ac.uk>
Message-ID: <OF3066E4FD.34FE4D03-ONC1257688.002BDB6F-C1257688.002FF22C@DFD-Hamburg>

I don't know about the technicalities, but Peter Dalgaard said the 
offending code also causes R to come to a stop using SUSE + WINE. Is it 
possible to run that lot on top of valgrind? Of course, it will probably 
take all day ...

If not, I have a  clue which might help. The problem seems to lie in the 
"sub" routine. In the original report I used
-- cut here --
gctorture()
u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
v <- rep(u,1e2)
v <- sub(" ","",v)
v %in% ""
-- cut here --

I've tried reducing this a bit more. Replacing intToUtf8 with a direct 
assignment writing out the string with Unicode escapes seems to make no 
difference. The %in% can be replaced with "match", leaving the following:
-- cut here --
gctorture()
u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
v <- rep(u,1e2)
v <- sub(" ","",v)
match(v,"")
-- cut here --
This also crashes R-2.10.0 and R-2.10.1 RC (2009-12-06 r50684).

The sub line is essential, so far as I can see, without it we don't get 
the crash. If we add "perl = TRUE" this seems to make no difference (there 
is still a crash). If instead we use "fixed = TRUE", the result is strange 
and differs for R-2.10.0 and R-2.10.1 RC. This is especially strange, 
because in an unbugged R, the result of v returned from sub should be the 
same either with fixed = TRUE or perl = TRUE.

R-2.10.0 pauses several seconds, then produces the enigmatic output:
> match(v,"")
  [1] 00 00 06 9d 78 9c cd 54 5d 4f 83 30 14 2d ec 9b a9 33 99 2f fe 89 65 
1a e3
 [26] c3 de 8c 26 be 38 7d d5 c7 4a af 0c 57 ca 42 cb 8c bf dc 18 93 61 29 
1d 83
 [51] 8e 7d c4 18 23 49 a1 f4 de 9e 7b 4e ef 81 47 07 21 64 23 5b 3e ec 1a 
42 56
 [76] 4b de ea b6 5c b3 e4 e8 c8 d1 f2 80 41 e4 bb 32 7e 5c 58 ae f3 49 f8 
66 a6
[101] ce b0 3b c5 1e c8 69 31 b5 15 80 98 84 84 cb e9 22 db 61 27 1b 53 4a 
80 0d
[126] 2f 0a e3 99 9c f4 91 ba 4a 41 67 8e 69 0c d7 14 73 ae d1 cc 8c 0e f7 
3d 86
[151] 45 1c 81 41 be 19 3e bf 82 2b 4c 40 ee 07 33 0a 0f 8c be a7 6f 3a 62 
ad 68
[176] af e8 12 78 c1 31 15 c8 aa 9d 9a a1 5c 89 dd 57 cb eb 27 da 14 38 f2 
20 dd
[201] 5c 45 ba c1 70 00 9b 14 35 dc 4c 6e 49 4d 51 e6 8e d3 4d 95 54 aa f1 
19 90
[226] 32 21 27 29 73 e8 26 bf 53 d6 32 71 0a 4e da 01 51 49 e3 84 48 77 ce 
81 dc
[251] 64 2d 19 ab 0d 7b 33 42 9f 99 42 64 af a7 a8 5e 9d 0f ce 86 83 a1 d9 
c1 a5
[276] 7f d0 97 86 69 16 a2 dd 54 90 a6 93 21 1f 25 ba c2 d2 54 68 25 c8 31 
49 d6
[301] ae ee 9f 2a ba d4 96 a6 89 03 60 22 83 2b 3b 17 53 3a ce 79 17 3e 96 
b5 d3
[326] ea ea b4 3b 9f 8b 9f b9 a5 cd a7 40 41 84 4c a9 ce dd dd 49 fe c6 3e 
07 7f
[351] 54 e7 7f d9 f4 50 77 5c 19 a9 e0 b9 5e b2 dd 60 79 6c 13 ad 1e 17 98 
11 1c
[376] 91 db e5 5f 7e df 0f e7 43 57 c9 7d 01 6c 3e 1a 5d 0c 2f ab 99 6e a9 
a8 88
[401] 57 1c 35 5a 7c 03 73 22 e4 b1

R-2.10.1 RC produces the following equally enigmatic output:
> match(v,"")
NULL
Fehler: 'getEncChar' muss f?r CHARSXP aufgerufen werden

So my provisional guess is the bug is somewhere in the part of the 
internal code for sub which is invoked whatever the value of fixed or 
perl. It is strange though that it makes a difference whether you specify 
fixed = TRUE or not.

George Russell


Prof Brian Ripley <ripley at stats.ox.ac.uk> schrieb am 10.12.2009 08:00:36:

> It seems (from the debugger output) that this is corruption in the R 
> memory allocation routines.  Such things can usually be tracked down 
> via valgrind and a valgrind-instrumented build of R, but I cannot 
> trigger this on any system with valgrind.  I've tried 64- and 32-bit 
> versions, and Latin-1 locales as well as UTF-8.
> 
> So I am inclining to think this is Windows-specific.  One thing that 
> is specific to Windows is UCS-2 (16-bit) wide characters, which might 
> be the issue.  But we simply don't have the tools on Windows that we 
> do on other platforms.
> 
> On Wed, 9 Dec 2009, g.russell at eos-solutions.com wrote:
> 
> > Hello Peter,
> >
> > I have now installed R-2.10.1 RC (sessionInfo() says "R version 2.10.1 
RC
> > (2009-12-06 r50684)", the rest I believe is as before). The following 
code
> > always brings R --vanilla down (with a crash, not a normal exit):
> > -- cut here --
> > gctorture()
> > u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
> > v <- rep(u,1e2)
> > v <- sub(" ","",v)
> > v %in% ""
> > q()
> > -- cut here --
> >
> > I've tried this several times now, with different effects. Sometimes R
> > crashes after 'v %in% ""'. Sometimes it survives that command, but 
crashes
> > during the q(). I have also had the error message "Fehler in match(x,
> > table, nomatch = 0L) > 0L : Vergleich (6) ist nur f?r atomare und
> > Listentypen m?glich" from that command (the match seems to be the
> > problem), when I type q() R still crashes.
> >
> > Best wishes,
> >
> > George Russell | KG EOS Holding GmbH & Co
> >
> > Tel: +49 40 2850 ? 1574  | g.russell at eos-solutions.com
> >
> > EOS. With head and heart in finance
> >
> > KG EOS Holding GmbH & Co | Steindamm 71, 20099 Hamburg | AG Hamburg 
HRA 95
> > 748
> > Pers?nlich haftend | EOS Holding GmbH | AG Hamburg HRB 78 748
> > Gesch?ftsf?hrer | Hans-Werner Scherer, Klaus Engberding, Justus
> > Hecking-Veltman, Paul Leary sen., Christos Savvides, Dr. Andreas 
Witzig
> > Vorsitzender des Beirates | J?rgen Schulte-Laggenbeck
> >
> > Save a tree. Don?t print this email unless it?s really necessary.
> >
> > Diese E-Mail enth?lt vertrauliche und/oder rechtlich gesch?tzte
> > Informationen. Wenn Sie nicht der richtige Adressat sind oder diese 
E-Mail
> > irrt?mlich erhalten haben, informieren Sie bitte sofort den Absender 
und
> > vernichten Sie diese Mail. Das unerlaubte Kopieren sowie die unbefugte
> > Weitergabe dieser Mail ist nicht gestattet.
> >
> > This email may contain confidential and/or privileged information.
> > If you are not the intended recipient or have received this email in
> > error, please notify the sender immediately and destroy this email.
> > Any unauthorized copying, disclosure or distribution of the material 
in
> > this email is strictly forbidden.
> >
> > Peter Dalgaard <P.Dalgaard at biostat.ku.dk> schrieb am 08.12.2009 
11:24:50:
> >
> >> g.russell at eos-solutions.com wrote:
> >>> Full_Name: George Russell
> >>> Version: 2.10.0
> >>> OS: Windows XP Version 2002 SP 2
> >>> Submission from: (NULL) (217.111.3.131)
> >>>
> >>>
> >>> The following typed into R --vanilla induces a crash:
> >>> -- cut here --
> >>> gctorture()
> >>> u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
> >>> v <- rep(u,1e2)
> >>> v <- sub(" ","",v)
> >>> v %in% ""
> >>> -- cut here --
> >>>
> >>> sessionInfo() says:
> >>>
> >>> -- cut here --
> >>> R version 2.10.0 (2009-10-26)
> >>> i386-pc-mingw32
> >>>
> >>> locale:
> >>> [1] LC_COLLATE=German_Germany.1252  LC_CTYPE=German_Germany.1252
> >>> [3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C
> >>> [5] LC_TIME=German_Germany.1252
> >>>
> >>> attached base packages:
> >>> [1] stats     graphics  grDevices datasets  utils     methods   base
> >>> -- cut here --
> >>>
> >>> I apologise for not testing this with R-2.10.1 but as far as I can
> >> see there are
> >>> only source releases available so far, which I am not able to 
compile.
> >>>
> >>
> >> 2.10.1 RC is available now. Please check. It does seem to be
> >> reproducible in the Windows version, or at least it takes a very long
> >> time, but that means running under Wine on SUSE for me. I don't see 
the
> >> effect with the Linux build.
> >>
> >> --
> >>    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
> >>   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> >>  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 
35327918
> >> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 
35327907
> >>
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From g.russell at eos-solutions.com  Thu Dec 10 09:45:33 2009
From: g.russell at eos-solutions.com (g.russell at eos-solutions.com)
Date: Thu, 10 Dec 2009 09:45:33 +0100 (CET)
Subject: [Rd] Antwort: Re:  Crash with Unicode and sub (PR#14114)
Message-ID: <20091210084533.DF2262832014@mail.pubhealth.ku.dk>

SSBkb24ndCBrbm93IGFib3V0IHRoZSB0ZWNobmljYWxpdGllcywgYnV0IFBldGVyIERhbGdhYXJk
IHNhaWQgdGhlIA0Kb2ZmZW5kaW5nIGNvZGUgYWxzbyBjYXVzZXMgUiB0byBjb21lIHRvIGEgc3Rv
cCB1c2luZyBTVVNFICsgV0lORS4gSXMgaXQgDQpwb3NzaWJsZSB0byBydW4gdGhhdCBsb3Qgb24g
dG9wIG9mIHZhbGdyaW5kPyBPZiBjb3Vyc2UsIGl0IHdpbGwgcHJvYmFibHkgDQp0YWtlIGFsbCBk
YXkgLi4uDQoNCklmIG5vdCwgSSBoYXZlIGEgIGNsdWUgd2hpY2ggbWlnaHQgaGVscC4gVGhlIHBy
b2JsZW0gc2VlbXMgdG8gbGllIGluIHRoZSANCiJzdWIiIHJvdXRpbmUuIEluIHRoZSBvcmlnaW5h
bCByZXBvcnQgSSB1c2VkDQotLSBjdXQgaGVyZSAtLQ0KZ2N0b3J0dXJlKCkNCnUgPC0gaW50VG9V
dGY4KGMocmVwKDFlMywxZTIpLDMyLGMocmVwKDFlMywxZTIpKSkpDQp2IDwtIHJlcCh1LDFlMikN
CnYgPC0gc3ViKCIgIiwiIix2KQ0KdiAlaW4lICIiDQotLSBjdXQgaGVyZSAtLQ0KDQpJJ3ZlIHRy
aWVkIHJlZHVjaW5nIHRoaXMgYSBiaXQgbW9yZS4gUmVwbGFjaW5nIGludFRvVXRmOCB3aXRoIGEg
ZGlyZWN0IA0KYXNzaWdubWVudCB3cml0aW5nIG91dCB0aGUgc3RyaW5nIHdpdGggVW5pY29kZSBl
c2NhcGVzIHNlZW1zIHRvIG1ha2Ugbm8gDQpkaWZmZXJlbmNlLiBUaGUgJWluJSBjYW4gYmUgcmVw
bGFjZWQgd2l0aCAibWF0Y2giLCBsZWF2aW5nIHRoZSBmb2xsb3dpbmc6DQotLSBjdXQgaGVyZSAt
LQ0KZ2N0b3J0dXJlKCkNCnUgPC0gaW50VG9VdGY4KGMocmVwKDFlMywxZTIpLDMyLGMocmVwKDFl
MywxZTIpKSkpDQp2IDwtIHJlcCh1LDFlMikNCnYgPC0gc3ViKCIgIiwiIix2KQ0KbWF0Y2godiwi
IikNCi0tIGN1dCBoZXJlIC0tDQpUaGlzIGFsc28gY3Jhc2hlcyBSLTIuMTAuMCBhbmQgUi0yLjEw
LjEgUkMgKDIwMDktMTItMDYgcjUwNjg0KS4NCg0KVGhlIHN1YiBsaW5lIGlzIGVzc2VudGlhbCwg
c28gZmFyIGFzIEkgY2FuIHNlZSwgd2l0aG91dCBpdCB3ZSBkb24ndCBnZXQgDQp0aGUgY3Jhc2gu
IElmIHdlIGFkZCAicGVybCA9IFRSVUUiIHRoaXMgc2VlbXMgdG8gbWFrZSBubyBkaWZmZXJlbmNl
ICh0aGVyZSANCmlzIHN0aWxsIGEgY3Jhc2gpLiBJZiBpbnN0ZWFkIHdlIHVzZSAiZml4ZWQgPSBU
UlVFIiwgdGhlIHJlc3VsdCBpcyBzdHJhbmdlIA0KYW5kIGRpZmZlcnMgZm9yIFItMi4xMC4wIGFu
ZCBSLTIuMTAuMSBSQy4gVGhpcyBpcyBlc3BlY2lhbGx5IHN0cmFuZ2UsIA0KYmVjYXVzZSBpbiBh
biB1bmJ1Z2dlZCBSLCB0aGUgcmVzdWx0IG9mIHYgcmV0dXJuZWQgZnJvbSBzdWIgc2hvdWxkIGJl
IHRoZSANCnNhbWUgZWl0aGVyIHdpdGggZml4ZWQgPSBUUlVFIG9yIHBlcmwgPSBUUlVFLg0KDQpS
LTIuMTAuMCBwYXVzZXMgc2V2ZXJhbCBzZWNvbmRzLCB0aGVuIHByb2R1Y2VzIHRoZSBlbmlnbWF0
aWMgb3V0cHV0Og0KPiBtYXRjaCh2LCIiKQ0KICBbMV0gMDAgMDAgMDYgOWQgNzggOWMgY2QgNTQg
NWQgNGYgODMgMzAgMTQgMmQgZWMgOWIgYTkgMzMgOTkgMmYgZmUgODkgNjUgDQoxYSBlMw0KIFsy
Nl0gYzMgZGUgOGMgMjYgYmUgMzggN2QgZDUgYzcgNGEgYWYgMGMgNTcgY2EgNDIgY2IgOGMgYmYg
ZGMgMTggOTMgNjEgMjkgDQoxZCA4Mw0KIFs1MV0gOGUgN2QgYzQgMTggMjMgNDkgYTEgZjQgZGUg
OWUgN2IgNGUgZWYgODEgNDcgMDcgMjEgNjQgMjMgNWIgM2UgZWMgMWEgDQo0MiA1Ng0KIFs3Nl0g
NGIgZGUgZWEgYjYgNWMgYjMgZTQgZTggYzggZDEgZjIgODAgNDEgZTQgYmIgMzIgN2UgNWMgNTgg
YWUgZjMgNDkgZjggDQo2NiBhNg0KWzEwMV0gY2UgYjAgM2IgYzUgMWUgYzggNjkgMzEgYjUgMTUg
ODAgOTggODQgODQgY2IgZTkgMjIgZGIgNjEgMjcgMWIgNTMgNGEgDQo4MCAwZA0KWzEyNl0gMmYg
MGEgZTMgOTkgOWMgZjQgOTEgYmEgNGEgNDEgNjcgOGUgNjkgMGMgZDcgMTQgNzMgYWUgZDEgY2Mg
OGMgMGUgZjcgDQozZCA4Ng0KWzE1MV0gNDUgMWMgODEgNDEgYmUgMTkgM2UgYmYgODIgMmIgNGMg
NDAgZWUgMDcgMzMgMGEgMGYgOGMgYmUgYTcgNmYgM2EgNjIgDQphZCA2OA0KWzE3Nl0gYWYgZTgg
MTIgNzggYzEgMzEgMTUgYzggYWEgOWQgOWEgYTEgNWMgODkgZGQgNTcgY2IgZWIgMjcgZGEgMTQg
MzggZjIgDQoyMCBkZA0KWzIwMV0gNWMgNDUgYmEgYzEgNzAgMDAgOWIgMTQgMzUgZGMgNGMgNmUg
NDkgNGQgNTEgZTYgOGUgZDMgNGQgOTUgNTQgYWEgZjEgDQoxOSA5MA0KWzIyNl0gMzIgMjEgMjcg
MjkgNzMgZTggMjYgYmYgNTMgZDYgMzIgNzEgMGEgNGUgZGEgMDEgNTEgNDkgZTMgODQgNDggNzcg
Y2UgDQo4MSBkYw0KWzI1MV0gNjQgMmQgMTkgYWIgMGQgN2IgMzMgNDIgOWYgOTkgNDIgNjQgYWYg
YTcgYTggNWUgOWQgMGYgY2UgODYgODMgYTEgZDkgDQpjMSBhNQ0KWzI3Nl0gN2YgZDAgOTcgODYg
NjkgMTYgYTIgZGQgNTQgOTAgYTYgOTMgMjEgMWYgMjUgYmEgYzIgZDIgNTQgNjggMjUgYzggMzEg
DQo0OSBkNg0KWzMwMV0gYWUgZWUgOWYgMmEgYmEgZDQgOTYgYTYgODkgMDMgNjAgMjIgODMgMmIg
M2IgMTcgNTMgM2EgY2UgNzkgMTcgM2UgOTYgDQpiNSBkMw0KWzMyNl0gZWEgZWEgYjQgM2IgOWYg
OGIgOWYgYjkgYTUgY2QgYTcgNDAgNDEgODQgNGMgYTkgY2UgZGQgZGQgNDkgZmUgYzYgM2UgDQow
NyA3Zg0KWzM1MV0gNTQgZTcgN2YgZDkgZjQgNTAgNzcgNWMgMTkgYTkgZTAgYjkgNWUgYjIgZGQg
NjAgNzkgNmMgMTMgYWQgMWUgMTcgOTggDQoxMSAxYw0KWzM3Nl0gOTEgZGIgZTUgNWYgN2UgZGYg
MGYgZTcgNDMgNTcgYzkgN2QgMDEgNmMgM2UgMWEgNWQgMGMgMmYgYWIgOTkgNmUgYTkgDQphOCA4
OA0KWzQwMV0gNTcgMWMgMzUgNWEgN2MgMDMgNzMgMjIgZTQgYjENCg0KUi0yLjEwLjEgUkMgcHJv
ZHVjZXMgdGhlIGZvbGxvd2luZyBlcXVhbGx5IGVuaWdtYXRpYyBvdXRwdXQ6DQo+IG1hdGNoKHYs
IiIpDQpOVUxMDQpGZWhsZXI6ICdnZXRFbmNDaGFyJyBtdXNzIGbDvHIgQ0hBUlNYUCBhdWZnZXJ1
ZmVuIHdlcmRlbg0KDQpTbyBteSBwcm92aXNpb25hbCBndWVzcyBpcyB0aGUgYnVnIGlzIHNvbWV3
aGVyZSBpbiB0aGUgcGFydCBvZiB0aGUgDQppbnRlcm5hbCBjb2RlIGZvciBzdWIgd2hpY2ggaXMg
aW52b2tlZCB3aGF0ZXZlciB0aGUgdmFsdWUgb2YgZml4ZWQgb3IgDQpwZXJsLiBJdCBpcyBzdHJh
bmdlIHRob3VnaCB0aGF0IGl0IG1ha2VzIGEgZGlmZmVyZW5jZSB3aGV0aGVyIHlvdSBzcGVjaWZ5
IA0KZml4ZWQgPSBUUlVFIG9yIG5vdC4NCg0KR2VvcmdlIFJ1c3NlbGwNCg0KDQpQcm9mIEJyaWFu
IFJpcGxleSA8cmlwbGV5QHN0YXRzLm94LmFjLnVrPiBzY2hyaWViIGFtIDEwLjEyLjIwMDkgMDg6
MDA6MzY6DQoNCj4gSXQgc2VlbXMgKGZyb20gdGhlIGRlYnVnZ2VyIG91dHB1dCkgdGhhdCB0aGlz
IGlzIGNvcnJ1cHRpb24gaW4gdGhlIFIgDQo+IG1lbW9yeSBhbGxvY2F0aW9uIHJvdXRpbmVzLiAg
U3VjaCB0aGluZ3MgY2FuIHVzdWFsbHkgYmUgdHJhY2tlZCBkb3duIA0KPiB2aWEgdmFsZ3JpbmQg
YW5kIGEgdmFsZ3JpbmQtaW5zdHJ1bWVudGVkIGJ1aWxkIG9mIFIsIGJ1dCBJIGNhbm5vdCANCj4g
dHJpZ2dlciB0aGlzIG9uIGFueSBzeXN0ZW0gd2l0aCB2YWxncmluZC4gIEkndmUgdHJpZWQgNjQt
IGFuZCAzMi1iaXQgDQo+IHZlcnNpb25zLCBhbmQgTGF0aW4tMSBsb2NhbGVzIGFzIHdlbGwgYXMg
VVRGLTguDQo+IA0KPiBTbyBJIGFtIGluY2xpbmluZyB0byB0aGluayB0aGlzIGlzIFdpbmRvd3Mt
c3BlY2lmaWMuICBPbmUgdGhpbmcgdGhhdCANCj4gaXMgc3BlY2lmaWMgdG8gV2luZG93cyBpcyBV
Q1MtMiAoMTYtYml0KSB3aWRlIGNoYXJhY3RlcnMsIHdoaWNoIG1pZ2h0IA0KPiBiZSB0aGUgaXNz
dWUuICBCdXQgd2Ugc2ltcGx5IGRvbid0IGhhdmUgdGhlIHRvb2xzIG9uIFdpbmRvd3MgdGhhdCB3
ZSANCj4gZG8gb24gb3RoZXIgcGxhdGZvcm1zLg0KPiANCj4gT24gV2VkLCA5IERlYyAyMDA5LCBn
LnJ1c3NlbGxAZW9zLXNvbHV0aW9ucy5jb20gd3JvdGU6DQo+IA0KPiA+IEhlbGxvIFBldGVyLA0K
PiA+DQo+ID4gSSBoYXZlIG5vdyBpbnN0YWxsZWQgUi0yLjEwLjEgUkMgKHNlc3Npb25JbmZvKCkg
c2F5cyAiUiB2ZXJzaW9uIDIuMTAuMSANClJDDQo+ID4gKDIwMDktMTItMDYgcjUwNjg0KSIsIHRo
ZSByZXN0IEkgYmVsaWV2ZSBpcyBhcyBiZWZvcmUpLiBUaGUgZm9sbG93aW5nIA0KY29kZQ0KPiA+
IGFsd2F5cyBicmluZ3MgUiAtLXZhbmlsbGEgZG93biAod2l0aCBhIGNyYXNoLCBub3QgYSBub3Jt
YWwgZXhpdCk6DQo+ID4gLS0gY3V0IGhlcmUgLS0NCj4gPiBnY3RvcnR1cmUoKQ0KPiA+IHUgPC0g
aW50VG9VdGY4KGMocmVwKDFlMywxZTIpLDMyLGMocmVwKDFlMywxZTIpKSkpDQo+ID4gdiA8LSBy
ZXAodSwxZTIpDQo+ID4gdiA8LSBzdWIoIiAiLCIiLHYpDQo+ID4gdiAlaW4lICIiDQo+ID4gcSgp
DQo+ID4gLS0gY3V0IGhlcmUgLS0NCj4gPg0KPiA+IEkndmUgdHJpZWQgdGhpcyBzZXZlcmFsIHRp
bWVzIG5vdywgd2l0aCBkaWZmZXJlbnQgZWZmZWN0cy4gU29tZXRpbWVzIFINCj4gPiBjcmFzaGVz
IGFmdGVyICd2ICVpbiUgIiInLiBTb21ldGltZXMgaXQgc3Vydml2ZXMgdGhhdCBjb21tYW5kLCBi
dXQgDQpjcmFzaGVzDQo+ID4gZHVyaW5nIHRoZSBxKCkuIEkgaGF2ZSBhbHNvIGhhZCB0aGUgZXJy
b3IgbWVzc2FnZSAiRmVobGVyIGluIG1hdGNoKHgsDQo+ID4gdGFibGUsIG5vbWF0Y2ggPSAwTCkg
PiAwTCA6IFZlcmdsZWljaCAoNikgaXN0IG51ciBmw7xyIGF0b21hcmUgdW5kDQo+ID4gTGlzdGVu
dHlwZW4gbcO2Z2xpY2giIGZyb20gdGhhdCBjb21tYW5kICh0aGUgbWF0Y2ggc2VlbXMgdG8gYmUg
dGhlDQo+ID4gcHJvYmxlbSksIHdoZW4gSSB0eXBlIHEoKSBSIHN0aWxsIGNyYXNoZXMuDQo+ID4N
Cj4gPiBCZXN0IHdpc2hlcywNCj4gPg0KPiA+IEdlb3JnZSBSdXNzZWxsIHwgS0cgRU9TIEhvbGRp
bmcgR21iSCAmIENvDQo+ID4NCj4gPiBUZWw6ICs0OSA0MCAyODUwIOKAkyAxNTc0ICB8IGcucnVz
c2VsbEBlb3Mtc29sdXRpb25zLmNvbQ0KPiA+DQo+ID4gRU9TLiBXaXRoIGhlYWQgYW5kIGhlYXJ0
IGluIGZpbmFuY2UNCj4gPg0KPiA+IEtHIEVPUyBIb2xkaW5nIEdtYkggJiBDbyB8IFN0ZWluZGFt
bSA3MSwgMjAwOTkgSGFtYnVyZyB8IEFHIEhhbWJ1cmcgDQpIUkEgOTUNCj4gPiA3NDgNCj4gPiBQ
ZXJzw7ZubGljaCBoYWZ0ZW5kIHwgRU9TIEhvbGRpbmcgR21iSCB8IEFHIEhhbWJ1cmcgSFJCIDc4
IDc0OA0KPiA+IEdlc2Now6RmdHNmw7xocmVyIHwgSGFucy1XZXJuZXIgU2NoZXJlciwgS2xhdXMg
RW5nYmVyZGluZywgSnVzdHVzDQo+ID4gSGVja2luZy1WZWx0bWFuLCBQYXVsIExlYXJ5IHNlbi4s
IENocmlzdG9zIFNhdnZpZGVzLCBEci4gQW5kcmVhcyANCldpdHppZw0KPiA+IFZvcnNpdHplbmRl
ciBkZXMgQmVpcmF0ZXMgfCBKw7xyZ2VuIFNjaHVsdGUtTGFnZ2VuYmVjaw0KPiA+DQo+ID4gU2F2
ZSBhIHRyZWUuIERvbuKAmXQgcHJpbnQgdGhpcyBlbWFpbCB1bmxlc3MgaXTigJlzIHJlYWxseSBu
ZWNlc3NhcnkuDQo+ID4NCj4gPiBEaWVzZSBFLU1haWwgZW50aMOkbHQgdmVydHJhdWxpY2hlIHVu
ZC9vZGVyIHJlY2h0bGljaCBnZXNjaMO8dHp0ZQ0KPiA+IEluZm9ybWF0aW9uZW4uIFdlbm4gU2ll
IG5pY2h0IGRlciByaWNodGlnZSBBZHJlc3NhdCBzaW5kIG9kZXIgZGllc2UgDQpFLU1haWwNCj4g
PiBpcnJ0w7xtbGljaCBlcmhhbHRlbiBoYWJlbiwgaW5mb3JtaWVyZW4gU2llIGJpdHRlIHNvZm9y
dCBkZW4gQWJzZW5kZXIgDQp1bmQNCj4gPiB2ZXJuaWNodGVuIFNpZSBkaWVzZSBNYWlsLiBEYXMg
dW5lcmxhdWJ0ZSBLb3BpZXJlbiBzb3dpZSBkaWUgdW5iZWZ1Z3RlDQo+ID4gV2VpdGVyZ2FiZSBk
aWVzZXIgTWFpbCBpc3QgbmljaHQgZ2VzdGF0dGV0Lg0KPiA+DQo+ID4gVGhpcyBlbWFpbCBtYXkg
Y29udGFpbiBjb25maWRlbnRpYWwgYW5kL29yIHByaXZpbGVnZWQgaW5mb3JtYXRpb24uDQo+ID4g
SWYgeW91IGFyZSBub3QgdGhlIGludGVuZGVkIHJlY2lwaWVudCBvciBoYXZlIHJlY2VpdmVkIHRo
aXMgZW1haWwgaW4NCj4gPiBlcnJvciwgcGxlYXNlIG5vdGlmeSB0aGUgc2VuZGVyIGltbWVkaWF0
ZWx5IGFuZCBkZXN0cm95IHRoaXMgZW1haWwuDQo+ID4gQW55IHVuYXV0aG9yaXplZCBjb3B5aW5n
LCBkaXNjbG9zdXJlIG9yIGRpc3RyaWJ1dGlvbiBvZiB0aGUgbWF0ZXJpYWwgDQppbg0KPiA+IHRo
aXMgZW1haWwgaXMgc3RyaWN0bHkgZm9yYmlkZGVuLg0KPiA+DQo+ID4gUGV0ZXIgRGFsZ2FhcmQg
PFAuRGFsZ2FhcmRAYmlvc3RhdC5rdS5kaz4gc2NocmllYiBhbSAwOC4xMi4yMDA5IA0KMTE6MjQ6
NTA6DQo+ID4NCj4gPj4gZy5ydXNzZWxsQGVvcy1zb2x1dGlvbnMuY29tIHdyb3RlOg0KPiA+Pj4g
RnVsbF9OYW1lOiBHZW9yZ2UgUnVzc2VsbA0KPiA+Pj4gVmVyc2lvbjogMi4xMC4wDQo+ID4+PiBP
UzogV2luZG93cyBYUCBWZXJzaW9uIDIwMDIgU1AgMg0KPiA+Pj4gU3VibWlzc2lvbiBmcm9tOiAo
TlVMTCkgKDIxNy4xMTEuMy4xMzEpDQo+ID4+Pg0KPiA+Pj4NCj4gPj4+IFRoZSBmb2xsb3dpbmcg
dHlwZWQgaW50byBSIC0tdmFuaWxsYSBpbmR1Y2VzIGEgY3Jhc2g6DQo+ID4+PiAtLSBjdXQgaGVy
ZSAtLQ0KPiA+Pj4gZ2N0b3J0dXJlKCkNCj4gPj4+IHUgPC0gaW50VG9VdGY4KGMocmVwKDFlMywx
ZTIpLDMyLGMocmVwKDFlMywxZTIpKSkpDQo+ID4+PiB2IDwtIHJlcCh1LDFlMikNCj4gPj4+IHYg
PC0gc3ViKCIgIiwiIix2KQ0KPiA+Pj4gdiAlaW4lICIiDQo+ID4+PiAtLSBjdXQgaGVyZSAtLQ0K
PiA+Pj4NCj4gPj4+IHNlc3Npb25JbmZvKCkgc2F5czoNCj4gPj4+DQo+ID4+PiAtLSBjdXQgaGVy
ZSAtLQ0KPiA+Pj4gUiB2ZXJzaW9uIDIuMTAuMCAoMjAwOS0xMC0yNikNCj4gPj4+IGkzODYtcGMt
bWluZ3czMg0KPiA+Pj4NCj4gPj4+IGxvY2FsZToNCj4gPj4+IFsxXSBMQ19DT0xMQVRFPUdlcm1h
bl9HZXJtYW55LjEyNTIgIExDX0NUWVBFPUdlcm1hbl9HZXJtYW55LjEyNTINCj4gPj4+IFszXSBM
Q19NT05FVEFSWT1HZXJtYW5fR2VybWFueS4xMjUyIExDX05VTUVSSUM9Qw0KPiA+Pj4gWzVdIExD
X1RJTUU9R2VybWFuX0dlcm1hbnkuMTI1Mg0KPiA+Pj4NCj4gPj4+IGF0dGFjaGVkIGJhc2UgcGFj
a2FnZXM6DQo+ID4+PiBbMV0gc3RhdHMgICAgIGdyYXBoaWNzICBnckRldmljZXMgZGF0YXNldHMg
IHV0aWxzICAgICBtZXRob2RzICAgYmFzZQ0KPiA+Pj4gLS0gY3V0IGhlcmUgLS0NCj4gPj4+DQo+
ID4+PiBJIGFwb2xvZ2lzZSBmb3Igbm90IHRlc3RpbmcgdGhpcyB3aXRoIFItMi4xMC4xIGJ1dCBh
cyBmYXIgYXMgSSBjYW4NCj4gPj4gc2VlIHRoZXJlIGFyZQ0KPiA+Pj4gb25seSBzb3VyY2UgcmVs
ZWFzZXMgYXZhaWxhYmxlIHNvIGZhciwgd2hpY2ggSSBhbSBub3QgYWJsZSB0byANCmNvbXBpbGUu
DQo+ID4+Pg0KPiA+Pg0KPiA+PiAyLjEwLjEgUkMgaXMgYXZhaWxhYmxlIG5vdy4gUGxlYXNlIGNo
ZWNrLiBJdCBkb2VzIHNlZW0gdG8gYmUNCj4gPj4gcmVwcm9kdWNpYmxlIGluIHRoZSBXaW5kb3dz
IHZlcnNpb24sIG9yIGF0IGxlYXN0IGl0IHRha2VzIGEgdmVyeSBsb25nDQo+ID4+IHRpbWUsIGJ1
dCB0aGF0IG1lYW5zIHJ1bm5pbmcgdW5kZXIgV2luZSBvbiBTVVNFIGZvciBtZS4gSSBkb24ndCBz
ZWUgDQp0aGUNCj4gPj4gZWZmZWN0IHdpdGggdGhlIExpbnV4IGJ1aWxkLg0KPiA+Pg0KPiA+PiAt
LQ0KPiA+PiAgICBPX18gIC0tLS0gUGV0ZXIgRGFsZ2FhcmQgICAgICAgICAgICAgw5hzdGVyIEZh
cmltYWdzZ2FkZSA1LCBFbnRyLkINCj4gPj4gICBjLyAvJ18gLS0tIERlcHQuIG9mIEJpb3N0YXRp
c3RpY3MgICAgIFBPIEJveCAyMDk5LCAxMDE0IENwaC4gSw0KPiA+PiAgKCopIFwoKikgLS0gVW5p
dmVyc2l0eSBvZiBDb3BlbmhhZ2VuICAgRGVubWFyayAgICAgIFBoOiAgKCs0NSkgDQozNTMyNzkx
OA0KPiA+PiB+fn5+fn5+fn5+IC0gKHAuZGFsZ2FhcmRAYmlvc3RhdC5rdS5kaykgICAgICAgICAg
ICAgIEZBWDogKCs0NSkgDQozNTMyNzkwNw0KPiA+Pg0KPiA+DQo+ID4gX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXw0KPiA+IFItZGV2ZWxAci1wcm9qZWN0Lm9y
ZyBtYWlsaW5nIGxpc3QNCj4gPiBodHRwczovL3N0YXQuZXRoei5jaC9tYWlsbWFuL2xpc3RpbmZv
L3ItZGV2ZWwNCj4gPg0KPiANCj4gLS0gDQo+IEJyaWFuIEQuIFJpcGxleSwgICAgICAgICAgICAg
ICAgICByaXBsZXlAc3RhdHMub3guYWMudWsNCj4gUHJvZmVzc29yIG9mIEFwcGxpZWQgU3RhdGlz
dGljcywgIGh0dHA6Ly93d3cuc3RhdHMub3guYWMudWsvfnJpcGxleS8NCj4gVW5pdmVyc2l0eSBv
ZiBPeGZvcmQsICAgICAgICAgICAgIFRlbDogICs0NCAxODY1IDI3Mjg2MSAoc2VsZikNCj4gMSBT
b3V0aCBQYXJrcyBSb2FkLCAgICAgICAgICAgICAgICAgICAgICs0NCAxODY1IDI3Mjg2NiAoUEEp
DQo+IE94Zm9yZCBPWDEgM1RHLCBVSyAgICAgICAgICAgICAgICBGYXg6ICArNDQgMTg2NSAyNzI1
OTUNCg==


From maechler at stat.math.ethz.ch  Thu Dec 10 12:20:24 2009
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Thu, 10 Dec 2009 12:20:24 +0100 (CET)
Subject: [Rd] switch() called with just the EXPR argument causes R to
	hang (PR#14124)
Message-ID: <20091210112024.4429C283201A@mail.pubhealth.ku.dk>

>>>>> "SG" == Simone Giannerini <sgiannerini at gmail.com>
>>>>>     on Thu, 10 Dec 2009 09:30:10 +0100 (CET) writes:

    SG> Dear all, switch() called with just the EXPR argument
    SG> causes R to hang so that the only way to stop it is to
    SG> kill R.

    SG> Reproducible example:

    >> switch(EXPR="a")

    SG> the internal C subroutine behind switch is do_switch
    SG> located in R/src/main/builtin.c For convenience I
    SG> reproduce it below.

    [..........]

    SG> I do not know C but it seems to me that do_switch
    SG> expects two arguments.

One can argue that it should return  NULL  when it has no
further arguments.

A fix is very simple and I'll commit it (after testing)
for R-devel and "R 2.10.1 RC".

Martin Maechler, ETH ZUrich

    SG> regards
    SG> Simone

    SG> tested both on Windows VISTA 32 bit

    SG> platform i386-pc-mingw32 arch i386 os mingw32 system
    SG> i386, mingw32 status major 2 minor 10.0 year 2009 month
    SG> 10 day 26 svn rev 50208 language R version.string R
    SG> version 2.10.0 (2009-10-26)

    SG> and on Linux OpenSuSE 11.0 64bit

    >> R.version
    SG>                _ platform x86_64-unknown-linux-gnu arch
    SG> x86_64 os linux-gnu system x86_64, linux-gnu status
    SG> Patched major 2 minor 10.0 year 2009 month 11 day 19 svn
    SG> rev 50499 language R version.string R version 2.10.0
    SG> Patched (2009-11-19 r50499)


    SG> --
    SG> ______________________________________________________

    SG> Simone Giannerini Dipartimento di Scienze Statistiche
    SG> "Paolo Fortunati" Universita' di Bologna Via delle belle
    SG> arti 41 - 40126 Bologna, ITALY Tel: +39 051 2098262 Fax:
    SG> +39 051 232153 http://www2.stat.unibo.it/giannerini/
    SG> ______________________________________________________

    SG> 	[[alternative HTML version deleted]]

    SG> ______________________________________________
    SG> R-devel at r-project.org mailing list
    SG> https://stat.ethz.ch/mailman/listinfo/r-devel


From hkawakat at gmail.com  Thu Dec 10 12:21:44 2009
From: hkawakat at gmail.com (Hiroyuki Kawakatsu)
Date: Thu, 10 Dec 2009 11:21:44 +0000
Subject: [Rd] expression paste broken in r-devel?
Message-ID: <307b90470912100321t4f561e24j7675b912d49ddb78@mail.gmail.com>

Hi,

The following expression() is silently ignored in r-devel (r50697):

plot(1:10)
text(5, 5, expression(paste("foo ", alpha)))

Am I the only one having this problem? example(plotmath) runs but all
constructs of the form expression(paste()) do not show up in the
plots.

h.
-- 
+---
| Hiroyuki Kawakatsu
| Business School, Dublin City University
| Dublin 9, Ireland. Tel +353 (0)1 700 7496


From murdoch at stats.uwo.ca  Thu Dec 10 12:50:32 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 10 Dec 2009 06:50:32 -0500
Subject: [Rd] expression paste broken in r-devel?
In-Reply-To: <307b90470912100321t4f561e24j7675b912d49ddb78@mail.gmail.com>
References: <307b90470912100321t4f561e24j7675b912d49ddb78@mail.gmail.com>
Message-ID: <4B20E088.1070809@stats.uwo.ca>

On 10/12/2009 6:21 AM, Hiroyuki Kawakatsu wrote:
> Hi,
> 
> The following expression() is silently ignored in r-devel (r50697):
> 
> plot(1:10)
> text(5, 5, expression(paste("foo ", alpha)))
> 
> Am I the only one having this problem? example(plotmath) runs but all
> constructs of the form expression(paste()) do not show up in the
> plots.

It's working for me in r50697 in Windows.  Please post sessionInfo, etc.

Duncan Murdoch


From ripley at stats.ox.ac.uk  Thu Dec 10 12:55:50 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 10 Dec 2009 11:55:50 +0000 (GMT)
Subject: [Rd] Antwort: Re:  Crash with Unicode and sub (PR#14114)
In-Reply-To: <OF3066E4FD.34FE4D03-ONC1257688.002BDB6F-C1257688.002FF22C@DFD-Hamburg>
References: <OF3066E4FD.34FE4D03-ONC1257688.002BDB6F-C1257688.002FF22C@DFD-Hamburg>
Message-ID: <alpine.LFD.2.00.0912100905550.13498@gannet.stats.ox.ac.uk>

On Thu, 10 Dec 2009, g.russell at eos-solutions.com wrote:

> I don't know about the technicalities, but Peter Dalgaard said the
> offending code also causes R to come to a stop using SUSE + WINE. Is it
> possible to run that lot on top of valgrind? Of course, it will probably
> take all day ...

Yes, but not the part about 'a valgrind-instrumented build of R'. 
Since otherwise valgrind will not get under the hood of the R garbage 
collector (where the crash is) that does not usually help on Linux.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hkawakat at gmail.com  Thu Dec 10 14:31:53 2009
From: hkawakat at gmail.com (Hiroyuki Kawakatsu)
Date: Thu, 10 Dec 2009 13:31:53 +0000
Subject: [Rd] expression paste broken in r-devel?
In-Reply-To: <4B20E088.1070809@stats.uwo.ca>
References: <307b90470912100321t4f561e24j7675b912d49ddb78@mail.gmail.com>
	<4B20E088.1070809@stats.uwo.ca>
Message-ID: <307b90470912100531q75c022c8m3dbe91757de97910@mail.gmail.com>

On Thu, Dec 10, 2009, Duncan Murdoch wrote:
> On 10/12/2009 6:21 AM, Hiroyuki Kawakatsu wrote:
>>
>> Hi,
>>
>> The following expression() is silently ignored in r-devel (r50697):
>>
>> plot(1:10)
>> text(5, 5, expression(paste("foo ", alpha)))
>>
>> Am I the only one having this problem? example(plotmath) runs but all
>> constructs of the form expression(paste()) do not show up in the
>> plots.
>
> It's working for me in r50697 in Windows.  Please post sessionInfo, etc.

hmmm. this is not working for me both in freeBSD

> sessionInfo()
R version 2.11.0 Under development (unstable) (2009-12-10 r50698)
x86_64-unknown-freebsd9.0

locale:
[1] C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] tools_2.11.0

and debian

> sessionInfo()
R version 2.11.0 Under development (unstable) (2009-12-10 r50697)
x86_64-unknown-linux-gnu

locale:
 [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8
 [5] LC_MONETARY=C              LC_MESSAGES=en_GB.UTF-8
 [7] LC_PAPER=en_GB.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


-- 
+---
| Hiroyuki Kawakatsu
| Business School, Dublin City University
| Dublin 9, Ireland. Tel +353 (0)1 700 7496


From P.Dalgaard at biostat.ku.dk  Thu Dec 10 15:15:09 2009
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu, 10 Dec 2009 15:15:09 +0100
Subject: [Rd] Antwort: Re:  Crash with Unicode and sub (PR#14114)
In-Reply-To: <20091210084533.DF2262832014@mail.pubhealth.ku.dk>
References: <20091210084533.DF2262832014@mail.pubhealth.ku.dk>
Message-ID: <4B21026D.6050805@biostat.ku.dk>

g.russell at eos-solutions.com wrote:
> SSBkb24ndCBrbm93IGFib3V0IHRoZSB0ZWNobmljYWxpdGllcywgYnV0IFBldGVyIERhbGdhYXJk
> IHNhaWQgdGhlIA0Kb2ZmZW5kaW5nIGNvZGUgYWxzbyBjYXVzZXMgUiB0byBjb21lIHRvIGEgc3Rv
> cCB1c2luZyBTVVNFICsgV0lORS4gSXMgaXQgDQpwb3NzaWJsZSB0byBydW4gdGhhdCBsb3Qgb24g
[...Argh!, Jitterbug must die....]


For those who cannot read base64 coded mails by eye, these are the
contents (an unmangled version reached r-devel, but probably not r-bugs):


I don't know about the technicalities, but Peter Dalgaard said the
offending code also causes R to come to a stop using SUSE + WINE. Is it
possible to run that lot on top of valgrind? Of course, it will probably
take all day ...

If not, I have a  clue which might help. The problem seems to lie in the
"sub" routine. In the original report I used
-- cut here --
gctorture()
u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
v <- rep(u,1e2)
v <- sub(" ","",v)
v %in% ""
-- cut here --

I've tried reducing this a bit more. Replacing intToUtf8 with a direct
assignment writing out the string with Unicode escapes seems to make no
difference. The %in% can be replaced with "match", leaving the following:
-- cut here --
gctorture()
u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
v <- rep(u,1e2)
v <- sub(" ","",v)
match(v,"")
-- cut here --
This also crashes R-2.10.0 and R-2.10.1 RC (2009-12-06 r50684).

The sub line is essential, so far as I can see, without it we don't get
the crash. If we add "perl = TRUE" this seems to make no difference (there
is still a crash). If instead we use "fixed = TRUE", the result is strange
and differs for R-2.10.0 and R-2.10.1 RC. This is especially strange,
because in an unbugged R, the result of v returned from sub should be the
same either with fixed = TRUE or perl = TRUE.

R-2.10.0 pauses several seconds, then produces the enigmatic output:
> match(v,"")
  [1] 00 00 06 9d 78 9c cd 54 5d 4f 83 30 14 2d ec 9b a9 33 99 2f fe 89 65
1a e3
 [26] c3 de 8c 26 be 38 7d d5 c7 4a af 0c 57 ca 42 cb 8c bf dc 18 93 61 29
1d 83
 [51] 8e 7d c4 18 23 49 a1 f4 de 9e 7b 4e ef 81 47 07 21 64 23 5b 3e ec 1a
42 56
 [76] 4b de ea b6 5c b3 e4 e8 c8 d1 f2 80 41 e4 bb 32 7e 5c 58 ae f3 49 f8
66 a6
[101] ce b0 3b c5 1e c8 69 31 b5 15 80 98 84 84 cb e9 22 db 61 27 1b 53 4a
80 0d
[126] 2f 0a e3 99 9c f4 91 ba 4a 41 67 8e 69 0c d7 14 73 ae d1 cc 8c 0e f7
3d 86
[151] 45 1c 81 41 be 19 3e bf 82 2b 4c 40 ee 07 33 0a 0f 8c be a7 6f 3a 62
ad 68
[176] af e8 12 78 c1 31 15 c8 aa 9d 9a a1 5c 89 dd 57 cb eb 27 da 14 38 f2
20 dd
[201] 5c 45 ba c1 70 00 9b 14 35 dc 4c 6e 49 4d 51 e6 8e d3 4d 95 54 aa f1
19 90
[226] 32 21 27 29 73 e8 26 bf 53 d6 32 71 0a 4e da 01 51 49 e3 84 48 77 ce
81 dc
[251] 64 2d 19 ab 0d 7b 33 42 9f 99 42 64 af a7 a8 5e 9d 0f ce 86 83 a1 d9
c1 a5
[276] 7f d0 97 86 69 16 a2 dd 54 90 a6 93 21 1f 25 ba c2 d2 54 68 25 c8 31
49 d6
[301] ae ee 9f 2a ba d4 96 a6 89 03 60 22 83 2b 3b 17 53 3a ce 79 17 3e 96
b5 d3
[326] ea ea b4 3b 9f 8b 9f b9 a5 cd a7 40 41 84 4c a9 ce dd dd 49 fe c6 3e
07 7f
[351] 54 e7 7f d9 f4 50 77 5c 19 a9 e0 b9 5e b2 dd 60 79 6c 13 ad 1e 17 98
11 1c
[376] 91 db e5 5f 7e df 0f e7 43 57 c9 7d 01 6c 3e 1a 5d 0c 2f ab 99 6e a9
a8 88
[401] 57 1c 35 5a 7c 03 73 22 e4 b1

R-2.10.1 RC produces the following equally enigmatic output:
> match(v,"")
NULL
Fehler: 'getEncChar' muss f?r CHARSXP aufgerufen werden

So my provisional guess is the bug is somewhere in the part of the
internal code for sub which is invoked whatever the value of fixed or
perl. It is strange though that it makes a difference whether you specify
fixed = TRUE or not.

George Russell


Prof Brian Ripley <ripley at stats.ox.ac.uk> schrieb am 10.12.2009 08:00:36:

> It seems (from the debugger output) that this is corruption in the R
> memory allocation routines.  Such things can usually be tracked down
> via valgrind and a valgrind-instrumented build of R, but I cannot
> trigger this on any system with valgrind.  I've tried 64- and 32-bit
> versions, and Latin-1 locales as well as UTF-8.
>
> So I am inclining to think this is Windows-specific.  One thing that
> is specific to Windows is UCS-2 (16-bit) wide characters, which might
> be the issue.  But we simply don't have the tools on Windows that we
> do on other platforms.
>
> On Wed, 9 Dec 2009, g.russell at eos-solutions.com wrote:
>
> > Hello Peter,
> >
> > I have now installed R-2.10.1 RC (sessionInfo() says "R version 2.10.1
RC
> > (2009-12-06 r50684)", the rest I believe is as before). The following
code
> > always brings R --vanilla down (with a crash, not a normal exit):
> > -- cut here --
> > gctorture()
> > u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
> > v <- rep(u,1e2)
> > v <- sub(" ","",v)
> > v %in% ""
> > q()
> > -- cut here --
> >
> > I've tried this several times now, with different effects. Sometimes R
> > crashes after 'v %in% ""'. Sometimes it survives that command, but
crashes
> > during the q(). I have also had the error message "Fehler in match(x,
> > table, nomatch = 0L) > 0L : Vergleich (6) ist nur f?r atomare und
> > Listentypen m?glich" from that command (the match seems to be the
> > problem), when I type q() R still crashes.
> >
> > Best wishes,
> >
> > George Russell | KG EOS Holding GmbH & Co
> >
> > Tel: +49 40 2850 ? 1574  | g.russell at eos-solutions.com
> >
> > EOS. With head and heart in finance
> >
> > KG EOS Holding GmbH & Co | Steindamm 71, 20099 Hamburg | AG Hamburg
HRA 95
> > 748
> > Pers?nlich haftend | EOS Holding GmbH | AG Hamburg HRB 78 748
> > Gesch?ftsf?hrer | Hans-Werner Scherer, Klaus Engberding, Justus
> > Hecking-Veltman, Paul Leary sen., Christos Savvides, Dr. Andreas
Witzig
> > Vorsitzender des Beirates | J?rgen Schulte-Laggenbeck
> >
> > Save a tree. Don?t print this email unless it?s really necessary.
> >
> > Diese E-Mail enth?lt vertrauliche und/oder rechtlich gesch?tzte
> > Informationen. Wenn Sie nicht der richtige Adressat sind oder diese
E-Mail
> > irrt?mlich erhalten haben, informieren Sie bitte sofort den Absender
und
> > vernichten Sie diese Mail. Das unerlaubte Kopieren sowie die unbefugte
> > Weitergabe dieser Mail ist nicht gestattet.
> >
> > This email may contain confidential and/or privileged information.
> > If you are not the intended recipient or have received this email in
> > error, please notify the sender immediately and destroy this email.
> > Any unauthorized copying, disclosure or distribution of the material
in
> > this email is strictly forbidden.
> >
> > Peter Dalgaard <P.Dalgaard at biostat.ku.dk> schrieb am 08.12.2009
11:24:50:
> >
> >> g.russell at eos-solutions.com wrote:
> >>> Full_Name: George Russell
> >>> Version: 2.10.0
> >>> OS: Windows XP Version 2002 SP 2
> >>> Submission from: (NULL) (217.111.3.131)
> >>>
> >>>
> >>> The following typed into R --vanilla induces a crash:
> >>> -- cut here --
> >>> gctorture()
> >>> u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
> >>> v <- rep(u,1e2)
> >>> v <- sub(" ","",v)
> >>> v %in% ""
> >>> -- cut here --
> >>>
> >>> sessionInfo() says:
> >>>
> >>> -- cut here --
> >>> R version 2.10.0 (2009-10-26)
> >>> i386-pc-mingw32
> >>>
> >>> locale:
> >>> [1] LC_COLLATE=German_Germany.1252  LC_CTYPE=German_Germany.1252
> >>> [3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C
> >>> [5] LC_TIME=German_Germany.1252
> >>>
> >>> attached base packages:
> >>> [1] stats     graphics  grDevices datasets  utils     methods   base
> >>> -- cut here --
> >>>
> >>> I apologise for not testing this with R-2.10.1 but as far as I can
> >> see there are
> >>> only source releases available so far, which I am not able to
compile.
> >>>
> >>
> >> 2.10.1 RC is available now. Please check. It does seem to be
> >> reproducible in the Windows version, or at least it takes a very long
> >> time, but that means running under Wine on SUSE for me. I don't see
the
> >> effect with the Linux build.
> >>
> >> --
> >>    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
> >>   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> >>  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45)
35327918
> >> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45)
35327907
> >>
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595




-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From peter.ruckdeschel at web.de  Thu Dec 10 18:56:31 2009
From: peter.ruckdeschel at web.de (Peter Ruckdeschel)
Date: Thu, 10 Dec 2009 18:56:31 +0100
Subject: [Rd] Recent TeX changes and R/package manuals
In-Reply-To: <alpine.LFD.2.00.0912091253370.27460@gannet.stats.ox.ac.uk>
References: <alpine.LFD.2.00.0912091253370.27460@gannet.stats.ox.ac.uk>
Message-ID: <hfrcob$jjo$1@ger.gmane.org>

Dear Prof Ripley

thanks (once again) for your alert

[snip]

> As far as I can tell, the following CRAN package manuals have been
> affected:
> 
>   distrMod, RCurl, RGtk2, SparseM, VIM, bit, ggplot2, operators,
>   relations, spam, tensorA
> 
> (and only distrMod fatally).
> 
> Given the current pace of change (ca 100 updates/week on 'only' 2000 TL
> packages), more things may pop out of the woodwork.
> 
> 
> For the curious and cognescenti:
> 
> (i) hyperref is having problems with markup in \section titles, which
> 'methods' and 'distrMod' had.  I've added a warning to the R-exts manual.

[snip]

A priliminary check gave that we had some instances of markup by
\code{<some code>} within \section{<some title>}. We have changed this
for '<some code>' now, but still are checking whether there are
additional things we have not seen so far.

Not an extremely urgent [xmas] wish:

Given that TeX is not the only renderer of Rd, and markup in
titles would be handy sometimes --- if I recall correctly,
in LaTeX there is Heiko Oberdiek's package 'hypbmsec' to resolve
such markup problems within titles; so if Rd-\section command
could take this up, we could still have markup in section titles;

Otoh, given that we were the only ones having fatal problems
with markup, this is probably not so important...

Anyway, thanks for stirring us up.
Peter (maintainer of 'distrMod')


From tomas.larsson at usaa.com  Thu Dec 10 17:50:09 2009
From: tomas.larsson at usaa.com (tomas.larsson at usaa.com)
Date: Thu, 10 Dec 2009 17:50:09 +0100 (CET)
Subject: [Rd] Using predict on a model with NA as a level (PR#14127)
Message-ID: <20091210165009.C19B5282EFCA@mail.pubhealth.ku.dk>

Full_Name: Tomas Larsson
Version: 2.8.0
OS: Windows XP
Submission from: (NULL) (167.24.24.150)


There appears to be a problem with using predict on a data set when NA has been
specified as a level in the model, see example below.


> # generate some data
> x<-matrix(,10,2)
> x[,1]<-c(numeric(5),numeric(5)+1)
> x[,2]<-c(0,0,NA,0,1,1,0,NA,1,1)
> x<-as.data.frame(x)
> # add NA as a level in the model
> x[,2]<-addNA(x[,2])
> m<-glm(data=x,formula=V1~V2)
> #works
> predict(m)
   1    2    3    4    5    6    7    8    9   10 
0.25 0.25 0.50 0.25 0.75 0.75 0.25 0.50 0.75 0.75 
> # does not work to use predict when using the new data option
> predict(m,newdata=x)
Error in drop(X[, piv, drop = FALSE] %*% beta[piv]) : 
  subscript out of bounds


From g.russell at eos-solutions.com  Thu Dec 10 17:36:23 2009
From: g.russell at eos-solutions.com (g.russell at eos-solutions.com)
Date: Thu, 10 Dec 2009 17:36:23 +0100
Subject: [Rd] Antwort: Re: Antwort: Re: Crash with Unicode and sub (PR#14114)
In-Reply-To: <4B21026D.6050805@biostat.ku.dk>
Message-ID: <OF1EF0B9F1.63392F4E-ONC1257688.005AFE07-C1257688.005B3925@DFD-Hamburg>

I take that back anyway. I have now managed to reliably crash R 2.10.0 and 
R version 2.10.1 RC (2009-12-06 r50684) on Windows without using the sub 
function. The following code does it:
-- cut here --
 u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
v <- rep(u,1e2)
w <- paste(substring(v,1,100),substring(v,102),sep = "")
gctorture()
match(w,"")
-- cut here --

 George Russell | KG EOS Holding GmbH & Co

Tel: +49 40 2850 ? 1574  | g.russell at eos-solutions.com

EOS. With head and heart in finance

KG EOS Holding GmbH & Co | Steindamm 71, 20099 Hamburg | AG Hamburg HRA 95 
748
Pers?nlich haftend | EOS Holding GmbH | AG Hamburg HRB 78 748
Gesch?ftsf?hrer | Hans-Werner Scherer, Klaus Engberding, Justus 
Hecking-Veltman, Paul Leary sen., Christos Savvides, Dr. Andreas Witzig
Vorsitzender des Beirates | J?rgen Schulte-Laggenbeck 

Save a tree. Don?t print this email unless it?s really necessary.

Diese E-Mail enth?lt vertrauliche und/oder rechtlich gesch?tzte 
Informationen. Wenn Sie nicht der richtige Adressat sind oder diese E-Mail 
irrt?mlich erhalten haben, informieren Sie bitte sofort den Absender und 
vernichten Sie diese Mail. Das unerlaubte Kopieren sowie die unbefugte 
Weitergabe dieser Mail ist nicht gestattet.

This email may contain confidential and/or privileged information.
If you are not the intended recipient or have received this email in 
error, please notify the sender immediately and destroy this email.
Any unauthorized copying, disclosure or distribution of the material in 
this email is strictly forbidden.

Peter Dalgaard <P.Dalgaard at biostat.ku.dk> schrieb am 10.12.2009 15:15:09:

> g.russell at eos-solutions.com wrote:
> > 
SSBkb24ndCBrbm93IGFib3V0IHRoZSB0ZWNobmljYWxpdGllcywgYnV0IFBldGVyIERhbGdhYXJk
> > 
IHNhaWQgdGhlIA0Kb2ZmZW5kaW5nIGNvZGUgYWxzbyBjYXVzZXMgUiB0byBjb21lIHRvIGEgc3Rv
> > 
cCB1c2luZyBTVVNFICsgV0lORS4gSXMgaXQgDQpwb3NzaWJsZSB0byBydW4gdGhhdCBsb3Qgb24g
> [...Argh!, Jitterbug must die....]
> 
> 
> For those who cannot read base64 coded mails by eye, these are the
> contents (an unmangled version reached r-devel, but probably not 
r-bugs):
> 
> 
> I don't know about the technicalities, but Peter Dalgaard said the
> offending code also causes R to come to a stop using SUSE + WINE. Is it
> possible to run that lot on top of valgrind? Of course, it will probably
> take all day ...
> 
> If not, I have a  clue which might help. The problem seems to lie in the
> "sub" routine. In the original report I used
> -- cut here --
> gctorture()
> u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
> v <- rep(u,1e2)
> v <- sub(" ","",v)
> v %in% ""
> -- cut here --
> 
> I've tried reducing this a bit more. Replacing intToUtf8 with a direct
> assignment writing out the string with Unicode escapes seems to make no
> difference. The %in% can be replaced with "match", leaving the 
following:
> -- cut here --
> gctorture()
> u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
> v <- rep(u,1e2)
> v <- sub(" ","",v)
> match(v,"")
> -- cut here --
> This also crashes R-2.10.0 and R-2.10.1 RC (2009-12-06 r50684).
> 
> The sub line is essential, so far as I can see, without it we don't get
> the crash. If we add "perl = TRUE" this seems to make no difference 
(there
> is still a crash). If instead we use "fixed = TRUE", the result is 
strange
> and differs for R-2.10.0 and R-2.10.1 RC. This is especially strange,
> because in an unbugged R, the result of v returned from sub should be 
the
> same either with fixed = TRUE or perl = TRUE.
> 
> R-2.10.0 pauses several seconds, then produces the enigmatic output:
> > match(v,"")
>   [1] 00 00 06 9d 78 9c cd 54 5d 4f 83 30 14 2d ec 9b a9 33 99 2f fe 89 
65
> 1a e3
>  [26] c3 de 8c 26 be 38 7d d5 c7 4a af 0c 57 ca 42 cb 8c bf dc 18 93 61 
29
> 1d 83
>  [51] 8e 7d c4 18 23 49 a1 f4 de 9e 7b 4e ef 81 47 07 21 64 23 5b 3e ec 
1a
> 42 56
>  [76] 4b de ea b6 5c b3 e4 e8 c8 d1 f2 80 41 e4 bb 32 7e 5c 58 ae f3 49 
f8
> 66 a6
> [101] ce b0 3b c5 1e c8 69 31 b5 15 80 98 84 84 cb e9 22 db 61 27 1b 53 
4a
> 80 0d
> [126] 2f 0a e3 99 9c f4 91 ba 4a 41 67 8e 69 0c d7 14 73 ae d1 cc 8c 0e 
f7
> 3d 86
> [151] 45 1c 81 41 be 19 3e bf 82 2b 4c 40 ee 07 33 0a 0f 8c be a7 6f 3a 
62
> ad 68
> [176] af e8 12 78 c1 31 15 c8 aa 9d 9a a1 5c 89 dd 57 cb eb 27 da 14 38 
f2
> 20 dd
> [201] 5c 45 ba c1 70 00 9b 14 35 dc 4c 6e 49 4d 51 e6 8e d3 4d 95 54 aa 
f1
> 19 90
> [226] 32 21 27 29 73 e8 26 bf 53 d6 32 71 0a 4e da 01 51 49 e3 84 48 77 
ce
> 81 dc
> [251] 64 2d 19 ab 0d 7b 33 42 9f 99 42 64 af a7 a8 5e 9d 0f ce 86 83 a1 
d9
> c1 a5
> [276] 7f d0 97 86 69 16 a2 dd 54 90 a6 93 21 1f 25 ba c2 d2 54 68 25 c8 
31
> 49 d6
> [301] ae ee 9f 2a ba d4 96 a6 89 03 60 22 83 2b 3b 17 53 3a ce 79 17 3e 
96
> b5 d3
> [326] ea ea b4 3b 9f 8b 9f b9 a5 cd a7 40 41 84 4c a9 ce dd dd 49 fe c6 
3e
> 07 7f
> [351] 54 e7 7f d9 f4 50 77 5c 19 a9 e0 b9 5e b2 dd 60 79 6c 13 ad 1e 17 
98
> 11 1c
> [376] 91 db e5 5f 7e df 0f e7 43 57 c9 7d 01 6c 3e 1a 5d 0c 2f ab 99 6e 
a9
> a8 88
> [401] 57 1c 35 5a 7c 03 73 22 e4 b1
> 
> R-2.10.1 RC produces the following equally enigmatic output:
> > match(v,"")
> NULL
> Fehler: 'getEncChar' muss f?r CHARSXP aufgerufen werden
> 
> So my provisional guess is the bug is somewhere in the part of the
> internal code for sub which is invoked whatever the value of fixed or
> perl. It is strange though that it makes a difference whether you 
specify
> fixed = TRUE or not.
> 
> George Russell
> 
> 
> Prof Brian Ripley <ripley at stats.ox.ac.uk> schrieb am 10.12.2009 
08:00:36:
> 
> > It seems (from the debugger output) that this is corruption in the R
> > memory allocation routines.  Such things can usually be tracked down
> > via valgrind and a valgrind-instrumented build of R, but I cannot
> > trigger this on any system with valgrind.  I've tried 64- and 32-bit
> > versions, and Latin-1 locales as well as UTF-8.
> >
> > So I am inclining to think this is Windows-specific.  One thing that
> > is specific to Windows is UCS-2 (16-bit) wide characters, which might
> > be the issue.  But we simply don't have the tools on Windows that we
> > do on other platforms.
> >
> > On Wed, 9 Dec 2009, g.russell at eos-solutions.com wrote:
> >
> > > Hello Peter,
> > >
> > > I have now installed R-2.10.1 RC (sessionInfo() says "R version 
2.10.1
> RC
> > > (2009-12-06 r50684)", the rest I believe is as before). The 
following
> code
> > > always brings R --vanilla down (with a crash, not a normal exit):
> > > -- cut here --
> > > gctorture()
> > > u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
> > > v <- rep(u,1e2)
> > > v <- sub(" ","",v)
> > > v %in% ""
> > > q()
> > > -- cut here --
> > >
> > > I've tried this several times now, with different effects. Sometimes 
R
> > > crashes after 'v %in% ""'. Sometimes it survives that command, but
> crashes
> > > during the q(). I have also had the error message "Fehler in 
match(x,
> > > table, nomatch = 0L) > 0L : Vergleich (6) ist nur f?r atomare und
> > > Listentypen m?glich" from that command (the match seems to be the
> > > problem), when I type q() R still crashes.
> > >
> > > Best wishes,
> > >
> > > George Russell | KG EOS Holding GmbH & Co
> > >
> > > Tel: +49 40 2850 ? 1574  | g.russell at eos-solutions.com
> > >
> > > EOS. With head and heart in finance
> > >
> > > KG EOS Holding GmbH & Co | Steindamm 71, 20099 Hamburg | AG Hamburg
> HRA 95
> > > 748
> > > Pers?nlich haftend | EOS Holding GmbH | AG Hamburg HRB 78 748
> > > Gesch?ftsf?hrer | Hans-Werner Scherer, Klaus Engberding, Justus
> > > Hecking-Veltman, Paul Leary sen., Christos Savvides, Dr. Andreas
> Witzig
> > > Vorsitzender des Beirates | J?rgen Schulte-Laggenbeck
> > >
> > > Save a tree. Don?t print this email unless it?s really necessary.
> > >
> > > Diese E-Mail enth?lt vertrauliche und/oder rechtlich gesch?tzte
> > > Informationen. Wenn Sie nicht der richtige Adressat sind oder diese
> E-Mail
> > > irrt?mlich erhalten haben, informieren Sie bitte sofort den Absender
> und
> > > vernichten Sie diese Mail. Das unerlaubte Kopieren sowie die 
unbefugte
> > > Weitergabe dieser Mail ist nicht gestattet.
> > >
> > > This email may contain confidential and/or privileged information.
> > > If you are not the intended recipient or have received this email in
> > > error, please notify the sender immediately and destroy this email.
> > > Any unauthorized copying, disclosure or distribution of the material
> in
> > > this email is strictly forbidden.
> > >
> > > Peter Dalgaard <P.Dalgaard at biostat.ku.dk> schrieb am 08.12.2009
> 11:24:50:
> > >
> > >> g.russell at eos-solutions.com wrote:
> > >>> Full_Name: George Russell
> > >>> Version: 2.10.0
> > >>> OS: Windows XP Version 2002 SP 2
> > >>> Submission from: (NULL) (217.111.3.131)
> > >>>
> > >>>
> > >>> The following typed into R --vanilla induces a crash:
> > >>> -- cut here --
> > >>> gctorture()
> > >>> u <- intToUtf8(c(rep(1e3,1e2),32,c(rep(1e3,1e2))))
> > >>> v <- rep(u,1e2)
> > >>> v <- sub(" ","",v)
> > >>> v %in% ""
> > >>> -- cut here --
> > >>>
> > >>> sessionInfo() says:
> > >>>
> > >>> -- cut here --
> > >>> R version 2.10.0 (2009-10-26)
> > >>> i386-pc-mingw32
> > >>>
> > >>> locale:
> > >>> [1] LC_COLLATE=German_Germany.1252  LC_CTYPE=German_Germany.1252
> > >>> [3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C
> > >>> [5] LC_TIME=German_Germany.1252
> > >>>
> > >>> attached base packages:
> > >>> [1] stats     graphics  grDevices datasets  utils     methods base
> > >>> -- cut here --
> > >>>
> > >>> I apologise for not testing this with R-2.10.1 but as far as I can
> > >> see there are
> > >>> only source releases available so far, which I am not able to
> compile.
> > >>>
> > >>
> > >> 2.10.1 RC is available now. Please check. It does seem to be
> > >> reproducible in the Windows version, or at least it takes a very 
long
> > >> time, but that means running under Wine on SUSE for me. I don't see
> the
> > >> effect with the Linux build.
> > >>
> > >> --
> > >>    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, 
Entr.B
> > >>   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> > >>  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45)
> 35327918
> > >> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45)
> 35327907
> > >>
> > >
> > > ______________________________________________
> > > R-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-devel
> > >
> >
> > --
> > Brian D. Ripley,                  ripley at stats.ox.ac.uk
> > Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> > University of Oxford,             Tel:  +44 1865 272861 (self)
> > 1 South Parks Road,                     +44 1865 272866 (PA)
> > Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 
> 
> 
> 
> -- 
>    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
>  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907
> 


From g.russell at eos-solutions.com  Thu Dec 10 17:40:13 2009
From: g.russell at eos-solutions.com (g.russell at eos-solutions.com)
Date: Thu, 10 Dec 2009 17:40:13 +0100 (CET)
Subject: [Rd] Antwort: Re: Antwort: Re: Crash with Unicode and sub (PR#14126)
Message-ID: <20091210164013.E7F8D282EFCA@mail.pubhealth.ku.dk>

SSB0YWtlIHRoYXQgYmFjayBhbnl3YXkuIEkgaGF2ZSBub3cgbWFuYWdlZCB0byByZWxpYWJseSBj
cmFzaCBSIDIuMTAuMCBhbmQgDQpSIHZlcnNpb24gMi4xMC4xIFJDICgyMDA5LTEyLTA2IHI1MDY4
NCkgb24gV2luZG93cyB3aXRob3V0IHVzaW5nIHRoZSBzdWIgDQpmdW5jdGlvbi4gVGhlIGZvbGxv
d2luZyBjb2RlIGRvZXMgaXQ6DQotLSBjdXQgaGVyZSAtLQ0KIHUgPC0gaW50VG9VdGY4KGMocmVw
KDFlMywxZTIpLDMyLGMocmVwKDFlMywxZTIpKSkpDQp2IDwtIHJlcCh1LDFlMikNCncgPC0gcGFz
dGUoc3Vic3RyaW5nKHYsMSwxMDApLHN1YnN0cmluZyh2LDEwMiksc2VwID0gIiIpDQpnY3RvcnR1
cmUoKQ0KbWF0Y2godywiIikNCi0tIGN1dCBoZXJlIC0tDQoNCiBHZW9yZ2UgUnVzc2VsbCB8IEtH
IEVPUyBIb2xkaW5nIEdtYkggJiBDbw0KDQpUZWw6ICs0OSA0MCAyODUwIOKAkyAxNTc0ICB8IGcu
cnVzc2VsbEBlb3Mtc29sdXRpb25zLmNvbQ0KDQpFT1MuIFdpdGggaGVhZCBhbmQgaGVhcnQgaW4g
ZmluYW5jZQ0KDQpLRyBFT1MgSG9sZGluZyBHbWJIICYgQ28gfCBTdGVpbmRhbW0gNzEsIDIwMDk5
IEhhbWJ1cmcgfCBBRyBIYW1idXJnIEhSQSA5NSANCjc0OA0KUGVyc8O2bmxpY2ggaGFmdGVuZCB8
IEVPUyBIb2xkaW5nIEdtYkggfCBBRyBIYW1idXJnIEhSQiA3OCA3NDgNCkdlc2Now6RmdHNmw7xo
cmVyIHwgSGFucy1XZXJuZXIgU2NoZXJlciwgS2xhdXMgRW5nYmVyZGluZywgSnVzdHVzIA0KSGVj
a2luZy1WZWx0bWFuLCBQYXVsIExlYXJ5IHNlbi4sIENocmlzdG9zIFNhdnZpZGVzLCBEci4gQW5k
cmVhcyBXaXR6aWcNClZvcnNpdHplbmRlciBkZXMgQmVpcmF0ZXMgfCBKw7xyZ2VuIFNjaHVsdGUt
TGFnZ2VuYmVjayANCg0KU2F2ZSBhIHRyZWUuIERvbuKAmXQgcHJpbnQgdGhpcyBlbWFpbCB1bmxl
c3MgaXTigJlzIHJlYWxseSBuZWNlc3NhcnkuDQoNCkRpZXNlIEUtTWFpbCBlbnRow6RsdCB2ZXJ0
cmF1bGljaGUgdW5kL29kZXIgcmVjaHRsaWNoIGdlc2Now7x0enRlIA0KSW5mb3JtYXRpb25lbi4g
V2VubiBTaWUgbmljaHQgZGVyIHJpY2h0aWdlIEFkcmVzc2F0IHNpbmQgb2RlciBkaWVzZSBFLU1h
aWwgDQppcnJ0w7xtbGljaCBlcmhhbHRlbiBoYWJlbiwgaW5mb3JtaWVyZW4gU2llIGJpdHRlIHNv
Zm9ydCBkZW4gQWJzZW5kZXIgdW5kIA0KdmVybmljaHRlbiBTaWUgZGllc2UgTWFpbC4gRGFzIHVu
ZXJsYXVidGUgS29waWVyZW4gc293aWUgZGllIHVuYmVmdWd0ZSANCldlaXRlcmdhYmUgZGllc2Vy
IE1haWwgaXN0IG5pY2h0IGdlc3RhdHRldC4NCg0KVGhpcyBlbWFpbCBtYXkgY29udGFpbiBjb25m
aWRlbnRpYWwgYW5kL29yIHByaXZpbGVnZWQgaW5mb3JtYXRpb24uDQpJZiB5b3UgYXJlIG5vdCB0
aGUgaW50ZW5kZWQgcmVjaXBpZW50IG9yIGhhdmUgcmVjZWl2ZWQgdGhpcyBlbWFpbCBpbiANCmVy
cm9yLCBwbGVhc2Ugbm90aWZ5IHRoZSBzZW5kZXIgaW1tZWRpYXRlbHkgYW5kIGRlc3Ryb3kgdGhp
cyBlbWFpbC4NCkFueSB1bmF1dGhvcml6ZWQgY29weWluZywgZGlzY2xvc3VyZSBvciBkaXN0cmli
dXRpb24gb2YgdGhlIG1hdGVyaWFsIGluIA0KdGhpcyBlbWFpbCBpcyBzdHJpY3RseSBmb3JiaWRk
ZW4uDQoNClBldGVyIERhbGdhYXJkIDxQLkRhbGdhYXJkQGJpb3N0YXQua3UuZGs+IHNjaHJpZWIg
YW0gMTAuMTIuMjAwOSAxNToxNTowOToNCg0KPiBnLnJ1c3NlbGxAZW9zLXNvbHV0aW9ucy5jb20g
d3JvdGU6DQo+ID4gDQpTU0JrYjI0bmRDQnJibTkzSUdGaWIzVjBJSFJvWlNCMFpXTm9ibWxqWVd4
cGRHbGxjeXdnWW5WMElGQmxkR1Z5SUVSaGJHZGhZWEprDQo+ID4gDQpJSE5oYVdRZ2RHaGxJQTBL
YjJabVpXNWthVzVuSUdOdlpHVWdZV3h6YnlCallYVnpaWE1nVWlCMGJ5QmpiMjFsSUhSdklHRWdj
M1J2DQo+ID4gDQpjQ0IxYzJsdVp5QlRWVk5GSUNzZ1YwbE9SUzRnU1hNZ2FYUWdEUXB3YjNOemFX
SnNaU0IwYnlCeWRXNGdkR2hoZENCc2IzUWdiMjRnDQo+IFsuLi5BcmdoISwgSml0dGVyYnVnIG11
c3QgZGllLi4uLl0NCj4gDQo+IA0KPiBGb3IgdGhvc2Ugd2hvIGNhbm5vdCByZWFkIGJhc2U2NCBj
b2RlZCBtYWlscyBieSBleWUsIHRoZXNlIGFyZSB0aGUNCj4gY29udGVudHMgKGFuIHVubWFuZ2xl
ZCB2ZXJzaW9uIHJlYWNoZWQgci1kZXZlbCwgYnV0IHByb2JhYmx5IG5vdCANCnItYnVncyk6DQo+
IA0KPiANCj4gSSBkb24ndCBrbm93IGFib3V0IHRoZSB0ZWNobmljYWxpdGllcywgYnV0IFBldGVy
IERhbGdhYXJkIHNhaWQgdGhlDQo+IG9mZmVuZGluZyBjb2RlIGFsc28gY2F1c2VzIFIgdG8gY29t
ZSB0byBhIHN0b3AgdXNpbmcgU1VTRSArIFdJTkUuIElzIGl0DQo+IHBvc3NpYmxlIHRvIHJ1biB0
aGF0IGxvdCBvbiB0b3Agb2YgdmFsZ3JpbmQ/IE9mIGNvdXJzZSwgaXQgd2lsbCBwcm9iYWJseQ0K
PiB0YWtlIGFsbCBkYXkgLi4uDQo+IA0KPiBJZiBub3QsIEkgaGF2ZSBhICBjbHVlIHdoaWNoIG1p
Z2h0IGhlbHAuIFRoZSBwcm9ibGVtIHNlZW1zIHRvIGxpZSBpbiB0aGUNCj4gInN1YiIgcm91dGlu
ZS4gSW4gdGhlIG9yaWdpbmFsIHJlcG9ydCBJIHVzZWQNCj4gLS0gY3V0IGhlcmUgLS0NCj4gZ2N0
b3J0dXJlKCkNCj4gdSA8LSBpbnRUb1V0ZjgoYyhyZXAoMWUzLDFlMiksMzIsYyhyZXAoMWUzLDFl
MikpKSkNCj4gdiA8LSByZXAodSwxZTIpDQo+IHYgPC0gc3ViKCIgIiwiIix2KQ0KPiB2ICVpbiUg
IiINCj4gLS0gY3V0IGhlcmUgLS0NCj4gDQo+IEkndmUgdHJpZWQgcmVkdWNpbmcgdGhpcyBhIGJp
dCBtb3JlLiBSZXBsYWNpbmcgaW50VG9VdGY4IHdpdGggYSBkaXJlY3QNCj4gYXNzaWdubWVudCB3
cml0aW5nIG91dCB0aGUgc3RyaW5nIHdpdGggVW5pY29kZSBlc2NhcGVzIHNlZW1zIHRvIG1ha2Ug
bm8NCj4gZGlmZmVyZW5jZS4gVGhlICVpbiUgY2FuIGJlIHJlcGxhY2VkIHdpdGggIm1hdGNoIiwg
bGVhdmluZyB0aGUgDQpmb2xsb3dpbmc6DQo+IC0tIGN1dCBoZXJlIC0tDQo+IGdjdG9ydHVyZSgp
DQo+IHUgPC0gaW50VG9VdGY4KGMocmVwKDFlMywxZTIpLDMyLGMocmVwKDFlMywxZTIpKSkpDQo+
IHYgPC0gcmVwKHUsMWUyKQ0KPiB2IDwtIHN1YigiICIsIiIsdikNCj4gbWF0Y2godiwiIikNCj4g
LS0gY3V0IGhlcmUgLS0NCj4gVGhpcyBhbHNvIGNyYXNoZXMgUi0yLjEwLjAgYW5kIFItMi4xMC4x
IFJDICgyMDA5LTEyLTA2IHI1MDY4NCkuDQo+IA0KPiBUaGUgc3ViIGxpbmUgaXMgZXNzZW50aWFs
LCBzbyBmYXIgYXMgSSBjYW4gc2VlLCB3aXRob3V0IGl0IHdlIGRvbid0IGdldA0KPiB0aGUgY3Jh
c2guIElmIHdlIGFkZCAicGVybCA9IFRSVUUiIHRoaXMgc2VlbXMgdG8gbWFrZSBubyBkaWZmZXJl
bmNlIA0KKHRoZXJlDQo+IGlzIHN0aWxsIGEgY3Jhc2gpLiBJZiBpbnN0ZWFkIHdlIHVzZSAiZml4
ZWQgPSBUUlVFIiwgdGhlIHJlc3VsdCBpcyANCnN0cmFuZ2UNCj4gYW5kIGRpZmZlcnMgZm9yIFIt
Mi4xMC4wIGFuZCBSLTIuMTAuMSBSQy4gVGhpcyBpcyBlc3BlY2lhbGx5IHN0cmFuZ2UsDQo+IGJl
Y2F1c2UgaW4gYW4gdW5idWdnZWQgUiwgdGhlIHJlc3VsdCBvZiB2IHJldHVybmVkIGZyb20gc3Vi
IHNob3VsZCBiZSANCnRoZQ0KPiBzYW1lIGVpdGhlciB3aXRoIGZpeGVkID0gVFJVRSBvciBwZXJs
ID0gVFJVRS4NCj4gDQo+IFItMi4xMC4wIHBhdXNlcyBzZXZlcmFsIHNlY29uZHMsIHRoZW4gcHJv
ZHVjZXMgdGhlIGVuaWdtYXRpYyBvdXRwdXQ6DQo+ID4gbWF0Y2godiwiIikNCj4gICBbMV0gMDAg
MDAgMDYgOWQgNzggOWMgY2QgNTQgNWQgNGYgODMgMzAgMTQgMmQgZWMgOWIgYTkgMzMgOTkgMmYg
ZmUgODkgDQo2NQ0KPiAxYSBlMw0KPiAgWzI2XSBjMyBkZSA4YyAyNiBiZSAzOCA3ZCBkNSBjNyA0
YSBhZiAwYyA1NyBjYSA0MiBjYiA4YyBiZiBkYyAxOCA5MyA2MSANCjI5DQo+IDFkIDgzDQo+ICBb
NTFdIDhlIDdkIGM0IDE4IDIzIDQ5IGExIGY0IGRlIDllIDdiIDRlIGVmIDgxIDQ3IDA3IDIxIDY0
IDIzIDViIDNlIGVjIA0KMWENCj4gNDIgNTYNCj4gIFs3Nl0gNGIgZGUgZWEgYjYgNWMgYjMgZTQg
ZTggYzggZDEgZjIgODAgNDEgZTQgYmIgMzIgN2UgNWMgNTggYWUgZjMgNDkgDQpmOA0KPiA2NiBh
Ng0KPiBbMTAxXSBjZSBiMCAzYiBjNSAxZSBjOCA2OSAzMSBiNSAxNSA4MCA5OCA4NCA4NCBjYiBl
OSAyMiBkYiA2MSAyNyAxYiA1MyANCjRhDQo+IDgwIDBkDQo+IFsxMjZdIDJmIDBhIGUzIDk5IDlj
IGY0IDkxIGJhIDRhIDQxIDY3IDhlIDY5IDBjIGQ3IDE0IDczIGFlIGQxIGNjIDhjIDBlIA0KZjcN
Cj4gM2QgODYNCj4gWzE1MV0gNDUgMWMgODEgNDEgYmUgMTkgM2UgYmYgODIgMmIgNGMgNDAgZWUg
MDcgMzMgMGEgMGYgOGMgYmUgYTcgNmYgM2EgDQo2Mg0KPiBhZCA2OA0KPiBbMTc2XSBhZiBlOCAx
MiA3OCBjMSAzMSAxNSBjOCBhYSA5ZCA5YSBhMSA1YyA4OSBkZCA1NyBjYiBlYiAyNyBkYSAxNCAz
OCANCmYyDQo+IDIwIGRkDQo+IFsyMDFdIDVjIDQ1IGJhIGMxIDcwIDAwIDliIDE0IDM1IGRjIDRj
IDZlIDQ5IDRkIDUxIGU2IDhlIGQzIDRkIDk1IDU0IGFhIA0KZjENCj4gMTkgOTANCj4gWzIyNl0g
MzIgMjEgMjcgMjkgNzMgZTggMjYgYmYgNTMgZDYgMzIgNzEgMGEgNGUgZGEgMDEgNTEgNDkgZTMg
ODQgNDggNzcgDQpjZQ0KPiA4MSBkYw0KPiBbMjUxXSA2NCAyZCAxOSBhYiAwZCA3YiAzMyA0MiA5
ZiA5OSA0MiA2NCBhZiBhNyBhOCA1ZSA5ZCAwZiBjZSA4NiA4MyBhMSANCmQ5DQo+IGMxIGE1DQo+
IFsyNzZdIDdmIGQwIDk3IDg2IDY5IDE2IGEyIGRkIDU0IDkwIGE2IDkzIDIxIDFmIDI1IGJhIGMy
IGQyIDU0IDY4IDI1IGM4IA0KMzENCj4gNDkgZDYNCj4gWzMwMV0gYWUgZWUgOWYgMmEgYmEgZDQg
OTYgYTYgODkgMDMgNjAgMjIgODMgMmIgM2IgMTcgNTMgM2EgY2UgNzkgMTcgM2UgDQo5Ng0KPiBi
NSBkMw0KPiBbMzI2XSBlYSBlYSBiNCAzYiA5ZiA4YiA5ZiBiOSBhNSBjZCBhNyA0MCA0MSA4NCA0
YyBhOSBjZSBkZCBkZCA0OSBmZSBjNiANCjNlDQo+IDA3IDdmDQo+IFszNTFdIDU0IGU3IDdmIGQ5
IGY0IDUwIDc3IDVjIDE5IGE5IGUwIGI5IDVlIGIyIGRkIDYwIDc5IDZjIDEzIGFkIDFlIDE3IA0K
OTgNCj4gMTEgMWMNCj4gWzM3Nl0gOTEgZGIgZTUgNWYgN2UgZGYgMGYgZTcgNDMgNTcgYzkgN2Qg
MDEgNmMgM2UgMWEgNWQgMGMgMmYgYWIgOTkgNmUgDQphOQ0KPiBhOCA4OA0KPiBbNDAxXSA1NyAx
YyAzNSA1YSA3YyAwMyA3MyAyMiBlNCBiMQ0KPiANCj4gUi0yLjEwLjEgUkMgcHJvZHVjZXMgdGhl
IGZvbGxvd2luZyBlcXVhbGx5IGVuaWdtYXRpYyBvdXRwdXQ6DQo+ID4gbWF0Y2godiwiIikNCj4g
TlVMTA0KPiBGZWhsZXI6ICdnZXRFbmNDaGFyJyBtdXNzIGbDvHIgQ0hBUlNYUCBhdWZnZXJ1ZmVu
IHdlcmRlbg0KPiANCj4gU28gbXkgcHJvdmlzaW9uYWwgZ3Vlc3MgaXMgdGhlIGJ1ZyBpcyBzb21l
d2hlcmUgaW4gdGhlIHBhcnQgb2YgdGhlDQo+IGludGVybmFsIGNvZGUgZm9yIHN1YiB3aGljaCBp
cyBpbnZva2VkIHdoYXRldmVyIHRoZSB2YWx1ZSBvZiBmaXhlZCBvcg0KPiBwZXJsLiBJdCBpcyBz
dHJhbmdlIHRob3VnaCB0aGF0IGl0IG1ha2VzIGEgZGlmZmVyZW5jZSB3aGV0aGVyIHlvdSANCnNw
ZWNpZnkNCj4gZml4ZWQgPSBUUlVFIG9yIG5vdC4NCj4gDQo+IEdlb3JnZSBSdXNzZWxsDQo+IA0K
PiANCj4gUHJvZiBCcmlhbiBSaXBsZXkgPHJpcGxleUBzdGF0cy5veC5hYy51az4gc2NocmllYiBh
bSAxMC4xMi4yMDA5IA0KMDg6MDA6MzY6DQo+IA0KPiA+IEl0IHNlZW1zIChmcm9tIHRoZSBkZWJ1
Z2dlciBvdXRwdXQpIHRoYXQgdGhpcyBpcyBjb3JydXB0aW9uIGluIHRoZSBSDQo+ID4gbWVtb3J5
IGFsbG9jYXRpb24gcm91dGluZXMuICBTdWNoIHRoaW5ncyBjYW4gdXN1YWxseSBiZSB0cmFja2Vk
IGRvd24NCj4gPiB2aWEgdmFsZ3JpbmQgYW5kIGEgdmFsZ3JpbmQtaW5zdHJ1bWVudGVkIGJ1aWxk
IG9mIFIsIGJ1dCBJIGNhbm5vdA0KPiA+IHRyaWdnZXIgdGhpcyBvbiBhbnkgc3lzdGVtIHdpdGgg
dmFsZ3JpbmQuICBJJ3ZlIHRyaWVkIDY0LSBhbmQgMzItYml0DQo+ID4gdmVyc2lvbnMsIGFuZCBM
YXRpbi0xIGxvY2FsZXMgYXMgd2VsbCBhcyBVVEYtOC4NCj4gPg0KPiA+IFNvIEkgYW0gaW5jbGlu
aW5nIHRvIHRoaW5rIHRoaXMgaXMgV2luZG93cy1zcGVjaWZpYy4gIE9uZSB0aGluZyB0aGF0DQo+
ID4gaXMgc3BlY2lmaWMgdG8gV2luZG93cyBpcyBVQ1MtMiAoMTYtYml0KSB3aWRlIGNoYXJhY3Rl
cnMsIHdoaWNoIG1pZ2h0DQo+ID4gYmUgdGhlIGlzc3VlLiAgQnV0IHdlIHNpbXBseSBkb24ndCBo
YXZlIHRoZSB0b29scyBvbiBXaW5kb3dzIHRoYXQgd2UNCj4gPiBkbyBvbiBvdGhlciBwbGF0Zm9y
bXMuDQo+ID4NCj4gPiBPbiBXZWQsIDkgRGVjIDIwMDksIGcucnVzc2VsbEBlb3Mtc29sdXRpb25z
LmNvbSB3cm90ZToNCj4gPg0KPiA+ID4gSGVsbG8gUGV0ZXIsDQo+ID4gPg0KPiA+ID4gSSBoYXZl
IG5vdyBpbnN0YWxsZWQgUi0yLjEwLjEgUkMgKHNlc3Npb25JbmZvKCkgc2F5cyAiUiB2ZXJzaW9u
IA0KMi4xMC4xDQo+IFJDDQo+ID4gPiAoMjAwOS0xMi0wNiByNTA2ODQpIiwgdGhlIHJlc3QgSSBi
ZWxpZXZlIGlzIGFzIGJlZm9yZSkuIFRoZSANCmZvbGxvd2luZw0KPiBjb2RlDQo+ID4gPiBhbHdh
eXMgYnJpbmdzIFIgLS12YW5pbGxhIGRvd24gKHdpdGggYSBjcmFzaCwgbm90IGEgbm9ybWFsIGV4
aXQpOg0KPiA+ID4gLS0gY3V0IGhlcmUgLS0NCj4gPiA+IGdjdG9ydHVyZSgpDQo+ID4gPiB1IDwt
IGludFRvVXRmOChjKHJlcCgxZTMsMWUyKSwzMixjKHJlcCgxZTMsMWUyKSkpKQ0KPiA+ID4gdiA8
LSByZXAodSwxZTIpDQo+ID4gPiB2IDwtIHN1YigiICIsIiIsdikNCj4gPiA+IHYgJWluJSAiIg0K
PiA+ID4gcSgpDQo+ID4gPiAtLSBjdXQgaGVyZSAtLQ0KPiA+ID4NCj4gPiA+IEkndmUgdHJpZWQg
dGhpcyBzZXZlcmFsIHRpbWVzIG5vdywgd2l0aCBkaWZmZXJlbnQgZWZmZWN0cy4gU29tZXRpbWVz
IA0KUg0KPiA+ID4gY3Jhc2hlcyBhZnRlciAndiAlaW4lICIiJy4gU29tZXRpbWVzIGl0IHN1cnZp
dmVzIHRoYXQgY29tbWFuZCwgYnV0DQo+IGNyYXNoZXMNCj4gPiA+IGR1cmluZyB0aGUgcSgpLiBJ
IGhhdmUgYWxzbyBoYWQgdGhlIGVycm9yIG1lc3NhZ2UgIkZlaGxlciBpbiANCm1hdGNoKHgsDQo+
ID4gPiB0YWJsZSwgbm9tYXRjaCA9IDBMKSA+IDBMIDogVmVyZ2xlaWNoICg2KSBpc3QgbnVyIGbD
vHIgYXRvbWFyZSB1bmQNCj4gPiA+IExpc3RlbnR5cGVuIG3DtmdsaWNoIiBmcm9tIHRoYXQgY29t
bWFuZCAodGhlIG1hdGNoIHNlZW1zIHRvIGJlIHRoZQ0KPiA+ID4gcHJvYmxlbSksIHdoZW4gSSB0
eXBlIHEoKSBSIHN0aWxsIGNyYXNoZXMuDQo+ID4gPg0KPiA+ID4gQmVzdCB3aXNoZXMsDQo+ID4g
Pg0KPiA+ID4gR2VvcmdlIFJ1c3NlbGwgfCBLRyBFT1MgSG9sZGluZyBHbWJIICYgQ28NCj4gPiA+
DQo+ID4gPiBUZWw6ICs0OSA0MCAyODUwIOKAkyAxNTc0ICB8IGcucnVzc2VsbEBlb3Mtc29sdXRp
b25zLmNvbQ0KPiA+ID4NCj4gPiA+IEVPUy4gV2l0aCBoZWFkIGFuZCBoZWFydCBpbiBmaW5hbmNl
DQo+ID4gPg0KPiA+ID4gS0cgRU9TIEhvbGRpbmcgR21iSCAmIENvIHwgU3RlaW5kYW1tIDcxLCAy
MDA5OSBIYW1idXJnIHwgQUcgSGFtYnVyZw0KPiBIUkEgOTUNCj4gPiA+IDc0OA0KPiA+ID4gUGVy
c8O2bmxpY2ggaGFmdGVuZCB8IEVPUyBIb2xkaW5nIEdtYkggfCBBRyBIYW1idXJnIEhSQiA3OCA3
NDgNCj4gPiA+IEdlc2Now6RmdHNmw7xocmVyIHwgSGFucy1XZXJuZXIgU2NoZXJlciwgS2xhdXMg
RW5nYmVyZGluZywgSnVzdHVzDQo+ID4gPiBIZWNraW5nLVZlbHRtYW4sIFBhdWwgTGVhcnkgc2Vu
LiwgQ2hyaXN0b3MgU2F2dmlkZXMsIERyLiBBbmRyZWFzDQo+IFdpdHppZw0KPiA+ID4gVm9yc2l0
emVuZGVyIGRlcyBCZWlyYXRlcyB8IErDvHJnZW4gU2NodWx0ZS1MYWdnZW5iZWNrDQo+ID4gPg0K
PiA+ID4gU2F2ZSBhIHRyZWUuIERvbuKAmXQgcHJpbnQgdGhpcyBlbWFpbCB1bmxlc3MgaXTigJlz
IHJlYWxseSBuZWNlc3NhcnkuDQo+ID4gPg0KPiA+ID4gRGllc2UgRS1NYWlsIGVudGjDpGx0IHZl
cnRyYXVsaWNoZSB1bmQvb2RlciByZWNodGxpY2ggZ2VzY2jDvHR6dGUNCj4gPiA+IEluZm9ybWF0
aW9uZW4uIFdlbm4gU2llIG5pY2h0IGRlciByaWNodGlnZSBBZHJlc3NhdCBzaW5kIG9kZXIgZGll
c2UNCj4gRS1NYWlsDQo+ID4gPiBpcnJ0w7xtbGljaCBlcmhhbHRlbiBoYWJlbiwgaW5mb3JtaWVy
ZW4gU2llIGJpdHRlIHNvZm9ydCBkZW4gQWJzZW5kZXINCj4gdW5kDQo+ID4gPiB2ZXJuaWNodGVu
IFNpZSBkaWVzZSBNYWlsLiBEYXMgdW5lcmxhdWJ0ZSBLb3BpZXJlbiBzb3dpZSBkaWUgDQp1bmJl
ZnVndGUNCj4gPiA+IFdlaXRlcmdhYmUgZGllc2VyIE1haWwgaXN0IG5pY2h0IGdlc3RhdHRldC4N
Cj4gPiA+DQo+ID4gPiBUaGlzIGVtYWlsIG1heSBjb250YWluIGNvbmZpZGVudGlhbCBhbmQvb3Ig
cHJpdmlsZWdlZCBpbmZvcm1hdGlvbi4NCj4gPiA+IElmIHlvdSBhcmUgbm90IHRoZSBpbnRlbmRl
ZCByZWNpcGllbnQgb3IgaGF2ZSByZWNlaXZlZCB0aGlzIGVtYWlsIGluDQo+ID4gPiBlcnJvciwg
cGxlYXNlIG5vdGlmeSB0aGUgc2VuZGVyIGltbWVkaWF0ZWx5IGFuZCBkZXN0cm95IHRoaXMgZW1h
aWwuDQo+ID4gPiBBbnkgdW5hdXRob3JpemVkIGNvcHlpbmcsIGRpc2Nsb3N1cmUgb3IgZGlzdHJp
YnV0aW9uIG9mIHRoZSBtYXRlcmlhbA0KPiBpbg0KPiA+ID4gdGhpcyBlbWFpbCBpcyBzdHJpY3Rs
eSBmb3JiaWRkZW4uDQo+ID4gPg0KPiA+ID4gUGV0ZXIgRGFsZ2FhcmQgPFAuRGFsZ2FhcmRAYmlv
c3RhdC5rdS5kaz4gc2NocmllYiBhbSAwOC4xMi4yMDA5DQo+IDExOjI0OjUwOg0KPiA+ID4NCj4g
PiA+PiBnLnJ1c3NlbGxAZW9zLXNvbHV0aW9ucy5jb20gd3JvdGU6DQo+ID4gPj4+IEZ1bGxfTmFt
ZTogR2VvcmdlIFJ1c3NlbGwNCj4gPiA+Pj4gVmVyc2lvbjogMi4xMC4wDQo+ID4gPj4+IE9TOiBX
aW5kb3dzIFhQIFZlcnNpb24gMjAwMiBTUCAyDQo+ID4gPj4+IFN1Ym1pc3Npb24gZnJvbTogKE5V
TEwpICgyMTcuMTExLjMuMTMxKQ0KPiA+ID4+Pg0KPiA+ID4+Pg0KPiA+ID4+PiBUaGUgZm9sbG93
aW5nIHR5cGVkIGludG8gUiAtLXZhbmlsbGEgaW5kdWNlcyBhIGNyYXNoOg0KPiA+ID4+PiAtLSBj
dXQgaGVyZSAtLQ0KPiA+ID4+PiBnY3RvcnR1cmUoKQ0KPiA+ID4+PiB1IDwtIGludFRvVXRmOChj
KHJlcCgxZTMsMWUyKSwzMixjKHJlcCgxZTMsMWUyKSkpKQ0KPiA+ID4+PiB2IDwtIHJlcCh1LDFl
MikNCj4gPiA+Pj4gdiA8LSBzdWIoIiAiLCIiLHYpDQo+ID4gPj4+IHYgJWluJSAiIg0KPiA+ID4+
PiAtLSBjdXQgaGVyZSAtLQ0KPiA+ID4+Pg0KPiA+ID4+PiBzZXNzaW9uSW5mbygpIHNheXM6DQo+
ID4gPj4+DQo+ID4gPj4+IC0tIGN1dCBoZXJlIC0tDQo+ID4gPj4+IFIgdmVyc2lvbiAyLjEwLjAg
KDIwMDktMTAtMjYpDQo+ID4gPj4+IGkzODYtcGMtbWluZ3czMg0KPiA+ID4+Pg0KPiA+ID4+PiBs
b2NhbGU6DQo+ID4gPj4+IFsxXSBMQ19DT0xMQVRFPUdlcm1hbl9HZXJtYW55LjEyNTIgIExDX0NU
WVBFPUdlcm1hbl9HZXJtYW55LjEyNTINCj4gPiA+Pj4gWzNdIExDX01PTkVUQVJZPUdlcm1hbl9H
ZXJtYW55LjEyNTIgTENfTlVNRVJJQz1DDQo+ID4gPj4+IFs1XSBMQ19USU1FPUdlcm1hbl9HZXJt
YW55LjEyNTINCj4gPiA+Pj4NCj4gPiA+Pj4gYXR0YWNoZWQgYmFzZSBwYWNrYWdlczoNCj4gPiA+
Pj4gWzFdIHN0YXRzICAgICBncmFwaGljcyAgZ3JEZXZpY2VzIGRhdGFzZXRzICB1dGlscyAgICAg
bWV0aG9kcyBiYXNlDQo+ID4gPj4+IC0tIGN1dCBoZXJlIC0tDQo+ID4gPj4+DQo+ID4gPj4+IEkg
YXBvbG9naXNlIGZvciBub3QgdGVzdGluZyB0aGlzIHdpdGggUi0yLjEwLjEgYnV0IGFzIGZhciBh
cyBJIGNhbg0KPiA+ID4+IHNlZSB0aGVyZSBhcmUNCj4gPiA+Pj4gb25seSBzb3VyY2UgcmVsZWFz
ZXMgYXZhaWxhYmxlIHNvIGZhciwgd2hpY2ggSSBhbSBub3QgYWJsZSB0bw0KPiBjb21waWxlLg0K
PiA+ID4+Pg0KPiA+ID4+DQo+ID4gPj4gMi4xMC4xIFJDIGlzIGF2YWlsYWJsZSBub3cuIFBsZWFz
ZSBjaGVjay4gSXQgZG9lcyBzZWVtIHRvIGJlDQo+ID4gPj4gcmVwcm9kdWNpYmxlIGluIHRoZSBX
aW5kb3dzIHZlcnNpb24sIG9yIGF0IGxlYXN0IGl0IHRha2VzIGEgdmVyeSANCmxvbmcNCj4gPiA+
PiB0aW1lLCBidXQgdGhhdCBtZWFucyBydW5uaW5nIHVuZGVyIFdpbmUgb24gU1VTRSBmb3IgbWUu
IEkgZG9uJ3Qgc2VlDQo+IHRoZQ0KPiA+ID4+IGVmZmVjdCB3aXRoIHRoZSBMaW51eCBidWlsZC4N
Cj4gPiA+Pg0KPiA+ID4+IC0tDQo+ID4gPj4gICAgT19fICAtLS0tIFBldGVyIERhbGdhYXJkICAg
ICAgICAgICAgIMOYc3RlciBGYXJpbWFnc2dhZGUgNSwgDQpFbnRyLkINCj4gPiA+PiAgIGMvIC8n
XyAtLS0gRGVwdC4gb2YgQmlvc3RhdGlzdGljcyAgICAgUE8gQm94IDIwOTksIDEwMTQgQ3BoLiBL
DQo+ID4gPj4gICgqKSBcKCopIC0tIFVuaXZlcnNpdHkgb2YgQ29wZW5oYWdlbiAgIERlbm1hcmsg
ICAgICBQaDogICgrNDUpDQo+IDM1MzI3OTE4DQo+ID4gPj4gfn5+fn5+fn5+fiAtIChwLmRhbGdh
YXJkQGJpb3N0YXQua3UuZGspICAgICAgICAgICAgICBGQVg6ICgrNDUpDQo+IDM1MzI3OTA3DQo+
ID4gPj4NCj4gPiA+DQo+ID4gPiBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fDQo+ID4gPiBSLWRldmVsQHItcHJvamVjdC5vcmcgbWFpbGluZyBsaXN0DQo+ID4g
PiBodHRwczovL3N0YXQuZXRoei5jaC9tYWlsbWFuL2xpc3RpbmZvL3ItZGV2ZWwNCj4gPiA+DQo+
ID4NCj4gPiAtLQ0KPiA+IEJyaWFuIEQuIFJpcGxleSwgICAgICAgICAgICAgICAgICByaXBsZXlA
c3RhdHMub3guYWMudWsNCj4gPiBQcm9mZXNzb3Igb2YgQXBwbGllZCBTdGF0aXN0aWNzLCAgaHR0
cDovL3d3dy5zdGF0cy5veC5hYy51ay9+cmlwbGV5Lw0KPiA+IFVuaXZlcnNpdHkgb2YgT3hmb3Jk
LCAgICAgICAgICAgICBUZWw6ICArNDQgMTg2NSAyNzI4NjEgKHNlbGYpDQo+ID4gMSBTb3V0aCBQ
YXJrcyBSb2FkLCAgICAgICAgICAgICAgICAgICAgICs0NCAxODY1IDI3Mjg2NiAoUEEpDQo+ID4g
T3hmb3JkIE9YMSAzVEcsIFVLICAgICAgICAgICAgICAgIEZheDogICs0NCAxODY1IDI3MjU5NQ0K
PiANCj4gDQo+IA0KPiANCj4gLS0gDQo+ICAgIE9fXyAgLS0tLSBQZXRlciBEYWxnYWFyZCAgICAg
ICAgICAgICDDmHN0ZXIgRmFyaW1hZ3NnYWRlIDUsIEVudHIuQg0KPiAgIGMvIC8nXyAtLS0gRGVw
dC4gb2YgQmlvc3RhdGlzdGljcyAgICAgUE8gQm94IDIwOTksIDEwMTQgQ3BoLiBLDQo+ICAoKikg
XCgqKSAtLSBVbml2ZXJzaXR5IG9mIENvcGVuaGFnZW4gICBEZW5tYXJrICAgICAgUGg6ICAoKzQ1
KSAzNTMyNzkxOA0KPiB+fn5+fn5+fn5+IC0gKHAuZGFsZ2FhcmRAYmlvc3RhdC5rdS5kaykgICAg
ICAgICAgICAgIEZBWDogKCs0NSkgMzUzMjc5MDcNCj4gDQoNCg==


From pengyu.ut at gmail.com  Thu Dec 10 21:35:52 2009
From: pengyu.ut at gmail.com (Peng Yu)
Date: Thu, 10 Dec 2009 14:35:52 -0600
Subject: [Rd] Which version of findInterval is used?
Message-ID: <366c6f340912101235m6d7e2773q173abd5594ceca7a@mail.gmail.com>

In an R session, I see the following, which means that findInterval is
an R function.

> findInterval
function (x, vec, rightmost.closed = FALSE, all.inside = FALSE)
{
    if (any(is.na(vec)))
        stop("'vec' contains NAs")
    if (is.unsorted(vec))
        stop("'vec' must be sorted non-decreasingly")
    if (has.na <- any(ix <- is.na(x)))
        x <- x[!ix]
    nx <- length(x)
    index <- integer(nx)
    .C("find_interv_vec", xt = as.double(vec), n = length(vec),
        x = as.double(x), nx = nx, as.logical(rightmost.closed),
        as.logical(all.inside), index, DUP = FALSE, NAOK = TRUE,
        PACKAGE = "base")
    if (has.na) {
        ii <- as.integer(ix)
        ii[ix] <- NA
        ii[!ix] <- index
        ii
    }
    else index
}
<environment: namespace:base>


However, I also see a C function with the same name in
src/appl/interv.c. I'm wondering where is this use?

int findInterval(double *xt, int n, double x,
		  Rboolean rightmost_closed,  Rboolean all_inside, int ilo,
		  int *mflag)


From pengyu.ut at gmail.com  Thu Dec 10 21:53:01 2009
From: pengyu.ut at gmail.com (Peng Yu)
Date: Thu, 10 Dec 2009 14:53:01 -0600
Subject: [Rd] Request to add section number to the bookmarks of R pdf
	documents
Message-ID: <366c6f340912101253q51e571d0m4fe922730d4b8b14@mail.gmail.com>

It will be convenient to add section number to the bookmarks of R
documents that are in pdf format. Could somebody take some time add
the sections number?

?Writing R Extensions
R Data Import/Export
R Language Definition
etc.


From pengyu.ut at gmail.com  Thu Dec 10 22:02:13 2009
From: pengyu.ut at gmail.com (Peng Yu)
Date: Thu, 10 Dec 2009 15:02:13 -0600
Subject: [Rd] Which packages in R use C++?
Message-ID: <366c6f340912101302h693f99e7m8bbaa29975c879fa@mail.gmail.com>

I want to see some working examples on how to call C++ programs from
R. Could somebody let me know which R packages mainly use C++ rather
than C or Fortran?


From edd at debian.org  Thu Dec 10 22:16:04 2009
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 10 Dec 2009 15:16:04 -0600
Subject: [Rd] Which packages in R use C++?
In-Reply-To: <366c6f340912101302h693f99e7m8bbaa29975c879fa@mail.gmail.com>
References: <366c6f340912101302h693f99e7m8bbaa29975c879fa@mail.gmail.com>
Message-ID: <19233.25876.540878.45388@ron.nulle.part>


On 10 December 2009 at 15:02, Peng Yu wrote:
| I want to see some working examples on how to call C++ programs from
| R. Could somebody let me know which R packages mainly use C++ rather
| than C or Fortran?

I am not aware of anyone keeping aggregate statistics.  

If you would like a simple example of C++ usage --- via the Rcpp package I
maintain --- then I'd recommend the Earth Mover Distance package on R-Forge
which wraps a single function providing the Earth Mover Distance metric:

 https://r-forge.r-project.org/projects/earthmovdist/

and the SVN sources are here

 https://r-forge.r-project.org/plugins/scmsvn/viewcvs.php/pkg/?root=earthmovdist

A more complicated example is e.g. RQuantLib on R-Forge and CRAN.

Dirk

-- 
Three out of two people have difficulties with fractions.


From pengyu.ut at gmail.com  Thu Dec 10 22:56:02 2009
From: pengyu.ut at gmail.com (Peng Yu)
Date: Thu, 10 Dec 2009 15:56:02 -0600
Subject: [Rd] How to organized code in the R/ directory of a package?
Message-ID: <366c6f340912101356j1be51766lba30bc00de72e52f@mail.gmail.com>

I'm making a package, Current, I put all R files in the R/ directory
in the package (without using subdirectory). This will become a
problem when there are many files in the directory. I'm wondering how
to use subdirectories in R/?

Does 'R CMD INSTALL' install the files in the subdirectories automatically?


From tobias.verbeke at openanalytics.be  Thu Dec 10 23:22:49 2009
From: tobias.verbeke at openanalytics.be (Tobias Verbeke)
Date: Thu, 10 Dec 2009 23:22:49 +0100
Subject: [Rd] How to organized code in the R/ directory of a package?
In-Reply-To: <366c6f340912101356j1be51766lba30bc00de72e52f@mail.gmail.com>
References: <366c6f340912101356j1be51766lba30bc00de72e52f@mail.gmail.com>
Message-ID: <4B2174B9.1050807@openanalytics.be>

Peng Yu wrote:
> I'm making a package, Current, I put all R files in the R/ directory
> in the package (without using subdirectory). This will become a
> problem when there are many files in the directory. I'm wondering how
> to use subdirectories in R/?

The standard solution is (I would think) to organize the code
such that functions belonging together are grouped in one file.

Best,
Tobias

> 
> Does 'R CMD INSTALL' install the files in the subdirectories automatically?
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From h.wickham at gmail.com  Thu Dec 10 23:29:26 2009
From: h.wickham at gmail.com (hadley wickham)
Date: Thu, 10 Dec 2009 16:29:26 -0600
Subject: [Rd] How to organized code in the R/ directory of a package?
In-Reply-To: <366c6f340912101356j1be51766lba30bc00de72e52f@mail.gmail.com>
References: <366c6f340912101356j1be51766lba30bc00de72e52f@mail.gmail.com>
Message-ID: <f8e6ff050912101429y343d3f1ev9b2ef6b63c9d9bab@mail.gmail.com>

I have 145 R files in ggplot2, but don't have any problems navigating
them (with appropriate tool support).  Just  how many files do you
have?

Hadley

On Thu, Dec 10, 2009 at 3:56 PM, Peng Yu <pengyu.ut at gmail.com> wrote:
> I'm making a package, Current, I put all R files in the R/ directory
> in the package (without using subdirectory). This will become a
> problem when there are many files in the directory. I'm wondering how
> to use subdirectories in R/?
>
> Does 'R CMD INSTALL' install the files in the subdirectories automatically?
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
http://had.co.nz/


From pengyu.ut at gmail.com  Thu Dec 10 23:49:39 2009
From: pengyu.ut at gmail.com (Peng Yu)
Date: Thu, 10 Dec 2009 16:49:39 -0600
Subject: [Rd] How to organized code in the R/ directory of a package?
In-Reply-To: <f8e6ff050912101429y343d3f1ev9b2ef6b63c9d9bab@mail.gmail.com>
References: <366c6f340912101356j1be51766lba30bc00de72e52f@mail.gmail.com>
	<f8e6ff050912101429y343d3f1ev9b2ef6b63c9d9bab@mail.gmail.com>
Message-ID: <366c6f340912101449k7d436b77y37c2450ea772fdd8@mail.gmail.com>

I don't have many files yet. I'm just wondering what the convention of
organizing files is, as different programming languages have different
ways of organizing source code. I don't want to start in a wrong way
and later to correct it.

I don't see ggplot in a tar.gz file on your website. It is also
removed from cran. Would you please let me know where I can download
the source code to take a look?

What 'appropriate tool support' do you refer to?

On Thu, Dec 10, 2009 at 4:29 PM, hadley wickham <h.wickham at gmail.com> wrote:
> I have 145 R files in ggplot2, but don't have any problems navigating
> them (with appropriate tool support). ?Just ?how many files do you
> have?
>
> Hadley
>
> On Thu, Dec 10, 2009 at 3:56 PM, Peng Yu <pengyu.ut at gmail.com> wrote:
>> I'm making a package, Current, I put all R files in the R/ directory
>> in the package (without using subdirectory). This will become a
>> problem when there are many files in the directory. I'm wondering how
>> to use subdirectories in R/?
>>
>> Does 'R CMD INSTALL' install the files in the subdirectories automatically?
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
>
> --
> http://had.co.nz/
>


From cstrato at aon.at  Fri Dec 11 00:22:47 2009
From: cstrato at aon.at (cstrato)
Date: Fri, 11 Dec 2009 00:22:47 +0100
Subject: [Rd] Which packages in R use C++?
In-Reply-To: <366c6f340912101302h693f99e7m8bbaa29975c879fa@mail.gmail.com>
References: <366c6f340912101302h693f99e7m8bbaa29975c879fa@mail.gmail.com>
Message-ID: <4B2182C7.3030101@aon.at>

Have a look at:
http://www.bioconductor.org/packages/release/bioc/html/xps.html
It is almost completely C++

Regards
Christian
_._._._._._._._._._._._._._._._._._
C.h.r.i.s.t.i.a.n   S.t.r.a.t.o.w.a
V.i.e.n.n.a           A.u.s.t.r.i.a
e.m.a.i.l:        cstrato at aon.at
_._._._._._._._._._._._._._._._._._


From h.wickham at gmail.com  Fri Dec 11 01:24:38 2009
From: h.wickham at gmail.com (hadley wickham)
Date: Thu, 10 Dec 2009 18:24:38 -0600
Subject: [Rd] How to organized code in the R/ directory of a package?
In-Reply-To: <366c6f340912101449k7d436b77y37c2450ea772fdd8@mail.gmail.com>
References: <366c6f340912101356j1be51766lba30bc00de72e52f@mail.gmail.com> 
	<f8e6ff050912101429y343d3f1ev9b2ef6b63c9d9bab@mail.gmail.com> 
	<366c6f340912101449k7d436b77y37c2450ea772fdd8@mail.gmail.com>
Message-ID: <f8e6ff050912101624v1ca21002s6f80b90028212124@mail.gmail.com>

> I don't see ggplot in a tar.gz file on your website. It is also
> removed from cran. Would you please let me know where I can download
> the source code to take a look?

It's ggplot2, not ggplot.

> What 'appropriate tool support' do you refer to?

Your text editor should make it easy to switch to another file by
typing in a few characters in its name.

Hadley

-- 
http://had.co.nz/


From d.scott at auckland.ac.nz  Fri Dec 11 01:52:21 2009
From: d.scott at auckland.ac.nz (David Scott)
Date: Fri, 11 Dec 2009 13:52:21 +1300
Subject: [Rd] How to organized code in the R/ directory of a package?
In-Reply-To: <4B2174B9.1050807@openanalytics.be>
References: <366c6f340912101356j1be51766lba30bc00de72e52f@mail.gmail.com>
	<4B2174B9.1050807@openanalytics.be>
Message-ID: <4B2197C5.9030305@auckland.ac.nz>

Tobias Verbeke wrote:
> Peng Yu wrote:
>> I'm making a package, Current, I put all R files in the R/ directory
>> in the package (without using subdirectory). This will become a
>> problem when there are many files in the directory. I'm wondering how
>> to use subdirectories in R/?
> 
> The standard solution is (I would think) to organize the code
> such that functions belonging together are grouped in one file.
> 

That is what I try to do. My rule is that functions which are documented 
in the same .Rd file are also in the same .R file. Might be more 
sensible for some packages than for others.

David

_________________________________________________________________
David Scott	Department of Statistics
		The University of Auckland, PB 92019
		Auckland 1142,    NEW ZEALAND
Phone: +64 9 923 5055, or +64 9 373 7599 ext 85055
Email:	d.scott at auckland.ac.nz,  Fax: +64 9 373 7018

Director of Consulting, Department of Statistics


From armstrong.whit at gmail.com  Fri Dec 11 14:06:11 2009
From: armstrong.whit at gmail.com (Whit Armstrong)
Date: Fri, 11 Dec 2009 08:06:11 -0500
Subject: [Rd] Which packages in R use C++?
In-Reply-To: <19233.25876.540878.45388@ron.nulle.part>
References: <366c6f340912101302h693f99e7m8bbaa29975c879fa@mail.gmail.com>
	<19233.25876.540878.45388@ron.nulle.part>
Message-ID: <8ec76080912110506j26b8d05cg4425e7cd6a61fa01@mail.gmail.com>

and fts, making heavy use of templates for R types:

http://github.com/armstrtw/fts

-Whit


On Thu, Dec 10, 2009 at 4:16 PM, Dirk Eddelbuettel <edd at debian.org> wrote:
>
> On 10 December 2009 at 15:02, Peng Yu wrote:
> | I want to see some working examples on how to call C++ programs from
> | R. Could somebody let me know which R packages mainly use C++ rather
> | than C or Fortran?
>
> I am not aware of anyone keeping aggregate statistics.
>
> If you would like a simple example of C++ usage --- via the Rcpp package I
> maintain --- then I'd recommend the Earth Mover Distance package on R-Forge
> which wraps a single function providing the Earth Mover Distance metric:
>
> ?https://r-forge.r-project.org/projects/earthmovdist/
>
> and the SVN sources are here
>
> ?https://r-forge.r-project.org/plugins/scmsvn/viewcvs.php/pkg/?root=earthmovdist
>
> A more complicated example is e.g. RQuantLib on R-Forge and CRAN.
>
> Dirk
>
> --
> Three out of two people have difficulties with fractions.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From karl at huftis.org  Fri Dec 11 12:36:11 2009
From: karl at huftis.org (Karl Ove Hufthammer)
Date: Fri, 11 Dec 2009 12:36:11 +0100
Subject: [Rd] R on Windows crashes when using certain characters in
	strings in data frames (PR#14125)
References: <20091210092009.D1A7A282EFC8@mail.pubhealth.ku.dk>
Message-ID: <MPG.258c4d052bca143f9896c5@news.gmane.org>

On Thu, 10 Dec 2009 10:20:09 +0100 (CET) karl at huftis.org 
<karl at huftis.org> wrote:

> The following commands trigger the crash for me:
> 
> n=1e5
> k=10
> x=sample(k,n,replace=TRUE)
> y=sample(k,n,replace=TRUE)
> xy=paste(x,y,sep=" ? ")
> z=sample(n)
> d=data.frame(xy,z)

Note: On the R Bug Tracking System Web site, the character causing the 
problem seems to be incorrectly displayed as a '.', though on the 
mailing list the correct character is used. The character should be the 
multiplication symbol, U+00D7, which looks similar to an 'x'. The 
character does exist in both ISO 8859-1 and Windows-1252.

-- 
Karl Ove Hufthammer


From brglez at ncsu.edu  Thu Dec 10 23:11:52 2009
From: brglez at ncsu.edu (Franc Brglez)
Date: Thu, 10 Dec 2009 17:11:52 -0500
Subject: [Rd] binary string conversion to a vector (PR#14120)
Message-ID: <D294391D-D31E-41AF-BC96-77AF138ACCBE@ncsu.edu>

Hello!
 
Please accept my sincere apologies for annoying the R development team with my post this week. If I were required to register as "a developer" before submission, this would not have happened. To rehabilitate myself, please find at the bottom of this mail two R-functions, 'string2vector' and 'vector2string', with "comments and tests". Both functions may go a long way towards assisting a number of R-users to make their R-programming more productive. I am a novice R-programmer: I started dabbling in R less than two months ago, heavily influenced by examples of code I see, including within the R.org documents (monkey does what monkey sees). Before posting two functions, I would really appreciate constructive edits where they may be needed as well as their posting by someone-in-the-know so there will be conveniently accessible for R users.

I am very impressed with potential of R and the community supporting it. I just wish I got to R sooner: I am looking to R to better support my work in "designed experiments to assess the statistically significant performance of combinatorial optimization algorithms on instance isomorphs of NP-hard problems" -- for better context of this mouthful, see the few postings under
  http://www.cbl.ncsu.edu:16080/xBed/publications/
I am working on a tutorial paper where I expect R to play a significant role in better explaining and illustrating, code-wise and graphically, the concepts discussed in the publications above. I would welcome a co-author with experience in R-programming as well as statistics and interests in the experimental methods addressed in these publications.

As I elaborate in notes that follow, I was looking at a variety of "R-documents" before my "bug" submission. I would appreciate very much if some of you could take the time to scan through these notes and respond briefly with useful pointers. Here are the headlines:

    (1) why I still think there may be a bug with 'noquote' vs 'as.integer'

    (2) search on "split string" and "join string"; the missing package "stringr"

    (3) a take on "Tcl" commands 'split', 'join', 'string', 'append', 'foreach'

    (4) a take on "R" functions 'string2vector' and 'vector2string'

    (5) code and comments for "R" functions 'string2vector' and 'vector2string

(1) why I still think there may be a bug with 'noquote' vs 'as.integer'
--------------------------------------------------------------------------------
> # MacOSX 10.6.2, R 2.9.1 GUI 1.28 Tiger build 32-bit (5444)
> qvector
[1] "0" "0" "0" "1" "1" "0" "1"
> qvector[1]
[1] "0"
> tmp = noquote(qvector[1])
> tmp
[1] 0
> tmp = as.integer(qvector[1])
> tmp
[1] 0
> 
When embedded in the function as per my "bug" report, 'noquote' and 'as.integer' are no longer equivalent whereas in the example above they appear to be equivalent!! I submitted the "function" with print/cat statements for sake of illustration.

(2) search on "split string" and "join string"; the missing package "stringr"
--------------------------------------------------------------------------------
http://search.r-project.org/ reveals
   orderof 850 messages for search on "split string"
   orderof 160 messages for search on "join string"

http://finzi.psych.upenn.edu/search.html reveals
    for search on "split string"
   	? Rhelp08:   [ split: 890 ] [ string: 1676 ] [ TOTAL: 77 ]
        ? functions: [ split: 954 ] [ string: 6453 ] [ TOTAL: 204 ]
    for search on "join string"
	? Rhelp08:   [ join: 176 ] [ string: 1676 ] [ TOTAL: 8 ]
	? functions: [ join: 192 ] [ string: 6453 ] [ TOTAL: 36 ]
    This site also provides a link to the package "stringr"
    http://finzi.psych.upenn.edu/R/library/stringr/html/00Index.html
However, the download does not deliver ...
> install.packages("stringr")
  ....
   package ?stringr? is not available

There are a lot of hard-to-understand and not-so-relevant code snippets in all these 1000's of postings. I would argue that had robust functions such as 'string2vector' and 'vector2string' been included in the R-package, many R-programmers could take longer vacations, spend their time more productively,
and significantly reduce duplication of coding efforts on basically the same
problems.

Since vector is such and important "primitive" in R, I argue that functions such as 'string2vector' and 'vector2string' should be made to play a role similar to commands 'split', 'join', 'string', and 'append' that support programmers in Tcl. See my take on Tcl in the section below.

(3) a take on "Tcl" commands 'split', 'join', 'string', 'append', 'foreach'
--------------------------------------------------------------------------------
I have been using Tcl to "wrap" a number of combinatorial solvers and automate workflows that implement and execute a number of my experiments on instance isomorphs. I even used Tcl to prototype few combinatorial optimization algorithm prototypes and write code for statistical analysis -- as task for which I now find R much better suited.

I intend to alert my Tcl colleagues in-the-know about the wonderful infrastructure provided in R when it comes to the R-shell (at least under MacOSX), and the ability to name and initialize function variable defaults explicitly, and the ability to install new packages so transparently. Before coming across R, I already took the trouble to create Tcl wrapper programs with command lines that feature identical order-indepent syntax as the syntax used in R. This being said, what I miss about R is gathering all commands on a single page such as
   http://www.tcl.tk/man/tcl8.5/TclCmd/contents.htm
Note that once you click on any of the commands, a number of classes that extend each command become visible, including the example section(s). 

Here I illustrate my use of just five tcl commands that subsequently guided my "design" of the function 'string2vector' in 'vector2string' "R"

# few "Tcl" examples before designing the function 'string2vector' in "R"
% set binS "10011"
% join [split $binS ""] ", "
1, 0, 0, 1, 1
%
% set strS "I \t am\tdone" 
% foreach item [split $strS "\t"] {append strSQ \"$item\",}
% set strSQ [string trimright $strSQ ,]
"I "," am","done"
# 
# few "Tcl" examples before designing the function 'vector2string' in "R"
% set strV "1,0,0,1"
1,0,0,1
% split $strV ","
1 0 0 1
join [split $strV ","] ":"
1:0:0:1

(4) a take on "R" functions 'string2vector' and 'vector2string'
--------------------------------------------------------------------------------
> # few tests of the function 'string2vector' in "R"
> binS = "10011"
> binV = string2vector(binS, SS="", type="int")
> binV[2] ; binV[5]
[1] 0
[1] 1
> strS = "I am done" 
> vecS = string2vector(strS, SS=" ", type="char")
> vecS[1] ; vecS[3]
[1] "I"
[1] "done"
> 
> # few tests of the function 'vector2string' in "R"
> binV = c(1,0,0,1) 
> vector2string(binV, type="int")
[1] "1001"
> vector2string(binV, SS=" ", type="char")
[1] "1 0 0 1"
> subsV = c("I", "am", "done")  
> vector2string(subsV, SS=":", type="char")
[1] "I:am:done"
> 

(5) code and comments for "R" functions 'string2vector' and 'vector2string'
--------------------------------------------------------------------------------

string2vector = function(string="ch-2 \t sec-7\tex-5", SS="\t", type="char")
#
# This procedure splits a string and assigns substrings to an R-vector.
# The split is controlled by the string separator SS (default value:  SS="\t").
# Here we convert  a binary string into a binary vector:
#   let  binS = "10011"  
#   then binV = string2vector(binS, SS="", type="int")
# Here we convert a string into a vector of substrings:
#   let  strS = "I am done" 
#   then vecS = string2vector(strS, SS=" ", type="char")
#
# LIMITATION: The function interprets all substrings either as of type 
#             "int" or "char".  A function that interprets the type of each
#             substring dynamically may one day be written by an R-guru.
#              
# Franc Brglez, Wed Dec  9 14:19:16 EST 2009
{   
    qlist   = strsplit(string, SS) ; qvector = qlist[[1]]
    n = length(qvector) ; xvector = NULL
    for (i in 1:n) {
        if (type == "int") {
            tmp = as.integer(qvector[i])
        } else {
            tmp = qvector[i]
        }
	xvector = c(xvector, tmp)
    }
    return(xvector)
} # string2vector

vector2string = function(vector=c("ch-2", "sec-7", "ex-5"), SS="_", type="char") 
#
# This procedure converts values from a vector to a concatenation of substrings 
# separated by user-specified string separator SS (default value:  SS="_").
# Each substring represents a vector component value, either as a numerical 
# value or as an alphanumeric string. 
# Here we convert a binary vector to a binary string representing an integer:
#   let  binV = c(1,0,0,1)  
#   then strS = vector2string(binV, type="int")
# Here we convert a binary vector to string representing a binary sequence:
#   let  binV = c(1,0,0,1)  
#   then seqS = vector2string(binV, SS=" ", type="char")
# Here we convert a vector of substrings to colon-separated string:
#   let subsV = c("I", "am", "done")  
#   then strS = vector2string(subsV, SS=":", type="char")
#
# LIMITATION: The function interprets all substrings in the vector either as of 
#             type "int" or "char".  A function that interprets the type of each
#             substring dynamically may one day be written by an R-guru.
#
# Franc Brglez, Wed Dec  9 15:43:59 EST 2009
{   
    if (type == "int") {
        string = paste(strsplit(paste(vector), " "), collapse="")
    } else {
        n = length(vector) ; nm1 = n-1 ; string = ""
        for (i in 1:nm1) {
            tmp    = noquote(vector[i])
            string = paste(string, tmp, SS, sep="")
        }
        tmp    = noquote(vector[n])
        string = paste(string, tmp, sep="")     
    }
    return(string)
} # vector2string

----------------
Dr. Franc Brglez                                        email: brglez at ncsu.edu 
Department of Computer Science, Box 8206     http://sitta.csc.ncsu.edu/~brglez
North Carolina State University                            TEL: (919) 515-9675
Raleigh NC 27695-8206 USA  


From baptiste.auguie at gmail.com  Fri Dec 11 15:15:13 2009
From: baptiste.auguie at gmail.com (baptiste.auguie at gmail.com)
Date: Fri, 11 Dec 2009 15:15:13 +0100 (CET)
Subject: [Rd] incorrect linetype with pdf device (PR#14128)
Message-ID: <20091211141513.D509D28320B2@mail.pubhealth.ku.dk>

Full_Name: baptiste augui?
Version: 2.10.1 RC (2009-12-06 r50690) 
OS: Mac OSX 10.5
Submission from: (NULL) (90.25.215.172)


The following code, run with a vanilla R session, produces different visual
output for the two devices,

library(grid)

pdf("test-pdf.pdf")
grid.newpage()
grid.lines(gp=gpar(lty="13", lineend = "butt"))
dev.off()

png("test-png.png")
grid.newpage()
grid.lines(gp=gpar(lty="13", lineend = "butt"))
dev.off()

The pdf output, opened with Acrobat, shows only extremely thin marks (artifacts)
at low zoom factor, and invisible line at higher zoom factor. The same file
opened with Adobe Illustrator reveals that the line pattern lty=13 has in fact
become 04 (0 solid length, 4 space). Similarly, lty=123456 would produce 032547,


pdf("test-123456.pdf")
grid.newpage()
grid.lines(gp=gpar(lty="123456", lineend = "butt"))
dev.off()

while the same command with quartz() gives the correct line pattern,

quartz(type="pdf", file="test2-123456.pdf")
grid.newpage()
grid.lines(gp=gpar(lty="123456", lineend = "butt"))
dev.off()

The same behavior is observed with R 2.11.0 (2009-12-09 r50690) 


sessionInfo()
R version 2.10.1 RC (2009-12-06 r50690) 
i386-apple-darwin9.8.0 

locale:
[1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets  methods  
[8] base


From baptiste.auguie at gmail.com  Fri Dec 11 15:30:10 2009
From: baptiste.auguie at gmail.com (baptiste.auguie at gmail.com)
Date: Fri, 11 Dec 2009 15:30:10 +0100 (CET)
Subject: [Rd] incorrect linetype with quartz device (PR#14129)
Message-ID: <20091211143010.45AA628320B2@mail.pubhealth.ku.dk>

Full_Name: baptiste augui?
Version: 2.10.1 RC (2009-12-06 r50690) 
OS: Mac OSX 10.5
Submission from: (NULL) (90.25.215.172)


The quartz() device, either in interactive use or with pdf file output, produces
an incorrect dashed line when the data is dense. Consider the following
comparison between quartz() and pdf(),

library(grid)

comparison <- function(N=10){
  
x = seq(0, 10, length=N)
y = cos(x) 

output.quartz <- paste("quartz-", N,".pdf", sep="")
output.pdf <- paste("pdf-", N,".pdf", sep="")

pdf(output.pdf, width=4, height=4)
pushViewport(viewport(xscale=c(0, 10), yscale=c(0, 6)))
for(ind in 1:5)
grid.lines(x, y+ind, gp=gpar(lty=ind),
           default.units="native")
dev.off()

quartz(type="pdf", file=output.quartz,
       width=4, height=4)
pushViewport(viewport(xscale=c(0, 10), yscale=c(0, 6)))
for(ind in 1:5)
grid.lines(x, y+ind, gp=gpar(lty=ind),
           default.units="native")
dev.off()

}

comparison()
## the output is (almost, see PR#14128) identical

comparison(1e4)
## here the quartz output has non-homogeneous spacing 
## depending on the slope of the data
## and the aspect ratio of the device

The same behavior is observed with R2.11.0 (2009-12-09 r50690) 

 sessionInfo()
R version 2.10.1 RC (2009-12-06 r50690) 
i386-apple-darwin9.8.0 

locale:
[1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets  methods  
[8] base


From cornell.p.gonschior at iem.fh-friedberg.de  Fri Dec 11 16:45:08 2009
From: cornell.p.gonschior at iem.fh-friedberg.de (cornell.p.gonschior at iem.fh-friedberg.de)
Date: Fri, 11 Dec 2009 16:45:08 +0100 (CET)
Subject: [Rd] `mgp[1:3]' are of differing sign (PR#14130)
Message-ID: <20091211154508.E564728320B2@mail.pubhealth.ku.dk>

Full_Name: Cornell Gonschior
Version: 2.10.0
OS: Linux
Submission from: (NULL) (212.201.28.40)


Hi,

in the introduction to R, you can find the following sentence in the par()
chapter:
"Use tck=0.01 and mgp=c(1,-1.5,0) for internal tick marks."
I thought that's nice, because I wanted to have tick marks and tick labels
inside and the axis title outside.

But:
> plot(z, las=1, tck=0.01, mgp=c(1,-1.5,0))
Warnmeldungen:
1: In plot.window(...) : `mgp[1:3]' are of differing sign
2: In plot.xy(xy, type, ...) : `mgp[1:3]' are of differing sign
3: In axis(side = side, at = at, labels = labels, ...) :
  `mgp[1:3]' are of differing sign
4: In axis(side = side, at = at, labels = labels, ...) :
  `mgp[1:3]' are of differing sign
5: In box(...) : `mgp[1:3]' are of differing sign
6: In title(...) : `mgp[1:3]' are of differing sign

> par(las=1, tck=0.01, mgp=c(1,-1,0))
Warnmeldung:
In par(las = 1, tck = 0.01, mgp = c(1, -1, 0)) :
  `mgp[1:3]' are of differing sign

Was there a recent change, couldn't find anything useful searching the web.

Regards,
Cornell


From murdoch at stats.uwo.ca  Fri Dec 11 21:25:13 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 11 Dec 2009 15:25:13 -0500
Subject: [Rd] R on Windows crashes when using certain characters
 in	strings in data frames (PR#14125)
In-Reply-To: <MPG.258c4d052bca143f9896c5@news.gmane.org>
References: <20091210092009.D1A7A282EFC8@mail.pubhealth.ku.dk>
	<MPG.258c4d052bca143f9896c5@news.gmane.org>
Message-ID: <4B22AAA9.1050205@stats.uwo.ca>

On 11/12/2009 6:36 AM, Karl Ove Hufthammer wrote:
> On Thu, 10 Dec 2009 10:20:09 +0100 (CET) karl at huftis.org 
> <karl at huftis.org> wrote:
>
> > The following commands trigger the crash for me:
> > 
> > n=1e5
> > k=10
> > x=sample(k,n,replace=TRUE)
> > y=sample(k,n,replace=TRUE)
> > xy=paste(x,y,sep=" ? ")
> > z=sample(n)
> > d=data.frame(xy,z)
>
> Note: On the R Bug Tracking System Web site, the character causing the 
> problem seems to be incorrectly displayed as a '.', though on the 
> mailing list the correct character is used. The character should be the 
> multiplication symbol, U+00D7, which looks similar to an 'x'. The 
> character does exist in both ISO 8859-1 and Windows-1252.
>
>   

Yes, I can reproduce this, and I know a likely cause.  It will be fixed 
in R-devel soon, but I think it will probably be too late to make it 
into 2.10.1.  It will go into 2.10.1 patched after release if that's the 
case.

Duncan Murdoch


From samandrew at gmx.ch  Fri Dec 11 22:25:13 2009
From: samandrew at gmx.ch (samandrew at gmx.ch)
Date: Fri, 11 Dec 2009 22:25:13 +0100 (CET)
Subject: [Rd] Calendar week ISO (PR#14132)
Message-ID: <20091211212513.73E592833EE0@mail.pubhealth.ku.dk>

Hi there

=20

I use Gnu R sometimes at work.=20

=20

Unfortunately we use Windows and R has problems with getting the calendar
week number with the first week as the one which has at least 4 days. A
colleague told me that he has the same problem.=20

=20

Below you can see what I use now, for finding the right week.=20

=20

=20

Kind regards,=20

Samuel Andreas Meichtry

=20

=20

#Excel-Funktion

#=3DK=DCRZEN((A3-DATUM(JAHR(A3+3-REST(A3-2;7));1;REST(A3-2;7)-9))/7)

=20

=20

#R-Funktion

KW<-function(x){=20=20=20=20

    return(floor(

    as.numeric((x-(as.Date(ISOdate(

=20
as.numeric(format(as.Date(as.numeric(x)+3+25569-2-(as.numeric(x)-2+25569)%%7
,origin=3D"1900-01-01"),"%Y")),1,1)

    )+((as.numeric(x)-2+25569)%%7-9)-1))/7)))=20=20=20=20=20=20=20=20=20=20=
=20=20=20=20=20=20

}

=20

tmp.d <- seq(as.Date("1970-01-01"),as.Date("2009-01-01"),"days")

df<-data.frame(TimeStamp=3Dtmp.d,KW=3DKW(tmp.d))

=20


	[[alternative HTML version deleted]]


From ehlers at ucalgary.ca  Sat Dec 12 10:04:58 2009
From: ehlers at ucalgary.ca (Peter Ehlers)
Date: Sat, 12 Dec 2009 02:04:58 -0700
Subject: [Rd] `mgp[1:3]' are of differing sign (PR#14130)
In-Reply-To: <20091211154508.E564728320B2@mail.pubhealth.ku.dk>
References: <20091211154508.E564728320B2@mail.pubhealth.ku.dk>
Message-ID: <4B235CBA.2090700@ucalgary.ca>


cornell.p.gonschior at iem.fh-friedberg.de wrote:
> Full_Name: Cornell Gonschior
> Version: 2.10.0
> OS: Linux
> Submission from: (NULL) (212.201.28.40)
> 
> 
> Hi,
> 
> in the introduction to R, you can find the following sentence in the par()
> chapter:
> "Use tck=0.01 and mgp=c(1,-1.5,0) for internal tick marks."
> I thought that's nice, because I wanted to have tick marks and tick labels
> inside and the axis title outside.
> 
> But:
>> plot(z, las=1, tck=0.01, mgp=c(1,-1.5,0))
> Warnmeldungen:
> 1: In plot.window(...) : `mgp[1:3]' are of differing sign
> 2: In plot.xy(xy, type, ...) : `mgp[1:3]' are of differing sign
> 3: In axis(side = side, at = at, labels = labels, ...) :
>   `mgp[1:3]' are of differing sign
> 4: In axis(side = side, at = at, labels = labels, ...) :
>   `mgp[1:3]' are of differing sign
> 5: In box(...) : `mgp[1:3]' are of differing sign
> 6: In title(...) : `mgp[1:3]' are of differing sign
> 
>> par(las=1, tck=0.01, mgp=c(1,-1,0))
> Warnmeldung:
> In par(las = 1, tck = 0.01, mgp = c(1, -1, 0)) :
>   `mgp[1:3]' are of differing sign
> 
> Was there a recent change, couldn't find anything useful searching the web.
> 
> Regards,
> Cornell

Well, it's only a warning, making you aware of a possibly
unintended par setting. Warnings are good things but if you
don't want to see them, they can be suppressed.

Certainly not a bug.

  -Peter Ehlers
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
Peter Ehlers
University of Calgary
403.202.3921


From p.dalgaard at biostat.ku.dk  Sat Dec 12 10:51:33 2009
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sat, 12 Dec 2009 10:51:33 +0100
Subject: [Rd] `mgp[1:3]' are of differing sign (PR#14130)
In-Reply-To: <4B235CBA.2090700@ucalgary.ca>
References: <20091211154508.E564728320B2@mail.pubhealth.ku.dk>
	<4B235CBA.2090700@ucalgary.ca>
Message-ID: <4B2367A5.7020000@biostat.ku.dk>

Peter Ehlers wrote:
> 
> cornell.p.gonschior at iem.fh-friedberg.de wrote:
>> Full_Name: Cornell Gonschior
>> Version: 2.10.0
>> OS: Linux
>> Submission from: (NULL) (212.201.28.40)
>>
>>
>> Hi,
>>
>> in the introduction to R, you can find the following sentence in the 
>> par()
>> chapter:
>> "Use tck=0.01 and mgp=c(1,-1.5,0) for internal tick marks."
>> I thought that's nice, because I wanted to have tick marks and tick 
>> labels
>> inside and the axis title outside.
>>
>> But:
>>> plot(z, las=1, tck=0.01, mgp=c(1,-1.5,0))
>> Warnmeldungen:
>> 1: In plot.window(...) : `mgp[1:3]' are of differing sign
>> 2: In plot.xy(xy, type, ...) : `mgp[1:3]' are of differing sign
>> 3: In axis(side = side, at = at, labels = labels, ...) :
>>   `mgp[1:3]' are of differing sign
>> 4: In axis(side = side, at = at, labels = labels, ...) :
>>   `mgp[1:3]' are of differing sign
>> 5: In box(...) : `mgp[1:3]' are of differing sign
>> 6: In title(...) : `mgp[1:3]' are of differing sign
>>
>>> par(las=1, tck=0.01, mgp=c(1,-1,0))
>> Warnmeldung:
>> In par(las = 1, tck = 0.01, mgp = c(1, -1, 0)) :
>>   `mgp[1:3]' are of differing sign
>>
>> Was there a recent change, couldn't find anything useful searching the 
>> web.
>>
>> Regards,
>> Cornell
> 
> Well, it's only a warning, making you aware of a possibly
> unintended par setting. Warnings are good things but if you
> don't want to see them, they can be suppressed.
> 
> Certainly not a bug.

Hmm, then again, I tend to agree with Cornell that there are a bit too 
many cases where mgp[1:3]' would sensibly have differing sign, compared 
to cases where it is a mistake. In addition to internal tick marks and 
labels, there are also cases where the whole axis is shifted into the 
plot area. I'd more likely use axis(pos=...) for that, but still.

-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From p.dalgaard at biostat.ku.dk  Sat Dec 12 10:55:23 2009
From: p.dalgaard at biostat.ku.dk (p.dalgaard at biostat.ku.dk)
Date: Sat, 12 Dec 2009 10:55:23 +0100 (CET)
Subject: [Rd] `mgp[1:3]' are of differing sign (PR#14130)
Message-ID: <20091212095523.20E02282EF4C@mail.pubhealth.ku.dk>

Peter Ehlers wrote:
> 
> cornell.p.gonschior at iem.fh-friedberg.de wrote:
>> Full_Name: Cornell Gonschior
>> Version: 2.10.0
>> OS: Linux
>> Submission from: (NULL) (212.201.28.40)
>>
>>
>> Hi,
>>
>> in the introduction to R, you can find the following sentence in the 
>> par()
>> chapter:
>> "Use tck=0.01 and mgp=c(1,-1.5,0) for internal tick marks."
>> I thought that's nice, because I wanted to have tick marks and tick 
>> labels
>> inside and the axis title outside.
>>
>> But:
>>> plot(z, las=1, tck=0.01, mgp=c(1,-1.5,0))
>> Warnmeldungen:
>> 1: In plot.window(...) : `mgp[1:3]' are of differing sign
>> 2: In plot.xy(xy, type, ...) : `mgp[1:3]' are of differing sign
>> 3: In axis(side = side, at = at, labels = labels, ...) :
>>   `mgp[1:3]' are of differing sign
>> 4: In axis(side = side, at = at, labels = labels, ...) :
>>   `mgp[1:3]' are of differing sign
>> 5: In box(...) : `mgp[1:3]' are of differing sign
>> 6: In title(...) : `mgp[1:3]' are of differing sign
>>
>>> par(las=1, tck=0.01, mgp=c(1,-1,0))
>> Warnmeldung:
>> In par(las = 1, tck = 0.01, mgp = c(1, -1, 0)) :
>>   `mgp[1:3]' are of differing sign
>>
>> Was there a recent change, couldn't find anything useful searching the 
>> web.
>>
>> Regards,
>> Cornell
> 
> Well, it's only a warning, making you aware of a possibly
> unintended par setting. Warnings are good things but if you
> don't want to see them, they can be suppressed.
> 
> Certainly not a bug.

Hmm, then again, I tend to agree with Cornell that there are a bit too 
many cases where mgp[1:3]' would sensibly have differing sign, compared 
to cases where it is a mistake. In addition to internal tick marks and 
labels, there are also cases where the whole axis is shifted into the 
plot area. I'd more likely use axis(pos=...) for that, but still.

-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From johann.kraus at uni-ulm.de  Sat Dec 12 13:20:09 2009
From: johann.kraus at uni-ulm.de (johann.kraus at uni-ulm.de)
Date: Sat, 12 Dec 2009 13:20:09 +0100 (CET)
Subject: [Rd] Missing html help files with R 2.10.0 (PR#14134)
Message-ID: <20091212122009.7F0BC282EF4D@mail.pubhealth.ku.dk>

Full_Name: Johann Kraus
Version: 2.10.0
OS: Mac
Submission from: (NULL) (134.60.236.10)


I'm running R version 2.10.0 on a Mac. The "Package Manager" from the GUI does
no more display html help files except the Index pages. When copying the links
to the browser it shows, that all help files are missing, e.g. 

file:///Library/Frameworks/R.framework/Versions/2.10/Resources/library/base/html/

However, if looking for html help via ? everything works correctly.


From ehlers at ucalgary.ca  Sat Dec 12 17:19:09 2009
From: ehlers at ucalgary.ca (Peter Ehlers)
Date: Sat, 12 Dec 2009 09:19:09 -0700
Subject: [Rd] `mgp[1:3]' are of differing sign (PR#14130)
In-Reply-To: <4B2367A5.7020000@biostat.ku.dk>
References: <20091211154508.E564728320B2@mail.pubhealth.ku.dk>
	<4B235CBA.2090700@ucalgary.ca> <4B2367A5.7020000@biostat.ku.dk>
Message-ID: <4B23C27D.5010509@ucalgary.ca>

Peter Dalgaard wrote:
> Peter Ehlers wrote:
>>
>> cornell.p.gonschior at iem.fh-friedberg.de wrote:
>>> Full_Name: Cornell Gonschior
>>> Version: 2.10.0
>>> OS: Linux
>>> Submission from: (NULL) (212.201.28.40)
>>>
>>>
>>> Hi,
>>>
>>> in the introduction to R, you can find the following sentence in the 
>>> par()
>>> chapter:
>>> "Use tck=0.01 and mgp=c(1,-1.5,0) for internal tick marks."
>>> I thought that's nice, because I wanted to have tick marks and tick 
>>> labels
>>> inside and the axis title outside.
>>>
>>> But:
>>>> plot(z, las=1, tck=0.01, mgp=c(1,-1.5,0))
>>> Warnmeldungen:
>>> 1: In plot.window(...) : `mgp[1:3]' are of differing sign
>>> 2: In plot.xy(xy, type, ...) : `mgp[1:3]' are of differing sign
>>> 3: In axis(side = side, at = at, labels = labels, ...) :
>>>   `mgp[1:3]' are of differing sign
>>> 4: In axis(side = side, at = at, labels = labels, ...) :
>>>   `mgp[1:3]' are of differing sign
>>> 5: In box(...) : `mgp[1:3]' are of differing sign
>>> 6: In title(...) : `mgp[1:3]' are of differing sign
>>>
>>>> par(las=1, tck=0.01, mgp=c(1,-1,0))
>>> Warnmeldung:
>>> In par(las = 1, tck = 0.01, mgp = c(1, -1, 0)) :
>>>   `mgp[1:3]' are of differing sign
>>>
>>> Was there a recent change, couldn't find anything useful searching 
>>> the web.
>>>
>>> Regards,
>>> Cornell
>>
>> Well, it's only a warning, making you aware of a possibly
>> unintended par setting. Warnings are good things but if you
>> don't want to see them, they can be suppressed.
>>
>> Certainly not a bug.
> 
> Hmm, then again, I tend to agree with Cornell that there are a bit too 
> many cases where mgp[1:3]' would sensibly have differing sign, compared 
> to cases where it is a mistake. In addition to internal tick marks and 
> labels, there are also cases where the whole axis is shifted into the 
> plot area. I'd more likely use axis(pos=...) for that, but still.
> 
And, I suppose, if R-Intro mentions it, it would be less confusing
if there were mention of the warning. But use of R conditions one to
seeing warnings as a good thing. Can't count the number of times
I've seen "longer ... is not a multiple of shorter ..." and having
it catch a silly user error.

-- 
Peter Ehlers
University of Calgary
403.202.3921


From ehlers at ucalgary.ca  Sat Dec 12 17:20:22 2009
From: ehlers at ucalgary.ca (ehlers at ucalgary.ca)
Date: Sat, 12 Dec 2009 17:20:22 +0100 (CET)
Subject: [Rd] `mgp[1:3]' are of differing sign (PR#14130)
Message-ID: <20091212162022.C4079282EF59@mail.pubhealth.ku.dk>

Peter Dalgaard wrote:
> Peter Ehlers wrote:
>>
>> cornell.p.gonschior at iem.fh-friedberg.de wrote:
>>> Full_Name: Cornell Gonschior
>>> Version: 2.10.0
>>> OS: Linux
>>> Submission from: (NULL) (212.201.28.40)
>>>
>>>
>>> Hi,
>>>
>>> in the introduction to R, you can find the following sentence in the 
>>> par()
>>> chapter:
>>> "Use tck=0.01 and mgp=c(1,-1.5,0) for internal tick marks."
>>> I thought that's nice, because I wanted to have tick marks and tick 
>>> labels
>>> inside and the axis title outside.
>>>
>>> But:
>>>> plot(z, las=1, tck=0.01, mgp=c(1,-1.5,0))
>>> Warnmeldungen:
>>> 1: In plot.window(...) : `mgp[1:3]' are of differing sign
>>> 2: In plot.xy(xy, type, ...) : `mgp[1:3]' are of differing sign
>>> 3: In axis(side = side, at = at, labels = labels, ...) :
>>>   `mgp[1:3]' are of differing sign
>>> 4: In axis(side = side, at = at, labels = labels, ...) :
>>>   `mgp[1:3]' are of differing sign
>>> 5: In box(...) : `mgp[1:3]' are of differing sign
>>> 6: In title(...) : `mgp[1:3]' are of differing sign
>>>
>>>> par(las=1, tck=0.01, mgp=c(1,-1,0))
>>> Warnmeldung:
>>> In par(las = 1, tck = 0.01, mgp = c(1, -1, 0)) :
>>>   `mgp[1:3]' are of differing sign
>>>
>>> Was there a recent change, couldn't find anything useful searching 
>>> the web.
>>>
>>> Regards,
>>> Cornell
>>
>> Well, it's only a warning, making you aware of a possibly
>> unintended par setting. Warnings are good things but if you
>> don't want to see them, they can be suppressed.
>>
>> Certainly not a bug.
> 
> Hmm, then again, I tend to agree with Cornell that there are a bit too 
> many cases where mgp[1:3]' would sensibly have differing sign, compared 
> to cases where it is a mistake. In addition to internal tick marks and 
> labels, there are also cases where the whole axis is shifted into the 
> plot area. I'd more likely use axis(pos=...) for that, but still.
> 
And, I suppose, if R-Intro mentions it, it would be less confusing
if there were mention of the warning. But use of R conditions one to
seeing warnings as a good thing. Can't count the number of times
I've seen "longer ... is not a multiple of shorter ..." and having
it catch a silly user error.

-- 
Peter Ehlers
University of Calgary
403.202.3921


From maechler at stat.math.ethz.ch  Sat Dec 12 18:33:59 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 12 Dec 2009 18:33:59 +0100
Subject: [Rd] How to organized code in the R/ directory of a package?
In-Reply-To: <4B2197C5.9030305@auckland.ac.nz>
References: <366c6f340912101356j1be51766lba30bc00de72e52f@mail.gmail.com>
	<4B2174B9.1050807@openanalytics.be>
	<4B2197C5.9030305@auckland.ac.nz>
Message-ID: <19235.54279.237965.469607@cmath-6.math.ethz.ch>

>>>>> "DScottNZ" == David Scott <d.scott at auckland.ac.nz>
>>>>>     on Fri, 11 Dec 2009 13:52:21 +1300 writes:

    DScottNZ> Tobias Verbeke wrote:
    >> Peng Yu wrote:
    >>> I'm making a package, Current, I put all R files in the
    >>> R/ directory in the package (without using
    >>> subdirectory). This will become a problem when there are
    >>> many files in the directory. I'm wondering how to use
    >>> subdirectories in R/?
    >> 
    >> The standard solution is (I would think) to organize the
    >> code such that functions belonging together are grouped
    >> in one file.
    >> 

    DScottNZ> That is what I try to do. My rule is that
    DScottNZ> functions which are documented in the same .Rd
    DScottNZ> file are also in the same .R file. Might be more
    DScottNZ> sensible for some packages than for others.

Yes.  I typically even use less *.R than *.Rd files.
That's also the case for the R standard package sources:
The ratio #{R/*.R} / #{man/*.Rd}  is ~ 44%
In my own packages, I see a  ratio of slightly less than 40%.

Martin Maechler, ETH Zurich (and R core)


From tplate at acm.org  Sat Dec 12 19:57:11 2009
From: tplate at acm.org (Tony Plate)
Date: Sat, 12 Dec 2009 11:57:11 -0700
Subject: [Rd] binary string conversion to a vector (PR#14120)
In-Reply-To: <D294391D-D31E-41AF-BC96-77AF138ACCBE@ncsu.edu>
References: <D294391D-D31E-41AF-BC96-77AF138ACCBE@ncsu.edu>
Message-ID: <4B23E787.9090400@acm.org>

Just responding to some of the issues in this long post:

(1) Don't rely on the printed form of an object to decide whether or not 
they are identical.  The function str() is very useful in this regard, 
and sometimes also unclass().  To see whether two object are identical, 
use the function identical()

 > qvector <- c("0", "0", "0", "1", "1", "0", "1")
 > qvector[1]
[1] "0"
 > noquote(qvector[1])
[1] 0
 > str(noquote(qvector[1]))
Class 'noquote'  chr "0"
 > as.integer(qvector[1])
[1] 0
 > str(as.integer(qvector[1]))
 int 0
 > identical(noquote(qvector[1]), as.integer(qvector[1]))
[1] FALSE
 >

Does this alleviate the concern as to the possibility of a bug in 
noquote/as.integer? Or were there deeper issues?

(2) to see how some other users of R have package up miscellaneous 
functions that might be of use to other people, look for packages on 
CRAN with "misc" in their names -- I see almost 10 of them.  The problem 
with just posting snippets of code is that they get lost in all the 
other posts here, and many long term R users have dozens if not hundreds 
of their own functions that are streamlined for their own frequent tasks 
and style of programming.

(3) sounds like a great idea to use R to bring statistical rigor into 
the analysis of the performance of combinatorial optimization algorithms!

(4) install.packages("stringr") works fine for me.  Maybe it was a 
temporary glitch?  Have you checked whether you have a valid repository 
selected?  E.g., I have in my .Rprofile:
options(repos=c(CRAN="http://cran.cnr.Berkeley.edu" , 
CRANextra="http://www.stats.ox.ac.uk/pub/RWin"))

Enjoy learning R!

-- Tony Plate

Franc Brglez wrote:
> Hello!
>  
> Please accept my sincere apologies for annoying the R development team with my post this week. If I were required to register as "a developer" before submission, this would not have happened. To rehabilitate myself, please find at the bottom of this mail two R-functions, 'string2vector' and 'vector2string', with "comments and tests". Both functions may go a long way towards assisting a number of R-users to make their R-programming more productive. I am a novice R-programmer: I started dabbling in R less than two months ago, heavily influenced by examples of code I see, including within the R.org documents (monkey does what monkey sees). Before posting two functions, I would really appreciate constructive edits where they may be needed as well as their posting by someone-in-the-know so there will be conveniently accessible for R users.
>
> I am very impressed with potential of R and the community supporting it. I just wish I got to R sooner: I am looking to R to better support my work in "designed experiments to assess the statistically significant performance of combinatorial optimization algorithms on instance isomorphs of NP-hard problems" -- for better context of this mouthful, see the few postings under
>   http://www.cbl.ncsu.edu:16080/xBed/publications/
> I am working on a tutorial paper where I expect R to play a significant role in better explaining and illustrating, code-wise and graphically, the concepts discussed in the publications above. I would welcome a co-author with experience in R-programming as well as statistics and interests in the experimental methods addressed in these publications.
>
> As I elaborate in notes that follow, I was looking at a variety of "R-documents" before my "bug" submission. I would appreciate very much if some of you could take the time to scan through these notes and respond briefly with useful pointers. Here are the headlines:
>
>     (1) why I still think there may be a bug with 'noquote' vs 'as.integer'
>
>     (2) search on "split string" and "join string"; the missing package "stringr"
>
>     (3) a take on "Tcl" commands 'split', 'join', 'string', 'append', 'foreach'
>
>     (4) a take on "R" functions 'string2vector' and 'vector2string'
>
>     (5) code and comments for "R" functions 'string2vector' and 'vector2string
>
> (1) why I still think there may be a bug with 'noquote' vs 'as.integer'
> --------------------------------------------------------------------------------
>   
>> # MacOSX 10.6.2, R 2.9.1 GUI 1.28 Tiger build 32-bit (5444)
>> qvector
>>     
> [1] "0" "0" "0" "1" "1" "0" "1"
>   
>> qvector[1]
>>     
> [1] "0"
>   
>> tmp = noquote(qvector[1])
>> tmp
>>     
> [1] 0
>   
>> tmp = as.integer(qvector[1])
>> tmp
>>     
> [1] 0
>   
> When embedded in the function as per my "bug" report, 'noquote' and 'as.integer' are no longer equivalent whereas in the example above they appear to be equivalent!! I submitted the "function" with print/cat statements for sake of illustration.
>
> (2) search on "split string" and "join string"; the missing package "stringr"
> --------------------------------------------------------------------------------
> http://search.r-project.org/ reveals
>    orderof 850 messages for search on "split string"
>    orderof 160 messages for search on "join string"
>
> http://finzi.psych.upenn.edu/search.html reveals
>     for search on "split string"
>    	? Rhelp08:   [ split: 890 ] [ string: 1676 ] [ TOTAL: 77 ]
>         ? functions: [ split: 954 ] [ string: 6453 ] [ TOTAL: 204 ]
>     for search on "join string"
> 	? Rhelp08:   [ join: 176 ] [ string: 1676 ] [ TOTAL: 8 ]
> 	? functions: [ join: 192 ] [ string: 6453 ] [ TOTAL: 36 ]
>     This site also provides a link to the package "stringr"
>     http://finzi.psych.upenn.edu/R/library/stringr/html/00Index.html
> However, the download does not deliver ...
>   
>> install.packages("stringr")
>>     
>   ....
>    package ?stringr? is not available
>
> There are a lot of hard-to-understand and not-so-relevant code snippets in all these 1000's of postings. I would argue that had robust functions such as 'string2vector' and 'vector2string' been included in the R-package, many R-programmers could take longer vacations, spend their time more productively,
> and significantly reduce duplication of coding efforts on basically the same
> problems.
>
> Since vector is such and important "primitive" in R, I argue that functions such as 'string2vector' and 'vector2string' should be made to play a role similar to commands 'split', 'join', 'string', and 'append' that support programmers in Tcl. See my take on Tcl in the section below.
>
> (3) a take on "Tcl" commands 'split', 'join', 'string', 'append', 'foreach'
> --------------------------------------------------------------------------------
> I have been using Tcl to "wrap" a number of combinatorial solvers and automate workflows that implement and execute a number of my experiments on instance isomorphs. I even used Tcl to prototype few combinatorial optimization algorithm prototypes and write code for statistical analysis -- as task for which I now find R much better suited.
>
> I intend to alert my Tcl colleagues in-the-know about the wonderful infrastructure provided in R when it comes to the R-shell (at least under MacOSX), and the ability to name and initialize function variable defaults explicitly, and the ability to install new packages so transparently. Before coming across R, I already took the trouble to create Tcl wrapper programs with command lines that feature identical order-indepent syntax as the syntax used in R. This being said, what I miss about R is gathering all commands on a single page such as
>    http://www.tcl.tk/man/tcl8.5/TclCmd/contents.htm
> Note that once you click on any of the commands, a number of classes that extend each command become visible, including the example section(s). 
>
> Here I illustrate my use of just five tcl commands that subsequently guided my "design" of the function 'string2vector' in 'vector2string' "R"
>
> # few "Tcl" examples before designing the function 'string2vector' in "R"
> % set binS "10011"
> % join [split $binS ""] ", "
> 1, 0, 0, 1, 1
> %
> % set strS "I \t am\tdone" 
> % foreach item [split $strS "\t"] {append strSQ \"$item\",}
> % set strSQ [string trimright $strSQ ,]
> "I "," am","done"
> # 
> # few "Tcl" examples before designing the function 'vector2string' in "R"
> % set strV "1,0,0,1"
> 1,0,0,1
> % split $strV ","
> 1 0 0 1
> join [split $strV ","] ":"
> 1:0:0:1
>
> (4) a take on "R" functions 'string2vector' and 'vector2string'
> --------------------------------------------------------------------------------
>   
>> # few tests of the function 'string2vector' in "R"
>> binS = "10011"
>> binV = string2vector(binS, SS="", type="int")
>> binV[2] ; binV[5]
>>     
> [1] 0
> [1] 1
>   
>> strS = "I am done" 
>> vecS = string2vector(strS, SS=" ", type="char")
>> vecS[1] ; vecS[3]
>>     
> [1] "I"
> [1] "done"
>   
>> # few tests of the function 'vector2string' in "R"
>> binV = c(1,0,0,1) 
>> vector2string(binV, type="int")
>>     
> [1] "1001"
>   
>> vector2string(binV, SS=" ", type="char")
>>     
> [1] "1 0 0 1"
>   
>> subsV = c("I", "am", "done")  
>> vector2string(subsV, SS=":", type="char")
>>     
> [1] "I:am:done"
>   
>
> (5) code and comments for "R" functions 'string2vector' and 'vector2string'
> --------------------------------------------------------------------------------
>
> string2vector = function(string="ch-2 \t sec-7\tex-5", SS="\t", type="char")
> #
> # This procedure splits a string and assigns substrings to an R-vector.
> # The split is controlled by the string separator SS (default value:  SS="\t").
> # Here we convert  a binary string into a binary vector:
> #   let  binS = "10011"  
> #   then binV = string2vector(binS, SS="", type="int")
> # Here we convert a string into a vector of substrings:
> #   let  strS = "I am done" 
> #   then vecS = string2vector(strS, SS=" ", type="char")
> #
> # LIMITATION: The function interprets all substrings either as of type 
> #             "int" or "char".  A function that interprets the type of each
> #             substring dynamically may one day be written by an R-guru.
> #              
> # Franc Brglez, Wed Dec  9 14:19:16 EST 2009
> {   
>     qlist   = strsplit(string, SS) ; qvector = qlist[[1]]
>     n = length(qvector) ; xvector = NULL
>     for (i in 1:n) {
>         if (type == "int") {
>             tmp = as.integer(qvector[i])
>         } else {
>             tmp = qvector[i]
>         }
> 	xvector = c(xvector, tmp)
>     }
>     return(xvector)
> } # string2vector
>
> vector2string = function(vector=c("ch-2", "sec-7", "ex-5"), SS="_", type="char") 
> #
> # This procedure converts values from a vector to a concatenation of substrings 
> # separated by user-specified string separator SS (default value:  SS="_").
> # Each substring represents a vector component value, either as a numerical 
> # value or as an alphanumeric string. 
> # Here we convert a binary vector to a binary string representing an integer:
> #   let  binV = c(1,0,0,1)  
> #   then strS = vector2string(binV, type="int")
> # Here we convert a binary vector to string representing a binary sequence:
> #   let  binV = c(1,0,0,1)  
> #   then seqS = vector2string(binV, SS=" ", type="char")
> # Here we convert a vector of substrings to colon-separated string:
> #   let subsV = c("I", "am", "done")  
> #   then strS = vector2string(subsV, SS=":", type="char")
> #
> # LIMITATION: The function interprets all substrings in the vector either as of 
> #             type "int" or "char".  A function that interprets the type of each
> #             substring dynamically may one day be written by an R-guru.
> #
> # Franc Brglez, Wed Dec  9 15:43:59 EST 2009
> {   
>     if (type == "int") {
>         string = paste(strsplit(paste(vector), " "), collapse="")
>     } else {
>         n = length(vector) ; nm1 = n-1 ; string = ""
>         for (i in 1:nm1) {
>             tmp    = noquote(vector[i])
>             string = paste(string, tmp, SS, sep="")
>         }
>         tmp    = noquote(vector[n])
>         string = paste(string, tmp, sep="")     
>     }
>     return(string)
> } # vector2string
>
> ----------------
> Dr. Franc Brglez                                        email: brglez at ncsu.edu 
> Department of Computer Science, Box 8206     http://sitta.csc.ncsu.edu/~brglez
> North Carolina State University                            TEL: (919) 515-9675
> Raleigh NC 27695-8206 USA  
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From tplate at acm.org  Sat Dec 12 20:00:28 2009
From: tplate at acm.org (tplate at acm.org)
Date: Sat, 12 Dec 2009 20:00:28 +0100 (CET)
Subject: [Rd] binary string conversion to a vector (PR#14120)
Message-ID: <20091212190028.8E9C92830314@mail.pubhealth.ku.dk>

Just responding to some of the issues in this long post:

(1) Don't rely on the printed form of an object to decide whether or not 
they are identical.  The function str() is very useful in this regard, 
and sometimes also unclass().  To see whether two object are identical, 
use the function identical()

 > qvector <- c("0", "0", "0", "1", "1", "0", "1")
 > qvector[1]
[1] "0"
 > noquote(qvector[1])
[1] 0
 > str(noquote(qvector[1]))
Class 'noquote'  chr "0"
 > as.integer(qvector[1])
[1] 0
 > str(as.integer(qvector[1]))
 int 0
 > identical(noquote(qvector[1]), as.integer(qvector[1]))
[1] FALSE
 >

Does this alleviate the concern as to the possibility of a bug in 
noquote/as.integer? Or were there deeper issues?

(2) to see how some other users of R have package up miscellaneous 
functions that might be of use to other people, look for packages on 
CRAN with "misc" in their names -- I see almost 10 of them.  The problem 
with just posting snippets of code is that they get lost in all the 
other posts here, and many long term R users have dozens if not hundreds 
of their own functions that are streamlined for their own frequent tasks 
and style of programming.

(3) sounds like a great idea to use R to bring statistical rigor into 
the analysis of the performance of combinatorial optimization algorithms!

(4) install.packages("stringr") works fine for me.  Maybe it was a 
temporary glitch?  Have you checked whether you have a valid repository 
selected?  E.g., I have in my .Rprofile:
options(repos=c(CRAN="http://cran.cnr.Berkeley.edu" , 
CRANextra="http://www.stats.ox.ac.uk/pub/RWin"))

Enjoy learning R!

-- Tony Plate

Franc Brglez wrote:
> Hello!
>  
> Please accept my sincere apologies for annoying the R development team with my post this week. If I were required to register as "a developer" before submission, this would not have happened. To rehabilitate myself, please find at the bottom of this mail two R-functions, 'string2vector' and 'vector2string', with "comments and tests". Both functions may go a long way towards assisting a number of R-users to make their R-programming more productive. I am a novice R-programmer: I started dabbling in R less than two months ago, heavily influenced by examples of code I see, including within the R.org documents (monkey does what monkey sees). Before posting two functions, I would really appreciate constructive edits where they may be needed as well as their posting by someone-in-the-know so there will be conveniently accessible for R users.
>
> I am very impressed with potential of R and the community supporting it. I just wish I got to R sooner: I am looking to R to better support my work in "designed experiments to assess the statistically significant performance of combinatorial optimization algorithms on instance isomorphs of NP-hard problems" -- for better context of this mouthful, see the few postings under
>   http://www.cbl.ncsu.edu:16080/xBed/publications/
> I am working on a tutorial paper where I expect R to play a significant role in better explaining and illustrating, code-wise and graphically, the concepts discussed in the publications above. I would welcome a co-author with experience in R-programming as well as statistics and interests in the experimental methods addressed in these publications.
>
> As I elaborate in notes that follow, I was looking at a variety of "R-documents" before my "bug" submission. I would appreciate very much if some of you could take the time to scan through these notes and respond briefly with useful pointers. Here are the headlines:
>
>     (1) why I still think there may be a bug with 'noquote' vs 'as.integer'
>
>     (2) search on "split string" and "join string"; the missing package "stringr"
>
>     (3) a take on "Tcl" commands 'split', 'join', 'string', 'append', 'foreach'
>
>     (4) a take on "R" functions 'string2vector' and 'vector2string'
>
>     (5) code and comments for "R" functions 'string2vector' and 'vector2string
>
> (1) why I still think there may be a bug with 'noquote' vs 'as.integer'
> --------------------------------------------------------------------------------
>   
>> # MacOSX 10.6.2, R 2.9.1 GUI 1.28 Tiger build 32-bit (5444)
>> qvector
>>     
> [1] "0" "0" "0" "1" "1" "0" "1"
>   
>> qvector[1]
>>     
> [1] "0"
>   
>> tmp = noquote(qvector[1])
>> tmp
>>     
> [1] 0
>   
>> tmp = as.integer(qvector[1])
>> tmp
>>     
> [1] 0
>   
> When embedded in the function as per my "bug" report, 'noquote' and 'as.integer' are no longer equivalent whereas in the example above they appear to be equivalent!! I submitted the "function" with print/cat statements for sake of illustration.
>
> (2) search on "split string" and "join string"; the missing package "stringr"
> --------------------------------------------------------------------------------
> http://search.r-project.org/ reveals
>    orderof 850 messages for search on "split string"
>    orderof 160 messages for search on "join string"
>
> http://finzi.psych.upenn.edu/search.html reveals
>     for search on "split string"
>    	? Rhelp08:   [ split: 890 ] [ string: 1676 ] [ TOTAL: 77 ]
>         ? functions: [ split: 954 ] [ string: 6453 ] [ TOTAL: 204 ]
>     for search on "join string"
> 	? Rhelp08:   [ join: 176 ] [ string: 1676 ] [ TOTAL: 8 ]
> 	? functions: [ join: 192 ] [ string: 6453 ] [ TOTAL: 36 ]
>     This site also provides a link to the package "stringr"
>     http://finzi.psych.upenn.edu/R/library/stringr/html/00Index.html
> However, the download does not deliver ...
>   
>> install.packages("stringr")
>>     
>   ....
>    package ?stringr? is not available
>
> There are a lot of hard-to-understand and not-so-relevant code snippets in all these 1000's of postings. I would argue that had robust functions such as 'string2vector' and 'vector2string' been included in the R-package, many R-programmers could take longer vacations, spend their time more productively,
> and significantly reduce duplication of coding efforts on basically the same
> problems.
>
> Since vector is such and important "primitive" in R, I argue that functions such as 'string2vector' and 'vector2string' should be made to play a role similar to commands 'split', 'join', 'string', and 'append' that support programmers in Tcl. See my take on Tcl in the section below.
>
> (3) a take on "Tcl" commands 'split', 'join', 'string', 'append', 'foreach'
> --------------------------------------------------------------------------------
> I have been using Tcl to "wrap" a number of combinatorial solvers and automate workflows that implement and execute a number of my experiments on instance isomorphs. I even used Tcl to prototype few combinatorial optimization algorithm prototypes and write code for statistical analysis -- as task for which I now find R much better suited.
>
> I intend to alert my Tcl colleagues in-the-know about the wonderful infrastructure provided in R when it comes to the R-shell (at least under MacOSX), and the ability to name and initialize function variable defaults explicitly, and the ability to install new packages so transparently. Before coming across R, I already took the trouble to create Tcl wrapper programs with command lines that feature identical order-indepent syntax as the syntax used in R. This being said, what I miss about R is gathering all commands on a single page such as
>    http://www.tcl.tk/man/tcl8.5/TclCmd/contents.htm
> Note that once you click on any of the commands, a number of classes that extend each command become visible, including the example section(s). 
>
> Here I illustrate my use of just five tcl commands that subsequently guided my "design" of the function 'string2vector' in 'vector2string' "R"
>
> # few "Tcl" examples before designing the function 'string2vector' in "R"
> % set binS "10011"
> % join [split $binS ""] ", "
> 1, 0, 0, 1, 1
> %
> % set strS "I \t am\tdone" 
> % foreach item [split $strS "\t"] {append strSQ \"$item\",}
> % set strSQ [string trimright $strSQ ,]
> "I "," am","done"
> # 
> # few "Tcl" examples before designing the function 'vector2string' in "R"
> % set strV "1,0,0,1"
> 1,0,0,1
> % split $strV ","
> 1 0 0 1
> join [split $strV ","] ":"
> 1:0:0:1
>
> (4) a take on "R" functions 'string2vector' and 'vector2string'
> --------------------------------------------------------------------------------
>   
>> # few tests of the function 'string2vector' in "R"
>> binS = "10011"
>> binV = string2vector(binS, SS="", type="int")
>> binV[2] ; binV[5]
>>     
> [1] 0
> [1] 1
>   
>> strS = "I am done" 
>> vecS = string2vector(strS, SS=" ", type="char")
>> vecS[1] ; vecS[3]
>>     
> [1] "I"
> [1] "done"
>   
>> # few tests of the function 'vector2string' in "R"
>> binV = c(1,0,0,1) 
>> vector2string(binV, type="int")
>>     
> [1] "1001"
>   
>> vector2string(binV, SS=" ", type="char")
>>     
> [1] "1 0 0 1"
>   
>> subsV = c("I", "am", "done")  
>> vector2string(subsV, SS=":", type="char")
>>     
> [1] "I:am:done"
>   
>
> (5) code and comments for "R" functions 'string2vector' and 'vector2string'
> --------------------------------------------------------------------------------
>
> string2vector = function(string="ch-2 \t sec-7\tex-5", SS="\t", type="char")
> #
> # This procedure splits a string and assigns substrings to an R-vector.
> # The split is controlled by the string separator SS (default value:  SS="\t").
> # Here we convert  a binary string into a binary vector:
> #   let  binS = "10011"  
> #   then binV = string2vector(binS, SS="", type="int")
> # Here we convert a string into a vector of substrings:
> #   let  strS = "I am done" 
> #   then vecS = string2vector(strS, SS=" ", type="char")
> #
> # LIMITATION: The function interprets all substrings either as of type 
> #             "int" or "char".  A function that interprets the type of each
> #             substring dynamically may one day be written by an R-guru.
> #              
> # Franc Brglez, Wed Dec  9 14:19:16 EST 2009
> {   
>     qlist   = strsplit(string, SS) ; qvector = qlist[[1]]
>     n = length(qvector) ; xvector = NULL
>     for (i in 1:n) {
>         if (type == "int") {
>             tmp = as.integer(qvector[i])
>         } else {
>             tmp = qvector[i]
>         }
> 	xvector = c(xvector, tmp)
>     }
>     return(xvector)
> } # string2vector
>
> vector2string = function(vector=c("ch-2", "sec-7", "ex-5"), SS="_", type="char") 
> #
> # This procedure converts values from a vector to a concatenation of substrings 
> # separated by user-specified string separator SS (default value:  SS="_").
> # Each substring represents a vector component value, either as a numerical 
> # value or as an alphanumeric string. 
> # Here we convert a binary vector to a binary string representing an integer:
> #   let  binV = c(1,0,0,1)  
> #   then strS = vector2string(binV, type="int")
> # Here we convert a binary vector to string representing a binary sequence:
> #   let  binV = c(1,0,0,1)  
> #   then seqS = vector2string(binV, SS=" ", type="char")
> # Here we convert a vector of substrings to colon-separated string:
> #   let subsV = c("I", "am", "done")  
> #   then strS = vector2string(subsV, SS=":", type="char")
> #
> # LIMITATION: The function interprets all substrings in the vector either as of 
> #             type "int" or "char".  A function that interprets the type of each
> #             substring dynamically may one day be written by an R-guru.
> #
> # Franc Brglez, Wed Dec  9 15:43:59 EST 2009
> {   
>     if (type == "int") {
>         string = paste(strsplit(paste(vector), " "), collapse="")
>     } else {
>         n = length(vector) ; nm1 = n-1 ; string = ""
>         for (i in 1:nm1) {
>             tmp    = noquote(vector[i])
>             string = paste(string, tmp, SS, sep="")
>         }
>         tmp    = noquote(vector[n])
>         string = paste(string, tmp, sep="")     
>     }
>     return(string)
> } # vector2string
>
> ----------------
> Dr. Franc Brglez                                        email: brglez at ncsu.edu 
> Department of Computer Science, Box 8206     http://sitta.csc.ncsu.edu/~brglez
> North Carolina State University                            TEL: (919) 515-9675
> Raleigh NC 27695-8206 USA  
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From murdoch at stats.uwo.ca  Sat Dec 12 22:57:25 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 12 Dec 2009 16:57:25 -0500
Subject: [Rd] Missing html help files with R 2.10.0 (PR#14134)
In-Reply-To: <20091212122009.7F0BC282EF4D@mail.pubhealth.ku.dk>
References: <20091212122009.7F0BC282EF4D@mail.pubhealth.ku.dk>
Message-ID: <4B2411C5.9090206@stats.uwo.ca>

On 12/12/2009 7:20 AM, johann.kraus at uni-ulm.de wrote:
> Full_Name: Johann Kraus
> Version: 2.10.0
> OS: Mac
> Submission from: (NULL) (134.60.236.10)
> 
> 
> I'm running R version 2.10.0 on a Mac. The "Package Manager" from the GUI does
> no more display html help files except the Index pages. When copying the links
> to the browser it shows, that all help files are missing, e.g. 
> 
> file:///Library/Frameworks/R.framework/Versions/2.10/Resources/library/base/html/
> 
> However, if looking for html help via ? everything works correctly.

This is by design, it's not a bug.  The HTML for the help pages is 
generated at the time you request it, and may contain dynamic content 
(though there are very few examples of that as yet).

Duncan Murdoch


From simon.urbanek at r-project.org  Sat Dec 12 23:20:51 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Sat, 12 Dec 2009 17:20:51 -0500
Subject: [Rd] Missing html help files with R 2.10.0 (PR#14134)
In-Reply-To: <4B2411C5.9090206@stats.uwo.ca>
References: <20091212122009.7F0BC282EF4D@mail.pubhealth.ku.dk>
	<4B2411C5.9090206@stats.uwo.ca>
Message-ID: <C6513E57-7F0A-4B17-B95F-0BC58DAFD360@r-project.org>


On Dec 12, 2009, at 4:57 PM, Duncan Murdoch wrote:

> On 12/12/2009 7:20 AM, johann.kraus at uni-ulm.de wrote:
>> Full_Name: Johann Kraus
>> Version: 2.10.0
>> OS: Mac
>> Submission from: (NULL) (134.60.236.10)
>> I'm running R version 2.10.0 on a Mac. The "Package Manager" from the GUI does
>> no more display html help files except the Index pages. When copying the links
>> to the browser it shows, that all help files are missing, e.g. file:///Library/Frameworks/R.framework/Versions/2.10/Resources/library/base/html/
>> However, if looking for html help via ? everything works correctly.
> 
> This is by design, it's not a bug.  The HTML for the help pages is generated at the time you request it, and may contain dynamic content (though there are very few examples of that as yet).
> 

The bug is that the GUI used a static file instead of the dynamic help. That is now fixed (the same was also true for the Data Manager, both should be now fixed, i.e., use the dynamic help instead).

Thanks,
Simon


From savicky at cs.cas.cz  Sun Dec 13 11:44:02 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Sun, 13 Dec 2009 11:44:02 +0100
Subject: [Rd] R CMD check may not detect a code/documentation mismatch
Message-ID: <20091213104402.GA20719@cs.cas.cz>

For the package at
  http://www.cs.cas.cz/~savicky/R-devel/something_0.0.0.tar.gz
which is a minor part of some other package only to demonstrate the
problem, i get (under R version 2.11.0 Under development 2009-12-12 r50714
and also under R-2.9.2, openSUSE 11.1 (x86_64) and CentOS release 5.2)

  R CMD check something_0.0.0.tar.gz

  ...
  * checking Rd files ... OK
  * checking Rd metadata ... OK
  * checking Rd cross-references ... OK
  * checking for missing documentation entries ... OK
  * checking for code/documentation mismatches ... OK
  * checking Rd \usage sections ... OK
  * checking examples ... NONE
  * checking PDF version of manual ... OK

although the package code contains

  testCoreNA <- function()

and the documentation contains

  \usage{
  testCoreClass(verbose=0)
  testCoreAttrEval(verbose=0)
  testCoreReg(verbose=0)
  testCoreNA(verbose=0)
  }

There is a mismatch between code and documentation of testCoreNA(). Is the 
problem caused by having four entries in \usage{} section?

Petr Savicky.


From p.dalgaard at biostat.ku.dk  Sun Dec 13 13:59:55 2009
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sun, 13 Dec 2009 13:59:55 +0100
Subject: [Rd] R CMD check may not detect a code/documentation mismatch
In-Reply-To: <20091213104402.GA20719@cs.cas.cz>
References: <20091213104402.GA20719@cs.cas.cz>
Message-ID: <4B24E54B.7080005@biostat.ku.dk>

Petr Savicky wrote:
> For the package at
>   http://www.cs.cas.cz/~savicky/R-devel/something_0.0.0.tar.gz
> which is a minor part of some other package only to demonstrate the
> problem, i get (under R version 2.11.0 Under development 2009-12-12 r50714
> and also under R-2.9.2, openSUSE 11.1 (x86_64) and CentOS release 5.2)
> 
>   R CMD check something_0.0.0.tar.gz
> 
>   ...
>   * checking Rd files ... OK
>   * checking Rd metadata ... OK
>   * checking Rd cross-references ... OK
>   * checking for missing documentation entries ... OK
>   * checking for code/documentation mismatches ... OK
>   * checking Rd \usage sections ... OK
>   * checking examples ... NONE
>   * checking PDF version of manual ... OK
> 
> although the package code contains
> 
>   testCoreNA <- function()
> 
> and the documentation contains
> 
>   \usage{
>   testCoreClass(verbose=0)
>   testCoreAttrEval(verbose=0)
>   testCoreReg(verbose=0)
>   testCoreNA(verbose=0)
>   }
> 
> There is a mismatch between code and documentation of testCoreNA(). Is the 
> problem caused by having four entries in \usage{} section?

Hmm, looks more like a thinko in this code inside codoc():

     functions_in_code <- Filter(function(f) {
         f <- get(f, envir = code_env)
         is.function(f) && (length(formals(f)) > 0L)
     }, objects_in_code)

which, further down the line, causes functions with no formal arguments 
to be skipped when compared to the usage section.

Browse[2]>
debug: ind <- (!functions %in% functions_to_be_ignored & functions %in%
     functions_in_code)
Browse[2]> functions
[1] "testCoreClass"    "testCoreAttrEval" "testCoreReg" 
"testCoreNA"
Browse[2]>
debug: bad_functions <- mapply(functions[ind], exprs[ind], FUN = 
function(x,
     y) check_codoc(x, as.pairlist(as.alist.call(y[-1L]))), SIMPLIFY = 
FALSE)
Browse[2]> ind
[1]  TRUE  TRUE  TRUE FALSE

I.e. testCoreNA is never tested by check_codoc. There may of course be a 
rationale for this, but it escapes me...


-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From dsimcha at gmail.com  Sun Dec 13 06:38:05 2009
From: dsimcha at gmail.com (David Simcha)
Date: Sun, 13 Dec 2009 00:38:05 -0500
Subject: [Rd] O(N log N) Kendall Tau
Message-ID: <4B247DBD.6060002@gmail.com>

I've noticed that the implementation of Kendall's Tau in R is O(N^2).  
The following reference describes how it can be done in O(N log N):

 A Computer Method for Calculating Kendall's Tau with Ungrouped Data
 William R. Knight
 Journal of the American Statistical Association, Vol. 61, No. 314, Part 
1 (Jun., 1966), pp. 436-439
 http://www.jstor.org/pss/2282833

I'm interested in contributing an implementation of this algorithm to 
R.  However, I have a few questions:

1.  Would it likely be accepted if well-implemented?
2.  cov.c in the main/ directory of the R source tree seems to contain 
at least 4 different but nearly identical implementations of Kendall's 
Tau:  cov_complete1, cov_complete2, cov_na1, and cov_na2.  I can't tell 
why.  The file is very difficult to read because of its lack of 
comments, (ab)use of macros and improper indentation.  As I will 
probably need to modify this file, can some seasoned veteran please 
explain what the heck is going on in this file?


From edd at debian.org  Sun Dec 13 17:27:03 2009
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sun, 13 Dec 2009 10:27:03 -0600
Subject: [Rd] O(N log N) Kendall Tau
In-Reply-To: <4B247DBD.6060002@gmail.com>
References: <4B247DBD.6060002@gmail.com>
Message-ID: <19237.5591.753351.570238@ron.nulle.part>


On 13 December 2009 at 00:38, David Simcha wrote:
| I've noticed that the implementation of Kendall's Tau in R is O(N^2).  
| The following reference describes how it can be done in O(N log N):
| 
|  A Computer Method for Calculating Kendall's Tau with Ungrouped Data
|  William R. Knight
|  Journal of the American Statistical Association, Vol. 61, No. 314, Part 
| 1 (Jun., 1966), pp. 436-439
|  http://www.jstor.org/pss/2282833

Interesting.  I recently used the performance of cor(X, method="kendall") as
a contrast to the 26-fold speedup when (!!) using gpuCor(X, method="kendall")
from the nice gputools package by Josh Buckner and Mark Seligman.  That was
using the GPU in a QuadroFX 4800 with a 1206 x 477 matrix; the full example
is in my most recent 'Intro to HPC with R' slides.

| I'm interested in contributing an implementation of this algorithm to 
| R.  However, I have a few questions:
| 
| 1.  Would it likely be accepted if well-implemented?
| 2.  cov.c in the main/ directory of the R source tree seems to contain 
| at least 4 different but nearly identical implementations of Kendall's 
| Tau:  cov_complete1, cov_complete2, cov_na1, and cov_na2.  I can't tell 
| why.  

Combine your bottom-up code analysis with a top-down usage analysis -- open
up R and read 'help(cov)'.  There are different ways to deal with missing
observations.  

| The file is very difficult to read because of its lack of 
| comments, (ab)use of macros and improper indentation.  As I will 
| probably need to modify this file, can some seasoned veteran please 
| explain what the heck is going on in this file?

Again, I think reading the help file along with the code may prove
beneficial.  The R implementation is pretty consistent across files to you
will have to get used to those C level macros if you want to modify code at
that level.  The R Extensions manual may prove helpful.

Lastly, as a matter of style, I find people are more likely to help you if
you don't hit them first with a two-by-four of 'your code and style is horrid'.

Cheers, Dirk

-- 
Three out of two people have difficulties with fractions.


From ligges at statistik.tu-dortmund.de  Sun Dec 13 18:18:51 2009
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sun, 13 Dec 2009 18:18:51 +0100
Subject: [Rd] O(N log N) Kendall Tau
In-Reply-To: <4B247DBD.6060002@gmail.com>
References: <4B247DBD.6060002@gmail.com>
Message-ID: <4B2521FB.2010206@statistik.tu-dortmund.de>



David Simcha wrote:
> I've noticed that the implementation of Kendall's Tau in R is O(N^2).  
> The following reference describes how it can be done in O(N log N):
> 
> A Computer Method for Calculating Kendall's Tau with Ungrouped Data
> William R. Knight
> Journal of the American Statistical Association, Vol. 61, No. 314, Part 
> 1 (Jun., 1966), pp. 436-439
> http://www.jstor.org/pss/2282833
> 
> I'm interested in contributing an implementation of this algorithm to 
> R.  However, I have a few questions:
> 
> 1.  Would it likely be accepted if well-implemented?
> 2.  cov.c in the main/ directory of the R source tree seems to contain 
> at least 4 different but nearly identical implementations of Kendall's 
> Tau:  cov_complete1, cov_complete2, cov_na1, and cov_na2.  I can't tell 
> why.  The file is very difficult to read because of its lack of 
> comments, (ab)use of macros and improper indentation.  As I will 
> probably need to modify this file, can some seasoned veteran please 
> explain what the heck is going on in this file?


Well, it is not that hard to find that the functions you mentioned are 
all used (for different cases) in the main function
   do_cov
that is called by R's cov() function.

Given you provide a well tested implementation based on a published 
algorithm that is numerically as stable as the method already 
implemented in R, including all features, and gives identical results, I 
think it is very likely that your implementation will replace the one 
that is currently used in R.

Best,
Uwe Ligges



> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From p.murrell at auckland.ac.nz  Mon Dec 14 03:50:20 2009
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Mon, 14 Dec 2009 15:50:20 +1300
Subject: [Rd] raster support in graphics devices
In-Reply-To: <de4e29f50912061259y283eb4abp14bb3f1637d6113@mail.gmail.com>
References: <4B146EC6.2000502@auckland.ac.nz>	
	<de4e29f50912011038v33c3503dmb732dbd0d8ffd456@mail.gmail.com>	
	<4B15A5C0.4060400@auckland.ac.nz>	
	<de4e29f50912031310j598729f3g9a188d6a270cb91c@mail.gmail.com>	
	<4B1C138C.5080204@auckland.ac.nz>
	<de4e29f50912061259y283eb4abp14bb3f1637d6113@mail.gmail.com>
Message-ID: <4B25A7EC.8090102@auckland.ac.nz>

Hi


baptiste auguie wrote:
> Hi,
> 
> Thanks for the fix. I hope the quartz bugs are not related to a bad
> configuration on my side (I don't have access to another Mac to test
> it).


I have not been able to get hold of a 10.5 (Leopard) Mac either.  Keen 
to hear confirmation from anyone else with this problem.


> I was quite happy with this proof-of-concept of filling patterns for
> rectangles, and I was wondering if perhaps you had considered adding a
> similar tiling option to grid.raster (at the C level)?


I have thought a bit about drawing the same image multiple times (more 
in the context of using a bitmap for a plotting symbol).  I imagine 
something like being able to "add" a raster image to a device and then 
simply "refer" to that image (e.g., by name) is needed.  Still thinking 
about the right way to go about that though.

Paul


> Best regards,
> 
> baptiste
> 
> 2009/12/6 Paul Murrell <p.murrell at auckland.ac.nz>:
>> Hi
>>
>>
>> baptiste auguie wrote:
>>> Hi again,
>>>
>>> I found two possible bugs related to grid.raster, one with the quartz
>>> device and the other with pdf.
>>>
>>> In my example I was playing with the idea of using grid.raster to
>>> create a filling pattern for rectangles. The pdf output does not seem
>>> to respect the clipping (it may have nothing to do with grid.raster
>>> though), whilst the quartz device with pdf file output often crashes
>>> for more than 4 different raster objects (but not always). I'm afraid
>>> I couldn't pinpoint the exact circumstance of the crash with a more
>>> concise example.
>>
>> Thanks again for the report.
>>
>> I have committed a fix for the PDF clipping.
>>
>> Still looking at the Quartz crashes.
>>
>> Paul
>>
>>
>>> Thanks in advance for any insights,
>>>
>>> baptiste
>>>
>>> ### Start example ###
>>>
>>> library(grid)
>>>
>>> ## create a motif
>>> grid45 <- function(..., width=0.5, height=0.5){
>>>  x11(width=width, height=height)
>>>  grid.polygon(...)
>>>  m <- grid.cap()
>>>  dev.off()
>>>  invisible(m)
>>> }
>>>
>>> .grid45 <- grid45()
>>> ## grid.raster(.grid45)
>>>
>>> tile.motif <- function(m, nx=10, ny=nx){
>>>  cols <- matrix(rep(m, nx), ncol=ncol(m)*nx, byrow=F)
>>>  matrix(rep(t(cols), ny), nrow=nrow(cols)*ny, byrow=T)
>>> }
>>>
>>> ## quartz()
>>> ## grid.raster(tile.motif(.grid45, 2, 3))
>>>
>>> patternGrob <- function(x=unit(0.5, "npc"), y=unit(0.5, "npc"),
>>>                        width=unit(1, "npc"), height=unit(1, "npc"),
>>>                        motif=matrix("white"), AR=1,
>>>                        motif.width=unit(5, "mm"),
>>>                        motif.height=AR*motif.width,
>>>                        pattern.offset=c(0, 0), # unimplemented
>>>                        default.units="npc",
>>>                        clip=TRUE, # testing purposes
>>>                        gp=gpar(fill=NA), ...)
>>>  {
>>>    grob(x=x, y=y, width=width, height=height,
>>>         motif=motif, motif.width=motif.width,
>>>         motif.height=motif.height, clip=clip, gp=gp, ..., cl="pattern")
>>>  }
>>>
>>> widthDetails.pattern <- function(x) x$width
>>> heightDetails.pattern <- function(x) x$height
>>>
>>> drawDetails.pattern <- function(x, recording=TRUE){
>>>
>>> ##   calculate the number of tiles
>>>  nx <- ceiling(convertUnit(x$width, "in", value=TRUE) /
>>>                convertUnit(x$motif.width, "in", value=TRUE)) + 1
>>>  ny <- ceiling(convertUnit(x$height, "in", axisFrom = "y", value=TRUE) /
>>>                convertUnit(x$motif.height, "in", axisFrom = "y",
>>> value=TRUE)) + 1
>>>
>>>  width <- convertUnit(x$width, "in")
>>>  height <- convertUnit(x$height, "in", axisFrom = "y")
>>>
>>> ##   clip the raster
>>>  pushViewport(viewport(x=x$x, y=x$y,
>>>          width=x$width, height=x$height, clip=x$clip))
>>>
>>>  grid.raster(tile.motif(x$motif, nx, ny), width=nx*x$motif.width,
>>>                         height=ny*x$motif.height)
>>>  upViewport()
>>>
>>> ##   overlay the rectangle
>>>  grid.rect(x=x$x, y=x$y,
>>>          width=x$width, height=x$height,
>>>          just="center", gp=x$gp)
>>> }
>>>
>>>
>>> g <- patternGrob(x=0.7, width=unit(0.3, "npc"),
>>>                  height=unit(5.2, "cm"),
>>>                  clip=TRUE, motif=.grid45)
>>>
>>> ## interactive use: OK
>>> quartz()
>>> grid.newpage()
>>> grid.draw(g)
>>>
>>> ## png: OK
>>> png(file="pngClip.png")
>>> grid.newpage()
>>> grid.draw(g)
>>> dev.off()
>>>
>>> ## pdf: clipping does not occur
>>> pdf(file="pdfClip.pdf")
>>> grid.newpage()
>>> grid.draw(g)
>>> dev.off()
>>>
>>> ## quartz pdf: OK, but see below
>>> quartz(file="quartzClip.pdf", type="pdf")
>>> grid.newpage()
>>> grid.draw(g)
>>> dev.off()
>>>
>>> g1 <- patternGrob(x=0.2, width=unit(0.2, "npc"),
>>>                  height=unit(5.2, "cm"),
>>>                  clip=TRUE, motif=.grid45)
>>>
>>> g2 <- patternGrob(x=0.4, width=unit(0.2, "npc"),
>>>                  height=unit(5.2, "cm"),
>>>                  clip=TRUE, motif=.grid45)
>>>
>>> g3 <- patternGrob(x=0.6, width=unit(0.2, "npc"),
>>>                  height=unit(5.2, "cm"),
>>>                  clip=TRUE, motif=.grid45)
>>>
>>> g4 <- patternGrob(x=0.8, width=unit(0.2, "npc"),
>>>                  height=unit(5.2, "cm"),
>>>                  clip=TRUE, motif=.grid45)
>>>
>>> quartz(file="quartzClip2.pdf", type="pdf")
>>> grid.newpage()
>>> grid.draw(g1)
>>> grid.draw(g2)
>>> grid.draw(g3)
>>> grid.draw(g4)
>>> dev.off()
>>>
>>>  *** caught segfault ***
>>> address 0x15dda018, cause 'memory not mapped'
>>>
>>> Traceback:
>>>  1: dev.off()
>>>
>>>  sessionInfo()
>>> R version 2.11.0 Under development (unstable) (2009-11-30 r50622)
>>> i386-apple-darwin9.8.0
>>>
>>> locale:
>>> [1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8
>>>
>>> attached base packages:
>>> [1] grid      stats     graphics  grDevices utils     datasets  methods
>>> [8] base
>>>
>>>
>>>
>>> 2009/12/2 Paul Murrell <p.murrell at auckland.ac.nz>:
>>>> Hi
>>>>
>>>>
>>>> baptiste auguie wrote:
>>>>> Very nice, thank you for this great addition to R graphics! I can't
>>>>> wait to see lattice and ggplot2 functions that use rasterGrob to
>>>>> display images. The pdf output is so much better in every way!
>>>>>
>>>>> Incidentally, I ran into a segfault with grid.cap on the quartz
>>>>> device, but maybe it's normal at this stage.
>>>> This may be due to the fact that I tested the changes on Mac OS X 10.6
>>>> (looks like you have 10.5 ?), plus the fact that I am feeling my way a
>>>> bit
>>>> on the Mac.  I have access to a 10.4 machine so I will try to take a look
>>>> there.  Thanks for the report.
>>>>
>>>> Paul
>>>>
>>>>
>>>>> This works fine:
>>>>>
>>>>> library(grid)
>>>>> x11()
>>>>> grid.text("test")
>>>>> cap <- grid.cap()
>>>>>
>>>>> This doesn't:
>>>>>
>>>>> library(grid)
>>>>> quartz()
>>>>> grid.text("test")
>>>>> cap <- grid.cap()
>>>>>
>>>>>  *** caught segfault ***
>>>>> address 0x18330001, cause 'memory not mapped'
>>>>>
>>>>> Traceback:
>>>>>  1: .Call(fnname, ..., PACKAGE = "grid")
>>>>>  2: grid.Call("L_cap")
>>>>>  3: grid.cap()
>>>>>
>>>>> Possible actions:
>>>>> 1: abort (with core dump, if enabled)
>>>>> 2: normal R exit
>>>>> 3: exit R without saving workspace
>>>>> 4: exit R saving workspace
>>>>>
>>>>> [R.app GUI 1.30 (5527) i386-apple-darwin9.8.0]
>>>>>
>>>>>> sessionInfo()
>>>>> R version 2.11.0 Under development (unstable) (2009-11-30 r50622)
>>>>> i386-apple-darwin9.8.0
>>>>>
>>>>> locale:
>>>>> [1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8
>>>>>
>>>>> attached base packages:
>>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>>>
>>>>> Best regards,
>>>>>
>>>>> baptiste
>>>>>
>>>>> 2009/12/1 Paul Murrell <p.murrell at auckland.ac.nz>:
>>>>>> Hi
>>>>>>
>>>>>> This is for developers of extension packages that provide extra
>>>>>> *graphics
>>>>>> devices* for R.
>>>>>>
>>>>>> In the *development* version of R, support has been added to the
>>>>>> graphics
>>>>>> engine for sending raster images (bitmaps) to a graphics device.  This
>>>>>> consists mainly of two new device functions:  dev_Raster() and
>>>>>> dev_Cap().
>>>>>>
>>>>>> The R_GE_version constant (in GraphicsEngine.h) has been bumped up to 6
>>>>>> as a
>>>>>> marker of this change.
>>>>>>
>>>>>> This means that, at a minimum, all graphics devices should be updated
>>>>>> to
>>>>>> provide dummy implementations of these new functions that just say the
>>>>>> feature is not yet implemented (see for example the PicTeX and XFig
>>>>>> devices
>>>>>> in the 'grDevices' package).
>>>>>>
>>>>>> A full implementation of dev_Raster() should be able to draw a raster
>>>>>> image
>>>>>> (provided as an array of 32-bit R colors) at any size, possibly
>>>>>> (bilinear)
>>>>>> interpolated (otherwise nearest-neighbour), at any orientation, and
>>>>>> with
>>>>>> a
>>>>>> per-pixel alpha channel.  Where these are not natively supported by a
>>>>>> device, the graphics engine provides some routines for scaling and
>>>>>> rotating
>>>>>> raster images (see for example the X11 device).  The dev_Cap() function
>>>>>> should return a representation of a raster image captured from the
>>>>>> current
>>>>>> device.  This will only make sense for some devices (see for example
>>>>>> the
>>>>>> Cairo device in the 'grDevices' package).
>>>>>>
>>>>>> A little more information and a couple of small examples are provided
>>>>>> at
>>>>>> http://developer.r-project.org/Raster/raster-RFC.html
>>>>>>
>>>>>> Paul
>>>>>> --
>>>>>> Dr Paul Murrell
>>>>>> Department of Statistics
>>>>>> The University of Auckland
>>>>>> Private Bag 92019
>>>>>> Auckland
>>>>>> New Zealand
>>>>>> 64 9 3737599 x85392
>>>>>> paul at stat.auckland.ac.nz
>>>>>> http://www.stat.auckland.ac.nz/~paul/
>>>>>>
>>>>>> ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>
>>>> --
>>>> Dr Paul Murrell
>>>> Department of Statistics
>>>> The University of Auckland
>>>> Private Bag 92019
>>>> Auckland
>>>> New Zealand
>>>> 64 9 3737599 x85392
>>>> paul at stat.auckland.ac.nz
>>>> http://www.stat.auckland.ac.nz/~paul/
>>>>
>> --
>> Dr Paul Murrell
>> Department of Statistics
>> The University of Auckland
>> Private Bag 92019
>> Auckland
>> New Zealand
>> 64 9 3737599 x85392
>> paul at stat.auckland.ac.nz
>> http://www.stat.auckland.ac.nz/~paul/
>>

-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From Kurt.Hornik at wu.ac.at  Mon Dec 14 09:24:12 2009
From: Kurt.Hornik at wu.ac.at (Kurt Hornik)
Date: Mon, 14 Dec 2009 09:24:12 +0100
Subject: [Rd] R CMD check may not detect a code/documentation mismatch
In-Reply-To: <4B24E54B.7080005@biostat.ku.dk>
References: <20091213104402.GA20719@cs.cas.cz> <4B24E54B.7080005@biostat.ku.dk>
Message-ID: <19237.63020.855201.147223@fangorn.hornik.net>

>>>>> Peter Dalgaard writes:

> Petr Savicky wrote:
>> For the package at
>> http://www.cs.cas.cz/~savicky/R-devel/something_0.0.0.tar.gz
>> which is a minor part of some other package only to demonstrate the
>> problem, i get (under R version 2.11.0 Under development 2009-12-12 r50714
>> and also under R-2.9.2, openSUSE 11.1 (x86_64) and CentOS release 5.2)
>> 
>> R CMD check something_0.0.0.tar.gz
>> 
>> ...
>> * checking Rd files ... OK
>> * checking Rd metadata ... OK
>> * checking Rd cross-references ... OK
>> * checking for missing documentation entries ... OK
>> * checking for code/documentation mismatches ... OK
>> * checking Rd \usage sections ... OK
>> * checking examples ... NONE
>> * checking PDF version of manual ... OK
>> 
>> although the package code contains
>> 
>> testCoreNA <- function()
>> 
>> and the documentation contains
>> 
>> \usage{
>> testCoreClass(verbose=0)
>> testCoreAttrEval(verbose=0)
>> testCoreReg(verbose=0)
>> testCoreNA(verbose=0)
>> }
>> 
>> There is a mismatch between code and documentation of testCoreNA(). Is the 
>> problem caused by having four entries in \usage{} section?

> Hmm, looks more like a thinko in this code inside codoc():

>      functions_in_code <- Filter(function(f) {
>          f <- get(f, envir = code_env)
>          is.function(f) && (length(formals(f)) > 0L)
>      }, objects_in_code)

> which, further down the line, causes functions with no formal arguments 
> to be skipped when compared to the usage section.

> Browse[2]>
> debug: ind <- (!functions %in% functions_to_be_ignored & functions %in%
>      functions_in_code)
> Browse[2]> functions
> [1] "testCoreClass"    "testCoreAttrEval" "testCoreReg" 
> "testCoreNA"
> Browse[2]>
> debug: bad_functions <- mapply(functions[ind], exprs[ind], FUN = 
> function(x,
>      y) check_codoc(x, as.pairlist(as.alist.call(y[-1L]))), SIMPLIFY = 
> FALSE)
> Browse[2]> ind
> [1]  TRUE  TRUE  TRUE FALSE

> I.e. testCoreNA is never tested by check_codoc. There may of course be
> a rationale for this, but it escapes me...

Well, I am sure I had good reasons when I wrote the code many years ago,
but of course I no longer recall what they were.

Did you try the effect of removing the length(formals(f)) test?

-k


> -- 
>     O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>    c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
>   (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907

> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Mon Dec 14 10:14:19 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 14 Dec 2009 09:14:19 +0000 (GMT)
Subject: [Rd] Calendar week ISO (PR#14132)
In-Reply-To: <20091211212513.73E592833EE0@mail.pubhealth.ku.dk>
References: <20091211212513.73E592833EE0@mail.pubhealth.ku.dk>
Message-ID: <alpine.OSX.1.00.0912131234110.259@tystie.local>

Why are you reporting a POSIX standard feature missing in your OS as a 
bug in R?  (One that is even documented on the help page.)

On more comprehensive OSes you can use the %V format of strftime. 
You could compile a replacement for Windows' strftime and link it into 
your build of R, as we have done for so many other Windows lacunae.
Then in your example use as.integer(strftime(tmp.d, "%V"))

On Fri, 11 Dec 2009, samandrew at gmx.ch wrote:

> Hi there
>
> =20
>
> I use Gnu R sometimes at work.=20
>
> =20
>
> Unfortunately we use Windows and R has problems with getting the calendar

That is simply false: R is not responsible for the lack of standards 
compliance of Windows, and filing a bug report with Microsoft would be 
much more appropriate.

> week number with the first week as the one which has at least 4 days. A
> colleague told me that he has the same problem.=20
>
> =20
>
> Below you can see what I use now, for finding the right week.=20
>
> =20
>
> =20
>
> Kind regards,=20
>
> Samuel Andreas Meichtry
>
> =20
>
> =20
>
> #Excel-Funktion
>
> #=3DK=DCRZEN((A3-DATUM(JAHR(A3+3-REST(A3-2;7));1;REST(A3-2;7)-9))/7)
>
> =20
>
> =20
>
> #R-Funktion
>
> KW<-function(x){=20=20=20=20
>
>    return(floor(
>
>    as.numeric((x-(as.Date(ISOdate(
>
> =20
> as.numeric(format(as.Date(as.numeric(x)+3+25569-2-(as.numeric(x)-2+25569)%%7
> ,origin=3D"1900-01-01"),"%Y")),1,1)
>
>    )+((as.numeric(x)-2+25569)%%7-9)-1))/7)))=20=20=20=20=20=20=20=20=20=20=
> =20=20=20=20=20=20
>
> }
>
> =20
>
> tmp.d <- seq(as.Date("1970-01-01"),as.Date("2009-01-01"),"days")
>
> df<-data.frame(TimeStamp=3Dtmp.d,KW=3DKW(tmp.d))
>
> =20
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From P.Dalgaard at biostat.ku.dk  Mon Dec 14 10:24:36 2009
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Mon, 14 Dec 2009 10:24:36 +0100
Subject: [Rd] R CMD check may not detect a code/documentation mismatch
In-Reply-To: <19237.63020.855201.147223@fangorn.hornik.net>
References: <20091213104402.GA20719@cs.cas.cz>	<4B24E54B.7080005@biostat.ku.dk>
	<19237.63020.855201.147223@fangorn.hornik.net>
Message-ID: <4B260454.20903@biostat.ku.dk>

Kurt Hornik wrote:
>>>>>> Peter Dalgaard writes:
> 
>> Petr Savicky wrote:
>>> For the package at
>>> http://www.cs.cas.cz/~savicky/R-devel/something_0.0.0.tar.gz
>>> which is a minor part of some other package only to demonstrate the
>>> problem, i get (under R version 2.11.0 Under development 2009-12-12 r50714
>>> and also under R-2.9.2, openSUSE 11.1 (x86_64) and CentOS release 5.2)
>>>
>>> R CMD check something_0.0.0.tar.gz
>>>
>>> ...
>>> * checking Rd files ... OK
>>> * checking Rd metadata ... OK
>>> * checking Rd cross-references ... OK
>>> * checking for missing documentation entries ... OK
>>> * checking for code/documentation mismatches ... OK
>>> * checking Rd \usage sections ... OK
>>> * checking examples ... NONE
>>> * checking PDF version of manual ... OK
>>>
>>> although the package code contains
>>>
>>> testCoreNA <- function()
>>>
>>> and the documentation contains
>>>
>>> \usage{
>>> testCoreClass(verbose=0)
>>> testCoreAttrEval(verbose=0)
>>> testCoreReg(verbose=0)
>>> testCoreNA(verbose=0)
>>> }
>>>
>>> There is a mismatch between code and documentation of testCoreNA(). Is the 
>>> problem caused by having four entries in \usage{} section?
> 
>> Hmm, looks more like a thinko in this code inside codoc():
> 
>>      functions_in_code <- Filter(function(f) {
>>          f <- get(f, envir = code_env)
>>          is.function(f) && (length(formals(f)) > 0L)
>>      }, objects_in_code)
> 
>> which, further down the line, causes functions with no formal arguments 
>> to be skipped when compared to the usage section.
> 
>> Browse[2]>
>> debug: ind <- (!functions %in% functions_to_be_ignored & functions %in%
>>      functions_in_code)
>> Browse[2]> functions
>> [1] "testCoreClass"    "testCoreAttrEval" "testCoreReg" 
>> "testCoreNA"
>> Browse[2]>
>> debug: bad_functions <- mapply(functions[ind], exprs[ind], FUN = 
>> function(x,
>>      y) check_codoc(x, as.pairlist(as.alist.call(y[-1L]))), SIMPLIFY = 
>> FALSE)
>> Browse[2]> ind
>> [1]  TRUE  TRUE  TRUE FALSE
> 
>> I.e. testCoreNA is never tested by check_codoc. There may of course be
>> a rationale for this, but it escapes me...
> 
> Well, I am sure I had good reasons when I wrote the code many years ago,
> but of course I no longer recall what they were.
> 
> Did you try the effect of removing the length(formals(f)) test?

Not yet. Priorities....

-p

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From Jerry.Lewis at biogenidec.com  Mon Dec 14 11:15:10 2009
From: Jerry.Lewis at biogenidec.com (Jerry.Lewis at biogenidec.com)
Date: Mon, 14 Dec 2009 11:15:10 +0100 (CET)
Subject: [Rd] qpois errors for degenerate distribution (PR#14135)
Message-ID: <20091214101510.7380F283031F@mail.pubhealth.ku.dk>

Full_Name: Jerry W. Lewis
Version: 2.10.0
OS: XP Professional
Submission from: (NULL) (96.237.55.233)


For a degenerate Poisson distribution (lambda==0), qpois(p,0,lower.tail) should
return 0 for any valid p, but qpois(1,0) and qpois(0,0,F) incorrectly return
Inf.


From murdoch at stats.uwo.ca  Mon Dec 14 13:34:35 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 14 Dec 2009 07:34:35 -0500
Subject: [Rd] R on Windows crashes when using certain characters in
 strings in data frames (PR#14125)
In-Reply-To: <20091210092009.D1A7A282EFC8@mail.pubhealth.ku.dk>
References: <20091210092009.D1A7A282EFC8@mail.pubhealth.ku.dk>
Message-ID: <4B2630DB.9080004@stats.uwo.ca>

On 10/12/2009 4:20 AM, karl at huftis.org wrote:
> Full_Name: Karl Ove Hufthammer
> Version: 2.10.0
> OS: Windows XP
> Submission from: (NULL) (93.124.134.66)
> 
> 
> I have found a rather strange bug in R 2.10.0 on Windows, where the choice of
> characters used in a string make R crash (i.e., Windows shows a dialogue saying
> that the application has a problem, and must be closed).

This was related to encoding changes.  It likely appeared 
Windows-specific because Windows uses a different default encoding than 
most Linux systems.  I believe it is fixed now in R-devel, and it will 
soon make it into 2.10.1-patched, but it came too late to make it into 
today's release.

I believe PR#14114 was the same issue and is also fixed, but I did less 
testing of it.  I'd appreciate it if those who saw either bug in real 
code test the patches.  They should be in today's tarball of R-devel, 
and did make it into the Windows binary build of R-devel this morning.

Duncan

> 
> I can reproduce the bug on two separate systems running Windows XP, and with
> both R 2.10.0 and the latest R.2.10.1 RC.
> 
> The following commands trigger the crash for me:
> 
> n=1e5
> k=10
> x=sample(k,n,replace=TRUE)
> y=sample(k,n,replace=TRUE)
> xy=paste(x,y,sep=" ? ")
> z=sample(n)
> d=data.frame(xy,z)
> 
> The last step takes very long time, and R crashes before it's finished. Note
> that if I reduce n, the problem disappears. Also, if I change the ? (a
> multiplication symbol) to a x (a letter), the problem also disappears (and the
> last command takes almost no time to run).
> 
> I originally discovered this (or a related?) bug while using 'unique' on a data
> frame similar to the 'd' data frame defined above, where R would often, but not
> always, crash. 
> 
>> sessionInfo()
> R version 2.10.0 (2009-10-26) 
> i386-pc-mingw32 
> 
> locale:
> [1] LC_COLLATE=Norwegian-Nynorsk_Norway.1252 
> [2] LC_CTYPE=Norwegian-Nynorsk_Norway.1252   
> [3] LC_MONETARY=Norwegian-Nynorsk_Norway.1252
> [4] LC_NUMERIC=C                             
> [5] LC_TIME=Norwegian-Nynorsk_Norway.1252    
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Mon Dec 14 13:40:10 2009
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Mon, 14 Dec 2009 13:40:10 +0100 (CET)
Subject: [Rd] R on Windows crashes when using certain characters in
	strings (PR#14137)
Message-ID: <20091214124010.95924282EF42@mail.pubhealth.ku.dk>

On 10/12/2009 4:20 AM, karl at huftis.org wrote:
> Full_Name: Karl Ove Hufthammer
> Version: 2.10.0
> OS: Windows XP
> Submission from: (NULL) (93.124.134.66)
> 
> 
> I have found a rather strange bug in R 2.10.0 on Windows, where the choice of
> characters used in a string make R crash (i.e., Windows shows a dialogue saying
> that the application has a problem, and must be closed).

This was related to encoding changes.  It likely appeared 
Windows-specific because Windows uses a different default encoding than 
most Linux systems.  I believe it is fixed now in R-devel, and it will 
soon make it into 2.10.1-patched, but it came too late to make it into 
today's release.

I believe PR#14114 was the same issue and is also fixed, but I did less 
testing of it.  I'd appreciate it if those who saw either bug in real 
code test the patches.  They should be in today's tarball of R-devel, 
and did make it into the Windows binary build of R-devel this morning.

Duncan

> 
> I can reproduce the bug on two separate systems running Windows XP, and with
> both R 2.10.0 and the latest R.2.10.1 RC.
> 
> The following commands trigger the crash for me:
> 
> n=1e5
> k=10
> x=sample(k,n,replace=TRUE)
> y=sample(k,n,replace=TRUE)
> xy=paste(x,y,sep=" ? ")
> z=sample(n)
> d=data.frame(xy,z)
> 
> The last step takes very long time, and R crashes before it's finished. Note
> that if I reduce n, the problem disappears. Also, if I change the ? (a
> multiplication symbol) to a x (a letter), the problem also disappears (and the
> last command takes almost no time to run).
> 
> I originally discovered this (or a related?) bug while using 'unique' on a data
> frame similar to the 'd' data frame defined above, where R would often, but not
> always, crash. 
> 
>> sessionInfo()
> R version 2.10.0 (2009-10-26) 
> i386-pc-mingw32 
> 
> locale:
> [1] LC_COLLATE=Norwegian-Nynorsk_Norway.1252 
> [2] LC_CTYPE=Norwegian-Nynorsk_Norway.1252   
> [3] LC_MONETARY=Norwegian-Nynorsk_Norway.1252
> [4] LC_NUMERIC=C                             
> [5] LC_TIME=Norwegian-Nynorsk_Norway.1252    
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From Achim.Zeileis at wu-wien.ac.at  Mon Dec 14 14:55:36 2009
From: Achim.Zeileis at wu-wien.ac.at (Achim Zeileis)
Date: Mon, 14 Dec 2009 14:55:36 +0100 (CET)
Subject: [Rd] ar.ols(): negative determinant problem
Message-ID: <alpine.DEB.2.00.0912141440460.26180@paninaro.stat-math.wu-wien.ac.at>

Hi,

I was pointed by a request on R-help to the following problem with 
ar.ols():

R> set.seed(1)
R> x <- matrix(rnorm(4 * 2), ncol = 2)
R> ar.ols(x, order.max = 1, aic = FALSE, demean = FALSE)
Error in if ((dimension < 1) | (dimension > n)) stop("wrong embedding 
dimension") :
   argument is of length zero
In addition: Warning message:
In log(det(varE[[m - order.min + 1L]])) : NaNs produced

This happens on my 32-bit Debian (i686-pc-linux-gnu), both in R-release 
and R-devel. The source is a numerical instability in the computations of 
the error variance and subsequent AIC.

         YH <- A[[m - order.min + 1L]] %*% t(X)
         E <- (Y - YH)
         varE[[m - order.min + 1L]] <- E %*% t(E)/N
[...]
         aic[m - order.min + 1L] <- n.used * log(det(varE[[m -
             order.min + 1L]])) + 2 * nser * (nser * m + intercept)

varE is the cross-product of the errors E and should be positive-definite 
but here det(varE[[1]]) is -6.920697e-17 (on my machine) and thus taking 
logs gives NaN yielding an aic of NaN for which the minimum cannot be 
determined.

Of course, it does not make much sense to fit such a VAR model but either 
a more meaningful error or a workaround would be useful. For example one 
could take

         log(max(0, det(varE[[m - order.min + 1L]])))

to avoid the negative determinant problem.

Best,
Z


From maechler at stat.math.ethz.ch  Mon Dec 14 15:35:22 2009
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Mon, 14 Dec 2009 15:35:22 +0100 (CET)
Subject: [Rd] qpois errors for degenerate distribution (PR#14135)
Message-ID: <20091214143522.D82A9282EF42@mail.pubhealth.ku.dk>

>>>>> "JL" == Jerry Lewis <Jerry.Lewis at biogenidec.com>
>>>>>     on Mon, 14 Dec 2009 11:15:10 +0100 (CET) writes:

    JL> Full_Name: Jerry W. Lewis Version: 2.10.0 OS: XP
    JL> Professional Submission from: (NULL) (96.237.55.233)


    JL> For a degenerate Poisson distribution (lambda==0),
    JL> qpois(p,0,lower.tail) should return 0 for any valid p,
    JL> but qpois(1,0) and qpois(0,0,F) incorrectly return Inf.

It's very much a borderline case.

But you are right.  This will be fixed in the next versions of R,
but not yet in  R 2.10.1  released a few hours ago ... ;-)

Martin Maechler, ETH Zurich


From baptiste.auguie at googlemail.com  Mon Dec 14 16:09:15 2009
From: baptiste.auguie at googlemail.com (baptiste auguie)
Date: Mon, 14 Dec 2009 16:09:15 +0100
Subject: [Rd] raster support in graphics devices
In-Reply-To: <4B25A7EC.8090102@auckland.ac.nz>
References: <4B146EC6.2000502@auckland.ac.nz>
	<de4e29f50912011038v33c3503dmb732dbd0d8ffd456@mail.gmail.com>
	<4B15A5C0.4060400@auckland.ac.nz>
	<de4e29f50912031310j598729f3g9a188d6a270cb91c@mail.gmail.com>
	<4B1C138C.5080204@auckland.ac.nz>
	<de4e29f50912061259y283eb4abp14bb3f1637d6113@mail.gmail.com>
	<4B25A7EC.8090102@auckland.ac.nz>
Message-ID: <de4e29f50912140709m53032a93na70fde820bb086a0@mail.gmail.com>

Hi,

[my message below is a bit off-topic]

2009/12/14 Paul Murrell <p.murrell at auckland.ac.nz>:

> I have thought a bit about drawing the same image multiple times (more in
> the context of using a bitmap for a plotting symbol). ?I imagine something
> like being able to "add" a raster image to a device and then simply "refer"
> to that image (e.g., by name) is needed.

That would be nice.

I first thought that this new rasterGrob would be a good way to
implement some kind of filling pattern for grid graphics, but after
some more testing I was surprised to see that a similar approach with
vector patterns could result in more efficient, better output. Of
course raster filling patterns could still be nice to have for fancy
images or gradients.

One thing that worries me with the approach I've taken below is that
the grob is not vectorized. In particular, if one was to use it as a
building block for histograms (as in base graphics' density parameter)
each rectangle would have to be drawn in sequence. I can of course
Vectorize() this grob into a new one (gTree) but I haven't seen any
examples like this before. Does this sound reasonable? (argument
explosion might be another problem...)

Best regards,

baptiste

Below is the gist of my experiments (the first part is not related to
grid.raster and runs in current R).


library(grid)

## vector patterns
source("http://gridextra.googlecode.com/svn/trunk/R/vpattern.r")

dev.new()
grid.newpage()
grid.vpattern(x=0.2, width=unit(3,"cm"), height=unit(0.5,"npc"),
             motif="points", motif.params=list(pch=22,
                               gp=gpar(cex=0.8, lwd=5, col="grey90",
fill="grey95")), clip=T)

grid.vpattern(x=0.5, width=unit(0.3,"npc"), height=unit(0.5,"npc"),
             motif="segments", motif.params=list(angle=45,
                                 gp=gpar(lty=2, col="grey", lwd=2.4)))

grid.vpattern(x=0.5, y=0.9, width=unit(0.5,"npc"), height=unit(1,"cm"),
             motif="points", motif.params=list(pch="+"), clip=F,
pattern.offset=c(1, 0.5))

grid.vpattern(x=0.8,  width=unit(0.2,"npc"), height=unit(0.2,"npc"),
             motif="grid", motif.params=list(angle=45,
                             gp=gpar(lwd=10, col="grey90")), clip=T,
pattern.offset=c(-1, 0.5))

grid.vpattern(x=0.5, y=0.1, width=unit(0.9,"npc"), height=unit(0.1,"npc"),
             motif="grid", motif.params=list(angle=30, gp=gpar(col="red")),
              gp=gpar(alpha=0.1, fill="red"))

## raster patterns

source("http://gridextra.googlecode.com/svn/trunk/R/rpattern.r")

## a raster motif
plus <- function(..., width=5, height=5){
  x11(width=width/25.4, height=height/25.4)
  grid.points(x=unit(0.5, "npc"), y=unit(0.5, "npc"),
              pch=3, size=unit(2, "mm"), gp=gpar(), ...)
  m <- grid.cap()
  dev.off()
  invisible(m)
}
.plus <- plus()

g1 <- rpatternGrob(x=0.5, y=0.4, width=unit(3.7, "cm"),
                   height=unit(0.4, "npc"),
                   clip=TRUE, motif=.plus)

dev.new()
grid.draw(g1)


From savicky at cs.cas.cz  Mon Dec 14 21:51:25 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Mon, 14 Dec 2009 21:51:25 +0100
Subject: [Rd] R CMD check may not detect a code/documentation mismatch
In-Reply-To: <19237.63020.855201.147223@fangorn.hornik.net>
References: <20091213104402.GA20719@cs.cas.cz> <4B24E54B.7080005@biostat.ku.dk>
	<19237.63020.855201.147223@fangorn.hornik.net>
Message-ID: <20091214205125.GA7516@cs.cas.cz>

On Mon, Dec 14, 2009 at 09:24:12AM +0100, Kurt Hornik wrote:
> >>>>> Peter Dalgaard writes:
[...]
> > Hmm, looks more like a thinko in this code inside codoc():
> 
> >      functions_in_code <- Filter(function(f) {
> >          f <- get(f, envir = code_env)
> >          is.function(f) && (length(formals(f)) > 0L)
> >      }, objects_in_code)
> 
> > which, further down the line, causes functions with no formal arguments 
> > to be skipped when compared to the usage section.
> 
> > Browse[2]>
> > debug: ind <- (!functions %in% functions_to_be_ignored & functions %in%
> >      functions_in_code)
> > Browse[2]> functions
> > [1] "testCoreClass"    "testCoreAttrEval" "testCoreReg" 
> > "testCoreNA"
> > Browse[2]>
> > debug: bad_functions <- mapply(functions[ind], exprs[ind], FUN = 
> > function(x,
> >      y) check_codoc(x, as.pairlist(as.alist.call(y[-1L]))), SIMPLIFY = 
> > FALSE)
> > Browse[2]> ind
> > [1]  TRUE  TRUE  TRUE FALSE
> 
> > I.e. testCoreNA is never tested by check_codoc. There may of course be
> > a rationale for this, but it escapes me...
> 
> Well, I am sure I had good reasons when I wrote the code many years ago,
> but of course I no longer recall what they were.
> 
> Did you try the effect of removing the length(formals(f)) test?

I understand this as the question, what is the influence of the following patch
(indented by two spaces).

  diff --minimal -U 3 -r R-devel_2009-12-13/src/library/tools/R/QC.R R-devel_length_formals/src/library/tools/R/QC.R
  --- R-devel_2009-12-13/src/library/tools/R/QC.R	2009-10-27 02:59:10.000000000 +0100
  +++ R-devel_length_formals/src/library/tools/R/QC.R	2009-12-14 18:45:55.000000000 +0100
  @@ -398,7 +398,7 @@
       functions_in_code <-
           Filter(function(f) {
                      f <- get(f, envir = code_env)
  -                   is.function(f) && (length(formals(f)) > 0L)
  +                   is.function(f)
                  },
                  objects_in_code)
       ## Sourcing all R code files in the package is a problem for base,

Since i do not know this part of R code, i simply applied the patch to the
current R-devel and run "make" and "make check" (both OK) and compared
the output of

  R CMD check XML_2.6-0.tar.gz
  R CMD check randomForest_4.5-33.tar.gz
  R CMD check tree_1.0-27.tar.gz
  R CMD check survival_2.35-7.tar.gz

with R being both original R-devel and the modified one. The results were identical
in all four cases (empty diff) on two Linux machines (CentOS and openSUSE).

On the other hand, for the package
  http://www.cs.cas.cz/~savicky/R-devel/something_0.0.0.tar.gz
which demonstrates the problem, the modified R detected the code/doc mismatch.
The diff of the two outputs of R CMD check was

  [savicky at uivtx test]$ diff original modified 
  35c35,42
  < * checking for code/documentation mismatches ... OK
  ---
  > * checking for code/documentation mismatches ... WARNING
  > Codoc mismatches from documentation object 'testCore':
  > testCoreNA
  >   Code: function()
  >   Docs: function(verbose = 0)
  >   Argument names in docs not in code:
  >     verbose
  > 
  39a47,50
  > WARNING: There was 1 warning, see
  >   /home/savicky/tmp/test/something.Rcheck/00check.log
  > for details
  > 

Petr Savicky.


From bersch at lycos.com  Mon Dec 14 18:10:16 2009
From: bersch at lycos.com (bersch at lycos.com)
Date: Mon, 14 Dec 2009 18:10:16 +0100 (CET)
Subject: [Rd] Accuracy (PR#14139)
Message-ID: <20091214171016.A1722282EF50@mail.pubhealth.ku.dk>

Full_Name: Bernd Schuster
Version: 2.10.0
OS: Windows Vista
Submission from: (NULL) (91.115.36.35)


> pnorm(1.35,0,1)
[1] 0.911492
> pnorm(1.36,0,1)
[1] 0.913085

> options(digits=4)

> pnorm(1.35,0,1)
[1] 0.9115
> pnorm(1.36,0,1)
[1] 0.913          rounding error?


From mg10 at sanger.ac.uk  Mon Dec 14 12:05:10 2009
From: mg10 at sanger.ac.uk (mg10 at sanger.ac.uk)
Date: Mon, 14 Dec 2009 12:05:10 +0100 (CET)
Subject: [Rd] Online help for text() wrong for 'pos' argument. (PR#14136)
Message-ID: <20091214110510.2E135282EF42@mail.pubhealth.ku.dk>

This is a multi-part message in MIME format.
--------------000902010602030404010803
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Hello

Please find bug report attached.

Thanks

Matthew

-- 
Matthew Gillman
Team 105: Variation Informatics
Wellcome Trust Sanger Institute, Wellcome Trust Genome Campus, Hinxton, Cambridge, CB10 1SA, UK
Tel: 01223 834244 Ext. 4922




-- 
 The Wellcome Trust Sanger Institute is operated by Genome Research 
 Limited, a charity registered in England with number 1021457 and a 
 company registered in England with number 2742969, whose registered 
 office is 215 Euston Road, London, NW1 2BE. 

--------------000902010602030404010803
Content-Type: text/plain;
 name="R.bug.report"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="R.bug.report"


Hello

I believe the help for the 'text' function (which places text on graphs)
is wrong, specifically for the 'pos' variable. I did some tests to place 
some text,

e.g. text(2000, -3, "This is a test at (2000, -3)", cex = 0.5, srt=90, pos=4)

With no pos, the (vertical) text was centred at the specified co-ordinates.
When pos=1, it was to the right
pos=2 -> below
pos=3 -> left
pos=4 -> above and to the right.

This disagrees with what the online help says:
"Values of '1', '2', '3' and '4', respectively indicate positions
below, to the left of, above and to the right of the specified coordinates."

Thanks

Matthew Gillman
mg10 _at_ sanger _dot_ ac _dot_ uk


--please do not edit the information below--


Version:
 platform = x86_64-unknown-linux-gnu
 arch = x86_64
 os = linux-gnu
 system = x86_64, linux-gnu
 status = 
 major = 2
 minor = 9.0
 year = 2009
 month = 04
 day = 17
 svn rev = 48333
 language = R
 version.string = R version 2.9.0 (2009-04-17)

Locale:
C

Search Path:
 .GlobalEnv, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, package:methods, Autoloads, package:base

> sessionInfo()
R version 2.9.0 (2009-04-17) 
x86_64-unknown-linux-gnu 

locale:
C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     
> 

--------------000902010602030404010803--


From rfalke at tzi.de  Mon Dec 14 18:45:15 2009
From: rfalke at tzi.de (rfalke at tzi.de)
Date: Mon, 14 Dec 2009 18:45:15 +0100 (CET)
Subject: [Rd] as.data.frame requires a lot of memory (PR#14140)
Message-ID: <20091214174515.68E8E282EF50@mail.pubhealth.ku.dk>

Full_Name: Raimar Falke
Version: R version 2.10.0 (2009-10-26) 
OS: Linux 2.6.27-16-generic #1 SMP Tue Dec 1 19:26:23 UTC 2009 x86_64 GNU/Linux
Submission from: (NULL) (134.102.222.56)


The construction of a data frame in the way shown below requires
much more memory than expected. If we assume a cell value takes 8 bytes
the total amount of the data is 128mb. However the process takes about 
920mb and not the expected 256mb (two times the data set).

With the real data sets (~35000 observations with ~33000 attributes) the 
conversion to a data frame requires has to be killed at with 60gb of 
memory usage while it should only require 17.6gb (2*8.8gb).

  dfn <- rep(list(rep(0, 4096)), 4096)
  test <- as.data.frame.list(dfn)

I also tried the incremental construction of the 
data-frame: df$colN <- dataForColN. While I currently can't say much 
about the memory usage, it takes a looong time.

After the construction the saved-and-loaded data-frame has the expected size.

What is the recommended way to construct larger data-frames?


From huh420 at dreamwiz.com  Mon Dec 14 21:25:10 2009
From: huh420 at dreamwiz.com (huh420 at dreamwiz.com)
Date: Mon, 14 Dec 2009 21:25:10 +0100 (CET)
Subject: [Rd] New version weighted mean differs from the old one (PR#14142)
Message-ID: <20091214202510.BF0DA282EF29@mail.pubhealth.ku.dk>

Full_Name: Myung-Hoe Huh
Version: 2.10
OS: Windows
Submission from: (NULL) (116.120.84.194)


New Version (2.10.0) weighted mean produces unreasonable result: see below.

     wt <- c(5,  5,  4,  1)/15
     x <- c(3.7,3.3,3.5,2.8)
     x[4] <- NA
     (xm <- weighted.mean(x,wt,na.rm=T))

Outcome is 

>      (xm <- weighted.mean(x,wt,na.rm=T))
[1] 3.266667

The number is obtained by treating x[4] <- 0

I think the old version(2.8.0)'s weighte mean is more reasonable. The old output
was

>      (xm <- weighted.mean(x,wt,na.rm=T))
[1] 3.5

The number si obtained ignoring the x[4], which is NA.


From rmh at temple.edu  Mon Dec 14 22:31:22 2009
From: rmh at temple.edu (RICHARD M. HEIBERGER)
Date: Mon, 14 Dec 2009 16:31:22 -0500
Subject: [Rd] Rd cross-references ... WARNING in R-2.10.*
Message-ID: <c9b79b280912141331gf6169f2ge5550c23f35eb173@mail.gmail.com>

I have observed a difference in behavior of R CMD check in older R vs R-2.10.x
on windows.
* using R version 2.10.0 (2009-10-26)
* using R version 2.10.1 RC (2009-12-14 r50718)

2.10 seems to be looking on the internet for crossreferenced packages.
I am not sure why it is looking.  The string <pkg> is not in any of
the Rd files.  I think it is not finding any CRAN sites because I am
currently behind a firewall.  I have attempted several variations of

R --internet2 CMD check --no-examples --no-latex packagename

and no position that I placed the keyword "--internet2" was valid.


* checking Rd metadata ... OK
* checking Rd cross-references ... WARNING
Warning: unable to access index for repository http://cran.r-project.org/src/con
trib
Warning: unable to access index for repository http://www.omegahat.org/R/src/con
trib
Warning: unable to access index for repository http://www.bioconductor.org/packa
ges/2.5/bioc/src/contrib
Warning: unable to access index for repository http://www.bioconductor.org/packa
ges/2.5/data/annotation/src/contrib
Warning: unable to access index for repository http://www.bioconductor.org/packa
ges/2.5/data/experiment/src/contrib
Unknown package(s) '<pkg>' in Rd xrefs
* checking for missing documentation entries ... WARNING


By comparison

* using R version 2.8.0 (2008-10-20)

* checking Rd cross-references ... OK
* checking for missing documentation entries ... WARNING



If my diagnosis looks correct, can you suggest what is triggering
the search on the internet?  Can you give a more specific warning message?
Is there a way to force internet2 in the R CMD check setting?

Thanks

Rich


From khansen at stat.berkeley.edu  Mon Dec 14 22:42:24 2009
From: khansen at stat.berkeley.edu (Kasper Daniel Hansen)
Date: Mon, 14 Dec 2009 16:42:24 -0500
Subject: [Rd] dumpMethod/getMethod on methods in packages
Message-ID: <4073DF11-9994-4040-B760-99D174A1BE29@stat.berkeley.edu>

There seems to be something wrong with dumpMethod when called on methods defined in packages (possibly with namespaces).  This may be caused by a possible bug in getMethod.

(see below for a full copy/paste without comments)

First
library(Matrix)

Now compare
  dumpMethod("rowSums", "ngCMatrix", file = "")  ## Nothing
to
  getMethod("rowSums", "ngCMatrix")  ## The method definition

Further inspection suggests that it is related to the where argument to dumpMethod, the default being where = topenv(parent.frame()) which evaluates (in this usecase) to .GlobalEnv.  I find it interesting to compare
  findMethod("rowSums", "ngCMatrix", where = .GlobalEnv)  ## Finds the method in the Matrix package
to
  getMethod("rowSums", "ngCMatrix", where = .GlobalEnv)  ## Does not find anything

It seems to me that getMethod is wrong when it does not find anything in the global environment.

Tested in R-2.10-patched (r50736) and R-devel (r50736)

dumpMethod works fine with example(dumpMethod) where a method gets defined in the global environment.  My usecase was trying to dump a method from a namespace I had edited with trace(..., edit = TRUE)

Kasper

All 5 lines for copy and paste:

library(Matrix)
dumpMethod("rowSums", "ngCMatrix", file = "")
getMethod("rowSums", "ngCMatrix")
findMethod("rowSums", "ngCMatrix", where = .GlobalEnv)
getMethod("rowSums", "ngCMatrix", where = .GlobalEnv)


From simon.urbanek at r-project.org  Mon Dec 14 23:01:19 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 14 Dec 2009 17:01:19 -0500
Subject: [Rd] as.data.frame requires a lot of memory (PR#14140)
In-Reply-To: <20091214174515.68E8E282EF50@mail.pubhealth.ku.dk>
References: <20091214174515.68E8E282EF50@mail.pubhealth.ku.dk>
Message-ID: <48EB365A-EC45-4291-B950-D5FEB2C85710@r-project.org>


On Dec 14, 2009, at 12:45 , rfalke at tzi.de wrote:

> Full_Name: Raimar Falke
> Version: R version 2.10.0 (2009-10-26)
> OS: Linux 2.6.27-16-generic #1 SMP Tue Dec 1 19:26:23 UTC 2009  
> x86_64 GNU/Linux
> Submission from: (NULL) (134.102.222.56)
>
>
> The construction of a data frame in the way shown below requires
> much more memory than expected. If we assume a cell value takes 8  
> bytes
> the total amount of the data is 128mb. However the process takes about
> 920mb and not the expected 256mb (two times the data set).
>
> With the real data sets (~35000 observations with ~33000 attributes)  
> the
> conversion to a data frame requires has to be killed at with 60gb of
> memory usage while it should only require 17.6gb (2*8.8gb).
>
>  dfn <- rep(list(rep(0, 4096)), 4096)
>  test <- as.data.frame.list(dfn)
>
> I also tried the incremental construction of the
> data-frame: df$colN <- dataForColN. While I currently can't say much
> about the memory usage, it takes a looong time.
>
> After the construction the saved-and-loaded data-frame has the  
> expected size.
>
> What is the recommended way to construct larger data-frames?
>

Please use R-help for questions, and not the bug tracking system!



There are few issues with your example - mainly because is has no row  
names and no column names so R will try to create them from the  
expression which is inherently slow and memory-consuming. So first,  
make sure you set the names on the list, e.g.:

names(dfn) <- paste("V",seq.int(length(dfn)),sep='')

That will reduce the overhead due to column names. Then what  
as.data.frame does is to simply call data.frame on the elements of the  
list. That ensures that all is right, but if you know for sure that  
your list is valid (correct lengths, valid names, no need for row  
names etc.) then you can simply assert that it is a data frame:

class(dfn)<-"data.frame"
row.names(dfn)<-NULL

You'll still need double the memory because the object needs to be  
copied for the attribute modifications, but that's as low as it get --  
although in your exact example there is an even more efficient way:

dfn <- rep(data.frame(X=rep(0, 4096)), 4096)
dfn <- do.call("cbind", dfn)

it uses only a fraction more memory than the size of the entire  
object, but that's for entirely different reasons :). No, it's not  
good in general :P

Cheers,
Simon


From cberry at tajo.ucsd.edu  Mon Dec 14 23:08:12 2009
From: cberry at tajo.ucsd.edu (Charles C. Berry)
Date: Mon, 14 Dec 2009 14:08:12 -0800
Subject: [Rd] New version weighted mean differs from the old one
	(PR#14142)
In-Reply-To: <20091214202510.BF0DA282EF29@mail.pubhealth.ku.dk>
References: <20091214202510.BF0DA282EF29@mail.pubhealth.ku.dk>
Message-ID: <Pine.LNX.4.64.0912141407220.5999@tajo.ucsd.edu>



This was PR#14032. Fixed in R.10.1.


On Mon, 14 Dec 2009, huh420 at dreamwiz.com wrote:

> Full_Name: Myung-Hoe Huh
> Version: 2.10
> OS: Windows
> Submission from: (NULL) (116.120.84.194)
>
>
> New Version (2.10.0) weighted mean produces unreasonable result: see below.
>
>     wt <- c(5,  5,  4,  1)/15
>     x <- c(3.7,3.3,3.5,2.8)
>     x[4] <- NA
>     (xm <- weighted.mean(x,wt,na.rm=T))
>
> Outcome is
>
>>      (xm <- weighted.mean(x,wt,na.rm=T))
> [1] 3.266667
>
> The number is obtained by treating x[4] <- 0
>
> I think the old version(2.8.0)'s weighte mean is more reasonable. The old output
> was
>
>>      (xm <- weighted.mean(x,wt,na.rm=T))
> [1] 3.5
>
> The number si obtained ignoring the x[4], which is NA.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Charles C. Berry                            (858) 534-2098
                                             Dept of Family/Preventive Medicine
E mailto:cberry at tajo.ucsd.edu	            UC San Diego
http://famprevmed.ucsd.edu/faculty/cberry/  La Jolla, San Diego 92093-0901


From savicky at cs.cas.cz  Mon Dec 14 23:10:00 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Mon, 14 Dec 2009 23:10:00 +0100
Subject: [Rd] Accuracy (PR#14139)
In-Reply-To: <20091214171016.A1722282EF50@mail.pubhealth.ku.dk>
References: <20091214171016.A1722282EF50@mail.pubhealth.ku.dk>
Message-ID: <20091214221000.GC6020@cs.cas.cz>

On Mon, Dec 14, 2009 at 06:10:16PM +0100, bersch at lycos.com wrote:
> 
> > pnorm(1.35,0,1)
> [1] 0.911492
> > pnorm(1.36,0,1)
> [1] 0.913085
> 
> > options(digits=4)
> 
> > pnorm(1.35,0,1)
> [1] 0.9115
> > pnorm(1.36,0,1)
> [1] 0.913          rounding error?

The technical explanation is as follows. If options(digits=k) is set,
then the number of significant digits for printing a single number x is 
determined as min(k, d), where d is the minimum number of digits,
for which the relative error of the printed number is less than 10^-k.

If we have
  x <- 0.913085
  y <- 0.913
then the relative error of y as an approximation of x is
  abs(y - x)/x # [1] 9.3091e-05
Since this is less than 10^-4, the 3 digit precision is chosen
for printing x.

A safer way of rounding is to use functions round() and signif().
For example,
  round(x, digits=4) # [1] 0.9131

I do not know the history of the R printing algorithm. It is designed
primarily for printing vectors, where the rules are more complicated
to achieve a good unified format for all numbers. May be, someone else
can say more about it. The above analysis may be obtained by inspecting
the R source code.

Petr Savicky.


From savicky at cs.cas.cz  Mon Dec 14 23:11:24 2009
From: savicky at cs.cas.cz (savicky at cs.cas.cz)
Date: Mon, 14 Dec 2009 23:11:24 +0100 (CET)
Subject: [Rd] Accuracy (PR#14139)
Message-ID: <20091214221124.11559282EF55@mail.pubhealth.ku.dk>

On Mon, Dec 14, 2009 at 06:10:16PM +0100, bersch at lycos.com wrote:
> 
> > pnorm(1.35,0,1)
> [1] 0.911492
> > pnorm(1.36,0,1)
> [1] 0.913085
> 
> > options(digits=4)
> 
> > pnorm(1.35,0,1)
> [1] 0.9115
> > pnorm(1.36,0,1)
> [1] 0.913          rounding error?

The technical explanation is as follows. If options(digits=k) is set,
then the number of significant digits for printing a single number x is 
determined as min(k, d), where d is the minimum number of digits,
for which the relative error of the printed number is less than 10^-k.

If we have
  x <- 0.913085
  y <- 0.913
then the relative error of y as an approximation of x is
  abs(y - x)/x # [1] 9.3091e-05
Since this is less than 10^-4, the 3 digit precision is chosen
for printing x.

A safer way of rounding is to use functions round() and signif().
For example,
  round(x, digits=4) # [1] 0.9131

I do not know the history of the R printing algorithm. It is designed
primarily for printing vectors, where the rules are more complicated
to achieve a good unified format for all numbers. May be, someone else
can say more about it. The above analysis may be obtained by inspecting
the R source code.

Petr Savicky.


From romain.francois at dbmail.com  Tue Dec 15 08:36:46 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Tue, 15 Dec 2009 08:36:46 +0100
Subject: [Rd] S4 dispatch and S3 "connection" objects
Message-ID: <4B273C8E.9090802@dbmail.com>

Hello,

I'm trying to get S4 dispatch on S3 "connection" objects.

So I do :

setOldClass( "connection" )

and then :

setGeneric( "bling", function(object) standardGeneric( "bling" ) )
setMethod( "bling", "connection", function(object) cat( "gotcha ", 
as.integer(object), "\n" ) )

but I get :

f <- file( "blabla", open = "rb" )

 > bling( f )
Error in function (classes, fdef, mtable)  :
   unable to find an inherited method for function "bling", for 
signature "file"
 > class( f )
[1] "file"       "connection"


Am I supposed to do :

setOldClass( c("file", "connection" ) )
setOldClass( c("url", "connection" ) )

and so on for each potential S3 class, or is there another way.

Romain

-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/HlX9 : new package : bibtex
|- http://tr.im/Gq7i : ohloh
`- http://tr.im/FtUu : new package : highlight


From maechler at stat.math.ethz.ch  Tue Dec 15 09:49:28 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 15 Dec 2009 09:49:28 +0100
Subject: [Rd] RFC: lchoose() vs lfactorial() etc
Message-ID: <19239.19864.396771.484772@lynne.math.ethz.ch>

lgamma(x) and lfactorial(x) are defined to return

 ln|Gamma(x)| {= log(abs(gamma(x)))} or  ln|Gamma(x+1)| respectively.

Unfortunately,  we haven't chosen the analogous definition for 
lchoose().

So, currently 

  > lchoose(1/2, 1:10)
   [1] -0.6931472 -2.0794415        NaN -3.2425924        NaN -3.8869494
   [7]        NaN -4.3357508        NaN -4.6805913
  Warning message:
  In lchoose(n, k) : NaNs produced
  > 

which (the NaN's) is not particularly useful.
(I have use case where I really have to workaround those NaNs.)

I herebey propose to *amend* the definition of lchoose() such
that it behaves analogously to  lgamma() and lfactorial(),
i.e., to return

   log(abs(choose(.,.))

Your comments are welcome.
Martin Maechler, ETH Zurich


From romain.francois at dbmail.com  Tue Dec 15 10:06:22 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Tue, 15 Dec 2009 10:06:22 +0100
Subject: [Rd] split.data.frame
Message-ID: <4B27518E.6030209@dbmail.com>

Hello,

I very much enjoy "with" and "subset" semantics for data frames and was 
wondering if we could have something similar with split, basically by 
evaluating the second argument "with" the data frame :

split.data.frame
function(x, f, drop = FALSE, ...){
         call <- match.call( )
         fcall <- call( "with", data = call[["x"]], expr = call[["f"]] )
         ff <- eval( fcall, parent.frame(1) )

         lapply(split(seq_len(nrow(x)), ff, drop = drop, ...), 
function(ind) x[ind, , drop = FALSE])
}


 > split( df, y )
$`1`
   x y
1 1 1
2 2 1
3 3 1
4 4 1
5 5 1

$`2`
     x y
6   6 2
7   7 2
8   8 2
9   9 2
10 10 2

 > split( df, x > 3 )
$`FALSE`
   x y
1 1 1
2 2 1
3 3 1

$`TRUE`
     x y
4   4 1
5   5 1
6   6 2
7   7 2
8   8 2
9   9 2
10 10 2


Romain

-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/HlX9 : new package : bibtex
|- http://tr.im/Gq7i : ohloh
`- http://tr.im/FtUu : new package : highlight


From rksh1 at cam.ac.uk  Tue Dec 15 10:20:56 2009
From: rksh1 at cam.ac.uk (Robin Hankin)
Date: Tue, 15 Dec 2009 09:20:56 +0000
Subject: [Rd] RFC: lchoose() vs lfactorial() etc
In-Reply-To: <19239.19864.396771.484772@lynne.math.ethz.ch>
References: <19239.19864.396771.484772@lynne.math.ethz.ch>
Message-ID: <4B2754F8.9010701@cam.ac.uk>

Hi Martin

I think you're absolutely right about this;
One thing I need again and again is
a multinomial function, and usually define:

 > lmultinomial
function (x)
{
    lfactorial(sum(x)) - sum(lfactorial(x))
}

 > multinomial
function (x)
{
    exp(lmultinomial(x))
}


It would be nice to have this in base R.

Is this the place to discuss having complex
arguments for gamma()?


best wishes

rksh






Martin Maechler wrote:
> lgamma(x) and lfactorial(x) are defined to return
>
>  ln|Gamma(x)| {= log(abs(gamma(x)))} or  ln|Gamma(x+1)| respectively.
>
> Unfortunately,  we haven't chosen the analogous definition for 
> lchoose().
>
> So, currently 
>
>   > lchoose(1/2, 1:10)
>    [1] -0.6931472 -2.0794415        NaN -3.2425924        NaN -3.8869494
>    [7]        NaN -4.3357508        NaN -4.6805913
>   Warning message:
>   In lchoose(n, k) : NaNs produced
>   > 
>
> which (the NaN's) is not particularly useful.
> (I have use case where I really have to workaround those NaNs.)
>
> I herebey propose to *amend* the definition of lchoose() such
> that it behaves analogously to  lgamma() and lfactorial(),
> i.e., to return
>
>    log(abs(choose(.,.))
>
> Your comments are welcome.
> Martin Maechler, ETH Zurich
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   


-- 
Robin K. S. Hankin
Uncertainty Analyst
University of Cambridge
19 Silver Street
Cambridge CB3 9EP
01223-764877


From savicky at cs.cas.cz  Tue Dec 15 10:52:43 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Tue, 15 Dec 2009 10:52:43 +0100
Subject: [Rd] RFC: lchoose() vs lfactorial() etc
In-Reply-To: <19239.19864.396771.484772@lynne.math.ethz.ch>
References: <19239.19864.396771.484772@lynne.math.ethz.ch>
Message-ID: <20091215095243.GA14388@cs.cas.cz>

On Tue, Dec 15, 2009 at 09:49:28AM +0100, Martin Maechler wrote:
> lgamma(x) and lfactorial(x) are defined to return
> 
>  ln|Gamma(x)| {= log(abs(gamma(x)))} or  ln|Gamma(x+1)| respectively.
> 
> Unfortunately,  we haven't chosen the analogous definition for 
> lchoose().
> 
> So, currently 
> 
>   > lchoose(1/2, 1:10)
>    [1] -0.6931472 -2.0794415        NaN -3.2425924        NaN -3.8869494
>    [7]        NaN -4.3357508        NaN -4.6805913
>   Warning message:
>   In lchoose(n, k) : NaNs produced
>   > 
> 
> which (the NaN's) is not particularly useful.
> (I have use case where I really have to workaround those NaNs.)
> 
> I herebey propose to *amend* the definition of lchoose() such
> that it behaves analogously to  lgamma() and lfactorial(),
> i.e., to return
> 
>    log(abs(choose(.,.))
> 
> Your comments are welcome.
> Martin Maechler, ETH Zurich

I do not have a strong opinion, whether lchoose() should be log(choose(.,.))
or log(abs(choose(.,.))), although i would slightly prefere the latter (with abs()).
One of the reasons is that this would simplify the code of the function
lchoose() in src/nmath/choose.c. It produces the NA by explicit testing
the sign, so this test could be simply removed.

Let me also point out that the current implementation seems to contain
a bug, which causes that it is neither log(choose(.,.)) nor log(abs(choose(.,.))).

  x <- choose(1/2, 1:10)
  y <- lchoose(1/2, 1:10)
  cbind(choose=x, lchoose=y, log.choose=log(abs(x)))
            choose    lchoose log.choose
  #  [1,]  0.500000000 -0.6931472 -0.6931472
  #  [2,] -0.125000000 -2.0794415 -2.0794415
  #  [3,]  0.062500000        NaN -2.7725887
  #  [4,] -0.039062500 -3.2425924 -3.2425924
  #  [5,]  0.027343750        NaN -3.5992673
  #  [6,] -0.020507812 -3.8869494 -3.8869494
  #  [7,]  0.016113281        NaN -4.1281114
  #  [8,] -0.013092041 -4.3357508 -4.3357508
  #  [9,]  0.010910034        NaN -4.5180723
  # [10,] -0.009273529 -4.6805913 -4.6805913

So, besides x[1], we get NA for those cases, when choose() is positive.
The reason seems to be the test at line 89 of src/nmath/choose.c, which is

    if (fmod(floor(n-k+1), 2.) == 0) /* choose() < 0 */
        return ML_NAN;

but it should be negated. I tested it using

    if (fmod(floor(n-k+1), 2.) != 0) /* choose() < 0 */
        return ML_NAN;

when we get

            choose    lchoose log.choose
   [1,]  0.500000000 -0.6931472 -0.6931472
   [2,] -0.125000000        NaN -2.0794415
   [3,]  0.062500000 -2.7725887 -2.7725887
   [4,] -0.039062500        NaN -3.2425924
   [5,]  0.027343750 -3.5992673 -3.5992673
   [6,] -0.020507812        NaN -3.8869494
   [7,]  0.016113281 -4.1281114 -4.1281114
   [8,] -0.013092041        NaN -4.3357508
   [9,]  0.010910034 -4.5180723 -4.5180723
  [10,] -0.009273529        NaN -4.6805913

Petr Savicky.


From martin.becker at mx.uni-saarland.de  Tue Dec 15 11:07:26 2009
From: martin.becker at mx.uni-saarland.de (Martin Becker)
Date: Tue, 15 Dec 2009 11:07:26 +0100
Subject: [Rd] RFC: lchoose() vs lfactorial() etc
In-Reply-To: <4B2754F8.9010701@cam.ac.uk>
References: <19239.19864.396771.484772@lynne.math.ethz.ch>
	<4B2754F8.9010701@cam.ac.uk>
Message-ID: <4B275FDE.7090409@mx.uni-saarland.de>

Robin Hankin wrote:
> ...
> Is this the place to discuss having complex
> arguments for gamma()?
> ...
If this discussion starts I would second the wish for the functionality 
of gsl's lngamma_complex in base R.

Best wishes

  Martin

-- 
Dr. Martin Becker
Statistics and Econometrics
Saarland University
Campus C3 1, Room 206
66123 Saarbruecken
Germany


From rksh1 at cam.ac.uk  Tue Dec 15 12:06:26 2009
From: rksh1 at cam.ac.uk (Robin Hankin)
Date: Tue, 15 Dec 2009 11:06:26 +0000
Subject: [Rd] RFC: lchoose() vs lfactorial() etc
In-Reply-To: <4B275FDE.7090409@mx.uni-saarland.de>
References: <19239.19864.396771.484772@lynne.math.ethz.ch>
	<4B2754F8.9010701@cam.ac.uk> <4B275FDE.7090409@mx.uni-saarland.de>
Message-ID: <4B276DB2.9020509@cam.ac.uk>


Martin Becker wrote:
> Robin Hankin wrote:
>> ...
>> Is this the place to discuss having complex
>> arguments for gamma()?
>> ...
> If this discussion starts I would second the wish for the 
> functionality of gsl's lngamma_complex in base R.
>
>

Do you mean gsl or GSL? ;-)

[the GNU scientific library is 'GSL'; the R package is 'gsl']

There are a few functions in gsl that don't take  complex  arguments,
such as airy_Ai() and airy_Bi(),  but for me the top priority would
be the incomplete gamma function.

best wishes

rksh





-- 
Robin K. S. Hankin
Uncertainty Analyst
University of Cambridge
19 Silver Street
Cambridge CB3 9EP
01223-764877


From maechler at stat.math.ethz.ch  Tue Dec 15 14:54:18 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 15 Dec 2009 14:54:18 +0100
Subject: [Rd] RFC: lchoose() vs lfactorial() etc
In-Reply-To: <20091215095243.GA14388@cs.cas.cz>
References: <19239.19864.396771.484772@lynne.math.ethz.ch>
	<20091215095243.GA14388@cs.cas.cz>
Message-ID: <19239.38154.219034.206322@lynne.math.ethz.ch>

>>>>> "PS" == Petr Savicky <savicky at cs.cas.cz>
>>>>>     on Tue, 15 Dec 2009 10:52:43 +0100 writes:

    PS> On Tue, Dec 15, 2009 at 09:49:28AM +0100, Martin Maechler wrote:
    >> lgamma(x) and lfactorial(x) are defined to return
    >> 
    >> ln|Gamma(x)| {= log(abs(gamma(x)))} or  ln|Gamma(x+1)| respectively.
    >> 
    >> Unfortunately,  we haven't chosen the analogous definition for 
    >> lchoose().
    >> 
    >> So, currently 
    >> 
    >> > lchoose(1/2, 1:10)
    >> [1] -0.6931472 -2.0794415        NaN -3.2425924        NaN -3.8869494
    >> [7]        NaN -4.3357508        NaN -4.6805913
    >> Warning message:
    >> In lchoose(n, k) : NaNs produced
    >> > 
    >> 
    >> which (the NaN's) is not particularly useful.
    >> (I have use case where I really have to workaround those NaNs.)
    >> 
    >> I herebey propose to *amend* the definition of lchoose() such
    >> that it behaves analogously to  lgamma() and lfactorial(),
    >> i.e., to return
    >> 
    >> log(abs(choose(.,.))
    >> 
    >> Your comments are welcome.
    >> Martin Maechler, ETH Zurich

    PS> I do not have a strong opinion, whether lchoose() should be log(choose(.,.))
    PS> or log(abs(choose(.,.))), although i would slightly prefere the latter (with abs()).
    PS> One of the reasons is that this would simplify the code of the function
    PS> lchoose() in src/nmath/choose.c. It produces the NA by explicit testing
    PS> the sign, so this test could be simply removed.

    PS> Let me also point out that the current implementation seems to contain
    PS> a bug, which causes that it is neither log(choose(.,.)) nor log(abs(choose(.,.))).

    PS> x <- choose(1/2, 1:10)
    PS> y <- lchoose(1/2, 1:10)
    PS> cbind(choose=x, lchoose=y, log.choose=log(abs(x)))
    PS> choose    lchoose log.choose
    PS> #  [1,]  0.500000000 -0.6931472 -0.6931472
    PS> #  [2,] -0.125000000 -2.0794415 -2.0794415
    PS> #  [3,]  0.062500000        NaN -2.7725887
    PS> #  [4,] -0.039062500 -3.2425924 -3.2425924
    PS> #  [5,]  0.027343750        NaN -3.5992673
    PS> #  [6,] -0.020507812 -3.8869494 -3.8869494
    PS> #  [7,]  0.016113281        NaN -4.1281114
    PS> #  [8,] -0.013092041 -4.3357508 -4.3357508
    PS> #  [9,]  0.010910034        NaN -4.5180723
    PS> # [10,] -0.009273529 -4.6805913 -4.6805913

    PS> So, besides x[1], we get NA for those cases, when choose() is positive.
    PS> The reason seems to be the test at line 89 of src/nmath/choose.c, which is

    PS> if (fmod(floor(n-k+1), 2.) == 0) /* choose() < 0 */
    PS> return ML_NAN;

    PS> but it should be negated. I tested it using

    PS> if (fmod(floor(n-k+1), 2.) != 0) /* choose() < 0 */
    PS> return ML_NAN;

Indeed !!! 
Pretty  "interesting" that this thinko has not been detected for
quite a few years....

This, of course, is an even more compelling reason to implement
the change of return  log(abs(choose(.,.)),
and at the moment, I'd even plan to "backport" that to R "2.10.1
patched", as the current behavior is clearly bugous.

Thank you, Petr!
Martin


From g.russell at eos-solutions.com  Tue Dec 15 11:15:20 2009
From: g.russell at eos-solutions.com (g.russell at eos-solutions.com)
Date: Tue, 15 Dec 2009 11:15:20 +0100 (CET)
Subject: [Rd] Antwort: Re: R on Windows crashes when using certain (PR#14143)
Message-ID: <20091215101520.BCD3D282EFC5@mail.pubhealth.ku.dk>

The new version of R-devel from yesterday morning seems to have fixed bug=20
14114! Thanks a lot for your help.

Duncan Murdoch <murdoch at stats.uwo.ca> schrieb am 14.12.2009 13:34:35:

> On 10/12/2009 4:20 AM, karl at huftis.org wrote:
> > Full=5FName: Karl Ove Hufthammer
> > Version: 2.10.0
> > OS: Windows XP
> > Submission from: (NULL) (93.124.134.66)
> >=20
> >=20
> > I have found a rather strange bug in R 2.10.0 on Windows, where=20
> the choice of
> > characters used in a string make R crash (i.e., Windows shows a=20
> dialogue saying
> > that the application has a problem, and must be closed).
>=20
> This was related to encoding changes.  It likely appeared=20
> Windows-specific because Windows uses a different default encoding than=20
> most Linux systems.  I believe it is fixed now in R-devel, and it will=20
> soon make it into 2.10.1-patched, but it came too late to make it into=20
> today's release.
>=20
> I believe PR#14114 was the same issue and is also fixed, but I did less=20
> testing of it.  I'd appreciate it if those who saw either bug in real=20
> code test the patches.  They should be in today's tarball of R-devel,=20
> and did make it into the Windows binary build of R-devel this morning.
>=20
> Duncan
>=20
> >=20
> > I can reproduce the bug on two separate systems running Windows XP,=20
and with
> > both R 2.10.0 and the latest R.2.10.1 RC.
> >=20
> > The following commands trigger the crash for me:
> >=20
> > n=3D1e5
> > k=3D10
> > x=3Dsample(k,n,replace=3DTRUE)
> > y=3Dsample(k,n,replace=3DTRUE)
> > xy=3Dpaste(x,y,sep=3D" =D7 ")
> > z=3Dsample(n)
> > d=3Ddata.frame(xy,z)
> >=20
> > The last step takes very long time, and R crashes before it's=20
finished. Note
> > that if I reduce n, the problem disappears. Also, if I change the =D7 (a
> > multiplication symbol) to a x (a letter), the problem also=20
> disappears (and the
> > last command takes almost no time to run).
> >=20
> > I originally discovered this (or a related?) bug while using=20
> 'unique' on a data
> > frame similar to the 'd' data frame defined above, where R would=20
> often, but not
> > always, crash.=20
> >=20
> >> sessionInfo()
> > R version 2.10.0 (2009-10-26)=20
> > i386-pc-mingw32=20
> >=20
> > locale:
> > [1] LC=5FCOLLATE=3DNorwegian-Nynorsk=5FNorway.1252=20
> > [2] LC=5FCTYPE=3DNorwegian-Nynorsk=5FNorway.1252=20
> > [3] LC=5FMONETARY=3DNorwegian-Nynorsk=5FNorway.1252
> > [4] LC=5FNUMERIC=3DC=20
> > [5] LC=5FTIME=3DNorwegian-Nynorsk=5FNorway.1252=20
> >=20
> > attached base packages:
> > [1] stats     graphics  grDevices utils     datasets  methods   base
> >=20
> > =5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=
=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
>=20


From lawrence.michael at gene.com  Tue Dec 15 15:34:43 2009
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Tue, 15 Dec 2009 06:34:43 -0800
Subject: [Rd] S4 dispatch and S3 "connection" objects
In-Reply-To: <4B273C8E.9090802@dbmail.com>
References: <4B273C8E.9090802@dbmail.com>
Message-ID: <acbd1aed0912150634v7695318ch8abaf9732efcd771@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091215/3cc70be5/attachment.pl>

From bolker at ufl.edu  Tue Dec 15 16:57:05 2009
From: bolker at ufl.edu (Ben Bolker)
Date: Tue, 15 Dec 2009 10:57:05 -0500
Subject: [Rd] silly SVN question
Message-ID: <4B27B1D1.1060006@ufl.edu>


  I followed the suggestions at
http://developer.r-project.org/SVNtips.html to check out an anonymous
copy of the development branch of R, but so far I have been unable to
figure out an analogous way to track the development branch of the
recommended packages. (I'm assuming they actually live somewhere on the
same SVN server, which might not be true ...) Any ideas (including
pointing out the obvious, or the obvious-in-hindsight)?

  thanks
    Ben Bolker


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 261 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091215/b3bf5f72/attachment.bin>

From khansen at stat.berkeley.edu  Tue Dec 15 17:07:41 2009
From: khansen at stat.berkeley.edu (Kasper Daniel Hansen)
Date: Tue, 15 Dec 2009 11:07:41 -0500
Subject: [Rd] silly SVN question
In-Reply-To: <4B27B1D1.1060006@ufl.edu>
References: <4B27B1D1.1060006@ufl.edu>
Message-ID: <EDFDA701-90FA-4EFB-905F-729389C79E23@stat.berkeley.edu>

The obvious: the recommended packages are inside
  src/library

Kasper

On Dec 15, 2009, at 10:57 AM, Ben Bolker wrote:

> 
>  I followed the suggestions at
> http://developer.r-project.org/SVNtips.html to check out an anonymous
> copy of the development branch of R, but so far I have been unable to
> figure out an analogous way to track the development branch of the
> recommended packages. (I'm assuming they actually live somewhere on the
> same SVN server, which might not be true ...) Any ideas (including
> pointing out the obvious, or the obvious-in-hindsight)?
> 
>  thanks
>    Ben Bolker
> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Tue Dec 15 17:09:32 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 15 Dec 2009 16:09:32 +0000 (GMT)
Subject: [Rd] Antwort: Re: R on Windows crashes when using certain
In-Reply-To: <20091215101520.BCD3D282EFC5@mail.pubhealth.ku.dk>
References: <20091215101520.BCD3D282EFC5@mail.pubhealth.ku.dk>
Message-ID: <alpine.OSX.1.00.0912151523410.67462@tystie.local>

A few comments, though (I've been offline through much of this, 
and away from a Windows machine for almost all).

1) You could have narrowed down the cause by saving and restarting the 
session.  In particular it would have shown that the issue was not in 
sub() as you reported, since saving the object after the sub() call 
and starting a new session caused the problem in the second session.

2) Using gctorture() makes such things happen on much smaller problems 
and more reliably (if no faster).  (The underlying cause was more than 
one missing PROTECT.)

3) The difference between fixed=TRUE (which you should have used in 
the first place) and the extended and PCRE versions is often in 2.10.x 
in the encoding of the result: use Encoding() to find out.  Not only 
is fixed = TRUE much faster, it avoids repeated re-encodings.

4) Using UTF-8 encoded strings in a non-UTF-8 locale (and in 
particular on Windows) is a convenience but has performance 
implications.  Unless you need text not representable in the current 
locale, convert your strings to the current charset.  If you are using 
non-ASCII text and an 8-bit locale (e.g. CP1252 on Windows) then 
regexp computations will work somewhat faster in R-devel since they 
are performed in bytes (whereas 2.10.x uses wchar_t and for [g]sub 
returns the result in UTF-8).

5) These reports show yet again that people are not doing enough to 
help in the alpha/beta testing period of 2.x.0.  The R developers are 
almost exclusively using ASCII data or UTF-8 locales, so people doing 
extensive text processing in other locales please do take note of 
requests to test new versions of R.


On Tue, 15 Dec 2009, g.russell at eos-solutions.com wrote:

> The new version of R-devel from yesterday morning seems to have fixed bug=20
> 14114! Thanks a lot for your help.
>
> Duncan Murdoch <murdoch at stats.uwo.ca> schrieb am 14.12.2009 13:34:35:
>
>> On 10/12/2009 4:20 AM, karl at huftis.org wrote:
>>> Full=5FName: Karl Ove Hufthammer
>>> Version: 2.10.0
>>> OS: Windows XP
>>> Submission from: (NULL) (93.124.134.66)
>>> =20
>>> =20
>>> I have found a rather strange bug in R 2.10.0 on Windows, where=20
>> the choice of
>>> characters used in a string make R crash (i.e., Windows shows a=20
>> dialogue saying
>>> that the application has a problem, and must be closed).
>> =20
>> This was related to encoding changes.  It likely appeared=20
>> Windows-specific because Windows uses a different default encoding than=20
>> most Linux systems.  I believe it is fixed now in R-devel, and it will=20
>> soon make it into 2.10.1-patched, but it came too late to make it into=20
>> today's release.
>> =20
>> I believe PR#14114 was the same issue and is also fixed, but I did less=20
>> testing of it.  I'd appreciate it if those who saw either bug in real=20
>> code test the patches.  They should be in today's tarball of R-devel,=20
>> and did make it into the Windows binary build of R-devel this morning.
>> =20
>> Duncan
>> =20
>>> =20
>>> I can reproduce the bug on two separate systems running Windows XP,=20
> and with
>>> both R 2.10.0 and the latest R.2.10.1 RC.
>>> =20
>>> The following commands trigger the crash for me:
>>> =20
>>> n=3D1e5
>>> k=3D10
>>> x=3Dsample(k,n,replace=3DTRUE)
>>> y=3Dsample(k,n,replace=3DTRUE)
>>> xy=3Dpaste(x,y,sep=3D" =D7 ")
>>> z=3Dsample(n)
>>> d=3Ddata.frame(xy,z)
>>> =20
>>> The last step takes very long time, and R crashes before it's=20
> finished. Note
>>> that if I reduce n, the problem disappears. Also, if I change the =D7 (a
>>> multiplication symbol) to a x (a letter), the problem also=20
>> disappears (and the
>>> last command takes almost no time to run).
>>> =20
>>> I originally discovered this (or a related?) bug while using=20
>> 'unique' on a data
>>> frame similar to the 'd' data frame defined above, where R would=20
>> often, but not
>>> always, crash.=20
>>> =20
>>>> sessionInfo()
>>> R version 2.10.0 (2009-10-26)=20
>>> i386-pc-mingw32=20
>>> =20
>>> locale:
>>> [1] LC=5FCOLLATE=3DNorwegian-Nynorsk=5FNorway.1252=20
>>> [2] LC=5FCTYPE=3DNorwegian-Nynorsk=5FNorway.1252=20
>>> [3] LC=5FMONETARY=3DNorwegian-Nynorsk=5FNorway.1252
>>> [4] LC=5FNUMERIC=3DC=20
>>> [5] LC=5FTIME=3DNorwegian-Nynorsk=5FNorway.1252=20
>>> =20
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>> =20
>>> =5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=
> =5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> =20
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bolker at ufl.edu  Tue Dec 15 17:14:32 2009
From: bolker at ufl.edu (Ben Bolker)
Date: Tue, 15 Dec 2009 11:14:32 -0500
Subject: [Rd] silly SVN question
In-Reply-To: <EDFDA701-90FA-4EFB-905F-729389C79E23@stat.berkeley.edu>
References: <4B27B1D1.1060006@ufl.edu>
	<EDFDA701-90FA-4EFB-905F-729389C79E23@stat.berkeley.edu>
Message-ID: <4B27B5E8.7030805@ufl.edu>


  Yes, but ... on my system at least the Recommended folder has a recent
version of the Makefile, but the packages are old tarballs.  I have a
fuzzy memory that I needed to download the packages from somewhere else
to build a complete/up-to-date version, but I have forgotten where I
read that.  And
https://svn.r-project.org/R/trunk/src/library/Recommended/ shows that
only Makefile.in and Makefile.win live here.

  Does your  src/library/Recommended have up-to-date source code for all
the packages ... ?

 cheers
   Ben

Kasper Daniel Hansen wrote:
> The obvious: the recommended packages are inside
>   src/library
> 
> Kasper
> 
> On Dec 15, 2009, at 10:57 AM, Ben Bolker wrote:
> 
>>  I followed the suggestions at
>> http://developer.r-project.org/SVNtips.html to check out an anonymous
>> copy of the development branch of R, but so far I have been unable to
>> figure out an analogous way to track the development branch of the
>> recommended packages. (I'm assuming they actually live somewhere on the
>> same SVN server, which might not be true ...) Any ideas (including
>> pointing out the obvious, or the obvious-in-hindsight)?
>>
>>  thanks
>>    Ben Bolker
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


-- 
Ben Bolker
Associate professor, Biology Dep't, Univ. of Florida
bolker at ufl.edu / people.biology.ufl.edu/bolker
GPG key: people.biology.ufl.edu/bolker/benbolker-publickey.asc

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 261 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091215/087b06eb/attachment.bin>

From ripley at stats.ox.ac.uk  Tue Dec 15 17:17:02 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 15 Dec 2009 16:17:02 +0000 (GMT)
Subject: [Rd] silly SVN question
In-Reply-To: <4B27B1D1.1060006@ufl.edu>
References: <4B27B1D1.1060006@ufl.edu>
Message-ID: <alpine.OSX.1.00.0912151609510.67555@tystie.local>

On Tue, 15 Dec 2009, Ben Bolker wrote:

>
>  I followed the suggestions at
> http://developer.r-project.org/SVNtips.html to check out an anonymous
> copy of the development branch of R, but so far I have been unable to
> figure out an analogous way to track the development branch of the
> recommended packages. (I'm assuming they actually live somewhere on the
> same SVN server, which might not be true ...) Any ideas (including
> pointing out the obvious, or the obvious-in-hindsight)?

https://svn.r-project.org/R-packages/trunk

but

- not all of the recommended packages are there.
- Matrix and survival have migrated to R-forge
- in some cases what is on the svn archive has lagged the release
   version.

It is most useful for the packages maintained by R-core collectively.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bolker at ufl.edu  Tue Dec 15 17:18:01 2009
From: bolker at ufl.edu (Ben Bolker)
Date: Tue, 15 Dec 2009 11:18:01 -0500
Subject: [Rd] silly SVN question
In-Reply-To: <alpine.OSX.1.00.0912151609510.67555@tystie.local>
References: <4B27B1D1.1060006@ufl.edu>
	<alpine.OSX.1.00.0912151609510.67555@tystie.local>
Message-ID: <4B27B6B9.4050207@ufl.edu>

  thanks!

Prof Brian Ripley wrote:
> On Tue, 15 Dec 2009, Ben Bolker wrote:
> 
>>  I followed the suggestions at
>> http://developer.r-project.org/SVNtips.html to check out an anonymous
>> copy of the development branch of R, but so far I have been unable to
>> figure out an analogous way to track the development branch of the
>> recommended packages. (I'm assuming they actually live somewhere on the
>> same SVN server, which might not be true ...) Any ideas (including
>> pointing out the obvious, or the obvious-in-hindsight)?
> 
> https://svn.r-project.org/R-packages/trunk
> 
> but
> 
> - not all of the recommended packages are there.
> - Matrix and survival have migrated to R-forge
> - in some cases what is on the svn archive has lagged the release
>    version.
> 
> It is most useful for the packages maintained by R-core collectively.
> 


-- 
Ben Bolker
Associate professor, Biology Dep't, Univ. of Florida
bolker at ufl.edu / people.biology.ufl.edu/bolker
GPG key: people.biology.ufl.edu/bolker/benbolker-publickey.asc

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 261 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091215/75e0957e/attachment.bin>

From romain.francois at dbmail.com  Tue Dec 15 17:19:33 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Tue, 15 Dec 2009 17:19:33 +0100
Subject: [Rd] silly SVN question
In-Reply-To: <4B27B5E8.7030805@ufl.edu>
References: <4B27B1D1.1060006@ufl.edu>	<EDFDA701-90FA-4EFB-905F-729389C79E23@stat.berkeley.edu>
	<4B27B5E8.7030805@ufl.edu>
Message-ID: <4B27B715.1050001@dbmail.com>

Maybe you are looking for ./tools/rsync-recommended

I think only the base set of packages (lower priority than recommended) 
are in src/library.

 > packageDescription( "utils" )[["Priority"]]
[1] "base"
 > packageDescription( "Matrix" )[["Priority"]]
[1] "recommended"

Romain

On 12/15/2009 05:14 PM, Ben Bolker wrote:
>
>    Yes, but ... on my system at least the Recommended folder has a recent
> version of the Makefile, but the packages are old tarballs.  I have a
> fuzzy memory that I needed to download the packages from somewhere else
> to build a complete/up-to-date version, but I have forgotten where I
> read that.  And
> https://svn.r-project.org/R/trunk/src/library/Recommended/ shows that
> only Makefile.in and Makefile.win live here.
>
>    Does your  src/library/Recommended have up-to-date source code for all
> the packages ... ?
>
>   cheers
>     Ben
>
> Kasper Daniel Hansen wrote:
>> The obvious: the recommended packages are inside
>>    src/library
>>
>> Kasper
>>
>> On Dec 15, 2009, at 10:57 AM, Ben Bolker wrote:
>>
>>>   I followed the suggestions at
>>> http://developer.r-project.org/SVNtips.html to check out an anonymous
>>> copy of the development branch of R, but so far I have been unable to
>>> figure out an analogous way to track the development branch of the
>>> recommended packages. (I'm assuming they actually live somewhere on the
>>> same SVN server, which might not be true ...) Any ideas (including
>>> pointing out the obvious, or the obvious-in-hindsight)?
>>>
>>>   thanks
>>>     Ben Bolker


-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/HlX9 : new package : bibtex
|- http://tr.im/Gq7i : ohloh
`- http://tr.im/FtUu : new package : highlight


From felix at nfrac.org  Tue Dec 15 23:35:50 2009
From: felix at nfrac.org (Felix Andrews)
Date: Wed, 16 Dec 2009 09:35:50 +1100
Subject: [Rd] split.data.frame
In-Reply-To: <4B27518E.6030209@dbmail.com>
References: <4B27518E.6030209@dbmail.com>
Message-ID: <94730b8a0912151435l1961c630y8ac5ad12f6dfba93@mail.gmail.com>

I agree, I would definitely appreciate that.

A simpler implementation:

split.data.frame <- function(x, f, drop = FALSE, ...)
{
    ff <- eval(substitute(f), x, parent.frame())
    lapply(split(seq_len(nrow(x)), ff, drop = drop, ...),
function(ind) x[ind, , drop = FALSE])
}


df <- data.frame(x = 1:10, y = rep(1:2, each = 5))
split( df, df$y )
split( df, y )
split( df, x > 3 )


2009/12/15 Romain Francois <romain.francois at dbmail.com>:
> Hello,
>
> I very much enjoy "with" and "subset" semantics for data frames and was
> wondering if we could have something similar with split, basically by
> evaluating the second argument "with" the data frame :
>
> split.data.frame
> function(x, f, drop = FALSE, ...){
> ? ? ? ?call <- match.call( )
> ? ? ? ?fcall <- call( "with", data = call[["x"]], expr = call[["f"]] )
> ? ? ? ?ff <- eval( fcall, parent.frame(1) )
>
> ? ? ? ?lapply(split(seq_len(nrow(x)), ff, drop = drop, ...), function(ind)
> x[ind, , drop = FALSE])
> }
>
>
>> split( df, y )
> $`1`
> ?x y
> 1 1 1
> 2 2 1
> 3 3 1
> 4 4 1
> 5 5 1
>
> $`2`
> ? ?x y
> 6 ? 6 2
> 7 ? 7 2
> 8 ? 8 2
> 9 ? 9 2
> 10 10 2
>
>> split( df, x > 3 )
> $`FALSE`
> ?x y
> 1 1 1
> 2 2 1
> 3 3 1
>
> $`TRUE`
> ? ?x y
> 4 ? 4 1
> 5 ? 5 1
> 6 ? 6 2
> 7 ? 7 2
> 8 ? 8 2
> 9 ? 9 2
> 10 10 2
>
>
> Romain
>
> --
> Romain Francois
> Professional R Enthusiast
> +33(0) 6 28 91 30 30
> http://romainfrancois.blog.free.fr
> |- http://tr.im/HlX9 : new package : bibtex
> |- http://tr.im/Gq7i : ohloh
> `- http://tr.im/FtUu : new package : highlight
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Felix Andrews / ???
Postdoctoral Fellow
Integrated Catchment Assessment and Management (iCAM) Centre
Fenner School of Environment and Society [Bldg 48a]
The Australian National University
Canberra ACT 0200 Australia
M: +61 410 400 963
T: + 61 2 6125 4670
E: felix.andrews at anu.edu.au
CRICOS Provider No. 00120C
-- 
http://www.neurofractal.org/felix/


From p.dalgaard at biostat.ku.dk  Wed Dec 16 00:14:24 2009
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 16 Dec 2009 00:14:24 +0100
Subject: [Rd] split.data.frame
In-Reply-To: <4B27518E.6030209@dbmail.com>
References: <4B27518E.6030209@dbmail.com>
Message-ID: <4B281850.6000708@biostat.ku.dk>

Romain Francois wrote:
> Hello,
> 
> I very much enjoy "with" and "subset" semantics for data frames and was 
> wondering if we could have something similar with split, basically by 
> evaluating the second argument "with" the data frame :

I seem to recall that this idea was considered and rejected when the 
current split.data.frame was written (10 years ago!). The main reasons 
were that

- it's not really THAT hard to evaluate a single splitting expression 
using with() or eval()

- not all applications will have the splitting factor inside the df to 
split ( split(df[-1], df[[1]]) for a simple case)

- if you need a computed splitting factor, there's a risk of inadvertent 
variable capture. I.e., if you inside a function do

   ....
   grp <- ...whatever...
   spl <- split(x, grp)
   ....

and x has a variable called grp, what do you get?





-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From jmc at r-project.org  Wed Dec 16 00:52:12 2009
From: jmc at r-project.org (John Chambers)
Date: Tue, 15 Dec 2009 15:52:12 -0800
Subject: [Rd] S4 dispatch and S3 "connection" objects
In-Reply-To: <acbd1aed0912150634v7695318ch8abaf9732efcd771@mail.gmail.com>
References: <4B273C8E.9090802@dbmail.com>
	<acbd1aed0912150634v7695318ch8abaf9732efcd771@mail.gmail.com>
Message-ID: <4B28212C.3090302@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091215/4b3a93ea/attachment.pl>

From romain.francois at dbmail.com  Wed Dec 16 08:03:33 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Wed, 16 Dec 2009 08:03:33 +0100
Subject: [Rd] split.data.frame
In-Reply-To: <4B281850.6000708@biostat.ku.dk>
References: <4B27518E.6030209@dbmail.com> <4B281850.6000708@biostat.ku.dk>
Message-ID: <4B288645.3010602@dbmail.com>

On 12/16/2009 12:14 AM, Peter Dalgaard wrote:
> Romain Francois wrote:
>> Hello,
>>
>> I very much enjoy "with" and "subset" semantics for data frames and
>> was wondering if we could have something similar with split, basically
>> by evaluating the second argument "with" the data frame :
>
> I seem to recall that this idea was considered and rejected when the
> current split.data.frame was written (10 years ago!). The main reasons
> were that
>
> - it's not really THAT hard to evaluate a single splitting expression
> using with() or eval()

Sure, this is just about convenience and laziness.

> - not all applications will have the splitting factor inside the df to
> split ( split(df[-1], df[[1]]) for a simple case)

this still works

> - if you need a computed splitting factor, there's a risk of inadvertent
> variable capture. I.e., if you inside a function do
>
> ....
> grp <- ...whatever...
> spl <- split(x, grp)
> ....
>
> and x has a variable called grp, what do you get?

this is a problem indeed.

thanks for the reply.

Romain

-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/HlX9 : new package : bibtex
|- http://tr.im/Gq7i : ohloh
`- http://tr.im/FtUu : new package : highlight


From romain.francois at dbmail.com  Wed Dec 16 08:12:10 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Wed, 16 Dec 2009 08:12:10 +0100
Subject: [Rd] S4 dispatch and S3 "connection" objects
In-Reply-To: <4B28212C.3090302@r-project.org>
References: <4B273C8E.9090802@dbmail.com>
	<acbd1aed0912150634v7695318ch8abaf9732efcd771@mail.gmail.com>
	<4B28212C.3090302@r-project.org>
Message-ID: <4B28884A.8040702@dbmail.com>

On 12/16/2009 12:52 AM, John Chambers wrote:
> We should probably incorporate this information in the pre-defined S4
> versions of the classes, since these are basic S3 classes.

That'd be good.

> Anybody see a
> down side?
>
> Meanwhile, your approach is a reasonable workaround.
>
> John
>
> Michael Lawrence wrote:
>> On Mon, Dec 14, 2009 at 11:36 PM, Romain Francois<
>> romain.francois at dbmail.com>  wrote:
>>
>>
>>> Hello,
>>>
>>> I'm trying to get S4 dispatch on S3 "connection" objects.
>>>
>>> So I do :
>>>
>>> setOldClass( "connection" )
>>>
>>> and then :
>>>
>>> setGeneric( "bling", function(object) standardGeneric( "bling" ) )
>>> setMethod( "bling", "connection", function(object) cat( "gotcha ",
>>> as.integer(object), "\n" ) )
>>>
>>> but I get :
>>>
>>> f<- file( "blabla", open = "rb" )
>>>
>>>
>>>> bling( f )
>>>>
>>> Error in function (classes, fdef, mtable)  :
>>>   unable to find an inherited method for function "bling", for signature
>>> "file"
>>>
>>>> class( f )
>>>>
>>> [1] "file"       "connection"
>>>
>>>
>>> Am I supposed to do :
>>>
>>> setOldClass( c("file", "connection" ) )
>>> setOldClass( c("url", "connection" ) )
>>>
>>> and so on for each potential S3 class, or is there another way.
>>>
>>>
>>>
>> That's the way I've always done it.
>>
>> Michael
>>
>>
>>
>>> Romain

-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/HlX9 : new package : bibtex
|- http://tr.im/Gq7i : ohloh
`- http://tr.im/FtUu : new package : highlight


From y_alperovych at yahoo.fr  Tue Dec 15 19:40:15 2009
From: y_alperovych at yahoo.fr (y_alperovych at yahoo.fr)
Date: Tue, 15 Dec 2009 19:40:15 +0100 (CET)
Subject: [Rd] R GUI editor window - help field does not return the
	help	topic (PR#14146)
Message-ID: <20091215184015.E367C282C76A@mail.pubhealth.ku.dk>

Full_Name: Yan Alperovych
Version: R 2.10.1, GUI 1.31
OS: Mac OS 10.6.2
Submission from: (NULL) (139.165.27.244)


Hello everyone, 

I am not sure if I am at the right place to put this question, so don't hesitate
to redirect me to the correct mailing list. My question is about the editor
window under the R GUI on Mac OS 10.6.2. Before the upgrade to R 2.10.1 with GUI
1.31, I was able to call for the help topics from the spotlight-like help field
in the upper right corner of the editor window. Now it only returns me a blank
box, which still slides as before, but the help content is missing. Is this a
frequent problem or is it related to my specific computer? And if it's a general
issue, is there some solution please?

Thank you for the replies or possible indications on where can I find more
hints.

Yan ALPEROVYCH
Financial Management, FRFC-FNRS Fellow
HEC-ULg Management School
Tel.: 	+32(4)/232.74.30
GSM:  	+32(4)/85.75.04.16 
E-mail: 	y.alperovych at ulg.ac.be


From allwrigh at maths.ox.ac.uk  Tue Dec 15 18:05:09 2009
From: allwrigh at maths.ox.ac.uk (allwrigh at maths.ox.ac.uk)
Date: Tue, 15 Dec 2009 18:05:09 +0100 (CET)
Subject: [Rd] apparently incorrect p-values from 2-sided Kolmogorov-Smirnov
	test (PR#14145)
Message-ID: <20091215170510.225BA282EFEA@mail.pubhealth.ku.dk>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--1132542651-1468968864-1260896436=:8788
Content-Type: TEXT/PLAIN; format=flowed; charset=US-ASCII

I am using R version 2.6.2 (2008-02-08) on a Ubuntu Linux system.
I seemed to be finding occasional errors in the p-values produced by 
ks.test(a,b) when a and b were vectors of 10 to 20 values.
So I tried to find simpler examples, and one that illustrates what I mean 
is included below and as the attached typescript file.
It is just

x<-1:5
y<-c(2.5,4.5)
ks.test(x,y)

The value of the D_2,5 statistic is calculated as 0.4 correctly, but the 
p-value is stated by R as 1, though in fact it should be 20/21=0.9524
As I say this is just one example of quite a lot of errors of this kind 
that I am finding.
If you want more examples I can try to be more systematic about tracking 
them down.
Thank you,
David Allwright.
-----------------------------------------------------------------------------
Dr DJ Allwright              E-mail    : allwrigh at maths.ox.ac.uk
OCIAM(Oxford Centre for Industrial and Applied Mathematics)
Mathematical Institute       Telephone : [+44](0)1865-280604
24-29 St.Giles'              FAX                     -270515
Oxford OX1 3LB, UK. 
-----------------------------------------------------------------------------


Script started on Tue 15 Dec 2009 16:49:46 GMT
]0;swamp-thing: ~/smithinst/be2swamp-thing:be2% R

R version 2.6.2 (2008-02-08)
Copyright (C) 2008 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

   Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> x<-1:5
> y<-c(2.5,4.5)
> ks.test(x,y)

 	Two-sample Kolmogorov-Smirnov test

data:  x and y 
D = 0.4, p-value = 1
alternative hypothesis: two-sided

> q()
Save workspace image? [y/n/c]: n
]0;swamp-thing: ~/smithinst/be2swamp-thing:be2% exit 
exit

Script done on Tue 15 Dec 2009 16:50:13 GMT

------------------------------------------------------------------------------
--1132542651-1468968864-1260896436=:8788
Content-Type: TEXT/PLAIN; charset=US-ASCII; name=typescript
Content-Transfer-Encoding: BASE64
Content-ID: <alpine.DEB.1.00.0912151700360.8788 at swamp-thing.maths.ox.ac.uk>
Content-Description: 
Content-Disposition: attachment; filename=typescript

U2NyaXB0IHN0YXJ0ZWQgb24gVHVlIDE1IERlYyAyMDA5IDE2OjQ5OjQ2IEdN
VA0KG10wO3N3YW1wLXRoaW5nOiB+L3NtaXRoaW5zdC9iZTIHc3dhbXAtdGhp
bmc6YmUyJSBSDQ0NCg0NClIgdmVyc2lvbiAyLjYuMiAoMjAwOC0wMi0wOCkN
DQpDb3B5cmlnaHQgKEMpIDIwMDggVGhlIFIgRm91bmRhdGlvbiBmb3IgU3Rh
dGlzdGljYWwgQ29tcHV0aW5nDQ0KSVNCTiAzLTkwMDA1MS0wNy0wDQ0KDQ0K
UiBpcyBmcmVlIHNvZnR3YXJlIGFuZCBjb21lcyB3aXRoIEFCU09MVVRFTFkg
Tk8gV0FSUkFOVFkuDQ0KWW91IGFyZSB3ZWxjb21lIHRvIHJlZGlzdHJpYnV0
ZSBpdCB1bmRlciBjZXJ0YWluIGNvbmRpdGlvbnMuDQ0KVHlwZSAnbGljZW5z
ZSgpJyBvciAnbGljZW5jZSgpJyBmb3IgZGlzdHJpYnV0aW9uIGRldGFpbHMu
DQ0KDQ0KICBOYXR1cmFsIGxhbmd1YWdlIHN1cHBvcnQgYnV0IHJ1bm5pbmcg
aW4gYW4gRW5nbGlzaCBsb2NhbGUNDQoNDQpSIGlzIGEgY29sbGFib3JhdGl2
ZSBwcm9qZWN0IHdpdGggbWFueSBjb250cmlidXRvcnMuDQ0KVHlwZSAnY29u
dHJpYnV0b3JzKCknIGZvciBtb3JlIGluZm9ybWF0aW9uIGFuZA0NCidjaXRh
dGlvbigpJyBvbiBob3cgdG8gY2l0ZSBSIG9yIFIgcGFja2FnZXMgaW4gcHVi
bGljYXRpb25zLg0NCg0NClR5cGUgJ2RlbW8oKScgZm9yIHNvbWUgZGVtb3Ms
ICdoZWxwKCknIGZvciBvbi1saW5lIGhlbHAsIG9yDQ0KJ2hlbHAuc3RhcnQo
KScgZm9yIGFuIEhUTUwgYnJvd3NlciBpbnRlcmZhY2UgdG8gaGVscC4NDQpU
eXBlICdxKCknIHRvIHF1aXQgUi4NDQoNDQo+IHg8LTE6NQ0NCj4geTwtYygy
LjUsNC41KQ0NCj4ga3MudGVzdCh4LHkpDQ0KDQ0KCVR3by1zYW1wbGUgS29s
bW9nb3Jvdi1TbWlybm92IHRlc3QNDQoNDQpkYXRhOiAgeCBhbmQgeSANDQpE
ID0gMC40LCBwLXZhbHVlID0gMQ0NCmFsdGVybmF0aXZlIGh5cG90aGVzaXM6
IHR3by1zaWRlZCANDQoNDQo+IHEoKQ0NClNhdmUgd29ya3NwYWNlIGltYWdl
PyBbeS9uL2NdOiBuDQ0KG10wO3N3YW1wLXRoaW5nOiB+L3NtaXRoaW5zdC9i
ZTIHc3dhbXAtdGhpbmc6YmUyJSBleGl0DQ0NCmV4aXQNDQoNClNjcmlwdCBk
b25lIG9uIFR1ZSAxNSBEZWMgMjAwOSAxNjo1MDoxMyBHTVQNCg==

--1132542651-1468968864-1260896436=:8788--


From joemsong at cs.nmsu.edu  Tue Dec 15 21:20:10 2009
From: joemsong at cs.nmsu.edu (joemsong at cs.nmsu.edu)
Date: Tue, 15 Dec 2009 21:20:10 +0100 (CET)
Subject: [Rd] Redirect standard output (PR#14148)
Message-ID: <20091215202010.AB1F1282EFE9@mail.pubhealth.ku.dk>

Full_Name: Joe Song
Version: 2.10.0
OS: Windows 7
Submission from: (NULL) (97.123.159.234)


Symptom: The following command in R

> system("program > run.log")

would not redirect standard output to the file "run.log".

This bug did not exist on Windows XP, but appeared on Windows 7 when the same
program is run.


From christopher.a.hane at gmail.com  Wed Dec 16 07:05:11 2009
From: christopher.a.hane at gmail.com (christopher.a.hane at gmail.com)
Date: Wed, 16 Dec 2009 07:05:11 +0100 (CET)
Subject: [Rd] Flexclust barchart issue when mcol=NULL (PR#14150)
Message-ID: <20091216060511.A32D0282EFF6@mail.pubhealth.ku.dk>

Full_Name: Chris Hane
Version: 2.10.1
OS: Windows
Submission from: (NULL) (198.203.181.181)


When using barchart in the flexcust package, setting mcol=NULL to avoid the
lollipops causes an error.  Each panel shows the text message "Error using
packet n replacement has length zero." where n is the panel number.

> data(iris)
> cl <- cclust(iris[,-5], k=3)
> barplot(cl, mcol=NULL)  #works fine
> barchart(cl, mcol=NULL) # oops

FWIW, as the data of the clusters is scaled showing the colMeans for the centers
is misleading.  The global mean of each column is 0, not the colMean of the
centers.


From romain.francois at dbmail.com  Wed Dec 16 12:47:50 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Wed, 16 Dec 2009 12:47:50 +0100
Subject: [Rd] Redirect standard output (PR#14148)
In-Reply-To: <20091215202010.AB1F1282EFE9@mail.pubhealth.ku.dk>
References: <20091215202010.AB1F1282EFE9@mail.pubhealth.ku.dk>
Message-ID: <4B28C8E6.6040203@dbmail.com>

On 12/15/2009 09:20 PM, joemsong at cs.nmsu.edu wrote:
>
> Full_Name: Joe Song
> Version: 2.10.0
> OS: Windows 7
> Submission from: (NULL) (97.123.159.234)
>
>
> Symptom: The following command in R
>
>> system("program>  run.log")
>
> would not redirect standard output to the file "run.log".
>
> This bug did not exist on Windows XP, but appeared on Windows 7 when the same
> program is run.

Then send this to microsoft.

-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/HlX9 : new package : bibtex
|- http://tr.im/Gq7i : ohloh
`- http://tr.im/FtUu : new package : highlight


From ripley at stats.ox.ac.uk  Wed Dec 16 12:59:40 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 16 Dec 2009 11:59:40 +0000 (GMT)
Subject: [Rd] Redirect standard output (PR#14148)
In-Reply-To: <20091215202010.AB1F1282EFE9@mail.pubhealth.ku.dk>
References: <20091215202010.AB1F1282EFE9@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0912161157080.28313@gannet.stats.ox.ac.uk>

On Tue, 15 Dec 2009, joemsong at cs.nmsu.edu wrote:

> Full_Name: Joe Song
> Version: 2.10.0
> OS: Windows 7
> Submission from: (NULL) (97.123.159.234)
>
>
> Symptom: The following command in R
>
>> system("program > run.log")
>
> would not redirect standard output to the file "run.log".
>
> This bug did not exist on Windows XP, but appeared on Windows 7 when the same
> program is run.

Please do read the help for system() on your OS.  It is not a bug to 
do what it is documented to do!  The help page gives you the 
workaround (and has for several years).

And a number of people using XP did start finding it this year: it 
seems related to a MS update.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Dec 16 13:01:24 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 16 Dec 2009 12:01:24 +0000 (GMT)
Subject: [Rd] Flexclust barchart issue when mcol=NULL (PR#14150)
In-Reply-To: <20091216060511.A32D0282EFF6@mail.pubhealth.ku.dk>
References: <20091216060511.A32D0282EFF6@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0912161200170.28313@gannet.stats.ox.ac.uk>

Please do read the section on 'BUGS' in the FAQ.
This is not the bug-reporting address for package 'flexclust'.

On Wed, 16 Dec 2009, christopher.a.hane at gmail.com wrote:

> Full_Name: Chris Hane
> Version: 2.10.1
> OS: Windows
> Submission from: (NULL) (198.203.181.181)
>
>
> When using barchart in the flexcust package, setting mcol=NULL to avoid the
> lollipops causes an error.  Each panel shows the text message "Error using
> packet n replacement has length zero." where n is the panel number.
>
>> data(iris)
>> cl <- cclust(iris[,-5], k=3)
>> barplot(cl, mcol=NULL)  #works fine
>> barchart(cl, mcol=NULL) # oops
>
> FWIW, as the data of the clusters is scaled showing the colMeans for the centers
> is misleading.  The global mean of each column is 0, not the colMean of the
> centers.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch at stats.uwo.ca  Wed Dec 16 13:17:53 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 16 Dec 2009 07:17:53 -0500
Subject: [Rd] Redirect standard output (PR#14148)
In-Reply-To: <20091215202010.AB1F1282EFE9@mail.pubhealth.ku.dk>
References: <20091215202010.AB1F1282EFE9@mail.pubhealth.ku.dk>
Message-ID: <4B28CFF1.8030503@stats.uwo.ca>

On 15/12/2009 3:20 PM, joemsong at cs.nmsu.edu wrote:
> Full_Name: Joe Song
> Version: 2.10.0
> OS: Windows 7
> Submission from: (NULL) (97.123.159.234)
> 
> 
> Symptom: The following command in R
> 
>> system("program > run.log")
> 
> would not redirect standard output to the file "run.log".
> 
> This bug did not exist on Windows XP, but appeared on Windows 7 when the same
> program is run.

That doesn't work on XP if program is an .exe, and I wouldn't expect it 
to.  The system() command on Windows doesn't process redirects.  See the 
documentation.

Duncan Murdoch


From nashjc at uottawa.ca  Wed Dec 16 15:18:18 2009
From: nashjc at uottawa.ca (Prof. John C Nash)
Date: Wed, 16 Dec 2009 09:18:18 -0500
Subject: [Rd] [R] R CMD check when package directory is symlinked
In-Reply-To: <mailman.19.1260961209.29033.r-devel@r-project.org>
References: <mailman.19.1260961209.29033.r-devel@r-project.org>
Message-ID: <4B28EC2A.3010004@uottawa.ca>

I've done a couple of searches and not found mention of the issue below, though some older 
scripts mention getting absolute paths for R CMD check. If the issue is "new" or 
unfamiliar I'll be happy to follow up and document it, but suspect it is in some sense 
already known and I've missed the right search strategy. The workaround is pretty simple 
-- copy the files to a new absolute directory. However, if I can save some grief for 
others, I will.

I run Ubuntu Jaunty 9.04, but until recently was running Hardy 8.04. I symlinked my 
R-optimtest directory from /home/john/ to my "old" home directory's version. When I 
changed a package and tried R CMD check I got the following.

> * checking whether the package can be loaded ... ERROR
> Error in dyn.load(file, DLLpath = DLLpath, ...) : 
>   unable to load shared library '/media/lnx804/home/john/R-optimtest/work/minqa.Rcheck/minqa/libs/minqa.so':
>   /media/lnx804/home/john/R-optimtest/work/minqa.Rcheck/minqa/libs/minqa.so: failed to map segment from shared object: Operation not permitted
> Error : .onLoad failed in 'loadNamespace' for 'minqa'
> Error: package/namespace load failed for 'minqa'
> Execution halted

I copied the entire minqa tree to a new "localR" directory and things work fine. So it 
looks like R is unhappy with the expanded directory name i.e., from 
/home/john/R-optimtest/work/... to /media/lnx804/home/john/R-optimtest/work/...


Cheers, JN


From simon.urbanek at r-project.org  Wed Dec 16 15:39:03 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 16 Dec 2009 09:39:03 -0500
Subject: [Rd] R GUI editor window - help field does not return the
	help	topic (PR#14146)
In-Reply-To: <20091215184015.E367C282C76A@mail.pubhealth.ku.dk>
References: <20091215184015.E367C282C76A@mail.pubhealth.ku.dk>
Message-ID: <3AD15C27-D7BF-4E81-9799-3166515CFC38@r-project.org>

Please read the posting guide before submitting bug reports, especially if you don't even know that it's the proper way!

I cannot reproduce the problem, so please supply the details as we kindly ask you to - at the very least sessionInfo()... Also the proper place for Mac-related questions is R-SIG-Mac (see "About R" in the GUI).

Thanks,
Simon



On Dec 15, 2009, at 1:40 PM, y_alperovych at yahoo.fr wrote:

> Full_Name: Yan Alperovych
> Version: R 2.10.1, GUI 1.31
> OS: Mac OS 10.6.2
> Submission from: (NULL) (139.165.27.244)
> 
> 
> Hello everyone, 
> 
> I am not sure if I am at the right place to put this question, so don't hesitate
> to redirect me to the correct mailing list. My question is about the editor
> window under the R GUI on Mac OS 10.6.2. Before the upgrade to R 2.10.1 with GUI
> 1.31, I was able to call for the help topics from the spotlight-like help field
> in the upper right corner of the editor window. Now it only returns me a blank
> box, which still slides as before, but the help content is missing. Is this a
> frequent problem or is it related to my specific computer? And if it's a general
> issue, is there some solution please?
> 
> Thank you for the replies or possible indications on where can I find more
> hints.
> 
> Yan ALPEROVYCH
> Financial Management, FRFC-FNRS Fellow
> HEC-ULg Management School
> Tel.: 	+32(4)/232.74.30
> GSM:  	+32(4)/85.75.04.16 
> E-mail: 	y.alperovych at ulg.ac.be
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From friedrich.leisch at stat.uni-muenchen.de  Wed Dec 16 15:55:30 2009
From: friedrich.leisch at stat.uni-muenchen.de (Friedrich Leisch)
Date: Wed, 16 Dec 2009 15:55:30 +0100
Subject: [Rd] Flexclust barchart issue when mcol=NULL
In-Reply-To: <20091216060511.A32D0282EFF6@mail.pubhealth.ku.dk>
References: <20091216060511.A32D0282EFF6@mail.pubhealth.ku.dk>
Message-ID: <19240.62690.283393.334035@ridcully.stat.uni-muenchen.de>

>>>>> On Wed, 16 Dec 2009 07:05:11 +0100 (CET),
>>>>> christopher a hane (cah) wrote:

  > Full_Name: Chris Hane
  > Version: 2.10.1
  > OS: Windows
  > Submission from: (NULL) (198.203.181.181)


  > When using barchart in the flexcust package, setting mcol=NULL to avoid the
  > lollipops causes an error.  Each panel shows the text message "Error using
  > packet n replacement has length zero." where n is the panel number.

  >> data(iris)
  >> cl <- cclust(iris[,-5], k=3)
  >> barplot(cl, mcol=NULL)  #works fine
  >> barchart(cl, mcol=NULL) # oops

Yes, that's a bug in flexclust. I'll fix it for the next release.

In the meantime you can use barchart(cl, mcol=NA) which has the same
effect for me. 
  

  > FWIW, as the data of the clusters is scaled showing the colMeans
  > for the centers is misleading.  The global mean of each column is
  > 0, not the colMean of the centers.

Hmm, I am not sure I understand this paragraph. I agree that showing
the global mean makes no sense for centered data, but the iris data
are not centered. I don't think that barcharts like the above make
sense in all possible situations. I mainly use them for binary data
where I want to see which variables have a high/low percentage of ones
in which cluster (=bars), and what the difference to the global mean
is.

Best,
Fritz


From P.Dalgaard at biostat.ku.dk  Wed Dec 16 16:27:04 2009
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 16 Dec 2009 16:27:04 +0100
Subject: [Rd] R CMD check may not detect a code/documentation mismatch
In-Reply-To: <20091214205125.GA7516@cs.cas.cz>
References: <20091213104402.GA20719@cs.cas.cz>
	<4B24E54B.7080005@biostat.ku.dk>	<19237.63020.855201.147223@fangorn.hornik.net>
	<20091214205125.GA7516@cs.cas.cz>
Message-ID: <4B28FC48.4020308@biostat.ku.dk>

[orig. correspondence below]

Brian and Kurt have been sinking their teeth further into this. It
turned out that there was a gotcha with the .Primitive functions like
`:`, `.C`, etc., for which formals() always returns NULL. However,
replacement with a  check for typeof(f) == "closure" made things work,
and revealed a handful of undetected issues in CRAN packages.

So this has now been committed to r-devel. Thanks for chasing this up.

-pd


Petr Savicky wrote:
> On Mon, Dec 14, 2009 at 09:24:12AM +0100, Kurt Hornik wrote:
>>>>>>> Peter Dalgaard writes:
> [...]
>>> Hmm, looks more like a thinko in this code inside codoc():
>>>      functions_in_code <- Filter(function(f) {
>>>          f <- get(f, envir = code_env)
>>>          is.function(f) && (length(formals(f)) > 0L)
>>>      }, objects_in_code)
>>> which, further down the line, causes functions with no formal arguments 
>>> to be skipped when compared to the usage section.
>>> Browse[2]>
>>> debug: ind <- (!functions %in% functions_to_be_ignored & functions %in%
>>>      functions_in_code)
>>> Browse[2]> functions
>>> [1] "testCoreClass"    "testCoreAttrEval" "testCoreReg" 
>>> "testCoreNA"
>>> Browse[2]>
>>> debug: bad_functions <- mapply(functions[ind], exprs[ind], FUN = 
>>> function(x,
>>>      y) check_codoc(x, as.pairlist(as.alist.call(y[-1L]))), SIMPLIFY = 
>>> FALSE)
>>> Browse[2]> ind
>>> [1]  TRUE  TRUE  TRUE FALSE
>>> I.e. testCoreNA is never tested by check_codoc. There may of course be
>>> a rationale for this, but it escapes me...
>> Well, I am sure I had good reasons when I wrote the code many years ago,
>> but of course I no longer recall what they were.
>>
>> Did you try the effect of removing the length(formals(f)) test?
> 
> I understand this as the question, what is the influence of the following patch
> (indented by two spaces).
> 
>   diff --minimal -U 3 -r R-devel_2009-12-13/src/library/tools/R/QC.R R-devel_length_formals/src/library/tools/R/QC.R
>   --- R-devel_2009-12-13/src/library/tools/R/QC.R	2009-10-27 02:59:10.000000000 +0100
>   +++ R-devel_length_formals/src/library/tools/R/QC.R	2009-12-14 18:45:55.000000000 +0100
>   @@ -398,7 +398,7 @@
>        functions_in_code <-
>            Filter(function(f) {
>                       f <- get(f, envir = code_env)
>   -                   is.function(f) && (length(formals(f)) > 0L)
>   +                   is.function(f)
>                   },
>                   objects_in_code)
>        ## Sourcing all R code files in the package is a problem for base,
> 
> Since i do not know this part of R code, i simply applied the patch to the
> current R-devel and run "make" and "make check" (both OK) and compared
> the output of
> 
>   R CMD check XML_2.6-0.tar.gz
>   R CMD check randomForest_4.5-33.tar.gz
>   R CMD check tree_1.0-27.tar.gz
>   R CMD check survival_2.35-7.tar.gz
> 
> with R being both original R-devel and the modified one. The results were identical
> in all four cases (empty diff) on two Linux machines (CentOS and openSUSE).
> 
> On the other hand, for the package
>   http://www.cs.cas.cz/~savicky/R-devel/something_0.0.0.tar.gz
> which demonstrates the problem, the modified R detected the code/doc mismatch.
> The diff of the two outputs of R CMD check was
> 
>   [savicky at uivtx test]$ diff original modified 
>   35c35,42
>   < * checking for code/documentation mismatches ... OK
>   ---
>   > * checking for code/documentation mismatches ... WARNING
>   > Codoc mismatches from documentation object 'testCore':
>   > testCoreNA
>   >   Code: function()
>   >   Docs: function(verbose = 0)
>   >   Argument names in docs not in code:
>   >     verbose
>   > 
>   39a47,50
>   > WARNING: There was 1 warning, see
>   >   /home/savicky/tmp/test/something.Rcheck/00check.log
>   > for details
>   > 
> 
> Petr Savicky.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From simon.urbanek at r-project.org  Wed Dec 16 17:05:23 2009
From: simon.urbanek at r-project.org (simon.urbanek at r-project.org)
Date: Wed, 16 Dec 2009 17:05:23 +0100 (CET)
Subject: [Rd] R GUI editor window - help field does not return the
	help	topic (PR#14146)
Message-ID: <20091216160523.DB5012830318@mail.pubhealth.ku.dk>

Yan,

On Dec 16, 2009, at 10:13 AM, Yan ALPEROVYCH wrote:

> Hello Simon,=20
>=20
> I did read the posting guide, and I did as your colleague from the GUI =
discussion instructed me to (Forwarded text bellow). It's ok, I got my =
lesson.=20
>=20
> The session info:
>=20
>> sessionInfo()
> R version 2.10.1 (2009-12-14)=20
> x86_64-apple-darwin9.8.0=20
>=20
> locale:
> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>=20
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base   =
 =20
>>=20
>=20
> The problem can be reproduced as:
> 1. Click on the "New document" in the R console.=20
> 2. In the popped editor window, type any command, e.g. "cbind", in the =
help field in the upper right corner.
>=20
> Normally, it should show you the content of the help topic. In my case =
it shows me only a blank box.
>=20

Great, thanks - I can reproduce it now. Fixed in r5539 (you can try =
tonight's build tomorrow).

Thanks,
Simon


> On Dec 16, 2009, at 3:39 PM, Simon Urbanek wrote:
>=20
>> Please read the posting guide before submitting bug reports, =
especially if you don't even know that it's the proper way!
>>=20
>> I cannot reproduce the problem, so please supply the details as we =
kindly ask you to - at the very least sessionInfo()... Also the proper =
place for Mac-related questions is R-SIG-Mac (see "About R" in the GUI).
>>=20
>> Thanks,
>> Simon
>>=20
>>=20
>>=20
>> On Dec 15, 2009, at 1:40 PM, y_alperovych at yahoo.fr wrote:
>>=20
>>> Full_Name: Yan Alperovych
>>> Version: R 2.10.1, GUI 1.31
>>> OS: Mac OS 10.6.2
>>> Submission from: (NULL) (139.165.27.244)
>>>=20
>>>=20
>>> Hello everyone,=20
>>>=20
>>> I am not sure if I am at the right place to put this question, so =
don't hesitate
>>> to redirect me to the correct mailing list. My question is about the =
editor
>>> window under the R GUI on Mac OS 10.6.2. Before the upgrade to R =
2.10.1 with GUI
>>> 1.31, I was able to call for the help topics from the spotlight-like =
help field
>>> in the upper right corner of the editor window. Now it only returns =
me a blank
>>> box, which still slides as before, but the help content is missing. =
Is this a
>>> frequent problem or is it related to my specific computer? And if =
it's a general
>>> issue, is there some solution please?
>>>=20
>>> Thank you for the replies or possible indications on where can I =
find more
>>> hints.
>>>=20
>>> Yan ALPEROVYCH
>>> Financial Management, FRFC-FNRS Fellow
>>> HEC-ULg Management School
>>> Tel.: 	+32(4)/232.74.30
>>> GSM:  	+32(4)/85.75.04.16=20
>>> E-mail: 	y.alperovych at ulg.ac.be
>>>=20
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>=20
>>>=20
>>=20
>=20
>=20
>=20
>=20
>> From: Philippe Grosjean <phgrosjean at sciviews.org>
>> Date: December 15, 2009 7:29:01 PM GMT+01:00
>> To: Yan ALPEROVYCH <y.alperovych at ulg.ac.be>
>> Cc: r-sig-gui at stat.math.ethz.ch
>> Subject: Re: [R-gui] R GUI editor window - help field does not return =
the help	topic.
>>=20
>> You should fill a bug report for R.
>>=20
>> PhG
>> ..............................................<=B0}))><........
>> ) ) ) ) )
>> ( ( ( ( (    Prof. Philippe Grosjean
>> ) ) ) ) )
>> ( ( ( ( (    Numerical Ecology of Aquatic Systems
>> ) ) ) ) )   Mons University, Belgium
>> ( ( ( ( (
>> ..............................................................
>>=20
>> Yan ALPEROVYCH wrote:
>>> Hello everyone, I am not sure if I am at the right place to put this =
question, so don't hesitate to redirect me to the correct mailing list. =
My question is about the editor window under the R GUI on Mac OS 10.6.2. =
Before the upgrade to R 2.10.1 with GUI 1.31, I was able to call for the =
help topics from the spotlight-like help field in the upper right corner =
of the editor. Now it only returns me a blank box, which still slides as =
before, but the help topic is missing. Is this a frequent problem or is =
it related to my specific computer? And if it's a general issue, is =
there some solution please?
>>> Thank you for the replies or possible indications on where can I =
find more hints.
>>> Yan ALPEROVYCH
>>> Financial Management, FRFC-FNRS Fellow
>>> HEC-ULg Management School
>>> Tel.: 	+32(4)/232.74.30
>>> GSM:  	+32(4)/85.75.04.16 E-mail: 	y.alperovych at ulg.ac.be
>>> _______________________________________________
>>> R-SIG-GUI mailing list
>>> R-SIG-GUI at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-gui
>=20
>=20


From tlumley at u.washington.edu  Wed Dec 16 18:32:56 2009
From: tlumley at u.washington.edu (tlumley at u.washington.edu)
Date: Wed, 16 Dec 2009 09:32:56 -0800 (PST)
Subject: [Rd] apparently incorrect p-values from 2-sided
 Kolmogorov-Smirnov test (PR#14145)
In-Reply-To: <20091215170510.225BA282EFEA@mail.pubhealth.ku.dk>
Message-ID: <alpine.LRH.2.01.0912160932560.32190@hymn32.u.washington.edu>

On Tue, 15 Dec 2009, allwrigh at maths.ox.ac.uk wrote; (in part)

>
> x<-1:5
> y<-c(2.5,4.5)
> ks.test(x,y)
>
> The value of the D_2,5 statistic is calculated as 0.4 correctly, but the
> p-value is stated by R as 1, though in fact it should be 20/21=0.9524


What we seem to have here is a rounding error problem.

In ks.c:psmirnov2x,  there is a double loop including
 	    if(fabs(i / md - j / nd) > q)
 		u[j] = 0;

where md=2, nd=5, and q=3/10.

Now,  to full precision  abs(1/2 - 4/5) > 3/10 is false, but at least on my MacBook it is true in C double precision.

I'm not sure why the loop is working with doubles, since multiplying by m*n should make everything an integer.

      -thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From tlumley at u.washington.edu  Wed Dec 16 18:35:16 2009
From: tlumley at u.washington.edu (tlumley at u.washington.edu)
Date: Wed, 16 Dec 2009 18:35:16 +0100 (CET)
Subject: [Rd] apparently incorrect p-values from 2-sided
	Kolmogorov-Smirnov (PR#14151)
Message-ID: <20091216173516.D6DFA2830318@mail.pubhealth.ku.dk>

On Tue, 15 Dec 2009, allwrigh at maths.ox.ac.uk wrote; (in part)

>
> x<-1:5
> y<-c(2.5,4.5)
> ks.test(x,y)
>
> The value of the D_2,5 statistic is calculated as 0.4 correctly, but the
> p-value is stated by R as 1, though in fact it should be 20/21=0.9524


What we seem to have here is a rounding error problem.

In ks.c:psmirnov2x,  there is a double loop including
 	    if(fabs(i / md - j / nd) > q)
 		u[j] = 0;

where md=2, nd=5, and q=3/10.

Now,  to full precision  abs(1/2 - 4/5) > 3/10 is false, but at least on my MacBook it is true in C double precision.

I'm not sure why the loop is working with doubles, since multiplying by m*n should make everything an integer.

      -thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From ross at biostat.ucsf.edu  Thu Dec 17 02:15:12 2009
From: ross at biostat.ucsf.edu (ross at biostat.ucsf.edu)
Date: Thu, 17 Dec 2009 02:15:12 +0100 (CET)
Subject: [Rd] ?setGeneric garbled (PR#14153)
Message-ID: <20091217011512.AE18B2831FE2@mail.pubhealth.ku.dk>

Full_Name: Ross Boylan
Version: 2.10.0
OS: Windows XP
Submission from: (NULL) (198.144.201.14)


Some of the help for setGeneric seems to have been garbled.  In the section
"Basic Use", 5th paragraph (where the example counts as a single line 3rd
paragraph) it says
<quote>
     Note that calling 'setGeneric()' in this form is not strictly
     necessary before calling 'setMethod()' for the same function.  If
     the function specified in the call to 'setMethod' is not generic,
     'setMethod' will execute the call to 'setGeneric' itself.
     Declaring explicitly that you want the function to be generic can
     be considered better programming style; the only difference in the
     result, however, is that not doing so produces a You cannot (and
     never need to) create an explicit generic version of the primitive
     functions in the base package.
<quote>
The stuff after the semi-colon of the final sentence is garbled, or at least
unparseable by me.  Probably something got deleted by mistake.

This is with ESS 5.7.1, Emacs 23.1.1.

This is a somewhat newish problem; the help in R 2.7 does not have the problem.


From henrik.parn at bio.ntnu.no  Thu Dec 17 10:05:09 2009
From: henrik.parn at bio.ntnu.no (henrik.parn at bio.ntnu.no)
Date: Thu, 17 Dec 2009 10:05:09 +0100 (CET)
Subject: [Rd] Wrong links in help help files? (PR#14155)
Message-ID: <20091217090509.A840E2831FE7@mail.pubhealth.ku.dk>

Dear R developers,


?help.search

...opens a tab in my browser (Firefox 3.5.6, Win XP):

http://127.0.0.1:31642/library/utils/html/help.search.html

When I click on the link for "?", 
(http://127.0.0.1:31642/library/utils/help/?)
in the last line of "Details", I get an error message:

"Server error: invalid response from R".


Similarly,

The link to "??" (http://127.0.0.1:31642/library/utils/help/??) found 
under http://127.0.0.1:31642/library/utils/html/help.html "See also" 
gives same error message.


On the other hand, in the help text for "help" 
(http://127.0.0.1:31642/library/utils/html/help.html) the link to "?", 
found under "See also", is 
http://127.0.0.1:31642/library/utils/html/Question.html, which seems to 
be the correct link.


I did not manage to find anything on this topic in recent bug reports on 
"Documentation" and "Documentation fixed".


Best regards,


Henrik P?rn


 > sessionInfo()
R version 2.10.1 (2009-12-14)
i386-pc-mingw32

locale:
[1] LC_COLLATE=English_United Kingdom.1252  LC_CTYPE=English_United 
Kingdom.1252    LC_MONETARY=English_United Kingdom.1252 LC_NUMERIC=C 

[5] LC_TIME=English_United Kingdom.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] tools_2.10.1

  	
-- 
Henrik P?rn
Centre for Conservation Biology
Department of Biology
Norwegian University of Science and Technology
NO-7491 Trondheim
Norway

Office: +47 73596285
Fax: +47 73596100
Mobile: +47 90989255

E-mail: henrik.parn at bio.ntnu.no


From adrian at maths.uwa.edu.au  Thu Dec 17 08:35:09 2009
From: adrian at maths.uwa.edu.au (adrian at maths.uwa.edu.au)
Date: Thu, 17 Dec 2009 08:35:09 +0100 (CET)
Subject: [Rd] segfault in glm.fit (PR#14154)
Message-ID: <20091217073510.19DEB2831FE5@mail.pubhealth.ku.dk>

Bug summary:
             glm() causes a segfault if the argument 'data'
             is a data frame with more than 16384 rows.

Bug demonstration:

-------input ---------------
      N <- 16400
      df <- data.frame(x=runif(N, min=1,max=2),y=rpois(N, 2))
      glm(y ~ x, family=poisson, data=df)

------ output ---------------
      *** caught segfault ***
      address (nil), cause 'unknown'

      Traceback:
 1: ifelse(y == 0, 1, y/mu)
 2: dev.resids(y, mu, weights)
 3: glm.fit(x = X, y = Y, weights = weights, start = start, etastart = 
etastart,     mustart = mustart, offset = offset, family = family, 
control = control,     intercept = attr(mt, "intercept") > 0)
 4: glm(y ~ x, family = poisson, data = df)

--------------------------------

The code generates a segfault if the value of 'N' is greater than 16384.

regards
Adrian Baddeley

////////////////////////////////////////////////////////////

--please do not edit the information below--

Version:
 platform = x86_64-unknown-linux-gnu
 arch = x86_64
 os = linux-gnu
 system = x86_64, linux-gnu
 status =
 major = 2
 minor = 10.1
 year = 2009
 month = 12
 day = 14
 svn rev = 50720
 language = R
 version.string = R version 2.10.1 (2009-12-14)

Locale:
LC_CTYPE=en_AU.UTF-8;LC_NUMERIC=C;LC_TIME=en_AU.UTF-8;LC_COLLATE=en_AU.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_AU.UTF-8;LC_PAPER=en_AU.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_AU.UTF-8;LC_IDENTIFICATION=C

Search Path:
 .GlobalEnv, package:stats, package:graphics, package:grDevices, 
package:utils, package:datasets, package:methods, Autoloads, package:base


From murdoch at stats.uwo.ca  Thu Dec 17 13:31:15 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 17 Dec 2009 07:31:15 -0500
Subject: [Rd] Wrong links in help help files? (PR#14155)
In-Reply-To: <20091217090509.A840E2831FE7@mail.pubhealth.ku.dk>
References: <20091217090509.A840E2831FE7@mail.pubhealth.ku.dk>
Message-ID: <4B2A2493.9020908@stats.uwo.ca>

On 17/12/2009 4:05 AM, henrik.parn at bio.ntnu.no wrote:
> Dear R developers,
> 
> 
> ?help.search
> 
> ...opens a tab in my browser (Firefox 3.5.6, Win XP):
> 
> http://127.0.0.1:31642/library/utils/html/help.search.html
> 
> When I click on the link for "?", 
> (http://127.0.0.1:31642/library/utils/help/?)
> in the last line of "Details", I get an error message:
> 
> "Server error: invalid response from R".
> 
> 
> Similarly,
> 
> The link to "??" (http://127.0.0.1:31642/library/utils/help/??) found 
> under http://127.0.0.1:31642/library/utils/html/help.html "See also" 
> gives same error message.
> 
> 
> On the other hand, in the help text for "help" 
> (http://127.0.0.1:31642/library/utils/html/help.html) the link to "?", 
> found under "See also", is 
> http://127.0.0.1:31642/library/utils/html/Question.html, which seems to 
> be the correct link.
> 
> 
> I did not manage to find anything on this topic in recent bug reports on 
> "Documentation" and "Documentation fixed".

Thanks.  The problem is that the HTML converter doesn't escape the 
question marks, which have special meaning in a URL, so they are 
misinterpreted.  I'll look into it.

Duncan Murdoch

> 
> 
> Best regards,
> 
> 
> Henrik P?rn
> 
> 
>  > sessionInfo()
> R version 2.10.1 (2009-12-14)
> i386-pc-mingw32
> 
> locale:
> [1] LC_COLLATE=English_United Kingdom.1252  LC_CTYPE=English_United 
> Kingdom.1252    LC_MONETARY=English_United Kingdom.1252 LC_NUMERIC=C 
> 
> [5] LC_TIME=English_United Kingdom.1252
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> loaded via a namespace (and not attached):
> [1] tools_2.10.1
> 
>


From mdowle at mdowle.plus.com  Thu Dec 17 13:39:27 2009
From: mdowle at mdowle.plus.com (Matthew Dowle)
Date: Thu, 17 Dec 2009 12:39:27 -0000
Subject: [Rd] split.data.frame
References: <4B27518E.6030209@dbmail.com> <4B281850.6000708@biostat.ku.dk>
	<4B288645.3010602@dbmail.com>
Message-ID: <hgd8q2$mr2$1@ger.gmane.org>


This seems very similar to the data.table package.

The 'by' argument splits the data.table by that value then executes the j 
expression within each subset.  The package documentation talks about 
'subset' and 'with' in some detail. See ?"[.data.table".

dt = data.table(x=1:20, y=rep(1:4,each=5)
dt[,sum(x),by="y"]

> and x has a variable called grp, what do you get?
In data.table that choice is given to the user via the argument 'with' which 
by default is TRUE meaning you get the x inside dt.


"Romain Francois" <romain.francois at dbmail.com> wrote in message 
news:4B288645.3010602 at dbmail.com...
> On 12/16/2009 12:14 AM, Peter Dalgaard wrote:
>> Romain Francois wrote:
>>> Hello,
>>>
>>> I very much enjoy "with" and "subset" semantics for data frames and
>>> was wondering if we could have something similar with split, basically
>>> by evaluating the second argument "with" the data frame :
>>
>> I seem to recall that this idea was considered and rejected when the
>> current split.data.frame was written (10 years ago!). The main reasons
>> were that
>>
>> - it's not really THAT hard to evaluate a single splitting expression
>> using with() or eval()
>
> Sure, this is just about convenience and laziness.
>
>> - not all applications will have the splitting factor inside the df to
>> split ( split(df[-1], df[[1]]) for a simple case)
>
> this still works
>
>> - if you need a computed splitting factor, there's a risk of inadvertent
>> variable capture. I.e., if you inside a function do
>>
>> ....
>> grp <- ...whatever...
>> spl <- split(x, grp)
>> ....
>>
>> and x has a variable called grp, what do you get?
>
> this is a problem indeed.
>
> thanks for the reply.
>
> Romain
>
> -- 
> Romain Francois
> Professional R Enthusiast
> +33(0) 6 28 91 30 30
> http://romainfrancois.blog.free.fr
> |- http://tr.im/HlX9 : new package : bibtex
> |- http://tr.im/Gq7i : ohloh
> `- http://tr.im/FtUu : new package : highlight
>


From maechler at stat.math.ethz.ch  Thu Dec 17 14:18:06 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 17 Dec 2009 14:18:06 +0100
Subject: [Rd] segfault in glm.fit (PR#14154)
In-Reply-To: <20091217073510.19DEB2831FE5@mail.pubhealth.ku.dk>
References: <20091217073510.19DEB2831FE5@mail.pubhealth.ku.dk>
Message-ID: <19242.12174.221758.505109@lynne.math.ethz.ch>

>>>>> "AB" == Adrian Baddeley <adrian at maths.uwa.edu.au>
>>>>>     on Thu, 17 Dec 2009 08:35:09 +0100 (CET) writes:

    AB> Bug summary:
    AB> glm() causes a segfault if the argument 'data'
    AB> is a data frame with more than 16384 rows.

not on my desktop

    AB> Bug demonstration:

    AB> -------input ---------------
    AB> N <- 16400
    AB> df <- data.frame(x=runif(N, min=1,max=2),y=rpois(N, 2))
    AB> glm(y ~ x, family=poisson, data=df)

I don't get a problem, nor do I if I do the above in a for()
loop, 100 times,

nor do I get a problem when I do it 100 times with  
N <- 50000
(where  you need to wait a few minutes)
using the following
x86_64-unknown-linux-gnu
 N <- 50000; for(n in 1:100) { cat("\nn = ",n,"\n----\n"); df <- data.frame(x=runif(N, min=1,max=2),y=rpois(N, 2)); print(glm(y ~ x, family=poisson, data=df)) }


So, I guess it's problem only on *some* platforms.
Mine is also  x86_64-unknown-linux-gnu

[with 8 Giga bytes of RAM, and a quad-core 
 AMD Phenom(tm) II X4 925 Processor ].

Martin

    AB> ------ output ---------------
    AB> *** caught segfault ***
    AB> address (nil), cause 'unknown'

    AB> Traceback:
    AB> 1: ifelse(y == 0, 1, y/mu)
    AB> 2: dev.resids(y, mu, weights)
    AB> 3: glm.fit(x = X, y = Y, weights = weights, start = start, etastart = 
    AB> etastart,     mustart = mustart, offset = offset, family = family, 
    AB> control = control,     intercept = attr(mt, "intercept") > 0)
    AB> 4: glm(y ~ x, family = poisson, data = df)

    AB> --------------------------------

    AB> The code generates a segfault if the value of 'N' is greater than 16384.

    AB> regards
    AB> Adrian Baddeley

    AB> ////////////////////////////////////////////////////////////

    AB> --please do not edit the information below--

    AB> Version:
    AB> platform = x86_64-unknown-linux-gnu
    AB> arch = x86_64
    AB> os = linux-gnu
    AB> system = x86_64, linux-gnu
    AB> status =
    AB> major = 2
    AB> minor = 10.1
    AB> year = 2009
    AB> month = 12
    AB> day = 14
    AB> svn rev = 50720
    AB> language = R
    AB> version.string = R version 2.10.1 (2009-12-14)

    AB> Locale:
    AB> LC_CTYPE=en_AU.UTF-8;LC_NUMERIC=C;LC_TIME=en_AU.UTF-8;LC_COLLATE=en_AU.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_AU.UTF-8;LC_PAPER=en_AU.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_AU.UTF-8;LC_IDENTIFICATION=C

    AB> Search Path:
    AB> .GlobalEnv, package:stats, package:graphics, package:grDevices, 
    AB> package:utils, package:datasets, package:methods, Autoloads, package:base

    AB> ______________________________________________
    AB> R-devel at r-project.org mailing list
    AB> https://stat.ethz.ch/mailman/listinfo/r-devel


From baptiste.auguie at googlemail.com  Thu Dec 17 14:22:59 2009
From: baptiste.auguie at googlemail.com (baptiste auguie)
Date: Thu, 17 Dec 2009 14:22:59 +0100
Subject: [Rd] incorrect linetype with pdf device (PR#14128)
Message-ID: <de4e29f50912170522ka82a70n4d081426f4d489a9@mail.gmail.com>

Dear list,

A small follow up on this issue. The same behavior is observed for
postscript() and pdf(), so I suspect the erroneous code is in
grDevices/src/devPS.c. In particular, this macro,

static void
PostScriptSetLineTexture(FILE *fp, const char *dashlist, int nlty, double lwd)
{
/* use same macro for Postscript and PDF */
#define PP_SetLineTexture(_CMD_)						\
    double dash;								\
    int i;									\
    fprintf(fp,"[");								\
    for (i = 0; i < nlty; i++) {						\
	dash = (lwd >= 1 ? lwd: 1) *						\
	    ((i % 2) ? dashlist[i] + 1						\
	     :((nlty == 1 && dashlist[i] == 1.) ? 1. : dashlist[i] - 1));	\
	if (dash < 0) dash = 0;							\
	fprintf(fp," %.2f", dash);						\
    }										\
    fprintf(fp,"] 0 %s\n", _CMD_)

    PP_SetLineTexture("setdash");
}


I think the dash pattern should be

dash = (lwd >= 1 ? lwd: 1) *						\
	    ((i % 2) ? dashlist[i] 						\
	     :((nlty == 1 && dashlist[i] == 1.) ? 1. : dashlist[i] ));

instead (but I don't know C well enough to be sure).


Best regards,

baptiste


From ripley at stats.ox.ac.uk  Thu Dec 17 15:03:52 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 17 Dec 2009 14:03:52 +0000 (GMT)
Subject: [Rd] segfault in glm.fit (PR#14154)
In-Reply-To: <20091217073510.19DEB2831FE5@mail.pubhealth.ku.dk>
References: <20091217073510.19DEB2831FE5@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0912171311210.8356@gannet.stats.ox.ac.uk>

I cannot reproduce this on our x86_64 Fedora systems (and I tried all 
the usual tricks such as gctorture and valgrind to provoke a problem).
And I have fitted much larger GLMs many times over the last decade, so 
your 'bug summary' cannot be the whole story.

Your example is random and you haven't set a seed: to eliminate that 
there is something specific about the data you tried can you set one 
and tell us which failed.

One possibility is a compiler optimization bug, so can you please tell 
us what compilers were used with what flags to build this version of 
R, and if you built it yourself try it without optimization.  (The 
machines I used had GCC 4.3.2 and 4.4.1 with CFLAGS="-g -O3 -Wall 
-pedantic -mtune=core2" FFLAGS="-g -O -mtune=core2": higher levels of 
optimization have known problems with recent x86_64 versions of 
gfortran, and I am wondering if that is an underlying issue.)


On Thu, 17 Dec 2009, adrian at maths.uwa.edu.au wrote:

> Bug summary:
>             glm() causes a segfault if the argument 'data'
>             is a data frame with more than 16384 rows.
>
> Bug demonstration:
>
> -------input ---------------
>      N <- 16400
>      df <- data.frame(x=runif(N, min=1,max=2),y=rpois(N, 2))
>      glm(y ~ x, family=poisson, data=df)
>
> ------ output ---------------
>      *** caught segfault ***
>      address (nil), cause 'unknown'
>
>      Traceback:
> 1: ifelse(y == 0, 1, y/mu)
> 2: dev.resids(y, mu, weights)
> 3: glm.fit(x = X, y = Y, weights = weights, start = start, etastart =
> etastart,     mustart = mustart, offset = offset, family = family,
> control = control,     intercept = attr(mt, "intercept") > 0)
> 4: glm(y ~ x, family = poisson, data = df)
>
> --------------------------------
>
> The code generates a segfault if the value of 'N' is greater than 16384.
>
> regards
> Adrian Baddeley
>
> ////////////////////////////////////////////////////////////
>
> --please do not edit the information below--
>
> Version:
> platform = x86_64-unknown-linux-gnu
> arch = x86_64
> os = linux-gnu
> system = x86_64, linux-gnu
> status =
> major = 2
> minor = 10.1
> year = 2009
> month = 12
> day = 14
> svn rev = 50720
> language = R
> version.string = R version 2.10.1 (2009-12-14)
>
> Locale:
> LC_CTYPE=en_AU.UTF-8;LC_NUMERIC=C;LC_TIME=en_AU.UTF-8;LC_COLLATE=en_AU.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_AU.UTF-8;LC_PAPER=en_AU.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_AU.UTF-8;LC_IDENTIFICATION=C
>
> Search Path:
> .GlobalEnv, package:stats, package:graphics, package:grDevices,
> package:utils, package:datasets, package:methods, Autoloads, package:base
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Thu Dec 17 15:10:49 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 17 Dec 2009 15:10:49 +0100
Subject: [Rd] RFC: lchoose() vs lfactorial() etc
In-Reply-To: <19239.38154.219034.206322@lynne.math.ethz.ch>
References: <19239.19864.396771.484772@lynne.math.ethz.ch>
	<20091215095243.GA14388@cs.cas.cz>
	<19239.38154.219034.206322@lynne.math.ethz.ch>
Message-ID: <19242.15337.267242.128687@lynne.math.ethz.ch>

>>>>> "MM" == Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Tue, 15 Dec 2009 14:54:18 +0100 writes:

>>>>> "PS" == Petr Savicky <savicky at cs.cas.cz>
>>>>>     on Tue, 15 Dec 2009 10:52:43 +0100 writes:

    PS> On Tue, Dec 15, 2009 at 09:49:28AM +0100, Martin Maechler wrote:
    >>> lgamma(x) and lfactorial(x) are defined to return
    >>> 
    >>> ln|Gamma(x)| {= log(abs(gamma(x)))} or  ln|Gamma(x+1)| respectively.
    >>> 
    >>> Unfortunately,  we haven't chosen the analogous definition for 
    >>> lchoose().
    >>> 
    >>> So, currently 
    >>> 
    >>> > lchoose(1/2, 1:10)
    >>> [1] -0.6931472 -2.0794415        NaN -3.2425924        NaN -3.8869494
    >>> [7]        NaN -4.3357508        NaN -4.6805913
    >>> Warning message:
    >>> In lchoose(n, k) : NaNs produced
    >>> > 
    >>> 
    >>> which (the NaN's) is not particularly useful.
    >>> (I have use case where I really have to workaround those NaNs.)
    >>> 
    >>> I herebey propose to *amend* the definition of lchoose() such
    >>> that it behaves analogously to  lgamma() and lfactorial(),
    >>> i.e., to return
    >>> 
    >>> log(abs(choose(.,.))
    >>> 
    >>> Your comments are welcome.
    >>> Martin Maechler, ETH Zurich

    PS> I do not have a strong opinion, whether lchoose() should be log(choose(.,.))
    PS> or log(abs(choose(.,.))), although i would slightly prefere the latter (with abs()).
    PS> One of the reasons is that this would simplify the code of the function
    PS> lchoose() in src/nmath/choose.c. It produces the NA by explicit testing
    PS> the sign, so this test could be simply removed.

    PS> Let me also point out that the current implementation seems to contain
    PS> a bug, which causes that it is neither log(choose(.,.)) nor log(abs(choose(.,.))).

    PS> x <- choose(1/2, 1:10)
    PS> y <- lchoose(1/2, 1:10)
    PS> cbind(choose=x, lchoose=y, log.choose=log(abs(x)))
    PS> choose    lchoose log.choose
    PS> #  [1,]  0.500000000 -0.6931472 -0.6931472
    PS> #  [2,] -0.125000000 -2.0794415 -2.0794415
    PS> #  [3,]  0.062500000        NaN -2.7725887
    PS> #  [4,] -0.039062500 -3.2425924 -3.2425924
    PS> #  [5,]  0.027343750        NaN -3.5992673
    PS> #  [6,] -0.020507812 -3.8869494 -3.8869494
    PS> #  [7,]  0.016113281        NaN -4.1281114
    PS> #  [8,] -0.013092041 -4.3357508 -4.3357508
    PS> #  [9,]  0.010910034        NaN -4.5180723
    PS> # [10,] -0.009273529 -4.6805913 -4.6805913

    PS> So, besides x[1], we get NA for those cases, when choose() is positive.
    PS> The reason seems to be the test at line 89 of src/nmath/choose.c, which is

    PS> if (fmod(floor(n-k+1), 2.) == 0) /* choose() < 0 */
    PS> return ML_NAN;

    PS> but it should be negated. I tested it using

    PS> if (fmod(floor(n-k+1), 2.) != 0) /* choose() < 0 */
    PS> return ML_NAN;

    MM> Indeed !!! 
    MM> Pretty  "interesting" that this thinko has not been detected for
    MM> quite a few years....

    MM> This, of course, is an even more compelling reason to implement
    MM> the change of return  log(abs(choose(.,.)),
    MM> and at the moment, I'd even plan to "backport" that to R "2.10.1
    MM> patched", as the current behavior is clearly bugous.

This has now happened;
svn revisions  50775 and 50776  {R-devel and R-patched}.

Martin


From maechler at stat.math.ethz.ch  Thu Dec 17 15:24:03 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 17 Dec 2009 15:24:03 +0100
Subject: [Rd] ?setGeneric garbled (PR#14153)
In-Reply-To: <20091217011512.AE18B2831FE2@mail.pubhealth.ku.dk>
References: <20091217011512.AE18B2831FE2@mail.pubhealth.ku.dk>
Message-ID: <19242.16131.942089.481511@lynne.math.ethz.ch>

>>>>> Ross Boylan <ross at biostat.ucsf.edu>
>>>>>     on Thu, 17 Dec 2009 02:15:12 +0100 (CET) writes:

    > Full_Name: Ross Boylan
    > Version: 2.10.0
    > OS: Windows XP
    > Submission from: (NULL) (198.144.201.14)


    > Some of the help for setGeneric seems to have been garbled.  In the section
    > "Basic Use", 5th paragraph (where the example counts as a single line 3rd
    > paragraph) it says
    > <quote>
    > Note that calling 'setGeneric()' in this form is not strictly
    > necessary before calling 'setMethod()' for the same function.  If
    > the function specified in the call to 'setMethod' is not generic,
    > 'setMethod' will execute the call to 'setGeneric' itself.
    > Declaring explicitly that you want the function to be generic can
    > be considered better programming style; the only difference in the
    > result, however, is that not doing so produces a You cannot (and
    > never need to) create an explicit generic version of the primitive
    > functions in the base package.
    > <quote>

    > The stuff after the semi-colon of the final sentence is garbled, or at least
    > unparseable by me.  Probably something got deleted by mistake.

That's very peculiar.

The corresponding  methods/man/setGeneric.Rd file has not been
changed in a while,
but I don't see your problem.


    > This is with ESS 5.7.1, Emacs 23.1.1.

exactly same versions here,  but not your problem.

What happens if you start  R  in terminal and call
?setGeneric there ?


Regards,
Martin


    > This is a somewhat newish problem; the help in R 2.7 does not have the problem.

(( peculiar indeed ... ))


From murdoch at stats.uwo.ca  Thu Dec 17 16:04:43 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 17 Dec 2009 10:04:43 -0500
Subject: [Rd] Wrong links in help help files? (PR#14155)
In-Reply-To: <20091217090509.A840E2831FE7@mail.pubhealth.ku.dk>
References: <20091217090509.A840E2831FE7@mail.pubhealth.ku.dk>
Message-ID: <4B2A488B.1090201@stats.uwo.ca>

This is now fixed in R-devel and R-patched as of  r50774.  It should 
show up in Windows builds tomorrow.  There were probably other special 
characters besides "?" that it handled incorrectly; thanks for noticing.

Duncan Murdoch

On 17/12/2009 4:05 AM, henrik.parn at bio.ntnu.no wrote:
> Dear R developers,
>
>
> ?help.search
>
> ...opens a tab in my browser (Firefox 3.5.6, Win XP):
>
> http://127.0.0.1:31642/library/utils/html/help.search.html
>
> When I click on the link for "?", 
> (http://127.0.0.1:31642/library/utils/help/?)
> in the last line of "Details", I get an error message:
>
> "Server error: invalid response from R".
>
>
> Similarly,
>
> The link to "??" (http://127.0.0.1:31642/library/utils/help/??) found 
> under http://127.0.0.1:31642/library/utils/html/help.html "See also" 
> gives same error message.
>
>
> On the other hand, in the help text for "help" 
> (http://127.0.0.1:31642/library/utils/html/help.html) the link to "?", 
> found under "See also", is 
> http://127.0.0.1:31642/library/utils/html/Question.html, which seems to 
> be the correct link.
>
>
> I did not manage to find anything on this topic in recent bug reports on 
> "Documentation" and "Documentation fixed".
>
>
> Best regards,
>
>
> Henrik P?rn
>
>
>  > sessionInfo()
> R version 2.10.1 (2009-12-14)
> i386-pc-mingw32
>
> locale:
> [1] LC_COLLATE=English_United Kingdom.1252  LC_CTYPE=English_United 
> Kingdom.1252    LC_MONETARY=English_United Kingdom.1252 LC_NUMERIC=C 
>
> [5] LC_TIME=English_United Kingdom.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> loaded via a namespace (and not attached):
> [1] tools_2.10.1
>
>   	
>


From ross at biostat.ucsf.edu  Thu Dec 17 18:42:22 2009
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Thu, 17 Dec 2009 09:42:22 -0800
Subject: [Rd] ?setGeneric garbled (PR#14153)
In-Reply-To: <19242.16131.942089.481511@lynne.math.ethz.ch>
References: <20091217011512.AE18B2831FE2@mail.pubhealth.ku.dk>
	<19242.16131.942089.481511@lynne.math.ethz.ch>
Message-ID: <1261071742.12277.11.camel@corn.betterworld.us>

On Thu, 2009-12-17 at 15:24 +0100, Martin Maechler wrote:
> >>>>> Ross Boylan <ross at biostat.ucsf.edu>
> >>>>>     on Thu, 17 Dec 2009 02:15:12 +0100 (CET) writes:
> 
>     > Full_Name: Ross Boylan
>     > Version: 2.10.0
>     > OS: Windows XP
>     > Submission from: (NULL) (198.144.201.14)
> 
> 
>     > Some of the help for setGeneric seems to have been garbled.  In the section
>     > "Basic Use", 5th paragraph (where the example counts as a single line 3rd
>     > paragraph) it says
>     > <quote>
>     > Note that calling 'setGeneric()' in this form is not strictly
>     > necessary before calling 'setMethod()' for the same function.  If
>     > the function specified in the call to 'setMethod' is not generic,
>     > 'setMethod' will execute the call to 'setGeneric' itself.
>     > Declaring explicitly that you want the function to be generic can
>     > be considered better programming style; the only difference in the
>     > result, however, is that not doing so produces a You cannot (and
>     > never need to) create an explicit generic version of the primitive
>     > functions in the base package.
>     > <quote>
> 
>     > The stuff after the semi-colon of the final sentence is garbled, or at least
>     > unparseable by me.  Probably something got deleted by mistake.
> 
> That's very peculiar.
> 
> The corresponding  methods/man/setGeneric.Rd file has not been
> changed in a while,
> but I don't see your problem.

The help from R launched directly from the R shortcut on my desktop
looks fine, in both 2.10 and 2.8.

I closed all my emacs sessions and restarted, but ?setGeneric produces
the same garbled text.  I also tried telling ESS to use a different
working directory when launching R; it didn't help.


The last sentence of this paragraph is also garbled:
<quote>
 The description above is the effect when the package that owns the
     non-generic function has not created an implicit generic version.
     Otherwise, it is this implicit generic function that is us_same_
     version of the generic function will be created each time.
</quote>

Weird.

P.S. http://bugs.r-project.org was extremely sluggish, even timing out,
both yesterday and today for me.


From savicky at cs.cas.cz  Fri Dec 18 00:14:49 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Fri, 18 Dec 2009 00:14:49 +0100
Subject: [Rd] RFC: lchoose() vs lfactorial() etc
In-Reply-To: <19242.15337.267242.128687@lynne.math.ethz.ch>
References: <19239.19864.396771.484772@lynne.math.ethz.ch>
	<20091215095243.GA14388@cs.cas.cz>
	<19239.38154.219034.206322@lynne.math.ethz.ch>
	<19242.15337.267242.128687@lynne.math.ethz.ch>
Message-ID: <20091217231449.GA23480@cs.cas.cz>

On Thu, Dec 17, 2009 at 03:10:49PM +0100, Martin Maechler wrote:
[...]
>     MM> This, of course, is an even more compelling reason to implement
>     MM> the change of return  log(abs(choose(.,.)),
>     MM> and at the moment, I'd even plan to "backport" that to R "2.10.1
>     MM> patched", as the current behavior is clearly bugous.
> 
> This has now happened;
> svn revisions  50775 and 50776  {R-devel and R-patched}.

Thank you.

When preparing a test, whether lchoose(n, k) \approx log(abs(choose(n, k))), it
appeared that there is a minor problem also in choose(n, k), when n is very close
to k, but not equal.

  options(digits=15)
  n <- 5 + (-15:15)*1e-8
  cbind(n, choose(n, 5))
  #                n                  
  #  [1,] 4.99999985 0.999999657500042
  #  [2,] 4.99999986 0.999999680333370
  #  [3,] 4.99999987 0.999999703166698
  #  [4,] 4.99999988 0.999999726000027
  #  [5,] 4.99999989 0.999999748833356
  #  [6,] 4.99999990 0.999999771666685
  #  [7,] 4.99999991 0.000000000000000
  #  [8,] 4.99999992 0.000000000000000
  #  [9,] 4.99999993 0.000000000000000
  # [10,] 4.99999994 0.000000000000000
  # [11,] 4.99999995 0.000000000000000
  # [12,] 4.99999996 0.000000000000000
  # [13,] 4.99999997 0.000000000000000
  # [14,] 4.99999998 0.000000000000000
  # [15,] 4.99999999 0.000000000000000
  # [16,] 5.00000000 1.000000000000000
  # [17,] 5.00000001 5.000000000000000
  # [18,] 5.00000002 5.000000000000000
  # [19,] 5.00000003 5.000000000000000
  # [20,] 5.00000004 5.000000000000000
  # [21,] 5.00000005 5.000000000000000
  # [22,] 5.00000006 5.000000000000000
  # [23,] 5.00000007 5.000000000000000
  # [24,] 5.00000008 5.000000000000000
  # [25,] 5.00000009 5.000000000000000
  # [26,] 5.00000010 1.000000228333353
  # [27,] 5.00000011 1.000000251166690
  # [28,] 5.00000012 1.000000274000027
  # [29,] 5.00000013 1.000000296833365
  # [30,] 5.00000014 1.000000319666704
  # [31,] 5.00000015 1.000000342500042

All the values in the second column should be close to 1, but some are 0 and
some are 5. The reason seems to be in the line 112 of src/nmath/choose.c,
which is
  if(n-k < k && n >= 0 && R_IS_INT(n)) k = n-k; /* <- Symmetry */
If n is not exactly an integer, then k becomes also non-integer. 
Since the code relies on k being an exact integer, we get an error
as follows.

If n = k - eps for a small positive eps, then the next line 113
  if (k <  0) return 0.;
determines the output since k is now - eps.

If n = k + eps for a small positive eps, then the line 116
  r = n;
determines the output, since now k = eps, so the condition j <= k is not 
satisfied already at the beginning of the next cycle.

I suggest two solutions, a more conservative one and a less conservative one.

A more conservative solution is to replace the line 112 by
  if(n-k < k && n >= 0 && R_IS_INT(n)) k = floor(n - k + 0.5); /* <- Symmetry */
This yields the following in the same test as above.

  #                n                  
  #  [1,] 4.99999985 0.999999657500042
  #  [2,] 4.99999986 0.999999680333370
  #  [3,] 4.99999987 0.999999703166698
  #  [4,] 4.99999988 0.999999726000027
  #  [5,] 4.99999989 0.999999748833356
  #  [6,] 4.99999990 0.999999771666685
  #  [7,] 4.99999991 1.000000000000000
  #  [8,] 4.99999992 1.000000000000000
  #  [9,] 4.99999993 1.000000000000000
  # [10,] 4.99999994 1.000000000000000
  # [11,] 4.99999995 1.000000000000000
  # [12,] 4.99999996 1.000000000000000
  # [13,] 4.99999997 1.000000000000000
  # [14,] 4.99999998 1.000000000000000
  # [15,] 4.99999999 1.000000000000000
  # [16,] 5.00000000 1.000000000000000
  # [17,] 5.00000001 1.000000000000000
  # [18,] 5.00000002 1.000000000000000
  # [19,] 5.00000003 1.000000000000000
  # [20,] 5.00000004 1.000000000000000
  # [21,] 5.00000005 1.000000000000000
  # [22,] 5.00000006 1.000000000000000
  # [23,] 5.00000007 1.000000000000000
  # [24,] 5.00000008 1.000000000000000
  # [25,] 5.00000009 1.000000000000000
  # [26,] 5.00000010 1.000000228333353
  # [27,] 5.00000011 1.000000251166690
  # [28,] 5.00000012 1.000000274000027
  # [29,] 5.00000013 1.000000296833365
  # [30,] 5.00000014 1.000000319666704
  # [31,] 5.00000015 1.000000342500042

So, the extreme values 0 and 5 do not occur, but there is an interval
of constant values and on both ends of this interval, there is a jump
much larger than machine accuracy.

A less conservative solution (a patch is in an attachment) replaces
lines 110 - 121 by

    if (k < k_small_max) {
        int j;
        if(n-k < k && n >= 0 && (n == floor(n))) k = n-k; /* <- Symmetry */
        if (k <  0) return 0.;
        if (k == 0) return 1.;
        /* else: k >= 1 */
        r = n;
        for(j = 2; j <= k; j++) {
            r *= (n-j+1);
            r /= j;
        }
        return r;
    }

Here, the symetry is used only for exact integers. The symetry is
valid only for integers, since choose(n, k) is a polynomial of
degree k. So, for different values of k, we get a different functions
on any interval of positive length.

The division at the line
            r /= j;
always produces an exact integer, since during the whole cycle, r is always
either an integer binomial coefficient or its integer multiple. So, the
division has an integer result and there is no rounding error unless the
intermediate result does not fit into 53 bit precison.

Using the above code, we get

  options(digits=15)
  n <- 5 + (-15:15)*1e-8
  cbind(n, choose(n, 5))
  #                n                  
  #  [1,] 4.99999985 0.999999657500042
  #  [2,] 4.99999986 0.999999680333370
  #  [3,] 4.99999987 0.999999703166698
  #  [4,] 4.99999988 0.999999726000027
  #  [5,] 4.99999989 0.999999748833356
  #  [6,] 4.99999990 0.999999771666685
  #  [7,] 4.99999991 0.999999794500014
  #  [8,] 4.99999992 0.999999817333345
  #  [9,] 4.99999993 0.999999840166677
  # [10,] 4.99999994 0.999999863000008
  # [11,] 4.99999995 0.999999885833339
  # [12,] 4.99999996 0.999999908666670
  # [13,] 4.99999997 0.999999931500002
  # [14,] 4.99999998 0.999999954333335
  # [15,] 4.99999999 0.999999977166667
  # [16,] 5.00000000 1.000000000000000
  # [17,] 5.00000001 1.000000022833334
  # [18,] 5.00000002 1.000000045666667
  # [19,] 5.00000003 1.000000068500001
  # [20,] 5.00000004 1.000000091333336
  # [21,] 5.00000005 1.000000114166671
  # [22,] 5.00000006 1.000000137000006
  # [23,] 5.00000007 1.000000159833342
  # [24,] 5.00000008 1.000000182666680
  # [25,] 5.00000009 1.000000205500016
  # [26,] 5.00000010 1.000000228333353
  # [27,] 5.00000011 1.000000251166690
  # [28,] 5.00000012 1.000000274000027
  # [29,] 5.00000013 1.000000296833365
  # [30,] 5.00000014 1.000000319666704
  # [31,] 5.00000015 1.000000342500042

Within the chosen accuracy 1e-8, there is no visible jump.
With 1e-15, we get

  options(digits=15)
  n <- 5 + (-15:15)*1e-15
  cbind(n, choose(n, 5))
  #                      n                  
  #  [1,] 4.99999999999998 0.999999999999966
  #  [2,] 4.99999999999999 0.999999999999967
  #  [3,] 4.99999999999999 0.999999999999970
  #  [4,] 4.99999999999999 0.999999999999972
  #  [5,] 4.99999999999999 0.999999999999976
  #  [6,] 4.99999999999999 0.999999999999978
  #  [7,] 4.99999999999999 0.999999999999980
  #  [8,] 4.99999999999999 0.999999999999982
  #  [9,] 4.99999999999999 0.999999999999984
  # [10,] 4.99999999999999 0.999999999999986
  # [11,] 4.99999999999999 0.999999999999988
  # [12,] 5.00000000000000 0.999999999999990
  # [13,] 5.00000000000000 0.999999999999994
  # [14,] 5.00000000000000 0.999999999999996
  # [15,] 5.00000000000000 0.999999999999998
  # [16,] 5.00000000000000 1.000000000000000
  # [17,] 5.00000000000000 1.000000000000002
  # [18,] 5.00000000000000 1.000000000000004
  # [19,] 5.00000000000000 1.000000000000006
  # [20,] 5.00000000000000 1.000000000000010
  # [21,] 5.00000000000001 1.000000000000012
  # [22,] 5.00000000000001 1.000000000000014
  # [23,] 5.00000000000001 1.000000000000016
  # [24,] 5.00000000000001 1.000000000000018
  # [25,] 5.00000000000001 1.000000000000020
  # [26,] 5.00000000000001 1.000000000000022
  # [27,] 5.00000000000001 1.000000000000024
  # [28,] 5.00000000000001 1.000000000000028
  # [29,] 5.00000000000001 1.000000000000031
  # [30,] 5.00000000000001 1.000000000000032
  # [31,] 5.00000000000002 1.000000000000035

So, the jump in the exactly integer value n[16] == 5 is comparable
to machine accuracy.

I would be pleased to provide more tests, if some of the above solutions
or their modifications can be accepted.

Petr Savicky.

-------------- next part --------------
--- R-devel_2009-12-16/src/nmath/choose.c	2008-03-17 17:52:35.000000000 +0100
+++ R-devel_less_conservative/src/nmath/choose.c	2009-12-17 22:43:54.000000000 +0100
@@ -107,19 +107,20 @@
 #endif
     if (fabs(k - k0) > 1e-7)
 	MATHLIB_WARNING2(_("'k' (%.2f) must be integer, rounded to %.0f"), k0, k);
     if (k < k_small_max) {
 	int j;
-	if(n-k < k && n >= 0 && R_IS_INT(n)) k = n-k; /* <- Symmetry */
+	if(n-k < k && n >= 0 && (n == floor(n))) k = n-k; /* <- Symmetry */
 	if (k <	 0) return 0.;
 	if (k == 0) return 1.;
 	/* else: k >= 1 */
 	r = n;
-	for(j = 2; j <= k; j++)
-	    r *= (n-j+1)/j;
-	return R_IS_INT(n) ? floor(r + 0.5) : r;
-	/* might have got rounding errors */
+	for(j = 2; j <= k; j++) {
+	    r *= (n-j+1);
+	    r /= j;
+	}
+	return r;
     }
     /* else: k >= k_small_max */
     if (n < 0) {
 	r = choose(-n+ k-1, k);
 	if (ODD(k)) r = -r;

From rdpeng at gmail.com  Fri Dec 18 03:06:40 2009
From: rdpeng at gmail.com (Roger Peng)
Date: Thu, 17 Dec 2009 21:06:40 -0500
Subject: [Rd] silly SVN question
In-Reply-To: <4B27B5E8.7030805@ufl.edu>
References: <4B27B1D1.1060006@ufl.edu>
	<EDFDA701-90FA-4EFB-905F-729389C79E23@stat.berkeley.edu>
	<4B27B5E8.7030805@ufl.edu>
Message-ID: <66f3bd910912171806p6d588ac9l7e0d3f371fa634d7@mail.gmail.com>

Are you searching for ./tools/rsync-recommended?

-roger

On Tue, Dec 15, 2009 at 11:14 AM, Ben Bolker <bolker at ufl.edu> wrote:
>
> ?Yes, but ... on my system at least the Recommended folder has a recent
> version of the Makefile, but the packages are old tarballs. ?I have a
> fuzzy memory that I needed to download the packages from somewhere else
> to build a complete/up-to-date version, but I have forgotten where I
> read that. ?And
> https://svn.r-project.org/R/trunk/src/library/Recommended/ shows that
> only Makefile.in and Makefile.win live here.
>
> ?Does your ?src/library/Recommended have up-to-date source code for all
> the packages ... ?
>
> ?cheers
> ? Ben
>
> Kasper Daniel Hansen wrote:
>> The obvious: the recommended packages are inside
>> ? src/library
>>
>> Kasper
>>
>> On Dec 15, 2009, at 10:57 AM, Ben Bolker wrote:
>>
>>> ?I followed the suggestions at
>>> http://developer.r-project.org/SVNtips.html to check out an anonymous
>>> copy of the development branch of R, but so far I have been unable to
>>> figure out an analogous way to track the development branch of the
>>> recommended packages. (I'm assuming they actually live somewhere on the
>>> same SVN server, which might not be true ...) Any ideas (including
>>> pointing out the obvious, or the obvious-in-hindsight)?
>>>
>>> ?thanks
>>> ? ?Ben Bolker
>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
> --
> Ben Bolker
> Associate professor, Biology Dep't, Univ. of Florida
> bolker at ufl.edu / people.biology.ufl.edu/bolker
> GPG key: people.biology.ufl.edu/bolker/benbolker-publickey.asc
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>



-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/


From maechler at stat.math.ethz.ch  Fri Dec 18 09:35:25 2009
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Fri, 18 Dec 2009 09:35:25 +0100 (CET)
Subject: [Rd] ?setGeneric garbled (PR#14153)
Message-ID: <20091218083525.A7169282EF5A@mail.pubhealth.ku.dk>

>>>>> "RossB" == Ross Boylan <ross at biostat.ucsf.edu>
>>>>>     on Thu, 17 Dec 2009 09:42:22 -0800 writes:

    RossB> On Thu, 2009-12-17 at 15:24 +0100, Martin Maechler wrote:
    >> >>>>> Ross Boylan <ross at biostat.ucsf.edu>
    >> >>>>>     on Thu, 17 Dec 2009 02:15:12 +0100 (CET) writes:
    >> 
    >> > Full_Name: Ross Boylan
    >> > Version: 2.10.0
    >> > OS: Windows XP
    >> > Submission from: (NULL) (198.144.201.14)
    >> 
    >> 
    >> > Some of the help for setGeneric seems to have been garbled.  In the section
    >> > "Basic Use", 5th paragraph (where the example counts as a single line 3rd
    >> > paragraph) it says
    >> > <quote>
    >> > Note that calling 'setGeneric()' in this form is not strictly
    >> > necessary before calling 'setMethod()' for the same function.  If
    >> > the function specified in the call to 'setMethod' is not generic,
    >> > 'setMethod' will execute the call to 'setGeneric' itself.
    >> > Declaring explicitly that you want the function to be generic can
    >> > be considered better programming style; the only difference in the
    >> > result, however, is that not doing so produces a You cannot (and
    >> > never need to) create an explicit generic version of the primitive
    >> > functions in the base package.
    >> > <quote>
    >> 
    >> > The stuff after the semi-colon of the final sentence is garbled, or at least
    >> > unparseable by me.  Probably something got deleted by mistake.
    >> 
    >> That's very peculiar.
    >> 
    >> The corresponding  methods/man/setGeneric.Rd file has not been
    >> changed in a while,
    >> but I don't see your problem.

    RossB> The help from R launched directly from the R shortcut on my desktop
    RossB> looks fine, in both 2.10 and 2.8.

    RossB> I closed all my emacs sessions and restarted, but ?setGeneric produces
    RossB> the same garbled text.  I also tried telling ESS to use a different
    RossB> working directory when launching R; it didn't help.


    RossB> The last sentence of this paragraph is also garbled:
    RossB> <quote>
    RossB> The description above is the effect when the package that owns the
    RossB> non-generic function has not created an implicit generic version.
    RossB> Otherwise, it is this implicit generic function that is us_same_
    RossB> version of the generic function will be created each time.
    RossB> </quote>

    RossB> Weird.

Very weird, indeed!

However, in any case, this is a bug of your version / installation of
 [Emacs + ESS]
and not of R.
So the topic should move to the 
ESS-help list ess-help at stat.math.ethz.ch
and you could possibly additionally also send an "official Ess bug report":
   [iESS] emacs-menu, last line:  "Send bug report"




    RossB> P.S. http://bugs.r-project.org was extremely sluggish, even timing out,
    RossB> both yesterday and today for me.

Maybe the world climate is a bit more important in Copenhagen,
at the moment, than R's bugs server? ;-)
{{bugs.r-project.org *is* indeed located there}}

Thanks for the report, but as we've established, the bug is not
with R, really, but with your installation/version of the  R <->
Emacs interface.

Regards,
Martin


From tlumley at u.washington.edu  Fri Dec 18 17:26:14 2009
From: tlumley at u.washington.edu (tlumley at u.washington.edu)
Date: Fri, 18 Dec 2009 08:26:14 -0800 (PST)
Subject: [Rd] apparently incorrect p-values from 2-sided
 Kolmogorov-Smirnov test (PR#14145)
In-Reply-To: <alpine.DEB.1.00.0912181231170.20366@swamp-thing.maths.ox.ac.uk>
Message-ID: <alpine.LRH.2.01.0912180826140.16373@hymn13.u.washington.edu>



I've fixed this by adding 0.5/mn to q.  The problem (at least in principle) with multiplying them all up is integer overflow.

By the time 0.5/mn underflows to zero, missing one value in the distribution won't matter.

      -thomas


On Fri, 18 Dec 2009, David John Allwright wrote:

> Dear Thomas, Right, thank you. Yes, I haven't looked at the source code 
> (because I don't know C) but something like what you mention could well cause 
> the kind of problems I am seeing: a loop being exectued one too few or one 
> too many times. And yes, I think those quantities should be multiplied up by 
> m*n to all become integers so we escape rounding error problems. David.
> ------------------------------------------------------------------------------
> On Wed, 16 Dec 2009, tlumley at u.washington.edu wrote:
>
>> On Tue, 15 Dec 2009, allwrigh at maths.ox.ac.uk wrote; (in part)
>> 
>>> 
>>> x<-1:5
>>> y<-c(2.5,4.5)
>>> ks.test(x,y)
>>> 
>>> The value of the D_2,5 statistic is calculated as 0.4 correctly, but the
>>> p-value is stated by R as 1, though in fact it should be 20/21=0.9524
>> 
>> 
>> What we seem to have here is a rounding error problem.
>> 
>> In ks.c:psmirnov2x,  there is a double loop including
>> 	    if(fabs(i / md - j / nd) > q)
>> 		u[j] = 0;
>> 
>> where md=2, nd=5, and q=3/10.
>> 
>> Now,  to full precision  abs(1/2 - 4/5) > 3/10 is false, but at least on my 
>> MacBook it is true in C double precision.
>> 
>> I'm not sure why the loop is working with doubles, since multiplying by m*n 
>> should make everything an integer.
>> 
>>     -thomas
>> 
>> Thomas Lumley			Assoc. Professor, Biostatistics
>> tlumley at u.washington.edu	University of Washington, Seattle
>> 
>> 
>> 
>

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From tlumley at u.washington.edu  Fri Dec 18 17:30:09 2009
From: tlumley at u.washington.edu (tlumley at u.washington.edu)
Date: Fri, 18 Dec 2009 17:30:09 +0100 (CET)
Subject: [Rd] apparently incorrect p-values from 2-sided
	Kolmogorov-Smirnov (PR#14158)
Message-ID: <20091218163009.F045E2830316@mail.pubhealth.ku.dk>



I've fixed this by adding 0.5/mn to q.  The problem (at least in principle) with multiplying them all up is integer overflow.

By the time 0.5/mn underflows to zero, missing one value in the distribution won't matter.

      -thomas


On Fri, 18 Dec 2009, David John Allwright wrote:

> Dear Thomas, Right, thank you. Yes, I haven't looked at the source code 
> (because I don't know C) but something like what you mention could well cause 
> the kind of problems I am seeing: a loop being exectued one too few or one 
> too many times. And yes, I think those quantities should be multiplied up by 
> m*n to all become integers so we escape rounding error problems. David.
> ------------------------------------------------------------------------------
> On Wed, 16 Dec 2009, tlumley at u.washington.edu wrote:
>
>> On Tue, 15 Dec 2009, allwrigh at maths.ox.ac.uk wrote; (in part)
>> 
>>> 
>>> x<-1:5
>>> y<-c(2.5,4.5)
>>> ks.test(x,y)
>>> 
>>> The value of the D_2,5 statistic is calculated as 0.4 correctly, but the
>>> p-value is stated by R as 1, though in fact it should be 20/21=0.9524
>> 
>> 
>> What we seem to have here is a rounding error problem.
>> 
>> In ks.c:psmirnov2x,  there is a double loop including
>> 	    if(fabs(i / md - j / nd) > q)
>> 		u[j] = 0;
>> 
>> where md=2, nd=5, and q=3/10.
>> 
>> Now,  to full precision  abs(1/2 - 4/5) > 3/10 is false, but at least on my 
>> MacBook it is true in C double precision.
>> 
>> I'm not sure why the loop is working with doubles, since multiplying by m*n 
>> should make everything an integer.
>> 
>>     -thomas
>> 
>> Thomas Lumley			Assoc. Professor, Biostatistics
>> tlumley at u.washington.edu	University of Washington, Seattle
>> 
>> 
>> 
>

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From allwrigh at maths.ox.ac.uk  Fri Dec 18 13:40:10 2009
From: allwrigh at maths.ox.ac.uk (allwrigh at maths.ox.ac.uk)
Date: Fri, 18 Dec 2009 13:40:10 +0100 (CET)
Subject: [Rd] apparently incorrect p-values from 2-sided
	Kolmogorov-Smirnov (PR#14157)
Message-ID: <20091218124011.03E15282EF4F@mail.pubhealth.ku.dk>

Dear Thomas, Right, thank you. Yes, I haven't looked at the source code 
(because I don't know C) but something like what you mention could 
well cause the kind of problems I am seeing: a loop being exectued one too 
few or one too many times. And yes, I think those quantities should be 
multiplied up by m*n to all become integers so we escape rounding error 
problems. David.
------------------------------------------------------------------------------
On Wed, 16 Dec 2009, tlumley at u.washington.edu wrote:

> On Tue, 15 Dec 2009, allwrigh at maths.ox.ac.uk wrote; (in part)
>
>> 
>> x<-1:5
>> y<-c(2.5,4.5)
>> ks.test(x,y)
>> 
>> The value of the D_2,5 statistic is calculated as 0.4 correctly, but the
>> p-value is stated by R as 1, though in fact it should be 20/21=0.9524
>
>
> What we seem to have here is a rounding error problem.
>
> In ks.c:psmirnov2x,  there is a double loop including
> 	    if(fabs(i / md - j / nd) > q)
> 		u[j] = 0;
>
> where md=2, nd=5, and q=3/10.
>
> Now,  to full precision  abs(1/2 - 4/5) > 3/10 is false, but at least on my 
> MacBook it is true in C double precision.
>
> I'm not sure why the loop is working with doubles, since multiplying by m*n 
> should make everything an integer.
>
>     -thomas
>
> Thomas Lumley			Assoc. Professor, Biostatistics
> tlumley at u.washington.edu	University of Washington, Seattle
>
>
>


From macrakis at alum.mit.edu  Fri Dec 18 20:07:08 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Fri, 18 Dec 2009 14:07:08 -0500
Subject: [Rd] Vectorized switch
Message-ID: <8b356f880912181107g7a7295fch9d26f2161d049404@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091218/74a441ee/attachment.pl>

From gmbecker at ucdavis.edu  Fri Dec 18 20:34:06 2009
From: gmbecker at ucdavis.edu (Gabriel Becker)
Date: Fri, 18 Dec 2009 11:34:06 -0800
Subject: [Rd] Vectorized switch
In-Reply-To: <8b356f880912181107g7a7295fch9d26f2161d049404@mail.gmail.com>
References: <8b356f880912181107g7a7295fch9d26f2161d049404@mail.gmail.com>
Message-ID: <c797fbfb0912181134o621f6501t62e2dba5b813cbf1@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091218/9b1781fe/attachment.pl>

From wdunlap at tibco.com  Fri Dec 18 20:39:41 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Fri, 18 Dec 2009 11:39:41 -0800
Subject: [Rd] Vectorized switch
In-Reply-To: <8b356f880912181107g7a7295fch9d26f2161d049404@mail.gmail.com>
References: <8b356f880912181107g7a7295fch9d26f2161d049404@mail.gmail.com>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D7000243D669@NA-PA-VBE03.na.tibco.com>

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Stavros Macrakis
> Sent: Friday, December 18, 2009 11:07 AM
> To: r-devel at r-project.org
> Subject: [Rd] Vectorized switch
> 
> What is the 'idiomatic' way of writing a vectorized switch statement?
> 
> That is, I would like to write, e.g.,
> 
>          vswitch( c('a','x','b','a'),
>                       a= 1:4,
>                       b=11:14,
>                       100 )
>           => c(1, 100, 13, 4 )
> 
> equivalent to
> 
>         ifelse( c('a','x','b','a') == 'a', 1:4,
>                    ifelse( c('a','x','b','a') == 'b', 11:14,
>                               100 ) )
> 
> A simple way of doing this is (leaving aside the default case):
> 
>        colchoose <- function(frame,selector)
>            
> mapply(function(a,b)frame[a,b],seq_along(frame[1]),selector))
> 
>       colchoose( data.frame(a=1:4,b=11:14), c('a','b','b','a'))
>            => c(1,11,11,1)

I thought you would want c(1,12,13,4), not c(1,11,11,1),
out of this call.  Perhaps I misunderstand your requirements.

However, if you want c(1,12,13,4) one approach is to use
a 2-column matrix of integers as the subscript into the
main matrix (or data.frame).  E.g.,

  > f1<-function(frame, selector) {
        selector <- match(selector, colnames(frame))
        frame[cbind(seq_along(selector), selector)]
    }
  > f1(data.frame(a=1:4,b=11:14), c('a','b','b','a'))
  [1]  1 12 13  4
  > f1(cbind(a=1:4,b=11:14), c('a','b','b','a'))
  [1]  1 12 13  4

A looping approach that did not use repeated calls to
[.data.frame should also be pretty quick.  E.g.,

  f2 <- function (namedList, selector) {
      result <- namedList[[1]] # just to get class and length right
      for (n in unique(selector)) {
          i <- n == selector
          result[i] <- namedList[[n]][i]
      }
      result
  }
  > f2(list(a=1:4,b=11:14), c('a','b','b','a'))
  [1]  1 12 13  4

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com 

> 
> But of course this is not very efficient compared to the way 
> ifelse works.
> 
> Is there a standard function or idiom for this (am I missing something
> obvious?), or should I write my own?
> 
>              -s
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From macrakis at alum.mit.edu  Fri Dec 18 20:48:12 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Fri, 18 Dec 2009 14:48:12 -0500
Subject: [Rd] Vectorized switch
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D7000243D669@NA-PA-VBE03.na.tibco.com>
References: <8b356f880912181107g7a7295fch9d26f2161d049404@mail.gmail.com>
	<77EB52C6DD32BA4D87471DCD70C8D7000243D669@NA-PA-VBE03.na.tibco.com>
Message-ID: <8b356f880912181148y4b801068vd09fadbfa7935cff@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091218/f815e76c/attachment.pl>

From tlumley at u.washington.edu  Fri Dec 18 20:49:30 2009
From: tlumley at u.washington.edu (tlumley at u.washington.edu)
Date: Fri, 18 Dec 2009 11:49:30 -0800 (PST)
Subject: [Rd] Vectorized switch
In-Reply-To: <c797fbfb0912181134o621f6501t62e2dba5b813cbf1@mail.gmail.com>
Message-ID: <alpine.LRH.2.01.0912181149300.16373@hymn13.u.washington.edu>

On Fri, 18 Dec 2009, Gabriel Becker wrote:

> My understanding is that all the really fast vectorized operations are
> implemented down in C code, not in R. Thus if you wanted to write a
> vectorized switch, which I agree would be rather nice to have, you'd need to
> do it down there and then write a .Call wrapper for it in R.
>
> The ifelse (C) code would probably be a good place to start looking in terms
> of how to write it.

Gabe: ifelse() is not in C, nor is it really fast (though it is better than it used to be).

Stavros: I don't think there is a standard idiom.  I tend to use match() to work out which choice applies for each element, or nested ifelse if there are only three choices.

       -thomas

> Gabe
>
> On Fri, Dec 18, 2009 at 11:07 AM, Stavros Macrakis <macrakis at alum.mit.edu>wrote:
>
>> What is the 'idiomatic' way of writing a vectorized switch statement?
>>
>> That is, I would like to write, e.g.,
>>
>>         vswitch( c('a','x','b','a'),
>>                      a= 1:4,
>>                      b=11:14,
>>                      100 )
>>          => c(1, 100, 13, 4 )
>>
>> equivalent to
>>
>>        ifelse( c('a','x','b','a') == 'a', 1:4,
>>                   ifelse( c('a','x','b','a') == 'b', 11:14,
>>                              100 ) )
>>
>> A simple way of doing this is (leaving aside the default case):
>>
>>       colchoose <- function(frame,selector)
>>           mapply(function(a,b)frame[a,b],seq_along(frame[1]),selector))
>>
>>      colchoose( data.frame(a=1:4,b=11:14), c('a','b','b','a'))
>>           => c(1,11,11,1)
>>
>> But of course this is not very efficient compared to the way ifelse works.
>>
>> Is there a standard function or idiom for this (am I missing something
>> obvious?), or should I write my own?
>>
>>             -s
>>
>>        [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From gmbecker at ucdavis.edu  Fri Dec 18 21:45:42 2009
From: gmbecker at ucdavis.edu (Gabriel Becker)
Date: Fri, 18 Dec 2009 12:45:42 -0800
Subject: [Rd] Vectorized switch
In-Reply-To: <alpine.LRH.2.01.0912181149300.16373@hymn13.u.washington.edu>
References: <c797fbfb0912181134o621f6501t62e2dba5b813cbf1@mail.gmail.com>
	<alpine.LRH.2.01.0912181149300.16373@hymn13.u.washington.edu>
Message-ID: <c797fbfb0912181245m65b02205q19f45d31489c41f6@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091218/585e9834/attachment.pl>

From baptiste.auguie at googlemail.com  Sat Dec 19 10:12:02 2009
From: baptiste.auguie at googlemail.com (baptiste auguie)
Date: Sat, 19 Dec 2009 10:12:02 +0100
Subject: [Rd] incorrect linetype with pdf device (PR#14128)
In-Reply-To: <de4e29f50912170522ka82a70n4d081426f4d489a9@mail.gmail.com>
References: <de4e29f50912170522ka82a70n4d081426f4d489a9@mail.gmail.com>
Message-ID: <de4e29f50912190112y5b627a5fqe239a5a695755aef@mail.gmail.com>

Dear all,

Running this minimal example,

library(grid)
postscript("test-123456.eps")
grid.newpage()
grid.lines(gp=gpar(lty="123456", lineend = "butt"))
dev.off()

produces eps output with the following setdash description towards the
end of the file,

## [ 0.00 3.00 2.00 5.00 4.00 7.00] 0 setdash

I consulted the postscript reference manual (page 667 *), which
indicates that the array should rather be [1 2 3 4 5 6] as intended
(and as produced by, e.g., quartz())

(*): http://www.adobe.com/products/postscript/pdfs/PLRM.pdf

Regards,

baptiste


From maechler at stat.math.ethz.ch  Sat Dec 19 15:01:37 2009
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Sat, 19 Dec 2009 15:01:37 +0100 (CET)
Subject: [Rd] ?setGeneric garbled (PR#14153)
Message-ID: <20091219140137.4F3CB282EF2D@mail.pubhealth.ku.dk>

>>>>> "DM" == Duncan Murdoch <murdoch at stats.uwo.ca>
>>>>>     on Fri, 18 Dec 2009 15:03:26 -0500 writes:

    DM> On 18/12/2009 1:15 PM, Duncan Murdoch wrote:
    >> On 18/12/2009 12:54 PM, Martin Maechler wrote:
    >>>>>>>> Martin Morgan <mtmorgan at fhcrc.org>
    >>>>>>>> on Fri, 18 Dec 2009 07:40:13 -0800 writes:
    >>> > Martin Maechler wrote:
    >>> >>>>>>> Martin Morgan <mtmorgan at fhcrc.org>
    >>> >>>>>>> on Thu, 17 Dec 2009 09:54:54 -0800 writes:
    >>> >> 
    >>> >> > Ross Boylan wrote:
    >>> >> >> On Thu, 2009-12-17 at 15:24 +0100, Martin Maechler wrote:
    >>> >> >>>>>>>> Ross Boylan <ross at biostat.ucsf.edu>
    >>> >> >>>>>>>> on Thu, 17 Dec 2009 02:15:12 +0100 (CET) writes:
    >>> >> >>> > Full_Name: Ross Boylan
    >>> >> >>> > Version: 2.10.0
    >>> >> >>> > OS: Windows XP
    >>> >> >>> > Submission from: (NULL) (198.144.201.14)
    >>> >> 
    >>> 
    >>> >> >>> > Some of the help for setGeneric seems to have been garbled.  In the section
    >>> >> >>> > "Basic Use", 5th paragraph (where the example counts as a single line 3rd
    >>> >> >>> > paragraph) it says
    >>> >> >>> > <quote>
    >>> >> >>> > Note that calling 'setGeneric()' in this form is not strictly
    >>> >> >>> > necessary before calling 'setMethod()' for the same function.  If
    >>> >> >>> > the function specified in the call to 'setMethod' is not generic,
    >>> >> >>> > 'setMethod' will execute the call to 'setGeneric' itself.
    >>> >> >>> > Declaring explicitly that you want the function to be generic can
    >>> >> >>> > be considered better programming style; the only difference in the
    >>> >> >>> > result, however, is that not doing so produces a You cannot (and
    >>> >> >>> > never need to) create an explicit generic version of the primitive
    >>> >> >>> > functions in the base package.
    >>> >> >>> > <quote>
    >>> >> >>> 
    >>> >> >>> > The stuff after the semi-colon of the final sentence is garbled, or at least
    >>> >> >>> > unparseable by me.  Probably something got deleted by mistake.
    >>> >> >>> 
    >>> >> >> 
    >>> >> >> The last sentence of this paragraph is also garbled:
    >>> >> >> <quote>
    >>> >> >> The description above is the effect when the package that owns the
    >>> >> >> non-generic function has not created an implicit generic version.
    >>> >> >> Otherwise, it is this implicit generic function that is us_same_
    >>> >> >> version of the generic function will be created each time.
    >>> >> >> </quote>
    >>> >> 
    >>> >> > Off-list, I guess both of these paragraphs have very long lines in the
    >>> >> > source; maybe your emacs is truncating lines instead of wrapping, or
    >>> >> > something similar?
    >>> >> 
    >>> >> Thank you, Martin, but no, we never have very long lines in the
    >>> >> R sources (and  *.Rd files belong to the sources),
    >>> >> and then translation of the *.Rd file to a "data base" of
    >>> >> text-help entries should keep newlines.
    >>> 
    >>> > I meant that they _are_ very long in the source. Martin
    >>> 
    >>> Oh dear, yes indeed, you are right!
    >>> 
    >>> So, astonishing as that may be, indeed for the 'text' version of
    >>> help, it seems that ... under some circumstances ...
    >>> the  (NAMESPACE-hidden) method
    >>> utils:::print.help_files_with_topic()
    >>> 
    >>> which ends up calling file.show() :
    >>> 
    >>> if (file.exists(paste(RdDB, "rdx", sep = "."))) {
    >>> temp <- tools::Rd2txt(tools:::fetchRdDB(RdDB, 
    >>> basename(file)), out = tempfile("Rtxt"), package = pkgname)
    >>> file.show(temp, title = gettextf("R Help on '%s'", 
    >>> topic), delete.file = TRUE)
    >>> }
    >>> 
    >>> 
    >>> *is* still influenced by the original *.Rd file's (lack) of new
    >>> lines, somewhat astonishingly to me.
    >>> 
    >>> Even more, I cannot understand that other people do not see the
    >>> same phenomenon (though maybe they would if they cared to notice...),
    >>> and also that you only get the "garbling" problem with ESS, and
    >>> only for R version 2.10, but not 2.8. 
    >>> Did our  'Rd2txt()' change here on purpose?
    >>> 
    >> 
    >> I seem to recall fixing a bug in the line wrapping code, but I can't 
    >> spot it in a quick glance over the log.  Maybe I forgot to commit the 
    >> fix?  I can't look into this now, but I'll follow up later.

    DM> The patch I recalled did get committed on November 8, with this NEWS entry:

	
    DM> o	Text help rendering did not handle very long input lines
    DM> properly.


    DM> So it made it into 2.10.1.  Do you still see the problem there?  I don't 
    DM> see it in text help for setGeneric in the Windows gui.

    DM> Duncan Murdoch

I think it was never a problem in the GUI, 
however when using ESS.

For some reason, I did overlook that Ross was talking about
Windows.  I had never checked it on Windows,
but did now {using our Windows terminal server}.

Indeed:  R 2.10.0  with ESS shows the problem Ross found
	 R 2.10.1  with ESS *NO LONGER* shows the problem.

--> I'm CC'ing R-bugs,  as this bug report
    	 ... an R bug after all  ..
    can be closed.

Thanks to all helpers!
Martin Maechler, ETH Zurich


From murdoch at stats.uwo.ca  Sat Dec 19 16:05:30 2009
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Sat, 19 Dec 2009 16:05:30 +0100 (CET)
Subject: [Rd] ?setGeneric garbled (PR#14153)
Message-ID: <20091219150530.5547F283031E@mail.pubhealth.ku.dk>

On 19/12/2009 8:56 AM, Martin Maechler wrote:
>>>>>> "DM" == Duncan Murdoch <murdoch at stats.uwo.ca>
>>>>>>     on Fri, 18 Dec 2009 15:03:26 -0500 writes:
> 
>     DM> On 18/12/2009 1:15 PM, Duncan Murdoch wrote:
>     >> On 18/12/2009 12:54 PM, Martin Maechler wrote:
>     >>>>>>>> Martin Morgan <mtmorgan at fhcrc.org>
>     >>>>>>>> on Fri, 18 Dec 2009 07:40:13 -0800 writes:
>     >>> > Martin Maechler wrote:
>     >>> >>>>>>> Martin Morgan <mtmorgan at fhcrc.org>
>     >>> >>>>>>> on Thu, 17 Dec 2009 09:54:54 -0800 writes:
>     >>> >> 
>     >>> >> > Ross Boylan wrote:
>     >>> >> >> On Thu, 2009-12-17 at 15:24 +0100, Martin Maechler wrote:
>     >>> >> >>>>>>>> Ross Boylan <ross at biostat.ucsf.edu>
>     >>> >> >>>>>>>> on Thu, 17 Dec 2009 02:15:12 +0100 (CET) writes:
>     >>> >> >>> > Full_Name: Ross Boylan
>     >>> >> >>> > Version: 2.10.0
>     >>> >> >>> > OS: Windows XP
>     >>> >> >>> > Submission from: (NULL) (198.144.201.14)
>     >>> >> 
>     >>> 
>     >>> >> >>> > Some of the help for setGeneric seems to have been garbled.  In the section
>     >>> >> >>> > "Basic Use", 5th paragraph (where the example counts as a single line 3rd
>     >>> >> >>> > paragraph) it says
>     >>> >> >>> > <quote>
>     >>> >> >>> > Note that calling 'setGeneric()' in this form is not strictly
>     >>> >> >>> > necessary before calling 'setMethod()' for the same function.  If
>     >>> >> >>> > the function specified in the call to 'setMethod' is not generic,
>     >>> >> >>> > 'setMethod' will execute the call to 'setGeneric' itself.
>     >>> >> >>> > Declaring explicitly that you want the function to be generic can
>     >>> >> >>> > be considered better programming style; the only difference in the
>     >>> >> >>> > result, however, is that not doing so produces a You cannot (and
>     >>> >> >>> > never need to) create an explicit generic version of the primitive
>     >>> >> >>> > functions in the base package.
>     >>> >> >>> > <quote>
>     >>> >> >>> 
>     >>> >> >>> > The stuff after the semi-colon of the final sentence is garbled, or at least
>     >>> >> >>> > unparseable by me.  Probably something got deleted by mistake.
>     >>> >> >>> 
>     >>> >> >> 
>     >>> >> >> The last sentence of this paragraph is also garbled:
>     >>> >> >> <quote>
>     >>> >> >> The description above is the effect when the package that owns the
>     >>> >> >> non-generic function has not created an implicit generic version.
>     >>> >> >> Otherwise, it is this implicit generic function that is us_same_
>     >>> >> >> version of the generic function will be created each time.
>     >>> >> >> </quote>
>     >>> >> 
>     >>> >> > Off-list, I guess both of these paragraphs have very long lines in the
>     >>> >> > source; maybe your emacs is truncating lines instead of wrapping, or
>     >>> >> > something similar?
>     >>> >> 
>     >>> >> Thank you, Martin, but no, we never have very long lines in the
>     >>> >> R sources (and  *.Rd files belong to the sources),
>     >>> >> and then translation of the *.Rd file to a "data base" of
>     >>> >> text-help entries should keep newlines.
>     >>> 
>     >>> > I meant that they _are_ very long in the source. Martin
>     >>> 
>     >>> Oh dear, yes indeed, you are right!
>     >>> 
>     >>> So, astonishing as that may be, indeed for the 'text' version of
>     >>> help, it seems that ... under some circumstances ...
>     >>> the  (NAMESPACE-hidden) method
>     >>> utils:::print.help_files_with_topic()
>     >>> 
>     >>> which ends up calling file.show() :
>     >>> 
>     >>> if (file.exists(paste(RdDB, "rdx", sep = "."))) {
>     >>> temp <- tools::Rd2txt(tools:::fetchRdDB(RdDB, 
>     >>> basename(file)), out = tempfile("Rtxt"), package = pkgname)
>     >>> file.show(temp, title = gettextf("R Help on '%s'", 
>     >>> topic), delete.file = TRUE)
>     >>> }
>     >>> 
>     >>> 
>     >>> *is* still influenced by the original *.Rd file's (lack) of new
>     >>> lines, somewhat astonishingly to me.
>     >>> 
>     >>> Even more, I cannot understand that other people do not see the
>     >>> same phenomenon (though maybe they would if they cared to notice...),
>     >>> and also that you only get the "garbling" problem with ESS, and
>     >>> only for R version 2.10, but not 2.8. 
>     >>> Did our  'Rd2txt()' change here on purpose?
>     >>> 
>     >> 
>     >> I seem to recall fixing a bug in the line wrapping code, but I can't 
>     >> spot it in a quick glance over the log.  Maybe I forgot to commit the 
>     >> fix?  I can't look into this now, but I'll follow up later.
> 
>     DM> The patch I recalled did get committed on November 8, with this NEWS entry:
> 
> 	
>     DM> o	Text help rendering did not handle very long input lines
>     DM> properly.
> 
> 
>     DM> So it made it into 2.10.1.  Do you still see the problem there?  I don't 
>     DM> see it in text help for setGeneric in the Windows gui.
> 
>     DM> Duncan Murdoch
> 
> I think it was never a problem in the GUI, 
> however when using ESS.

It was simply a problem of Rd2txt in 2.10.0, and appeared wherever that 
was used: in the GUI, in Rterm, whatever.  The bug report was about an 
obsolete version.

Duncan Murdoch

> 
> For some reason, I did overlook that Ross was talking about
> Windows.  I had never checked it on Windows,
> but did now {using our Windows terminal server}.
> 
> Indeed:  R 2.10.0  with ESS shows the problem Ross found
> 	 R 2.10.1  with ESS *NO LONGER* shows the problem.
> 
> --> I'm CC'ing R-bugs,  as this bug report
>     	 ... an R bug after all  ..
>     can be closed.
> 
> Thanks to all helpers!
> Martin Maechler, ETH Zurich


From ross at biostat.ucsf.edu  Sat Dec 19 20:55:27 2009
From: ross at biostat.ucsf.edu (ross at biostat.ucsf.edu)
Date: Sat, 19 Dec 2009 20:55:27 +0100 (CET)
Subject: [Rd] ?setGeneric garbled (PR#14153)
Message-ID: <20091219195528.01065282EF42@mail.pubhealth.ku.dk>

I confirm that R 2.10.1 fixes the problem under ESS 5.7.1 on Windows XP.

See below for one more comment.

On Sat, 2009-12-19 at 10:03 -0500, Duncan Murdoch wrote:
> On 19/12/2009 8:56 AM, Martin Maechler wrote:
> >>>>>> "DM" == Duncan Murdoch <murdoch at stats.uwo.ca>
> >>>>>>     on Fri, 18 Dec 2009 15:03:26 -0500 writes:
> > 
> >     DM> On 18/12/2009 1:15 PM, Duncan Murdoch wrote:
> >     >> On 18/12/2009 12:54 PM, Martin Maechler wrote:
> >     >>>>>>>> Martin Morgan <mtmorgan at fhcrc.org>
> >     >>>>>>>> on Fri, 18 Dec 2009 07:40:13 -0800 writes:
> >     >>> > Martin Maechler wrote:
> >     >>> >>>>>>> Martin Morgan <mtmorgan at fhcrc.org>
> >     >>> >>>>>>> on Thu, 17 Dec 2009 09:54:54 -0800 writes:
> >     >>> >> 
> >     >>> >> > Ross Boylan wrote:
> >     >>> >> >> On Thu, 2009-12-17 at 15:24 +0100, Martin Maechler wrote:
> >     >>> >> >>>>>>>> Ross Boylan <ross at biostat.ucsf.edu>
> >     >>> >> >>>>>>>> on Thu, 17 Dec 2009 02:15:12 +0100 (CET) writes:
> >     >>> >> >>> > Full_Name: Ross Boylan
> >     >>> >> >>> > Version: 2.10.0
> >     >>> >> >>> > OS: Windows XP
> >     >>> >> >>> > Submission from: (NULL) (198.144.201.14)
> >     >>> >> 
> >     >>> 
> >     >>> >> >>> > Some of the help for setGeneric seems to have been garbled.  In the section
> >     >>> >> >>> > "Basic Use", 5th paragraph (where the example counts as a single line 3rd
> >     >>> >> >>> > paragraph) it says
> >     >>> >> >>> > <quote>
> >     >>> >> >>> > Note that calling 'setGeneric()' in this form is not strictly
> >     >>> >> >>> > necessary before calling 'setMethod()' for the same function.  If
> >     >>> >> >>> > the function specified in the call to 'setMethod' is not generic,
> >     >>> >> >>> > 'setMethod' will execute the call to 'setGeneric' itself.
> >     >>> >> >>> > Declaring explicitly that you want the function to be generic can
> >     >>> >> >>> > be considered better programming style; the only difference in the
> >     >>> >> >>> > result, however, is that not doing so produces a You cannot (and
> >     >>> >> >>> > never need to) create an explicit generic version of the primitive
> >     >>> >> >>> > functions in the base package.
> >     >>> >> >>> > <quote>
> >     >>> >> >>> 
> >     >>> >> >>> > The stuff after the semi-colon of the final sentence is garbled, or at least
> >     >>> >> >>> > unparseable by me.  Probably something got deleted by mistake.
> >     >>> >> >>> 
> >     >>> >> >> 
> >     >>> >> >> The last sentence of this paragraph is also garbled:
> >     >>> >> >> <quote>
> >     >>> >> >> The description above is the effect when the package that owns the
> >     >>> >> >> non-generic function has not created an implicit generic version.
> >     >>> >> >> Otherwise, it is this implicit generic function that is us_same_
> >     >>> >> >> version of the generic function will be created each time.
> >     >>> >> >> </quote>
> >     >>> >> 
> >     >>> >> > Off-list, I guess both of these paragraphs have very long lines in the
> >     >>> >> > source; maybe your emacs is truncating lines instead of wrapping, or
> >     >>> >> > something similar?
> >     >>> >> 
> >     >>> >> Thank you, Martin, but no, we never have very long lines in the
> >     >>> >> R sources (and  *.Rd files belong to the sources),
> >     >>> >> and then translation of the *.Rd file to a "data base" of
> >     >>> >> text-help entries should keep newlines.
> >     >>> 
> >     >>> > I meant that they _are_ very long in the source. Martin
> >     >>> 
> >     >>> Oh dear, yes indeed, you are right!
> >     >>> 
> >     >>> So, astonishing as that may be, indeed for the 'text' version of
> >     >>> help, it seems that ... under some circumstances ...
> >     >>> the  (NAMESPACE-hidden) method
> >     >>> utils:::print.help_files_with_topic()
> >     >>> 
> >     >>> which ends up calling file.show() :
> >     >>> 
> >     >>> if (file.exists(paste(RdDB, "rdx", sep = "."))) {
> >     >>> temp <- tools::Rd2txt(tools:::fetchRdDB(RdDB, 
> >     >>> basename(file)), out = tempfile("Rtxt"), package = pkgname)
> >     >>> file.show(temp, title = gettextf("R Help on '%s'", 
> >     >>> topic), delete.file = TRUE)
> >     >>> }
> >     >>> 
> >     >>> 
> >     >>> *is* still influenced by the original *.Rd file's (lack) of new
> >     >>> lines, somewhat astonishingly to me.
> >     >>> 
> >     >>> Even more, I cannot understand that other people do not see the
> >     >>> same phenomenon (though maybe they would if they cared to notice...),
> >     >>> and also that you only get the "garbling" problem with ESS, and
> >     >>> only for R version 2.10, but not 2.8. 
> >     >>> Did our  'Rd2txt()' change here on purpose?
> >     >>> 
> >     >> 
> >     >> I seem to recall fixing a bug in the line wrapping code, but I can't 
> >     >> spot it in a quick glance over the log.  Maybe I forgot to commit the 
> >     >> fix?  I can't look into this now, but I'll follow up later.
> > 
> >     DM> The patch I recalled did get committed on November 8, with this NEWS entry:
> > 
> > 	
> >     DM> o	Text help rendering did not handle very long input lines
> >     DM> properly.
> > 
> > 
> >     DM> So it made it into 2.10.1.  Do you still see the problem there?  I don't 
> >     DM> see it in text help for setGeneric in the Windows gui.
> > 
> >     DM> Duncan Murdoch
> > 
> > I think it was never a problem in the GUI, 
> > however when using ESS.
> 
> It was simply a problem of Rd2txt in 2.10.0, and appeared wherever that 
> was used: in the GUI, in Rterm, whatever.  
It did not appear for me when using the standard R GUI launched from the
icon for R on the desktop.

> The bug report was about an 
> obsolete version.
> 
> Duncan Murdoch
> 
> > 
> > For some reason, I did overlook that Ross was talking about
> > Windows.  I had never checked it on Windows,
> > but did now {using our Windows terminal server}.
> > 
> > Indeed:  R 2.10.0  with ESS shows the problem Ross found
> > 	 R 2.10.1  with ESS *NO LONGER* shows the problem.
> > 
> > --> I'm CC'ing R-bugs,  as this bug report
> >     	 ... an R bug after all  ..
> >     can be closed.
> > 
> > Thanks to all helpers!
> > Martin Maechler, ETH Zurich
>


From maechler at stat.math.ethz.ch  Sat Dec 19 22:02:49 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 19 Dec 2009 22:02:49 +0100
Subject: [Rd] choose(n,k) when n is almost integer
In-Reply-To: <20091217231449.GA23480@cs.cas.cz>
References: <19239.19864.396771.484772@lynne.math.ethz.ch>
	<20091215095243.GA14388@cs.cas.cz>
	<19239.38154.219034.206322@lynne.math.ethz.ch>
	<19242.15337.267242.128687@lynne.math.ethz.ch>
	<20091217231449.GA23480@cs.cas.cz>
Message-ID: <19245.16249.290239.986122@cmath-6.math.ethz.ch>

{I've changed the subject;  it's really no longer about
 lchoose()'s definition}

>>>>> Petr Savicky <savicky at cs.cas.cz>
>>>>>     on Fri, 18 Dec 2009 00:14:49 +0100 writes:

    > On Thu, Dec 17, 2009 at 03:10:49PM +0100, Martin Maechler wrote:
    > [...]
    MM> This, of course, is an even more compelling reason to implement
    MM> the change of return  log(abs(choose(.,.)),
    MM> and at the moment, I'd even plan to "backport" that to R "2.10.1
    MM> patched", as the current behavior is clearly bugous.
    >> 
    >> This has now happened;
    >> svn revisions  50775 and 50776  {R-devel and R-patched}.

    > Thank you.

    > When preparing a test, whether lchoose(n, k) \approx log(abs(choose(n, k))), it
    > appeared that there is a minor problem also in choose(n, k), when n is very close
    > to k, but not equal.

    > options(digits=15)
    > n <- 5 + (-15:15)*1e-8
    > cbind(n, choose(n, 5))
    > #                n                  
    > #  [1,] 4.99999985 0.999999657500042
    > #  [2,] 4.99999986 0.999999680333370
    > #  [3,] 4.99999987 0.999999703166698
    > #  [4,] 4.99999988 0.999999726000027
    > #  [5,] 4.99999989 0.999999748833356
    > #  [6,] 4.99999990 0.999999771666685
    > #  [7,] 4.99999991 0.000000000000000
    > #  [8,] 4.99999992 0.000000000000000
    > #  [9,] 4.99999993 0.000000000000000
    > # [10,] 4.99999994 0.000000000000000
    > # [11,] 4.99999995 0.000000000000000
    > # [12,] 4.99999996 0.000000000000000
    > # [13,] 4.99999997 0.000000000000000
    > # [14,] 4.99999998 0.000000000000000
    > # [15,] 4.99999999 0.000000000000000
    > # [16,] 5.00000000 1.000000000000000
    > # [17,] 5.00000001 5.000000000000000
    > # [18,] 5.00000002 5.000000000000000
    > # [19,] 5.00000003 5.000000000000000
    > # [20,] 5.00000004 5.000000000000000
    > # [21,] 5.00000005 5.000000000000000
    > # [22,] 5.00000006 5.000000000000000
    > # [23,] 5.00000007 5.000000000000000
    > # [24,] 5.00000008 5.000000000000000
    > # [25,] 5.00000009 5.000000000000000
    > # [26,] 5.00000010 1.000000228333353
    > # [27,] 5.00000011 1.000000251166690
    > # [28,] 5.00000012 1.000000274000027
    > # [29,] 5.00000013 1.000000296833365
    > # [30,] 5.00000014 1.000000319666704
    > # [31,] 5.00000015 1.000000342500042

    > All the values in the second column should be close to 1, but some are 0 and
    > some are 5. The reason seems to be in the line 112 of src/nmath/choose.c,
    > which is
    > if(n-k < k && n >= 0 && R_IS_INT(n)) k = n-k; /* <- Symmetry */
    > If n is not exactly an integer, then k becomes also non-integer. 
    > Since the code relies on k being an exact integer, we get an error
    > as follows.

    > If n = k - eps for a small positive eps, then the next line 113
    > if (k <  0) return 0.;
    > determines the output since k is now - eps.

    > If n = k + eps for a small positive eps, then the line 116
    > r = n;
    > determines the output, since now k = eps, so the condition j <= k is not 
    > satisfied already at the beginning of the next cycle.

    > I suggest two solutions, a more conservative one and a less conservative one.

    > A more conservative solution is to replace the line 112 by
    > if(n-k < k && n >= 0 && R_IS_INT(n)) k = floor(n - k + 0.5); /* <- Symmetry */
    > This yields the following in the same test as above.

    > #                n                  
    > #  [1,] 4.99999985 0.999999657500042
    > #  [2,] 4.99999986 0.999999680333370
    > #  [3,] 4.99999987 0.999999703166698
    > #  [4,] 4.99999988 0.999999726000027
    > #  [5,] 4.99999989 0.999999748833356
    > #  [6,] 4.99999990 0.999999771666685
    > #  [7,] 4.99999991 1.000000000000000
    > #  [8,] 4.99999992 1.000000000000000
    > #  [9,] 4.99999993 1.000000000000000
    > # [10,] 4.99999994 1.000000000000000
    > # [11,] 4.99999995 1.000000000000000
    > # [12,] 4.99999996 1.000000000000000
    > # [13,] 4.99999997 1.000000000000000
    > # [14,] 4.99999998 1.000000000000000
    > # [15,] 4.99999999 1.000000000000000
    > # [16,] 5.00000000 1.000000000000000
    > # [17,] 5.00000001 1.000000000000000
    > # [18,] 5.00000002 1.000000000000000
    > # [19,] 5.00000003 1.000000000000000
    > # [20,] 5.00000004 1.000000000000000
    > # [21,] 5.00000005 1.000000000000000
    > # [22,] 5.00000006 1.000000000000000
    > # [23,] 5.00000007 1.000000000000000
    > # [24,] 5.00000008 1.000000000000000
    > # [25,] 5.00000009 1.000000000000000
    > # [26,] 5.00000010 1.000000228333353
    > # [27,] 5.00000011 1.000000251166690
    > # [28,] 5.00000012 1.000000274000027
    > # [29,] 5.00000013 1.000000296833365
    > # [30,] 5.00000014 1.000000319666704
    > # [31,] 5.00000015 1.000000342500042

    > So, the extreme values 0 and 5 do not occur, but there is an interval
    > of constant values and on both ends of this interval, there is a jump
    > much larger than machine accuracy.

    > A less conservative solution (a patch is in an attachment) replaces
    > lines 110 - 121 by

    > if (k < k_small_max) {
    > int j;
    > if(n-k < k && n >= 0 && (n == floor(n))) k = n-k; /* <- Symmetry */
    > if (k <  0) return 0.;
    > if (k == 0) return 1.;
    > /* else: k >= 1 */
    > r = n;
    > for(j = 2; j <= k; j++) {
    > r *= (n-j+1);
    > r /= j;
    > }
    > return r;
    > }

    > Here, the symetry is used only for exact integers. The symetry is
    > valid only for integers, since choose(n, k) is a polynomial of
    > degree k. So, for different values of k, we get a different functions
    > on any interval of positive length.

    > The division at the line
    > r /= j;
    > always produces an exact integer, since during the whole cycle, r is always
    > either an integer binomial coefficient or its integer multiple. So, the
    > division has an integer result and there is no rounding error unless the
    > intermediate result does not fit into 53 bit precison.

    > Using the above code, we get

    > options(digits=15)
    > n <- 5 + (-15:15)*1e-8
    > cbind(n, choose(n, 5))
    > #                n                  
    > #  [1,] 4.99999985 0.999999657500042
    > #  [2,] 4.99999986 0.999999680333370
    > #  [3,] 4.99999987 0.999999703166698
    > #  [4,] 4.99999988 0.999999726000027
    > #  [5,] 4.99999989 0.999999748833356
    > #  [6,] 4.99999990 0.999999771666685
    > #  [7,] 4.99999991 0.999999794500014
    > #  [8,] 4.99999992 0.999999817333345
    > #  [9,] 4.99999993 0.999999840166677
    > # [10,] 4.99999994 0.999999863000008
    > # [11,] 4.99999995 0.999999885833339
    > # [12,] 4.99999996 0.999999908666670
    > # [13,] 4.99999997 0.999999931500002
    > # [14,] 4.99999998 0.999999954333335
    > # [15,] 4.99999999 0.999999977166667
    > # [16,] 5.00000000 1.000000000000000
    > # [17,] 5.00000001 1.000000022833334
    > # [18,] 5.00000002 1.000000045666667
    > # [19,] 5.00000003 1.000000068500001
    > # [20,] 5.00000004 1.000000091333336
    > # [21,] 5.00000005 1.000000114166671
    > # [22,] 5.00000006 1.000000137000006
    > # [23,] 5.00000007 1.000000159833342
    > # [24,] 5.00000008 1.000000182666680
    > # [25,] 5.00000009 1.000000205500016
    > # [26,] 5.00000010 1.000000228333353
    > # [27,] 5.00000011 1.000000251166690
    > # [28,] 5.00000012 1.000000274000027
    > # [29,] 5.00000013 1.000000296833365
    > # [30,] 5.00000014 1.000000319666704
    > # [31,] 5.00000015 1.000000342500042

    > Within the chosen accuracy 1e-8, there is no visible jump.
    > With 1e-15, we get

    > options(digits=15)
    > n <- 5 + (-15:15)*1e-15
    > cbind(n, choose(n, 5))
    > #                      n                  
    > #  [1,] 4.99999999999998 0.999999999999966
    > #  [2,] 4.99999999999999 0.999999999999967
    > #  [3,] 4.99999999999999 0.999999999999970
    > #  [4,] 4.99999999999999 0.999999999999972
    > #  [5,] 4.99999999999999 0.999999999999976
    > #  [6,] 4.99999999999999 0.999999999999978
    > #  [7,] 4.99999999999999 0.999999999999980
    > #  [8,] 4.99999999999999 0.999999999999982
    > #  [9,] 4.99999999999999 0.999999999999984
    > # [10,] 4.99999999999999 0.999999999999986
    > # [11,] 4.99999999999999 0.999999999999988
    > # [12,] 5.00000000000000 0.999999999999990
    > # [13,] 5.00000000000000 0.999999999999994
    > # [14,] 5.00000000000000 0.999999999999996
    > # [15,] 5.00000000000000 0.999999999999998
    > # [16,] 5.00000000000000 1.000000000000000
    > # [17,] 5.00000000000000 1.000000000000002
    > # [18,] 5.00000000000000 1.000000000000004
    > # [19,] 5.00000000000000 1.000000000000006
    > # [20,] 5.00000000000000 1.000000000000010
    > # [21,] 5.00000000000001 1.000000000000012
    > # [22,] 5.00000000000001 1.000000000000014
    > # [23,] 5.00000000000001 1.000000000000016
    > # [24,] 5.00000000000001 1.000000000000018
    > # [25,] 5.00000000000001 1.000000000000020
    > # [26,] 5.00000000000001 1.000000000000022
    > # [27,] 5.00000000000001 1.000000000000024
    > # [28,] 5.00000000000001 1.000000000000028
    > # [29,] 5.00000000000001 1.000000000000031
    > # [30,] 5.00000000000001 1.000000000000032
    > # [31,] 5.00000000000002 1.000000000000035

    > So, the jump in the exactly integer value n[16] == 5 is comparable
    > to machine accuracy.

    > I would be pleased to provide more tests, if some of the above solutions
    > or their modifications can be accepted.

    > Petr Savicky.

    [.......................]

Thanks a lot, Petr, for your explorations.
I agree that at least something like your conservative change
should happen.

Personally, I'd agree with you and prefer the "progressive"
(non-conservative) change,
basically getting rid of  all  R_IS_INT(n)
tests, which seem kludgey.

OTOH, the R core members who did start using R_IS_INT(n)
must have had good reasons with another set examples.

Have you tried 'make check-devel' (or 'check-all') also with the 
progressive change?

I'll hope to get back to this on Monday.
Martin


From landronimirc at gmail.com  Mon Dec 21 13:23:55 2009
From: landronimirc at gmail.com (Liviu Andronic)
Date: Mon, 21 Dec 2009 12:23:55 +0000
Subject: [Rd] checking Rd cross-references ... WARNING
Message-ID: <68b1e2610912210423o57acf2c4v9ddc3fc5eab5bc62@mail.gmail.com>

Dear all
I am getting this strange error when checking my package. Would you
have an idea what causes it?

Thank you
Liviu

* checking Rd cross-references ... WARNING
Error in .find.package(package, lib.loc) :
  there is no package called 'KernSmooth'
Calls: <Anonymous> -> lapply -> FUN -> .find.package
Execution halted



> sessionInfo ()
R version 2.10.0 (2009-10-26)
x86_64-pc-linux-gnu

locale:
 [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C
LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8
 [5] LC_MONETARY=C              LC_MESSAGES=en_GB.UTF-8
LC_PAPER=en_GB.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C

attached base packages:
 [1] datasets  grid      splines   graphics  stats     utils
grDevices tcltk     methods   base

other attached packages:
 [1] fortunes_1.3-6           RcmdrPlugin.HH_1.1-25    HH_2.1-32
         leaps_2.9
 [5] multcomp_1.1-2           mvtnorm_0.9-8            lattice_0.17-26
         RcmdrPlugin.sos_0.1-0
 [9] tcltk2_1.1-1             RcmdrPlugin.Export_0.3-0 Hmisc_3.7-0
         survival_2.35-7
[13] xtable_1.5-6             Rcmdr_1.5-4              car_1.2-16
         relimp_1.0-1
[17] sos_1.2-4                brew_1.0-3               hints_1.0.1-1

loaded via a namespace (and not attached):
[1] cluster_1.12.1



-- 
Do you know how to read?
http://www.alienetworks.com/srtest.cfm
Do you know how to write?
http://garbl.home.comcast.net/~garbl/stylemanual/e.htm#e-mail


From murdoch at stats.uwo.ca  Mon Dec 21 13:42:57 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 21 Dec 2009 07:42:57 -0500
Subject: [Rd] checking Rd cross-references ... WARNING
In-Reply-To: <68b1e2610912210423o57acf2c4v9ddc3fc5eab5bc62@mail.gmail.com>
References: <68b1e2610912210423o57acf2c4v9ddc3fc5eab5bc62@mail.gmail.com>
Message-ID: <4B2F6D51.6040708@stats.uwo.ca>

Liviu Andronic wrote:
> Dear all
> I am getting this strange error when checking my package. Would you
> have an idea what causes it?
>
> Thank you
> Liviu
>
> * checking Rd cross-references ... WARNING
> Error in .find.package(package, lib.loc) :
>   there is no package called 'KernSmooth'
> Calls: <Anonymous> -> lapply -> FUN -> .find.package
> Execution halted
>
>
>
>   
>> sessionInfo ()
>>     
> R version 2.10.0 (2009-10-26)
>   

Do you get the same message in 2.10.1?

Duncan Murdoch

> x86_64-pc-linux-gnu
>
> locale:
>  [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C
> LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8
>  [5] LC_MONETARY=C              LC_MESSAGES=en_GB.UTF-8
> LC_PAPER=en_GB.UTF-8       LC_NAME=C
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
>  [1] datasets  grid      splines   graphics  stats     utils
> grDevices tcltk     methods   base
>
> other attached packages:
>  [1] fortunes_1.3-6           RcmdrPlugin.HH_1.1-25    HH_2.1-32
>          leaps_2.9
>  [5] multcomp_1.1-2           mvtnorm_0.9-8            lattice_0.17-26
>          RcmdrPlugin.sos_0.1-0
>  [9] tcltk2_1.1-1             RcmdrPlugin.Export_0.3-0 Hmisc_3.7-0
>          survival_2.35-7
> [13] xtable_1.5-6             Rcmdr_1.5-4              car_1.2-16
>          relimp_1.0-1
> [17] sos_1.2-4                brew_1.0-3               hints_1.0.1-1
>
> loaded via a namespace (and not attached):
> [1] cluster_1.12.1
>
>
>
>


From felix at nfrac.org  Mon Dec 21 13:44:46 2009
From: felix at nfrac.org (Felix Andrews)
Date: Mon, 21 Dec 2009 23:44:46 +1100
Subject: [Rd] proposal for new axis.Date/axis.POSIXct
Message-ID: <94730b8a0912210444l1313c1d2vb780f9ea4e1fb3ad@mail.gmail.com>

Hi R-devel.

I've noticed a couple of quirks in the current time/date axis
functions (axis.Date, axis.POSIXct, and the equivalents in lattice).
Looking at the code, it seems like a fairly ad-hoc approach, often
using pretty() on components of the time. This is not always ideal -
for example a one-hour interval gets cut into 10-minute chunks rather
than the more natural 15-minute chunks (since pretty() doesn't know
about the minutes in an hour, etc). Generally the number of tick marks
produced varies a lot, and there are a couple of strange cases: try
plot(0:1 ~ as.POSIXct(paste(2002:2003,"-02-01",sep="")))

So, I've written a function prettyDate() that attempts to act like
pretty(), but with dates and times. Like pretty, it takes arguments
'n' and 'min.n' which specify the desired and minimum number of ticks,
respectively.

http://pastie.org/751640

By the way, also listed there is an extension of trunc.POSIXt with
extra units "weeks", "months", "years", "decades", "centuries".

Following is a test of prettyDate() for axis labelling, drawn for a
sequence of different time intervals.

source("http://pastie.org/751640.txt")

steps <-
    list("10 secs",
         "1 min", "5 mins", "10 mins", "15 mins", "30 mins",
         "1 hour", "3 hours", "6 hours", "12 hours",
         "1 DSTday", "1 week", "2 weeks",
         "1 month", "3 months", "6 months",
         "1 year", "2 years", "5 years", "10 years",
         "20 years", "50 years", "100 years")
names(steps) <- paste("span =", unlist(steps))

from <- as.POSIXct("2002-02-02 02:02")
devAskNewPage(TRUE)

lapply(steps, function(s) {
    times <- seq(from, by = s, length = 2)
    plot(0:1 ~ times, yaxt = "n", ylab = "")
    x <- mean(par("usr")[1:2])
    text(x, 0.5, paste("span:", s), cex = 2)
    text(x, 0.33, paste(format(times), collapse="\n"))
    text(x, 0.05, "current axis.POSIXct")
    text(x, 0.95, "proposed new prettyDate axis")
    ## draw new proposed axis function at top of plot
    timelim <- par("usr")[1:2]
    mostattributes(timelim) <- attributes(from)
    axis(side = 3, at = prettyDate(timelim),
        labels = prettyDate(timelim, do.format=TRUE))
})

devAskNewPage(FALSE)


Is it appropriate / desirable for this to be incorporated into R?


-- 
Felix Andrews / ???
Postdoctoral Fellow
Integrated Catchment Assessment and Management (iCAM) Centre
Fenner School of Environment and Society [Bldg 48a]
The Australian National University
Canberra ACT 0200 Australia
M: +61 410 400 963
T: + 61 2 6125 4670
E: felix.andrews at anu.edu.au
CRICOS Provider No. 00120C
-- 
http://www.neurofractal.org/felix/


From landronimirc at gmail.com  Mon Dec 21 14:24:46 2009
From: landronimirc at gmail.com (Liviu Andronic)
Date: Mon, 21 Dec 2009 13:24:46 +0000
Subject: [Rd] checking Rd cross-references ... WARNING
In-Reply-To: <4B2F6D51.6040708@stats.uwo.ca>
References: <68b1e2610912210423o57acf2c4v9ddc3fc5eab5bc62@mail.gmail.com>
	<4B2F6D51.6040708@stats.uwo.ca>
Message-ID: <68b1e2610912210524r1cf5292arbdaeb7fd1d2bce27@mail.gmail.com>

Hello

On 12/21/09, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> > R version 2.10.0 (2009-10-26)
>
>  Do you get the same message in 2.10.1?
>
I no longer get the warning after I installed r-recommended and
r-cran-kernsmooth, without upgrading to 2.10.1. Perhaps this is a
Debian specific issue.

Regards
Liviu


From baoliqin at gmail.com  Mon Dec 21 13:00:10 2009
From: baoliqin at gmail.com (baoliqin at gmail.com)
Date: Mon, 21 Dec 2009 13:00:10 +0100 (CET)
Subject: [Rd] a little bug for the function 'sprintf' (PR#14161)
Message-ID: <20091221120010.4696F282EFC5@mail.pubhealth.ku.dk>

Dear R-ers,

I am a gratuate student from South China University of Technology. I fond
the function 'sprintf' in R2.10.1 have a little bug(?):

When you type in the example codes:

> sprintf("%s is %f feet tall\n", "Sven", 7.1)

and R returns:

[1] "Sven is 7.100000 feet tall\n"

this is very different from the 'sprintf' function in C/C++, for in C/C++,
the format string "\n" usually represents a new line, but here, just
the plain text "\n"!

Is it a bug, or a deliberate design?

Thanks for your attention!

Best wishes!

Yours sincerely,
Baoli Qin

	[[alternative HTML version deleted]]


From shmunde at googlemail.com  Mon Dec 21 13:45:09 2009
From: shmunde at googlemail.com (shmunde at googlemail.com)
Date: Mon, 21 Dec 2009 13:45:09 +0100 (CET)
Subject: [Rd] cut.POSIXt problem with breaks= "quarter" (PR#14162)
Message-ID: <20091221124509.A2AFC282EFFB@mail.pubhealth.ku.dk>

Full_Name: Qing Xia
Version: 2.10.0
OS: Windows XP
Submission from: (NULL) (213.71.23.233)


I find, when I use "cut" function to cut date-time objects based on breaks =
"quarter", there exists a problem. It means, if the date-time has "JJJJ-MM-30"
or "JJJJ-MM-31", then "cut" runs not correctly, it gives wrong levels. Detail
can be found in the following R-Output:

1. correct Output levels, if there is no date-time "JJJJ-MM-30" or "JJJJ-MM-31"

> x<- as.Date(c("2009-03-21","2009-03-24"))
> cut(x, breaks= "quarter")
[1] 2009-01-01 2009-01-01
Levels: 2009-01-01


2. wrong Output levels, if there exists date-time "JJJJ-MM-30" or "JJJJ-MM-31"

> x<- as.Date(c("2009-03-21","2009-03-30"))
> cut(x, breaks= "quarter")
[1] 2009-01-01 2009-01-01
Levels: 2009-01-01 2009-04-01


> x<- as.Date(c("2009-03-21","2009-03-31"))
> cut(x, breaks= "quarter")
[1] 2009-01-01 2009-01-01
Levels: 2009-01-01 2009-04-01


From p.dalgaard at biostat.ku.dk  Mon Dec 21 18:36:12 2009
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Mon, 21 Dec 2009 18:36:12 +0100
Subject: [Rd] a little bug for the function 'sprintf' (PR#14161)
In-Reply-To: <20091221120010.4696F282EFC5@mail.pubhealth.ku.dk>
References: <20091221120010.4696F282EFC5@mail.pubhealth.ku.dk>
Message-ID: <4B2FB20C.2090003@biostat.ku.dk>

baoliqin at gmail.com wrote:
> Dear R-ers,
> 
> I am a gratuate student from South China University of Technology. I fond
> the function 'sprintf' in R2.10.1 have a little bug(?):
> 
> When you type in the example codes:
> 
>> sprintf("%s is %f feet tall\n", "Sven", 7.1)
> 
> and R returns:
> 
> [1] "Sven is 7.100000 feet tall\n"
> 
> this is very different from the 'sprintf' function in C/C++, for in C/C++,
> the format string "\n" usually represents a new line, but here, just
> the plain text "\n"!


No, this is exactly the same as in C/C++. If you compare the result of 
sprintf to "Sven is 7.100000 feet tall\n" with strcmp() in C, they will 
compare equal.

 > s <- sprintf("%s is %f feet tall\n", "Sven", 7.1)
 > s
[1] "Sven is 7.100000 feet tall\n"
 > nchar(s)
[1] 27
 > substr(s,27,27)
[1] "\n"

The thing that is confusing you is that strings are DISPLAYED using the 
same escape-character mechanisms as used for input. Compare

 > cat(s)
Sven is 7.100000 feet tall
 >



> 
> Is it a bug, or a deliberate design?

Design, not bug (and please don't file as bug when you are in doubt.)

> Thanks for your attention!
> 
> Best wishes!
> 
> Yours sincerely,
> Baoli Qin
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From ggrothendieck at gmail.com  Mon Dec 21 18:37:21 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 21 Dec 2009 12:37:21 -0500
Subject: [Rd] cut.POSIXt problem with breaks= "quarter" (PR#14162)
In-Reply-To: <20091221124509.A2AFC282EFFB@mail.pubhealth.ku.dk>
References: <20091221124509.A2AFC282EFFB@mail.pubhealth.ku.dk>
Message-ID: <971536df0912210937o31c3c316jbbde4af6aac195c0@mail.gmail.com>

as.yearqtr in the zoo package could be used as a workaround until cut is fixed.

> as.yearqtr(as.Date(c("2009-03-21","2009-03-31")))
[1] "2009 Q1" "2009 Q1"

> as.Date(as.yearqtr(as.Date(c("2009-03-21","2009-03-31"))))
[1] "2009-01-01" "2009-01-01"

On Mon, Dec 21, 2009 at 7:45 AM,  <shmunde at googlemail.com> wrote:
> Full_Name: Qing Xia
> Version: 2.10.0
> OS: Windows XP
> Submission from: (NULL) (213.71.23.233)
>
>
> I find, when I use "cut" function to cut date-time objects based on breaks =
> "quarter", there exists a problem. It means, if the date-time has "JJJJ-MM-30"
> or "JJJJ-MM-31", then "cut" runs not correctly, it gives wrong levels. Detail
> can be found in the following R-Output:
>
> 1. correct Output levels, if there is no date-time "JJJJ-MM-30" or "JJJJ-MM-31"
>
>> x<- as.Date(c("2009-03-21","2009-03-24"))
>> cut(x, breaks= "quarter")
> [1] 2009-01-01 2009-01-01
> Levels: 2009-01-01
>
>
> 2. wrong Output levels, if there exists date-time "JJJJ-MM-30" or "JJJJ-MM-31"
>
>> x<- as.Date(c("2009-03-21","2009-03-30"))
>> cut(x, breaks= "quarter")
> [1] 2009-01-01 2009-01-01
> Levels: 2009-01-01 2009-04-01
>
>
>> x<- as.Date(c("2009-03-21","2009-03-31"))
>> cut(x, breaks= "quarter")
> [1] 2009-01-01 2009-01-01
> Levels: 2009-01-01 2009-04-01
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From savicky at cs.cas.cz  Mon Dec 21 18:41:13 2009
From: savicky at cs.cas.cz (savicky at cs.cas.cz)
Date: Mon, 21 Dec 2009 18:41:13 +0100 (CET)
Subject: [Rd] a little bug for the function 'sprintf' (PR#14161)
Message-ID: <20091221174113.EBAE9282C76A@mail.pubhealth.ku.dk>

> When you type in the example codes:
> 
> > sprintf("%s is %f feet tall\n", "Sven", 7.1)
> 
> and R returns:
> 
> [1] "Sven is 7.100000 feet tall\n"
> 
> this is very different from the 'sprintf' function in C/C++, for in C/C++,
> the format string "\n" usually represents a new line, but here, just
> the plain text "\n"!

The function sprintf() produces a string, which is then printed
using R formatting. You probably expected the following.

  > cat(sprintf("%s is %f feet tall\n", "Sven", 7.1))
  Sven is 7.100000 feet tall

Compare also 

  > s <- sprintf("%s is %f feet tall\n", "Sven", 7.1)
  > cat(s)
  Sven is 7.100000 feet tall
  > print(s)
  [1] "Sven is 7.100000 feet tall\n"
  > 

PS.


From Ted.Harding at manchester.ac.uk  Mon Dec 21 19:15:01 2009
From: Ted.Harding at manchester.ac.uk ( (Ted Harding))
Date: Mon, 21 Dec 2009 18:15:01 -0000 (GMT)
Subject: [Rd] a little bug for the function 'sprintf' (PR#14161)
In-Reply-To: <4B2FB20C.2090003@biostat.ku.dk>
Message-ID: <XFMail.091221181501.Ted.Harding@manchester.ac.uk>

On 21-Dec-09 17:36:12, Peter Dalgaard wrote:
> baoliqin at gmail.com wrote:
>> Dear R-ers,
>> I am a gratuate student from South China University of Technology.
>> I fond the function 'sprintf' in R2.10.1 have a little bug(?):
>> 
>> When you type in the example codes:
>> 
>>> sprintf("%s is %f feet tall\n", "Sven", 7.1)
>> 
>> and R returns:
>> 
>> [1] "Sven is 7.100000 feet tall\n"
>> 
>> this is very different from the 'sprintf' function in C/C++,
>> for in C/C++, the format string "\n" usually represents a new line,
>> but here, just the plain text "\n"!
> 
> No, this is exactly the same as in C/C++. If you compare the result
> of sprintf to "Sven is 7.100000 feet tall\n" with strcmp() in C,
> they will compare equal.
> 
>  > s <- sprintf("%s is %f feet tall\n", "Sven", 7.1)
>  > s
> [1] "Sven is 7.100000 feet tall\n"
>  > nchar(s)
> [1] 27
>  > substr(s,27,27)
> [1] "\n"
> 
> The thing that is confusing you is that strings are DISPLAYED
> using the same escape-character mechanisms as used for input.
> Compare
> 
>  > cat(s)
> Sven is 7.100000 feet tall
>  >
> 
>> 
>> Is it a bug, or a deliberate design?
> 
> Design, not bug (and please don't file as bug when you are in doubt.)

And another confusion is that the C/C++ function sprintf() indeed
creates a string AND ASSIGNS IT TO A NAMED VARIABLE, according to
the syntax

  int sprintf(char *str, const char *format, ...);

as in

  char *X ;
  sprintf(X,"%s is %f feet tall\n", "Sven", 7.1) ;

as a result of which the string X will have the value
  "Sven is 7.100000 feet tall\n"

R's sprintf does not provide for the parameter "Char *str", here X,
and so RETURNS the string as the value of the function.

This is NOT TO BE CONFUSED with the behaviour of the C/C++ functions
printf() and fprintf(), both of which create the string and then
send it to either stdout or to a file:

  int printf(const char *format, ...);
  int fprintf(FILE *stream, const char *format, ...);

Therefore, if you programmed

  printf("%s is %f feet tall\n", "Sven", 7.1) ;

you would see on-screen (stdout) the string 

  "Sven is 7.100000 feet tall"

(followed by a line-break due to the "\n"), while

  mystream = fopen("myoutput.txt",a) ;
  fprintf(mystream, "%s is %f feet tall\n", "Sven", 7.1) ;

would append

  "Sven is 7.100000 feet tall"

(followed by a line-break) to myoutput.txt

Hoping this helps!
Ted.

--------------------------------------------------------------------
E-Mail: (Ted Harding) <Ted.Harding at manchester.ac.uk>
Fax-to-email: +44 (0)870 094 0861
Date: 21-Dec-09                                       Time: 18:14:57
------------------------------ XFMail ------------------------------


From h.wickham at gmail.com  Mon Dec 21 21:45:05 2009
From: h.wickham at gmail.com (hadley wickham)
Date: Mon, 21 Dec 2009 20:45:05 +0000
Subject: [Rd] a little bug for the function 'sprintf' (PR#14161)
In-Reply-To: <4B2FB20C.2090003@biostat.ku.dk>
References: <20091221120010.4696F282EFC5@mail.pubhealth.ku.dk> 
	<4B2FB20C.2090003@biostat.ku.dk>
Message-ID: <f8e6ff050912211245r5bf26ca3p958e9c49dfb58781@mail.gmail.com>

> The thing that is confusing you is that strings are DISPLAYED using the same
> escape-character mechanisms as used for input. Compare
>
>> cat(s)
> Sven is 7.100000 feet tall

See also:

http://en.wikipedia.org/wiki/The_Treachery_of_Images
http://www.youtube.com/watch?v=sShMA85pv8M

Hadley

-- 
http://had.co.nz/


From jeffreys at rand.org  Mon Dec 21 20:40:09 2009
From: jeffreys at rand.org (jeffreys at rand.org)
Date: Mon, 21 Dec 2009 20:40:09 +0100 (CET)
Subject: [Rd] sort yields different results on OS X (PR#14163)
Message-ID: <20091221194009.4E4882830319@mail.pubhealth.ku.dk>

Full_Name: Jeffrey Sullivan
Version: 2.10
OS: Mac
Submission from: (NULL) (130.154.0.250)


Sort produces different results when sorting strings with non-alphanumeric
characters, depending on the operating system:

RHEL 5.2, R 2.10.0
-------------
> v <- c("1","<0",">3","2")
> Sys.setlocale("LC_COLLATE","en_US.UTF-8")
[1] "en_US.UTF-8"
> sort(v)
[1] "<0" "1"  "2"  ">3"

Max OS 10.5.8, R 2.10.1
-------------------
> v <- c("1","<0",">3","2")
> Sys.setlocale("LC_COLLATE","en_US.UTF-8")
[1] "en_US.UTF-8"
> sort(v)
[1] "<0" ">3" "1"  "2"


From ripley at stats.ox.ac.uk  Tue Dec 22 13:18:46 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 22 Dec 2009 12:18:46 +0000 (GMT)
Subject: [Rd] sort yields different results on OS X (PR#14163)
In-Reply-To: <20091221194009.4E4882830319@mail.pubhealth.ku.dk>
References: <20091221194009.4E4882830319@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0912221212120.15604@toucan.stats.ox.ac.uk>

As the help says

      The sort order for character vectors will depend on the collating
      sequence of the locale in use: see ?Comparison?.

and that ref says

      Collation of
      non-letters (spaces, punctuation signs, hyphens, fractions and so
      on) is even more problematic.

That different OSes use the same name for a locale does not make them 
the same locale.

Note that R can be compiled to use ICU, which provides a 
well-considered collation suite.  R on Mac OS X uses ICU, as does a 
Linux build if it is available -- so I would say that it is RHEL that 
is out of line here (it makes little sense to have < and > far apart 
in the collation sequence).

Why did you report a documented difference as a bug?

On Mon, 21 Dec 2009, jeffreys at rand.org wrote:

> Full_Name: Jeffrey Sullivan
> Version: 2.10
> OS: Mac
> Submission from: (NULL) (130.154.0.250)
>
>
> Sort produces different results when sorting strings with non-alphanumeric
> characters, depending on the operating system:
>
> RHEL 5.2, R 2.10.0
> -------------
>> v <- c("1","<0",">3","2")
>> Sys.setlocale("LC_COLLATE","en_US.UTF-8")
> [1] "en_US.UTF-8"
>> sort(v)
> [1] "<0" "1"  "2"  ">3"
>
> Max OS 10.5.8, R 2.10.1
> -------------------
>> v <- c("1","<0",">3","2")
>> Sys.setlocale("LC_COLLATE","en_US.UTF-8")
> [1] "en_US.UTF-8"
>> sort(v)
> [1] "<0" ">3" "1"  "2"
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From p.dalgaard at biostat.ku.dk  Tue Dec 22 13:59:54 2009
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 22 Dec 2009 13:59:54 +0100
Subject: [Rd] sort yields different results on OS X (PR#14163)
In-Reply-To: <alpine.LFD.2.00.0912221212120.15604@toucan.stats.ox.ac.uk>
References: <20091221194009.4E4882830319@mail.pubhealth.ku.dk>
	<alpine.LFD.2.00.0912221212120.15604@toucan.stats.ox.ac.uk>
Message-ID: <4B30C2CA.8010009@biostat.ku.dk>

Prof Brian Ripley wrote:

> 
> That different OSes use the same name for a locale does not make them 
> the same locale.
> 
> Note that R can be compiled to use ICU, which provides a well-considered 
> collation suite.  R on Mac OS X uses ICU, as does a Linux build if it is 
> available -- so I would say that it is RHEL that is out of line here (it 
> makes little sense to have < and > far apart in the collation sequence).
> 

That's not it:

 > v <- c("1","<0","<3","2")
 > sort(v)
[1] "<0" "1"  "2"  "<3"

The point is rather that "special characters" are ignored during collation.

Apparently, this comes from /usr/share/i18n/locales/iso14651_t1_common 
on Fedora; I wouldn't know how faithful to the ISO standard that is.

-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From savicky at cs.cas.cz  Tue Dec 22 14:25:15 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Tue, 22 Dec 2009 14:25:15 +0100
Subject: [Rd] choose(n,k) when n is almost integer
In-Reply-To: <19245.16249.290239.986122@cmath-6.math.ethz.ch>
References: <19239.19864.396771.484772@lynne.math.ethz.ch>
	<20091215095243.GA14388@cs.cas.cz>
	<19239.38154.219034.206322@lynne.math.ethz.ch>
	<19242.15337.267242.128687@lynne.math.ethz.ch>
	<20091217231449.GA23480@cs.cas.cz>
	<19245.16249.290239.986122@cmath-6.math.ethz.ch>
Message-ID: <20091222132515.GA31782@cs.cas.cz>

On Sat, Dec 19, 2009 at 10:02:49PM +0100, Martin Maechler wrote:
> {I've changed the subject;  it's really no longer about
>  lchoose()'s definition}
> 
[.......................]
> 
> Thanks a lot, Petr, for your explorations.
> I agree that at least something like your conservative change
> should happen.
> 
> Personally, I'd agree with you and prefer the "progressive"
> (non-conservative) change,
> basically getting rid of  all  R_IS_INT(n)
> tests, which seem kludgey.
> 
> OTOH, the R core members who did start using R_IS_INT(n)
> must have had good reasons with another set examples.
> 
> Have you tried 'make check-devel' (or 'check-all') also with the 
> progressive change?

After some tests, i changed the two suggested patches. The new versions
will be called A and B.

Let us consider computing choose(n, k) with an integer k and a general n.

Patch A is a minimal one. It rounds n to be an exact integer, if we assume
this after the test R_IS_INT(n).

Patch B corresponds to the progressive older suggestion. It tries to avoid
rounding of n, if possible. Rounding is not needed, is k < 30 or if none
of the factors in the product n(n-1)...(n-k+1) is close to zero.

Patch A (without indentation in attachment):

  --- R-devel-orig-sse/src/nmath/choose.c	2009-12-17 17:52:39.000000000 +0100
  +++ R-devel-work-copy-1-sse/src/nmath/choose.c	2009-12-22 09:06:32.000000000 +0100
  @@ -109,6 +109,7 @@
   	MATHLIB_WARNING2(_("'k' (%.2f) must be integer, rounded to %.0f"), k0, k);
       if (k < k_small_max) {
   	int j;
  +	if (R_IS_INT(n)) n = floor(n + 0.5);
   	if(n-k < k && n >= 0 && R_IS_INT(n)) k = n-k; /* <- Symmetry */
   	if (k <	 0) return 0.;
   	if (k == 0) return 1.;
  @@ -126,6 +127,7 @@
   	return r;
       }
       else if (R_IS_INT(n)) {
  +	n = floor(n + 0.5);
   	if(n < k) return 0.;
   	if(n - k < k_small_max) return choose(n, n-k); /* <- Symmetry */
   	return floor(exp(lfastchoose(n, k)) + 0.5);

Path B (without indentation in attachment):

  --- R-devel-orig-sse/src/nmath/choose.c	2009-12-17 17:52:39.000000000 +0100
  +++ R-devel-work-copy-2-sse/src/nmath/choose.c	2009-12-22 13:49:33.000000000 +0100
  @@ -93,13 +93,14 @@
       return lfastchoose(n, k);
   }
   
  +#define IS_INT(x)	  ((x) == floor(x))
   #define k_small_max 30
   /* 30 is somewhat arbitrary: it is on the *safe* side:
    * both speed and precision are clearly improved for k < 30.
   */
   double choose(double n, double k)
   {
  -    double r, k0 = k;
  +    double r, k0 = k, n1;
       k = floor(k + 0.5);
   #ifdef IEEE_754
       /* NaNs propagated correctly */
  @@ -109,14 +110,14 @@
   	MATHLIB_WARNING2(_("'k' (%.2f) must be integer, rounded to %.0f"), k0, k);
       if (k < k_small_max) {
   	int j;
  -	if(n-k < k && n >= 0 && R_IS_INT(n)) k = n-k; /* <- Symmetry */
  +	if(n-k < k && n >= 0 && IS_INT(n)) k = n-k; /* <- Symmetry */
   	if (k <	 0) return 0.;
   	if (k == 0) return 1.;
   	/* else: k >= 1 */
   	r = n;
   	for(j = 2; j <= k; j++)
  -	    r *= (n-j+1)/j;
  -	return R_IS_INT(n) ? floor(r + 0.5) : r;
  +	    r *= (n-(j-1))/j;
  +	return IS_INT(n) ? floor(r + 0.5) : r;
   	/* might have got rounding errors */
       }
       /* else: k >= k_small_max */
  @@ -125,12 +126,15 @@
   	if (ODD(k)) r = -r;
   	return r;
       }
  -    else if (R_IS_INT(n)) {
  +    else if (IS_INT(n)) {
   	if(n < k) return 0.;
   	if(n - k < k_small_max) return choose(n, n-k); /* <- Symmetry */
   	return floor(exp(lfastchoose(n, k)) + 0.5);
       }
       /* else non-integer n >= 0 : */
  +    n1 = floor(n + 0.5);
  +    if (n1 <= k-1 && fabs(n1 - n) <= 1e-7)
  +	return 0.;
       if (n < k-1) {
   	int s_choose;
   	r = lfastchoose2(n, k, /* -> */ &s_choose);
  @@ -140,5 +144,6 @@
   }
   
   #undef ODD
  +#undef IS_INT
   #undef R_IS_INT
   #undef k_small_max

Both patches solve the main problems of the original implementation, namely

  # for k < k_small_max
  choose(5 - 1e-9, 5) # [1] 0
  choose(5 + 1e-9, 5) # [1] 5
  # for k >= k_small_max
  choose(30 - 1e-9, 30) # [1] 0
  choose(60 - 1e-9, 30) # Error: segfault from C stack overflow

and we get in 7 digit precision

  # for k < k_small_max
  choose(5 - 1e-9, 5) # [1] 1
  choose(5 + 1e-9, 5) # [1] 1
  # for k >= k_small_max
  choose(30 - 1e-9, 30) # [1] 1
  choose(60 - 1e-9, 30) # [1] 1.182646e+17

The patches do not modify lchoose(). I think, this should be done after
a decision how to modify choose().

Both patches go through make check-devel until the test of Tcl/Tk, which fails,
since i do not have Tcl/Tk on the machine, which i have now available. I will
perform the whole test later.

Both patches and also the original implementation sometimes generate a warning
of the following type

  > choose(19 - 2e-7, 30)
  [1] -3.328339e-16
  Warning message:
  In choose(19 - 2e-07, 30) :
    full precision may not have been achieved in 'lgamma'

These warnings are generated in functions called from choose() and the intention
of this patch is not to change this. Most of these warnings are eliminated
in the original implementation by treating numbers, which differ from an
integer by less than 1e-7, as integers. However, there are some such cases
even if the difference is slightly larger than 1e-7 like the above 2e-7.

The cases, when the above warning is generated, are the same for both patches A and B
in the tests, which i did.

Patch B is significantly more accurate in cases, when the result is more than 1.

In order to verify these two claims, i used the test script at
  http://www.cs.cas.cz/~savicky/R-devel/test_choose_0.R

Its outputs with A and B are presented below. The list of cases with warning 
   Cases with warning
        [,1] [,2]
   [1,] 6715   31
   [2,]  152   33
   [3,]  152   34
   [4,] 6393   37
   [5,] 9388   39
   [6,] 6059   40
   [7,] 8773   40
   [8,] 5058   44
   [9,] 5531   44
  [10,] 6670   46
  [11,]  652   47
  [12,] 2172   49
  [13,] 3371   49
  [14,] 1913   50
is the same in all four tests. So, i only include the tables of errors, which
are different. The table contains columns "bound" and "error". The error is
the maximum error achieved in cases, where the compared values are at most the
bound on the same row and more than the bounds on the previous rows.

Patch A on Intel extended arithmetic

  minimum log2() of a wrong result for integer n : 53.95423 
  maximum error for real n :
       bound        error
  [1,] 0e+00 1.206026e-08
  [2,] 1e-20 2.699943e-08
  [3,] 1e-15 3.444711e-08
  [4,] 1e-10 2.806709e-08
  [5,] 1e-05 8.395916e-09
  [6,] 1e+00 3.695634e-07
  [7,]   Inf 2.990987e-07

Patch A on SSE arithmetic

  minimum log2() of a wrong result for integer n : 49.94785 
  maximum error for real n :
       bound        error
  [1,] 0e+00 1.206026e-08
  [2,] 1e-20 2.699943e-08
  [3,] 1e-15 3.444709e-08
  [4,] 1e-10 2.806707e-08
  [5,] 1e-05 8.395951e-09
  [6,] 1e+00 3.695634e-07
  [7,]   Inf 2.990987e-07

Patch B on Intel extended arithmetic

  minimum log2() of a wrong result for integer n : 53.95423 
  maximum error for real n :
       bound        error
  [1,] 0e+00 2.047988e-09
  [2,] 1e-20 2.699943e-08
  [3,] 1e-15 3.444711e-08
  [4,] 1e-10 2.806709e-08
  [5,] 1e-05 8.395916e-09
  [6,] 1e+00 1.207856e-11
  [7,]   Inf 1.509903e-14

Patch B on SSE arithmetic

  minimum log2() of a wrong result for integer n : 49.94785 
  maximum error for real n :
       bound        error
  [1,] 0e+00 2.047988e-09
  [2,] 1e-20 2.699943e-08
  [3,] 1e-15 3.444709e-08
  [4,] 1e-10 2.806707e-08
  [5,] 1e-05 8.395951e-09
  [6,] 1e+00 1.205369e-11
  [7,]   Inf 2.731149e-14

We can see that B has smaller error, if the output is more than 1.

For integer n, we can see that the smallest output values, where we
do not get the exact result is the same for A and B. There is a difference
between Intel extended arithmetic and SSE for clear reasons.

I suggest to use B and i appreciate comments.

Petr Savicky.

-------------- next part --------------
--- R-devel-orig-sse/src/nmath/choose.c	2009-12-17 17:52:39.000000000 +0100
+++ R-devel-work-copy-1-sse/src/nmath/choose.c	2009-12-22 09:06:32.000000000 +0100
@@ -109,6 +109,7 @@
 	MATHLIB_WARNING2(_("'k' (%.2f) must be integer, rounded to %.0f"), k0, k);
     if (k < k_small_max) {
 	int j;
+	if (R_IS_INT(n)) n = floor(n + 0.5);
 	if(n-k < k && n >= 0 && R_IS_INT(n)) k = n-k; /* <- Symmetry */
 	if (k <	 0) return 0.;
 	if (k == 0) return 1.;
@@ -126,6 +127,7 @@
 	return r;
     }
     else if (R_IS_INT(n)) {
+	n = floor(n + 0.5);
 	if(n < k) return 0.;
 	if(n - k < k_small_max) return choose(n, n-k); /* <- Symmetry */
 	return floor(exp(lfastchoose(n, k)) + 0.5);
-------------- next part --------------
--- R-devel-orig-sse/src/nmath/choose.c	2009-12-17 17:52:39.000000000 +0100
+++ R-devel-work-copy-2-sse/src/nmath/choose.c	2009-12-22 13:49:33.000000000 +0100
@@ -93,13 +93,14 @@
     return lfastchoose(n, k);
 }
 
+#define IS_INT(x)	  ((x) == floor(x))
 #define k_small_max 30
 /* 30 is somewhat arbitrary: it is on the *safe* side:
  * both speed and precision are clearly improved for k < 30.
 */
 double choose(double n, double k)
 {
-    double r, k0 = k;
+    double r, k0 = k, n1;
     k = floor(k + 0.5);
 #ifdef IEEE_754
     /* NaNs propagated correctly */
@@ -109,14 +110,14 @@
 	MATHLIB_WARNING2(_("'k' (%.2f) must be integer, rounded to %.0f"), k0, k);
     if (k < k_small_max) {
 	int j;
-	if(n-k < k && n >= 0 && R_IS_INT(n)) k = n-k; /* <- Symmetry */
+	if(n-k < k && n >= 0 && IS_INT(n)) k = n-k; /* <- Symmetry */
 	if (k <	 0) return 0.;
 	if (k == 0) return 1.;
 	/* else: k >= 1 */
 	r = n;
 	for(j = 2; j <= k; j++)
-	    r *= (n-j+1)/j;
-	return R_IS_INT(n) ? floor(r + 0.5) : r;
+	    r *= (n-(j-1))/j;
+	return IS_INT(n) ? floor(r + 0.5) : r;
 	/* might have got rounding errors */
     }
     /* else: k >= k_small_max */
@@ -125,12 +126,15 @@
 	if (ODD(k)) r = -r;
 	return r;
     }
-    else if (R_IS_INT(n)) {
+    else if (IS_INT(n)) {
 	if(n < k) return 0.;
 	if(n - k < k_small_max) return choose(n, n-k); /* <- Symmetry */
 	return floor(exp(lfastchoose(n, k)) + 0.5);
     }
     /* else non-integer n >= 0 : */
+    n1 = floor(n + 0.5);
+    if (n1 <= k-1 && fabs(n1 - n) <= 1e-7)
+	return 0.;
     if (n < k-1) {
 	int s_choose;
 	r = lfastchoose2(n, k, /* -> */ &s_choose);
@@ -140,5 +144,6 @@
 }
 
 #undef ODD
+#undef IS_INT
 #undef R_IS_INT
 #undef k_small_max

From ripley at stats.ox.ac.uk  Tue Dec 22 14:37:24 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 22 Dec 2009 13:37:24 +0000 (GMT)
Subject: [Rd] sort yields different results on OS X (PR#14163)
In-Reply-To: <4B30C2CA.8010009@biostat.ku.dk>
References: <20091221194009.4E4882830319@mail.pubhealth.ku.dk>
	<alpine.LFD.2.00.0912221212120.15604@toucan.stats.ox.ac.uk>
	<4B30C2CA.8010009@biostat.ku.dk>
Message-ID: <alpine.LFD.2.00.0912221325380.29919@gannet.stats.ox.ac.uk>

On Tue, 22 Dec 2009, Peter Dalgaard wrote:

> Prof Brian Ripley wrote:
>
>> 
>> That different OSes use the same name for a locale does not make them the 
>> same locale.
>> 
>> Note that R can be compiled to use ICU, which provides a well-considered 
>> collation suite.  R on Mac OS X uses ICU, as does a Linux build if it is 
>> available -- so I would say that it is RHEL that is out of line here (it 
>> makes little sense to have < and > far apart in the collation sequence).
>> 
>
> That's not it:
>
>> v <- c("1","<0","<3","2")
>> sort(v)
> [1] "<0" "1"  "2"  "<3"
>
> The point is rather that "special characters" are ignored during collation.

Sometimes ....

> Apparently, this comes from /usr/share/i18n/locales/iso14651_t1_common on 
> Fedora; I wouldn't know how faithful to the ISO standard that is.

ISO 14651 is a version of the Unicode Collation Algorithm 
(http://www.unicode.org/reports/tr10/) which ICU uses.  So other 
people have implemented the same set of rules to give different 
results -- which is quite possible given the number of non-prescribed 
choices that need to be made.

We've seen too many anomalies from glibc to trust it: which is why ICU 
is used if available.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From djsamperi at earthlink.net  Tue Dec 22 19:14:15 2009
From: djsamperi at earthlink.net (Dominick Samperi)
Date: Tue, 22 Dec 2009 13:14:15 -0500
Subject: [Rd] Rcpp: Clarifying the meaning of GPL?
Message-ID: <4B310C77.9030806@earthlink.net>

I wrote the Rcpp library and the RcppTemplate package to make it
easier for developers to contribute packages to the R community.
In addition to providing detailed documentation on
package creation it provides a clean object mapping between
R anc C++ that helps developers to implement packages that
benefit from the performance of C++ and the flexibility of R.

The package named 'Rcpp' was forked from my work and
is being developed independently, in spite of many protests
from me. A diff of Rcpp_0.6.6 and RcppTemplate_5.3 (written
several years ago), both available at CRAN, will show that
Rcpp added a few cut-and-paste changes. (The latest release
of Rcpp has been split up and reorganized so that it would
be difficult to find the differences now.)

More importantly, while GPL gives developers the right to
make changes (without the permission of the original
contributor) it explicitly states that these changes should
not leave misleading impressions about the original
developer.

Unfortunately, GPL does not spell out what it means to
be misleading. I think using the same name ('Rcpp')
as a library still being developed by the original author,
and listing yourself as a copyright holder on source code
alongside the original author without that person's
permission counts as misleading, but that is my
opinion.

I am posting this message seeking the opinion of others
in the R community. Perhaps by sharing ideas we can
"self-organize" and find an interpretation of GPL that
benefits all R users, and all package contributors as well.

A minimal resolution of this issue would be to simply
rename 'Rcpp' to something like 'RInside', or to something
else that is not misleading.

Thanks,
Dominick


From savicky at cs.cas.cz  Tue Dec 22 22:58:43 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Tue, 22 Dec 2009 22:58:43 +0100
Subject: [Rd] choose(n,k) when n is almost integer
In-Reply-To: <19245.16249.290239.986122@cmath-6.math.ethz.ch>
References: <19239.19864.396771.484772@lynne.math.ethz.ch>
	<20091215095243.GA14388@cs.cas.cz>
	<19239.38154.219034.206322@lynne.math.ethz.ch>
	<19242.15337.267242.128687@lynne.math.ethz.ch>
	<20091217231449.GA23480@cs.cas.cz>
	<19245.16249.290239.986122@cmath-6.math.ethz.ch>
Message-ID: <20091222215843.GA9120@cs.cas.cz>

On Sat, Dec 19, 2009 at 10:02:49PM +0100, Martin Maechler wrote:
[...]
> Have you tried 'make check-devel' (or 'check-all') also with the 
> progressive change?

The patch-B.txt from my previous email passed "make check-all" with the
exception of the Tcl/Tk support, which is missing on my computer.
The test was run both with Intel extended and SSE arithmetic.

Petr Savicky.


From macrakis at alum.mit.edu  Wed Dec 23 05:08:33 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Tue, 22 Dec 2009 23:08:33 -0500
Subject: [Rd] Rcpp: Clarifying the meaning of GPL?
In-Reply-To: <4B310C77.9030806@earthlink.net>
References: <4B310C77.9030806@earthlink.net>
Message-ID: <8b356f880912222008o47ee54c9k267773cc570708d2@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091222/c698b6c1/attachment.pl>

From xie at yihui.name  Wed Dec 23 05:53:57 2009
From: xie at yihui.name (Yihui Xie)
Date: Tue, 22 Dec 2009 22:53:57 -0600
Subject: [Rd] Rcpp: Clarifying the meaning of GPL?
In-Reply-To: <4B310C77.9030806@earthlink.net>
References: <4B310C77.9030806@earthlink.net>
Message-ID: <89b6b8c90912222053s61ebeb92re97260421a81d372@mail.gmail.com>

I see your name and work are clearly mentioned in the DESCRIPTION file:

Rcpp: Rcpp R/C++ interface package

R/C++ interface classes and examples The Rcpp library maps data types
betweeen R and C++, and includes support for R types real, integer,
character, vector, matrix, Date, datetime (i.e. POSIXct) at
microsecond resolution, data frame, and function. Transer to and from
simple SEXP objects is particular easy. Calling R functions from C++
is also supported. C++ code can be 'inlined' and a helper function
(from the 'inline' package) will create a C++ function and compile,
link and load it which makes C++ integration easy. Several examples
are included.

Version: 	0.7.0
Depends: 	R (>=2.0.0), methods
Published: 	2009-12-20
Author: 	Dirk Eddelbuettel with contributions by Simon Urbanek and
David Reiss; based on code written during 2005 and 2006 by Dominick
Samperi
Maintainer: 	Dirk Eddelbuettel <edd at debian.org>
License: 	GPL (>=2)
URL: 	http://dirk.eddelbuettel.com/code/rcpp.html

Besides, I followed the URL and also saw Dirk's explanation for
adopting your original work (in the "History" section). And when I
opened the source code files, I can see declarations like this here
and there:

// -*- mode: C++; c-indent-level: 4; c-basic-offset: 4; tab-width: 8 -*-
//
// Rcpp.h: R/C++ interface class library
//
// Copyright (C) 2005 - 2006 Dominick Samperi
// Copyright (C) 2008 - 2009 Dirk Eddelbuettel

So the impression does not seem to be misleading at least to me...
Maybe I missed anything or I did not understand your problem?

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Phone: 515-294-6609 Web: http://yihui.name
Department of Statistics, Iowa State University
3211 Snedecor Hall, Ames, IA



On Tue, Dec 22, 2009 at 12:14 PM, Dominick Samperi
<djsamperi at earthlink.net> wrote:
> I wrote the Rcpp library and the RcppTemplate package to make it
> easier for developers to contribute packages to the R community.
> In addition to providing detailed documentation on
> package creation it provides a clean object mapping between
> R anc C++ that helps developers to implement packages that
> benefit from the performance of C++ and the flexibility of R.
>
> The package named 'Rcpp' was forked from my work and
> is being developed independently, in spite of many protests
> from me. A diff of Rcpp_0.6.6 and RcppTemplate_5.3 (written
> several years ago), both available at CRAN, will show that
> Rcpp added a few cut-and-paste changes. (The latest release
> of Rcpp has been split up and reorganized so that it would
> be difficult to find the differences now.)
>
> More importantly, while GPL gives developers the right to
> make changes (without the permission of the original
> contributor) it explicitly states that these changes should
> not leave misleading impressions about the original
> developer.
>
> Unfortunately, GPL does not spell out what it means to
> be misleading. I think using the same name ('Rcpp')
> as a library still being developed by the original author,
> and listing yourself as a copyright holder on source code
> alongside the original author without that person's
> permission counts as misleading, but that is my
> opinion.
>
> I am posting this message seeking the opinion of others
> in the R community. Perhaps by sharing ideas we can
> "self-organize" and find an interpretation of GPL that
> benefits all R users, and all package contributors as well.
>
> A minimal resolution of this issue would be to simply
> rename 'Rcpp' to something like 'RInside', or to something
> else that is not misleading.
>
> Thanks,
> Dominick
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From djsamperi at earthlink.net  Wed Dec 23 06:27:29 2009
From: djsamperi at earthlink.net (Dominick Samperi)
Date: Wed, 23 Dec 2009 00:27:29 -0500
Subject: [Rd] Rcpp: Clarifying the meaning of GPL?
In-Reply-To: <8b356f880912222008o47ee54c9k267773cc570708d2@mail.gmail.com>
References: <4B310C77.9030806@earthlink.net>
	<8b356f880912222008o47ee54c9k267773cc570708d2@mail.gmail.com>
Message-ID: <4B31AA41.2010700@earthlink.net>

Stavros Macrakis wrote:
> That said, as a matter of courtesy and clarity, I'd think that a fork 
> should use a different name.
Yes, the point is that this is not a legal or technical matter, it is a 
matter of professional courtesy.

I take this as one vote for the name change.

On US copyright law, this should not be confused with "copyright" 
notices that appear in GPL
source code. Remember that these are really "copyleft" notices, and 
copyleft is designed to
protect the rights of copiers, not original contributors. My concern 
about the copyright notice
should be viewed in the same spirit as the name change (professional 
courtesy).

Since GPL is largely silent on these issues I have asked the R community 
to vote...

Thanks,
Dominick


From jeff.a.ryan at gmail.com  Wed Dec 23 06:32:15 2009
From: jeff.a.ryan at gmail.com (Jeff Ryan)
Date: Tue, 22 Dec 2009 23:32:15 -0600
Subject: [Rd] Rcpp: Clarifying the meaning of GPL?
In-Reply-To: <4B31AA41.2010700@earthlink.net>
References: <4B310C77.9030806@earthlink.net>
	<8b356f880912222008o47ee54c9k267773cc570708d2@mail.gmail.com>
	<4B31AA41.2010700@earthlink.net>
Message-ID: <e8e755250912222132w600ba28dnf50fcd1e44c737eb@mail.gmail.com>

This is fantastically off-topic, and has nothing to do with *R*.

Out of "courtesy" to this list, the subscribers, and future readers,
please take this off-list where it belongs.

Jeff

On Tue, Dec 22, 2009 at 11:27 PM, Dominick Samperi
<djsamperi at earthlink.net> wrote:
> Stavros Macrakis wrote:
>>
>> That said, as a matter of courtesy and clarity, I'd think that a fork
>> should use a different name.
>
> Yes, the point is that this is not a legal or technical matter, it is a
> matter of professional courtesy.
>
> I take this as one vote for the name change.
>
> On US copyright law, this should not be confused with "copyright" notices
> that appear in GPL
> source code. Remember that these are really "copyleft" notices, and copyleft
> is designed to
> protect the rights of copiers, not original contributors. My concern about
> the copyright notice
> should be viewed in the same spirit as the name change (professional
> courtesy).
>
> Since GPL is largely silent on these issues I have asked the R community to
> vote...
>
> Thanks,
> Dominick
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Jeffrey Ryan
jeffrey.ryan at insightalgo.com

ia: insight algorithmics
www.insightalgo.com


From mwkimpel at gmail.com  Wed Dec 23 06:56:05 2009
From: mwkimpel at gmail.com (Mark Kimpel)
Date: Wed, 23 Dec 2009 00:56:05 -0500
Subject: [Rd] Rcpp: Clarifying the meaning of GPL?
In-Reply-To: <e8e755250912222132w600ba28dnf50fcd1e44c737eb@mail.gmail.com>
References: <4B310C77.9030806@earthlink.net>
	<8b356f880912222008o47ee54c9k267773cc570708d2@mail.gmail.com>
	<4B31AA41.2010700@earthlink.net>
	<e8e755250912222132w600ba28dnf50fcd1e44c737eb@mail.gmail.com>
Message-ID: <6b93d1830912222156p6b2bab33sb4c83535fe651420@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091223/11df74bb/attachment.pl>

From ripley at stats.ox.ac.uk  Wed Dec 23 11:23:21 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 23 Dec 2009 10:23:21 +0000 (GMT)
Subject: [Rd] cut.POSIXt problem with breaks= "quarter" (PR#14162)
In-Reply-To: <20091221124509.A2AFC282EFFB@mail.pubhealth.ku.dk>
References: <20091221124509.A2AFC282EFFB@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0912231020030.8321@gannet.stats.ox.ac.uk>

What exactly is the purported bug here?  It seems to me that the cuts 
are correct and the behaiour is as documented, but that you were not 
expecting empty levels.  If that bothers you, use

cut(x, breaks= "quarter")[,drop=TRUE]


On Mon, 21 Dec 2009, shmunde at googlemail.com wrote:

> Full_Name: Qing Xia
> Version: 2.10.0
> OS: Windows XP
> Submission from: (NULL) (213.71.23.233)
>
>
> I find, when I use "cut" function to cut date-time objects based on breaks =
> "quarter", there exists a problem. It means, if the date-time has "JJJJ-MM-30"
> or "JJJJ-MM-31", then "cut" runs not correctly, it gives wrong levels. Detail
> can be found in the following R-Output:
>
> 1. correct Output levels, if there is no date-time "JJJJ-MM-30" or "JJJJ-MM-31"
>
>> x<- as.Date(c("2009-03-21","2009-03-24"))
>> cut(x, breaks= "quarter")
> [1] 2009-01-01 2009-01-01
> Levels: 2009-01-01
>
>
> 2. wrong Output levels, if there exists date-time "JJJJ-MM-30" or "JJJJ-MM-31"
>
>> x<- as.Date(c("2009-03-21","2009-03-30"))
>> cut(x, breaks= "quarter")
> [1] 2009-01-01 2009-01-01
> Levels: 2009-01-01 2009-04-01
>
>
>> x<- as.Date(c("2009-03-21","2009-03-31"))
>> cut(x, breaks= "quarter")
> [1] 2009-01-01 2009-01-01
> Levels: 2009-01-01 2009-04-01
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From diverses at univecom.ch  Tue Dec 22 20:40:12 2009
From: diverses at univecom.ch (diverses at univecom.ch)
Date: Tue, 22 Dec 2009 20:40:12 +0100 (CET)
Subject: [Rd] as.Date function yields inconsistent results (PR#14166)
Message-ID: <20091222194012.1FDE22831FE1@mail.pubhealth.ku.dk>

Full_Name: Mario Luoni
Version: 2.10.0
OS: Windows XP HE SP3
Submission from: (NULL) (217.194.59.134)


This piece of code:

zzz1 <- as.POSIXct("1999-03-18", tz="CET")
zzz2 <- as.POSIXlt("1999-03-18", tz="CET")
zzz1 == zzz2
as.Date(zzz1)
as.Date(zzz2)

yields TRUE for "zzz1==zzz2", but the two dates returned by as.Date are 
different:

> as.Date(zzz1)
[1] "1999-03-17"
> as.Date(zzz2)
[1] "1999-03-18"

For me this looks like a bug, even though it could be a problem with timezones,
but I couldn't find documentation that would explain that behaviour.


> sessionInfo()
R version 2.10.0 (2009-10-26) 
i386-pc-mingw32 

locale:
[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252  

[3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C                         

[5] LC_TIME=English_United States.1252    

attached base packages:
[1] grDevices datasets  splines   graphics  stats     tcltk     utils    
methods   base     

other attached packages:
[1] svSocket_0.9-48 TinnR_1.0.3     R2HTML_1.59-1   Hmisc_3.7-0    
survival_2.35-7

loaded via a namespace (and not attached):
[1] cluster_1.12.1  grid_2.10.0     lattice_0.17-26 svMisc_0.9-56   tools_2.10.0


From jeffreys at rand.org  Tue Dec 22 20:55:35 2009
From: jeffreys at rand.org (Jeffrey M Sullivan)
Date: Tue, 22 Dec 2009 11:55:35 -0800
Subject: [Rd] sort yields different results on OS X (PR#14163)
In-Reply-To: <alpine.LFD.2.00.0912221212120.15604@toucan.stats.ox.ac.uk>
References: <20091221194009.4E4882830319@mail.pubhealth.ku.dk>
	<alpine.LFD.2.00.0912221212120.15604@toucan.stats.ox.ac.uk>
Message-ID: <04AAD302-691F-4A3E-9C3D-16B020B46258@rand.org>

On Dec 22, 2009, at 4:18 AM, Prof Brian Ripley wrote:

> As the help says
>
>     The sort order for character vectors will depend on the collating
>     sequence of the locale in use: see ?Comparison?.
>
> and that ref says
>
>     Collation of
>     non-letters (spaces, punctuation signs, hyphens, fractions and so
>     on) is even more problematic.
>
> That different OSes use the same name for a locale does not make  
> them the same locale.
>
> Note that R can be compiled to use ICU, which provides a well- 
> considered collation suite.  R on Mac OS X uses ICU, as does a Linux  
> build if it is available -- so I would say that it is RHEL that is  
> out of line here (it makes little sense to have < and > far apart in  
> the collation sequence).
>
> Why did you report a documented difference as a bug?
>

Because it wasn't clear to me from the documentation what sort of  
"problematic" behaviors were covered as documented differences vs  
unexpected behavior. Other OSS projects I have been involved with have  
a "when in doubt, file a bug" policy. If that isn't the case with R, I  
won't do so in the future.

Thank you for the pointer towards ICU. RHEL has some of the ICU  
libraries, but the icuSetCollate function returns a warning that R was  
not built with them. Including a reference to this function in the  
"See Also" for Comparison would make this info a little easier to find.

Thanks for your time,
Jeff

> On Mon, 21 Dec 2009, jeffreys at rand.org wrote:
>
>> Full_Name: Jeffrey Sullivan
>> Version: 2.10
>> OS: Mac
>> Submission from: (NULL) (130.154.0.250)
>>
>>
>> Sort produces different results when sorting strings with non- 
>> alphanumeric
>> characters, depending on the operating system:
>>
>> RHEL 5.2, R 2.10.0
>> -------------
>>> v <- c("1","<0",">3","2")
>>> Sys.setlocale("LC_COLLATE","en_US.UTF-8")
>> [1] "en_US.UTF-8"
>>> sort(v)
>> [1] "<0" "1"  "2"  ">3"
>>
>> Max OS 10.5.8, R 2.10.1
>> -------------------
>>> v <- c("1","<0",">3","2")
>>> Sys.setlocale("LC_COLLATE","en_US.UTF-8")
>> [1] "en_US.UTF-8"
>>> sort(v)
>> [1] "<0" ">3" "1"  "2"
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-- 
Jeffrey Sullivan
Senior Project Associate
RAND Corporation

Work : (310) 393-0411 x6883
Fax  : (310) 260-8147
SIPR : jeffreys at sm.rand.pentagon.smil.mil
JWICS: sullivanj at la.ic.gov

-------------- next part --------------

__________________________________________________________________________

This email message is for the sole use of the intended r...{{dropped:8}}


From macrakis at alum.mit.edu  Wed Dec 23 16:20:31 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Wed, 23 Dec 2009 10:20:31 -0500
Subject: [Rd] Rcpp: Clarifying the meaning of GPL?
In-Reply-To: <4B31AA41.2010700@earthlink.net>
References: <4B310C77.9030806@earthlink.net>
	<8b356f880912222008o47ee54c9k267773cc570708d2@mail.gmail.com>
	<4B31AA41.2010700@earthlink.net>
Message-ID: <8b356f880912230720g6ee4f82an37980cd3586f7f41@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091223/8fe3784d/attachment.pl>

From djsamperi at earthlink.net  Wed Dec 23 17:05:58 2009
From: djsamperi at earthlink.net (Dominick Samperi)
Date: Wed, 23 Dec 2009 11:05:58 -0500
Subject: [Rd] Rcpp: Clarifying the meaning of GPL?
In-Reply-To: <8b356f880912230720g6ee4f82an37980cd3586f7f41@mail.gmail.com>
References: <4B310C77.9030806@earthlink.net>	
	<8b356f880912222008o47ee54c9k267773cc570708d2@mail.gmail.com>	
	<4B31AA41.2010700@earthlink.net>
	<8b356f880912230720g6ee4f82an37980cd3586f7f41@mail.gmail.com>
Message-ID: <4B323FE6.8080800@earthlink.net>

In my view what has happened is not much different from a situation 
where I place my
name as co-author on a research paper that you have created, without 
your permission,
after making a few small edits that you may not agree with. Furthermore, 
if you complain
I simply present the results (at conferences) as my own without 
mentioning your name.

Is this just a dispute between implementers?

Stavros Macrakis wrote:
> On Wed, Dec 23, 2009 at 12:27 AM, Dominick Samperi 
> <djsamperi at earthlink.net <mailto:djsamperi at earthlink.net>> wrote:
>
>     Stavros Macrakis wrote:
>
>         That said, as a matter of courtesy and clarity, I'd think that
>         a fork should use a different name.
>
>     Yes, the point is that this is not a legal or technical matter, it
>     is a matter of professional courtesy.
>
>     I take this as one vote for the name change.
>
>
> The naming and maintenance history of this package (or these packages: 
> Rcpp and RcppTemplate) appears to be complicated, and I have no 
> interest in becoming an arbitrator or voter in what is a dispute 
> between you and other implementers.
>  
>
>     On US copyright law, this should not be confused with "copyright"
>     notices that appear in GPL
>     source code. Remember that these are really "copyleft" notices,
>     and copyleft is designed to
>     protect the rights of copiers, not original contributors.
>
>
> The copyright notice is a correct and legally valid copyright notice.  
> The GPL (copyleft) is the copyright *license*.  Like all licenses, it 
> defines the relationship between authors and copiers.  The GPL 
> explicitly avoided the so-called "obnoxious BSD advertising clause", 
> which has requirements about giving credit.
>
>               -s
>


From mtmorgan at fhcrc.org  Wed Dec 23 18:59:57 2009
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Wed, 23 Dec 2009 09:59:57 -0800
Subject: [Rd] how to catch useDynLib errors? Rgraphviz
Message-ID: <4B325A9D.3090104@fhcrc.org>

Rgraphviz load problems frequently involve a mismatch between the
version of graphviz installed on the user machine, compared to the
version of graphviz used to build the package.

Rgraphviz has a name space with useDynLib(Rgrahpviz), and an .onLoad
function that checks that the versions of the installed and built
graphviz match. Unfortunately, the .onLoad code is only evaluated if
useDynLib succeeds, so in many cases of version mismatch users receive
hard-to-interpret error messages.

Are there any hooks or other solutions available to catch errors during
useDynLib? Or will we have more success using library.dynam in .onLoad?

Thanks in advacne

Martin
-- 
Martin Morgan
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From sean.oriordain at gmail.com  Wed Dec 23 19:17:13 2009
From: sean.oriordain at gmail.com (Sean O'Riordain)
Date: Wed, 23 Dec 2009 18:17:13 +0000
Subject: [Rd] Rcpp: Clarifying the meaning of GPL?
In-Reply-To: <4B323FE6.8080800@earthlink.net>
References: <4B310C77.9030806@earthlink.net>
	<8b356f880912222008o47ee54c9k267773cc570708d2@mail.gmail.com>
	<4B31AA41.2010700@earthlink.net>
	<8b356f880912230720g6ee4f82an37980cd3586f7f41@mail.gmail.com>
	<4B323FE6.8080800@earthlink.net>
Message-ID: <8ed68eed0912231017h48c8c500v66cb2bac052200ba@mail.gmail.com>

Good afternoon,

While I don't know the history of this particular conflict - to me the
entire *purpose* of the GPL is to ALLOW forking of code which must
remain in public.  If somebody forks code and makes any change
whatsoever and then distributes either the diff or the entire previous
project, then they can (and probably should) add their name as a
copyright holder to the copyrights of previous contributors.  They
cannot however remove previous copyright holders names so easily.

It should be noted that having multiple independent copyright holder
names on a GPL project is normally held as a positive thing - it makes
it much harder to un-GPL the project.

Kind regards,
Sean


On Wed, Dec 23, 2009 at 4:05 PM, Dominick Samperi
<djsamperi at earthlink.net> wrote:
> In my view what has happened is not much different from a situation where I
> place my
> name as co-author on a research paper that you have created, without your
> permission,
> after making a few small edits that you may not agree with. Furthermore, if
> you complain
> I simply present the results (at conferences) as my own without mentioning
> your name.
>
> Is this just a dispute between implementers?
>
> Stavros Macrakis wrote:
>>
>> On Wed, Dec 23, 2009 at 12:27 AM, Dominick Samperi
>> <djsamperi at earthlink.net <mailto:djsamperi at earthlink.net>> wrote:
>>
>> ? ?Stavros Macrakis wrote:
>>
>> ? ? ? ?That said, as a matter of courtesy and clarity, I'd think that
>> ? ? ? ?a fork should use a different name.
>>
>> ? ?Yes, the point is that this is not a legal or technical matter, it
>> ? ?is a matter of professional courtesy.
>>
>> ? ?I take this as one vote for the name change.
>>
>>
>> The naming and maintenance history of this package (or these packages:
>> Rcpp and RcppTemplate) appears to be complicated, and I have no interest in
>> becoming an arbitrator or voter in what is a dispute between you and other
>> implementers.
>>
>> ? ?On US copyright law, this should not be confused with "copyright"
>> ? ?notices that appear in GPL
>> ? ?source code. Remember that these are really "copyleft" notices,
>> ? ?and copyleft is designed to
>> ? ?protect the rights of copiers, not original contributors.
>>
>>
>> The copyright notice is a correct and legally valid copyright notice. ?The
>> GPL (copyleft) is the copyright *license*. ?Like all licenses, it defines
>> the relationship between authors and copiers. ?The GPL explicitly avoided
>> the so-called "obnoxious BSD advertising clause", which has requirements
>> about giving credit.
>>
>> ? ? ? ? ? ? ?-s
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From sylvain.loiseau at unicaen.fr  Wed Dec 23 20:20:48 2009
From: sylvain.loiseau at unicaen.fr (Sylvain Loiseau)
Date: Wed, 23 Dec 2009 20:20:48 +0100
Subject: [Rd] A package for visualizing R syntax
Message-ID: <EB79B90A-EE79-4FC3-9FDB-E7A6C2805193@unicaen.fr>

Dear all,

I have written a small set of functions for drawing graphical representations of R objects and evaluations of R expressions.

It is mainly intended for pedagogical purposes. Here are some samples:

http://panini.u-paris10.fr/~sloiseau/sampleGraphics.pdf

The idea is to use some graphical conventions in order to make clear the abstract syntax and to explain function, extraction, recycling, type conversion, properties of data structures, etc.

I would be very interested in your reactions and comments. I'm wondering if it may become a R package. Does something like this already exist? May it be useful? What improvement may be planned? Have you some idea for the name of such a package (visualR, seeR... ?)

Best regards,
Sylvain
--
Sylvain Loiseau
sylvain.loiseau at unicaen.fr

Universit? de Caen Basse Normandie
Maison de la Recherche en Sciences Humaines
MRSH - SH018
Esplanade de la Paix
Campus 1
14032 Caen Cedex


From macrakis at alum.mit.edu  Wed Dec 23 22:00:45 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Wed, 23 Dec 2009 16:00:45 -0500
Subject: [Rd] Rcpp: Clarifying the meaning of GPL?
In-Reply-To: <4B323FE6.8080800@earthlink.net>
References: <4B310C77.9030806@earthlink.net>
	<8b356f880912222008o47ee54c9k267773cc570708d2@mail.gmail.com>
	<4B31AA41.2010700@earthlink.net>
	<8b356f880912230720g6ee4f82an37980cd3586f7f41@mail.gmail.com>
	<4B323FE6.8080800@earthlink.net>
Message-ID: <8b356f880912231300n3ed18c84vde9eef20a288f82f@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091223/11d39d02/attachment.pl>

From hb at stat.berkeley.edu  Wed Dec 23 22:21:05 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Wed, 23 Dec 2009 13:21:05 -0800
Subject: [Rd] Rcpp: Clarifying the meaning of GPL?
In-Reply-To: <8b356f880912231300n3ed18c84vde9eef20a288f82f@mail.gmail.com>
References: <4B310C77.9030806@earthlink.net>
	<8b356f880912222008o47ee54c9k267773cc570708d2@mail.gmail.com>
	<4B31AA41.2010700@earthlink.net>
	<8b356f880912230720g6ee4f82an37980cd3586f7f41@mail.gmail.com>
	<4B323FE6.8080800@earthlink.net>
	<8b356f880912231300n3ed18c84vde9eef20a288f82f@mail.gmail.com>
Message-ID: <59d7961d0912231321k2df5cb90lf128966969d11974@mail.gmail.com>

I guess one problem is who is in charge of the name Rcpp on CRAN.  For
instance, can I "fork" of yet another version of Rcpp (or any other
CRAN package) and submit it to CRAN?  Can the original author submit a
completely different Rcpp package breaking all the additions made by
the new contributors?  I don't think the GPL answers those questions,
but maybe there is something on the ownership to the (original)
"title/label/name/identifier" of a GPL artifact.

My $.02

/Henrik

On Wed, Dec 23, 2009 at 1:00 PM, Stavros Macrakis <macrakis at alum.mit.edu> wrote:
> The central purpose of the GPL license is precisely to allow and indeed
> encourage the behavior your are criticizing. ?In particular, when you
> release software under the GPL, you are *explicitly* giving recipients of
> the software the right to modify it pretty much in any way (trivial or
> radical) they please and redistribute it by any means they choose (as long
> as they redistribute source with binary and maintain the legal notices).
> There is no legal or ethical obligation to consult the original author in
> any way, or even to acknowledge the original author other than by
> maintaining his or her copyright notice. ?The only legal obligation is to
> maintain the copyright notice and the GPL license itself and to include a
> notice that the software has been modified (GPL3 section 5a).
>
> This is not an accident. ?The promulgators of the GPL, the FSF, believe that
> these are the conditions under which software is best distributed -- that
> implementors should be free to combine bits and pieces of software from a
> variety of GPL-compatible licenses with no fear of violating any of their
> licenses.
>
> Obviously these legal and ethical conditions are quite different from those
> which prevail in academic publishing, and if you don't like them, you should
> be releasing your software under a different license -- which will probably
> have the effect of making your software less useful to the community and
> therefore less widely known and used.
>
> ? ? ? ? ? ? ? -s
>
>
> On Wed, Dec 23, 2009 at 11:05 AM, Dominick Samperi
> <djsamperi at earthlink.net>wrote:
>
>> In my view what has happened is not much different from a situation where I
>> place my
>> name as co-author on a research paper that you have created, without your
>> permission,
>> after making a few small edits that you may not agree with. Furthermore, if
>> you complain
>> I simply present the results (at conferences) as my own without mentioning
>> your name.
>>
>> Is this just a dispute between implementers?
>>
>> Stavros Macrakis wrote:
>>
>> ?On Wed, Dec 23, 2009 at 12:27 AM, Dominick Samperi <
>>> djsamperi at earthlink.net <mailto:djsamperi at earthlink.net>> wrote:
>>>
>>> ? ?Stavros Macrakis wrote:
>>>
>>> ? ? ? ?That said, as a matter of courtesy and clarity, I'd think that
>>> ? ? ? ?a fork should use a different name.
>>>
>>> ? ?Yes, the point is that this is not a legal or technical matter, it
>>> ? ?is a matter of professional courtesy.
>>>
>>> ? ?I take this as one vote for the name change.
>>>
>>>
>>> The naming and maintenance history of this package (or these packages:
>>> Rcpp and RcppTemplate) appears to be complicated, and I have no interest in
>>> becoming an arbitrator or voter in what is a dispute between you and other
>>> implementers.
>>>
>>> ? ?On US copyright law, this should not be confused with "copyright"
>>> ? ?notices that appear in GPL
>>> ? ?source code. Remember that these are really "copyleft" notices,
>>> ? ?and copyleft is designed to
>>> ? ?protect the rights of copiers, not original contributors.
>>>
>>>
>>> The copyright notice is a correct and legally valid copyright notice. ?The
>>> GPL (copyleft) is the copyright *license*. ?Like all licenses, it defines
>>> the relationship between authors and copiers. ?The GPL explicitly avoided
>>> the so-called "obnoxious BSD advertising clause", which has requirements
>>> about giving credit.
>>>
>>> ? ? ? ? ? ? ?-s
>>>
>>>
>>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From jeff.a.ryan at gmail.com  Wed Dec 23 22:42:12 2009
From: jeff.a.ryan at gmail.com (Jeff Ryan)
Date: Wed, 23 Dec 2009 15:42:12 -0600
Subject: [Rd] Rcpp: Clarifying the meaning of GPL?
In-Reply-To: <59d7961d0912231321k2df5cb90lf128966969d11974@mail.gmail.com>
References: <4B310C77.9030806@earthlink.net>
	<8b356f880912222008o47ee54c9k267773cc570708d2@mail.gmail.com>
	<4B31AA41.2010700@earthlink.net>
	<8b356f880912230720g6ee4f82an37980cd3586f7f41@mail.gmail.com>
	<4B323FE6.8080800@earthlink.net>
	<8b356f880912231300n3ed18c84vde9eef20a288f82f@mail.gmail.com>
	<59d7961d0912231321k2df5cb90lf128966969d11974@mail.gmail.com>
Message-ID: <e8e755250912231342i4008c156o7545faac946a2b5e@mail.gmail.com>

One critical aspect to this is the fact that RcppTemplate seems to
have been where the Rcpp work moved to _before_ abandoning the Rcpp
project.

http://cran.r-project.org/src/contrib/Archive/RcppTemplate/

So the 'namespace' of Rcpp was left with seemingly no public intention
of picking it up.

One of the strengths of GPL is that a package can live on when the
original author has chosen to go a different route.  Rcpp was
maintained by another person (with backward compatibility I think) to
likely not break his (and other's) code.

I don't think it is in the best interest of the community to break
existing code, just because one would like to have complete control
over the end product.

Plus, everyone benefits from competition.  And we have a good one here.

My 2c ;-)

Jeff





On Wed, Dec 23, 2009 at 3:21 PM, Henrik Bengtsson <hb at stat.berkeley.edu> wrote:
> I guess one problem is who is in charge of the name Rcpp on CRAN. ?For
> instance, can I "fork" of yet another version of Rcpp (or any other
> CRAN package) and submit it to CRAN? ?Can the original author submit a
> completely different Rcpp package breaking all the additions made by
> the new contributors? ?I don't think the GPL answers those questions,
> but maybe there is something on the ownership to the (original)
> "title/label/name/identifier" of a GPL artifact.
>
> My $.02
>
> /Henrik
>
> On Wed, Dec 23, 2009 at 1:00 PM, Stavros Macrakis <macrakis at alum.mit.edu> wrote:
>> The central purpose of the GPL license is precisely to allow and indeed
>> encourage the behavior your are criticizing. ?In particular, when you
>> release software under the GPL, you are *explicitly* giving recipients of
>> the software the right to modify it pretty much in any way (trivial or
>> radical) they please and redistribute it by any means they choose (as long
>> as they redistribute source with binary and maintain the legal notices).
>> There is no legal or ethical obligation to consult the original author in
>> any way, or even to acknowledge the original author other than by
>> maintaining his or her copyright notice. ?The only legal obligation is to
>> maintain the copyright notice and the GPL license itself and to include a
>> notice that the software has been modified (GPL3 section 5a).
>>
>> This is not an accident. ?The promulgators of the GPL, the FSF, believe that
>> these are the conditions under which software is best distributed -- that
>> implementors should be free to combine bits and pieces of software from a
>> variety of GPL-compatible licenses with no fear of violating any of their
>> licenses.
>>
>> Obviously these legal and ethical conditions are quite different from those
>> which prevail in academic publishing, and if you don't like them, you should
>> be releasing your software under a different license -- which will probably
>> have the effect of making your software less useful to the community and
>> therefore less widely known and used.
>>
>> ? ? ? ? ? ? ? -s
>>
>>
>> On Wed, Dec 23, 2009 at 11:05 AM, Dominick Samperi
>> <djsamperi at earthlink.net>wrote:
>>
>>> In my view what has happened is not much different from a situation where I
>>> place my
>>> name as co-author on a research paper that you have created, without your
>>> permission,
>>> after making a few small edits that you may not agree with. Furthermore, if
>>> you complain
>>> I simply present the results (at conferences) as my own without mentioning
>>> your name.
>>>
>>> Is this just a dispute between implementers?
>>>
>>> Stavros Macrakis wrote:
>>>
>>> ?On Wed, Dec 23, 2009 at 12:27 AM, Dominick Samperi <
>>>> djsamperi at earthlink.net <mailto:djsamperi at earthlink.net>> wrote:
>>>>
>>>> ? ?Stavros Macrakis wrote:
>>>>
>>>> ? ? ? ?That said, as a matter of courtesy and clarity, I'd think that
>>>> ? ? ? ?a fork should use a different name.
>>>>
>>>> ? ?Yes, the point is that this is not a legal or technical matter, it
>>>> ? ?is a matter of professional courtesy.
>>>>
>>>> ? ?I take this as one vote for the name change.
>>>>
>>>>
>>>> The naming and maintenance history of this package (or these packages:
>>>> Rcpp and RcppTemplate) appears to be complicated, and I have no interest in
>>>> becoming an arbitrator or voter in what is a dispute between you and other
>>>> implementers.
>>>>
>>>> ? ?On US copyright law, this should not be confused with "copyright"
>>>> ? ?notices that appear in GPL
>>>> ? ?source code. Remember that these are really "copyleft" notices,
>>>> ? ?and copyleft is designed to
>>>> ? ?protect the rights of copiers, not original contributors.
>>>>
>>>>
>>>> The copyright notice is a correct and legally valid copyright notice. ?The
>>>> GPL (copyleft) is the copyright *license*. ?Like all licenses, it defines
>>>> the relationship between authors and copiers. ?The GPL explicitly avoided
>>>> the so-called "obnoxious BSD advertising clause", which has requirements
>>>> about giving credit.
>>>>
>>>> ? ? ? ? ? ? ?-s
>>>>
>>>>
>>>
>>
>> ? ? ? ?[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Jeffrey Ryan
jeffrey.ryan at insightalgo.com

ia: insight algorithmics
www.insightalgo.com


From ggrothendieck at gmail.com  Wed Dec 23 22:52:48 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 23 Dec 2009 16:52:48 -0500
Subject: [Rd] A package for visualizing R syntax
In-Reply-To: <EB79B90A-EE79-4FC3-9FDB-E7A6C2805193@unicaen.fr>
References: <EB79B90A-EE79-4FC3-9FDB-E7A6C2805193@unicaen.fr>
Message-ID: <971536df0912231352q57960fa9n781a374a3896b94c@mail.gmail.com>

Very nice.  Certainly it would be welcome to see this packaged for
widespread use.

On Wed, Dec 23, 2009 at 2:20 PM, Sylvain Loiseau
<sylvain.loiseau at unicaen.fr> wrote:
> Dear all,
>
> I have written a small set of functions for drawing graphical representations of R objects and evaluations of R expressions.
>
> It is mainly intended for pedagogical purposes. Here are some samples:
>
> http://panini.u-paris10.fr/~sloiseau/sampleGraphics.pdf
>
> The idea is to use some graphical conventions in order to make clear the abstract syntax and to explain function, extraction, recycling, type conversion, properties of data structures, etc.
>
> I would be very interested in your reactions and comments. I'm wondering if it may become a R package. Does something like this already exist? May it be useful? What improvement may be planned? Have you some idea for the name of such a package (visualR, seeR... ?)
>
> Best regards,
> Sylvain
> --
> Sylvain Loiseau
> sylvain.loiseau at unicaen.fr
>
> Universit? de Caen Basse Normandie
> Maison de la Recherche en Sciences Humaines
> MRSH - SH018
> Esplanade de la Paix
> Campus 1
> 14032 Caen Cedex
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From felix at nfrac.org  Wed Dec 23 23:12:51 2009
From: felix at nfrac.org (Felix Andrews)
Date: Thu, 24 Dec 2009 09:12:51 +1100
Subject: [Rd] A package for visualizing R syntax
In-Reply-To: <EB79B90A-EE79-4FC3-9FDB-E7A6C2805193@unicaen.fr>
References: <EB79B90A-EE79-4FC3-9FDB-E7A6C2805193@unicaen.fr>
Message-ID: <94730b8a0912231412s9412642h2fd7d7af6d977f63@mail.gmail.com>

Nice idea.
But I think "visualR" or "seeR" are way too vague.
How about "drawExpressions", or "showExpressions"?

-Felix

2009/12/24 Sylvain Loiseau <sylvain.loiseau at unicaen.fr>:
> Dear all,
>
> I have written a small set of functions for drawing graphical representations of R objects and evaluations of R expressions.
>
> It is mainly intended for pedagogical purposes. Here are some samples:
>
> http://panini.u-paris10.fr/~sloiseau/sampleGraphics.pdf
>
> The idea is to use some graphical conventions in order to make clear the abstract syntax and to explain function, extraction, recycling, type conversion, properties of data structures, etc.
>
> I would be very interested in your reactions and comments. I'm wondering if it may become a R package. Does something like this already exist? May it be useful? What improvement may be planned? Have you some idea for the name of such a package (visualR, seeR... ?)
>
> Best regards,
> Sylvain
> --
> Sylvain Loiseau
> sylvain.loiseau at unicaen.fr
>
> Universit? de Caen Basse Normandie
> Maison de la Recherche en Sciences Humaines
> MRSH - SH018
> Esplanade de la Paix
> Campus 1
> 14032 Caen Cedex
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Felix Andrews / ???
Postdoctoral Fellow
Integrated Catchment Assessment and Management (iCAM) Centre
Fenner School of Environment and Society [Bldg 48a]
The Australian National University
Canberra ACT 0200 Australia
M: +61 410 400 963
T: + 61 2 6125 4670
E: felix.andrews at anu.edu.au
CRICOS Provider No. 00120C
-- 
http://www.neurofractal.org/felix/


From ggrothendieck at gmail.com  Wed Dec 23 23:16:25 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 23 Dec 2009 17:16:25 -0500
Subject: [Rd] A package for visualizing R syntax
In-Reply-To: <94730b8a0912231412s9412642h2fd7d7af6d977f63@mail.gmail.com>
References: <EB79B90A-EE79-4FC3-9FDB-E7A6C2805193@unicaen.fr> 
	<94730b8a0912231412s9412642h2fd7d7af6d977f63@mail.gmail.com>
Message-ID: <971536df0912231416w612ae92dv68bbfbfd4a95bd05@mail.gmail.com>

or ExpressionBlocks

On Wed, Dec 23, 2009 at 5:12 PM, Felix Andrews <felix at nfrac.org> wrote:
> Nice idea.
> But I think "visualR" or "seeR" are way too vague.
> How about "drawExpressions", or "showExpressions"?
>
> -Felix
>
> 2009/12/24 Sylvain Loiseau <sylvain.loiseau at unicaen.fr>:
>> Dear all,
>>
>> I have written a small set of functions for drawing graphical representations of R objects and evaluations of R expressions.
>>
>> It is mainly intended for pedagogical purposes. Here are some samples:
>>
>> http://panini.u-paris10.fr/~sloiseau/sampleGraphics.pdf
>>
>> The idea is to use some graphical conventions in order to make clear the abstract syntax and to explain function, extraction, recycling, type conversion, properties of data structures, etc.
>>
>> I would be very interested in your reactions and comments. I'm wondering if it may become a R package. Does something like this already exist? May it be useful? What improvement may be planned? Have you some idea for the name of such a package (visualR, seeR... ?)
>>
>> Best regards,
>> Sylvain
>> --
>> Sylvain Loiseau
>> sylvain.loiseau at unicaen.fr
>>
>> Universit? de Caen Basse Normandie
>> Maison de la Recherche en Sciences Humaines
>> MRSH - SH018
>> Esplanade de la Paix
>> Campus 1
>> 14032 Caen Cedex
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
>
> --
> Felix Andrews / ???
> Postdoctoral Fellow
> Integrated Catchment Assessment and Management (iCAM) Centre
> Fenner School of Environment and Society [Bldg 48a]
> The Australian National University
> Canberra ACT 0200 Australia
> M: +61 410 400 963
> T: + 61 2 6125 4670
> E: felix.andrews at anu.edu.au
> CRICOS Provider No. 00120C
> --
> http://www.neurofractal.org/felix/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From savicky at cs.cas.cz  Wed Dec 23 23:42:23 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Wed, 23 Dec 2009 23:42:23 +0100
Subject: [Rd] choose(n,k) when n is almost integer
In-Reply-To: <20091222215843.GA9120@cs.cas.cz>
References: <19239.19864.396771.484772@lynne.math.ethz.ch>
	<20091215095243.GA14388@cs.cas.cz>
	<19239.38154.219034.206322@lynne.math.ethz.ch>
	<19242.15337.267242.128687@lynne.math.ethz.ch>
	<20091217231449.GA23480@cs.cas.cz>
	<19245.16249.290239.986122@cmath-6.math.ethz.ch>
	<20091222215843.GA9120@cs.cas.cz>
Message-ID: <20091223224223.GA3057@cs.cas.cz>

In a previous email, i suggested two patches A and B to choose(n, k), which
solve some of its problems, but keep some of the inaccuracies of the original
implementation. I would like to suggest another patch, which i will call C
(patch-C.txt in an attachment), which eliminates the warnings obtained sometimes
from the original implementation and which is more accurate in all ranges of
the output.

For testing patch C a simpler script is sufficient, since we need not to take
care of the warnings. Namely
  http://www.cs.cas.cz/~savicky/R-devel/test_choose_1.R
which produces the output (the error is the relative error)

  > source("test_choose_1.R")
  k <= 0 max err = 0 
  k <= 10 max err = 1.332268e-15 
  k <= 20 max err = 2.442491e-15 
  k <= 30 max err = 3.774758e-15 
  k <= 40 max err = 2.553513e-14 
  k <= 50 max err = 2.88658e-14 
  k <= 60 max err = 3.197442e-14 
  k <= 70 max err = 4.396483e-14 
  k <= 80 max err = 4.685141e-14 
  k <= 90 max err = 4.907186e-14 
  k <= 100 max err = 5.084821e-14 
  k <= 110 max err = 5.373479e-14 
  k <= 120 max err = 5.551115e-14 
  k <= 130 max err = 7.41629e-14 
  k <= 140 max err = 9.592327e-14 
  k <= 150 max err = 9.636736e-14 
  k <= 160 max err = 9.725554e-14 
  k <= 170 max err = 9.947598e-14 
  k <= 180 max err = 1.04583e-13 
  k <= 190 max err = 1.088019e-13 
  k <= 200 max err = 1.090239e-13 
  minimum log2() of a wrong result for integer n : 53.32468 
  maximum error for real n : 1.090239e-13 

Increasing accuracy of choose(n, k) for n almost an integer needed to use
additional transformations of it to those already used in the code. I will
work out a description of these transformations and send a link to it.
Similarly as patches A and B, patch C also does not modify lchoose().

It should be pointed out that choose(n, k) for non-integer n is mainly
needed if n is a rational number like 1/2, 1/3, 2/3, .... However, making
choose(n, k) accurate for all inputs seems to be not too complex as the
patch C and its test results show.

I appreciate comments on patch C.

Petr Savicky.

-------------- next part --------------
--- R-devel-orig-intel/src/nmath/choose.c	2009-12-17 17:52:39.000000000 +0100
+++ R-devel-work-copy-3-intel/src/nmath/choose.c	2009-12-23 21:59:40.000000000 +0100
@@ -93,13 +93,14 @@
     return lfastchoose(n, k);
 }
 
+#define IS_INT(x)	  ((x) == floor(x))
 #define k_small_max 30
 /* 30 is somewhat arbitrary: it is on the *safe* side:
  * both speed and precision are clearly improved for k < 30.
 */
 double choose(double n, double k)
 {
-    double r, k0 = k;
+    double r, k0 = k, l, aux;
     k = floor(k + 0.5);
 #ifdef IEEE_754
     /* NaNs propagated correctly */
@@ -109,36 +110,37 @@
 	MATHLIB_WARNING2(_("'k' (%.2f) must be integer, rounded to %.0f"), k0, k);
     if (k < k_small_max) {
 	int j;
-	if(n-k < k && n >= 0 && R_IS_INT(n)) k = n-k; /* <- Symmetry */
+	if(n-k < k && n >= 0 && IS_INT(n)) k = n-k; /* <- Symmetry */
 	if (k <	 0) return 0.;
 	if (k == 0) return 1.;
 	/* else: k >= 1 */
 	r = n;
 	for(j = 2; j <= k; j++)
-	    r *= (n-j+1)/j;
-	return R_IS_INT(n) ? floor(r + 0.5) : r;
+	    r *= (n-(j-1))/j;
+	return IS_INT(n) ? floor(r + 0.5) : r;
 	/* might have got rounding errors */
     }
     /* else: k >= k_small_max */
     if (n < 0) {
-	r = choose(-n+ k-1, k);
-	if (ODD(k)) r = -r;
+	r = n / k * choose(k - 1.0 - n, k - 1.0);
+	if (ODD(k - 1.0)) r = -r;
 	return r;
     }
-    else if (R_IS_INT(n)) {
+    else if (IS_INT(n)) {
 	if(n < k) return 0.;
 	if(n - k < k_small_max) return choose(n, n-k); /* <- Symmetry */
 	return floor(exp(lfastchoose(n, k)) + 0.5);
     }
     /* else non-integer n >= 0 : */
-    if (n < k-1) {
-	int s_choose;
-	r = lfastchoose2(n, k, /* -> */ &s_choose);
-	return s_choose * exp(r);
+    l = floor(n + 0.5);
+    if (l <= k-1) {
+	aux = lfastchoose(n, l) + lfastchoose(k - 1.0 - n, k - l - 1.0) - lfastchoose(k, l);
+	return exp(aux) * (n - l) / (k - l) * (ODD(k - l) ? 1.0 : - 1.0);
     }
     return exp(lfastchoose(n, k));
 }
 
 #undef ODD
+#undef IS_INT
 #undef R_IS_INT
 #undef k_small_max

From gheine at mathnmaps.com  Thu Dec 24 01:04:09 2009
From: gheine at mathnmaps.com (gheine at mathnmaps.com)
Date: Wed, 23 Dec 2009 17:04:09 -0700
Subject: [Rd] Locating code that is outside of functions in R scripts
Message-ID: <fb287d9d14fc581a6136541c2685b3b7@localhost>


Working with a number of scripts (text files with R commands) that I

"source" into R sessions from time to time.

The source() command is most convenient (at least for me) 

if it only loads function definitions, and doesn't otherwise change the

interactive environment.  For example, I might have a file that looks like



func1<-function() {

  code

  code

  code

  }

# this is a comment



A<-"this is code outside the function definitions";



func2<-function() {

   code

# a comment with a spurious } 

   code

   code

   }



I would like a quick-and-dirty script that finds the line beginnning with

"A", since it is R code outside of any function definition.

On the other hand it would ignore the two comment lines, and would not be

fooled by the spurious "}" in the second comment line.

Probably not too hard to put something like this together, but am making

this post in case it is something that has already been done.





Thanks!


From murdoch at stats.uwo.ca  Thu Dec 24 01:31:31 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 23 Dec 2009 19:31:31 -0500
Subject: [Rd] Locating code that is outside of functions in R scripts
In-Reply-To: <fb287d9d14fc581a6136541c2685b3b7@localhost>
References: <fb287d9d14fc581a6136541c2685b3b7@localhost>
Message-ID: <4B32B663.8080909@stats.uwo.ca>

On 23/12/2009 7:04 PM, gheine at mathnmaps.com wrote:
> Working with a number of scripts (text files with R commands) that I
> 
> "source" into R sessions from time to time.
> 
> The source() command is most convenient (at least for me) 
> 
> if it only loads function definitions, and doesn't otherwise change the
> 
> interactive environment.  For example, I might have a file that looks like
> 
> 
> 
> func1<-function() {
> 
>   code
> 
>   code
> 
>   code
> 
>   }
> 
> # this is a comment
> 
> 
> 
> A<-"this is code outside the function definitions";
> 
> 
> 
> func2<-function() {
> 
>    code
> 
> # a comment with a spurious } 
> 
>    code
> 
>    code
> 
>    }
> 
> 
> 
> I would like a quick-and-dirty script that finds the line beginnning with
> 
> "A", since it is R code outside of any function definition.
> 
> On the other hand it would ignore the two comment lines, and would not be
> 
> fooled by the spurious "}" in the second comment line.
> 
> Probably not too hard to put something like this together, but am making
> 
> this post in case it is something that has already been done.

You should call parse() to process the file, then examine the list of 
expressions that gets returned.  This function will recognize a function 
definition if it is the form above:

isfundef <- function(e) {
   identical(e[[1]], quote(`<-`)) && identical(e[[3]][[1]], 
quote(`function`))
}

but there are other ways to create functions which it will miss. 
Nevertheless, pasting your code into a file and doing this seems to give 
you what you want:

 > exprs <- parse("test.R")
 > lapply(exprs, isfundef)
[[1]]
[1] TRUE

[[2]]
[1] FALSE

[[3]]
[1] TRUE

 > exprs[[2]]
A <- "this is code outside the function definitions"

or

 > exprs[!unlist(lapply(exprs, isfundef))]
expression(A<-"this is code outside the function definitions")


Duncan Murdoch


From ggrothendieck at gmail.com  Thu Dec 24 01:51:30 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 23 Dec 2009 19:51:30 -0500
Subject: [Rd] Locating code that is outside of functions in R scripts
In-Reply-To: <fb287d9d14fc581a6136541c2685b3b7@localhost>
References: <fb287d9d14fc581a6136541c2685b3b7@localhost>
Message-ID: <971536df0912231651p1e65f22dvb1041afab78163fc@mail.gmail.com>

This sources the indicated file into the local environment (i.e. the
environment within src) and then only copies out the objects that are
functions into the workspace so that you are only left with them.

src <- function(file) {
   source(file, local = TRUE)
   for(nm in ls(all = TRUE)) if (is.function(get(nm))) assign(nm,
get(nm), .GlobalEnv)
}

# usage:
src("myfile.R")

On Wed, Dec 23, 2009 at 7:04 PM,  <gheine at mathnmaps.com> wrote:
>
> Working with a number of scripts (text files with R commands) that I
>
> "source" into R sessions from time to time.
>
> The source() command is most convenient (at least for me)
>
> if it only loads function definitions, and doesn't otherwise change the
>
> interactive environment. ?For example, I might have a file that looks like
>
>
>
> func1<-function() {
>
> ?code
>
> ?code
>
> ?code
>
> ?}
>
> # this is a comment
>
>
>
> A<-"this is code outside the function definitions";
>
>
>
> func2<-function() {
>
> ? code
>
> # a comment with a spurious }
>
> ? code
>
> ? code
>
> ? }
>
>
>
> I would like a quick-and-dirty script that finds the line beginnning with
>
> "A", since it is R code outside of any function definition.
>
> On the other hand it would ignore the two comment lines, and would not be
>
> fooled by the spurious "}" in the second comment line.
>
> Probably not too hard to put something like this together, but am making
>
> this post in case it is something that has already been done.
>
>
>
>
>
> Thanks!
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From djsamperi at earthlink.net  Thu Dec 24 06:59:18 2009
From: djsamperi at earthlink.net (Dominick Samperi)
Date: Thu, 24 Dec 2009 00:59:18 -0500
Subject: [Rd] Rcpp: Clarifying the meaning of GPL?
In-Reply-To: <e8e755250912231342i4008c156o7545faac946a2b5e@mail.gmail.com>
References: <4B310C77.9030806@earthlink.net>	
	<8b356f880912222008o47ee54c9k267773cc570708d2@mail.gmail.com>	
	<4B31AA41.2010700@earthlink.net>	
	<8b356f880912230720g6ee4f82an37980cd3586f7f41@mail.gmail.com>	
	<4B323FE6.8080800@earthlink.net>	
	<8b356f880912231300n3ed18c84vde9eef20a288f82f@mail.gmail.com>	
	<59d7961d0912231321k2df5cb90lf128966969d11974@mail.gmail.com>
	<e8e755250912231342i4008c156o7545faac946a2b5e@mail.gmail.com>
Message-ID: <4B330336.50004@earthlink.net>


Jeff Ryan wrote:
> One critical aspect to this is the fact that RcppTemplate seems to
> have been where the Rcpp work moved to _before_ abandoning the Rcpp
> project.
>   
The Rcpp package was not abandoned, it was renamed to RcppTemplate
because I thought it would be more useful for the R community to have a
complete solution to the package development problem,
not just a stand-alone library (Rcpp). The Rcpp package (not to be confused
with the Rcpp library!) forked from RcppTemplate_5.3, not Rcpp_x_x,
and RcppTemplate was in the CRAN archives the whole time (not
abandoned).

This explains Stavros' confusion about the naming, and it also highlights
the questions raised by Henrik. Perhaps there is a need for a package
name registrar.

> Plus, everyone benefits from competition.  And we have a good one here.
>
>   
I do not think having to compete with your own work is a "good one."
I may have to rename RcppTemplate and the Rcpp library again to
something entirely different.

Dominick


From twoutopias at gmail.com  Thu Dec 24 01:50:12 2009
From: twoutopias at gmail.com (twoutopias at gmail.com)
Date: Thu, 24 Dec 2009 01:50:12 +0100 (CET)
Subject: [Rd] bug in princomp example (PR#14167)
Message-ID: <20091224005012.6F5E5282EF4E@mail.pubhealth.ku.dk>

When I run

example(princomp)

I get the following error message:

prncmp> ## The variances of the variables in the
prncmp> ## USArrests data vary by orders of magnitude, so scaling is
appropriate
prncmp> (pc.cr <- princomp(USArrests))  # inappropriate
Error in cov.wt(z) : 'x' must contain finite values only

Seth Roberts



-- 
blog.sethroberts.net
www.shangriladiet.com
boards.shangriladiet.com
skype twoutopias
fax 267 222 4105
510 418 7753 (Berkeley)
1 368 117 0784 (Beijing)

	[[alternative HTML version deleted]]


From ehlers at ucalgary.ca  Fri Dec 25 01:17:56 2009
From: ehlers at ucalgary.ca (Peter Ehlers)
Date: Thu, 24 Dec 2009 17:17:56 -0700
Subject: [Rd] bug in princomp example (PR#14167)
In-Reply-To: <20091224005012.6F5E5282EF4E@mail.pubhealth.ku.dk>
References: <20091224005012.6F5E5282EF4E@mail.pubhealth.ku.dk>
Message-ID: <4B3404B4.2050708@ucalgary.ca>


twoutopias at gmail.com wrote:
> When I run
> 
> example(princomp)
> 
> I get the following error message:
> 
> prncmp> ## The variances of the variables in the
> prncmp> ## USArrests data vary by orders of magnitude, so scaling is
> appropriate
> prncmp> (pc.cr <- princomp(USArrests))  # inappropriate
> Error in cov.wt(z) : 'x' must contain finite values only

try rm(x) before you run the example; I think you might
have an 'x' hanging around in your workspace.
I had no trouble with the example run in a clean workspace.

 > sessionInfo()
R version 2.10.1 Patched (2009-12-21 r50796)
i386-pc-mingw32

locale:
[1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252
[3] LC_MONETARY=English_Canada.1252 LC_NUMERIC=C
[5] LC_TIME=English_Canada.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] fortunes_1.3-6

loaded via a namespace (and not attached):
[1] tools_2.10.1
 >
  -Peter Ehlers

> 
> Seth Roberts
> 
> 
> 

-- 
Peter Ehlers
University of Calgary
403.202.3921


From ggrothendieck at gmail.com  Fri Dec 25 14:23:56 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 25 Dec 2009 08:23:56 -0500
Subject: [Rd] simplifying number of R installations on disk
Message-ID: <971536df0912250523t481d4a31n213093fbde50f3be@mail.gmail.com>

If R-2.10.0 were the current version of R then by default there will
be an R-2.10.0 directory on your machine and when R-2.10.1 comes along
a new directory R-2-10.1 will be created if you use the installation
defaults.

I normally don't use the defaults but rather put all R-2.10.* versions
in the same directory so that R-2.10.1 overwrites R-2.10.0; however,
if the first or second number in the version change then I do use a
new directory.  Also I put any alpha or beta versions of R-2.10 in
R-2.10 again overwriting any prior R-2.10 version.

Actually this is already how it works for win-library.  That is, R
automatically generates a win-library\2.9, a win-library\2.10 but
there will not be automatically generated separate libraries for the
third level version number or for alpha or beta versions.

I think it would make more sense for the installation procedure of R
itself to use the same scheme that win-library uses since otherwise
there is an accumulation of too many directories as R changes.  It
should still be possible to have the current scheme for those who wish
to retain it but I doubt that most people really want to keep separate
third level versions separately so it would not be the default;
instead, a scheme that produces R-2.10, R-2.11, etc. R directories
would be the default.


From saptarshi.guha at gmail.com  Sat Dec 26 22:41:00 2009
From: saptarshi.guha at gmail.com (Saptarshi Guha)
Date: Sat, 26 Dec 2009 16:41:00 -0500
Subject: [Rd] Problem compiling R library on FC4 ( conflicting declaration
	in Rinterface.h and stdint.h)
Message-ID: <1e7471d50912261341m64f121aekdd8ebd4c99a679ff@mail.gmail.com>

Hello,
The package builds successfully on RHEL5 and OS X( 64 bit,32/64
respectively) but on FC4(32 bit) it fails with this error

g++ -m32 -I/usr/include/R  -I/usr/local/include    -fpic  -O2 -g -pipe
-Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
--param=ssp-buffer-size=4 -m32 -march=i386 -mtune=generic
-fasynchronous-unwind-tables -I. -g  `pkg-config --cflags protobuf`
-Wall -c display.cc -o display.o

/usr/include/R/Rinterface.h:84: error: conflicting declaration
'typedef long unsigned int uintptr_t'
/usr/include/stdint.h:129: error: 'uintptr_t' has a previous
declaration as 'typedef unsigned int uintptr_t'


display.cc includes a header file ream.h which has

#ifndef __ream_h
#define __ream_h

#include <iostream>
#include <google/protobuf/stubs/common.h>

#include <rexp.pb.h>
#include <stdint.h>  //commenting this does not make a difference
#include <sys/types.h>
#include <sys/time.h>
#include <time.h>
#include <errno.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/wait.h>

#define R_NO_REMAP
#define R_INTERFACE_PTRS 1
#define CSTACK_DEFNS 1

#include <Rversion.h>
#include <R.h>
#include <Rdefines.h>

#include <Rinterface.h>
#include <Rembedded.h>
#include <R_ext/Boolean.h>
#include <R_ext/Parse.h>
#include <R_ext/Rdynload.h>


Thanks
Saptarshi


From maiagx at gmail.com  Sun Dec 27 00:26:16 2009
From: maiagx at gmail.com (Charlotte Maia)
Date: Sun, 27 Dec 2009 12:26:16 +1300
Subject: [Rd] simplifying number of R installations on disk
Message-ID: <b7bfe54e0912261526k2c541356y86aa27ae9d5400f3@mail.gmail.com>

I think it's a very bad idea to truncate version numbers.
Version numbers are important, and there may be a critical difference
x.y.0 and x.y.1.
Plus there is no guarantee that the updated version is better than the
previous one.
Hence a programmer may need to go back to x.y.0 until x.y.2 is released.

Perhaps there should be an option somewhere to remove existing
installations (maybe there is????), however by default, installing a
new version of a programming language, should not uninstall existing
versions.


-- 
Charlotte Maia
Open Source Developer and Statistician
http://sites.google.com/site/maiagx


From marc_schwartz at me.com  Sun Dec 27 00:53:02 2009
From: marc_schwartz at me.com (Marc Schwartz)
Date: Sat, 26 Dec 2009 17:53:02 -0600
Subject: [Rd] Problem compiling R library on FC4 ( conflicting
	declaration	in Rinterface.h and stdint.h)
In-Reply-To: <1e7471d50912261341m64f121aekdd8ebd4c99a679ff@mail.gmail.com>
References: <1e7471d50912261341m64f121aekdd8ebd4c99a679ff@mail.gmail.com>
Message-ID: <0AEF0B3E-C385-4F0F-A27F-817109A28B52@me.com>

FC4?  Really?

That has not been supported in over 3 years.

The only versions of Fedora currently supported are 11 and 12. You  
need to get that machine updated.

My vague recollection was that there were a variety of fortran  
compiler issues around that time (circa 2005/2006) with FC4, though I  
could not locate anything specific regarding the error message you are  
observing.

Get your computer updated to a current version of Fedora, if that is  
the Linux distribution you wish to stay with. Trying to debug compiler  
problems on a Linux distribution that itself has not been supported in  
a long time is asking for trouble.

Marc Schwartz


On Dec 26, 2009, at 3:41 PM, Saptarshi Guha wrote:

> Hello,
> The package builds successfully on RHEL5 and OS X( 64 bit,32/64
> respectively) but on FC4(32 bit) it fails with this error
>
> g++ -m32 -I/usr/include/R  -I/usr/local/include    -fpic  -O2 -g -pipe
> -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
> --param=ssp-buffer-size=4 -m32 -march=i386 -mtune=generic
> -fasynchronous-unwind-tables -I. -g  `pkg-config --cflags protobuf`
> -Wall -c display.cc -o display.o
>
> /usr/include/R/Rinterface.h:84: error: conflicting declaration
> 'typedef long unsigned int uintptr_t'
> /usr/include/stdint.h:129: error: 'uintptr_t' has a previous
> declaration as 'typedef unsigned int uintptr_t'
>
>
> display.cc includes a header file ream.h which has
>
> #ifndef __ream_h
> #define __ream_h
>
> #include <iostream>
> #include <google/protobuf/stubs/common.h>
>
> #include <rexp.pb.h>
> #include <stdint.h>  //commenting this does not make a difference
> #include <sys/types.h>
> #include <sys/time.h>
> #include <time.h>
> #include <errno.h>
> #include <fcntl.h>
> #include <signal.h>
> #include <stdio.h>
> #include <stdlib.h>
> #include <string.h>
> #include <unistd.h>
> #include <sys/wait.h>
>
> #define R_NO_REMAP
> #define R_INTERFACE_PTRS 1
> #define CSTACK_DEFNS 1
>
> #include <Rversion.h>
> #include <R.h>
> #include <Rdefines.h>
>
> #include <Rinterface.h>
> #include <Rembedded.h>
> #include <R_ext/Boolean.h>
> #include <R_ext/Parse.h>
> #include <R_ext/Rdynload.h>
>
>
> Thanks
> Saptarshi
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ggrothendieck at gmail.com  Sun Dec 27 02:16:19 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 26 Dec 2009 20:16:19 -0500
Subject: [Rd] simplifying number of R installations on disk
In-Reply-To: <b7bfe54e0912261526k2c541356y86aa27ae9d5400f3@mail.gmail.com>
References: <b7bfe54e0912261526k2c541356y86aa27ae9d5400f3@mail.gmail.com>
Message-ID: <971536df0912261716ucf3ef2kb54c4027aab0982d@mail.gmail.com>

On Sat, Dec 26, 2009 at 6:26 PM, Charlotte Maia <maiagx at gmail.com> wrote:
> I think it's a very bad idea to truncate version numbers.
> Version numbers are important, and there may be a critical difference
> x.y.0 and x.y.1.
> Plus there is no guarantee that the updated version is better than the
> previous one.
> Hence a programmer may need to go back to x.y.0 until x.y.2 is released.
>
> Perhaps there should be an option somewhere to remove existing
> installations (maybe there is????), however by default, installing a
> new version of a programming language, should not uninstall existing
> versions.

A new version of R comes out almost daily or weekly.  I don't think
many would want to create a separate R directory daily or weekly so
there has to be some sensible cutoff somewhere. In particular, its
important to distinguish 1st and 2nd level versions with 3rd level
versions.  I would agree with you for 1st and 2nd level versions but
not for 3rd level versions which is what is being discussed here.  3rd
level versions

- don't have critical differences and
- you virtually never have to go back since third level versions are
basically bug fixes

so I don't think such arguments apply.  The fact that one bug fix can
generate another bug is more theoretical than a real problem that is
encountered.  If you did want to go back there is nothing to prevent
you from downloading the old version again (although in years of
following this scheme I have never had to do it) or using the last 2nd
level version.   Also if you don't like the whole scheme its only a
default, not an operating requirement, so for those few people who
want a separate installation for every third level version they could
still have it just as anyone can implement the proposed scheme even in
the absence making it the default; however, for most people I think
that generating a large number of alpha, beta, pat, *.0, *.1
directories is pointless since they will never use anything other than
the most recent in any x.y.* series.


From edd at debian.org  Sun Dec 27 04:56:14 2009
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sat, 26 Dec 2009 21:56:14 -0600
Subject: [Rd] simplifying number of R installations on disk
In-Reply-To: <971536df0912261716ucf3ef2kb54c4027aab0982d@mail.gmail.com>
References: <b7bfe54e0912261526k2c541356y86aa27ae9d5400f3@mail.gmail.com>
	<971536df0912261716ucf3ef2kb54c4027aab0982d@mail.gmail.com>
Message-ID: <19254.56030.904030.376115@ron.nulle.part>


Moreover, one may want to script use of R. And while I use R a lot more on
non-Windows systems I do have helper and convenience scripts, PATH settings
etc to create packages on Windows.  For that I find it a PITA to have to
adjust things on each upgrade --- and hence some time ago I stopped accepting
the defaults and started to install R into C:/opt/R/R-current/ and treat that
as a fixed path. I find this makes my life on Windows easier -- and yes,
R_LIBS is also set to a fixed path.

Dirk

-- 
Three out of two people have difficulties with fractions.


From ggrothendieck at gmail.com  Sun Dec 27 05:38:38 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 26 Dec 2009 23:38:38 -0500
Subject: [Rd] simplifying number of R installations on disk
In-Reply-To: <19254.56030.904030.376115@ron.nulle.part>
References: <b7bfe54e0912261526k2c541356y86aa27ae9d5400f3@mail.gmail.com> 
	<971536df0912261716ucf3ef2kb54c4027aab0982d@mail.gmail.com> 
	<19254.56030.904030.376115@ron.nulle.part>
Message-ID: <971536df0912262038q2277af8an22af9189bafe453a@mail.gmail.com>

Note that there is a batch file Rgui.bat, etc. here:

http://batchfiles.googlecode.com

that will find R in the Windows registry and then run Rgui.exe so that
you don't need to change any paths each time you do an install. There
is also a command, Rversions.hta, that will display which versions of
R you have and set whichever you wish to be the current version.

R already uses the scheme that I mentioned for libraries (i.e. it
creates a new library when x or y in x.y.z changes but not when z
changes so I find it convenient to just stick to its default in that
case  The batchfiles collection also has utilities for moving and
copying libraries as well as notes on other ways to do it and also a
variety of other R-related batch files for Windows.

On Sat, Dec 26, 2009 at 10:56 PM, Dirk Eddelbuettel <edd at debian.org> wrote:
>
> Moreover, one may want to script use of R. And while I use R a lot more on
> non-Windows systems I do have helper and convenience scripts, PATH settings
> etc to create packages on Windows. ?For that I find it a PITA to have to
> adjust things on each upgrade --- and hence some time ago I stopped accepting
> the defaults and started to install R into C:/opt/R/R-current/ and treat that
> as a fixed path. I find this makes my life on Windows easier -- and yes,
> R_LIBS is also set to a fixed path.
>
> Dirk
>
> --
> Three out of two people have difficulties with fractions.
>


From ripley at stats.ox.ac.uk  Sun Dec 27 08:01:04 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 27 Dec 2009 07:01:04 +0000 (GMT)
Subject: [Rd] Problem compiling R library on FC4 ( conflicting
 declaration in Rinterface.h and stdint.h)
In-Reply-To: <0AEF0B3E-C385-4F0F-A27F-817109A28B52@me.com>
References: <1e7471d50912261341m64f121aekdd8ebd4c99a679ff@mail.gmail.com>
	<0AEF0B3E-C385-4F0F-A27F-817109A28B52@me.com>
Message-ID: <alpine.LFD.2.00.0912270655590.18065@gannet.stats.ox.ac.uk>

On Sat, 26 Dec 2009, Marc Schwartz wrote:

> FC4?  Really?

That was my reaction, but I think there may be another problem.  The 
subject line said 'R library', the body said 'The package'.  What are 
we talking about here?  Rinterface.h is intended for alternative 
front-ends (see the comments in the file), and there ought to be a 
configure script in such front-ends, defining e.g. HAVE_UINTPTR_T.

We were not told the version of R: maybe that is equally old?

> That has not been supported in over 3 years.
>
> The only versions of Fedora currently supported are 11 and 12. You need to 
> get that machine updated.
>
> My vague recollection was that there were a variety of fortran compiler 
> issues around that time (circa 2005/2006) with FC4, though I could not locate 
> anything specific regarding the error message you are observing.

(S)he is using C++.

> Get your computer updated to a current version of Fedora, if that is the 
> Linux distribution you wish to stay with. Trying to debug compiler problems 
> on a Linux distribution that itself has not been supported in a long time is 
> asking for trouble.
>
> Marc Schwartz
>
>
> On Dec 26, 2009, at 3:41 PM, Saptarshi Guha wrote:
>
>> Hello,
>> The package builds successfully on RHEL5 and OS X( 64 bit,32/64
>> respectively) but on FC4(32 bit) it fails with this error
>> 
>> g++ -m32 -I/usr/include/R  -I/usr/local/include    -fpic  -O2 -g -pipe
>> -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
>> --param=ssp-buffer-size=4 -m32 -march=i386 -mtune=generic
>> -fasynchronous-unwind-tables -I. -g  `pkg-config --cflags protobuf`
>> -Wall -c display.cc -o display.o
>> 
>> /usr/include/R/Rinterface.h:84: error: conflicting declaration
>> 'typedef long unsigned int uintptr_t'
>> /usr/include/stdint.h:129: error: 'uintptr_t' has a previous
>> declaration as 'typedef unsigned int uintptr_t'
>> 
>> 
>> display.cc includes a header file ream.h which has
>> 
>> #ifndef __ream_h
>> #define __ream_h
>> 
>> #include <iostream>
>> #include <google/protobuf/stubs/common.h>
>> 
>> #include <rexp.pb.h>
>> #include <stdint.h>  //commenting this does not make a difference
>> #include <sys/types.h>
>> #include <sys/time.h>
>> #include <time.h>
>> #include <errno.h>
>> #include <fcntl.h>
>> #include <signal.h>
>> #include <stdio.h>
>> #include <stdlib.h>
>> #include <string.h>
>> #include <unistd.h>
>> #include <sys/wait.h>
>> 
>> #define R_NO_REMAP
>> #define R_INTERFACE_PTRS 1
>> #define CSTACK_DEFNS 1
>> 
>> #include <Rversion.h>
>> #include <R.h>
>> #include <Rdefines.h>
>> 
>> #include <Rinterface.h>
>> #include <Rembedded.h>
>> #include <R_ext/Boolean.h>
>> #include <R_ext/Parse.h>
>> #include <R_ext/Rdynload.h>
>> 
>> 
>> Thanks
>> Saptarshi

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From saptarshi.guha at gmail.com  Sun Dec 27 16:43:54 2009
From: saptarshi.guha at gmail.com (Saptarshi Guha)
Date: Sun, 27 Dec 2009 10:43:54 -0500
Subject: [Rd] Problem compiling R library on FC4 ( conflicting
	declaration in Rinterface.h and stdint.h)
In-Reply-To: <alpine.LFD.2.00.0912270655590.18065@gannet.stats.ox.ac.uk>
References: <1e7471d50912261341m64f121aekdd8ebd4c99a679ff@mail.gmail.com> 
	<0AEF0B3E-C385-4F0F-A27F-817109A28B52@me.com>
	<alpine.LFD.2.00.0912270655590.18065@gannet.stats.ox.ac.uk>
Message-ID: <1e7471d50912270743w21b5091xd2a3b32dcd570022@mail.gmail.com>

My apologies all around, I'm using FC8.


> That was my reaction, but I think there may be another problem. ?The subject
> line said 'R library', the body said 'The package'. ?What are we talking
> about here? ?Rinterface.h is intended for alternative front-ends (see the
> comments in the file), and there ought to be a configure script in such
> front-ends, defining e.g. HAVE_UINTPTR_T.

The code is both a library and a frontend, I couldn't recall the word frontend.
I'm building this on Amazon EC2 32bit FC8 AMI, so will dig around.
Regards
Saptarshi
R-2.8


>
> We were not told the version of R: maybe that is equally old?
>
>> That has not been supported in over 3 years.
>>
>> The only versions of Fedora currently supported are 11 and 12. You need to
>> get that machine updated.
>>
>> My vague recollection was that there were a variety of fortran compiler
>> issues around that time (circa 2005/2006) with FC4, though I could not
>> locate anything specific regarding the error message you are observing.
>
> (S)he is using C++.
>
>> Get your computer updated to a current version of Fedora, if that is the
>> Linux distribution you wish to stay with. Trying to debug compiler problems
>> on a Linux distribution that itself has not been supported in a long time is
>> asking for trouble.
>>
>> Marc Schwartz
>>
>>
>> On Dec 26, 2009, at 3:41 PM, Saptarshi Guha wrote:
>>
>>> Hello,
>>> The package builds successfully on RHEL5 and OS X( 64 bit,32/64
>>> respectively) but on FC4(32 bit) it fails with this error
>>>
>>> g++ -m32 -I/usr/include/R ?-I/usr/local/include ? ?-fpic ?-O2 -g -pipe
>>> -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
>>> --param=ssp-buffer-size=4 -m32 -march=i386 -mtune=generic
>>> -fasynchronous-unwind-tables -I. -g ?`pkg-config --cflags protobuf`
>>> -Wall -c display.cc -o display.o
>>>
>>> /usr/include/R/Rinterface.h:84: error: conflicting declaration
>>> 'typedef long unsigned int uintptr_t'
>>> /usr/include/stdint.h:129: error: 'uintptr_t' has a previous
>>> declaration as 'typedef unsigned int uintptr_t'
>>>
>>>
>>> display.cc includes a header file ream.h which has
>>>
>>> #ifndef __ream_h
>>> #define __ream_h
>>>
>>> #include <iostream>
>>> #include <google/protobuf/stubs/common.h>
>>>
>>> #include <rexp.pb.h>
>>> #include <stdint.h> ?//commenting this does not make a difference
>>> #include <sys/types.h>
>>> #include <sys/time.h>
>>> #include <time.h>
>>> #include <errno.h>
>>> #include <fcntl.h>
>>> #include <signal.h>
>>> #include <stdio.h>
>>> #include <stdlib.h>
>>> #include <string.h>
>>> #include <unistd.h>
>>> #include <sys/wait.h>
>>>
>>> #define R_NO_REMAP
>>> #define R_INTERFACE_PTRS 1
>>> #define CSTACK_DEFNS 1
>>>
>>> #include <Rversion.h>
>>> #include <R.h>
>>> #include <Rdefines.h>
>>>
>>> #include <Rinterface.h>
>>> #include <Rembedded.h>
>>> #include <R_ext/Boolean.h>
>>> #include <R_ext/Parse.h>
>>> #include <R_ext/Rdynload.h>
>>>
>>>
>>> Thanks
>>> Saptarshi
>
> --
> Brian D. Ripley, ? ? ? ? ? ? ? ? ?ripley at stats.ox.ac.uk
> Professor of Applied Statistics, ?http://www.stats.ox.ac.uk/~ripley/
> University of Oxford, ? ? ? ? ? ? Tel: ?+44 1865 272861 (self)
> 1 South Parks Road, ? ? ? ? ? ? ? ? ? ? +44 1865 272866 (PA)
> Oxford OX1 3TG, UK ? ? ? ? ? ? ? ?Fax: ?+44 1865 272595
>


From marc_schwartz at me.com  Sun Dec 27 17:01:11 2009
From: marc_schwartz at me.com (Marc Schwartz)
Date: Sun, 27 Dec 2009 10:01:11 -0600
Subject: [Rd] Problem compiling R library on FC4 ( conflicting
 declaration in Rinterface.h and stdint.h)
In-Reply-To: <alpine.LFD.2.00.0912270655590.18065@gannet.stats.ox.ac.uk>
References: <1e7471d50912261341m64f121aekdd8ebd4c99a679ff@mail.gmail.com>
	<0AEF0B3E-C385-4F0F-A27F-817109A28B52@me.com>
	<alpine.LFD.2.00.0912270655590.18065@gannet.stats.ox.ac.uk>
Message-ID: <3D874156-FDB6-4D35-AA3E-FFBDF46366D2@me.com>

On Dec 27, 2009, at 1:01 AM, Prof Brian Ripley wrote:

> On Sat, 26 Dec 2009, Marc Schwartz wrote:
>
>> FC4?  Really?
>
> That was my reaction, but I think there may be another problem.  The  
> subject line said 'R library', the body said 'The package'.  What  
> are we talking about here?  Rinterface.h is intended for alternative  
> front-ends (see the comments in the file), and there ought to be a  
> configure script in such front-ends, defining e.g. HAVE_UINTPTR_T.
>
> We were not told the version of R: maybe that is equally old?
>
>> That has not been supported in over 3 years.
>>
>> The only versions of Fedora currently supported are 11 and 12. You  
>> need to get that machine updated.
>>
>> My vague recollection was that there were a variety of fortran  
>> compiler issues around that time (circa 2005/2006) with FC4, though  
>> I could not locate anything specific regarding the error message  
>> you are observing.
>
> (S)he is using C++.


Indeed. For some reason I saw the 'g++' below and combined with my  
recollections of FC4, my brain translated that to g77.

Thanks for noting that.

Marc


>> Get your computer updated to a current version of Fedora, if that  
>> is the Linux distribution you wish to stay with. Trying to debug  
>> compiler problems on a Linux distribution that itself has not been  
>> supported in a long time is asking for trouble.
>>
>> Marc Schwartz
>>
>>
>> On Dec 26, 2009, at 3:41 PM, Saptarshi Guha wrote:
>>
>>> Hello,
>>> The package builds successfully on RHEL5 and OS X( 64 bit,32/64
>>> respectively) but on FC4(32 bit) it fails with this error
>>> g++ -m32 -I/usr/include/R  -I/usr/local/include    -fpic  -O2 -g - 
>>> pipe
>>> -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
>>> --param=ssp-buffer-size=4 -m32 -march=i386 -mtune=generic
>>> -fasynchronous-unwind-tables -I. -g  `pkg-config --cflags protobuf`
>>> -Wall -c display.cc -o display.o
>>> /usr/include/R/Rinterface.h:84: error: conflicting declaration
>>> 'typedef long unsigned int uintptr_t'
>>> /usr/include/stdint.h:129: error: 'uintptr_t' has a previous
>>> declaration as 'typedef unsigned int uintptr_t'
>>> display.cc includes a header file ream.h which has
>>> #ifndef __ream_h
>>> #define __ream_h
>>> #include <iostream>
>>> #include <google/protobuf/stubs/common.h>
>>> #include <rexp.pb.h>
>>> #include <stdint.h>  //commenting this does not make a difference
>>> #include <sys/types.h>
>>> #include <sys/time.h>
>>> #include <time.h>
>>> #include <errno.h>
>>> #include <fcntl.h>
>>> #include <signal.h>
>>> #include <stdio.h>
>>> #include <stdlib.h>
>>> #include <string.h>
>>> #include <unistd.h>
>>> #include <sys/wait.h>
>>> #define R_NO_REMAP
>>> #define R_INTERFACE_PTRS 1
>>> #define CSTACK_DEFNS 1
>>> #include <Rversion.h>
>>> #include <R.h>
>>> #include <Rdefines.h>
>>> #include <Rinterface.h>
>>> #include <Rembedded.h>
>>> #include <R_ext/Boolean.h>
>>> #include <R_ext/Parse.h>
>>> #include <R_ext/Rdynload.h>
>>> Thanks
>>> Saptarshi


From whuber at embl.de  Mon Dec 28 10:02:33 2009
From: whuber at embl.de (Wolfgang Huber)
Date: Mon, 28 Dec 2009 10:02:33 +0100
Subject: [Rd] Locating code that is outside of functions in R scripts
In-Reply-To: <971536df0912231651p1e65f22dvb1041afab78163fc@mail.gmail.com>
References: <fb287d9d14fc581a6136541c2685b3b7@localhost>
	<971536df0912231651p1e65f22dvb1041afab78163fc@mail.gmail.com>
Message-ID: <4B387429.6090907@embl.de>

Dear Gheine,

you could also start creating your own package with these functions, and 
manage the code using R's well thought-out package management 
functionalities, with namespaces etc. At some point, this might be less 
effort than (re-)inventing tools as below.

		Best wishes
		Wolfgang




Gabor Grothendieck wrote:
> This sources the indicated file into the local environment (i.e. the
> environment within src) and then only copies out the objects that are
> functions into the workspace so that you are only left with them.
> 
> src <- function(file) {
>    source(file, local = TRUE)
>    for(nm in ls(all = TRUE)) if (is.function(get(nm))) assign(nm,
> get(nm), .GlobalEnv)
> }
> 
> # usage:
> src("myfile.R")
> 
> On Wed, Dec 23, 2009 at 7:04 PM,  <gheine at mathnmaps.com> wrote:
>> Working with a number of scripts (text files with R commands) that I
>>
>> "source" into R sessions from time to time.
>>
>> The source() command is most convenient (at least for me)
>>
>> if it only loads function definitions, and doesn't otherwise change the
>>
>> interactive environment.  For example, I might have a file that looks like
>>
>>
>>
>> func1<-function() {
>>
>>  code
>>
>>  code
>>
>>  code
>>
>>  }
>>
>> # this is a comment
>>
>>
>>
>> A<-"this is code outside the function definitions";
>>
>>
>>
>> func2<-function() {
>>
>>   code
>>
>> # a comment with a spurious }
>>
>>   code
>>
>>   code
>>
>>   }
>>
>>
>>
>> I would like a quick-and-dirty script that finds the line beginnning with
>>
>> "A", since it is R code outside of any function definition.
>>
>> On the other hand it would ignore the two comment lines, and would not be
>>
>> fooled by the spurious "}" in the second comment line.
>>
>> Probably not too hard to put something like this together, but am making
>>
>> this post in case it is something that has already been done.
>>
>>
>>
>>
>>
>> Thanks!
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 

Best wishes
      Wolfgang


--
Wolfgang Huber
EMBL
http://www.embl.de/research/units/genome_biology/huber/contact


From tplate at acm.org  Mon Dec 28 10:15:06 2009
From: tplate at acm.org (Tony Plate)
Date: Mon, 28 Dec 2009 02:15:06 -0700
Subject: [Rd] as.Date function yields inconsistent results (PR#14166)
In-Reply-To: <20091222194012.1FDE22831FE1@mail.pubhealth.ku.dk>
References: <20091222194012.1FDE22831FE1@mail.pubhealth.ku.dk>
Message-ID: <4B38771A.5060209@acm.org>

I think you're right that this is a timezone issue -- it seems to be a 
consequence of the behavior described about in the article by Gabor 
Grothendieck and Thomas Petzoldt: "R help desk: Date and time classes in 
R." R News, 4(1):29-32, June 2004. 
<http://cran.r-project.org/doc/Rnews/Rnews_2004-1.pdf>  
http://cran.r-project.org/doc/Rnews/Rnews_2004-1.pdf

(there is a reference at 
http://wiki.r-project.org/rwiki/doku.php?id=guides:times-dates)

BEGIN QUOTE from p31 http://cran.r-project.org/doc/Rnews/Rnews_2004-1.pdf

Regarding POSIX classes, the user should be aware of the following:
...
* POSIXlt.  The tzone attribute on POSIXlt times are ignored so it is 
safer to use POSIXct than POSIXlt when performing arithmetic or other 
manipulations that may depend on time zones.

END QUOTE

The ignoring of the tzone attribute appears to apply to as.Date() 
conversions too.  The behavior is especially interesting because POSIXlt 
objects are converted to POSIXct objects by arithmetic, and the 
arithmetic operation preserves the tzone attribute.  So, if you want 
as.Date() to pay attention to the tzone attribute of a POSIXlt object, 
you might be able to just add 0 to it (or just use as.POSIXct() on it).  
(Though I don't know if there are other pitfalls in this path to catch 
the unwary).  The following demonstrates various aspects of the behavior:


 > d.ct.CET <- as.POSIXct("1999-03-18", tz="CET")
 > d.lt.CET <- as.POSIXlt("1999-03-18", tz="CET")
 > d.ct.UTC <- as.POSIXct("1999-03-18", tz="UTC")
 > d.lt.UTC <- as.POSIXlt("1999-03-18", tz="UTC")
 > d.ct.EST <- as.POSIXct("1999-03-18", tz="EST")
 > d.lt.EST <- as.POSIXlt("1999-03-18", tz="EST")
 > # ii is hours to catch the date changes in the time-zones here
 > ii <- c(0,1,19,20,23,24)*3600
 > # all columns of x1 are as.Date() of POSIXct objects
 > # each column follows its tzone attribute because as.Date() pays
 > # attention to tzone attr of POSIXct object, and arithmetic converts
 > # POSIXlt object to POSIXct object preserving the tzone attr
 > (x1 <- data.frame(hour=ii, ct.UTC=as.Date(d.ct.UTC + ii), 
lt.UTC=as.Date(d.lt.UTC + ii), ct.CET=as.Date(d.ct.CET + ii), 
lt.CET=as.Date(d.lt.CET + ii), ct.EST=as.Date(d.ct.EST + ii), 
lt.EST=as.Date(d.lt.EST + ii)))
   hour     ct.UTC     lt.UTC     ct.CET     lt.CET     ct.EST     lt.EST
1     0 1999-03-18 1999-03-18 1999-03-17 1999-03-17 1999-03-18 1999-03-18
2  3600 1999-03-18 1999-03-18 1999-03-18 1999-03-18 1999-03-18 1999-03-18
3 68400 1999-03-18 1999-03-18 1999-03-18 1999-03-18 1999-03-19 1999-03-19
4 72000 1999-03-18 1999-03-18 1999-03-18 1999-03-18 1999-03-19 1999-03-19
5 82800 1999-03-18 1999-03-18 1999-03-18 1999-03-18 1999-03-19 1999-03-19
6 86400 1999-03-19 1999-03-19 1999-03-18 1999-03-18 1999-03-19 1999-03-19
 > all.equal(x1$lt.UTC, x1$ct.UTC)
[1] TRUE
 > all.equal(x1$lt.CET, x1$ct.CET)
[1] TRUE
 > all.equal(x1$lt.EST, x1$ct.EST)
[1] TRUE
 > class(d.lt.EST)
[1] "POSIXt"  "POSIXlt"
 > class(d.lt.EST + ii)
[1] "POSIXt"  "POSIXct"
 > as.POSIXlt(d.lt.EST + ii)
[1] "1999-03-18 00:00:00 EST" "1999-03-18 01:00:00 EST"
[3] "1999-03-18 19:00:00 EST" "1999-03-18 20:00:00 EST"
[5] "1999-03-18 23:00:00 EST" "1999-03-19 00:00:00 EST"
 >
 > # the lt.* columns of x2 are as.Date() of POSIXlt objects, and these
 > # are all the same the ct.UTC column because as.Date() ignores the
 > # tzone attribute of POSIXlt objects
 > (x2 <- data.frame(hour=ii, ct.UTC=as.Date(d.ct.UTC + ii), 
lt.UTC=as.Date(as.POSIXlt(d.lt.UTC + ii)), ct.CET=as.Date(d.ct.CET + 
ii), lt.CET=as.Date(as.POSIXlt(d.lt.CET + ii)), ct.EST=as.Date(d.ct.EST 
+ ii), lt.EST=as.Date(as.POSIXlt(d.lt.EST + ii))))
   hour     ct.UTC     lt.UTC     ct.CET     lt.CET     ct.EST     lt.EST
1     0 1999-03-18 1999-03-18 1999-03-17 1999-03-18 1999-03-18 1999-03-18
2  3600 1999-03-18 1999-03-18 1999-03-18 1999-03-18 1999-03-18 1999-03-18
3 68400 1999-03-18 1999-03-18 1999-03-18 1999-03-18 1999-03-19 1999-03-18
4 72000 1999-03-18 1999-03-18 1999-03-18 1999-03-18 1999-03-19 1999-03-18
5 82800 1999-03-18 1999-03-18 1999-03-18 1999-03-18 1999-03-19 1999-03-18
6 86400 1999-03-19 1999-03-19 1999-03-18 1999-03-19 1999-03-19 1999-03-19
 > all.equal(x2$lt.UTC, x2$ct.UTC)
[1] TRUE
 > all.equal(x2$lt.CET, x2$ct.UTC)
[1] TRUE
 > all.equal(x2$lt.EST, x2$ct.UTC)
[1] TRUE
 >
 > sessionInfo()
R version 2.10.1 (2009-12-14)
i486-pc-linux-gnu

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C             
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8   
 [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8  
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                
 [9] LC_ADDRESS=C               LC_TELEPHONE=C           
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C      

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base    

loaded via a namespace (and not attached):
[1] tools_2.10.1
 >
 >


diverses at univecom.ch wrote:
> Full_Name: Mario Luoni
> Version: 2.10.0
> OS: Windows XP HE SP3
> Submission from: (NULL) (217.194.59.134)
>
>
> This piece of code:
>
> zzz1 <- as.POSIXct("1999-03-18", tz="CET")
> zzz2 <- as.POSIXlt("1999-03-18", tz="CET")
> zzz1 == zzz2
> as.Date(zzz1)
> as.Date(zzz2)
>
> yields TRUE for "zzz1==zzz2", but the two dates returned by as.Date are 
> different:
>
>   
>> as.Date(zzz1)
>>     
> [1] "1999-03-17"
>   
>> as.Date(zzz2)
>>     
> [1] "1999-03-18"
>
> For me this looks like a bug, even though it could be a problem with timezones,
> but I couldn't find documentation that would explain that behaviour.
>
>
>   
>> sessionInfo()
>>     
> R version 2.10.0 (2009-10-26) 
> i386-pc-mingw32 
>
> locale:
> [1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252  
>
> [3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C                         
>
> [5] LC_TIME=English_United States.1252    
>
> attached base packages:
> [1] grDevices datasets  splines   graphics  stats     tcltk     utils    
> methods   base     
>
> other attached packages:
> [1] svSocket_0.9-48 TinnR_1.0.3     R2HTML_1.59-1   Hmisc_3.7-0    
> survival_2.35-7
>
> loaded via a namespace (and not attached):
> [1] cluster_1.12.1  grid_2.10.0     lattice_0.17-26 svMisc_0.9-56   tools_2.10.0
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From sylvain.loiseau at unicaen.fr  Mon Dec 28 10:58:55 2009
From: sylvain.loiseau at unicaen.fr (Sylvain Loiseau)
Date: Mon, 28 Dec 2009 10:58:55 +0100
Subject: [Rd] A package for visualizing R syntax
In-Reply-To: <971536df0912231416w612ae92dv68bbfbfd4a95bd05@mail.gmail.com>
References: <EB79B90A-EE79-4FC3-9FDB-E7A6C2805193@unicaen.fr>
	<94730b8a0912231412s9412642h2fd7d7af6d977f63@mail.gmail.com>
	<971536df0912231416w612ae92dv68bbfbfd4a95bd05@mail.gmail.com>
Message-ID: <A1A12A6C-4ACE-4BA9-8B6A-5375B8D10DA5@unicaen.fr>

Thanks!
I have submitted a project on R-forge (not sure it is the good place), with package name "drawExpression".

Sylvain

Le 23 d?c. 2009 ? 23:16, Gabor Grothendieck a ?crit :

> or ExpressionBlocks
> 
> On Wed, Dec 23, 2009 at 5:12 PM, Felix Andrews <felix at nfrac.org> wrote:
>> Nice idea.
>> But I think "visualR" or "seeR" are way too vague.
>> How about "drawExpressions", or "showExpressions"?
>> 
>> -Felix
>> 
>> 2009/12/24 Sylvain Loiseau <sylvain.loiseau at unicaen.fr>:
>>> Dear all,
>>> 
>>> I have written a small set of functions for drawing graphical representations of R objects and evaluations of R expressions.
>>> 
>>> It is mainly intended for pedagogical purposes. Here are some samples:
>>> 
>>> http://panini.u-paris10.fr/~sloiseau/sampleGraphics.pdf
>>> 
>>> The idea is to use some graphical conventions in order to make clear the abstract syntax and to explain function, extraction, recycling, type conversion, properties of data structures, etc.
>>> 
>>> I would be very interested in your reactions and comments. I'm wondering if it may become a R package. Does something like this already exist? May it be useful? What improvement may be planned? Have you some idea for the name of such a package (visualR, seeR... ?)
>>> 
>>> Best regards,
>>> Sylvain
>>> --
>>> Sylvain Loiseau
>>> sylvain.loiseau at unicaen.fr
>>> 
>>> Universit? de Caen Basse Normandie
>>> Maison de la Recherche en Sciences Humaines
>>> MRSH - SH018
>>> Esplanade de la Paix
>>> Campus 1
>>> 14032 Caen Cedex
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>> 
>> 
>> 
>> --
>> Felix Andrews / ???
>> Postdoctoral Fellow
>> Integrated Catchment Assessment and Management (iCAM) Centre
>> Fenner School of Environment and Society [Bldg 48a]
>> The Australian National University
>> Canberra ACT 0200 Australia
>> M: +61 410 400 963
>> T: + 61 2 6125 4670
>> E: felix.andrews at anu.edu.au
>> CRICOS Provider No. 00120C
>> --
>> http://www.neurofractal.org/felix/
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
> 

--
Sylvain Loiseau
sylvain.loiseau at unicaen.fr

Universit? de Caen Basse Normandie
Maison de la Recherche en Sciences Humaines
MRSH - SH018
Esplanade de la Paix
Campus 1
14032 Caen Cedex


From osklyar at gmx.com  Sun Dec 27 20:25:12 2009
From: osklyar at gmx.com (osklyar at gmx.com)
Date: Sun, 27 Dec 2009 20:25:12 +0100 (CET)
Subject: [Rd] R CMD SHLIB on Mac OS X fails when the default tempdir() is
	used (PR#14168)
Message-ID: <20091227192512.8EF4F282EEFA@mail.pubhealth.ku.dk>

This is prompted by trying to run the 'inline' package on Mac OS X Leopard =
with R 2.10.1. Mac uses completely crazy temp paths and R uses those as wel=
l. The inline package creates source files in the temp directory which it t=
hen compiles with R CMD SHLIB and attaches. The compilation fails with the =
error message below which seems to be caused by the complexity of the path =
(compiling the same file with R CMD SHLIB and a sane path is ok, see below)=
. What can look like an inline problem, in fact is not inline's as it fails=
 in exactly the same way when run from a command line (see below). It fails=
 on c, cpp, f files. For the inline package, I will get a workaround by set=
wd to the location of the code and then setwd back, but generally one shoul=
d be able to run R CMD SHLIB with any valid path, at least this one contain=
s only alphanumerics and + and -.

Best,
Oleg

Browse[2]> system("/Library/Frameworks/R.framework/Resources/bin/R CMD SHLI=
B /var/folders/bU/bUB3Gk1uHBuDXq1G72Xc+++++TI/-Tmp-/RtmpGzn3kA/file60b7acd9=
.cpp")
Error in sub(p0(base, "."), "", a) :=20
  invalid regular expression '/var/folders/bU/bUB3Gk1uHBuDXq1G72Xc+++++TI/-=
Tmp-/RtmpGzn3kA/file60b7acd9.'
Calls: <Anonymous> -> .shlib_internal -> sub
In addition: Warning message:
In sub(p0(base, "."), "", a) :
  regcomp error:  'Invalid use of repetition operators'
Execution halted
Browse[2]> system("R CMD SHLIB /var/folders/bU/bUB3Gk1uHBuDXq1G72Xc+++++TI/=
-Tmp-/RtmpGzn3kA/file60b7acd9.cpp")
Error in sub(p0(base, "."), "", a) :=20
  invalid regular expression '/var/folders/bU/bUB3Gk1uHBuDXq1G72Xc+++++TI/-=
Tmp-/RtmpGzn3kA/file60b7acd9.'
Calls: <Anonymous> -> .shlib_internal -> sub
In addition: Warning message:
In sub(p0(base, "."), "", a) :
  regcomp error:  'Invalid use of repetition operators'
Execution halted
Browse[2]> tempdir()
[1] "/var/folders/bU/bUB3Gk1uHBuDXq1G72Xc+++++TI/-Tmp-//RtmpGzn3kA"
Browse[2]> sessionInfo()
R version 2.10.1 (2009-12-14)=20
x86_64-apple-darwin9.8.0=20

locale:
[1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base=20=20=
=20=20=20

other attached packages:
[1] inline_0.3.3.1

bash-3.2$ R CMD SHLIB /var/folders/bU/bUB3Gk1uHBuDXq1G72Xc+++++TI/-Tmp-/Rtm=
pGzn3kA/file60b7acd9.cpp
Error in sub(p0(base, "."), "", a) :=20
  invalid regular expression '/var/folders/bU/bUB3Gk1uHBuDXq1G72Xc+++++TI/-=
Tmp-/RtmpGzn3kA/file60b7acd9.'
Calls: <Anonymous> -> .shlib_internal -> sub
In addition: Warning message:
In sub(p0(base, "."), "", a) :
  regcomp error:  'Invalid use of repetition operators'
Execution halted
bash-3.2$ pwd
/Users/osklyar/Code
bash-3.2$ cd tmp/
bash-3.2$ ln -s /var/folders/bU/bUB3Gk1uHBuDXq1G72Xc+++++TI/-Tmp-/RtmpGzn3k=
A/file60b7acd9.cpp file60b7acd9.cpp
bash-3.2$ ls
file60b7acd9.cpp        inline
bash-3.2$ R CMD SHLIB file60b7acd9.cpp=20
g++-4.2 -arch x86_64 -I/Library/Frameworks/R.framework/Resources/include -I=
/Library/Frameworks/R.framework/Resources/include/x86_64  -I/usr/local/incl=
ude    -fPIC  -mtune=3Dcore2 -g -O2 -c file60b7acd9.cpp -o file60b7acd9.o
g++-4.2 -arch x86_64 -dynamiclib -Wl,-headerpad_max_install_names -undefine=
d dynamic_lookup -single_module -multiply_defined suppress -L/usr/local/lib=
 -o file60b7acd9.so file60b7acd9.o -F/Library/Frameworks/R.framework/.. -fr=
amework R -Wl,-framework -Wl,CoreFoundation
	[[alternative HTML version deleted]]


From gunter.berton at gene.com  Tue Dec 29 00:05:09 2009
From: gunter.berton at gene.com (gunter.berton at gene.com)
Date: Tue, 29 Dec 2009 00:05:09 +0100 (CET)
Subject: [Rd] bug in rep.unit method for grid arithmetic ? (PR#14170)
Message-ID: <20091228230510.25568282EF4F@mail.pubhealth.ku.dk>

The following code should suffice to document the problem.

Things work properly in the following:

> x <- unit.c(unit(5,"mm"),unit(3,"npc"))
> x
[1] 5mm  3npc
> rep(x,2)
[1] 5mm  3npc 5mm  3npc
> rep(x, e=2)
[1] 5mm  5npc 3mm  3npc
> rep(x,c(2,2))
[1] 5mm  5npc 3mm  3npc

However, not so for:

> x <- x - unit(1,"mm")
> x
[1] 5mm-1mm  3npc-1mm
> rep(x,2)
[1] 5mm-1mm  3npc-1mm 5mm-1mm  3npc-1mm
> rep(x, e=2)
[1] 5mm-1mm  3npc-1mm   ##ERROR
> rep(x,c(2,2))
Error in rep(unclass(x), ...) : invalid 'times' argument


> sessionInfo()
R version 2.10.0 (2009-10-26) 
i386-pc-mingw32 

locale:
[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United
States.1252   
[3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C

[5] LC_TIME=English_United States.1252    

attached base packages:
 [1] datasets  splines   grid      tcltk     stats     graphics  grDevices
utils     methods   base     

other attached packages:
[1] TinnR_1.0.3     R2HTML_1.59-1   Hmisc_3.7-0     survival_2.35-7
svSocket_0.9-48 lattice_0.17-26 MASS_7.3-3     

loaded via a namespace (and not attached):
[1] cluster_1.12.1 svMisc_0.9-56  tools_2.10.0  


Best regards and Happy New Year to All,

Bert Gunter
Genentech Nonclinical Biostatistics


From schlather at math.uni-goettingen.de  Tue Dec 29 02:05:10 2009
From: schlather at math.uni-goettingen.de (schlather at math.uni-goettingen.de)
Date: Tue, 29 Dec 2009 02:05:10 +0100 (CET)
Subject: [Rd] different behaviour of NAs under valgrind (PR#14171)
Message-ID: <20091229010510.D84E9282EEFA@mail.pubhealth.ku.dk>

Full_Name: Martin Schlather
Version: 2.10.0
OS: linux
Submission from: (NULL) (91.3.220.231)


 
Bug summary:
    some functions behave differently for NAs when
    valgrind is used in R, e.g. sum and prod


Bug demonstration:
---  without  valgrind ----
>  sum(c(NA,1)[1])
[1] NA

---  with  valgrind ----
> sum(c(NA,1)[1])
[1] NaN


R call with valgrind:
R -d "valgrind --tool=memcheck --memcheck:leak-check=yes --num-callers=20 "

using
valgrind-3.3.0


platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status =
 major = 2
 minor = 10.0
 year = 2009
 month = 10
 day = 26
 svn rev = 50208
 language = R
 version.string = R version 2.10.0 (2009-10-26)

Locale:
LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;LC_COLLATE=en_GB.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_GB.UTF-8;LC_PAPER=en_GB.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_GB.UTF-8;LC_IDENTIFICATION=C

Search Path:
 .GlobalEnv, package:stats, package:graphics, package:grDevices, package:utils,
package:datasets, package:methods, Autoloads, package:base


From hartwig.deneke at gmail.com  Tue Dec 29 10:26:40 2009
From: hartwig.deneke at gmail.com (Hartwig Deneke)
Date: Tue, 29 Dec 2009 10:26:40 +0100
Subject: [Rd] Calling Fortran90 code from R
Message-ID: <1cd92f370912290126s137f83d9k5223e877cc237c64@mail.gmail.com>

Dear all,

I am currently trying to create a package wrapping Fortran90 code, the
RRTMG radiative transfer model( http://rtweb.aer.com/rrtm_frame.html).
I am doing this on a Linux workstation, with gcc/gfortran, in case
this matters. The code heavily relies on F90 features, in particular
modules, which seem to clash with R's assumptions for calling compiled
code.

What I have done:
-compiled the files to mod/object files using gfortran
-am able to create a dynamic link library "librrtmg.so"

Further experiments:
- dyn.load('librrtmg.so') works
-. with "objdump -T librrtmg.so", I have found the following function
symbols to call:
    1. __rrtmg_lw_init_MOD_rrtmg_lw_ini (the initialization of the code)
    2. __rrtmg_?w_rad_MOD_rrtmg_lw (the actual main function I want
to call to do the calculations)
- These symbols are found via "is.loaded", but only without specifying
"type='FORTRAN'" (I have experimented with upper/lowercase letters as
well as dropping the leading underscores)
- I have not been able to call these routines via the ".Fortran" interface.
- I do managed to call a simple F90 subroutine (with similar argument
list, for experimentation) via the ".C" interface. However, I am not
able to  pass 2D field of type "DOUBLE", but always get a crash.

Is there any official way for calling Fortran90 libraries which I
missed (I have both searched through the documentation and this list)?
Any advice how to go about this? My best idea at the moment seems to
be to write a simple C wrapper for the Fortran routines, and call the
wrapper from R. If needed, I can also post some code from my
experiments. I'd actually like to get something which could be
submitted to CRAN out of this (are there any other packages depending
on Fortran90 code?)

Thanks in advance for any help,
Hartwig Deneke


From sgiannerini at gmail.com  Tue Dec 29 12:37:49 2009
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Tue, 29 Dec 2009 12:37:49 +0100
Subject: [Rd] Calling Fortran90 code from R
In-Reply-To: <1cd92f370912290126s137f83d9k5223e877cc237c64@mail.gmail.com>
References: <1cd92f370912290126s137f83d9k5223e877cc237c64@mail.gmail.com>
Message-ID: <3c12769c0912290337t65d774c4mf32ff36e78ed6923@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091229/75d2b287/attachment.pl>

From oehl_list at gmx.de  Mon Dec 28 20:50:13 2009
From: oehl_list at gmx.de (oehl_list at gmx.de)
Date: Mon, 28 Dec 2009 20:50:13 +0100 (CET)
Subject: [Rd] seq.int broken (seq as well) (PR#14169)
Message-ID: <20091228195013.29A1E282EF4F@mail.pubhealth.ku.dk>

Full_Name: Jens Oehlschl?gel
Version: 2.10.1
OS: Windows XP
Submission from: (NULL) (156.109.18.2)


# fine as expected from help page: 
# "from+by, ..., up to the sequence value less than or equal to to"
# thus 1+10=11 is not in
> seq.int(1L, 10L, by=10L)
[1] 1

# of course 1+1e7 should also not be in
# but is: wrong
> seq.int(1L, 1e7L, by=1e7L)
[1] 1e+00 1e+07

# since we use seq.int AND are within integer range, rounding should not be an
issue


> version
               _                            
platform       i386-pc-mingw32              
arch           i386                         
os             mingw32                      
system         i386, mingw32                
status                                      
major          2                            
minor          10.1                         
year           2009                         
month          12                           
day            14                           
svn rev        50720                        
language       R                            
version.string R version 2.10.1 (2009-12-14)


From hartwig.deneke at gmail.com  Tue Dec 29 13:44:22 2009
From: hartwig.deneke at gmail.com (Hartwig Deneke)
Date: Tue, 29 Dec 2009 13:44:22 +0100
Subject: [Rd] Calling Fortran90 code from R
In-Reply-To: <3c12769c0912290337t65d774c4mf32ff36e78ed6923@mail.gmail.com>
References: <1cd92f370912290126s137f83d9k5223e877cc237c64@mail.gmail.com>
	<3c12769c0912290337t65d774c4mf32ff36e78ed6923@mail.gmail.com>
Message-ID: <1cd92f370912290444gffb6372o3006a746da671329@mail.gmail.com>

2009/12/29 Simone Giannerini <sgiannerini at gmail.com>:
> Dear Hartwig,
>
> I think there are many packages that use F90 code and you should really be
> able to call it by following the advices in the R-exts
> manual. There are no major differences with F77 and you do not need a C
> wrapper. Maybe you might start with a simple example like this one.
>
....(helpful example removed)...
> open R ************************
> dyn.load("foo.so")
> is.loaded("foo")
>
> TRUE
Dear Simone (and others reading),

first of all thanks for your helpful example. While I did something
similar yesterday, it did give me a simple example to start from which
worked, and find a nice approach to solving my problems. A brief
summary of the origin of my problems, which are related to the use of
Fortran90 module declarations.

It is perfectly possible to call Fortran90 code compiled with
gfortran. Compiling a subroutine/function "foo" will produce a symbol
"foo_" in the dynamic library. If, however, the subroutine is
contained in a module named "modname", the symbol will be called
"__modname_MOD_foo". In  this case, it will not be found by the
".Fortran" call or a call to "is.loaded", at least I have not found
any way to do this. However, for my purposes, I have simply added a
set of wrapper subroutines to the library (which I planned to add
anyway for other reasons, in particular to reduce the number of
arguments), which forwards the calls to the module functions, and
everything seems to work all right.

Kind Regards,
Hartwig


From sgiannerini at gmail.com  Tue Dec 29 16:51:44 2009
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Tue, 29 Dec 2009 16:51:44 +0100
Subject: [Rd] Calling Fortran90 code from R
In-Reply-To: <1cd92f370912290444gffb6372o3006a746da671329@mail.gmail.com>
References: <1cd92f370912290126s137f83d9k5223e877cc237c64@mail.gmail.com>
	<3c12769c0912290337t65d774c4mf32ff36e78ed6923@mail.gmail.com>
	<1cd92f370912290444gffb6372o3006a746da671329@mail.gmail.com>
Message-ID: <3c12769c0912290751j60459db8mdf522f618c4d7580@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091229/c4e7cfcc/attachment.pl>

From p.dalgaard at biostat.ku.dk  Tue Dec 29 22:46:50 2009
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 29 Dec 2009 22:46:50 +0100
Subject: [Rd] Outage in Copenhagen tomorrow
Message-ID: <4B3A78CA.5000806@biostat.ku.dk>

This came in at 11:21 today:

"From 30/12-2009 at 15.30 untill 31/12-2009 at 08.00, ALL IT services at 
SUND-IT will be shut down!

ALL forms of electronic communication will be affected at SUND; VPN, 
Webmail, Mail, Print, Network drives, Servers ie.
Furthermore, Panum, CSS, Teilum, Museion and Biocenteret will have no 
access to the Internet.

The time of restoration of normal IT services, will be updated at 
http://it.sund.ku.dk the 30. December at 20.00 and 22.00.

This is a planned upgrade of firewalls, which can?t be implemented 
without impacting IT services."

(Timings are CET)

Apart from my personal activities (mail and remote access to servers and 
desktop systems), this is also going to block access to 
bugs.r-project.org. Hopefully, things will return to normal afterwards.

-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From maiagx at gmail.com  Wed Dec 30 10:05:31 2009
From: maiagx at gmail.com (Charlotte Maia)
Date: Wed, 30 Dec 2009 22:05:31 +1300
Subject: [Rd] UML Class and Object Diagrams in R
Message-ID: <b7bfe54e0912300105x153885fr481394af2a675ada@mail.gmail.com>

Hi all

Does anyone know if there are any R packages available for creating
UML class and object diagrams in R (suitable for use with Latex)?

I'm considering developing such a system...
Note, I'm aware there are Latex packages (so no one needs to state the obvious).

On a side issue I'm thinking about (mostly) abandoning the class
system I mentioned earlier. Thank you to Martin Maechler, Thomas
Petzoldt and Barry Rowlingson, for their feedback.


kind regards
-- 
Charlotte Maia
Open Source Developer and Statistician
http://sites.google.com/site/maiagx


From ripley at stats.ox.ac.uk  Wed Dec 30 16:45:59 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 30 Dec 2009 15:45:59 +0000 (GMT)
Subject: [Rd] different behaviour of NAs under valgrind (PR#14171)
In-Reply-To: <20091229010510.D84E9282EEFA@mail.pubhealth.ku.dk>
References: <20091229010510.D84E9282EEFA@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0912292041440.3307@gannet.stats.ox.ac.uk>

On Tue, 29 Dec 2009, schlather at math.uni-goettingen.de wrote:

> Full_Name: Martin Schlather
> Version: 2.10.0

Not current ....
> OS: linux

Not really specific enough to be helpful: these things depend on the 
compiler and libc.

> Submission from: (NULL) (91.3.220.231)
>
> Bug summary:
>    some functions behave differently for NAs when
>    valgrind is used in R, e.g. sum and prod

Why is that something to be reported to R-bugs?

For me (with the current valgrind 3.5.0 on i686 Fedora 12) exactly the 
same compiled code gives different results when run natively and under 
valgrind.  That looks very like a bug in valgrind's runtime, and it is 
incomprehensible as to why you assign blame to R.


>
> Bug demonstration:
> ---  without  valgrind ----
>>  sum(c(NA,1)[1])
> [1] NA
>
> ---  with  valgrind ----
>> sum(c(NA,1)[1])
> [1] NaN
>
>
> R call with valgrind:
> R -d "valgrind --tool=memcheck --memcheck:leak-check=yes --num-callers=20 "
>
> using
> valgrind-3.3.0
>
>
> platform = i686-pc-linux-gnu
> arch = i686
> os = linux-gnu
> system = i686, linux-gnu
> status =
> major = 2
> minor = 10.0
> year = 2009
> month = 10
> day = 26
> svn rev = 50208
> language = R
> version.string = R version 2.10.0 (2009-10-26)
>
> Locale:
> LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;LC_COLLATE=en_GB.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_GB.UTF-8;LC_PAPER=en_GB.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_GB.UTF-8;LC_IDENTIFICATION=C
>
> Search Path:
> .GlobalEnv, package:stats, package:graphics, package:grDevices, package:utils,
> package:datasets, package:methods, Autoloads, package:base
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From spencer.graves at prodsyse.com  Wed Dec 30 17:14:04 2009
From: spencer.graves at prodsyse.com (spencerg)
Date: Wed, 30 Dec 2009 08:14:04 -0800
Subject: [Rd] UML Class and Object Diagrams in R
In-Reply-To: <b7bfe54e0912300105x153885fr481394af2a675ada@mail.gmail.com>
References: <b7bfe54e0912300105x153885fr481394af2a675ada@mail.gmail.com>
Message-ID: <4B3B7C4C.7030601@prodsyse.com>

I'm not familiar with 'class and object diagrams', but have you tried 
the sos package available from CRAN via something like the following: 


library(sos)
cod <- findFn('class and object diagram')
cods <- findFn('class and object diagrams')
(cod. <- cod|cods)
summary(cod.)


      When I ran this just now, cod included 287 matches and cods 126, 
totalling 413.  Their union 'cod.' 356 links in 100 packages;  the print 
method opened the results as a table in a browser sorted to put the 
packages with the most, best matches first, with links to each manual 
page.  The 7 packages with the most, best matches were given by the 
summary: 


Packages with at least 7 matches using pattern
  'class+and+object+diagram | class+and+object+diagrams'
         Package Count MaxScore TotalScore       Date
1           ade4    33       24        117 2009-12-16
2        diagram    25       27        166 2009-10-19
3          vegan    15       25         79 2009-07-01
4         CHNOSZ    14       56        183 2009-12-16
5            oce    14       26        114 2009-11-26
6        plotrix    12       39        193 2009-05-14
7   compositions    12       26         91 2009-03-17
8            Epi    11       37        146 2009-11-26
9          psych    10       31        107 2009-11-05
10     alphahull     9       33        100 2009-12-16
11 BiodiversityR     7       48        112 2009-12-16
12  verification     7       28         60 2009-08-16


      Hope this helps.      
      Spencer


Charlotte Maia wrote:
> Hi all
>
> Does anyone know if there are any R packages available for creating
> UML class and object diagrams in R (suitable for use with Latex)?
>
> I'm considering developing such a system...
> Note, I'm aware there are Latex packages (so no one needs to state the obvious).
>
> On a side issue I'm thinking about (mostly) abandoning the class
> system I mentioned earlier. Thank you to Martin Maechler, Thomas
> Petzoldt and Barry Rowlingson, for their feedback.
>
>
> kind regards
>   


-- 
Spencer Graves, PE, PhD
President and Chief Operating Officer
Structure Inspection and Monitoring, Inc.
751 Emerson Ct.
San Jos?, CA 95126
ph:  408-655-4567


From catuxa333 at gmail.com  Wed Dec 30 19:04:35 2009
From: catuxa333 at gmail.com (karina lopez)
Date: Wed, 30 Dec 2009 19:04:35 +0100
Subject: [Rd] creating R package-perl
In-Reply-To: <cbf5367c0912301000i42b58971we436d46560dc4621@mail.gmail.com>
References: <cbf5367c0912301000i42b58971we436d46560dc4621@mail.gmail.com>
Message-ID: <cbf5367c0912301004j53805330pd06aa4fea84597ed@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091230/74ff3e56/attachment.pl>

From Edward.Gracely at DrexelMed.edu  Wed Dec 30 19:15:12 2009
From: Edward.Gracely at DrexelMed.edu (Edward.Gracely at DrexelMed.edu)
Date: Wed, 30 Dec 2009 19:15:12 +0100 (CET)
Subject: [Rd] Bug query (PR#14173)
Message-ID: <20091230181512.7E9A8282EF42@mail.pubhealth.ku.dk>

I'm seeing a probable error in the way R boot.ci calculates certain
confidence intervals. Not sure where to submit it. Should this go to the
package maintainer?  If so, how would I identify that person?

=20

Thanks...Ed

=20

Ed J. Gracely, Ph.D.
Drexel University College of Medicine &
Drexel University School of Public Health

Mail to:
Family, Community, and Preventive Medicine
Drexel University College of Medicine
2900 Queen Lane
Philadelphia PA, 19129

215-991-8466 phone
215-843-6028 fax
egracely at drexelmed.edu

=20


	[[alternative HTML version deleted]]


From hb at stat.berkeley.edu  Thu Dec 31 00:42:23 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Wed, 30 Dec 2009 15:42:23 -0800
Subject: [Rd] Should file.access(as.character(NA)) return -1 (now 0)?
Message-ID: <59d7961d0912301542y4a0fe0d7u411fd7accca7a50c@mail.gmail.com>

Should file.access(as.character(NA)) return -1 to be consisting with
non-existing files?

> file.access(c("Non-existing-file", NA), mode=1)
Non-existing-file              <NA>
               -1                 0
> file.access(c("Non-existing-file", NA), mode=2)
Non-existing-file              <NA>
               -1                 0
> file.access(c("Non-existing-file", NA), mode=4)
Non-existing-file              <NA>
               -1                 0

/Henrik

> sessionInfo()
R version 2.10.1 Patched (2009-12-24 r50837)
i386-pc-mingw32

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


From maiagx at gmail.com  Thu Dec 31 01:42:00 2009
From: maiagx at gmail.com (Charlotte Maia)
Date: Thu, 31 Dec 2009 13:42:00 +1300
Subject: [Rd] UML Class and Object Diagrams in R
In-Reply-To: <4B3B7C4C.7030601@prodsyse.com>
References: <b7bfe54e0912300105x153885fr481394af2a675ada@mail.gmail.com>
	<4B3B7C4C.7030601@prodsyse.com>
Message-ID: <b7bfe54e0912301642g51d94e54l22f320197761b0d2@mail.gmail.com>

On Thu, Dec 31, 2009 at 5:14 AM, spencerg <spencer.graves at prodsyse.com> wrote:
> I'm not familiar with 'class and object diagrams', but have you tried the
> sos package available from CRAN via something like the following:
>
> Packages with at least 7 matches using pattern
>  'class+and+object+diagram | class+and+object+diagrams'
>        Package Count MaxScore TotalScore       Date
> 1           ade4    33       24        117 2009-12-16
> 2        diagram    25       27        166 2009-10-19
> 3          vegan    15       25         79 2009-07-01
> 4         CHNOSZ    14       56        183 2009-12-16
> 5            oce    14       26        114 2009-11-26
> 6        plotrix    12       39        193 2009-05-14
> 7   compositions    12       26         91 2009-03-17

I don't follow this output.
I checked the first seven packages and couldn't find any reference to
UML diagrams.
However, thank you for trying anyway.

The diagram package may have some potential here (not sure), however
even so, it's far from ideal for UML modelling.


kind regards
-- 
Charlotte Maia
Open Source Developer and Statistician
http://sites.google.com/site/maiagx


From steve.mew at alphaedge.org  Thu Dec 31 07:09:39 2009
From: steve.mew at alphaedge.org (Steve Mew)
Date: Wed, 30 Dec 2009 22:09:39 -0800
Subject: [Rd] how do I join two lists of the same type ?
Message-ID: <992a74950912302209ucbd754p56e43e4da067ac08@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091230/e283ad09/attachment.pl>

From macrakis at alum.mit.edu  Thu Dec 31 07:23:20 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Thu, 31 Dec 2009 01:23:20 -0500
Subject: [Rd] how do I join two lists of the same type ?
In-Reply-To: <992a74950912302209ucbd754p56e43e4da067ac08@mail.gmail.com>
References: <992a74950912302209ucbd754p56e43e4da067ac08@mail.gmail.com>
Message-ID: <8b356f880912302223g3e26834bjd4a0923efc2abd10@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20091231/07aa275d/attachment.pl>

From jel+r at cs.uni-magdeburg.de  Thu Dec 31 07:33:12 2009
From: jel+r at cs.uni-magdeburg.de (Jens Elkner)
Date: Thu, 31 Dec 2009 07:33:12 +0100
Subject: [Rd] readCitationFile encoding
Message-ID: <20091231063312.GA991@trex.cs.uni-magdeburg.de>

Hi,

does anybody know, how to enforce a certain encoding for
readCitationFile()? Haven't found any usable documentation for this :(

E.g.:
basecit <- system.file("CITATION", package="base")
source(basecit, echo=TRUE, encoding="8859-1")
readCitationFile(basecit)

BTW: 'make check' is a relativ long running task and if one changes 
a source file, all checks are ran again til it gets to the code in
question (in my case tests/Examples/utils-Ex.Rout.fail). Is there
a shortcut to jump immediately to the utils tests?

Regards,
jel.
-- 
Otto-von-Guericke University     http://www.cs.uni-magdeburg.de/
Department of Computer Science   Geb. 29 R 027, Universitaetsplatz 2
39106 Magdeburg, Germany         Tel: +49 391 67 12768


From ripley at stats.ox.ac.uk  Thu Dec 31 09:01:15 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 31 Dec 2009 08:01:15 +0000 (GMT)
Subject: [Rd] readCitationFile encoding
In-Reply-To: <20091231063312.GA991@trex.cs.uni-magdeburg.de>
References: <20091231063312.GA991@trex.cs.uni-magdeburg.de>
Message-ID: <alpine.LFD.2.00.0912310755040.20941@gannet.stats.ox.ac.uk>

On Thu, 31 Dec 2009, Jens Elkner wrote:

> Hi,
>
> does anybody know, how to enforce a certain encoding for
> readCitationFile()? Haven't found any usable documentation for this :(

Really?  From the help file in current versions of R (2.10.1 patched, 
R-devel)

      ?readCitationFile? make use of the ?encoding? element (if any) of
      ?meta? to determine the encoding of the file.

so

readCitationFile(basecit, list(encoding="latin1"))

is probably what you are looking for.  And PLEASE do use the 
recommended portable encoding names.

>
> E.g.:
> basecit <- system.file("CITATION", package="base")
> source(basecit, echo=TRUE, encoding="8859-1")
> readCitationFile(basecit)
>
> BTW: 'make check' is a relativ long running task and if one changes
> a source file, all checks are ran again til it gets to the code in
> question (in my case tests/Examples/utils-Ex.Rout.fail). Is there
> a shortcut to jump immediately to the utils tests?

No, but many sections can be suppressed -- see check --help and the 
environment variables discussed in the R Internals manual.

>
> Regards,
> jel.
> -- 
> Otto-von-Guericke University     http://www.cs.uni-magdeburg.de/
> Department of Computer Science   Geb. 29 R 027, Universitaetsplatz 2
> 39106 Magdeburg, Germany         Tel: +49 391 67 12768
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From savicky at cs.cas.cz  Thu Dec 31 11:17:36 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Thu, 31 Dec 2009 11:17:36 +0100
Subject: [Rd] seq.int broken (seq as well) (PR#14169)
In-Reply-To: <20091228195013.29A1E282EF4F@mail.pubhealth.ku.dk>
References: <20091228195013.29A1E282EF4F@mail.pubhealth.ku.dk>
Message-ID: <20091231101736.GC10897@cs.cas.cz>

On Mon, Dec 28, 2009 at 08:50:13PM +0100, oehl_list at gmx.de wrote:
[...]
> # fine as expected from help page: 
> # "from+by, ..., up to the sequence value less than or equal to to"
> # thus 1+10=11 is not in
> > seq.int(1L, 10L, by=10L)
> [1] 1
> 
> # of course 1+1e7 should also not be in
> # but is: wrong
> > seq.int(1L, 1e7L, by=1e7L)
> [1] 1e+00 1e+07
> 
> # since we use seq.int AND are within integer range, rounding should not be an
> issue

In my opinion, this is a documented behavior. The Details section of the help
page says

     Note that the computed final value
     can go just beyond 'to' to allow for rounding error, but (as from
     R 2.9.0) is truncated to 'to'.

Since "by" is 1e7, going by 1 more than 'to' is "just beyond 'to'".

What can be a bit misleading is the following difference between the type
of seq() and seq.int(), which is only partially documented.

  x <- seq.int(from=1L, to=10000000L, by=10000000L); typeof(x); x
  # [1] "double"
  # [1] 1e+00 1e+07

  x <- seq(from=1L, to=10000000L, by=10000000L); typeof(x); x
  # [1] "integer"
  # [1]        1 10000000

The Value section of the help page says:

     Currently, 'seq.int' and the default method of 'seq' return a
     result of type '"integer"' (if it is representable as that and) if
     'from' is (numerically equal to an) integer and, e.g., only 'to'
     is specified, or also if only 'length' or only 'along.with' is
     specified.  *Note:* this may change in the future and programmers
     should not rely on it.

This suggests that we should get "double" in both cases, since all three
arguments "from", "to", and "by" are specified. I do not know, whether
having an "integer" result in seq() in the above case is intended or not.

Petr Savicky.


From ligges at statistik.tu-dortmund.de  Thu Dec 31 13:06:18 2009
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Thu, 31 Dec 2009 13:06:18 +0100
Subject: [Rd] creating R package-perl
In-Reply-To: <cbf5367c0912301004j53805330pd06aa4fea84597ed@mail.gmail.com>
References: <cbf5367c0912301000i42b58971we436d46560dc4621@mail.gmail.com>
	<cbf5367c0912301004j53805330pd06aa4fea84597ed@mail.gmail.com>
Message-ID: <4B3C93BA.4070002@statistik.tu-dortmund.de>



On 30.12.2009 19:04, karina lopez wrote:
>   do "R CMD install mypkg" an error appears : "Can't open
> perl script "C:\PROGRA~1\R\R-210~1.0/bin/install": No such file or di
> rectory", but i installed perl in C:\Rtools\perl\bin and i wrote it in the
> path, i need to do something more???

Yes, it's case sensitive here, hence you need to do something more: use 
the shift key and type

R CMD INSTALL mypkg

Uwe Ligges


From ligges at statistik.tu-dortmund.de  Thu Dec 31 13:12:16 2009
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Thu, 31 Dec 2009 13:12:16 +0100
Subject: [Rd] Bug query (PR#14173)
In-Reply-To: <20091230181512.7E9A8282EF42@mail.pubhealth.ku.dk>
References: <20091230181512.7E9A8282EF42@mail.pubhealth.ku.dk>
Message-ID: <4B3C9520.2060403@statistik.tu-dortmund.de>

This is R-bugs. Please read the FAQs about bugs in R and learn not to 
post non base R bugs to R-bugs.


On 30.12.2009 19:15, Edward.Gracely at DrexelMed.edu wrote:
> I'm seeing a probable error in the way R boot.ci calculates certain
> confidence intervals. Not sure where to submit it. Should this go to the
> package maintainer?

Yes, if it is a bug which we cannot confirm given the missing of all 
relevant information.


>  If so, how would I identify that person?

library(help = "boot")

or more explicitly:

packageDescription("boot")$Maintainer


Uwe Ligges



> =20
>
> Thanks...Ed
>
> =20
>
> Ed J. Gracely, Ph.D.
> Drexel University College of Medicine&
> Drexel University School of Public Health
>
> Mail to:
> Family, Community, and Preventive Medicine
> Drexel University College of Medicine
> 2900 Queen Lane
> Philadelphia PA, 19129
>
> 215-991-8466 phone
> 215-843-6028 fax
> egracely at drexelmed.edu
>
> =20
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From Red.Dawn at nc.rr.com  Thu Dec 31 03:05:11 2009
From: Red.Dawn at nc.rr.com (Red.Dawn at nc.rr.com)
Date: Thu, 31 Dec 2009 03:05:11 +0100 (CET)
Subject: [Rd] configure R-2.10.1 => "Error: MPlayer will not compile without
	(PR#14175)
Message-ID: <20091231020511.CC708282BE86@mail.pubhealth.ku.dk>

Hi.

uname -a
Linux localhost.localdomain 2.6.30.10-105.fc11.i686.PAE #1 SMP Thu Dec
24 16:41:17 UTC 2009 i686 i686 i386 GNU/Linux

[??@localhost R-2.10.1]$ pwd
/home/??/Bin/RStats/R-2.10.1

I fixed this before for previous version of R by copying part of the
mplayer tree into the R tree.

But, I forgot what I did.

Any help?

Checking for FFmpeg libavutil ... 
Error: MPlayer will not compile without libavutil in the source tree.

Check "configure.log" if you do not understand why it failed.
[mluther at localhost R-2.10.1]$ tail -f configure.log
cc1plus: warning: command line option "-std=gnu99" is valid for C/ObjC
but not for C++
/tmp/mplayer-conf-24144-9141.cpp:1:24: error: liveMedia.hh: No such file
or directory
/tmp/mplayer-conf-24144-9141.cpp:2:6: warning:
"LIVEMEDIA_LIBRARY_VERSION_INT" is not defined
/tmp/mplayer-conf-24144-9141.cpp:3:2: error: #error Please upgrade to
version 2006.03.03 or later of the "LIVE555 Streaming Media" libraries -
available from <www.live555.com/liveMedia/>


Result is: no 
##########################################

============ Checking for FFmpeg libavutil ============

I added everything I could with "Add/Remove Sofware" for mpeg.

There is no mplayer in "Add/Remove Sofware".

[mluther at localhost R-2.10.1]$ uname -a
Linux localhost.localdomain 2.6.30.10-105.fc11.i686.PAE #1 SMP Thu Dec
24 16:41:17 UTC 2009 i686 i686 i386 GNU/Linux

[mluther at localhost R-2.10.1]$ configure
sed: can't read libavcodec/allcodecs.c: No such file or directory
sed: can't read libavcodec/allcodecs.c: No such file or directory
sed: can't read libavcodec/allcodecs.c: No such file or directory
sed: can't read libavcodec/allcodecs.c: No such file or directory
sed: can't read libavformat/allformats.c: No such file or directory
sed: can't read libavformat/allformats.c: No such file or directory
sed: can't read libavformat/allformats.c: No such file or directory
Detected operating system: Linux
Detected host architecture: i386
Checking for cc version ... 4.4.1 
Checking for host cc ... cc 
Checking for cross compilation ... no 
Checking for CPU vendor ... GenuineIntel (15:2:4) 
Checking for CPU type ...  Intel(R) Pentium(R) 4 CPU 2.00GHz 
Checking for kernel support of mmx ... yes 
Checking for kernel support of mmxext ... yes 
Checking for kernel support of sse ... yes 
Checking for kernel support of sse2 ... yes 
Checking for kernel support of cmov ... yes 
Checking for mtrr support ... yes 
Checking for GCC & CPU optimization abilities ... native 
Checking for byte order ... little-endian 
Checking for extern symbol prefix ...  
Checking for assembler support of -pipe option ... yes 
Checking for compiler support of named assembler arguments ... yes 
Checking for assembler (as 2.19.51.0.14) ... ok 
Checking for .align is a power of two ... no 
Checking for 10 assembler operands ... yes 
Checking for ebx availability ... yes 
Checking for yasm ... no 
Checking for bswap ... yes 
Checking for Linux kernel version ... 2.6.30.10-105.fc11.i686.PAE, ok 
Checking for -lposix ... no 
Checking for -lm ... yes 
Checking for langinfo ... yes 
Checking for language ... messages: en - man pages: en - documentation:
en 
Checking for enable sighandler ... yes 
Checking for runtime cpudetection ... no 
Checking for restrict keyword ... restrict 
Checking for __builtin_expect ... yes 
Checking for kstat ... no 
Checking for posix4 ... no 
Checking for llrint ... yes 
Checking for log2 ... yes 
Checking for lrint ... yes 
Checking for lrintf ... yes 
Checking for round ... yes 
Checking for roundf ... yes 
Checking for truncf ... yes 
Checking for mkstemp ... yes 
Checking for nanosleep ... yes 
Checking for socklib ... yes 
Checking for arpa/inet.h ... yes 
Checking for inet_pton() ... yes 
Checking for inet_aton() ... yes 
Checking for socklen_t ... yes 
Checking for closesocket() ... no 
Checking for network ... yes 
Checking for inet6 ... yes 
Checking for gethostbyname2 ... yes 
Checking for inttypes.h (required) ... yes 
Checking for int_fastXY_t in inttypes.h ... yes 
Checking for malloc.h ... yes 
Checking for memalign() ... yes 
Checking for posix_memalign() ... yes 
Checking for alloca.h ... yes 
Checking for fastmemcpy ... yes 
Checking for mman.h ... yes 
Checking for dynamic loader ... yes 
Checking for dynamic a/v plugins support ... no 
Checking for pthread ... yes (using -lpthread)
Checking for w32threads ... no (using pthread instead)
Checking for rpath ... no 
Checking for iconv ... yes 
Checking for soundcard.h ... yes (sys/soundcard.h)
Checking for sys/dvdio.h ... no 
Checking for sys/cdio.h ... no 
Checking for linux/cdrom.h ... yes 
Checking for dvd.h ... no 
Checking for termcap ... yes (using -lncurses)
Checking for termios ... yes (using sys/termios.h)
Checking for shm ... yes 
Checking for strsep() ... yes 
Checking for vsscanf() ... yes 
Checking for swab() ... yes 
Checking for POSIX select() ... yes 
Checking for audio select() ... yes 
Checking for gettimeofday() ... yes 
Checking for glob() ... yes 
Checking for setenv() ... yes 
Checking for sys/sysinfo.h ... yes 
Checking for Apple IR ... yes 
Checking for pkg-config ... yes 
Checking for Samba support (libsmbclient) ... no 
Checking for tdfxfb ... no 
Checking for s3fb ... no 
Checking for wii ... no 
Checking for tdfxvid ... no 
Checking for xvr100 ... no 
Checking for tga ... yes 
Checking for md5sum support ... yes 
Checking for yuv4mpeg support ... yes 
Checking for bl ... no 
Checking for DirectFB ... no 
Checking for X11 headers presence ... yes 
Checking for X11 ... yes 
Checking for Xss screensaver extensions ... yes 
Checking for DPMS ... yes (using Xdpms 4)
Checking for Xv ... yes 
Checking for XvMC ... no 
Checking for VDPAU ... no 
Checking for Xinerama ... yes 
Checking for Xxf86vm ... yes 
Checking for XF86keysym ... yes 
Checking for DGA ... yes (using DGA 2.0)
Checking for 3dfx ... no 
Checking for VIDIX ... yes 
Checking for VIDIX PCI device name database ... yes 
Checking for VIDIX dhahelper support ... no 
Checking for VIDIX svgalib_helper support ... no 
Checking for /dev/mga_vid ... no 
Checking for xmga ... no 
Checking for GGI ... no 
Checking for GGI extension: libggiwmh ... no 
Checking for AA ... no 
Checking for CACA ... no 
Checking for SVGAlib ... no 
Checking for FBDev ... yes 
Checking for DVB ... no 
Checking for DVB HEAD ... yes 
Checking for OpenGL ... no 
Checking for PNG support ... no 
Checking for MNG support ... no 
Checking for JPEG support ... yes 
Checking for PNM support ... yes 
Checking for GIF support ... no 
Checking for VESA support ... no 
Checking for SDL ... no 
Checking for DXR2 ... no 
Checking for DXR3/H+ ... yes 
Checking for IVTV TV-Out (pre linux-2.6.24) ... no 
Checking for V4L2 MPEG Decoder ... yes 
Checking for OSS Audio ... yes 
Checking for aRts ... no 
Checking for EsounD ... no 
Checking for NAS ... no 
Checking for pulse ... no 
Checking for JACK ... no 
Checking for OpenAL ... no 
Checking for ALSA audio ... no 
Checking for Sun audio ... no 
Checking for VCD support ... yes 
Checking for dvdread ... yes (internal)
Checking for internal libdvdcss ... yes 
Checking for cdparanoia ... no 
Checking for libcdio ... no 
Checking for bitmap font support ... yes 
Checking for freetype >= 2.0.9 ... no 
Checking for fontconfig ... no (FreeType support needed)
Checking for SSA/ASS support ... no (FreeType support needed)
Checking for fribidi with charsets ... no 
Checking for ENCA ... no 
Checking for zlib ... yes 
Checking for bzlib ... no 
Checking for RTC ... yes 
Checking for liblzo2 support ... no 
Checking for mad support ... no 
Checking for Twolame ... no 
Checking for Toolame ... no 
Checking for OggVorbis support ... yes (internal Tremor)
Checking for libspeex (version >= 1.1 required) ... no 
Checking for OggTheora support ... no 
Checking for internal mp3lib support ... yes 
Checking for liba52 support ... yes (internal)
Checking for internal libmpeg2 support ... yes 
Checking for libdca support ... no 
Checking for libmpcdec (musepack, version >= 1.2.1 required) ... no 
Checking for FAAC support ... no (in libavcodec: no)
Checking for FAAD2 support ... yes (internal floating-point)
Checking for LADSPA plugin support ... no 
Checking for libbs2b audio filter support ... no 
Checking for Win32 codecs ... yes (using /usr/lib/codecs)
Checking for XAnim codecs ... yes (using /usr/lib/codecs)
Checking for RealPlayer codecs ... yes (using /usr/lib/codecs)
Checking for QuickTime codecs ... yes 
Checking for Nemesi Streaming Media libraries ... no 
Checking for LIVE555 Streaming Media libraries ... no 
Checking for FFmpeg libavutil ... 
Error: MPlayer will not compile without libavutil in the source tree.

Check "configure.log" if you do not understand why it failed.
[mluther at localhost R-2.10.1]$


From jel+r at cs.uni-magdeburg.de  Thu Dec 31 16:05:16 2009
From: jel+r at cs.uni-magdeburg.de (Jens Elkner)
Date: Thu, 31 Dec 2009 16:05:16 +0100
Subject: [Rd] readCitationFile encoding
In-Reply-To: <alpine.LFD.2.00.0912310755040.20941@gannet.stats.ox.ac.uk>
References: <20091231063312.GA991@trex.cs.uni-magdeburg.de>
	<alpine.LFD.2.00.0912310755040.20941@gannet.stats.ox.ac.uk>
Message-ID: <20091231150516.GA1305@trex.cs.uni-magdeburg.de>

On Thu, Dec 31, 2009 at 08:01:15AM +0000, Prof Brian Ripley wrote:
> On Thu, 31 Dec 2009, Jens Elkner wrote:
Hi,

> >does anybody know, how to enforce a certain encoding for
> >readCitationFile()? Haven't found any usable documentation for this :(
> 
> Really?

Yes. Well, just started to dive into R and that's probably the problem
(like in old UNIX times), the help aka man pages are very useful and
sufficient, if you know the language/system ... ;-)

> From the help file in current versions of R (2.10.1 patched, 
> R-devel)
> 
>      ?readCitationFile? make use of the ?encoding? element (if any) of
>      ?meta? to determine the encoding of the file.

Ah - ok, haven't applied the latest release.diff. But anyway, for a
newbie it is not easy to find out, what "meta" is expected to be.
  
> so
> readCitationFile(basecit, list(encoding="latin1"))

Yepp - with a leading uppercase E it works. Thanx a lot!!! :)
  
> is probably what you are looking for.  And PLEASE do use the 
> recommended portable encoding names.
  
OT: Wondering, what does "recommended portable encoding names" in this
context mean (e.g. AFAIK 'latin1' is not a standardized name ...).

BTW: Just build R-2.10.1 on Solaris Nevada b129 (x86_64) using its native
iconv facilities in libc and sunperf libs (wrt. BLAS/LAPACK) only. It
works now and all checks are saying, everything is ok. 

> >BTW: 'make check' is a relativ long running task and if one changes
> >a source file, all checks are ran again til it gets to the code in
> >question (in my case tests/Examples/utils-Ex.Rout.fail). Is there
> >a shortcut to jump immediately to the utils tests?
> 
> No, but many sections can be suppressed -- see check --help and the 
> environment variables discussed in the R Internals manual.

Ahh - good hint - help("check") wasn't really fruitful. However,

elkner.idev2 build/R-2.10.1/bin > ./check --help
Can't locate File/Copy/Recursive.pm in @INC (@INC contains: ...

So still need to do a little bit tweaking ...

Anyway, thanx a lot for your quick help!!!,
jel.
-- 
Otto-von-Guericke University     http://www.cs.uni-magdeburg.de/
Department of Computer Science   Geb. 29 R 027, Universitaetsplatz 2
39106 Magdeburg, Germany         Tel: +49 391 67 12768


From simon.urbanek at r-project.org  Thu Dec 31 20:50:00 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 31 Dec 2009 14:50:00 -0500
Subject: [Rd] readCitationFile encoding
In-Reply-To: <20091231150516.GA1305@trex.cs.uni-magdeburg.de>
References: <20091231063312.GA991@trex.cs.uni-magdeburg.de>
	<alpine.LFD.2.00.0912310755040.20941@gannet.stats.ox.ac.uk>
	<20091231150516.GA1305@trex.cs.uni-magdeburg.de>
Message-ID: <7C0CA516-F119-4A79-99F3-EE7CEB7E8E3F@r-project.org>


On Dec 31, 2009, at 10:05 AM, Jens Elkner wrote:

> On Thu, Dec 31, 2009 at 08:01:15AM +0000, Prof Brian Ripley wrote:
>> On Thu, 31 Dec 2009, Jens Elkner wrote:
> Hi,
> 
>>> does anybody know, how to enforce a certain encoding for
>>> readCitationFile()? Haven't found any usable documentation for this :(
>> 
>> Really?
> 
> Yes. Well, just started to dive into R and that's probably the problem
> (like in old UNIX times), the help aka man pages are very useful and
> sufficient, if you know the language/system ... ;-)
> 
>> From the help file in current versions of R (2.10.1 patched, 
>> R-devel)
>> 
>>     ?readCitationFile? make use of the ?encoding? element (if any) of
>>     ?meta? to determine the encoding of the file.
> 
> Ah - ok, haven't applied the latest release.diff. But anyway, for a
> newbie it is not easy to find out, what "meta" is expected to be.
> 
>> so
>> readCitationFile(basecit, list(encoding="latin1"))
> 
> Yepp - with a leading uppercase E it works. Thanx a lot!!! :)
> 
>> is probably what you are looking for.  And PLEASE do use the 
>> recommended portable encoding names.
> 
> OT: Wondering, what does "recommended portable encoding names" in this
> context mean (e.g. AFAIK 'latin1' is not a standardized name ...).

It is in R -- since no standard name for that encoding exists in general R maps "latin1" to whatever the OS expects this to be -- see ?Encoding.


> BTW: Just build R-2.10.1 on Solaris Nevada b129 (x86_64) using its native
> iconv facilities in libc and sunperf libs (wrt. BLAS/LAPACK) only. It
> works now and all checks are saying, everything is ok. 
> 
>>> BTW: 'make check' is a relativ long running task and if one changes
>>> a source file, all checks are ran again til it gets to the code in
>>> question (in my case tests/Examples/utils-Ex.Rout.fail). Is there
>>> a shortcut to jump immediately to the utils tests?
>> 
>> No, but many sections can be suppressed -- see check --help and the 
>> environment variables discussed in the R Internals manual.
> 
> Ahh - good hint - help("check") wasn't really fruitful. However,
> 
> elkner.idev2 build/R-2.10.1/bin > ./check --help
> Can't locate File/Copy/Recursive.pm in @INC (@INC contains: ...
> 
> So still need to do a little bit tweaking ...
> 

.. rather reading the docs ;). It's R CMD check --help (since we're on R-devel knowledge of basics is assumed).

Cheers,
Simon


From saptarshi.guha at gmail.com  Thu Dec 31 21:43:43 2009
From: saptarshi.guha at gmail.com (Saptarshi Guha)
Date: Thu, 31 Dec 2009 15:43:43 -0500
Subject: [Rd] Benefit of treating NA and NaN differently for numerics
Message-ID: <1e7471d50912311243s6e681390n1f27ea0fde3c8e3e@mail.gmail.com>

Hello,
I notice in main/arithmetic.c, that NA and NaN are encoded
differently(since every numeric NA comes  from R_NaReal which is
defined via ValueOfNA)
. What is the benefit of treating these two differently? Why can't NA
be a synonym for NaN?

Thank you
Saptarshi
(R-2.9)


From Ted.Harding at manchester.ac.uk  Thu Dec 31 22:05:09 2009
From: Ted.Harding at manchester.ac.uk ( (Ted Harding))
Date: Thu, 31 Dec 2009 21:05:09 -0000 (GMT)
Subject: [Rd] Benefit of treating NA and NaN differently for numerics
In-Reply-To: <1e7471d50912311243s6e681390n1f27ea0fde3c8e3e@mail.gmail.com>
Message-ID: <XFMail.091231210509.Ted.Harding@manchester.ac.uk>

On 31-Dec-09 20:43:43, Saptarshi Guha wrote:
> Hello,
> I notice in main/arithmetic.c, that NA and NaN are encoded
> differently(since every numeric NA comes  from R_NaReal which is
> defined via ValueOfNA)
> What is the benefit of treating these two differently? Why can't NA
> be a synonym for NaN?
> 
> Thank you
> Saptarshi
> (R-2.9)

Because they are used to represent different things. Others will be
able to give you a much more comprehensive account than I can of
their uses in R, but essentially:

NaN represents a result which is not valid (i.e. "Not a Number")
in the domain of quantities being evaluated. For example, R does
its arithmetic by default in the domain of "double", i.e. the
machine representation of real numbers. In this domain, sqrt(-1)
does not exist -- it is not a number in the domain of real numbers.
Hence:

  sqrt(-1)
  # [1] NaN
  # Warning message:
  # In sqrt(-1) : NaNs produced

In order to obtain a result which does exist, you need to switch
domain to complex numbers:

  > sqrt(as.complex(-1))
  # [1] 0+1i

NA, on the other hand, represents a value (in whatever domain:
double, logical, character, ...) which is not known, which is why
it is typically used to represent missing data. It would be a valid
entity in the current domain if its value were known, but the value
is not known. Hence the result of any expression involving NA
quantities is NA, since the value if the expression would depend on
the unkown elements, and hence the value of the expression is unknown.

This distinction is important and useful, so it should not be done
away with by merging NaN and NA!

Best wishes,
Ted.

--------------------------------------------------------------------
E-Mail: (Ted Harding) <Ted.Harding at manchester.ac.uk>
Fax-to-email: +44 (0)870 094 0861
Date: 31-Dec-09                                       Time: 21:05:06
------------------------------ XFMail ------------------------------


From murdoch at stats.uwo.ca  Thu Dec 31 22:10:12 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 31 Dec 2009 16:10:12 -0500
Subject: [Rd] Benefit of treating NA and NaN differently for numerics
In-Reply-To: <1e7471d50912311243s6e681390n1f27ea0fde3c8e3e@mail.gmail.com>
References: <1e7471d50912311243s6e681390n1f27ea0fde3c8e3e@mail.gmail.com>
Message-ID: <4B3D1334.2050206@stats.uwo.ca>

On 31/12/2009 3:43 PM, Saptarshi Guha wrote:
> Hello,
> I notice in main/arithmetic.c, that NA and NaN are encoded
> differently(since every numeric NA comes  from R_NaReal which is
> defined via ValueOfNA)
> . What is the benefit of treating these two differently? Why can't NA
> be a synonym for NaN?

I don't know of any cases where a useful distinction is made between NA 
and NaN, but I suppose it could be useful to know where the bad value 
came from.  R functions rarely generate NaN directly, it usually comes 
from the hardware or runtime library.

And by the way, as the thread containing this message shows,

http://finzi.psych.upenn.edu/R/R-devel/2009-August/054319.html

there are several different encodings which are displayed as NA, and a 
huge number (more than 2^50, I seem to recall) of different encodings 
displayed as NaN.

Duncan Murdoch


