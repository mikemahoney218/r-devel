From xie at yihui.name  Sun Jun  1 00:52:36 2014
From: xie at yihui.name (Yihui Xie)
Date: Sat, 31 May 2014 17:52:36 -0500
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>
	<538885F3.8020807@gmail.com>
	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>
	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>
Message-ID: <CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>

Note the test has been done once in weave, since R CMD check will try
to rebuild vignettes. The problem is whether the related tools in R
should change their tangle utilities so we can **repeat** the test,
and it seems the answer is "no" in my eyes.

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Web: http://yihui.name


On Sat, May 31, 2014 at 4:54 PM, Gabriel Becker <gmbecker at ucdavis.edu> wrote:
>
>
>
> On Fri, May 30, 2014 at 9:22 PM, Yihui Xie <xie at yihui.name> wrote:
>>
>> Hi Kevin,
>>
>>
>> I tend to adopt Henrik's idea, i.e., to provide vignette
>> engines that just ignore tangle. At the moment, it seems R CMD check
>> is comfortable with vignettes that do not have corresponding R
>> scripts, and I hope these R scripts will not become mandatory in the
>> future.
>
>
> I'm not sure this is the right approach. This would essentially make the
> test optional based on decisions by the package author. I'm not arguing in
> favor if this particular test, but if package authors are able to turn a
> test off then the test loses quite a bit of it's value.
>
> I think that R CMD check has done a great deal for the R community by
> presenting a uniform, minimum "barrier to entry" for R packages. Allowing
> package developers to alter the tests it does (other than the obvious case
> of their own unit tests) would remove that.
>
> That having been said, it seems to me that tangle-like utilities should have
> the option of extracting inline code, and that during R CMD check that
> option should *always* be turned on.  That would solve the problem in
> question while retaining the test would it not?
>
> ~G


From gmbecker at ucdavis.edu  Sun Jun  1 00:58:15 2014
From: gmbecker at ucdavis.edu (Gabriel Becker)
Date: Sat, 31 May 2014 15:58:15 -0700
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>
	<538885F3.8020807@gmail.com>
	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>
	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>
	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>
Message-ID: <CADwqtCN9RXgqWof3XOb9hxmXuToVVNa7QM0vmPwes_seVQjVtA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140531/ec5e2e44/attachment.pl>

From mtmorgan at fhcrc.org  Sun Jun  1 01:20:38 2014
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Sat, 31 May 2014 16:20:38 -0700
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>	<538885F3.8020807@gmail.com>	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>
	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>
Message-ID: <538A63C6.5030201@fhcrc.org>

On 05/31/2014 03:52 PM, Yihui Xie wrote:
> Note the test has been done once in weave, since R CMD check will try
> to rebuild vignettes. The problem is whether the related tools in R
> should change their tangle utilities so we can **repeat** the test,
> and it seems the answer is "no" in my eyes.
>
> Regards,
> Yihui
> --
> Yihui Xie <xieyihui at gmail.com>
> Web: http://yihui.name
>
>
> On Sat, May 31, 2014 at 4:54 PM, Gabriel Becker <gmbecker at ucdavis.edu> wrote:
>>
>>
>>
>> On Fri, May 30, 2014 at 9:22 PM, Yihui Xie <xie at yihui.name> wrote:
>>>
>>> Hi Kevin,
>>>
>>>
>>> I tend to adopt Henrik's idea, i.e., to provide vignette
>>> engines that just ignore tangle. At the moment, it seems R CMD check

It is very useful, pedagogically and when reproducing analyses, to be able to 
source() the tangled .R code into an R session, analogous to running example 
code with example(). The documentation for ?Stangle does read

      (Code inside '\Sexpr{}' statements is ignored by 'Stangle'.)

So my 'vote' (recognizing that I don't have one of those) is to incorporate 
\Sexpr{} expressions into the tangled code, or to continue to flag use of Sexpr 
with side effects as errors (indirectly, by source()ing the tangled code), 
rather than writing engines that ignore tangle.

It is very valuable to all parties to write a vignette with code that is fully 
evaluated; otherwise, it is too easy for bit rot to seep in, or to 'fake' it in 
a way that seems innocent but is misleading.

Martin Morgan

>>> is comfortable with vignettes that do not have corresponding R
>>> scripts, and I hope these R scripts will not become mandatory in the
>>> future.
>>
>>
>> I'm not sure this is the right approach. This would essentially make the
>> test optional based on decisions by the package author. I'm not arguing in
>> favor if this particular test, but if package authors are able to turn a
>> test off then the test loses quite a bit of it's value.
>>
>> I think that R CMD check has done a great deal for the R community by
>> presenting a uniform, minimum "barrier to entry" for R packages. Allowing
>> package developers to alter the tests it does (other than the obvious case
>> of their own unit tests) would remove that.
>>
>> That having been said, it seems to me that tangle-like utilities should have
>> the option of extracting inline code, and that during R CMD check that
>> option should *always* be turned on.  That would solve the problem in
>> question while retaining the test would it not?
>>
>> ~G
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From xie at yihui.name  Sun Jun  1 03:54:09 2014
From: xie at yihui.name (Yihui Xie)
Date: Sat, 31 May 2014 20:54:09 -0500
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <538A63C6.5030201@fhcrc.org>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>
	<538885F3.8020807@gmail.com>
	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>
	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>
	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>
	<538A63C6.5030201@fhcrc.org>
Message-ID: <CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>

I mentioned in my original post that Sweave()/knit()/... can be
considered as the "new" source(). They can do the same thing as
source() does. I agree that fully evaluating the code is valuable, but
it is not a problem since the weave functions do fully evaluate the
code. If there is a reason for why source() an R script is preferred,
I guess it is users' familiarity with .R instead of .Rnw/.Rmd/...,
however, I guess it would be painful to read the pure R script tangled
from the source document without the original narratives.

So what do we really lose if we turn off tangle? We lose an R script
as a derivative from the source document, but we do not lose the code
evaluation.

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Web: http://yihui.name


On Sat, May 31, 2014 at 6:20 PM, Martin Morgan <mtmorgan at fhcrc.org> wrote:
> On 05/31/2014 03:52 PM, Yihui Xie wrote:
>>
>> Note the test has been done once in weave, since R CMD check will try
>> to rebuild vignettes. The problem is whether the related tools in R
>> should change their tangle utilities so we can **repeat** the test,
>> and it seems the answer is "no" in my eyes.
>>
>> Regards,
>> Yihui
>> --
>> Yihui Xie <xieyihui at gmail.com>
>> Web: http://yihui.name
>>
>>
>> On Sat, May 31, 2014 at 4:54 PM, Gabriel Becker <gmbecker at ucdavis.edu>
>> wrote:
>>>
>>>
>>>
>>>
>>> On Fri, May 30, 2014 at 9:22 PM, Yihui Xie <xie at yihui.name> wrote:
>>>>
>>>>
>>>> Hi Kevin,
>>>>
>>>>
>>>> I tend to adopt Henrik's idea, i.e., to provide vignette
>>>> engines that just ignore tangle. At the moment, it seems R CMD check
>
>
> It is very useful, pedagogically and when reproducing analyses, to be able
> to source() the tangled .R code into an R session, analogous to running
> example code with example(). The documentation for ?Stangle does read
>
>      (Code inside '\Sexpr{}' statements is ignored by 'Stangle'.)
>
> So my 'vote' (recognizing that I don't have one of those) is to incorporate
> \Sexpr{} expressions into the tangled code, or to continue to flag use of
> Sexpr with side effects as errors (indirectly, by source()ing the tangled
> code), rather than writing engines that ignore tangle.
>
> It is very valuable to all parties to write a vignette with code that is
> fully evaluated; otherwise, it is too easy for bit rot to seep in, or to
> 'fake' it in a way that seems innocent but is misleading.
>
> Martin Morgan


From kasperdanielhansen at gmail.com  Sun Jun  1 04:11:54 2014
From: kasperdanielhansen at gmail.com (Kasper Daniel Hansen)
Date: Sat, 31 May 2014 22:11:54 -0400
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>
	<538885F3.8020807@gmail.com>
	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>
	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>
	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>
	<538A63C6.5030201@fhcrc.org>
	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>
Message-ID: <CAC2h7utv3-dCDjh5fFNWCUosL5sN1KA+xusFQgYRztE9mKtqPg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140531/b46d05f4/attachment.pl>

From gmbecker at ucdavis.edu  Sun Jun  1 04:20:26 2014
From: gmbecker at ucdavis.edu (Gabriel Becker)
Date: Sat, 31 May 2014 19:20:26 -0700
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>
	<538885F3.8020807@gmail.com>
	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>
	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>
	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>
	<538A63C6.5030201@fhcrc.org>
	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>
Message-ID: <CADwqtCNQEAz==L4fSomQt+Ayw6wSo61-uM=xN_9K26K1XRoFwQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140531/21f3e15a/attachment.pl>

From xie at yihui.name  Sun Jun  1 05:03:07 2014
From: xie at yihui.name (Yihui Xie)
Date: Sat, 31 May 2014 22:03:07 -0500
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <CAC2h7utv3-dCDjh5fFNWCUosL5sN1KA+xusFQgYRztE9mKtqPg@mail.gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>
	<538885F3.8020807@gmail.com>
	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>
	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>
	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>
	<538A63C6.5030201@fhcrc.org>
	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>
	<CAC2h7utv3-dCDjh5fFNWCUosL5sN1KA+xusFQgYRztE9mKtqPg@mail.gmail.com>
Message-ID: <CANROs4dKzoh6sY4eaWhLuV4R08TV2FfZYtqihA=U+LjVhBQdmw@mail.gmail.com>

Yes, that is a matter of familiarity as I mentioned, isn't it? I
understand this justification. I can argue that it is also convenient
to give people an Rnw/Rmd document and they can easily run the R code
chunks as well (e.g. in RStudio, chunk navigation and evaluation are
pretty simple) _within_ the context of your teaching materials.
However, I think this is drifting away from the original topic, so
I'll stop my comments on the direction of teaching.

The original question was, what do we lose if we disable tangle for R
package vignettes? Please also note I mean this is _optional_, i.e.
package authors can _choose_ whether they want to disable tangle.

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Web: http://yihui.name


On Sat, May 31, 2014 at 9:11 PM, Kasper Daniel Hansen
<kasperdanielhansen at gmail.com> wrote:
> The Bioconductor project has a substantial amount of teaching material in
> the form of Sweave files.  For teaching, it can be extremely convenient to
> give people an R script which they can copy and paste from (or do something
> else with).  This is especially true for inexperienced R users.
>
> Best,
> Kasper
>


From xie at yihui.name  Sun Jun  1 05:17:43 2014
From: xie at yihui.name (Yihui Xie)
Date: Sat, 31 May 2014 22:17:43 -0500
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <CADwqtCNQEAz==L4fSomQt+Ayw6wSo61-uM=xN_9K26K1XRoFwQ@mail.gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>
	<538885F3.8020807@gmail.com>
	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>
	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>
	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>
	<538A63C6.5030201@fhcrc.org>
	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>
	<CADwqtCNQEAz==L4fSomQt+Ayw6wSo61-uM=xN_9K26K1XRoFwQ@mail.gmail.com>
Message-ID: <CANROs4cuHbSTeNXgBuWFAhpHGMVdGLsAs5gFH+8s=HCq8NYiwQ@mail.gmail.com>

1. The starting point of this discussion is package vignettes, instead
of R scripts. I'm not saying we should abandon R scripts, or all
people should write R code to generate reports. Starting from a
package vignette, you can evaluate it using a weave function, or
evaluate its derivative, namely an R script. I was saying the former
might not be a bad idea, although the latter sounds more familiar to
most R users. For a package vignette, within the context of R CMD
check, is it necessary to do tangle + evaluate _besides_ weave?

2. If you are comfortable with reading pure code without narratives,
I'm totally fine with that. I guess there is nothing to argue on this
point, since it is pretty much personal taste.

3. Yes, you are absolutely correct -- Sweave()/knit() does more than
source(), but let me repeat the issue to be discussed: what harm does
it bring if we disable tangle for R package vignettes?

Sorry if I did not make it clear enough, my priority of this
discussion is the necessity of tangle for package vignettes. After we
finish this issue, I'll be happy to extend the discussion towards
tangle in general.

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Web: http://yihui.name


On Sat, May 31, 2014 at 9:20 PM, Gabriel Becker <gmbecker at ucdavis.edu> wrote:
>
>
>
> On Sat, May 31, 2014 at 6:54 PM, Yihui Xie <xie at yihui.name> wrote:
>
>> I agree that fully evaluating the code is valuable, but
>> it is not a problem since the weave functions do fully evaluate the
>> code. If there is a reason for why source() an R script is preferred,
>>
>> I guess it is users' familiarity with .R instead of .Rnw/.Rmd/...,
>
>
> It's because .Rnw and Rmd require more from the user than .R. Also, this
> started with vignettes but you seem to be talking more generally. If so, I
> would point out that not all R code is intended to generate reports, and
> writing pure R code that isn't going to generate a report in an .Rnw/.Rmd
> file would be very strange to say the least.
>
>
>>
>> however, I guess it would be painful to read the pure R script tangled
>> from the source document without the original narratives.
>
>
> That depends a lot on what you want. Reading an woven article/report that
> includes code and reading code are different and equally valid activities.
> Sometimes I really just want to know what the author actually told the
> computer to do.
>
>>
>>
>> So what do we really lose if we turn off tangle? We lose an R script
>> as a derivative from the source document, but we do not lose the code
>> evaluation.
>
>
> We lose *isolated* code evaluation. Sweave/knit have a lot more moving
> pieces than source/eval do. Many of which are  for the purpose of displaying
> output, rather than running code.
>


From cboettig at gmail.com  Mon Jun  2 05:43:20 2014
From: cboettig at gmail.com (Carl Boettiger)
Date: Sun, 1 Jun 2014 20:43:20 -0700
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <CANROs4cuHbSTeNXgBuWFAhpHGMVdGLsAs5gFH+8s=HCq8NYiwQ@mail.gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>
	<538885F3.8020807@gmail.com>
	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>
	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>
	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>
	<538A63C6.5030201@fhcrc.org>
	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>
	<CADwqtCNQEAz==L4fSomQt+Ayw6wSo61-uM=xN_9K26K1XRoFwQ@mail.gmail.com>
	<CANROs4cuHbSTeNXgBuWFAhpHGMVdGLsAs5gFH+8s=HCq8NYiwQ@mail.gmail.com>
Message-ID: <CAN_1p9wgx57ZRAYz56m+-51_UMYTtm97-JmpYSKYtHSobLkOzQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140601/43a6cd49/attachment.pl>

From gmbecker at ucdavis.edu  Mon Jun  2 06:16:48 2014
From: gmbecker at ucdavis.edu (Gabriel Becker)
Date: Sun, 1 Jun 2014 21:16:48 -0700
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <CAN_1p9wgx57ZRAYz56m+-51_UMYTtm97-JmpYSKYtHSobLkOzQ@mail.gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>
	<538885F3.8020807@gmail.com>
	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>
	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>
	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>
	<538A63C6.5030201@fhcrc.org>
	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>
	<CADwqtCNQEAz==L4fSomQt+Ayw6wSo61-uM=xN_9K26K1XRoFwQ@mail.gmail.com>
	<CANROs4cuHbSTeNXgBuWFAhpHGMVdGLsAs5gFH+8s=HCq8NYiwQ@mail.gmail.com>
	<CAN_1p9wgx57ZRAYz56m+-51_UMYTtm97-JmpYSKYtHSobLkOzQ@mail.gmail.com>
Message-ID: <CADwqtCP=PJR=hDx9KSjs4HeSaqdgpdLZR-EpS0a5A2DPcW_7=Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140601/d0623625/attachment.pl>

From cboettig at gmail.com  Mon Jun  2 06:41:09 2014
From: cboettig at gmail.com (Carl Boettiger)
Date: Sun, 1 Jun 2014 21:41:09 -0700
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <CADwqtCP=PJR=hDx9KSjs4HeSaqdgpdLZR-EpS0a5A2DPcW_7=Q@mail.gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>
	<538885F3.8020807@gmail.com>
	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>
	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>
	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>
	<538A63C6.5030201@fhcrc.org>
	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>
	<CADwqtCNQEAz==L4fSomQt+Ayw6wSo61-uM=xN_9K26K1XRoFwQ@mail.gmail.com>
	<CANROs4cuHbSTeNXgBuWFAhpHGMVdGLsAs5gFH+8s=HCq8NYiwQ@mail.gmail.com>
	<CAN_1p9wgx57ZRAYz56m+-51_UMYTtm97-JmpYSKYtHSobLkOzQ@mail.gmail.com>
	<CADwqtCP=PJR=hDx9KSjs4HeSaqdgpdLZR-EpS0a5A2DPcW_7=Q@mail.gmail.com>
Message-ID: <CAN_1p9zazjw4QpOT_-53LMNYyB49J5iZuD+b2enTyrRU4Uy0vg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140601/6c7184fc/attachment.pl>

From murdoch.duncan at gmail.com  Mon Jun  2 07:06:28 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 02 Jun 2014 14:06:28 +0900
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <CAN_1p9zazjw4QpOT_-53LMNYyB49J5iZuD+b2enTyrRU4Uy0vg@mail.gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>	<538885F3.8020807@gmail.com>	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>	<538A63C6.5030201@fhcrc.org>	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>	<CADwqtCNQEAz==L4fSomQt+Ayw6wSo61-uM=xN_9K26K1XRoFwQ@mail.gmail.com>	<CANROs4cuHbSTeNXgBuWFAhpHGMVdGLsAs5gFH+8s=HCq8NYiwQ@mail.gmail.com>	<CAN_1p9wgx57ZRAYz56m+-51_UMYTtm97-JmpYSKYtHSobLkOzQ@mail.gmail.com>	<CADwqtCP=PJR=hDx9KSjs4HeSaqdgpdLZR-EpS0a5A2DPcW_7=Q@mail.gmail.com>
	<CAN_1p9zazjw4QpOT_-53LMNYyB49J5iZuD+b2enTyrRU4Uy0vg@mail.gmail.com>
Message-ID: <538C0654.7050205@gmail.com>

On 02/06/2014, 1:41 PM, Carl Boettiger wrote:
> Thanks both for the replies.
>
> Duncan, I'm sorry if I wasn't clear.  I am indeed writing a vignette using
> Sweave (knitr actually), and I want it to be a vignette. I'm well aware
> that I can dodge these tests as you suggest, or through other ways, but I'm
> not trying to dodge them.  R CMD check is running both knit and
> tangle+source on it, and I do not understand why the latter is necessary
> when the code is already run by the former.  Is there a good reason for
> checking an R vignette in this seemingly redundant fashion?
>
> Gabe, I see your point but surely you can agree that is a rather obtuse way
> to enforce that behavior. I don't recall seeing anything in the R
> extensions manual documenting that Sweave files must meet this constraint
> in order to be considered valid vignettes.  I also believe there are valid
> use cases for side-effects of inline chunk options (my example being
> dynamic references).  While it is easy to hack a vignette to meet this
> constraint (e.g. replicating inline calls with non-displayed chunk), that
> seems poor form.
>
> I think Yihui has made a good case that there is no reason for R CMD check
> to be running weave/knit and source, and I haven't seen any replies trying
> to explain to the contrary why this is a reasonable thing for the automated
> check to be doing.

You haven't been reading very carefully.  I saw several:  mine, Martin 
Morgan's, Kasper Daniel Hansen's.

Duncan Murdoch
>
> Cheers,
>
> Carl
>
>
> On Sun, Jun 1, 2014 at 9:16 PM, Gabriel Becker <gmbecker at ucdavis.edu> wrote:
>
>> Carl,
>>
>> I don't really have a horse in this race other than a strong feeling that
>> whatever check does should be mandatory.
>>
>> That having been said, I think it can be argued that the fact that check
>> does this means that it IS in the R package vignette specification that all
>> vignettes must be such that their tangled code will run without errors.
>>
>> ~G
>>
>>
>> On Sun, Jun 1, 2014 at 8:43 PM, Carl Boettiger <cboettig at gmail.com> wrote:
>>
>>> Yihui, list,
>>>
>>> Focusing the behavior of R CMD check, the only reason I have seen put
>>> forward in the discussion for having check tangle and then source as well
>>> as knit/weave the very same vignette is to assist the package maintainer in
>>> debugging R errors vs pdflatex errors.  As tangle (and many other tools)
>>> are already available to an author needing extra help debugging, and as the
>>> error messages are usually clear on whether errors come from the R code or
>>> whatever format compiling (pdflatex, markdown html, etc), this seems like a
>>> poor reason for R CMD check to be wasting time doing two versions of almost
>>> (but not literally) the same check.
>>>
>>> As has already been discussed, it is possible to write vignettes that can
>>> be Sweave'd but not source'd, due to the different treatments of inline
>>> chunks.  While I see the advantages of this property, I don't see why R CMD
>>> check should be enforcing it through the arbitrary mechanism of running
>>> both Sweave and tangle+source. If that is the desired behavior for all
>>> Sweave documents it should be in part of the Sweave specification not to be
>>> able to write/change values in inline expressions, or part of the tangle
>>> definition to include inline chunks.  I any event I don't see any reason
>>> for R CMD check doing both.  Perhaps someone can fill in whatever I've
>>> overlooked?
>>>
>>> Carl
>>>
>>>
>>> On Sat, May 31, 2014 at 8:17 PM, Yihui Xie <xie at yihui.name> wrote:
>>>
>>>> 1. The starting point of this discussion is package vignettes, instead
>>>> of R scripts. I'm not saying we should abandon R scripts, or all
>>>> people should write R code to generate reports. Starting from a
>>>> package vignette, you can evaluate it using a weave function, or
>>>> evaluate its derivative, namely an R script. I was saying the former
>>>> might not be a bad idea, although the latter sounds more familiar to
>>>> most R users. For a package vignette, within the context of R CMD
>>>> check, is it necessary to do tangle + evaluate _besides_ weave?
>>>>
>>>> 2. If you are comfortable with reading pure code without narratives,
>>>> I'm totally fine with that. I guess there is nothing to argue on this
>>>> point, since it is pretty much personal taste.
>>>>
>>>> 3. Yes, you are absolutely correct -- Sweave()/knit() does more than
>>>> source(), but let me repeat the issue to be discussed: what harm does
>>>> it bring if we disable tangle for R package vignettes?
>>>>
>>>> Sorry if I did not make it clear enough, my priority of this
>>>> discussion is the necessity of tangle for package vignettes. After we
>>>> finish this issue, I'll be happy to extend the discussion towards
>>>> tangle in general.
>>>>
>>>> Regards,
>>>> Yihui
>>>> --
>>>> Yihui Xie <xieyihui at gmail.com>
>>>> Web: http://yihui.name
>>>>
>>>>
>>>> On Sat, May 31, 2014 at 9:20 PM, Gabriel Becker <gmbecker at ucdavis.edu>
>>>> wrote:
>>>>>
>>>>>
>>>>>
>>>>> On Sat, May 31, 2014 at 6:54 PM, Yihui Xie <xie at yihui.name> wrote:
>>>>>
>>>>>> I agree that fully evaluating the code is valuable, but
>>>>>> it is not a problem since the weave functions do fully evaluate the
>>>>>> code. If there is a reason for why source() an R script is preferred,
>>>>>>
>>>>>> I guess it is users' familiarity with .R instead of .Rnw/.Rmd/...,
>>>>>
>>>>>
>>>>> It's because .Rnw and Rmd require more from the user than .R. Also,
>>>> this
>>>>> started with vignettes but you seem to be talking more generally. If
>>>> so, I
>>>>> would point out that not all R code is intended to generate reports,
>>>> and
>>>>> writing pure R code that isn't going to generate a report in an
>>>> .Rnw/.Rmd
>>>>> file would be very strange to say the least.
>>>>>
>>>>>
>>>>>>
>>>>>> however, I guess it would be painful to read the pure R script tangled
>>>>>> from the source document without the original narratives.
>>>>>
>>>>>
>>>>> That depends a lot on what you want. Reading an woven article/report
>>>> that
>>>>> includes code and reading code are different and equally valid
>>>> activities.
>>>>> Sometimes I really just want to know what the author actually told the
>>>>> computer to do.
>>>>>
>>>>>>
>>>>>>
>>>>>> So what do we really lose if we turn off tangle? We lose an R script
>>>>>> as a derivative from the source document, but we do not lose the code
>>>>>> evaluation.
>>>>>
>>>>>
>>>>> We lose *isolated* code evaluation. Sweave/knit have a lot more moving
>>>>> pieces than source/eval do. Many of which are  for the purpose of
>>>> displaying
>>>>> output, rather than running code.
>>>>>
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>>
>>>
>>> --
>>> Carl Boettiger
>>> UC Santa Cruz
>>> http://carlboettiger.info/
>>>
>>
>>
>>
>> --
>> Gabriel Becker
>> Graduate Student
>> Statistics Department
>> University of California, Davis
>>
>
>
>


From csardi.gabor at gmail.com  Mon Jun  2 11:43:47 2014
From: csardi.gabor at gmail.com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Mon, 2 Jun 2014 11:43:47 +0200
Subject: [Rd] Contact email on CRAN website
Message-ID: <CABtg=KmoJEe9cJfkv9y08x75oeh4RXquFjAWPowL9FaK_7jSyw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140602/21191149/attachment.pl>

From nashjc at uottawa.ca  Mon Jun  2 14:06:56 2014
From: nashjc at uottawa.ca (Prof J C Nash (U30A))
Date: Mon, 02 Jun 2014 08:06:56 -0400
Subject: [Rd] R CMD check for the R code from vignettes -- thread
	fraying?
In-Reply-To: <mailman.21.1401703206.24344.r-devel@r-project.org>
References: <mailman.21.1401703206.24344.r-devel@r-project.org>
Message-ID: <538C68E0.2080601@uottawa.ca>

I noted Duncan's comment that an answer had been provided, and went to
the archives to find his earlier comment, which I am fairly sure I saw a
day or two ago. However, neither May nor June archives show Duncan in
the thread except for the msg below (edited for space). Possibly tech
failures are causing misunderstandings.

JN

On 14-06-02 06:00 AM, r-devel-request at r-project.org wrote:
> Message: 4 Date: Mon, 02 Jun 2014 14:06:28 +0900 From: Duncan Murdoch
> <murdoch.duncan at gmail.com> To: Carl Boettiger <cboettig at gmail.com>,
> Gabriel Becker <gmbecker at ucdavis.edu> Cc: Henrik Bengtsson
> <hb at biostat.ucsf.edu>, R-devel <r-devel at r-project.org> Subject: Re: [Rd]
> R CMD check for the R code from vignettes Message-ID:
> <538C0654.7050205 at gmail.com> Content-Type: text/plain;
> charset=ISO-8859-1; format=flowed On 02/06/2014, 1:41 PM, Carl Boettiger
> wrote:
>> > Thanks both for the replies.
>> >
....

> You haven't been reading very carefully.  I saw several:  mine, Martin 
> Morgan's, Kasper Daniel Hansen's.
> 
> Duncan Murdoch

....


From pgilbert902 at gmail.com  Mon Jun  2 17:19:39 2014
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Mon, 02 Jun 2014 11:19:39 -0400
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <CADwqtCP=PJR=hDx9KSjs4HeSaqdgpdLZR-EpS0a5A2DPcW_7=Q@mail.gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>	<538885F3.8020807@gmail.com>	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>	<538A63C6.5030201@fhcrc.org>	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>	<CADwqtCNQEAz==L4fSomQt+Ayw6wSo61-uM=xN_9K26K1XRoFwQ@mail.gmail.com>	<CANROs4cuHbSTeNXgBuWFAhpHGMVdGLsAs5gFH+8s=HCq8NYiwQ@mail.gmail.com>	<CAN_1p9wgx57ZRAYz56m+-51_UMYTtm97-JmpYSKYtHSobLkOzQ@mail.gmail.com>
	<CADwqtCP=PJR=hDx9KSjs4HeSaqdgpdLZR-EpS0a5A2DPcW_7=Q@mail.gmail.com>
Message-ID: <538C960B.2040509@gmail.com>



On 06/02/2014 12:16 AM, Gabriel Becker wrote:
> Carl,
>
> I don't really have a horse in this race other than a strong feeling that
> whatever check does should be mandatory.
>
> That having been said, I think it can be argued that the fact that check
> does this means that it IS in the R package vignette specification that all
> vignettes must be such that their tangled code will run without errors.

My understanding of this is that the package maintainer can turn off 
building the vignette (--no-vignettes) but R CMD check and CRAN still 
check that the tangle code runs, and the check fails if it does not. 
Running the tangle code can be turned off, just not by the package 
maintainer. You have to make a special appeal to the CRAN maintainers, 
and give reasons they are prepared to accept. I think the intention is 
that the tangle code should run without errors. I doubt they would 
accept "it doesn't work" as an acceptable reason. But there are reasons, 
like the vignette requires access to a commercial database engine. Also, 
I think, turning this off means they just do not run it regularly, in 
the daily checks. I don't think it necessarily means the code is never 
tested. The testing may need to be done on machines with special resources.

Thus, --no-vignettes provides a mechanism to avoid running the tangle 
code twice but, without special exemption, it is still run once. Some 
package maintainers may not think of several feature of 'R CMD check' as 
'aids'. I think of it having more to do with maintaining some quality 
assurance, which I think of as an aid but not a debugging aid.

I believe the CRAN maintainers have intentionally, and successfully, 
made disabling the running of tangled code  more trouble than it is 
generally worth. Effectively, a package should have tangle code that 
runs without errors.

(Of course, I could be wrong about all this, it has happened before.)

Paul

>
> ~G
>
>
> On Sun, Jun 1, 2014 at 8:43 PM, Carl Boettiger <cboettig at gmail.com> wrote:
>
>> Yihui, list,
>>
>> Focusing the behavior of R CMD check, the only reason I have seen put
>> forward in the discussion for having check tangle and then source as well
>> as knit/weave the very same vignette is to assist the package maintainer in
>> debugging R errors vs pdflatex errors.  As tangle (and many other tools)
>> are already available to an author needing extra help debugging, and as the
>> error messages are usually clear on whether errors come from the R code or
>> whatever format compiling (pdflatex, markdown html, etc), this seems like a
>> poor reason for R CMD check to be wasting time doing two versions of almost
>> (but not literally) the same check.
>>
>> As has already been discussed, it is possible to write vignettes that can
>> be Sweave'd but not source'd, due to the different treatments of inline
>> chunks.  While I see the advantages of this property, I don't see why R CMD
>> check should be enforcing it through the arbitrary mechanism of running
>> both Sweave and tangle+source. If that is the desired behavior for all
>> Sweave documents it should be in part of the Sweave specification not to be
>> able to write/change values in inline expressions, or part of the tangle
>> definition to include inline chunks.  I any event I don't see any reason
>> for R CMD check doing both.  Perhaps someone can fill in whatever I've
>> overlooked?
>>
>> Carl
>>
>>
>> On Sat, May 31, 2014 at 8:17 PM, Yihui Xie <xie at yihui.name> wrote:
>>
>>> 1. The starting point of this discussion is package vignettes, instead
>>> of R scripts. I'm not saying we should abandon R scripts, or all
>>> people should write R code to generate reports. Starting from a
>>> package vignette, you can evaluate it using a weave function, or
>>> evaluate its derivative, namely an R script. I was saying the former
>>> might not be a bad idea, although the latter sounds more familiar to
>>> most R users. For a package vignette, within the context of R CMD
>>> check, is it necessary to do tangle + evaluate _besides_ weave?
>>>
>>> 2. If you are comfortable with reading pure code without narratives,
>>> I'm totally fine with that. I guess there is nothing to argue on this
>>> point, since it is pretty much personal taste.
>>>
>>> 3. Yes, you are absolutely correct -- Sweave()/knit() does more than
>>> source(), but let me repeat the issue to be discussed: what harm does
>>> it bring if we disable tangle for R package vignettes?
>>>
>>> Sorry if I did not make it clear enough, my priority of this
>>> discussion is the necessity of tangle for package vignettes. After we
>>> finish this issue, I'll be happy to extend the discussion towards
>>> tangle in general.
>>>
>>> Regards,
>>> Yihui
>>> --
>>> Yihui Xie <xieyihui at gmail.com>
>>> Web: http://yihui.name
>>>
>>>
>>> On Sat, May 31, 2014 at 9:20 PM, Gabriel Becker <gmbecker at ucdavis.edu>
>>> wrote:
>>>>
>>>>
>>>>
>>>> On Sat, May 31, 2014 at 6:54 PM, Yihui Xie <xie at yihui.name> wrote:
>>>>
>>>>> I agree that fully evaluating the code is valuable, but
>>>>> it is not a problem since the weave functions do fully evaluate the
>>>>> code. If there is a reason for why source() an R script is preferred,
>>>>>
>>>>> I guess it is users' familiarity with .R instead of .Rnw/.Rmd/...,
>>>>
>>>>
>>>> It's because .Rnw and Rmd require more from the user than .R. Also, this
>>>> started with vignettes but you seem to be talking more generally. If
>>> so, I
>>>> would point out that not all R code is intended to generate reports, and
>>>> writing pure R code that isn't going to generate a report in an
>>> .Rnw/.Rmd
>>>> file would be very strange to say the least.
>>>>
>>>>
>>>>>
>>>>> however, I guess it would be painful to read the pure R script tangled
>>>>> from the source document without the original narratives.
>>>>
>>>>
>>>> That depends a lot on what you want. Reading an woven article/report
>>> that
>>>> includes code and reading code are different and equally valid
>>> activities.
>>>> Sometimes I really just want to know what the author actually told the
>>>> computer to do.
>>>>
>>>>>
>>>>>
>>>>> So what do we really lose if we turn off tangle? We lose an R script
>>>>> as a derivative from the source document, but we do not lose the code
>>>>> evaluation.
>>>>
>>>>
>>>> We lose *isolated* code evaluation. Sweave/knit have a lot more moving
>>>> pieces than source/eval do. Many of which are  for the purpose of
>>> displaying
>>>> output, rather than running code.
>>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>>
>> --
>> Carl Boettiger
>> UC Santa Cruz
>> http://carlboettiger.info/
>>
>
>
>


From xie at yihui.name  Mon Jun  2 17:58:54 2014
From: xie at yihui.name (Yihui Xie)
Date: Mon, 2 Jun 2014 10:58:54 -0500
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <538C960B.2040509@gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>
	<538885F3.8020807@gmail.com>
	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>
	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>
	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>
	<538A63C6.5030201@fhcrc.org>
	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>
	<CADwqtCNQEAz==L4fSomQt+Ayw6wSo61-uM=xN_9K26K1XRoFwQ@mail.gmail.com>
	<CANROs4cuHbSTeNXgBuWFAhpHGMVdGLsAs5gFH+8s=HCq8NYiwQ@mail.gmail.com>
	<CAN_1p9wgx57ZRAYz56m+-51_UMYTtm97-JmpYSKYtHSobLkOzQ@mail.gmail.com>
	<CADwqtCP=PJR=hDx9KSjs4HeSaqdgpdLZR-EpS0a5A2DPcW_7=Q@mail.gmail.com>
	<538C960B.2040509@gmail.com>
Message-ID: <CANROs4fyMwi9=+h=78sXxcp4L8oH=WFSP_fighbzT8h_qa0b8Q@mail.gmail.com>

Yes, I completely agree the tangle code should run without errors, if
the package author has provided such a script. However, I think it is
also the package author's right to choose not to provide such a
script, for reasons that I stated in the beginning (1. redundancy; 2.
tangle functions ignore inline expressions that should not be
ignored).

It seems that I still need to clarify it: I'm not talking about
disabling _running_ the tangled code, but disabling _generating_ the
code _optionally_. Unless someone is arguing that the tangled code
_must_ be generated from vignettes, I do not think anybody in this
discussion really has a conflict with anybody else.

Please also note that I do not expect R core or CRAN maintainers to do
any extra work: package authors can easily disable tangle by
themselves without anything special flags to R CMD build or R CMD
check. The vignettes are still built normally (in terms of "weave"). I
brought forward the discussion to hear the possible harm that I was
potentially not aware of when we disable tangle for R package
vignettes (e.g. does it affect the quality of the package?). So far I
have not heard real harm (I admit my judgment is subjective).

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Web: http://yihui.name


On Mon, Jun 2, 2014 at 10:19 AM, Paul Gilbert <pgilbert902 at gmail.com> wrote:
>
>
> On 06/02/2014 12:16 AM, Gabriel Becker wrote:
>>
>> Carl,
>>
>> I don't really have a horse in this race other than a strong feeling that
>> whatever check does should be mandatory.
>>
>> That having been said, I think it can be argued that the fact that check
>> does this means that it IS in the R package vignette specification that
>> all
>> vignettes must be such that their tangled code will run without errors.
>
>
> My understanding of this is that the package maintainer can turn off
> building the vignette (--no-vignettes) but R CMD check and CRAN still check
> that the tangle code runs, and the check fails if it does not. Running the
> tangle code can be turned off, just not by the package maintainer. You have
> to make a special appeal to the CRAN maintainers, and give reasons they are
> prepared to accept. I think the intention is that the tangle code should run
> without errors. I doubt they would accept "it doesn't work" as an acceptable
> reason. But there are reasons, like the vignette requires access to a
> commercial database engine. Also, I think, turning this off means they just
> do not run it regularly, in the daily checks. I don't think it necessarily
> means the code is never tested. The testing may need to be done on machines
> with special resources.
>
> Thus, --no-vignettes provides a mechanism to avoid running the tangle code
> twice but, without special exemption, it is still run once. Some package
> maintainers may not think of several feature of 'R CMD check' as 'aids'. I
> think of it having more to do with maintaining some quality assurance, which
> I think of as an aid but not a debugging aid.
>
> I believe the CRAN maintainers have intentionally, and successfully, made
> disabling the running of tangled code  more trouble than it is generally
> worth. Effectively, a package should have tangle code that runs without
> errors.
>
> (Of course, I could be wrong about all this, it has happened before.)
>
> Paul


From xie at yihui.name  Mon Jun  2 18:08:48 2014
From: xie at yihui.name (Yihui Xie)
Date: Mon, 2 Jun 2014 11:08:48 -0500
Subject: [Rd] R CMD check for the R code from vignettes -- thread
	fraying?
In-Reply-To: <538C68E0.2080601@uottawa.ca>
References: <mailman.21.1401703206.24344.r-devel@r-project.org>
	<538C68E0.2080601@uottawa.ca>
Message-ID: <CANROs4fbaOHTuwir6VOXhSg-fQKt6eRft7MTZEpqHK5pt+zzjQ@mail.gmail.com>

I asked the same question privately yesterday since I did not receive
it or find it in the archive, and it turned out he sent an off-line
reply. I'm replying publicly just to avoid further confusion, and
sorry to spam all in the list.

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Web: http://yihui.name


On Mon, Jun 2, 2014 at 7:06 AM, Prof J C Nash (U30A) <nashjc at uottawa.ca> wrote:
> I noted Duncan's comment that an answer had been provided, and went to
> the archives to find his earlier comment, which I am fairly sure I saw a
> day or two ago. However, neither May nor June archives show Duncan in
> the thread except for the msg below (edited for space). Possibly tech
> failures are causing misunderstandings.
>
> JN
>
> On 14-06-02 06:00 AM, r-devel-request at r-project.org wrote:
>> Message: 4 Date: Mon, 02 Jun 2014 14:06:28 +0900 From: Duncan Murdoch
>> <murdoch.duncan at gmail.com> To: Carl Boettiger <cboettig at gmail.com>,
>> Gabriel Becker <gmbecker at ucdavis.edu> Cc: Henrik Bengtsson
>> <hb at biostat.ucsf.edu>, R-devel <r-devel at r-project.org> Subject: Re: [Rd]
>> R CMD check for the R code from vignettes Message-ID:
>> <538C0654.7050205 at gmail.com> Content-Type: text/plain;
>> charset=ISO-8859-1; format=flowed On 02/06/2014, 1:41 PM, Carl Boettiger
>> wrote:
>>> > Thanks both for the replies.
>>> >
> ....
>
>> You haven't been reading very carefully.  I saw several:  mine, Martin
>> Morgan's, Kasper Daniel Hansen's.
>>
>> Duncan Murdoch


From toth.denes at ttk.mta.hu  Mon Jun  2 18:31:52 2014
From: toth.denes at ttk.mta.hu (=?ISO-8859-1?Q?D=E9nes_T=F3th?=)
Date: Mon, 02 Jun 2014 18:31:52 +0200
Subject: [Rd] memory allocation if multiple names point to the same object
In-Reply-To: <5377F03E.2020702@oracle.com>
References: <53779F9A.1040809@oracle.com>	<414982A9-728F-4018-9D96-C3005B57BC05@gmail.com>
	<5377F03E.2020702@oracle.com>
Message-ID: <538CA6F8.5060006@ttk.mta.hu>


Hi,

Please consider the following code:

a <- seq.int(10)  # create a
tracemem(a)
a[1:4] <- 4:1   # no internal copy
b <- a          # no internal copy
b[1:4] <- 1:4   # copy, b is not a any more
a[1:4] <- 1:4   # copy, but why?

With results:
 > a <- seq.int(10)
 > tracemem(a)
[1] "<0x1792bc0>"
 > a[1:4] <- 4:1
 > b <- a
 > b[1:4] <- 1:4
tracemem[0x1792bc0 -> 0x1792b58]:
 > a[1:4] <- 1:4
tracemem[0x1792bc0 -> 0x1792af0]:


##

Could you provide a brief explanation or point me to a source why R 
needs a copy in the final step?


Best,
   Denes



 > sessionInfo()
R version 3.1.0 (2014-04-10)
Platform: x86_64-pc-linux-gnu (64-bit)

locale:
  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


From murdoch.duncan at gmail.com  Mon Jun  2 19:44:39 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 03 Jun 2014 02:44:39 +0900
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <CANROs4fyMwi9=+h=78sXxcp4L8oH=WFSP_fighbzT8h_qa0b8Q@mail.gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>	<538885F3.8020807@gmail.com>	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>	<538A63C6.5030201@fhcrc.org>	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>	<CADwqtCNQEAz==L4fSomQt+Ayw6wSo61-uM=xN_9K26K1XRoFwQ@mail.gmail.com>	<CANROs4cuHbSTeNXgBuWFAhpHGMVdGLsAs5gFH+8s=HCq8NYiwQ@mail.gmail.com>	<CAN_1p9wgx57ZRAYz56m+-51_UMYTtm97-JmpYSKYtHSobLkOzQ@mail.gmail.com>	<CADwqtCP=PJR=hDx9KSjs4HeSaqdgpdLZR-EpS0a5A2DPcW_7=Q@mail.gmail.com>	<538C960B.2040509@gmail.com>
	<CANROs4fyMwi9=+h=78sXxcp4L8oH=WFSP_fighbzT8h_qa0b8Q@mail.gmail.com>
Message-ID: <538CB807.7050100@gmail.com>

On 03/06/2014, 12:58 AM, Yihui Xie wrote:
> Yes, I completely agree the tangle code should run without errors, if
> the package author has provided such a script. However, I think it is
> also the package author's right to choose not to provide such a
> script, for reasons that I stated in the beginning (1. redundancy; 2.
> tangle functions ignore inline expressions that should not be
> ignored).
>
> It seems that I still need to clarify it: I'm not talking about
> disabling _running_ the tangled code, but disabling _generating_ the
> code _optionally_. Unless someone is arguing that the tangled code
> _must_ be generated from vignettes, I do not think anybody in this
> discussion really has a conflict with anybody else.

I think that it's not a vignette if you can't tangle it.  Including 
\Sexpr expressions in the tangled code is the sort of option I would 
support much more than suppressing the ability to tangle.  (I don't 
think \Sexpr expressions should be included by default, but there's 
enough flexibility in the system that it shouldn't be hard to include 
them optionally.)

>
> Please also note that I do not expect R core or CRAN maintainers to do
> any extra work: package authors can easily disable tangle by
> themselves without anything special flags to R CMD build or R CMD
> check. The vignettes are still built normally (in terms of "weave"). I
> brought forward the discussion to hear the possible harm that I was
> potentially not aware of when we disable tangle for R package
> vignettes (e.g. does it affect the quality of the package?). So far I
> have not heard real harm (I admit my judgment is subjective).

Several of us have told you the real harm:  it means that users can't 
easily extract a script that replicates the computations done in the 
vignette.  That's a useful thing to be able to do.

Duncan Murdoch

>
> Regards,
> Yihui
> --
> Yihui Xie <xieyihui at gmail.com>
> Web: http://yihui.name
>
>
> On Mon, Jun 2, 2014 at 10:19 AM, Paul Gilbert <pgilbert902 at gmail.com> wrote:
>>
>>
>> On 06/02/2014 12:16 AM, Gabriel Becker wrote:
>>>
>>> Carl,
>>>
>>> I don't really have a horse in this race other than a strong feeling that
>>> whatever check does should be mandatory.
>>>
>>> That having been said, I think it can be argued that the fact that check
>>> does this means that it IS in the R package vignette specification that
>>> all
>>> vignettes must be such that their tangled code will run without errors.
>>
>>
>> My understanding of this is that the package maintainer can turn off
>> building the vignette (--no-vignettes) but R CMD check and CRAN still check
>> that the tangle code runs, and the check fails if it does not. Running the
>> tangle code can be turned off, just not by the package maintainer. You have
>> to make a special appeal to the CRAN maintainers, and give reasons they are
>> prepared to accept. I think the intention is that the tangle code should run
>> without errors. I doubt they would accept "it doesn't work" as an acceptable
>> reason. But there are reasons, like the vignette requires access to a
>> commercial database engine. Also, I think, turning this off means they just
>> do not run it regularly, in the daily checks. I don't think it necessarily
>> means the code is never tested. The testing may need to be done on machines
>> with special resources.
>>
>> Thus, --no-vignettes provides a mechanism to avoid running the tangle code
>> twice but, without special exemption, it is still run once. Some package
>> maintainers may not think of several feature of 'R CMD check' as 'aids'. I
>> think of it having more to do with maintaining some quality assurance, which
>> I think of as an aid but not a debugging aid.
>>
>> I believe the CRAN maintainers have intentionally, and successfully, made
>> disabling the running of tangled code  more trouble than it is generally
>> worth. Effectively, a package should have tangle code that runs without
>> errors.
>>
>> (Of course, I could be wrong about all this, it has happened before.)
>>
>> Paul
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ucfagls at gmail.com  Mon Jun  2 21:12:01 2014
From: ucfagls at gmail.com (Gavin Simpson)
Date: Mon, 2 Jun 2014 13:12:01 -0600
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <538CB807.7050100@gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>
	<538885F3.8020807@gmail.com>
	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>
	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>
	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>
	<538A63C6.5030201@fhcrc.org>
	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>
	<CADwqtCNQEAz==L4fSomQt+Ayw6wSo61-uM=xN_9K26K1XRoFwQ@mail.gmail.com>
	<CANROs4cuHbSTeNXgBuWFAhpHGMVdGLsAs5gFH+8s=HCq8NYiwQ@mail.gmail.com>
	<CAN_1p9wgx57ZRAYz56m+-51_UMYTtm97-JmpYSKYtHSobLkOzQ@mail.gmail.com>
	<CADwqtCP=PJR=hDx9KSjs4HeSaqdgpdLZR-EpS0a5A2DPcW_7=Q@mail.gmail.com>
	<538C960B.2040509@gmail.com>
	<CANROs4fyMwi9=+h=78sXxcp4L8oH=WFSP_fighbzT8h_qa0b8Q@mail.gmail.com>
	<538CB807.7050100@gmail.com>
Message-ID: <CAAHES9wXcvfzrCTAtz0XrOVeYzijno32WZ8seOh4LO+0ZzZd_A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140602/cea7b5e4/attachment.pl>

From xie at yihui.name  Mon Jun  2 21:38:28 2014
From: xie at yihui.name (Yihui Xie)
Date: Mon, 2 Jun 2014 14:38:28 -0500
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <538CB807.7050100@gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>
	<538885F3.8020807@gmail.com>
	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>
	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>
	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>
	<538A63C6.5030201@fhcrc.org>
	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>
	<CADwqtCNQEAz==L4fSomQt+Ayw6wSo61-uM=xN_9K26K1XRoFwQ@mail.gmail.com>
	<CANROs4cuHbSTeNXgBuWFAhpHGMVdGLsAs5gFH+8s=HCq8NYiwQ@mail.gmail.com>
	<CAN_1p9wgx57ZRAYz56m+-51_UMYTtm97-JmpYSKYtHSobLkOzQ@mail.gmail.com>
	<CADwqtCP=PJR=hDx9KSjs4HeSaqdgpdLZR-EpS0a5A2DPcW_7=Q@mail.gmail.com>
	<538C960B.2040509@gmail.com>
	<CANROs4fyMwi9=+h=78sXxcp4L8oH=WFSP_fighbzT8h_qa0b8Q@mail.gmail.com>
	<538CB807.7050100@gmail.com>
Message-ID: <CANROs4dPkps8XQxYc6Wa1fGoO=TMugDg5xkP0r9jJF7Fk2a7tQ@mail.gmail.com>

Well, there is still misunderstanding: there is nothing that really
stops you from tangling the vignettes, and I do not disagree that
tangle can be useful in certain cases. I'm talking about whether
package authors _must_ tangle all their vignettes, or leave some to
users to run Stangle() or knitr::purl() on the vignettes if they
really want the potentially broken R script. The prerequisite of this
question is that the current tangle functions ignore inline
expressions, and it is not totally clear whether this is good or bad.

The harm that you mentioned was not from disabling tangle, but from
the tangle function, or if you insist the current tangle function
should be what we expect, then the harm came from the improper use of
inline expressions.

I do not think it is trivial to improve the tangle function so that it
can generate an R script that fully reproduce what was done in weave.
Inline expressions are not the only thing that need improvement. If
you argue for reproducible research, I can open the Pandora's box to
make tangle even less desirable and further away from reproducible
research. For example, how about reproducing graphics using the
tangled R script? (How do you make tangle use the same graphical
device(s) as weave? How do you pass the chunk options
width/height/fig/prefix.string to tangle?) How about chunk hook
functions in getOption('SweaveHooks')? (What if they have significant
side effects such as clearing up the workspace as documented in
help(RweaveLatex)? How to reproduce these side effects in the tangled
R script?) These open-ended questions apply to both Sweave and knitr.
As the author of knitr, I feel it is very difficult to answer them.
Instead of patching tangle functions with uncertainty, personally I'd
like to stay primarily in the weave world (I admit I'm lazy and lack
confidence).

I work like Kevin Coombes in the sense that the number of times I
invoke weave is orders of magnitude greater than tangle. If you
produced a report using weave, I do not think you should expect other
people to reproduce the computation using the tangled code.

My conclusion: Is tangle useful? Yes. Must we tangle package
vignettes? Perhaps no.

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Web: http://yihui.name


On Mon, Jun 2, 2014 at 12:44 PM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 03/06/2014, 12:58 AM, Yihui Xie wrote:
>>
>> Yes, I completely agree the tangle code should run without errors, if
>> the package author has provided such a script. However, I think it is
>> also the package author's right to choose not to provide such a
>> script, for reasons that I stated in the beginning (1. redundancy; 2.
>> tangle functions ignore inline expressions that should not be
>> ignored).
>>
>> It seems that I still need to clarify it: I'm not talking about
>> disabling _running_ the tangled code, but disabling _generating_ the
>> code _optionally_. Unless someone is arguing that the tangled code
>> _must_ be generated from vignettes, I do not think anybody in this
>> discussion really has a conflict with anybody else.
>
>
> I think that it's not a vignette if you can't tangle it.  Including \Sexpr
> expressions in the tangled code is the sort of option I would support much
> more than suppressing the ability to tangle.  (I don't think \Sexpr
> expressions should be included by default, but there's enough flexibility in
> the system that it shouldn't be hard to include them optionally.)
>
>
>>
>> Please also note that I do not expect R core or CRAN maintainers to do
>> any extra work: package authors can easily disable tangle by
>> themselves without anything special flags to R CMD build or R CMD
>> check. The vignettes are still built normally (in terms of "weave"). I
>> brought forward the discussion to hear the possible harm that I was
>> potentially not aware of when we disable tangle for R package
>> vignettes (e.g. does it affect the quality of the package?). So far I
>> have not heard real harm (I admit my judgment is subjective).
>
>
> Several of us have told you the real harm:  it means that users can't easily
> extract a script that replicates the computations done in the vignette.
> That's a useful thing to be able to do.
>
> Duncan Murdoch


From gmbecker at ucdavis.edu  Mon Jun  2 22:22:33 2014
From: gmbecker at ucdavis.edu (Gabriel Becker)
Date: Mon, 2 Jun 2014 13:22:33 -0700
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <CANROs4dPkps8XQxYc6Wa1fGoO=TMugDg5xkP0r9jJF7Fk2a7tQ@mail.gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>
	<538885F3.8020807@gmail.com>
	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>
	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>
	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>
	<538A63C6.5030201@fhcrc.org>
	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>
	<CADwqtCNQEAz==L4fSomQt+Ayw6wSo61-uM=xN_9K26K1XRoFwQ@mail.gmail.com>
	<CANROs4cuHbSTeNXgBuWFAhpHGMVdGLsAs5gFH+8s=HCq8NYiwQ@mail.gmail.com>
	<CAN_1p9wgx57ZRAYz56m+-51_UMYTtm97-JmpYSKYtHSobLkOzQ@mail.gmail.com>
	<CADwqtCP=PJR=hDx9KSjs4HeSaqdgpdLZR-EpS0a5A2DPcW_7=Q@mail.gmail.com>
	<538C960B.2040509@gmail.com>
	<CANROs4fyMwi9=+h=78sXxcp4L8oH=WFSP_fighbzT8h_qa0b8Q@mail.gmail.com>
	<538CB807.7050100@gmail.com>
	<CANROs4dPkps8XQxYc6Wa1fGoO=TMugDg5xkP0r9jJF7Fk2a7tQ@mail.gmail.com>
Message-ID: <CADwqtCNmYczcAcbFwo7F0NQYim=D_-qDiEhOZnbNOmFCyNxDrA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140602/7b44c41b/attachment.pl>

From murdoch.duncan at gmail.com  Mon Jun  2 23:59:19 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 03 Jun 2014 06:59:19 +0900
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <CAAHES9wXcvfzrCTAtz0XrOVeYzijno32WZ8seOh4LO+0ZzZd_A@mail.gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>	<538885F3.8020807@gmail.com>	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>	<538A63C6.5030201@fhcrc.org>	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>	<CADwqtCNQEAz==L4fSomQt+Ayw6wSo61-uM=xN_9K26K1XRoFwQ@mail.gmail.com>	<CANROs4cuHbSTeNXgBuWFAhpHGMVdGLsAs5gFH+8s=HCq8NYiwQ@mail.gmail.com>	<CAN_1p9wgx57ZRAYz56m+-51_UMYTtm97-JmpYSKYtHSobLkOzQ@mail.gmail.com>	<CADwqtCP=PJR=hDx9KSjs4HeSaqdgpdLZR-EpS0a5A2DPcW_7=Q@mail.gmail.com>	<538C960B.2040509@gmail.com>	<CANROs4fyMwi9=+h=78sXxcp4L8oH=WFSP_fighbzT8h_qa0b8Q@mail.gmail.com>	<538CB807.7050100@gmail.com>
	<CAAHES9wXcvfzrCTAtz0XrOVeYzijno32WZ8seOh4LO+0ZzZd_A@mail.gmail.com>
Message-ID: <538CF3B7.2060007@gmail.com>

On 03/06/2014, 4:12 AM, Gavin Simpson wrote:
> On 2 June 2014 11:44, Duncan Murdoch <murdoch.duncan at gmail.com
> <mailto:murdoch.duncan at gmail.com>> wrote:
>
>     On 03/06/2014, 12:58 AM, Yihui Xie wrote:
>
>         Please also note that I do not expect R core or CRAN maintainers
>         to do
>         any extra work: package authors can easily disable tangle by
>         themselves without anything special flags to R CMD build or R CMD
>         check. The vignettes are still built normally (in terms of
>         "weave"). I
>         brought forward the discussion to hear the possible harm that I was
>         potentially not aware of when we disable tangle for R package
>         vignettes (e.g. does it affect the quality of the package?). So
>         far I
>         have not heard real harm (I admit my judgment is subjective).
>
>
>     Several of us have told you the real harm:  it means that users
>     can't easily extract a script that replicates the computations done
>     in the vignette.  That's a useful thing to be able to do.
>
>
> Isn't the issue here that `tangle()` doesn't, currently, "extract a
> script that replicates the computations done in the vignette", but
> rather does so only partially?

No, I think the issue is that some people don't want to have to 
guarantee that the tangled source produces the same results.  R doesn't 
guarantee it, it is up to the author to do so.

>
> People seem to be arguing across one another throughout this thread.
> Yihui has identified an infelicity in the tangle implementation. Turning
> off tangling + sourcing in R CMD check may not be a desirable solution,
> so if the aim is to extract R code to replicate the computations in the
> vignette, tangle() needs to be modified to allow for inclusion
> (optional) of \Sexpr "chunks".

That's one solution, and the other is to limit \Sexpr code to things 
with no side effects, as Sweave was originally designed.

>
> To move this thread forwards, would contributions that added this
> optional feature to tangle() be considered by R Core? If so, perhaps
> those affected by the current infelicity might wish to propose patches
> to the R sources which implement a solution?

As I said before, I'm more sympathetic to that solution than to dropping 
the requirement that tangled code should work.  I think the changes to 
base R need only be minimal:  only an extra argument to the driver code 
for the tangling.  Users who want to use this feature should write their 
own (or use someone else's if they don't' mind an extra dependency) as a 
"non-Sweave vignette driver", whose implementation is to call Stangle 
with the non-default parameter setting.

Duncan Murdoch


From murdoch.duncan at gmail.com  Tue Jun  3 00:03:59 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 03 Jun 2014 07:03:59 +0900
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <CANROs4dPkps8XQxYc6Wa1fGoO=TMugDg5xkP0r9jJF7Fk2a7tQ@mail.gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>
	<538885F3.8020807@gmail.com>
	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>
	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>
	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>
	<538A63C6.5030201@fhcrc.org>
	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>
	<CADwqtCNQEAz==L4fSomQt+Ayw6wSo61-uM=xN_9K26K1XRoFwQ@mail.gmail.com>
	<CANROs4cuHbSTeNXgBuWFAhpHGMVdGLsAs5gFH+8s=HCq8NYiwQ@mail.gmail.com>
	<CAN_1p9wgx57ZRAYz56m+-51_UMYTtm97-JmpYSKYtHSobLkOzQ@mail.gmail.com>
	<CADwqtCP=PJR=hDx9KSjs4HeSaqdgpdLZR-EpS0a5A2DPcW_7=Q@mail.gmail.com>
	<538C960B.2040509@gmail.com>
	<CANROs4fyMwi9=+h=78sXxcp4L8oH=WFSP_fighbzT8h_qa0b8Q@mail.gmail.com>
	<538CB807.7050100@gmail.com>
	<CANROs4dPkps8XQxYc6Wa1fGoO=TMugDg5xkP0r9jJF7Fk2a7tQ@mail.gmail.com>
Message-ID: <538CF4CF.7000300@gmail.com>

On 03/06/2014, 4:38 AM, Yihui Xie wrote:
> Well, there is still misunderstanding: there is nothing that really
> stops you from tangling the vignettes, and I do not disagree that
> tangle can be useful in certain cases. I'm talking about whether
> package authors _must_ tangle all their vignettes,

Yes, there is a misunderstanding.  You don't need to manually tangle all 
your vignettes, R will do it for you.


  or leave some to
> users to run Stangle() or knitr::purl() on the vignettes if they
> really want the potentially broken R script.

If the script is broken, the vignette is broken.  The package author 
should fix it.

  The prerequisite of this
> question is that the current tangle functions ignore inline
> expressions, and it is not totally clear whether this is good or bad.

It may not be clear whether it was a good design decision, but it is the 
Sweave design.  Nowadays there's nothing stopping you from writing a 
non-Sweave driver that doesn't ignore them.
>
> The harm that you mentioned was not from disabling tangle, but from
> the tangle function, or if you insist the current tangle function
> should be what we expect, then the harm came from the improper use of
> inline expressions.

The latter.
>
> I do not think it is trivial to improve the tangle function so that it
> can generate an R script that fully reproduce what was done in weave.

Now you are being nitpicky.

Duncan Murdoch


> Inline expressions are not the only thing that need improvement. If
> you argue for reproducible research, I can open the Pandora's box to
> make tangle even less desirable and further away from reproducible
> research. For example, how about reproducing graphics using the
> tangled R script? (How do you make tangle use the same graphical
> device(s) as weave? How do you pass the chunk options
> width/height/fig/prefix.string to tangle?) How about chunk hook
> functions in getOption('SweaveHooks')? (What if they have significant
> side effects such as clearing up the workspace as documented in
> help(RweaveLatex)? How to reproduce these side effects in the tangled
> R script?) These open-ended questions apply to both Sweave and knitr.
> As the author of knitr, I feel it is very difficult to answer them.
> Instead of patching tangle functions with uncertainty, personally I'd
> like to stay primarily in the weave world (I admit I'm lazy and lack
> confidence).
>
> I work like Kevin Coombes in the sense that the number of times I
> invoke weave is orders of magnitude greater than tangle. If you
> produced a report using weave, I do not think you should expect other
> people to reproduce the computation using the tangled code.
>
> My conclusion: Is tangle useful? Yes. Must we tangle package
> vignettes? Perhaps no.
>
> Regards,
> Yihui
> --
> Yihui Xie <xieyihui at gmail.com>
> Web: http://yihui.name
>
>
> On Mon, Jun 2, 2014 at 12:44 PM, Duncan Murdoch
> <murdoch.duncan at gmail.com> wrote:
>> On 03/06/2014, 12:58 AM, Yihui Xie wrote:
>>>
>>> Yes, I completely agree the tangle code should run without errors, if
>>> the package author has provided such a script. However, I think it is
>>> also the package author's right to choose not to provide such a
>>> script, for reasons that I stated in the beginning (1. redundancy; 2.
>>> tangle functions ignore inline expressions that should not be
>>> ignored).
>>>
>>> It seems that I still need to clarify it: I'm not talking about
>>> disabling _running_ the tangled code, but disabling _generating_ the
>>> code _optionally_. Unless someone is arguing that the tangled code
>>> _must_ be generated from vignettes, I do not think anybody in this
>>> discussion really has a conflict with anybody else.
>>
>>
>> I think that it's not a vignette if you can't tangle it.  Including \Sexpr
>> expressions in the tangled code is the sort of option I would support much
>> more than suppressing the ability to tangle.  (I don't think \Sexpr
>> expressions should be included by default, but there's enough flexibility in
>> the system that it shouldn't be hard to include them optionally.)
>>
>>
>>>
>>> Please also note that I do not expect R core or CRAN maintainers to do
>>> any extra work: package authors can easily disable tangle by
>>> themselves without anything special flags to R CMD build or R CMD
>>> check. The vignettes are still built normally (in terms of "weave"). I
>>> brought forward the discussion to hear the possible harm that I was
>>> potentially not aware of when we disable tangle for R package
>>> vignettes (e.g. does it affect the quality of the package?). So far I
>>> have not heard real harm (I admit my judgment is subjective).
>>
>>
>> Several of us have told you the real harm:  it means that users can't easily
>> extract a script that replicates the computations done in the vignette.
>> That's a useful thing to be able to do.
>>
>> Duncan Murdoch


From ucfagls at gmail.com  Tue Jun  3 00:28:42 2014
From: ucfagls at gmail.com (Gavin Simpson)
Date: Mon, 2 Jun 2014 16:28:42 -0600
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <538CF3B7.2060007@gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>
	<538885F3.8020807@gmail.com>
	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>
	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>
	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>
	<538A63C6.5030201@fhcrc.org>
	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>
	<CADwqtCNQEAz==L4fSomQt+Ayw6wSo61-uM=xN_9K26K1XRoFwQ@mail.gmail.com>
	<CANROs4cuHbSTeNXgBuWFAhpHGMVdGLsAs5gFH+8s=HCq8NYiwQ@mail.gmail.com>
	<CAN_1p9wgx57ZRAYz56m+-51_UMYTtm97-JmpYSKYtHSobLkOzQ@mail.gmail.com>
	<CADwqtCP=PJR=hDx9KSjs4HeSaqdgpdLZR-EpS0a5A2DPcW_7=Q@mail.gmail.com>
	<538C960B.2040509@gmail.com>
	<CANROs4fyMwi9=+h=78sXxcp4L8oH=WFSP_fighbzT8h_qa0b8Q@mail.gmail.com>
	<538CB807.7050100@gmail.com>
	<CAAHES9wXcvfzrCTAtz0XrOVeYzijno32WZ8seOh4LO+0ZzZd_A@mail.gmail.com>
	<538CF3B7.2060007@gmail.com>
Message-ID: <CAAHES9x3EnvZ=mLWd624jUYxV_uEbd1QiZmoL-OhXrC4TGAnqA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140602/412eb049/attachment.pl>

From bbolker at gmail.com  Tue Jun  3 02:07:28 2014
From: bbolker at gmail.com (Ben Bolker)
Date: Tue, 3 Jun 2014 00:07:28 +0000
Subject: [Rd] A bug in princomp(), perhaps?
References: <2F9EA67EF9AE1C48A147CB41BE2E15C30E2D6CDC@DOM-EB-MAIL2.win.ad.jhu.edu>
	<5213E16E-54FC-46D2-A92E-BC2D44A338BD@gmail.com>
	<2F9EA67EF9AE1C48A147CB41BE2E15C30E2D7237@DOM-EB-MAIL2.win.ad.jhu.edu>
	<CAAHES9zWN3c4pdK8XcKLuKbq4kNV3Ohs6NCb0yo9dGM0+3sP4w@mail.gmail.com>
	<2F9EA67EF9AE1C48A147CB41BE2E15C30E2D734D@DOM-EB-MAIL2.win.ad.jhu.edu>
	<CAAHES9xiwaSv3FQ1HYY3NPfCsdqGN+fvqDzvp6vxtArERXA4Jw@mail.gmail.com>
	<loom.20140531T202439-171@post.gmane.org>
Message-ID: <loom.20140603T020140-313@post.gmane.org>

Ben Bolker <bbolker <at> gmail.com> writes:

> 
> FWIW this seems to be a FAQ:
> 
> https://stat.ethz.ch/pipermail/r-devel/2003-July/027018.html
> 
> http://thr3ads.net/r-devel/2013/01/
>    2171832-Re-na.omit-option-in-prcomp-formula-interface-only
> 
> http://r.789695.n4.nabble.com/
>   na-omit-option-in-prcomp-formula-interface-only-td4373533.html
> 
> And two StackOverflow questions (the latter's a bit tangential):
> 
> http://stackoverflow.com/questions/12078291/
>    r-function-prcomp-fails-with-nas-values-even-though-nas-are-allowed
> 
> http://stackoverflow.com/questions/23421438/
>   what-was-wrong-with-running-princomp-in-r/23446938#23446938
> 
>   (Sorry for broken URLs and random assortment of mailing list
> aggregators.)
> 
>   I appreciate Gavin's points that implementing this stuff for
> princomp.default is difficult/problematic, but I second Ravi's
> request for a little  more clarification in the help  text; it's
> quite easy to miss the fact that 'na.action' is defined for
> princomp.formula but not for princomp.default.  Perhaps just
> "Note that setting na.action works for princomp.formula, but
> not for princomp.default" (under the "na.action" argument description).

Putting my effort where my mouth is: I wonder if there is any chance
that this patch against the current SVN would be accepted ... ??

Index: princomp.Rd
===================================================================
--- princomp.Rd	(revision 65832)
+++ princomp.Rd	(working copy)
@@ -37,7 +37,8 @@
     when the data contain \code{NA}s.  The default is set by
     the \code{na.action} setting of \code{\link{options}}, and is
     \code{\link{na.fail}} if that is unset. The \sQuote{factory-fresh}
-    default is \code{\link{na.omit}}.}
+    default is \code{\link{na.omit}}.  (This argument applies \emph{only}
+    to the formula method.)}
   \item{x}{a numeric matrix or data frame which provides the data for the
     principal components analysis.}
   \item{cor}{a logical value indicating whether the calculation should
Index: prcomp.Rd
===================================================================
--- prcomp.Rd	(revision 65832)
+++ prcomp.Rd	(working copy)
@@ -40,7 +40,8 @@
     when the data contain \code{NA}s.  The default is set by
     the \code{na.action} setting of \code{\link{options}}, and is
     \code{\link{na.fail}} if that is unset. The \sQuote{factory-fresh}
-    default is \code{\link{na.omit}}.}
+    default is \code{\link{na.omit}}. (This argument applies \emph{only}
+    to the formula method.)}
   \item{\dots}{arguments passed to or from other methods. If \code{x} is
     a formula one might specify \code{scale.} or \code{tol}.}
   \item{x}{a numeric or complex matrix (or data frame) which provides


From kevin.r.coombes at gmail.com  Tue Jun  3 04:18:42 2014
From: kevin.r.coombes at gmail.com (Kevin Coombes)
Date: Mon, 02 Jun 2014 22:18:42 -0400
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <CAAHES9x3EnvZ=mLWd624jUYxV_uEbd1QiZmoL-OhXrC4TGAnqA@mail.gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>	<538885F3.8020807@gmail.com>	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>	<538A63C6.5030201@fhcrc.org>	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>	<CADwqtCNQEAz==L4fSomQt+Ayw6wSo61-uM=xN_9K26K1XRoFwQ@mail.gmail.com>	<CANROs4cuHbSTeNXgBuWFAhpHGMVdGLsAs5gFH+8s=HCq8NYiwQ@mail.gmail.com>	<CAN_1p9wgx57ZRAYz56m+-51_UMYTtm97-JmpYSKYtHSobLkOzQ@mail.gmail.com>	<CADwqtCP=PJR=hDx9KSjs4HeSaqdgpdLZR-EpS0a5A2DPcW_7=Q@mail.gmail.com>	<538C960B.2040509@gmail.com>	<CANROs4fyMwi9=+h=78sXxcp4L8oH=WFSP_fighbzT8h_qa0b8Q@mail.gmail.com>	<538CB807.7050100@gmail.com>	<CAAHES9wXcvfzrCTAtz0XrOVeYzijno32WZ8seOh4LO+0ZzZd_A@mail.gmail.com>	<538CF3B7.2060007@gmail.com>
	<CAAHES9x3EnvZ=mLWd624jUYxV_uEbd1QiZmoL-OhXrC4TGAnqA@mail.gmail.com>
Message-ID: <538D3082.9050209@gmail.com>

"Doc, it hurts when I do this."
"So, don't do that."

If no one in R Core does anything about this issue (in terms of changing 
Sweave or Stangle), then the solution still remains very simple.  
Authors of vignettes should avoid using anything in \Sexpr{} that has a 
side effect. As long as they do that, the code will tangle correctly and 
produce the same result as Sweave.

R CMD check already detects other things which may or may not be 
outright errors but are viewed as bad practice. I think it is bad 
practice to put code with side effects into an Sexpr. So, I don't do 
that. If I did do that accidentally, I really wouldn't mind if R CMD 
check warned me abut it.

   -- Kevin

On 6/2/2014 6:28 PM, Gavin Simpson wrote:
> On 2 June 2014 15:59, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>
>> On 03/06/2014, 4:12 AM, Gavin Simpson wrote:
>>
>>> On 2 June 2014 11:44, Duncan Murdoch <murdoch.duncan at gmail.com
>>> <mailto:murdoch.duncan at gmail.com>> wrote:
>>>
>>> ....
>>      Several of us have told you the real harm:  it means that users
>>>      can't easily extract a script that replicates the computations done
>>>      in the vignette.  That's a useful thing to be able to do.
>>>
>>>
>>> Isn't the issue here that `tangle()` doesn't, currently, "extract a
>>> script that replicates the computations done in the vignette", but
>>> rather does so only partially?
>>>
>> No, I think the issue is that some people don't want to have to guarantee
>> that the tangled source produces the same results.  R doesn't guarantee it,
>> it is up to the author to do so.
>
> I think those issues have become conflated on this thread; R CMD check
> issues raised the problem that side effects in \Sexpr may lead to tangle()
> generating an R script that may not work or do so only incorrectly.
>
> Whatever the ensuing discussion; the above issue is not ideal and as you
> mention below it could be solved by not allowing side effects in \Sexpr,
> fixing tangle so that \Sexpr is recorded, or some other workaround.
>
>
>>> People seem to be arguing across one another throughout this thread.
>>> Yihui has identified an infelicity in the tangle implementation. Turning
>>> off tangling + sourcing in R CMD check may not be a desirable solution,
>>> so if the aim is to extract R code to replicate the computations in the
>>> vignette, tangle() needs to be modified to allow for inclusion
>>> (optional) of \Sexpr "chunks".
>>>
>> That's one solution, and the other is to limit \Sexpr code to things with
>> no side effects, as Sweave was originally designed.
>
> That would be perfectly fine also; clarifying usage etc helps and whilst it
> may inconvenience those authors that exploited the ambiguity, there is a
> solution now that anyone can write their own vignette drivers.
>
>
>>
>>> To move this thread forwards, would contributions that added this
>>> optional feature to tangle() be considered by R Core? If so, perhaps
>>> those affected by the current infelicity might wish to propose patches
>>> to the R sources which implement a solution?
>>>
>> As I said before, I'm more sympathetic to that solution than to dropping
>> the requirement that tangled code should work.  I think the changes to base
>> R need only be minimal:  only an extra argument to the driver code for the
>> tangling.  Users who want to use this feature should write their own (or
>> use someone else's if they don't' mind an extra dependency) as a
>> "non-Sweave vignette driver", whose implementation is to call Stangle with
>> the non-default parameter setting.
>>
>> Duncan Murdoch
>>
> I agree, and given that the changes to base R would be minimal and yet
> solve the problem for those wanting to allow & tangle side effects in
> \Sexpr (or allow them to solve it with a driver) it is disappointing to
> note i) the length of this thread (!) and ii) the often irrelevant
> arguments that some contributors have offered. (Do note this is not
> directed specifically at you Duncan.)
>
> It has not gone without notice of late the increasing regularity with which
> threads here descend into irrelevant or antagonistic directions.
>
> G
>


From djsamperi at gmail.com  Tue Jun  3 07:02:55 2014
From: djsamperi at gmail.com (Dominick Samperi)
Date: Tue, 3 Jun 2014 01:02:55 -0400
Subject: [Rd] rgl pinch and zoom under Windows 8.1
Message-ID: <CADUbQ5gXpX5RBwyXYuVCSMAZwPti1EVFpSy7iMmPDSd2xH472g@mail.gmail.com>

Under Windows 8.1 with a touch screen, the pinch gesture
causes an rgl plot to expand (zoom in) instead of contract, the opposite of
what I would expect. When using a map app, for example, the pinch
gesture causes the map to contract (zoom out).


From xie at yihui.name  Tue Jun  3 07:04:08 2014
From: xie at yihui.name (Yihui Xie)
Date: Tue, 3 Jun 2014 00:04:08 -0500
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <538D3082.9050209@gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>
	<538885F3.8020807@gmail.com>
	<CANROs4eect+qAvXTLEzPhM=X2Eg5R0T-DCUBO6=VDfBFVJNCuQ@mail.gmail.com>
	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>
	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>
	<538A63C6.5030201@fhcrc.org>
	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>
	<CADwqtCNQEAz==L4fSomQt+Ayw6wSo61-uM=xN_9K26K1XRoFwQ@mail.gmail.com>
	<CANROs4cuHbSTeNXgBuWFAhpHGMVdGLsAs5gFH+8s=HCq8NYiwQ@mail.gmail.com>
	<CAN_1p9wgx57ZRAYz56m+-51_UMYTtm97-JmpYSKYtHSobLkOzQ@mail.gmail.com>
	<CADwqtCP=PJR=hDx9KSjs4HeSaqdgpdLZR-EpS0a5A2DPcW_7=Q@mail.gmail.com>
	<538C960B.2040509@gmail.com>
	<CANROs4fyMwi9=+h=78sXxcp4L8oH=WFSP_fighbzT8h_qa0b8Q@mail.gmail.com>
	<538CB807.7050100@gmail.com>
	<CAAHES9wXcvfzrCTAtz0XrOVeYzijno32WZ8seOh4LO+0ZzZd_A@mail.gmail.com>
	<538CF3B7.2060007@gmail.com>
	<CAAHES9x3EnvZ=mLWd624jUYxV_uEbd1QiZmoL-OhXrC4TGAnqA@mail.gmail.com>
	<538D3082.9050209@gmail.com>
Message-ID: <CANROs4dWXzYuig3npku5+YOSkchTpZJUn0e2=1pygMa3JOZLoA@mail.gmail.com>

As I pointed out, \Sexpr{} is not the only potential problem. Besides,
side effects are not necessarily evil in all cases.

Since I have been described as "nitpicky", it is time for me to quit
the discussion now (adjectives on personal pronouns instead of nouns
in a discussion is a sign for me to quit in my eyes). I'm fine with
optional tangling, and I believe one should not expect to reproduce
results generated by weave using a different approach, namely
tangle+source. Some people believe tangling should mandatory, and
tangle must completely match weave in terms of code evaluation. I'm
fine with that, too. I'll be happy to see improvement in tangle
functions, as well as education on good/bad side effects. I have no
intention to win the Nobel Peace Prize, so I'm not going to make
everyone agree with each other. You hold your opinions, and I hold
mine. Once again, thanks everyone for your perspectives!

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Web: http://yihui.name


On Mon, Jun 2, 2014 at 9:18 PM, Kevin Coombes <kevin.r.coombes at gmail.com> wrote:
> "Doc, it hurts when I do this."
> "So, don't do that."
>
> If no one in R Core does anything about this issue (in terms of changing
> Sweave or Stangle), then the solution still remains very simple.  Authors of
> vignettes should avoid using anything in \Sexpr{} that has a side effect. As
> long as they do that, the code will tangle correctly and produce the same
> result as Sweave.
>
> R CMD check already detects other things which may or may not be outright
> errors but are viewed as bad practice. I think it is bad practice to put
> code with side effects into an Sexpr. So, I don't do that. If I did do that
> accidentally, I really wouldn't mind if R CMD check warned me abut it.
>
>   -- Kevin


From lawrence.michael at gene.com  Tue Jun  3 15:57:31 2014
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Tue, 3 Jun 2014 06:57:31 -0700
Subject: [Rd] memory allocation if multiple names point to the same
	object
In-Reply-To: <538CA6F8.5060006@ttk.mta.hu>
References: <53779F9A.1040809@oracle.com>
	<414982A9-728F-4018-9D96-C3005B57BC05@gmail.com>
	<5377F03E.2020702@oracle.com> <538CA6F8.5060006@ttk.mta.hu>
Message-ID: <CAOQ5NyfjOHG29yLE54PVFk_htgPMWw9vZ4RC8=JVPyVzmRinYA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140603/ae8092c1/attachment.pl>

From bowen.m04 at gmail.com  Tue Jun  3 18:55:38 2014
From: bowen.m04 at gmail.com (Bowen Meng)
Date: Tue, 3 Jun 2014 12:55:38 -0400
Subject: [Rd] setting environmental variable inside R function to call C
	function
Message-ID: <CACbqYaxwaYNtyNiuOVH9VjZH5oJ5yytntemyUCr_sP4WZjNVpQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140603/4ce3e3b1/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Tue Jun  3 20:06:13 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 3 Jun 2014 19:06:13 +0100
Subject: [Rd] setting environmental variable inside R function to call C
	function
In-Reply-To: <7dd62e4fe5734fe9af02cce995cfdf83@EX-1-HT0.lancs.local>
References: <7dd62e4fe5734fe9af02cce995cfdf83@EX-1-HT0.lancs.local>
Message-ID: <CANVKczMSHxjHb7rjLvUhMVC-zph4B-aOsD+338=VM6H05g+zjQ@mail.gmail.com>

What does c_fun look like? Here's mine:

#include <stdio.h>
#include <stdlib.h>
void c_fun(){
  printf("TMP is %s\n", getenv("TMP"));
    }

and I then do this at the shell prompt:

R CMD SHLIB c_fun.c

and this at the R prompt:

dyn.load("c_fun.so")
wrapper()

and I get:

> wrapper()
[1] "A"
TMP is A
list()

Is that not what you want?

tldr; works for me.


On Tue, Jun 3, 2014 at 5:55 PM, Bowen Meng <bowen.m04 at gmail.com> wrote:
> wrapper <- function(){
>   Sys.setenv(TMP="A")
>   print(Sys.getenv("TMP"))
>
>   .C("c_fun")
> }
>
>
> As the example above, I hope to set an env var $TMP inside the R function
> "wrapper", which affects the functionality of the C function call "c_fun".
> Also the print line shows that $TMP is set to be "A", but the function call
> of "c_fun" was not affected.
>
> Does anyone know why and how to correctly set the env var for subsequent
> functions?
>
> Thanks,
> BW
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From edd at debian.org  Tue Jun  3 20:49:40 2014
From: edd at debian.org (Dirk Eddelbuettel)
Date: Tue, 3 Jun 2014 13:49:40 -0500
Subject: [Rd] setting environmental variable inside R function to call
	C	function
In-Reply-To: <CANVKczMSHxjHb7rjLvUhMVC-zph4B-aOsD+338=VM6H05g+zjQ@mail.gmail.com>
References: <7dd62e4fe5734fe9af02cce995cfdf83@EX-1-HT0.lancs.local>
	<CANVKczMSHxjHb7rjLvUhMVC-zph4B-aOsD+338=VM6H05g+zjQ@mail.gmail.com>
Message-ID: <21390.6340.125923.394030@max.nulle.part>


I suspect the intend is to send a value from R to compiled code.  Which
happens to be a problem for which Rcpp offers a pretty convenient solution.  

And if you really, really want to, you can even program in C inside of an
Rcpp interface:

R> cppFunction("int foo(std::string txt) { Rprintf(\"Var is %s\\n\", txt.c_str()); return 0; }")
R> foo("A")
Var is A
[1] 0
R> 

Dirk



On 3 June 2014 at 19:06, Barry Rowlingson wrote:
| What does c_fun look like? Here's mine:
| 
| #include <stdio.h>
| #include <stdlib.h>
| void c_fun(){
|   printf("TMP is %s\n", getenv("TMP"));
|     }
| 
| and I then do this at the shell prompt:
| 
| R CMD SHLIB c_fun.c
| 
| and this at the R prompt:
| 
| dyn.load("c_fun.so")
| wrapper()
| 
| and I get:
| 
| > wrapper()
| [1] "A"
| TMP is A
| list()
| 
| Is that not what you want?
| 
| tldr; works for me.
| 
| 
| On Tue, Jun 3, 2014 at 5:55 PM, Bowen Meng <bowen.m04 at gmail.com> wrote:
| > wrapper <- function(){
| >   Sys.setenv(TMP="A")
| >   print(Sys.getenv("TMP"))
| >
| >   .C("c_fun")
| > }
| >
| >
| > As the example above, I hope to set an env var $TMP inside the R function
| > "wrapper", which affects the functionality of the C function call "c_fun".
| > Also the print line shows that $TMP is set to be "A", but the function call
| > of "c_fun" was not affected.
| >
| > Does anyone know why and how to correctly set the env var for subsequent
| > functions?
| >
| > Thanks,
| > BW
| >
| >         [[alternative HTML version deleted]]
| >
| > ______________________________________________
| > R-devel at r-project.org mailing list
| > https://stat.ethz.ch/mailman/listinfo/r-devel
| 
| ______________________________________________
| R-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From ravi.varadhan at jhu.edu  Tue Jun  3 21:18:08 2014
From: ravi.varadhan at jhu.edu (Ravi Varadhan)
Date: Tue, 3 Jun 2014 19:18:08 +0000
Subject: [Rd] A bug in princomp(), perhaps?
In-Reply-To: <loom.20140603T020140-313@post.gmane.org>
References: <2F9EA67EF9AE1C48A147CB41BE2E15C30E2D6CDC@DOM-EB-MAIL2.win.ad.jhu.edu>
	<5213E16E-54FC-46D2-A92E-BC2D44A338BD@gmail.com>
	<2F9EA67EF9AE1C48A147CB41BE2E15C30E2D7237@DOM-EB-MAIL2.win.ad.jhu.edu>
	<CAAHES9zWN3c4pdK8XcKLuKbq4kNV3Ohs6NCb0yo9dGM0+3sP4w@mail.gmail.com>
	<2F9EA67EF9AE1C48A147CB41BE2E15C30E2D734D@DOM-EB-MAIL2.win.ad.jhu.edu>
	<CAAHES9xiwaSv3FQ1HYY3NPfCsdqGN+fvqDzvp6vxtArERXA4Jw@mail.gmail.com>
	<loom.20140531T202439-171@post.gmane.org>
	<loom.20140603T020140-313@post.gmane.org>
Message-ID: <2F9EA67EF9AE1C48A147CB41BE2E15C30E2D7C58@DOM-EB-MAIL2.win.ad.jhu.edu>

Thank you, Ben.  

Best,
Ravi

-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of Ben Bolker
Sent: Monday, June 02, 2014 8:07 PM
To: r-devel at stat.math.ethz.ch
Subject: Re: [Rd] A bug in princomp(), perhaps?

Ben Bolker <bbolker <at> gmail.com> writes:

> 
> FWIW this seems to be a FAQ:
> 
> https://stat.ethz.ch/pipermail/r-devel/2003-July/027018.html
> 
> http://thr3ads.net/r-devel/2013/01/
>    2171832-Re-na.omit-option-in-prcomp-formula-interface-only
> 
> http://r.789695.n4.nabble.com/
>   na-omit-option-in-prcomp-formula-interface-only-td4373533.html
> 
> And two StackOverflow questions (the latter's a bit tangential):
> 
> http://stackoverflow.com/questions/12078291/
>    r-function-prcomp-fails-with-nas-values-even-though-nas-are-allowed
> 
> http://stackoverflow.com/questions/23421438/
>   what-was-wrong-with-running-princomp-in-r/23446938#23446938
> 
>   (Sorry for broken URLs and random assortment of mailing list
> aggregators.)
> 
>   I appreciate Gavin's points that implementing this stuff for 
> princomp.default is difficult/problematic, but I second Ravi's request 
> for a little  more clarification in the help  text; it's quite easy to 
> miss the fact that 'na.action' is defined for princomp.formula but not 
> for princomp.default.  Perhaps just "Note that setting na.action works 
> for princomp.formula, but not for princomp.default" (under the 
> "na.action" argument description).

Putting my effort where my mouth is: I wonder if there is any chance that this patch against the current SVN would be accepted ... ??

Index: princomp.Rd
===================================================================
--- princomp.Rd	(revision 65832)
+++ princomp.Rd	(working copy)
@@ -37,7 +37,8 @@
     when the data contain \code{NA}s.  The default is set by
     the \code{na.action} setting of \code{\link{options}}, and is
     \code{\link{na.fail}} if that is unset. The \sQuote{factory-fresh}
-    default is \code{\link{na.omit}}.}
+    default is \code{\link{na.omit}}.  (This argument applies \emph{only}
+    to the formula method.)}
   \item{x}{a numeric matrix or data frame which provides the data for the
     principal components analysis.}
   \item{cor}{a logical value indicating whether the calculation should
Index: prcomp.Rd
===================================================================
--- prcomp.Rd	(revision 65832)
+++ prcomp.Rd	(working copy)
@@ -40,7 +40,8 @@
     when the data contain \code{NA}s.  The default is set by
     the \code{na.action} setting of \code{\link{options}}, and is
     \code{\link{na.fail}} if that is unset. The \sQuote{factory-fresh}
-    default is \code{\link{na.omit}}.}
+    default is \code{\link{na.omit}}. (This argument applies \emph{only}
+    to the formula method.)}
   \item{\dots}{arguments passed to or from other methods. If \code{x} is
     a formula one might specify \code{scale.} or \code{tol}.}
   \item{x}{a numeric or complex matrix (or data frame) which provides

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From ravi.varadhan at jhu.edu  Tue Jun  3 21:20:26 2014
From: ravi.varadhan at jhu.edu (Ravi Varadhan)
Date: Tue, 3 Jun 2014 19:20:26 +0000
Subject: [Rd] A bug in princomp(), perhaps?
In-Reply-To: <loom.20140603T020140-313@post.gmane.org>
References: <2F9EA67EF9AE1C48A147CB41BE2E15C30E2D6CDC@DOM-EB-MAIL2.win.ad.jhu.edu>
	<5213E16E-54FC-46D2-A92E-BC2D44A338BD@gmail.com>
	<2F9EA67EF9AE1C48A147CB41BE2E15C30E2D7237@DOM-EB-MAIL2.win.ad.jhu.edu>
	<CAAHES9zWN3c4pdK8XcKLuKbq4kNV3Ohs6NCb0yo9dGM0+3sP4w@mail.gmail.com>
	<2F9EA67EF9AE1C48A147CB41BE2E15C30E2D734D@DOM-EB-MAIL2.win.ad.jhu.edu>
	<CAAHES9xiwaSv3FQ1HYY3NPfCsdqGN+fvqDzvp6vxtArERXA4Jw@mail.gmail.com>
	<loom.20140531T202439-171@post.gmane.org>
	<loom.20140603T020140-313@post.gmane.org>
Message-ID: <2F9EA67EF9AE1C48A147CB41BE2E15C30E2D7C63@DOM-EB-MAIL2.win.ad.jhu.edu>

Perhaps, adding Gavin's work around for a dataframe with missing values might also be useful to the documentation:

princomp(na.omit(x))

Thanks,
Ravi

-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of Ben Bolker
Sent: Monday, June 02, 2014 8:07 PM
To: r-devel at stat.math.ethz.ch
Subject: Re: [Rd] A bug in princomp(), perhaps?

Ben Bolker <bbolker <at> gmail.com> writes:

> 
> FWIW this seems to be a FAQ:
> 
> https://stat.ethz.ch/pipermail/r-devel/2003-July/027018.html
> 
> http://thr3ads.net/r-devel/2013/01/
>    2171832-Re-na.omit-option-in-prcomp-formula-interface-only
> 
> http://r.789695.n4.nabble.com/
>   na-omit-option-in-prcomp-formula-interface-only-td4373533.html
> 
> And two StackOverflow questions (the latter's a bit tangential):
> 
> http://stackoverflow.com/questions/12078291/
>    r-function-prcomp-fails-with-nas-values-even-though-nas-are-allowed
> 
> http://stackoverflow.com/questions/23421438/
>   what-was-wrong-with-running-princomp-in-r/23446938#23446938
> 
>   (Sorry for broken URLs and random assortment of mailing list
> aggregators.)
> 
>   I appreciate Gavin's points that implementing this stuff for 
> princomp.default is difficult/problematic, but I second Ravi's request 
> for a little  more clarification in the help  text; it's quite easy to 
> miss the fact that 'na.action' is defined for princomp.formula but not 
> for princomp.default.  Perhaps just "Note that setting na.action works 
> for princomp.formula, but not for princomp.default" (under the 
> "na.action" argument description).

Putting my effort where my mouth is: I wonder if there is any chance that this patch against the current SVN would be accepted ... ??

Index: princomp.Rd
===================================================================
--- princomp.Rd	(revision 65832)
+++ princomp.Rd	(working copy)
@@ -37,7 +37,8 @@
     when the data contain \code{NA}s.  The default is set by
     the \code{na.action} setting of \code{\link{options}}, and is
     \code{\link{na.fail}} if that is unset. The \sQuote{factory-fresh}
-    default is \code{\link{na.omit}}.}
+    default is \code{\link{na.omit}}.  (This argument applies \emph{only}
+    to the formula method.)}
   \item{x}{a numeric matrix or data frame which provides the data for the
     principal components analysis.}
   \item{cor}{a logical value indicating whether the calculation should
Index: prcomp.Rd
===================================================================
--- prcomp.Rd	(revision 65832)
+++ prcomp.Rd	(working copy)
@@ -40,7 +40,8 @@
     when the data contain \code{NA}s.  The default is set by
     the \code{na.action} setting of \code{\link{options}}, and is
     \code{\link{na.fail}} if that is unset. The \sQuote{factory-fresh}
-    default is \code{\link{na.omit}}.}
+    default is \code{\link{na.omit}}. (This argument applies \emph{only}
+    to the formula method.)}
   \item{\dots}{arguments passed to or from other methods. If \code{x} is
     a formula one might specify \code{scale.} or \code{tol}.}
   \item{x}{a numeric or complex matrix (or data frame) which provides

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From Will.Landau at gmail.com  Tue Jun  3 21:44:12 2014
From: Will.Landau at gmail.com (landau)
Date: Tue, 3 Jun 2014 12:44:12 -0700 (PDT)
Subject: [Rd] cuda-memcheck to debug CUDA-enabled R packages
Message-ID: <1401824622278-4691668.post@n4.nabble.com>

I'm building a simple R extension around a CUDA-enabled dynamic library, and
I want to run the whole package with cuda-memcheck for debugging purposes. I
can run it just fine with Valgrind:

$ R --no-save -d valgrind < test.R

However, if I try the same thing with cuda-memcheck,

$ R --no-save -d cuda-memcheck < test.R

I get:

*** Further command line arguments ('--no-save ') disregarded
*** (maybe use 'run --no-save ' from *inside* cuda-memcheck)

========= CUDA-MEMCHECK
Fatal error: you must specify '--save', '--no-save' or '--vanilla'
========= No CUDA-MEMCHECK results found

So cuda-memcheck is eating up an argument that's supposed to go to R. What
can I do about this? 



--
View this message in context: http://r.789695.n4.nabble.com/cuda-memcheck-to-debug-CUDA-enabled-R-packages-tp4691668.html
Sent from the R devel mailing list archive at Nabble.com.


From toth.denes at ttk.mta.hu  Tue Jun  3 22:56:11 2014
From: toth.denes at ttk.mta.hu (=?UTF-8?B?RMOpbmVzIFTDs3Ro?=)
Date: Tue, 03 Jun 2014 22:56:11 +0200
Subject: [Rd] memory allocation if multiple names point to the same
	object
In-Reply-To: <CAOQ5NyfjOHG29yLE54PVFk_htgPMWw9vZ4RC8=JVPyVzmRinYA@mail.gmail.com>
References: <53779F9A.1040809@oracle.com>	<414982A9-728F-4018-9D96-C3005B57BC05@gmail.com>	<5377F03E.2020702@oracle.com>	<538CA6F8.5060006@ttk.mta.hu>
	<CAOQ5NyfjOHG29yLE54PVFk_htgPMWw9vZ4RC8=JVPyVzmRinYA@mail.gmail.com>
Message-ID: <538E366B.1080707@ttk.mta.hu>

Dear Michael,

thank you for the enlightenment.  Just for the records, here is the 
solution that Michael referred to: 
http://developer.r-project.org/Refcnt.html

Best,
   Denes


On 06/03/2014 03:57 PM, Michael Lawrence wrote:
> This is because R keeps track of the names of an object, until there are
> 2 names. Thus, once it reaches 2, it can no longer decrement the named
> count. In this example, 'a' reaches 2 names ('a' and 'b'), thus R does
> not know that 'a' only has one name at the end.
>
> Luke has added reference counting to R 3.1 to get around these types of
> problems. If you want to try it out, make the necessary change in
> Rinternals.h and recompile. With reference counting, R knows that 'a'
> only has one reference and avoids the copy.
>
>  > a <- seq.int <http://seq.int>(10)
>  > a[1:4] <- 4:1
>  > b <- a
>  > .Internal(inspect(a))
> @2b71608 13 INTSXP g0c4 [REF(2)] (len=10, tl=0) 4,3,2,1,5,...
>  > b[1:4] <- 1:4
>  > .Internal(inspect(b))
> @2b715a0 13 INTSXP g0c4 [REF(1)] (len=10, tl=0) 1,2,3,4,5,...
>  > .Internal(inspect(a))
> @2b71608 13 INTSXP g0c4 [REF(1)] (len=10, tl=0) 4,3,2,1,5,...
>  > a[1:4] <- 1:4
>  > .Internal(inspect(a))
> @2b71608 13 INTSXP g0c4 [REF(1)] (len=10, tl=0) 1,2,3,4,5,...
>
>
>
> On Mon, Jun 2, 2014 at 9:31 AM, D?nes T?th <toth.denes at ttk.mta.hu
> <mailto:toth.denes at ttk.mta.hu>> wrote:
>
>
>     Hi,
>
>     Please consider the following code:
>
>     a <- seq.int <http://seq.int>(10)  # create a
>     tracemem(a)
>     a[1:4] <- 4:1   # no internal copy
>     b <- a          # no internal copy
>     b[1:4] <- 1:4   # copy, b is not a any more
>     a[1:4] <- 1:4   # copy, but why?
>
>     With results:
>      > a <- seq.int <http://seq.int>(10)
>      > tracemem(a)
>     [1] "<0x1792bc0>"
>      > a[1:4] <- 4:1
>      > b <- a
>      > b[1:4] <- 1:4
>     tracemem[0x1792bc0 -> 0x1792b58]:
>      > a[1:4] <- 1:4
>     tracemem[0x1792bc0 -> 0x1792af0]:
>
>
>     ##
>
>     Could you provide a brief explanation or point me to a source why R
>     needs a copy in the final step?
>
>
>     Best,
>        Denes
>
>
>
>      > sessionInfo()
>     R version 3.1.0 (2014-04-10)
>     Platform: x86_64-pc-linux-gnu (64-bit)
>
>     locale:
>       [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>       [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>       [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>       [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>       [9] LC_ADDRESS=C               LC_TELEPHONE=C
>     [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
>     attached base packages:
>     [1] stats     graphics  grDevices utils     datasets  methods   base
>
>     ________________________________________________
>     R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>     https://stat.ethz.ch/mailman/__listinfo/r-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-devel>
>
>


From kristian at buchardt.net  Wed Jun  4 11:53:41 2014
From: kristian at buchardt.net (Kristian Buchardt)
Date: Wed, 04 Jun 2014 11:53:41 +0200
Subject: [Rd] Lapack / dgesvx function declaration
Message-ID: <538EECA5.9070602@buchardt.net>

Hello there

I'm writing some c-code to solve a numerically tough problem for me in 
R. Looking in Lapack.h, i find the following line

F77_NAME(dgesvx)(const int* fact, const char* trans, const int* n,

and I believe that "fact" should've been char instead of int, i.e.

F77_NAME(dgesvx)(const char* fact, const char* trans, const int* n,


My reasoning: In the R-source:
src/modules/lapack/dlapack.f

I find the following lines:

*       SUBROUTINE DGESVX( FACT, TRANS, N, NRHS, A, LDA, AF, LDAF, IPIV,
*                          EQUED, R, C, B, LDB, X, LDX, RCOND, FERR, BERR,
*                          WORK, IWORK, INFO )
*
*       .. Scalar Arguments ..
*       CHARACTER          EQUED, FACT, TRANS
*       INTEGER            INFO, LDA, LDAF, LDB, LDX, N, NRHS
*       DOUBLE PRECISION   RCOND

where FACT is specified to a char.


Might this simply be an error in Lapack.h? And can I just edit my 
Lapack.h and compile?

-- 
Best Regards
Kristian Buchardt

Ph.d.-student
http://math.ku.dk/~buchardt

Department of Mathematical Sciences, University of Copenhagen
Universitetsparken 5, DK-2100 Copenhagen O

PFA Pension
Sundkrogsgade 4, DK-2100 Copenhagen O


From xie at yihui.name  Wed Jun  4 20:18:19 2014
From: xie at yihui.name (Yihui Xie)
Date: Wed, 4 Jun 2014 13:18:19 -0500
Subject: [Rd] Package keyval Error: noupquote undefined
Message-ID: <CANROs4d9he16mCBTXaineQoU48V2x4ZZt41BuY7hUDmbm_Li-A@mail.gmail.com>

Hi,

Due to a change in Rd.sty a few days ago
(https://github.com/wch/r-source/commit/620eb9a#diff-3bf3d821c6faae50cd6ec931f6f63296L272),
the default installation of TeXLive 2009 or 2012 no longer works when
building Rd to PDF. The error log is like this:

===============
Converting Rd files to LaTeX .....
Creating pdf output from LaTeX ...
Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
  Running 'texi2dvi' on 'Rd2.tex' failed.
LaTeX errors:
! Package keyval Error: noupquote undefined.

See the keyval package documentation for explanation.
Type  H <return>  for immediate help.
 ...
! Emergency stop.
 ...

l.37 \ProcessOptions*

!  ==> Fatal error occurred, no output PDF file produced!
Output:
This is pdfTeX, Version 3.1415926-1.40.10 (TeX Live 2009/Debian)
entering extended mode
LaTeX2e <2009/09/24>
Babel <v3.8l> and hyphenation patterns for english, usenglishmax, dumylang, noh
yphenation, loaded.
(./Rd2.tex (/usr/share/texmf-texlive/tex/latex/base/book.cls
Document Class: book 2007/10/19 v1.4h Standard LaTeX document class
(/usr/share/texmf-texlive/tex/latex/base/bk10.clo))
(/home/yihui/repos/r-source/share/texmf/tex/latex/Rd.sty
(/usr/share/texmf-texlive/tex/latex/base/ifthen.sty)
(/usr/share/texmf-texlive/tex/latex/tools/longtable.sty)
(/usr/share/texmf-texlive/tex/latex/tools/bm.sty)
(/usr/share/texmf-texlive/tex/latex/base/alltt.sty)
(/usr/share/texmf-texlive/tex/latex/tools/verbatim.sty)
(/usr/share/texmf-texlive/tex/latex/ltxmisc/url.sty)
(/usr/share/texmf-texlive/tex/latex/base/textcomp.sty
(/usr/share/texmf-texlive/tex/latex/base/ts1enc.def))
(/usr/share/texmf-texlive/tex/latex/base/fontenc.sty
(/usr/share/texmf-texlive/tex/latex/base/t1enc.def))
(/usr/share/texmf-texlive/tex/latex/psnfss/times.sty)
(/usr/share/texmf-texlive/tex/latex/inconsolata/inconsolata.sty
(/usr/share/texmf-texlive/tex/latex/graphics/keyval.sty)

! Package keyval Error: noupquote undefined.

See the keyval package documentation for explanation.
Type  H <return>  for immediate help.
 ...

l.37 \ProcessOptions*

?
! Emergency stop.
 ...

l.37 \ProcessOptions*

!  ==> Fatal error occurred, no output PDF file produced!
Transcript written on Rd2.log.
Error in running tools::texi2pdf()
===============

Here is my sessionInfo():

> sessionInfo()
R Under development (unstable) (2014-06-04 r65854)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

$ pdflatex --version
pdfTeX 3.1415926-1.40.10-2.2 (TeX Live 2009/Debian)
kpathsea version 5.0.0
Copyright 2009 Peter Breitenlohner (eTeX)/Han The Thanh (pdfTeX).

The problem is reproducible with TeXLive 2012 and Ubuntu 12.04. I went
through the R-admin manual, and I did not seem to find a requirement
of the TeXLive version there.

Here is a minimal foo.Rd that shows the problem when running `Rd CMD
Rd2pdf foo.Rd`:

\name{foo}
\alias{foo}
\title{Foo}
\description{
Bar.
}

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Web: http://yihui.name


From murdoch.duncan at gmail.com  Thu Jun  5 03:33:39 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 05 Jun 2014 10:33:39 +0900
Subject: [Rd] rgl pinch and zoom under Windows 8.1
In-Reply-To: <CADUbQ5gXpX5RBwyXYuVCSMAZwPti1EVFpSy7iMmPDSd2xH472g@mail.gmail.com>
References: <CADUbQ5gXpX5RBwyXYuVCSMAZwPti1EVFpSy7iMmPDSd2xH472g@mail.gmail.com>
Message-ID: <538FC8F3.50808@gmail.com>

On 03/06/2014, 2:02 PM, Dominick Samperi wrote:
> Under Windows 8.1 with a touch screen, the pinch gesture
> causes an rgl plot to expand (zoom in) instead of contract, the opposite of
> what I would expect. When using a map app, for example, the pinch
> gesture causes the map to contract (zoom out).
>

rgl has no support for pinch gestures, so your OS is translating the 
message into something else, which rgl is acting on.  I'd guess it's the 
scroll wheel.

So I guess you should see if you can configure it to translate to the 
opposite direction of rotation.

Duncan Murdoch


From murdoch.duncan at gmail.com  Thu Jun  5 03:40:36 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 05 Jun 2014 10:40:36 +0900
Subject: [Rd] R CMD check for the R code from vignettes
In-Reply-To: <CANROs4dWXzYuig3npku5+YOSkchTpZJUn0e2=1pygMa3JOZLoA@mail.gmail.com>
References: <CANROs4dyoXEUEzouGTsL9sHCMM8RcjYWw9584SUAEYfGntPrFg@mail.gmail.com>	<CADwqtCN2XixFy0H43BeFMU7R_p+sQCaOHBU5W6tXn7Ng7pP1pA@mail.gmail.com>	<CANROs4c=x7BNDWJ7ObS5pB36+NBGzVmTmN7-94t8T+dowcEA5A@mail.gmail.com>	<538A63C6.5030201@fhcrc.org>	<CANROs4cM=q0isYqUO6eg2vWjT2HieUy996u7HtS8_deydFa-8g@mail.gmail.com>	<CADwqtCNQEAz==L4fSomQt+Ayw6wSo61-uM=xN_9K26K1XRoFwQ@mail.gmail.com>	<CANROs4cuHbSTeNXgBuWFAhpHGMVdGLsAs5gFH+8s=HCq8NYiwQ@mail.gmail.com>	<CAN_1p9wgx57ZRAYz56m+-51_UMYTtm97-JmpYSKYtHSobLkOzQ@mail.gmail.com>	<CADwqtCP=PJR=hDx9KSjs4HeSaqdgpdLZR-EpS0a5A2DPcW_7=Q@mail.gmail.com>	<538C960B.2040509@gmail.com>	<CANROs4fyMwi9=+h=78sXxcp4L8oH=WFSP_fighbzT8h_qa0b8Q@mail.gmail.com>	<538CB807.7050100@gmail.com>	<CAAHES9wXcvfzrCTAtz0XrOVeYzijno32WZ8seOh4LO+0ZzZd_A@mail.gmail.com>	<538CF3B7.2060007@gmail.com>	<CAAHES9x3EnvZ=mLWd624jUYxV_uEbd1QiZmoL-OhXrC4TGAnqA@mail.gmail.com>	<538D3082.9050209@gmail.com>
	<CANROs4dWXzYuig3npku5+YOSkchTpZJUn0e2=1pygMa3JOZLoA@mail.gmail.com>
Message-ID: <538FCA94.9010105@gmail.com>

On 03/06/2014, 2:04 PM, Yihui Xie wrote:
> As I pointed out, \Sexpr{} is not the only potential problem. Besides,
> side effects are not necessarily evil in all cases.
>
> Since I have been described as "nitpicky", it is time for me to quit
> the discussion now

In that case I'll also consider the issue closed.

Duncan Murdoch


(adjectives on personal pronouns instead of nouns
> in a discussion is a sign for me to quit in my eyes). I'm fine with
> optional tangling, and I believe one should not expect to reproduce
> results generated by weave using a different approach, namely
> tangle+source. Some people believe tangling should mandatory, and
> tangle must completely match weave in terms of code evaluation. I'm
> fine with that, too. I'll be happy to see improvement in tangle
> functions, as well as education on good/bad side effects. I have no
> intention to win the Nobel Peace Prize, so I'm not going to make
> everyone agree with each other. You hold your opinions, and I hold
> mine. Once again, thanks everyone for your perspectives!
>
> Regards,
> Yihui
> --
> Yihui Xie <xieyihui at gmail.com>
> Web: http://yihui.name
>
>
> On Mon, Jun 2, 2014 at 9:18 PM, Kevin Coombes <kevin.r.coombes at gmail.com> wrote:
>> "Doc, it hurts when I do this."
>> "So, don't do that."
>>
>> If no one in R Core does anything about this issue (in terms of changing
>> Sweave or Stangle), then the solution still remains very simple.  Authors of
>> vignettes should avoid using anything in \Sexpr{} that has a side effect. As
>> long as they do that, the code will tangle correctly and produce the same
>> result as Sweave.
>>
>> R CMD check already detects other things which may or may not be outright
>> errors but are viewed as bad practice. I think it is bad practice to put
>> code with side effects into an Sexpr. So, I don't do that. If I did do that
>> accidentally, I really wouldn't mind if R CMD check warned me abut it.
>>
>>    -- Kevin
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ledelato at gmail.com  Thu Jun  5 19:57:47 2014
From: ledelato at gmail.com (Luis de la Torre)
Date: Thu, 5 Jun 2014 12:57:47 -0500
Subject: [Rd] Building source package in Windows, error in .doLoadActions()
Message-ID: <CAH77tP8x1y4r+0yj1ky3rutkeYSU+bQNuYkj3bvwFVvEeyMiEg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140605/a83e931c/attachment.pl>

From ledelato at gmail.com  Thu Jun  5 22:23:02 2014
From: ledelato at gmail.com (Luis de la Torre)
Date: Thu, 5 Jun 2014 15:23:02 -0500
Subject: [Rd] Building source package in Windows, error in .doLoadActions()
Message-ID: <CAH77tP8SvvAJbbCX7DCykDjF70jRQ9oojoRAPjdn=0vqkG43RQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140605/5fb4c1e9/attachment.pl>

From Will.Landau at gmail.com  Thu Jun  5 22:45:29 2014
From: Will.Landau at gmail.com (landau)
Date: Thu, 5 Jun 2014 13:45:29 -0700 (PDT)
Subject: [Rd] debugging a CUDA-enabled R package with cuda-memcheck
In-Reply-To: <1401824710890-4691669.post@n4.nabble.com>
References: <1401824710890-4691669.post@n4.nabble.com>
Message-ID: <1402001129138-4691765.post@n4.nabble.com>

Edit:

I solved this problem by putting 

  R CMD BATCH --no-save < test.R

into a script (say, run.sh), and then running

  $ cuda-memcheck ./run.sh





--
View this message in context: http://r.789695.n4.nabble.com/debugging-a-CUDA-enabled-R-package-with-cuda-memcheck-tp4691669p4691765.html
Sent from the R devel mailing list archive at Nabble.com.


From Will.Landau at gmail.com  Thu Jun  5 22:46:16 2014
From: Will.Landau at gmail.com (landau)
Date: Thu, 5 Jun 2014 13:46:16 -0700 (PDT)
Subject: [Rd] cuda-memcheck to debug CUDA-enabled R packages
In-Reply-To: <1401824622278-4691668.post@n4.nabble.com>
References: <1401824622278-4691668.post@n4.nabble.com>
Message-ID: <1402001176976-4691766.post@n4.nabble.com>

Edit:

I solved this problem by putting 

  R CMD BATCH --no-save < test.R

into a script (say, run.sh), and then running

  $ cuda-memcheck ./run.sh



--
View this message in context: http://r.789695.n4.nabble.com/cuda-memcheck-to-debug-CUDA-enabled-R-packages-tp4691668p4691766.html
Sent from the R devel mailing list archive at Nabble.com.


From Will.Landau at gmail.com  Thu Jun  5 22:53:07 2014
From: Will.Landau at gmail.com (landau)
Date: Thu, 5 Jun 2014 13:53:07 -0700 (PDT)
Subject: [Rd] Note: information on .o files is not available
Message-ID: <1402001587036-4691767.post@n4.nabble.com>

I'm developing an R package with compiled code in CUDA C/C++. I ran R CMD
check on it, and there are no errors or warnings. However, there is a note
that reads, "Note: information on .o files is not available". What does this
mean? I can't find any clues on the web, in the documentation, or in the
source of the devtools package.

Here is the full output of my R CMD check.

* using log directory ?/home/landau/heterosis.Rcheck?
* using R version 3.1.0 (2014-04-10)
* using platform: x86_64-unknown-linux-gnu (64-bit)
* using session charset: UTF-8
* checking for file ?heterosis/DESCRIPTION? ... OK
* this is package ?heterosis? version ?0.0?
* checking package namespace information ... OK
* checking package dependencies ... OK
* checking if this is a source package ... OK
* checking if there is a namespace ... OK
* checking for executable files ... OK
* checking for hidden files and directories ... OK
* checking for portable file names ... OK
* checking for sufficient/correct file permissions ... OK
* checking whether package ?heterosis? can be installed ... OK
* checking installed package size ... OK
* checking package directory ... OK
* checking DESCRIPTION meta-information ... OK
* checking top-level files ... OK
* checking for left-over files ... OK
* checking index information ... OK
* checking package subdirectories ... OK
* checking R files for non-ASCII characters ... OK
* checking R files for syntax errors ... OK
* checking whether the package can be loaded ... OK
* checking whether the package can be loaded with stated dependencies ... OK
* checking whether the package can be unloaded cleanly ... OK
* checking whether the namespace can be loaded with stated dependencies ...
OK
* checking whether the namespace can be unloaded cleanly ... OK
* checking loading without being on the library search path ... OK
* checking dependencies in R code ... OK
* checking S3 generic/method consistency ... OK
* checking replacement functions ... OK
* checking foreign function calls ... OK
* checking R code for possible problems ... OK
* checking Rd files ... OK
* checking Rd metadata ... OK
* checking Rd cross-references ... OK
* checking for missing documentation entries ... OK
* checking for code/documentation mismatches ... OK
* checking Rd \usage sections ... OK
* checking Rd contents ... OK
* checking for unstated dependencies in examples ... OK
* checking contents of ?data? directory ... OK
* checking data for non-ASCII characters ... OK
* checking data for ASCII and uncompressed saves ... OK
* checking line endings in C/C++/Fortran sources/headers ... OK
* checking line endings in Makefiles ... OK
* checking for portable use of $(BLAS_LIBS) and $(LAPACK_LIBS) ... OK
* checking compiled code ... NOTE
Note: information on .o files is not available
* checking installed files from ?inst/doc? ... OK
* checking examples ... NONE
* checking PDF version of manual ... OK

NOTE: There was 1 note.
See
  ?/home/landau/heterosis.Rcheck/00check.log?
for details.





--
View this message in context: http://r.789695.n4.nabble.com/Note-information-on-o-files-is-not-available-tp4691767.html
Sent from the R devel mailing list archive at Nabble.com.


From ligges at statistik.tu-dortmund.de  Thu Jun  5 23:09:30 2014
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Thu, 05 Jun 2014 23:09:30 +0200
Subject: [Rd] Building source package in Windows,
	error in .doLoadActions()
In-Reply-To: <CAH77tP8x1y4r+0yj1ky3rutkeYSU+bQNuYkj3bvwFVvEeyMiEg@mail.gmail.com>
References: <CAH77tP8x1y4r+0yj1ky3rutkeYSU+bQNuYkj3bvwFVvEeyMiEg@mail.gmail.com>
Message-ID: <5390DC8A.4010706@statistik.tu-dortmund.de>



On 05.06.2014 19:57, Luis de la Torre wrote:
> I'm trying to build the source package KNITRO in Windows and getting an
> error when the package is loaded. Maybe there is something I'm missing in
> order to build a package in Windows? Note that I have successfully built
> the package in Linux.
>
> I'm using R 3.1.0; Rcpp 0.11.1 installed from CRAN; Cygwin with g++ 4.8.3.

cygwin is an unsuported platform, please use the Rtools collection that 
includes a version of gcc that works out of the box.

Best,
Uwe Ligges



> Details about the problem are below. I can provide more details to
> reproduce the error, but it would require a license of KNITRO.
>
> This package is on Github at https://github.com/romainfrancois/KNITRO.
>
> In the package, I modified Makevars, linking to library libomp5md instead
> of libomp5, and built the package with R CMD build KNITRO.
>
> When I install with:
>
>      R CMD INSTALL --build --no-multiarch
>
> it to "testing if installed package can be loaded" and gives the following
> error:
>
> Error in .doLoadActions(where, attach) :
>    error in load action .__A__.1 for package KNITRO: loadModule(module =
> "knitro", what = TRUE, env = ns, loadNow = TRUE): Unable to load module
> "knitro": Failed to initialize module pointer: Error in
> FUN("_rcpp_module_boot_knitro"[[1L]], ...): no such symbol
> _rcpp_module_boot_knitro in package KNITRO
>
> Thank you,
>
> Luis de la Torre
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Fri Jun  6 11:37:14 2014
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 06 Jun 2014 10:37:14 +0100
Subject: [Rd] Lapack / dgesvx function declaration
In-Reply-To: <538EECA5.9070602@buchardt.net>
References: <538EECA5.9070602@buchardt.net>
Message-ID: <53918BCA.2030009@stats.ox.ac.uk>

On 04/06/2014 10:53, Kristian Buchardt wrote:
> Hello there
>
> I'm writing some c-code to solve a numerically tough problem for me in
> R. Looking in Lapack.h, i find the following line
>
> F77_NAME(dgesvx)(const int* fact, const char* trans, const int* n,
>
> and I believe that "fact" should've been char instead of int, i.e.
>
> F77_NAME(dgesvx)(const char* fact, const char* trans, const int* n,
>
>
> My reasoning: In the R-source:
> src/modules/lapack/dlapack.f
>
> I find the following lines:
>
> *       SUBROUTINE DGESVX( FACT, TRANS, N, NRHS, A, LDA, AF, LDAF, IPIV,
> *                          EQUED, R, C, B, LDB, X, LDX, RCOND, FERR, BERR,
> *                          WORK, IWORK, INFO )
> *
> *       .. Scalar Arguments ..
> *       CHARACTER          EQUED, FACT, TRANS
> *       INTEGER            INFO, LDA, LDAF, LDB, LDX, N, NRHS
> *       DOUBLE PRECISION   RCOND
>
> where FACT is specified to a char.
>
>
> Might this simply be an error in Lapack.h? And can I just edit my
> Lapack.h and compile?

It is an error.  Thanks for reporting it: we will change future R 
sources and you can edit locally as well.

Note though that passing FORTRAN CHARACTER variables from C is tricky 
(see 'Writing R Extensions') and for portable code we would recommend a 
FORTRAN wrapper which converted integer codes sent from C to FORTRAN 
CHARACTER variables.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From armgong at yahoo.com  Fri Jun  6 07:23:37 2014
From: armgong at yahoo.com (Yu Gong)
Date: Thu, 5 Jun 2014 22:23:37 -0700 (PDT)
Subject: [Rd] Rjulia: a package for R call Julia through Julia C API
Message-ID: <1402032217.18325.YahooMailNeo@web162905.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140605/889d2b12/attachment.pl>

From karl.forner at gmail.com  Fri Jun  6 13:30:35 2014
From: karl.forner at gmail.com (Karl Forner)
Date: Fri, 6 Jun 2014 13:30:35 +0200
Subject: [Rd] Rjulia: a package for R call Julia through Julia C API
In-Reply-To: <1402032217.18325.YahooMailNeo@web162905.mail.bf1.yahoo.com>
References: <1402032217.18325.YahooMailNeo@web162905.mail.bf1.yahoo.com>
Message-ID: <CAMd4_Ac08SvyUi6dR-QLc4Vaynj4fRWmpXxD7aXvm6MDzT_7_A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140606/b0e010c8/attachment.pl>

From armgong at yahoo.com  Fri Jun  6 13:42:56 2014
From: armgong at yahoo.com (Yu Gong)
Date: Fri, 6 Jun 2014 04:42:56 -0700 (PDT)
Subject: [Rd] Rjulia: a package for R call Julia through Julia C API
In-Reply-To: <CAMd4_Ac08SvyUi6dR-QLc4Vaynj4fRWmpXxD7aXvm6MDzT_7_A@mail.gmail.com>
References: <1402032217.18325.YahooMailNeo@web162905.mail.bf1.yahoo.com>
	<CAMd4_Ac08SvyUi6dR-QLc4Vaynj4fRWmpXxD7aXvm6MDzT_7_A@mail.gmail.com>
Message-ID: <1402054976.44885.YahooMailNeo@web162903.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140606/a1edc8be/attachment.pl>

From kasperdanielhansen at gmail.com  Sun Jun  8 03:33:30 2014
From: kasperdanielhansen at gmail.com (Kasper Daniel Hansen)
Date: Sat, 7 Jun 2014 21:33:30 -0400
Subject: [Rd] feature request: print.bibentry
Message-ID: <CAC2h7uuS_Yn=RO3saeCW0yR+W7Cvu=PePfLW48X5chgFtxRovA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140607/ad7a629c/attachment.pl>

From xie at yihui.name  Mon Jun  9 21:40:08 2014
From: xie at yihui.name (Yihui Xie)
Date: Mon, 9 Jun 2014 14:40:08 -0500
Subject: [Rd] Package keyval Error: noupquote undefined
In-Reply-To: <CANROs4d9he16mCBTXaineQoU48V2x4ZZt41BuY7hUDmbm_Li-A@mail.gmail.com>
References: <CANROs4d9he16mCBTXaineQoU48V2x4ZZt41BuY7hUDmbm_Li-A@mail.gmail.com>
Message-ID: <CANROs4fgVEzN7UqtMiuVixpEDJAU-LZYnz3Uy_7U2Zec=N06fA@mail.gmail.com>

Cc'ing to the author of this commit.

If TeXLive >= 2013 or a certain version of inconsolata/zi4 is
required, I think it should be documented somewhere, otherwise please
consider backward compatibility with TeXLive <= 2012. Personally I
prefer the latter, given how infrequently TeXLive is upgraded. It is
not unusual to see TeXLive that has been a few years older than its
latest version.

One possible solution is to test the version of inconsolata or zi4:

\@ifpackagelater{inconsolata}{2013/06/09}{
% use noupquote
}
{
% do not use
}

although I do not quite understand the rationale to write a homemade
version of upquote in Rd.sty...

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Web: http://yihui.name


On Wed, Jun 4, 2014 at 1:18 PM, Yihui Xie <xie at yihui.name> wrote:
> Hi,
>
> Due to a change in Rd.sty a few days ago
> (https://github.com/wch/r-source/commit/620eb9a#diff-3bf3d821c6faae50cd6ec931f6f63296L272),
> the default installation of TeXLive 2009 or 2012 no longer works when
> building Rd to PDF. The error log is like this:
>
> ===============
> Converting Rd files to LaTeX .....
> Creating pdf output from LaTeX ...
> Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
>   Running 'texi2dvi' on 'Rd2.tex' failed.
> LaTeX errors:
> ! Package keyval Error: noupquote undefined.
>
> See the keyval package documentation for explanation.
> Type  H <return>  for immediate help.
>  ...
> ! Emergency stop.
>  ...
>
> l.37 \ProcessOptions*
>
> !  ==> Fatal error occurred, no output PDF file produced!
> Output:
> This is pdfTeX, Version 3.1415926-1.40.10 (TeX Live 2009/Debian)
> entering extended mode
> LaTeX2e <2009/09/24>
> Babel <v3.8l> and hyphenation patterns for english, usenglishmax, dumylang, noh
> yphenation, loaded.
> (./Rd2.tex (/usr/share/texmf-texlive/tex/latex/base/book.cls
> Document Class: book 2007/10/19 v1.4h Standard LaTeX document class
> (/usr/share/texmf-texlive/tex/latex/base/bk10.clo))
> (/home/yihui/repos/r-source/share/texmf/tex/latex/Rd.sty
> (/usr/share/texmf-texlive/tex/latex/base/ifthen.sty)
> (/usr/share/texmf-texlive/tex/latex/tools/longtable.sty)
> (/usr/share/texmf-texlive/tex/latex/tools/bm.sty)
> (/usr/share/texmf-texlive/tex/latex/base/alltt.sty)
> (/usr/share/texmf-texlive/tex/latex/tools/verbatim.sty)
> (/usr/share/texmf-texlive/tex/latex/ltxmisc/url.sty)
> (/usr/share/texmf-texlive/tex/latex/base/textcomp.sty
> (/usr/share/texmf-texlive/tex/latex/base/ts1enc.def))
> (/usr/share/texmf-texlive/tex/latex/base/fontenc.sty
> (/usr/share/texmf-texlive/tex/latex/base/t1enc.def))
> (/usr/share/texmf-texlive/tex/latex/psnfss/times.sty)
> (/usr/share/texmf-texlive/tex/latex/inconsolata/inconsolata.sty
> (/usr/share/texmf-texlive/tex/latex/graphics/keyval.sty)
>
> ! Package keyval Error: noupquote undefined.
>
> See the keyval package documentation for explanation.
> Type  H <return>  for immediate help.
>  ...
>
> l.37 \ProcessOptions*
>
> ?
> ! Emergency stop.
>  ...
>
> l.37 \ProcessOptions*
>
> !  ==> Fatal error occurred, no output PDF file produced!
> Transcript written on Rd2.log.
> Error in running tools::texi2pdf()
> ===============
>
> Here is my sessionInfo():
>
>> sessionInfo()
> R Under development (unstable) (2014-06-04 r65854)
> Platform: x86_64-unknown-linux-gnu (64-bit)
>
> locale:
>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> $ pdflatex --version
> pdfTeX 3.1415926-1.40.10-2.2 (TeX Live 2009/Debian)
> kpathsea version 5.0.0
> Copyright 2009 Peter Breitenlohner (eTeX)/Han The Thanh (pdfTeX).
>
> The problem is reproducible with TeXLive 2012 and Ubuntu 12.04. I went
> through the R-admin manual, and I did not seem to find a requirement
> of the TeXLive version there.
>
> Here is a minimal foo.Rd that shows the problem when running `Rd CMD
> Rd2pdf foo.Rd`:
>
> \name{foo}
> \alias{foo}
> \title{Foo}
> \description{
> Bar.
> }
>
> Regards,
> Yihui
> --
> Yihui Xie <xieyihui at gmail.com>
> Web: http://yihui.name


From paul at stat.auckland.ac.nz  Mon Jun  9 22:10:52 2014
From: paul at stat.auckland.ac.nz (Paul Murrell)
Date: Tue, 10 Jun 2014 08:10:52 +1200
Subject: [Rd] Package keyval Error: noupquote undefined
In-Reply-To: <CANROs4fgVEzN7UqtMiuVixpEDJAU-LZYnz3Uy_7U2Zec=N06fA@mail.gmail.com>
References: <CANROs4d9he16mCBTXaineQoU48V2x4ZZt41BuY7hUDmbm_Li-A@mail.gmail.com>
	<CANROs4fgVEzN7UqtMiuVixpEDJAU-LZYnz3Uy_7U2Zec=N06fA@mail.gmail.com>
Message-ID: <539614CC.40306@stat.auckland.ac.nz>


I'm getting the same problem
(I'm on Ubuntu 12.04, TeXLive 2009 and likely to remain there for the 
next year or so)

Paul

On 06/10/14 07:40, Yihui Xie wrote:
> Cc'ing to the author of this commit.
>
> If TeXLive >= 2013 or a certain version of inconsolata/zi4 is
> required, I think it should be documented somewhere, otherwise please
> consider backward compatibility with TeXLive <= 2012. Personally I
> prefer the latter, given how infrequently TeXLive is upgraded. It is
> not unusual to see TeXLive that has been a few years older than its
> latest version.
>
> One possible solution is to test the version of inconsolata or zi4:
>
> \@ifpackagelater{inconsolata}{2013/06/09}{
> % use noupquote
> }
> {
> % do not use
> }
>
> although I do not quite understand the rationale to write a homemade
> version of upquote in Rd.sty...
>
> Regards,
> Yihui
> --
> Yihui Xie <xieyihui at gmail.com>
> Web: http://yihui.name
>
>
> On Wed, Jun 4, 2014 at 1:18 PM, Yihui Xie <xie at yihui.name> wrote:
>> Hi,
>>
>> Due to a change in Rd.sty a few days ago
>> (https://github.com/wch/r-source/commit/620eb9a#diff-3bf3d821c6faae50cd6ec931f6f63296L272),
>> the default installation of TeXLive 2009 or 2012 no longer works when
>> building Rd to PDF. The error log is like this:
>>
>> ===============
>> Converting Rd files to LaTeX .....
>> Creating pdf output from LaTeX ...
>> Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
>>    Running 'texi2dvi' on 'Rd2.tex' failed.
>> LaTeX errors:
>> ! Package keyval Error: noupquote undefined.
>>
>> See the keyval package documentation for explanation.
>> Type  H <return>  for immediate help.
>>   ...
>> ! Emergency stop.
>>   ...
>>
>> l.37 \ProcessOptions*
>>
>> !  ==> Fatal error occurred, no output PDF file produced!
>> Output:
>> This is pdfTeX, Version 3.1415926-1.40.10 (TeX Live 2009/Debian)
>> entering extended mode
>> LaTeX2e <2009/09/24>
>> Babel <v3.8l> and hyphenation patterns for english, usenglishmax, dumylang, noh
>> yphenation, loaded.
>> (./Rd2.tex (/usr/share/texmf-texlive/tex/latex/base/book.cls
>> Document Class: book 2007/10/19 v1.4h Standard LaTeX document class
>> (/usr/share/texmf-texlive/tex/latex/base/bk10.clo))
>> (/home/yihui/repos/r-source/share/texmf/tex/latex/Rd.sty
>> (/usr/share/texmf-texlive/tex/latex/base/ifthen.sty)
>> (/usr/share/texmf-texlive/tex/latex/tools/longtable.sty)
>> (/usr/share/texmf-texlive/tex/latex/tools/bm.sty)
>> (/usr/share/texmf-texlive/tex/latex/base/alltt.sty)
>> (/usr/share/texmf-texlive/tex/latex/tools/verbatim.sty)
>> (/usr/share/texmf-texlive/tex/latex/ltxmisc/url.sty)
>> (/usr/share/texmf-texlive/tex/latex/base/textcomp.sty
>> (/usr/share/texmf-texlive/tex/latex/base/ts1enc.def))
>> (/usr/share/texmf-texlive/tex/latex/base/fontenc.sty
>> (/usr/share/texmf-texlive/tex/latex/base/t1enc.def))
>> (/usr/share/texmf-texlive/tex/latex/psnfss/times.sty)
>> (/usr/share/texmf-texlive/tex/latex/inconsolata/inconsolata.sty
>> (/usr/share/texmf-texlive/tex/latex/graphics/keyval.sty)
>>
>> ! Package keyval Error: noupquote undefined.
>>
>> See the keyval package documentation for explanation.
>> Type  H <return>  for immediate help.
>>   ...
>>
>> l.37 \ProcessOptions*
>>
>> ?
>> ! Emergency stop.
>>   ...
>>
>> l.37 \ProcessOptions*
>>
>> !  ==> Fatal error occurred, no output PDF file produced!
>> Transcript written on Rd2.log.
>> Error in running tools::texi2pdf()
>> ===============
>>
>> Here is my sessionInfo():
>>
>>> sessionInfo()
>> R Under development (unstable) (2014-06-04 r65854)
>> Platform: x86_64-unknown-linux-gnu (64-bit)
>>
>> locale:
>>   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>>   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>   [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>>   [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> $ pdflatex --version
>> pdfTeX 3.1415926-1.40.10-2.2 (TeX Live 2009/Debian)
>> kpathsea version 5.0.0
>> Copyright 2009 Peter Breitenlohner (eTeX)/Han The Thanh (pdfTeX).
>>
>> The problem is reproducible with TeXLive 2012 and Ubuntu 12.04. I went
>> through the R-admin manual, and I did not seem to find a requirement
>> of the TeXLive version there.
>>
>> Here is a minimal foo.Rd that shows the problem when running `Rd CMD
>> Rd2pdf foo.Rd`:
>>
>> \name{foo}
>> \alias{foo}
>> \title{Foo}
>> \description{
>> Bar.
>> }
>>
>> Regards,
>> Yihui
>> --
>> Yihui Xie <xieyihui at gmail.com>
>> Web: http://yihui.name
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From peter.langfelder at gmail.com  Tue Jun 10 21:30:03 2014
From: peter.langfelder at gmail.com (Peter Langfelder)
Date: Tue, 10 Jun 2014 12:30:03 -0700
Subject: [Rd] Package impute on CRAN OSX Mavericks check machine
Message-ID: <CA+hbrhX+_swTLBsHBCGp+gmkXtMqcZjwUB=f4mZCKAj_1dwgbQ@mail.gmail.com>

Hello,

would it be possible to install the Bioconductor package impute on the
machine that checks and builds binary packages for OSX 10.9 Mavericks?

Thanks,

Peter


From simon.urbanek at r-project.org  Wed Jun 11 00:19:28 2014
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 10 Jun 2014 18:19:28 -0400
Subject: [Rd] Package impute on CRAN OSX Mavericks check machine
In-Reply-To: <CA+hbrhX+_swTLBsHBCGp+gmkXtMqcZjwUB=f4mZCKAj_1dwgbQ@mail.gmail.com>
References: <CA+hbrhX+_swTLBsHBCGp+gmkXtMqcZjwUB=f4mZCKAj_1dwgbQ@mail.gmail.com>
Message-ID: <AF3EA292-E753-4A43-BE6D-C0ADDC64C0B2@r-project.org>

On Jun 10, 2014, at 3:30 PM, Peter Langfelder <peter.langfelder at gmail.com> wrote:

> Hello,
> 
> would it be possible to install the Bioconductor package impute on the
> machine that checks and builds binary packages for OSX 10.9 Mavericks?
> 

Sure, done.

Cheers,
Simon


From spencer.graves at structuremonitoring.com  Wed Jun 11 07:02:53 2014
From: spencer.graves at structuremonitoring.com (Spencer Graves)
Date: Tue, 10 Jun 2014 22:02:53 -0700
Subject: [Rd] infelicity in dlnorm, plnorm
Message-ID: <5397E2FD.1010000@structuremonitoring.com>

In theory, dlnorm(x, ...) == dnorm(log(x), ...)/x, x>0.


Unfortunately, when sd=0, dlnorm and plnorm return NaN, while dnorm 
returns (if(x != mean)0 else Inf) and pnorm returns (if(x<mean)0 else 
1). [A numerical optimization, maxLik{maxLik}, reported the NaNs for me.]


help('dlnorm') says, "dlnorm is calculated from the definition (in 
?Details?). [pqr]lnorm are based on the relationship to the normal." 
This seems not completely accurate, because plnorm(2, 1, 0) returns NaN, 
while pnorm(log(2), 1, 0) returns 0.


Obviously, this is not very important. However, I felt a need to report it.


Thanks for all you do to make R the great product it is.


Spencer Graves


 > dlnorm(2, 1, 0)
[1] NaN
Warning message:
In dlnorm(2, 1, 0) : NaNs produced
 > dnorm(log(2), 1, 0)/2
[1] 0
 >
 > dlnorm(2, 1, 1)
[1] 0.1902978
 > dnorm(log(2), 1, 1)/2
[1] 0.1902978
 >
 > dlnorm(exp(1), 1, 0)
[1] NaN
Warning message:
In dlnorm(exp(1), 1, 0) : NaNs produced
 > dnorm(1, 1, 0)/exp(1)
[1] Inf
 >
 > sessionInfo()
R version 3.1.0 (2014-04-10)
Platform: i386-w64-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats graphics grDevices utils datasets methods base


From mmclean at stat.tamu.edu  Wed Jun 11 13:34:26 2014
From: mmclean at stat.tamu.edu (Mathew McLean)
Date: Wed, 11 Jun 2014 06:34:26 -0500
Subject: [Rd] R CMD check and DESCRIPTION file with Authors@R only
Message-ID: <CA+3KFoOKvcgL27Daw0SsZ-WZPUGQfvT90X6tniXhbv0ttYGuUQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140611/bbc78ab7/attachment.pl>

From plummerm at iarc.fr  Wed Jun 11 15:33:21 2014
From: plummerm at iarc.fr (Martyn Plummer)
Date: Wed, 11 Jun 2014 13:33:21 +0000
Subject: [Rd] R CMD check and DESCRIPTION file with Authors@R only
In-Reply-To: <CA+3KFoOKvcgL27Daw0SsZ-WZPUGQfvT90X6tniXhbv0ttYGuUQ@mail.gmail.com>
References: <CA+3KFoOKvcgL27Daw0SsZ-WZPUGQfvT90X6tniXhbv0ttYGuUQ@mail.gmail.com>
Message-ID: <1402493601.17749.16.camel@braque.iarc.fr>

You need to run "R CMD build" on your package, then run "R CMD check" on
the resulting tarball, as recommended in section 1.3.1 of the "Writing R
Extensions" manual.

The tarball will contain a version of the DESCRIPTION file with Author
and Maintainer fields built from the Authors at R field.

Martyn

On Wed, 2014-06-11 at 06:34 -0500, Mathew McLean wrote:
> Section 1.1 of R-exts mentions that the Maintainer and Author fields can be
> omitted from the DESCRIPTION file if Authors at R is supplied.  However, R CMD
> check does not seem to like this.
> 
> package.skeleton("foo")
> desc <- readLines("foo/DESCRIPTION")
> desc[6] <- "Authors at R: person('Mathew', 'McLean', email = 'name at example.com',
> role = c('aut', 'cre'))"
> desc <- desc[-7]
> writeLines(desc, "foo/DESCRIPTION")
> system2("R", args = c("CMD", "check", "foo"))
> * using log directory ?/home/grad/mmclean/foo.Rcheck?
> * using R version 3.0.3 (2014-03-06)
> * using platform: x86_64-unknown-linux-gnu (64-bit)
> * using session charset: UTF-8
> * checking for file ?foo/DESCRIPTION? ... ERROR
> Required fields missing or empty:
>   ?Author? ?Maintainer?
> 
> sessionInfo()
> R version 3.0.3 (2014-03-06)
> Platform: x86_64-unknown-linux-gnu (64-bit)
> 
> locale:
>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> 
> ?This also happens for R Under development (unstable) (2014-04-10 r65396)
> Platform: x86_64-w64-mingw32/x64 (64-bit)?
> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From joran.elias at gmail.com  Wed Jun 11 20:59:50 2014
From: joran.elias at gmail.com (Joran Elias)
Date: Wed, 11 Jun 2014 12:59:50 -0600
Subject: [Rd] Should documentation for box() be more clear about bty?
Message-ID: <CALdbFF6_BR0Ufno2nxxH8xVuDJDX07SJ+_agavWBh42CZga8UA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140611/3e1e8f8f/attachment.pl>

From dstr7320 at uni.sydney.edu.au  Thu Jun 12 09:00:14 2014
From: dstr7320 at uni.sydney.edu.au (Dario Strbenac)
Date: Thu, 12 Jun 2014 07:00:14 +0000
Subject: [Rd] do.call Error for Function Not Present When Manually Called
Message-ID: <1402560086387.53754@uni.sydney.edu.au>

Hello,

The e1071 function naiveBayes gives an error when called by do.call, although it doesn't give any error if I call it manually.

Browse[1]> trainParams at classifier
function (x, ...) 
UseMethod("naiveBayes")
<environment: namespace:e1071>
Browse[1]> trained <- do.call(trainParams at classifier, paramList)
Error in names(dimnames(tables[[i]])) <- c(Yname, colnames(x)[i]) : 
  'names' attribute [4] must be the same length as the vector [2]
Browse[1]> summary(paramList)
        Length Class  Mode   
        925    -none- numeric
         37    factor numeric
verbose   1    -none- logical
Browse[1]> class(trainParams at classifier(paramList[[1]], paramList[[2]], paramList[[3]]))
[1] "naiveBayes"

What is the explanation for this ? I read that the behaviour of do.call is currently undefined and subject to change.

Browse[1]> sessionInfo()
R version 3.1.0 (2014-04-10)
Platform: x86_64-pc-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_AU.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_AU.UTF-8        LC_COLLATE=en_AU.UTF-8    
 [5] LC_MONETARY=en_AU.UTF-8    LC_MESSAGES=en_AU.UTF-8   
 [7] LC_PAPER=en_AU.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_AU.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
 [1] stats4    splines   parallel  grid      stats     graphics  grDevices
 [8] utils     datasets  methods   base     

other attached packages:
 [1] robustbase_0.91-1         e1071_1.6-3              
 [3] car_2.0-20                edgeR_3.6.2              
 [5] statmod_1.4.19            PoiClaClu_1.0.2          
 [7] lawstat_2.4.1             VGAM_0.9-4               
 [9] mvtnorm_0.9-99992         sparsediscrim_0.2        
[11] MASS_7.3-33               curatedOvarianData_1.2.0 
[13] affy_1.40.0               lumiHumanIDMapping_1.10.0
[15] illuminaHumanv3.db_1.20.0 org.Hs.eg.db_2.10.1      
[17] RSQLite_0.11.4            DBI_0.2-7                
[19] AnnotationDbi_1.24.0      lumi_2.14.2              
[21] Biobase_2.22.0            BiocGenerics_0.8.0       
[23] limma_3.18.13             ROCR_1.0-5               
[25] gplots_2.13.0             gridExtra_0.9.1          
[27] ggplot2_1.0.0            

loaded via a namespace (and not attached):
 [1] affyio_1.30.0          annotate_1.40.1        AnnotationForge_1.4.4 
 [4] base64_1.1             bdsmatrix_1.3-1        beanplot_1.1          
 [7] BiocInstaller_1.14.2   biomaRt_2.18.0         Biostrings_2.30.1     
[10] bitops_1.0-6           BSgenome_1.30.0        bumphunter_1.2.0      
[13] caTools_1.17           class_7.3-10           codetools_0.2-8       
[16] colorspace_1.2-4       corpcor_1.6.6          DEoptimR_1.0-1        
[19] digest_0.6.4           doRNG_1.6              foreach_1.4.2         
[22] gdata_2.13.3           genefilter_1.44.0      GenomicFeatures_1.14.5
[25] GenomicRanges_1.14.4   gtable_0.1.2           gtools_3.4.0          
[28] illuminaio_0.4.0       IRanges_1.20.7         iterators_1.0.7       
[31] itertools_0.1-3        KernSmooth_2.23-12     labeling_0.2          
[34] lattice_0.20-29        locfit_1.5-9.1         Matrix_1.1-3          
[37] matrixStats_0.8.14     mclust_4.3             methylumi_2.8.0       
[40] mgcv_1.7-29            minfi_1.8.9            multtest_2.18.0       
[43] munsell_0.4.2          nleqslv_2.1.1          nlme_3.1-117          
[46] nnet_7.3-8             nor1mix_1.1-4          pkgmaker_0.22         
[49] plyr_1.8.1             preprocessCore_1.24.0  proto_0.3-10          
[52] RColorBrewer_1.0-5     Rcpp_0.11.1            RCurl_1.95-4.1        
[55] registry_0.2           reshape_0.8.5          reshape2_1.4          
[58] R.methodsS3_1.6.1      rngtools_1.2.4         Rsamtools_1.14.3      
[61] rtracklayer_1.22.7     scales_0.2.4           siggenes_1.36.0       
[64] stringr_0.6.2          survival_2.37-7        tcltk_3.1.0           
[67] tools_3.1.0            XML_3.98-1.1           xtable_1.7-3          
[70] XVector_0.2.0          zlibbioc_1.8.0        

--------------------------------------
Dario Strbenac
PhD Student
University of Sydney
Camperdown NSW 2050
Australia


From pdalgd at gmail.com  Thu Jun 12 11:02:24 2014
From: pdalgd at gmail.com (peter dalgaard)
Date: Thu, 12 Jun 2014 11:02:24 +0200
Subject: [Rd] do.call Error for Function Not Present When Manually Called
In-Reply-To: <1402560086387.53754@uni.sydney.edu.au>
References: <1402560086387.53754@uni.sydney.edu.au>
Message-ID: <99F20586-A63E-49C6-8972-049D2F166BBD@gmail.com>


On 12 Jun 2014, at 09:00 , Dario Strbenac <dstr7320 at uni.sydney.edu.au> wrote:

> Hello,
> 
> The e1071 function naiveBayes gives an error when called by do.call, although it doesn't give any error if I call it manually.
> 
> Browse[1]> trainParams at classifier
> function (x, ...) 
> UseMethod("naiveBayes")
> <environment: namespace:e1071>
> Browse[1]> trained <- do.call(trainParams at classifier, paramList)
> Error in names(dimnames(tables[[i]])) <- c(Yname, colnames(x)[i]) : 
>  'names' attribute [4] must be the same length as the vector [2]
> Browse[1]> summary(paramList)
>        Length Class  Mode   
>        925    -none- numeric
>         37    factor numeric
> verbose   1    -none- logical
> Browse[1]> class(trainParams at classifier(paramList[[1]], paramList[[2]], paramList[[3]]))
> [1] "naiveBayes"
> 
> What is the explanation for this ? I read that the behaviour of do.call is currently undefined and subject to change.


Read where? Not in the documentation, as far as I can see.

Problems with do.call are usually related to lack of lazy evaluation since "args" in do.call is a list of _evaluated_ arguments. 

You're not giving sufficient context, but I would conjecture that "Yname" is computed via deparse(substitute(Y)) or something like that. If so, you will run into effects like this (notice the y axis title):

> x <- rnorm(3)
> do.call("plot", list(x))

or, possibly the exact problem for you:

> y <- rnorm(10)
> yname <- function(y)deparse(substitute(y))
> do.call("yname", list(y))
[1] "c(-0.750056154880415, -1.70241489930364, 2.36590757548367, -1.3989317670186, "
[2] "0.125698210447379, 0.446013380855154, -0.949447325668307, 0.388833055449324, "
[3] "1.61595795424046, -0.657071605757215)"                                        

in which the "name" of the vector becomes a character vector of length 3, not 1, because of line breaks.

Using list(quote(y)) sometimes helps, but you may need some care that y gets evaluated in the correct environment.


> 
> Browse[1]> sessionInfo()
> R version 3.1.0 (2014-04-10)
> Platform: x86_64-pc-linux-gnu (64-bit)
> 
> locale:
> [1] LC_CTYPE=en_AU.UTF-8       LC_NUMERIC=C              
> [3] LC_TIME=en_AU.UTF-8        LC_COLLATE=en_AU.UTF-8    
> [5] LC_MONETARY=en_AU.UTF-8    LC_MESSAGES=en_AU.UTF-8   
> [7] LC_PAPER=en_AU.UTF-8       LC_NAME=C                 
> [9] LC_ADDRESS=C               LC_TELEPHONE=C            
> [11] LC_MEASUREMENT=en_AU.UTF-8 LC_IDENTIFICATION=C       
> 
> attached base packages:
> [1] stats4    splines   parallel  grid      stats     graphics  grDevices
> [8] utils     datasets  methods   base     
> 
> other attached packages:
> [1] robustbase_0.91-1         e1071_1.6-3              
> [3] car_2.0-20                edgeR_3.6.2              
> [5] statmod_1.4.19            PoiClaClu_1.0.2          
> [7] lawstat_2.4.1             VGAM_0.9-4               
> [9] mvtnorm_0.9-99992         sparsediscrim_0.2        
> [11] MASS_7.3-33               curatedOvarianData_1.2.0 
> [13] affy_1.40.0               lumiHumanIDMapping_1.10.0
> [15] illuminaHumanv3.db_1.20.0 org.Hs.eg.db_2.10.1      
> [17] RSQLite_0.11.4            DBI_0.2-7                
> [19] AnnotationDbi_1.24.0      lumi_2.14.2              
> [21] Biobase_2.22.0            BiocGenerics_0.8.0       
> [23] limma_3.18.13             ROCR_1.0-5               
> [25] gplots_2.13.0             gridExtra_0.9.1          
> [27] ggplot2_1.0.0            
> 
> loaded via a namespace (and not attached):
> [1] affyio_1.30.0          annotate_1.40.1        AnnotationForge_1.4.4 
> [4] base64_1.1             bdsmatrix_1.3-1        beanplot_1.1          
> [7] BiocInstaller_1.14.2   biomaRt_2.18.0         Biostrings_2.30.1     
> [10] bitops_1.0-6           BSgenome_1.30.0        bumphunter_1.2.0      
> [13] caTools_1.17           class_7.3-10           codetools_0.2-8       
> [16] colorspace_1.2-4       corpcor_1.6.6          DEoptimR_1.0-1        
> [19] digest_0.6.4           doRNG_1.6              foreach_1.4.2         
> [22] gdata_2.13.3           genefilter_1.44.0      GenomicFeatures_1.14.5
> [25] GenomicRanges_1.14.4   gtable_0.1.2           gtools_3.4.0          
> [28] illuminaio_0.4.0       IRanges_1.20.7         iterators_1.0.7       
> [31] itertools_0.1-3        KernSmooth_2.23-12     labeling_0.2          
> [34] lattice_0.20-29        locfit_1.5-9.1         Matrix_1.1-3          
> [37] matrixStats_0.8.14     mclust_4.3             methylumi_2.8.0       
> [40] mgcv_1.7-29            minfi_1.8.9            multtest_2.18.0       
> [43] munsell_0.4.2          nleqslv_2.1.1          nlme_3.1-117          
> [46] nnet_7.3-8             nor1mix_1.1-4          pkgmaker_0.22         
> [49] plyr_1.8.1             preprocessCore_1.24.0  proto_0.3-10          
> [52] RColorBrewer_1.0-5     Rcpp_0.11.1            RCurl_1.95-4.1        
> [55] registry_0.2           reshape_0.8.5          reshape2_1.4          
> [58] R.methodsS3_1.6.1      rngtools_1.2.4         Rsamtools_1.14.3      
> [61] rtracklayer_1.22.7     scales_0.2.4           siggenes_1.36.0       
> [64] stringr_0.6.2          survival_2.37-7        tcltk_3.1.0           
> [67] tools_3.1.0            XML_3.98-1.1           xtable_1.7-3          
> [70] XVector_0.2.0          zlibbioc_1.8.0        
> 
> --------------------------------------
> Dario Strbenac
> PhD Student
> University of Sydney
> Camperdown NSW 2050
> Australia
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From karl.forner at gmail.com  Thu Jun 12 13:37:54 2014
From: karl.forner at gmail.com (Karl Forner)
Date: Thu, 12 Jun 2014 13:37:54 +0200
Subject: [Rd] regression bug with getParseData and/or parse in R-3.1.0
Message-ID: <CAMd4_Ads7bcW9ivosvbdcSrDx-LmJ81uzbD5izRGxq1=4g7RCA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140612/ed72de38/attachment.pl>

From murdoch.duncan at gmail.com  Thu Jun 12 14:39:25 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 12 Jun 2014 08:39:25 -0400
Subject: [Rd] regression bug with getParseData and/or parse in R-3.1.0
In-Reply-To: <CAMd4_Ads7bcW9ivosvbdcSrDx-LmJ81uzbD5izRGxq1=4g7RCA@mail.gmail.com>
References: <CAMd4_Ads7bcW9ivosvbdcSrDx-LmJ81uzbD5izRGxq1=4g7RCA@mail.gmail.com>
Message-ID: <53999F7D.3030500@gmail.com>

On 12/06/2014, 7:37 AM, Karl Forner wrote:
> Hi,
> 
> With R-3.1.0 I get:
>> getParseData(parse(text = "{1}", keep.source = TRUE))
>   line1 col1 line2 col2 id parent     token terminal text
> 7     1    1     1    3  7      9      expr    FALSE
> 1     1    1     1    1  1      7       '{'     TRUE    {
> 2     1    2     1    2  2      3 NUM_CONST     TRUE    1
> 3     1    2     1    2  3      5      expr    FALSE
> 4     1    3     1    3  4      7       '}'     TRUE    }
> 
> Which has two problems:
> 1) the parent of the first expression (id=7) should be 0
> 2) the parent of the expression with id=3 should be 7

I believe this has been fixed in R-patched.  Could you please check?

The problem was due to an overly aggressive optimization introduced in
R-devel in June, 2013.  It assumed a vector was initialized to zeros,
but in some fairly common circumstances it wasn't, so the parent
calculation was wrong.

Luckily 3.1.1 has been delayed by incompatible schedules of various
people, or this fix might have missed that too.  As with some other
fixes in R-patched, this is a case of a bug that sat there for most of a
year before being reported.  Please people, test pre-release versions.

Duncan Murdoch


> 
> For reference, with R-3.0.2:
> 
>> getParseData(parse(text = "{1}", keep.source = TRUE))
>   line1 col1 line2 col2 id parent     token terminal text
> 7     1    1     1    3  7      0      expr    FALSE
> 1     1    1     1    1  1      7       '{'     TRUE    {
> 2     1    2     1    2  2      3 NUM_CONST     TRUE    1
> 3     1    2     1    2  3      7      expr    FALSE
> 4     1    3     1    3  4      7       '}'     TRUE    }
> 
> which is correct.
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From karl.forner at gmail.com  Thu Jun 12 15:09:56 2014
From: karl.forner at gmail.com (Karl Forner)
Date: Thu, 12 Jun 2014 15:09:56 +0200
Subject: [Rd] regression bug with getParseData and/or parse in R-3.1.0
In-Reply-To: <53999F7D.3030500@gmail.com>
References: <CAMd4_Ads7bcW9ivosvbdcSrDx-LmJ81uzbD5izRGxq1=4g7RCA@mail.gmail.com>
	<53999F7D.3030500@gmail.com>
Message-ID: <CAMd4_Af9RziZck=L+oVHaN+79WEFodorsPg7jG0NJQ2LiaVa8w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140612/fa977dc0/attachment.pl>

From dstr7320 at uni.sydney.edu.au  Fri Jun 13 04:00:12 2014
From: dstr7320 at uni.sydney.edu.au (Dario Strbenac)
Date: Fri, 13 Jun 2014 02:00:12 +0000
Subject: [Rd] do.call Error for Function Not Present When Manually Called
In-Reply-To: <99F20586-A63E-49C6-8972-049D2F166BBD@gmail.com>
References: <1402560086387.53754@uni.sydney.edu.au>,
	<99F20586-A63E-49C6-8972-049D2F166BBD@gmail.com>
Message-ID: <1402628487771.40117@uni.sydney.edu.au>

I had a look at the source code, and your prediction is right. There is line at the beginning of the naiveBayes function :

    Yname <- deparse(substitute(y))

When I manually edited it to list(quote(y)), it works.

From skostysh at princeton.edu  Fri Jun 13 08:04:36 2014
From: skostysh at princeton.edu (Scott Kostyshak)
Date: Fri, 13 Jun 2014 02:04:36 -0400
Subject: [Rd] Encourage exit with nonzero error status in ?last.dump
Message-ID: <CAE3=dmewge4vJQkGhmtJCO0NrKwg9VZRiwwaQJEKb8Rw6LY93A@mail.gmail.com>

The following example in ?dump.frames

options(error = quote({dump.frames(to.file = TRUE); q()}))

is useful for teaching the user how to save a frame dump when R
encounters an error during non-interactive sessions. This command
however causes an additional change that on encountering an error R
exits with a 0 error status. Although it's just an example, it's an
important one as it's referenced in the 'Details' section of the help
file. I think it would be better to encourage exiting with a nonzero
error status:

options(error = quote({dump.frames(to.file = TRUE); q(status = 1)}))

Scott


--
Scott Kostyshak
Economics PhD Candidate
Princeton University


From maechler at stat.math.ethz.ch  Fri Jun 13 11:32:40 2014
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 13 Jun 2014 11:32:40 +0200
Subject: [Rd] Encourage exit with nonzero error status in ?last.dump
In-Reply-To: <CAE3=dmewge4vJQkGhmtJCO0NrKwg9VZRiwwaQJEKb8Rw6LY93A@mail.gmail.com>
References: <CAE3=dmewge4vJQkGhmtJCO0NrKwg9VZRiwwaQJEKb8Rw6LY93A@mail.gmail.com>
Message-ID: <21402.50488.327614.392169@stat.math.ethz.ch>

>>>>> Scott Kostyshak <skostysh at princeton.edu>
>>>>>     on Fri, 13 Jun 2014 02:04:36 -0400 writes:

    > The following example in ?dump.frames options(error =
    > quote({dump.frames(to.file = TRUE); q()}))

    > is useful for teaching the user how to save a frame dump
    > when R encounters an error during non-interactive
    > sessions. This command however causes an additional change
    > that on encountering an error R exits with a 0 error
    > status. Although it's just an example, it's an important
    > one as it's referenced in the 'Details' section of the
    > help file. I think it would be better to encourage exiting
    > with a nonzero error status:

    > options(error = quote({dump.frames(to.file = TRUE); q(status = 1)}))

You are right.  
Thank you for the suggestion: it will be in next
release.

Martin Maechler,
ETH Zurich


From renaud at mancala.cbio.uct.ac.za  Fri Jun 13 12:10:34 2014
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Fri, 13 Jun 2014 12:10:34 +0200
Subject: [Rd] Is it possible to make install.packages compile source code on
 Unix but use shipped binary on Windows?
Message-ID: <CAHavPHE1WW4JV735EQsGMdv_-wLY8_AnfAGqzCq=k96_D-wgYw@mail.gmail.com>

Hi,

is it possible to make install.packages install a source package by
compiling it on Unix, but skip compilation and use a pre-built windows
binary (shipped in exec/) if installing on Windows?

The package should be installable on Windows machines that do not have
Rtools installed. This is to make the update process easier for users,
because the C++ code does not change often, meaning that I can just
send source packages built on Linux, with a binary executable built
once in a while on win-builder.

Note that this is for a package that is not meant for CRAN, so no
policy issue here.

Thank you.

Bests,
Renaud


From ripley at stats.ox.ac.uk  Fri Jun 13 18:07:41 2014
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 13 Jun 2014 17:07:41 +0100
Subject: [Rd] Is it possible to make install.packages compile source
 code on Unix but use shipped binary on Windows?
In-Reply-To: <CAHavPHE1WW4JV735EQsGMdv_-wLY8_AnfAGqzCq=k96_D-wgYw@mail.gmail.com>
References: <CAHavPHE1WW4JV735EQsGMdv_-wLY8_AnfAGqzCq=k96_D-wgYw@mail.gmail.com>
Message-ID: <539B21CD.6090704@stats.ox.ac.uk>

On 13/06/2014 11:10, Renaud Gaujoux wrote:
> Hi,
>
> is it possible to make install.packages install a source package by
> compiling it on Unix, but skip compilation and use a pre-built windows
> binary (shipped in exec/) if installing on Windows?

A 'pre-built windows binary' of what?

You can easily ship a DLL or .exe for use on Windows: just make use of 
configure.win and/or Makefile.win.  If you have a Makefile.win it will 
override the normal procedures for directory src.  OTOH, shipping 
something in exec will be installed everwhere.

Watch out for sub-architectures: 'Windows' is in fact two platforms.  We 
have over the years seen a lot of problem with people shipping 64-bit 
Windows binaries: 32-bit Windows does not recognize those.

> The package should be installable on Windows machines that do not have
> Rtools installed. This is to make the update process easier for users,
> because the C++ code does not change often, meaning that I can just
> send source packages built on Linux, with a binary executable built
> once in a while on win-builder.
>
> Note that this is for a package that is not meant for CRAN, so no
> policy issue here.
>
> Thank you.
>
> Bests,
> Renaud



-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From skyebend at skyeome.net  Fri Jun 13 23:41:35 2014
From: skyebend at skyeome.net (Skye Bender-deMoll)
Date: Fri, 13 Jun 2014 14:41:35 -0700
Subject: [Rd] what is the current correct repos structure for mac osx
	binaries?
Message-ID: <539B700F.7080902@skyeome.net>

Dear R-developers,

As part of our package building process, we maintain internal CRAN-like 
repositories of our packages.  This has worked pretty well, but we are 
running into issues with R 3.1 and OSX mavericks.

Specifically, machines with osx mavericks seem to, by default, expect 
packages to be located under a 'mavericks' sub-directory, but this is 
not the location reported when generating a mac.binary appropriate 
contrib url.

 >contrib.url('foo')
[1] "foo/bin/macosx/mavericks/contrib/3.1/"


If I ask where the mac binaries are on a linux machine (AND on mac 
mavericks machines) I get

 >contrib.url('foo',type='mac.binary')
[1] "foo/bin/macosx/mavericks/contrib/3.1/"


But the OSX machine gives an error and fails to locate the packages if 
they are located at foo/bin/macosx/contrib/3.1/

So where are the mac binaries supposed to located in a CRAN-like 
repository so that they can be installed on a mac with the default 
install command?  And is there a way for a non-mac machine (i.e. our 
linux deploy server) to determine that directory other than 
contrib.url(,type='mac.binary) ?

thanks for your help,
  -skye


From simon.urbanek at r-project.org  Sat Jun 14 02:22:24 2014
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 13 Jun 2014 20:22:24 -0400
Subject: [Rd] what is the current correct repos structure for mac osx
	binaries?
In-Reply-To: <539B700F.7080902@skyeome.net>
References: <539B700F.7080902@skyeome.net>
Message-ID: <429A4CCF-F996-4C40-9A80-68373348EED4@r-project.org>


On Jun 13, 2014, at 5:41 PM, Skye Bender-deMoll <skyebend at skyeome.net> wrote:

> Dear R-developers,
> 
> As part of our package building process, we maintain internal CRAN-like repositories of our packages.  This has worked pretty well, but we are running into issues with R 3.1 and OSX mavericks.
> 
> Specifically, machines with osx mavericks seem to, by default, expect packages to be located under a 'mavericks' sub-directory, but this is not the location reported when generating a mac.binary appropriate contrib url.
> 
> >contrib.url('foo')
> [1] "foo/bin/macosx/mavericks/contrib/3.1/"
> 
> 
> If I ask where the mac binaries are on a linux machine (AND on mac mavericks machines) I get
> 
> >contrib.url('foo',type='mac.binary')
> [1] "foo/bin/macosx/mavericks/contrib/3.1/"
> 

I don't think that is true. On all machines (Linux, OS X, ...) I get

> contrib.url('foo', type='mac.binary')
[1] "foo/bin/macosx/contrib/3.1"


Note that the type for the mavericks build is "mac.binary.mavericks", so on all machines you also get

> contrib.url('foo',type='mac.binary.mavericks')
[1] "foo/bin/macosx/mavericks/contrib/3.1"

The only difference are the defaults for pkgType - they differ by the build, but the repo structure is fixed and consistent across all platforms.

Cheers,
Simon


> 
> But the OSX machine gives an error and fails to locate the packages if they are located at foo/bin/macosx/contrib/3.1/
> 
> So where are the mac binaries supposed to located in a CRAN-like repository so that they can be installed on a mac with the default install command?  And is there a way for a non-mac machine (i.e. our linux deploy server) to determine that directory other than contrib.url(,type='mac.binary) ?
> 
> thanks for your help,
> -skye
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From skostysh at princeton.edu  Sat Jun 14 08:19:16 2014
From: skostysh at princeton.edu (Scott Kostyshak)
Date: Sat, 14 Jun 2014 02:19:16 -0400
Subject: [Rd] Encourage exit with nonzero error status in ?last.dump
In-Reply-To: <21402.50488.327614.392169@stat.math.ethz.ch>
References: <CAE3=dmewge4vJQkGhmtJCO0NrKwg9VZRiwwaQJEKb8Rw6LY93A@mail.gmail.com>
	<21402.50488.327614.392169@stat.math.ethz.ch>
Message-ID: <CAE3=dmcrD2a2d6hUAHUpuZQvPvjtvV=GX9ojEm+RJxFQnYnLgQ@mail.gmail.com>

On Fri, Jun 13, 2014 at 5:32 AM, Martin Maechler
<maechler at stat.math.ethz.ch> wrote:
>>>>>> Scott Kostyshak <skostysh at princeton.edu>
>>>>>>     on Fri, 13 Jun 2014 02:04:36 -0400 writes:
>
>     > The following example in ?dump.frames options(error =
>     > quote({dump.frames(to.file = TRUE); q()}))
>
>     > is useful for teaching the user how to save a frame dump
>     > when R encounters an error during non-interactive
>     > sessions. This command however causes an additional change
>     > that on encountering an error R exits with a 0 error
>     > status. Although it's just an example, it's an important
>     > one as it's referenced in the 'Details' section of the
>     > help file. I think it would be better to encourage exiting
>     > with a nonzero error status:
>
>     > options(error = quote({dump.frames(to.file = TRUE); q(status = 1)}))
>
> You are right.
> Thank you for the suggestion: it will be in next
> release.
>
> Martin Maechler,
> ETH Zurich

Thanks, Martin.


--
Scott Kostyshak
Economics PhD Candidate
Princeton University


From mtmorgan at fhcrc.org  Sat Jun 14 13:48:44 2014
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Sat, 14 Jun 2014 04:48:44 -0700
Subject: [Rd] Should a package that indirectly Suggests: a vignette engine
 pass R CMD check?
Message-ID: <539C369C.6090807@fhcrc.org>

A package uses VignetteEngine: knitr; the package itself does not Suggests: 
knitr, but it Suggests: BiocStyle which in turn Suggests: knitr. Nonetheless, R 
CMD check fails indicating that a package required for checking is not declared. 
Is it really the intention that the original package duplicate Suggests: knitr?

This is only with a recent R. In detail, with

$ Rdev --version|head -3
R Under development (unstable) (2014-06-14 r65947) -- "Unsuffered Consequences"
Copyright (C) 2014 The R Foundation for Statistical Computing
Platform: x86_64-unknown-linux-gnu (64-bit)

trying to  check the Bioconductor genefilter package leads to

$ Rdev --vanilla CMD check genefilter_1.47.5.tar.gz
* using log directory ?/home/mtmorgan/b/Rpacks/genefilter.Rcheck?
* using R Under development (unstable) (2014-06-13 r65941)
* using platform: x86_64-unknown-linux-gnu (64-bit)
* using session charset: UTF-8
* checking for file ?genefilter/DESCRIPTION? ... OK
* this is package ?genefilter? version ?1.47.5?
* checking package namespace information ... OK
* checking package dependencies ... ERROR
VignetteBuilder package not declared: ?knitr?

See the information on DESCRIPTION files in the chapter ?Creating R
packages? of the ?Writing R Extensions? manual.

I interpret this to mean that knitr should be mentioned in Suggests: or other 
dependency field. The package does not Suggests: knitr, but it does Suggests: 
BiocStyle, which itself Suggests: knitr. The author knows that they are using 
the BiocStyle package for their vignette, and the BiocStyle package suggests the 
appropriate builder.

Martin Morgan
-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From murdoch.duncan at gmail.com  Sat Jun 14 14:54:02 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 14 Jun 2014 08:54:02 -0400
Subject: [Rd] Should a package that indirectly Suggests: a vignette
 engine pass R CMD check?
In-Reply-To: <539C369C.6090807@fhcrc.org>
References: <539C369C.6090807@fhcrc.org>
Message-ID: <539C45EA.4000306@gmail.com>

On 14/06/2014, 7:48 AM, Martin Morgan wrote:
> A package uses VignetteEngine: knitr; the package itself does not Suggests: 
> knitr, but it Suggests: BiocStyle which in turn Suggests: knitr. Nonetheless, R 
> CMD check fails indicating that a package required for checking is not declared. 
> Is it really the intention that the original package duplicate Suggests: knitr?

Yes.  The VignetteEngine setting requires that knitr be available for
building and checking, but it doesn't imply how.  You need to also
declare knitr in one of the other ways (Depends, Suggests, etc.).

It would be possible to change the checks so that a dependency of a
dependency was sufficient, but a suggestion of a suggestion would not
be. You can pass a check without having the Suggests of BiocStyle
present, because checking your package doesn't require doing anything
with BiocStyle that would need its suggestions.  However, I don't think
it's worth complicating the check code to support this.  If you need
knitr to be present to build your vignettes, why not just declare it
explicitly?

Duncan Murdoch

> 
> This is only with a recent R. In detail, with
> 
> $ Rdev --version|head -3
> R Under development (unstable) (2014-06-14 r65947) -- "Unsuffered Consequences"
> Copyright (C) 2014 The R Foundation for Statistical Computing
> Platform: x86_64-unknown-linux-gnu (64-bit)
> 
> trying to  check the Bioconductor genefilter package leads to
> 
> $ Rdev --vanilla CMD check genefilter_1.47.5.tar.gz
> * using log directory ?/home/mtmorgan/b/Rpacks/genefilter.Rcheck?
> * using R Under development (unstable) (2014-06-13 r65941)
> * using platform: x86_64-unknown-linux-gnu (64-bit)
> * using session charset: UTF-8
> * checking for file ?genefilter/DESCRIPTION? ... OK
> * this is package ?genefilter? version ?1.47.5?
> * checking package namespace information ... OK
> * checking package dependencies ... ERROR
> VignetteBuilder package not declared: ?knitr?
> 
> See the information on DESCRIPTION files in the chapter ?Creating R
> packages? of the ?Writing R Extensions? manual.
> 
> I interpret this to mean that knitr should be mentioned in Suggests: or other 
> dependency field. The package does not Suggests: knitr, but it does Suggests: 
> BiocStyle, which itself Suggests: knitr. The author knows that they are using 
> the BiocStyle package for their vignette, and the BiocStyle package suggests the 
> appropriate builder.
> 
> Martin Morgan
>


From ripley at stats.ox.ac.uk  Sat Jun 14 16:31:33 2014
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 14 Jun 2014 15:31:33 +0100
Subject: [Rd] Should a package that indirectly Suggests: a vignette
 engine pass R CMD check?
In-Reply-To: <539C45EA.4000306@gmail.com>
References: <539C369C.6090807@fhcrc.org> <539C45EA.4000306@gmail.com>
Message-ID: <539C5CC5.8020102@stats.ox.ac.uk>

On 14/06/2014 13:54, Duncan Murdoch wrote:
> On 14/06/2014, 7:48 AM, Martin Morgan wrote:
>> A package uses VignetteEngine: knitr; the package itself does not Suggests:
>> knitr, but it Suggests: BiocStyle which in turn Suggests: knitr. Nonetheless, R
>> CMD check fails indicating that a package required for checking is not declared.
>> Is it really the intention that the original package duplicate Suggests: knitr?
>
> Yes.  The VignetteEngine setting requires that knitr be available for
> building and checking, but it doesn't imply how.  You need to also
> declare knitr in one of the other ways (Depends, Suggests, etc.).
>
> It would be possible to change the checks so that a dependency of a
> dependency was sufficient, but a suggestion of a suggestion would not
> be. You can pass a check without having the Suggests of BiocStyle
> present, because checking your package doesn't require doing anything
> with BiocStyle that would need its suggestions.  However, I don't think
> it's worth complicating the check code to support this.  If you need
> knitr to be present to build your vignettes, why not just declare it
> explicitly?

This is just checking what 'Writing R Extensions' requires:

'As Sweave is the only engine supplied with the R distribution, the 
package providing any other engine must be specified in the 
?VignetteBuilder? field of the package DESCRIPTION file, and also 
specified in the ?Suggests?, ?Imports? or ?Depends? field (since its 
namespace must be available to build or check your package).'

Note the 'must be' ... it is a requirement.  And various parts of the 
software in various versions of R (there have been quite a few variants) 
have relied on this.  For example, it is optionally possible to do 
build/check without Suggests present (and always without Suggests of 
Suggests) and then in some versions some of files intended to be 
non-Sweave vignettes were silently ignored.

>
> Duncan Murdoch
>
>>
>> This is only with a recent R. In detail, with
>>
>> $ Rdev --version|head -3
>> R Under development (unstable) (2014-06-14 r65947) -- "Unsuffered Consequences"
>> Copyright (C) 2014 The R Foundation for Statistical Computing
>> Platform: x86_64-unknown-linux-gnu (64-bit)
>>
>> trying to  check the Bioconductor genefilter package leads to
>>
>> $ Rdev --vanilla CMD check genefilter_1.47.5.tar.gz
>> * using log directory ?/home/mtmorgan/b/Rpacks/genefilter.Rcheck?
>> * using R Under development (unstable) (2014-06-13 r65941)
>> * using platform: x86_64-unknown-linux-gnu (64-bit)
>> * using session charset: UTF-8
>> * checking for file ?genefilter/DESCRIPTION? ... OK
>> * this is package ?genefilter? version ?1.47.5?
>> * checking package namespace information ... OK
>> * checking package dependencies ... ERROR
>> VignetteBuilder package not declared: ?knitr?
>>
>> See the information on DESCRIPTION files in the chapter ?Creating R
>> packages? of the ?Writing R Extensions? manual.
>>
>> I interpret this to mean that knitr should be mentioned in Suggests: or other
>> dependency field. The package does not Suggests: knitr, but it does Suggests:
>> BiocStyle, which itself Suggests: knitr. The author knows that they are using
>> the BiocStyle package for their vignette, and the BiocStyle package suggests the
>> appropriate builder.
>>
>> Martin Morgan
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From dusa.adrian at unibuc.ro  Mon Jun 16 03:22:17 2014
From: dusa.adrian at unibuc.ro (=?UTF-8?B?QWRyaWFuIER1yJlh?=)
Date: Mon, 16 Jun 2014 04:22:17 +0300
Subject: [Rd] index.search
Message-ID: <CAJ=0CtANJ8UALh8bwv+CceC75+sAmm-SEhNsFiqd=XUjpbs_tg@mail.gmail.com>

Dear r-devel,

I am trying to automatically check if two successive versions of a
package have the same results (i.e. code not broken), by parsing the
example sections for each function against a previously tested
version.

While trying to replicate the code from example(), I am facing an
error related with te "index.search" function (line 7 in the example()
code).
This is the code I am using:

example2 <- function (topic, package = NULL, lib.loc = NULL,
character.only = FALSE,
    give.lines = FALSE, local = FALSE, echo = TRUE, verbose =
getOption("verbose"),
    setRNG = FALSE, ask = getOption("example.ask"), prompt.prefix =
abbreviate(topic, 6), run.dontrun = FALSE)
{
    if (!character.only) {
        topic <- substitute(topic)
        if (!is.character(topic))
            topic <- deparse(topic)[1L]
    }
    pkgpaths <- find.package(package, lib.loc, verbose = verbose)
    file <- index.search(topic, pkgpaths, TRUE)
    return(file)
}

> example2("deMorgan", package="QCA")
Error in example2("deMorgan", package = "QCA") :
  could not find function "index.search"


I've tried an explicit library(utils), with the same result.
?index.search doesn't yield anything better...

Could anyone point me in the right direction, please?
Thank you,
Adrian


-- 
Adrian Dusa
University of Bucharest
Romanian Social Data Archive
1, Schitu Magureanu Bd.
050025 Bucharest sector 5
Romania
Tel.:+40 21 3126618 \
        +40 21 3120210 / int.101
Fax: +40 21 3158391


From gmbecker at ucdavis.edu  Mon Jun 16 04:46:34 2014
From: gmbecker at ucdavis.edu (Gabriel Becker)
Date: Sun, 15 Jun 2014 19:46:34 -0700
Subject: [Rd] index.search
In-Reply-To: <CAJ=0CtANJ8UALh8bwv+CceC75+sAmm-SEhNsFiqd=XUjpbs_tg@mail.gmail.com>
References: <CAJ=0CtANJ8UALh8bwv+CceC75+sAmm-SEhNsFiqd=XUjpbs_tg@mail.gmail.com>
Message-ID: <CADwqtCNrh5v1vgMtoJWW7Pd+m+xs4n0diXC8mZA=qeqbngLFiw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140615/f8447dc5/attachment.pl>

From dusa.adrian at unibuc.ro  Mon Jun 16 05:23:26 2014
From: dusa.adrian at unibuc.ro (=?UTF-8?B?QWRyaWFuIER1yJlh?=)
Date: Mon, 16 Jun 2014 06:23:26 +0300
Subject: [Rd] index.search
In-Reply-To: <CADwqtCNrh5v1vgMtoJWW7Pd+m+xs4n0diXC8mZA=qeqbngLFiw@mail.gmail.com>
References: <CAJ=0CtANJ8UALh8bwv+CceC75+sAmm-SEhNsFiqd=XUjpbs_tg@mail.gmail.com>
	<CADwqtCNrh5v1vgMtoJWW7Pd+m+xs4n0diXC8mZA=qeqbngLFiw@mail.gmail.com>
Message-ID: <CAJ=0CtCuZZF2d7eWZzv96myB8cd88Pyks=uFdNiJdcxzbcnzhA@mail.gmail.com>

Hi Gabriel,

Actually, I am not going to use multiple versions of the same package,
but always the last version. What I would like to do is:
- to run all examples from all functions in the package, saving the
results into a list
- compare the list to an already saved one (from the previous version
of the package), possibly using all.equal()

I tried using the example() function, like this:
example("deMorgan", package="QCA", give.lines=TRUE)

That returns the commands from the examples section, but if a command
is split over multiple rows I cannot use it automatically.

I could also use:
capture.output(example("deMorgan", package="QCA", ask=FALSE))

That would indeed work for the printed output, but I would also like
to compare the objects saved by the deMorgan() function. If that is
not possible, I'll probably be happy with the printed output.

I'd still be curious as to why the index.search() function cannot be
used... (it seems useful for other purposes).

Best wishes,
Adrian


On Mon, Jun 16, 2014 at 5:46 AM, Gabriel Becker <gmbecker at ucdavis.edu> wrote:
> Adrian,
>
> R isn't really designed to use multiple versions of the same package in the
> same R session. To do what you want you'll need to unload one version of the
> package before you load the next, which will work some percentage of the
> time between 50 and 100 ("usually"), but when it can be done it is
> relatively easy to do.
>
>  Packages with C code will give you problems, or at least they used to. I
> haven't tried recently.  See Prof Ripley's response here: See
> https://stat.ethz.ch/pipermail/r-devel/2009-February/052229.html
>
> For packages that can be unloaded/reloaded safely, is there a reason you
> can't just use the existing example function with two different library
> locations (lib.loc argument) with the two package versions installed?
>
> ~G
>
>
> On Sun, Jun 15, 2014 at 6:22 PM, Adrian Du?a <dusa.adrian at unibuc.ro> wrote:
>>
>> Dear r-devel,
>>
>> I am trying to automatically check if two successive versions of a
>> package have the same results (i.e. code not broken), by parsing the
>> example sections for each function against a previously tested
>> version.
>>
>> While trying to replicate the code from example(), I am facing an
>> error related with te "index.search" function (line 7 in the example()
>> code).
>> This is the code I am using:
>>
>> example2 <- function (topic, package = NULL, lib.loc = NULL,
>> character.only = FALSE,
>>     give.lines = FALSE, local = FALSE, echo = TRUE, verbose =
>> getOption("verbose"),
>>     setRNG = FALSE, ask = getOption("example.ask"), prompt.prefix =
>> abbreviate(topic, 6), run.dontrun = FALSE)
>> {
>>     if (!character.only) {
>>         topic <- substitute(topic)
>>         if (!is.character(topic))
>>             topic <- deparse(topic)[1L]
>>     }
>>     pkgpaths <- find.package(package, lib.loc, verbose = verbose)
>>     file <- index.search(topic, pkgpaths, TRUE)
>>     return(file)
>> }
>>
>> > example2("deMorgan", package="QCA")
>> Error in example2("deMorgan", package = "QCA") :
>>   could not find function "index.search"
>>
>>
>> I've tried an explicit library(utils), with the same result.
>> ?index.search doesn't yield anything better...
>>
>> Could anyone point me in the right direction, please?
>> Thank you,
>> Adrian
>>
>>
>> --
>> Adrian Dusa
>> University of Bucharest
>> Romanian Social Data Archive
>> 1, Schitu Magureanu Bd.
>> 050025 Bucharest sector 5
>> Romania
>> Tel.:+40 21 3126618 \
>>         +40 21 3120210 / int.101
>> Fax: +40 21 3158391
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>
>
> --
> Gabriel Becker
> Graduate Student
> Statistics Department
> University of California, Davis



-- 
Adrian Dusa
University of Bucharest
Romanian Social Data Archive
1, Schitu Magureanu Bd.
050025 Bucharest sector 5
Romania
Tel.:+40 21 3126618 \
        +40 21 3120210 / int.101
Fax: +40 21 3158391


From rowe at muxspace.com  Mon Jun 16 05:36:15 2014
From: rowe at muxspace.com (Brian Lee Yung Rowe)
Date: Sun, 15 Jun 2014 23:36:15 -0400
Subject: [Rd] index.search
In-Reply-To: <CAJ=0CtCuZZF2d7eWZzv96myB8cd88Pyks=uFdNiJdcxzbcnzhA@mail.gmail.com>
References: <CAJ=0CtANJ8UALh8bwv+CceC75+sAmm-SEhNsFiqd=XUjpbs_tg@mail.gmail.com>
	<CADwqtCNrh5v1vgMtoJWW7Pd+m+xs4n0diXC8mZA=qeqbngLFiw@mail.gmail.com>
	<CAJ=0CtCuZZF2d7eWZzv96myB8cd88Pyks=uFdNiJdcxzbcnzhA@mail.gmail.com>
Message-ID: <A2C88BCF-C710-4EA4-A947-9C88A948678B@muxspace.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140615/7dc444e7/attachment.pl>

From gmbecker at ucdavis.edu  Mon Jun 16 05:37:35 2014
From: gmbecker at ucdavis.edu (Gabriel Becker)
Date: Sun, 15 Jun 2014 20:37:35 -0700
Subject: [Rd] index.search
In-Reply-To: <CAJ=0CtCuZZF2d7eWZzv96myB8cd88Pyks=uFdNiJdcxzbcnzhA@mail.gmail.com>
References: <CAJ=0CtANJ8UALh8bwv+CceC75+sAmm-SEhNsFiqd=XUjpbs_tg@mail.gmail.com>
	<CADwqtCNrh5v1vgMtoJWW7Pd+m+xs4n0diXC8mZA=qeqbngLFiw@mail.gmail.com>
	<CAJ=0CtCuZZF2d7eWZzv96myB8cd88Pyks=uFdNiJdcxzbcnzhA@mail.gmail.com>
Message-ID: <CADwqtCNUjqsDStxxuo5w7WpK+7wCuTcruwLV=PTFKKTbVmW2NA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140615/ee13df1b/attachment.pl>

From dusa.adrian at unibuc.ro  Mon Jun 16 07:22:47 2014
From: dusa.adrian at unibuc.ro (=?UTF-8?B?QWRyaWFuIER1yJlh?=)
Date: Mon, 16 Jun 2014 08:22:47 +0300
Subject: [Rd] index.search
In-Reply-To: <A2C88BCF-C710-4EA4-A947-9C88A948678B@muxspace.com>
References: <CAJ=0CtANJ8UALh8bwv+CceC75+sAmm-SEhNsFiqd=XUjpbs_tg@mail.gmail.com>
	<CADwqtCNrh5v1vgMtoJWW7Pd+m+xs4n0diXC8mZA=qeqbngLFiw@mail.gmail.com>
	<CAJ=0CtCuZZF2d7eWZzv96myB8cd88Pyks=uFdNiJdcxzbcnzhA@mail.gmail.com>
	<A2C88BCF-C710-4EA4-A947-9C88A948678B@muxspace.com>
Message-ID: <CAJ=0CtD7Or20+F_NSX+3p2cYVWA6Zkj2=3MV35zB=OEV5wGKhQ@mail.gmail.com>

On Mon, Jun 16, 2014 at 6:36 AM, Brian Lee Yung Rowe <rowe at muxspace.com> wrote:
> Adrian,
>
> You might consider using a unit testing framework such as RUnit or testthat,
> which does this but in a more structured manner. Essentially you codify the
> behavior in a set of tests as opposed to comparing with a previous version.

Right... I knew there was a better way to handle this.
Will take a look on those and try to build something on them.

Best,
Adrian

-- 
Adrian Dusa
University of Bucharest
Romanian Social Data Archive
1, Schitu Magureanu Bd.
050025 Bucharest sector 5
Romania
Tel.:+40 21 3126618 \
        +40 21 3120210 / int.101
Fax: +40 21 3158391


From dusa.adrian at unibuc.ro  Mon Jun 16 07:33:59 2014
From: dusa.adrian at unibuc.ro (=?UTF-8?B?QWRyaWFuIER1yJlh?=)
Date: Mon, 16 Jun 2014 08:33:59 +0300
Subject: [Rd] index.search
In-Reply-To: <CADwqtCNUjqsDStxxuo5w7WpK+7wCuTcruwLV=PTFKKTbVmW2NA@mail.gmail.com>
References: <CAJ=0CtANJ8UALh8bwv+CceC75+sAmm-SEhNsFiqd=XUjpbs_tg@mail.gmail.com>
	<CADwqtCNrh5v1vgMtoJWW7Pd+m+xs4n0diXC8mZA=qeqbngLFiw@mail.gmail.com>
	<CAJ=0CtCuZZF2d7eWZzv96myB8cd88Pyks=uFdNiJdcxzbcnzhA@mail.gmail.com>
	<CADwqtCNUjqsDStxxuo5w7WpK+7wCuTcruwLV=PTFKKTbVmW2NA@mail.gmail.com>
Message-ID: <CAJ=0CtBD32=SzJi7Zf_DR2THoOiZ3L32MHtzW3+a0V+VE-JvAg@mail.gmail.com>

On Mon, Jun 16, 2014 at 6:37 AM, Gabriel Becker <gmbecker at ucdavis.edu> wrote:
> [...]
> You can. This is valid R source, so the parser will understand it
>
> expr = parse(text= example("deMorgan", package="QCA", give.lines=TRUE))
>
> You can then evaluate some or all of that expression using either R's own
> eval package or, e.g. Hadley Wickham's evaluate package (for your particular
> usecase evaluate will be easier I think).

Oh, I see...! In that case I can use it, of course.
Did install the evaluate package, although one would expect some
better documentation (no examples at all, especially at the main
evaluate function).


>> [...]
> index.search is an unexported function, which means that it is subject to
> change in how it behaves without notice or even externally available
> reasons. You can get it via :::, but again, it's really not the right tool
> here, and not safe to use in general in code you expect to keep working.

Yes, I figured that much.
Of course it's not meant to be used in any decently working code, but
I learn heavily by simply looking at these sort of (hidden) R
functions.

Thanks again,
Adrian

-- 
Adrian Dusa
University of Bucharest
Romanian Social Data Archive
1, Schitu Magureanu Bd.
050025 Bucharest sector 5
Romania
Tel.:+40 21 3126618 \
        +40 21 3120210 / int.101
Fax: +40 21 3158391


From maechler at stat.math.ethz.ch  Mon Jun 16 09:32:49 2014
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 16 Jun 2014 09:32:49 +0200
Subject: [Rd] index.search
In-Reply-To: <CAJ=0CtBD32=SzJi7Zf_DR2THoOiZ3L32MHtzW3+a0V+VE-JvAg@mail.gmail.com>
References: <CAJ=0CtANJ8UALh8bwv+CceC75+sAmm-SEhNsFiqd=XUjpbs_tg@mail.gmail.com>
	<CADwqtCNrh5v1vgMtoJWW7Pd+m+xs4n0diXC8mZA=qeqbngLFiw@mail.gmail.com>
	<CAJ=0CtCuZZF2d7eWZzv96myB8cd88Pyks=uFdNiJdcxzbcnzhA@mail.gmail.com>
	<CADwqtCNUjqsDStxxuo5w7WpK+7wCuTcruwLV=PTFKKTbVmW2NA@mail.gmail.com>
	<CAJ=0CtBD32=SzJi7Zf_DR2THoOiZ3L32MHtzW3+a0V+VE-JvAg@mail.gmail.com>
Message-ID: <21406.40353.259201.480277@stat.math.ethz.ch>

>>>>> Adrian Du?a <dusa.adrian at unibuc.ro>
>>>>>     on Mon, 16 Jun 2014 08:33:59 +0300 writes:

    > On Mon, Jun 16, 2014 at 6:37 AM, Gabriel Becker
    > <gmbecker at ucdavis.edu> wrote:
    >> [...]  You can. This is valid R source, so the parser
    >> will understand it
    >> 
    >> expr = parse(text= example("deMorgan", package="QCA",
    >> give.lines=TRUE))
    >> 
    >> You can then evaluate some or all of that expression
    >> using either R's own eval package or, e.g. Hadley
    >> Wickham's evaluate package (for your particular usecase
    >> evaluate will be easier I think).

    > Oh, I see...! In that case I can use it, of course.  Did
    > install the evaluate package, although one would expect
    > some better documentation (no examples at all, especially
    > at the main evaluate function).


    >>> [...]
    >> index.search is an unexported function, which means that
    >> it is subject to change in how it behaves without notice
    >> or even externally available reasons. You can get it via
    >> :::, but again, it's really not the right tool here, and
    >> not safe to use in general in code you expect to keep
    >> working.

    > Yes, I figured that much.  Of course it's not meant to be
    > used in any decently working code, but I learn heavily by
    > simply looking at these sort of (hidden) R functions.

    > Thanks again, Adrian

Apropos "not the right tool".  I'm a bit astonished that nobody
mentioned the fact R already provides "the tool" to
automatically compare all example outputs with a previous
version (of the packages example outputs):

*THE* manual (every package writer should know about,
 re-read/browse about once a year, and search in for such questions):

"Writing R Extensions", section Package subdirectories
----------------------------
(e.g. on the CRAN master in Vienna,
 http://cran.r-project.org/doc/manuals/R-exts.html#Package-subdirectories )
says

|    If directory 'tests' has a subdirectory 'Examples' containing a file
|    'PKG-Ex.Rout.save', this is compared to the output file for running the
|    examples when the latter are checked. 

So: After an 'R CMD check <PKG>' you only need to take and
keep the  <PKG>-Ex.Rout  file that is produced (in the
PKG.Rcheck/ directory), and save it into <PKG>/tests/<PKG>-Ex.Rout.save
and from then on, every time you run R CMD check <PKG>  the
comparison will be made. 

Martin Maechler, ETH Zurich


From dusa.adrian at unibuc.ro  Mon Jun 16 09:49:46 2014
From: dusa.adrian at unibuc.ro (=?UTF-8?B?QWRyaWFuIER1yJlh?=)
Date: Mon, 16 Jun 2014 10:49:46 +0300
Subject: [Rd] index.search
In-Reply-To: <21406.40353.259201.480277@stat.math.ethz.ch>
References: <CAJ=0CtANJ8UALh8bwv+CceC75+sAmm-SEhNsFiqd=XUjpbs_tg@mail.gmail.com>
	<CADwqtCNrh5v1vgMtoJWW7Pd+m+xs4n0diXC8mZA=qeqbngLFiw@mail.gmail.com>
	<CAJ=0CtCuZZF2d7eWZzv96myB8cd88Pyks=uFdNiJdcxzbcnzhA@mail.gmail.com>
	<CADwqtCNUjqsDStxxuo5w7WpK+7wCuTcruwLV=PTFKKTbVmW2NA@mail.gmail.com>
	<CAJ=0CtBD32=SzJi7Zf_DR2THoOiZ3L32MHtzW3+a0V+VE-JvAg@mail.gmail.com>
	<21406.40353.259201.480277@stat.math.ethz.ch>
Message-ID: <CAJ=0CtBY2xAaRfPRKjh==QaYyvrbw07cwv6URM5VB41xgMGZYg@mail.gmail.com>

Oh my... this is so simple, why didn't I think of that...?
Thanks a lot Martin, beautiful,
Adrian


On Mon, Jun 16, 2014 at 10:32 AM, Martin Maechler
<maechler at stat.math.ethz.ch> wrote:
>>>>>> Adrian Du?a <dusa.adrian at unibuc.ro>
>>>>>>     on Mon, 16 Jun 2014 08:33:59 +0300 writes:
>
>     > On Mon, Jun 16, 2014 at 6:37 AM, Gabriel Becker
>     > <gmbecker at ucdavis.edu> wrote:
>     >> [...]  You can. This is valid R source, so the parser
>     >> will understand it
>     >>
>     >> expr = parse(text= example("deMorgan", package="QCA",
>     >> give.lines=TRUE))
>     >>
>     >> You can then evaluate some or all of that expression
>     >> using either R's own eval package or, e.g. Hadley
>     >> Wickham's evaluate package (for your particular usecase
>     >> evaluate will be easier I think).
>
>     > Oh, I see...! In that case I can use it, of course.  Did
>     > install the evaluate package, although one would expect
>     > some better documentation (no examples at all, especially
>     > at the main evaluate function).
>
>
>     >>> [...]
>     >> index.search is an unexported function, which means that
>     >> it is subject to change in how it behaves without notice
>     >> or even externally available reasons. You can get it via
>     >> :::, but again, it's really not the right tool here, and
>     >> not safe to use in general in code you expect to keep
>     >> working.
>
>     > Yes, I figured that much.  Of course it's not meant to be
>     > used in any decently working code, but I learn heavily by
>     > simply looking at these sort of (hidden) R functions.
>
>     > Thanks again, Adrian
>
> Apropos "not the right tool".  I'm a bit astonished that nobody
> mentioned the fact R already provides "the tool" to
> automatically compare all example outputs with a previous
> version (of the packages example outputs):
>
> *THE* manual (every package writer should know about,
>  re-read/browse about once a year, and search in for such questions):
>
> "Writing R Extensions", section Package subdirectories
> ----------------------------
> (e.g. on the CRAN master in Vienna,
>  http://cran.r-project.org/doc/manuals/R-exts.html#Package-subdirectories )
> says
>
> |    If directory 'tests' has a subdirectory 'Examples' containing a file
> |    'PKG-Ex.Rout.save', this is compared to the output file for running the
> |    examples when the latter are checked.
>
> So: After an 'R CMD check <PKG>' you only need to take and
> keep the  <PKG>-Ex.Rout  file that is produced (in the
> PKG.Rcheck/ directory), and save it into <PKG>/tests/<PKG>-Ex.Rout.save
> and from then on, every time you run R CMD check <PKG>  the
> comparison will be made.
>
> Martin Maechler, ETH Zurich



-- 
Adrian Dusa
University of Bucharest
Romanian Social Data Archive
1, Schitu Magureanu Bd.
050025 Bucharest sector 5
Romania
Tel.:+40 21 3126618 \
        +40 21 3120210 / int.101
Fax: +40 21 3158391


From rowe at muxspace.com  Mon Jun 16 14:26:53 2014
From: rowe at muxspace.com (Brian Lee Yung Rowe)
Date: Mon, 16 Jun 2014 08:26:53 -0400
Subject: [Rd] index.search
In-Reply-To: <21406.40353.259201.480277@stat.math.ethz.ch>
References: <CAJ=0CtANJ8UALh8bwv+CceC75+sAmm-SEhNsFiqd=XUjpbs_tg@mail.gmail.com>
	<CADwqtCNrh5v1vgMtoJWW7Pd+m+xs4n0diXC8mZA=qeqbngLFiw@mail.gmail.com>
	<CAJ=0CtCuZZF2d7eWZzv96myB8cd88Pyks=uFdNiJdcxzbcnzhA@mail.gmail.com>
	<CADwqtCNUjqsDStxxuo5w7WpK+7wCuTcruwLV=PTFKKTbVmW2NA@mail.gmail.com>
	<CAJ=0CtBD32=SzJi7Zf_DR2THoOiZ3L32MHtzW3+a0V+VE-JvAg@mail.gmail.com>
	<21406.40353.259201.480277@stat.math.ethz.ch>
Message-ID: <5CF398D9-6CD3-4B96-8C89-C7D1975B8E16@muxspace.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140616/fb8d53b8/attachment.pl>

From murdoch.duncan at gmail.com  Mon Jun 16 14:54:29 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 16 Jun 2014 08:54:29 -0400
Subject: [Rd] index.search
In-Reply-To: <21406.40353.259201.480277@stat.math.ethz.ch>
References: <CAJ=0CtANJ8UALh8bwv+CceC75+sAmm-SEhNsFiqd=XUjpbs_tg@mail.gmail.com>	<CADwqtCNrh5v1vgMtoJWW7Pd+m+xs4n0diXC8mZA=qeqbngLFiw@mail.gmail.com>	<CAJ=0CtCuZZF2d7eWZzv96myB8cd88Pyks=uFdNiJdcxzbcnzhA@mail.gmail.com>	<CADwqtCNUjqsDStxxuo5w7WpK+7wCuTcruwLV=PTFKKTbVmW2NA@mail.gmail.com>	<CAJ=0CtBD32=SzJi7Zf_DR2THoOiZ3L32MHtzW3+a0V+VE-JvAg@mail.gmail.com>
	<21406.40353.259201.480277@stat.math.ethz.ch>
Message-ID: <539EE905.8050207@gmail.com>

On 16/06/2014 3:32 AM, Martin Maechler wrote:
> >>>>> Adrian Du?a <dusa.adrian at unibuc.ro>
> >>>>>     on Mon, 16 Jun 2014 08:33:59 +0300 writes:
>
>      > On Mon, Jun 16, 2014 at 6:37 AM, Gabriel Becker
>      > <gmbecker at ucdavis.edu> wrote:
>      >> [...]  You can. This is valid R source, so the parser
>      >> will understand it
>      >>
>      >> expr = parse(text= example("deMorgan", package="QCA",
>      >> give.lines=TRUE))
>      >>
>      >> You can then evaluate some or all of that expression
>      >> using either R's own eval package or, e.g. Hadley
>      >> Wickham's evaluate package (for your particular usecase
>      >> evaluate will be easier I think).
>
>      > Oh, I see...! In that case I can use it, of course.  Did
>      > install the evaluate package, although one would expect
>      > some better documentation (no examples at all, especially
>      > at the main evaluate function).
>
>
>      >>> [...]
>      >> index.search is an unexported function, which means that
>      >> it is subject to change in how it behaves without notice
>      >> or even externally available reasons. You can get it via
>      >> :::, but again, it's really not the right tool here, and
>      >> not safe to use in general in code you expect to keep
>      >> working.
>
>      > Yes, I figured that much.  Of course it's not meant to be
>      > used in any decently working code, but I learn heavily by
>      > simply looking at these sort of (hidden) R functions.
>
>      > Thanks again, Adrian
>
> Apropos "not the right tool".  I'm a bit astonished that nobody
> mentioned the fact R already provides "the tool" to
> automatically compare all example outputs with a previous
> version (of the packages example outputs):
>
> *THE* manual (every package writer should know about,
>   re-read/browse about once a year, and search in for such questions):
>
> "Writing R Extensions", section Package subdirectories
> ----------------------------
> (e.g. on the CRAN master in Vienna,
>   http://cran.r-project.org/doc/manuals/R-exts.html#Package-subdirectories )
> says
>
> |    If directory 'tests' has a subdirectory 'Examples' containing a file
> |    'PKG-Ex.Rout.save', this is compared to the output file for running the
> |    examples when the latter are checked.
>
> So: After an 'R CMD check <PKG>' you only need to take and
> keep the  <PKG>-Ex.Rout  file that is produced (in the
> PKG.Rcheck/ directory), and save it into <PKG>/tests/<PKG>-Ex.Rout.save
> and from then on, every time you run R CMD check <PKG>  the
> comparison will be made.

It's also worth mentioning that there is something similar to test for 
changes to vignettes:

> If there is a target output file .Rout.save in the vignette source 
> directory, the output from running the code in that vignette is 
> compared with the target output file and any differences are reported 
> (but not recorded in the log file). 

The slightly surprising thing is that R CMD check doesn't produce 
<vignette>.Rout; the file that is compared to <vignette>.Rout.save is 
<vignette>.log.

Duncan Murdoch


From dusa.adrian at unibuc.ro  Mon Jun 16 17:51:51 2014
From: dusa.adrian at unibuc.ro (=?UTF-8?B?QWRyaWFuIER1yJlh?=)
Date: Mon, 16 Jun 2014 18:51:51 +0300
Subject: [Rd] index.search
In-Reply-To: <21406.40353.259201.480277@stat.math.ethz.ch>
References: <CAJ=0CtANJ8UALh8bwv+CceC75+sAmm-SEhNsFiqd=XUjpbs_tg@mail.gmail.com>
	<CADwqtCNrh5v1vgMtoJWW7Pd+m+xs4n0diXC8mZA=qeqbngLFiw@mail.gmail.com>
	<CAJ=0CtCuZZF2d7eWZzv96myB8cd88Pyks=uFdNiJdcxzbcnzhA@mail.gmail.com>
	<CADwqtCNUjqsDStxxuo5w7WpK+7wCuTcruwLV=PTFKKTbVmW2NA@mail.gmail.com>
	<CAJ=0CtBD32=SzJi7Zf_DR2THoOiZ3L32MHtzW3+a0V+VE-JvAg@mail.gmail.com>
	<21406.40353.259201.480277@stat.math.ethz.ch>
Message-ID: <CAJ=0CtCq3-rj95zk0G=3PVHcoyMAQfhiY7b=V_q4h_sY0tHSUg@mail.gmail.com>

On Mon, Jun 16, 2014 at 10:32 AM, Martin Maechler
<maechler at stat.math.ethz.ch> wrote:
> [...]
>
> Apropos "not the right tool".  I'm a bit astonished that nobody
> mentioned the fact R already provides "the tool" to
> automatically compare all example outputs with a previous
> version (of the packages example outputs):

As appealing as this is, while trying to figure out a solution of my
own (until Martin's email), I think I've succeeded in creating a
rather useful function which allows fine grained control over each and
every line of code in the examples sections:

#############
helpfiles <- c(
"allExpressions",
"calibrate",
"createMatrix",
"deMorgan",
"demoChart",
"eqmcc",
"factorize",
"findSubsets",
"findSupersets",
"findTh",
"getRow",
"pof",
"solveChart",
"superSubset",
"truthTable"
)

testQCAmaybe <- function() {
    results <- vector(mode="list", length=length(helpfiles))
    names(results) <- helpfiles

    for (i in seq(length(helpfiles))) {
        Rdfile <- file.path(find.package("QCA"), paste(helpfiles[i],
".Rd", sep=""))
        commands <- parse(text=capture.output(tools::Rd2ex(Rdfile)))

        results[[i]] <- vector(mode="list", length=length(commands))
        names(results[[i]]) <- commands
        for (j in seq(length(commands))) {
            results[[i]][[j]] <-
suppressWarnings(capture.output(eval(commands[j])))
        }
    }
    return(results)
}
#############

Using all.equal(), over the entire list or sequentially over parts of
it quickly identifies sources of difference.

I hope this helps anyone,
Adrian


-- 
Adrian Dusa
University of Bucharest
Romanian Social Data Archive
1, Schitu Magureanu Bd.
050025 Bucharest sector 5
Romania
Tel.:+40 21 3126618 \
        +40 21 3120210 / int.101
Fax: +40 21 3158391


From skyebend at skyeome.net  Mon Jun 16 19:18:00 2014
From: skyebend at skyeome.net (Skye Bender-deMoll)
Date: Mon, 16 Jun 2014 10:18:00 -0700
Subject: [Rd] what is the current correct repos structure for mac osx
 binaries?
In-Reply-To: <429A4CCF-F996-4C40-9A80-68373348EED4@r-project.org>
References: <539B700F.7080902@skyeome.net>
	<429A4CCF-F996-4C40-9A80-68373348EED4@r-project.org>
Message-ID: <539F26C8.2020904@skyeome.net>

Dear R-devel,

Apologies for the confusing typo in the reported paths my previous 
question, thanks to Simon for providing the answer that the default 
repository type on the mac is now "mac.binary.mavericks" not 
"mac.binary" as the docs for install.packages state.

Perhaps the docs for install packages could be updated something like:


...
type  character, indicating the type of package to download and install

Possible values are (currently) "source", "mac.binary.BUILD_NAME" and 
"win.binary". The BUILD_NAME on OSX is determined internally by ???.
...


I'm still not quite clear how the CRAN-like repository should be 
structured for OSX.  CRAN seems to include .tgz packages in both

http://cran.r-project.org/bin/macosx/contrib/3.1/

and

http://cran.r-project.org/bin/macosx/mavericks/contrib/3.1/

The directory contents are not identical, but both include packages 
built as recently as today.  Is bin/macosx/contrib/3.1/  a snowleopard 
build?  Do I need to maintain two directories as well?

It seems like if I put my packages in

http://foo/bin/macosx/contrib/3.1/

the mavericks machines won't find them.  But if I put the packages in

http://foo/bin/macosx/mavericks/contrib/3.1/

people with the snowleopard build wont find them.  Perhaps this is the 
desired behavior if the mavericks binaries are not snowleopard compatible?

thanks again for your help,
  -skye





On 06/13/2014 05:22 PM, Simon Urbanek wrote:
>
> On Jun 13, 2014, at 5:41 PM, Skye Bender-deMoll <skyebend at skyeome.net> wrote:
>
>> Dear R-developers,
>>
>> As part of our package building process, we maintain internal CRAN-like repositories of our packages.  This has worked pretty well, but we are running into issues with R 3.1 and OSX mavericks.
>>
>> Specifically, machines with osx mavericks seem to, by default, expect packages to be located under a 'mavericks' sub-directory, but this is not the location reported when generating a mac.binary appropriate contrib url.
>>
>>> contrib.url('foo')
>> [1] "foo/bin/macosx/mavericks/contrib/3.1/"
>>
>>
>> If I ask where the mac binaries are on a linux machine (AND on mac mavericks machines) I get
>>
>>> contrib.url('foo',type='mac.binary')
>> [1] "foo/bin/macosx/mavericks/contrib/3.1/"
>>
>
> I don't think that is true. On all machines (Linux, OS X, ...) I get
>
>> contrib.url('foo', type='mac.binary')
> [1] "foo/bin/macosx/contrib/3.1"
>
>
> Note that the type for the mavericks build is "mac.binary.mavericks", so on all machines you also get
>
>> contrib.url('foo',type='mac.binary.mavericks')
> [1] "foo/bin/macosx/mavericks/contrib/3.1"
>
> The only difference are the defaults for pkgType - they differ by the build, but the repo structure is fixed and consistent across all platforms.
>
> Cheers,
> Simon
>
>
>>
>> But the OSX machine gives an error and fails to locate the packages if they are located at foo/bin/macosx/contrib/3.1/
>>
>> So where are the mac binaries supposed to located in a CRAN-like repository so that they can be installed on a mac with the default install command?  And is there a way for a non-mac machine (i.e. our linux deploy server) to determine that directory other than contrib.url(,type='mac.binary) ?
>>
>> thanks for your help,
>> -skye
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>


From therneau at mayo.edu  Mon Jun 16 20:35:33 2014
From: therneau at mayo.edu (Therneau, Terry M., Ph.D.)
Date: Mon, 16 Jun 2014 13:35:33 -0500
Subject: [Rd] model.frame and parent environment
Message-ID: <d46aec$hcl2i9@ironport9.mayo.edu>

Someone has reported a problem with predict.coxph that I can't seem to solve.  The 
underlying issue is with model.frame.coxph; the same issue is also found in lm so I'll use 
that for the example.

--------------------------

 > test <- data.frame(y = 1:10 + runif(10), x=1:10)

 > myfun <- function(formula, nd) {
     fit <- lm(formula, data=nd, model=FALSE)
     model.frame(fit)
     }

 > myfun(test)
Error in is.data.frame(data): object "nd" not found

--------------------

1. The key line, in both model.frame.coxph and model.frame.lm is
     eval(fcall, env, parent.frame())

and it appear (at least to me) that the parent.frame() part of this is effectively ignored 
when fcall is itself a reference to model.frame.  I'd like to understand this better.


2. The modeling functions coxph and survreg in the survival default to model=FALSE, 
originally in mimicry of lm and glm; I don't know when R changed the default to model=TRUE 
for lm and glm.  One possible response to my question would be advice to change my 
routine's defaults too.  I'm somewhat reluctant since I work with a few very large data 
sets, but would entertain that discussion as well.   I'd still like to understand how 
model.frame could be made to work under the current regimen.

Terry Therneau


From simon.urbanek at r-project.org  Mon Jun 16 20:32:23 2014
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 16 Jun 2014 14:32:23 -0400
Subject: [Rd] what is the current correct repos structure for mac osx
	binaries?
In-Reply-To: <539F26C8.2020904@skyeome.net>
References: <539B700F.7080902@skyeome.net>
	<429A4CCF-F996-4C40-9A80-68373348EED4@r-project.org>
	<539F26C8.2020904@skyeome.net>
Message-ID: <B4ADE400-DBCC-43CC-B3D2-3C548BF8B8D2@r-project.org>


On Jun 16, 2014, at 1:18 PM, Skye Bender-deMoll <skyebend at skyeome.net> wrote:

> Dear R-devel,
> 
> Apologies for the confusing typo in the reported paths my previous question, thanks to Simon for providing the answer that the default repository type on the mac is now "mac.binary.mavericks" not "mac.binary" as the docs for install.packages state.
> 

That is incorrect. The default varies by the distribution you use. For the "regular" binary based on 10.6+ it is "mac.binary". For the special Mavericks distribution it is "mac.binary.mavericks". 


> Perhaps the docs for install packages could be updated something like:
> 
> 
> ...
> type  character, indicating the type of package to download and install
> 
> Possible values are (currently) "source", "mac.binary.BUILD_NAME" and "win.binary". The BUILD_NAME on OSX is determined internally by ???.
> ...
> 
> 
> I'm still not quite clear how the CRAN-like repository should be structured for OSX.  CRAN seems to include .tgz packages in both
> 
> http://cran.r-project.org/bin/macosx/contrib/3.1/
> 
> and
> 
> http://cran.r-project.org/bin/macosx/mavericks/contrib/3.1/
> 
> The directory contents are not identical, but both include packages built as recently as today.  Is bin/macosx/contrib/3.1/  a snowleopard build?  Do I need to maintain two directories as well?
> 
> It seems like if I put my packages in
> 
> http://foo/bin/macosx/contrib/3.1/
> 
> the mavericks machines won't find them.  But if I put the packages in
> 
> http://foo/bin/macosx/mavericks/contrib/3.1/
> 
> people with the snowleopard build wont find them.  Perhaps this is the desired behavior if the mavericks binaries are not snowleopard compatible?
> 

Yes, Mavericks build is incompatible with the Snow Leopard build, that's why there are two separate distributions and two separate repositories.

Cheers,
Simon



> thanks again for your help,
> -skye
> 
> 
> 
> 
> 
> On 06/13/2014 05:22 PM, Simon Urbanek wrote:
>> 
>> On Jun 13, 2014, at 5:41 PM, Skye Bender-deMoll <skyebend at skyeome.net> wrote:
>> 
>>> Dear R-developers,
>>> 
>>> As part of our package building process, we maintain internal CRAN-like repositories of our packages.  This has worked pretty well, but we are running into issues with R 3.1 and OSX mavericks.
>>> 
>>> Specifically, machines with osx mavericks seem to, by default, expect packages to be located under a 'mavericks' sub-directory, but this is not the location reported when generating a mac.binary appropriate contrib url.
>>> 
>>>> contrib.url('foo')
>>> [1] "foo/bin/macosx/mavericks/contrib/3.1/"
>>> 
>>> 
>>> If I ask where the mac binaries are on a linux machine (AND on mac mavericks machines) I get
>>> 
>>>> contrib.url('foo',type='mac.binary')
>>> [1] "foo/bin/macosx/mavericks/contrib/3.1/"
>>> 
>> 
>> I don't think that is true. On all machines (Linux, OS X, ...) I get
>> 
>>> contrib.url('foo', type='mac.binary')
>> [1] "foo/bin/macosx/contrib/3.1"
>> 
>> 
>> Note that the type for the mavericks build is "mac.binary.mavericks", so on all machines you also get
>> 
>>> contrib.url('foo',type='mac.binary.mavericks')
>> [1] "foo/bin/macosx/mavericks/contrib/3.1"
>> 
>> The only difference are the defaults for pkgType - they differ by the build, but the repo structure is fixed and consistent across all platforms.
>> 
>> Cheers,
>> Simon
>> 
>> 
>>> 
>>> But the OSX machine gives an error and fails to locate the packages if they are located at foo/bin/macosx/contrib/3.1/
>>> 
>>> So where are the mac binaries supposed to located in a CRAN-like repository so that they can be installed on a mac with the default install command?  And is there a way for a non-mac machine (i.e. our linux deploy server) to determine that directory other than contrib.url(,type='mac.binary) ?
>>> 
>>> thanks for your help,
>>> -skye
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>> 
>> 
> 


From ripley at stats.ox.ac.uk  Mon Jun 16 23:30:40 2014
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 16 Jun 2014 22:30:40 +0100
Subject: [Rd] model.frame and parent environment
In-Reply-To: <d46aec$hcl2i9@ironport9.mayo.edu>
References: <d46aec$hcl2i9@ironport9.mayo.edu>
Message-ID: <539F6200.8040300@stats.ox.ac.uk>

On 16/06/2014 19:35, Therneau, Terry M., Ph.D. wrote:
> Someone has reported a problem with predict.coxph that I can't seem to
> solve.  The underlying issue is with model.frame.coxph; the same issue
> is also found in lm so I'll use that for the example.
>
> --------------------------
>
>  > test <- data.frame(y = 1:10 + runif(10), x=1:10)
>
>  > myfun <- function(formula, nd) {
>      fit <- lm(formula, data=nd, model=FALSE)
>      model.frame(fit)
>      }
>
>  > myfun(test)
> Error in is.data.frame(data): object "nd" not found

You have specified formula = test and given no value for nd.  Is that 
really what you intended?  It is undocumented that it works for lm().

>
> --------------------
>
> 1. The key line, in both model.frame.coxph and model.frame.lm is
>      eval(fcall, env, parent.frame())
>
> and it appear (at least to me) that the parent.frame() part of this is
> effectively ignored when fcall is itself a reference to model.frame.
> I'd like to understand this better.

Way back (ca R 1.2.0) an advocate of lexical scoping changed 
model.frame.lm to refer to an environment not a data frame for 'env'. 
That pretty fundamental change means that your sort of example is not a 
recommended way to do this: you are mixing scoping models.

> 2. The modeling functions coxph and survreg in the survival default to
> model=FALSE, originally in mimicry of lm and glm; I don't know when R
 > changed the default to model=TRUE for lm and glm.  One possible response

I am not sure R ever did: model = TRUE was the default 16 years ago at 
the beginning of the CVS/SVN archive.

> to my question would be advice to change my routine's defaults too.  I'm
> somewhat reluctant since I work with a few very large data sets, but
> would entertain that discussion as well.   I'd still like to understand
> how model.frame could be made to work under the current regimen.

For smaller problems using model = TRUE is the most robust solution.  As 
the components of the model frame can be changed after fitting, there is 
no way to guarantee to recreate the model frame, so to be sure you need 
to store it.

If you called myfun(y ~ x, test) it will look for 'nd' in the global 
environment, the environment of the formula.  One way to get that to 
work more often is something like

myfun <- function(formula, nd) {
      qnd <- substitute(nd)
      fit <- lm(formula, data=nd, model=FALSE)
      fit$call$data <- qnd
      model.frame(fit)
}

so it looks for the value of 'nd' instead.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From therneau at mayo.edu  Tue Jun 17 00:12:32 2014
From: therneau at mayo.edu (Therneau, Terry M., Ph.D.)
Date: Mon, 16 Jun 2014 17:12:32 -0500
Subject: [Rd] model.frame and parent environment
In-Reply-To: <539F38F5.9090902@mayo.edu>
References: <539F38F5.9090902@mayo.edu>
Message-ID: <27747b$8rkckh@ironport10.mayo.edu>

I had a typo in the prior example when transcribing from R to the message, now corrected 
below.  (The call to myfun).
   My apologies for that.  Corrected message below.

Someone has reported a problem with predict.coxph that I can't seem to solve.  The
underlying issue is with model.frame.coxph; the same issue is also found in lm so I'll use
that for the example.

--------------------------

> test <- data.frame(y = 1:10 + runif(10), x=1:10)

> myfun <- function(formula, nd) {
     fit <- lm(formula, data=nd, model=FALSE)
     model.frame(fit)
     }

> myfun( y~x, test)
Error in is.data.frame(data): object "nd" not found

--------------------

1. The key line, in both model.frame.coxph and model.frame.lm is
     eval(fcall, env, parent.frame())

and it appear (at least to me) that the parent.frame() part of this is effectively ignored
when fcall is itself a reference to model.frame.  I'd like to understand this better.


2. The modeling functions coxph and survreg in the survival default to model=FALSE,
originally in mimicry of lm and glm; I don't know when R changed the default to model=TRUE
for lm and glm.  One possible response to my question would be advice to change my
routine's defaults too.  I'm somewhat reluctant since I work with a few very large data
sets, but would entertain that discussion as well.   I'd still like to understand how
model.frame could be made to work under the current regimen.

Terry Therneau


From radhakrishnan.mohan at gmail.com  Tue Jun 17 08:43:10 2014
From: radhakrishnan.mohan at gmail.com (rmohan)
Date: Mon, 16 Jun 2014 23:43:10 -0700 (PDT)
Subject: [Rd] rJava Java debugger API
Message-ID: <1402987390011-4692222.post@n4.nabble.com>

Hi,
     I use rJava and call Java code that uses JVMTI code like this

      VM vm = VM.getVM();
       Universe universe = vm.getUniverse();
        CollectedHeap heap = universe.heap();

This code attaches to another JVM and to get its internals. This is legal
Java and it works. But when I use rJava to call this code, the call is
successfull and it throws an error. I believe there  is Java native
Interface involved in the JVM and it seems to affect R. rJava is 0.9

> version
               _                           
platform       x86_64-apple-darwin10.8.0   
arch           x86_64                      
os             darwin10.8.0                
system         x86_64, darwin10.8.0        
status                                     
major          3                           
minor          1.0                         
year           2014                        
month          04                          
day            10                          
svn rev        65387                       
language       R                           
version.string R version 3.1.0 (2014-04-10)
nickname       Spring Dance                


Thanks,
Mohan

Error: C stack usage  140730070087404 is too close to the limit
Error: C stack usage  140730070156700 is too close to the limit
> Warning: stack imbalance in '.Call', 59 then -1
Warning: stack imbalance in '{', 56 then -4

 *** caught bus error ***
address 0x100583fd8, cause 'non-existent physical address'


 *** caught bus error ***
address 0x100583fd8, cause 'non-existent physical address'
> 
Traceback:
 1: run(timeoutMs)
 2: service(timeout)

Possible actions:
1: abort (with core dump, if enabled)
2: normal R exit
3: exit R without saving workspace
4: exit R saving workspace
Selection: run(10)


 *** caught segfault ***
address 0x20057ea40, cause 'memory not mapped'

Traceback:
 1: run(timeoutMs)
 2: service(timeout)

Possible actions:
1: abort (with core dump, if enabled)
2: normal R exit
3: exit R without saving workspace
4: exit R saving workspace



--
View this message in context: http://r.789695.n4.nabble.com/rJava-Java-debugger-API-tp4692222.html
Sent from the R devel mailing list archive at Nabble.com.


From therneau at mayo.edu  Tue Jun 17 14:52:16 2014
From: therneau at mayo.edu (Therneau, Terry M., Ph.D.)
Date: Tue, 17 Jun 2014 07:52:16 -0500
Subject: [Rd] model.frame and parent environment
In-Reply-To: <539F7D39.4040606@gmail.com>
References: <d46aec$hcl2i9@ironport9.mayo.edu>
	<CA+COutdDhFezrrQcg2v_fhMoCBb1yXPTe2u+BuSv5R+q1SF-Hw@mail.gmail.com>
	<27747b$8rkcdl@ironport10.mayo.edu> <539F7D39.4040606@gmail.com>
Message-ID: <d46aec$hcvg83@ironport9.mayo.edu>

Duncan,
   You missed the point.  (I sometimes write too tersely, so I take the blame.)  Users are 
writing their own "myfun".  I want model.frame to work for them, without forcing the user 
to learn environment trickery.   The actual question from the user was a call to
        fit <- coxph(formula, data=nd)
        predict(fit, type='expected')
Within the predict call it is model.frame that fails, in the same way that it does in my 
simplified example.

Now within model.frame.coxph (and model.frame.lm) there is the line
       eval(fexpr, env, parent.frame())
where env = environment of the formula and fexpr is an unevaluated call to model.frame. 
My underneath question: why is the enclosure argment ignored in this particular case? 
Parent.frame includes "nd".

I have to admit that I find the non-functional parts of scheme, which R inherited, 
continue to leave me with the emotional response of "why would you add such nastiness to a 
language"?   This leaves me at a disadvantage, I suspect, when trying to trace these 
things out.  I've not yet seen a situation where I would want a formula to reference 
non-local information.

Aside: The horrible decision in S to have "data=" replace rather than augment the scope 
for variable matching caused a lot of grief when calling a model inside a function.  The R 
paradym fixed that, for which I am grateful, but with serious consequences.

Terry T.




On 06/16/2014 06:26 PM, Duncan Murdoch wrote:
> On 16/06/2014, 6:09 PM, Therneau, Terry M., Ph.D. wrote:
>> Copy/paste error in creating my message, should have been:
>>     myfun(y~x, test)
>>
>> The problem is still real.
>
> I believe you that there's a real problem, I just wasn't sure what it was.
>
> When I try your corrected code I get this:
>
> Error in is.data.frame(data) : object 'nd' not found
>
> which is presumably the problem you had.  A simple fix is to add the line
>
> environment(formula) <- environment()
>
> at the start of myfun.  This tells R functions to look in the local
> environment, where it will find nd.
>
> Duncan Murdoch
>
>
>>
>>
>> On 06/16/2014 04:27 PM, Duncan Murdoch wrote:
>>> I think something went wrong in your example: myfun takes a formula as well as a
>>> dataframe, and you only passed the dataframe.
>>>
>>> Duncan Murdoch
>>>
>>>
>>
>


From therneau at mayo.edu  Tue Jun 17 15:24:43 2014
From: therneau at mayo.edu (Therneau, Terry M., Ph.D.)
Date: Tue, 17 Jun 2014 08:24:43 -0500
Subject: [Rd] model.frame question
In-Reply-To: <mailman.21.1402999208.32588.r-devel@r-project.org>
References: <mailman.21.1402999208.32588.r-devel@r-project.org>
Message-ID: <27747b$8rlcr2@ironport10.mayo.edu>

Brian,
   So let me ask an r-core opinion.  Should I change the default to model=TRUE?  Survival 
is heavily used and there is something to be said for consistency within the central 
packages.  Sometimes old habits die hard, and there is a "save memory" part of me that 
hates to save a large object that likely won't be used.  Not nearly as relevant today as 
when I started my career.

   I agree that the biggest issue with model=FALSE is when someone asks for predictions 
from a saved fit, perhaps saved weeks ago, and the data has changed under our feet.  I 
have a check in predict.coxph that the number of rows in the data hasn't changed, but 
there really is no defense.

    Aside: This would mean in theory that I could also change the default to y= FALSE.  I 
discovered a few years ago that that won't fly, when I set the default for y to "not 
model"; why keep redundant copies?  Several other packages that depend on survival failed. 
  They assume fit$y is there, without checking.  The iron chains of backwards compatability...


>> >1. The key line, in both model.frame.coxph and model.frame.lm is
>> >      eval(fcall, env, parent.frame())
>> >
>> >and it appear (at least to me) that the parent.frame() part of this is
>> >effectively ignored when fcall is itself a reference to model.frame.
>> >I'd like to understand this better.

> Way back (ca R 1.2.0) an advocate of lexical scoping changed
> model.frame.lm to refer to an environment not a data frame for 'env'.
> That pretty fundamental change means that your sort of example is not a
> recommended way to do this: you are mixing scoping models.
>

This hasn't left me any wiser.  Can you expand?  As stated in another note the real issue was
	fit <- coxph(formula, data=nd)
         predict(fit, type="expected")

within a user's function.  They, not unreasonably, expected it to work without further 
trickery.  It fails because the model.frame call within predict.coxph cannot find "nd".



>> >2. The modeling functions coxph and survreg in the survival default to
>> >model=FALSE, originally in mimicry of lm and glm; I don't know when R
>   > changed the default to model=TRUE for lm and glm.  One possible response
>
> I am not sure R ever did: model = TRUE was the default 16 years ago at
> the beginning of the CVS/SVN archive.
>

> -- Brian D. Ripley, ripley at stats.ox.ac.uk Professor of Applied Statistics,
> http://www.stats.ox.ac.uk/~ripley/ University of Oxford, Tel: +44 1865 272861 (self) 1
> South Parks Road, +44 1865 272866 (PA) Oxford OX1 3TG, UK Fax: +44 1865 272595


From ripley at stats.ox.ac.uk  Tue Jun 17 16:59:10 2014
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 17 Jun 2014 15:59:10 +0100
Subject: [Rd] rJava Java debugger API
In-Reply-To: <1402987390011-4692222.post@n4.nabble.com>
References: <1402987390011-4692222.post@n4.nabble.com>
Message-ID: <53A057BE.3000408@stats.ox.ac.uk>

*Now* you tell us rJava is involved.  Its lists are accessed via 
http://www.rforge.net/rJava/

On 17/06/2014 07:43, rmohan wrote:
> Hi,
>       I use rJava and call Java code that uses JVMTI code like this
>
>        VM vm = VM.getVM();
>         Universe universe = vm.getUniverse();
>          CollectedHeap heap = universe.heap();
>
> This code attaches to another JVM and to get its internals. This is legal
> Java and it works. But when I use rJava to call this code, the call is
> successfull and it throws an error. I believe there  is Java native
> Interface involved in the JVM and it seems to affect R. rJava is 0.9
>
>> version
>                 _
> platform       x86_64-apple-darwin10.8.0
> arch           x86_64
> os             darwin10.8.0
> system         x86_64, darwin10.8.0
> status
> major          3
> minor          1.0
> year           2014
> month          04
> day            10
> svn rev        65387
> language       R
> version.string R version 3.1.0 (2014-04-10)
> nickname       Spring Dance
>
>
> Thanks,
> Mohan
>
> Error: C stack usage  140730070087404 is too close to the limit
> Error: C stack usage  140730070156700 is too close to the limit
>> Warning: stack imbalance in '.Call', 59 then -1
> Warning: stack imbalance in '{', 56 then -4
>
>   *** caught bus error ***
> address 0x100583fd8, cause 'non-existent physical address'
>
>
>   *** caught bus error ***
> address 0x100583fd8, cause 'non-existent physical address'
>>
> Traceback:
>   1: run(timeoutMs)
>   2: service(timeout)
>
> Possible actions:
> 1: abort (with core dump, if enabled)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
> Selection: run(10)
>
>
>   *** caught segfault ***
> address 0x20057ea40, cause 'memory not mapped'
>
> Traceback:
>   1: run(timeoutMs)
>   2: service(timeout)
>
> Possible actions:
> 1: abort (with core dump, if enabled)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
>
>
>
> --
> View this message in context: http://r.789695.n4.nabble.com/rJava-Java-debugger-API-tp4692222.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From winstonchang1 at gmail.com  Tue Jun 17 21:21:28 2014
From: winstonchang1 at gmail.com (Winston Chang)
Date: Tue, 17 Jun 2014 14:21:28 -0500
Subject: [Rd] R CMD check warning with S3 method
Message-ID: <CAFOpNVGGT+tpdAZ42Q+jkWntAE+N=Ctq_D5pKbVVHx7F6_m0RQ@mail.gmail.com>

I'm getting an R CMD check warning with a package (call it package A)
that defines an S3 method but not the generic. The generic is defined
in another package (package B). Package A imports the S3 generic from
B. And there's one additional detail: the generic overrides a function
in the stats package.

I've created a minimal test package which reproduces the problem:
  https://github.com/wch/s3methodtest

In this case:
- the package imports dplyr, for the dplyr::filter S3 generic
- the package defines a S3 method filter.test
- it imports dplyr, which defines a filter S3 generic

The warning doesn't occur when package dplyr is in Depends instead of
Imports. It also doesn't occur if the method is for a generic that
does not override an existing function like stats::filter. For
example, if instead of filter.test, I define select.test
(dplyr::select is also an S3 generic), then there's no warning.

This warning seems incorrect. Is this a bug? I'm interested in
submitting the package to CRAN soon, so any advice on what to do is
appreciated.

Thanks,
-Winston


From winstonchang1 at gmail.com  Tue Jun 17 22:08:11 2014
From: winstonchang1 at gmail.com (Winston Chang)
Date: Tue, 17 Jun 2014 15:08:11 -0500
Subject: [Rd] R CMD check warning with S3 method
In-Reply-To: <CAFOpNVGGT+tpdAZ42Q+jkWntAE+N=Ctq_D5pKbVVHx7F6_m0RQ@mail.gmail.com>
References: <CAFOpNVGGT+tpdAZ42Q+jkWntAE+N=Ctq_D5pKbVVHx7F6_m0RQ@mail.gmail.com>
Message-ID: <CAFOpNVH6t487eY8GQh=pvZJXRYpj2eEYRyOEZ4ZR=8rOKkskYA@mail.gmail.com>

I forgot to add this - here's the warning:

* checking S3 generic/method consistency ... WARNING
Warning: declared S3 method 'filter.test' not found
See section 'Generic functions and methods' of the 'Writing R
Extensions' manual.


On Tue, Jun 17, 2014 at 2:21 PM, Winston Chang <winstonchang1 at gmail.com> wrote:
> I'm getting an R CMD check warning with a package (call it package A)
> that defines an S3 method but not the generic. The generic is defined
> in another package (package B). Package A imports the S3 generic from
> B. And there's one additional detail: the generic overrides a function
> in the stats package.
>
> I've created a minimal test package which reproduces the problem:
>   https://github.com/wch/s3methodtest
>
> In this case:
> - the package imports dplyr, for the dplyr::filter S3 generic
> - the package defines a S3 method filter.test
> - it imports dplyr, which defines a filter S3 generic
>
> The warning doesn't occur when package dplyr is in Depends instead of
> Imports. It also doesn't occur if the method is for a generic that
> does not override an existing function like stats::filter. For
> example, if instead of filter.test, I define select.test
> (dplyr::select is also an S3 generic), then there's no warning.
>
> This warning seems incorrect. Is this a bug? I'm interested in
> submitting the package to CRAN soon, so any advice on what to do is
> appreciated.
>
> Thanks,
> -Winston


From skyebend at skyeome.net  Tue Jun 17 22:38:00 2014
From: skyebend at skyeome.net (Skye Bender-deMoll)
Date: Tue, 17 Jun 2014 13:38:00 -0700
Subject: [Rd] what is the current correct repos structure for mac osx
 binaries?
In-Reply-To: <B4ADE400-DBCC-43CC-B3D2-3C548BF8B8D2@r-project.org>
References: <539B700F.7080902@skyeome.net>
	<429A4CCF-F996-4C40-9A80-68373348EED4@r-project.org>
	<539F26C8.2020904@skyeome.net>
	<B4ADE400-DBCC-43CC-B3D2-3C548BF8B8D2@r-project.org>
Message-ID: <53A0A728.7070408@skyeome.net>

Please forgive another comment on this topic.

The 'type' argument to tools::write_PACKAGES doesn't currently accept 
the 'mac.binary.mavericks' value.  It seems like it should, to make it 
possible to pass the same 'type' argument to all of the package 
generation and manipulation functions?

 > tools::write_PACKAGES(type='mac.binary.mavericks')
Error in match.arg(type) :
   'arg' should be one of ?source?, ?mac.binary?, ?win.binary?

best,
  -skye

On 06/16/2014 11:32 AM, Simon Urbanek wrote:
>
> On Jun 16, 2014, at 1:18 PM, Skye Bender-deMoll <skyebend at skyeome.net> wrote:
>
>> Dear R-devel,
>>
>> Apologies for the confusing typo in the reported paths my previous question, thanks to Simon for providing the answer that the default repository type on the mac is now "mac.binary.mavericks" not "mac.binary" as the docs for install.packages state.
>>
>
> That is incorrect. The default varies by the distribution you use. For the "regular" binary based on 10.6+ it is "mac.binary". For the special Mavericks distribution it is "mac.binary.mavericks".


From hb at biostat.ucsf.edu  Tue Jun 17 23:27:14 2014
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Tue, 17 Jun 2014 14:27:14 -0700
Subject: [Rd] PATCH: Avoiding extra copies (NAMED bumped) with source(...,
 print.eval=FALSE) ...and with print.eval=TRUE?
Message-ID: <CAFDcVCSMmgD8JZt5YFpF0H8xyO8cqHMG5MfW5rwVvK+A3hQFsQ@mail.gmail.com>

OBJECTIVE:
To update source(..., print.eval=FALSE) to not use withVisible()
unless really needed. This avoids unnecessary increases of reference
counts/NAMED introduced by withVisible(), which in turn avoids
unnecessary memory allocations and garbage collection overhead.  This
has an impact on all source():ed scripts, e.g. pre-allocation of large
matrices to save memory does *not always* help in such setups.  It is
likely to also affect the evaluation of code chunks of various
vignette engines.


BACKGROUND:
If you run the following at the prompt, you get that the assignment of
the first element does *not* cause an extra copy of 'x':

> x <- 1:2
> tracemem(x)
[1] "<0x000000001c5a7b28>"
> x[1] <- 0L
> x
[1] 0 2



However, it you source() the same code (with print.eval=FALSE; the
default), you get:

> code <- "
x <- 1:2
tracemem(x)
x[1] <- 0L
"
> source(textConnection(code))
tracemem[0x0000000010504e20 -> 0x0000000010509cd0]: eval eval withVisible source
> x
[1] 0 2

Looking at how source() works, this is because it effectively does:

> invisible(withVisible(x <- 1:2))
> invisible(withVisible(tracemem(x)))
> invisible(withVisible(x[1] <- 0L))
tracemem[0x00000000104b68a8 -> 0x00000000104b6788]: withVisible
> x
[1] 0 2


WORKAROUND HACK:
I understand that wrapping up multiple expressions into one avoids this:

> code <- "{
x <- 1:2
tracemem(x)
x[1] <- 0L
}"
> source(textConnection(code))

which you in this case can narrow down to:

code <- "
{x <- 1:2; {}}
tracemem(x)
x[1] <- 0L
"
source(textConnection(code))

but that's not my point here.  Instead, I believe R can handle this
better itself.


DISCUSSION / PATCH:
It's quite easy to patch base::source(..., print.eval=FALSE) to avoid
the extra copies, because source() uses withVisible() so that it:

(a) can show()/print() the value of each expression (when
print.eval=TRUE), as well as
(b) returning the value of the last expression evaluated.

Thus, with print.eval=FALSE, withVisible() is only needed for the very
last expression evaluated.

Here is a patch to source() that avoids calling withVisible() unless needed:

$ svn diff src/library/base/R/source.R
Index: src/library/base/R/source.R
===================================================================
--- src/library/base/R/source.R (revision 65900)
+++ src/library/base/R/source.R (working copy)
@@ -206,7 +206,10 @@
            }
        }
        if (!tail) {
-           yy <- withVisible(eval(ei, envir))
+            if (print.eval || i == Ne+echo)
+                yy <- withVisible(eval(ei, envir))
+            else
+                eval(ei, envir)
            i.symbol <- mode(ei[[1L]]) == "name"
            if (!i.symbol) {
                ## ei[[1L]] : the function "<-" or other


With this patch you get:

> source(textConnection(code), echo=TRUE, print.eval=FALSE)

> x <- 1:2
> tracemem(x)
> x[1] <- 0L


> source(textConnection(code), echo=TRUE, print.eval=TRUE)

> x <- 1:2
> tracemem(x)
[1] "<0x000000001c5675c0>"
> x[1] <- 0L
tracemem[0x000000001c5675c0 -> 0x000000001c564ad0]: eval eval withVisible source


FURTHER IMPROVEMENTS:
Looking at the internals of withVisible():

/* This is a special .Internal */
SEXP attribute_hidden do_withVisible(SEXP call, SEXP op, SEXP args, SEXP rho)
{
    SEXP x, nm, ret;

    checkArity(op, args);
    x = CAR(args);
    x = eval(x, rho);
    PROTECT(x);
    PROTECT(ret = allocVector(VECSXP, 2));
    PROTECT(nm = allocVector(STRSXP, 2));
    SET_STRING_ELT(nm, 0, mkChar("value"));
    SET_STRING_ELT(nm, 1, mkChar("visible"));
    SET_VECTOR_ELT(ret, 0, x);
    SET_VECTOR_ELT(ret, 1, ScalarLogical(R_Visible));
    setAttrib(ret, R_NamesSymbol, nm);
    UNPROTECT(3);
    return ret;
}

Not sure exactly where the reference count (NAMED is updated) is
bumped, but *if it is possible to evaluate the expression and inspect
if the value is "visible" or not before it happens*, then one could
imaging adding an option to withVisible() that tells it to only return
the value if the evaluated value is visible (otherwise NULL).  That
way one could avoid extra copies in most cases also with
print.eval=TRUE, e.g.

> withVisible(x[1] <- 0L)
$value
[1] 0

$visible
[1] FALSE

In other words, whenever withVisible() returns visible=FALSE, the
return values is not used by source().

Comments?

/Henrik

> sessionInfo()
R Under development (unstable) (2014-06-12 r65926)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


From ripley at stats.ox.ac.uk  Wed Jun 18 09:09:53 2014
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 18 Jun 2014 08:09:53 +0100
Subject: [Rd] what is the current correct repos structure for mac osx
 binaries?
In-Reply-To: <53A0A728.7070408@skyeome.net>
References: <539B700F.7080902@skyeome.net>	<429A4CCF-F996-4C40-9A80-68373348EED4@r-project.org>	<539F26C8.2020904@skyeome.net>	<B4ADE400-DBCC-43CC-B3D2-3C548BF8B8D2@r-project.org>
	<53A0A728.7070408@skyeome.net>
Message-ID: <53A13B41.7060205@stats.ox.ac.uk>

On 17/06/2014 21:38, Skye Bender-deMoll wrote:
> Please forgive another comment on this topic.

But it is not on the topic ... this function is run on a single directory.

> The 'type' argument to tools::write_PACKAGES doesn't currently accept
> the 'mac.binary.mavericks' value.  It seems like it should, to make it
> possible to pass the same 'type' argument to all of the package
> generation and manipulation functions?
>
>  > tools::write_PACKAGES(type='mac.binary.mavericks')
> Error in match.arg(type) :
>    'arg' should be one of ?source?, ?mac.binary?, ?win.binary?

Functions 'should' do what they are documented to do:

     type: Type of packages: currently source ?.tar.gz? archives, and
           Mac or Windows binary (?.tgz? or ?.zip?, respectively)
           packages are supported.  Defaults to ?"win.binary"? on
           Windows and to ?"source"? otherwise.

All Mac binary packages are .tgz.  We had Universal and Leopard packages 
for a long time with using type = "mac.binary" here.  The 
specializations of that type are only used where needed.

It does do the job it was designed and documented to do.

> best,
>   -skye

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From renaud at mancala.cbio.uct.ac.za  Wed Jun 18 10:11:44 2014
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Wed, 18 Jun 2014 10:11:44 +0200
Subject: [Rd] Is it possible to make install.packages compile source
 code on Unix but use shipped binary on Windows?
In-Reply-To: <539B21CD.6090704@stats.ox.ac.uk>
References: <CAHavPHE1WW4JV735EQsGMdv_-wLY8_AnfAGqzCq=k96_D-wgYw@mail.gmail.com>
	<539B21CD.6090704@stats.ox.ac.uk>
Message-ID: <CAHavPHHH8TjtpVbbrGBc+ZtTHo4HoXsUswrRcb=9bJv76w2GYQ@mail.gmail.com>

Thank you for the replies and hints.

> A 'pre-built windows binary' of what?

Sorry this was not clear, src/ contains source code for a binary
executable, which produces no .lib or .dll.
It is all fine in a R development environment:
  * On Linux, the executable is compiled and copied to
R_PACKAGE_DIR/binR_ARCH using a custom install.libs.R script.
  * Same thing on Windows, if Rtools is installed, install.packages
compiles and installs both 32 and 64 bits .exe.

> You can easily ship a DLL or .exe for use on Windows: just make use of
> configure.win and/or Makefile.win.  If you have a Makefile.win it will
> override the normal procedures for directory src.

I have tried using Makevars.win, but this requires make to be
installed (as by Rtools). So I guess using Makefile.win would also not
work, on a classic non-development geared Windows host.
Would using configure.win work without Rtools?

> OTOH, shipping something in exec will be installed everwhere.

True, although it seems that sub-directories of exec/ are actually not
installed though. Is this intentional?

> Watch out for sub-architectures: 'Windows' is in fact two platforms.  We
> have over the years seen a lot of problem with people shipping 64-bit
> Windows binaries: 32-bit Windows does not recognize those.

Indeed, and I think I properly take care of this in install.libs.R.

@Grabriel: the package is provided as a source package. This one is
installable locally from file, although in may case users actually get
it through a personal CRAN-like repository, using argument
type='both'.

Thank you.

Bests,
Renaud


From ripley at stats.ox.ac.uk  Wed Jun 18 13:20:59 2014
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 18 Jun 2014 12:20:59 +0100
Subject: [Rd] Is it possible to make install.packages compile source
 code on Unix but use shipped binary on Windows?
In-Reply-To: <CAHavPHHH8TjtpVbbrGBc+ZtTHo4HoXsUswrRcb=9bJv76w2GYQ@mail.gmail.com>
References: <CAHavPHE1WW4JV735EQsGMdv_-wLY8_AnfAGqzCq=k96_D-wgYw@mail.gmail.com>	<539B21CD.6090704@stats.ox.ac.uk>
	<CAHavPHHH8TjtpVbbrGBc+ZtTHo4HoXsUswrRcb=9bJv76w2GYQ@mail.gmail.com>
Message-ID: <53A1761B.1080504@stats.ox.ac.uk>

On 18/06/2014 09:11, Renaud Gaujoux wrote:
> Thank you for the replies and hints.
>
>> A 'pre-built windows binary' of what?
>
> Sorry this was not clear, src/ contains source code for a binary
> executable, which produces no .lib or .dll.
> It is all fine in a R development environment:
>    * On Linux, the executable is compiled and copied to
> R_PACKAGE_DIR/binR_ARCH using a custom install.libs.R script.
>    * Same thing on Windows, if Rtools is installed, install.packages
> compiles and installs both 32 and 64 bits .exe.
>
>> You can easily ship a DLL or .exe for use on Windows: just make use of
>> configure.win and/or Makefile.win.  If you have a Makefile.win it will
>> override the normal procedures for directory src.
>
> I have tried using Makevars.win, but this requires make to be
> installed (as by Rtools). So I guess using Makefile.win would also not
> work, on a classic non-development geared Windows host.
> Would using configure.win work without Rtools?

Maybe.  Read the documentation and sources for yourself (see below).

>> OTOH, shipping something in exec will be installed everywhere.
>
> True, although it seems that sub-directories of exec/ are actually not
> installed though. Is this intentional?

Yes, *and documented* (including that it should not be used for Windows 
executables).

Neither I nor R-devel is a documentation-reading service: do read 
http://www.r-project.org/posting-guide.html very carefully.


>> Watch out for sub-architectures: 'Windows' is in fact two platforms.  We
>> have over the years seen a lot of problem with people shipping 64-bit
>> Windows binaries: 32-bit Windows does not recognize those.
>
> Indeed, and I think I properly take care of this in install.libs.R.
>
> @Grabriel: the package is provided as a source package. This one is
> installable locally from file, although in may case users actually get
> it through a personal CRAN-like repository, using argument
> type='both'.
>
> Thank you.
>
> Bests,
> Renaud
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From renaud at mancala.cbio.uct.ac.za  Wed Jun 18 16:10:07 2014
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Wed, 18 Jun 2014 16:10:07 +0200
Subject: [Rd] Is it possible to make install.packages compile source
 code on Unix but use shipped binary on Windows?
In-Reply-To: <53A1761B.1080504@stats.ox.ac.uk>
References: <CAHavPHE1WW4JV735EQsGMdv_-wLY8_AnfAGqzCq=k96_D-wgYw@mail.gmail.com>
	<539B21CD.6090704@stats.ox.ac.uk>
	<CAHavPHHH8TjtpVbbrGBc+ZtTHo4HoXsUswrRcb=9bJv76w2GYQ@mail.gmail.com>
	<53A1761B.1080504@stats.ox.ac.uk>
Message-ID: <CAHavPHEZuFnGHMEK3+vCJiR5VcC1y6-HUjHT5N1dGKbLes9L1w@mail.gmail.com>

> Maybe.  Read the documentation and sources for yourself (see below).

Not working, at least in my hands, as it requires `sh`.

> Yes, *and documented*

True. I overlooked the beginning of the NB point.

> (including that it should not be used for Windows executables).

Yes, that's why I use the suggested procedure that uses
src/install.libs.R to copy compiled .exe files into bin<R_ARCH>/.

So, eventually, I guess the answer to the original question is: no,
one cannot make install.packages skip compilation of a source package,
only if on Windows, without having Rtools installed -- and in PATH.

Renaud


From plummerm at iarc.fr  Wed Jun 18 16:34:50 2014
From: plummerm at iarc.fr (Martyn Plummer)
Date: Wed, 18 Jun 2014 14:34:50 +0000
Subject: [Rd] Is it possible to make install.packages compile source
 code on Unix but use shipped binary on Windows?
In-Reply-To: <CAHavPHEZuFnGHMEK3+vCJiR5VcC1y6-HUjHT5N1dGKbLes9L1w@mail.gmail.com>
References: <CAHavPHE1WW4JV735EQsGMdv_-wLY8_AnfAGqzCq=k96_D-wgYw@mail.gmail.com>
	<539B21CD.6090704@stats.ox.ac.uk>
	<CAHavPHHH8TjtpVbbrGBc+ZtTHo4HoXsUswrRcb=9bJv76w2GYQ@mail.gmail.com>
	<53A1761B.1080504@stats.ox.ac.uk>
	<CAHavPHEZuFnGHMEK3+vCJiR5VcC1y6-HUjHT5N1dGKbLes9L1w@mail.gmail.com>
Message-ID: <1403102090.17749.135.camel@braque.iarc.fr>

On Wed, 2014-06-18 at 16:10 +0200, Renaud Gaujoux wrote:
> > Maybe.  Read the documentation and sources for yourself (see below).
> 
> Not working, at least in my hands, as it requires `sh`.
> 
> > Yes, *and documented*
> 
> True. I overlooked the beginning of the NB point.
> 
> > (including that it should not be used for Windows executables).
> 
> Yes, that's why I use the suggested procedure that uses
> src/install.libs.R to copy compiled .exe files into bin<R_ARCH>/.
> 
> So, eventually, I guess the answer to the original question is: no,
> one cannot make install.packages skip compilation of a source package,
> only if on Windows, without having Rtools installed -- and in PATH.

But why would you want to? I don't understand why you are making life so
hard for yourself.

It isn't hard to set up Rtools on Windows and you only need to do it
once. Then you build a binary package on your development system to
distribute to your users.

Without even considering any technical details there is a purely
strategic issue here. If a system has been set up that is robust and
widely tested, like the R packaging system, you are much better off
working with it than trying to subvert it.  

Martyn


> Renaud
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-----------------------------------------------------------------------
This message and its attachments are strictly confidenti...{{dropped:8}}


From renaud at mancala.cbio.uct.ac.za  Thu Jun 19 09:16:43 2014
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Thu, 19 Jun 2014 09:16:43 +0200
Subject: [Rd] Is it possible to make install.packages compile source
 code on Unix but use shipped binary on Windows?
In-Reply-To: <1403102090.17749.135.camel@braque.iarc.fr>
References: <CAHavPHE1WW4JV735EQsGMdv_-wLY8_AnfAGqzCq=k96_D-wgYw@mail.gmail.com>
	<539B21CD.6090704@stats.ox.ac.uk>
	<CAHavPHHH8TjtpVbbrGBc+ZtTHo4HoXsUswrRcb=9bJv76w2GYQ@mail.gmail.com>
	<53A1761B.1080504@stats.ox.ac.uk>
	<CAHavPHEZuFnGHMEK3+vCJiR5VcC1y6-HUjHT5N1dGKbLes9L1w@mail.gmail.com>
	<1403102090.17749.135.camel@braque.iarc.fr>
Message-ID: <CAHavPHGpc-_12U6_W4S+ZUrNebOmRrsu=2od3ObTZfx2DX9O=g@mail.gmail.com>

Hi Martyn,

> It isn't hard to set up Rtools on Windows and you only need to do it
> once. Then you build a binary package on your development system to
> distribute to your users.

Yes, but since I am working on Linux, it is slightly more steps
involved in order to generate a windows binary (even using a virtual
machine), compared to build and push source packages to my repository,
for which I have shell scripts and make files that do that in seconds
and in batch mode. When working in a fast bug fix-test cycle with
windows users testing things out often times a day, these extra steps
take much time overall.

> Without even considering any technical details there is a purely
> strategic issue here. If a system has been set up that is robust and
> widely tested, like the R packaging system, you are much better off
> working with it than trying to subvert it.

Agreed completely. I really like R cross-platform packaging and
checking system, and was just wondering if this conditional
compilation option was possible using the flexibility of this very
system.

Renaud


From karl.forner at gmail.com  Thu Jun 19 15:10:18 2014
From: karl.forner at gmail.com (Karl Forner)
Date: Thu, 19 Jun 2014 15:10:18 +0200
Subject: [Rd] isOpen() misbehaviour
Message-ID: <CAMd4_AcYsLBH-7yUzeT4kMVRfBWUzZZxK3SNRZmb0vKe=5z+cQ@mail.gmail.com>

Hello,

>From the doc, it says:
 "isOpen returns a logical value, whether the connection is currently open."

But actually it seems to die on closed connections:
> con <- file()
> isOpen(con)
[1] TRUE
> close(con)
> isOpen(con)
Error in isOpen(con) : invalid connection

Is it expected ?
Tested on R-3.0.2 and R version 3.1.0 Patched (2014-06-11 r65921) on
linux x86_64

Karl


From jorismeys at gmail.com  Thu Jun 19 15:22:30 2014
From: jorismeys at gmail.com (Joris Meys)
Date: Thu, 19 Jun 2014 15:22:30 +0200
Subject: [Rd] isOpen() misbehaviour
In-Reply-To: <CAMd4_AcYsLBH-7yUzeT4kMVRfBWUzZZxK3SNRZmb0vKe=5z+cQ@mail.gmail.com>
References: <CAMd4_AcYsLBH-7yUzeT4kMVRfBWUzZZxK3SNRZmb0vKe=5z+cQ@mail.gmail.com>
Message-ID: <CAO1zAVZrtbaVf8gdTFe0LG+BS6RCfJ6jDxJPwWmjWzrbLTAbpg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140619/78b5c1bc/attachment.pl>

From karl.forner at gmail.com  Thu Jun 19 15:55:31 2014
From: karl.forner at gmail.com (Karl Forner)
Date: Thu, 19 Jun 2014 15:55:31 +0200
Subject: [Rd] isOpen() misbehaviour
In-Reply-To: <CAO1zAVZrtbaVf8gdTFe0LG+BS6RCfJ6jDxJPwWmjWzrbLTAbpg@mail.gmail.com>
References: <CAMd4_AcYsLBH-7yUzeT4kMVRfBWUzZZxK3SNRZmb0vKe=5z+cQ@mail.gmail.com>
	<CAO1zAVZrtbaVf8gdTFe0LG+BS6RCfJ6jDxJPwWmjWzrbLTAbpg@mail.gmail.com>
Message-ID: <CAMd4_Af36cdVY45iOMJVneCXV_chgdM+RX5Q8dFN2YXuWuvHTA@mail.gmail.com>

Thanks Joris, it makes sense now, though the doc is a bit misleading.

On Thu, Jun 19, 2014 at 3:22 PM, Joris Meys <jorismeys at gmail.com> wrote:
> Hi Karl,
>
> that is expected. The moment you close a connection, it is destroyed as well
> (see ?close). A destroyed connection cannot be tested. In fact, I've used
> isOpen() only in combination with the argument rw.
>
>> con <- file("clipboard",open="r")
>> isOpen(con,"write")
> [1] FALSE
>
> cheers
>
>
> On Thu, Jun 19, 2014 at 3:10 PM, Karl Forner <karl.forner at gmail.com> wrote:
>>
>> Hello,
>>
>> >From the doc, it says:
>>  "isOpen returns a logical value, whether the connection is currently
>> open."
>>
>> But actually it seems to die on closed connections:
>> > con <- file()
>> > isOpen(con)
>> [1] TRUE
>> > close(con)
>> > isOpen(con)
>> Error in isOpen(con) : invalid connection
>>
>> Is it expected ?
>> Tested on R-3.0.2 and R version 3.1.0 Patched (2014-06-11 r65921) on
>> linux x86_64
>>
>> Karl
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>
>
> --
> Joris Meys
> Statistical consultant
>
> Ghent University
> Faculty of Bioscience Engineering
> Department of Mathematical Modelling, Statistics and Bio-Informatics
>
> tel : +32 9 264 59 87
> Joris.Meys at Ugent.be
> -------------------------------
> Disclaimer : http://helpdesk.ugent.be/e-maildisclaimer.php


From plummerm at iarc.fr  Thu Jun 19 19:15:00 2014
From: plummerm at iarc.fr (Martyn Plummer)
Date: Thu, 19 Jun 2014 17:15:00 +0000
Subject: [Rd] R CMD check warning with S3 method
In-Reply-To: <CAFOpNVGGT+tpdAZ42Q+jkWntAE+N=Ctq_D5pKbVVHx7F6_m0RQ@mail.gmail.com>
References: <CAFOpNVGGT+tpdAZ42Q+jkWntAE+N=Ctq_D5pKbVVHx7F6_m0RQ@mail.gmail.com>
Message-ID: <1403198095.17749.166.camel@braque.iarc.fr>

When you provide a method for a generic function imported from another
package then the generic must be on the search path. Otherwise if a user
types "filter" the dispatch to "filter.test" will never occur.

What is happening here is worse because "filter" is a non-generic
function in the stats package which is always on the search path.

As you note, using "Depends: dplyr" works because it attaches dplyr to
the search path before your test package is loaded. If you use "Imports"
instead then you need to re-export the generic "filter" function from
your package namespace.

You will also need to document the generic function in your package. A
minimal functioning help page that cross-references to the dplyr package
should be sufficient (Note that S4 generics get a free pass here and do
not need to be documented when re-exported, but S3 generics do).

Martyn
 
On Tue, 2014-06-17 at 14:21 -0500, Winston Chang wrote:
> I'm getting an R CMD check warning with a package (call it package A)
> that defines an S3 method but not the generic. The generic is defined
> in another package (package B). Package A imports the S3 generic from
> B. And there's one additional detail: the generic overrides a function
> in the stats package.
> 
> I've created a minimal test package which reproduces the problem:
>   https://github.com/wch/s3methodtest
> 
> In this case:
> - the package imports dplyr, for the dplyr::filter S3 generic
> - the package defines a S3 method filter.test
> - it imports dplyr, which defines a filter S3 generic
> 
> The warning doesn't occur when package dplyr is in Depends instead of
> Imports. It also doesn't occur if the method is for a generic that
> does not override an existing function like stats::filter. For
> example, if instead of filter.test, I define select.test
> (dplyr::select is also an S3 generic), then there's no warning.
> 
> This warning seems incorrect. Is this a bug? I'm interested in
> submitting the package to CRAN soon, so any advice on what to do is
> appreciated.
> 
> Thanks,
> -Winston
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-----------------------------------------------------------------------
This message and its attachments are strictly confidenti...{{dropped:8}}


From winstonchang1 at gmail.com  Thu Jun 19 21:28:25 2014
From: winstonchang1 at gmail.com (Winston Chang)
Date: Thu, 19 Jun 2014 14:28:25 -0500
Subject: [Rd] R CMD check warning with S3 method
In-Reply-To: <1403198095.17749.166.camel@braque.iarc.fr>
References: <CAFOpNVGGT+tpdAZ42Q+jkWntAE+N=Ctq_D5pKbVVHx7F6_m0RQ@mail.gmail.com>
	<1403198095.17749.166.camel@braque.iarc.fr>
Message-ID: <CAFOpNVF3Q2nN7jUpCvoqGh_Q0PEpMFgP7KQxrymQxHWUX86YvA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140619/7e955e30/attachment.pl>

From plummerm at iarc.fr  Thu Jun 19 22:15:12 2014
From: plummerm at iarc.fr (Martyn Plummer)
Date: Thu, 19 Jun 2014 20:15:12 +0000
Subject: [Rd] R CMD check warning with S3 method
In-Reply-To: <CAFOpNVF3Q2nN7jUpCvoqGh_Q0PEpMFgP7KQxrymQxHWUX86YvA@mail.gmail.com>
References: <CAFOpNVGGT+tpdAZ42Q+jkWntAE+N=Ctq_D5pKbVVHx7F6_m0RQ@mail.gmail.com>
	<1403198095.17749.166.camel@braque.iarc.fr>,
	<CAFOpNVF3Q2nN7jUpCvoqGh_Q0PEpMFgP7KQxrymQxHWUX86YvA@mail.gmail.com>
Message-ID: <31E214B6DF75104E942856C2F74953CB0519C64C@exchange>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140619/f2653ef4/attachment.pl>

From jeroenooms at gmail.com  Fri Jun 20 04:32:51 2014
From: jeroenooms at gmail.com (Jeroen Ooms)
Date: Thu, 19 Jun 2014 19:32:51 -0700
Subject: [Rd] problem using rJava with parallel::mclapply
In-Reply-To: <2EEA1904-0556-4D37-9492-A54D77EF3B52@r-project.org>
References: <CAMd4_Ac0=DvjjChhQ2SHxYeA3YNUKhsz7+vjZ=+VDtTR5ojJ6Q@mail.gmail.com>
	<2EEA1904-0556-4D37-9492-A54D77EF3B52@r-project.org>
Message-ID: <CABFfbXuxXeGR_a5tj3kjLsQFXo5QakYW7Vr-4hDt=BGxMUB5zg@mail.gmail.com>

On Mon, Nov 11, 2013 at 6:20 PM, Simon Urbanek
<simon.urbanek at r-project.org> wrote:
>
> It?s a limitation of the Java runtime - you cannot fork a JVM. This is true for most libraries that use long-lived threads or any kind if UI (see the warnings in mcfork).

Is there some way to reset or restart the JVM within the fork? For
example, the following code seems to work in the terminal on mac/linux
(not in macgui):

library(rJava)
library(parallel)
myfile <-  system.file("tests", "test_import.xlsx", package = "xlsx")
mccollect(mcparallel({xlsx::read.xlsx(myfile, 1)}))

But if we load the 'xlsxjars' package in the parent process, the
example does not work anymore as Simon explained:

library(xlsxjars)
mccollect(mcparallel({xlsx::read.xlsx(myfile, 1)}))

Would there be a way to work around this by manually forcing a reset
of the JVM in the child process, in order to get the similar behavior
as if the 'xlsxjars' package was not loaded in the parent process? I
tried unloading 'xlsxjars' with ?detach, but that seems to make things
worse.


From winstonchang1 at gmail.com  Fri Jun 20 07:19:42 2014
From: winstonchang1 at gmail.com (Winston Chang)
Date: Fri, 20 Jun 2014 00:19:42 -0500
Subject: [Rd] R CMD check warning with S3 method
In-Reply-To: <31E214B6DF75104E942856C2F74953CB0519C64C@exchange>
References: <CAFOpNVGGT+tpdAZ42Q+jkWntAE+N=Ctq_D5pKbVVHx7F6_m0RQ@mail.gmail.com>
	<1403198095.17749.166.camel@braque.iarc.fr>
	<CAFOpNVF3Q2nN7jUpCvoqGh_Q0PEpMFgP7KQxrymQxHWUX86YvA@mail.gmail.com>
	<31E214B6DF75104E942856C2F74953CB0519C64C@exchange>
Message-ID: <CAFOpNVGDzUUtGnWmX3dakGgsnRMG0q+cMFY7WYtWhM98dJrPqg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140620/92a31033/attachment.pl>

From xie at yihui.name  Fri Jun 20 08:34:05 2014
From: xie at yihui.name (Yihui Xie)
Date: Fri, 20 Jun 2014 01:34:05 -0500
Subject: [Rd] R CMD check warning with S3 method
In-Reply-To: <CAFOpNVGDzUUtGnWmX3dakGgsnRMG0q+cMFY7WYtWhM98dJrPqg@mail.gmail.com>
References: <CAFOpNVGGT+tpdAZ42Q+jkWntAE+N=Ctq_D5pKbVVHx7F6_m0RQ@mail.gmail.com>
	<1403198095.17749.166.camel@braque.iarc.fr>
	<CAFOpNVF3Q2nN7jUpCvoqGh_Q0PEpMFgP7KQxrymQxHWUX86YvA@mail.gmail.com>
	<31E214B6DF75104E942856C2F74953CB0519C64C@exchange>
	<CAFOpNVGDzUUtGnWmX3dakGgsnRMG0q+cMFY7WYtWhM98dJrPqg@mail.gmail.com>
Message-ID: <CANROs4fBWPkhPXKV+AkTXCXPx0aFkpt97u2yyboMMp8teeNvMw@mail.gmail.com>

but note that you will have to document it even if it is a function
imported from another package... Perhaps help() should be intelligent
enough to link the documentation of `FUN` from package A for package B
when B imports `FUN` from A, and exports it in B's NAMESPACE. The
package name of A may be obtained from
environmentName(environment(FUN)). At the moment, since R CMD check
will warn against the missing documentation of `FUN` in B, I have to
copy FUN.Rd from A to B in this case, which seems to be inefficient
and not a best way to maintain. Did I miss anything in the R-exts
manual?

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Web: http://yihui.name


On Fri, Jun 20, 2014 at 12:19 AM, Winston Chang <winstonchang1 at gmail.com> wrote:
> On Thu, Jun 19, 2014 at 3:15 PM, Martyn Plummer <plummerm at iarc.fr> wrote:
>
>>  Export filter in the NAMESPACE file *without copying it* in the R source
>> code.
>>
>>
> Ah, it works! Thank you!
>


From murdoch.duncan at gmail.com  Fri Jun 20 09:40:53 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 20 Jun 2014 09:40:53 +0200
Subject: [Rd] R CMD check warning with S3 method
In-Reply-To: <CANROs4fBWPkhPXKV+AkTXCXPx0aFkpt97u2yyboMMp8teeNvMw@mail.gmail.com>
References: <CAFOpNVGGT+tpdAZ42Q+jkWntAE+N=Ctq_D5pKbVVHx7F6_m0RQ@mail.gmail.com>	<1403198095.17749.166.camel@braque.iarc.fr>	<CAFOpNVF3Q2nN7jUpCvoqGh_Q0PEpMFgP7KQxrymQxHWUX86YvA@mail.gmail.com>	<31E214B6DF75104E942856C2F74953CB0519C64C@exchange>	<CAFOpNVGDzUUtGnWmX3dakGgsnRMG0q+cMFY7WYtWhM98dJrPqg@mail.gmail.com>
	<CANROs4fBWPkhPXKV+AkTXCXPx0aFkpt97u2yyboMMp8teeNvMw@mail.gmail.com>
Message-ID: <53A3E585.4010406@gmail.com>

On 20/06/2014, 8:34 AM, Yihui Xie wrote:
> but note that you will have to document it even if it is a function
> imported from another package... Perhaps help() should be intelligent
> enough to link the documentation of `FUN` from package A for package B
> when B imports `FUN` from A, and exports it in B's NAMESPACE. The
> package name of A may be obtained from
> environmentName(environment(FUN)). At the moment, since R CMD check
> will warn against the missing documentation of `FUN` in B, I have to
> copy FUN.Rd from A to B in this case, which seems to be inefficient
> and not a best way to maintain. Did I miss anything in the R-exts
> manual?

Only that you can have a link to the help page in the other package, e.g.

\code{\link[emdbook]{curve3d}}

You'll still need to copy the required parts, but you can link to the
original for the rest.

Duncan Murdoch

> 
> Regards,
> Yihui
> --
> Yihui Xie <xieyihui at gmail.com>
> Web: http://yihui.name
> 
> 
> On Fri, Jun 20, 2014 at 12:19 AM, Winston Chang <winstonchang1 at gmail.com> wrote:
>> On Thu, Jun 19, 2014 at 3:15 PM, Martyn Plummer <plummerm at iarc.fr> wrote:
>>
>>>  Export filter in the NAMESPACE file *without copying it* in the R source
>>> code.
>>>
>>>
>> Ah, it works! Thank you!
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From plummerm at iarc.fr  Fri Jun 20 10:37:26 2014
From: plummerm at iarc.fr (Martyn Plummer)
Date: Fri, 20 Jun 2014 08:37:26 +0000
Subject: [Rd] R CMD check warning with S3 method
In-Reply-To: <CANROs4fBWPkhPXKV+AkTXCXPx0aFkpt97u2yyboMMp8teeNvMw@mail.gmail.com>
References: <CAFOpNVGGT+tpdAZ42Q+jkWntAE+N=Ctq_D5pKbVVHx7F6_m0RQ@mail.gmail.com>
	<1403198095.17749.166.camel@braque.iarc.fr>
	<CAFOpNVF3Q2nN7jUpCvoqGh_Q0PEpMFgP7KQxrymQxHWUX86YvA@mail.gmail.com>
	<31E214B6DF75104E942856C2F74953CB0519C64C@exchange>
	<CAFOpNVGDzUUtGnWmX3dakGgsnRMG0q+cMFY7WYtWhM98dJrPqg@mail.gmail.com>
	<CANROs4fBWPkhPXKV+AkTXCXPx0aFkpt97u2yyboMMp8teeNvMw@mail.gmail.com>
Message-ID: <1403253447.17749.176.camel@braque.iarc.fr>

On Fri, 2014-06-20 at 01:34 -0500, Yihui Xie wrote:
> but note that you will have to document it even if it is a function
> imported from another package... 

Let's not go round in circles. I already pointed this out in my earlier
reply to Winston. It has been snipped from the thread history so I'll
repeat it here:

"You will also need to document the generic function in your package. A
minimal functioning help page that cross-references to the dplyr package
should be sufficient"

Duncan gives more details on the cross reference in his reply.

> Perhaps help() should be intelligent
> enough to link the documentation of `FUN` from package A for package B
> when B imports `FUN` from A, and exports it in B's NAMESPACE. The
> package name of A may be obtained from
> environmentName(environment(FUN)). At the moment, since R CMD check
> will warn against the missing documentation of `FUN` in B, I have to
> copy FUN.Rd from A to B in this case, which seems to be inefficient
> and not a best way to maintain. Did I miss anything in the R-exts
> manual?

> Regards,
> Yihui
> --
> Yihui Xie <xieyihui at gmail.com>
> Web: http://yihui.name
> 
> 
> On Fri, Jun 20, 2014 at 12:19 AM, Winston Chang <winstonchang1 at gmail.com> wrote:
> > On Thu, Jun 19, 2014 at 3:15 PM, Martyn Plummer <plummerm at iarc.fr> wrote:
> >
> >>  Export filter in the NAMESPACE file *without copying it* in the R source
> >> code.
> >>
> >>
> > Ah, it works! Thank you!
> >

-----------------------------------------------------------------------
This message and its attachments are strictly confidenti...{{dropped:8}}


From h.wickham at gmail.com  Fri Jun 20 11:33:25 2014
From: h.wickham at gmail.com (Hadley Wickham)
Date: Fri, 20 Jun 2014 10:33:25 +0100
Subject: [Rd] R CMD check warning with S3 method
In-Reply-To: <1403198095.17749.166.camel@braque.iarc.fr>
References: <CAFOpNVGGT+tpdAZ42Q+jkWntAE+N=Ctq_D5pKbVVHx7F6_m0RQ@mail.gmail.com>
	<1403198095.17749.166.camel@braque.iarc.fr>
Message-ID: <CABdHhvF0-ddRHXB_o3cYqfHkRSUwW122gdWN4htvWfKFPBh9fA@mail.gmail.com>

> When you provide a method for a generic function imported from another
> package then the generic must be on the search path. Otherwise if a user
> types "filter" the dispatch to "filter.test" will never occur.

Right, and this is as desired. If dplyr is not explicitly loaded by
the user, filter.ggvis will never be called.

I don't understand why ggvis should be need to re-export filter from
dplyr - the intent is that filter will be useable with ggvis object,
but you'll only have the filter generic available if you've loaded
dplyr.

Hadley

-- 
http://had.co.nz/


From istazahn at gmail.com  Fri Jun 20 16:37:09 2014
From: istazahn at gmail.com (Ista Zahn)
Date: Fri, 20 Jun 2014 10:37:09 -0400
Subject: [Rd] dget() much slower in recent R versions
Message-ID: <CA+vqiLFbYLec-6Afcee2fGq0R=_8=VyZAfq1nMHMgCd_ynAPhA@mail.gmail.com>

Hello,

I've noticed that dget() is much slower in the current and devel R
versions than in previous versions. In 2.15 reading a 10000-row
data.frame takes less than half a second:

> (which.r <- R.Version()$version.string)
[1] "R version 2.15.2 (2012-10-26)"
> x <- data.frame(matrix(sample(letters, 100000, replace = TRUE), ncol = 10))
> dput(x, which.r)
> system.time(y <- dget(which.r))
   user  system elapsed
  0.546   0.033   0.586

While in 3.1.0 and r-devel it takes around 7 seconds.

> (which.r <- R.Version()$version.string)
[1] "R version 3.1.0 (2014-04-10)"
> x <- data.frame(matrix(sample(letters, 100000, replace = TRUE), ncol = 10))
> dput(x, which.r)
> system.time(y <- dget(which.r))
   user  system elapsed
  6.920   0.060   7.074

> (which.r <- R.Version()$version.string)
[1] "R Under development (unstable) (2014-06-19 r65979)"
> x <- data.frame(matrix(sample(letters, 100000, replace = TRUE), ncol = 10))
> dput(x, which.r)
> system.time(y <- dget(which.r))
   user  system elapsed
  6.886   0.047   6.943
>

I know dput/dget is probably not the right tool for this job:
nevertheless the slowdown in quite dramatic so I thought it was worth
calling attention to.

Best,
Ista


From plummerm at iarc.fr  Fri Jun 20 22:47:11 2014
From: plummerm at iarc.fr (Martyn Plummer)
Date: Fri, 20 Jun 2014 20:47:11 +0000
Subject: [Rd] R CMD check warning with S3 method
In-Reply-To: <CABdHhvF0-ddRHXB_o3cYqfHkRSUwW122gdWN4htvWfKFPBh9fA@mail.gmail.com>
References: <CAFOpNVGGT+tpdAZ42Q+jkWntAE+N=Ctq_D5pKbVVHx7F6_m0RQ@mail.gmail.com>
	<1403198095.17749.166.camel@braque.iarc.fr>,
	<CABdHhvF0-ddRHXB_o3cYqfHkRSUwW122gdWN4htvWfKFPBh9fA@mail.gmail.com>
Message-ID: <31E214B6DF75104E942856C2F74953CB0519CE55@exchange>

Right. I believe that last time this topic came up (August last year) you said that your preferred solution was to export the method but not the generic. I think that's a good idea.

The reason that it doesn't work with filter is that when you created the generic function filter in the dplyr package you overloaded the non-generic filter function in the stats package. Since stats is a default package that is always on the search path, this means you created an ambiguity that must always be resolved by making the generic function visible.

In particular, the QC code is finding the non-generic filter function when it tries to check that the filter.test (or filter.ggvis) method is working correctly, and that is why you get the warnings.

Martyn
________________________________________
From: Hadley Wickham [h.wickham at gmail.com]
Sent: 20 June 2014 11:33
To: Martyn Plummer
Cc: winstonchang1 at gmail.com; r-devel at r-project.org
Subject: Re: [Rd] R CMD check warning with S3 method

> When you provide a method for a generic function imported from another
> package then the generic must be on the search path. Otherwise if a user
> types "filter" the dispatch to "filter.test" will never occur.

Right, and this is as desired. If dplyr is not explicitly loaded by
the user, filter.ggvis will never be called.

I don't understand why ggvis should be need to re-export filter from
dplyr - the intent is that filter will be useable with ggvis object,
but you'll only have the filter generic available if you've loaded
dplyr.

Hadley

--
http://had.co.nz/
-----------------------------------------------------------------------
This message and its attachments are strictly confidenti...{{dropped:8}}


From ripley at stats.ox.ac.uk  Sat Jun 21 09:56:00 2014
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 21 Jun 2014 08:56:00 +0100
Subject: [Rd] dget() much slower in recent R versions
In-Reply-To: <CA+vqiLFbYLec-6Afcee2fGq0R=_8=VyZAfq1nMHMgCd_ynAPhA@mail.gmail.com>
References: <CA+vqiLFbYLec-6Afcee2fGq0R=_8=VyZAfq1nMHMgCd_ynAPhA@mail.gmail.com>
Message-ID: <53A53A90.4070106@stats.ox.ac.uk>

On 20/06/2014 15:37, Ista Zahn wrote:
> Hello,
>
> I've noticed that dget() is much slower in the current and devel R
> versions than in previous versions. In 2.15 reading a 10000-row
> data.frame takes less than half a second:
>
>> (which.r <- R.Version()$version.string)
> [1] "R version 2.15.2 (2012-10-26)"
>> x <- data.frame(matrix(sample(letters, 100000, replace = TRUE), ncol = 10))
>> dput(x, which.r)
>> system.time(y <- dget(which.r))
>     user  system elapsed
>    0.546   0.033   0.586
>
> While in 3.1.0 and r-devel it takes around 7 seconds.
>
>> (which.r <- R.Version()$version.string)
> [1] "R version 3.1.0 (2014-04-10)"
>> x <- data.frame(matrix(sample(letters, 100000, replace = TRUE), ncol = 10))
>> dput(x, which.r)
>> system.time(y <- dget(which.r))
>     user  system elapsed
>    6.920   0.060   7.074
>
>> (which.r <- R.Version()$version.string)
> [1] "R Under development (unstable) (2014-06-19 r65979)"
>> x <- data.frame(matrix(sample(letters, 100000, replace = TRUE), ncol = 10))
>> dput(x, which.r)
>> system.time(y <- dget(which.r))
>     user  system elapsed
>    6.886   0.047   6.943
>>
>
> I know dput/dget is probably not the right tool for this job:
> nevertheless the slowdown in quite dramatic so I thought it was worth
> calling attention to.

This is completely the wrong way to do this. See ?dump.

dget() basically calls eval(parse()).  parse() is much slower in R >= 
3.0 mainly because it keeps more information.  Using keep.source=FALSE 
here speeds things up a lot.

 > system.time(y <- dget(which.r))
    user  system elapsed
   3.233   0.012   3.248
 > options(keep.source=FALSE)
 > system.time(y <- dget(which.r))
    user  system elapsed
   0.090   0.001   0.092


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From istazahn at gmail.com  Sat Jun 21 16:24:19 2014
From: istazahn at gmail.com (Ista Zahn)
Date: Sat, 21 Jun 2014 10:24:19 -0400
Subject: [Rd] dget() much slower in recent R versions
In-Reply-To: <53A53A90.4070106@stats.ox.ac.uk>
References: <CA+vqiLFbYLec-6Afcee2fGq0R=_8=VyZAfq1nMHMgCd_ynAPhA@mail.gmail.com>
	<53A53A90.4070106@stats.ox.ac.uk>
Message-ID: <CA+vqiLFmY5q78xUpyZ-NYFMD_UPM+SGw2G6H_XUip-Xkp6B1ng@mail.gmail.com>

Makes sense, thanks for the explanation.

Best,
Ista

On Sat, Jun 21, 2014 at 3:56 AM, Prof Brian Ripley
<ripley at stats.ox.ac.uk> wrote:
> On 20/06/2014 15:37, Ista Zahn wrote:
>>
>> Hello,
>>
>> I've noticed that dget() is much slower in the current and devel R
>> versions than in previous versions. In 2.15 reading a 10000-row
>> data.frame takes less than half a second:
>>
>>> (which.r <- R.Version()$version.string)
>>
>> [1] "R version 2.15.2 (2012-10-26)"
>>>
>>> x <- data.frame(matrix(sample(letters, 100000, replace = TRUE), ncol =
>>> 10))
>>> dput(x, which.r)
>>> system.time(y <- dget(which.r))
>>
>>     user  system elapsed
>>    0.546   0.033   0.586
>>
>> While in 3.1.0 and r-devel it takes around 7 seconds.
>>
>>> (which.r <- R.Version()$version.string)
>>
>> [1] "R version 3.1.0 (2014-04-10)"
>>>
>>> x <- data.frame(matrix(sample(letters, 100000, replace = TRUE), ncol =
>>> 10))
>>> dput(x, which.r)
>>> system.time(y <- dget(which.r))
>>
>>     user  system elapsed
>>    6.920   0.060   7.074
>>
>>> (which.r <- R.Version()$version.string)
>>
>> [1] "R Under development (unstable) (2014-06-19 r65979)"
>>>
>>> x <- data.frame(matrix(sample(letters, 100000, replace = TRUE), ncol =
>>> 10))
>>> dput(x, which.r)
>>> system.time(y <- dget(which.r))
>>
>>     user  system elapsed
>>    6.886   0.047   6.943
>>>
>>>
>>
>> I know dput/dget is probably not the right tool for this job:
>> nevertheless the slowdown in quite dramatic so I thought it was worth
>> calling attention to.
>
>
> This is completely the wrong way to do this. See ?dump.
>
> dget() basically calls eval(parse()).  parse() is much slower in R >= 3.0
> mainly because it keeps more information.  Using keep.source=FALSE here
> speeds things up a lot.
>
>
>> system.time(y <- dget(which.r))
>    user  system elapsed
>   3.233   0.012   3.248
>> options(keep.source=FALSE)
>
>> system.time(y <- dget(which.r))
>    user  system elapsed
>   0.090   0.001   0.092
>
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From skostysh at princeton.edu  Sun Jun 22 17:07:19 2014
From: skostysh at princeton.edu (Scott Kostyshak)
Date: Sun, 22 Jun 2014 11:07:19 -0400
Subject: [Rd] r65998 build error. share/Rd/macros/*: No such file or
	directory
Message-ID: <CAE3=dmfBUngKXntuaVALX0QZr2qHxwHqCtby-_ych2PHCL5peA@mail.gmail.com>

As of r65998 I'm getting
/usr/bin/install: cannot stat
?/home/scott/rbuilds/r-devel/repo/share/Rd/macros/*?: No such file or
directory

Commenting out the newly added

        @for f in $(srcdir)/Rd/macros/*; do \
          $(INSTALL_DATA) $${f} "$(DESTDIR)$(rsharedir)/Rd/macros"; \
        done

in share/Makefile.in
fixes compilation for me.

I'm on Ubuntu 13.10. My configure output is here:
https://www.dropbox.com/s/srwa1mbzesvvq5v/configure
my make output is here:
https://www.dropbox.com/s/q7ylkw00re7riaf/make
and my config.log is here:
https://www.dropbox.com/s/0w09zhds9q6253n/config.log

Scott


--
Scott Kostyshak
Economics PhD Candidate
Princeton University


From murdoch.duncan at gmail.com  Sun Jun 22 17:16:48 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sun, 22 Jun 2014 17:16:48 +0200
Subject: [Rd] r65998 build error. share/Rd/macros/*: No such file or
	directory
In-Reply-To: <CAE3=dmfBUngKXntuaVALX0QZr2qHxwHqCtby-_ych2PHCL5peA@mail.gmail.com>
References: <CAE3=dmfBUngKXntuaVALX0QZr2qHxwHqCtby-_ych2PHCL5peA@mail.gmail.com>
Message-ID: <53A6F360.3030706@gmail.com>

On 22/06/2014, 5:07 PM, Scott Kostyshak wrote:
> As of r65998 I'm getting
> /usr/bin/install: cannot stat
> ?/home/scott/rbuilds/r-devel/repo/share/Rd/macros/*?: No such file or
> directory
> 
> Commenting out the newly added
> 
>         @for f in $(srcdir)/Rd/macros/*; do \
>           $(INSTALL_DATA) $${f} "$(DESTDIR)$(rsharedir)/Rd/macros"; \
>         done
> 
> in share/Makefile.in
> fixes compilation for me.
> 
> I'm on Ubuntu 13.10. My configure output is here:
> https://www.dropbox.com/s/srwa1mbzesvvq5v/configure
> my make output is here:
> https://www.dropbox.com/s/q7ylkw00re7riaf/make
> and my config.log is here:
> https://www.dropbox.com/s/0w09zhds9q6253n/config.log

Just a missed commit, now fixed.

Duncan Murdoch


From skostysh at princeton.edu  Sun Jun 22 17:21:39 2014
From: skostysh at princeton.edu (Scott Kostyshak)
Date: Sun, 22 Jun 2014 11:21:39 -0400
Subject: [Rd] r65998 build error. share/Rd/macros/*: No such file or
	directory
In-Reply-To: <53A6F360.3030706@gmail.com>
References: <CAE3=dmfBUngKXntuaVALX0QZr2qHxwHqCtby-_ych2PHCL5peA@mail.gmail.com>
	<53A6F360.3030706@gmail.com>
Message-ID: <CAE3=dmd03TNVGh+06pZ5E6Yt3T3q5idYxwPX51YbqdNjjTeOZg@mail.gmail.com>

On Sun, Jun 22, 2014 at 11:16 AM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 22/06/2014, 5:07 PM, Scott Kostyshak wrote:
>> As of r65998 I'm getting
>> /usr/bin/install: cannot stat
>> ?/home/scott/rbuilds/r-devel/repo/share/Rd/macros/*?: No such file or
>> directory
>>
>> Commenting out the newly added
>>
>>         @for f in $(srcdir)/Rd/macros/*; do \
>>           $(INSTALL_DATA) $${f} "$(DESTDIR)$(rsharedir)/Rd/macros"; \
>>         done
>>
>> in share/Makefile.in
>> fixes compilation for me.
>>
>> I'm on Ubuntu 13.10. My configure output is here:
>> https://www.dropbox.com/s/srwa1mbzesvvq5v/configure
>> my make output is here:
>> https://www.dropbox.com/s/q7ylkw00re7riaf/make
>> and my config.log is here:
>> https://www.dropbox.com/s/0w09zhds9q6253n/config.log
>
> Just a missed commit, now fixed.

Thanks Duncan,

Scott


--
Scott Kostyshak
Economics PhD Candidate
Princeton University


From cstrato at aon.at  Mon Jun 23 15:20:12 2014
From: cstrato at aon.at (cstrato)
Date: Mon, 23 Jun 2014 15:20:12 +0200
Subject: [Rd] =?windows-1252?q?operation_on_=91numsels=92_may_be_undefined?=
Message-ID: <53A8298C.9010605@aon.at>

Dear all,

Since many years the following C++ code does compile on ALL Bioconductor 
servers (Linux, Windows, Mac) without any warnings:

    Int_t numsels = 0;  //number of selected entries
    ...
    for (Int_t i=0; i<size; i++) {
       numsels = (arrMask[i] == 1) ? ++numsels : numsels;
    }//for_i

Even on the recently added release server 'zin2' Linux (Ubuntu 12.04.4 
LTS) the above code compiles w/o warnings.

However, on the new development server 'zin1' Linux (Ubuntu 12.04.4 LTS) 
I get suddenly the following warning message:

Found the following significant warnings:
   XPSPreProcessing.cxx:3026:56: warning: operation on ?numsels? may be 
undefined [-Wsequence-point]

Interestingly, both servers do not only run the same version of Ubuntu, 
but also the same version of the C++ compiler, i.e. g++ (Ubuntu/Linaro 
4.6.3-1ubuntu5) 4.6.3, and use the same flags, see:
http://bioconductor.org/checkResults/2.14/bioc-LATEST/zin2-NodeInfo.html
http://bioconductor.org/checkResults/devel/bioc-LATEST/zin1-NodeInfo.html

My question is now, why do I suddenly get the compiler warning?

The reason why I ask at R-devel and not Bioc-devel is that it may not 
only be a Bioc question, since I found the following links:
http://c-faq.com/expr/seqpoints.html
http://stackoverflow.com/questions/16838884/why-i-got-operation-may-be-undefined-in-statement-expression-in-c

I am not sure if I understand the meaning, but until now I have never 
got any warning from any compiler the I have used (including MS Visual 
C++).

Do I really have to replace '++numsels' with 'numsels+1'?

Best regards,
Christian
_._._._._._._._._._._._._._._._._._
C.h.r.i.s.t.i.a.n   S.t.r.a.t.o.w.a
V.i.e.n.n.a           A.u.s.t.r.i.a
e.m.a.i.l:        cstrato at aon.at
_._._._._._._._._._._._._._._._._._


From romain at r-enthusiasts.com  Mon Jun 23 15:45:00 2014
From: romain at r-enthusiasts.com (=?windows-1252?Q?Romain_Fran=E7ois?=)
Date: Mon, 23 Jun 2014 15:45:00 +0200
Subject: [Rd]
 =?windows-1252?q?operation_on_=91numsels=92_may_be_undefined?=
In-Reply-To: <53A8298C.9010605@aon.at>
References: <53A8298C.9010605@aon.at>
Message-ID: <244EC819-4336-4A49-BAEB-86B57E8A2970@r-enthusiasts.com>


Le 23 juin 2014 ? 15:20, cstrato <cstrato at aon.at> a ?crit :

> Dear all,
> 
> Since many years the following C++ code does compile on ALL Bioconductor servers (Linux, Windows, Mac) without any warnings:
> 
>   Int_t numsels = 0;  //number of selected entries
>   ...
>   for (Int_t i=0; i<size; i++) {
>      numsels = (arrMask[i] == 1) ? ++numsels : numsels;
>   }//for_i

This is confusing. I would write the loop body like this: 

numsels += (arrMask[i] == 1) ;


or preferably using the STL: 

Int_t numsels = std::count( begin(arrMask), end(arrMask), 1 ) ;

or some other variation of this, i.e. perhaps you don?t have a C++11 compiler, so perhaps one of these depending on what is arrMask:

Int_t numsels = std::count( arrMask.begin(), arrMask.end(), 1 ) ;
Int_t numsels = std::count( arrMask, arrMask + size, 1 ) ;

Romain

> Even on the recently added release server 'zin2' Linux (Ubuntu 12.04.4 LTS) the above code compiles w/o warnings.
> 
> However, on the new development server 'zin1' Linux (Ubuntu 12.04.4 LTS) I get suddenly the following warning message:
> 
> Found the following significant warnings:
>  XPSPreProcessing.cxx:3026:56: warning: operation on ?numsels? may be undefined [-Wsequence-point]
> 
> Interestingly, both servers do not only run the same version of Ubuntu, but also the same version of the C++ compiler, i.e. g++ (Ubuntu/Linaro 4.6.3-1ubuntu5) 4.6.3, and use the same flags, see:
> http://bioconductor.org/checkResults/2.14/bioc-LATEST/zin2-NodeInfo.html
> http://bioconductor.org/checkResults/devel/bioc-LATEST/zin1-NodeInfo.html
> 
> My question is now, why do I suddenly get the compiler warning?
> 
> The reason why I ask at R-devel and not Bioc-devel is that it may not only be a Bioc question, since I found the following links:
> http://c-faq.com/expr/seqpoints.html
> http://stackoverflow.com/questions/16838884/why-i-got-operation-may-be-undefined-in-statement-expression-in-c
> 
> I am not sure if I understand the meaning, but until now I have never got any warning from any compiler the I have used (including MS Visual C++).
> 
> Do I really have to replace '++numsels' with 'numsels+1'?
> 
> Best regards,
> Christian
> _._._._._._._._._._._._._._._._._._
> C.h.r.i.s.t.i.a.n   S.t.r.a.t.o.w.a
> V.i.e.n.n.a           A.u.s.t.r.i.a
> e.m.a.i.l:        cstrato at aon.at
> _._._._._._._._._._._._._._._._._._
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From radford at cs.toronto.edu  Mon Jun 23 17:24:35 2014
From: radford at cs.toronto.edu (Radford Neal)
Date: Mon, 23 Jun 2014 11:24:35 -0400
Subject: [Rd] Unfixed bugs in latest R-patched
Message-ID: <20140623152435.GA22211@cs.toronto.edu>

A new version of pqR is now available at pqR-project.org, which fixes
several bugs that are also present in the latest R Core patch release
(r66002).  A number of bugs found previously during pqR development
are also unfixed in the latest R Core release.  Here is the list of
these bugs that are unfixed in r66002 (including documentation
deficiencies), taken from the pqR bug fix and documentation update
sections of the pqR NEWS file (pqR-project.org/NEWS.txt):

    o The documentation for c now says how the names for the result are
      determined, including previously missing information on the
      use.names argument, and on the role of the names of arguments in
      the call of c.  This documentation is missing in R-2.15.0 and
      R-3.1.0.

    o The documentaton for diag now documents that a diagonal matrix is
      always created with type double or complex, and that the names of
      an extracted diagonal vector are taken from a names attribute (if
      present), if not from the row and column names.  This information
      is absent in the documentation in R-2.15.1 and R-3.1.0.

    o Incorrect information regarding the pointer protection stack was
      removed from help(Memory).  This incorrect information is present
      in R-2.15.0 and R-3.1.0 as well.

    o There is now information in help(Arithmetic) regarding what
      happens when the operands of an arithmetic operation are NA or
      NaN, including the arbitrary nature of the result when one
      operand is NA and the other is NaN.  There is no discussion of
      this issue in the documentation for R-2.15.0 and R-3.1.0.

    o Fixed lack of protection bugs in the equal and greater functions
      in sort.c.  These bugs are also present in R-2.15.0 and R-3.1.0.

    o Fixed lack of protection bugs in the D function in deriv.c.
      These bugs are also present in R-2.15.0 and R-3.1.0.

    o Fixed argument error-checking bugs in getGraphicsEventEnv and
      setGraphicsEventEnv (also present in R-2.15.0 and R-3.1.0).

    o Fixed the following bug (also present in R-2.15.0 and R-3.0.2):
      
          x <- t(5)
          print (x %*% c(3,4))
          print (crossprod(5,c(3,4)))

      The call of crossprod produced an error, whereas the
      corresponding use of %*% does not.

      In pqR-2013-12-29, this bug also affected the expression t(5) %*%
      c(3,4), since it is converted to the equivalent of
      crossprod(5,c(3,4)).

    o Fixed a problem in R_AllocStringBuffer that could result in a
      crash due to an invalid memory access.  (This bug is also present
      in R-2.15.0 and R-3.0.2.)

    o The documentation for aperm now says that the default method does
      not copy attributes (other than dimensions and dimnames).
      Previously, it incorrecty said it did (as is the case also in
      R-2.15.0 and R-3.0.2).

    o Fixed the following bug (also present in R-2.15.0 and R-3.0.2):
      
         v <- c(1,2)
         m <- matrix(c(3,4),1,2)
         print(t(m)%*%v)
         print(crossprod(m,v))

      in which crossprod gave an error rather than produce the answer
      for the corresponding use of %*%.

    o Raising -Inf to a large value (eg, (-Inf)^(1e16)) no longer
      produces an incomprehensible warning.  As before, the value
      returned is Inf, because (due to their limited-precision
      floating-point representation) all such large numbers are even
      integers.

    o Fixed a bug (also present in R-2.15.0 and R-3.0.1) illustrated by
      the following code:
      
         > a <- list(x=c(1,2),y=c(3,4))
         > b <- as.pairlist(a)
         > b$x[1] <- 9
         > print(a)
         $x
         [1] 9 2
         
         $y
         [1] 3 4

      The value printed for a has a$x[1] changed to 9, when it should
      still be 1. See pqR issue #14.

    o Fixed several bugs (also present in R-2.15.0 and R-3.0.1)
      illustrated by the code below (see pqR issue #16):
      
         v <- c(10,20,30)
         v[[2]] <- NULL        # wrong error message
         
         x <- pairlist(list(1,2))
         x[[c(1,2)]] <- NULL   # wrongly gives an error, referring to misuse
                               # of the internal SET_VECTOR_ELT procedure
         
         v<-list(1)
         v[[quote(abc)]] <- 2  # internal error, this time for SET_STRING_ELT
         
         a <- pairlist(10,20,30,40,50,60)
         dim(a) <- c(2,3)
         dimnames(a) <- list(c("a","b"),c("x","y","z"))
         print(a)              # doesn't print names
         
         a[["a","x"]] <- 0     # crashes with a segmentation fault

    o Fixed a bug where, for example, log(base=4) returned the natural
      log of 4, rather than signalling an error.

    o The documentation on what MARGIN arguments are allowed for apply
      has been clarified, and checks for validity added.  The call
      
         > apply(array(1:24,c(2,3,4)),-3,sum)

      now produces correct results (the same as when MARGIN is 1:2).

    o Fixed a bug in which Im(matrix(complex(0),3,4)) returned a matrix
      of zero elements rather than a matrix of NA elements.

    o Now check for bad arguments for .rowSums, .colSums, .rowMeans,
      and .rowMeans (would previously segfault if n*p too big).

    o Fixed a bug where excess warning messages may be produced on
      conversion to RAW.  For instance:
      
         > as.raw(1e40)
         [1] 00
         Warning messages:
         1: NAs introduced by coercion 
         2: out-of-range values treated as 0 in coercion to raw 

      Now, only the second warning message is produced.

    o A bug has been fixed in which rbind would not handle non-vector
      objects such as function closures, whereas cbind did handle them,
      and both were documented to do so.

Regards,

   Radford Neal


From cstrato at aon.at  Mon Jun 23 18:28:54 2014
From: cstrato at aon.at (cstrato)
Date: Mon, 23 Jun 2014 18:28:54 +0200
Subject: [Rd]
 =?windows-1252?q?operation_on_=91numsels=92_may_be_undefined?=
In-Reply-To: <244EC819-4336-4A49-BAEB-86B57E8A2970@r-enthusiasts.com>
References: <53A8298C.9010605@aon.at>
	<244EC819-4336-4A49-BAEB-86B57E8A2970@r-enthusiasts.com>
Message-ID: <53A855C6.1000301@aon.at>

Dear Romain,

Thank you for your suggestions, I like especially the first one.

However, you did not explain why I have never got this warning message 
on any compiler, and why only one of the two identical Ubuntu compilers 
did give this warning message?

Best regards,
Christian



On 6/23/14 3:45 PM, Romain Fran?ois wrote:
>
> Le 23 juin 2014 ? 15:20, cstrato <cstrato at aon.at> a ?crit :
>
>> Dear all,
>>
>> Since many years the following C++ code does compile on ALL Bioconductor servers (Linux, Windows, Mac) without any warnings:
>>
>>    Int_t numsels = 0;  //number of selected entries
>>    ...
>>    for (Int_t i=0; i<size; i++) {
>>       numsels = (arrMask[i] == 1) ? ++numsels : numsels;
>>    }//for_i
>
> This is confusing. I would write the loop body like this:
>
> numsels += (arrMask[i] == 1) ;
>
>
> or preferably using the STL:
>
> Int_t numsels = std::count( begin(arrMask), end(arrMask), 1 ) ;
>
> or some other variation of this, i.e. perhaps you don?t have a C++11 compiler, so perhaps one of these depending on what is arrMask:
>
> Int_t numsels = std::count( arrMask.begin(), arrMask.end(), 1 ) ;
> Int_t numsels = std::count( arrMask, arrMask + size, 1 ) ;
>
> Romain
>
>> Even on the recently added release server 'zin2' Linux (Ubuntu 12.04.4 LTS) the above code compiles w/o warnings.
>>
>> However, on the new development server 'zin1' Linux (Ubuntu 12.04.4 LTS) I get suddenly the following warning message:
>>
>> Found the following significant warnings:
>>   XPSPreProcessing.cxx:3026:56: warning: operation on ?numsels? may be undefined [-Wsequence-point]
>>
>> Interestingly, both servers do not only run the same version of Ubuntu, but also the same version of the C++ compiler, i.e. g++ (Ubuntu/Linaro 4.6.3-1ubuntu5) 4.6.3, and use the same flags, see:
>> http://bioconductor.org/checkResults/2.14/bioc-LATEST/zin2-NodeInfo.html
>> http://bioconductor.org/checkResults/devel/bioc-LATEST/zin1-NodeInfo.html
>>
>> My question is now, why do I suddenly get the compiler warning?
>>
>> The reason why I ask at R-devel and not Bioc-devel is that it may not only be a Bioc question, since I found the following links:
>> http://c-faq.com/expr/seqpoints.html
>> http://stackoverflow.com/questions/16838884/why-i-got-operation-may-be-undefined-in-statement-expression-in-c
>>
>> I am not sure if I understand the meaning, but until now I have never got any warning from any compiler the I have used (including MS Visual C++).
>>
>> Do I really have to replace '++numsels' with 'numsels+1'?
>>
>> Best regards,
>> Christian
>> _._._._._._._._._._._._._._._._._._
>> C.h.r.i.s.t.i.a.n   S.t.r.a.t.o.w.a
>> V.i.e.n.n.a           A.u.s.t.r.i.a
>> e.m.a.i.l:        cstrato at aon.at
>> _._._._._._._._._._._._._._._._._._
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From romain at r-enthusiasts.com  Mon Jun 23 19:13:45 2014
From: romain at r-enthusiasts.com (=?windows-1252?Q?Romain_Fran=E7ois?=)
Date: Mon, 23 Jun 2014 19:13:45 +0200
Subject: [Rd]
 =?windows-1252?q?operation_on_=91numsels=92_may_be_undefined?=
In-Reply-To: <53A855C6.1000301@aon.at>
References: <53A8298C.9010605@aon.at>
	<244EC819-4336-4A49-BAEB-86B57E8A2970@r-enthusiasts.com>
	<53A855C6.1000301@aon.at>
Message-ID: <BE6B83B4-2A60-4F84-8B5F-C0754997E5C5@r-enthusiasts.com>


Le 23 juin 2014 ? 18:28, cstrato <cstrato at aon.at> a ?crit :

> Dear Romain,
> 
> Thank you for your suggestions, I like especially the first one.
> 
> However, you did not explain why I have never got this warning message on any compiler, and why only one of the two identical Ubuntu compilers did give this warning message?
> 
> Best regards,
> Christian

I don?t know, but this:

numsels = ++numsels ; 

seems fishy to me, and so it keeps feeling weird with the addition of the ternary operator. 

There is obviously a difference of setup between these two machines, but I don?t have time to sherlock that for you. One of the compilers is getting more careful than the other. Getting warnings you did not get before is a good thing, as it helps you update the code with that new insight. 

Welcome to my world, I?m sometimes thrown all kinds of new warnings from esoteric compilers, all of them have value .

Romain

> On 6/23/14 3:45 PM, Romain Fran?ois wrote:
>> 
>> Le 23 juin 2014 ? 15:20, cstrato <cstrato at aon.at> a ?crit :
>> 
>>> Dear all,
>>> 
>>> Since many years the following C++ code does compile on ALL Bioconductor servers (Linux, Windows, Mac) without any warnings:
>>> 
>>>   Int_t numsels = 0;  //number of selected entries
>>>   ...
>>>   for (Int_t i=0; i<size; i++) {
>>>      numsels = (arrMask[i] == 1) ? ++numsels : numsels;
>>>   }//for_i
>> 
>> This is confusing. I would write the loop body like this:
>> 
>> numsels += (arrMask[i] == 1) ;
>> 
>> 
>> or preferably using the STL:
>> 
>> Int_t numsels = std::count( begin(arrMask), end(arrMask), 1 ) ;
>> 
>> or some other variation of this, i.e. perhaps you don?t have a C++11 compiler, so perhaps one of these depending on what is arrMask:
>> 
>> Int_t numsels = std::count( arrMask.begin(), arrMask.end(), 1 ) ;
>> Int_t numsels = std::count( arrMask, arrMask + size, 1 ) ;
>> 
>> Romain
>> 
>>> Even on the recently added release server 'zin2' Linux (Ubuntu 12.04.4 LTS) the above code compiles w/o warnings.
>>> 
>>> However, on the new development server 'zin1' Linux (Ubuntu 12.04.4 LTS) I get suddenly the following warning message:
>>> 
>>> Found the following significant warnings:
>>>  XPSPreProcessing.cxx:3026:56: warning: operation on ?numsels? may be undefined [-Wsequence-point]
>>> 
>>> Interestingly, both servers do not only run the same version of Ubuntu, but also the same version of the C++ compiler, i.e. g++ (Ubuntu/Linaro 4.6.3-1ubuntu5) 4.6.3, and use the same flags, see:
>>> http://bioconductor.org/checkResults/2.14/bioc-LATEST/zin2-NodeInfo.html
>>> http://bioconductor.org/checkResults/devel/bioc-LATEST/zin1-NodeInfo.html
>>> 
>>> My question is now, why do I suddenly get the compiler warning?
>>> 
>>> The reason why I ask at R-devel and not Bioc-devel is that it may not only be a Bioc question, since I found the following links:
>>> http://c-faq.com/expr/seqpoints.html
>>> http://stackoverflow.com/questions/16838884/why-i-got-operation-may-be-undefined-in-statement-expression-in-c
>>> 
>>> I am not sure if I understand the meaning, but until now I have never got any warning from any compiler the I have used (including MS Visual C++).
>>> 
>>> Do I really have to replace '++numsels' with 'numsels+1'?
>>> 
>>> Best regards,
>>> Christian
>>> _._._._._._._._._._._._._._._._._._
>>> C.h.r.i.s.t.i.a.n   S.t.r.a.t.o.w.a
>>> V.i.e.n.n.a           A.u.s.t.r.i.a
>>> e.m.a.i.l:        cstrato at aon.at
>>> _._._._._._._._._._._._._._._._._._
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 


From cstrato at aon.at  Mon Jun 23 20:54:38 2014
From: cstrato at aon.at (cstrato)
Date: Mon, 23 Jun 2014 20:54:38 +0200
Subject: [Rd]
 =?windows-1252?q?operation_on_=91numsels=92_may_be_undefined?=
In-Reply-To: <BE6B83B4-2A60-4F84-8B5F-C0754997E5C5@r-enthusiasts.com>
References: <53A8298C.9010605@aon.at>
	<244EC819-4336-4A49-BAEB-86B57E8A2970@r-enthusiasts.com>
	<53A855C6.1000301@aon.at>
	<BE6B83B4-2A60-4F84-8B5F-C0754997E5C5@r-enthusiasts.com>
Message-ID: <53A877EE.1080201@aon.at>

Dear Romain,

I do not know enough about compilers, but as far as I remember, they 
'work' from right to left, so numsels = ++numsels should not confuse the 
compiler. Anyhow I will change my code to your first suggestion since it 
is more elegant.

Best regards,
Christian


On 6/23/14 7:13 PM, Romain Fran?ois wrote:
>
> Le 23 juin 2014 ? 18:28, cstrato <cstrato at aon.at> a ?crit :
>
>> Dear Romain,
>>
>> Thank you for your suggestions, I like especially the first one.
>>
>> However, you did not explain why I have never got this warning message on any compiler, and why only one of the two identical Ubuntu compilers did give this warning message?
>>
>> Best regards,
>> Christian
>
> I don?t know, but this:
>
> numsels = ++numsels ;
>
> seems fishy to me, and so it keeps feeling weird with the addition of the ternary operator.
>
> There is obviously a difference of setup between these two machines, but I don?t have time to sherlock that for you. One of the compilers is getting more careful than the other. Getting warnings you did not get before is a good thing, as it helps you update the code with that new insight.
>
> Welcome to my world, I?m sometimes thrown all kinds of new warnings from esoteric compilers, all of them have value .
>
> Romain
>
>> On 6/23/14 3:45 PM, Romain Fran?ois wrote:
>>>
>>> Le 23 juin 2014 ? 15:20, cstrato <cstrato at aon.at> a ?crit :
>>>
>>>> Dear all,
>>>>
>>>> Since many years the following C++ code does compile on ALL Bioconductor servers (Linux, Windows, Mac) without any warnings:
>>>>
>>>>    Int_t numsels = 0;  //number of selected entries
>>>>    ...
>>>>    for (Int_t i=0; i<size; i++) {
>>>>       numsels = (arrMask[i] == 1) ? ++numsels : numsels;
>>>>    }//for_i
>>>
>>> This is confusing. I would write the loop body like this:
>>>
>>> numsels += (arrMask[i] == 1) ;
>>>
>>>
>>> or preferably using the STL:
>>>
>>> Int_t numsels = std::count( begin(arrMask), end(arrMask), 1 ) ;
>>>
>>> or some other variation of this, i.e. perhaps you don?t have a C++11 compiler, so perhaps one of these depending on what is arrMask:
>>>
>>> Int_t numsels = std::count( arrMask.begin(), arrMask.end(), 1 ) ;
>>> Int_t numsels = std::count( arrMask, arrMask + size, 1 ) ;
>>>
>>> Romain
>>>
>>>> Even on the recently added release server 'zin2' Linux (Ubuntu 12.04.4 LTS) the above code compiles w/o warnings.
>>>>
>>>> However, on the new development server 'zin1' Linux (Ubuntu 12.04.4 LTS) I get suddenly the following warning message:
>>>>
>>>> Found the following significant warnings:
>>>>   XPSPreProcessing.cxx:3026:56: warning: operation on ?numsels? may be undefined [-Wsequence-point]
>>>>
>>>> Interestingly, both servers do not only run the same version of Ubuntu, but also the same version of the C++ compiler, i.e. g++ (Ubuntu/Linaro 4.6.3-1ubuntu5) 4.6.3, and use the same flags, see:
>>>> http://bioconductor.org/checkResults/2.14/bioc-LATEST/zin2-NodeInfo.html
>>>> http://bioconductor.org/checkResults/devel/bioc-LATEST/zin1-NodeInfo.html
>>>>
>>>> My question is now, why do I suddenly get the compiler warning?
>>>>
>>>> The reason why I ask at R-devel and not Bioc-devel is that it may not only be a Bioc question, since I found the following links:
>>>> http://c-faq.com/expr/seqpoints.html
>>>> http://stackoverflow.com/questions/16838884/why-i-got-operation-may-be-undefined-in-statement-expression-in-c
>>>>
>>>> I am not sure if I understand the meaning, but until now I have never got any warning from any compiler the I have used (including MS Visual C++).
>>>>
>>>> Do I really have to replace '++numsels' with 'numsels+1'?
>>>>
>>>> Best regards,
>>>> Christian
>>>> _._._._._._._._._._._._._._._._._._
>>>> C.h.r.i.s.t.i.a.n   S.t.r.a.t.o.w.a
>>>> V.i.e.n.n.a           A.u.s.t.r.i.a
>>>> e.m.a.i.l:        cstrato at aon.at
>>>> _._._._._._._._._._._._._._._._._._
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>
>


From kasperdanielhansen at gmail.com  Mon Jun 23 22:05:01 2014
From: kasperdanielhansen at gmail.com (Kasper Daniel Hansen)
Date: Mon, 23 Jun 2014 16:05:01 -0400
Subject: [Rd]
	=?utf-8?q?operation_on_=E2=80=98numsels=E2=80=99_may_be_unde?=
	=?utf-8?q?fined?=
In-Reply-To: <53A877EE.1080201@aon.at>
References: <53A8298C.9010605@aon.at>
	<244EC819-4336-4A49-BAEB-86B57E8A2970@r-enthusiasts.com>
	<53A855C6.1000301@aon.at>
	<BE6B83B4-2A60-4F84-8B5F-C0754997E5C5@r-enthusiasts.com>
	<53A877EE.1080201@aon.at>
Message-ID: <CAC2h7usxy2-X-Nq4NYwExyuDZuVW4D7kqRALdhBhmGZVnVJKpA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140623/133edb2f/attachment.pl>

From cstrato at aon.at  Mon Jun 23 23:54:03 2014
From: cstrato at aon.at (cstrato)
Date: Mon, 23 Jun 2014 23:54:03 +0200
Subject: [Rd]
 =?utf-8?q?operation_on_=E2=80=98numsels=E2=80=99_may_be_unde?=
 =?utf-8?q?fined?=
In-Reply-To: <CAC2h7usxy2-X-Nq4NYwExyuDZuVW4D7kqRALdhBhmGZVnVJKpA@mail.gmail.com>
References: <53A8298C.9010605@aon.at>
	<244EC819-4336-4A49-BAEB-86B57E8A2970@r-enthusiasts.com>
	<53A855C6.1000301@aon.at>
	<BE6B83B4-2A60-4F84-8B5F-C0754997E5C5@r-enthusiasts.com>
	<53A877EE.1080201@aon.at>
	<CAC2h7usxy2-X-Nq4NYwExyuDZuVW4D7kqRALdhBhmGZVnVJKpA@mail.gmail.com>
Message-ID: <53A8A1FB.3040803@aon.at>

Dear Kasper,

What do you mean with 'undefined aspect of ++'?

Every compiler has to evaluate first the expression on the right side 
and then apply the result to the variable on the left side, as in:
    i = i + 1;
I understand that the expression:
    i = i++;
may be confusing, but the expression:
    i = ++i;
should work. What about:
    i = (++i); or i = {++i}
Would this also result in a warning message?

Best regards,
Christian


On 6/23/14 10:05 PM, Kasper Daniel Hansen wrote:
> You're getting this message because you are using an undefined aspect of
> ++.  Depending on compiler convention re. the interpretation of ++, your
> code may be interpreted differently; ie. different compilers will
> interpret the code differently.  This is a bad thing.
>
> You're presumably getting the warning now, because the compiler flag has
> been added on the Bioc build servers.
>
> There was a recent thread on this specific aspect of ++ recently, but I
> forgot which email list.
>
> Kasper
>
>
> On Mon, Jun 23, 2014 at 2:54 PM, cstrato <cstrato at aon.at
> <mailto:cstrato at aon.at>> wrote:
>
>     Dear Romain,
>
>     I do not know enough about compilers, but as far as I remember, they
>     'work' from right to left, so numsels = ++numsels should not confuse
>     the compiler. Anyhow I will change my code to your first suggestion
>     since it is more elegant.
>
>     Best regards,
>     Christian
>
>
>
>     On 6/23/14 7:13 PM, Romain Fran?ois wrote:
>
>
>         Le 23 juin 2014 ? 18:28, cstrato <cstrato at aon.at
>         <mailto:cstrato at aon.at>> a ?crit :
>
>             Dear Romain,
>
>             Thank you for your suggestions, I like especially the first one.
>
>             However, you did not explain why I have never got this
>             warning message on any compiler, and why only one of the two
>             identical Ubuntu compilers did give this warning message?
>
>             Best regards,
>             Christian
>
>
>         I don?t know, but this:
>
>         numsels = ++numsels ;
>
>         seems fishy to me, and so it keeps feeling weird with the
>         addition of the ternary operator.
>
>         There is obviously a difference of setup between these two
>         machines, but I don?t have time to sherlock that for you. One of
>         the compilers is getting more careful than the other. Getting
>         warnings you did not get before is a good thing, as it helps you
>         update the code with that new insight.
>
>         Welcome to my world, I?m sometimes thrown all kinds of new
>         warnings from esoteric compilers, all of them have value .
>
>         Romain
>
>             On 6/23/14 3:45 PM, Romain Fran?ois wrote:
>
>
>                 Le 23 juin 2014 ? 15:20, cstrato <cstrato at aon.at
>                 <mailto:cstrato at aon.at>> a ?crit :
>
>                     Dear all,
>
>                     Since many years the following C++ code does compile
>                     on ALL Bioconductor servers (Linux, Windows, Mac)
>                     without any warnings:
>
>                         Int_t numsels = 0;  //number of selected entries
>                         ...
>                         for (Int_t i=0; i<size; i++) {
>                            numsels = (arrMask[i] == 1) ? ++numsels :
>                     numsels;
>                         }//for_i
>
>
>                 This is confusing. I would write the loop body like this:
>
>                 numsels += (arrMask[i] == 1) ;
>
>
>                 or preferably using the STL:
>
>                 Int_t numsels = std::count( begin(arrMask),
>                 end(arrMask), 1 ) ;
>
>                 or some other variation of this, i.e. perhaps you don?t
>                 have a C++11 compiler, so perhaps one of these depending
>                 on what is arrMask:
>
>                 Int_t numsels = std::count( arrMask.begin(),
>                 arrMask.end(), 1 ) ;
>                 Int_t numsels = std::count( arrMask, arrMask + size, 1 ) ;
>
>                 Romain
>
>                     Even on the recently added release server 'zin2'
>                     Linux (Ubuntu 12.04.4 LTS) the above code compiles
>                     w/o warnings.
>
>                     However, on the new development server 'zin1' Linux
>                     (Ubuntu 12.04.4 LTS) I get suddenly the following
>                     warning message:
>
>                     Found the following significant warnings:
>                        XPSPreProcessing.cxx:3026:56: warning: operation
>                     on ?numsels? may be undefined [-Wsequence-point]
>
>                     Interestingly, both servers do not only run the same
>                     version of Ubuntu, but also the same version of the
>                     C++ compiler, i.e. g++ (Ubuntu/Linaro
>                     4.6.3-1ubuntu5) 4.6.3, and use the same flags, see:
>                     http://bioconductor.org/__checkResults/2.14/bioc-LATEST/__zin2-NodeInfo.html
>                     <http://bioconductor.org/checkResults/2.14/bioc-LATEST/zin2-NodeInfo.html>
>                     http://bioconductor.org/__checkResults/devel/bioc-__LATEST/zin1-NodeInfo.html
>                     <http://bioconductor.org/checkResults/devel/bioc-LATEST/zin1-NodeInfo.html>
>
>                     My question is now, why do I suddenly get the
>                     compiler warning?
>
>                     The reason why I ask at R-devel and not Bioc-devel
>                     is that it may not only be a Bioc question, since I
>                     found the following links:
>                     http://c-faq.com/expr/__seqpoints.html
>                     <http://c-faq.com/expr/seqpoints.html>
>                     http://stackoverflow.com/__questions/16838884/why-i-got-__operation-may-be-undefined-in-__statement-expression-in-c
>                     <http://stackoverflow.com/questions/16838884/why-i-got-operation-may-be-undefined-in-statement-expression-in-c>
>
>                     I am not sure if I understand the meaning, but until
>                     now I have never got any warning from any compiler
>                     the I have used (including MS Visual C++).
>
>                     Do I really have to replace '++numsels' with
>                     'numsels+1'?
>
>                     Best regards,
>                     Christian
>                     _._._._._._._._._._._._._._._.___._._
>                     C.h.r.i.s.t.i.a.n   S.t.r.a.t.o.w.a
>                     V.i.e.n.n.a           A.u.s.t.r.i.a
>                     e.m.a.i.l:        cstrato at aon.at <http://aon.at>
>                     _._._._._._._._._._._._._._._.___._._
>
>                     ________________________________________________
>                     R-devel at r-project.org <mailto:R-devel at r-project.org>
>                     mailing list
>                     https://stat.ethz.ch/mailman/__listinfo/r-devel
>                     <https://stat.ethz.ch/mailman/listinfo/r-devel>
>
>
>
>
>
>
>     ________________________________________________
>     R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>     https://stat.ethz.ch/mailman/__listinfo/r-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-devel>
>
>


From macrakis at alum.mit.edu  Tue Jun 24 00:04:09 2014
From: macrakis at alum.mit.edu (=?UTF-8?B?U3RhdnJvcyBNYWNyYWtpcyAozqPPhM6x4b+mz4HOv8+CIM6czrHOus+BzqzOus63z4Ip?=)
Date: Mon, 23 Jun 2014 18:04:09 -0400
Subject: [Rd] Curious behavior of $ and lapply
Message-ID: <CACLVabXgnoWajqk30r9+ufC1fk_C9xQWc7fc1JQKxh5tuYvOWg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140623/07f35984/attachment.pl>

From hpages at fhcrc.org  Tue Jun 24 00:18:02 2014
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Mon, 23 Jun 2014 15:18:02 -0700
Subject: [Rd]
 =?windows-1252?q?operation_on_=91numsels=92_may_be_undefined?=
In-Reply-To: <53A877EE.1080201@aon.at>
References: <53A8298C.9010605@aon.at>	<244EC819-4336-4A49-BAEB-86B57E8A2970@r-enthusiasts.com>	<53A855C6.1000301@aon.at>	<BE6B83B4-2A60-4F84-8B5F-C0754997E5C5@r-enthusiasts.com>
	<53A877EE.1080201@aon.at>
Message-ID: <53A8A79A.9070301@fhcrc.org>

Hi Christian,

On 06/23/2014 11:54 AM, cstrato wrote:
> Dear Romain,
>
> I do not know enough about compilers, but as far as I remember, they
> 'work' from right to left,

Not necessarily. So you should not rely on that. This is what the
(somewhat obscure) warning you see on zin1 is trying to tell you.
Personally I would just do:

     if (arrMask[i] == 1) numsels++;

which is the standard way to implement the "if (some condition)
then increment counter" idiom.

As Kasper mentioned, a similar issue was recently discussed here:

   https://stat.ethz.ch/pipermail/bioc-devel/2014-June/005858.html

Cheers,
H.


> so numsels = ++numsels should not confuse the
> compiler. Anyhow I will change my code to your first suggestion since it
> is more elegant.
>
> Best regards,
> Christian
>
>
> On 6/23/14 7:13 PM, Romain Fran?ois wrote:
>>
>> Le 23 juin 2014 ? 18:28, cstrato <cstrato at aon.at> a ?crit :
>>
>>> Dear Romain,
>>>
>>> Thank you for your suggestions, I like especially the first one.
>>>
>>> However, you did not explain why I have never got this warning
>>> message on any compiler, and why only one of the two identical Ubuntu
>>> compilers did give this warning message?
>>>
>>> Best regards,
>>> Christian
>>
>> I don?t know, but this:
>>
>> numsels = ++numsels ;
>>
>> seems fishy to me, and so it keeps feeling weird with the addition of
>> the ternary operator.
>>
>> There is obviously a difference of setup between these two machines,
>> but I don?t have time to sherlock that for you. One of the compilers
>> is getting more careful than the other. Getting warnings you did not
>> get before is a good thing, as it helps you update the code with that
>> new insight.
>>
>> Welcome to my world, I?m sometimes thrown all kinds of new warnings
>> from esoteric compilers, all of them have value .
>>
>> Romain
>>
>>> On 6/23/14 3:45 PM, Romain Fran?ois wrote:
>>>>
>>>> Le 23 juin 2014 ? 15:20, cstrato <cstrato at aon.at> a ?crit :
>>>>
>>>>> Dear all,
>>>>>
>>>>> Since many years the following C++ code does compile on ALL
>>>>> Bioconductor servers (Linux, Windows, Mac) without any warnings:
>>>>>
>>>>>    Int_t numsels = 0;  //number of selected entries
>>>>>    ...
>>>>>    for (Int_t i=0; i<size; i++) {
>>>>>       numsels = (arrMask[i] == 1) ? ++numsels : numsels;
>>>>>    }//for_i
>>>>
>>>> This is confusing. I would write the loop body like this:
>>>>
>>>> numsels += (arrMask[i] == 1) ;
>>>>
>>>>
>>>> or preferably using the STL:
>>>>
>>>> Int_t numsels = std::count( begin(arrMask), end(arrMask), 1 ) ;
>>>>
>>>> or some other variation of this, i.e. perhaps you don?t have a C++11
>>>> compiler, so perhaps one of these depending on what is arrMask:
>>>>
>>>> Int_t numsels = std::count( arrMask.begin(), arrMask.end(), 1 ) ;
>>>> Int_t numsels = std::count( arrMask, arrMask + size, 1 ) ;
>>>>
>>>> Romain
>>>>
>>>>> Even on the recently added release server 'zin2' Linux (Ubuntu
>>>>> 12.04.4 LTS) the above code compiles w/o warnings.
>>>>>
>>>>> However, on the new development server 'zin1' Linux (Ubuntu 12.04.4
>>>>> LTS) I get suddenly the following warning message:
>>>>>
>>>>> Found the following significant warnings:
>>>>>   XPSPreProcessing.cxx:3026:56: warning: operation on ?numsels? may
>>>>> be undefined [-Wsequence-point]
>>>>>
>>>>> Interestingly, both servers do not only run the same version of
>>>>> Ubuntu, but also the same version of the C++ compiler, i.e. g++
>>>>> (Ubuntu/Linaro 4.6.3-1ubuntu5) 4.6.3, and use the same flags, see:
>>>>> http://bioconductor.org/checkResults/2.14/bioc-LATEST/zin2-NodeInfo.html
>>>>>
>>>>> http://bioconductor.org/checkResults/devel/bioc-LATEST/zin1-NodeInfo.html
>>>>>
>>>>>
>>>>> My question is now, why do I suddenly get the compiler warning?
>>>>>
>>>>> The reason why I ask at R-devel and not Bioc-devel is that it may
>>>>> not only be a Bioc question, since I found the following links:
>>>>> http://c-faq.com/expr/seqpoints.html
>>>>> http://stackoverflow.com/questions/16838884/why-i-got-operation-may-be-undefined-in-statement-expression-in-c
>>>>>
>>>>>
>>>>> I am not sure if I understand the meaning, but until now I have
>>>>> never got any warning from any compiler the I have used (including
>>>>> MS Visual C++).
>>>>>
>>>>> Do I really have to replace '++numsels' with 'numsels+1'?
>>>>>
>>>>> Best regards,
>>>>> Christian
>>>>> _._._._._._._._._._._._._._._._._._
>>>>> C.h.r.i.s.t.i.a.n   S.t.r.a.t.o.w.a
>>>>> V.i.e.n.n.a           A.u.s.t.r.i.a
>>>>> e.m.a.i.l:        cstrato at aon.at
>>>>> _._._._._._._._._._._._._._._._._._
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From hpages at fhcrc.org  Tue Jun 24 00:42:07 2014
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Mon, 23 Jun 2014 15:42:07 -0700
Subject: [Rd]
 =?windows-1252?q?operation_on_=91numsels=92_may_be_undefined?=
In-Reply-To: <53A8A79A.9070301@fhcrc.org>
References: <53A8298C.9010605@aon.at>	<244EC819-4336-4A49-BAEB-86B57E8A2970@r-enthusiasts.com>	<53A855C6.1000301@aon.at>	<BE6B83B4-2A60-4F84-8B5F-C0754997E5C5@r-enthusiasts.com>	<53A877EE.1080201@aon.at>
	<53A8A79A.9070301@fhcrc.org>
Message-ID: <53A8AD3F.2030901@fhcrc.org>

On 06/23/2014 03:18 PM, Herv? Pag?s wrote:
> Hi Christian,
>
> On 06/23/2014 11:54 AM, cstrato wrote:
>> Dear Romain,
>>
>> I do not know enough about compilers, but as far as I remember, they
>> 'work' from right to left,
>
> Not necessarily. So you should not rely on that. This is what the
> (somewhat obscure) warning you see on zin1 is trying to tell you.

Actually, I don't see an ambiguity in your code:

   numsels = (arrMask[i] == 1) ? ++numsels : numsels;

Yes it's confusing and unnecessarily complicated but I don't see that
it relies on some undefined behavior. It's not like in the thread on
Bioc-devel where the expression was:

   *p++ = tolower(*p);

In that case the left-value of the assignment is itself an expression
that needs to be evaluated and the outcome of the assignment depends
on whether the left-value is evaluated before the right expression or
not. But in your case the left-value is a variable name so there is
nothing to evaluate.

So I don't know. Looks like a false positive from the gcc compiler to
me. Someone on the list might have a better insight.

Cheers,
H.


> Personally I would just do:
>
>      if (arrMask[i] == 1) numsels++;
>
> which is the standard way to implement the "if (some condition)
> then increment counter" idiom.
>
> As Kasper mentioned, a similar issue was recently discussed here:
>
>    https://stat.ethz.ch/pipermail/bioc-devel/2014-June/005858.html
>
> Cheers,
> H.
>
>
>> so numsels = ++numsels should not confuse the
>> compiler. Anyhow I will change my code to your first suggestion since it
>> is more elegant.
>>
>> Best regards,
>> Christian
>>
>>
>> On 6/23/14 7:13 PM, Romain Fran?ois wrote:
>>>
>>> Le 23 juin 2014 ? 18:28, cstrato <cstrato at aon.at> a ?crit :
>>>
>>>> Dear Romain,
>>>>
>>>> Thank you for your suggestions, I like especially the first one.
>>>>
>>>> However, you did not explain why I have never got this warning
>>>> message on any compiler, and why only one of the two identical Ubuntu
>>>> compilers did give this warning message?
>>>>
>>>> Best regards,
>>>> Christian
>>>
>>> I don?t know, but this:
>>>
>>> numsels = ++numsels ;
>>>
>>> seems fishy to me, and so it keeps feeling weird with the addition of
>>> the ternary operator.
>>>
>>> There is obviously a difference of setup between these two machines,
>>> but I don?t have time to sherlock that for you. One of the compilers
>>> is getting more careful than the other. Getting warnings you did not
>>> get before is a good thing, as it helps you update the code with that
>>> new insight.
>>>
>>> Welcome to my world, I?m sometimes thrown all kinds of new warnings
>>> from esoteric compilers, all of them have value .
>>>
>>> Romain
>>>
>>>> On 6/23/14 3:45 PM, Romain Fran?ois wrote:
>>>>>
>>>>> Le 23 juin 2014 ? 15:20, cstrato <cstrato at aon.at> a ?crit :
>>>>>
>>>>>> Dear all,
>>>>>>
>>>>>> Since many years the following C++ code does compile on ALL
>>>>>> Bioconductor servers (Linux, Windows, Mac) without any warnings:
>>>>>>
>>>>>>    Int_t numsels = 0;  //number of selected entries
>>>>>>    ...
>>>>>>    for (Int_t i=0; i<size; i++) {
>>>>>>       numsels = (arrMask[i] == 1) ? ++numsels : numsels;
>>>>>>    }//for_i
>>>>>
>>>>> This is confusing. I would write the loop body like this:
>>>>>
>>>>> numsels += (arrMask[i] == 1) ;
>>>>>
>>>>>
>>>>> or preferably using the STL:
>>>>>
>>>>> Int_t numsels = std::count( begin(arrMask), end(arrMask), 1 ) ;
>>>>>
>>>>> or some other variation of this, i.e. perhaps you don?t have a C++11
>>>>> compiler, so perhaps one of these depending on what is arrMask:
>>>>>
>>>>> Int_t numsels = std::count( arrMask.begin(), arrMask.end(), 1 ) ;
>>>>> Int_t numsels = std::count( arrMask, arrMask + size, 1 ) ;
>>>>>
>>>>> Romain
>>>>>
>>>>>> Even on the recently added release server 'zin2' Linux (Ubuntu
>>>>>> 12.04.4 LTS) the above code compiles w/o warnings.
>>>>>>
>>>>>> However, on the new development server 'zin1' Linux (Ubuntu 12.04.4
>>>>>> LTS) I get suddenly the following warning message:
>>>>>>
>>>>>> Found the following significant warnings:
>>>>>>   XPSPreProcessing.cxx:3026:56: warning: operation on ?numsels? may
>>>>>> be undefined [-Wsequence-point]
>>>>>>
>>>>>> Interestingly, both servers do not only run the same version of
>>>>>> Ubuntu, but also the same version of the C++ compiler, i.e. g++
>>>>>> (Ubuntu/Linaro 4.6.3-1ubuntu5) 4.6.3, and use the same flags, see:
>>>>>> http://bioconductor.org/checkResults/2.14/bioc-LATEST/zin2-NodeInfo.html
>>>>>>
>>>>>>
>>>>>> http://bioconductor.org/checkResults/devel/bioc-LATEST/zin1-NodeInfo.html
>>>>>>
>>>>>>
>>>>>>
>>>>>> My question is now, why do I suddenly get the compiler warning?
>>>>>>
>>>>>> The reason why I ask at R-devel and not Bioc-devel is that it may
>>>>>> not only be a Bioc question, since I found the following links:
>>>>>> http://c-faq.com/expr/seqpoints.html
>>>>>> http://stackoverflow.com/questions/16838884/why-i-got-operation-may-be-undefined-in-statement-expression-in-c
>>>>>>
>>>>>>
>>>>>>
>>>>>> I am not sure if I understand the meaning, but until now I have
>>>>>> never got any warning from any compiler the I have used (including
>>>>>> MS Visual C++).
>>>>>>
>>>>>> Do I really have to replace '++numsels' with 'numsels+1'?
>>>>>>
>>>>>> Best regards,
>>>>>> Christian
>>>>>> _._._._._._._._._._._._._._._._._._
>>>>>> C.h.r.i.s.t.i.a.n   S.t.r.a.t.o.w.a
>>>>>> V.i.e.n.n.a           A.u.s.t.r.i.a
>>>>>> e.m.a.i.l:        cstrato at aon.at
>>>>>> _._._._._._._._._._._._._._._._._._
>>>>>>
>>>>>> ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>>
>>>
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From kasperdanielhansen at gmail.com  Tue Jun 24 06:22:57 2014
From: kasperdanielhansen at gmail.com (Kasper Daniel Hansen)
Date: Tue, 24 Jun 2014 00:22:57 -0400
Subject: [Rd]
	=?utf-8?q?operation_on_=E2=80=98numsels=E2=80=99_may_be_unde?=
	=?utf-8?q?fined?=
In-Reply-To: <53A8AD3F.2030901@fhcrc.org>
References: <53A8298C.9010605@aon.at>
	<244EC819-4336-4A49-BAEB-86B57E8A2970@r-enthusiasts.com>
	<53A855C6.1000301@aon.at>
	<BE6B83B4-2A60-4F84-8B5F-C0754997E5C5@r-enthusiasts.com>
	<53A877EE.1080201@aon.at> <53A8A79A.9070301@fhcrc.org>
	<53A8AD3F.2030901@fhcrc.org>
Message-ID: <CAC2h7utL_vzyRCSOHB9xi+nqmkm3aqWwNBbiitvpsu4jevqr6g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140624/62ff43a2/attachment.pl>

From kevinushey at gmail.com  Tue Jun 24 07:28:21 2014
From: kevinushey at gmail.com (Kevin Ushey)
Date: Mon, 23 Jun 2014 22:28:21 -0700
Subject: [Rd]
	=?utf-8?q?operation_on_=E2=80=98numsels=E2=80=99_may_be_unde?=
	=?utf-8?q?fined?=
In-Reply-To: <CAC2h7utL_vzyRCSOHB9xi+nqmkm3aqWwNBbiitvpsu4jevqr6g@mail.gmail.com>
References: <53A8298C.9010605@aon.at>
	<244EC819-4336-4A49-BAEB-86B57E8A2970@r-enthusiasts.com>
	<53A855C6.1000301@aon.at>
	<BE6B83B4-2A60-4F84-8B5F-C0754997E5C5@r-enthusiasts.com>
	<53A877EE.1080201@aon.at> <53A8A79A.9070301@fhcrc.org>
	<53A8AD3F.2030901@fhcrc.org>
	<CAC2h7utL_vzyRCSOHB9xi+nqmkm3aqWwNBbiitvpsu4jevqr6g@mail.gmail.com>
Message-ID: <CAJXgQP0racSjePV_Aoexkcr6DGCyQ_VZv7GF+SuJfGm_da6rYA@mail.gmail.com>

I don't see what's so surprising here.

That statement is identical to writing:

    if (arrMask[i] == 1) {
        numsels = ++numsels;
    } else {
        numsels = numsels;
    }

and

    numsels = ++numsels;

has two statements modifying the value of numsels (= and prefix-++) in
a single sequence point. (Do we increment then assign, or assign then
increment? The C / C++ standards leave this undefined.)

Imagine writing the operations out as functions: we have the `=`
function, and the `prefix-++` function -- both of these 'modify' (one
of) their arguments. Do we evaluate it as `=`(a, `prefix-++`(a)) or
`prefix-++`(`=`(a, a))? The C standard leaves this undefined, so
compilers are free to do what they wish (and the nice ones warn you
when there is such an ambiguity). I guess the net result of the
operation is the same in each case _here_, but this is of course not
the case for other functions that modify the value of their
operand(s). And, in truth, this is _undefined behaviour_ and so the
compiler could still rightly make demons fly out of your nose if it
wanted to upon program execution.

I highly recommend reading the slides at
http://www.slideshare.net/olvemaudal/deep-c, especially the bit on
sequence points.

Cheers,
Kevin

On Mon, Jun 23, 2014 at 9:22 PM, Kasper Daniel Hansen
<kasperdanielhansen at gmail.com> wrote:
> I am not an expert on this, but I note that the section on -Wsequence-point
> at
>   http://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html
> specifically mentions ? and :.  Perhaps some more work on tracking down
> their definitions and precedence might lead to insights.
>
> Best,
> Kasper
>
>
> On Mon, Jun 23, 2014 at 6:42 PM, Herv? Pag?s <hpages at fhcrc.org> wrote:
>
>> On 06/23/2014 03:18 PM, Herv? Pag?s wrote:
>>
>>> Hi Christian,
>>>
>>> On 06/23/2014 11:54 AM, cstrato wrote:
>>>
>>>> Dear Romain,
>>>>
>>>> I do not know enough about compilers, but as far as I remember, they
>>>> 'work' from right to left,
>>>>
>>>
>>> Not necessarily. So you should not rely on that. This is what the
>>> (somewhat obscure) warning you see on zin1 is trying to tell you.
>>>
>>
>> Actually, I don't see an ambiguity in your code:
>>
>>
>>   numsels = (arrMask[i] == 1) ? ++numsels : numsels;
>>
>> Yes it's confusing and unnecessarily complicated but I don't see that
>> it relies on some undefined behavior. It's not like in the thread on
>> Bioc-devel where the expression was:
>>
>>   *p++ = tolower(*p);
>>
>> In that case the left-value of the assignment is itself an expression
>> that needs to be evaluated and the outcome of the assignment depends
>> on whether the left-value is evaluated before the right expression or
>> not. But in your case the left-value is a variable name so there is
>> nothing to evaluate.
>>
>> So I don't know. Looks like a false positive from the gcc compiler to
>> me. Someone on the list might have a better insight.
>>
>> Cheers,
>>
>> H.
>>
>>
>>  Personally I would just do:
>>>
>>>      if (arrMask[i] == 1) numsels++;
>>>
>>> which is the standard way to implement the "if (some condition)
>>> then increment counter" idiom.
>>>
>>> As Kasper mentioned, a similar issue was recently discussed here:
>>>
>>>    https://stat.ethz.ch/pipermail/bioc-devel/2014-June/005858.html
>>>
>>> Cheers,
>>> H.
>>>
>>>
>>>  so numsels = ++numsels should not confuse the
>>>> compiler. Anyhow I will change my code to your first suggestion since it
>>>> is more elegant.
>>>>
>>>> Best regards,
>>>> Christian
>>>>
>>>>
>>>> On 6/23/14 7:13 PM, Romain Fran?ois wrote:
>>>>
>>>>>
>>>>> Le 23 juin 2014 ? 18:28, cstrato <cstrato at aon.at> a ?crit :
>>>>>
>>>>>  Dear Romain,
>>>>>>
>>>>>> Thank you for your suggestions, I like especially the first one.
>>>>>>
>>>>>> However, you did not explain why I have never got this warning
>>>>>> message on any compiler, and why only one of the two identical Ubuntu
>>>>>> compilers did give this warning message?
>>>>>>
>>>>>> Best regards,
>>>>>> Christian
>>>>>>
>>>>>
>>>>> I don?t know, but this:
>>>>>
>>>>> numsels = ++numsels ;
>>>>>
>>>>> seems fishy to me, and so it keeps feeling weird with the addition of
>>>>> the ternary operator.
>>>>>
>>>>> There is obviously a difference of setup between these two machines,
>>>>> but I don?t have time to sherlock that for you. One of the compilers
>>>>> is getting more careful than the other. Getting warnings you did not
>>>>> get before is a good thing, as it helps you update the code with that
>>>>> new insight.
>>>>>
>>>>> Welcome to my world, I?m sometimes thrown all kinds of new warnings
>>>>> from esoteric compilers, all of them have value .
>>>>>
>>>>> Romain
>>>>>
>>>>>  On 6/23/14 3:45 PM, Romain Fran?ois wrote:
>>>>>>
>>>>>>>
>>>>>>> Le 23 juin 2014 ? 15:20, cstrato <cstrato at aon.at> a ?crit :
>>>>>>>
>>>>>>>  Dear all,
>>>>>>>>
>>>>>>>> Since many years the following C++ code does compile on ALL
>>>>>>>> Bioconductor servers (Linux, Windows, Mac) without any warnings:
>>>>>>>>
>>>>>>>>    Int_t numsels = 0;  //number of selected entries
>>>>>>>>    ...
>>>>>>>>    for (Int_t i=0; i<size; i++) {
>>>>>>>>       numsels = (arrMask[i] == 1) ? ++numsels : numsels;
>>>>>>>>    }//for_i
>>>>>>>>
>>>>>>>
>>>>>>> This is confusing. I would write the loop body like this:
>>>>>>>
>>>>>>> numsels += (arrMask[i] == 1) ;
>>>>>>>
>>>>>>>
>>>>>>> or preferably using the STL:
>>>>>>>
>>>>>>> Int_t numsels = std::count( begin(arrMask), end(arrMask), 1 ) ;
>>>>>>>
>>>>>>> or some other variation of this, i.e. perhaps you don?t have a C++11
>>>>>>> compiler, so perhaps one of these depending on what is arrMask:
>>>>>>>
>>>>>>> Int_t numsels = std::count( arrMask.begin(), arrMask.end(), 1 ) ;
>>>>>>> Int_t numsels = std::count( arrMask, arrMask + size, 1 ) ;
>>>>>>>
>>>>>>> Romain
>>>>>>>
>>>>>>>  Even on the recently added release server 'zin2' Linux (Ubuntu
>>>>>>>> 12.04.4 LTS) the above code compiles w/o warnings.
>>>>>>>>
>>>>>>>> However, on the new development server 'zin1' Linux (Ubuntu 12.04.4
>>>>>>>> LTS) I get suddenly the following warning message:
>>>>>>>>
>>>>>>>> Found the following significant warnings:
>>>>>>>>   XPSPreProcessing.cxx:3026:56: warning: operation on ?numsels? may
>>>>>>>> be undefined [-Wsequence-point]
>>>>>>>>
>>>>>>>> Interestingly, both servers do not only run the same version of
>>>>>>>> Ubuntu, but also the same version of the C++ compiler, i.e. g++
>>>>>>>> (Ubuntu/Linaro 4.6.3-1ubuntu5) 4.6.3, and use the same flags, see:
>>>>>>>> http://bioconductor.org/checkResults/2.14/bioc-LATEST/
>>>>>>>> zin2-NodeInfo.html
>>>>>>>>
>>>>>>>>
>>>>>>>> http://bioconductor.org/checkResults/devel/bioc-
>>>>>>>> LATEST/zin1-NodeInfo.html
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> My question is now, why do I suddenly get the compiler warning?
>>>>>>>>
>>>>>>>> The reason why I ask at R-devel and not Bioc-devel is that it may
>>>>>>>> not only be a Bioc question, since I found the following links:
>>>>>>>> http://c-faq.com/expr/seqpoints.html
>>>>>>>> http://stackoverflow.com/questions/16838884/why-i-got-
>>>>>>>> operation-may-be-undefined-in-statement-expression-in-c
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> I am not sure if I understand the meaning, but until now I have
>>>>>>>> never got any warning from any compiler the I have used (including
>>>>>>>> MS Visual C++).
>>>>>>>>
>>>>>>>> Do I really have to replace '++numsels' with 'numsels+1'?
>>>>>>>>
>>>>>>>> Best regards,
>>>>>>>> Christian
>>>>>>>> _._._._._._._._._._._._._._._._._._
>>>>>>>> C.h.r.i.s.t.i.a.n   S.t.r.a.t.o.w.a
>>>>>>>> V.i.e.n.n.a           A.u.s.t.r.i.a
>>>>>>>> e.m.a.i.l:        cstrato at aon.at
>>>>>>>> _._._._._._._._._._._._._._._._._._
>>>>>>>>
>>>>>>>> ______________________________________________
>>>>>>>> R-devel at r-project.org mailing list
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>
>>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>>
>> --
>> Herv? Pag?s
>>
>> Program in Computational Biology
>> Division of Public Health Sciences
>> Fred Hutchinson Cancer Research Center
>> 1100 Fairview Ave. N, M1-B514
>> P.O. Box 19024
>> Seattle, WA 98109-1024
>>
>> E-mail: hpages at fhcrc.org
>> Phone:  (206) 667-5791
>> Fax:    (206) 667-1319
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>         [[alternative HTML version deleted]]
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From kevinushey at gmail.com  Tue Jun 24 08:28:04 2014
From: kevinushey at gmail.com (Kevin Ushey)
Date: Mon, 23 Jun 2014 23:28:04 -0700
Subject: [Rd] Curious behavior of $ and lapply
In-Reply-To: <CACLVabXgnoWajqk30r9+ufC1fk_C9xQWc7fc1JQKxh5tuYvOWg@mail.gmail.com>
References: <CACLVabXgnoWajqk30r9+ufC1fk_C9xQWc7fc1JQKxh5tuYvOWg@mail.gmail.com>
Message-ID: <CAJXgQP3FZEqsaXOOh+o9JOKj8fvuQygO2=k56ApO_Ey3ykteOg@mail.gmail.com>

`lapply` basically takes its call and massages into calls of the following form:

    FUN(X[[1L]], ...)
    FUN(X[[2L]], ...)
    ... <up to length of X>

that get evaluated in the appropriate environment.

For `lapply(list(list(a=3,b=4)),"$","b")`, you can imagine that a
function `FUN` of the form:

    FUN <- function(x, ...) "$"(x, ...)

is being generated, and then evaluated as

    FUN(list(list(a=3, b=4))[[1L]], "b") ## returns NULL

and I can only guess that the non-standard evaluation of `$` is not
interpreting `...` as you expect.

Moral of the story -- lapply does non-standard evaluation, and does
not compose nicely with other functions performing non-standard
evaluation. This is discussed a bit in the Note: section of `?lapply`.
Copied from there (emphasis mine):

For historical reasons, the calls created by lapply are unevaluated,
and code has been written (e.g. bquote) that relies on this. This
means that the recorded call is always of the form FUN(X[[i]], ...),
with i replaced by the current (integer or double) index. This is not
normally a problem, but it can be if FUN uses sys.call or match.call
or if it __is a primitive function that makes use of the call__. This
means that it is often safer to call primitive functions with a
wrapper, so that e.g. lapply(ll, function(x) is.numeric(x)) is
required to ensure that method dispatch for is.numeric occurs
correctly.

Cheers,
Kevin


On Mon, Jun 23, 2014 at 3:04 PM, Stavros Macrakis (??????? ????????)
<macrakis at alum.mit.edu> wrote:
> There seems to be a funny interaction between lapply and "$" -- also, "$"
> doesn't signal an error in some cases where "[[" does.
>
> The $ operator accepts a string second argument in functional form:
>
>> `$`(list(a=3,b=4),"b")
> [1] 4
>
> lapply(list(list(a=3,b=4)),function(x) `$`(x,"b"))
> [[1]]
> [1] 4
>
> ... but using an lapply "..." argument, this returns NULL:
>
>> lapply(list(list(a=3,b=4)),"$","b")
> [[1]]
> NULL
>
> Equally strangely, a symbol is an error in functional form:
>
>>  `$`(list(a=3,b=4),quote(`b`))
> Error in list(a = 3, b = 4)$quote(b) : invalid subscript type 'language'
>
> ... but not an error in lapply, where it returns NULL:
>
>> lapply(list(list(a=3,b=4)),`$`,quote(`b`))
> [[1]]
> NULL
>
> I wonder if lapply is failing to pass the second argument to $ correctly,
> since $ with various unreasonable second arguments returns NULL (shouldn't
> it given an error?):
>
> "$"(list(list(a=3,b=4)),) => NULL
> lapply(list(list(a=3,b=4)),`$`,function(i)i) => NULL
>
> Compare
>
> "[["(list(list(a=3,b=4)),) => <<error>>
>
> But with [[, lapply correctly gives an error:
>
> lapply(list(list(a=3,b=4)),`[[`,function(i)i) => <<error>>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From armgong at yahoo.com  Tue Jun 24 08:57:51 2014
From: armgong at yahoo.com (Yu Gong)
Date: Mon, 23 Jun 2014 23:57:51 -0700
Subject: [Rd] using C code to create data frame but always return as list
Message-ID: <1403593071.58141.YahooMailNeo@web162903.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140623/16f2d89b/attachment.pl>

From armgong at yahoo.com  Tue Jun 24 09:19:52 2014
From: armgong at yahoo.com (Yu Gong)
Date: Tue, 24 Jun 2014 00:19:52 -0700
Subject: [Rd] using C code to create data frame but always return as list
In-Reply-To: <1403593071.58141.YahooMailNeo@web162903.mail.bf1.yahoo.com>
References: <1403593071.58141.YahooMailNeo@web162903.mail.bf1.yahoo.com>
Message-ID: <1403594392.62836.YahooMailNeo@web162905.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140624/f6ba449a/attachment.pl>

From murdoch.duncan at gmail.com  Tue Jun 24 09:20:30 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 24 Jun 2014 09:20:30 +0200
Subject: [Rd] Unfixed bugs in latest R-patched
In-Reply-To: <20140623152435.GA22211@cs.toronto.edu>
References: <20140623152435.GA22211@cs.toronto.edu>
Message-ID: <53A926BE.4030205@gmail.com>

It's hardly fair to call these "unfixed bugs".  Most of them are better
described as "unreported bugs", or, after this posting, "bugs reported
with insufficient detail".  We can't fix them if we don't know what they
are, and it's not easy to determine that for most of the items below.

Duncan Murdoch

On 23/06/2014, 5:24 PM, Radford Neal wrote:
> A new version of pqR is now available at pqR-project.org, which fixes
> several bugs that are also present in the latest R Core patch release
> (r66002).  A number of bugs found previously during pqR development
> are also unfixed in the latest R Core release.  Here is the list of
> these bugs that are unfixed in r66002 (including documentation
> deficiencies), taken from the pqR bug fix and documentation update
> sections of the pqR NEWS file (pqR-project.org/NEWS.txt):
> 
>     o The documentation for c now says how the names for the result are
>       determined, including previously missing information on the
>       use.names argument, and on the role of the names of arguments in
>       the call of c.  This documentation is missing in R-2.15.0 and
>       R-3.1.0.
> 
>     o The documentaton for diag now documents that a diagonal matrix is
>       always created with type double or complex, and that the names of
>       an extracted diagonal vector are taken from a names attribute (if
>       present), if not from the row and column names.  This information
>       is absent in the documentation in R-2.15.1 and R-3.1.0.
> 
>     o Incorrect information regarding the pointer protection stack was
>       removed from help(Memory).  This incorrect information is present
>       in R-2.15.0 and R-3.1.0 as well.
> 
>     o There is now information in help(Arithmetic) regarding what
>       happens when the operands of an arithmetic operation are NA or
>       NaN, including the arbitrary nature of the result when one
>       operand is NA and the other is NaN.  There is no discussion of
>       this issue in the documentation for R-2.15.0 and R-3.1.0.
> 
>     o Fixed lack of protection bugs in the equal and greater functions
>       in sort.c.  These bugs are also present in R-2.15.0 and R-3.1.0.
> 
>     o Fixed lack of protection bugs in the D function in deriv.c.
>       These bugs are also present in R-2.15.0 and R-3.1.0.
> 
>     o Fixed argument error-checking bugs in getGraphicsEventEnv and
>       setGraphicsEventEnv (also present in R-2.15.0 and R-3.1.0).
> 
>     o Fixed the following bug (also present in R-2.15.0 and R-3.0.2):
>       
>           x <- t(5)
>           print (x %*% c(3,4))
>           print (crossprod(5,c(3,4)))
> 
>       The call of crossprod produced an error, whereas the
>       corresponding use of %*% does not.
> 
>       In pqR-2013-12-29, this bug also affected the expression t(5) %*%
>       c(3,4), since it is converted to the equivalent of
>       crossprod(5,c(3,4)).
> 
>     o Fixed a problem in R_AllocStringBuffer that could result in a
>       crash due to an invalid memory access.  (This bug is also present
>       in R-2.15.0 and R-3.0.2.)
> 
>     o The documentation for aperm now says that the default method does
>       not copy attributes (other than dimensions and dimnames).
>       Previously, it incorrecty said it did (as is the case also in
>       R-2.15.0 and R-3.0.2).
> 
>     o Fixed the following bug (also present in R-2.15.0 and R-3.0.2):
>       
>          v <- c(1,2)
>          m <- matrix(c(3,4),1,2)
>          print(t(m)%*%v)
>          print(crossprod(m,v))
> 
>       in which crossprod gave an error rather than produce the answer
>       for the corresponding use of %*%.
> 
>     o Raising -Inf to a large value (eg, (-Inf)^(1e16)) no longer
>       produces an incomprehensible warning.  As before, the value
>       returned is Inf, because (due to their limited-precision
>       floating-point representation) all such large numbers are even
>       integers.
> 
>     o Fixed a bug (also present in R-2.15.0 and R-3.0.1) illustrated by
>       the following code:
>       
>          > a <- list(x=c(1,2),y=c(3,4))
>          > b <- as.pairlist(a)
>          > b$x[1] <- 9
>          > print(a)
>          $x
>          [1] 9 2
>          
>          $y
>          [1] 3 4
> 
>       The value printed for a has a$x[1] changed to 9, when it should
>       still be 1. See pqR issue #14.
> 
>     o Fixed several bugs (also present in R-2.15.0 and R-3.0.1)
>       illustrated by the code below (see pqR issue #16):
>       
>          v <- c(10,20,30)
>          v[[2]] <- NULL        # wrong error message
>          
>          x <- pairlist(list(1,2))
>          x[[c(1,2)]] <- NULL   # wrongly gives an error, referring to misuse
>                                # of the internal SET_VECTOR_ELT procedure
>          
>          v<-list(1)
>          v[[quote(abc)]] <- 2  # internal error, this time for SET_STRING_ELT
>          
>          a <- pairlist(10,20,30,40,50,60)
>          dim(a) <- c(2,3)
>          dimnames(a) <- list(c("a","b"),c("x","y","z"))
>          print(a)              # doesn't print names
>          
>          a[["a","x"]] <- 0     # crashes with a segmentation fault
> 
>     o Fixed a bug where, for example, log(base=4) returned the natural
>       log of 4, rather than signalling an error.
> 
>     o The documentation on what MARGIN arguments are allowed for apply
>       has been clarified, and checks for validity added.  The call
>       
>          > apply(array(1:24,c(2,3,4)),-3,sum)
> 
>       now produces correct results (the same as when MARGIN is 1:2).
> 
>     o Fixed a bug in which Im(matrix(complex(0),3,4)) returned a matrix
>       of zero elements rather than a matrix of NA elements.
> 
>     o Now check for bad arguments for .rowSums, .colSums, .rowMeans,
>       and .rowMeans (would previously segfault if n*p too big).
> 
>     o Fixed a bug where excess warning messages may be produced on
>       conversion to RAW.  For instance:
>       
>          > as.raw(1e40)
>          [1] 00
>          Warning messages:
>          1: NAs introduced by coercion 
>          2: out-of-range values treated as 0 in coercion to raw 
> 
>       Now, only the second warning message is produced.
> 
>     o A bug has been fixed in which rbind would not handle non-vector
>       objects such as function closures, whereas cbind did handle them,
>       and both were documented to do so.
> 
> Regards,
> 
>    Radford Neal
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From romain at r-enthusiasts.com  Tue Jun 24 09:21:40 2014
From: romain at r-enthusiasts.com (Romain Francois)
Date: Tue, 24 Jun 2014 09:21:40 +0200
Subject: [Rd] using C code to create data frame but always return as list
In-Reply-To: <1403593071.58141.YahooMailNeo@web162903.mail.bf1.yahoo.com>
References: <1403593071.58141.YahooMailNeo@web162903.mail.bf1.yahoo.com>
Message-ID: <1E9AC80C-C494-454F-9821-747152C88BFE@r-enthusiasts.com>

Hi, 

Can you give us what str on the returned object gives you? 

I think you need : 

SET_OBJECT(and, 1) ; 

at the end. 

Romain

Le 24 juin 2014 ? 08:57, Yu Gong <armgong at yahoo.com> a ?crit :

> there is my code,  expect return value  is a data frame but R say it is list:
> 
> SEXP Julia_R_MD_NA_DataFrame(jl_value_t* Var)
> {
>  SEXP ans,names,rownames;
>  char evalcmd[4096];
>  int i;
>  const char* dfname="DataFrameName0tmp";
>  jl_set_global(jl_main_module, jl_symbol(dfname), (jl_value_t*)Var);
>  //Get Frame cols 
>  sprintf(evalcmd,"size(%s,2)",dfname);
>  jl_value_t* cols=jl_eval_string(evalcmd);
>  int collen=jl_unbox_long(cols);
>  jl_value_t* eachcolvector;
>  //Create VECSXP
> 
>  //Create SEXP for Each Column and assign
>  PROTECT(ans=allocVector(VECSXP,collen));
>  for (i=0;i<collen;i++)
>  {
>   sprintf(evalcmd,"%s[%d]",dfname,i+1);
>   eachcolvector=jl_eval_string(evalcmd);
>   SET_VECTOR_ELT(ans,i,Julia_R_MD_NA(eachcolvector));
>  }
>  //set names attribute
>  sprintf(evalcmd,"names(%s)",dfname);
>  jl_value_t* ret=jl_eval_string(evalcmd);
>  jl_value_t* onesymbol;
>  if (jl_is_array(ret))
>  {
>   PROTECT(names=allocVector(STRSXP,collen));
>   for (i=0;i<jl_array_len(ret);i++)
>   { 
>    onesymbol=jl_arrayref((jl_array_t*)ret,i);
>    if (jl_is_symbol(onesymbol))
>     SET_STRING_ELT(names,i,mkChar(((jl_sym_t*)onesymbol)->name));
>   }
>   setAttrib(ans,R_NamesSymbol,names);
>   UNPROTECT(1);
>  } 
>  //set row names
>  sprintf(evalcmd,"size(%s,1)",dfname);
>  jl_value_t* rows=jl_eval_string(evalcmd);
>  int rowlen=jl_unbox_long(rows);
>  PROTECT(rownames=allocVector(INTSXP,rowlen));
>  for (i=0;i<rowlen;i++)
>   INTEGER(rownames)[i]=i+1;
>  setAttrib(ans,R_RowNamesSymbol,rownames);
>  UNPROTECT(1);
>  //set class as data frame
>  setAttrib(ans,R_ClassSymbol,mkString("data.frame"));
>  UNPROTECT(1);
>  return ans;
> }


From radford at cs.toronto.edu  Tue Jun 24 13:40:05 2014
From: radford at cs.toronto.edu (Radford Neal)
Date: Tue, 24 Jun 2014 07:40:05 -0400
Subject: [Rd] Unfixed bugs in latest R-patched
In-Reply-To: <53A926BE.4030205@gmail.com>
References: <20140623152435.GA22211@cs.toronto.edu>
	<53A926BE.4030205@gmail.com>
Message-ID: <20140624114005.GA10010@cs.toronto.edu>

On Tue, Jun 24, 2014 at 09:20:30AM +0200, Duncan Murdoch wrote:
> It's hardly fair to call these "unfixed bugs".  Most of them are better
> described as "unreported bugs", or, after this posting, "bugs reported
> with insufficient detail".  We can't fix them if we don't know what they
> are, and it's not easy to determine that for most of the items below.

I think most of them are pretty clear.  For the ones referring to lack
of protection or argument error checking code, I suggesting doing a
"diff" on the source files to find where I made changes.

If your complaint is that your time is more valuable than my time, so
I should be producing a nice patch for you, then I don't agree.  I went 
to the effort of verifing that the bugs are still present in r66002.  
That's as much as I'm willing to do.  It's up to you what you do.

   Radford Neal


> On 23/06/2014, 5:24 PM, Radford Neal wrote:
> > A new version of pqR is now available at pqR-project.org, which fixes
> > several bugs that are also present in the latest R Core patch release
> > (r66002).  A number of bugs found previously during pqR development
> > are also unfixed in the latest R Core release.  Here is the list of
> > these bugs that are unfixed in r66002 (including documentation
> > deficiencies), taken from the pqR bug fix and documentation update
> > sections of the pqR NEWS file (pqR-project.org/NEWS.txt):
> > 
> >     o The documentation for c now says how the names for the result are
> >       determined, including previously missing information on the
> >       use.names argument, and on the role of the names of arguments in
> >       the call of c.  This documentation is missing in R-2.15.0 and
> >       R-3.1.0.
> > 
> >     o The documentaton for diag now documents that a diagonal matrix is
> >       always created with type double or complex, and that the names of
> >       an extracted diagonal vector are taken from a names attribute (if
> >       present), if not from the row and column names.  This information
> >       is absent in the documentation in R-2.15.1 and R-3.1.0.
> > 
> >     o Incorrect information regarding the pointer protection stack was
> >       removed from help(Memory).  This incorrect information is present
> >       in R-2.15.0 and R-3.1.0 as well.
> > 
> >     o There is now information in help(Arithmetic) regarding what
> >       happens when the operands of an arithmetic operation are NA or
> >       NaN, including the arbitrary nature of the result when one
> >       operand is NA and the other is NaN.  There is no discussion of
> >       this issue in the documentation for R-2.15.0 and R-3.1.0.
> > 
> >     o Fixed lack of protection bugs in the equal and greater functions
> >       in sort.c.  These bugs are also present in R-2.15.0 and R-3.1.0.
> > 
> >     o Fixed lack of protection bugs in the D function in deriv.c.
> >       These bugs are also present in R-2.15.0 and R-3.1.0.
> > 
> >     o Fixed argument error-checking bugs in getGraphicsEventEnv and
> >       setGraphicsEventEnv (also present in R-2.15.0 and R-3.1.0).
> > 
> >     o Fixed the following bug (also present in R-2.15.0 and R-3.0.2):
> >       
> >           x <- t(5)
> >           print (x %*% c(3,4))
> >           print (crossprod(5,c(3,4)))
> > 
> >       The call of crossprod produced an error, whereas the
> >       corresponding use of %*% does not.
> > 
> >       In pqR-2013-12-29, this bug also affected the expression t(5) %*%
> >       c(3,4), since it is converted to the equivalent of
> >       crossprod(5,c(3,4)).
> > 
> >     o Fixed a problem in R_AllocStringBuffer that could result in a
> >       crash due to an invalid memory access.  (This bug is also present
> >       in R-2.15.0 and R-3.0.2.)
> > 
> >     o The documentation for aperm now says that the default method does
> >       not copy attributes (other than dimensions and dimnames).
> >       Previously, it incorrecty said it did (as is the case also in
> >       R-2.15.0 and R-3.0.2).
> > 
> >     o Fixed the following bug (also present in R-2.15.0 and R-3.0.2):
> >       
> >          v <- c(1,2)
> >          m <- matrix(c(3,4),1,2)
> >          print(t(m)%*%v)
> >          print(crossprod(m,v))
> > 
> >       in which crossprod gave an error rather than produce the answer
> >       for the corresponding use of %*%.
> > 
> >     o Raising -Inf to a large value (eg, (-Inf)^(1e16)) no longer
> >       produces an incomprehensible warning.  As before, the value
> >       returned is Inf, because (due to their limited-precision
> >       floating-point representation) all such large numbers are even
> >       integers.
> > 
> >     o Fixed a bug (also present in R-2.15.0 and R-3.0.1) illustrated by
> >       the following code:
> >       
> >          > a <- list(x=c(1,2),y=c(3,4))
> >          > b <- as.pairlist(a)
> >          > b$x[1] <- 9
> >          > print(a)
> >          $x
> >          [1] 9 2
> >          
> >          $y
> >          [1] 3 4
> > 
> >       The value printed for a has a$x[1] changed to 9, when it should
> >       still be 1. See pqR issue #14.
> > 
> >     o Fixed several bugs (also present in R-2.15.0 and R-3.0.1)
> >       illustrated by the code below (see pqR issue #16):
> >       
> >          v <- c(10,20,30)
> >          v[[2]] <- NULL        # wrong error message
> >          
> >          x <- pairlist(list(1,2))
> >          x[[c(1,2)]] <- NULL   # wrongly gives an error, referring to misuse
> >                                # of the internal SET_VECTOR_ELT procedure
> >          
> >          v<-list(1)
> >          v[[quote(abc)]] <- 2  # internal error, this time for SET_STRING_ELT
> >          
> >          a <- pairlist(10,20,30,40,50,60)
> >          dim(a) <- c(2,3)
> >          dimnames(a) <- list(c("a","b"),c("x","y","z"))
> >          print(a)              # doesn't print names
> >          
> >          a[["a","x"]] <- 0     # crashes with a segmentation fault
> > 
> >     o Fixed a bug where, for example, log(base=4) returned the natural
> >       log of 4, rather than signalling an error.
> > 
> >     o The documentation on what MARGIN arguments are allowed for apply
> >       has been clarified, and checks for validity added.  The call
> >       
> >          > apply(array(1:24,c(2,3,4)),-3,sum)
> > 
> >       now produces correct results (the same as when MARGIN is 1:2).
> > 
> >     o Fixed a bug in which Im(matrix(complex(0),3,4)) returned a matrix
> >       of zero elements rather than a matrix of NA elements.
> > 
> >     o Now check for bad arguments for .rowSums, .colSums, .rowMeans,
> >       and .rowMeans (would previously segfault if n*p too big).
> > 
> >     o Fixed a bug where excess warning messages may be produced on
> >       conversion to RAW.  For instance:
> >       
> >          > as.raw(1e40)
> >          [1] 00
> >          Warning messages:
> >          1: NAs introduced by coercion 
> >          2: out-of-range values treated as 0 in coercion to raw 
> > 
> >       Now, only the second warning message is produced.
> > 
> >     o A bug has been fixed in which rbind would not handle non-vector
> >       objects such as function closures, whereas cbind did handle them,
> >       and both were documented to do so.
> > 
> > Regards,
> > 
> >    Radford Neal
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> > 
>


From cstrato at aon.at  Tue Jun 24 14:51:59 2014
From: cstrato at aon.at (cstrato)
Date: Tue, 24 Jun 2014 14:51:59 +0200
Subject: [Rd]
 =?utf-8?q?operation_on_=E2=80=98numsels=E2=80=99_may_be_unde?=
 =?utf-8?q?fined?=
In-Reply-To: <CAJXgQP0racSjePV_Aoexkcr6DGCyQ_VZv7GF+SuJfGm_da6rYA@mail.gmail.com>
References: <53A8298C.9010605@aon.at>	<244EC819-4336-4A49-BAEB-86B57E8A2970@r-enthusiasts.com>	<53A855C6.1000301@aon.at>	<BE6B83B4-2A60-4F84-8B5F-C0754997E5C5@r-enthusiasts.com>	<53A877EE.1080201@aon.at>	<53A8A79A.9070301@fhcrc.org>	<53A8AD3F.2030901@fhcrc.org>	<CAC2h7utL_vzyRCSOHB9xi+nqmkm3aqWwNBbiitvpsu4jevqr6g@mail.gmail.com>
	<CAJXgQP0racSjePV_Aoexkcr6DGCyQ_VZv7GF+SuJfGm_da6rYA@mail.gmail.com>
Message-ID: <53A9746F.3050906@aon.at>

Dear all,

Thank you very much for this interesting discussion, I appreciate it.

I think that Kevin gave a very good explanation why my code is 
ambiguous, although it is not clear to me why the C/C++ standard leaves 
this case undefined. One last question:
If I would write
    numsels = {++numsels;}
Is this also undefined or is this then allowed?

Best regards,
Christian


On 6/24/14 7:28 AM, Kevin Ushey wrote:
> I don't see what's so surprising here.
>
> That statement is identical to writing:
>
>      if (arrMask[i] == 1) {
>          numsels = ++numsels;
>      } else {
>          numsels = numsels;
>      }
>
> and
>
>      numsels = ++numsels;
>
> has two statements modifying the value of numsels (= and prefix-++) in
> a single sequence point. (Do we increment then assign, or assign then
> increment? The C / C++ standards leave this undefined.)
>
> Imagine writing the operations out as functions: we have the `=`
> function, and the `prefix-++` function -- both of these 'modify' (one
> of) their arguments. Do we evaluate it as `=`(a, `prefix-++`(a)) or
> `prefix-++`(`=`(a, a))? The C standard leaves this undefined, so
> compilers are free to do what they wish (and the nice ones warn you
> when there is such an ambiguity). I guess the net result of the
> operation is the same in each case _here_, but this is of course not
> the case for other functions that modify the value of their
> operand(s). And, in truth, this is _undefined behaviour_ and so the
> compiler could still rightly make demons fly out of your nose if it
> wanted to upon program execution.
>
> I highly recommend reading the slides at
> http://www.slideshare.net/olvemaudal/deep-c, especially the bit on
> sequence points.
>
> Cheers,
> Kevin
>
> On Mon, Jun 23, 2014 at 9:22 PM, Kasper Daniel Hansen
> <kasperdanielhansen at gmail.com> wrote:
>> I am not an expert on this, but I note that the section on -Wsequence-point
>> at
>>    http://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html
>> specifically mentions ? and :.  Perhaps some more work on tracking down
>> their definitions and precedence might lead to insights.
>>
>> Best,
>> Kasper
>>
>>
>> On Mon, Jun 23, 2014 at 6:42 PM, Herv? Pag?s <hpages at fhcrc.org> wrote:
>>
>>> On 06/23/2014 03:18 PM, Herv? Pag?s wrote:
>>>
>>>> Hi Christian,
>>>>
>>>> On 06/23/2014 11:54 AM, cstrato wrote:
>>>>
>>>>> Dear Romain,
>>>>>
>>>>> I do not know enough about compilers, but as far as I remember, they
>>>>> 'work' from right to left,
>>>>>
>>>>
>>>> Not necessarily. So you should not rely on that. This is what the
>>>> (somewhat obscure) warning you see on zin1 is trying to tell you.
>>>>
>>>
>>> Actually, I don't see an ambiguity in your code:
>>>
>>>
>>>    numsels = (arrMask[i] == 1) ? ++numsels : numsels;
>>>
>>> Yes it's confusing and unnecessarily complicated but I don't see that
>>> it relies on some undefined behavior. It's not like in the thread on
>>> Bioc-devel where the expression was:
>>>
>>>    *p++ = tolower(*p);
>>>
>>> In that case the left-value of the assignment is itself an expression
>>> that needs to be evaluated and the outcome of the assignment depends
>>> on whether the left-value is evaluated before the right expression or
>>> not. But in your case the left-value is a variable name so there is
>>> nothing to evaluate.
>>>
>>> So I don't know. Looks like a false positive from the gcc compiler to
>>> me. Someone on the list might have a better insight.
>>>
>>> Cheers,
>>>
>>> H.
>>>
>>>
>>>   Personally I would just do:
>>>>
>>>>       if (arrMask[i] == 1) numsels++;
>>>>
>>>> which is the standard way to implement the "if (some condition)
>>>> then increment counter" idiom.
>>>>
>>>> As Kasper mentioned, a similar issue was recently discussed here:
>>>>
>>>>     https://stat.ethz.ch/pipermail/bioc-devel/2014-June/005858.html
>>>>
>>>> Cheers,
>>>> H.
>>>>
>>>>
>>>>   so numsels = ++numsels should not confuse the
>>>>> compiler. Anyhow I will change my code to your first suggestion since it
>>>>> is more elegant.
>>>>>
>>>>> Best regards,
>>>>> Christian
>>>>>
>>>>>
>>>>> On 6/23/14 7:13 PM, Romain Fran?ois wrote:
>>>>>
>>>>>>
>>>>>> Le 23 juin 2014 ? 18:28, cstrato <cstrato at aon.at> a ?crit :
>>>>>>
>>>>>>   Dear Romain,
>>>>>>>
>>>>>>> Thank you for your suggestions, I like especially the first one.
>>>>>>>
>>>>>>> However, you did not explain why I have never got this warning
>>>>>>> message on any compiler, and why only one of the two identical Ubuntu
>>>>>>> compilers did give this warning message?
>>>>>>>
>>>>>>> Best regards,
>>>>>>> Christian
>>>>>>>
>>>>>>
>>>>>> I don?t know, but this:
>>>>>>
>>>>>> numsels = ++numsels ;
>>>>>>
>>>>>> seems fishy to me, and so it keeps feeling weird with the addition of
>>>>>> the ternary operator.
>>>>>>
>>>>>> There is obviously a difference of setup between these two machines,
>>>>>> but I don?t have time to sherlock that for you. One of the compilers
>>>>>> is getting more careful than the other. Getting warnings you did not
>>>>>> get before is a good thing, as it helps you update the code with that
>>>>>> new insight.
>>>>>>
>>>>>> Welcome to my world, I?m sometimes thrown all kinds of new warnings
>>>>>> from esoteric compilers, all of them have value .
>>>>>>
>>>>>> Romain
>>>>>>
>>>>>>   On 6/23/14 3:45 PM, Romain Fran?ois wrote:
>>>>>>>
>>>>>>>>
>>>>>>>> Le 23 juin 2014 ? 15:20, cstrato <cstrato at aon.at> a ?crit :
>>>>>>>>
>>>>>>>>   Dear all,
>>>>>>>>>
>>>>>>>>> Since many years the following C++ code does compile on ALL
>>>>>>>>> Bioconductor servers (Linux, Windows, Mac) without any warnings:
>>>>>>>>>
>>>>>>>>>     Int_t numsels = 0;  //number of selected entries
>>>>>>>>>     ...
>>>>>>>>>     for (Int_t i=0; i<size; i++) {
>>>>>>>>>        numsels = (arrMask[i] == 1) ? ++numsels : numsels;
>>>>>>>>>     }//for_i
>>>>>>>>>
>>>>>>>>
>>>>>>>> This is confusing. I would write the loop body like this:
>>>>>>>>
>>>>>>>> numsels += (arrMask[i] == 1) ;
>>>>>>>>
>>>>>>>>
>>>>>>>> or preferably using the STL:
>>>>>>>>
>>>>>>>> Int_t numsels = std::count( begin(arrMask), end(arrMask), 1 ) ;
>>>>>>>>
>>>>>>>> or some other variation of this, i.e. perhaps you don?t have a C++11
>>>>>>>> compiler, so perhaps one of these depending on what is arrMask:
>>>>>>>>
>>>>>>>> Int_t numsels = std::count( arrMask.begin(), arrMask.end(), 1 ) ;
>>>>>>>> Int_t numsels = std::count( arrMask, arrMask + size, 1 ) ;
>>>>>>>>
>>>>>>>> Romain
>>>>>>>>
>>>>>>>>   Even on the recently added release server 'zin2' Linux (Ubuntu
>>>>>>>>> 12.04.4 LTS) the above code compiles w/o warnings.
>>>>>>>>>
>>>>>>>>> However, on the new development server 'zin1' Linux (Ubuntu 12.04.4
>>>>>>>>> LTS) I get suddenly the following warning message:
>>>>>>>>>
>>>>>>>>> Found the following significant warnings:
>>>>>>>>>    XPSPreProcessing.cxx:3026:56: warning: operation on ?numsels? may
>>>>>>>>> be undefined [-Wsequence-point]
>>>>>>>>>
>>>>>>>>> Interestingly, both servers do not only run the same version of
>>>>>>>>> Ubuntu, but also the same version of the C++ compiler, i.e. g++
>>>>>>>>> (Ubuntu/Linaro 4.6.3-1ubuntu5) 4.6.3, and use the same flags, see:
>>>>>>>>> http://bioconductor.org/checkResults/2.14/bioc-LATEST/
>>>>>>>>> zin2-NodeInfo.html
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> http://bioconductor.org/checkResults/devel/bioc-
>>>>>>>>> LATEST/zin1-NodeInfo.html
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> My question is now, why do I suddenly get the compiler warning?
>>>>>>>>>
>>>>>>>>> The reason why I ask at R-devel and not Bioc-devel is that it may
>>>>>>>>> not only be a Bioc question, since I found the following links:
>>>>>>>>> http://c-faq.com/expr/seqpoints.html
>>>>>>>>> http://stackoverflow.com/questions/16838884/why-i-got-
>>>>>>>>> operation-may-be-undefined-in-statement-expression-in-c
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> I am not sure if I understand the meaning, but until now I have
>>>>>>>>> never got any warning from any compiler the I have used (including
>>>>>>>>> MS Visual C++).
>>>>>>>>>
>>>>>>>>> Do I really have to replace '++numsels' with 'numsels+1'?
>>>>>>>>>
>>>>>>>>> Best regards,
>>>>>>>>> Christian
>>>>>>>>> _._._._._._._._._._._._._._._._._._
>>>>>>>>> C.h.r.i.s.t.i.a.n   S.t.r.a.t.o.w.a
>>>>>>>>> V.i.e.n.n.a           A.u.s.t.r.i.a
>>>>>>>>> e.m.a.i.l:        cstrato at aon.at
>>>>>>>>> _._._._._._._._._._._._._._._._._._
>>>>>>>>>
>>>>>>>>> ______________________________________________
>>>>>>>>> R-devel at r-project.org mailing list
>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>
>>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>
>>>>
>>> --
>>> Herv? Pag?s
>>>
>>> Program in Computational Biology
>>> Division of Public Health Sciences
>>> Fred Hutchinson Cancer Research Center
>>> 1100 Fairview Ave. N, M1-B514
>>> P.O. Box 19024
>>> Seattle, WA 98109-1024
>>>
>>> E-mail: hpages at fhcrc.org
>>> Phone:  (206) 667-5791
>>> Fax:    (206) 667-1319
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>          [[alternative HTML version deleted]]
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From simon.urbanek at r-project.org  Tue Jun 24 14:58:41 2014
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 24 Jun 2014 14:58:41 +0200
Subject: [Rd] using C code to create data frame but always return as list
In-Reply-To: <1E9AC80C-C494-454F-9821-747152C88BFE@r-enthusiasts.com>
References: <1403593071.58141.YahooMailNeo@web162903.mail.bf1.yahoo.com>
	<1E9AC80C-C494-454F-9821-747152C88BFE@r-enthusiasts.com>
Message-ID: <FE529AF1-3CC6-4F92-A7ED-98C8EC81C784@r-project.org>

On Jun 24, 2014, at 9:21 AM, Romain Francois <romain at r-enthusiasts.com> wrote:

> Hi, 
> 
> Can you give us what str on the returned object gives you? 
> 
> I think you need : 
> 
> SET_OBJECT(and, 1) ; 
> 
> at the end. 
> 

SET_OBJECT should not be used by user code in normal circumstances, it is set by R automatically as part of the handling of the "class" attribute.

Cheers,
S


> Romain
> 
> Le 24 juin 2014 ? 08:57, Yu Gong <armgong at yahoo.com> a ?crit :
> 
>> there is my code,  expect return value  is a data frame but R say it is list:
>> 
>> SEXP Julia_R_MD_NA_DataFrame(jl_value_t* Var)
>> {
>> SEXP ans,names,rownames;
>> char evalcmd[4096];
>> int i;
>> const char* dfname="DataFrameName0tmp";
>> jl_set_global(jl_main_module, jl_symbol(dfname), (jl_value_t*)Var);
>> //Get Frame cols 
>> sprintf(evalcmd,"size(%s,2)",dfname);
>> jl_value_t* cols=jl_eval_string(evalcmd);
>> int collen=jl_unbox_long(cols);
>> jl_value_t* eachcolvector;
>> //Create VECSXP
>> 
>> //Create SEXP for Each Column and assign
>> PROTECT(ans=allocVector(VECSXP,collen));
>> for (i=0;i<collen;i++)
>> {
>>  sprintf(evalcmd,"%s[%d]",dfname,i+1);
>>  eachcolvector=jl_eval_string(evalcmd);
>>  SET_VECTOR_ELT(ans,i,Julia_R_MD_NA(eachcolvector));
>> }
>> //set names attribute
>> sprintf(evalcmd,"names(%s)",dfname);
>> jl_value_t* ret=jl_eval_string(evalcmd);
>> jl_value_t* onesymbol;
>> if (jl_is_array(ret))
>> {
>>  PROTECT(names=allocVector(STRSXP,collen));
>>  for (i=0;i<jl_array_len(ret);i++)
>>  { 
>>   onesymbol=jl_arrayref((jl_array_t*)ret,i);
>>   if (jl_is_symbol(onesymbol))
>>    SET_STRING_ELT(names,i,mkChar(((jl_sym_t*)onesymbol)->name));
>>  }
>>  setAttrib(ans,R_NamesSymbol,names);
>>  UNPROTECT(1);
>> } 
>> //set row names
>> sprintf(evalcmd,"size(%s,1)",dfname);
>> jl_value_t* rows=jl_eval_string(evalcmd);
>> int rowlen=jl_unbox_long(rows);
>> PROTECT(rownames=allocVector(INTSXP,rowlen));
>> for (i=0;i<rowlen;i++)
>>  INTEGER(rownames)[i]=i+1;
>> setAttrib(ans,R_RowNamesSymbol,rownames);
>> UNPROTECT(1);
>> //set class as data frame
>> setAttrib(ans,R_ClassSymbol,mkString("data.frame"));
>> UNPROTECT(1);
>> return ans;
>> }
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From maechler at stat.math.ethz.ch  Tue Jun 24 15:08:09 2014
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 24 Jun 2014 15:08:09 +0200
Subject: [Rd] Unfixed bugs in latest R-patched
In-Reply-To: <20140623152435.GA22211@cs.toronto.edu>
References: <20140623152435.GA22211@cs.toronto.edu>
Message-ID: <21417.30777.209017.331344@stat.math.ethz.ch>

>>>>> Radford Neal <radford at cs.toronto.edu>
>>>>>     on Mon, 23 Jun 2014 11:24:35 -0400 writes:

    > A new version of pqR is now available at pqR-project.org, which fixes
    > several bugs that are also present in the latest R Core patch release
    > (r66002).  A number of bugs found previously during pqR development
    > are also unfixed in the latest R Core release.  Here is the list of
    > these bugs that are unfixed in r66002 (including documentation
    > deficiencies), taken from the pqR bug fix and documentation update
    > sections of the pqR NEWS file (pqR-project.org/NEWS.txt):

Duncan Murdoch has already mentioned that "unfixed bugs" is a
strong wording...

I'm commenting on one subtopic only:

[.........]

    > o Fixed the following bug (also present in R-2.15.0 and R-3.0.2):
      
    > x <- t(5)
    > print (x %*% c(3,4))
    > print (crossprod(5,c(3,4)))

    > The call of crossprod produced an error, whereas the
    > corresponding use of %*% does not.

    > In pqR-2013-12-29, this bug also affected the expression t(5) %*%
    > c(3,4), since it is converted to the equivalent of
    > crossprod(5,c(3,4)).
(I'm not getting this last para... but that may be unimportant)

[........]

    > o Fixed the following bug (also present in R-2.15.0 and R-3.0.2):
      
    > v <- c(1,2)
    > m <- matrix(c(3,4),1,2)
    > print(t(m)%*%v)
    > print(crossprod(m,v))

    > in which crossprod gave an error rather than produce the answer
    > for the corresponding use of %*%.

Both cases above concern  %*%, crossprod() {and also
tcrossprod()}, and always when one at least one operand is a
vector... 

As S and R's terminology has always been mathematically correct and
"knows" that a vector is not a 1-row matrix or 1-column matrix 
(which some people call row-vector and column-vector), R has
indeed much more freedom to be lenient in how to promote vectors
to matrices, and it has always done so tolerantly for some cases
of "%*%", but even there is room for discussion, see below.

Since about January, I have a corresponding entry in the TODO
file of the Matrix package (which I maintain), and I (at least
partly) agree with you, that we should *consider* changing the
current behavior.  The following is from my corresponding R
script :

  ### NOTA BENE:  vector %*% Matrix  _and_  Matrix %*% vector :
  ### ---------   -----------------         -----------------
  ## The k-vector is treated as  (1,k)-matrix *or* (k,1)-matrix
  ## on both sides  whenever it "helps fit" the matrix dimensions:

and one kind of reasoning would go to say that 
crossprod() and tcrossprod()  should do the same.   This would
even make more cases work than (I think) your proposal.

However, one can argue that the current behavior is quite
consistent {there is more than one kind of consistency here; in
this case it's the consistency of underlying C code IIRC}, and
not strictly a bug.
It is something which I am grateful you bring up for discussion,
and I'm happy to settle here.
Note that the Matrix package and many other packages that
implement matrix multiplication methods, should then also follow
the new semantic, and so this is typically rather for R-devel
than R-patched.

Note that from your first case example, one could also argue
-- at least from my 'NOTA BENE' rule above --
that    5 %*% 3:4
should work, since  
       5 %*% rbind(3:4)
does work, but
       5 %*% cbind(3:4)
does not.  So you see, there are quite a few cases one could
discuss, and have reasons pro and contra some of the changes.

I will be too busy till the end of 'useR! 2014' and would want
quite a bit of further thoughts before making a quick decision,
notably about the cases I have in the appended  products.Rout

Martin Maechler,
(ETH Zurich and R Core team)

---------------
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: products.Rout
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140624/25ab3c6d/attachment.pl>

From romain at r-enthusiasts.com  Tue Jun 24 15:14:53 2014
From: romain at r-enthusiasts.com (=?windows-1252?Q?Romain_Fran=E7ois?=)
Date: Tue, 24 Jun 2014 15:14:53 +0200
Subject: [Rd] using C code to create data frame but always return as list
In-Reply-To: <FE529AF1-3CC6-4F92-A7ED-98C8EC81C784@r-project.org>
References: <1403593071.58141.YahooMailNeo@web162903.mail.bf1.yahoo.com>
	<1E9AC80C-C494-454F-9821-747152C88BFE@r-enthusiasts.com>
	<FE529AF1-3CC6-4F92-A7ED-98C8EC81C784@r-project.org>
Message-ID: <F1EDD19D-FE27-4791-BF9C-FECA57052652@r-enthusiasts.com>


Le 24 juin 2014 ? 14:58, Simon Urbanek <simon.urbanek at r-project.org> a ?crit :

> On Jun 24, 2014, at 9:21 AM, Romain Francois <romain at r-enthusiasts.com> wrote:
> 
>> Hi, 
>> 
>> Can you give us what str on the returned object gives you? 
>> 
>> I think you need : 
>> 
>> SET_OBJECT(and, 1) ; 
>> 
>> at the end. 
>> 
> 
> SET_OBJECT should not be used by user code in normal circumstances, it is set by R automatically as part of the handling of the "class" attribute.

Ah ok, thanks. I vaguely recall that I had to use it at some point, perhaps in conjunction with a direct SET_ATTRIB call, but I guess I?m not supposed to use this either. 

Romain

From Antonio.Gasparrini at lshtm.ac.uk  Tue Jun 24 14:45:49 2014
From: Antonio.Gasparrini at lshtm.ac.uk (Antonio Gasparrini)
Date: Tue, 24 Jun 2014 13:45:49 +0100
Subject: [Rd] mismatch warning in documentation
Message-ID: <53A9810D020000B200028E12@smtp-b.lshtm.ac.uk>

Hi all,
 
I received a request from the R maintainers (kurt Hornik) to fix some problems arising in r-devel with my package mvmeta.
Basically, the check returns a series of warnings about a mismatch in the documentation of some data sets between the code and the docs. See the results at:
http://cran.r-project.org/web/checks/check_results_mvmeta.html 
 
The problem might be that I grouped the variables in lists separated by commas, as many of them are simply variances or covariances of the same matrix.
A fix could be to create individual entries, but this would extend the documentation substantially and would create a less readable help pages.
 
Does anyone have a solution?
Please let me know.
 
Best
-Antonio Gasparrini

________________________________________
Antonio Gasparrini, PhD
Lecturer in Biostatistics and Epidemiology
London School of Hygiene & Tropical Medicine
Keppel Street, London WC1E 7HT, UK
Office: 0044 (0)20 79272406
Mobile: 0044 (0)79 64925523
Skype contact: a.gasparrini
http://www.ag-myresearch.com


From murdoch.duncan at gmail.com  Tue Jun 24 15:34:44 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 24 Jun 2014 15:34:44 +0200
Subject: [Rd] Unfixed bugs in latest R-patched
In-Reply-To: <20140624114005.GA10010@cs.toronto.edu>
References: <20140623152435.GA22211@cs.toronto.edu>
	<53A926BE.4030205@gmail.com>
	<20140624114005.GA10010@cs.toronto.edu>
Message-ID: <53A97E74.1050107@gmail.com>

On 24/06/2014, 1:40 PM, Radford Neal wrote:
> On Tue, Jun 24, 2014 at 09:20:30AM +0200, Duncan Murdoch wrote:
>> It's hardly fair to call these "unfixed bugs".  Most of them are better
>> described as "unreported bugs", or, after this posting, "bugs reported
>> with insufficient detail".  We can't fix them if we don't know what they
>> are, and it's not easy to determine that for most of the items below.
> 
> I think most of them are pretty clear.  For the ones referring to lack
> of protection or argument error checking code, I suggesting doing a
> "diff" on the source files to find where I made changes.
> 
> If your complaint is that your time is more valuable than my time, so
> I should be producing a nice patch for you, then I don't agree.  I went 
> to the effort of verifing that the bugs are still present in r66002.  
> That's as much as I'm willing to do.  It's up to you what you do.

No, I don't think it's reasonable to expect you to write a patch, but
reporting the bugs in the R bug reporting system isn't that hard to do,
and does lead to fixes pretty rapidly in cases where the report contains
sample code to reproduce the problem.

I don't know if pqR has a similar bug reporting system, but if it does,
a reference to a report there would also be fine.  But something like
"Fixed a problem in R_AllocStringBuffer that could result in a crash due
to an invalid memory access" sounds serious, but is just too vague to
follow up.  I would expect that doing a diff on the source files is
going to find all sorts of stuff:  pqR isn't just R with bugs fixed, it
has a lot of other changes too.

I can understand that from your point of view saying "R has bugs that
have been fixed in pqR" is a form of advertising, but it would be more
helpful to the community if the bugs actually got fixed.  I think all of
the bugs that you reported last June got fixed within a couple of weeks
(though not all of the speedups were incorporated).  Why not report them
more frequently than annually, and give the details you already have so
they are easier to fix?

Duncan Murdoch


> 
>    Radford Neal
> 
> 
>> On 23/06/2014, 5:24 PM, Radford Neal wrote:
>>> A new version of pqR is now available at pqR-project.org, which fixes
>>> several bugs that are also present in the latest R Core patch release
>>> (r66002).  A number of bugs found previously during pqR development
>>> are also unfixed in the latest R Core release.  Here is the list of
>>> these bugs that are unfixed in r66002 (including documentation
>>> deficiencies), taken from the pqR bug fix and documentation update
>>> sections of the pqR NEWS file (pqR-project.org/NEWS.txt):
>>>
>>>     o The documentation for c now says how the names for the result are
>>>       determined, including previously missing information on the
>>>       use.names argument, and on the role of the names of arguments in
>>>       the call of c.  This documentation is missing in R-2.15.0 and
>>>       R-3.1.0.
>>>
>>>     o The documentaton for diag now documents that a diagonal matrix is
>>>       always created with type double or complex, and that the names of
>>>       an extracted diagonal vector are taken from a names attribute (if
>>>       present), if not from the row and column names.  This information
>>>       is absent in the documentation in R-2.15.1 and R-3.1.0.
>>>
>>>     o Incorrect information regarding the pointer protection stack was
>>>       removed from help(Memory).  This incorrect information is present
>>>       in R-2.15.0 and R-3.1.0 as well.
>>>
>>>     o There is now information in help(Arithmetic) regarding what
>>>       happens when the operands of an arithmetic operation are NA or
>>>       NaN, including the arbitrary nature of the result when one
>>>       operand is NA and the other is NaN.  There is no discussion of
>>>       this issue in the documentation for R-2.15.0 and R-3.1.0.
>>>
>>>     o Fixed lack of protection bugs in the equal and greater functions
>>>       in sort.c.  These bugs are also present in R-2.15.0 and R-3.1.0.
>>>
>>>     o Fixed lack of protection bugs in the D function in deriv.c.
>>>       These bugs are also present in R-2.15.0 and R-3.1.0.
>>>
>>>     o Fixed argument error-checking bugs in getGraphicsEventEnv and
>>>       setGraphicsEventEnv (also present in R-2.15.0 and R-3.1.0).
>>>
>>>     o Fixed the following bug (also present in R-2.15.0 and R-3.0.2):
>>>       
>>>           x <- t(5)
>>>           print (x %*% c(3,4))
>>>           print (crossprod(5,c(3,4)))
>>>
>>>       The call of crossprod produced an error, whereas the
>>>       corresponding use of %*% does not.
>>>
>>>       In pqR-2013-12-29, this bug also affected the expression t(5) %*%
>>>       c(3,4), since it is converted to the equivalent of
>>>       crossprod(5,c(3,4)).
>>>
>>>     o Fixed a problem in R_AllocStringBuffer that could result in a
>>>       crash due to an invalid memory access.  (This bug is also present
>>>       in R-2.15.0 and R-3.0.2.)
>>>
>>>     o The documentation for aperm now says that the default method does
>>>       not copy attributes (other than dimensions and dimnames).
>>>       Previously, it incorrecty said it did (as is the case also in
>>>       R-2.15.0 and R-3.0.2).
>>>
>>>     o Fixed the following bug (also present in R-2.15.0 and R-3.0.2):
>>>       
>>>          v <- c(1,2)
>>>          m <- matrix(c(3,4),1,2)
>>>          print(t(m)%*%v)
>>>          print(crossprod(m,v))
>>>
>>>       in which crossprod gave an error rather than produce the answer
>>>       for the corresponding use of %*%.
>>>
>>>     o Raising -Inf to a large value (eg, (-Inf)^(1e16)) no longer
>>>       produces an incomprehensible warning.  As before, the value
>>>       returned is Inf, because (due to their limited-precision
>>>       floating-point representation) all such large numbers are even
>>>       integers.
>>>
>>>     o Fixed a bug (also present in R-2.15.0 and R-3.0.1) illustrated by
>>>       the following code:
>>>       
>>>          > a <- list(x=c(1,2),y=c(3,4))
>>>          > b <- as.pairlist(a)
>>>          > b$x[1] <- 9
>>>          > print(a)
>>>          $x
>>>          [1] 9 2
>>>          
>>>          $y
>>>          [1] 3 4
>>>
>>>       The value printed for a has a$x[1] changed to 9, when it should
>>>       still be 1. See pqR issue #14.
>>>
>>>     o Fixed several bugs (also present in R-2.15.0 and R-3.0.1)
>>>       illustrated by the code below (see pqR issue #16):
>>>       
>>>          v <- c(10,20,30)
>>>          v[[2]] <- NULL        # wrong error message
>>>          
>>>          x <- pairlist(list(1,2))
>>>          x[[c(1,2)]] <- NULL   # wrongly gives an error, referring to misuse
>>>                                # of the internal SET_VECTOR_ELT procedure
>>>          
>>>          v<-list(1)
>>>          v[[quote(abc)]] <- 2  # internal error, this time for SET_STRING_ELT
>>>          
>>>          a <- pairlist(10,20,30,40,50,60)
>>>          dim(a) <- c(2,3)
>>>          dimnames(a) <- list(c("a","b"),c("x","y","z"))
>>>          print(a)              # doesn't print names
>>>          
>>>          a[["a","x"]] <- 0     # crashes with a segmentation fault
>>>
>>>     o Fixed a bug where, for example, log(base=4) returned the natural
>>>       log of 4, rather than signalling an error.
>>>
>>>     o The documentation on what MARGIN arguments are allowed for apply
>>>       has been clarified, and checks for validity added.  The call
>>>       
>>>          > apply(array(1:24,c(2,3,4)),-3,sum)
>>>
>>>       now produces correct results (the same as when MARGIN is 1:2).
>>>
>>>     o Fixed a bug in which Im(matrix(complex(0),3,4)) returned a matrix
>>>       of zero elements rather than a matrix of NA elements.
>>>
>>>     o Now check for bad arguments for .rowSums, .colSums, .rowMeans,
>>>       and .rowMeans (would previously segfault if n*p too big).
>>>
>>>     o Fixed a bug where excess warning messages may be produced on
>>>       conversion to RAW.  For instance:
>>>       
>>>          > as.raw(1e40)
>>>          [1] 00
>>>          Warning messages:
>>>          1: NAs introduced by coercion 
>>>          2: out-of-range values treated as 0 in coercion to raw 
>>>
>>>       Now, only the second warning message is produced.
>>>
>>>     o A bug has been fixed in which rbind would not handle non-vector
>>>       objects such as function closures, whereas cbind did handle them,
>>>       and both were documented to do so.
>>>
>>> Regards,
>>>
>>>    Radford Neal
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>


From macrakis at alum.mit.edu  Tue Jun 24 18:15:21 2014
From: macrakis at alum.mit.edu (=?UTF-8?B?U3RhdnJvcyBNYWNyYWtpcyAozqPPhM6x4b+mz4HOv8+CIM6czrHOus+BzqzOus63z4Ip?=)
Date: Tue, 24 Jun 2014 12:15:21 -0400
Subject: [Rd] Curious behavior of $ and lapply
In-Reply-To: <CAJXgQP3FZEqsaXOOh+o9JOKj8fvuQygO2=k56ApO_Ey3ykteOg@mail.gmail.com>
References: <CACLVabXgnoWajqk30r9+ufC1fk_C9xQWc7fc1JQKxh5tuYvOWg@mail.gmail.com>
	<CAJXgQP3FZEqsaXOOh+o9JOKj8fvuQygO2=k56ApO_Ey3ykteOg@mail.gmail.com>
Message-ID: <CACLVabVLObr8r_4-ajY_aZm+1EkJfyQJ8R0eF+d=WP45kyNE+g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140624/eae0f341/attachment.pl>

From radford at cs.toronto.edu  Tue Jun 24 22:26:35 2014
From: radford at cs.toronto.edu (Radford Neal)
Date: Tue, 24 Jun 2014 16:26:35 -0400
Subject: [Rd] Unfixed bugs in latest R-patched
In-Reply-To: <53A97E74.1050107@gmail.com>
References: <20140623152435.GA22211@cs.toronto.edu>
	<53A926BE.4030205@gmail.com>
	<20140624114005.GA10010@cs.toronto.edu>
	<53A97E74.1050107@gmail.com>
Message-ID: <20140624202635.GA6619@cs.toronto.edu>

> Duncan Murdoch:
>
> No, I don't think it's reasonable to expect you to write a patch, but
> reporting the bugs in the R bug reporting system isn't that hard to do,
> and does lead to fixes pretty rapidly in cases where the report contains
> sample code to reproduce the problem.

Sometimes.  Sometimes not.  For instance, PR #14985, a significant set
of bugs, with an easy fix (patch provided), which took almost two
years to make it to an R Core release - perhaps because you were more
interested in trying to argue that they weren't really bugs at all...

> "Fixed a problem in R_AllocStringBuffer that could result in a crash due
> to an invalid memory access" sounds serious, but is just too vague to
> follow up.  I would expect that doing a diff on the source files is
> going to find all sorts of stuff:  pqR isn't just R with bugs fixed, it
> has a lot of other changes too.

You might expect that if it was really that difficult, I would have
given more detail.  I think if you actually looked at this procedure,
which is about 30 lines long, you might, seeing as you've been warned 
that it has a bug, find the problem in about 30 seconds, even without
looking at the pqR source code, which of course isn't difficult to do.

> it would be more
> helpful to the community if the bugs actually got fixed.  

Indeed.

> I think all of
> the bugs that you reported last June got fixed within a couple of weeks

Actually, the last six in the list I just posted are from the original
pqR release last June.  Some of the six don't seem too crucial, but
two of them seem reasonably serious (one leads to R crashing).

> Why not report them
> more frequently than annually, and give the details you already have so
> they are easier to fix?

I did report at least one bug not long ago (which got fixed), after
seeing (as now) that an R Core release was imminent, and therefore
thinking it would be best if a fix was put in before it went out.

You're of course welcome to look at the NEWS file at pqR-project.org
whenever you like.

   Radford Neal


From radford at cs.toronto.edu  Tue Jun 24 22:40:30 2014
From: radford at cs.toronto.edu (Radford Neal)
Date: Tue, 24 Jun 2014 16:40:30 -0400
Subject: [Rd] Unfixed bugs in latest R-patched
In-Reply-To: <21417.30777.209017.331344@stat.math.ethz.ch>
References: <20140623152435.GA22211@cs.toronto.edu>
	<21417.30777.209017.331344@stat.math.ethz.ch>
Message-ID: <20140624204030.GA9705@cs.toronto.edu>

>     > o Fixed the following bug (also present in R-2.15.0 and R-3.0.2):
>       
>     > x <- t(5)
>     > print (x %*% c(3,4))
>     > print (crossprod(5,c(3,4)))
> 
>     > The call of crossprod produced an error, whereas the
>     > corresponding use of %*% does not.
> 
>     > o Fixed the following bug (also present in R-2.15.0 and R-3.0.2):
>       
>     > v <- c(1,2)
>     > m <- matrix(c(3,4),1,2)
>     > print(t(m)%*%v)
>     > print(crossprod(m,v))
> 
>     > in which crossprod gave an error rather than produce the answer
>     > for the corresponding use of %*%.

> As S and R's terminology has always been mathematically correct and
> "knows" that a vector is not a 1-row matrix or 1-column matrix 
> (which some people call row-vector and column-vector), R has
> indeed much more freedom to be lenient in how to promote vectors
> to matrices, and it has always done so tolerantly for some cases
> of "%*%", but even there is room for discussion, see below.

> However, one can argue that the current behavior is quite
> consistent {there is more than one kind of consistency here; in
> this case it's the consistency of underlying C code IIRC}, and
> not strictly a bug.

If you look at help(crossprod), you'll see that it says that
crossprod(x,y) is equivalent to t(x) %*% y.  But it's not, since
the latter works in some cases where the former gives an error.
So it's a bug.

Furthermore, crossprod(x,y) ought to be equivalent to t(x) %*% y,
even in cases where a vector needs to get promoted to a matrix,
because such cases can arise from inadvertant dropping of dimensions
when subscriptiong a matrix (eg, with 1:n, with n happening to be 1).
Sometimes, this problem gets fixed by the transpose.  

   Radford Neal


From hpages at fhcrc.org  Wed Jun 25 00:38:07 2014
From: hpages at fhcrc.org (=?UTF-8?B?SGVydsOpIFBhZ8Oocw==?=)
Date: Tue, 24 Jun 2014 15:38:07 -0700
Subject: [Rd]
 =?utf-8?q?operation_on_=E2=80=98numsels=E2=80=99_may_be_unde?=
 =?utf-8?q?fined?=
In-Reply-To: <CAJXgQP0racSjePV_Aoexkcr6DGCyQ_VZv7GF+SuJfGm_da6rYA@mail.gmail.com>
References: <53A8298C.9010605@aon.at>	<244EC819-4336-4A49-BAEB-86B57E8A2970@r-enthusiasts.com>	<53A855C6.1000301@aon.at>	<BE6B83B4-2A60-4F84-8B5F-C0754997E5C5@r-enthusiasts.com>	<53A877EE.1080201@aon.at>	<53A8A79A.9070301@fhcrc.org>	<53A8AD3F.2030901@fhcrc.org>	<CAC2h7utL_vzyRCSOHB9xi+nqmkm3aqWwNBbiitvpsu4jevqr6g@mail.gmail.com>
	<CAJXgQP0racSjePV_Aoexkcr6DGCyQ_VZv7GF+SuJfGm_da6rYA@mail.gmail.com>
Message-ID: <53A9FDCF.2030501@fhcrc.org>

Hi Kevin,

On 06/23/2014 10:28 PM, Kevin Ushey wrote:
> I don't see what's so surprising here.
>
> That statement is identical to writing:
>
>      if (arrMask[i] == 1) {
>          numsels = ++numsels;
>      } else {
>          numsels = numsels;
>      }
>
> and
>
>      numsels = ++numsels;
>
> has two statements modifying the value of numsels (= and prefix-++) in
> a single sequence point. (Do we increment then assign, or assign then
> increment? The C / C++ standards leave this undefined.)
>
> Imagine writing the operations out as functions: we have the `=`
> function, and the `prefix-++` function -- both of these 'mo dify' (one
> of) their arguments. Do we evaluate it as `=`(a, `prefix-++`(a)) or
> `prefix-++`(`=`(a, a))?

As the former? Isn't it that `prefix-++` has precedence over `=`? Also
according to the standard, `prefix-++` must perform the increment
*before* returning the incremented value. So I'm still a little bit
confused about this warning. Although I would understand it if
`suffix-++` was used instead of `prefix-++`:

     numsels = numsels++;

In that case the incrementation happens *after* the right value
of the assignment is evaluated but it's undefined whether it will
happen before or after the assignment itself (on my machine it
happens after).

> The C standard leaves this undefined, so
> compilers are free to do what they wish (and the nice ones warn you
> when there is such an ambiguity). I guess the net result of the
> operation is the same in each case _here_, but this is of course not
> the case for other functions that modify the value of their
> operand(s). And, in truth, this is _undefined behaviour_ and so the
> compiler could still rightly make demons fly out of your nose if it
> wanted to upon program execution.
>
> I highly recommend reading the slides at
> http://www.slideshare.net/olvemaudal/deep-c, especially the bit on
> sequence points.

Nice slides. Pretty entertaining! The numsels = numsels++ case is
actually discussed at slide 142. Thanks for the link!

H.

>
> Cheers,
> Kevin
>
> On Mon, Jun 23, 2014 at 9:22 PM, Kasper Daniel Hansen
> <kasperdanielhansen at gmail.com> wrote:
>> I am not an expert on this, but I note that the section on -Wsequence-point
>> at
>>    http://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html
>> specifically mentions ? and :.  Perhaps some more work on tracking down
>> their definitions and precedence might lead to insights.
>>
>> Best,
>> Kasper
>>
>>
>> On Mon, Jun 23, 2014 at 6:42 PM, Herv? Pag?s <hpages at fhcrc.org> wrote:
>>
>>> On 06/23/2014 03:18 PM, Herv? Pag?s wrote:
>>>
>>>> Hi Christian,
>>>>
>>>> On 06/23/2014 11:54 AM, cstrato wrote:
>>>>
>>>>> Dear Romain,
>>>>>
>>>>> I do not know enough about compilers, but as far as I remember, they
>>>>> 'work' from right to left,
>>>>>
>>>>
>>>> Not necessarily. So you should not rely on that. This is what the
>>>> (somewhat obscure) warning you see on zin1 is trying to tell you.
>>>>
>>>
>>> Actually, I don't see an ambiguity in your code:
>>>
>>>
>>>    numsels = (arrMask[i] == 1) ? ++numsels : numsels;
>>>
>>> Yes it's confusing and unnecessarily complicated but I don't see that
>>> it relies on some undefined behavior. It's not like in the thread on
>>> Bioc-devel where the expression was:
>>>
>>>    *p++ = tolower(*p);
>>>
>>> In that case the left-value of the assignment is itself an expression
>>> that needs to be evaluated and the outcome of the assignment depends
>>> on whether the left-value is evaluated before the right expression or
>>> not. But in your case the left-value is a variable name so there is
>>> nothing to evaluate.
>>>
>>> So I don't know. Looks like a false positive from the gcc compiler to
>>> me. Someone on the list might have a better insight.
>>>
>>> Cheers,
>>>
>>> H.
>>>
>>>
>>>   Personally I would just do:
>>>>
>>>>       if (arrMask[i] == 1) numsels++;
>>>>
>>>> which is the standard way to implement the "if (some condition)
>>>> then increment counter" idiom.
>>>>
>>>> As Kasper mentioned, a similar issue was recently discussed here:
>>>>
>>>>     https://stat.ethz.ch/pipermail/bioc-devel/2014-June/005858.html
>>>>
>>>> Cheers,
>>>> H.
>>>>
>>>>
>>>>   so numsels = ++numsels should not confuse the
>>>>> compiler. Anyhow I will change my code to your first suggestion since it
>>>>> is more elegant.
>>>>>
>>>>> Best regards,
>>>>> Christian
>>>>>
>>>>>
>>>>> On 6/23/14 7:13 PM, Romain Fran?ois wrote:
>>>>>
>>>>>>
>>>>>> Le 23 juin 2014 ? 18:28, cstrato <cstrato at aon.at> a ?crit :
>>>>>>
>>>>>>   Dear Romain,
>>>>>>>
>>>>>>> Thank you for your suggestions, I like especially the first one.
>>>>>>>
>>>>>>> However, you did not explain why I have never got this warning
>>>>>>> message on any compiler, and why only one of the two identical Ubuntu
>>>>>>> compilers did give this warning message?
>>>>>>>
>>>>>>> Best regards,
>>>>>>> Christian
>>>>>>>
>>>>>>
>>>>>> I don?t know, but this:
>>>>>>
>>>>>> numsels = ++numsels ;
>>>>>>
>>>>>> seems fishy to me, and so it keeps feeling weird with the addition of
>>>>>> the ternary operator.
>>>>>>
>>>>>> There is obviously a difference of setup between these two machines,
>>>>>> but I don?t have time to sherlock that for you. One of the compilers
>>>>>> is getting more careful than the other. Getting warnings you did not
>>>>>> get before is a good thing, as it helps you update the code with that
>>>>>> new insight.
>>>>>>
>>>>>> Welcome to my world, I?m sometimes thrown all kinds of new warnings
>>>>>> from esoteric compilers, all of them have value .
>>>>>>
>>>>>> Romain
>>>>>>
>>>>>>   On 6/23/14 3:45 PM, Romain Fran?ois wrote:
>>>>>>>
>>>>>>>>
>>>>>>>> Le 23 juin 2014 ? 15:20, cstrato <cstrato at aon.at> a ?crit :
>>>>>>>>
>>>>>>>>   Dear all,
>>>>>>>>>
>>>>>>>>> Since many years the following C++ code does compile on ALL
>>>>>>>>> Bioconductor servers (Linux, Windows, Mac) without any warnings:
>>>>>>>>>
>>>>>>>>>     Int_t numsels = 0;  //number of selected entries
>>>>>>>>>     ...
>>>>>>>>>     for (Int_t i=0; i<size; i++) {
>>>>>>>>>        numsels = (arrMask[i] == 1) ? ++numsels : numsels;
>>>>>>>>>     }//for_i
>>>>>>>>>
>>>>>>>>
>>>>>>>> This is confusing. I would write the loop body like this:
>>>>>>>>
>>>>>>>> numsels += (arrMask[i] == 1) ;
>>>>>>>>
>>>>>>>>
>>>>>>>> or preferably using the STL:
>>>>>>>>
>>>>>>>> Int_t numsels = std::count( begin(arrMask), end(arrMask), 1 ) ;
>>>>>>>>
>>>>>>>> or some other variation of this, i.e. perhaps you don?t have a C++11
>>>>>>>> compiler, so perhaps one of these depending on what is arrMask:
>>>>>>>>
>>>>>>>> Int_t numsels = std::count( arrMask.begin(), arrMask.end(), 1 ) ;
>>>>>>>> Int_t numsels = std::count( arrMask, arrMask + size, 1 ) ;
>>>>>>>>
>>>>>>>> Romain
>>>>>>>>
>>>>>>>>   Even on the recently added release server 'zin2' Linux (Ubuntu
>>>>>>>>> 12.04.4 LTS) the above code compiles w/o warnings.
>>>>>>>>>
>>>>>>>>> However, on the new development server 'zin1' Linux (Ubuntu 12.04.4
>>>>>>>>> LTS) I get suddenly the following warning message:
>>>>>>>>>
>>>>>>>>> Found the following significant warnings:
>>>>>>>>>    XPSPreProcessing.cxx:3026:56: warning: operation on ?numsels? may
>>>>>>>>> be undefined [-Wsequence-point]
>>>>>>>>>
>>>>>>>>> Interestingly, both servers do not only run the same version of
>>>>>>>>> Ubuntu, but also the same version of the C++ compiler, i.e. g++
>>>>>>>>> (Ubuntu/Linaro 4.6.3-1ubuntu5) 4.6.3, and use the same flags, see:
>>>>>>>>> http://bioconductor.org/checkResults/2.14/bioc-LATEST/
>>>>>>>>> zin2-NodeInfo.html
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> http://bioconductor.org/checkResults/devel/bioc-
>>>>>>>>> LATEST/zin1-NodeInfo.html
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> My question is now, why do I suddenly get the compiler warning?
>>>>>>>>>
>>>>>>>>> The reason why I ask at R-devel and not Bioc-devel is that it may
>>>>>>>>> not only be a Bioc question, since I found the following links:
>>>>>>>>> http://c-faq.com/expr/seqpoints.html
>>>>>>>>> http://stackoverflow.com/questions/16838884/why-i-got-
>>>>>>>>> operation-may-be-undefined-in-statement-expression-in-c
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> I am not sure if I understand the meaning, but until now I have
>>>>>>>>> never got any warning from any compiler the I have used (including
>>>>>>>>> MS Visual C++).
>>>>>>>>>
>>>>>>>>> Do I really have to replace '++numsels' with 'numsels+1'?
>>>>>>>>>
>>>>>>>>> Best regards,
>>>>>>>>> Christian
>>>>>>>>> _._._._._._._._._._._._._._._._._._
>>>>>>>>> C.h.r.i.s.t.i.a.n   S.t.r.a.t.o.w.a
>>>>>>>>> V.i.e.n.n.a           A.u.s.t.r.i.a
>>>>>>>>> e.m.a.i.l:        cstrato at aon.at
>>>>>>>>> _._._._._._._._._._._._._._._._._._
>>>>>>>>>
>>>>>>>>> ______________________________________________
>>>>>>>>> R-devel at r-project.org mailing list
>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>
>>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>
>>>>
>>> --
>>> Herv? Pag?s
>>>
>>> Program in Computational Biology
>>> Division of Public Health Sciences
>>> Fred Hutchinson Cancer Research Center
>>> 1100 Fairview Ave. N, M1-B514
>>> P.O. Box 19024
>>> Seattle, WA 98109-1024
>>>
>>> E-mail: hpages at fhcrc.org
>>> Phone:  (206) 667-5791
>>> Fax:    (206) 667-1319
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>          [[alternative HTML version deleted]]
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From hb at biostat.ucsf.edu  Wed Jun 25 01:18:26 2014
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Tue, 24 Jun 2014 16:18:26 -0700
Subject: [Rd] debug()/trace() to standard error?
Message-ID: <CAFDcVCTrRNZijoC2+5dBXudn+C=2OJUuP-X_eAqTnx7Kf4yswg@mail.gmail.com>

Does anyone know of a simple/neat way to make debug() and/or trace()
send output to the standard error stream (not standard output)?

Thanks,

Henrik


From murdoch.duncan at gmail.com  Wed Jun 25 04:07:17 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 25 Jun 2014 04:07:17 +0200
Subject: [Rd] Unfixed bugs in latest R-patched
In-Reply-To: <20140624202635.GA6619@cs.toronto.edu>
References: <20140623152435.GA22211@cs.toronto.edu>
	<53A926BE.4030205@gmail.com>
	<20140624114005.GA10010@cs.toronto.edu>
	<53A97E74.1050107@gmail.com> <20140624202635.GA6619@cs.toronto.edu>
Message-ID: <53AA2ED5.1070108@gmail.com>

On 24/06/2014, 10:26 PM, Radford Neal wrote:
>> Duncan Murdoch:
>>
>> No, I don't think it's reasonable to expect you to write a patch, but
>> reporting the bugs in the R bug reporting system isn't that hard to do,
>> and does lead to fixes pretty rapidly in cases where the report contains
>> sample code to reproduce the problem.
> 
> Sometimes.  Sometimes not.  For instance, PR #14985, a significant set
> of bugs, with an easy fix (patch provided), which took almost two
> years to make it to an R Core release - perhaps because you were more
> interested in trying to argue that they weren't really bugs at all...

I've just re-read that thread (and I'd invite anyone else to do so, it's
at https://bugs.r-project.org/bugzilla/show_bug.cgi?id=14985), and I
don't think that's a completely fair characterization of it.  That was a
case where problems did sit around for about a year before being dealt
with, but since it was a change to the interface that could affect third
party front-ends, I didn't put it into R-patched right away, which means
it waited most of another year before making it into a release.

> 
>> "Fixed a problem in R_AllocStringBuffer that could result in a crash due
>> to an invalid memory access" sounds serious, but is just too vague to
>> follow up.  I would expect that doing a diff on the source files is
>> going to find all sorts of stuff:  pqR isn't just R with bugs fixed, it
>> has a lot of other changes too.
> 
> You might expect that if it was really that difficult, I would have
> given more detail.  I think if you actually looked at this procedure,
> which is about 30 lines long, you might, seeing as you've been warned 
> that it has a bug, find the problem in about 30 seconds, even without
> looking at the pqR source code, which of course isn't difficult to do.

I think it's fixed now.

> 
>> it would be more
>> helpful to the community if the bugs actually got fixed.  
> 
> Indeed.
> 
>> I think all of
>> the bugs that you reported last June got fixed within a couple of weeks
> 
> Actually, the last six in the list I just posted are from the original
> pqR release last June.  Some of the six don't seem too crucial, but
> two of them seem reasonably serious (one leads to R crashing).

I imagine the reason they weren't dealt with was because we mistakenly
thought they had been.

Duncan Murdoch

> 
>> Why not report them
>> more frequently than annually, and give the details you already have so
>> they are easier to fix?
> 
> I did report at least one bug not long ago (which got fixed), after
> seeing (as now) that an R Core release was imminent, and therefore
> thinking it would be best if a fix was put in before it went out.
> 
> You're of course welcome to look at the NEWS file at pqR-project.org
> whenever you like.
> 
>    Radford Neal
>


From kevinushey at gmail.com  Wed Jun 25 08:41:17 2014
From: kevinushey at gmail.com (Kevin Ushey)
Date: Tue, 24 Jun 2014 23:41:17 -0700
Subject: [Rd]
	=?utf-8?q?operation_on_=E2=80=98numsels=E2=80=99_may_be_unde?=
	=?utf-8?q?fined?=
In-Reply-To: <53A9FDCF.2030501@fhcrc.org>
References: <53A8298C.9010605@aon.at>
	<244EC819-4336-4A49-BAEB-86B57E8A2970@r-enthusiasts.com>
	<53A855C6.1000301@aon.at>
	<BE6B83B4-2A60-4F84-8B5F-C0754997E5C5@r-enthusiasts.com>
	<53A877EE.1080201@aon.at> <53A8A79A.9070301@fhcrc.org>
	<53A8AD3F.2030901@fhcrc.org>
	<CAC2h7utL_vzyRCSOHB9xi+nqmkm3aqWwNBbiitvpsu4jevqr6g@mail.gmail.com>
	<CAJXgQP0racSjePV_Aoexkcr6DGCyQ_VZv7GF+SuJfGm_da6rYA@mail.gmail.com>
	<53A9FDCF.2030501@fhcrc.org>
Message-ID: <CAJXgQP0d7tz=sErZgTiJ5A7VrCBX_GvcVrZqcu7oYdfCK1DKkQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140624/c286837f/attachment.pl>

From sannandi at umail.iu.edu  Wed Jun 25 23:31:39 2014
From: sannandi at umail.iu.edu (Sandip Nandi)
Date: Wed, 25 Jun 2014 14:31:39 -0700
Subject: [Rd] Need help on calling Head from C
Message-ID: <CAGSjAUC2q3s19Bx4Vs7TJuw2y8aF9Xwn0MBwfbV0wn17TPfZoA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140625/4d4a199a/attachment.pl>

From simon.urbanek at r-project.org  Thu Jun 26 09:50:54 2014
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 26 Jun 2014 09:50:54 +0200
Subject: [Rd] Need help on calling Head from C
In-Reply-To: <CAGSjAUC2q3s19Bx4Vs7TJuw2y8aF9Xwn0MBwfbV0wn17TPfZoA@mail.gmail.com>
References: <CAGSjAUC2q3s19Bx4Vs7TJuw2y8aF9Xwn0MBwfbV0wn17TPfZoA@mail.gmail.com>
Message-ID: <B20A88CC-F4B3-4DE5-9109-C95C30469AB9@r-project.org>

On Jun 25, 2014, at 11:31 PM, Sandip Nandi <sannandi at umail.iu.edu> wrote:

> Hi ,
> 
> I am trying to call head function from C . My doubt is with the parameter
> n,how to pass it .
> 
> PROTECT(dfm=lang3(install("data.frame"),df,ScalarLogical(FALSE)));
> SET_TAG(CDDR(dfm), install("stringsAsFactors")) ;
> SEXP res = PROTECT(eval(dfm,R_GlobalEnv));
> PROTECT(head=lang3(install("head"),res,ScalarInteger(1)));
> head  = PROTECT(eval(head,R_GlobalEnv));
> 
> 
> I tried the above following , it seemed to be not working . Can you please
> help.
> 

Can you elaborate? The above code works AFAICT ...

Cheers,
S



> Thanks
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From Jens.Preussner at mpi-bn.mpg.de  Thu Jun 26 08:46:32 2014
From: Jens.Preussner at mpi-bn.mpg.de (Preussner, Jens)
Date: Thu, 26 Jun 2014 06:46:32 +0000
Subject: [Rd] Compiling R-3.1.0 on debian with libpng/libjpeg
Message-ID: <2DB14965CF615445B453E3930C87350D556A827E@KI-S0113.kerckhoff.mpg.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140626/78224313/attachment.pl>

From ripley at stats.ox.ac.uk  Thu Jun 26 13:10:30 2014
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 26 Jun 2014 12:10:30 +0100
Subject: [Rd] Compiling R-3.1.0 on debian with libpng/libjpeg
In-Reply-To: <2DB14965CF615445B453E3930C87350D556A827E@KI-S0113.kerckhoff.mpg.de>
References: <2DB14965CF615445B453E3930C87350D556A827E@KI-S0113.kerckhoff.mpg.de>
Message-ID: <53ABFFA6.3020806@stats.ox.ac.uk>

On 26/06/2014 07:46, Preussner, Jens wrote:
> Dear r-developers,
>
> I currently face an issue while compiling R from source on a debian wheezy. When running the configure script (particularly with --enable-R-shlib --prefix=/packages/R/3.1.0/) I get a Makefile and the output
> ...
>    Interfaces supported:      X11
>    External libraries:        readline
>    Additional capabilities:   PNG, JPEG, NLS
>    Options enabled:           shared R library, shared BLAS, R profiling
> ...
>
> After compiling and checking the capabilities, R tells me the following:
>> capabilities()
>      jpeg      png     tiff    tcltk      X11     aqua http/ftp  sockets
>     FALSE    FALSE    FALSE    FALSE    FALSE    FALSE     TRUE     TRUE
>    libxml     fifo   cledit    iconv      NLS  profmem    cairo
>      TRUE     TRUE     TRUE     TRUE     TRUE    FALSE    FALSE
>
> I already have R on another machine with jpeg/png capabilities, also compiled on my own. I crosschecked the versions of the libpng-* and libjpeg-* packages installed there and could not find any difference. Also returning to R-3.0.2 doesn't work.
> A last thing: The same question came up back in 2009, but there was no answer on the list.. https://stat.ethz.ch/pipermail/r-help/2009-December/222967.html
>
> Any suggestions how to get more information on what is going on here?

As you do not have capabilities for cairo nor X11, read ?png, e.g.

     type: character string, one of ?"Xlib"? or ?"quartz"? (some OS X
           builds) or ?"cairo"?.  The latter will only be available if
           the system was compiled with support for cairo - otherwise
           ?"Xlib"? will be used.  The default is set by
           ?getOption("bitmapType")? - the ?out of the box? default is
           ?"quartz"? or ?"cairo"? where available, otherwise ?"Xlib"?.

      R can be compiled without support for some or all of the types for
      each of these devices: this will be reported if you attempt to use
      them on a system where they are not supported.  For ?type =
      "Xlib"? they may not be usable unless the X11 display is available
      to the owner of the R process.

So, the only type available to you appears to be "Xlib", and that 
process does not have access to an X server.

The strongly recommended solution is to get cairographics working: see
http://cran.r-project.org/doc/manuals/r-patched/R-admin.html#Useful-libraries-and-programs

> Many thanks and best regards,
>
> Jens
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sannandi at umail.iu.edu  Thu Jun 26 18:10:37 2014
From: sannandi at umail.iu.edu (Sandip Nandi)
Date: Thu, 26 Jun 2014 09:10:37 -0700
Subject: [Rd] Need help on calling Head from C
In-Reply-To: <B20A88CC-F4B3-4DE5-9109-C95C30469AB9@r-project.org>
References: <CAGSjAUC2q3s19Bx4Vs7TJuw2y8aF9Xwn0MBwfbV0wn17TPfZoA@mail.gmail.com>
	<B20A88CC-F4B3-4DE5-9109-C95C30469AB9@r-project.org>
Message-ID: <CAGSjAUAqnExocDa4tLrfvDTafvBDzShkE23Dk2QEvenD+L2pew@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140626/8ab7253e/attachment.pl>

From sannandi at umail.iu.edu  Thu Jun 26 19:03:53 2014
From: sannandi at umail.iu.edu (Sandip Nandi)
Date: Thu, 26 Jun 2014 10:03:53 -0700
Subject: [Rd] Need help on calling Head from C
In-Reply-To: <CAGSjAUAqnExocDa4tLrfvDTafvBDzShkE23Dk2QEvenD+L2pew@mail.gmail.com>
References: <CAGSjAUC2q3s19Bx4Vs7TJuw2y8aF9Xwn0MBwfbV0wn17TPfZoA@mail.gmail.com>
	<B20A88CC-F4B3-4DE5-9109-C95C30469AB9@r-project.org>
	<CAGSjAUAqnExocDa4tLrfvDTafvBDzShkE23Dk2QEvenD+L2pew@mail.gmail.com>
Message-ID: <CAGSjAUDyzSPMhhsFNx3zfH4tuK6Cp-oSCfZ-uAaEWtVTUnAV-Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140626/1737912a/attachment.pl>

From radford at cs.toronto.edu  Thu Jun 26 22:36:24 2014
From: radford at cs.toronto.edu (Radford Neal)
Date: Thu, 26 Jun 2014 16:36:24 -0400
Subject: [Rd]  Need help on calling Head from C
Message-ID: <20140626203624.GA17415@cs.toronto.edu>

>> PROTECT(dfm=lang3(install("data.frame"),df,ScalarLogical(FALSE)));
>> SET_TAG(CDDR(dfm), install("stringsAsFactors")) ;
>> SEXP res = PROTECT(eval(dfm,R_GlobalEnv));
>> PROTECT(head=lang3(install("head"),res,ScalarInteger(1)));
>> head  = PROTECT(eval(head,R_GlobalEnv));
>> 
>> 
>> I tried the above following , it seemed to be not working . Can you please
>> help.
>> 
>
>Can you elaborate? The above code works AFAICT ...

The code is actually not safe.  Both "install" and "SalarLogical/Integer"
potentially allocate memory, so at least one needs to be protected before
callling lang3.  (Passing one such argument would be OK, since lang3 
protects its arguments, but it doesn't get a chance to do that while they
are still being evaluated.)

Now, I'm not sure this is the source of the actual problem, since both
"data.frame" and "head" presumably already exist, so the install won't
actually allocate memory.  But this is not a safe coding method in 
general.

   Radford Neal


From sannandi at umail.iu.edu  Thu Jun 26 22:52:28 2014
From: sannandi at umail.iu.edu (Sandip Nandi)
Date: Thu, 26 Jun 2014 13:52:28 -0700
Subject: [Rd] Need help on calling Head from C
In-Reply-To: <20140626203624.GA17415@cs.toronto.edu>
References: <20140626203624.GA17415@cs.toronto.edu>
Message-ID: <CAGSjAUB9eAsfwAWBf_BR2Vw+84LeW5vG7G8kezrX22wRBp8LbQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140626/58210d20/attachment.pl>

From radford at cs.toronto.edu  Thu Jun 26 23:25:27 2014
From: radford at cs.toronto.edu (Radford Neal)
Date: Thu, 26 Jun 2014 17:25:27 -0400
Subject: [Rd] Need help on calling Head from C
In-Reply-To: <CAGSjAUB9eAsfwAWBf_BR2Vw+84LeW5vG7G8kezrX22wRBp8LbQ@mail.gmail.com>
References: <20140626203624.GA17415@cs.toronto.edu>
	<CAGSjAUB9eAsfwAWBf_BR2Vw+84LeW5vG7G8kezrX22wRBp8LbQ@mail.gmail.com>
Message-ID: <20140626212527.GA22247@cs.toronto.edu>

> Thank you for the wonderful suggestion .  do you suggest to protect
> ScalarInteger(1)
> before calling lang3 ?

Yes, either the result of Scalar Integer(1) or the result of install
should be protected (before calling lang3 - don't try to do it inside
the argument list of lang3).


From sannandi at umail.iu.edu  Thu Jun 26 23:29:37 2014
From: sannandi at umail.iu.edu (Sandip Nandi)
Date: Thu, 26 Jun 2014 14:29:37 -0700
Subject: [Rd] Need help on calling Head from C
In-Reply-To: <20140626212527.GA22247@cs.toronto.edu>
References: <20140626203624.GA17415@cs.toronto.edu>
	<CAGSjAUB9eAsfwAWBf_BR2Vw+84LeW5vG7G8kezrX22wRBp8LbQ@mail.gmail.com>
	<20140626212527.GA22247@cs.toronto.edu>
Message-ID: <CAGSjAUCuZtBNcLzbuPpsFEkfZ84Q7ooKH-ua4ankodaXkYS+CA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140626/9dd9544f/attachment.pl>

From sannandi at umail.iu.edu  Thu Jun 26 23:32:17 2014
From: sannandi at umail.iu.edu (Sandip Nandi)
Date: Thu, 26 Jun 2014 14:32:17 -0700
Subject: [Rd] using 2D array of SEXP for creating dataframe
Message-ID: <CAGSjAUAizjg9fmuEAiRkmw=QM7tDjp+mkHZkb=XhotiP_rM1DQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140626/04a34093/attachment.pl>

From hpages at fhcrc.org  Fri Jun 27 00:06:54 2014
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Thu, 26 Jun 2014 15:06:54 -0700
Subject: [Rd] Need help on calling Head from C
In-Reply-To: <20140626203624.GA17415@cs.toronto.edu>
References: <20140626203624.GA17415@cs.toronto.edu>
Message-ID: <53AC997E.2070706@fhcrc.org>

Hi,

On 06/26/2014 01:36 PM, Radford Neal wrote:
>>> PROTECT(dfm=lang3(install("data.frame"),df,ScalarLogical(FALSE)));
>>> SET_TAG(CDDR(dfm), install("stringsAsFactors")) ;
>>> SEXP res = PROTECT(eval(dfm,R_GlobalEnv));
>>> PROTECT(head=lang3(install("head"),res,ScalarInteger(1)));
>>> head  = PROTECT(eval(head,R_GlobalEnv));
>>>
>>>
>>> I tried the above following , it seemed to be not working . Can you please
>>> help.
>>>
>>
>> Can you elaborate? The above code works AFAICT ...
>
> The code is actually not safe.  Both "install" and "SalarLogical/Integer"
> potentially allocate memory, so at least one needs to be protected before
> callling lang3.  (Passing one such argument would be OK, since lang3
> protects its arguments, but it doesn't get a chance to do that while they
> are still being evaluated.)

How true but who can blame him? The Writing R Extensions manual
contains the same mistake:

   SEXP mkans(double x)
   {
     SEXP ans;
     ans = PROTECT(allocVector(REALSXP, 1));
     REAL(ans)[0] = x;
     UNPROTECT(1);
     return ans;
   }

   double feval(double x, SEXP f, SEXP rho)
   {
     defineVar(install("x"), mkans(x), rho);
     return REAL(eval(f, rho))[0];
   }

Reported here more than 6 years ago and never fixed:

   https://stat.ethz.ch/pipermail/r-devel/2008-January/048040.html

Cheers,
H.

>
> Now, I'm not sure this is the source of the actual problem, since both
> "data.frame" and "head" presumably already exist, so the install won't
> actually allocate memory.  But this is not a safe coding method in
> general.
>
>     Radford Neal
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From edd at debian.org  Fri Jun 27 00:19:49 2014
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 26 Jun 2014 17:19:49 -0500
Subject: [Rd] Compiling R-3.1.0 on debian with libpng/libjpeg
In-Reply-To: <53ABFFA6.3020806@stats.ox.ac.uk>
References: <2DB14965CF615445B453E3930C87350D556A827E@KI-S0113.kerckhoff.mpg.de>
	<53ABFFA6.3020806@stats.ox.ac.uk>
Message-ID: <21420.40069.708518.749916@max.nulle.part>


On 26 June 2014 at 12:10, Prof Brian Ripley wrote:
| On 26/06/2014 07:46, Preussner, Jens wrote:
| > Dear r-developers,
| >
| > I currently face an issue while compiling R from source on a debian wheezy. When running the configure script (particularly with --enable-R-shlib --prefix=/packages/R/3.1.0/) I get a Makefile and the output
| > ...
| >    Interfaces supported:      X11
| >    External libraries:        readline
| >    Additional capabilities:   PNG, JPEG, NLS
| >    Options enabled:           shared R library, shared BLAS, R profiling
| > ...
| >
| > After compiling and checking the capabilities, R tells me the following:
| >> capabilities()
| >      jpeg      png     tiff    tcltk      X11     aqua http/ftp  sockets
| >     FALSE    FALSE    FALSE    FALSE    FALSE    FALSE     TRUE     TRUE
| >    libxml     fifo   cledit    iconv      NLS  profmem    cairo
| >      TRUE     TRUE     TRUE     TRUE     TRUE    FALSE    FALSE
| >
| > I already have R on another machine with jpeg/png capabilities, also compiled on my own. I crosschecked the versions of the libpng-* and libjpeg-* packages installed there and could not find any difference. Also returning to R-3.0.2 doesn't work.
| > A last thing: The same question came up back in 2009, but there was no answer on the list.. https://stat.ethz.ch/pipermail/r-help/2009-December/222967.html
| >
| > Any suggestions how to get more information on what is going on here?
| 
| As you do not have capabilities for cairo nor X11, read ?png, e.g.
| 
|      type: character string, one of ?"Xlib"? or ?"quartz"? (some OS X
|            builds) or ?"cairo"?.  The latter will only be available if
|            the system was compiled with support for cairo - otherwise
|            ?"Xlib"? will be used.  The default is set by
|            ?getOption("bitmapType")? - the ?out of the box? default is
|            ?"quartz"? or ?"cairo"? where available, otherwise ?"Xlib"?.
| 
|       R can be compiled without support for some or all of the types for
|       each of these devices: this will be reported if you attempt to use
|       them on a system where they are not supported.  For ?type =
|       "Xlib"? they may not be usable unless the X11 display is available
|       to the owner of the R process.
| 
| So, the only type available to you appears to be "Xlib", and that 
| process does not have access to an X server.
| 
| The strongly recommended solution is to get cairographics working: see
| http://cran.r-project.org/doc/manuals/r-patched/R-admin.html#Useful-libraries-and-programs

1)  Here are the Build-Depends: the actual Debian binary uses:

    Build-Depends: gcc (>= 4:4.1.0), g++ (>= 4:4.1.0), gfortran (>= 4:4.1.0),
    libblas-dev, liblapack-dev (>= 3.1.1), tcl8.5-dev, tk8.5-dev, bison,
    groff-base, libncurses5-dev, libreadline-dev, debhelper (>= 7.2.3),
    texinfo (>= 4.1-2), libbz2-dev, liblzma-dev, libpcre3-dev, xdg-utils,
    zlib1g-dev, libpng-dev, libjpeg-dev, libx11-dev, libxt-dev,
    x11proto-core-dev, libpango1.0-dev, libcairo2-dev, libtiff5-dev, xvfb,
    xauth, xfonts-base, texlive-base, texlive-latex-base,
    texlive-generic-recommended, texlive-fonts-recommended,
    texlive-fonts-extra, texlive-extra-utils, texlive-latex-recommended,
    texlive-latex-extra, default-jdk [!arm !hppa !kfreebsd-i386
    !kfreebsd-amd64 !hurd-i386], mpack, bash-completion

2)  Here is the relevant part from debian/rules calling configure:

	./configure --prefix=/usr			\
		    --with-cairo			\
		    --with-jpeglib			\
		    --with-readline			\
		    --with-tcltk			\
		    --with-system-bzlib			\
		    --with-system-pcre			\
		    --with-system-zlib			\
		    --mandir=/usr/share/man		\
		    --infodir=/usr/share/info		\
		    --datadir=/usr/share/R/share	\
		    --includedir=/usr/share/R/include	\
		    $(atlas)		\
		    $(lapack)		\
		    --enable-R-profiling		\
		    --enable-R-shlib			\
		    --enable-memory-profiling		\
		    --without-recommended-packages	\
		    --build $(buildarch)

    We select Cairo and Jpeg, Png gets autoselected when the header and
    library are found.

3)  None of this is secret. Our package sources have always been public.

Greetings from DSC,  Dirk

| 
| > Many thanks and best regards,
| >
| > Jens
| >
| >
| > 	[[alternative HTML version deleted]]
| >
| > ______________________________________________
| > R-devel at r-project.org mailing list
| > https://stat.ethz.ch/mailman/listinfo/r-devel
| >
| 
| 
| -- 
| Brian D. Ripley,                  ripley at stats.ox.ac.uk
| Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
| University of Oxford,             Tel:  +44 1865 272861 (self)
| 1 South Parks Road,                     +44 1865 272866 (PA)
| Oxford OX1 3TG, UK                Fax:  +44 1865 272595
| 
| ______________________________________________
| R-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From hpages at fhcrc.org  Fri Jun 27 00:49:45 2014
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Thu, 26 Jun 2014 15:49:45 -0700
Subject: [Rd] using 2D array of SEXP for creating dataframe
In-Reply-To: <CAGSjAUAizjg9fmuEAiRkmw=QM7tDjp+mkHZkb=XhotiP_rM1DQ@mail.gmail.com>
References: <CAGSjAUAizjg9fmuEAiRkmw=QM7tDjp+mkHZkb=XhotiP_rM1DQ@mail.gmail.com>
Message-ID: <53ACA389.5040505@fhcrc.org>

Hi,

On 06/26/2014 02:32 PM, Sandip Nandi wrote:
> Hi ,
>
> For our production package i need to create a dataframein C . So I wrote
> the following code
>
> SEXP dfm ,head,df , dfint , dfStr,lsnm;
>
> *SEXP  valueVector[2];*
>
> char *ab[3] = {"aa","vv","gy"};
> int sn[3] ={99,89,12};
> char *listnames[2] = {"int","string"};
> int i,j;
>
> //=============================
>
> PROTECT(df = allocVector(VECSXP,2));
>
> *PROTECT(valueVector[0] = allocVector(REALSXP,3));*
> *PROTECT(valueVector[1] = allocVector(VECSXP,3));*
>
>
> PROTECT(lsnm = allocVector(STRSXP,2));
>
> SET_STRING_ELT(lsnm,0,mkChar("int"));
> SET_STRING_ELT(lsnm,1,mkChar("string"));
> SEXP rawvec,headr;
> unsigned char str[24]="abcdef";
>
> for ( i = 0 ; i < 3; i++ ) {
>
> *SET_STRING_ELT(valueVector[1],i,mkChar(ab[i]));*
> *REAL(valueVector[0])[i] = sn[i];*
> }
>
>
> It works , data frame is being created and executed properly .

Really? You mean, you can compile this code right? Otherwise it's
incomplete: you allocate but do nothing with 'df'. Same with 'lsnm'.
And you don't UNPROTECT. With no further treatment, 'df' will be an
unnamed list containing junk data, but not the data.frame you expect.
So there are a few gaps that would need to be filled before this code
actually works as intended.

Maybe try and come back again with specific questions?

Cheers,
H.
  > Just curious , if I am doing anything wrong or is there another way 
around
> for creation of data-frame .  I am concerned about the SEXP 2D array .
>
> Thanks,
> Sandip
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From sannandi at umail.iu.edu  Fri Jun 27 01:21:42 2014
From: sannandi at umail.iu.edu (Sandip Nandi)
Date: Thu, 26 Jun 2014 16:21:42 -0700
Subject: [Rd] using 2D array of SEXP for creating dataframe
In-Reply-To: <53ACA389.5040505@fhcrc.org>
References: <CAGSjAUAizjg9fmuEAiRkmw=QM7tDjp+mkHZkb=XhotiP_rM1DQ@mail.gmail.com>
	<53ACA389.5040505@fhcrc.org>
Message-ID: <CAGSjAUCPffJQmmBSKYtvt++pXPeyYVU3yLFF=4r8dsdRg14-zw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140626/dbf49b96/attachment.pl>

From hpages at fhcrc.org  Fri Jun 27 01:52:11 2014
From: hpages at fhcrc.org (=?UTF-8?B?SGVydsOpIFBhZ8Oocw==?=)
Date: Thu, 26 Jun 2014 16:52:11 -0700
Subject: [Rd] using 2D array of SEXP for creating dataframe
In-Reply-To: <CAGSjAUCPffJQmmBSKYtvt++pXPeyYVU3yLFF=4r8dsdRg14-zw@mail.gmail.com>
References: <CAGSjAUAizjg9fmuEAiRkmw=QM7tDjp+mkHZkb=XhotiP_rM1DQ@mail.gmail.com>	<53ACA389.5040505@fhcrc.org>
	<CAGSjAUCPffJQmmBSKYtvt++pXPeyYVU3yLFF=4r8dsdRg14-zw@mail.gmail.com>
Message-ID: <53ACB22B.1050506@fhcrc.org>

Hi Sandip,

On 06/26/2014 04:21 PM, Sandip Nandi wrote:
> Hi ,
>
> I have put incomplete code here . The complete code works , My doubt is
> , what I am doing logical/safe ? Any memory leak going to happen ? is
> there any way to create dataframe ?

I still don't believe it "works". It doesn't even compile. More below...

>
>
>
> SEXP formDF() {
>
> SEXP dfm ,head,df , dfint , dfStr,lsnm;
> SEXP  valueVector[2];
> char *ab[3] = {"aa","vv","gy"};
> int sn[3] ={99,89,12};
> char *listnames[2] = {"int","string"};
> int i,j;
>
> PROTECT(df = allocVector(VECSXP,2));
>
> PROTECT(valueVector[0] = allocVector(REALSXP,3));
> PROTECT(valueVector[1] = allocVector(VECSXP,3));
> PROTECT(lsnm = allocVector(STRSXP,2));
>
> SET_STRING_ELT(lsnm,0,mkChar("int"));
> SET_STRING_ELT(lsnm,1,mkChar("string"));
> SEXP rawvec,headr;
>
> for ( i = 0 ; i < 3; i++ ) {
> SET_STRING_ELT(valueVector[1],0,mkChar(listNames[i]));

'listNames' is undeclared (C is case-sensitive).

Let's assume you managed to compile this with an (imaginary)
case-insensitive C compiler, 'listnames' is an array of length
2 and this for loop tries to read the 3 first elements
from it. So you're just lucky that you didn't get a segfault.
In any case, I don't see how this code could produce
the data.frame you're trying to make.

If you want to discuss how to improve code that *works* (i.e.
compiles and produces the expected result), that's fine, but you
should be able to show that code. Otherwise it sounds like you're
asking people to fix your code. Or to write it for you. Maybe
that's fine too but people will be more sympathetic and willing
to help if you're honest about it.

Cheers,
H.

> REAL(valueVector[0])[i] = sn[i];
> }
>
> SET_VECTOR_ELT(df,1,valueVector[0]);
> SET_VECTOR_ELT(df,0,valueVector[1]);
> setAttrib(df,R_RowNamesSymbol,lsnm);
>
> PROTECT(dfm=lang3(install("data.frame"),df,ScalarLogical(FALSE)));
> SET_TAG(CDDR(dfm), install("stringsAsFactors")) ;
> SEXP res = PROTECT(eval(dfm,R_GlobalEnv));
>
> UNPROTECT(7);
> return res;
>
> }
>
>
>
> On Thu, Jun 26, 2014 at 3:49 PM, Herv? Pag?s <hpages at fhcrc.org
> <mailto:hpages at fhcrc.org>> wrote:
>
>     Hi,
>
>
>     On 06/26/2014 02:32 PM, Sandip Nandi wrote:
>
>         Hi ,
>
>         For our production package i need to create a dataframein C . So
>         I wrote
>         the following code
>
>         SEXP dfm ,head,df , dfint , dfStr,lsnm;
>
>         *SEXP  valueVector[2];*
>
>
>         char *ab[3] = {"aa","vv","gy"};
>         int sn[3] ={99,89,12};
>         char *listnames[2] = {"int","string"};
>         int i,j;
>
>         //============================__=
>
>         PROTECT(df = allocVector(VECSXP,2));
>
>         *PROTECT(valueVector[0] = allocVector(REALSXP,3));*
>         *PROTECT(valueVector[1] = allocVector(VECSXP,3));*
>
>
>
>         PROTECT(lsnm = allocVector(STRSXP,2));
>
>         SET_STRING_ELT(lsnm,0,mkChar("__int"));
>         SET_STRING_ELT(lsnm,1,mkChar("__string"));
>         SEXP rawvec,headr;
>         unsigned char str[24]="abcdef";
>
>         for ( i = 0 ; i < 3; i++ ) {
>
>         *SET_STRING_ELT(valueVector[1]__,i,mkChar(ab[i]));*
>         *REAL(valueVector[0])[i] = sn[i];*
>
>         }
>
>
>         It works , data frame is being created and executed properly .
>
>
>     Really? You mean, you can compile this code right? Otherwise it's
>     incomplete: you allocate but do nothing with 'df'. Same with 'lsnm'.
>     And you don't UNPROTECT. With no further treatment, 'df' will be an
>     unnamed list containing junk data, but not the data.frame you expect.
>     So there are a few gaps that would need to be filled before this code
>     actually works as intended.
>
>     Maybe try and come back again with specific questions?
>
>     Cheers,
>     H.
>
>       > Just curious , if I am doing anything wrong or is there another
>     way around
>
>         for creation of data-frame .  I am concerned about the SEXP 2D
>         array .
>
>         Thanks,
>         Sandip
>
>                  [[alternative HTML version deleted]]
>
>         ________________________________________________
>         R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>         https://stat.ethz.ch/mailman/__listinfo/r-devel
>         <https://stat.ethz.ch/mailman/listinfo/r-devel>
>
>
>     --
>     Herv? Pag?s
>
>     Program in Computational Biology
>     Division of Public Health Sciences
>     Fred Hutchinson Cancer Research Center
>     1100 Fairview Ave. N, M1-B514
>     P.O. Box 19024
>     Seattle, WA 98109-1024
>
>     E-mail: hpages at fhcrc.org <mailto:hpages at fhcrc.org>
>     Phone: (206) 667-5791 <tel:%28206%29%20667-5791>
>     Fax: (206) 667-1319 <tel:%28206%29%20667-1319>
>
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From sannandi at umail.iu.edu  Fri Jun 27 02:18:18 2014
From: sannandi at umail.iu.edu (Sandip Nandi)
Date: Thu, 26 Jun 2014 17:18:18 -0700
Subject: [Rd] using 2D array of SEXP for creating dataframe
In-Reply-To: <53ACB22B.1050506@fhcrc.org>
References: <CAGSjAUAizjg9fmuEAiRkmw=QM7tDjp+mkHZkb=XhotiP_rM1DQ@mail.gmail.com>
	<53ACA389.5040505@fhcrc.org>
	<CAGSjAUCPffJQmmBSKYtvt++pXPeyYVU3yLFF=4r8dsdRg14-zw@mail.gmail.com>
	<53ACB22B.1050506@fhcrc.org>
Message-ID: <CAGSjAUD8TnN4AGWo1bp2_w=ZoKxnKATK+Ememj0AL=cjiZn_mA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140626/e39d11bd/attachment.pl>

From hpages at fhcrc.org  Fri Jun 27 02:25:45 2014
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Thu, 26 Jun 2014 17:25:45 -0700
Subject: [Rd] dget() much slower in recent R versions
In-Reply-To: <53A53A90.4070106@stats.ox.ac.uk>
References: <CA+vqiLFbYLec-6Afcee2fGq0R=_8=VyZAfq1nMHMgCd_ynAPhA@mail.gmail.com>
	<53A53A90.4070106@stats.ox.ac.uk>
Message-ID: <53ACBA09.5010901@fhcrc.org>



On 06/21/2014 12:56 AM, Prof Brian Ripley wrote:
> On 20/06/2014 15:37, Ista Zahn wrote:
>> Hello,
>>
>> I've noticed that dget() is much slower in the current and devel R
>> versions than in previous versions. In 2.15 reading a 10000-row
>> data.frame takes less than half a second:
>>
>>> (which.r <- R.Version()$version.string)
>> [1] "R version 2.15.2 (2012-10-26)"
>>> x <- data.frame(matrix(sample(letters, 100000, replace = TRUE), ncol
>>> = 10))
>>> dput(x, which.r)
>>> system.time(y <- dget(which.r))
>>     user  system elapsed
>>    0.546   0.033   0.586
>>
>> While in 3.1.0 and r-devel it takes around 7 seconds.
>>
>>> (which.r <- R.Version()$version.string)
>> [1] "R version 3.1.0 (2014-04-10)"
>>> x <- data.frame(matrix(sample(letters, 100000, replace = TRUE), ncol
>>> = 10))
>>> dput(x, which.r)
>>> system.time(y <- dget(which.r))
>>     user  system elapsed
>>    6.920   0.060   7.074
>>
>>> (which.r <- R.Version()$version.string)
>> [1] "R Under development (unstable) (2014-06-19 r65979)"
>>> x <- data.frame(matrix(sample(letters, 100000, replace = TRUE), ncol
>>> = 10))
>>> dput(x, which.r)
>>> system.time(y <- dget(which.r))
>>     user  system elapsed
>>    6.886   0.047   6.943
>>>
>>
>> I know dput/dget is probably not the right tool for this job:
>> nevertheless the slowdown in quite dramatic so I thought it was worth
>> calling attention to.
>
> This is completely the wrong way to do this. See ?dump.
>
> dget() basically calls eval(parse()).  parse() is much slower in R >=
> 3.0 mainly because it keeps more information.  Using keep.source=FALSE
> here speeds things up a lot.
>
>  > system.time(y <- dget(which.r))
>     user  system elapsed
>    3.233   0.012   3.248
>  > options(keep.source=FALSE)
>  > system.time(y <- dget(which.r))
>     user  system elapsed
>    0.090   0.001   0.092

Nice. But why add the 'keep.source' arg do dget() in R-devel rev 65990:

   dget <- function(file, keep.source = FALSE)
       eval(parse(file = file, keep.source = FALSE))

(Note that the 'keep.source' arg is actually ignored.)

Why not just:

   dget <- function(file)
       eval(parse(file = file, keep.source = FALSE))

Cheers,

H.


From hpages at fhcrc.org  Fri Jun 27 03:35:47 2014
From: hpages at fhcrc.org (=?UTF-8?B?SGVydsOpIFBhZ8Oocw==?=)
Date: Thu, 26 Jun 2014 18:35:47 -0700
Subject: [Rd] using 2D array of SEXP for creating dataframe
In-Reply-To: <CAGSjAUD8TnN4AGWo1bp2_w=ZoKxnKATK+Ememj0AL=cjiZn_mA@mail.gmail.com>
References: <CAGSjAUAizjg9fmuEAiRkmw=QM7tDjp+mkHZkb=XhotiP_rM1DQ@mail.gmail.com>	<53ACA389.5040505@fhcrc.org>	<CAGSjAUCPffJQmmBSKYtvt++pXPeyYVU3yLFF=4r8dsdRg14-zw@mail.gmail.com>	<53ACB22B.1050506@fhcrc.org>
	<CAGSjAUD8TnN4AGWo1bp2_w=ZoKxnKATK+Ememj0AL=cjiZn_mA@mail.gmail.com>
Message-ID: <53ACCA73.9080805@fhcrc.org>

On 06/26/2014 05:18 PM, Sandip Nandi wrote:
> Hi ,
>
> I have asked a question , whether the data structure I am using to
> create a dataframe is fine or there is anyother way i can use. My aim is
> to read  a database and write it to dataframe and do operation on it .
> The dataframe creation ,output everything works .  The code I put is
> wrong , trying to adding pieces and do it ,sorry for that.    I feel my
> way of doing , creating a 2D array may not be the best, so if someone
> can point out any drawback of my method will be great . My code in
> production can read 100k rows and write in 15 seconds . But one case ,
> when I try to assign NA_REAL to a real vector it causes floating point
> exception. So I doubt something is not wrong . People may be doing
> faster,efficient way.
>

Please understand that the code you send is useful for the discussion
only if we can understand it. And for this it needs to make sense.
The code below still makes little sense. Did you try it? For example
you're calling SET_VECTOR_ELT() and setAttrib() on an SEXP ('df') that
you didn't even allocate. Sounds maybe like a detail but because of
that the code will segfault and, more importantly, it's not clear what
kind of SEXP you want 'df' to be.

Also the following line makes no sense:

   setAttrib(df,R_RowNamesSymbol,lsnm);

given that 'lsnm' is c("int", "string") so it looks more like the col
names than the row names (and also because you're apparently trying to
make a 3x2 data.frame, not a 2x2).

Anyway, once you realize that a data.frame is just a list with 3
attributes:

   > attributes(data.frame(int=c(99,89,12), string=c("aa", "vv", "gy")))
   $names
   [1] "int"    "string"

   $row.names
   [1] 1 2 3

   $class
   [1] "data.frame"

everything becomes simple at the C level i.e. just make that list
and stick these 3 attributes on it. You don't need to call R code
from C (which BTW will protect you from random changes in the behavior
of the data.frame() constructor). You don't need the intermediate
'valueVector' data structure (what you seem to be referring to as the
"2D array of SEXP", don't know why, doesn't look like a 2D array to me,
but you never explained).

Cheers,
H.


> This is a sample code
> */**
> *
> *
> *dfm is a dataframe which i assume as list of list . So I created a SEXP
> array valueVector[2]  where each one can hold different datatype .  Now
> values are assigned and dataframe is generated at end*
> *
> *
> **/*
>
> SEXP formDF() {
>
> SEXP dfm ,head,df , dfint , dfStr,lsnm;
> SEXP  valueVector[2];
> char *ab[3] = {"aa","vv","gy"};
> int sn[3] ={99,89,12};
> char *listnames[2] = {"int","string"};
> int i,j;
>
>
> PROTECT(valueVector[0] = allocVector(REALSXP,3));
> PROTECT(valueVector[1] = allocVector(STRSXP,3));
> PROTECT(lsnm = allocVector(STRSXP,2));
>
> SET_STRING_ELT(lsnm,0,mkChar("int"));
> SET_STRING_ELT(lsnm,1,mkChar("string"));
>
> for ( i = 0 ; i < 3; i++ ) {
> SET_STRING_ELT(valueVector[1],i,mkChar(ab[i]));
> REAL(valueVector[0])[i] = sn[i];
> }
>
>
> SET_VECTOR_ELT(df,1,valueVector[0]);
> SET_VECTOR_ELT(df,0,valueVector[1]);
> setAttrib(df,R_RowNamesSymbol,lsnm);
>
> PROTECT(dfm=lang3(install("data.frame"),df,ScalarLogical(FALSE)));
> SET_TAG(CDDR(dfm), install("stringsAsFactors")) ;
> SEXP res = PROTECT(eval(dfm,R_GlobalEnv));
>
> UNPROTECT(7);
> return res;
>
> }
>
>
> On Thu, Jun 26, 2014 at 4:52 PM, Herv? Pag?s <hpages at fhcrc.org
> <mailto:hpages at fhcrc.org>> wrote:
>
>     Hi Sandip,
>
>
>     On 06/26/2014 04:21 PM, Sandip Nandi wrote:
>
>         Hi ,
>
>         I have put incomplete code here . The complete code works , My
>         doubt is
>         , what I am doing logical/safe ? Any memory leak going to happen
>         ? is
>         there any way to create dataframe ?
>
>
>     I still don't believe it "works". It doesn't even compile. More below...
>
>
>
>
>
>         SEXP formDF() {
>
>         SEXP dfm ,head,df , dfint , dfStr,lsnm;
>         SEXP  valueVector[2];
>         char *ab[3] = {"aa","vv","gy"};
>         int sn[3] ={99,89,12};
>         char *listnames[2] = {"int","string"};
>         int i,j;
>
>         PROTECT(df = allocVector(VECSXP,2));
>
>         PROTECT(valueVector[0] = allocVector(REALSXP,3));
>         PROTECT(valueVector[1] = allocVector(VECSXP,3));
>         PROTECT(lsnm = allocVector(STRSXP,2));
>
>         SET_STRING_ELT(lsnm,0,mkChar("__int"));
>         SET_STRING_ELT(lsnm,1,mkChar("__string"));
>         SEXP rawvec,headr;
>
>         for ( i = 0 ; i < 3; i++ ) {
>         SET_STRING_ELT(valueVector[1],__0,mkChar(listNames[i]));
>
>
>     'listNames' is undeclared (C is case-sensitive).
>
>     Let's assume you managed to compile this with an (imaginary)
>     case-insensitive C compiler, 'listnames' is an array of length
>     2 and this for loop tries to read the 3 first elements
>     from it. So you're just lucky that you didn't get a segfault.
>     In any case, I don't see how this code could produce
>     the data.frame you're trying to make.
>
>     If you want to discuss how to improve code that *works* (i.e.
>     compiles and produces the expected result), that's fine, but you
>     should be able to show that code. Otherwise it sounds like you're
>     asking people to fix your code. Or to write it for you. Maybe
>     that's fine too but people will be more sympathetic and willing
>     to help if you're honest about it.
>
>     Cheers,
>     H.
>
>         REAL(valueVector[0])[i] = sn[i];
>         }
>
>         SET_VECTOR_ELT(df,1,__valueVector[0]);
>         SET_VECTOR_ELT(df,0,__valueVector[1]);
>         setAttrib(df,R_RowNamesSymbol,__lsnm);
>
>         PROTECT(dfm=lang3(install("__data.frame"),df,ScalarLogical(__FALSE)));
>         SET_TAG(CDDR(dfm), install("stringsAsFactors")) ;
>         SEXP res = PROTECT(eval(dfm,R_GlobalEnv))__;
>
>         UNPROTECT(7);
>         return res;
>
>         }
>
>
>
>         On Thu, Jun 26, 2014 at 3:49 PM, Herv? Pag?s <hpages at fhcrc.org
>         <mailto:hpages at fhcrc.org>
>         <mailto:hpages at fhcrc.org <mailto:hpages at fhcrc.org>>> wrote:
>
>              Hi,
>
>
>              On 06/26/2014 02:32 PM, Sandip Nandi wrote:
>
>                  Hi ,
>
>                  For our production package i need to create a
>         dataframein C . So
>                  I wrote
>                  the following code
>
>                  SEXP dfm ,head,df , dfint , dfStr,lsnm;
>
>                  *SEXP  valueVector[2];*
>
>
>                  char *ab[3] = {"aa","vv","gy"};
>                  int sn[3] ={99,89,12};
>                  char *listnames[2] = {"int","string"};
>                  int i,j;
>
>                  //============================____=
>
>
>                  PROTECT(df = allocVector(VECSXP,2));
>
>                  *PROTECT(valueVector[0] = allocVector(REALSXP,3));*
>                  *PROTECT(valueVector[1] = allocVector(VECSXP,3));*
>
>
>
>                  PROTECT(lsnm = allocVector(STRSXP,2));
>
>                  SET_STRING_ELT(lsnm,0,mkChar("____int"));
>                  SET_STRING_ELT(lsnm,1,mkChar("____string"));
>
>                  SEXP rawvec,headr;
>                  unsigned char str[24]="abcdef";
>
>                  for ( i = 0 ; i < 3; i++ ) {
>
>                  *SET_STRING_ELT(valueVector[1]____,i,mkChar(ab[i]));*
>
>                  *REAL(valueVector[0])[i] = sn[i];*
>
>                  }
>
>
>                  It works , data frame is being created and executed
>         properly .
>
>
>              Really? You mean, you can compile this code right?
>         Otherwise it's
>              incomplete: you allocate but do nothing with 'df'. Same
>         with 'lsnm'.
>              And you don't UNPROTECT. With no further treatment, 'df'
>         will be an
>              unnamed list containing junk data, but not the data.frame
>         you expect.
>              So there are a few gaps that would need to be filled before
>         this code
>              actually works as intended.
>
>              Maybe try and come back again with specific questions?
>
>              Cheers,
>              H.
>
>                > Just curious , if I am doing anything wrong or is there
>         another
>              way around
>
>                  for creation of data-frame .  I am concerned about the
>         SEXP 2D
>                  array .
>
>                  Thanks,
>                  Sandip
>
>                           [[alternative HTML version deleted]]
>
>                  __________________________________________________
>         R-devel at r-project.org <mailto:R-devel at r-project.org>
>         <mailto:R-devel at r-project.org <mailto:R-devel at r-project.org>>
>         mailing list
>         https://stat.ethz.ch/mailman/____listinfo/r-devel
>         <https://stat.ethz.ch/mailman/__listinfo/r-devel>
>
>                  <https://stat.ethz.ch/mailman/__listinfo/r-devel
>         <https://stat.ethz.ch/mailman/listinfo/r-devel>>
>
>
>              --
>              Herv? Pag?s
>
>              Program in Computational Biology
>              Division of Public Health Sciences
>              Fred Hutchinson Cancer Research Center
>              1100 Fairview Ave. N, M1-B514
>              P.O. Box 19024
>              Seattle, WA 98109-1024
>
>              E-mail: hpages at fhcrc.org <mailto:hpages at fhcrc.org>
>         <mailto:hpages at fhcrc.org <mailto:hpages at fhcrc.org>>
>              Phone: (206) 667-5791 <tel:%28206%29%20667-5791>
>         <tel:%28206%29%20667-5791>
>              Fax: (206) 667-1319 <tel:%28206%29%20667-1319>
>         <tel:%28206%29%20667-1319>
>
>
>
>     --
>     Herv? Pag?s
>
>     Program in Computational Biology
>     Division of Public Health Sciences
>     Fred Hutchinson Cancer Research Center
>     1100 Fairview Ave. N, M1-B514
>     P.O. Box 19024
>     Seattle, WA 98109-1024
>
>     E-mail: hpages at fhcrc.org <mailto:hpages at fhcrc.org>
>     Phone: (206) 667-5791 <tel:%28206%29%20667-5791>
>     Fax: (206) 667-1319 <tel:%28206%29%20667-1319>
>
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From dstr7320 at uni.sydney.edu.au  Fri Jun 27 04:00:08 2014
From: dstr7320 at uni.sydney.edu.au (Dario Strbenac)
Date: Fri, 27 Jun 2014 02:00:08 +0000
Subject: [Rd] Listing Packages in Depends or Imports
Message-ID: <1403834407075.39663@uni.sydney.edu.au>

Hello,

The Writing R Extensions manual gives confusing advice. Compare 

Packages listed in imports or importFrom directives in the NAMESPACE file should almost always be in ?Imports? and not ?Depends?. 

with 

Almost always packages mentioned in ?Depends? should also be imported from in the NAMESPACE file

--------------------------------------
Dario Strbenac
PhD Student
University of Sydney
Camperdown NSW 2050
Australia


From b.rowlingson at lancaster.ac.uk  Fri Jun 27 09:40:04 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 27 Jun 2014 08:40:04 +0100
Subject: [Rd] Listing Packages in Depends or Imports
In-Reply-To: <d5f96359bb8f49a8ab8d42077ae5210d@EX-0-HT0.lancs.local>
References: <d5f96359bb8f49a8ab8d42077ae5210d@EX-0-HT0.lancs.local>
Message-ID: <CANVKczNpcsTusQ4sEvUd+M=d4PJpeATNui=7Cfbf4tmUGRScuw@mail.gmail.com>

On Fri, Jun 27, 2014 at 3:00 AM, Dario Strbenac
<dstr7320 at uni.sydney.edu.au> wrote:
> Hello,
>
> The Writing R Extensions manual gives confusing advice. Compare
>
> Packages listed in imports or importFrom directives in the NAMESPACE file should almost always be in ?Imports? and not ?Depends?.
>
> with
>
> Almost always packages mentioned in ?Depends? should also be imported from in the NAMESPACE file

 Why is that confusing? Its perfectly logical.

 First line says that packages imported in the NAMESPACE should
usually be in "Imports" in the DESCRIPTION. It implies there are
special cases when "Depends" may be correctly used.

 Second line is that packages that are listed as Depends in
DESCRIPTION should usually be imported in the NAMESPACE file, but
implies there may be exceptions - you might correctly have a "Depends"
that doesn't have an import in the NAMESPACE.

In themselves, those two statements are perfectly logical and consistent.

As an attempt to explain **when** you'd put a reference in Depends or
Imports or why you'd use one of those get-out exceptions, it makes no
claims!

Barry


From radford at cs.toronto.edu  Fri Jun 27 11:23:48 2014
From: radford at cs.toronto.edu (Radford Neal)
Date: Fri, 27 Jun 2014 05:23:48 -0400
Subject: [Rd] Need help on calling Head from C
In-Reply-To: <53AC997E.2070706@fhcrc.org>
References: <20140626203624.GA17415@cs.toronto.edu>
	<53AC997E.2070706@fhcrc.org>
Message-ID: <20140627092348.GA23738@cs.toronto.edu>

> >The code is actually not safe.  Both "install" and "SalarLogical/Integer"
> >potentially allocate memory, so at least one needs to be protected before
> >callling lang3.  (Passing one such argument would be OK, since lang3
> >protects its arguments, but it doesn't get a chance to do that while they
> >are still being evaluated.)
> 
> How true but who can blame him? The Writing R Extensions manual
> contains the same mistake:
> 
>   SEXP mkans(double x)
>   {
>     SEXP ans;
>     ans = PROTECT(allocVector(REALSXP, 1));
>     REAL(ans)[0] = x;
>     UNPROTECT(1);
>     return ans;
>   }
> 
>   double feval(double x, SEXP f, SEXP rho)
>   {
>     defineVar(install("x"), mkans(x), rho);
>     return REAL(eval(f, rho))[0];
>   }

A further comment on this...  Currently, symbols are never garbage
collected, so you might think the above is OK, since the result
of install("x") can't be lost wen mkans(x) is called.  However, I
think it's not a good idea to rely on symbols never being collected.
In any case, though, even if you are relying on that, the code isn't
safe because C doesn't specify the order of evaluation of argments,
so mkans(x) might be called before install("x").

One should also note that the PROTECT within mkans is unnecessary,
and must surely be confusing to anyone who thought (correctly) 
that they had understood what PROTECT is for.

   Radford Neal


From ligges at statistik.tu-dortmund.de  Fri Jun 27 13:07:21 2014
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Fri, 27 Jun 2014 13:07:21 +0200
Subject: [Rd] Listing Packages in Depends or Imports
In-Reply-To: <1403834407075.39663@uni.sydney.edu.au>
References: <1403834407075.39663@uni.sydney.edu.au>
Message-ID: <53AD5069.9090100@statistik.tu-dortmund.de>



On 27.06.2014 04:00, Dario Strbenac wrote:
> Hello,
>
> The Writing R Extensions manual gives confusing advice. Compare
>
> Packages listed in imports or importFrom directives in the NAMESPACE file should almost always be in ?Imports? and not ?Depends?.
>
> with
>
> Almost always packages mentioned in ?Depends? should also be imported from in the NAMESPACE file
>


Right. In the DESCRIPTION file, you should try to be in "Imports" only, 
but even you have to declare in "Depends", you still need to import with 
appropriate directives in the NAMESPACE file.

Best,
Uwe Ligges



> --------------------------------------
> Dario Strbenac
> PhD Student
> University of Sydney
> Camperdown NSW 2050
> Australia
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From peljasz at yahoo.co.uk  Fri Jun 27 13:38:13 2014
From: peljasz at yahoo.co.uk (lejeczek)
Date: Fri, 27 Jun 2014 12:38:13 +0100
Subject: [Rd] blas test problem
Message-ID: <53AD57A5.7020905@yahoo.co.uk>

dear developers

I myself am not a prog-devel, I found this

http://devgurus.amd.com/message/1255852#1255852

Most R compilations/installations I use seem to fail this 
test, is this a problem and if yes then how serious is it?

regards


From luke.hartigan at bigpond.com  Fri Jun 27 12:17:55 2014
From: luke.hartigan at bigpond.com (Luke Hartigan)
Date: Fri, 27 Jun 2014 20:17:55 +1000
Subject: [Rd] R CMD SHLIB failure (Win7 64-bit OS)
Message-ID: <000001cf91f1$105908d0$310b1a70$@bigpond.com>

Dear all,

I am struggling to get the 'Rtools' tool chain to successfully build .dlls
using the "R CMD SHLIB" method on my home Win7 64-bit (Ultimate) PC.
Strangely I did get it working on my work PC (also Win7 64-bit but
Enterprise) so I am totally at a loss as to what to do.

When I type, "R CMD SHLIB foo.c" using the Command Prompt I get:

make: *** No rule to make target 'foo.o', needed by 'foo.dll'. Stop.
Warning message:
running command 'make -f "C:/R/R-3.1.0/etc/x64/Makeconf" -f
"C:/R/R-3.1.0/share/make/winshlib.mk" SHLIB="filename.dll" WIN=64 TCLBIN=64
OBJECTS="filename.o"' has status 2

NB: I am using R-3.1.0 and the most current Rtools suitable for R-3.1.0 as
directed.

To clarify, I installed R-3.1.0 (64-bit) on "C:\R\R-3.1.0". I installed
Rtools to "C:\R\Rtools". I have placed these at the front of my PATH as
directed as well.

Here is my path:

PATH=C:\R\Rtools\bin;C:\R\Rtools\gcc-4.6.3\bin;C:\R\R-3.1.0\bin\x64;C:\Progr
am Files (x86)\NVIDIA Corporation\PhysX\Common;C:\Program Files
(x86)\Intel\iCLS Client\;C:\Program 
Files\Intel\iCLS
Client\;C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Windows\S
ystem32\WindowsPowerShell\v1.0\;C:\Windows\System32\WindowsPowerShell\v1.0\;
C:
\Program Files\Intel\Intel(R) Management Engine Components\DAL;C:\Program
Files\Intel\Intel(R) Management Engine Components\IPT;C:\Program Files
(x86)\Intel\Intel(R) 
Management Engine Components\DAL;C:\Program Files (x86)\Intel\Intel(R)
Management Engine Components\IPT;C:\Program Files\MiKTeX
2.9\miktex\bin\x64\;C:\SDE\TDM-GCC-64\bin;C:
\Anaconda;C:\Anaconda\Scripts;C:\Program
Files\MATLAB\R2013b\runtime\win64;C:\Program Files\MATLAB\R2013b\bin

There does not seem to be any spaces which might cause an issue.

Strangely, if I type: "R --version" at the Command Prompt I get the usual
notice saying I have R version 3.1.0 (2014-04-10)

If I type: "R CMD config CC" I get: 

gcc -m64

If I type: "R CMD config CFLAGS" I get: 

-O2 -Wall -std=gnu99 -mtune=core2

If I manually type in:

gcc -m64 -I"C:/R/R-3.1.0/include" -O2 -Wall -std=gnu99 -mtune=core2 -c
<filename.c> -o <filename.o>

gcc -m64 -shared -s -static-libgcc -o <filename.dll> <filename.o>
-LC:/R/R-3.1.0/bin/x64 -lR

I do get a .dll file which does work in R using dynload("filename.dll"), so
I am wondering if it might be related to the "Makeconf" file?

As another test, if I type in R:

library(devtools)
has_deve()

I get:

make: *** No rule to make target `foo.o', needed by `foo.dll'.  Stop.
Warning message:
running command 'make -f "C:/R/R-3.1.0/etc/x64/Makeconf" -f
"C:/R/R-3.1.0/share/make/winshlib.mk" SHLIB="foo.dll" WIN=64 TCLBIN=64
OBJECTS="foo.o"' had status 2 
Error: Command failed (1)

I would greatly appreciate any suggestions on how I could get this to work
or what I am doing wrong.

Many thanks,

Luke


From hpages at fhcrc.org  Fri Jun 27 19:59:59 2014
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Fri, 27 Jun 2014 10:59:59 -0700
Subject: [Rd] Need help on calling Head from C
In-Reply-To: <20140627092348.GA23738@cs.toronto.edu>
References: <20140626203624.GA17415@cs.toronto.edu>
	<53AC997E.2070706@fhcrc.org>
	<20140627092348.GA23738@cs.toronto.edu>
Message-ID: <53ADB11F.1050004@fhcrc.org>

On 06/27/2014 02:23 AM, Radford Neal wrote:
>>> The code is actually not safe.  Both "install" and "SalarLogical/Integer"
>>> potentially allocate memory, so at least one needs to be protected before
>>> callling lang3.  (Passing one such argument would be OK, since lang3
>>> protects its arguments, but it doesn't get a chance to do that while they
>>> are still being evaluated.)
>>
>> How true but who can blame him? The Writing R Extensions manual
>> contains the same mistake:
>>
>>    SEXP mkans(double x)
>>    {
>>      SEXP ans;
>>      ans = PROTECT(allocVector(REALSXP, 1));
>>      REAL(ans)[0] = x;
>>      UNPROTECT(1);
>>      return ans;
>>    }
>>
>>    double feval(double x, SEXP f, SEXP rho)
>>    {
>>      defineVar(install("x"), mkans(x), rho);
>>      return REAL(eval(f, rho))[0];
>>    }
>
> A further comment on this...  Currently, symbols are never garbage
> collected, so you might think the above is OK, since the result
> of install("x") can't be lost wen mkans(x) is called.  However, I
> think it's not a good idea to rely on symbols never being collected.
> In any case, though, even if you are relying on that, the code isn't
> safe because C doesn't specify the order of evaluation of argments,
> so mkans(x) might be called before install("x").
>
> One should also note that the PROTECT within mkans is unnecessary,
> and must surely be confusing to anyone who thought (correctly)
> that they had understood what PROTECT is for.

I understand what PROTECT is for and I don't find the PROTECT in mkans
confusing.

Maybe it's not necessary now. But it's so much simpler/safer to just
systematically protect any freshly allocated SEXP. One day
someone might need to modify mkans(), say, add a call to warning() or
Rprintf() after the call to allocVector(), and will most likely forget
to add the PROTECT/UNPROTECT that will then become necessary. So at
least there should be a comment next to the allocVector() call in
mkans() to explain why in this particular case the returned value
doesn't need to be protected (but writing the comment probably takes
as much time as doing the PROTECT/UNPROTECT anyway).

Even now, why should I rely on the fact that the REAL() macro doesn't
allocate memory and will never do so?

So with systematic protection:

      SEXP mkans(double x)
      {
          SEXP ans;
          PROTECT(ans = allocVector(REALSXP, 1));
          REAL(ans)[0] = x;
          UNPROTECT(1);
          return ans;
      }

      double feval(double x, SEXP f, SEXP rho)
      {
          SEXP symbol, value;
          PROTECT(symbol = install("x"));
          PROTECT(value = mkans(x));
          defineVar(symbol, value, rho);
          UNPROTECT(2);
          return(REAL(eval(f, rho))[0]);
      }

I doubt you'll ever be able to detect any difference in terms of speed
or memory usage because the cost of PROTECT/UNPROTECT is virtually 0.
Furthermore, one could imagine a static code checker would be able to
verify this and warn me about missing PROTECTs.

BTW I appreciate the work you're doing on pqR and hopefully more of the
stuff you've done will get merged into R at some point.

Cheers,
H.

>
>     Radford Neal
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From sannandi at umail.iu.edu  Fri Jun 27 23:51:04 2014
From: sannandi at umail.iu.edu (Sandip Nandi)
Date: Fri, 27 Jun 2014 14:51:04 -0700
Subject: [Rd] using 2D array of SEXP for creating dataframe
In-Reply-To: <53ACCA73.9080805@fhcrc.org>
References: <CAGSjAUAizjg9fmuEAiRkmw=QM7tDjp+mkHZkb=XhotiP_rM1DQ@mail.gmail.com>
	<53ACA389.5040505@fhcrc.org>
	<CAGSjAUCPffJQmmBSKYtvt++pXPeyYVU3yLFF=4r8dsdRg14-zw@mail.gmail.com>
	<53ACB22B.1050506@fhcrc.org>
	<CAGSjAUD8TnN4AGWo1bp2_w=ZoKxnKATK+Ememj0AL=cjiZn_mA@mail.gmail.com>
	<53ACCA73.9080805@fhcrc.org>
Message-ID: <CAGSjAUBMrn2JJNwGQoiz09PUVpFZb-eYDM_Y0YtPOs74ECOKgA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140627/d43a8f9c/attachment.pl>

From radford at cs.toronto.edu  Sat Jun 28 00:32:22 2014
From: radford at cs.toronto.edu (Radford Neal)
Date: Fri, 27 Jun 2014 18:32:22 -0400
Subject: [Rd] Need help on calling Head from C
In-Reply-To: <53ADB11F.1050004@fhcrc.org>
References: <20140626203624.GA17415@cs.toronto.edu>
	<53AC997E.2070706@fhcrc.org>
	<20140627092348.GA23738@cs.toronto.edu>
	<53ADB11F.1050004@fhcrc.org>
Message-ID: <20140627223222.GA8338@cs.toronto.edu>

> >>   SEXP mkans(double x)
> >>   {
> >>     SEXP ans;
> >>     ans = PROTECT(allocVector(REALSXP, 1));
> >>     REAL(ans)[0] = x;
> >>     UNPROTECT(1);
> >>     return ans;
> >>   }

> >One should also note that the PROTECT within mkans is unnecessary,
> >and must surely be confusing to anyone who thought (correctly)
> >that they had understood what PROTECT is for.
> 
> I understand what PROTECT is for and I don't find the PROTECT in mkans
> confusing.
> 
> Maybe it's not necessary now. But it's so much simpler/safer to just
> systematically protect any freshly allocated SEXP. One day
> someone might need to modify mkans(), say, add a call to warning() or
> Rprintf() after the call to allocVector(), and will most likely forget
> to add the PROTECT/UNPROTECT that will then become necessary.

There's certainly something to be said in favour of the "better safe
than sorry" approach to using PROTECT.  But in the context of a tutorial,
one shouldn't put one in that's unnecessary without a comment saying,
"not needed at the moment, but would be if code that allocates more
memory is added later, so let's be safe and do it now too".  Otherwise,
the reader may infer an incorrect model of when to PROTECT, such as 
"you should PROTECT every allocated object, then UNPROTECT at the end of
the procedure - do that and you'll be OK".  Of course, that's not
enough to be OK.  And to illustrate the correct model, one needs some
negative examples as well as positive examples.

   Radford Neal


From dstr7320 at uni.sydney.edu.au  Sat Jun 28 05:00:17 2014
From: dstr7320 at uni.sydney.edu.au (Dario Strbenac)
Date: Sat, 28 Jun 2014 03:00:17 +0000
Subject: [Rd] Listing Packages in Depends or Imports
In-Reply-To: <CANVKczNpcsTusQ4sEvUd+M=d4PJpeATNui=7Cfbf4tmUGRScuw@mail.gmail.com>
References: <d5f96359bb8f49a8ab8d42077ae5210d@EX-0-HT0.lancs.local>,
	<CANVKczNpcsTusQ4sEvUd+M=d4PJpeATNui=7Cfbf4tmUGRScuw@mail.gmail.com>
Message-ID: <1403924412141.44235@uni.sydney.edu.au>

Hello,

What I meant was that the second rule implies that Depends packages should be in the NAMESPACE file, but the first rule implies that packages in the NAMESPACE file should not be in the Depends field, but Imports field. It would be a logical contradiction if it wasn't preceded by "almost always".

--------------------------------------
Dario Strbenac
PhD Student
University of Sydney
Camperdown NSW 2050
Australia

From xie at yihui.name  Sat Jun 28 05:21:13 2014
From: xie at yihui.name (Yihui Xie)
Date: Fri, 27 Jun 2014 22:21:13 -0500
Subject: [Rd] user defined macros in Rd files
In-Reply-To: <5255C2AA.6010807@gmail.com>
References: <CAC2h7usETeFHChYavo-mCP=4rSRX+Jzxta=e=S=S2sR0_6AAUw@mail.gmail.com>
	<CANROs4er+wdYVQ3MBS7tBn7uWTnot3VQPe3Tm-RTGhHo7AMm1A@mail.gmail.com>
	<5255C2AA.6010807@gmail.com>
Message-ID: <CANROs4cU5ij+pwtoaeDfHihP_4O+dwFp0Lv=TqD+Gv6br2AMMw@mail.gmail.com>

Hi Duncan,

Thanks a lot for eventually implementing this and making the Rd world
greener! https://github.com/wch/r-source/commit/ff3ea81ae87

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Web: http://yihui.name


On Wed, Oct 9, 2013 at 3:55 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> On 13-10-09 4:34 PM, Yihui Xie wrote:
>>
>> +1. As an example, there are 91 instances of \newcommand{\CRANpkg} in
>> R source, and this number is still growing as I see:
>>
>> $ grep "\\\\newcommand{\\\\CRANpkg}" -r . | wc
>>       91      91   10317
>>
>
> So you're saying if I ever get around to doing this, I'll have to track down
> 91+ files to make use of it?  This sounds like an argument why someone else
> should do it. ;-)
>
> Duncan Murdoch
>


From xie at yihui.name  Sat Jun 28 05:32:57 2014
From: xie at yihui.name (Yihui Xie)
Date: Fri, 27 Jun 2014 22:32:57 -0500
Subject: [Rd] R CMD check warning with S3 method
In-Reply-To: <CANROs4fBWPkhPXKV+AkTXCXPx0aFkpt97u2yyboMMp8teeNvMw@mail.gmail.com>
References: <CAFOpNVGGT+tpdAZ42Q+jkWntAE+N=Ctq_D5pKbVVHx7F6_m0RQ@mail.gmail.com>
	<1403198095.17749.166.camel@braque.iarc.fr>
	<CAFOpNVF3Q2nN7jUpCvoqGh_Q0PEpMFgP7KQxrymQxHWUX86YvA@mail.gmail.com>
	<31E214B6DF75104E942856C2F74953CB0519C64C@exchange>
	<CAFOpNVGDzUUtGnWmX3dakGgsnRMG0q+cMFY7WYtWhM98dJrPqg@mail.gmail.com>
	<CANROs4fBWPkhPXKV+AkTXCXPx0aFkpt97u2yyboMMp8teeNvMw@mail.gmail.com>
Message-ID: <CANROs4dB8Z2tS6s5dp2RK+T6Vt=4_M1KugAFqbh+VZhZybEwFw@mail.gmail.com>

Hi Duncan,

Again, thanks a lot for making this change (help requests are tried
over all loaded instead of attached packages):
https://github.com/wch/r-source/commit/21d2f7430b4 This makes what I
proposed last time possible now: if pkg B imports FUN from A and
re-exports it, ?FUN will work after B is attached because A will also
be at least attached.

Then it will be perfect if `R CMD check` can stop warning against the
missing documentation, which is not really missing.

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Web: http://yihui.name


On Fri, Jun 20, 2014 at 1:34 AM, Yihui Xie <xie at yihui.name> wrote:
> but note that you will have to document it even if it is a function
> imported from another package... Perhaps help() should be intelligent
> enough to link the documentation of `FUN` from package A for package B
> when B imports `FUN` from A, and exports it in B's NAMESPACE. The
> package name of A may be obtained from
> environmentName(environment(FUN)). At the moment, since R CMD check
> will warn against the missing documentation of `FUN` in B, I have to
> copy FUN.Rd from A to B in this case, which seems to be inefficient
> and not a best way to maintain. Did I miss anything in the R-exts
> manual?
>
> Regards,
> Yihui
> --
> Yihui Xie <xieyihui at gmail.com>
> Web: http://yihui.name
>
>
> On Fri, Jun 20, 2014 at 12:19 AM, Winston Chang <winstonchang1 at gmail.com> wrote:
>> On Thu, Jun 19, 2014 at 3:15 PM, Martyn Plummer <plummerm at iarc.fr> wrote:
>>
>>>  Export filter in the NAMESPACE file *without copying it* in the R source
>>> code.
>>>
>>>
>> Ah, it works! Thank you!
>>


From lawrence.michael at gene.com  Sun Jun 29 15:07:11 2014
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Sun, 29 Jun 2014 06:07:11 -0700
Subject: [Rd] R CMD check warning with S3 method
In-Reply-To: <CANROs4dB8Z2tS6s5dp2RK+T6Vt=4_M1KugAFqbh+VZhZybEwFw@mail.gmail.com>
References: <CAFOpNVGGT+tpdAZ42Q+jkWntAE+N=Ctq_D5pKbVVHx7F6_m0RQ@mail.gmail.com>
	<1403198095.17749.166.camel@braque.iarc.fr>
	<CAFOpNVF3Q2nN7jUpCvoqGh_Q0PEpMFgP7KQxrymQxHWUX86YvA@mail.gmail.com>
	<31E214B6DF75104E942856C2F74953CB0519C64C@exchange>
	<CAFOpNVGDzUUtGnWmX3dakGgsnRMG0q+cMFY7WYtWhM98dJrPqg@mail.gmail.com>
	<CANROs4fBWPkhPXKV+AkTXCXPx0aFkpt97u2yyboMMp8teeNvMw@mail.gmail.com>
	<CANROs4dB8Z2tS6s5dp2RK+T6Vt=4_M1KugAFqbh+VZhZybEwFw@mail.gmail.com>
Message-ID: <CAOQ5NyfkV7D-kmCcuADQTkhs+fxGTbd6B9EZcM_y6jj-_4A7aw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140629/1898f656/attachment.pl>

From skostysh at princeton.edu  Sun Jun 29 16:03:52 2014
From: skostysh at princeton.edu (Scott Kostyshak)
Date: Sun, 29 Jun 2014 10:03:52 -0400
Subject: [Rd] [patch] Fix n arg in mclapply call to ngettext
Message-ID: <CAE3=dmfibNLARJNxTZv-GQ4=-hyMyPn9y60WMYBL3oe93dKy9w@mail.gmail.com>

Regarding the following code,

warning(sprintf(ngettext(has.errors,
      "scheduled core %s encountered error in user code, all values of
the job will be affected",
      "scheduled cores %s encountered errors in user code, all values
of the jobs will be affected"),
    paste(has.errors, collapse = ", ")),
  domain = NA)

has.errors is a vector whose elements are the cores that have encountered
errors. The plural message thus appears if the first element of has.errors is
greater than one and is singular otherwise. What we want is for the plural
message to be given if more than one core encountered errors. Changing the n
arg of ngettext from has.errors to length(has.errors) leads to the correct
messages.

Attached is a patch.

More details for completeness:

I've reproduced this on 3.1.0 and r66050.

Below is an example that leads to bad output sometimes (depending on
the order in which the cores finish).
library(parallel)
options(mc.cores = 4)
abc <- mclapply(2:5, FUN = function(x) stopifnot(x >= 4))
# Warning message:
# In mclapply(2:5, FUN = function(x) { :
#   scheduled core 1, 2 encountered error in user code, all values of
the job will be affected

# if a core with number great than 1 has the only error, then an
incorrect message is shown:
library(parallel)
options(mc.cores = 4)
abc <- mclapply(2:5, FUN = function(x) stopifnot(x <= 4))
# Warning message:
# In mclapply(2:5, FUN = function(x) { :
#  scheduled cores 4 encountered errors in user code, all values of
the jobs will be affected

> sessionInfo()
R Under development (unstable) (2014-06-29 r66050)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

Scott


--
Scott Kostyshak
Economics PhD Candidate
Princeton University
-------------- next part --------------
Index: src/library/parallel/R/unix/mclapply.R
===================================================================
--- src/library/parallel/R/unix/mclapply.R	(revision 66050)
+++ src/library/parallel/R/unix/mclapply.R	(working copy)
@@ -172,7 +172,7 @@
         if (length(has.errors) == cores)
             warning("all scheduled cores encountered errors in user code")
         else
-            warning(sprintf(ngettext(has.errors,
+            warning(sprintf(ngettext(length(has.errors),
                                      "scheduled core %s encountered error in user code, all values of the job will be affected",
                                      "scheduled cores %s encountered errors in user code, all values of the jobs will be affected"),
                             paste(has.errors, collapse = ", ")),

From murdoch.duncan at gmail.com  Sun Jun 29 21:43:01 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sun, 29 Jun 2014 21:43:01 +0200
Subject: [Rd] R CMD check warning with S3 method
In-Reply-To: <CAOQ5NyfkV7D-kmCcuADQTkhs+fxGTbd6B9EZcM_y6jj-_4A7aw@mail.gmail.com>
References: <CAFOpNVGGT+tpdAZ42Q+jkWntAE+N=Ctq_D5pKbVVHx7F6_m0RQ@mail.gmail.com>	<1403198095.17749.166.camel@braque.iarc.fr>	<CAFOpNVF3Q2nN7jUpCvoqGh_Q0PEpMFgP7KQxrymQxHWUX86YvA@mail.gmail.com>	<31E214B6DF75104E942856C2F74953CB0519C64C@exchange>	<CAFOpNVGDzUUtGnWmX3dakGgsnRMG0q+cMFY7WYtWhM98dJrPqg@mail.gmail.com>	<CANROs4fBWPkhPXKV+AkTXCXPx0aFkpt97u2yyboMMp8teeNvMw@mail.gmail.com>	<CANROs4dB8Z2tS6s5dp2RK+T6Vt=4_M1KugAFqbh+VZhZybEwFw@mail.gmail.com>
	<CAOQ5NyfkV7D-kmCcuADQTkhs+fxGTbd6B9EZcM_y6jj-_4A7aw@mail.gmail.com>
Message-ID: <53B06C45.30208@gmail.com>

On 29/06/2014, 3:07 PM, Michael Lawrence wrote:
> While the change to the symbol lookup is generally useful (e.g., for
> finding S4 methods that become available whenever a package is loaded),
> it seems that we ultimately want a mechanism by which a package
> namespace can formally declare that it is re-exporting a symbol from
> some package. Then, for example, the check mechanism can be made smart
> enough to avoid throwing such warnings.
> 
> I've developed a proof-of-concept exportFrom() namespace directive. This
> is the syntax:
> 
> exportFrom(utils, help)
> 
> Then:
> 
>> getNamespaceInfo("ReexportingPackage", "exports")$help
> [1] "help"
> attr(,"origin")
> [1] "utils"
> 
> Comments?

I don't see why this is needed.  What does it gain over documenting that
the symbol "help" is just a copy of the one from utils?  As of this
morning, that's easy...

Duncan Murdoch

> 
> Michael
> 
> 
> On Fri, Jun 27, 2014 at 8:32 PM, Yihui Xie <xie at yihui.name
> <mailto:xie at yihui.name>> wrote:
> 
>     Hi Duncan,
> 
>     Again, thanks a lot for making this change (help requests are tried
>     over all loaded instead of attached packages):
>     https://github.com/wch/r-source/commit/21d2f7430b4 This makes what I
>     proposed last time possible now: if pkg B imports FUN from A and
>     re-exports it, ?FUN will work after B is attached because A will also
>     be at least attached.
> 
>     Then it will be perfect if `R CMD check` can stop warning against the
>     missing documentation, which is not really missing.
> 
>     Regards,
>     Yihui
>     --
>     Yihui Xie <xieyihui at gmail.com <mailto:xieyihui at gmail.com>>
>     Web: http://yihui.name
> 
> 
>     On Fri, Jun 20, 2014 at 1:34 AM, Yihui Xie <xie at yihui.name
>     <mailto:xie at yihui.name>> wrote:
>     > but note that you will have to document it even if it is a function
>     > imported from another package... Perhaps help() should be intelligent
>     > enough to link the documentation of `FUN` from package A for package B
>     > when B imports `FUN` from A, and exports it in B's NAMESPACE. The
>     > package name of A may be obtained from
>     > environmentName(environment(FUN)). At the moment, since R CMD check
>     > will warn against the missing documentation of `FUN` in B, I have to
>     > copy FUN.Rd from A to B in this case, which seems to be inefficient
>     > and not a best way to maintain. Did I miss anything in the R-exts
>     > manual?
>     >
>     > Regards,
>     > Yihui
>     > --
>     > Yihui Xie <xieyihui at gmail.com <mailto:xieyihui at gmail.com>>
>     > Web: http://yihui.name
>     >
>     >
>     > On Fri, Jun 20, 2014 at 12:19 AM, Winston Chang
>     <winstonchang1 at gmail.com <mailto:winstonchang1 at gmail.com>> wrote:
>     >> On Thu, Jun 19, 2014 at 3:15 PM, Martyn Plummer <plummerm at iarc.fr
>     <mailto:plummerm at iarc.fr>> wrote:
>     >>
>     >>>  Export filter in the NAMESPACE file *without copying it* in the
>     R source
>     >>> code.
>     >>>
>     >>>
>     >> Ah, it works! Thank you!
>     >>
> 
>     ______________________________________________
>     R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>     https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From nalimilan at club.fr  Mon Jun 30 10:44:13 2014
From: nalimilan at club.fr (Milan Bouchet-Valat)
Date: Mon, 30 Jun 2014 10:44:13 +0200
Subject: [Rd] Building R on Windows: mkdir of Rtools creates directories
 with read-only permissions [WEIRD]
Message-ID: <1404117853.25972.8.camel@milan.mobile.lan>

On Thu Jan 9 2014 03:47 Henrik Bengtsson wrote:
> This is is an issue that bugged me for a while.  I encountered a year
> ago (April 2012) when I first tried to build R from source on Windows.
>  I never figured out what the solution is or if I'm doing something
> wrong myself (but I have found a tedious workaround).  I'm still on
> the same Windows 7 Ultimate machine with NTFS, but I now made sure I
> started from scratch so I have a completely fresh setup (see details
> at the end).
> 
> PROBLEM:
> At the very first step I do:
> 
> C:\R\src\gnuwin32>make all
> [... Waiting. No errors until ...]
> cp R.dll ../../bin/i386
> -------- Building ../../../bin/i386/Rblas.dll --------
> gcc -std=gnu99  -shared  -o ../../../bin/i386/Rblas.dll blas.o
> cmplxblas.o ../../gnuwin32/dllversion.o Rblas.def -L../../../bin/i386
> -lR -lgfortran
> c:/rtools/gcc-4.6.3/bin/../lib/gcc/i686-w64-mingw32/4.6.3/../../../../i686-w64-mingw32/bin/ld.exe:
> cannot find -lR
> collect2: ld returned 1 exit status
> make[2]: *** [../../../bin/i386/Rblas.dll] Error 1
> make[1]: *** [Rblas] Error 2
> make: *** [rbuild] Error 2
> 
> However:
> 
> C:\R\src\gnuwin32>dir ..\..\bin\i386\
>  Volume in drive C is Windows7_OS
>  Volume Serial Number is E038-51CC
> 
>  Directory of C:\R\bin\i386
> 
> 01/08/2014  06:18 PM    <DIR>          .
> 01/08/2014  06:18 PM    <DIR>          ..
> 01/08/2014  06:18 PM         3,059,712 R.dll
> 01/08/2014  06:18 PM           348,995 Rgraphapp.dll
> 01/08/2014  06:18 PM           102,975 Riconv.dll
> 01/08/2014  06:18 PM           154,917 Rzlib.dll
>                4 File(s)      3,666,599 bytes
>                2 Dir(s)  22,424,739,840 bytes free
> 
> What's weird is that these files have **read permission disabled**:
> 
> C:\R\src\gnuwin32>file ..\..\bin\i386\*.dll
> ..\..\bin\i386\R.dll:         writable, executable, regular file, no
> read permission
> ..\..\bin\i386\Rgraphapp.dll: writable, executable, regular file, no
> read permission
> ..\..\bin\i386\Riconv.dll:    writable, executable, regular file, no
> read permission
> ..\..\bin\i386\Rzlib.dll:     writable, executable, regular file, no
> read permission
> 
> What is going on?  Have anyone else seen this?  I've also tried
> running as Administrator - no difference.
Hi Henrik,

Old thread, but I think I'm experiencing exactly the same problem. I
tried running as administrator and as a normal user, and no luck. I
noticed, though, that resetting permissions on the build tree makes the
error go away, and replaces it with another one stating that headers in
include/ could not be created due to permission issues.

This is on a machine where I was able to build R 3.0.1 successfully,
though I also remember having permission issues I eventually fixed by
resetting permissions on the build tree. Not sure what's changed since
then...

To add bit of information to the debugging you've already done: I
noticed that when opening the directory/file property dialog, a user
with a very long name including letters and numbers appears in the
permissions list for a second, and then disappears. This user reappears
every time I run 'make'. So maybe 'mkdir' or other tools use wrong user
IDs, creating bogus users. Just a guess.

Have you found a solution or workaround since January? I really need to
build an R installer and I seem to be stuck...

Thanks for your help


> TROUBLESHOOTING / WORKAROUND:
> It appears that 'mkdir' (of Rtools) causes this problem, because if I
> manually pre-create 'C:\R\src\gnuwin32\bin\i386' using Windows' mkdir
> it works, e.g.
> 
> C:\R\src\gnuwin32>rm -fR ..\..\bin\
> C:\R\src\gnuwin32>cmd /C mkdir ..\..\bin\i386
> C:\R\src\gnuwin32>make rbuild
> [...]
> -------- Building ../../../bin/i386/Rblas.dll --------
> gcc -std=gnu99  -shared  -o ../../../bin/i386/Rblas.dll blas.o
> cmplxblas.o ../../gnuwin32/dllversion.o Rblas.def -L../../../bin/i386
> -lR -lgfortran
> make --no-print-directory -C front-ends
> mkdir -p ../../../bin/i386
> cp Rgui.exe ../../../bin/i386/Rgui.exe
> mkdir -p ../../../bin/i386
> cp Rterm.exe ../../../bin/i386/Rterm.exe
> mkdir -p ../../../bin/i386
> cp Rcmd.exe ../../../bin/i386/Rcmd.exe
> mkdir -p ../../../bin/i386
> cp RSetReg.exe ../../../bin/i386/RSetReg.exe
> mkdir -p ../../../bin/i386
> cp R.exe ../../../bin/i386/R.exe
> mkdir -p ../../../bin/i386
> cp Rscript.exe ../../../bin/i386/Rscript.exe
> mkdir -p ../../../bin/i386
> cp open.exe ../../../bin/i386/open.exe
> mkdir -p ../../../bin
> cp Rfe.exe ../../../bin/R.exe
> mkdir -p ../../../bin
> cp Rfe.exe ../../../bin/Rscript.exe
> make[1]: `COPYRIGHTS' is up to date.
> make --no-print-directory -C ../modules -f Makefile.win \
>   CFLAGS='-O3 -Wall -pedantic -mtune=core2' FFLAGS='-O3 -mtune=core2'
> gcc -std=gnu99  -shared -s -o ../../../bin/i386/Rlapack.dll dlamch.o
> dlapack.o cmplx.o init_win.o Rlapackrc.o -L../../../bin/i386 -lR
> -lRblas -lgfortran
> cp lapack.dll ../../../modules/i386/lapack.dll
> 
> and there is (obviously) read permissions on those files:
> 
> C:\R\src\gnuwin32>file ..\..\bin\i386\*.dll
> ..\..\bin\i386\R.dll:         PE32 executable for MS Windows (DLL)
> (GUI) Intel 80386 32-bit
> ..\..\bin\i386\Rblas.dll:     PE32 executable for MS Windows (DLL)
> (console) Intel 80386 32-bit
> ..\..\bin\i386\Rgraphapp.dll: PE32 executable for MS Windows (DLL)
> (GUI) Intel 80386 32-bit
> ..\..\bin\i386\Riconv.dll:    PE32 executable for MS Windows (DLL)
> (console) Intel 80386 32-bit
> ..\..\bin\i386\Rlapack.dll:   PE32 executable for MS Windows (DLL)
> (console) Intel 80386 32-bit
> ..\..\bin\i386\Rzlib.dll:     PE32 executable for MS Windows (DLL)
> (console) Intel 80386 32-bit
> 
> Pre-creating the proper directories is tedious and only works up to
> the point of 'make distribution', where I haven't found a similar
> workaround (without modifying the Makefiles).  Note, I can get to the
> point where I have build and check everything (including recommended
> packages).
> 
> 
> Just to convince you that mkdir is the problem, I can reproduce the
> problem from this point, by removing the bin/ directory again and
> relying on Rtools mkdir again;
> 
> C:\R\src\gnuwin32>rm -fR ..\..\bin
> C:\R\src\gnuwin32>make rbuild
> make[3]: Nothing to be done for `svnonly'.
> installing C headers
> make[1]: `libRblas.dll.a' is up to date.
> make[4]: Nothing to be done for `svnonly'.
> installing C headers
> make --no-print-directory -C ../extra/intl CFLAGS='-O3 -Wall -pedantic
> -mtune=core2' -f Makefile.win
> make --no-print-directory -C ../appl CFLAGS='-O3 -Wall -pedantic
> -mtune=core2' FFLAGS='-O3 -mtune=core2' -f Makefile.win
> make --no-print-directory -C ../nmath CFLAGS='-O3 -Wall -pedantic
> -mtune=core2' FFLAGS='-O3 -mtune=core2' -f Makefile.win
> make --no-print-directory -C ../main CFLAGS='-O3 -Wall -pedantic
> -mtune=core2' FFLAGS='-O3 -mtune=core2' malloc-DEFS='-DLEA_MALLOC' -f
> Makefile.win
> make --no-print-directory -C ./getline CFLAGS='-O3 -Wall -pedantic -mtune=core2'
> 
> make[3]: `gl.a' is up to date.
> make -f Makefile.win makeMakedeps
> make -f Makefile.win libpcre.a
> make[4]: `libpcre.a' is up to date.
> make[3]: Nothing to be done for `all'.
> make -f Makefile.win makeMakedeps
> make -f Makefile.win libtre.a
> make[4]: `libtre.a' is up to date.
> make[3]: Nothing to be done for `all'.
> make[4]: `stamp' is up to date.
> make[4]: `liblzma.a' is up to date.
> make[2]: `R.dll' is up to date.
> cp R.dll ../../bin/i386
> -------- Building ../../../bin/i386/Rblas.dll --------
> gcc -std=gnu99  -shared  -o ../../../bin/i386/Rblas.dll blas.o
> cmplxblas.o ../../gnuwin32/dllversion.o Rblas.def -L../../../bin/i386
> -lR -lgfortran
> c:/rtools/gcc-4.6.3/bin/../lib/gcc/i686-w64-mingw32/4.6.3/../../../../i686-w64-mingw32/bin/ld.exe:
> cannot find -lR
> collect2: ld returned 1 exit status
> make[2]: *** [../../../bin/i386/Rblas.dll] Error 1
> make[1]: *** [Rblas] Error 2
> make: *** [rbuild] Error 2
> 
> 
> MORE TROUBLESHOOTING:
> The MD5 checksum when it fails (reproducible):
> C:\R\src\gnuwin32>md5sum ../../bin/i386/*.dll
> 75b2e64d3847e768631681922df5a81d *../../bin/i386/R.dll
> 12a35b63a28ad0e0fee8cae04f76e907 *../../bin/i386/Rgraphapp.dll
> e2c40ae15d13dc17af33c1367f78817d *../../bin/i386/Riconv.dll
> c5ea5a5cd2b7d3c07970f5314ce7296a *../../bin/i386/Rzlib.dll
> 
> The MD5 checksum when it works (reproducible):
> C:\R\src\gnuwin32>md5sum ../../bin/i386/*.dll
> 75b2e64d3847e768631681922df5a81d *../../bin/i386/R.dll
> 12a35b63a28ad0e0fee8cae04f76e907 *../../bin/i386/Rgraphapp.dll
> e2c40ae15d13dc17af33c1367f78817d *../../bin/i386/Riconv.dll
> c5ea5a5cd2b7d3c07970f5314ce7296a *../../bin/i386/Rzlib.dll
> +
> c81b3399027ec9c24ca80ba92199327c *../../bin/i386/Rblas.dll
> 20d32cee2e561d1826af1a538844472b *../../bin/i386/Rlapack.dll
> 
> 
> Thanks for any help,
> 
> Henrik
> 
> 
> SETUP:
> 1. Downloaded/svn checkout the R source to C:\R\.
> 2. Installed most recent Rtools to C:\Rtools (completely removed previously)
> (3. Modifying the MkRules.* files has no impact for reproducing this
> problem.  Same with 'make rsync-recommended')
> 
> C:\R\src\gnuwin32>path
> PATH=;C:\Rtools\bin;C:\Rtools\gcc-4.6.3\bin;C:\Windows;C:\Windows\system32
> 
> C:\R\src\gnuwin32>cat C:\Rtools\VERSION.txt
> Rtools version 3.1.0.1939
> 
> C:\R\src\gnuwin32>ls ../..
> COPYING      Makefile.fw  VERSION       configure.ac  po     tmp
> ChangeLog    Makefile.in  VERSION-NICK  doc           share  tools
> INSTALL      README       config.site   etc           src
> Makeconf.in  Tcl          configure     m4            tests


From murdoch.duncan at gmail.com  Mon Jun 30 11:23:36 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 30 Jun 2014 05:23:36 -0400
Subject: [Rd] Building R on Windows: mkdir of Rtools creates directories
 with read-only permissions [WEIRD]
In-Reply-To: <1404117853.25972.8.camel@milan.mobile.lan>
References: <1404117853.25972.8.camel@milan.mobile.lan>
Message-ID: <53B12C98.2000007@gmail.com>

On 30/06/2014, 4:44 AM, Milan Bouchet-Valat wrote:
> On Thu Jan 9 2014 03:47 Henrik Bengtsson wrote:
>> This is is an issue that bugged me for a while.  I encountered a year
>> ago (April 2012) when I first tried to build R from source on Windows.
>>  I never figured out what the solution is or if I'm doing something
>> wrong myself (but I have found a tedious workaround).  I'm still on
>> the same Windows 7 Ultimate machine with NTFS, but I now made sure I
>> started from scratch so I have a completely fresh setup (see details
>> at the end).
>>
>> PROBLEM:
>> At the very first step I do:
>>
>> C:\R\src\gnuwin32>make all
>> [... Waiting. No errors until ...]
>> cp R.dll ../../bin/i386
>> -------- Building ../../../bin/i386/Rblas.dll --------
>> gcc -std=gnu99  -shared  -o ../../../bin/i386/Rblas.dll blas.o
>> cmplxblas.o ../../gnuwin32/dllversion.o Rblas.def -L../../../bin/i386
>> -lR -lgfortran
>> c:/rtools/gcc-4.6.3/bin/../lib/gcc/i686-w64-mingw32/4.6.3/../../../../i686-w64-mingw32/bin/ld.exe:
>> cannot find -lR
>> collect2: ld returned 1 exit status
>> make[2]: *** [../../../bin/i386/Rblas.dll] Error 1
>> make[1]: *** [Rblas] Error 2
>> make: *** [rbuild] Error 2
>>
>> However:
>>
>> C:\R\src\gnuwin32>dir ..\..\bin\i386\
>>  Volume in drive C is Windows7_OS
>>  Volume Serial Number is E038-51CC
>>
>>  Directory of C:\R\bin\i386
>>
>> 01/08/2014  06:18 PM    <DIR>          .
>> 01/08/2014  06:18 PM    <DIR>          ..
>> 01/08/2014  06:18 PM         3,059,712 R.dll
>> 01/08/2014  06:18 PM           348,995 Rgraphapp.dll
>> 01/08/2014  06:18 PM           102,975 Riconv.dll
>> 01/08/2014  06:18 PM           154,917 Rzlib.dll
>>                4 File(s)      3,666,599 bytes
>>                2 Dir(s)  22,424,739,840 bytes free
>>
>> What's weird is that these files have **read permission disabled**:
>>
>> C:\R\src\gnuwin32>file ..\..\bin\i386\*.dll
>> ..\..\bin\i386\R.dll:         writable, executable, regular file, no
>> read permission
>> ..\..\bin\i386\Rgraphapp.dll: writable, executable, regular file, no
>> read permission
>> ..\..\bin\i386\Riconv.dll:    writable, executable, regular file, no
>> read permission
>> ..\..\bin\i386\Rzlib.dll:     writable, executable, regular file, no
>> read permission
>>
>> What is going on?  Have anyone else seen this?  I've also tried
>> running as Administrator - no difference.
> Hi Henrik,
> 
> Old thread, but I think I'm experiencing exactly the same problem. I
> tried running as administrator and as a normal user, and no luck. I
> noticed, though, that resetting permissions on the build tree makes the
> error go away, and replaces it with another one stating that headers in
> include/ could not be created due to permission issues.
> 
> This is on a machine where I was able to build R 3.0.1 successfully,
> though I also remember having permission issues I eventually fixed by
> resetting permissions on the build tree. Not sure what's changed since
> then...
> 
> To add bit of information to the debugging you've already done: I
> noticed that when opening the directory/file property dialog, a user
> with a very long name including letters and numbers appears in the
> permissions list for a second, and then disappears. This user reappears
> every time I run 'make'. So maybe 'mkdir' or other tools use wrong user
> IDs, creating bogus users. Just a guess.
> 
> Have you found a solution or workaround since January? I really need to
> build an R installer and I seem to be stuck...

I have seen this, but I don't see it on every machine.  One one where I
do see it is the Windows builder machine in Dortmund.  The following is
inserted into the script after building the 32 bit build

cacls %name32% /T /E /G VORDEFINIERT\Benutzer:R > NUL

and similar after the 64 bit build.  (I don't remember whether
VORDEFINIERT\Benutzer is the current user name, or is some generic thing
saying "current user".  I think Uwe Ligges came up with this...)

Duncan Murdoch

> 
> Thanks for your help
> 
> 
>> TROUBLESHOOTING / WORKAROUND:
>> It appears that 'mkdir' (of Rtools) causes this problem, because if I
>> manually pre-create 'C:\R\src\gnuwin32\bin\i386' using Windows' mkdir
>> it works, e.g.
>>
>> C:\R\src\gnuwin32>rm -fR ..\..\bin\
>> C:\R\src\gnuwin32>cmd /C mkdir ..\..\bin\i386
>> C:\R\src\gnuwin32>make rbuild
>> [...]
>> -------- Building ../../../bin/i386/Rblas.dll --------
>> gcc -std=gnu99  -shared  -o ../../../bin/i386/Rblas.dll blas.o
>> cmplxblas.o ../../gnuwin32/dllversion.o Rblas.def -L../../../bin/i386
>> -lR -lgfortran
>> make --no-print-directory -C front-ends
>> mkdir -p ../../../bin/i386
>> cp Rgui.exe ../../../bin/i386/Rgui.exe
>> mkdir -p ../../../bin/i386
>> cp Rterm.exe ../../../bin/i386/Rterm.exe
>> mkdir -p ../../../bin/i386
>> cp Rcmd.exe ../../../bin/i386/Rcmd.exe
>> mkdir -p ../../../bin/i386
>> cp RSetReg.exe ../../../bin/i386/RSetReg.exe
>> mkdir -p ../../../bin/i386
>> cp R.exe ../../../bin/i386/R.exe
>> mkdir -p ../../../bin/i386
>> cp Rscript.exe ../../../bin/i386/Rscript.exe
>> mkdir -p ../../../bin/i386
>> cp open.exe ../../../bin/i386/open.exe
>> mkdir -p ../../../bin
>> cp Rfe.exe ../../../bin/R.exe
>> mkdir -p ../../../bin
>> cp Rfe.exe ../../../bin/Rscript.exe
>> make[1]: `COPYRIGHTS' is up to date.
>> make --no-print-directory -C ../modules -f Makefile.win \
>>   CFLAGS='-O3 -Wall -pedantic -mtune=core2' FFLAGS='-O3 -mtune=core2'
>> gcc -std=gnu99  -shared -s -o ../../../bin/i386/Rlapack.dll dlamch.o
>> dlapack.o cmplx.o init_win.o Rlapackrc.o -L../../../bin/i386 -lR
>> -lRblas -lgfortran
>> cp lapack.dll ../../../modules/i386/lapack.dll
>>
>> and there is (obviously) read permissions on those files:
>>
>> C:\R\src\gnuwin32>file ..\..\bin\i386\*.dll
>> ..\..\bin\i386\R.dll:         PE32 executable for MS Windows (DLL)
>> (GUI) Intel 80386 32-bit
>> ..\..\bin\i386\Rblas.dll:     PE32 executable for MS Windows (DLL)
>> (console) Intel 80386 32-bit
>> ..\..\bin\i386\Rgraphapp.dll: PE32 executable for MS Windows (DLL)
>> (GUI) Intel 80386 32-bit
>> ..\..\bin\i386\Riconv.dll:    PE32 executable for MS Windows (DLL)
>> (console) Intel 80386 32-bit
>> ..\..\bin\i386\Rlapack.dll:   PE32 executable for MS Windows (DLL)
>> (console) Intel 80386 32-bit
>> ..\..\bin\i386\Rzlib.dll:     PE32 executable for MS Windows (DLL)
>> (console) Intel 80386 32-bit
>>
>> Pre-creating the proper directories is tedious and only works up to
>> the point of 'make distribution', where I haven't found a similar
>> workaround (without modifying the Makefiles).  Note, I can get to the
>> point where I have build and check everything (including recommended
>> packages).
>>
>>
>> Just to convince you that mkdir is the problem, I can reproduce the
>> problem from this point, by removing the bin/ directory again and
>> relying on Rtools mkdir again;
>>
>> C:\R\src\gnuwin32>rm -fR ..\..\bin
>> C:\R\src\gnuwin32>make rbuild
>> make[3]: Nothing to be done for `svnonly'.
>> installing C headers
>> make[1]: `libRblas.dll.a' is up to date.
>> make[4]: Nothing to be done for `svnonly'.
>> installing C headers
>> make --no-print-directory -C ../extra/intl CFLAGS='-O3 -Wall -pedantic
>> -mtune=core2' -f Makefile.win
>> make --no-print-directory -C ../appl CFLAGS='-O3 -Wall -pedantic
>> -mtune=core2' FFLAGS='-O3 -mtune=core2' -f Makefile.win
>> make --no-print-directory -C ../nmath CFLAGS='-O3 -Wall -pedantic
>> -mtune=core2' FFLAGS='-O3 -mtune=core2' -f Makefile.win
>> make --no-print-directory -C ../main CFLAGS='-O3 -Wall -pedantic
>> -mtune=core2' FFLAGS='-O3 -mtune=core2' malloc-DEFS='-DLEA_MALLOC' -f
>> Makefile.win
>> make --no-print-directory -C ./getline CFLAGS='-O3 -Wall -pedantic -mtune=core2'
>>
>> make[3]: `gl.a' is up to date.
>> make -f Makefile.win makeMakedeps
>> make -f Makefile.win libpcre.a
>> make[4]: `libpcre.a' is up to date.
>> make[3]: Nothing to be done for `all'.
>> make -f Makefile.win makeMakedeps
>> make -f Makefile.win libtre.a
>> make[4]: `libtre.a' is up to date.
>> make[3]: Nothing to be done for `all'.
>> make[4]: `stamp' is up to date.
>> make[4]: `liblzma.a' is up to date.
>> make[2]: `R.dll' is up to date.
>> cp R.dll ../../bin/i386
>> -------- Building ../../../bin/i386/Rblas.dll --------
>> gcc -std=gnu99  -shared  -o ../../../bin/i386/Rblas.dll blas.o
>> cmplxblas.o ../../gnuwin32/dllversion.o Rblas.def -L../../../bin/i386
>> -lR -lgfortran
>> c:/rtools/gcc-4.6.3/bin/../lib/gcc/i686-w64-mingw32/4.6.3/../../../../i686-w64-mingw32/bin/ld.exe:
>> cannot find -lR
>> collect2: ld returned 1 exit status
>> make[2]: *** [../../../bin/i386/Rblas.dll] Error 1
>> make[1]: *** [Rblas] Error 2
>> make: *** [rbuild] Error 2
>>
>>
>> MORE TROUBLESHOOTING:
>> The MD5 checksum when it fails (reproducible):
>> C:\R\src\gnuwin32>md5sum ../../bin/i386/*.dll
>> 75b2e64d3847e768631681922df5a81d *../../bin/i386/R.dll
>> 12a35b63a28ad0e0fee8cae04f76e907 *../../bin/i386/Rgraphapp.dll
>> e2c40ae15d13dc17af33c1367f78817d *../../bin/i386/Riconv.dll
>> c5ea5a5cd2b7d3c07970f5314ce7296a *../../bin/i386/Rzlib.dll
>>
>> The MD5 checksum when it works (reproducible):
>> C:\R\src\gnuwin32>md5sum ../../bin/i386/*.dll
>> 75b2e64d3847e768631681922df5a81d *../../bin/i386/R.dll
>> 12a35b63a28ad0e0fee8cae04f76e907 *../../bin/i386/Rgraphapp.dll
>> e2c40ae15d13dc17af33c1367f78817d *../../bin/i386/Riconv.dll
>> c5ea5a5cd2b7d3c07970f5314ce7296a *../../bin/i386/Rzlib.dll
>> +
>> c81b3399027ec9c24ca80ba92199327c *../../bin/i386/Rblas.dll
>> 20d32cee2e561d1826af1a538844472b *../../bin/i386/Rlapack.dll
>>
>>
>> Thanks for any help,
>>
>> Henrik
>>
>>
>> SETUP:
>> 1. Downloaded/svn checkout the R source to C:\R\.
>> 2. Installed most recent Rtools to C:\Rtools (completely removed previously)
>> (3. Modifying the MkRules.* files has no impact for reproducing this
>> problem.  Same with 'make rsync-recommended')
>>
>> C:\R\src\gnuwin32>path
>> PATH=;C:\Rtools\bin;C:\Rtools\gcc-4.6.3\bin;C:\Windows;C:\Windows\system32
>>
>> C:\R\src\gnuwin32>cat C:\Rtools\VERSION.txt
>> Rtools version 3.1.0.1939
>>
>> C:\R\src\gnuwin32>ls ../..
>> COPYING      Makefile.fw  VERSION       configure.ac  po     tmp
>> ChangeLog    Makefile.in  VERSION-NICK  doc           share  tools
>> INSTALL      README       config.site   etc           src
>> Makeconf.in  Tcl          configure     m4            tests
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From pdalgd at gmail.com  Mon Jun 30 11:45:09 2014
From: pdalgd at gmail.com (peter dalgaard)
Date: Mon, 30 Jun 2014 11:45:09 +0200
Subject: [Rd] blas test problem
In-Reply-To: <53AD57A5.7020905@yahoo.co.uk>
References: <53AD57A5.7020905@yahoo.co.uk>
Message-ID: <B93CB00F-5B28-40D6-909D-8D69A35DFC7D@gmail.com>

It is not clear what you mean:

The quoted page lists particular AMD BLAS versions that fail R's regression test.

Other builds of R would run the regression test during building and you can run them yourself if you get the source code (for good measure, use the current version, not one from a 2011 web posting, i.e., fetch say https://svn.r-project.org/R/branches/R-3-1-branch/tests/reg-BLAS.R). 

E.g., for me

Peters-iMac:R pd$ ../BUILD/bin/R --vanilla < tests/reg-BLAS.R  
... normal output, no errors ...

There is some risk that binary builds of R on one machine will fail on another. If this happens, it could be quite serious, so developers would want to know. However "most...seem to fail" is not enough to act upon. What exactly did you do, on which computing platform, and what happened that makes you believe that it had failed?

-pd

On 27 Jun 2014, at 13:38 , lejeczek <peljasz at yahoo.co.uk> wrote:

> dear developers
> 
> I myself am not a prog-devel, I found this
> 
> http://devgurus.amd.com/message/1255852#1255852
> 
> Most R compilations/installations I use seem to fail this test, is this a problem and if yes then how serious is it?
> 
> regards
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From lawrence.michael at gene.com  Mon Jun 30 14:51:20 2014
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Mon, 30 Jun 2014 05:51:20 -0700
Subject: [Rd] R CMD check warning with S3 method
In-Reply-To: <53B06C45.30208@gmail.com>
References: <CAFOpNVGGT+tpdAZ42Q+jkWntAE+N=Ctq_D5pKbVVHx7F6_m0RQ@mail.gmail.com>
	<1403198095.17749.166.camel@braque.iarc.fr>
	<CAFOpNVF3Q2nN7jUpCvoqGh_Q0PEpMFgP7KQxrymQxHWUX86YvA@mail.gmail.com>
	<31E214B6DF75104E942856C2F74953CB0519C64C@exchange>
	<CAFOpNVGDzUUtGnWmX3dakGgsnRMG0q+cMFY7WYtWhM98dJrPqg@mail.gmail.com>
	<CANROs4fBWPkhPXKV+AkTXCXPx0aFkpt97u2yyboMMp8teeNvMw@mail.gmail.com>
	<CANROs4dB8Z2tS6s5dp2RK+T6Vt=4_M1KugAFqbh+VZhZybEwFw@mail.gmail.com>
	<CAOQ5NyfkV7D-kmCcuADQTkhs+fxGTbd6B9EZcM_y6jj-_4A7aw@mail.gmail.com>
	<53B06C45.30208@gmail.com>
Message-ID: <CAOQ5NydcoTxWRi1csjOXT7k2H58BqgtWE9CE6P1pBr+oGEEMxQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140630/2199c231/attachment.pl>

From murdoch.duncan at gmail.com  Mon Jun 30 15:19:20 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 30 Jun 2014 09:19:20 -0400
Subject: [Rd] R CMD check warning with S3 method
In-Reply-To: <CAOQ5NydcoTxWRi1csjOXT7k2H58BqgtWE9CE6P1pBr+oGEEMxQ@mail.gmail.com>
References: <CAFOpNVGGT+tpdAZ42Q+jkWntAE+N=Ctq_D5pKbVVHx7F6_m0RQ@mail.gmail.com>	<1403198095.17749.166.camel@braque.iarc.fr>	<CAFOpNVF3Q2nN7jUpCvoqGh_Q0PEpMFgP7KQxrymQxHWUX86YvA@mail.gmail.com>	<31E214B6DF75104E942856C2F74953CB0519C64C@exchange>	<CAFOpNVGDzUUtGnWmX3dakGgsnRMG0q+cMFY7WYtWhM98dJrPqg@mail.gmail.com>	<CANROs4fBWPkhPXKV+AkTXCXPx0aFkpt97u2yyboMMp8teeNvMw@mail.gmail.com>	<CANROs4dB8Z2tS6s5dp2RK+T6Vt=4_M1KugAFqbh+VZhZybEwFw@mail.gmail.com>	<CAOQ5NyfkV7D-kmCcuADQTkhs+fxGTbd6B9EZcM_y6jj-_4A7aw@mail.gmail.com>	<53B06C45.30208@gmail.com>
	<CAOQ5NydcoTxWRi1csjOXT7k2H58BqgtWE9CE6P1pBr+oGEEMxQ@mail.gmail.com>
Message-ID: <53B163D8.7070006@gmail.com>

On 30/06/2014 8:51 AM, Michael Lawrence wrote:
> I think it's generally nice to be able to compute on the network of 
> imported and exported symbols, and exportFrom() preserves the 
> information that a symbol has been forwarded. But let's focus on the 
> use case of documenting the symbol.
>
> First, from the user perspective: my understanding (without testing 
> anything) is that with promptImport(), the call to help() will find 
> two or more hits to the symbol, so the user has to choose from a menu 
> or otherwise qualify the package.

It depends how the user formulates it.  The usual ?foo will find at 
least two hits.  But if a user qualifies it by saying ?pkg::foo,
they'll just get the redirect page.

I think we need ?pkg::foo to do something, and this seemed easier than 
inventing an invisible redirect.

> Choosing the man page for the re-exported symbol will bring up a page 
> that just requests them to make an extra click. This seems like extra 
> work for the user. One potential benefit is that the user will know 
> that a re-export has occurred, but does the user care? Why not proceed 
> directly to the actual documentation? The majority of users have no or 
> little knowledge of namespaces.

I think some users would like to know that pkg::foo is identical to 
original::foo, so if we had the invisible redirect, I think the target 
page should be modified to say "redirected from ...", just so the users 
were sure they had come to the right place.
>
> From the developer perspective, promptImport() means that there is 
> another man page to worry about, while exportFrom() would make it 
> clear to developers reading the NAMESPACE that symbols are being 
> simply forwarded, rather than re-defined.

Those are both benefits of your approach, which I wouldn't object to if 
you go ahead and do it subject to the qualifications above, and one 
other.  How should existing redirects be handled?  If a package imports 
and re-exports a symbol without change, should the author be 
encouraged/required to use exportFrom?  If we do nothing, most people 
will just do what they're currently doing, so maybe some sort of nag 
should be added.  Package writers won't like that unless there's some 
obvious benefit to the change.

Duncan

>
> Michael
>
>
> On Sun, Jun 29, 2014 at 12:43 PM, Duncan Murdoch 
> <murdoch.duncan at gmail.com <mailto:murdoch.duncan at gmail.com>> wrote:
>
>     On 29/06/2014, 3:07 PM, Michael Lawrence wrote:
>     > While the change to the symbol lookup is generally useful (e.g., for
>     > finding S4 methods that become available whenever a package is
>     loaded),
>     > it seems that we ultimately want a mechanism by which a package
>     > namespace can formally declare that it is re-exporting a symbol from
>     > some package. Then, for example, the check mechanism can be made
>     smart
>     > enough to avoid throwing such warnings.
>     >
>     > I've developed a proof-of-concept exportFrom() namespace
>     directive. This
>     > is the syntax:
>     >
>     > exportFrom(utils, help)
>     >
>     > Then:
>     >
>     >> getNamespaceInfo("ReexportingPackage", "exports")$help
>     > [1] "help"
>     > attr(,"origin")
>     > [1] "utils"
>     >
>     > Comments?
>
>     I don't see why this is needed.  What does it gain over
>     documenting that
>     the symbol "help" is just a copy of the one from utils?  As of this
>     morning, that's easy...
>
>     Duncan Murdoch
>
>     >
>     > Michael
>     >
>     >
>     > On Fri, Jun 27, 2014 at 8:32 PM, Yihui Xie <xie at yihui.name
>     <mailto:xie at yihui.name>
>     > <mailto:xie at yihui.name <mailto:xie at yihui.name>>> wrote:
>     >
>     >     Hi Duncan,
>     >
>     >     Again, thanks a lot for making this change (help requests
>     are tried
>     >     over all loaded instead of attached packages):
>     > https://github.com/wch/r-source/commit/21d2f7430b4 This makes what I
>     >     proposed last time possible now: if pkg B imports FUN from A and
>     >     re-exports it, ?FUN will work after B is attached because A
>     will also
>     >     be at least attached.
>     >
>     >     Then it will be perfect if `R CMD check` can stop warning
>     against the
>     >     missing documentation, which is not really missing.
>     >
>     >     Regards,
>     >     Yihui
>     >     --
>     >     Yihui Xie <xieyihui at gmail.com <mailto:xieyihui at gmail.com>
>     <mailto:xieyihui at gmail.com <mailto:xieyihui at gmail.com>>>
>     >     Web: http://yihui.name
>     >
>     >
>     >     On Fri, Jun 20, 2014 at 1:34 AM, Yihui Xie <xie at yihui.name
>     <mailto:xie at yihui.name>
>     >     <mailto:xie at yihui.name <mailto:xie at yihui.name>>> wrote:
>     >     > but note that you will have to document it even if it is a
>     function
>     >     > imported from another package... Perhaps help() should be
>     intelligent
>     >     > enough to link the documentation of `FUN` from package A
>     for package B
>     >     > when B imports `FUN` from A, and exports it in B's
>     NAMESPACE. The
>     >     > package name of A may be obtained from
>     >     > environmentName(environment(FUN)). At the moment, since R
>     CMD check
>     >     > will warn against the missing documentation of `FUN` in B,
>     I have to
>     >     > copy FUN.Rd from A to B in this case, which seems to be
>     inefficient
>     >     > and not a best way to maintain. Did I miss anything in the
>     R-exts
>     >     > manual?
>     >     >
>     >     > Regards,
>     >     > Yihui
>     >     > --
>     >     > Yihui Xie <xieyihui at gmail.com <mailto:xieyihui at gmail.com>
>     <mailto:xieyihui at gmail.com <mailto:xieyihui at gmail.com>>>
>     >     > Web: http://yihui.name
>     >     >
>     >     >
>     >     > On Fri, Jun 20, 2014 at 12:19 AM, Winston Chang
>     >     <winstonchang1 at gmail.com <mailto:winstonchang1 at gmail.com>
>     <mailto:winstonchang1 at gmail.com <mailto:winstonchang1 at gmail.com>>>
>     wrote:
>     >     >> On Thu, Jun 19, 2014 at 3:15 PM, Martyn Plummer
>     <plummerm at iarc.fr <mailto:plummerm at iarc.fr>
>     >     <mailto:plummerm at iarc.fr <mailto:plummerm at iarc.fr>>> wrote:
>     >     >>
>     >     >>>  Export filter in the NAMESPACE file *without copying
>     it* in the
>     >     R source
>     >     >>> code.
>     >     >>>
>     >     >>>
>     >     >> Ah, it works! Thank you!
>     >     >>
>     >
>     >     ______________________________________________
>     > R-devel at r-project.org <mailto:R-devel at r-project.org>
>     <mailto:R-devel at r-project.org <mailto:R-devel at r-project.org>>
>     mailing list
>     > https://stat.ethz.ch/mailman/listinfo/r-devel
>     >
>     >
>
>


From nalimilan at club.fr  Mon Jun 30 20:41:18 2014
From: nalimilan at club.fr (Milan Bouchet-Valat)
Date: Mon, 30 Jun 2014 20:41:18 +0200
Subject: [Rd] Building R on Windows: mkdir of Rtools creates directories
 with read-only permissions [WEIRD]
In-Reply-To: <53B12C98.2000007@gmail.com>
References: <1404117853.25972.8.camel@milan.mobile.lan>
	<53B12C98.2000007@gmail.com>
Message-ID: <1404153678.32183.41.camel@milan.mobile.lan>

Le lundi 30 juin 2014 ? 05:23 -0400, Duncan Murdoch a ?crit :
> On 30/06/2014, 4:44 AM, Milan Bouchet-Valat wrote:
> > On Thu Jan 9 2014 03:47 Henrik Bengtsson wrote:
> >> This is is an issue that bugged me for a while.  I encountered a year
> >> ago (April 2012) when I first tried to build R from source on Windows.
> >>  I never figured out what the solution is or if I'm doing something
> >> wrong myself (but I have found a tedious workaround).  I'm still on
> >> the same Windows 7 Ultimate machine with NTFS, but I now made sure I
> >> started from scratch so I have a completely fresh setup (see details
> >> at the end).
> >>
> >> PROBLEM:
> >> At the very first step I do:
> >>
> >> C:\R\src\gnuwin32>make all
> >> [... Waiting. No errors until ...]
> >> cp R.dll ../../bin/i386
> >> -------- Building ../../../bin/i386/Rblas.dll --------
> >> gcc -std=gnu99  -shared  -o ../../../bin/i386/Rblas.dll blas.o
> >> cmplxblas.o ../../gnuwin32/dllversion.o Rblas.def -L../../../bin/i386
> >> -lR -lgfortran
> >> c:/rtools/gcc-4.6.3/bin/../lib/gcc/i686-w64-mingw32/4.6.3/../../../../i686-w64-mingw32/bin/ld.exe:
> >> cannot find -lR
> >> collect2: ld returned 1 exit status
> >> make[2]: *** [../../../bin/i386/Rblas.dll] Error 1
> >> make[1]: *** [Rblas] Error 2
> >> make: *** [rbuild] Error 2
> >>
> >> However:
> >>
> >> C:\R\src\gnuwin32>dir ..\..\bin\i386\
> >>  Volume in drive C is Windows7_OS
> >>  Volume Serial Number is E038-51CC
> >>
> >>  Directory of C:\R\bin\i386
> >>
> >> 01/08/2014  06:18 PM    <DIR>          .
> >> 01/08/2014  06:18 PM    <DIR>          ..
> >> 01/08/2014  06:18 PM         3,059,712 R.dll
> >> 01/08/2014  06:18 PM           348,995 Rgraphapp.dll
> >> 01/08/2014  06:18 PM           102,975 Riconv.dll
> >> 01/08/2014  06:18 PM           154,917 Rzlib.dll
> >>                4 File(s)      3,666,599 bytes
> >>                2 Dir(s)  22,424,739,840 bytes free
> >>
> >> What's weird is that these files have **read permission disabled**:
> >>
> >> C:\R\src\gnuwin32>file ..\..\bin\i386\*.dll
> >> ..\..\bin\i386\R.dll:         writable, executable, regular file, no
> >> read permission
> >> ..\..\bin\i386\Rgraphapp.dll: writable, executable, regular file, no
> >> read permission
> >> ..\..\bin\i386\Riconv.dll:    writable, executable, regular file, no
> >> read permission
> >> ..\..\bin\i386\Rzlib.dll:     writable, executable, regular file, no
> >> read permission
> >>
> >> What is going on?  Have anyone else seen this?  I've also tried
> >> running as Administrator - no difference.
> > Hi Henrik,
> > 
> > Old thread, but I think I'm experiencing exactly the same problem. I
> > tried running as administrator and as a normal user, and no luck. I
> > noticed, though, that resetting permissions on the build tree makes the
> > error go away, and replaces it with another one stating that headers in
> > include/ could not be created due to permission issues.
> > 
> > This is on a machine where I was able to build R 3.0.1 successfully,
> > though I also remember having permission issues I eventually fixed by
> > resetting permissions on the build tree. Not sure what's changed since
> > then...
> > 
> > To add bit of information to the debugging you've already done: I
> > noticed that when opening the directory/file property dialog, a user
> > with a very long name including letters and numbers appears in the
> > permissions list for a second, and then disappears. This user reappears
> > every time I run 'make'. So maybe 'mkdir' or other tools use wrong user
> > IDs, creating bogus users. Just a guess.
> > 
> > Have you found a solution or workaround since January? I really need to
> > build an R installer and I seem to be stuck...
> 
> I have seen this, but I don't see it on every machine.  One one where I
> do see it is the Windows builder machine in Dortmund.  The following is
> inserted into the script after building the 32 bit build
> 
> cacls %name32% /T /E /G VORDEFINIERT\Benutzer:R > NUL
> 
> and similar after the 64 bit build.  (I don't remember whether
> VORDEFINIERT\Benutzer is the current user name, or is some generic thing
> saying "current user".  I think Uwe Ligges came up with this...)
Thanks. VORDEFINIERT\Benutzer appears to mean BUILTIN\Users (BUILTIN
\Utilisateurs in French), and refers to any user on the system (more or
less).

Unfortunately, I've run that, and it doesn't make any difference to the
error I'm seeing. But I don't understand what you mean by "after
building the 32 bit build" since the problem is precisely that this step
does not complete successfully.

Here is what I get:

Microsoft Windows [version 6.1.7600]
Copyright (c) 2009 Microsoft Corporation. Tous droits r?serv?s.

C:\Windows\system32>cd C:\Rbuild\R-3.1.0-32bit

C:\Rbuild\R-3.1.0-32bit>cacls %name32% /T /E /G BUILTIN\UTILISATEURS:R > NUL

C:\Rbuild\R-3.1.0-32bit>cacls %name32% /T /E /G BUILTIN\UTILISATEURS:W > NUL

C:\Rbuild\R-3.1.0-32bit>cd src/gnuwin32

C:\Rbuild\R-3.1.0-32bit\src\gnuwin32>set TMPDIR=C:\Rbuild\tmp

C:\Rbuild\R-3.1.0-32bit\src\gnuwin32>make -j4 all
make[1]: warning: jobserver unavailable: using -j1.  Add `+' to parent make rule
.
make[1]: `MkRules' is up to date.
make[1]: warning: jobserver unavailable: using -j1.  Add `+' to parent make rule
.
make[4]: Nothing to be done for `svnonly'.
installing C headers
make[2]: Nothing to be done for `all'.
make[2]: `libRblas.dll.a' is up to date.
make[5]: Nothing to be done for `svnonly'.
installing C headers
make --no-print-directory -C ../extra/intl CFLAGS='-O3 -Wall -pedantic -mtune=core2' -f Makefile.win
make --no-print-directory -C ../appl CFLAGS='-O3 -Wall -pedantic -mtune=core2' FFLAGS='-O3 -mtune=core2' -f Makefile.win
make --no-print-directory -C ../nmath CFLAGS='-O3 -Wall -pedantic -mtune=core2'
FFLAGS='-O3 -mtune=core2' -f Makefile.win
make --no-print-directory -C ../main CFLAGS='-O3 -Wall -pedantic -mtune=core2' FFLAGS='-O3 -mtune=core2' malloc-DEFS='-DLEA_MALLOC' -f Makefile.win
gcc -std=gnu99 -m32 -I. -I../include -DHAVE_CONFIG_H -DR_DLL_BUILD -DR_ARCH='"i386"' -I../extra/xdr -O3 -Wall -pedantic -mtune=core2   -c serialize.c -o serialize.o
In file included from serialize.c:28:0:
../include/Defn.h:1244:21: fatal error: ../include/libintl.h: Permission denied
compilation terminated.
make[4]: *** [serialize.o] Error 1
make[3]: *** [rlibs] Error 2
make[2]: *** [../../bin/i386/R.dll] Error 2
make[1]: *** [rbuild] Error 2
make: *** [all] Error 2

C:\Rbuild\R-3.1.0-32bit\src\gnuwin32>ls ../include/libintl.h -l
---------- 1 Milan mkpasswd 14384 Jun 29 20:15 ../include/libintl.h

I see this weird permission pattern for most of the files in the build
tree. Running
cacls %name32% /T /E /G BUILTIN\UTILISATEURS:R > NUL
does not have any effect on the output of 'ls -l'.


Regards

> Duncan Murdoch
> 
> > 
> > Thanks for your help
> > 
> > 
> >> TROUBLESHOOTING / WORKAROUND:
> >> It appears that 'mkdir' (of Rtools) causes this problem, because if I
> >> manually pre-create 'C:\R\src\gnuwin32\bin\i386' using Windows' mkdir
> >> it works, e.g.
> >>
> >> C:\R\src\gnuwin32>rm -fR ..\..\bin\
> >> C:\R\src\gnuwin32>cmd /C mkdir ..\..\bin\i386
> >> C:\R\src\gnuwin32>make rbuild
> >> [...]
> >> -------- Building ../../../bin/i386/Rblas.dll --------
> >> gcc -std=gnu99  -shared  -o ../../../bin/i386/Rblas.dll blas.o
> >> cmplxblas.o ../../gnuwin32/dllversion.o Rblas.def -L../../../bin/i386
> >> -lR -lgfortran
> >> make --no-print-directory -C front-ends
> >> mkdir -p ../../../bin/i386
> >> cp Rgui.exe ../../../bin/i386/Rgui.exe
> >> mkdir -p ../../../bin/i386
> >> cp Rterm.exe ../../../bin/i386/Rterm.exe
> >> mkdir -p ../../../bin/i386
> >> cp Rcmd.exe ../../../bin/i386/Rcmd.exe
> >> mkdir -p ../../../bin/i386
> >> cp RSetReg.exe ../../../bin/i386/RSetReg.exe
> >> mkdir -p ../../../bin/i386
> >> cp R.exe ../../../bin/i386/R.exe
> >> mkdir -p ../../../bin/i386
> >> cp Rscript.exe ../../../bin/i386/Rscript.exe
> >> mkdir -p ../../../bin/i386
> >> cp open.exe ../../../bin/i386/open.exe
> >> mkdir -p ../../../bin
> >> cp Rfe.exe ../../../bin/R.exe
> >> mkdir -p ../../../bin
> >> cp Rfe.exe ../../../bin/Rscript.exe
> >> make[1]: `COPYRIGHTS' is up to date.
> >> make --no-print-directory -C ../modules -f Makefile.win \
> >>   CFLAGS='-O3 -Wall -pedantic -mtune=core2' FFLAGS='-O3 -mtune=core2'
> >> gcc -std=gnu99  -shared -s -o ../../../bin/i386/Rlapack.dll dlamch.o
> >> dlapack.o cmplx.o init_win.o Rlapackrc.o -L../../../bin/i386 -lR
> >> -lRblas -lgfortran
> >> cp lapack.dll ../../../modules/i386/lapack.dll
> >>
> >> and there is (obviously) read permissions on those files:
> >>
> >> C:\R\src\gnuwin32>file ..\..\bin\i386\*.dll
> >> ..\..\bin\i386\R.dll:         PE32 executable for MS Windows (DLL)
> >> (GUI) Intel 80386 32-bit
> >> ..\..\bin\i386\Rblas.dll:     PE32 executable for MS Windows (DLL)
> >> (console) Intel 80386 32-bit
> >> ..\..\bin\i386\Rgraphapp.dll: PE32 executable for MS Windows (DLL)
> >> (GUI) Intel 80386 32-bit
> >> ..\..\bin\i386\Riconv.dll:    PE32 executable for MS Windows (DLL)
> >> (console) Intel 80386 32-bit
> >> ..\..\bin\i386\Rlapack.dll:   PE32 executable for MS Windows (DLL)
> >> (console) Intel 80386 32-bit
> >> ..\..\bin\i386\Rzlib.dll:     PE32 executable for MS Windows (DLL)
> >> (console) Intel 80386 32-bit
> >>
> >> Pre-creating the proper directories is tedious and only works up to
> >> the point of 'make distribution', where I haven't found a similar
> >> workaround (without modifying the Makefiles).  Note, I can get to the
> >> point where I have build and check everything (including recommended
> >> packages).
> >>
> >>
> >> Just to convince you that mkdir is the problem, I can reproduce the
> >> problem from this point, by removing the bin/ directory again and
> >> relying on Rtools mkdir again;
> >>
> >> C:\R\src\gnuwin32>rm -fR ..\..\bin
> >> C:\R\src\gnuwin32>make rbuild
> >> make[3]: Nothing to be done for `svnonly'.
> >> installing C headers
> >> make[1]: `libRblas.dll.a' is up to date.
> >> make[4]: Nothing to be done for `svnonly'.
> >> installing C headers
> >> make --no-print-directory -C ../extra/intl CFLAGS='-O3 -Wall -pedantic
> >> -mtune=core2' -f Makefile.win
> >> make --no-print-directory -C ../appl CFLAGS='-O3 -Wall -pedantic
> >> -mtune=core2' FFLAGS='-O3 -mtune=core2' -f Makefile.win
> >> make --no-print-directory -C ../nmath CFLAGS='-O3 -Wall -pedantic
> >> -mtune=core2' FFLAGS='-O3 -mtune=core2' -f Makefile.win
> >> make --no-print-directory -C ../main CFLAGS='-O3 -Wall -pedantic
> >> -mtune=core2' FFLAGS='-O3 -mtune=core2' malloc-DEFS='-DLEA_MALLOC' -f
> >> Makefile.win
> >> make --no-print-directory -C ./getline CFLAGS='-O3 -Wall -pedantic -mtune=core2'
> >>
> >> make[3]: `gl.a' is up to date.
> >> make -f Makefile.win makeMakedeps
> >> make -f Makefile.win libpcre.a
> >> make[4]: `libpcre.a' is up to date.
> >> make[3]: Nothing to be done for `all'.
> >> make -f Makefile.win makeMakedeps
> >> make -f Makefile.win libtre.a
> >> make[4]: `libtre.a' is up to date.
> >> make[3]: Nothing to be done for `all'.
> >> make[4]: `stamp' is up to date.
> >> make[4]: `liblzma.a' is up to date.
> >> make[2]: `R.dll' is up to date.
> >> cp R.dll ../../bin/i386
> >> -------- Building ../../../bin/i386/Rblas.dll --------
> >> gcc -std=gnu99  -shared  -o ../../../bin/i386/Rblas.dll blas.o
> >> cmplxblas.o ../../gnuwin32/dllversion.o Rblas.def -L../../../bin/i386
> >> -lR -lgfortran
> >> c:/rtools/gcc-4.6.3/bin/../lib/gcc/i686-w64-mingw32/4.6.3/../../../../i686-w64-mingw32/bin/ld.exe:
> >> cannot find -lR
> >> collect2: ld returned 1 exit status
> >> make[2]: *** [../../../bin/i386/Rblas.dll] Error 1
> >> make[1]: *** [Rblas] Error 2
> >> make: *** [rbuild] Error 2
> >>
> >>
> >> MORE TROUBLESHOOTING:
> >> The MD5 checksum when it fails (reproducible):
> >> C:\R\src\gnuwin32>md5sum ../../bin/i386/*.dll
> >> 75b2e64d3847e768631681922df5a81d *../../bin/i386/R.dll
> >> 12a35b63a28ad0e0fee8cae04f76e907 *../../bin/i386/Rgraphapp.dll
> >> e2c40ae15d13dc17af33c1367f78817d *../../bin/i386/Riconv.dll
> >> c5ea5a5cd2b7d3c07970f5314ce7296a *../../bin/i386/Rzlib.dll
> >>
> >> The MD5 checksum when it works (reproducible):
> >> C:\R\src\gnuwin32>md5sum ../../bin/i386/*.dll
> >> 75b2e64d3847e768631681922df5a81d *../../bin/i386/R.dll
> >> 12a35b63a28ad0e0fee8cae04f76e907 *../../bin/i386/Rgraphapp.dll
> >> e2c40ae15d13dc17af33c1367f78817d *../../bin/i386/Riconv.dll
> >> c5ea5a5cd2b7d3c07970f5314ce7296a *../../bin/i386/Rzlib.dll
> >> +
> >> c81b3399027ec9c24ca80ba92199327c *../../bin/i386/Rblas.dll
> >> 20d32cee2e561d1826af1a538844472b *../../bin/i386/Rlapack.dll
> >>
> >>
> >> Thanks for any help,
> >>
> >> Henrik
> >>
> >>
> >> SETUP:
> >> 1. Downloaded/svn checkout the R source to C:\R\.
> >> 2. Installed most recent Rtools to C:\Rtools (completely removed previously)
> >> (3. Modifying the MkRules.* files has no impact for reproducing this
> >> problem.  Same with 'make rsync-recommended')
> >>
> >> C:\R\src\gnuwin32>path
> >> PATH=;C:\Rtools\bin;C:\Rtools\gcc-4.6.3\bin;C:\Windows;C:\Windows\system32
> >>
> >> C:\R\src\gnuwin32>cat C:\Rtools\VERSION.txt
> >> Rtools version 3.1.0.1939
> >>
> >> C:\R\src\gnuwin32>ls ../..
> >> COPYING      Makefile.fw  VERSION       configure.ac  po     tmp
> >> ChangeLog    Makefile.in  VERSION-NICK  doc           share  tools
> >> INSTALL      README       config.site   etc           src
> >> Makeconf.in  Tcl          configure     m4            tests
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >


