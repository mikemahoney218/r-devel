From ligges at statistik.uni-dortmund.de  Tue Jan  1 16:51:33 2008
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Tue, 01 Jan 2008 16:51:33 +0100
Subject: [Rd] readBin differences on Windows and Linux/mac
In-Reply-To: <264855a00712311151w7a43dbeara85e6abb0e6cec22@mail.gmail.com>
References: <264855a00712310958o42483fa6g27e0111ed6d01b16@mail.gmail.com>	
	<477933F0.6080205@statistik.uni-dortmund.de>
	<264855a00712311151w7a43dbeara85e6abb0e6cec22@mail.gmail.com>
Message-ID: <477A6185.6050007@statistik.uni-dortmund.de>

I see. It is either a bug or something related to the following 
paragraph from ?seek:

      We have found so many errors in the Windows implementation of file
      positioning that users are advised to use it only at their own
      risk, and asked not to waste the R developers' time with bug
      reports on Windows' deficiencies.

I will investigate more closely when I am back in office end of this week.

Best,
Uwe




Sean Davis wrote:
> Sorry, Uwe.  Of course:
> 
> Both in relatively recent R-devel (one mac, one windows):
> 
> ### gunzip pulled from R.utils to be a simple function
> ### In R.utils, implemented as a method
> gunzip <- function(filename, destname=gsub("[.]gz$", "", filename), 
> overwrite=FALSE, remove=TRUE, BFR.SIZE=1e7) {
>   if (filename == destname)
>     stop(sprintf("Argument 'filename' and 'destname' are identical: %s", 
> filename));
>   if (!overwrite && file.exists(destname))
>     stop(sprintf("File already exists: %s", destname));
> 
>   inn <- gzfile(filename, "rb");
>   on.exit(if (!is.null(inn)) close(inn));
> 
>   out <- file(destname, "wb");
>   on.exit(close(out), add=TRUE);
> 
>   nbytes <- 0;
>   repeat {
>     bfr <- readBin(inn, what=raw(0), size=1, n=BFR.SIZE);
>     n <- length(bfr);
>     if (n == 0)
>       break;
>     nbytes <- nbytes + n;
>     writeBin(bfr, con=out, size=1);
>   };
> 
>   if (remove) {
>     close(inn);
>     inn <- NULL;
>     file.remove(filename);
>   }
>    
>   invisible(nbytes);
> }
> download.file(' 
> ftp://ftp.ncbi.nih.gov/pub/geo/DATA/SeriesMatrix/GSE1/GSE1_series_matrix.txt.gz','test.txt.gz' 
> <ftp://ftp.ncbi.nih.gov/pub/geo/DATA/SeriesMatrix/GSE1/GSE1_series_matrix.txt.gz','test.txt.gz'>)
> gunzip('test.txt.gz')
> 
> Under windows, this results in the error reported below.  Under mac and 
> linux, results in test.txt being created in the current working 
> directory.  The actual gunzip function is pretty bare bones, so I don't 
> think it complicates matters much to use it in this example. 
> 
> Sean
> 
> 
> On Dec 31, 2007 1:24 PM, Uwe Ligges <ligges at statistik.uni-dortmund.de 
> <mailto:ligges at statistik.uni-dortmund.de>> wrote:
> 
>     Can you give a reproducible example, pelase?
> 
>     Uwe Ligges
> 
> 
>     Sean Davis wrote:
>      > I have been trying to use the gunzip function in the R.utils
>     package.  It
>      > opens a connection to a gzfile, uses readBin to read from that
>     connection,
>      > and then uses writeBin to write out the raw data to a new file.
>      This works
>      > as expected under linux/mac, but under Windows, I get:
>      >
>      > Error in readBin(inn, what= raw(0), size = 1, n=BFR.SIZE)  :
>      >   negative length vectors are not allowed
>      >
>      > A simple traceback shows the error in readBin.  I wouldn't be
>     surprised if
>      > this is a programming issue not located in readBin, but I am
>     confused about
>      > the difference in behaviors on Windows versus mac/linux.  Any
>     insight into
>      > what I can do to remedy the issue and have a cross-platform gunzip()?
>      >
>      > Thanks,
>      > Sean
>      >
>      >       [[alternative HTML version deleted]]
>      >
>      > ______________________________________________
>      > R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>      > https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From hb at stat.berkeley.edu  Tue Jan  1 17:10:46 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Tue, 1 Jan 2008 17:10:46 +0100
Subject: [Rd] readBin differences on Windows and Linux/mac
In-Reply-To: <477A6185.6050007@statistik.uni-dortmund.de>
References: <264855a00712310958o42483fa6g27e0111ed6d01b16@mail.gmail.com>
	<477933F0.6080205@statistik.uni-dortmund.de>
	<264855a00712311151w7a43dbeara85e6abb0e6cec22@mail.gmail.com>
	<477A6185.6050007@statistik.uni-dortmund.de>
Message-ID: <59d7961d0801010810l3a2a346aja02429552e45464c@mail.gmail.com>

Also make sure the problem is not due to downloading a gzip file in
text mode, because to the best of my understanding that is platform
dependent.  That is, use download.file(..., mode="wb") instead of the
default, which is mode="w".  (This is such a common error that I would
like to suggest mode="wb" to become the default.)

/Henrik

On 01/01/2008, Uwe Ligges <ligges at statistik.uni-dortmund.de> wrote:
> I see. It is either a bug or something related to the following
> paragraph from ?seek:
>
>       We have found so many errors in the Windows implementation of file
>       positioning that users are advised to use it only at their own
>       risk, and asked not to waste the R developers' time with bug
>       reports on Windows' deficiencies.
>
> I will investigate more closely when I am back in office end of this week.
>
> Best,
> Uwe
>
>
>
>
> Sean Davis wrote:
> > Sorry, Uwe.  Of course:
> >
> > Both in relatively recent R-devel (one mac, one windows):
> >
> > ### gunzip pulled from R.utils to be a simple function
> > ### In R.utils, implemented as a method
> > gunzip <- function(filename, destname=gsub("[.]gz$", "", filename),
> > overwrite=FALSE, remove=TRUE, BFR.SIZE=1e7) {
> >   if (filename == destname)
> >     stop(sprintf("Argument 'filename' and 'destname' are identical: %s",
> > filename));
> >   if (!overwrite && file.exists(destname))
> >     stop(sprintf("File already exists: %s", destname));
> >
> >   inn <- gzfile(filename, "rb");
> >   on.exit(if (!is.null(inn)) close(inn));
> >
> >   out <- file(destname, "wb");
> >   on.exit(close(out), add=TRUE);
> >
> >   nbytes <- 0;
> >   repeat {
> >     bfr <- readBin(inn, what=raw(0), size=1, n=BFR.SIZE);
> >     n <- length(bfr);
> >     if (n == 0)
> >       break;
> >     nbytes <- nbytes + n;
> >     writeBin(bfr, con=out, size=1);
> >   };
> >
> >   if (remove) {
> >     close(inn);
> >     inn <- NULL;
> >     file.remove(filename);
> >   }
> >
> >   invisible(nbytes);
> > }
> > download.file('
> > ftp://ftp.ncbi.nih.gov/pub/geo/DATA/SeriesMatrix/GSE1/GSE1_series_matrix.txt.gz','test.txt.gz'
> > <ftp://ftp.ncbi.nih.gov/pub/geo/DATA/SeriesMatrix/GSE1/GSE1_series_matrix.txt.gz','test.txt.gz'>)
> > gunzip('test.txt.gz')
> >
> > Under windows, this results in the error reported below.  Under mac and
> > linux, results in test.txt being created in the current working
> > directory.  The actual gunzip function is pretty bare bones, so I don't
> > think it complicates matters much to use it in this example.
> >
> > Sean
> >
> >
> > On Dec 31, 2007 1:24 PM, Uwe Ligges <ligges at statistik.uni-dortmund.de
> > <mailto:ligges at statistik.uni-dortmund.de>> wrote:
> >
> >     Can you give a reproducible example, pelase?
> >
> >     Uwe Ligges
> >
> >
> >     Sean Davis wrote:
> >      > I have been trying to use the gunzip function in the R.utils
> >     package.  It
> >      > opens a connection to a gzfile, uses readBin to read from that
> >     connection,
> >      > and then uses writeBin to write out the raw data to a new file.
> >      This works
> >      > as expected under linux/mac, but under Windows, I get:
> >      >
> >      > Error in readBin(inn, what= raw(0), size = 1, n=BFR.SIZE)  :
> >      >   negative length vectors are not allowed
> >      >
> >      > A simple traceback shows the error in readBin.  I wouldn't be
> >     surprised if
> >      > this is a programming issue not located in readBin, but I am
> >     confused about
> >      > the difference in behaviors on Windows versus mac/linux.  Any
> >     insight into
> >      > what I can do to remedy the issue and have a cross-platform gunzip()?
> >      >
> >      > Thanks,
> >      > Sean
> >      >
> >      >       [[alternative HTML version deleted]]
> >      >
> >      > ______________________________________________
> >      > R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
> >      > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From hb at stat.berkeley.edu  Tue Jan  1 17:20:28 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Tue, 1 Jan 2008 17:20:28 +0100
Subject: [Rd] readBin differences on Windows and Linux/mac
In-Reply-To: <59d7961d0801010810l3a2a346aja02429552e45464c@mail.gmail.com>
References: <264855a00712310958o42483fa6g27e0111ed6d01b16@mail.gmail.com>
	<477933F0.6080205@statistik.uni-dortmund.de>
	<264855a00712311151w7a43dbeara85e6abb0e6cec22@mail.gmail.com>
	<477A6185.6050007@statistik.uni-dortmund.de>
	<59d7961d0801010810l3a2a346aja02429552e45464c@mail.gmail.com>
Message-ID: <59d7961d0801010820u40da9caetdcf66dff6dc5d514@mail.gmail.com>

On 01/01/2008, Henrik Bengtsson <hb at stat.berkeley.edu> wrote:
> Also make sure the problem is not due to downloading a gzip file in
> text mode, because to the best of my understanding that is platform
> dependent.  That is, use download.file(..., mode="wb") instead of the
> default, which is mode="w".  (This is such a common error that I would
> like to suggest mode="wb" to become the default.)

Ok, that solves the problem with your example file.   On WinXP/R v2.6.1:

> library(R.utils)
> uri <- "ftp://ftp.ncbi.nih.gov/pub/geo/DATA/SeriesMatrix/GSE1/GSE1_series_matrix.txt.gz"

> download.file(uri, "test.txt.gz")  # mode="w"
trying URL 'ftp://ftp.ncbi.nih.gov/pub/geo/DATA/SeriesMatrix/GSE1/GSE1_series_ma
trix.txt.gz'
ftp data connection made, file length 918804 bytes
opened URL
downloaded 897 Kb
> file.info("test.txt.gz")$size
[1] 922243

> download.file(uri, "test2.txt.gz")
ftp data connection made, file length 918804 bytes
opened URL
downloaded 897 Kb
> file.info("test2.txt.gz")$size
[1] 918804

> gunzip("test.txt.gz")
Error in readBin(inn, what = raw(0), size = 1, n = BFR.SIZE) :
  negative length vectors are not allowed
> gunzip("test2.txt.gz")
> file.info("test2.txt")$size
[1] 3338362

/H

>
> /Henrik
>
> On 01/01/2008, Uwe Ligges <ligges at statistik.uni-dortmund.de> wrote:
> > I see. It is either a bug or something related to the following
> > paragraph from ?seek:
> >
> >       We have found so many errors in the Windows implementation of file
> >       positioning that users are advised to use it only at their own
> >       risk, and asked not to waste the R developers' time with bug
> >       reports on Windows' deficiencies.
> >
> > I will investigate more closely when I am back in office end of this week.
> >
> > Best,
> > Uwe
> >
> >
> >
> >
> > Sean Davis wrote:
> > > Sorry, Uwe.  Of course:
> > >
> > > Both in relatively recent R-devel (one mac, one windows):
> > >
> > > ### gunzip pulled from R.utils to be a simple function
> > > ### In R.utils, implemented as a method
> > > gunzip <- function(filename, destname=gsub("[.]gz$", "", filename),
> > > overwrite=FALSE, remove=TRUE, BFR.SIZE=1e7) {
> > >   if (filename == destname)
> > >     stop(sprintf("Argument 'filename' and 'destname' are identical: %s",
> > > filename));
> > >   if (!overwrite && file.exists(destname))
> > >     stop(sprintf("File already exists: %s", destname));
> > >
> > >   inn <- gzfile(filename, "rb");
> > >   on.exit(if (!is.null(inn)) close(inn));
> > >
> > >   out <- file(destname, "wb");
> > >   on.exit(close(out), add=TRUE);
> > >
> > >   nbytes <- 0;
> > >   repeat {
> > >     bfr <- readBin(inn, what=raw(0), size=1, n=BFR.SIZE);
> > >     n <- length(bfr);
> > >     if (n == 0)
> > >       break;
> > >     nbytes <- nbytes + n;
> > >     writeBin(bfr, con=out, size=1);
> > >   };
> > >
> > >   if (remove) {
> > >     close(inn);
> > >     inn <- NULL;
> > >     file.remove(filename);
> > >   }
> > >
> > >   invisible(nbytes);
> > > }
> > > download.file('
> > > ftp://ftp.ncbi.nih.gov/pub/geo/DATA/SeriesMatrix/GSE1/GSE1_series_matrix.txt.gz','test.txt.gz'
> > > <ftp://ftp.ncbi.nih.gov/pub/geo/DATA/SeriesMatrix/GSE1/GSE1_series_matrix.txt.gz','test.txt.gz'>)
> > > gunzip('test.txt.gz')
> > >
> > > Under windows, this results in the error reported below.  Under mac and
> > > linux, results in test.txt being created in the current working
> > > directory.  The actual gunzip function is pretty bare bones, so I don't
> > > think it complicates matters much to use it in this example.
> > >
> > > Sean
> > >
> > >
> > > On Dec 31, 2007 1:24 PM, Uwe Ligges <ligges at statistik.uni-dortmund.de
> > > <mailto:ligges at statistik.uni-dortmund.de>> wrote:
> > >
> > >     Can you give a reproducible example, pelase?
> > >
> > >     Uwe Ligges
> > >
> > >
> > >     Sean Davis wrote:
> > >      > I have been trying to use the gunzip function in the R.utils
> > >     package.  It
> > >      > opens a connection to a gzfile, uses readBin to read from that
> > >     connection,
> > >      > and then uses writeBin to write out the raw data to a new file.
> > >      This works
> > >      > as expected under linux/mac, but under Windows, I get:
> > >      >
> > >      > Error in readBin(inn, what= raw(0), size = 1, n=BFR.SIZE)  :
> > >      >   negative length vectors are not allowed
> > >      >
> > >      > A simple traceback shows the error in readBin.  I wouldn't be
> > >     surprised if
> > >      > this is a programming issue not located in readBin, but I am
> > >     confused about
> > >      > the difference in behaviors on Windows versus mac/linux.  Any
> > >     insight into
> > >      > what I can do to remedy the issue and have a cross-platform gunzip()?
> > >      >
> > >      > Thanks,
> > >      > Sean
> > >      >
> > >      >       [[alternative HTML version deleted]]
> > >      >
> > >      > ______________________________________________
> > >      > R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
> > >      > https://stat.ethz.ch/mailman/listinfo/r-devel
> > >
> > >
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>


From nmcalder at verizon.net  Tue Jan  1 18:08:49 2008
From: nmcalder at verizon.net (Matt Calder)
Date: Tue, 01 Jan 2008 12:08:49 -0500
Subject: [Rd] Problem with dyn.load'ed code
In-Reply-To: <20071231203010.GA72526@piskorski.com>
References: <1199072630.17113.54.camel@calder-linux>
	<20071231203010.GA72526@piskorski.com>
Message-ID: <1199207329.17113.67.camel@calder-linux>

Andrew,
	Thanks! The version script worked like a charm. Specifically I now
build using:

g++ -shared -Wl,--version-script=ver.map to_dyn_load.cc -o to_dyn_load.so -larpack

where ver.map is the file:

{
     global: R_func_*;
     local:*;
};

and any function I want exported to R is named R_func_*. This is going
to be my new SOP. 
	Thanks again Andrew, and also Simon. I greatly appreciate you taking
your time to solve this problem for me.

	Matt

	
On Mon, 2007-12-31 at 15:30 -0500, Andrew Piskorski wrote:
> On Sun, Dec 30, 2007 at 10:43:50PM -0500, Matt Calder wrote:
> > Simon,
> > 	Thanks for the reply. Indeed, declaring the function static fixes the
> > example. Unfortunately, the real problem that gave rise to the example
> > arises in a large Fortran library that is not under my control (ARPACK).
> > The author is providing BLAS and LAPACK functionality intentionally.
> > That may or may not be good practice, but it is a given in this case.
> 
> Ok, so R is calling its one "dnrm2_" function, let's call this "A",
> while ARPACK defines a second, different "dnrm2_", which we'll call
> "B".  You want to call function A from your own C code, while R keeps
> calling function A as before without any change or interference.  And
> of course, A and B are two C-coded functions with different behaviors
> but the exact same name.  You can make that work, it just requires
> some tricks.
> 
> > 	I still feel like the linker ought to be able to solve this problem for
> > me. My impression was that the static keyword passed to the linker
> 
> It can, you just need to tell it exactly what you want.  I assume you
> are building your own custom C code into a shared library, which you
> then load into R.
> 
> Thus, one solution is to statically link the ARPACK library into your
> own shared library, and then carefully tell the linker which symbols
> to export and which to keep private inside your shared library.  As
> long as the symbol ARPACK's "B" dnrm2_ function is kept private inside
> your own shared library (not exported), R will never see it and will
> happily keep using dnrm2_ "A" as before.
> 
> That's how I've solved this sort of name collision problem in the
> past.  In your "src/Makevars", you may want something like to this:
> 
>   PKG_LIBS = -Wl,--version-script=vis.map -Wl,-Bstatic -L/usr/local/lib/ARPACK -lARPACK -Wl,-Bdynamic
> 
> You may also need a PG_PKG_LIBS with the same stuff, but I don't
> remember why.  The '--version-script=' and related matters were also
> disccussed here back in February:
> 
>   https://stat.ethz.ch/pipermail/r-devel/2007-February/044531.html
>


From ligges at statistik.uni-dortmund.de  Tue Jan  1 18:36:36 2008
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Tue, 01 Jan 2008 18:36:36 +0100
Subject: [Rd] readBin differences on Windows and Linux/mac
In-Reply-To: <59d7961d0801010820u40da9caetdcf66dff6dc5d514@mail.gmail.com>
References: <264855a00712310958o42483fa6g27e0111ed6d01b16@mail.gmail.com>	
	<477933F0.6080205@statistik.uni-dortmund.de>	
	<264855a00712311151w7a43dbeara85e6abb0e6cec22@mail.gmail.com>	
	<477A6185.6050007@statistik.uni-dortmund.de>	
	<59d7961d0801010810l3a2a346aja02429552e45464c@mail.gmail.com>
	<59d7961d0801010820u40da9caetdcf66dff6dc5d514@mail.gmail.com>
Message-ID: <477A7A24.4020600@statistik.uni-dortmund.de>

Thank you, Henrik! This saves us a lot of time!

Uwe


Henrik Bengtsson wrote:
> On 01/01/2008, Henrik Bengtsson <hb at stat.berkeley.edu> wrote:
>> Also make sure the problem is not due to downloading a gzip file in
>> text mode, because to the best of my understanding that is platform
>> dependent.  That is, use download.file(..., mode="wb") instead of the
>> default, which is mode="w".  (This is such a common error that I would
>> like to suggest mode="wb" to become the default.)
> 
> Ok, that solves the problem with your example file.   On WinXP/R v2.6.1:
> 
>> library(R.utils)
>> uri <- "ftp://ftp.ncbi.nih.gov/pub/geo/DATA/SeriesMatrix/GSE1/GSE1_series_matrix.txt.gz"
> 
>> download.file(uri, "test.txt.gz")  # mode="w"
> trying URL 'ftp://ftp.ncbi.nih.gov/pub/geo/DATA/SeriesMatrix/GSE1/GSE1_series_ma
> trix.txt.gz'
> ftp data connection made, file length 918804 bytes
> opened URL
> downloaded 897 Kb
>> file.info("test.txt.gz")$size
> [1] 922243
> 
>> download.file(uri, "test2.txt.gz")
> ftp data connection made, file length 918804 bytes
> opened URL
> downloaded 897 Kb
>> file.info("test2.txt.gz")$size
> [1] 918804
> 
>> gunzip("test.txt.gz")
> Error in readBin(inn, what = raw(0), size = 1, n = BFR.SIZE) :
>   negative length vectors are not allowed
>> gunzip("test2.txt.gz")
>> file.info("test2.txt")$size
> [1] 3338362
> 
> /H
> 
>> /Henrik
>>
>> On 01/01/2008, Uwe Ligges <ligges at statistik.uni-dortmund.de> wrote:
>>> I see. It is either a bug or something related to the following
>>> paragraph from ?seek:
>>>
>>>       We have found so many errors in the Windows implementation of file
>>>       positioning that users are advised to use it only at their own
>>>       risk, and asked not to waste the R developers' time with bug
>>>       reports on Windows' deficiencies.
>>>
>>> I will investigate more closely when I am back in office end of this week.
>>>
>>> Best,
>>> Uwe
>>>
>>>
>>>
>>>
>>> Sean Davis wrote:
>>>> Sorry, Uwe.  Of course:
>>>>
>>>> Both in relatively recent R-devel (one mac, one windows):
>>>>
>>>> ### gunzip pulled from R.utils to be a simple function
>>>> ### In R.utils, implemented as a method
>>>> gunzip <- function(filename, destname=gsub("[.]gz$", "", filename),
>>>> overwrite=FALSE, remove=TRUE, BFR.SIZE=1e7) {
>>>>   if (filename == destname)
>>>>     stop(sprintf("Argument 'filename' and 'destname' are identical: %s",
>>>> filename));
>>>>   if (!overwrite && file.exists(destname))
>>>>     stop(sprintf("File already exists: %s", destname));
>>>>
>>>>   inn <- gzfile(filename, "rb");
>>>>   on.exit(if (!is.null(inn)) close(inn));
>>>>
>>>>   out <- file(destname, "wb");
>>>>   on.exit(close(out), add=TRUE);
>>>>
>>>>   nbytes <- 0;
>>>>   repeat {
>>>>     bfr <- readBin(inn, what=raw(0), size=1, n=BFR.SIZE);
>>>>     n <- length(bfr);
>>>>     if (n == 0)
>>>>       break;
>>>>     nbytes <- nbytes + n;
>>>>     writeBin(bfr, con=out, size=1);
>>>>   };
>>>>
>>>>   if (remove) {
>>>>     close(inn);
>>>>     inn <- NULL;
>>>>     file.remove(filename);
>>>>   }
>>>>
>>>>   invisible(nbytes);
>>>> }
>>>> download.file('
>>>> ftp://ftp.ncbi.nih.gov/pub/geo/DATA/SeriesMatrix/GSE1/GSE1_series_matrix.txt.gz','test.txt.gz'
>>>> <ftp://ftp.ncbi.nih.gov/pub/geo/DATA/SeriesMatrix/GSE1/GSE1_series_matrix.txt.gz','test.txt.gz'>)
>>>> gunzip('test.txt.gz')
>>>>
>>>> Under windows, this results in the error reported below.  Under mac and
>>>> linux, results in test.txt being created in the current working
>>>> directory.  The actual gunzip function is pretty bare bones, so I don't
>>>> think it complicates matters much to use it in this example.
>>>>
>>>> Sean
>>>>
>>>>
>>>> On Dec 31, 2007 1:24 PM, Uwe Ligges <ligges at statistik.uni-dortmund.de
>>>> <mailto:ligges at statistik.uni-dortmund.de>> wrote:
>>>>
>>>>     Can you give a reproducible example, pelase?
>>>>
>>>>     Uwe Ligges
>>>>
>>>>
>>>>     Sean Davis wrote:
>>>>      > I have been trying to use the gunzip function in the R.utils
>>>>     package.  It
>>>>      > opens a connection to a gzfile, uses readBin to read from that
>>>>     connection,
>>>>      > and then uses writeBin to write out the raw data to a new file.
>>>>      This works
>>>>      > as expected under linux/mac, but under Windows, I get:
>>>>      >
>>>>      > Error in readBin(inn, what= raw(0), size = 1, n=BFR.SIZE)  :
>>>>      >   negative length vectors are not allowed
>>>>      >
>>>>      > A simple traceback shows the error in readBin.  I wouldn't be
>>>>     surprised if
>>>>      > this is a programming issue not located in readBin, but I am
>>>>     confused about
>>>>      > the difference in behaviors on Windows versus mac/linux.  Any
>>>>     insight into
>>>>      > what I can do to remedy the issue and have a cross-platform gunzip()?
>>>>      >
>>>>      > Thanks,
>>>>      > Sean
>>>>      >
>>>>      >       [[alternative HTML version deleted]]
>>>>      >
>>>>      > ______________________________________________
>>>>      > R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>>>>      > https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>


From sdavis2 at mail.nih.gov  Tue Jan  1 18:54:17 2008
From: sdavis2 at mail.nih.gov (Sean Davis)
Date: Tue, 1 Jan 2008 12:54:17 -0500
Subject: [Rd] readBin differences on Windows and Linux/mac
In-Reply-To: <477A7A24.4020600@statistik.uni-dortmund.de>
References: <264855a00712310958o42483fa6g27e0111ed6d01b16@mail.gmail.com>
	<477933F0.6080205@statistik.uni-dortmund.de>
	<264855a00712311151w7a43dbeara85e6abb0e6cec22@mail.gmail.com>
	<477A6185.6050007@statistik.uni-dortmund.de>
	<59d7961d0801010810l3a2a346aja02429552e45464c@mail.gmail.com>
	<59d7961d0801010820u40da9caetdcf66dff6dc5d514@mail.gmail.com>
	<477A7A24.4020600@statistik.uni-dortmund.de>
Message-ID: <264855a00801010954r1d648b33t8b25cdca0380f906@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080101/ff3e671f/attachment.pl 

From simon.urbanek at r-project.org  Tue Jan  1 19:33:55 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 1 Jan 2008 13:33:55 -0500
Subject: [Rd] Problem with dyn.load'ed code
In-Reply-To: <1199207329.17113.67.camel@calder-linux>
References: <1199072630.17113.54.camel@calder-linux>
	<20071231203010.GA72526@piskorski.com>
	<1199207329.17113.67.camel@calder-linux>
Message-ID: <95DF88BB-C703-4B87-BDC3-439D6D57AF50@r-project.org>

Matt,

On Jan 1, 2008, at 12:08 PM, Matt Calder wrote:

> Andrew,
> 	Thanks! The version script worked like a charm. Specifically I now
> build using:
>
> g++ -shared -Wl,--version-script=ver.map to_dyn_load.cc -o  
> to_dyn_load.so -larpack
>

just a word of warning - this is in no way portable. It is probably ok  
for your private compilation, but it won't work in general. In any  
case, I'd strongly recommend enabling this hack only if you know that  
the target system supports it for the sake of portability. However, if  
you are concerned about the latter, you should probably have a look at  
libtool and --export-symbols - it allows you to control the visibility  
on most systems that support it.
Note that there are systems that don't support it at all.

Cheers,
Simon


> where ver.map is the file:
>
> {
>     global: R_func_*;
>     local:*;
> };
>
> and any function I want exported to R is named R_func_*. This is going
> to be my new SOP.
> 	Thanks again Andrew, and also Simon. I greatly appreciate you taking
> your time to solve this problem for me.
>
> 	Matt
>
> 	
> On Mon, 2007-12-31 at 15:30 -0500, Andrew Piskorski wrote:
>> On Sun, Dec 30, 2007 at 10:43:50PM -0500, Matt Calder wrote:
>>> Simon,
>>> 	Thanks for the reply. Indeed, declaring the function static fixes  
>>> the
>>> example. Unfortunately, the real problem that gave rise to the  
>>> example
>>> arises in a large Fortran library that is not under my control  
>>> (ARPACK).
>>> The author is providing BLAS and LAPACK functionality intentionally.
>>> That may or may not be good practice, but it is a given in this  
>>> case.
>>
>> Ok, so R is calling its one "dnrm2_" function, let's call this "A",
>> while ARPACK defines a second, different "dnrm2_", which we'll call
>> "B".  You want to call function A from your own C code, while R keeps
>> calling function A as before without any change or interference.  And
>> of course, A and B are two C-coded functions with different behaviors
>> but the exact same name.  You can make that work, it just requires
>> some tricks.
>>
>>> 	I still feel like the linker ought to be able to solve this  
>>> problem for
>>> me. My impression was that the static keyword passed to the linker
>>
>> It can, you just need to tell it exactly what you want.  I assume you
>> are building your own custom C code into a shared library, which you
>> then load into R.
>>
>> Thus, one solution is to statically link the ARPACK library into your
>> own shared library, and then carefully tell the linker which symbols
>> to export and which to keep private inside your shared library.  As
>> long as the symbol ARPACK's "B" dnrm2_ function is kept private  
>> inside
>> your own shared library (not exported), R will never see it and will
>> happily keep using dnrm2_ "A" as before.
>>
>> That's how I've solved this sort of name collision problem in the
>> past.  In your "src/Makevars", you may want something like to this:
>>
>>  PKG_LIBS = -Wl,--version-script=vis.map -Wl,-Bstatic -L/usr/local/ 
>> lib/ARPACK -lARPACK -Wl,-Bdynamic
>>
>> You may also need a PG_PKG_LIBS with the same stuff, but I don't
>> remember why.  The '--version-script=' and related matters were also
>> disccussed here back in February:
>>
>>  https://stat.ethz.ch/pipermail/r-devel/2007-February/044531.html
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From ggrothendieck at gmail.com  Tue Jan  1 20:59:57 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 1 Jan 2008 14:59:57 -0500
Subject: [Rd] Wish List
Message-ID: <971536df0801011159p69804fabk34ad41d98468d29e@mail.gmail.com>

Most of the items on this list have been mentioned before but it
may be useful to see them altogether and at any rate every year
I have posted my R wishlist at the beginning of the year.

High priority items pertain to the foundations of R (promises,
environments) since those form the basis of everything
else and the foundation needs to be looked after first.

The medium items are focused on scripting since with a few additional
features R could work more smoothly with other software.

For the Low priority items we listed the rest.  They are not necessarily
low in terms of desirability but I wanted to focus the high and
medium items on foundations and scripting.

There is also a section at the end focusing on addon packages.
These may be strictly speaking part of R but are widely used.

High

1. Some way of inspecting promises.  It is possible to get
the expression associated with a promise using substitute but
not its environment.  Also need a way to copy a promise without
forcing it.  See:
https://stat.ethz.ch/pipermail/r-devel/2007-September/046966.html

2. Fix bug when promises are stored in lists:

    f <- function(x) environment()
    as.list(f(0))$x == 0 # gives error.  Should be TRUE.

3. If a package uses "LazyLoad: true" then R changes the class of
certain top level objects.  This does not occur if "Lazyload: false"
is used.  For an example see:
https://stat.ethz.ch/pipermail/r-devel/2007-October/047118.html

4. If two environment variables point to the same environment they
cannot have different attributes.  This effectively thwarts subclassing
of environments (contrary to OO principles).

Medium

5. Sweave. A common scanario is spawning a Sweave job from
another program (such as from a program controlling a
web site).  The caller needs to pass some information to the
Sweave program such as the file name of a report to produce.
Its possible to spawn R and have R spawn sweave but given the
existence of R CMD Sweave it would be nice to be able to just
spawn R CMD Sweave directly.  Features that would help here
would be:

- support --args or some other method of passing arguments
  from R CMD Sweave line to the Sweave script

- have a facility whereby R CMD Sweave can directly generate
  the .pdf file and an argument which allows the caller to
  define the name of the resulting pdf file, e.g. -o.  (With
  automated reports one may need to have many different outputs
  from the same Rnw file so its important to name them differently.)

- an -x argument similar to Perl/Python/Ruby such that if one calls
  R CMD Sweave -x abc myfile.Rnw then all lines up to the first one
  matching the indicated regexp, abc here, are skipped.  This
  facilitates combining the script with a shell or batch file if the
  previous is not enough.

Thus one could spawn this from their program:
R CMD Sweave --pdf myfile.Rnw -o myfile-123.pdf --args 23
and it would generate a pdf file from myfile.Rnw of the
indicated name passing 23 as arg1 to the R code embedded in the
Sweave file.

See:
https://stat.ethz.ch/pipermail/r-devel/2007-October/047195.html
https://stat.ethz.ch/pipermail/r-help/2007-December/148091.html

6. -x flag on Rscript as in perl/python/ruby.  Useful for combining batch
   and R file into a single file on non-UNIX systems.  It would cause all
   lines until a line starting with #!Rscript to be skipped by the R
   processor.  See:
   https://www.stat.math.ethz.ch/pipermail/r-devel/2007-January/044433.html
   Also see
   http://www.datafocus.com/docs/perl/pod/perlwin32.asp#running_perl_scripts
   since the same considerations as for Perl scripts applies.
   There is also some discussion here:
   https://stat.ethz.ch/pipermail/r-help/2007-November/145279.html
   https://stat.ethz.ch/pipermail/r-help/2007-November/145301.html

Low

7. Define Lag <- function(x, k = 1, ...) lag(x, -k, ,..)

   so the user has his choice of which orientation he prefers.
   Many packages could make use of it if it were in the core of R including
   zoo, dyn, dynlm, fame and others.  This would also address comments
   such as in ISSUE 4 on this page which is associated with a popular
   book on time series:
   http://www.stat.pitt.edu/stoffer/tsa2/Rissues.htm

8. On Windows, package build tools should check that Cygwin is in
correct position on PATH and issue meaningful error if not.  If
you get this wrong currently its quite hard to diagnose unless
you know about it.

9. Implement the R shell() and shell.exec() commands on
non-Windows systems.

10. print.function should be improved to make it obvious how to find what
    the user is undoubtedly looking for in both the S3 and S4 cases.
    That would address one of the criticisms here:
    http://www.stat.columbia.edu/~cook/movabletype/archives/2007/08/they_started_me.html
    (The other criticisms at this link are worth addressing too -- ggplot2
    and several existing or upcoming books on grid, lattice and ggplot
R graphics are
    presumably addressing  the criticism that creating graphics is
difficult in R.)

11. Add { to the derivative table so one can write this:
    f <- function(x) x*x
    deriv(body(f), "x", func = TRUE)

    Currently, one must do:
    deriv(body(f)[[2]], "x", func = TRUE)

12. as.Date.numeric should have Epoch as default origin.  Its currently
    asymmetric since as.numeric(as.Date(x)) does not require specifying
    the Epoch yet you do have to specify it in the reverse direction.
       dd <- Sys.Date()
       x <- as.numeric(dd) # ok
       as.Date(x) # error
    Even worse, sapply (and also ifelse and likely some other functions)
    unclass your dates and you should not have to know the origin to get
    them back with as.Date .

13. In traceback(), environents in the calling sequence are listed
    simply as <environment> so we don't know which environment is being
    referenced.  It would be more helpful if the hash code associated
    with the environment were listed.  Also it would be useful if it were
    possible to inspect an environment given its hash code as this might
    help the programmer determine which environment is being referenced.

14. These provide results which are not valid R:

	> dput(alist(a=1,b=))
	structure(list(a = 1, b = ), .Names = c("a", "b"))

	> dput(alist(a=1,b=),control="all")
	structure(list(a = 1, b = quote()), .Names = c("a", "b"))

15. There should be a "LazyLoad: auto" or similar that corresponds to
    omitting LazyLoad in the DESCRIPTION file.  Currently there no
    explicit argument setting that corresponds to the default LazyLoad
    setting.

16. facility to directly get the hex code for an environment.  Currently
   one must do:
   capture.output(new.env())

17. stats:::nlsModel.  Would like option to NOT calculate derivatives so
    it can be used with derivative-free algorithms.

18. Make as.POSIXlt, difftime, filter, rowMeans and rowSums into S3 generics.
   Various time series and datetime packages such as fame, zoo and chron
   could use these.

Packages
========

19. DBI.
    - It should be possible for a program to discover which DBI drivers
      are loaded.
    - A DBI driver for ODBC would be nice.

20. RSQlite
    - automatically set eol correctly in sqliteImportFile according to
      input file (currently it defaults to "\n" which only works correctly
      for files created on UNIX)
    - either give sqliteImportFile its own .Rd page or make it possible
      to read ?dbWriteTable without reference to sqliteImportFile
    - ability to use arbitrary R functions from within sqlite select statements
      (or second best would be to at least support common functions used in
      statistics that are not in sqlite such as sd, var, etc.)
    - sqliteImportFile should support quoted fields so that .csv files,
      the most common input file format, can be supported
    See: https://stat.ethz.ch/pipermail/r-sig-db/2007-August/000382.html
         https://stat.ethz.ch/pipermail/r-sig-db/2007-August/000384.html

21. MySQL
    - dbWriteTable on Windows inserts extra "\r" characters
    See: https://stat.ethz.ch/pipermail/r-sig-db/2007-August/000385.html

22. grid

- grid.ls() enhancement to show more info (if grid.ls is analogous to ls
  on UNIX then this would be analogous to ls -l) and a grep-like facility
  which only lists grid objects with specified attributes, e.g. just list
  all grid objects that are dark green
- ability to reset grid names so generating the same plot twice gives
  the same sequence of grid names.

My previous wish lists are here:
https://www.stat.math.ethz.ch/pipermail/r-devel/2007-January/044122.html
https://www.stat.math.ethz.ch/pipermail/r-devel/2006-January/035949.html
https://www.stat.math.ethz.ch/pipermail/r-help/2005-January/061984.html
https://www.stat.math.ethz.ch/pipermail/r-devel/2004-January/028465.html


From huber at ebi.ac.uk  Tue Jan  1 22:53:06 2008
From: huber at ebi.ac.uk (Wolfgang Huber)
Date: Tue, 01 Jan 2008 21:53:06 +0000
Subject: [Rd] Error from wilcox.test
Message-ID: <477AB642.6070201@ebi.ac.uk>

When one of the two groups has only one member and the other one more 
than 49, wilcox.test will exit with the below error message,

  n=51; wilcox.test(1:n ~ 1:n==1, conf.int=TRUE)

  Error in uniroot(wdiff, c(mumin, mumax), tol = 1e-04, zq = 
qnorm(alpha/2,  :
   f() values at end points not of opposite sign


whereas with n=50 a result is returned:

  n=50; wilcox.test(1:n ~ 1:n==1, conf.int=TRUE)

         Wilcoxon rank sum test

data:  1:n by 1:n == 1
W = 49, p-value = 0.04
alternative hypothesis: true location shift is not equal to 0
95 percent confidence interval:
   1 49
sample estimates:
difference in location
                     25


I wonder whether it would be worthwhile to make the wilcox.test function 
handle such (admittedly pathologic) cases more gracefully.


Happy New Year to all -
   Wolfgang

------------------------------------------------------------------
Wolfgang Huber  EBI/EMBL  Cambridge UK  http://www.ebi.ac.uk/huber


From ripley at stats.ox.ac.uk  Wed Jan  2 07:59:51 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 2 Jan 2008 06:59:51 +0000 (GMT)
Subject: [Rd] large netCDF files under Windows.
In-Reply-To: <Pine.LNX.4.64.0712301205540.14525@gannet.stats.ox.ac.uk>
References: <Pine.LNX.4.43.0712291844220.7069@hymn33.u.washington.edu>
	<Pine.LNX.4.64.0712301205540.14525@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0801020657150.6266@gannet.stats.ox.ac.uk>

For the record: Thomas provided a test case and both ncdf and RNetCDF have 
been rebuilt with support for files > 2Gb.  Updated versions are now on 
the CRANextras repository.

On Sun, 30 Dec 2007, Prof Brian Ripley wrote:

> The netcdf code is rather silly: it uses 64-bit versions of seek etc when
> building a DLL, not on Windows.  I can rebuild it using 64-bit seek, but
> could you please send me (privately) a test case?
>
> On Sat, 29 Dec 2007, Thomas Lumley wrote:
>
>> Has anyone successfully used R to access netCDF files larger than 2Gb
>> under Windows?
>>
>> With the version of the ncdf package that Brian Ripley provides for CRAN
>> extras I get an assertion failure with a 12Gb file, but not a 1Gb subset
>> of it. The same 12Gb file is ok with ncdf on Mac OS X (32bit R) and on
>> Linux(64bit R).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Jan  2 08:14:56 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 2 Jan 2008 07:14:56 +0000 (GMT)
Subject: [Rd] Error from wilcox.test
In-Reply-To: <477AB642.6070201@ebi.ac.uk>
References: <477AB642.6070201@ebi.ac.uk>
Message-ID: <Pine.LNX.4.64.0801020708590.6430@gannet.stats.ox.ac.uk>

Try exact = TRUE: the default switches to a normal approximation that will 
not be adequate in your extreme example.

On Tue, 1 Jan 2008, Wolfgang Huber wrote:

> When one of the two groups has only one member and the other one more
> than 49, wilcox.test will exit with the below error message,
>
>  n=51; wilcox.test(1:n ~ 1:n==1, conf.int=TRUE)
>
>  Error in uniroot(wdiff, c(mumin, mumax), tol = 1e-04, zq =
> qnorm(alpha/2,  :
>   f() values at end points not of opposite sign
>
>
> whereas with n=50 a result is returned:
>
>  n=50; wilcox.test(1:n ~ 1:n==1, conf.int=TRUE)
>
>         Wilcoxon rank sum test
>
> data:  1:n by 1:n == 1
> W = 49, p-value = 0.04
> alternative hypothesis: true location shift is not equal to 0
> 95 percent confidence interval:
>   1 49
> sample estimates:
> difference in location
>                     25
>
>
> I wonder whether it would be worthwhile to make the wilcox.test function
> handle such (admittedly pathologic) cases more gracefully.
>
>
> Happy New Year to all -
>   Wolfgang
>
> ------------------------------------------------------------------
> Wolfgang Huber  EBI/EMBL  Cambridge UK  http://www.ebi.ac.uk/huber
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From dfaden at gmail.com  Wed Jan  2 09:16:07 2008
From: dfaden at gmail.com (David Faden)
Date: Wed, 2 Jan 2008 02:16:07 -0600
Subject: [Rd] setting the seed in standalone code using Rlib
Message-ID: <6730abff0801020016m41b73fb9o4e832b4785d98853@mail.gmail.com>

Hi,

Is the below -- setSeed -- an okay way to set the seed in standalone
applications making use of Rlib? It seems to work as expected. Is
there a better way to do it? (I'm also looking at do_setseed but am
unsure what to supply as op. findFun("set.seed", R_GlobalEnv)?) Thanks
much.

-- 
David Faden, dfaden at iastate.edu
AIM: pitulx
--

#include <assert.h>
#include <R.h>
#include <Rinternals.h>
#include <R_ext/Parse.h>
#include <Rmath.h>
#include <stdio.h>

void setSeed(unsigned int seed)
{
#ifndef MATHLIB_STANDALONE

  /**
   * Following the example in Writing R Extensions 5.10
   */

  char cmd[256];
  SEXP cmdSexp;
  SEXP cmdExp;
  ParseStatus status;

  sprintf(cmd, "set.seed(%u)", seed);

  PROTECT(cmdSexp = allocVector(STRSXP, 1));
  SET_STRING_ELT(cmdSexp, 0, mkChar(cmd));
  cmdExp = PROTECT(R_ParseVector(cmdSexp, -1, &status, R_NilValue));

  assert(status == PARSE_OK);

  eval(VECTOR_ELT(cmdExp, 0), R_GlobalEnv);

  UNPROTECT(2);

#else

  set_seed(seed, seed);

#endif

}

/* Test */

extern int Rf_initEmbeddedR(int argc, const char *argv[]);

int main(int numArgs, char** args)
{
  const char *argv[]= {"setseed", "--gui=none", "--silent"};
  const int argc = 3;

  Rf_initEmbeddedR(argc, argv);

  setSeed((unsigned int)42);
  printf("%f\n", rnorm(0.0, 1.0));
  return 0;
}


From ripley at stats.ox.ac.uk  Wed Jan  2 09:19:11 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 2 Jan 2008 08:19:11 +0000 (GMT)
Subject: [Rd] Error from wilcox.test
In-Reply-To: <Pine.LNX.4.64.0801020708590.6430@gannet.stats.ox.ac.uk>
References: <477AB642.6070201@ebi.ac.uk>
	<Pine.LNX.4.64.0801020708590.6430@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0801020810030.8354@gannet.stats.ox.ac.uk>

On Wed, 2 Jan 2008, Prof Brian Ripley wrote:

> Try exact = TRUE: the default switches to a normal approximation that will
> not be adequate in your extreme example.

I've modified the code in R-devel to give an answer in such extreme cases, 
but note that the p-value is pretty inaccurate, and so is the coverage of 
the reported CI.

> On Tue, 1 Jan 2008, Wolfgang Huber wrote:
>
>> When one of the two groups has only one member and the other one more
>> than 49, wilcox.test will exit with the below error message,
>>
>>  n=51; wilcox.test(1:n ~ 1:n==1, conf.int=TRUE)
>>
>>  Error in uniroot(wdiff, c(mumin, mumax), tol = 1e-04, zq =
>> qnorm(alpha/2,  :
>>   f() values at end points not of opposite sign
>>
>>
>> whereas with n=50 a result is returned:
>>
>>  n=50; wilcox.test(1:n ~ 1:n==1, conf.int=TRUE)
>>
>>         Wilcoxon rank sum test
>>
>> data:  1:n by 1:n == 1
>> W = 49, p-value = 0.04
>> alternative hypothesis: true location shift is not equal to 0
>> 95 percent confidence interval:
>>   1 49
>> sample estimates:
>> difference in location
>>                     25
>>
>>
>> I wonder whether it would be worthwhile to make the wilcox.test function
>> handle such (admittedly pathologic) cases more gracefully.
>>
>>
>> Happy New Year to all -
>>   Wolfgang
>>
>> ------------------------------------------------------------------
>> Wolfgang Huber  EBI/EMBL  Cambridge UK  http://www.ebi.ac.uk/huber


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Jan  2 09:30:40 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 2 Jan 2008 08:30:40 +0000 (GMT)
Subject: [Rd] setting the seed in standalone code using Rlib
In-Reply-To: <6730abff0801020016m41b73fb9o4e832b4785d98853@mail.gmail.com>
References: <6730abff0801020016m41b73fb9o4e832b4785d98853@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0801020819530.8546@gannet.stats.ox.ac.uk>

What is 'Rlib'?

Did you mean embedded R (libR), rather than standalone Rmath? 
Applications making use of libR are not 'standalone': they use almost all 
of the installed R files.

On Wed, 2 Jan 2008, David Faden wrote:

> Hi,
>
> Is the below -- setSeed -- an okay way to set the seed in standalone
> applications making use of Rlib? It seems to work as expected. Is
> there a better way to do it? (

It is the only documented way to set the seed in embedded R.  Should you 
have meant standalone Rmath, other ways are documented.

> I'm also looking at do_setseed but am
> unsure what to supply as op. findFun("set.seed", R_GlobalEnv)?) Thanks
> much.

do_setseed is not an exported entry point, so not available to most users 
of libR.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From A.R.Runnalls at kent.ac.uk  Wed Jan  2 18:45:38 2008
From: A.R.Runnalls at kent.ac.uk (A.R.Runnalls at kent.ac.uk)
Date: Wed,  2 Jan 2008 18:45:38 +0100 (CET)
Subject: [Rd] do_gsub (PR#10540)
Message-ID: <20080102174538.4B6D7283416A@mail.pubhealth.ku.dk>

In character.c within R 2.6.1, the function do_gsub contains the following 
code:

1199        if (STRING_ELT(pat, 0) == NA_STRING) {
1200            PROTECT(ans = allocVector(STRSXP, n));
1201            for(i = 0; i < n; i++)  SET_STRING_ELT(ans, i, NA_STRING);
1202            UNPROTECT(1);
1203            return ans;
1204        }
1205
1206        if (length(pat) < 1 || length(rep) < 1) error(R_MSG_IA);

Line 1206 checks that pat contains at least one element.  However, line 1199 
has already attempted to access the first element.  The check should surely 
come first.

Andrew Runnalls


From ggrothendieck at gmail.com  Thu Jan  3 15:03:03 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 3 Jan 2008 09:03:03 -0500
Subject: [Rd] Typo in DateTimeClasses.Rd
Message-ID: <971536df0801030603k6f8c46cbvb18669d5276ba290@mail.gmail.com>

In:

   trunk/src/library/base/man/DateTimeClasses.Rd

this:

  \section{Sub-section Accuracy}{

should be

  \section{Sub-second Accuracy}{


From murdoch at stats.uwo.ca  Thu Jan  3 15:25:48 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 03 Jan 2008 09:25:48 -0500
Subject: [Rd] Typo in DateTimeClasses.Rd
In-Reply-To: <971536df0801030603k6f8c46cbvb18669d5276ba290@mail.gmail.com>
References: <971536df0801030603k6f8c46cbvb18669d5276ba290@mail.gmail.com>
Message-ID: <477CF06C.8000909@stats.uwo.ca>

On 1/3/2008 9:03 AM, Gabor Grothendieck wrote:
> In:
> 
>    trunk/src/library/base/man/DateTimeClasses.Rd
> 
> this:
> 
>   \section{Sub-section Accuracy}{
> 
> should be
> 
>   \section{Sub-second Accuracy}{

Thanks, will fix.

Duncan Murdoch


From h.wickham at gmail.com  Fri Jan  4 03:31:18 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Thu, 3 Jan 2008 20:31:18 -0600
Subject: [Rd] checking whether the name space can be loaded with stated
	dependencies
Message-ID: <f8e6ff050801031831j36005a1cw8449a6f65481845b@mail.gmail.com>

Can any one provide more details on this error that I'm getting from R
CMD check:

* checking whether the name space can be loaded with stated
dependencies ... WARNING
Error in eval(expr, envir, enclos) : could not find function "proto"
Error: unable to load R code in package 'ggplot2'
Execution halted

A namespace must be able to be loaded with just the base namespace loaded:
otherwise if the namespace gets loaded by a saved object, the session will
be unable to start.

Probably some imports need to be declared in the NAMESPACE file.


It's only occurred recently and I have no idea what might have caused
the change.  The function proto is from the proto package which does
not have a namespace.

Thanks,

Hadley


-- 
http://had.co.nz/


From tplate at acm.org  Fri Jan  4 06:16:05 2008
From: tplate at acm.org (Tony Plate)
Date: Thu, 03 Jan 2008 22:16:05 -0700
Subject: [Rd] as.Date.numeric origin default
In-Reply-To: <e8e755250712302153ha84354bw53f14a280f22506@mail.gmail.com>
References: <e8e755250712302153ha84354bw53f14a280f22506@mail.gmail.com>
Message-ID: <477DC115.4040303@acm.org>

Seems like it makes sense to have a default origin of 1970-01-01 for 
as.Date.numeric().  Are there any strong arguments for requiring users 
to specify the origin for every invocation of as.Date.numeric()?

The code could be:

as.Date.numeric <- function(x, origin="1970-01-01", ...)
{
    if ((missing(origin) && nargs()==1)
        || (is.character(origin) && origin=="1970-01-01" && nargs()==2))
        return(structure(as.integer(x), class="Date"))
    as.Date(origin, ...) + as.integer(x)
}

I guess the use of as.integer(x) is debatable, but using it seems 
consistent with the "Details" section of ?Date.

-- Tony Plate

Jeff Ryan wrote:
> R-devel,
>
> I would like to second Gabor Grothendieck's request from September (
> http://www.nabble.com/as.Date.numeric-to12962733.html#a12962733 )
> on adding a default value (1970-01-01) to the origin argument of
> as.Date.numeric.
>
> I realize there is good reason to allow for origin to be specified,
> but I don't see why it must be up to the user at each and every
> invocation if most (if not all) users will simply be using 1970-01-01.
>
> My first contact was building quantmod for CRAN - many more hidden
> errors occur as I test  on R-devel.  It just seems to me to be an easy
> compromise to what will undoubtedly cost many hours of debugging
> across all packages/users.
>
> Thank you for your consideration,
> Jeff Ryan
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From ripley at stats.ox.ac.uk  Fri Jan  4 10:08:49 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 4 Jan 2008 09:08:49 +0000 (GMT)
Subject: [Rd] checking whether the name space can be loaded with stated
 dependencies
In-Reply-To: <f8e6ff050801031831j36005a1cw8449a6f65481845b@mail.gmail.com>
References: <f8e6ff050801031831j36005a1cw8449a6f65481845b@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0801040237590.26624@gannet.stats.ox.ac.uk>

What it is trying is

% env R_DEFAULT_PACKAGES=NULL R

> loadNamespace("ggplot2")

The test is not new, so it would seem to be a change in ggplot2 since the 
version on CRAN.  My guess is the your package is doing top-level 
computations, which `Writing R Extensions' warns against:

   The R code files should only create R objects and not call functions
   with side effects such as require and options.

If you must deviate from that, you need to arrange for the environment you 
need: when loading a name space the Depends: packages are not loaded.

On Thu, 3 Jan 2008, hadley wickham wrote:

> Can any one provide more details on this error that I'm getting from R
> CMD check:
>
> * checking whether the name space can be loaded with stated
> dependencies ... WARNING
> Error in eval(expr, envir, enclos) : could not find function "proto"
> Error: unable to load R code in package 'ggplot2'
> Execution halted
>
> A namespace must be able to be loaded with just the base namespace loaded:
> otherwise if the namespace gets loaded by a saved object, the session will
> be unable to start.
>
> Probably some imports need to be declared in the NAMESPACE file.
>
>
> It's only occurred recently and I have no idea what might have caused
> the change.  The function proto is from the proto package which does
> not have a namespace.
>
> Thanks,
>
> Hadley
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From h.wickham at gmail.com  Fri Jan  4 15:15:45 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 4 Jan 2008 08:15:45 -0600
Subject: [Rd] checking whether the name space can be loaded with stated
	dependencies
In-Reply-To: <Pine.LNX.4.64.0801040237590.26624@gannet.stats.ox.ac.uk>
References: <f8e6ff050801031831j36005a1cw8449a6f65481845b@mail.gmail.com>
	<Pine.LNX.4.64.0801040237590.26624@gannet.stats.ox.ac.uk>
Message-ID: <f8e6ff050801040615t3469f32cldfe27bedc5539b1@mail.gmail.com>

On 1/4/08, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> What it is trying is
>
> % env R_DEFAULT_PACKAGES=NULL R
>
> > loadNamespace("ggplot2")
>
> The test is not new, so it would seem to be a change in ggplot2 since the
> version on CRAN.  My guess is the your package is doing top-level
> computations, which `Writing R Extensions' warns against:
>
>    The R code files should only create R objects and not call functions
>    with side effects such as require and options.

Thanks for the additional info. I've grepped for ^[^#\n ]+\(  (which I
think should find any top-level function call) and didn't find
anything. I certainly can't think of any top level computations that
I'm doing apart from creating R functions and objects.  Is there
anyway to get more details about what exactly I've done wrong?
Calling traceback after loadNamespace isn't helpful.

> If you must deviate from that, you need to arrange for the environment you
> need: when loading a name space the Depends: packages are not loaded.

Is this a recent change to R? The package appears to work fine after
installation so I presume this check is protecting me from some more
subtle danger.

If it's helpful, my depends line is:
Depends: R (>= 2.6), grid, reshape (>= 0.8.0), proto, splines, MASS,
  RColorBrewer, colorspace

so only proto or RColorBrewer should be a problem.

Hadley

-- 
http://had.co.nz/


From hendrik.weisser at gmx.net  Fri Jan  4 15:45:26 2008
From: hendrik.weisser at gmx.net (hendrik.weisser at gmx.net)
Date: Fri,  4 Jan 2008 15:45:26 +0100 (CET)
Subject: [Rd] nls (with SSlogis model and upper limit) never returns
	(PR#10544)
Message-ID: <20080104144526.F378D2834618@mail.pubhealth.ku.dk>

Full_Name: Hendrik Weisser
Version: 2.6.1
OS: Linux
Submission from: (NULL) (139.19.102.218)


The following computation never finishes and locks R up:

> values <- list(x=10:30, y=c(23.85, 28.805, 28.195, 26.23, 25.005, 20.475,
17.33, 14.97, 11.765, 8.857, 5.3725, 5.16, 4.2105, 2.929, 2.174, 1.25, 1.0255,
0.612, 0.556, 0.4025, 0.173))
> y.max <- max(values$y)
> model <- nls(y ~ SSlogis(x, asym, xmid, scal), data=values, algorithm="port",
start=c(asym=y.max, xmid=15, scal=-0.5), upper=c(y.max, Inf, Inf))

This used to work with R version 2.5.1 patched.
The problem does _not_ occur if the parameter "scal=-0.5" in the nls call is
changed, e. g. to "scal=-0.6" or "scal=-0.4".
Simply calling "model <- nls(y ~ SSlogis(x, asym, xmid, scal), data=values)"
also works, but this does not use the upper bound for the asym parameter, which
was the point.


From P.Dalgaard at biostat.ku.dk  Fri Jan  4 18:23:33 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Fri, 04 Jan 2008 18:23:33 +0100
Subject: [Rd] nls (with SSlogis model and upper limit) never
	returns	(PR#10544)
In-Reply-To: <20080104144526.F378D2834618@mail.pubhealth.ku.dk>
References: <20080104144526.F378D2834618@mail.pubhealth.ku.dk>
Message-ID: <477E6B95.50906@biostat.ku.dk>

hendrik.weisser at gmx.net wrote:
> Full_Name: Hendrik Weisser
> Version: 2.6.1
> OS: Linux
> Submission from: (NULL) (139.19.102.218)
>
>
> The following computation never finishes and locks R up:
>
>   
>> values <- list(x=10:30, y=c(23.85, 28.805, 28.195, 26.23, 25.005, 20.475,
>>     
> 17.33, 14.97, 11.765, 8.857, 5.3725, 5.16, 4.2105, 2.929, 2.174, 1.25, 1.0255,
> 0.612, 0.556, 0.4025, 0.173))
>   
>> y.max <- max(values$y)
>> model <- nls(y ~ SSlogis(x, asym, xmid, scal), data=values, algorithm="port",
>>     
> start=c(asym=y.max, xmid=15, scal=-0.5), upper=c(y.max, Inf, Inf))
>
> This used to work with R version 2.5.1 patched.
> The problem does _not_ occur if the parameter "scal=-0.5" in the nls call is
> changed, e. g. to "scal=-0.6" or "scal=-0.4".
> Simply calling "model <- nls(y ~ SSlogis(x, asym, xmid, scal), data=values)"
> also works, but this does not use the upper bound for the asym parameter, which
> was the point.
>
>   
"Linux" is not a good enough description of your platform.

This works fine on SUSE 10.2/x86_64.


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From h.wickham at gmail.com  Fri Jan  4 19:13:15 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 4 Jan 2008 12:13:15 -0600
Subject: [Rd] Unicode whitespace
Message-ID: <f8e6ff050801041013y586ed491lbffb0370c1e35b0d@mail.gmail.com>

It would be nice if R ignored more unicode white space characters.
For example, if I have  "\u2028" in a command (which I get from a
line-break in keynote) I get the following error:

> qplot(carat, price, data = diamonds, 
  colour=clarity)
Error: unexpected input in "qplot(carat, price, data = diamonds, ?"

And occasionally have such problems when copying and pasting from
emails as well.

Wikipedia lists the following codepoints as whitespace (I'm sure there
is a more definitive reference but I could not find one with some
quick googling):

U0009-U000D (Control characters, containing TAB, CR and LF)
U0020 SPACE
U0085 NEL
U00A0 NBSP
U1680 OGHAM SPACE MARK
U180E MONGOLIAN VOWEL SEPARATOR
U2000-U200A (different sorts of spaces)
U2028 LSP
U2029 PSP
U202F NARROW NBSP
U205F MEDIUM MATHEMATICAL SPACE
U3000 IDEOGRAPHIC SPACE

would it be possible for R to treat these all in the same way? (Or
does it already but my R is misconfigured?)

Hadley

-- 
http://had.co.nz/

From therneau at mayo.edu  Fri Jan  4 21:15:17 2008
From: therneau at mayo.edu (Terry Therneau)
Date: Fri, 4 Jan 2008 14:15:17 -0600 (CST)
Subject: [Rd] Evaluating R expressions from C
Message-ID: <200801042015.m04KFHF03452@hsrnfs-101.mayo.edu>

I am currently puzzled by a passage in the R Extensions manual, section 5.10:

SEXP lapply(SEXP list, SEXP expr, SEXP rho)
     {
       R_len_t i, n = length(list);
       SEXP ans;
     
       if(!isNewList(list)) error("`list' must be a list");
       if(!isEnvironment(rho)) error("`rho' should be an environment");
       PROTECT(ans = allocVector(VECSXP, n));
       for(i = 0; i < n; i++) {
         defineVar(install("x"), VECTOR_ELT(list, i), rho);
         SET_VECTOR_ELT(ans, i, eval(expr, rho));
       }
    
I'm trying to understand this code beyond just copying it, and don't find 
definitions for many of the calls.  PROTECT and SEXP have been well discussed 
previously in the document, but what exactly are
	R_len_t
	defineVar
	install
	VECTOR_ELT
	SET_VECTOR_ELT
	
The last I also found in 5.7.4, but it's not defined there either.  

So:
   What do these macros do?  Some I could guess, like is.Environment; and I'm 
fairly confident of R_len_t.  Others I need some help.
   Perhaps they are elswhere in the document?  (My version of acrobat can't do 
searches.)  Is there another document that I should look at first?
   Why "isNewList"?  I would have guessed "isList".  What's the difference?
   
   	Thanks for any help,
   		Terry Therneau


From rgentlem at fhcrc.org  Fri Jan  4 21:45:54 2008
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Fri, 04 Jan 2008 12:45:54 -0800
Subject: [Rd] Evaluating R expressions from C
In-Reply-To: <200801042015.m04KFHF03452@hsrnfs-101.mayo.edu>
References: <200801042015.m04KFHF03452@hsrnfs-101.mayo.edu>
Message-ID: <477E9B02.9080106@fhcrc.org>

Hi Terry,

Terry Therneau wrote:
> I am currently puzzled by a passage in the R Extensions manual, section 5.10:
> 
> SEXP lapply(SEXP list, SEXP expr, SEXP rho)
>      {
>        R_len_t i, n = length(list);
>        SEXP ans;
>      
>        if(!isNewList(list)) error("`list' must be a list");
>        if(!isEnvironment(rho)) error("`rho' should be an environment");
>        PROTECT(ans = allocVector(VECSXP, n));
>        for(i = 0; i < n; i++) {
>          defineVar(install("x"), VECTOR_ELT(list, i), rho);
>          SET_VECTOR_ELT(ans, i, eval(expr, rho));
>        }
>     
> I'm trying to understand this code beyond just copying it, and don't find 
> definitions for many of the calls.  PROTECT and SEXP have been well discussed 
> previously in the document, but what exactly are
> 	R_len_t
> 	defineVar

        this function defines the variable (SYMSXP; one type of SEXP) of 
its first argument, to have the value given by its second argument, in 
the environment defined by its third argument. There are lots of 
variants, these are largely in envir.c


> 	install

   all symbols in R are unique (there is only one symbol named x, even 
though it might have bindings in many different environments). So to get 
the unique "thing" (a SYMSXP) you call install (line 1067 in names.c has 
a pretty brief comment to this effect). This makes it efficient to do 
variable look up, as we only need to compare pointers (within an 
environment), not compare names.

> 	VECTOR_ELT

     access the indicated element (2nd arg) of the vector (first arg)

> 	SET_VECTOR_ELT

      set the indicated element (2nd arg), of the vector (1st arg) to 
the value (3rd arg)

> 	
> The last I also found in 5.7.4, but it's not defined there either.  
> 
> So:
>    What do these macros do?  Some I could guess, like is.Environment; and I'm 
> fairly confident of R_len_t.  Others I need some help.
>    Perhaps they are elswhere in the document?  (My version of acrobat can't do 
> searches.)  Is there another document that I should look at first?
>    Why "isNewList"?  I would have guessed "isList".  What's the difference?

    "old lists" are of the CAR-CDR variant, and largely only used 
internally these days.  "new lists", are generic vectors, and are what 
users will almost always encounter (even users that program internals, 
you pretty much need to be messing with the language itself to run into 
the CAR-CDR variety).

    best wishes
     Robert

>    
>    	Thanks for any help,
>    		Terry Therneau
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From therneau at mayo.edu  Fri Jan  4 22:38:10 2008
From: therneau at mayo.edu (Terry Therneau)
Date: Fri, 4 Jan 2008 15:38:10 -0600 (CST)
Subject: [Rd] Evaluating R expressions
Message-ID: <200801042138.m04LcAF13105@hsrnfs-101.mayo.edu>

All,
  Thank you for the prompt and useful answers to my questions.
  
  I had missed references in 5.7.6 which would have answered some of the points. 
As Bill pointed out a newer version of acrobat would help, but the Sun system 
here is still running 5.0.  (An oversubscribed sysadmin).  Then I could have 
searched and at at least avoided the most trivial.
  All three comments were different, and all three helped.
 
  Terry T.
  
"I see" said the blind carpenter, as he picked up his hammer and saw.  (A 
favorite phrase of my mother's when something became clear).


From ripley at stats.ox.ac.uk  Fri Jan  4 23:00:51 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 4 Jan 2008 22:00:51 +0000 (GMT)
Subject: [Rd] checking whether the name space can be loaded with stated
 dependencies
In-Reply-To: <f8e6ff050801040615t3469f32cldfe27bedc5539b1@mail.gmail.com>
References: <f8e6ff050801031831j36005a1cw8449a6f65481845b@mail.gmail.com> 
	<Pine.LNX.4.64.0801040237590.26624@gannet.stats.ox.ac.uk>
	<f8e6ff050801040615t3469f32cldfe27bedc5539b1@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0801042155140.30877@gannet.stats.ox.ac.uk>

On Fri, 4 Jan 2008, hadley wickham wrote:

> On 1/4/08, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>> What it is trying is
>>
>> % env R_DEFAULT_PACKAGES=NULL R
>>
>>> loadNamespace("ggplot2")
>>
>> The test is not new, so it would seem to be a change in ggplot2 since the
>> version on CRAN.  My guess is the your package is doing top-level
>> computations, which `Writing R Extensions' warns against:
>>
>>    The R code files should only create R objects and not call functions
>>    with side effects such as require and options.
>
> Thanks for the additional info. I've grepped for ^[^#\n ]+\(  (which I
> think should find any top-level function call) and didn't find
> anything. I certainly can't think of any top level computations that
> I'm doing apart from creating R functions and objects.  Is there
> anyway to get more details about what exactly I've done wrong?

As I said, that was a guess: if it is not the cause then I am in the dark.
If you can send me the version doing this I can try to dig further.

> Calling traceback after loadNamespace isn't helpful.
>
>> If you must deviate from that, you need to arrange for the environment you
>> need: when loading a name space the Depends: packages are not loaded.
>
> Is this a recent change to R?

No: that wording is ancient, and the test is not recent.

> The package appears to work fine after
> installation so I presume this check is protecting me from some more
> subtle danger.

The danger is that if some other package (or a user) does 
ggplot2::some_function_in_ggplot2 that this will fail if the package is 
not attached, similarly if a package name space imports from ggplot2.

> If it's helpful, my depends line is:
> Depends: R (>= 2.6), grid, reshape (>= 0.8.0), proto, splines, MASS,
>  RColorBrewer, colorspace
>
> so only proto or RColorBrewer should be a problem.
>
> Hadley
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at stat.berkeley.edu  Fri Jan  4 23:54:57 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Fri, 4 Jan 2008 23:54:57 +0100
Subject: [Rd] checking whether the name space can be loaded with stated
	dependencies
In-Reply-To: <f8e6ff050801040615t3469f32cldfe27bedc5539b1@mail.gmail.com>
References: <f8e6ff050801031831j36005a1cw8449a6f65481845b@mail.gmail.com>
	<Pine.LNX.4.64.0801040237590.26624@gannet.stats.ox.ac.uk>
	<f8e6ff050801040615t3469f32cldfe27bedc5539b1@mail.gmail.com>
Message-ID: <59d7961d0801041454t8edfe8bre4fdcfa10cc5342d@mail.gmail.com>

On 04/01/2008, hadley wickham <h.wickham at gmail.com> wrote:
> On 1/4/08, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> > What it is trying is
> >
> > % env R_DEFAULT_PACKAGES=NULL R
> >
> > > loadNamespace("ggplot2")
> >
> > The test is not new, so it would seem to be a change in ggplot2 since the
> > version on CRAN.  My guess is the your package is doing top-level
> > computations, which `Writing R Extensions' warns against:
> >
> >    The R code files should only create R objects and not call functions
> >    with side effects such as require and options.
>
> Thanks for the additional info. I've grepped for ^[^#\n ]+\(  (which I
> think should find any top-level function call) and didn't find

Not the correct pattern; there can be spaces after the function name
the first parentesis, e.g.

> rnorm   (3)
[1]  0.6127487  0.8150284 -0.7170449

More, the above regular expression will not detect function calls
starting with a space, neither expressions such as "3+3" although I
don't think they would generate the above NOTE/error.

> pattern <- "^[^#\n ]+\\("
> regexpr(pattern, "rnorm(3)")
[1] 1
> regexpr(pattern, "rnorm   (3)")
[1] -1
> regexpr(pattern, " rnorm(3)")
[1] -1
> regexpr(pattern, "3+3")
[1] -1

Also, what is the newline ('\n') doing in the negated set - isn't grep
done line by line?

> anything. I certainly can't think of any top level computations that
> I'm doing apart from creating R functions and objects.  Is there
> anyway to get more details about what exactly I've done wrong?
> Calling traceback after loadNamespace isn't helpful.

Start commenting out/exclude part of your source code and recheck for
the same error should do.  Start from scratch by adding a

foo <- function() { NA }

and exclude everything else.  If that works, leave 1st half out, then
2nd and continue with "divide and conquer" until you narrow down the
problem.  Sometimes it comes down to a single right bracket missed
out.

/Henrik


>
> > If you must deviate from that, you need to arrange for the environment you
> > need: when loading a name space the Depends: packages are not loaded.
>
> Is this a recent change to R? The package appears to work fine after
> installation so I presume this check is protecting me from some more
> subtle danger.
>
> If it's helpful, my depends line is:
> Depends: R (>= 2.6), grid, reshape (>= 0.8.0), proto, splines, MASS,
>   RColorBrewer, colorspace
>
> so only proto or RColorBrewer should be a problem.
>
> Hadley
>
> --
> http://had.co.nz/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From hendrik.weisser at gmx.net  Fri Jan  4 21:35:13 2008
From: hendrik.weisser at gmx.net (hendrik.weisser at gmx.net)
Date: Fri,  4 Jan 2008 21:35:13 +0100 (CET)
Subject: [Rd] Addendum: nls (with SSlogis model and upper limit) never
	returns (PR#10548)
Message-ID: <20080104203513.1E2D9283484A@mail.pubhealth.ku.dk>

Peter Dalgaard reminded me to be more specific about my computing platform; it's Debian 4.1.1-19 on a 32-bit Pentium 4 machine (Dell Optiplex GX620).

The problem I described (nls not returning) also occurs with different data at other values of the scal parameter.


Regards

Hendrik Weisser
--


From h.wickham at gmail.com  Sat Jan  5 01:24:14 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 4 Jan 2008 18:24:14 -0600
Subject: [Rd] checking whether the name space can be loaded with stated
	dependencies
In-Reply-To: <59d7961d0801041454t8edfe8bre4fdcfa10cc5342d@mail.gmail.com>
References: <f8e6ff050801031831j36005a1cw8449a6f65481845b@mail.gmail.com>
	<Pine.LNX.4.64.0801040237590.26624@gannet.stats.ox.ac.uk>
	<f8e6ff050801040615t3469f32cldfe27bedc5539b1@mail.gmail.com>
	<59d7961d0801041454t8edfe8bre4fdcfa10cc5342d@mail.gmail.com>
Message-ID: <f8e6ff050801041624u735947e3yab22528acbd441d9@mail.gmail.com>

On 1/4/08, Henrik Bengtsson <hb at stat.berkeley.edu> wrote:
> On 04/01/2008, hadley wickham <h.wickham at gmail.com> wrote:
> > On 1/4/08, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> > > What it is trying is
> > >
> > > % env R_DEFAULT_PACKAGES=NULL R
> > >
> > > > loadNamespace("ggplot2")
> > >
> > > The test is not new, so it would seem to be a change in ggplot2 since the
> > > version on CRAN.  My guess is the your package is doing top-level
> > > computations, which `Writing R Extensions' warns against:
> > >
> > >    The R code files should only create R objects and not call functions
> > >    with side effects such as require and options.
> >
> > Thanks for the additional info. I've grepped for ^[^#\n ]+\(  (which I
> > think should find any top-level function call) and didn't find
>
> Not the correct pattern; there can be spaces after the function name
> the first parentesis, e.g.
>
> > rnorm   (3)
> [1]  0.6127487  0.8150284 -0.7170449

Well, yes, but I never write functions like that, and I hardly need to
search my own code for idioms that I never use.

> More, the above regular expression will not detect function calls
> starting with a space, neither expressions such as "3+3" although I
> don't think they would generate the above NOTE/error.
>
> > pattern <- "^[^#\n ]+\\("
> > regexpr(pattern, "rnorm(3)")
> [1] 1
> > regexpr(pattern, "rnorm   (3)")
> [1] -1
> > regexpr(pattern, " rnorm(3)")
> [1] -1
> > regexpr(pattern, "3+3")
> [1] -1
>
> Also, what is the newline ('\n') doing in the negated set - isn't grep
> done line by line?

I wasn't actually using grep.

> > anything. I certainly can't think of any top level computations that
> > I'm doing apart from creating R functions and objects.  Is there
> > anyway to get more details about what exactly I've done wrong?
> > Calling traceback after loadNamespace isn't helpful.
>
> Start commenting out/exclude part of your source code and recheck for
> the same error should do.  Start from scratch by adding a
>
> foo <- function() { NA }
>
> and exclude everything else.  If that works, leave 1st half out, then
> 2nd and continue with "divide and conquer" until you narrow down the
> problem.  Sometimes it comes down to a single right bracket missed
> out.

Unfortunately a binary search isn't so easy when you have fairly
complex dependencies between files.

Hadley

-- 
http://had.co.nz/


From timh at insightful.com  Sat Jan  5 02:05:08 2008
From: timh at insightful.com (timh at insightful.com)
Date: Sat,  5 Jan 2008 02:05:08 +0100 (CET)
Subject: [Rd] is(x, "parent") returns FALSE when class(x) is c("child",
	"parent") (PR#10549)
Message-ID: <20080105010508.D5D1B2834847@mail.pubhealth.ku.dk>

is() does not catch parent S3 classes:
> library(splines)
> temp <- bs(1:99, df=5)
> class(temp)
[1] "bs"    "basis"
> is(temp, "basis")
[1] FALSE

In contrast, is() does catch parent S4 classes:
> library(copula)
> norm.cop <- ellipCopula("normal", param = c(0.5, 0.6, 0.7),
+                         dim = 3, dispstr = "un")
> is(norm.cop, "copula")
[1] TRUE
> class(norm.cop)
[1] "normalCopula"


--please do not edit the information below--

Version:
 platform = i386-pc-mingw32
 arch = i386
 os = mingw32
 system = i386, mingw32
 status = 
 major = 2
 minor = 6.1
 year = 2007
 month = 11
 day = 26
 svn rev = 43537
 language = R
 version.string = R version 2.6.1 (2007-11-26)

Windows XP (build 2600) Service Pack 2.0

Locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MONETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

Search Path:
 .GlobalEnv, package:splines, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, package:methods, Autoloads, package:base


From ripley at stats.ox.ac.uk  Sat Jan  5 08:40:41 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 5 Jan 2008 07:40:41 +0000 (GMT)
Subject: [Rd] Unicode whitespace
In-Reply-To: <f8e6ff050801041013y586ed491lbffb0370c1e35b0d@mail.gmail.com>
References: <f8e6ff050801041013y586ed491lbffb0370c1e35b0d@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0801050715280.28380@gannet.stats.ox.ac.uk>

I presume you want this only in a UTF-8 locale?

Currently this is done by

static int SkipSpace(void)
{
     int c;
     while ((c = xxgetc()) == ' ' || c == '\t' || c == '\f')
 	/* nothing */;
     return c;
}

in gram.c.  We could make use of isspace and its wide-char equivalent 
iswspace.  However:


- there is the perennial debate over whether \v is whitespace.

R-lang says

   Although not strictly tokens, stretches of whitespace characters
   (spaces and tabs) serve to delimit tokens in case of ambiguity,

which suggests it has a minimal view of whitespace.


- iswspace is often rather unreliable.  E.g. glibc says

     The wide character class "space" always contains  at  least  the  space
     character and the control characters '\f', '\n', '\r', '\t', '\v'.

and I think it usually does not contain other forms of spaces.  More 
seriously

     The  behaviour  of  iswspace()  depends on the LC_CTYPE category of the
     current locale.

so what is a space will depend on the encoding (hence my question about 
UTF-8).  And Ei-ji Makama was replaced iswspace on MacOS X, because 
apparently it is wrongly implemented.


- it would complicate the parser as look-ahead would be needed (you would 
need to read the next mbcs, check it it were whitespace and pushback if 
needed).  We do that elsewhere, though.


The only one of these 'spaces' I have much sympathy for is NBSP (which is 
also fairly easy to generate in CP1252).  It would be easy to add that.
Otherwise I am not convinced it is worth the work (and added uncertainty).



On Fri, 4 Jan 2008, hadley wickham wrote:

> It would be nice if R ignored more unicode white space characters.
> For example, if I have  "\u2028" in a command (which I get from a
> line-break in keynote) I get the following error:
>
>> qplot(carat, price, data = diamonds, ??  colour=clarity)
> Error: unexpected input in "qplot(carat, price, data = diamonds, ?"
>
> And occasionally have such problems when copying and pasting from
> emails as well.
>
> Wikipedia lists the following codepoints as whitespace (I'm sure there
> is a more definitive reference but I could not find one with some
> quick googling):
>
> U0009-U000D (Control characters, containing TAB, CR and LF)

Most of those are not normally considered whitespace.

> U0020 SPACE
> U0085 NEL
> U00A0 NBSP
> U1680 OGHAM SPACE MARK
> U180E MONGOLIAN VOWEL SEPARATOR
> U2000-U200A (different sorts of spaces)
> U2028 LSP
> U2029 PSP
> U202F NARROW NBSP
> U205F MEDIUM MATHEMATICAL SPACE
> U3000 IDEOGRAPHIC SPACE
>
> would it be possible for R to treat these all in the same way? (Or
> does it already but my R is misconfigured?)
>
> Hadley
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From maechler at stat.math.ethz.ch  Sat Jan  5 10:45:30 2008
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Sat,  5 Jan 2008 10:45:30 +0100 (CET)
Subject: [Rd] nls (with SSlogis model and upper limit) never returns
	(PR#10544)
Message-ID: <20080105094530.EFBFB2834847@mail.pubhealth.ku.dk>

>>>>> "PD" == Peter Dalgaard <P.Dalgaard at biostat.ku.dk>
>>>>>     on Fri, 04 Jan 2008 18:23:33 +0100 writes:

    PD> hendrik.weisser at gmx.net wrote:
    >> Full_Name: Hendrik Weisser
    >> Version: 2.6.1
    >> OS: Linux
    >> Submission from: (NULL) (139.19.102.218)
    >> 
    >> 
    >> The following computation never finishes and locks R up:
    >> 
    >> 
    >>> values <- list(x=10:30, y=c(23.85, 28.805, 28.195, 26.23, 25.005, 20.475,
    >>> 
    >> 17.33, 14.97, 11.765, 8.857, 5.3725, 5.16, 4.2105, 2.929, 2.174, 1.25, 1.0255,
    >> 0.612, 0.556, 0.4025, 0.173))
    >> 
    >>> y.max <- max(values$y)
    >>> model <- nls(y ~ SSlogis(x, asym, xmid, scal), data=values, algorithm="port",
    >>> 
    >> start=c(asym=y.max, xmid=15, scal=-0.5), upper=c(y.max, Inf, Inf))
    >> 
    >> This used to work with R version 2.5.1 patched.
    >> The problem does _not_ occur if the parameter "scal=-0.5" in the nls call is
    >> changed, e. g. to "scal=-0.6" or "scal=-0.4".
    >> Simply calling "model <- nls(y ~ SSlogis(x, asym, xmid, scal), data=values)"
    >> also works, but this does not use the upper bound for the asym parameter, which
    >> was the point.


    PD> "Linux" is not a good enough description of your platform.

    PD> This works fine on SUSE 10.2/x86_64.

It also works fine for me on

- Ubuntu 7.10("gutsy") i686
- Redhat EL 5  	       x86_64

Martin

    PD> -- 
    PD> O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
    PD> c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
    PD> (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
    PD> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From maechler at stat.math.ethz.ch  Sat Jan  5 11:00:15 2008
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Sat,  5 Jan 2008 11:00:15 +0100 (CET)
Subject: [Rd] is(x, "parent") returns FALSE when class(x) is c("child",
	"parent") (PR#10549)
Message-ID: <20080105100015.230A52834847@mail.pubhealth.ku.dk>

>>>>> "TimH" == timh  <timh at insightful.com>
>>>>>     on Sat,  5 Jan 2008 02:05:08 +0100 (CET) writes:

    TimH> is() does not catch parent S3 classes:

    >> library(splines)
    >> temp <- bs(1:99, df=5)
    >> class(temp)
    TimH> [1] "bs"    "basis"
    >> is(temp, "basis")
    TimH> [1] FALSE

    TimH> In contrast, is() does catch parent S4 classes:
    >> library(copula)
    >> norm.cop <- ellipCopula("normal", param = c(0.5, 0.6, 0.7),
    TimH> +                         dim = 3, dispstr = "un")
    >> is(norm.cop, "copula")
    TimH> [1] TRUE
    >> class(norm.cop)
    TimH> [1] "normalCopula"

Yes, that's all correct, but where's the bug?

S3 has *NO* class definitions, so how can there be class
inheritance?
There's many reasons to go from S3 to S4, and the lack of class
definitions in S3 is an important one...

Now, still being curious:  Are you implicitly saying that in S-plus,
is() behaves differently, namely 
``as if S3 classes would exist?'' (:-)

[Of course, I understand what you mean, and I agree that
 normally, the S3  class attribute  c("ch", "pr") means that "ch"
 is conceptually a child of "pr".
 
 However, there's at least one exception in R {which I have found a
 bit unfortunate, but never followed up}:

   > class(Sys.time())
   [1] "POSIXt"  "POSIXct"
]

Regards,
Martin

    TimH> Version:
    .....
    TimH> version.string = R version 2.6.1 (2007-11-26)
    .....


From bolker at ufl.edu  Sat Jan  5 15:49:49 2008
From: bolker at ufl.edu (Ben Bolker)
Date: Sat, 5 Jan 2008 14:49:49 +0000 (UTC)
Subject: [Rd]
	=?utf-8?q?Addendum=3A_nls_=28with_SSlogis_model_and_upper_li?=
	=?utf-8?q?mit=29_never=09returns_=28PR=2310548=29?=
References: <20080104203513.1E2D9283484A@mail.pubhealth.ku.dk>
Message-ID: <loom.20080105T144832-652@post.gmane.org>

 <hendrik.weisser <at> gmx.net> writes:

> 
> Peter Dalgaard reminded me to be more specific about my computing platform;
it's Debian 4.1.1-19 on a
> 32-bit Pentium 4 machine (Dell Optiplex GX620).
> 
> The problem I described (nls not returning) also occurs with different 
> data at
> other values of the scal parameter.
> 
> Regards
> 
> Hendrik Weisser
> --
> 

  Hmm.
  Works fine with Ubuntu 7.10 (gutsy) for me:

> sessionInfo()
R version 2.6.1 (2007-11-26) 
i486-pc-linux-gnu 

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;
LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;
LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;
LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     
>


From tplate at acm.org  Sat Jan  5 20:11:46 2008
From: tplate at acm.org (Tony Plate)
Date: Sat, 05 Jan 2008 12:11:46 -0700
Subject: [Rd] is(x, "parent") returns FALSE when class(x) is c("child",
 "parent") (PR#10549)
In-Reply-To: <20080105100015.230A52834847@mail.pubhealth.ku.dk>
References: <20080105100015.230A52834847@mail.pubhealth.ku.dk>
Message-ID: <477FD672.50906@acm.org>

maechler at stat.math.ethz.ch wrote:
>>>>>> "TimH" == timh  <timh at insightful.com>
>>>>>>     on Sat,  5 Jan 2008 02:05:08 +0100 (CET) writes:
>>>>>>             
>
>     TimH> is() does not catch parent S3 classes:
>
>     >> library(splines)
>     >> temp <- bs(1:99, df=5)
>     >> class(temp)
>     TimH> [1] "bs"    "basis"
>     >> is(temp, "basis")
>     TimH> [1] FALSE
>
>     TimH> In contrast, is() does catch parent S4 classes:
>     >> library(copula)
>     >> norm.cop <- ellipCopula("normal", param = c(0.5, 0.6, 0.7),
>     TimH> +                         dim = 3, dispstr = "un")
>     >> is(norm.cop, "copula")
>     TimH> [1] TRUE
>     >> class(norm.cop)
>     TimH> [1] "normalCopula"
>
> Yes, that's all correct, but where's the bug?
>
> S3 has *NO* class definitions, so how can there be class
> inheritance?
>   
These types of statements make me really confused (and I suspect far 
more than necessary).  Isn't 'inherits()' an S3 function?  (at least 
it's not in package "methods", and it works with S3 classes, while 'is' 
is in the "methods" package).

The inherits documentation says:
Details:

     Many R objects have a 'class' attribute, a character vector giving
     the names of the classes from which the object _inherits_. If the
     object does not have a class attribute, it has an implicit class,
     '"matrix"', '"array"' or the result of 'mode(x)' (except that
     integer vectors have implicit class '"integer"').  (Functions
     'oldClass' and 'oldClass<-' get and set the attribute, which can
     also be done directly.)

But if S3 has no class definitions, and that fact precludes class 
inheritance, how come the inherits() functions exists and works with S3 
"classes" and inherits() documentation talks about classes and inheritance?

And it looks like 'inherits()' does what (I think) Tim Hesterberg is 
looking for:

 > x <- structure(1, class=c("a", "ab", "abc"))
 > is(x, "a")
[1] TRUE
 > is(x, "ab")
[1] FALSE
 > inherits(x, "a")
[1] TRUE
 > inherits(x, "ab")
[1] TRUE
 >


> There's many reasons to go from S3 to S4, and the lack of class
> definitions in S3 is an important one...
>
> Now, still being curious:  Are you implicitly saying that in S-plus,
> is() behaves differently, namely 
> ``as if S3 classes would exist?'' (:-)
>   
Is S-PLUS 7.0, I see the following behavior:

 > x <- structure(1, class=c("a", "ab"))
Warning in checkOldClass(c("a", "ab")): No formal definition of 
old-style inheritance; consider setOldClass(c("a",
 "ab"))
 > inherits(x, "a")
[1] T
 > inherits(x, "ab")
[1] T
 > is(x, "a")
[1] T
 > is(x, "ab")
[1] T
 >

Which would make it appear that in S-PLUS, for objects with S3 classes 
the function "is" uses the definition of the concept "inherits" that 
appears in the R documentation for the function "inherits" :-)  (But, 
apparently, S3 classes don't exist, so does that make R an imaginary 
language except when one uses S4 classes? :-)

-- Tony Plate

> [Of course, I understand what you mean, and I agree that
>  normally, the S3  class attribute  c("ch", "pr") means that "ch"
>  is conceptually a child of "pr".
>  
>  However, there's at least one exception in R {which I have found a
>  bit unfortunate, but never followed up}:
>
>    > class(Sys.time())
>    [1] "POSIXt"  "POSIXct"
> ]
>
> Regards,
> Martin
>
>     TimH> Version:
>     .....
>     TimH> version.string = R version 2.6.1 (2007-11-26)
>     .....
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From davison at stats.ox.ac.uk  Sat Jan  5 20:34:07 2008
From: davison at stats.ox.ac.uk (Dan Davison)
Date: Sat, 5 Jan 2008 19:34:07 +0000
Subject: [Rd] Rscript argument processing minor bug with -g
Message-ID: <20080105193407.GA13024@stats.ox.ac.uk>

I think there's a minor bug in the argument-processing carried out by Rscript.
The effect is that if one passes "-g" as a flag to the script, it is erroneously 
exposed to the main executable's argument processing and therefore generates a 
message about not being able to comply with the request for a particular GUI. 
Uppercase G is fine as are the other 25 letters in upper or lower case.

I noticed this with R-2.5.1 and carried out the tests below with R-devel-2.7.0.

Dan

platform       i686-pc-linux-gnu                                               
arch           i686                                                            
os             linux-gnu                                                       
system         i686, linux-gnu                                                 
status         Under development (unstable)                                    
major          2                                                               
minor          7.0                                                             
year           2008                                                            
month          01                                                              
day            04                                                              
svn rev        43862                                                           
language       R                                                               
version.string R version 2.7.0 Under development (unstable) (2008-01-04 r43862)

[fedora core 5]

## No problem with -a -b -f -h

~/src/scripts/R> /usr/src/R/R-devel/bin/Rscript -e "commandArgs()" -a -b -f -h
 [1] "/usr/src/R/R-devel/bin/exec/R" "--slave"                      
 [3] "--no-restore"                  "-e"                           
 [5] "commandArgs()"                 "--args"                       
 [7] "-a"                            "-b"                           
 [9] "-f"                            "-h"   

## But if -g is in there, there's a warning message

~/src/scripts/R> /usr/src/R/R-devel/bin/Rscript -e "commandArgs()" -a -b -f -g -h
WARNING: unknown gui '-h', using X11

 [1] "/usr/src/R/R-devel/bin/exec/R" "--slave"                      
 [3] "--no-restore"                  "-e"                           
 [5] "commandArgs()"                 "--args"                       
 [7] "-a"                            "-b"                           
 [9] "-f"                            "-g"                           
[11] "-h"                           

~/src/scripts/R> /usr/src/R/R-devel/bin/Rscript -e "commandArgs()" -a -b -f -g not_a_gui -h
WARNING: unknown gui 'not_a_gui', using X11

 [1] "/usr/src/R/R-devel/bin/exec/R" "--slave"                      
 [3] "--no-restore"                  "-e"                           
 [5] "commandArgs()"                 "--args"                       
 [7] "-a"                            "-b"                           
 [9] "-f"                            "-g"                           
[11] "not_a_gui"                     "-h"      

## The problem remains if the R code is in a file rather than in-line,
## and also with a #! style script:

~/src/scripts/R> cat test.R 
#!/usr/src/R/R-devel/bin/Rscript
commandArgs()

~/src/scripts/R> ./test.R -a -g invalid_gui
WARNING: unknown gui 'invalid_gui', using X11

[1] "/usr/src/R/R-devel/bin/exec/R" "--slave"                      
[3] "--no-restore"                  "--file=./test.R"              
[5] "--args"                        "-a"                           
[7] "-g"                            "invalid_gui"        

~/src/scripts/R> cat test2.R 
commandArgs()
~/src/scripts/R> /usr/src/R/R-devel/bin/Rscript test2.R -a -g
WARNING: --gui or -g without value ignored
[1] "/usr/src/R/R-devel/bin/exec/R" "--slave"                      
[3] "--no-restore"                  "--file=test2.R"               
[5] "--args"                        "-a"                           
[7] "-g"


From jmc at r-project.org  Sat Jan  5 21:29:55 2008
From: jmc at r-project.org (John Chambers)
Date: Sat, 05 Jan 2008 12:29:55 -0800
Subject: [Rd] is(x, "parent") returns FALSE when class(x) is c("child",
 "parent") (PR#10549)
In-Reply-To: <477FD672.50906@acm.org>
References: <20080105100015.230A52834847@mail.pubhealth.ku.dk>
	<477FD672.50906@acm.org>
Message-ID: <477FE8C3.9020900@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080105/c04cf066/attachment.pl 

From maechler at stat.math.ethz.ch  Sat Jan  5 22:26:42 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 5 Jan 2008 22:26:42 +0100
Subject: [Rd] is(x, "parent") returns FALSE when class(x) is c("child",
	"parent") (PR#10549)
In-Reply-To: <477FD672.50906@acm.org>
References: <20080105100015.230A52834847@mail.pubhealth.ku.dk>
	<477FD672.50906@acm.org>
Message-ID: <18303.62994.578842.888135@ada-stat.math.ethz.ch>

>>>>> "TP" == Tony Plate <tplate at acm.org>
>>>>>     on Sat, 05 Jan 2008 12:11:46 -0700 writes:

    TP> maechler at stat.math.ethz.ch wrote:
    >>>>>>> "TimH" == timh  <timh at insightful.com>
    >>>>>>> on Sat,  5 Jan 2008 02:05:08 +0100 (CET) writes:
    >>>>>>> 
    >> 
    TimH> is() does not catch parent S3 classes:
    >> 
    >> >> library(splines)
    >> >> temp <- bs(1:99, df=5)
    >> >> class(temp)
    TimH> [1] "bs"    "basis"
    >> >> is(temp, "basis")
    TimH> [1] FALSE
    >> 
    TimH> In contrast, is() does catch parent S4 classes:
    >> >> library(copula)
    >> >> norm.cop <- ellipCopula("normal", param = c(0.5, 0.6, 0.7),
    TimH> +                         dim = 3, dispstr = "un")
    >> >> is(norm.cop, "copula")
    TimH> [1] TRUE
    >> >> class(norm.cop)
    TimH> [1] "normalCopula"
    >> 
    >> Yes, that's all correct, but where's the bug?
    >> 
    >> S3 has *NO* class definitions, so how can there be class
    >> inheritance?

    TP> These types of statements make me really confused (and I suspect far 
    TP> more than necessary).  Isn't 'inherits()' an S3 function?  (at least 
    TP> it's not in package "methods", and it works with S3 classes, while 'is' 
    TP> is in the "methods" package).


John already kindly answered, but yes, indeed, my statements
must have been somewhat confusing.

Prompted by Tim's ("child", "parent"), 
I was talking about *class* inheritance (which does not exist
for S3) but with his question/remark/bug report about 
     is(<obj>, <class>) 
Tim was really concerned with *objects* inheriting from classes
and Tony's answer about  inherits() vs is() was well appropriate.

When I was talking about class inheritance,
I was talking about "parent child relationships" between
classes, where "the answer" is extends(), not is().

E.g.

  > library(Matrix)
  > extends("dgCMatrix", "CsparseMatrix")
  [1] TRUE
  > extends("CsparseMatrix", "sparseMatrix")
  [1] TRUE
  > extends("sparseMatrix", "Matrix")
  [1] TRUE

And last year, I've finished a small CRAN package,  called 'classGraph',
which nicely visualizes such  class inheritance by drawing
graphs (using the bioconductor packages 'Rgraphviz' and 'graph'):

library(Matrix)
library(classGraph)
cg2. <- class2Graph("dgCMatrix", fullNames=FALSE)
plot(cg2.)


then produces the attached plot which *is* all about class
inheritance, only present in S4, but, again, I apologize for
confusing you, since Tim really needed the "class instance" or
"object -> class" inheritance. 

Martin

-------------- next part --------------
A non-text attachment was scrubbed...
Name: dgCMatrix-class-graph.png
Type: image/png
Size: 4873 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20080105/ce13a874/attachment.png 

From ggrothendieck at gmail.com  Sun Jan  6 06:06:38 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 6 Jan 2008 00:06:38 -0500
Subject: [Rd] nls (with SSlogis model and upper limit) never returns
	(PR#10544)
In-Reply-To: <20080104144526.F378D2834618@mail.pubhealth.ku.dk>
References: <20080104144526.F378D2834618@mail.pubhealth.ku.dk>
Message-ID: <971536df0801052106h442b75bbpe97c23a214293c8c@mail.gmail.com>

On my Windows Vista system it returns an answer:

> values <- list(x=10:30, y=c(23.85, 28.805, 28.195, 26.23, 25.005, 20.475,
+ 17.33, 14.97, 11.765, 8.857, 5.3725, 5.16, 4.2105, 2.929, 2.174, 1.25, 1.0255,
+ 0.612, 0.556, 0.4025, 0.173))
> y.max <- max(values$y)
> model <- nls(y ~ SSlogis(x, asym, xmid, scal), data=values, algorithm="port",
+ start=c(asym=y.max, xmid=15, scal=-0.5), upper=c(y.max, Inf, Inf))
> model
Nonlinear regression model
  model:  y ~ SSlogis(x, asym, xmid, scal)
   data:  values
  asym   xmid   scal
28.805 17.268 -2.223
 residual sum-of-squares: 32.02

Algorithm "port", convergence message: relative convergence (4)
> R.version.string # Vista
[1] "R version 2.6.1 Patched (2007-12-06 r43610)"


On Jan 4, 2008 9:45 AM,  <hendrik.weisser at gmx.net> wrote:
> Full_Name: Hendrik Weisser
> Version: 2.6.1
> OS: Linux
> Submission from: (NULL) (139.19.102.218)
>
>
> The following computation never finishes and locks R up:
>
> > values <- list(x=10:30, y=c(23.85, 28.805, 28.195, 26.23, 25.005, 20.475,
> 17.33, 14.97, 11.765, 8.857, 5.3725, 5.16, 4.2105, 2.929, 2.174, 1.25, 1.0255,
> 0.612, 0.556, 0.4025, 0.173))
> > y.max <- max(values$y)
> > model <- nls(y ~ SSlogis(x, asym, xmid, scal), data=values, algorithm="port",
> start=c(asym=y.max, xmid=15, scal=-0.5), upper=c(y.max, Inf, Inf))
>
> This used to work with R version 2.5.1 patched.
> The problem does _not_ occur if the parameter "scal=-0.5" in the nls call is
> changed, e. g. to "scal=-0.6" or "scal=-0.4".
> Simply calling "model <- nls(y ~ SSlogis(x, asym, xmid, scal), data=values)"
> also works, but this does not use the upper bound for the asym parameter, which
> was the point.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From h.wickham at gmail.com  Sun Jan  6 06:32:05 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Sat, 5 Jan 2008 23:32:05 -0600
Subject: [Rd] Unicode whitespace
In-Reply-To: <Pine.LNX.4.64.0801050715280.28380@gannet.stats.ox.ac.uk>
References: <f8e6ff050801041013y586ed491lbffb0370c1e35b0d@mail.gmail.com>
	<Pine.LNX.4.64.0801050715280.28380@gannet.stats.ox.ac.uk>
Message-ID: <f8e6ff050801052132k1d2d9f8do2cf0e550d17869b0@mail.gmail.com>

On Jan 5, 2008 1:40 AM, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> I presume you want this only in a UTF-8 locale?

Yes, although my assumption is that this will become an increasing
common locale as time goes by.

> Currently this is done by
>
> static int SkipSpace(void)
> {
>      int c;
>      while ((c = xxgetc()) == ' ' || c == '\t' || c == '\f')
>         /* nothing */;
>      return c;
> }
>
> in gram.c.  We could make use of isspace and its wide-char equivalent
> iswspace.  However:
>
>
> - there is the perennial debate over whether \v is whitespace.
>
> R-lang says
>
>    Although not strictly tokens, stretches of whitespace characters
>    (spaces and tabs) serve to delimit tokens in case of ambiguity,
>
> which suggests it has a minimal view of whitespace.
>
>
> - iswspace is often rather unreliable.  E.g. glibc says
>
>      The wide character class "space" always contains  at  least  the  space
>      character and the control characters '\f', '\n', '\r', '\t', '\v'.
>
> and I think it usually does not contain other forms of spaces.  More
> seriously
>
>      The  behaviour  of  iswspace()  depends on the LC_CTYPE category of the
>      current locale.
>
> so what is a space will depend on the encoding (hence my question about
> UTF-8).  And Ei-ji Makama was replaced iswspace on MacOS X, because
> apparently it is wrongly implemented.
>
>
> - it would complicate the parser as look-ahead would be needed (you would
> need to read the next mbcs, check it it were whitespace and pushback if
> needed).  We do that elsewhere, though.

I had assumed the parser would be unicode/mb aware already and so
would be an easy fix.  The locale issues are clearly important and
can't easily be swept under the rug.

> The only one of these 'spaces' I have much sympathy for is NBSP (which is
> also fairly easy to generate in CP1252).  It would be easy to add that.
> Otherwise I am not convinced it is worth the work (and added uncertainty).

That's reasonable.  Another related request would be treating curly
quotes (single and double) the same way as normal quotes, but I'd
imagine similar caveats would apply there.  You could also imagine
using unicode arrows in place of <- and ->, but that's probably
heading too far down the apl/fortress road!

Hadley

-- 
http://had.co.nz/


From Jerry.Lewis at biogenidec.com  Mon Jan  7 05:20:23 2008
From: Jerry.Lewis at biogenidec.com (Jerry.Lewis at biogenidec.com)
Date: Mon,  7 Jan 2008 05:20:23 +0100 (CET)
Subject: [Rd] chi-squared with zero df (PR#10551)
Message-ID: <20080107042023.4C3AF283463A@mail.pubhealth.ku.dk>

Full_Name: Jerry W. Lewis
Version: 2.6.1
OS: Windows XP Professional
Submission from: (NULL) (24.147.191.250)


pchisq(0,0,ncp=lambda) returns 0 instead of exp(-lambda/2)

pchisq(x,0,ncp=lambda) returns NaN instead of exp(-lambda/2)*(1 +
SUM_{r=0}^infty ((lambda/2)^r / r!) pchisq(x, df + 2r))

qchisq(.7,0,ncp=1) returns 1.712252 instead of 0.701297103

qchisq(exp(-1/2),0,ncp=1) returns 1.238938 instead of 0


From maechler at stat.math.ethz.ch  Mon Jan  7 09:50:15 2008
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Mon,  7 Jan 2008 09:50:15 +0100 (CET)
Subject: [Rd] chi-squared with zero df (PR#10551)
Message-ID: <20080107085015.A0855283484C@mail.pubhealth.ku.dk>

>>>>> "JL" == Jerry Lewis <Jerry.Lewis at biogenidec.com>
>>>>>     on Mon,  7 Jan 2008 05:20:23 +0100 (CET) writes:

    JL> Full_Name: Jerry W. Lewis
    JL> Version: 2.6.1
    JL> OS: Windows XP Professional
    JL> Submission from: (NULL) (24.147.191.250)

    JL> pchisq(0,0,ncp=lambda) returns 0 instead of exp(-lambda/2)

Yes. As we know,  chi-square(df=0, ncp=lambda)   has a point mass of
exp(-lambda/2) at 0.

Hence pchisq() has a corresponding jump there; strictly, it's a
matter of definition (left- / right- continuity, etc) what
pchisq() should be there, but indeed, the usual definition --
which we also follow for the discrete distributions -- 
is "cadlag" (continue ? droite, limite ? gauche), 
and you are right.

That's easily fixed.

    JL> pchisq(x,0,ncp=lambda) returns NaN 

    JL> instead of exp(-lambda/2)*(1 + SUM_{r=0}^infty
    JL>		 ((lambda/2)^r / r!) pchisq(x, df + 2r))

Not on my Linux computers; e.g.,

 > pchisq(0:10, 0,1)
  [1] 0.0000000 0.7328798 0.8193100 0.8781745 0.9181077 0.9451020 0.9632911
  [8] 0.9755110 0.9836985 0.9891706 0.9928194

but I can see the problem on Windows (Server 2003 R2, x64 edition),
where I get 

 > pchisq(0:10, 0,1)
 [1] 0 NaN NaN ... NaN

aah, and I also see it on a 32-bit Linux computer.

    JL> qchisq(.7,0,ncp=1) returns 1.712252 instead of 0.701297103

On my 64-bit Linux computer I get the correct result where as
the above Windows and our 32-bit Linux give *different* (but
wrong) results.

    JL> qchisq(exp(-1/2),0,ncp=1) returns 1.238938 instead of 0

Not on my 64-bit Linux where e.g.,

 > lam <- 1:10; qchisq(exp(-lam), 0, ncp=lam)
 [1] 2.225074e-308 2.225074e-308 2.225074e-308 2.225074e-308 2.225074e-308
 [6] 2.225074e-308 2.225074e-308 2.225074e-308 2.225074e-308 2.225074e-308

i.e. "numerically 0"

{Note that I've known about problems with our non-central chisq
 algorithms, but these were all of very extreme cases...}

In summary, we seem to have an issue with our algorithms failing
on some platforms.

I'll investigate.

Martin Maechler, ETH Zurich


From r.hankin at noc.soton.ac.uk  Mon Jan  7 10:03:27 2008
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Mon, 7 Jan 2008 09:03:27 +0000
Subject: [Rd] S3 vs S4 for a simple package
Message-ID: <CB8F09FF-2B71-4A19-BA7D-61CF056E4C22@noc.soton.ac.uk>

I am writing a package and need to decide whether to use S3 or S4.

I have a single class, "multipol"; this needs methods for "[" and "[<-"
and I also need a print (or show) method and methods for arithmetic +- 
*/^.

In S4, an object of class "multipol" has one slot that holds an array.

Objects of class "multipol" require specific arithmetic operations;  
a,b being
multipols means that a+b and a*b are defined in peculiar ways
that make sense in the context of the package. I can also add and  
multiply
by scalars (vectors of length one).

My impression is that S3 is perfectly adequate for this task, although
I've not yet finalized the coding.

S4 seems to be "overkill" for such a simple system.

Can anyone give me some motivation for persisting with S4?

Or indeed reassure me that S3 is a good design decision?



--
Robin Hankin
Uncertainty Analyst and Neutral Theorist,
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From ripley at stats.ox.ac.uk  Mon Jan  7 10:11:18 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 7 Jan 2008 09:11:18 +0000 (GMT)
Subject: [Rd] S3 vs S4 for a simple package
In-Reply-To: <CB8F09FF-2B71-4A19-BA7D-61CF056E4C22@noc.soton.ac.uk>
References: <CB8F09FF-2B71-4A19-BA7D-61CF056E4C22@noc.soton.ac.uk>
Message-ID: <Pine.LNX.4.64.0801070908360.11790@gannet.stats.ox.ac.uk>

On Mon, 7 Jan 2008, Robin Hankin wrote:

> I am writing a package and need to decide whether to use S3 or S4.
>
> I have a single class, "multipol"; this needs methods for "[" and "[<-"
> and I also need a print (or show) method and methods for arithmetic +-
> */^.
>
> In S4, an object of class "multipol" has one slot that holds an array.
>
> Objects of class "multipol" require specific arithmetic operations;
> a,b being
> multipols means that a+b and a*b are defined in peculiar ways
> that make sense in the context of the package. I can also add and
> multiply
> by scalars (vectors of length one).
>
> My impression is that S3 is perfectly adequate for this task, although
> I've not yet finalized the coding.
>
> S4 seems to be "overkill" for such a simple system.
>
> Can anyone give me some motivation for persisting with S4?
>
> Or indeed reassure me that S3 is a good design decision?

Does performance matter?: S4 dispatch is many times slower than S3 
dispatch for such functions. (It is several times slower in general, but 
the difference is particularly marked for primitives.)

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From feodor at stat.ku.dk  Mon Jan  7 14:40:05 2008
From: feodor at stat.ku.dk (feodor at stat.ku.dk)
Date: Mon,  7 Jan 2008 14:40:05 +0100 (CET)
Subject: [Rd] xtable (PR#10553)
Message-ID: <20080107134005.98C5E2834851@mail.pubhealth.ku.dk>

Full_Name: Soren Feodor Nielsen
Version: 2.5.0
OS: linux-gnu
Submission from: (NULL) (130.225.103.21)


The print-out of xtable in the following example is wrong; instead of yielding
the correct ci's for the second model it repeats the ci's from the first model.


require(xtable)
require(MASS)
data(cats)
b1<-lm(Hwt~Sex,cats)
b2<-lm(Hwt~Sex+Bwt,cats)
cbind(c(coef(b1),NA),rbind(confint(b1),c(NA,NA)),coef(b2),confint(b2))
xtable(cbind(c(coef(b1),NA),rbind(confint(b1),c(NA,NA)),coef(b2),confint(b2)))


From P.Dalgaard at biostat.ku.dk  Mon Jan  7 15:59:07 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Mon, 07 Jan 2008 15:59:07 +0100
Subject: [Rd] xtable (PR#10553)
In-Reply-To: <20080107134005.98C5E2834851@mail.pubhealth.ku.dk>
References: <20080107134005.98C5E2834851@mail.pubhealth.ku.dk>
Message-ID: <47823E3B.1040105@biostat.ku.dk>

feodor at stat.ku.dk wrote:
> Full_Name: Soren Feodor Nielsen
> Version: 2.5.0
> OS: linux-gnu
> Submission from: (NULL) (130.225.103.21)
>
>
> The print-out of xtable in the following example is wrong; instead of yielding
> the correct ci's for the second model it repeats the ci's from the first model.
>
>
> require(xtable)
> require(MASS)
> data(cats)
> b1<-lm(Hwt~Sex,cats)
> b2<-lm(Hwt~Sex+Bwt,cats)
> cbind(c(coef(b1),NA),rbind(confint(b1),c(NA,NA)),coef(b2),confint(b2))
> xtable(cbind(c(coef(b1),NA),rbind(confint(b1),c(NA,NA)),coef(b2),confint(b2)))
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   
Not for me with a current(!) version of R et al.:

> cbind(c(coef(b1),NA),rbind(confint(b1),c(NA,NA)),coef(b2),confint(b2))
                        2.5 %   97.5 %                  2.5 %   97.5 %
(Intercept) 9.202128 8.559519 9.844736 -0.41495263 -1.8528230 1.022918
SexM        2.120553 1.337588 2.903517 -0.08209684 -0.6831776 0.518984
                  NA       NA       NA  4.07576892  3.4929923 4.658546
>
xtable(cbind(c(coef(b1),NA),rbind(confint(b1),c(NA,NA)),coef(b2),confint(b2)))
% latex table generated in R 2.6.1 by xtable 1.5-2 package
% Mon Jan  7 15:38:21 2008
\begin{table}[ht]
\begin{center}
\begin{tabular}{rrrrrrr}
  \hline
 & V1 & 2.5 \% & 97.5 \% & V4 & 2.5 \% & 97.5 \% \\
  \hline
(Intercept) & 9.20 & 8.56 & 9.84 & $-$0.41 & $-$1.85 & 1.02 \\
  SexM & 2.12 & 1.34 & 2.90 & $-$0.08 & $-$0.68 & 0.52 \\
   &  &  &  & 4.08 & 3.49 & 4.66 \\
   \hline
\end{tabular}
\end{center}
\end{table}

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From maechler at stat.math.ethz.ch  Mon Jan  7 18:20:43 2008
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Mon,  7 Jan 2008 18:20:43 +0100 (CET)
Subject: [Rd] chi-squared with zero df (PR#10551)
Message-ID: <20080107172043.D0C08282EFF7@mail.pubhealth.ku.dk>

>>>>> "MM" == Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Mon,  7 Jan 2008 09:50:15 +0100 (CET) writes:

>>>>> "JL" == Jerry Lewis <Jerry.Lewis at biogenidec.com>
>>>>>     on Mon,  7 Jan 2008 05:20:23 +0100 (CET) writes:

    JL> Full_Name: Jerry W. Lewis
    JL> Version: 2.6.1
    JL> OS: Windows XP Professional
    JL> Submission from: (NULL) (24.147.191.250)

    JL> pchisq(0,0,ncp=lambda) returns 0 instead of exp(-lambda/2)

    MM> Yes. As we know,  chi-square(df=0, ncp=lambda)   has a point mass of
    MM> exp(-lambda/2) at 0.

    MM> Hence pchisq() has a corresponding jump there; strictly, it's a
    MM> matter of definition (left- / right- continuity, etc) what
    MM> pchisq() should be there, but indeed, the usual definition --
    MM> which we also follow for the discrete distributions -- 
    MM> is "cadlag" (continue ? droite, limite ? gauche), 
    MM> and you are right.

    MM> That's easily fixed.

    JL> pchisq(x,0,ncp=lambda) returns NaN 

    JL> instead of exp(-lambda/2)*(1 + SUM_{r=0}^infty
    JL> ((lambda/2)^r / r!) pchisq(x, df + 2r))

    MM> Not on my Linux computers; e.g.,

    >> pchisq(0:10, 0,1)
    MM> [1] 0.0000000 0.7328798 0.8193100 0.8781745 0.9181077 0.9451020 0.9632911
    MM> [8] 0.9755110 0.9836985 0.9891706 0.9928194

    MM> but I can see the problem on Windows (Server 2003 R2, x64 edition),
    MM> where I get 

    >> pchisq(0:10, 0,1)
    MM> [1] 0 NaN NaN ... NaN

    MM> aah, and I also see it on a 32-bit Linux computer.

and actually did see it on all computers; I was wrong above.

It's been a consequence of an "improvement" introduced for R 2.3.0;
unfortunately that made the (df=0, ncp < 80) wrongly return NaN.

Now fixed in both R-patched and R-devel.

Thank you once more for the bug report!
Martin


    JL> qchisq(.7,0,ncp=1) returns 1.712252 instead of 0.701297103

    MM> On my 64-bit Linux computer I get the correct result where as
    MM> the above Windows and our 32-bit Linux give *different* (but
    MM> wrong) results.

    JL> qchisq(exp(-1/2),0,ncp=1) returns 1.238938 instead of 0

    MM> Not on my 64-bit Linux where e.g.,

    >> lam <- 1:10; qchisq(exp(-lam), 0, ncp=lam)
    MM> [1] 2.225074e-308 2.225074e-308 2.225074e-308 2.225074e-308 2.225074e-308
    MM> [6] 2.225074e-308 2.225074e-308 2.225074e-308 2.225074e-308 2.225074e-308

    MM> i.e. "numerically 0"

    MM> {Note that I've known about problems with our non-central chisq
    MM> algorithms, but these were all of very extreme cases...}

    MM> In summary, we seem to have an issue with our algorithms failing
    MM> on some platforms.

    MM> I'll investigate.

    MM> Martin Maechler, ETH Zurich


From ripley at stats.ox.ac.uk  Mon Jan  7 19:03:10 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 7 Jan 2008 18:03:10 +0000 (GMT)
Subject: [Rd] Unicode whitespace
In-Reply-To: <f8e6ff050801052132k1d2d9f8do2cf0e550d17869b0@mail.gmail.com>
References: <f8e6ff050801041013y586ed491lbffb0370c1e35b0d@mail.gmail.com> 
	<Pine.LNX.4.64.0801050715280.28380@gannet.stats.ox.ac.uk>
	<f8e6ff050801052132k1d2d9f8do2cf0e550d17869b0@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0801060655290.23958@gannet.stats.ox.ac.uk>

On Sat, 5 Jan 2008, hadley wickham wrote:

> On Jan 5, 2008 1:40 AM, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>> I presume you want this only in a UTF-8 locale?
>
> Yes, although my assumption is that this will become an increasing
> common locale as time goes by.

Probably, except on Windows.  UTF-8 support in commercial Unixen is often 
poor (i.e. it is nominally there but does not work well).  The need for 
other non-8-bit encodings is diminishing, e.g. the various shift encodings 
for Japanese will likely die out but over a long time.

>> Currently this is done by
>>
>> static int SkipSpace(void)
>> {
>>      int c;
>>      while ((c = xxgetc()) == ' ' || c == '\t' || c == '\f')
>>         /* nothing */;
>>      return c;
>> }
>>
>> in gram.c.  We could make use of isspace and its wide-char equivalent
>> iswspace.  However:
>>
>>
>> - there is the perennial debate over whether \v is whitespace.
>>
>> R-lang says
>>
>>    Although not strictly tokens, stretches of whitespace characters
>>    (spaces and tabs) serve to delimit tokens in case of ambiguity,
>>
>> which suggests it has a minimal view of whitespace.
>>
>>
>> - iswspace is often rather unreliable.  E.g. glibc says
>>
>>      The wide character class "space" always contains  at  least  the  space
>>      character and the control characters '\f', '\n', '\r', '\t', '\v'.
>>
>> and I think it usually does not contain other forms of spaces.  More
>> seriously
>>
>>      The  behaviour  of  iswspace()  depends on the LC_CTYPE category of the
>>      current locale.
>>
>> so what is a space will depend on the encoding (hence my question about
>> UTF-8).  And Ei-ji Makama was replaced iswspace on MacOS X, because
>> apparently it is wrongly implemented.
>>
>>
>> - it would complicate the parser as look-ahead would be needed (you would
>> need to read the next mbcs, check it it were whitespace and pushback if
>> needed).  We do that elsewhere, though.
>
> I had assumed the parser would be unicode/mb aware already and so
> would be an easy fix.

It's not, because it has to work on non-Unicode platforms (e.g. Windows 9x 
until R 2.7.0), and even platforms in which wchar_t is not Unicode.  (More 
precisely, we need to avoid making assumptions we can't verify on such 
platforms.)

There's a problem with 'whitespace':  \n is whitespace but is a command 
terminator -- so what should Unicode line and para separators map to?  I 
decided to use only blanks (in the sense of iswblank) as whitespace, and 
further only to use the table that Ei-ji Nakama provided for us in 
rlocale_data.h (adding NBSP).  So the new rules are that 'whitespace' in 
parsing is

\t, \f (not \v, for historical reasons, I presume)
NBSP in 8-bit Windows locales
Unicode blanks in UTF-8 locales on internally Unicode machines (and I 
doubt UTF-8 locales exist anywhere else).

> The locale issues are clearly important and
> can't easily be swept under the rug.
>
>> The only one of these 'spaces' I have much sympathy for is NBSP (which is
>> also fairly easy to generate in CP1252).  It would be easy to add that.
>> Otherwise I am not convinced it is worth the work (and added uncertainty).
>
> That's reasonable.  Another related request would be treating curly
> quotes (single and double) the same way as normal quotes, but I'd
> imagine similar caveats would apply there.

And a bit more: they are directional so you would (I presume) only want to 
match \u2029 to \u2028 etc.  That would be a lot of extra work.

>  You could also imagine using unicode arrows in place of <- and ->, but 
> that's probably heading too far down the apl/fortress road!



-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From timh at insightful.com  Mon Jan  7 20:25:49 2008
From: timh at insightful.com (Tim Hesterberg)
Date: Mon, 07 Jan 2008 11:25:49 -0800
Subject: [Rd] is(x, "parent") returns FALSE when class(x) is c("child",
	"parent") (PR#10549)
In-Reply-To: <18303.21586.362271.585369@stat.math.ethz.ch> (message from
	Martin Maechler on Sat, 5 Jan 2008 10:56:34 +0100)
References: <20080105010508.D5D1B2834847@mail.pubhealth.ku.dk>
	<18303.21586.362271.585369@stat.math.ethz.ch>
Message-ID: <usl19zbcy.fsf@insightful.com>

In S-PLUS, is() does catch parent S3 classes.  It does not
require a setOldClass definition to do so.  I would prefer that
R work the same way, to make porting code easier.

I use is() in S-PLUS for both S3 and S4 classes because it is faster
than inherits().  I use inherits() only for testing a vector of
classes, rather than a single class.

To suggest that S3 has no class inheritance seems odd.
We use inheritance of S3 classes all the time - "ordered" inheriting
from "factor", many classes inheriting from "data.frame", etc.
I see no problem in having inheritance without class definitions.

>>>>>> "TimH" == timh  <timh at insightful.com>
>>>>>>     on Sat,  5 Jan 2008 02:05:08 +0100 (CET) writes:
>
>    TimH> is() does not catch parent S3 classes:
>
>    >> library(splines)
>    >> temp <- bs(1:99, df=5)
>    >> class(temp)
>    TimH> [1] "bs"    "basis"
>    >> is(temp, "basis")
>    TimH> [1] FALSE
>
>    TimH> In contrast, is() does catch parent S4 classes:
>...
>
>Yes, that's all correct, but where's the bug?
>
>S3 has *NO* class definitions, so how can there be class
>inheritance?
>There's many reasons to go from S3 to S4, and the lack of class
>definitions in S3 is an important one...
>
>Now, still being curious:  Are you implicitly saying that in S-plus,
>is() behaves differently, namely 
>``as if S3 classes would exist?'' (:-)


From timh at insightful.com  Mon Jan  7 20:30:23 2008
From: timh at insightful.com (timh at insightful.com)
Date: Mon,  7 Jan 2008 20:30:23 +0100 (CET)
Subject: [Rd] is(x, "parent") returns FALSE when class(x) is c("child",
	"parent") (PR#10549)
Message-ID: <20080107193023.E8625282EFF7@mail.pubhealth.ku.dk>

In S-PLUS, is() does catch parent S3 classes.  It does not
require a setOldClass definition to do so.  I would prefer that
R work the same way, to make porting code easier.

I use is() in S-PLUS for both S3 and S4 classes because it is faster
than inherits().  I use inherits() only for testing a vector of
classes, rather than a single class.

To suggest that S3 has no class inheritance seems odd.
We use inheritance of S3 classes all the time - "ordered" inheriting
from "factor", many classes inheriting from "data.frame", etc.
I see no problem in having inheritance without class definitions.

>>>>>> "TimH" == timh  <timh at insightful.com>
>>>>>>     on Sat,  5 Jan 2008 02:05:08 +0100 (CET) writes:
>
>    TimH> is() does not catch parent S3 classes:
>
>    >> library(splines)
>    >> temp <- bs(1:99, df=5)
>    >> class(temp)
>    TimH> [1] "bs"    "basis"
>    >> is(temp, "basis")
>    TimH> [1] FALSE
>
>    TimH> In contrast, is() does catch parent S4 classes:
>...
>
>Yes, that's all correct, but where's the bug?
>
>S3 has *NO* class definitions, so how can there be class
>inheritance?
>There's many reasons to go from S3 to S4, and the lack of class
>definitions in S3 is an important one...
>
>Now, still being curious:  Are you implicitly saying that in S-plus,
>is() behaves differently, namely 
>``as if S3 classes would exist?'' (:-)


From jmc at r-project.org  Mon Jan  7 20:34:01 2008
From: jmc at r-project.org (John Chambers)
Date: Mon, 07 Jan 2008 11:34:01 -0800
Subject: [Rd] S3 vs S4 for a simple package
In-Reply-To: <Pine.LNX.4.64.0801070908360.11790@gannet.stats.ox.ac.uk>
References: <CB8F09FF-2B71-4A19-BA7D-61CF056E4C22@noc.soton.ac.uk>
	<Pine.LNX.4.64.0801070908360.11790@gannet.stats.ox.ac.uk>
Message-ID: <47827EA9.8080802@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080107/7599fc73/attachment.pl 

From timh at insightful.com  Mon Jan  7 20:35:07 2008
From: timh at insightful.com (timh at insightful.com)
Date: Mon,  7 Jan 2008 20:35:07 +0100 (CET)
Subject: [Rd] library(splines) is missing setOldClass(c("bs",
	"basis")) (PR#10554)
Message-ID: <20080107193507.6124C282EFF7@mail.pubhealth.ku.dk>

> library(splines)
> extends("bs", "basis")
[1] FALSE
> setOldClass(c("bs", "basis"))
> extends("bs", "basis")
[1] TRUE

Note that "bs" should inherit from "basis":
> temp <- bs(1:99, df=5)
> oldClass(temp)
[1] "bs"    "basis"

Similarly for "ns"

In contrast, in S+:
> extends("bs", "basis")
[1] T

--please do not edit the information below--

Version:
 platform = i386-pc-mingw32
 arch = i386
 os = mingw32
 system = i386, mingw32
 status = 
 major = 2
 minor = 6.1
 year = 2007
 month = 11
 day = 26
 svn rev = 43537
 language = R
 version.string = R version 2.6.1 (2007-11-26)

Windows XP (build 2600) Service Pack 2.0

Locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MONETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

Search Path:
 .GlobalEnv, package:splines, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, package:methods, Autoloads, package:base


From mtmorgan at fhcrc.org  Mon Jan  7 20:51:23 2008
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Mon, 07 Jan 2008 11:51:23 -0800
Subject: [Rd] Finding windows DLLs
Message-ID: <6phy7b12z44.fsf@gopher4.fhcrc.org>

The XML package relies on libxml2.dll (e.g., bundled with the CRAN
binary) installed in library/XML/libs. Unfortunately,
c:/WINDOWS/system32/libxml2.dll will be found and loaded before
this.

Is there any programatic solution?

Thanks,

Martin
-- 
Martin Morgan
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M2 B169
Phone: (206) 667-2793


From murdoch at stats.uwo.ca  Mon Jan  7 21:00:08 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 07 Jan 2008 15:00:08 -0500
Subject: [Rd] Finding windows DLLs
In-Reply-To: <6phy7b12z44.fsf@gopher4.fhcrc.org>
References: <6phy7b12z44.fsf@gopher4.fhcrc.org>
Message-ID: <478284C8.1040203@stats.uwo.ca>

On 1/7/2008 2:51 PM, Martin Morgan wrote:
> The XML package relies on libxml2.dll (e.g., bundled with the CRAN
> binary) installed in library/XML/libs. Unfortunately,
> c:/WINDOWS/system32/libxml2.dll will be found and loaded before
> this.
> 
> Is there any programatic solution?

Search order for DLLs is version dependent on Windows.  The best way to 
be sure of what you're loading is to fully specify the path to the DLL, 
and this generally requires you to use API calls LoadLibrary() and 
GetProcAddress() rather than relying on automatic loading of dependencies.

I don't know how many entry points XML is importing from libxml2.dll; if 
there are a lot, LoadLibrary() will be a pain to use, and it might be 
easiest to rename libxml2.dll and hope to avoid a collision.

Duncan Murdoch


From osklyar at ebi.ac.uk  Mon Jan  7 21:06:46 2008
From: osklyar at ebi.ac.uk (Oleg Sklyar)
Date: Mon, 07 Jan 2008 20:06:46 +0000
Subject: [Rd] Finding windows DLLs
In-Reply-To: <6phy7b12z44.fsf@gopher4.fhcrc.org>
References: <6phy7b12z44.fsf@gopher4.fhcrc.org>
Message-ID: <47828656.2050702@ebi.ac.uk>

Should adding PREFIX/library/XML/libs to PATH before system32 solve the 
issue as Windows relies on PATH when searching for libs as well?

Dr Oleg Sklyar | EBI-EMBL, Cambridge CB10 1SD, UK | +44-1223-494466


Martin Morgan wrote:
> The XML package relies on libxml2.dll (e.g., bundled with the CRAN
> binary) installed in library/XML/libs. Unfortunately,
> c:/WINDOWS/system32/libxml2.dll will be found and loaded before
> this.
> 
> Is there any programatic solution?
> 
> Thanks,
> 
> Martin


From osklyar at ebi.ac.uk  Mon Jan  7 21:13:09 2008
From: osklyar at ebi.ac.uk (Oleg Sklyar)
Date: Mon, 07 Jan 2008 20:13:09 +0000
Subject: [Rd] S3 vs S4 for a simple package
In-Reply-To: <47827EA9.8080802@r-project.org>
References: <CB8F09FF-2B71-4A19-BA7D-61CF056E4C22@noc.soton.ac.uk>	<Pine.LNX.4.64.0801070908360.11790@gannet.stats.ox.ac.uk>
	<47827EA9.8080802@r-project.org>
Message-ID: <478287D5.1040304@ebi.ac.uk>

In EBImage I have a very similar situation (well, with more methods). It 
would be impossible to use S3 in my case as my data structures are 
images and I need at least two dimensions (but in fact use 3), thus 2 
variables to dispatch on in [, which are defined for multiple 
configurations like integer,missing; integer,integer or logical,missing. 
To make things faster in S4, I however did not put data into a separate 
slot, rather derived the class with contains="array", so effectively 
giving the class all the functionality of array, and only changing the 
default behaviour for a couple of methods. Obviously one can access the 
data low level through the @.Data slot, both in C and R. This was a real 
performance boost compared to putting data into a separate slot, 
otherwise even working with many images and large sets I have not really 
noticed any performance issues that would be connected with the speed of 
method dispatch (although I would not argue that there are none).

Regards,
Oleg

Dr Oleg Sklyar | EBI-EMBL, Cambridge CB10 1SD, UK | +44-1223-494466


John Chambers wrote:
> Prof Brian Ripley wrote:
>> On Mon, 7 Jan 2008, Robin Hankin wrote:
>>
>>   
>>> I am writing a package and need to decide whether to use S3 or S4.
>>>
>>> I have a single class, "multipol"; this needs methods for "[" and "[<-"
>>> and I also need a print (or show) method and methods for arithmetic +-
>>> */^.
>>>
>>> In S4, an object of class "multipol" has one slot that holds an array.
>>>
>>> Objects of class "multipol" require specific arithmetic operations;
>>> a,b being
>>> multipols means that a+b and a*b are defined in peculiar ways
>>> that make sense in the context of the package. I can also add and
>>> multiply
>>> by scalars (vectors of length one).
>>>     
> One thing you cannot do in S3 is to have methods that depend on anything 
> but the first argument.  Do you want something sensible for 1 + a when  
> a is a "multipol"? The default call to the primitive version may or may 
> not give you what you want.
>>> My impression is that S3 is perfectly adequate for this task, although
>>> I've not yet finalized the coding.
>>>
>>> S4 seems to be "overkill" for such a simple system.
>>>
>>> Can anyone give me some motivation for persisting with S4?
>>>
>>> Or indeed reassure me that S3 is a good design decision?
>>>     
>> Does performance matter?: S4 dispatch is many times slower than S3 
>> dispatch for such functions. (It is several times slower in general, but 
>> the difference is particularly marked for primitives.)
>>   
> Well, the question is whether performance of _method dispatch_ matters, 
> which it tends not to in many cases. And it would be good to have some 
> data to clarify "many times slower".  Generally, looking up inherited 
> methods is likely to take a while, but only the first time does R code 
> need to work out the inheritance. On repeated calls with the same 
> signature, dispatch should be basically a lookup in an environment.
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Mon Jan  7 22:30:41 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 07 Jan 2008 16:30:41 -0500
Subject: [Rd] Finding windows DLLs
In-Reply-To: <47828656.2050702@ebi.ac.uk>
References: <6phy7b12z44.fsf@gopher4.fhcrc.org> <47828656.2050702@ebi.ac.uk>
Message-ID: <47829A01.50600@stats.uwo.ca>

On 1/7/2008 3:06 PM, Oleg Sklyar wrote:
> Should adding PREFIX/library/XML/libs to PATH before system32 solve the 
> issue as Windows relies on PATH when searching for libs as well?

No, system32 is searched before the PATH.  See

http://msdn2.microsoft.com/en-us/library/ms682586.aspx

That page doesn't discuss Win9X, NT4, or Win2K; I don't recall for sure, 
but I suspect there were earlier changes to the search order as well.  R 
currently supports all of these, and 2.7 will continue to support Win2k 
or later.

Duncan Murdoch


From ripley at stats.ox.ac.uk  Mon Jan  7 22:35:28 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 7 Jan 2008 21:35:28 +0000 (GMT)
Subject: [Rd] Finding windows DLLs
In-Reply-To: <47828656.2050702@ebi.ac.uk>
References: <6phy7b12z44.fsf@gopher4.fhcrc.org> <47828656.2050702@ebi.ac.uk>
Message-ID: <Pine.LNX.4.64.0801072123590.23156@gannet.stats.ox.ac.uk>

On Mon, 7 Jan 2008, Oleg Sklyar wrote:

> Should adding PREFIX/library/XML/libs to PATH before system32 solve the
> issue as Windows relies on PATH when searching for libs as well?

The Windows code for package XML says

> XML:::.onLoad
function (libname, pkgname)
{
     if (.Platform$OS.type == "windows") {
         temp <- Sys.getenv("PATH")
         Sys.setenv(PATH = paste(utils::normalizePath(file.path(libname,
             pkgname, "libs")), temp, sep = ";"))
         on.exit(Sys.setenv(PATH = temp))
     }
     library.dynam("XML", pkgname, libname)
     if (exists("setMethod")) {
     }
     .C("RSXML_setErrorHandlers")
}
<environment: namespace:XML>

so it does already do that.

The order depends on the version of Windows *and* its settings: see

http://msdn2.microsoft.com/en-us/library/ms682586(VS.85).aspx

There is a way to change this:

http://msdn2.microsoft.com/en-us/library/ms686203(VS.85).aspx

but it would preclude Windows 2000.

Perhaps Martin can explain how libxml2.dll got into c:/WINDOWS/system32/?
My suggestion is that we rename the DLL when copied into library/XML/libs 
to something like libRxml2.dll.

>
> Dr Oleg Sklyar | EBI-EMBL, Cambridge CB10 1SD, UK | +44-1223-494466
>
>
> Martin Morgan wrote:
>> The XML package relies on libxml2.dll (e.g., bundled with the CRAN
>> binary) installed in library/XML/libs. Unfortunately,
>> c:/WINDOWS/system32/libxml2.dll will be found and loaded before
>> this.
>>
>> Is there any programatic solution?
>>
>> Thanks,
>>
>> Martin

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From timh at insightful.com  Mon Jan  7 22:36:08 2008
From: timh at insightful.com (Tim Hesterberg)
Date: Mon, 07 Jan 2008 13:36:08 -0800
Subject: [Rd] S3 vs S4 for a simple package
In-Reply-To: <CB8F09FF-2B71-4A19-BA7D-61CF056E4C22@noc.soton.ac.uk> (message
	from Robin Hankin on Mon, 7 Jan 2008 09:03:27 +0000)
References: <CB8F09FF-2B71-4A19-BA7D-61CF056E4C22@noc.soton.ac.uk>
Message-ID: <u8x31z5br.fsf@insightful.com>

Would you like existing functions such as mean, range, sum,
colSums, dim, apply, length, and many more to operate on the array of
numbers?  If so use an S3 class.

If you would like to effectively disable such functions, to prevent
them from working on the object unless you write a method that specifies
exactly how the function should operate on the class, then either
use an S4 class, or an S3 class where the array is one component of
a list.

An S3 class also allows for flexibility - you can add attributes,
or list components, without breaking things.

As for reassurance - I use S3 classes for almost everything, happily.
The one time I chose to use an S4 class I later regretted it.  This
was for objects containing multiple imputations, where I wanted to
prevent functions like mean() from working on the original data,
without filling in imputations.  The regret was because we later
realized that in some cases we wanted to add a "call" attribute or
component/slot so that update() would work.  If it had been an S3
object we could have done so, but as an S4 object we would have broken
existing objects of the class.

Tim Hesterberg
Disclaimer - this is my personal opinion, not my employer's.

>I am writing a package and need to decide whether to use S3 or S4.
>
>I have a single class, "multipol"; this needs methods for "[" and "[<-"
>and I also need a print (or show) method and methods for arithmetic +- 
>*/^.
>
>In S4, an object of class "multipol" has one slot that holds an array.
>
>Objects of class "multipol" require specific arithmetic operations;  
>a,b being
>multipols means that a+b and a*b are defined in peculiar ways
>that make sense in the context of the package. I can also add and  
>multiply
>by scalars (vectors of length one).
>
>My impression is that S3 is perfectly adequate for this task, although
>I've not yet finalized the coding.
>
>S4 seems to be "overkill" for such a simple system.
>
>Can anyone give me some motivation for persisting with S4?
>
>Or indeed reassure me that S3 is a good design decision?


From ripley at stats.ox.ac.uk  Mon Jan  7 22:39:54 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 7 Jan 2008 21:39:54 +0000 (GMT)
Subject: [Rd] Finding windows DLLs
In-Reply-To: <47829A01.50600@stats.uwo.ca>
References: <6phy7b12z44.fsf@gopher4.fhcrc.org> <47828656.2050702@ebi.ac.uk>
	<47829A01.50600@stats.uwo.ca>
Message-ID: <Pine.LNX.4.64.0801072136350.23156@gannet.stats.ox.ac.uk>

On Mon, 7 Jan 2008, Duncan Murdoch wrote:

> On 1/7/2008 3:06 PM, Oleg Sklyar wrote:
>> Should adding PREFIX/library/XML/libs to PATH before system32 solve the
>> issue as Windows relies on PATH when searching for libs as well?
>
> No, system32 is searched before the PATH.  See
>
> http://msdn2.microsoft.com/en-us/library/ms682586.aspx
>
> That page doesn't discuss Win9X, NT4, or Win2K; I don't recall for sure,
> but I suspect there were earlier changes to the search order as well.  R
> currently supports all of these, and 2.7 will continue to support Win2k
> or later.

For the record, here is what the search order was at the time of VC++6 
(1998):

1. The directory from which the application loaded.

2. The current directory.

3. Windows 95 and Windows 98: The Windows system directory. Use 
the GetSystemDirectory function to get the path of this directory.

Windows NT: The 32-bit Windows system directory. Use the 
GetSystemDirectory function to get the path of this directory. The name of 
this directory is SYSTEM32.

4. Windows NT: The 16-bit Windows system directory. There is no function 
that obtains the path of this directory, but it is searched. The name of 
this directory is SYSTEM.

5. The Windows directory. Use theGetWindowsDirectory function to get the 
path of this directory.

6. The directories that are listed in the PATH environment variable.

The differences have been what is meant by the 'system directories', and 
the position of the current directory.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bates at stat.wisc.edu  Mon Jan  7 22:50:24 2008
From: bates at stat.wisc.edu (Douglas Bates)
Date: Mon, 7 Jan 2008 15:50:24 -0600
Subject: [Rd] S3 vs S4 for a simple package
In-Reply-To: <47827EA9.8080802@r-project.org>
References: <CB8F09FF-2B71-4A19-BA7D-61CF056E4C22@noc.soton.ac.uk>
	<Pine.LNX.4.64.0801070908360.11790@gannet.stats.ox.ac.uk>
	<47827EA9.8080802@r-project.org>
Message-ID: <40e66e0b0801071350v7781e36as27ccb882ff4a3b3@mail.gmail.com>

On Jan 7, 2008 1:34 PM, John Chambers <jmc at r-project.org> wrote:
> Prof Brian Ripley wrote:
> > On Mon, 7 Jan 2008, Robin Hankin wrote:
> >
> >
> >> I am writing a package and need to decide whether to use S3 or S4.
> >>
> >> I have a single class, "multipol"; this needs methods for "[" and "[<-"
> >> and I also need a print (or show) method and methods for arithmetic +-
> >> */^.
> >>
> >> In S4, an object of class "multipol" has one slot that holds an array.
> >>
> >> Objects of class "multipol" require specific arithmetic operations;
> >> a,b being
> >> multipols means that a+b and a*b are defined in peculiar ways
> >> that make sense in the context of the package. I can also add and
> >> multiply
> >> by scalars (vectors of length one).
> >>
> One thing you cannot do in S3 is to have methods that depend on anything
> but the first argument.  Do you want something sensible for 1 + a when
> a is a "multipol"? The default call to the primitive version may or may
> not give you what you want.

I agree with John.  If method dispatch on multiple arguments is
potentially useful to you, and it sounds as if it is, then S4 is
clearly the winner.  In the Matrix package, for example, determining a
good method for evaluating A %*% B or solve(A, B), where A and B are
Matrix objects, or matrix objects would be extremely difficult if we
were not using S4 classes and methods.

> >> My impression is that S3 is perfectly adequate for this task, although
> >> I've not yet finalized the coding.
> >>
> >> S4 seems to be "overkill" for such a simple system.
> >>
> >> Can anyone give me some motivation for persisting with S4?
> >>
> >> Or indeed reassure me that S3 is a good design decision?
> >>
> >
> > Does performance matter?: S4 dispatch is many times slower than S3
> > dispatch for such functions. (It is several times slower in general, but
> > the difference is particularly marked for primitives.)
> >
> Well, the question is whether performance of _method dispatch_ matters,
> which it tends not to in many cases. And it would be good to have some
> data to clarify "many times slower".  Generally, looking up inherited
> methods is likely to take a while, but only the first time does R code
> need to work out the inheritance. On repeated calls with the same
> signature, dispatch should be basically a lookup in an environment.

I can imagine circumstances in which the time spent on method dispatch
would be important but I haven't encountered them and we have been
working with S4 classes and methods in the Matrix and lme4 packages
for a long time now.  Much more important to me is the amount of time
that I spend designing and debugging code and that is where S4 is, for
me, the clear winner.  Because of the formal class definitions and the
validation of objects  I can write C code assuming that the contents
of particular slots in an object have the desired class.  When I end
up dealing with S3 objects not S4 objects I find it very clunky
because there is no formal class definition and, if I am to play it
safe, I should always check for the existence of certain components in
the object then check or coerce the type then check the length, etc.
With S4 classes I only need to do that once in a validate method.

With S4 I feel that I can use a single class system in my R code and
in the underlying C code.  I don't need to create exotic structs or
C++ classes in the compiled code because the S4 class system in R is
enforcing the class definition for me.

I just read Tim Hesterberg's message from later in this thread and I
agree with him that the formal definition of classes makes it awkward
to revise the slots.  Fortunately, I have a very understanding user
base for the lme4 package and they tolerate my changing class
definitions between releases because I manage to convince them somehow
that the package is improved by the changes.


From ripley at stats.ox.ac.uk  Mon Jan  7 22:50:56 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 7 Jan 2008 21:50:56 +0000 (GMT)
Subject: [Rd] Finding windows DLLs
In-Reply-To: <478284C8.1040203@stats.uwo.ca>
References: <6phy7b12z44.fsf@gopher4.fhcrc.org> <478284C8.1040203@stats.uwo.ca>
Message-ID: <Pine.LNX.4.64.0801072141160.23156@gannet.stats.ox.ac.uk>

On Mon, 7 Jan 2008, Duncan Murdoch wrote:

> On 1/7/2008 2:51 PM, Martin Morgan wrote:
>> The XML package relies on libxml2.dll (e.g., bundled with the CRAN
>> binary) installed in library/XML/libs. Unfortunately,
>> c:/WINDOWS/system32/libxml2.dll will be found and loaded before
>> this.
>>
>> Is there any programatic solution?
>
> Search order for DLLs is version dependent on Windows.  The best way to
> be sure of what you're loading is to fully specify the path to the DLL,
> and this generally requires you to use API calls LoadLibrary() and
> GetProcAddress() rather than relying on automatic loading of dependencies.
>
> I don't know how many entry points XML is importing from libxml2.dll; if
> there are a lot, LoadLibrary() will be a pain to use, and it might be
> easiest to rename libxml2.dll and hope to avoid a collision.

About 85.  But it's worse than that, as libxml2.dll itself imports from 
zlib1.dll and iconv.dll, and there is one of the latter in the application 
directory in R >= 2.6.0.  So even if you find the right libxml2.dll, you 
may not find the right zlib1.dll and iconv.dll (and I already knew that 
you found R's iconv.dll, which fortunately works).

I think we do need to provide an interface to SetDllDirectory, probably as 
an additional argument to dyn.load.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From mtmorgan at fhcrc.org  Mon Jan  7 22:51:00 2008
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Mon, 07 Jan 2008 13:51:00 -0800
Subject: [Rd] Finding windows DLLs
In-Reply-To: <Pine.LNX.4.64.0801072123590.23156@gannet.stats.ox.ac.uk> (Brian
	Ripley's message of "Mon, 7 Jan 2008 21:35:28 +0000 (GMT)")
References: <6phy7b12z44.fsf@gopher4.fhcrc.org> <47828656.2050702@ebi.ac.uk>
	<Pine.LNX.4.64.0801072123590.23156@gannet.stats.ox.ac.uk>
Message-ID: <6phd4sd2tkr.fsf@gopher4.fhcrc.org>

Thanks Duncan for the hints.

libxml2.dll is not in my c:/WINDOWS/system32, but in that of a user of
a package of mine. I guess installed by some other application, though
I don't really know what it's doing there (or the consequences of
removing it).

The MSDN site seemed in the long term to point in the direction of
side-by-side assemblies, which would require cooperation /
infrastructure from R.

Martin

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> On Mon, 7 Jan 2008, Oleg Sklyar wrote:
>
>> Should adding PREFIX/library/XML/libs to PATH before system32 solve the
>> issue as Windows relies on PATH when searching for libs as well?
>
> The Windows code for package XML says
>
>> XML:::.onLoad
> function (libname, pkgname)
> {
>      if (.Platform$OS.type == "windows") {
>          temp <- Sys.getenv("PATH")
>          Sys.setenv(PATH = paste(utils::normalizePath(file.path(libname,
>              pkgname, "libs")), temp, sep = ";"))
>          on.exit(Sys.setenv(PATH = temp))
>      }
>      library.dynam("XML", pkgname, libname)
>      if (exists("setMethod")) {
>      }
>      .C("RSXML_setErrorHandlers")
> }
> <environment: namespace:XML>
>
> so it does already do that.
>
> The order depends on the version of Windows *and* its settings: see
>
> http://msdn2.microsoft.com/en-us/library/ms682586(VS.85).aspx
>
> There is a way to change this:
>
> http://msdn2.microsoft.com/en-us/library/ms686203(VS.85).aspx
>
> but it would preclude Windows 2000.
>
> Perhaps Martin can explain how libxml2.dll got into c:/WINDOWS/system32/?
> My suggestion is that we rename the DLL when copied into
> library/XML/libs to something like libRxml2.dll.
>
>>
>> Dr Oleg Sklyar | EBI-EMBL, Cambridge CB10 1SD, UK | +44-1223-494466
>>
>>
>> Martin Morgan wrote:
>>> The XML package relies on libxml2.dll (e.g., bundled with the CRAN
>>> binary) installed in library/XML/libs. Unfortunately,
>>> c:/WINDOWS/system32/libxml2.dll will be found and loaded before
>>> this.
>>>
>>> Is there any programatic solution?
>>>
>>> Thanks,
>>>
>>> Martin
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-- 
Martin Morgan
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M2 B169
Phone: (206) 667-2793


From rgentlem at fhcrc.org  Tue Jan  8 00:51:46 2008
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Mon, 07 Jan 2008 15:51:46 -0800
Subject: [Rd] course announcement
Message-ID: <4782BB12.8020202@fhcrc.org>

Hi,
   We will be holding an advanced course in R programming at the FHCRC 
(Seattle), Feb 13-15. There will be some emphasis on Bioinformatic 
applications, but not much.

   Sign up at:
    https://secure.bioconductor.org/SeattleFeb08/index.php

   please note space is very limited so make sure you have a 
registration before making any travel plans. Also, this is definitely 
not a course for beginners.

   Best wishes
     Robert

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From ggrothendieck at gmail.com  Tue Jan  8 02:56:24 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 7 Jan 2008 20:56:24 -0500
Subject: [Rd] S3 vs S4 for a simple package
In-Reply-To: <47827EA9.8080802@r-project.org>
References: <CB8F09FF-2B71-4A19-BA7D-61CF056E4C22@noc.soton.ac.uk>
	<Pine.LNX.4.64.0801070908360.11790@gannet.stats.ox.ac.uk>
	<47827EA9.8080802@r-project.org>
Message-ID: <971536df0801071756u3ead0a72h8d98408bb723554@mail.gmail.com>

On Jan 7, 2008 2:34 PM, John Chambers <jmc at r-project.org> wrote:
> One thing you cannot do in S3 is to have methods that depend on anything
> but the first argument.

Actually, you can.  Here are two examples.

> ### first example - Axis ###
> ### note that it can be dispatched on x or at
> Axis
function (x = NULL, at = NULL, ..., side, labels = NULL)
{
    if (!is.null(x))
        UseMethod("Axis", x)
    else if (!is.null(at))
        UseMethod("Axis", at)
    else axis(side = side, at = at, labels = labels, ...)
}
<environment: namespace:graphics>

> ### second example: +.Date
> methods("+")  # note S3 Date method for +
[1] +.Date   +.POSIXt
> debug("+.Date")  # notify if +.Date invoked
> Sys.Date() + 1 # yup.  its invoked.
debugging in: `+.Date`(Sys.Date(), 1)
debug: {
    coerceTimeUnit <- function(x) {
        round(switch(attr(x, "units"), secs = x/86400, mins = x/1440,
            hours = x/24, days = x, weeks = 7 * x))
    }
    if (nargs() == 1)
        return(e1)
    if (inherits(e1, "Date") && inherits(e2, "Date"))
        stop("binary + is not defined for Date objects")
    if (inherits(e1, "difftime"))
        e1 <- coerceTimeUnit(e1)
    if (inherits(e2, "difftime"))
        e2 <- coerceTimeUnit(e2)
    structure(unclass(e1) + unclass(e2), class = "Date")
}
Browse[1]> Q
> 1 + Sys.Date()  # its invoked on arg 2 as well
debugging in: `+.Date`(1, Sys.Date())
debug: {
    coerceTimeUnit <- function(x) {
        round(switch(attr(x, "units"), secs = x/86400, mins = x/1440,
            hours = x/24, days = x, weeks = 7 * x))
    }
    if (nargs() == 1)
        return(e1)
    if (inherits(e1, "Date") && inherits(e2, "Date"))
        stop("binary + is not defined for Date objects")
    if (inherits(e1, "difftime"))
        e1 <- coerceTimeUnit(e1)
    if (inherits(e2, "difftime"))
        e2 <- coerceTimeUnit(e2)
    structure(unclass(e1) + unclass(e2), class = "Date")
}
Browse[1]> Q


From duncan at wald.ucdavis.edu  Tue Jan  8 05:55:14 2008
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Tue, 08 Jan 2008 17:55:14 +1300
Subject: [Rd] Finding windows DLLs
In-Reply-To: <Pine.LNX.4.64.0801072141160.23156@gannet.stats.ox.ac.uk>
References: <6phy7b12z44.fsf@gopher4.fhcrc.org> <478284C8.1040203@stats.uwo.ca>
	<Pine.LNX.4.64.0801072141160.23156@gannet.stats.ox.ac.uk>
Message-ID: <47830232.8000503@wald.ucdavis.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

While I don't disagree with the general need to provide an interface
to SetDllDirectory, etc., I think the discussion about 3rd party
libraries has slightly missed the more obvious solution.
Instead of using a DLL, such packages can link against a _static_
version of the 3rd party and so not get into this dynamic search and
load but guarantee that the symbols are resolved to what they were
intended at build time.

There are lots of advantages to using DLLs, but in many cases
we are not exploiting these and a static link would make these
issues irrelevant and not require users to know about PATH settings, etc.

 D.


Prof Brian Ripley wrote:
> On Mon, 7 Jan 2008, Duncan Murdoch wrote:
> 
>> On 1/7/2008 2:51 PM, Martin Morgan wrote:
>>> The XML package relies on libxml2.dll (e.g., bundled with the CRAN
>>> binary) installed in library/XML/libs. Unfortunately,
>>> c:/WINDOWS/system32/libxml2.dll will be found and loaded before
>>> this.
>>>
>>> Is there any programatic solution?
>> Search order for DLLs is version dependent on Windows.  The best way to
>> be sure of what you're loading is to fully specify the path to the DLL,
>> and this generally requires you to use API calls LoadLibrary() and
>> GetProcAddress() rather than relying on automatic loading of dependencies.
>>
>> I don't know how many entry points XML is importing from libxml2.dll; if
>> there are a lot, LoadLibrary() will be a pain to use, and it might be
>> easiest to rename libxml2.dll and hope to avoid a collision.
> 
> About 85.  But it's worse than that, as libxml2.dll itself imports from 
> zlib1.dll and iconv.dll, and there is one of the latter in the application 
> directory in R >= 2.6.0.  So even if you find the right libxml2.dll, you 
> may not find the right zlib1.dll and iconv.dll (and I already knew that 
> you found R's iconv.dll, which fortunately works).
> 
> I think we do need to provide an interface to SetDllDirectory, probably as 
> an additional argument to dyn.load.
> 
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.7 (Darwin)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFHgwIy9p/Jzwa2QP4RAr32AJ9tDRvunOM0RMeCnEPJIlY7s5NgGACfRmK5
yB/ZNnqkdqc2aeu4f6mxW1w=
=kytC
-----END PGP SIGNATURE-----


From ripley at stats.ox.ac.uk  Tue Jan  8 07:20:40 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 8 Jan 2008 06:20:40 +0000 (GMT)
Subject: [Rd] Finding windows DLLs
In-Reply-To: <47830232.8000503@wald.ucdavis.edu>
References: <6phy7b12z44.fsf@gopher4.fhcrc.org> <478284C8.1040203@stats.uwo.ca>
	<Pine.LNX.4.64.0801072141160.23156@gannet.stats.ox.ac.uk>
	<47830232.8000503@wald.ucdavis.edu>
Message-ID: <Pine.LNX.4.64.0801080558300.29081@gannet.stats.ox.ac.uk>

On Tue, 8 Jan 2008, Duncan Temple Lang wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> While I don't disagree with the general need to provide an interface
> to SetDllDirectory, etc., I think the discussion about 3rd party
> libraries has slightly missed the more obvious solution.
> Instead of using a DLL, such packages can link against a _static_
> version of the 3rd party and so not get into this dynamic search and
> load but guarantee that the symbols are resolved to what they were
> intended at build time.

Only if there is one.  This has been my practice when building Windows 
binary packages, but as in the recent example of ncdf, the developers of 
the third-party (netcdf) set up their make system only to implement some 
Windows tweaks when a DLL was built.  More commonly, the third-party has 
to be built under a different compiler (typically VC++), and the static 
library is not compatible with MinGW.  (iconv and Tcl/Tk are two examples 
where at least at one time MinGW builds didn't work correctly.)

In the case of XML, we could revert to my practice before Uwe took over, 
as I did (after some struggle) build libxml2/zlib statically under older 
versions of MinGW and so would expect to be able to do so again.

> There are lots of advantages to using DLLs, but in many cases
> we are not exploiting these and a static link would make these
> issues irrelevant and not require users to know about PATH settings, etc.
>
> D.
>
>
> Prof Brian Ripley wrote:
>> On Mon, 7 Jan 2008, Duncan Murdoch wrote:
>>
>>> On 1/7/2008 2:51 PM, Martin Morgan wrote:
>>>> The XML package relies on libxml2.dll (e.g., bundled with the CRAN
>>>> binary) installed in library/XML/libs. Unfortunately,
>>>> c:/WINDOWS/system32/libxml2.dll will be found and loaded before
>>>> this.
>>>>
>>>> Is there any programatic solution?
>>> Search order for DLLs is version dependent on Windows.  The best way to
>>> be sure of what you're loading is to fully specify the path to the DLL,
>>> and this generally requires you to use API calls LoadLibrary() and
>>> GetProcAddress() rather than relying on automatic loading of dependencies.
>>>
>>> I don't know how many entry points XML is importing from libxml2.dll; if
>>> there are a lot, LoadLibrary() will be a pain to use, and it might be
>>> easiest to rename libxml2.dll and hope to avoid a collision.
>>
>> About 85.  But it's worse than that, as libxml2.dll itself imports from
>> zlib1.dll and iconv.dll, and there is one of the latter in the application
>> directory in R >= 2.6.0.  So even if you find the right libxml2.dll, you
>> may not find the right zlib1.dll and iconv.dll (and I already knew that
>> you found R's iconv.dll, which fortunately works).
>>
>> I think we do need to provide an interface to SetDllDirectory, probably as
>> an additional argument to dyn.load.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From duncan at wald.ucdavis.edu  Tue Jan  8 07:40:39 2008
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Tue, 08 Jan 2008 19:40:39 +1300
Subject: [Rd] Finding windows DLLs
In-Reply-To: <Pine.LNX.4.64.0801080558300.29081@gannet.stats.ox.ac.uk>
References: <6phy7b12z44.fsf@gopher4.fhcrc.org> <478284C8.1040203@stats.uwo.ca>
	<Pine.LNX.4.64.0801072141160.23156@gannet.stats.ox.ac.uk>
	<47830232.8000503@wald.ucdavis.edu>
	<Pine.LNX.4.64.0801080558300.29081@gannet.stats.ox.ac.uk>
Message-ID: <47831AE7.6040308@wald.ucdavis.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



Prof Brian Ripley wrote:
> On Tue, 8 Jan 2008, Duncan Temple Lang wrote:
> 
>> -----BEGIN PGP SIGNED MESSAGE-----
>> Hash: SHA1
>>
>> While I don't disagree with the general need to provide an interface
>> to SetDllDirectory, etc., I think the discussion about 3rd party
>> libraries has slightly missed the more obvious solution.
>> Instead of using a DLL, such packages can link against a _static_
>> version of the 3rd party and so not get into this dynamic search and
>> load but guarantee that the symbols are resolved to what they were
>> intended at build time.
> 
> Only if there is one. 

I assume 'one' refers to DLLs.
Either way, of course you can link against static versions of all
libraries and not just one. It requires having static versions of each
library.

> This has been my practice when building Windows
> binary packages, but as in the recent example of ncdf, the developers of
> the third-party (netcdf) set up their make system only to implement some
> Windows tweaks when a DLL was built.  More commonly, the third-party has
> to be built under a different compiler (typically VC++), and the static
> library is not compatible with MinGW.  (iconv and Tcl/Tk are two
> examples where at least at one time MinGW builds didn't work correctly.)


> 
> In the case of XML, we could revert to my practice before Uwe took over,
> as I did (after some struggle) build libxml2/zlib statically under older
> versions of MinGW and so would expect to be able to do so again.
> 

Well this is the issue - whether we want to build our own versions of
a static version of a DLL.  It would be a lot better if Windows users
were aware of the work done to support them and realized that it reduced
the resources available for more creative work.



>> There are lots of advantages to using DLLs, but in many cases
>> we are not exploiting these and a static link would make these
>> issues irrelevant and not require users to know about PATH settings, etc.
>>
>> D.
>>
>>
>> Prof Brian Ripley wrote:
>>> On Mon, 7 Jan 2008, Duncan Murdoch wrote:
>>>
>>>> On 1/7/2008 2:51 PM, Martin Morgan wrote:
>>>>> The XML package relies on libxml2.dll (e.g., bundled with the CRAN
>>>>> binary) installed in library/XML/libs. Unfortunately,
>>>>> c:/WINDOWS/system32/libxml2.dll will be found and loaded before
>>>>> this.
>>>>>
>>>>> Is there any programatic solution?
>>>> Search order for DLLs is version dependent on Windows.  The best way to
>>>> be sure of what you're loading is to fully specify the path to the DLL,
>>>> and this generally requires you to use API calls LoadLibrary() and
>>>> GetProcAddress() rather than relying on automatic loading of
>>>> dependencies.
>>>>
>>>> I don't know how many entry points XML is importing from
>>>> libxml2.dll; if
>>>> there are a lot, LoadLibrary() will be a pain to use, and it might be
>>>> easiest to rename libxml2.dll and hope to avoid a collision.
>>>
>>> About 85.  But it's worse than that, as libxml2.dll itself imports from
>>> zlib1.dll and iconv.dll, and there is one of the latter in the
>>> application
>>> directory in R >= 2.6.0.  So even if you find the right libxml2.dll, you
>>> may not find the right zlib1.dll and iconv.dll (and I already knew that
>>> you found R's iconv.dll, which fortunately works).
>>>
>>> I think we do need to provide an interface to SetDllDirectory,
>>> probably as
>>> an additional argument to dyn.load.
> 
> 
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.7 (Darwin)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFHgxrn9p/Jzwa2QP4RAnsVAJsEkOT7DEu3pIOkIiA23RZ9mACIfACeIqrG
L3YrWfoD916Vbzu1zy93KkU=
=6yOz
-----END PGP SIGNATURE-----


From ripley at stats.ox.ac.uk  Tue Jan  8 07:59:32 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 8 Jan 2008 06:59:32 +0000 (GMT)
Subject: [Rd] Finding windows DLLs
In-Reply-To: <47831AE7.6040308@wald.ucdavis.edu>
References: <6phy7b12z44.fsf@gopher4.fhcrc.org> <478284C8.1040203@stats.uwo.ca>
	<Pine.LNX.4.64.0801072141160.23156@gannet.stats.ox.ac.uk>
	<47830232.8000503@wald.ucdavis.edu>
	<Pine.LNX.4.64.0801080558300.29081@gannet.stats.ox.ac.uk>
	<47831AE7.6040308@wald.ucdavis.edu>
Message-ID: <Pine.LNX.4.64.0801080655450.30003@gannet.stats.ox.ac.uk>

On Tue, 8 Jan 2008, Duncan Temple Lang wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
>
>
> Prof Brian Ripley wrote:
>> On Tue, 8 Jan 2008, Duncan Temple Lang wrote:
>>
>>> -----BEGIN PGP SIGNED MESSAGE-----
>>> Hash: SHA1
>>>
>>> While I don't disagree with the general need to provide an interface
>>> to SetDllDirectory, etc., I think the discussion about 3rd party
>>> libraries has slightly missed the more obvious solution.
>>> Instead of using a DLL, such packages can link against a _static_
>>> version of the 3rd party and so not get into this dynamic search and
>>> load but guarantee that the symbols are resolved to what they were
>>> intended at build time.
>>
>> Only if there is one.
>
> I assume 'one' refers to DLLs.
> Either way, of course you can link against static versions of all
> libraries and not just one. It requires having static versions of each
> library.

It refers to 'a _static_ version': normal English rules -- the immediate 
antecedent -- apply.

>> This has been my practice when building Windows
>> binary packages, but as in the recent example of ncdf, the developers of
>> the third-party (netcdf) set up their make system only to implement some
>> Windows tweaks when a DLL was built.  More commonly, the third-party has
>> to be built under a different compiler (typically VC++), and the static
>> library is not compatible with MinGW.  (iconv and Tcl/Tk are two
>> examples where at least at one time MinGW builds didn't work correctly.)
>
>> In the case of XML, we could revert to my practice before Uwe took over,
>> as I did (after some struggle) build libxml2/zlib statically under older
>> versions of MinGW and so would expect to be able to do so again.
>
> Well this is the issue - whether we want to build our own versions of
> a static version of a DLL.  It would be a lot better if Windows users
> were aware of the work done to support them and realized that it reduced
> the resources available for more creative work.
>
>
>
>>> There are lots of advantages to using DLLs, but in many cases
>>> we are not exploiting these and a static link would make these
>>> issues irrelevant and not require users to know about PATH settings, etc.
>>>
>>> D.
>>>
>>>
>>> Prof Brian Ripley wrote:
>>>> On Mon, 7 Jan 2008, Duncan Murdoch wrote:
>>>>
>>>>> On 1/7/2008 2:51 PM, Martin Morgan wrote:
>>>>>> The XML package relies on libxml2.dll (e.g., bundled with the CRAN
>>>>>> binary) installed in library/XML/libs. Unfortunately,
>>>>>> c:/WINDOWS/system32/libxml2.dll will be found and loaded before
>>>>>> this.
>>>>>>
>>>>>> Is there any programatic solution?
>>>>> Search order for DLLs is version dependent on Windows.  The best way to
>>>>> be sure of what you're loading is to fully specify the path to the DLL,
>>>>> and this generally requires you to use API calls LoadLibrary() and
>>>>> GetProcAddress() rather than relying on automatic loading of
>>>>> dependencies.
>>>>>
>>>>> I don't know how many entry points XML is importing from
>>>>> libxml2.dll; if
>>>>> there are a lot, LoadLibrary() will be a pain to use, and it might be
>>>>> easiest to rename libxml2.dll and hope to avoid a collision.
>>>>
>>>> About 85.  But it's worse than that, as libxml2.dll itself imports from
>>>> zlib1.dll and iconv.dll, and there is one of the latter in the
>>>> application
>>>> directory in R >= 2.6.0.  So even if you find the right libxml2.dll, you
>>>> may not find the right zlib1.dll and iconv.dll (and I already knew that
>>>> you found R's iconv.dll, which fortunately works).
>>>>
>>>> I think we do need to provide an interface to SetDllDirectory,
>>>> probably as
>>>> an additional argument to dyn.load.
>>
>>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.7 (Darwin)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org
>
> iD8DBQFHgxrn9p/Jzwa2QP4RAnsVAJsEkOT7DEu3pIOkIiA23RZ9mACIfACeIqrG
> L3YrWfoD916Vbzu1zy93KkU=
> =6yOz
> -----END PGP SIGNATURE-----
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Tue Jan  8 08:31:50 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 8 Jan 2008 07:31:50 +0000 (GMT)
Subject: [Rd] checking whether the name space can be loaded with stated
 dependencies
In-Reply-To: <Pine.LNX.4.64.0801042155140.30877@gannet.stats.ox.ac.uk>
References: <f8e6ff050801031831j36005a1cw8449a6f65481845b@mail.gmail.com> 
	<Pine.LNX.4.64.0801040237590.26624@gannet.stats.ox.ac.uk>
	<f8e6ff050801040615t3469f32cldfe27bedc5539b1@mail.gmail.com>
	<Pine.LNX.4.64.0801042155140.30877@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0801080723090.30441@gannet.stats.ox.ac.uk>

Hadley sent me the package, and my guess *was* correct.  The package is 
not using lazy-loading, and early on it has (in aaa-top-level.r)

TopLevel <- proto(expr = {
...

That is 'a top-level computation'.  To make this work, you need
require("proto") in that file.  It also needs require("grid").

The Depends: packages are available when the package is installed, but not 
when the namespace is loaded.


On Fri, 4 Jan 2008, Prof Brian Ripley wrote:

> On Fri, 4 Jan 2008, hadley wickham wrote:
>
>> On 1/4/08, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>>> What it is trying is
>>>
>>> % env R_DEFAULT_PACKAGES=NULL R
>>>
>>>> loadNamespace("ggplot2")
>>>
>>> The test is not new, so it would seem to be a change in ggplot2 since the
>>> version on CRAN.  My guess is the your package is doing top-level
>>> computations, which `Writing R Extensions' warns against:
>>>
>>>    The R code files should only create R objects and not call functions
>>>    with side effects such as require and options.
>>
>> Thanks for the additional info. I've grepped for ^[^#\n ]+\(  (which I
>> think should find any top-level function call) and didn't find
>> anything. I certainly can't think of any top level computations that
>> I'm doing apart from creating R functions and objects.  Is there
>> anyway to get more details about what exactly I've done wrong?
>
> As I said, that was a guess: if it is not the cause then I am in the dark.
> If you can send me the version doing this I can try to dig further.
>
>> Calling traceback after loadNamespace isn't helpful.
>>
>>> If you must deviate from that, you need to arrange for the environment you
>>> need: when loading a name space the Depends: packages are not loaded.
>>
>> Is this a recent change to R?
>
> No: that wording is ancient, and the test is not recent.
>
>> The package appears to work fine after
>> installation so I presume this check is protecting me from some more
>> subtle danger.
>
> The danger is that if some other package (or a user) does
> ggplot2::some_function_in_ggplot2 that this will fail if the package is
> not attached, similarly if a package name space imports from ggplot2.
>
>> If it's helpful, my depends line is:
>> Depends: R (>= 2.6), grid, reshape (>= 0.8.0), proto, splines, MASS,
>>  RColorBrewer, colorspace
>>
>> so only proto or RColorBrewer should be a problem.
>>
>> Hadley
>>
>>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From r.hankin at noc.soton.ac.uk  Tue Jan  8 10:25:04 2008
From: r.hankin at noc.soton.ac.uk (r.hankin at noc.soton.ac.uk)
Date: Tue,  8 Jan 2008 10:25:04 +0100 (CET)
Subject: [Rd] fisher.test(... , simulate.p.value=TRUE) (PR#10558)
Message-ID: <20080108092504.BEABE283484C@mail.pubhealth.ku.dk>

Full_Name: Robin Hankin
Version: R-2.6.1
OS: macosx 10.5.1
Submission from: (NULL) (139.166.245.10)


fisher.test() with a matrix a <- diag(1:3) has a p-value of 1/60 ~= 0.016666

Setting the simulate.p.value flag to TRUE gives a very incorrect answer:

> fisher.test(a,simulate.p.value=TRUE)$p.value
[1] 0.0004997501
> fisher.test(a,simulate.p.value=TRUE,B=10000)$p.value
[1] 9.999e-05
> 


These values are repeatable [there is no variability].  The relevant line in
fisher.test() is reproduced below; it is the one where PVAL is set:


       n <- sum(sc)
            STATISTIC <- -sum(lfactorial(x))
            tmp <- .C("fisher_sim", as.integer(nr), as.integer(nc), 
                as.integer(sr), as.integer(sc), as.integer(n), 
                as.integer(B), integer(nr * nc), double(n + 1), 
                integer(nc), results = double(B), PACKAGE = "stats")$results
            almost.1 <- 1 + 64 * .Machine$double.eps
            PVAL <- (1 + sum(tmp <= almost.1 * STATISTIC))/(B + 
                1)
        }


the problem is sum(tmp <= almost.1 * STATISTIC).  This line would be correct if
tmp (and STATISTIC) were positive, but they are negative (or zero).  The
fisher.test() is returning 1/(B+1) because *no* element of tmp satisfies tmp <=
almost.1 * STATISTIC.


 Changing the line to read 

PVAL <- (1 + sum(tmp <=  STATISTIC/almost.1))/(B +  1)


fixes the problem:


> myfish(a,simulate.p.value=TRUE,B=10000)$p.value
[1] 0.01749825
> myfish(a,simulate.p.value=TRUE,B=10000)$p.value
[1] 0.01779822
> myfish(a,simulate.p.value=TRUE,B=10000)$p.value
[1] 0.01559844
> myfish(a,simulate.p.value=TRUE,B=10000)$p.value
[1] 0.01739826
> 


See how the p-values agree with the theoretical value of 1/60 (more or less).


From osklyar at ebi.ac.uk  Tue Jan  8 12:17:42 2008
From: osklyar at ebi.ac.uk (Oleg Sklyar)
Date: Tue, 08 Jan 2008 11:17:42 +0000
Subject: [Rd] S3 vs S4 for a simple package
In-Reply-To: <u8x31z5br.fsf@insightful.com>
References: <CB8F09FF-2B71-4A19-BA7D-61CF056E4C22@noc.soton.ac.uk>
	<u8x31z5br.fsf@insightful.com>
Message-ID: <47835BD6.5060001@ebi.ac.uk>

> Would you like existing functions such as mean, range, sum,
> colSums, dim, apply, length, and many more to operate on the array of
> numbers?  If so use an S3 class.

The above is misleading as 'setClass("NewArray", [additional structures 
go in here], contains="array")' will give the NewArray all the 
functionality of "array" with mean, range, sum, colSums, dim, apply, 
length etc *and* [<- [[<- supported out of the box! You basically need 
only to write [, [[ to ensure that returns are of the NewClass!

> If you would like to effectively disable such functions, to prevent
> them from working on the object unless you write a method that specifies
> exactly how the function should operate on the class, then either
> use an S4 class, or an S3 class where the array is one component of
> a list.

This is very slow when used with [, [[ operators on that element

> An S3 class also allows for flexibility - you can add attributes,
> or list components, without breaking things.

That's true, but then what is the purpose of a class but the rigid 
structure?

> As for reassurance - I use S3 classes for almost everything, happily.
> The one time I chose to use an S4 class I later regretted it.  This
> was for objects containing multiple imputations, where I wanted to
> prevent functions like mean() from working on the original data,
> without filling in imputations.  The regret was because we later
> realized that in some cases we wanted to add a "call" attribute or
> component/slot so that update() would work.  If it had been an S3
> object we could have done so, but as an S4 object we would have broken
> existing objects of the class.
> 
> Tim Hesterberg
> Disclaimer - this is my personal opinion, not my employer's.
> 
>> I am writing a package and need to decide whether to use S3 or S4.
>>
>> I have a single class, "multipol"; this needs methods for "[" and "[<-"
>> and I also need a print (or show) method and methods for arithmetic +- 
>> */^.
>>
>> In S4, an object of class "multipol" has one slot that holds an array.
>>
>> Objects of class "multipol" require specific arithmetic operations;  
>> a,b being
>> multipols means that a+b and a*b are defined in peculiar ways
>> that make sense in the context of the package. I can also add and  
>> multiply
>> by scalars (vectors of length one).
>>
>> My impression is that S3 is perfectly adequate for this task, although
>> I've not yet finalized the coding.
>>
>> S4 seems to be "overkill" for such a simple system.
>>
>> Can anyone give me some motivation for persisting with S4?
>>
>> Or indeed reassure me that S3 is a good design decision?
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Tue Jan  8 13:20:07 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 8 Jan 2008 12:20:07 +0000 (GMT)
Subject: [Rd] Finding windows DLLs
In-Reply-To: <Pine.LNX.4.64.0801072141160.23156@gannet.stats.ox.ac.uk>
References: <6phy7b12z44.fsf@gopher4.fhcrc.org> <478284C8.1040203@stats.uwo.ca>
	<Pine.LNX.4.64.0801072141160.23156@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0801080951350.32339@gannet.stats.ox.ac.uk>

Let me try to pull the ends together on this.

- As DTL pointed out one way out is to use a static libxml2.  I tried
   that, and managed to  build and check it under MinGW but it did not work
   correctly with package XML.  That route used to be possible, but it is
   too much work to keep fixing it up, at least for me: package
   developers are strongly biased towards providing DLLs on Windows.

- Renaming the DLL is not an option, as libxml2.dll contains its name, and
   if you rename it you will not be able to link against it.  Perhaps there
   is a route through this involving import libs, but the standard
   mechanisms do not work.  It also does not solve the dependent DLL
   problem.

- Adding an interface to SetDLLDirectory is viable in Windows > 2000
   provided only one directory is involved.  (E.g. not if you want to link
   to DLLs provided in another package as well as your own.)  I've
   implemented that and am about to add it: there is a new argument
   'DLLpath' to dyn.load() and it is set by library.dynam().  This works in
   Windows 2000 by temporarily changing the current directory.  This
   provides a safer way for the Windows' tcltk package to link to its
   DLLs.

Note that the issues are not just confined to Windows: the search path for 
dlopen() is pretty much undocumented in most OSes (apart from that 
LD_LIBRARY_PATH is involved and it is usually read only at startup). It 
usually works because DSOs are versioned and so libxml2.so.2.6.30 is 
likely to be found only once (or once for each architecture).  Some other 
software makes use of ld -R or -rpath (and hence has relocation issues: it 
was decided not to consider that for R until libtool was fully usable 
which after several years it is not).


On Mon, 7 Jan 2008, Prof Brian Ripley wrote:

> On Mon, 7 Jan 2008, Duncan Murdoch wrote:
>
>> On 1/7/2008 2:51 PM, Martin Morgan wrote:
>>> The XML package relies on libxml2.dll (e.g., bundled with the CRAN
>>> binary) installed in library/XML/libs. Unfortunately,
>>> c:/WINDOWS/system32/libxml2.dll will be found and loaded before
>>> this.
>>>
>>> Is there any programatic solution?
>>
>> Search order for DLLs is version dependent on Windows.  The best way to
>> be sure of what you're loading is to fully specify the path to the DLL,
>> and this generally requires you to use API calls LoadLibrary() and
>> GetProcAddress() rather than relying on automatic loading of dependencies.
>>
>> I don't know how many entry points XML is importing from libxml2.dll; if
>> there are a lot, LoadLibrary() will be a pain to use, and it might be
>> easiest to rename libxml2.dll and hope to avoid a collision.
>
> About 85.  But it's worse than that, as libxml2.dll itself imports from
> zlib1.dll and iconv.dll, and there is one of the latter in the application
> directory in R >= 2.6.0.  So even if you find the right libxml2.dll, you
> may not find the right zlib1.dll and iconv.dll (and I already knew that
> you found R's iconv.dll, which fortunately works).
>
> I think we do need to provide an interface to SetDllDirectory, probably as
> an additional argument to dyn.load.
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From h.wickham at gmail.com  Tue Jan  8 14:45:49 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Tue, 8 Jan 2008 07:45:49 -0600
Subject: [Rd] checking whether the name space can be loaded with stated
	dependencies
In-Reply-To: <Pine.LNX.4.64.0801080723090.30441@gannet.stats.ox.ac.uk>
References: <f8e6ff050801031831j36005a1cw8449a6f65481845b@mail.gmail.com>
	<Pine.LNX.4.64.0801040237590.26624@gannet.stats.ox.ac.uk>
	<f8e6ff050801040615t3469f32cldfe27bedc5539b1@mail.gmail.com>
	<Pine.LNX.4.64.0801042155140.30877@gannet.stats.ox.ac.uk>
	<Pine.LNX.4.64.0801080723090.30441@gannet.stats.ox.ac.uk>
Message-ID: <f8e6ff050801080545y73fe7857ue7a68b60a2528c73@mail.gmail.com>

On Jan 8, 2008 1:31 AM, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> Hadley sent me the package, and my guess *was* correct.  The package is
> not using lazy-loading, and early on it has (in aaa-top-level.r)
>
> TopLevel <- proto(expr = {
> ...
>
> That is 'a top-level computation'.  To make this work, you need
> require("proto") in that file.  It also needs require("grid").

Thanks for looking into it.  I must have misinterpreted:

  The R code files should only create R objects and not call functions
  with side effects such as require and options.

because isn't that expression creating an R object?  And something in
R CMD check must have changed recently because that code has been
there as long as ggplot2 has.  Regardless, thanks again for the help
as I never would have found that given that my understanding of the
problem was clearly flawed.

Thanks,

Hadley

-- 
http://had.co.nz/


From ripley at stats.ox.ac.uk  Tue Jan  8 15:10:14 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 8 Jan 2008 14:10:14 +0000 (GMT)
Subject: [Rd] checking whether the name space can be loaded with stated
 dependencies
In-Reply-To: <f8e6ff050801080545y73fe7857ue7a68b60a2528c73@mail.gmail.com>
References: <f8e6ff050801031831j36005a1cw8449a6f65481845b@mail.gmail.com> 
	<Pine.LNX.4.64.0801040237590.26624@gannet.stats.ox.ac.uk> 
	<f8e6ff050801040615t3469f32cldfe27bedc5539b1@mail.gmail.com> 
	<Pine.LNX.4.64.0801042155140.30877@gannet.stats.ox.ac.uk> 
	<Pine.LNX.4.64.0801080723090.30441@gannet.stats.ox.ac.uk>
	<f8e6ff050801080545y73fe7857ue7a68b60a2528c73@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0801081356040.7137@gannet.stats.ox.ac.uk>

On Tue, 8 Jan 2008, hadley wickham wrote:

> On Jan 8, 2008 1:31 AM, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>> Hadley sent me the package, and my guess *was* correct.  The package is
>> not using lazy-loading, and early on it has (in aaa-top-level.r)
>>
>> TopLevel <- proto(expr = {
>> ...
>>
>> That is 'a top-level computation'.  To make this work, you need
>> require("proto") in that file.  It also needs require("grid").
>
> Thanks for looking into it.  I must have misinterpreted:
>
>  The R code files should only create R objects and not call functions
>  with side effects such as require and options.
>
> because isn't that expression creating an R object?

Only if package proto is attached.  Not my wording, and it long predates 
saved images and lazyloading.

> And something in R CMD check must have changed recently because that 
> code has been there as long as ggplot2 has.

But you set 'LazyLoad: no' since the CRAN version.  That's the problem -- 
the environment when creating an image is richer than when loading a 
namespace.

>  Regardless, thanks again for the help
> as I never would have found that given that my understanding of the
> problem was clearly flawed.
>
> Thanks,
>
> Hadley
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From mtmorgan at fhcrc.org  Wed Jan  9 05:43:53 2008
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Tue, 08 Jan 2008 20:43:53 -0800
Subject: [Rd] Finding windows DLLs
In-Reply-To: <Pine.LNX.4.64.0801080951350.32339@gannet.stats.ox.ac.uk> (Brian
	Ripley's message of "Tue, 8 Jan 2008 12:20:07 +0000 (GMT)")
References: <6phy7b12z44.fsf@gopher4.fhcrc.org> <478284C8.1040203@stats.uwo.ca>
	<Pine.LNX.4.64.0801072141160.23156@gannet.stats.ox.ac.uk>
	<Pine.LNX.4.64.0801080951350.32339@gannet.stats.ox.ac.uk>
Message-ID: <6phlk6z38xi.fsf@gopher4.fhcrc.org>

Thank you very much, Prof. Ripley, for the prompt solution, and to all
participants in the thread for their insights. Martin

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> Let me try to pull the ends together on this.
>
> - As DTL pointed out one way out is to use a static libxml2.  I tried
>    that, and managed to  build and check it under MinGW but it did not work
>    correctly with package XML.  That route used to be possible, but it is
>    too much work to keep fixing it up, at least for me: package
>    developers are strongly biased towards providing DLLs on Windows.
>
> - Renaming the DLL is not an option, as libxml2.dll contains its name, and
>    if you rename it you will not be able to link against it.  Perhaps there
>    is a route through this involving import libs, but the standard
>    mechanisms do not work.  It also does not solve the dependent DLL
>    problem.
>
> - Adding an interface to SetDLLDirectory is viable in Windows > 2000
>    provided only one directory is involved.  (E.g. not if you want to link
>    to DLLs provided in another package as well as your own.)  I've
>    implemented that and am about to add it: there is a new argument
>    'DLLpath' to dyn.load() and it is set by library.dynam().  This works in
>    Windows 2000 by temporarily changing the current directory.  This
>    provides a safer way for the Windows' tcltk package to link to its
>    DLLs.
>
> Note that the issues are not just confined to Windows: the search path for 
> dlopen() is pretty much undocumented in most OSes (apart from that 
> LD_LIBRARY_PATH is involved and it is usually read only at startup). It 
> usually works because DSOs are versioned and so libxml2.so.2.6.30 is 
> likely to be found only once (or once for each architecture).  Some other 
> software makes use of ld -R or -rpath (and hence has relocation issues: it 
> was decided not to consider that for R until libtool was fully usable 
> which after several years it is not).
>
>
> On Mon, 7 Jan 2008, Prof Brian Ripley wrote:
>
>> On Mon, 7 Jan 2008, Duncan Murdoch wrote:
>>
>>> On 1/7/2008 2:51 PM, Martin Morgan wrote:
>>>> The XML package relies on libxml2.dll (e.g., bundled with the CRAN
>>>> binary) installed in library/XML/libs. Unfortunately,
>>>> c:/WINDOWS/system32/libxml2.dll will be found and loaded before
>>>> this.
>>>>
>>>> Is there any programatic solution?
>>>
>>> Search order for DLLs is version dependent on Windows.  The best way to
>>> be sure of what you're loading is to fully specify the path to the DLL,
>>> and this generally requires you to use API calls LoadLibrary() and
>>> GetProcAddress() rather than relying on automatic loading of dependencies.
>>>
>>> I don't know how many entry points XML is importing from libxml2.dll; if
>>> there are a lot, LoadLibrary() will be a pain to use, and it might be
>>> easiest to rename libxml2.dll and hope to avoid a collision.
>>
>> About 85.  But it's worse than that, as libxml2.dll itself imports from
>> zlib1.dll and iconv.dll, and there is one of the latter in the application
>> directory in R >= 2.6.0.  So even if you find the right libxml2.dll, you
>> may not find the right zlib1.dll and iconv.dll (and I already knew that
>> you found R's iconv.dll, which fortunately works).
>>
>> I think we do need to provide an interface to SetDllDirectory, probably as
>> an additional argument to dyn.load.
>>
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin Morgan
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M2 B169
Phone: (206) 667-2793


From fannin.14 at fisher.osu.edu  Tue Jan  8 23:25:07 2008
From: fannin.14 at fisher.osu.edu (fannin.14 at fisher.osu.edu)
Date: Tue,  8 Jan 2008 23:25:07 +0100 (CET)
Subject: [Rd] Change Dir issue in Vista (PR#10561)
Message-ID: <20080108222507.1F82E283416B@mail.pubhealth.ku.dk>

Full_Name: Paul Fannin
Version: 2.6.0 and 2.6.1
OS: Windows Vista Enterprise
Submission from: (NULL) (164.107.68.250)


When going to File>Change Dir... and clicking the Browse button, you are only
permitted to go into directories on the desktop.  I tested versions 2.2.0 to
2.51, and they will all allow you to navigate essentially any directory with the
Browse button.


From ripley at stats.ox.ac.uk  Wed Jan  9 17:30:32 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Wed,  9 Jan 2008 17:30:32 +0100 (CET)
Subject: [Rd] Change Dir issue in Vista (PR#10561)
Message-ID: <20080109163032.74F662834615@mail.pubhealth.ku.dk>

Oh please do try not to annoy those who give you the free gift of R!

1) This is a repeat of two previous bug reports: look in the Windows-fixed 
section on the bug repository.

2) It is documented in R 2.6.1: see ?choose.dir.

3) It has already been worked around in R-patched and R-devel.

Reporting already fixed bugs is really annoying, and specifically warned 
against in the FAQ.  Especially since the root of the bug is a broken 
Windows Vista system call, and not our fault.

On Tue, 8 Jan 2008, fannin.14 at fisher.osu.edu wrote:

> Full_Name: Paul Fannin
> Version: 2.6.0 and 2.6.1
> OS: Windows Vista Enterprise
> Submission from: (NULL) (164.107.68.250)
>
>
> When going to File>Change Dir... and clicking the Browse button, you are only
> permitted to go into directories on the desktop.  I tested versions 2.2.0 to
> 2.51, and they will all allow you to navigate essentially any directory with the
> Browse button.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ggrothendieck at gmail.com  Wed Jan  9 17:54:15 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 9 Jan 2008 11:54:15 -0500
Subject: [Rd] R Bugs link broken
Message-ID: <971536df0801090854g214c8c61g1e34473399e3836@mail.gmail.com>

The link to R Bugs in the posting guide

  http://www.r-project.org/posting-guide.html

is broken. The - that should be in the link:

http://cran.r-project.org/doc/FAQ/R-FAQ.html#R-Bugs

is currently %20:

http://cran.r-project.org/doc/FAQ/R-FAQ.html#R%20Bugs


From delmeric at gmail.com  Wed Jan  9 20:01:28 2008
From: delmeric at gmail.com (Derek Stephen Elmerick)
Date: Wed, 9 Jan 2008 14:01:28 -0500
Subject: [Rd] read.table: aborting based on a time constraint
Message-ID: <d054d5fa0801091101p3a93cd2ey7df35352416d2e6f@mail.gmail.com>

Hello ?

I am trying to write code that will read in multiple datasets;
however, I would like to skip any dataset where the read-in process
takes longer than some fixed cutoff. A generic version of the function
is the following:

for(k in  1:number.of.datasets)
{
   X[k]=read.table(?)
}

The issue is that I cannot find a way to embed logic that will abort
the read-in process of a specific dataset without manual intervention.
I scanned the help manual and other postings, but no luck based on my
search. Any thoughts?

Thanks,
Derek


From sdavis2 at mail.nih.gov  Wed Jan  9 20:34:27 2008
From: sdavis2 at mail.nih.gov (Sean Davis)
Date: Wed, 9 Jan 2008 14:34:27 -0500
Subject: [Rd] read.table: aborting based on a time constraint
In-Reply-To: <d054d5fa0801091101p3a93cd2ey7df35352416d2e6f@mail.gmail.com>
References: <d054d5fa0801091101p3a93cd2ey7df35352416d2e6f@mail.gmail.com>
Message-ID: <264855a00801091134s104fb63fldcab2695e1303be@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080109/59bd7ea0/attachment.pl 

From ggrothendieck at gmail.com  Wed Jan  9 21:27:31 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 9 Jan 2008 15:27:31 -0500
Subject: [Rd] read.table: aborting based on a time constraint
In-Reply-To: <d054d5fa0801091101p3a93cd2ey7df35352416d2e6f@mail.gmail.com>
References: <d054d5fa0801091101p3a93cd2ey7df35352416d2e6f@mail.gmail.com>
Message-ID: <971536df0801091227k7206d511x4d5af52ff54237fc@mail.gmail.com>

Use file.file()$size to find out how large the file is
and skip files larger than some cutoff.

On Jan 9, 2008 2:01 PM, Derek Stephen Elmerick <delmeric at gmail.com> wrote:
> Hello ?
>
> I am trying to write code that will read in multiple datasets;
> however, I would like to skip any dataset where the read-in process
> takes longer than some fixed cutoff. A generic version of the function
> is the following:
>
> for(k in  1:number.of.datasets)
> {
>   X[k]=read.table(?)
> }
>
> The issue is that I cannot find a way to embed logic that will abort
> the read-in process of a specific dataset without manual intervention.
> I scanned the help manual and other postings, but no luck based on my
> search. Any thoughts?
>
> Thanks,
> Derek
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ggrothendieck at gmail.com  Wed Jan  9 21:27:47 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 9 Jan 2008 15:27:47 -0500
Subject: [Rd] read.table: aborting based on a time constraint
In-Reply-To: <971536df0801091227k7206d511x4d5af52ff54237fc@mail.gmail.com>
References: <d054d5fa0801091101p3a93cd2ey7df35352416d2e6f@mail.gmail.com>
	<971536df0801091227k7206d511x4d5af52ff54237fc@mail.gmail.com>
Message-ID: <971536df0801091227g7cc015c7w6f2b24535b1f70f3@mail.gmail.com>

That was supposed to be file.info()$size

On Jan 9, 2008 3:27 PM, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> Use file.file()$size to find out how large the file is
> and skip files larger than some cutoff.
>
> On Jan 9, 2008 2:01 PM, Derek Stephen Elmerick <delmeric at gmail.com> wrote:
>
> > Hello ?
> >
> > I am trying to write code that will read in multiple datasets;
> > however, I would like to skip any dataset where the read-in process
> > takes longer than some fixed cutoff. A generic version of the function
> > is the following:
> >
> > for(k in  1:number.of.datasets)
> > {
> >   X[k]=read.table(?)
> > }
> >
> > The issue is that I cannot find a way to embed logic that will abort
> > the read-in process of a specific dataset without manual intervention.
> > I scanned the help manual and other postings, but no luck based on my
> > search. Any thoughts?
> >
> > Thanks,
> > Derek
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>


From bill at insightful.com  Wed Jan  9 21:33:13 2008
From: bill at insightful.com (Bill Dunlap)
Date: Wed, 9 Jan 2008 12:33:13 -0800 (PST)
Subject: [Rd] read.table: aborting based on a time constraint
In-Reply-To: <d054d5fa0801091101p3a93cd2ey7df35352416d2e6f@mail.gmail.com>
References: <d054d5fa0801091101p3a93cd2ey7df35352416d2e6f@mail.gmail.com>
Message-ID: <Pine.GSO.4.56.0801091213240.17807@devsun3201.insightful.com>

On Wed, 9 Jan 2008, Derek Stephen Elmerick wrote:

> Hello ?
>
> I am trying to write code that will read in multiple datasets;
> however, I would like to skip any dataset where the read-in process
> takes longer than some fixed cutoff. A generic version of the function
> is the following:
>
> for(k in  1:number.of.datasets)
> {
>    X[k]=read.table(?)
> }
>
> The issue is that I cannot find a way to embed logic that will abort
> the read-in process of a specific dataset without manual intervention.
> I scanned the help manual and other postings, but no luck based on my
> search. Any thoughts?

A long time ago, for S, I write a timeout(expr, seconds)
function that would return the value of expr if it completed
before 'seconds' seconds went by but would throw an error
otherwise.  One could then use try(timeout(expr, seconds))
to catch the error.

It only worked on Unix, as it spawned another process that would send
an interrupt signal back to S after the allotted time.  If the
expression were evaluated before the interrupter process finished, then S
would kill the interrupter process.  It relied on S catching the interrupt
and turning it into an error condition.

Translated into R code (unix()->system(intern=T)),
this function would be

   timeout <- function(expr, seconds = 60) {
     killer.pid <- system(intern = TRUE, paste(" (sleep", seconds,
        " ; echo 'Timed out after",
        seconds, "seconds' 1>&2 ; kill -INT", Sys.getpid(),
        ")>/dev/null&\n echo $!"))
     on.exit(system(paste("kill", killer.pid, "> /dev/null 2>&1")))
     expr
   }

E.g.,

   > timeout(log(2), seconds=1)
   [1] 0.6931472
   > timeout(while(TRUE)log(2), seconds=1)
   Timed out after 1 seconds

   >  # you get the prompt back in 1 second

R's try() doesn't catch interrupts and I haven't studied
tryCatch enough to use it to catch the interrupt.

This is pretty ugly, but I was wondering if R had the
facilities to write such a timeout() function.
I used to use it to automate tests of infinite-loop bugs.

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From edd at debian.org  Wed Jan  9 21:40:23 2008
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 9 Jan 2008 14:40:23 -0600
Subject: [Rd] read.table: aborting based on a time constraint
In-Reply-To: <971536df0801091227k7206d511x4d5af52ff54237fc@mail.gmail.com>
References: <d054d5fa0801091101p3a93cd2ey7df35352416d2e6f@mail.gmail.com>
	<971536df0801091227k7206d511x4d5af52ff54237fc@mail.gmail.com>
Message-ID: <20080109204023.GA5436@eddelbuettel.com>

On Wed, Jan 09, 2008 at 03:27:31PM -0500, Gabor Grothendieck wrote:
> Use file.file()$size to find out how large the file is
> and skip files larger than some cutoff.

You presumably meant file.info()$size 

Dirk

> 
> On Jan 9, 2008 2:01 PM, Derek Stephen Elmerick <delmeric at gmail.com> wrote:
> > Hello ?
> >
> > I am trying to write code that will read in multiple datasets;
> > however, I would like to skip any dataset where the read-in process
> > takes longer than some fixed cutoff. A generic version of the function
> > is the following:
> >
> > for(k in  1:number.of.datasets)
> > {
> >   X[k]=read.table(?)
> > }
> >
> > The issue is that I cannot find a way to embed logic that will abort
> > the read-in process of a specific dataset without manual intervention.
> > I scanned the help manual and other postings, but no luck based on my
> > search. Any thoughts?
> >
> > Thanks,
> > Derek
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Three out of two people have difficulties with fractions.


From hin-tak.leung at cimr.cam.ac.uk  Thu Jan 10 11:34:37 2008
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Thu, 10 Jan 2008 10:34:37 +0000
Subject: [Rd] pdf viewers Re:  Evaluating R expressions
In-Reply-To: <200801042138.m04LcAF13105@hsrnfs-101.mayo.edu>
References: <200801042138.m04LcAF13105@hsrnfs-101.mayo.edu>
Message-ID: <4785F4BD.5020508@cimr.cam.ac.uk>

Rather off topic, while acrobat reader is Adobe and authoritative,
there are a lot of other 3rd-party pdf viewers around. xpdf
(http://www.foolabs.com/xpdf/download.html) provides text search
functionally and mostly just a single binary so it shouldn't require
sysadmin installation or assistance to use. Should make your life a bit 
easier when you are searching for something in big thick manuals.

Terry Therneau wrote:
> All,
>   Thank you for the prompt and useful answers to my questions.
>   
>   I had missed references in 5.7.6 which would have answered some of the points. 
> As Bill pointed out a newer version of acrobat would help, but the Sun system 
> here is still running 5.0.  (An oversubscribed sysadmin).  Then I could have 
> searched and at at least avoided the most trivial.
>   All three comments were different, and all three helped.
>  
>   Terry T.
>   
> "I see" said the blind carpenter, as he picked up his hammer and saw.  (A 
> favorite phrase of my mother's when something became clear).
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From edward.m at psu.ac.th  Thu Jan 10 10:33:14 2008
From: edward.m at psu.ac.th (Edward)
Date: Thu, 10 Jan 2008 16:33:14 +0700
Subject: [Rd] write.dta (foreign package)
Message-ID: <4785E65A.2080605@psu.ac.th>

Hi,
I'd like to request that the 'write.dta' command also save the 
"var.labels" attributes of the data frame.
'read.dta' can read them, but 'write.dta' doesn't write them back.
Thanks....
Edward McNeil

-- 
Epidemiology Unit
Faculty of Medicine
Prince of Songkla University
Hat Yai
THAILAND

 (\_ _/)
 (='.'=)
('')_('')


-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From ripley at stats.ox.ac.uk  Thu Jan 10 14:59:29 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 10 Jan 2008 13:59:29 +0000 (GMT)
Subject: [Rd] write.dta (foreign package)
In-Reply-To: <4785E65A.2080605@psu.ac.th>
References: <4785E65A.2080605@psu.ac.th>
Message-ID: <Pine.LNX.4.64.0801101356490.3623@gannet.stats.ox.ac.uk>

On Thu, 10 Jan 2008, Edward wrote:

> Hi,
> I'd like to request that the 'write.dta' command also save the
> "var.labels" attributes of the data frame.
> 'read.dta' can read them, but 'write.dta' doesn't write them back.

Perhaps you could provide a patch?  Very few of us have Stata which would 
be needed to check this out.

Note that a general data frame will not have a "var.labels" attribute, so 
you need careful validity checking.

> Thanks....
> Edward McNeil
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Fri Jan 11 09:37:10 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 11 Jan 2008 09:37:10 +0100
Subject: [Rd] R Bugs link broken
In-Reply-To: <971536df0801090854g214c8c61g1e34473399e3836@mail.gmail.com>
References: <971536df0801090854g214c8c61g1e34473399e3836@mail.gmail.com>
Message-ID: <18311.10934.260359.122625@stat.math.ethz.ch>

>>>>> "GaGr" == Gabor Grothendieck <ggrothendieck at gmail.com>
>>>>>     on Wed, 9 Jan 2008 11:54:15 -0500 writes:

    GaGr> The link to R Bugs in the posting guide
    GaGr> http://www.r-project.org/posting-guide.html

    GaGr> is broken.

What's your definition of broken?

    GaGr> http://cran.r-project.org/doc/FAQ/R-FAQ.html#R-Bugs

    GaGr> is currently %20:

    GaGr> http://cran.r-project.org/doc/FAQ/R-FAQ.html#R%20Bugs

Yes, but that *does* work for me.
I've even logged into an M$ server machine and tested the
dreaded M$ IE for you.

Martin


From P.Dalgaard at biostat.ku.dk  Fri Jan 11 09:53:03 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Fri, 11 Jan 2008 09:53:03 +0100
Subject: [Rd] R Bugs link broken
In-Reply-To: <18311.10934.260359.122625@stat.math.ethz.ch>
References: <971536df0801090854g214c8c61g1e34473399e3836@mail.gmail.com>
	<18311.10934.260359.122625@stat.math.ethz.ch>
Message-ID: <47872E6F.6000409@biostat.ku.dk>

Martin Maechler wrote:
>>>>>> "GaGr" == Gabor Grothendieck <ggrothendieck at gmail.com>
>>>>>>     on Wed, 9 Jan 2008 11:54:15 -0500 writes:
>>>>>>             
>
>     GaGr> The link to R Bugs in the posting guide
>     GaGr> http://www.r-project.org/posting-guide.html
>
>     GaGr> is broken.
>
> What's your definition of broken?
>
>     GaGr> http://cran.r-project.org/doc/FAQ/R-FAQ.html#R-Bugs
>
>     GaGr> is currently %20:
>
>     GaGr> http://cran.r-project.org/doc/FAQ/R-FAQ.html#R%20Bugs
>
> Yes, but that *does* work for me.
> I've even logged into an M$ server machine and tested the
> dreaded M$ IE for you.
>
>   
Perhaps someone already fixed this? It is a bit ambiguous what
"currently" means above....

Currently (sic!) the posting guide has ...#R-Bugs as the link, and that
goes to the relevant section of the FAQ.
The ...#R%20Bugs goes to the top of the FAQ. So I'd say that things are
as they should be and anything else would be wrong.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From maechler at stat.math.ethz.ch  Fri Jan 11 09:53:50 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 11 Jan 2008 09:53:50 +0100
Subject: [Rd] R-FAQ.html change breaks "R Bugs" link in posting guide.
In-Reply-To: <18311.10934.260359.122625@stat.math.ethz.ch>
References: <971536df0801090854g214c8c61g1e34473399e3836@mail.gmail.com>
	<18311.10934.260359.122625@stat.math.ethz.ch>
Message-ID: <18311.11934.719042.281502@stat.math.ethz.ch>

>>>>> "MM" == Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Fri, 11 Jan 2008 09:37:10 +0100 writes:

>>>>> "GaGr" == Gabor Grothendieck <ggrothendieck at gmail.com>
>>>>>     on Wed, 9 Jan 2008 11:54:15 -0500 writes:

    GaGr> The link to R Bugs in the posting guide
    GaGr> http://www.r-project.org/posting-guide.html

    GaGr> is broken.

  MM> What's your definition of broken?

ok. That it points to the wrong place (even though to the
correct page)

    GaGr> http://cran.r-project.org/doc/FAQ/R-FAQ.html#R-Bugs

    GaGr> is currently %20:

    GaGr> http://cran.r-project.org/doc/FAQ/R-FAQ.html#R%20Bugs

    MM> Yes, but that *does* work for me.

it works by going to the FAQ but not the the R Bugs section.
So, Gabor is all correct here. [Please apologize, Gabor!]

There's a 2nd link in the posting guide that has also stopped working
namely
 <a
href="http://cran.r-project.org/doc/FAQ/R-FAQ.html#Add-on%20packages%20in%20R">
Add-on packages in R</a>

due to changes in the R-FAQ.html
and since R-FAQ.html is auto-constructed from R-FAQ.texi
which has
------------------------------
@node R Bugs, Acknowledgments, R Programming, Top
@chapter R Bugs
------------------------------

this seems to be a change in the  Texinfo -> HTML translation,
and I'd say a rather unfortunate one.

Kurt, do you have any idea,
what has changed here?

Regards,
Martin


From maechler at stat.math.ethz.ch  Fri Jan 11 11:39:06 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 11 Jan 2008 11:39:06 +0100
Subject: [Rd] R-FAQ.html change breaks "R Bugs" link in posting guide.
In-Reply-To: <18311.11934.719042.281502@stat.math.ethz.ch>
References: <971536df0801090854g214c8c61g1e34473399e3836@mail.gmail.com>
	<18311.10934.260359.122625@stat.math.ethz.ch>
	<18311.11934.719042.281502@stat.math.ethz.ch>
Message-ID: <18311.18250.74940.174040@stat.math.ethz.ch>

>>>>> "MM" == Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Fri, 11 Jan 2008 09:53:50 +0100 writes:

>>>>> "MM" == Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Fri, 11 Jan 2008 09:37:10 +0100 writes:

>>>>> "GaGr" == Gabor Grothendieck <ggrothendieck at gmail.com>
>>>>>     on Wed, 9 Jan 2008 11:54:15 -0500 writes:

    GaGr> The link to R Bugs in the posting guide
    GaGr> http://www.r-project.org/posting-guide.html

    GaGr> is broken.

    MM> What's your definition of broken?

    MM> ok. That it points to the wrong place (even though to the
    MM> correct page)

    GaGr> http://cran.r-project.org/doc/FAQ/R-FAQ.html#R-Bugs

    GaGr> is currently %20:

    GaGr> http://cran.r-project.org/doc/FAQ/R-FAQ.html#R%20Bugs

    MM> Yes, but that *does* work for me.

    MM> it works by going to the FAQ but not the the R Bugs section.
    MM> So, Gabor is all correct here. [Please apologize, Gabor!]

    MM> There's a 2nd link in the posting guide that has also stopped working
    MM> namely
    MM> <a
    MM> href="http://cran.r-project.org/doc/FAQ/R-FAQ.html#Add-on%20packages%20in%20R">
    MM> Add-on packages in R</a>

    MM> due to changes in the R-FAQ.html
    MM> and since R-FAQ.html is auto-constructed from R-FAQ.texi
    MM> which has
    MM> ------------------------------
    MM> @node R Bugs, Acknowledgments, R Programming, Top
    MM> @chapter R Bugs
    MM> ------------------------------

    MM> this seems to be a change in the  Texinfo -> HTML translation,
    MM> and I'd say a rather unfortunate one.

but then, I've checked:  
This is the current default of what 

   makeinfo --html --no-split --css-include=$(srcdir)/Rman.css -D UseExternalXrefs -I$(srcdir) R-FAQ.texi -o R-FAQ.html

delivers (and that's what we end up using in <Rsources>/doc/manual/ ).

I'm updating the posting guide.
Thank you, Gabor, for the initial "heads up"!
Martin


From ggrothendieck at gmail.com  Fri Jan 11 15:35:25 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 11 Jan 2008 09:35:25 -0500
Subject: [Rd] R Bugs link broken
In-Reply-To: <971536df0801090854g214c8c61g1e34473399e3836@mail.gmail.com>
References: <971536df0801090854g214c8c61g1e34473399e3836@mail.gmail.com>
Message-ID: <971536df0801110635o119584c2s5bc2c3499f8cb993@mail.gmail.com>

With the dash it goes to section 9.1 entitled R Bugs but with
the %20 it goes to the top.  It should go to 9.1; however, it
looks likes someone fixed it since I posted.

On Jan 9, 2008 11:54 AM, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> The link to R Bugs in the posting guide
>
>  http://www.r-project.org/posting-guide.html
>
> is broken. The - that should be in the link:
>
> http://cran.r-project.org/doc/FAQ/R-FAQ.html#R-Bugs
>
> is currently %20:
>
> http://cran.r-project.org/doc/FAQ/R-FAQ.html#R%20Bugs
>


From hin-tak.leung at cimr.cam.ac.uk  Fri Jan 11 16:17:54 2008
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Fri, 11 Jan 2008 15:17:54 +0000
Subject: [Rd] do_gsub (PR#10540)
In-Reply-To: <20080102174538.4B6D7283416A@mail.pubhealth.ku.dk>
References: <20080102174538.4B6D7283416A@mail.pubhealth.ku.dk>
Message-ID: <478788A2.80608@cimr.cam.ac.uk>

I believe STRING_ELT() works even when pat is R_NilValue, so
the first line "does the right thing" even if the first element does not 
exist. I think this is intentional and not a bug.

Other more knowledgeable people please correct me if I am wrong.

A.R.Runnalls at kent.ac.uk wrote:
> In character.c within R 2.6.1, the function do_gsub contains the following 
> code:
> 
> 1199        if (STRING_ELT(pat, 0) == NA_STRING) {
> 1200            PROTECT(ans = allocVector(STRSXP, n));
> 1201            for(i = 0; i < n; i++)  SET_STRING_ELT(ans, i, NA_STRING);
> 1202            UNPROTECT(1);
> 1203            return ans;
> 1204        }
> 1205
> 1206        if (length(pat) < 1 || length(rep) < 1) error(R_MSG_IA);
> 
> Line 1206 checks that pat contains at least one element.  However, line 1199 
> has already attempted to access the first element.  The check should surely 
> come first.
> 
> Andrew Runnalls
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jojeda at unizar.es  Fri Jan 11 16:19:35 2008
From: jojeda at unizar.es (Jorge Luis Ojeda Cabrera)
Date: Fri, 11 Jan 2008 16:19:35 +0100
Subject: [Rd] Adding weights to ecdf
Message-ID: <47878907.10307@unizar.es>

I would like you consider that the function ecdf
could be extended in the following way to handle weights
when computing Empirical distribution Functions. There
exist particular cases that supports this kind of
extension, see for example:

Rao, C. R., 1997.
Statistic and True. Putting chance to work.
World Scientific Publishing.

Cox, D. R., 1969.
Some Sampling Problems in Technology.
New Developments in Survey Sampling, pg. 506--527
John Wiley, New York.

Vardi, Y., 1982.
Nonparametric estimation in the presence of length bias
The Annals of Statistics, vol. 10, num. 2 , pg. 616--620.

Gill, Richard D. and Vardi, Yehuda and Wellner, Jon A., 1988.
Large sample theory of empirical distributions in biased sampling models.
The Annals of Statistics, vol. 16, num. 3, pg. 1069--1112.

and all the references there in.

In this case, and for observations x=(x1,x2, ... xn), with
weights weig=(w1, w2,..., wn), Fn(t) is the addition of the
normalized weights nwi=wi/sum(weig) for all i such that
xi observations less or equal to t i.e.,

Fn(t) = w1/(sum(i=1,n)wi) sum(i=1,n) Indicator(xi <= t).

The code I suggest to use is the following

newEcdf <- function (x,weig=rep(1,length(x)))
#	x = vector with observations.
#	weig = weigths, one per observation.
{
     n <- length(x)
     if (n < 1)
         stop("'x' have 1 or more non-missing values")
	if (n != length(weig))
         stop("'weig' must have same length than 'x'")
     xPerm <- order(x)
     weig <- weig/sum(weig)
     x <- x[xPerm]
     weig <- weig[xPerm]
	ndIdx <- !duplicated(x)
     vals <- x[ndIdx]
     weig <- sapply(x[ndIdx],function(xx) sum(weig[x==xx]))
     rval <- approxfun(vals, cumsum(weig),
         method = "constant", yleft = 0, yright = 1, f = 0, ties = 
"ordered")
     class(rval) <- c("ecdf", "stepfun", class(rval))
     attr(rval, "call") <- sys.call()
     rval
}


and as a particular example, to see how the E.C.D.F. behaves
in the length--biased framework consider running the following
function with different values for n


lengthBiasExample <- function(n=100)
{
	distFun <- function(x) pgamma(x,shape=1,rate=1)
	##lenght biased version of a gamma(shape=1,rate=1)
     x <- rgamma(n,shape=2,rate=1)
	par(ask=T)
	Fx <- ecdf(x)
	newFx <- newEcdf(x,1/x)
	plot(Fx,pch="+")
	curve(distFun,from=0,to=10,add=T,col="red")
	plot(newFx,pch="+")
	curve(distFun,from=0,to=10,add=T,col="red")
	print(summary(newFx))
	par(ask=F)
}


Thank you very much in advance, Jorge.


Jorge Luis Ojeda Cabrera
Prof. Asoc. del Dep. M?todos Estad?sticos.

Univ. de Zaragoza.
Fac. de Ciencias, Edif. Matem?ticas.
Pedro Cerbuna, num. 12.
50009 Zaragoza.
Spain.


Tlf.:    34 76 762884
Fax:    34 76 761115
jojeda at unizar.es


From marc_schwartz at comcast.net  Sat Jan 12 03:35:21 2008
From: marc_schwartz at comcast.net (Marc Schwartz)
Date: Fri, 11 Jan 2008 20:35:21 -0600
Subject: [Rd] hist.Date() and cut.Date(): approximations used when using
 breaks = 'months' or 'years'
Message-ID: <47882769.2080902@comcast.net>

Hi all,

I came across some curious behavior today in using hist.Date() and
subsequently noted the same behavior in cut.Date(), both of which are
using similar code when 'breaks = "months"' or 'breaks = "years"'.

I was in the process of creating a histogram of subject enrollment in a
clinical trial. The counts needed to be by month, so essentially used:

  hist(Dates, breaks = "months")

When reviewing the counts generated, I noted a discrepancy between the
histogram and another frequency table generated independently. In
attempting to identify the etiology, I reviewed the code for hist.Date()
and noted the following:

          start <- as.POSIXlt(min(x, na.rm = TRUE))
...
          if (valid == 3) {
              start$mday <- 1
              incr <- 31
          }
          if (valid == 4) {
              start$mon <- 0
              incr <- 366
          }
          start <- .Internal(POSIXlt2Date(start))
          maxx <- max(x, na.rm = TRUE)
          breaks <- seq.int(start, maxx + incr, breaks)
          breaks <- breaks[1:(1 + max(which(breaks < maxx)))]
...
    res <- hist.default(unclass(x), unclass(breaks), plot = FALSE,
        ...)


The first check is for breaks = "months" and the second for "years".  If
I am reading it correctly, it seems that the discrepancy is due to the
approximations of the numbers of days in a month and the number of days
in a year, respectively, which get further and further off, especially
for "boundary" dates near the interval breaks.

The use of approximations is not noted in ?hist.Date (or in ?cut.Date),
so I was a bit surprised.

To give a specific example, I have uploaded a text file containing a
date series that shows at least some aspects of the discrepancy.



# Read in the file and convert to dates
# Total of 1361 entries
Dates <-
as.Date(scan("http://home.comcast.net/~marc_schwartz/Dates.txt", what =
"character"))


# Get the hist.Date() counts for months
> hist(Dates, breaks = "months", plot = FALSE)$counts
 [1]  2  3  2  9 10 15 21 34 52 85 77 59 56 71 73 55 52 88 67 66 74 86
[23] 58 96 64 71 15


# Get the hist.Date() counts for years
> hist(Dates, breaks = "years", plot = FALSE)$counts
[1]   6 533 822


# Now format the dates for the subsequent counts
months <- format(Dates, format = "%m")
years <- format(Dates, format = "%Y")


# Tabulate the years - NOTE there are 4 years, not 3 as above
> table(years)
years
2005 2006 2007 2008
   5  491  850   15


# Now split months by years and tabulate - NOTE count diffs
> sapply(split(months, years), table)
$`2005`

11 12
 1  4

$`2006`

01 02 03 04 05 06 07 08 09 10 11 12
 2  8 11 14 18 38 45 85 84 58 54 74

$`2007`

01 02 03 04 05 06 07 08 09 10 11 12
71 57 52 78 74 69 70 90 57 87 74 71

$`2008`

01
15


I think that it becomes clear just how far off the hist.Dates() based
counts are, though this is clearly affected by the specific date series
in question.

I would like to suggest that a warning be added to both hist.Date() and
to cut.Date() giving users a heads up that approximations are being used
for these intervals, possibly resulting in count errors.

If it is desirable, I would be willing to spend some time incorporating
code similar to the above, as appropriate for each interval
specification, and make it available for both functions. I suspect
additional tweaking would be required to handle other aspects of the two
functions as required.

If there are any pitfalls that I should be aware of that perhaps have
led to the use of the current approach, I'd love to hear about them, so
that I can avoid re-inventing the wheel, if it is desired for me to
proceed with code updates here.

Thanks,

Marc Schwartz


From f.harrell at vanderbilt.edu  Sat Jan 12 15:11:51 2008
From: f.harrell at vanderbilt.edu (Frank E Harrell Jr)
Date: Sat, 12 Jan 2008 08:11:51 -0600
Subject: [Rd] Adding weights to ecdf
Message-ID: <4788CAA7.203@vanderbilt.edu>

The Ecdf function in the Hmisc package already has a weights argument.
-- 
Frank E Harrell Jr   Professor and Chair           School of Medicine
                      Department of Biostatistics   Vanderbilt University


From AlexanderP at gmx.at  Sat Jan 12 17:28:07 2008
From: AlexanderP at gmx.at (AlexanderP at gmx.at)
Date: Sat, 12 Jan 2008 17:28:07 +0100
Subject: [Rd] Embedding R
Message-ID: <20080112162807.219410@gmx.net>

hello all,

is there somewhere a comprehensive documentation for the (C) functions used for embedded R? (e.g. the functions which are used in the directory \tests\Embedding in the R source)
or
Are there somewhere many more examples for this? (especially handover of data between C and embedded R)

thanks,
Alex
--


From edd at debian.org  Sat Jan 12 18:41:35 2008
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sat, 12 Jan 2008 11:41:35 -0600
Subject: [Rd] Embedding R
In-Reply-To: <20080112162807.219410@gmx.net>
References: <20080112162807.219410@gmx.net>
Message-ID: <18312.64463.276251.888235@ron.nulle.part>


On 12 January 2008 at 17:28, AlexanderP at gmx.at wrote:
| hello all,
| 
| is there somewhere a comprehensive documentation for the (C) functions used
| for embedded R? (e.g. the functions which are used in the directory
| \tests\Embedding in the R source) 
| or
| Are there somewhere many more examples for this? (especially handover of
| data between C and embedded R) 

Not really.  I have done it based on how littler [1] works, and I am
basically doing the same from C++ -- I form R expression that I 'send' to R
and I use Dominick's under-appreciated RCpp (on CRAN) to easily convert R and
C++ data structures.  Poking around in the RCpp examples and the littler code
should get you started.

As for the data handover, this is more or less the same as 'normal' exchange
between R and C/C++ functions -- so the R-Exts manual, and the RCpp
documentation can help.

I hope to have something more to show, share and talk about for the UseR
tutorial I'll give.

In the interim, another choice may be RServe by Simon which you can run on
the local computer too.

Hope this helps,  Dirk
 
[1] http://dirk.eddelbuettel.com/code/littler.tml as well as Jeff's site

-- 
Three out of two people have difficulties with fractions.


From hin-tak.leung at cimr.cam.ac.uk  Sun Jan 13 14:42:02 2008
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Sun, 13 Jan 2008 13:42:02 +0000
Subject: [Rd] Embedding R
In-Reply-To: <20080112162807.219410@gmx.net>
References: <20080112162807.219410@gmx.net>
Message-ID: <478A152A.3050708@cimr.cam.ac.uk>

Hmm, you need to read R-exts throughoutly. There are tonnes of 
information in there, and a few chapters devoted to the topics you are 
after.

As for actual examples - the known GUIs - Rgnome on unix (which AFAIK is
no longer maintained but still useful as an example, I guess), Rgui on 
windows, and a few of the omegahat projects, RSJava, RSPython, RSPerl...
all of these I mentioned are fairly heavy-going though. But R-exts is 
really what you need to read throughoutly...

AlexanderP at gmx.at wrote:
> hello all,
> 
> is there somewhere a comprehensive documentation for the (C) functions used for embedded R? (e.g. the functions which are used in the directory \tests\Embedding in the R source)
> or
> Are there somewhere many more examples for this? (especially handover of data between C and embedded R)
> 
> thanks,
> Alex
> --
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From r.hankin at noc.soton.ac.uk  Mon Jan 14 09:11:52 2008
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Mon, 14 Jan 2008 08:11:52 +0000
Subject: [Rd] as.function()
Message-ID: <39993FF2-8FE4-4FB9-A752-8A3ABAB18CEF@noc.soton.ac.uk>

Hi

[this after some considerable thought as to R-help vs R-devel]



I want to write a (S3) method for as.function();
toy example follows.

Given a matrix "a", I need to evaluate trace(ax) as a function of
(matrix) "x".

Here's a trace function:

tr <-  function (a)  {
     i <- seq_len(nrow(a))
     return(sum(a[cbind(i, i)]))
}


How do I accomplish the following:


a <- crossprod(matrix(rnorm(12),ncol=3))
class(a) <- "foo"

f <- as.function(a)       # need help to write as.function.foo()
x <- diag(3)

f(x)             #should give tr(ax)

a <- 4
f(x)           # should still give tr(ax) even though "a" has been  
reassigned.





[my real example is very much more complicated than this but
I need this toy one too and I can't see how to modify  
as.function.polynomial()
to do what I want]




--
Robin Hankin
Uncertainty Analyst and Neutral Theorist,
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From antonio.fabio at gmail.com  Mon Jan 14 09:45:37 2008
From: antonio.fabio at gmail.com (Antonio, Fabio Di Narzo)
Date: Mon, 14 Jan 2008 09:45:37 +0100
Subject: [Rd] as.function()
In-Reply-To: <39993FF2-8FE4-4FB9-A752-8A3ABAB18CEF@noc.soton.ac.uk>
References: <39993FF2-8FE4-4FB9-A752-8A3ABAB18CEF@noc.soton.ac.uk>
Message-ID: <b0808fdc0801140045s7058fb2dqe9a9ebb9a4084d1e@mail.gmail.com>

2008/1/14, Robin Hankin <r.hankin at noc.soton.ac.uk>:
> Hi
>
> [this after some considerable thought as to R-help vs R-devel]
>
>
>
> I want to write a (S3) method for as.function();
> toy example follows.
>
> Given a matrix "a", I need to evaluate trace(ax) as a function of
> (matrix) "x".
>
> Here's a trace function:
>
> tr <-  function (a)  {
>      i <- seq_len(nrow(a))
>      return(sum(a[cbind(i, i)]))
> }
>
>
> How do I accomplish the following:
>
>
> a <- crossprod(matrix(rnorm(12),ncol=3))
> class(a) <- "foo"
>
> f <- as.function(a)       # need help to write as.function.foo()
> x <- diag(3)
>
> f(x)             #should give tr(ax)

What about the following?

as.function.foo <- function(a, ...)
  function(x)
    sum(diag(a*x))

However, I don't see the need for an S3 method. Why don't simply use (?):
mulTraceFun <- function(a)
  function(x)
   sum(diag(a*x))

So you also have a more meaningful name than an anonymous 'as.function'.

HTH,
Antonio.

>
> a <- 4
> f(x)           # should still give tr(ax) even though "a" has been
> reassigned.

This would'nt work with my proposal, because of lexical scoping.

>
>
>
>
>
> [my real example is very much more complicated than this but
> I need this toy one too and I can't see how to modify
> as.function.polynomial()
> to do what I want]
>
>
>
>
> --
> Robin Hankin
> Uncertainty Analyst and Neutral Theorist,
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>   tel  023-8059-7743
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Antonio, Fabio Di Narzo
Ph.D. student at
Department of Statistical Sciences
University of Bologna, Italy


From r.hankin at noc.soton.ac.uk  Mon Jan 14 10:35:34 2008
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Mon, 14 Jan 2008 09:35:34 +0000
Subject: [Rd] as.function()
In-Reply-To: <b0808fdc0801140045s7058fb2dqe9a9ebb9a4084d1e@mail.gmail.com>
References: <39993FF2-8FE4-4FB9-A752-8A3ABAB18CEF@noc.soton.ac.uk>
	<b0808fdc0801140045s7058fb2dqe9a9ebb9a4084d1e@mail.gmail.com>
Message-ID: <14380496-D85E-4F6C-9E8D-42554C5E269D@noc.soton.ac.uk>

Antonio


thanks for your help here, but it doesn't answer my question.

Perhaps if I outline my motivation it would help.


I want to recreate the ability of
the "polynom" package to do the following:


 > library(polynom)
 > p <- polynomial(1:4)
 > p
1 + 2*x + 3*x^2 + 4*x^3
 > MySpecialFunction <- as.function(p)
 > MySpecialFunction(1:10)
  [1]   10   49  142  313  586  985 1534 2257 3178 4321
 > p <- 4
 > MySpecialFunction(1:10)
  [1]   10   49  142  313  586  985 1534 2257 3178 4321
 >


See how the user can define object "MySpecialFunction",
  which outlives short-lived polynomial "p".

Unfortunately, I don't see a way to modify as.function.polynomial()
to do what I want.


best wishes


rksh









On 14 Jan 2008, at 08:45, Antonio, Fabio Di Narzo wrote:

> 2008/1/14, Robin Hankin <r.hankin at noc.soton.ac.uk>:
>> Hi
>>
>> [this after some considerable thought as to R-help vs R-devel]
>>
>>
>>
>> I want to write a (S3) method for as.function();
>> toy example follows.
>>
>> Given a matrix "a", I need to evaluate trace(ax) as a function of
>> (matrix) "x".
>>
>> Here's a trace function:
>>
>> tr <-  function (a)  {
>>     i <- seq_len(nrow(a))
>>     return(sum(a[cbind(i, i)]))
>> }
>>
>>
>> How do I accomplish the following:
>>
>>
>> a <- crossprod(matrix(rnorm(12),ncol=3))
>> class(a) <- "foo"
>>
>> f <- as.function(a)       # need help to write as.function.foo()
>> x <- diag(3)
>>
>> f(x)             #should give tr(ax)
>
> What about the following?
>
> as.function.foo <- function(a, ...)
>  function(x)
>    sum(diag(a*x))
>
> However, I don't see the need for an S3 method. Why don't simply use  
> (?):
> mulTraceFun <- function(a)
>  function(x)
>   sum(diag(a*x))
>
> So you also have a more meaningful name than an anonymous  
> 'as.function'.
>
> HTH,
> Antonio.
>
>>
>> a <- 4
>> f(x)           # should still give tr(ax) even though "a" has been
>> reassigned.
>
> This would'nt work with my proposal, because of lexical scoping.
>
>>
>>
>>
>>
>>
>> [my real example is very much more complicated than this but
>> I need this toy one too and I can't see how to modify
>> as.function.polynomial()
>> to do what I want]
>>
>>
>>
>>
>> --
>> Robin Hankin
>> Uncertainty Analyst and Neutral Theorist,
>> National Oceanography Centre, Southampton
>> European Way, Southampton SO14 3ZH, UK
>>  tel  023-8059-7743
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
> -- 
> Antonio, Fabio Di Narzo
> Ph.D. student at
> Department of Statistical Sciences
> University of Bologna, Italy

--
Robin Hankin
Uncertainty Analyst and Neutral Theorist,
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From wwwhsd at gmail.com  Mon Jan 14 11:37:02 2008
From: wwwhsd at gmail.com (Henrique Dallazuanna)
Date: Mon, 14 Jan 2008 08:37:02 -0200
Subject: [Rd] as.function()
In-Reply-To: <14380496-D85E-4F6C-9E8D-42554C5E269D@noc.soton.ac.uk>
References: <39993FF2-8FE4-4FB9-A752-8A3ABAB18CEF@noc.soton.ac.uk>
	<b0808fdc0801140045s7058fb2dqe9a9ebb9a4084d1e@mail.gmail.com>
	<14380496-D85E-4F6C-9E8D-42554C5E269D@noc.soton.ac.uk>
Message-ID: <da79af330801140237t36af5f45y2c196210b3dd4764@mail.gmail.com>

Try this:

as.function.foo <- function(obj, ...)
{
newobj <- function(x, ...){}
body(newobj) <- obj
return(newobj)
}

x <- expression(2*x + 3*x^2)

foo <- as.function.foo(x)
foo(2)


Hope this help

On 14/01/2008, Robin Hankin <r.hankin at noc.soton.ac.uk> wrote:
> Antonio
>
>
> thanks for your help here, but it doesn't answer my question.
>
> Perhaps if I outline my motivation it would help.
>
>
> I want to recreate the ability of
> the "polynom" package to do the following:
>
>
>  > library(polynom)
>  > p <- polynomial(1:4)
>  > p
> 1 + 2*x + 3*x^2 + 4*x^3
>  > MySpecialFunction <- as.function(p)
>  > MySpecialFunction(1:10)
>   [1]   10   49  142  313  586  985 1534 2257 3178 4321
>  > p <- 4
>  > MySpecialFunction(1:10)
>   [1]   10   49  142  313  586  985 1534 2257 3178 4321
>  >
>
>
> See how the user can define object "MySpecialFunction",
>   which outlives short-lived polynomial "p".
>
> Unfortunately, I don't see a way to modify as.function.polynomial()
> to do what I want.
>
>
> best wishes
>
>
> rksh
>
>
>
>
>
>
>
>
>
> On 14 Jan 2008, at 08:45, Antonio, Fabio Di Narzo wrote:
>
> > 2008/1/14, Robin Hankin <r.hankin at noc.soton.ac.uk>:
> >> Hi
> >>
> >> [this after some considerable thought as to R-help vs R-devel]
> >>
> >>
> >>
> >> I want to write a (S3) method for as.function();
> >> toy example follows.
> >>
> >> Given a matrix "a", I need to evaluate trace(ax) as a function of
> >> (matrix) "x".
> >>
> >> Here's a trace function:
> >>
> >> tr <-  function (a)  {
> >>     i <- seq_len(nrow(a))
> >>     return(sum(a[cbind(i, i)]))
> >> }
> >>
> >>
> >> How do I accomplish the following:
> >>
> >>
> >> a <- crossprod(matrix(rnorm(12),ncol=3))
> >> class(a) <- "foo"
> >>
> >> f <- as.function(a)       # need help to write as.function.foo()
> >> x <- diag(3)
> >>
> >> f(x)             #should give tr(ax)
> >
> > What about the following?
> >
> > as.function.foo <- function(a, ...)
> >  function(x)
> >    sum(diag(a*x))
> >
> > However, I don't see the need for an S3 method. Why don't simply use
> > (?):
> > mulTraceFun <- function(a)
> >  function(x)
> >   sum(diag(a*x))
> >
> > So you also have a more meaningful name than an anonymous
> > 'as.function'.
> >
> > HTH,
> > Antonio.
> >
> >>
> >> a <- 4
> >> f(x)           # should still give tr(ax) even though "a" has been
> >> reassigned.
> >
> > This would'nt work with my proposal, because of lexical scoping.
> >
> >>
> >>
> >>
> >>
> >>
> >> [my real example is very much more complicated than this but
> >> I need this toy one too and I can't see how to modify
> >> as.function.polynomial()
> >> to do what I want]
> >>
> >>
> >>
> >>
> >> --
> >> Robin Hankin
> >> Uncertainty Analyst and Neutral Theorist,
> >> National Oceanography Centre, Southampton
> >> European Way, Southampton SO14 3ZH, UK
> >>  tel  023-8059-7743
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >
> >
> > --
> > Antonio, Fabio Di Narzo
> > Ph.D. student at
> > Department of Statistical Sciences
> > University of Bologna, Italy
>
> --
> Robin Hankin
> Uncertainty Analyst and Neutral Theorist,
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>   tel  023-8059-7743
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Henrique Dallazuanna
Curitiba-Paran?-Brasil
25? 25' 40" S 49? 16' 22" O


From ripley at stats.ox.ac.uk  Mon Jan 14 11:57:00 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 14 Jan 2008 10:57:00 +0000 (GMT)
Subject: [Rd] as.function()
In-Reply-To: <da79af330801140237t36af5f45y2c196210b3dd4764@mail.gmail.com>
References: <39993FF2-8FE4-4FB9-A752-8A3ABAB18CEF@noc.soton.ac.uk>
	<b0808fdc0801140045s7058fb2dqe9a9ebb9a4084d1e@mail.gmail.com>
	<14380496-D85E-4F6C-9E8D-42554C5E269D@noc.soton.ac.uk>
	<da79af330801140237t36af5f45y2c196210b3dd4764@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0801141050560.27437@auk.stats>

On Mon, 14 Jan 2008, Henrique Dallazuanna wrote:

> Try this:
>
> as.function.foo <- function(obj, ...)
> {
> newobj <- function(x, ...){}
> body(newobj) <- obj
> return(newobj)
> }
>
> x <- expression(2*x + 3*x^2)
>
> foo <- as.function.foo(x)
> foo(2)

Well, that copies what as.function.polynomial did but that was written 
for S3 well before R was started.  Here you can use environments:

as.function.foo <- function(obj, ...) function(x, ...) eval(obj)


>
>
> Hope this help
>
> On 14/01/2008, Robin Hankin <r.hankin at noc.soton.ac.uk> wrote:
>> Antonio
>>
>>
>> thanks for your help here, but it doesn't answer my question.
>>
>> Perhaps if I outline my motivation it would help.
>>
>>
>> I want to recreate the ability of
>> the "polynom" package to do the following:
>>
>>
>> > library(polynom)
>> > p <- polynomial(1:4)
>> > p
>> 1 + 2*x + 3*x^2 + 4*x^3
>> > MySpecialFunction <- as.function(p)
>> > MySpecialFunction(1:10)
>>   [1]   10   49  142  313  586  985 1534 2257 3178 4321
>> > p <- 4
>> > MySpecialFunction(1:10)
>>   [1]   10   49  142  313  586  985 1534 2257 3178 4321
>> >
>>
>>
>> See how the user can define object "MySpecialFunction",
>>   which outlives short-lived polynomial "p".
>>
>> Unfortunately, I don't see a way to modify as.function.polynomial()
>> to do what I want.
>>
>>
>> best wishes
>>
>>
>> rksh
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> On 14 Jan 2008, at 08:45, Antonio, Fabio Di Narzo wrote:
>>
>>> 2008/1/14, Robin Hankin <r.hankin at noc.soton.ac.uk>:
>>>> Hi
>>>>
>>>> [this after some considerable thought as to R-help vs R-devel]
>>>>
>>>>
>>>>
>>>> I want to write a (S3) method for as.function();
>>>> toy example follows.
>>>>
>>>> Given a matrix "a", I need to evaluate trace(ax) as a function of
>>>> (matrix) "x".
>>>>
>>>> Here's a trace function:
>>>>
>>>> tr <-  function (a)  {
>>>>     i <- seq_len(nrow(a))
>>>>     return(sum(a[cbind(i, i)]))
>>>> }
>>>>
>>>>
>>>> How do I accomplish the following:
>>>>
>>>>
>>>> a <- crossprod(matrix(rnorm(12),ncol=3))
>>>> class(a) <- "foo"
>>>>
>>>> f <- as.function(a)       # need help to write as.function.foo()
>>>> x <- diag(3)
>>>>
>>>> f(x)             #should give tr(ax)
>>>
>>> What about the following?
>>>
>>> as.function.foo <- function(a, ...)
>>>  function(x)
>>>    sum(diag(a*x))
>>>
>>> However, I don't see the need for an S3 method. Why don't simply use
>>> (?):
>>> mulTraceFun <- function(a)
>>>  function(x)
>>>   sum(diag(a*x))
>>>
>>> So you also have a more meaningful name than an anonymous
>>> 'as.function'.
>>>
>>> HTH,
>>> Antonio.
>>>
>>>>
>>>> a <- 4
>>>> f(x)           # should still give tr(ax) even though "a" has been
>>>> reassigned.
>>>
>>> This would'nt work with my proposal, because of lexical scoping.
>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> [my real example is very much more complicated than this but
>>>> I need this toy one too and I can't see how to modify
>>>> as.function.polynomial()
>>>> to do what I want]
>>>>
>>>>
>>>>
>>>>
>>>> --
>>>> Robin Hankin
>>>> Uncertainty Analyst and Neutral Theorist,
>>>> National Oceanography Centre, Southampton
>>>> European Way, Southampton SO14 3ZH, UK
>>>>  tel  023-8059-7743
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>>
>>> --
>>> Antonio, Fabio Di Narzo
>>> Ph.D. student at
>>> Department of Statistical Sciences
>>> University of Bologna, Italy
>>
>> --
>> Robin Hankin
>> Uncertainty Analyst and Neutral Theorist,
>> National Oceanography Centre, Southampton
>> European Way, Southampton SO14 3ZH, UK
>>   tel  023-8059-7743
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From galway at rand.org  Fri Jan 11 19:55:22 2008
From: galway at rand.org (galway at rand.org)
Date: Fri, 11 Jan 2008 19:55:22 +0100 (CET)
Subject: [Rd] Possible bug in R 2.6.1 (PR#10565)
Message-ID: <20080111185523.2781D283462E@mail.pubhealth.ku.dk>

Colleagues,

=20

In using the paste command I have to spell out the collapse option:

=20

> paste(1:3,coll=3D"a")

[1] "1 a" "2 a" "3 a"

> paste(1:3,collapse=3D"a")

[1] "1a2a3"

=20

My understanding is that the abbreviation coll should be adequate.
Actually, even collaps isn't enough:

=20

paste(1:3,collaps=3D"a")

[1] "1 a" "2 a" "3 a"

=20

LG

=20

Lionel Galway, Ph.D.

Senior Statistician

The RAND Corporation     voice: (+1) 310-393-0411 x7957

1776 Main St.                  fax:    (+1) 310-393-4818

Santa Monica, CA 90407 USA

email:  Lionel_Galway at rand.org <mailto:Lionel_Galway at rand.org>=20

=20

=20


__________________________________________________________________________

This email message is for the sole use of the intended r...{{dropped:3}}


From gpau at ebi.ac.uk  Mon Jan 14 11:13:39 2008
From: gpau at ebi.ac.uk (Gregoire Pau)
Date: Mon, 14 Jan 2008 10:13:39 +0000
Subject: [Rd] knnFinder package
Message-ID: <478B35D3.1040200@ebi.ac.uk>

Dear all,

I have found some serious bugs in the knnFinder package (which supports 
data structures and algorithms for both exact and approximate nearest 
neighbor searching in arbitrarily high dimensions) that may trigger 
segmentation faults.
I have fixed them but I had troubles to contact its maintainer Samuel E. 
Kemp (previously with the University of Glamorgan, UK). Do someone know 
where I can reach him ?

Best regards,

Greg
---
Gregoire Pau
EMBL/EBI Cambridge, UK
http://www.ebi.ac.uk/~gpau


From r.hankin at noc.soton.ac.uk  Mon Jan 14 12:37:32 2008
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Mon, 14 Jan 2008 11:37:32 +0000
Subject: [Rd] as.function()
In-Reply-To: <Pine.LNX.4.64.0801141050560.27437@auk.stats>
References: <39993FF2-8FE4-4FB9-A752-8A3ABAB18CEF@noc.soton.ac.uk>
	<b0808fdc0801140045s7058fb2dqe9a9ebb9a4084d1e@mail.gmail.com>
	<14380496-D85E-4F6C-9E8D-42554C5E269D@noc.soton.ac.uk>
	<da79af330801140237t36af5f45y2c196210b3dd4764@mail.gmail.com>
	<Pine.LNX.4.64.0801141050560.27437@auk.stats>
Message-ID: <E51E9392-6C55-419C-ADB3-BBBD2140EC30@noc.soton.ac.uk>


On 14 Jan 2008, at 10:57, Prof Brian Ripley wrote:

> On Mon, 14 Jan 2008, Henrique Dallazuanna wrote:
>
>> Try this:
>>
>> as.function.foo <- function(obj, ...)
>> {
>> newobj <- function(x, ...){}
>> body(newobj) <- obj
>> return(newobj)
>> }
>>
>> x <- expression(2*x + 3*x^2)
>>
>> foo <- as.function.foo(x)
>> foo(2)
>
> Well, that copies what as.function.polynomial did but that was  
> written for S3 well before R was started.  Here you can use  
> environments:
>
> as.function.foo <- function(obj, ...) function(x, ...) eval(obj)
>


Yes, "did" is the operative word here.    The new  
as.function.polynomial() is considerably slicker
and more general.

But both old and new versions 'unpick' the polynomial "x" into its  
elements
and create a function, line by line, that depends on the elements of  
"x".

The new version uses:

as.function.polynomial <- function (x, ...)
{

<< clever and efficient creation of list "ex"  as a function of vector  
"x" snipped>>

     f <- function(x) NULL
     body(f) <- ex
     f
}


The old version uses:


as.function.polynomial <- function (x, ...)
{

<< clever and efficient creation of character string "jj"  as a  
function of vector "x" snipped>>

    f <- function(x) NULL
     body(f) <- parse(text = jj )[[1]]
    f
}



If f <- as.function.foo(x),  somehow the "f" object has to include  
within itself
the entirety of "x".   In my case, "x" is [of course] an arbitrary- 
dimensional
array of possibly complex elements.

So I can't use Bill/Kurt's method (at least not easily)  because my
object is considerably more complicated than a vector.
And I don't have an example  that works on a complicated object
to copy.


>
>>
>>
>> Hope this help
>>
>> On 14/01/2008, Robin Hankin <r.hankin at noc.soton.ac.uk> wrote:
>>> Antonio
>>>
>>>
>>> thanks for your help here, but it doesn't answer my question.
>>>
>>> Perhaps if I outline my motivation it would help.
>>>
>>>
>>> I want to recreate the ability of
>>> the "polynom" package to do the following:
>>>
>>>
>>> > library(polynom)
>>> > p <- polynomial(1:4)
>>> > p
>>> 1 + 2*x + 3*x^2 + 4*x^3
>>> > MySpecialFunction <- as.function(p)
>>> > MySpecialFunction(1:10)
>>>  [1]   10   49  142  313  586  985 1534 2257 3178 4321
>>> > p <- 4
>>> > MySpecialFunction(1:10)
>>>  [1]   10   49  142  313  586  985 1534 2257 3178 4321
>>> >
>>>
>>>
>>> See how the user can define object "MySpecialFunction",
>>>  which outlives short-lived polynomial "p".
>>>
>>> Unfortunately, I don't see a way to modify as.function.polynomial()
>>> to do what I want.
>>>
>>>
>>> best wishes
>>>
>>>
>>> rksh
>>>

--
Robin Hankin
Uncertainty Analyst and Neutral Theorist,
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From ripley at stats.ox.ac.uk  Mon Jan 14 12:45:39 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon, 14 Jan 2008 12:45:39 +0100 (CET)
Subject: [Rd] Possible bug in R 2.6.1 (PR#10565)
Message-ID: <20080114114539.D4C9A2834620@mail.pubhealth.ku.dk>

On Fri, 11 Jan 2008, galway at rand.org wrote:

> Colleagues,
>
> =20
>
> In using the paste command I have to spell out the collapse option:
>
> =20
>
>> paste(1:3,coll=3D"a")
>
> [1] "1 a" "2 a" "3 a"
>
>> paste(1:3,collapse=3D"a")
>
> [1] "1a2a3"
>
> =20
>
> My understanding is that the abbreviation coll should be adequate.
> Actually, even collaps isn't enough:

Your understanding is wrong.  The help page says

Usage:

      paste(..., sep = " ", collapse = NULL)

Argument names after ... cannot be abbreviated ('S Programming' p.40, 
amongst other places).

I do often wonder why people are 'sure you know for certain' (to quote the 
FAQ) that something as elementary as this would be a bug for so many 
years. It indicates a lack of respect for the R developers.


>
> =20
>
> paste(1:3,collaps=3D"a")
>
> [1] "1 a" "2 a" "3 a"
>
> =20
>
> LG
>
> =20
>
> Lionel Galway, Ph.D.
>
> Senior Statistician
>
> The RAND Corporation     voice: (+1) 310-393-0411 x7957
>
> 1776 Main St.                  fax:    (+1) 310-393-4818
>
> Santa Monica, CA 90407 USA
>
> email:  Lionel_Galway at rand.org <mailto:Lionel_Galway at rand.org>=20

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch at stats.uwo.ca  Mon Jan 14 12:50:32 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 14 Jan 2008 06:50:32 -0500
Subject: [Rd] as.function()
In-Reply-To: <39993FF2-8FE4-4FB9-A752-8A3ABAB18CEF@noc.soton.ac.uk>
References: <39993FF2-8FE4-4FB9-A752-8A3ABAB18CEF@noc.soton.ac.uk>
Message-ID: <478B4C88.6070205@stats.uwo.ca>

Robin Hankin wrote:
> Hi
>
> [this after some considerable thought as to R-help vs R-devel]
>
>
>
> I want to write a (S3) method for as.function();
> toy example follows.
>
> Given a matrix "a", I need to evaluate trace(ax) as a function of
> (matrix) "x".
>
> Here's a trace function:
>
> tr <-  function (a)  {
>      i <- seq_len(nrow(a))
>      return(sum(a[cbind(i, i)]))
> }
>
>
> How do I accomplish the following:
>
>
> a <- crossprod(matrix(rnorm(12),ncol=3))
> class(a) <- "foo"
>
> f <- as.function(a)       # need help to write as.function.foo()
> x <- diag(3)
>
> f(x)             #should give tr(ax)
>
> a <- 4
> f(x)           # should still give tr(ax) even though "a" has been  
> reassigned.
>
>   
Brian's answer was what you want.  A less general version is this:

 > as.function.foo <- function(x, ...) {
+    function(b) tr(x %*% b)
+ }

(I switched the names of the args, because the first arg to 
as.function.foo should match the name of the first arg to as.function).

I was a little surprised that this worked even if a was changed without 
ever evaluating f, because I thought lazy evaluation would mess up that 
case.  But of course the value of x is forced when R evaluates it to 
find out the class for dispatch to the method.

Duncan Murdoch


From r.hankin at noc.soton.ac.uk  Mon Jan 14 12:59:58 2008
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Mon, 14 Jan 2008 11:59:58 +0000
Subject: [Rd] as.function()
In-Reply-To: <478B4C88.6070205@stats.uwo.ca>
References: <39993FF2-8FE4-4FB9-A752-8A3ABAB18CEF@noc.soton.ac.uk>
	<478B4C88.6070205@stats.uwo.ca>
Message-ID: <1572149B-D187-451B-8A86-E5D9811A5DDB@noc.soton.ac.uk>


On 14 Jan 2008, at 11:50, Duncan Murdoch wrote:

> Robin Hankin wrote:
>> Hi
>>

[snip]

>> a <- crossprod(matrix(rnorm(12),ncol=3))
>> class(a) <- "foo"
>>
>> f <- as.function(a)       # need help to write as.function.foo()
>> x <- diag(3)
>>
>> f(x)             #should give tr(ax)
>>
>> a <- 4
>> f(x)           # should still give tr(ax) even though "a" has been   
>> reassigned.
>>
>>
> Brian's answer was what you want.  A less general version is this:
>
> > as.function.foo <- function(x, ...) {
> +    function(b) tr(x %*% b)
> + }
>


Wow.  Got it!  Looks like I'll have to read the R Language Definition  
again.

Thanks everyone.




> (I switched the names of the args, because the first arg to  
> as.function.foo should match the name of the first arg to  
> as.function).
>
> I was a little surprised that this worked even if a was changed  
> without ever evaluating f, because I thought lazy evaluation would  
> mess up that case.  But of course the value of x is forced when R  
> evaluates it to find out the class for dispatch to the method.
>
> Duncan Murdoch

--
Robin Hankin
Uncertainty Analyst and Neutral Theorist,
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From ripley at stats.ox.ac.uk  Mon Jan 14 13:04:25 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 14 Jan 2008 12:04:25 +0000 (GMT)
Subject: [Rd] as.function()
In-Reply-To: <478B4C88.6070205@stats.uwo.ca>
References: <39993FF2-8FE4-4FB9-A752-8A3ABAB18CEF@noc.soton.ac.uk>
	<478B4C88.6070205@stats.uwo.ca>
Message-ID: <Pine.LNX.4.64.0801141200060.21774@gannet.stats.ox.ac.uk>

On Mon, 14 Jan 2008, Duncan Murdoch wrote:

> Robin Hankin wrote:
>> Hi
>>
>> [this after some considerable thought as to R-help vs R-devel]
>>
>>
>>
>> I want to write a (S3) method for as.function();
>> toy example follows.
>>
>> Given a matrix "a", I need to evaluate trace(ax) as a function of
>> (matrix) "x".
>>
>> Here's a trace function:
>>
>> tr <-  function (a)  {
>>      i <- seq_len(nrow(a))
>>      return(sum(a[cbind(i, i)]))
>> }
>>
>>
>> How do I accomplish the following:
>>
>>
>> a <- crossprod(matrix(rnorm(12),ncol=3))
>> class(a) <- "foo"
>>
>> f <- as.function(a)       # need help to write as.function.foo()
>> x <- diag(3)
>>
>> f(x)             #should give tr(ax)
>>
>> a <- 4
>> f(x)           # should still give tr(ax) even though "a" has been
>> reassigned.
>>
>>
> Brian's answer was what you want.  A less general version is this:
>
> > as.function.foo <- function(x, ...) {
> +    function(b) tr(x %*% b)
> + }

And see the R version of as.function.polynomial called Rpoly in 'S 
Programming' p.95 for a similar example, in case yet another is needed 
(and to set the record straight after RH's unthinking reply).

> (I switched the names of the args, because the first arg to
> as.function.foo should match the name of the first arg to as.function).
>
> I was a little surprised that this worked even if a was changed without
> ever evaluating f, because I thought lazy evaluation would mess up that
> case.  But of course the value of x is forced when R evaluates it to
> find out the class for dispatch to the method.
>
> Duncan Murdoch

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Roger.Bivand at nhh.no  Mon Jan 14 14:29:29 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 14 Jan 2008 14:29:29 +0100 (CET)
Subject: [Rd] knnFinder package
In-Reply-To: <478B35D3.1040200@ebi.ac.uk>
References: <478B35D3.1040200@ebi.ac.uk>
Message-ID: <Pine.LNX.4.64.0801141424370.30966@reclus.nhh.no>

On Mon, 14 Jan 2008, Gregoire Pau wrote:

> Dear all,
>
> I have found some serious bugs in the knnFinder package (which supports
> data structures and algorithms for both exact and approximate nearest
> neighbor searching in arbitrarily high dimensions) that may trigger
> segmentation faults.
> I have fixed them but I had troubles to contact its maintainer Samuel E.
> Kemp (previously with the University of Glamorgan, UK). Do someone know
> where I can reach him ?

I have also tried, for the same reason, without result. He seems to have 
been a student who has now left the university where he wrote the package. 
I also wrote to his apparent supervisor, also without result. My 
suggestion would be that the package be orphaned, and that if you are 
willing to replace it with your version, and to adopt it as maintainer, 
its posting on CRAN can be continued.

Roger

>
> Best regards,
>
> Greg
> ---
> Gregoire Pau
> EMBL/EBI Cambridge, UK
> http://www.ebi.ac.uk/~gpau
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From pinard at iro.umontreal.ca  Mon Jan 14 16:45:13 2008
From: pinard at iro.umontreal.ca (=?iso-8859-1?Q?Fran=E7ois?= Pinard)
Date: Mon, 14 Jan 2008 10:45:13 -0500
Subject: [Rd] Possible bug in R 2.6.1 (PR#10565)
In-Reply-To: <20080114114539.D4C9A2834620@mail.pubhealth.ku.dk>
References: <20080114114539.D4C9A2834620@mail.pubhealth.ku.dk>
Message-ID: <20080114154513.GA15372@phenix.progiciels-bpi.ca>

[Brian Ripley]

>I do often wonder why people are 'sure you know for certain' (to quote the 
>FAQ) that something as elementary as this would be a bug for so many 
>years.  It indicates a lack of respect for the R developers.

Not at all.  A bug report may be naive, or even wrong, and still be 
driven by good will, and be rightly interpreted as an attempt at 
a contribution to both the R community and R developers.

The lack of respect only exists in the head of susceptible developers.
Some of them are nevertheless admirable for their expertise, commitment 
and contributions.  The truth is that, deep down, _nobody_ is perfect.  
Tolerance and kindness usually are more fruitful attitudes, not only on 
the R lists, but everywhere.

-- 
Fran?ois Pinard   http://pinard.progiciels-bpi.ca


From tlumley at u.washington.edu  Mon Jan 14 17:23:56 2008
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Mon, 14 Jan 2008 08:23:56 -0800 (PST)
Subject: [Rd] Possible bug in R 2.6.1 (PR#10565)
In-Reply-To: <20080114154513.GA15372@phenix.progiciels-bpi.ca>
Message-ID: <Pine.LNX.4.43.0801140823560.16045@hymn14.u.washington.edu>

On Mon, 14 Jan 2008, [iso-8859-1] Fran?ois Pinard wrote:

> [Brian Ripley]
>
>> I do often wonder why people are 'sure you know for certain' (to quote the
>> FAQ) that something as elementary as this would be a bug for so many
>> years.  It indicates a lack of respect for the R developers.
>
> Not at all.  A bug report may be naive, or even wrong, and still be
> driven by good will, and be rightly interpreted as an attempt at
> a contribution to both the R community and R developers.
>

Brian's point is that there is an *explicit* request (in both the posting guide and the FAQ) not to send things to R-bugs unless you are *sure* they are bugs.  Queries about *possible* bugs are welcome on r-devel or r-help as appropriate.

Someone who sends a query about a possible bug to r-bugs has either not read the posting guide or has chosen to ignore the request. It is possible that the request in the posting guide is not sufficiently clear and they just misunderstand it, but I haven't seen anyone claim this. If that's what you mean, then suggestions for making it clearer would be considered.

If someone presents code  on r-help or r-devel that produces behaviour they don't understand and asks if it is bug (rather than asserting that it must be a bug) they have a much higher chance of receiving a friendly reply [and an even higher chance of receiving a helpful reply]


    -thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From ggrothendieck at gmail.com  Mon Jan 14 17:48:52 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 14 Jan 2008 11:48:52 -0500
Subject: [Rd] as.function()
In-Reply-To: <478B4C88.6070205@stats.uwo.ca>
References: <39993FF2-8FE4-4FB9-A752-8A3ABAB18CEF@noc.soton.ac.uk>
	<478B4C88.6070205@stats.uwo.ca>
Message-ID: <971536df0801140848o4f77c3f4q14766d42038141a8@mail.gmail.com>

On Jan 14, 2008 6:50 AM, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> Robin Hankin wrote:
> > Hi
> >
> > [this after some considerable thought as to R-help vs R-devel]
> >
> >
> >
> > I want to write a (S3) method for as.function();
> > toy example follows.
> >
> > Given a matrix "a", I need to evaluate trace(ax) as a function of
> > (matrix) "x".
> >
> > Here's a trace function:
> >
> > tr <-  function (a)  {
> >      i <- seq_len(nrow(a))
> >      return(sum(a[cbind(i, i)]))
> > }
> >
> >
> > How do I accomplish the following:
> >
> >
> > a <- crossprod(matrix(rnorm(12),ncol=3))
> > class(a) <- "foo"
> >
> > f <- as.function(a)       # need help to write as.function.foo()
> > x <- diag(3)
> >
> > f(x)             #should give tr(ax)
> >
> > a <- 4
> > f(x)           # should still give tr(ax) even though "a" has been
> > reassigned.
> >
> >
> Brian's answer was what you want.  A less general version is this:
>
>  > as.function.foo <- function(x, ...) {
> +    function(b) tr(x %*% b)
> + }
>

This can also be done using the proto package.  p has two
components b and f.  q inherits f from p but has its own b.

library(proto)
p <- proto(b = 1:4, f = function(., x) sum(diag(x %*% .$b)))
q <- p$proto(b = 5:8)
p$f(1:4)
q$f(1:4)


From ldimitro at wfubmc.edu  Mon Jan 14 18:26:59 2008
From: ldimitro at wfubmc.edu (Latchezar (Lucho) Dimitrov)
Date: Mon, 14 Jan 2008 12:26:59 -0500
Subject: [Rd] Possible bug in R 2.6.1 (PR#10565)
In-Reply-To: <Pine.LNX.4.43.0801140823560.16045@hymn14.u.washington.edu>
References: <20080114154513.GA15372@phenix.progiciels-bpi.ca>
	<Pine.LNX.4.43.0801140823560.16045@hymn14.u.washington.edu>
Message-ID: <F160BE32A2E5E04497668BBDFE83FEDF2427526C@EXCHVS1.medctr.ad.wfubmc.edu>

 

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Thomas Lumley
> Sent: Monday, January 14, 2008 11:24 AM
> To: Fran?ois Pinard
> Cc: ripley at stats.ox.ac.uk; r-devel at stat.math.ethz.ch
> Subject: Re: [Rd] Possible bug in R 2.6.1 (PR#10565)
> 
> On Mon, 14 Jan 2008, [iso-8859-1] Fran?ois Pinard wrote:
> 
> > [Brian Ripley]
> >
> >> I do often wonder why people are 'sure you know for certain' (to 
> >> quote the
> >> FAQ) that something as elementary as this would be a bug 
> for so many 
> >> years.  It indicates a lack of respect for the R developers.
> >
> > Not at all.  A bug report may be naive, or even wrong, and still be 
> > driven by good will, and be rightly interpreted as an attempt at a 
> > contribution to both the R community and R developers.
> >
> 
> Brian's point is

  ... and Fran?ois Pinard's is that you should (sic) be more tolerant and forgiving to _your_ users.

BTW, my standing ovations to Fran?ois Pinard excellent language and wordings. I wish I could do it as well :-(


Thanks for understanding,

Latchezar Dimitrov


> that there is an *explicit* request (in both 
> the posting guide and the FAQ) not to send things to R-bugs 
> unless you are *sure* they are bugs.  Queries about 
> *possible* bugs are welcome on r-devel or r-help as appropriate.
> 
> Someone who sends a query about a possible bug to r-bugs has 
> either not read the posting guide or has chosen to ignore the 
> request. It is possible that the request in the posting guide 
> is not sufficiently clear and they just misunderstand it, but 
> I haven't seen anyone claim this. If that's what you mean, 
> then suggestions for making it clearer would be considered.
> 
> If someone presents code  on r-help or r-devel that produces 
> behaviour they don't understand and asks if it is bug (rather 
> than asserting that it must be a bug) they have a much higher 
> chance of receiving a friendly reply [and an even higher 
> chance of receiving a helpful reply]
> 
> 
>     -thomas
> 
> Thomas Lumley			Assoc. Professor, Biostatistics
> tlumley at u.washington.edu	University of Washington, Seattle
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From richard.cotton at hsl.gov.uk  Mon Jan 14 15:50:06 2008
From: richard.cotton at hsl.gov.uk (richard.cotton at hsl.gov.uk)
Date: Mon, 14 Jan 2008 15:50:06 +0100 (CET)
Subject: [Rd] %s in filename when opening device causes crash (PR#10571)
Message-ID: <20080114145006.C745B2834629@mail.pubhealth.ku.dk>

Full_Name: Richard Cotton
Version: 2.6.1
OS: Windows XP (32bit)
Submission from: (NULL) (193.119.236.82)


Using %s in a filename when opening a device causes R to crash, e.g.,

pdf("foo%s.pdf")
win.metafile("foo%s.wmf")
postscript("foo%s.ps")


From osklyar at ebi.ac.uk  Mon Jan 14 18:50:52 2008
From: osklyar at ebi.ac.uk (Oleg Sklyar)
Date: Mon, 14 Jan 2008 17:50:52 +0000
Subject: [Rd] %s in filename when opening device causes crash (PR#10571)
In-Reply-To: <20080114145006.C745B2834629@mail.pubhealth.ku.dk>
References: <20080114145006.C745B2834629@mail.pubhealth.ku.dk>
Message-ID: <478BA0FC.3060001@ebi.ac.uk>

Same on 2.7.0 Under development (unstable) (2007-12-21 r43753)
using Ubuntu i686 2.6.22-14-generic:

* ~: R
:: R version 2.7.0 Under development (unstable) (2007-12-21 r43753)
pdf> pdf("foo%s.pdf")

  *** caught segfault ***
address 0x1, cause 'memory not mapped'

Traceback:
  1: .External(PDF, file, old$paper, old$family, old$encoding, old$bg, 
    old$fg, old$width, old$height, old$pointsize, onefile, 
old$pagecentre,     old$title, old$fonts, version[1], version[2])
  2: pdf("foo%s.pdf")

Possible actions:
1: abort (with core dump, if enabled)
2: normal R exit
3: exit R without saving workspace
4: exit R saving workspace
Selection: 2
* ~:


richard.cotton at hsl.gov.uk wrote:
> Full_Name: Richard Cotton
> Version: 2.6.1
> OS: Windows XP (32bit)
> Submission from: (NULL) (193.119.236.82)
> 
> 
> Using %s in a filename when opening a device causes R to crash, e.g.,
> 
> pdf("foo%s.pdf")
> win.metafile("foo%s.wmf")
> postscript("foo%s.ps")
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Dr Oleg Sklyar * EBI-EMBL, Cambridge CB10 1SD, UK * +44-1223-494466


From ripley at stats.ox.ac.uk  Mon Jan 14 18:50:23 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon, 14 Jan 2008 18:50:23 +0100 (CET)
Subject: [Rd] %s in filename when opening device causes crash (PR#10571)
Message-ID: <20080114175023.B5B242834612@mail.pubhealth.ku.dk>

On Mon, 14 Jan 2008, richard.cotton at hsl.gov.uk wrote:

> Full_Name: Richard Cotton
> Version: 2.6.1
> OS: Windows XP (32bit)
> Submission from: (NULL) (193.119.236.82)
>
>
> Using %s in a filename when opening a device causes R to crash, e.g.,
>
> pdf("foo%s.pdf")
> win.metafile("foo%s.wmf")
> postscript("foo%s.ps")

Do you have a workaround for this?  Since that is done at C level, we 
can't easily trap this (especially on Windows), and the list of possible 
errors that might cause a crash is rather long.

It has been considered as a vulnerability, but there seems no simple 
solution.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From tplate at acm.org  Mon Jan 14 19:05:28 2008
From: tplate at acm.org (Tony Plate)
Date: Mon, 14 Jan 2008 11:05:28 -0700
Subject: [Rd] as.function()
In-Reply-To: <da79af330801140237t36af5f45y2c196210b3dd4764@mail.gmail.com>
References: <39993FF2-8FE4-4FB9-A752-8A3ABAB18CEF@noc.soton.ac.uk>	<b0808fdc0801140045s7058fb2dqe9a9ebb9a4084d1e@mail.gmail.com>	<14380496-D85E-4F6C-9E8D-42554C5E269D@noc.soton.ac.uk>
	<da79af330801140237t36af5f45y2c196210b3dd4764@mail.gmail.com>
Message-ID: <478BA468.7090404@acm.org>

How about this as a version  that automatically constructs the argument 
list (and make into a method for as.function as appropriate)?

makefun <- function(expr)
{
    f <- function() {}
    body(f) <- expr
    vars <- all.vars(expr)
    if (length(vars)) {
        args <- alist(x=)[rep(1,length(vars))]
        names(args) <- vars
        formals(f) <- args
    }
    environment(f) <- globalenv()
    return(f)
}

 > makefun(expression(2*x + 3*y^2))
function (x, y)
2 * x + 3 * y^2
 > makefun(expression(2*x + 3*y^2 - z))
function (x, y, z)
2 * x + 3 * y^2 - z
 > makefun(expression(p1 + p2))
function (p1, p2)
p1 + p2
 >

-- Tony Plate



Henrique Dallazuanna wrote:
> Try this:
>
> as.function.foo <- function(obj, ...)
> {
> newobj <- function(x, ...){}
> body(newobj) <- obj
> return(newobj)
> }
>
> x <- expression(2*x + 3*x^2)
>
> foo <- as.function.foo(x)
> foo(2)
>
>
> Hope this help
>
> On 14/01/2008, Robin Hankin <r.hankin at noc.soton.ac.uk> wrote:
>   
>> Antonio
>>
>>
>> thanks for your help here, but it doesn't answer my question.
>>
>> Perhaps if I outline my motivation it would help.
>>
>>
>> I want to recreate the ability of
>> the "polynom" package to do the following:
>>
>>
>>  > library(polynom)
>>  > p <- polynomial(1:4)
>>  > p
>> 1 + 2*x + 3*x^2 + 4*x^3
>>  > MySpecialFunction <- as.function(p)
>>  > MySpecialFunction(1:10)
>>   [1]   10   49  142  313  586  985 1534 2257 3178 4321
>>  > p <- 4
>>  > MySpecialFunction(1:10)
>>   [1]   10   49  142  313  586  985 1534 2257 3178 4321
>>  >
>>
>>
>> See how the user can define object "MySpecialFunction",
>>   which outlives short-lived polynomial "p".
>>
>> Unfortunately, I don't see a way to modify as.function.polynomial()
>> to do what I want.
>>
>>
>> best wishes
>>
>>
>> rksh
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> On 14 Jan 2008, at 08:45, Antonio, Fabio Di Narzo wrote:
>>
>>     
>>> 2008/1/14, Robin Hankin <r.hankin at noc.soton.ac.uk>:
>>>       
>>>> Hi
>>>>
>>>> [this after some considerable thought as to R-help vs R-devel]
>>>>
>>>>
>>>>
>>>> I want to write a (S3) method for as.function();
>>>> toy example follows.
>>>>
>>>> Given a matrix "a", I need to evaluate trace(ax) as a function of
>>>> (matrix) "x".
>>>>
>>>> Here's a trace function:
>>>>
>>>> tr <-  function (a)  {
>>>>     i <- seq_len(nrow(a))
>>>>     return(sum(a[cbind(i, i)]))
>>>> }
>>>>
>>>>
>>>> How do I accomplish the following:
>>>>
>>>>
>>>> a <- crossprod(matrix(rnorm(12),ncol=3))
>>>> class(a) <- "foo"
>>>>
>>>> f <- as.function(a)       # need help to write as.function.foo()
>>>> x <- diag(3)
>>>>
>>>> f(x)             #should give tr(ax)
>>>>         
>>> What about the following?
>>>
>>> as.function.foo <- function(a, ...)
>>>  function(x)
>>>    sum(diag(a*x))
>>>
>>> However, I don't see the need for an S3 method. Why don't simply use
>>> (?):
>>> mulTraceFun <- function(a)
>>>  function(x)
>>>   sum(diag(a*x))
>>>
>>> So you also have a more meaningful name than an anonymous
>>> 'as.function'.
>>>
>>> HTH,
>>> Antonio.
>>>
>>>       
>>>> a <- 4
>>>> f(x)           # should still give tr(ax) even though "a" has been
>>>> reassigned.
>>>>         
>>> This would'nt work with my proposal, because of lexical scoping.
>>>
>>>       
>>>>
>>>>
>>>>
>>>> [my real example is very much more complicated than this but
>>>> I need this toy one too and I can't see how to modify
>>>> as.function.polynomial()
>>>> to do what I want]
>>>>
>>>>
>>>>
>>>>
>>>> --
>>>> Robin Hankin
>>>> Uncertainty Analyst and Neutral Theorist,
>>>> National Oceanography Centre, Southampton
>>>> European Way, Southampton SO14 3ZH, UK
>>>>  tel  023-8059-7743
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>         
>>> --
>>> Antonio, Fabio Di Narzo
>>> Ph.D. student at
>>> Department of Statistical Sciences
>>> University of Bologna, Italy
>>>       
>> --
>> Robin Hankin
>> Uncertainty Analyst and Neutral Theorist,
>> National Oceanography Centre, Southampton
>> European Way, Southampton SO14 3ZH, UK
>>   tel  023-8059-7743
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>     
>
>
>


From ggrothendieck at gmail.com  Mon Jan 14 19:16:17 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 14 Jan 2008 13:16:17 -0500
Subject: [Rd] as.function()
In-Reply-To: <478BA468.7090404@acm.org>
References: <39993FF2-8FE4-4FB9-A752-8A3ABAB18CEF@noc.soton.ac.uk>
	<b0808fdc0801140045s7058fb2dqe9a9ebb9a4084d1e@mail.gmail.com>
	<14380496-D85E-4F6C-9E8D-42554C5E269D@noc.soton.ac.uk>
	<da79af330801140237t36af5f45y2c196210b3dd4764@mail.gmail.com>
	<478BA468.7090404@acm.org>
Message-ID: <971536df0801141016n25d55d66w1afe190122ccf348@mail.gmail.com>

The gsubfn package can do something like that too.  If you
preface a function with fn$ then it will interpret certain formula
arguments as functions.  If all we want is the function itself we
can use force, the identity function, to recover it:

> library(gsubfn)
> fn$force(~ 2*x + 3*y^2)
function (x, y)
2 * x + 3 * y^2

If there are free variables in the formula that you don't want to
include in the argument list the left hand side can be used to
specify the argument list:

> fn$force(x + y ~ 2*x + a*y^2)
function (x, y)
2 * x + a * y^2



On Jan 14, 2008 1:05 PM, Tony Plate <tplate at acm.org> wrote:
> How about this as a version  that automatically constructs the argument
> list (and make into a method for as.function as appropriate)?
>
> makefun <- function(expr)
> {
>    f <- function() {}
>    body(f) <- expr
>    vars <- all.vars(expr)
>    if (length(vars)) {
>        args <- alist(x=)[rep(1,length(vars))]
>        names(args) <- vars
>        formals(f) <- args
>    }
>    environment(f) <- globalenv()
>    return(f)
> }
>
>  > makefun(expression(2*x + 3*y^2))
> function (x, y)
> 2 * x + 3 * y^2
>  > makefun(expression(2*x + 3*y^2 - z))
> function (x, y, z)
> 2 * x + 3 * y^2 - z
>  > makefun(expression(p1 + p2))
> function (p1, p2)
> p1 + p2
>  >
>
> -- Tony Plate
>
>
>
>
> Henrique Dallazuanna wrote:
> > Try this:
> >
> > as.function.foo <- function(obj, ...)
> > {
> > newobj <- function(x, ...){}
> > body(newobj) <- obj
> > return(newobj)
> > }
> >
> > x <- expression(2*x + 3*x^2)
> >
> > foo <- as.function.foo(x)
> > foo(2)
> >
> >
> > Hope this help
> >
> > On 14/01/2008, Robin Hankin <r.hankin at noc.soton.ac.uk> wrote:
> >
> >> Antonio
> >>
> >>
> >> thanks for your help here, but it doesn't answer my question.
> >>
> >> Perhaps if I outline my motivation it would help.
> >>
> >>
> >> I want to recreate the ability of
> >> the "polynom" package to do the following:
> >>
> >>
> >>  > library(polynom)
> >>  > p <- polynomial(1:4)
> >>  > p
> >> 1 + 2*x + 3*x^2 + 4*x^3
> >>  > MySpecialFunction <- as.function(p)
> >>  > MySpecialFunction(1:10)
> >>   [1]   10   49  142  313  586  985 1534 2257 3178 4321
> >>  > p <- 4
> >>  > MySpecialFunction(1:10)
> >>   [1]   10   49  142  313  586  985 1534 2257 3178 4321
> >>  >
> >>
> >>
> >> See how the user can define object "MySpecialFunction",
> >>   which outlives short-lived polynomial "p".
> >>
> >> Unfortunately, I don't see a way to modify as.function.polynomial()
> >> to do what I want.
> >>
> >>
> >> best wishes
> >>
> >>
> >> rksh
> >>
> >>
> >>
> >>
> >>
> >>
> >>
> >>
> >>
> >> On 14 Jan 2008, at 08:45, Antonio, Fabio Di Narzo wrote:
> >>
> >>
> >>> 2008/1/14, Robin Hankin <r.hankin at noc.soton.ac.uk>:
> >>>
> >>>> Hi
> >>>>
> >>>> [this after some considerable thought as to R-help vs R-devel]
> >>>>
> >>>>
> >>>>
> >>>> I want to write a (S3) method for as.function();
> >>>> toy example follows.
> >>>>
> >>>> Given a matrix "a", I need to evaluate trace(ax) as a function of
> >>>> (matrix) "x".
> >>>>
> >>>> Here's a trace function:
> >>>>
> >>>> tr <-  function (a)  {
> >>>>     i <- seq_len(nrow(a))
> >>>>     return(sum(a[cbind(i, i)]))
> >>>> }
> >>>>
> >>>>
> >>>> How do I accomplish the following:
> >>>>
> >>>>
> >>>> a <- crossprod(matrix(rnorm(12),ncol=3))
> >>>> class(a) <- "foo"
> >>>>
> >>>> f <- as.function(a)       # need help to write as.function.foo()
> >>>> x <- diag(3)
> >>>>
> >>>> f(x)             #should give tr(ax)
> >>>>
> >>> What about the following?
> >>>
> >>> as.function.foo <- function(a, ...)
> >>>  function(x)
> >>>    sum(diag(a*x))
> >>>
> >>> However, I don't see the need for an S3 method. Why don't simply use
> >>> (?):
> >>> mulTraceFun <- function(a)
> >>>  function(x)
> >>>   sum(diag(a*x))
> >>>
> >>> So you also have a more meaningful name than an anonymous
> >>> 'as.function'.
> >>>
> >>> HTH,
> >>> Antonio.
> >>>
> >>>
> >>>> a <- 4
> >>>> f(x)           # should still give tr(ax) even though "a" has been
> >>>> reassigned.
> >>>>
> >>> This would'nt work with my proposal, because of lexical scoping.
> >>>
> >>>
> >>>>
> >>>>
> >>>>
> >>>> [my real example is very much more complicated than this but
> >>>> I need this toy one too and I can't see how to modify
> >>>> as.function.polynomial()
> >>>> to do what I want]
> >>>>
> >>>>
> >>>>
> >>>>
> >>>> --
> >>>> Robin Hankin
> >>>> Uncertainty Analyst and Neutral Theorist,
> >>>> National Oceanography Centre, Southampton
> >>>> European Way, Southampton SO14 3ZH, UK
> >>>>  tel  023-8059-7743
> >>>>
> >>>> ______________________________________________
> >>>> R-devel at r-project.org mailing list
> >>>> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>>>
> >>>>
> >>> --
> >>> Antonio, Fabio Di Narzo
> >>> Ph.D. student at
> >>> Department of Statistical Sciences
> >>> University of Bologna, Italy
> >>>
> >> --
> >> Robin Hankin
> >> Uncertainty Analyst and Neutral Theorist,
> >> National Oceanography Centre, Southampton
> >> European Way, Southampton SO14 3ZH, UK
> >>   tel  023-8059-7743
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >>
> >
> >
> >
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From P.Dalgaard at biostat.ku.dk  Mon Jan 14 19:18:47 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Mon, 14 Jan 2008 19:18:47 +0100
Subject: [Rd] %s in filename when opening device causes crash (PR#10571)
In-Reply-To: <20080114175023.B5B242834612@mail.pubhealth.ku.dk>
References: <20080114175023.B5B242834612@mail.pubhealth.ku.dk>
Message-ID: <478BA787.8060806@biostat.ku.dk>

ripley at stats.ox.ac.uk wrote:
> On Mon, 14 Jan 2008, richard.cotton at hsl.gov.uk wrote:
>
>   
>> Full_Name: Richard Cotton
>> Version: 2.6.1
>> OS: Windows XP (32bit)
>> Submission from: (NULL) (193.119.236.82)
>>
>>
>> Using %s in a filename when opening a device causes R to crash, e.g.,
>>
>> pdf("foo%s.pdf")
>> win.metafile("foo%s.wmf")
>> postscript("foo%s.ps")
>>     
>
> Do you have a workaround for this?  Since that is done at C level, we 
> can't easily trap this (especially on Windows), and the list of possible 
> errors that might cause a crash is rather long.
>
> It has been considered as a vulnerability, but there seems no simple 
> solution.
>
>   
Yes. The problem is of course that we do want a sprintf() format there
for "Rplot%03d.pdf" et al. One  option would be to escape "%" except
when in (regexp) "%[0-9]*d", which seems nontrivial, but not impossible.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Mon Jan 14 19:32:38 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 14 Jan 2008 18:32:38 +0000 (GMT)
Subject: [Rd] %s in filename when opening device causes crash (PR#10571)
In-Reply-To: <478BA787.8060806@biostat.ku.dk>
References: <20080114175023.B5B242834612@mail.pubhealth.ku.dk>
	<478BA787.8060806@biostat.ku.dk>
Message-ID: <Pine.LNX.4.64.0801141824520.12548@gannet.stats.ox.ac.uk>

On Mon, 14 Jan 2008, Peter Dalgaard wrote:

> ripley at stats.ox.ac.uk wrote:
>> On Mon, 14 Jan 2008, richard.cotton at hsl.gov.uk wrote:
>>
>>
>>> Full_Name: Richard Cotton
>>> Version: 2.6.1
>>> OS: Windows XP (32bit)
>>> Submission from: (NULL) (193.119.236.82)
>>>
>>>
>>> Using %s in a filename when opening a device causes R to crash, e.g.,
>>>
>>> pdf("foo%s.pdf")
>>> win.metafile("foo%s.wmf")
>>> postscript("foo%s.ps")
>>>
>>
>> Do you have a workaround for this?  Since that is done at C level, we
>> can't easily trap this (especially on Windows), and the list of possible
>> errors that might cause a crash is rather long.
>>
>> It has been considered as a vulnerability, but there seems no simple
>> solution.
>>
>>
> Yes. The problem is of course that we do want a sprintf() format there
> for "Rplot%03d.pdf" et al. One  option would be to escape "%" except
> when in (regexp) "%[0-9]*d", which seems nontrivial, but not impossible.

But there are other integer formats (%i, %u, %x, %X), and other flags (# 
might be useful).  So the list of valid inputs is also rather long.  It 
would be tedious to do at C level, but a check in the R-level wrapper 
would be easier (if not 'simple').

BTW, this occurs in other places, e.g. the title argument of quartz() and, 
from R-devel, X11().

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From timh at insightful.com  Mon Jan 14 19:40:08 2008
From: timh at insightful.com (timh at insightful.com)
Date: Mon, 14 Jan 2008 19:40:08 +0100 (CET)
Subject: [Rd] illegal data frame produced by [<-.data.frame (PR#10574)
Message-ID: <20080114184009.AE316283463A@mail.pubhealth.ku.dk>

> x <- data.frame(a=1:3,b=2:4)
> x[,3] <- x
Warning message:
In `[<-.data.frame`(`*tmp*`, , 3, value = list(a = 1:3, b = 2:4)) :
  provided 2 variables to replace 1 variables
> x
  a b a.1  b.1
1 1 2   1 NULL
2 2 3   2 <NA>
3 3 4   3 <NA>
Warning message:
In format.data.frame(x, digits = digits, na.encode = FALSE) :
  corrupt data frame: columns will be truncated or padded with NAs

In S-PLUS, the first warning is given, then a legal data frame
is produced, using only the first column of value.
The following change to R's "[<-.data.frame" gives that behavior.
Change:

    else if (ncolv > p) 
        warning(gettextf("provided %d variables to replace %d variables", 
            ncolv, p), domain = NA)

to:

    else if (ncolv > p) {
        warning(gettextf("provided %d variables to replace %d variables", 
            ncolv, p), domain = NA)
        new.cols <- new.cols[seq_len(p)]
    }






--please do not edit the information below--

Version:
 platform = i386-pc-mingw32
 arch = i386
 os = mingw32
 system = i386, mingw32
 status = 
 major = 2
 minor = 6.1
 year = 2007
 month = 11
 day = 26
 svn rev = 43537
 language = R
 version.string = R version 2.6.1 (2007-11-26)

Windows XP (build 2600) Service Pack 2.0

Locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MONETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

Search Path:
 .GlobalEnv, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, package:methods, Autoloads, package:base


From timh at insightful.com  Mon Jan 14 20:00:16 2008
From: timh at insightful.com (timh at insightful.com)
Date: Mon, 14 Jan 2008 20:00:16 +0100 (CET)
Subject: [Rd] extra space in:  all.equal(5,6) (PR#10575)
Message-ID: <20080114190016.4DB25283462D@mail.pubhealth.ku.dk>

> all.equal(5,6)
[1] "Mean relative  difference: 0.2"

Note the odd extra space.
A fix is to change lines in all.equal.numeric from:

    if (is.na(xy) || xy > tolerance) 
        msg <- c(msg, paste("Mean", what, if (cplx) "Mod", "difference:", 
            format(xy)))

 to:

    if (cplx)
      what <- paste(what, "Mod")
    if (is.na(xy) || xy > tolerance) 
        msg <- c(msg, paste("Mean", what, "difference:", 
            format(xy)))



--please do not edit the information below--

Version:
 platform = i386-pc-mingw32
 arch = i386
 os = mingw32
 system = i386, mingw32
 status = 
 major = 2
 minor = 6.1
 year = 2007
 month = 11
 day = 26
 svn rev = 43537
 language = R
 version.string = R version 2.6.1 (2007-11-26)

Windows XP (build 2600) Service Pack 2.0

Locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MONETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

Search Path:
 .GlobalEnv, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, package:methods, Autoloads, package:base


From murdoch at stats.uwo.ca  Tue Jan 15 00:25:30 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 14 Jan 2008 18:25:30 -0500
Subject: [Rd] rm: failed to get attributes of `/':
In-Reply-To: <6afac6e60801091051p54234844oe963c9bc0f53fff7@mail.gmail.com>
References: <6afac6e60801091051p54234844oe963c9bc0f53fff7@mail.gmail.com>
Message-ID: <478BEF6A.1070908@stats.uwo.ca>

Recently I have heard reports like the one below a couple of times:

Tineke Casneuf wrote:
> However I did encouter an error when trying to install a self-made dummy
> package. I am sure it is not due to the package because it can be build on
> someone else's windows PC.
>
> The error message is *rm: failed to get attributes of `/': No such file or
> directory.
Today I saw one live, and managed to track down the problem.  Cygwin 
(from which the Windows R toolset gets a number of utilities), stores 
information on its mounts in the Windows registry.  If you later 
uninstall it but leave the registry entries in place, you'll get an 
error like the above.  The rm utility thinks that "/" refers to a 
directory like c:\cygwin, but such a directory doesn't exist.

I don't know if this is a bug in the Cygwin uninstaller (which I would 
say should remove registry entries once they are no longer valid), in rm 
(which should ignore mounts that don't make sense), or if it is user 
error.  But the fix is quite simple:  look in the registry (under 
HKEY_CURRENT_USER\Software\Cygnus Solutions\Cygwin\mounts v2, or the 
same location in HKEY_LOCAL_MACHINE), and remove any invalid mounts.

I will modify the Rtools installer to work around this problem.

Duncan Murdoch


From edd at debian.org  Tue Jan 15 05:16:06 2008
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 14 Jan 2008 22:16:06 -0600
Subject: [Rd] Rscript argument processing minor bug with -g
In-Reply-To: <20080105193407.GA13024@stats.ox.ac.uk>
References: <20080105193407.GA13024@stats.ox.ac.uk>
Message-ID: <18316.13190.684215.761581@ron.nulle.part>


On 5 January 2008 at 19:34, Dan Davison wrote:
| I think there's a minor bug in the argument-processing carried out by Rscript.
| The effect is that if one passes "-g" as a flag to the script, it is erroneously 
| exposed to the main executable's argument processing and therefore generates a 
| message about not being able to comply with the request for a particular GUI. 
| Uppercase G is fine as are the other 25 letters in upper or lower case.
| 
| I noticed this with R-2.5.1 and carried out the tests below with R-devel-2.7.0.
[...]
| ~/src/scripts/R> /usr/src/R/R-devel/bin/Rscript -e "commandArgs()" -a -b -f -g -h
| WARNING: unknown gui '-h', using X11
| 
|  [1] "/usr/src/R/R-devel/bin/exec/R" "--slave"                      
|  [3] "--no-restore"                  "-e"                           
|  [5] "commandArgs()"                 "--args"                       
|  [7] "-a"                            "-b"                           
|  [9] "-f"                            "-g"                           
| [11] "-h"                           

For what it's worth, littler does not have that problem with   Following GNU
traditions, we stick all arguments that are not referring to existing
switches into the argv vector which you can access normally:

	edd at ron:~> r -e 'print(argv)' -- -a -b -f -g -h -i -j
	[1] "-a" "-b" "-f" "-g" "-h" "-i" "-j"

It is then up to you to parse these remaining arguments. If you hit an
existing option like -h _before_ the --, its code gets invoked.  This also
works when code is piped into littler (when '-' is used to turn on stdin
parsing):

	edd at ron:~> echo 'print(argv)' | r - -- -a -b -f -g -h -i -j
	[1] "-a" "-b" "-f" "-g" "-h" "-i" "-j"

Prior versions had an off-by-one error in the way argv was built, but version
0.1.0 which I just put onto

	http://dirk.eddelbuettel.com/code/littler.html

should be fine.

Hope this helps,  Dirk

-- 
Three out of two people have difficulties with fractions.


From cgenolin at u-paris10.fr  Tue Jan 15 09:40:26 2008
From: cgenolin at u-paris10.fr (cgenolin at u-paris10.fr)
Date: Tue, 15 Jan 2008 09:40:26 +0100 (CET)
Subject: [Rd] bug in mmlcr ? (PR#10576)
Message-ID: <20080115084026.CAACE2834632@mail.pubhealth.ku.dk>

Hi the list.

Is there a bug in mmlcr package ?
The following code does not compile:

mmlcrTest <- function(dataW){
  dataL <-
reshape(dataW,idvar="id",timevar="T",varying=list("T0","T1","T2"),direction="long",v.names="score")

  resultR <- mmlcr(outer= ~ 1 | id,
                   components = list(list(formula = score~1+T,class=
"normlong")),                         n.groups=3,
                   data=dataL,
                   max.iter=500
                   )
  plot(resultR)
}
mmlcrTest(dataW)

The error is (translate from french):
"Error in inherits(x, "data.frame") : objet "dataL" not find"

It seems that mmlcr does not look for the data at the right place since
it did find dataL if we set it a a global variable but it does not find
it if we define it in a function.

Christophe

----------------------------------------------------------------
Ce message a ete envoye par IMP, grace a l'Universite Paris 10 Nanterre


From Richard.Cotton at hsl.gov.uk  Tue Jan 15 10:45:09 2008
From: Richard.Cotton at hsl.gov.uk (Richard.Cotton at hsl.gov.uk)
Date: Tue, 15 Jan 2008 10:45:09 +0100 (CET)
Subject: [Rd] %s in filename when opening device causes crash (PR#10571)
Message-ID: <20080115094509.AE73D283462B@mail.pubhealth.ku.dk>

> > Using %s in a filename when opening a device causes R to crash, e.g.,
> >
> > pdf("foo%s.pdf")
> > win.metafile("foo%s.wmf")
> > postscript("foo%s.ps")
> 
> Do you have a workaround for this?  Since that is done at C level, we 
> can't easily trap this (especially on Windows), and the list of possible 

> errors that might cause a crash is rather long.
> 
> It has been considered as a vulnerability, but there seems no simple 
> solution.

The simplest workaround is probably to check that '%s' isn't included in 
the character string for the file argument to each of the R wrapper 
functions, something like

if(length(grep("%s", file))) stop("using '%s' in a filename is invalid")

This of course means that we couldn't use '%s' in a file string (is this a 
great loss?), and that users could still cause a crash by calling the 
.External code directly.

Regards,
Richie.

Mathematical Sciences Unit
HSL


------------------------------------------------------------------------
ATTENTION:

This message contains privileged and confidential inform...{{dropped:21}}


From kjbeath at kagi.com  Tue Jan 15 23:42:38 2008
From: kjbeath at kagi.com (Ken Beath)
Date: Wed, 16 Jan 2008 09:42:38 +1100
Subject: [Rd] bug in mmlcr ? (PR#10576)
In-Reply-To: <20080115084026.CAACE2834632@mail.pubhealth.ku.dk>
References: <20080115084026.CAACE2834632@mail.pubhealth.ku.dk>
Message-ID: <FDD13B8A-19A9-4A11-8280-34366A2F07C8@kagi.com>

On 15/01/2008, at 7:40 PM, cgenolin at u-paris10.fr wrote:

> Hi the list.
>
> Is there a bug in mmlcr package ?
> The following code does not compile:
>
> mmlcrTest <- function(dataW){
>  dataL <-
> reshape
> (dataW
> ,idvar
> =
> "id
> ",timevar
> ="T",varying=list("T0","T1","T2"),direction="long",v.names="score")
>
>  resultR <- mmlcr(outer= ~ 1 | id,
>                   components = list(list(formula = score~1+T,class=
> "normlong")),                         n.groups=3,
>                   data=dataL,
>                   max.iter=500
>                   )
>  plot(resultR)
> }
> mmlcrTest(dataW)
>
> The error is (translate from french):
> "Error in inherits(x, "data.frame") : objet "dataL" not find"
>
> It seems that mmlcr does not look for the data at the right place  
> since
> it did find dataL if we set it a a global variable but it does not  
> find
> it if we define it in a function.
>

This should be directed to the package maintainer Steve Buyske, who I  
have included in the reply.

Ken


From hpages at fhcrc.org  Wed Jan 16 01:49:34 2008
From: hpages at fhcrc.org (Herve Pages)
Date: Tue, 15 Jan 2008 16:49:34 -0800
Subject: [Rd] Pb with defineVar() example in the "Writing R Extensions"
	manual
Message-ID: <478D549E.40406@fhcrc.org>

Hi,

I'm wondering if this code from the "Writing R Extensions" manual
is really safe:

     SEXP mkans(double x)
     {
         SEXP ans;
         PROTECT(ans = allocVector(REALSXP, 1));
         REAL(ans)[0] = x;
         UNPROTECT(1);
         return ans;
     }

     double feval(double x, SEXP f, SEXP rho)
     {
         defineVar(install("x"), mkans(x), rho);
         return(REAL(eval(f, rho))[0]);
     }

In C, the order in which function arguments are evaluated before the
function itself is called is undefined. Hence there is no guarantee
that install("x") will be evaluated before mkans(x). What happens if
mkans(x) is evaluated first? Then install("x") will be called and
eventually trigger garbage collection while the SEXP returned by
mkans(x) is still unprotected.

I'm asking because I'm getting all sorts of problems with

  defineVar(install(somekey), mkans(x), rho);

In my code this line is inside a big loop (hundred of thousands of
iterations) so I end up with a lot of symbols in the rho environment.

The problems I've seen are hard to reproduce: sometimes it's a segfault,
sometimes a "cons memory exhausted" error, or sometimes everything looks
fine except that, later, when I retrieve values from the rho environment
with findVar(), some of them are altered!

But if I replace the above line by:

  PROTECT(ans = mkans(x));
  defineVar(install(somekey), ans, rho);
  UNPROTECT(1);

then everything works fine :-)

Cheers,
H.


From P.Dalgaard at biostat.ku.dk  Wed Jan 16 10:58:31 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 16 Jan 2008 10:58:31 +0100
Subject: [Rd] Pb with defineVar() example in the "Writing R Extensions"
 manual
In-Reply-To: <478D549E.40406@fhcrc.org>
References: <478D549E.40406@fhcrc.org>
Message-ID: <478DD547.5080608@biostat.ku.dk>

Herve Pages wrote:
> Hi,
>
> I'm wondering if this code from the "Writing R Extensions" manual
> is really safe:
>
>      SEXP mkans(double x)
>      {
>          SEXP ans;
>          PROTECT(ans = allocVector(REALSXP, 1));
>          REAL(ans)[0] = x;
>          UNPROTECT(1);
>          return ans;
>      }
>
>      double feval(double x, SEXP f, SEXP rho)
>      {
>          defineVar(install("x"), mkans(x), rho);
>          return(REAL(eval(f, rho))[0]);
>      }
>
> In C, the order in which function arguments are evaluated before the
> function itself is called is undefined. Hence there is no guarantee
> that install("x") will be evaluated before mkans(x). What happens if
> mkans(x) is evaluated first? Then install("x") will be called and
> eventually trigger garbage collection while the SEXP returned by
> mkans(x) is still unprotected.
>
> I'm asking because I'm getting all sorts of problems with
>
>   defineVar(install(somekey), mkans(x), rho);
>
> In my code this line is inside a big loop (hundred of thousands of
> iterations) so I end up with a lot of symbols in the rho environment.
>
> The problems I've seen are hard to reproduce: sometimes it's a segfault,
> sometimes a "cons memory exhausted" error, or sometimes everything looks
> fine except that, later, when I retrieve values from the rho environment
> with findVar(), some of them are altered!
>
> But if I replace the above line by:
>
>   PROTECT(ans = mkans(x));
>   defineVar(install(somekey), ans, rho);
>   UNPROTECT(1);
>
> then everything works fine :-)
>
>   
Sounds like you are right. You don't really have the "smoking gun", but
it doesn't seem to be worth trying to catch the actual bug in action
with hardware watchpoints and whatnot.

The opposite fix should work too (does it?):

{ SEXP sym = install(somekey) ; defineVar(sym, mkans(x), rho);}

(I don't think you need to  PROTECT elements in the symbol table)

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From Richard.Cotton at hsl.gov.uk  Wed Jan 16 11:32:23 2008
From: Richard.Cotton at hsl.gov.uk (Richard Cotton)
Date: Wed, 16 Jan 2008 02:32:23 -0800 (PST)
Subject: [Rd] %s in filename when opening device causes crash (PR#10571)
In-Reply-To: <Pine.LNX.4.64.0801141824520.12548@gannet.stats.ox.ac.uk>
References: <20080114145006.C745B2834629@mail.pubhealth.ku.dk>
	<20080114175023.B5B242834612@mail.pubhealth.ku.dk>
	<478BA787.8060806@biostat.ku.dk>
	<Pine.LNX.4.64.0801141824520.12548@gannet.stats.ox.ac.uk>
Message-ID: <14877649.post@talk.nabble.com>




Prof Brian Ripley wrote:
> 
>> Yes. The problem is of course that we do want a sprintf() format there
>> for "Rplot%03d.pdf" et al. One  option would be to escape "%" except
>> when in (regexp) "%[0-9]*d", which seems nontrivial, but not impossible.
> 
> But there are other integer formats (%i, %u, %x, %X), and other flags (# 
> might be useful).  So the list of valid inputs is also rather long.  It 
> would be tedious to do at C level, but a check in the R-level wrapper 
> would be easier (if not 'simple').
> 

Having just worked my way through the alphabet, I can say that it is only
the letters 's' and 'n' that cause any problems.  Thus, if you do decide to
handle the error in the R wrapper functions, the regex for bad inputs is
fairly straightforward "%[#[:blank:]\\+\\-]*[[:digit:]]*[sn]".
-- 
View this message in context: http://www.nabble.com/-s-in-filename-when-opening-device-causes-crash-%28PR-10571%29-tp14806982p14877649.html
Sent from the R devel mailing list archive at Nabble.com.


From P.Dalgaard at biostat.ku.dk  Wed Jan 16 11:56:16 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 16 Jan 2008 11:56:16 +0100
Subject: [Rd] %s in filename when opening device causes crash (PR#10571)
In-Reply-To: <14877649.post@talk.nabble.com>
References: <20080114145006.C745B2834629@mail.pubhealth.ku.dk>	<20080114175023.B5B242834612@mail.pubhealth.ku.dk>	<478BA787.8060806@biostat.ku.dk>	<Pine.LNX.4.64.0801141824520.12548@gannet.stats.ox.ac.uk>
	<14877649.post@talk.nabble.com>
Message-ID: <478DE2D0.5060405@biostat.ku.dk>

Richard Cotton wrote:
>
> Prof Brian Ripley wrote:
>   
>>> Yes. The problem is of course that we do want a sprintf() format there
>>> for "Rplot%03d.pdf" et al. One  option would be to escape "%" except
>>> when in (regexp) "%[0-9]*d", which seems nontrivial, but not impossible.
>>>       
>> But there are other integer formats (%i, %u, %x, %X), and other flags (# 
>> might be useful).  So the list of valid inputs is also rather long.  It 
>> would be tedious to do at C level, but a check in the R-level wrapper 
>> would be easier (if not 'simple').
>>
>>     
>
> Having just worked my way through the alphabet, I can say that it is only
> the letters 's' and 'n' that cause any problems.  Thus, if you do decide to
> handle the error in the R wrapper functions, the regex for bad inputs is
> fairly straightforward "%[#[:blank:]\\+\\-]*[[:digit:]]*[sn]".
>   
Not quite. The floating point formats are also problematic; you may
fetch 8 bytes where only 4 was allocated. Also, %%s should not be
forbidden. Anyways, I believe Brian has this in hand.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Wed Jan 16 12:19:30 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 16 Jan 2008 11:19:30 +0000 (GMT)
Subject: [Rd] %s in filename when opening device causes crash (PR#10571)
In-Reply-To: <14877649.post@talk.nabble.com>
References: <20080114145006.C745B2834629@mail.pubhealth.ku.dk>
	<20080114175023.B5B242834612@mail.pubhealth.ku.dk>
	<478BA787.8060806@biostat.ku.dk>
	<Pine.LNX.4.64.0801141824520.12548@gannet.stats.ox.ac.uk>
	<14877649.post@talk.nabble.com>
Message-ID: <Pine.LNX.4.64.0801161042080.3928@gannet.stats.ox.ac.uk>

On Wed, 16 Jan 2008, Richard Cotton wrote:

>
>
>
> Prof Brian Ripley wrote:
>>
>>> Yes. The problem is of course that we do want a sprintf() format there
>>> for "Rplot%03d.pdf" et al. One  option would be to escape "%" except
>>> when in (regexp) "%[0-9]*d", which seems nontrivial, but not impossible.
>>
>> But there are other integer formats (%i, %u, %x, %X), and other flags (#
>> might be useful).  So the list of valid inputs is also rather long.  It
>> would be tedious to do at C level, but a check in the R-level wrapper
>> would be easier (if not 'simple').
>>
>
> Having just worked my way through the alphabet, I can say that it is only
> the letters 's' and 'n' that cause any problems.  Thus, if you do decide to
> handle the error in the R wrapper functions, the regex for bad inputs is
> fairly straightforward "%[#[:blank:]\\+\\-]*[[:digit:]]*[sn]".

Thanks: but %% (escaped %) should be allowed (and only ASCII blank is 
allowed as a flag, and only ASCII digits).

We decided to do the opposite and test for an allowed format
(you are only allowed to have one).  So the current check is

### Check for a single valid integer format
checkIntFormat <- function(s)
{
     ## OK if no unescaped %, so first remove those
     s <- gsub("%%", "", s)
     if(length(grep("%", s)) == 0) return(TRUE)
     ## now remove at most one valid(ish) integer format
     s <- sub("%[#0 +-]*[0-9.]*[diouxX]", "", s)
     length(grep("%", s)) == 0
}

The set of flags is debatable, and not yet final.  Not all strings that 
pass that test are valid formats, but hopefully the exceptions are

- rare
- will not crash R.

Empirical testing of crashing is not comprehensive and machine-dependent 
even if you use a tool like valgrind to detect violations (32- vs 64-bit 
issues, for example).

Unfortunately there *is* a C-level call to the postscript driver, so some 
C-level checking is needed.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From AlexanderP at gmx.at  Wed Jan 16 16:30:18 2008
From: AlexanderP at gmx.at (AlexanderP at gmx.at)
Date: Wed, 16 Jan 2008 16:30:18 +0100
Subject: [Rd] data types / numerative system
Message-ID: <20080116153018.125600@gmx.net>

hello all,

well it is a general question, surely this is written somewhere but I cannot find it.
where is the full list of 'shortcuts' for numerative systems?
(so 0x123 : hex, 123L : dec(?... or is it for a... long datatype?))
are there in R 'shortcuts' for data types?

thanks,
Alex
-- 
Ist Ihr Browser Vista-kompatibel? Jetzt die neuesten


From murdoch at stats.uwo.ca  Wed Jan 16 16:41:39 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 16 Jan 2008 10:41:39 -0500
Subject: [Rd] data types / numerative system
In-Reply-To: <20080116153018.125600@gmx.net>
References: <20080116153018.125600@gmx.net>
Message-ID: <478E25B3.2040701@stats.uwo.ca>

On 1/16/2008 10:30 AM, AlexanderP at gmx.at wrote:
> hello all,
> 
> well it is a general question, surely this is written somewhere but I cannot find it.
> where is the full list of 'shortcuts' for numerative systems?
> (so 0x123 : hex, 123L : dec(?... or is it for a... long datatype?))
> are there in R 'shortcuts' for data types?

You want to look in the section on "Constants" of the R Language 
References (Section 3.1.1 in the PDF version in 2.6.1).

In summary:  the 0x prefix indicates hex, the L suffix indicates the 
integer type.

Duncan Murdoch


From ripley at stats.ox.ac.uk  Wed Jan 16 16:46:21 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 16 Jan 2008 15:46:21 +0000 (GMT)
Subject: [Rd] data types / numerative system
In-Reply-To: <478E25B3.2040701@stats.uwo.ca>
References: <20080116153018.125600@gmx.net> <478E25B3.2040701@stats.uwo.ca>
Message-ID: <Pine.LNX.4.64.0801161545260.30431@gannet.stats.ox.ac.uk>

On Wed, 16 Jan 2008, Duncan Murdoch wrote:

> On 1/16/2008 10:30 AM, AlexanderP at gmx.at wrote:
>> hello all,
>>
>> well it is a general question, surely this is written somewhere but I cannot find it.
>> where is the full list of 'shortcuts' for numerative systems?
>> (so 0x123 : hex, 123L : dec(?... or is it for a... long datatype?))
>> are there in R 'shortcuts' for data types?
>
> You want to look in the section on "Constants" of the R Language
> References (Section 3.1.1 in the PDF version in 2.6.1).

Or ?NumericConstants, linked from ?Syntax.  (The online help tends to be 
more up-to-date then that _draft_ reference manual.)

>
> In summary:  the 0x prefix indicates hex, the L suffix indicates the
> integer type.
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hpages at fhcrc.org  Wed Jan 16 18:57:11 2008
From: hpages at fhcrc.org (Herve Pages)
Date: Wed, 16 Jan 2008 09:57:11 -0800
Subject: [Rd] Pb with defineVar() example in the "Writing R Extensions"
 manual
In-Reply-To: <478DD547.5080608@biostat.ku.dk>
References: <478D549E.40406@fhcrc.org> <478DD547.5080608@biostat.ku.dk>
Message-ID: <478E4577.8040402@fhcrc.org>

Hi Peter,

Peter Dalgaard wrote:
> Herve Pages wrote:
>> Hi,
>>
>> I'm wondering if this code from the "Writing R Extensions" manual
>> is really safe:
>>
>>      SEXP mkans(double x)
>>      {
>>          SEXP ans;
>>          PROTECT(ans = allocVector(REALSXP, 1));
>>          REAL(ans)[0] = x;
>>          UNPROTECT(1);
>>          return ans;
>>      }
>>
>>      double feval(double x, SEXP f, SEXP rho)
>>      {
>>          defineVar(install("x"), mkans(x), rho);
>>          return(REAL(eval(f, rho))[0]);
>>      }
>>
>> In C, the order in which function arguments are evaluated before the
>> function itself is called is undefined. Hence there is no guarantee
>> that install("x") will be evaluated before mkans(x). What happens if
>> mkans(x) is evaluated first? Then install("x") will be called and
>> eventually trigger garbage collection while the SEXP returned by
>> mkans(x) is still unprotected.
>>
>> I'm asking because I'm getting all sorts of problems with
>>
>>   defineVar(install(somekey), mkans(x), rho);
>>
>> In my code this line is inside a big loop (hundred of thousands of
>> iterations) so I end up with a lot of symbols in the rho environment.
>>
>> The problems I've seen are hard to reproduce: sometimes it's a segfault,
>> sometimes a "cons memory exhausted" error, or sometimes everything looks
>> fine except that, later, when I retrieve values from the rho environment
>> with findVar(), some of them are altered!
>>
>> But if I replace the above line by:
>>
>>   PROTECT(ans = mkans(x));
>>   defineVar(install(somekey), ans, rho);
>>   UNPROTECT(1);
>>
>> then everything works fine :-)
>>
>>   
> Sounds like you are right. You don't really have the "smoking gun", but
> it doesn't seem to be worth trying to catch the actual bug in action
> with hardware watchpoints and whatnot.
> 
> The opposite fix should work too (does it?):
> 
> { SEXP sym = install(somekey) ; defineVar(sym, mkans(x), rho);}

So now you are protected against install(somekey) eventually triggering
garbage collection but you are still not protected against defineVar() itself
triggering garbage collection. Maybe defineVar() does not do that, and will
never do it, but isn't it risky to rely on this kind of assumption?

Thanks!
H.

> 
> (I don't think you need to  PROTECT elements in the symbol table)
>


From P.Dalgaard at biostat.ku.dk  Wed Jan 16 19:11:25 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 16 Jan 2008 19:11:25 +0100
Subject: [Rd] Pb with defineVar() example in the "Writing R Extensions"
 manual
In-Reply-To: <478E4577.8040402@fhcrc.org>
References: <478D549E.40406@fhcrc.org> <478DD547.5080608@biostat.ku.dk>
	<478E4577.8040402@fhcrc.org>
Message-ID: <478E48CD.3000602@biostat.ku.dk>

Herve Pages wrote:
> Hi Peter,
>
> Peter Dalgaard wrote:
>   
>> Herve Pages wrote:
>>     
>>> Hi,
>>>
>>> I'm wondering if this code from the "Writing R Extensions" manual
>>> is really safe:
>>>
>>>      SEXP mkans(double x)
>>>      {
>>>          SEXP ans;
>>>          PROTECT(ans = allocVector(REALSXP, 1));
>>>          REAL(ans)[0] = x;
>>>          UNPROTECT(1);
>>>          return ans;
>>>      }
>>>
>>>      double feval(double x, SEXP f, SEXP rho)
>>>      {
>>>          defineVar(install("x"), mkans(x), rho);
>>>          return(REAL(eval(f, rho))[0]);
>>>      }
>>>
>>> In C, the order in which function arguments are evaluated before the
>>> function itself is called is undefined. Hence there is no guarantee
>>> that install("x") will be evaluated before mkans(x). What happens if
>>> mkans(x) is evaluated first? Then install("x") will be called and
>>> eventually trigger garbage collection while the SEXP returned by
>>> mkans(x) is still unprotected.
>>>
>>> I'm asking because I'm getting all sorts of problems with
>>>
>>>   defineVar(install(somekey), mkans(x), rho);
>>>
>>> In my code this line is inside a big loop (hundred of thousands of
>>> iterations) so I end up with a lot of symbols in the rho environment.
>>>
>>> The problems I've seen are hard to reproduce: sometimes it's a segfault,
>>> sometimes a "cons memory exhausted" error, or sometimes everything looks
>>> fine except that, later, when I retrieve values from the rho environment
>>> with findVar(), some of them are altered!
>>>
>>> But if I replace the above line by:
>>>
>>>   PROTECT(ans = mkans(x));
>>>   defineVar(install(somekey), ans, rho);
>>>   UNPROTECT(1);
>>>
>>> then everything works fine :-)
>>>
>>>   
>>>       
>> Sounds like you are right. You don't really have the "smoking gun", but
>> it doesn't seem to be worth trying to catch the actual bug in action
>> with hardware watchpoints and whatnot.
>>
>> The opposite fix should work too (does it?):
>>
>> { SEXP sym = install(somekey) ; defineVar(sym, mkans(x), rho);}
>>     
>
> So now you are protected against install(somekey) eventually triggering
> garbage collection but you are still not protected against defineVar() itself
> triggering garbage collection. Maybe defineVar() does not do that, and will
> never do it, but isn't it risky to rely on this kind of assumption?
>
> Thanks!
> H.
>   
That's not the problem you raised (argument evaluation order), but
there's a CONS inside defineVar, and as far as I can see, it doesn't
protect its arguments, so you could well be right.

>   
>> (I don't think you need to  PROTECT elements in the symbol table)
>>
>>     
>
>   


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From luke at stat.uiowa.edu  Wed Jan 16 19:15:34 2008
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Wed, 16 Jan 2008 12:15:34 -0600 (CST)
Subject: [Rd] Pb with defineVar() example in the "Writing R Extensions"
 manual
In-Reply-To: <478E48CD.3000602@biostat.ku.dk>
References: <478D549E.40406@fhcrc.org> <478DD547.5080608@biostat.ku.dk>
	<478E4577.8040402@fhcrc.org> <478E48CD.3000602@biostat.ku.dk>
Message-ID: <Pine.LNX.4.64.0801161215070.5979@itasca2.wildberry.org>

On Wed, 16 Jan 2008, Peter Dalgaard wrote:

> Herve Pages wrote:
> Hi Peter,
>
> Peter Dalgaard wrote:
> 
>> Herve Pages wrote:
>> 
>>> Hi,
>>>
>>> I'm wondering if this code from the "Writing R Extensions" manual
>>> is really safe:
>>>
>>>      SEXP mkans(double x)
>>>      {
>>>          SEXP ans;
>>>          PROTECT(ans = allocVector(REALSXP, 1));
>>>          REAL(ans)[0] = x;
>>>          UNPROTECT(1);
>>>          return ans;
>>>      }
>>>
>>>      double feval(double x, SEXP f, SEXP rho)
>>>      {
>>>          defineVar(install("x"), mkans(x), rho);
>>>          return(REAL(eval(f, rho))[0]);
>>>      }
>>>
>>> In C, the order in which function arguments are evaluated before the
>>> function itself is called is undefined. Hence there is no guarantee
>>> that install("x") will be evaluated before mkans(x). What happens if
>>> mkans(x) is evaluated first? Then install("x") will be called and
>>> eventually trigger garbage collection while the SEXP returned by
>>> mkans(x) is still unprotected.
>>>
>>> I'm asking because I'm getting all sorts of problems with
>>>
>>>   defineVar(install(somekey), mkans(x), rho);
>>>
>>> In my code this line is inside a big loop (hundred of thousands of
>>> iterations) so I end up with a lot of symbols in the rho environment.
>>>
>>> The problems I've seen are hard to reproduce: sometimes it's a segfault,
>>> sometimes a "cons memory exhausted" error, or sometimes everything looks
>>> fine except that, later, when I retrieve values from the rho environment
>>> with findVar(), some of them are altered!
>>>
>>> But if I replace the above line by:
>>>
>>>   PROTECT(ans = mkans(x));
>>>   defineVar(install(somekey), ans, rho);
>>>   UNPROTECT(1);
>>>
>>> then everything works fine :-)
>>>
>>>
>>> 
>> Sounds like you are right. You don't really have the "smoking gun", but
>> it doesn't seem to be worth trying to catch the actual bug in action
>> with hardware watchpoints and whatnot.
>>
>> The opposite fix should work too (does it?):
>>
>> { SEXP sym = install(somekey) ; defineVar(sym, mkans(x), rho);}
>> 
>
> So now you are protected against install(somekey) eventually triggering
> garbage collection but you are still not protected against defineVar() itself
> triggering garbage collection. Maybe defineVar() does not do that, and will
> never do it, but isn't it risky to rely on this kind of assumption?
>
> Thanks!
> H.
> 
That's not the problem you raised (argument evaluation order), but
there's a CONS inside defineVar, and as far as I can see, it doesn't
protect its arguments, so you could well be right.

CONS itself protects its arguments though.

luke

> 
>> (I don't think you need to  PROTECT elements in the symbol table)
>>
>> 
>
>


-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu

From P.Dalgaard at biostat.ku.dk  Wed Jan 16 19:27:24 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 16 Jan 2008 19:27:24 +0100
Subject: [Rd] Pb with defineVar() example in the "Writing R Extensions"
 manual
In-Reply-To: <Pine.LNX.4.64.0801161215070.5979@itasca2.wildberry.org>
References: <478D549E.40406@fhcrc.org> <478DD547.5080608@biostat.ku.dk>
	<478E4577.8040402@fhcrc.org> <478E48CD.3000602@biostat.ku.dk>
	<Pine.LNX.4.64.0801161215070.5979@itasca2.wildberry.org>
Message-ID: <478E4C8C.4080008@biostat.ku.dk>

Luke Tierney wrote:
> On Wed, 16 Jan 2008, Peter Dalgaard wrote:
>
>> Herve Pages wrote:
>> Hi Peter,
>>
>> Peter Dalgaard wrote:
>>
>>> Herve Pages wrote:
>>>
>>>> Hi,
>>>>
>>>> I'm wondering if this code from the "Writing R Extensions" manual
>>>> is really safe:
>>>>
>>>>      SEXP mkans(double x)
>>>>      {
>>>>          SEXP ans;
>>>>          PROTECT(ans = allocVector(REALSXP, 1));
>>>>          REAL(ans)[0] = x;
>>>>          UNPROTECT(1);
>>>>          return ans;
>>>>      }
>>>>
>>>>      double feval(double x, SEXP f, SEXP rho)
>>>>      {
>>>>          defineVar(install("x"), mkans(x), rho);
>>>>          return(REAL(eval(f, rho))[0]);
>>>>      }
>>>>
>>>> In C, the order in which function arguments are evaluated before the
>>>> function itself is called is undefined. Hence there is no guarantee
>>>> that install("x") will be evaluated before mkans(x). What happens if
>>>> mkans(x) is evaluated first? Then install("x") will be called and
>>>> eventually trigger garbage collection while the SEXP returned by
>>>> mkans(x) is still unprotected.
>>>>
>>>> I'm asking because I'm getting all sorts of problems with
>>>>
>>>>   defineVar(install(somekey), mkans(x), rho);
>>>>
>>>> In my code this line is inside a big loop (hundred of thousands of
>>>> iterations) so I end up with a lot of symbols in the rho environment.
>>>>
>>>> The problems I've seen are hard to reproduce: sometimes it's a
>>>> segfault,
>>>> sometimes a "cons memory exhausted" error, or sometimes everything
>>>> looks
>>>> fine except that, later, when I retrieve values from the rho
>>>> environment
>>>> with findVar(), some of them are altered!
>>>>
>>>> But if I replace the above line by:
>>>>
>>>>   PROTECT(ans = mkans(x));
>>>>   defineVar(install(somekey), ans, rho);
>>>>   UNPROTECT(1);
>>>>
>>>> then everything works fine :-)
>>>>
>>>>
>>>>
>>> Sounds like you are right. You don't really have the "smoking gun", but
>>> it doesn't seem to be worth trying to catch the actual bug in action
>>> with hardware watchpoints and whatnot.
>>>
>>> The opposite fix should work too (does it?):
>>>
>>> { SEXP sym = install(somekey) ; defineVar(sym, mkans(x), rho);}
>>>
>>
>> So now you are protected against install(somekey) eventually triggering
>> garbage collection but you are still not protected against
>> defineVar() itself
>> triggering garbage collection. Maybe defineVar() does not do that,
>> and will
>> never do it, but isn't it risky to rely on this kind of assumption?
>>
>> Thanks!
>> H.
>>
> That's not the problem you raised (argument evaluation order), but
> there's a CONS inside defineVar, and as far as I can see, it doesn't
> protect its arguments, so you could well be right.

> CONS itself protects its arguments though.
>
> luke
>
Ah, right! (and one of them is "value"). That explains why we haven't
seen crashes left right and center from this....

How about the hashed environment case? R_Newhashpjw and R_HashSet
wouldn't need allocation, and R_HashResize is after the assignment, so I
suppose it is OK.

We should make this sort ot convention more explicit somehow.


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From milbo at sonic.net  Wed Jan 16 19:32:59 2008
From: milbo at sonic.net (Stephen Milborrow)
Date: Wed, 16 Jan 2008 20:32:59 +0200
Subject: [Rd] Just-in-time compiler for R
Message-ID: <004e01c8586e$3d98a580$6401a8c0@G3>

Greetings R developers!

I have been working on a just-in-time compiler for R arithmetic expressions.
An example:


    jit(1)                       # turn on just-in-time compilation
    for(i in 1:na)            # example convolution code
        for(j in 1:nb)
          ab[i + j] <- ab[i + j] + a[i] * b[j]


The loop will run about 30% faster. That's not much of a speedup, but the
code is still in early development and the figure will get much better.

If you are interested there is more information at
www.milbo.users.sonic.net/ra.




Stephen Milborrow
www.milbo.users.sonic.net


From hpages at fhcrc.org  Wed Jan 16 20:02:46 2008
From: hpages at fhcrc.org (Herve Pages)
Date: Wed, 16 Jan 2008 11:02:46 -0800
Subject: [Rd] Pb with defineVar() example in the "Writing R Extensions"
 manual
In-Reply-To: <478E48CD.3000602@biostat.ku.dk>
References: <478D549E.40406@fhcrc.org> <478DD547.5080608@biostat.ku.dk>
	<478E4577.8040402@fhcrc.org> <478E48CD.3000602@biostat.ku.dk>
Message-ID: <478E54D6.5040301@fhcrc.org>

Peter Dalgaard wrote:
> Herve Pages wrote:
>> Hi Peter,
>>
>> Peter Dalgaard wrote:
>>   
>>> Herve Pages wrote:
>>>     
>>>> Hi,
>>>>
>>>> I'm wondering if this code from the "Writing R Extensions" manual
>>>> is really safe:
>>>>
>>>>      SEXP mkans(double x)
>>>>      {
>>>>          SEXP ans;
>>>>          PROTECT(ans = allocVector(REALSXP, 1));
>>>>          REAL(ans)[0] = x;
>>>>          UNPROTECT(1);
>>>>          return ans;
>>>>      }
>>>>
>>>>      double feval(double x, SEXP f, SEXP rho)
>>>>      {
>>>>          defineVar(install("x"), mkans(x), rho);
>>>>          return(REAL(eval(f, rho))[0]);
>>>>      }
>>>>
>>>> In C, the order in which function arguments are evaluated before the
>>>> function itself is called is undefined. Hence there is no guarantee
>>>> that install("x") will be evaluated before mkans(x). What happens if
>>>> mkans(x) is evaluated first? Then install("x") will be called and
>>>> eventually trigger garbage collection while the SEXP returned by
>>>> mkans(x) is still unprotected.
>>>>
>>>> I'm asking because I'm getting all sorts of problems with
>>>>
>>>>   defineVar(install(somekey), mkans(x), rho);
>>>>
>>>> In my code this line is inside a big loop (hundred of thousands of
>>>> iterations) so I end up with a lot of symbols in the rho environment.
>>>>
>>>> The problems I've seen are hard to reproduce: sometimes it's a segfault,
>>>> sometimes a "cons memory exhausted" error, or sometimes everything looks
>>>> fine except that, later, when I retrieve values from the rho environment
>>>> with findVar(), some of them are altered!
>>>>
>>>> But if I replace the above line by:
>>>>
>>>>   PROTECT(ans = mkans(x));
>>>>   defineVar(install(somekey), ans, rho);
>>>>   UNPROTECT(1);
>>>>
>>>> then everything works fine :-)
>>>>
>>>>   
>>>>       
>>> Sounds like you are right. You don't really have the "smoking gun", but
>>> it doesn't seem to be worth trying to catch the actual bug in action
>>> with hardware watchpoints and whatnot.
>>>
>>> The opposite fix should work too (does it?):
>>>
>>> { SEXP sym = install(somekey) ; defineVar(sym, mkans(x), rho);}
>>>     
>> So now you are protected against install(somekey) eventually triggering
>> garbage collection but you are still not protected against defineVar() itself
>> triggering garbage collection. Maybe defineVar() does not do that, and will
>> never do it, but isn't it risky to rely on this kind of assumption?
>>
>> Thanks!
>> H.
>>   
> That's not the problem you raised (argument evaluation order), but
> there's a CONS inside defineVar, and as far as I can see, it doesn't
> protect its arguments, so you could well be right.

This problem is related to my original problem since it would cause the same
disaster: garbage collection on my unprotected SEXP.
The more general problem I'm facing is to know whether or not it is safe to
use a function like mkans() (that returns an unprotected SEXP) like this:

  SET_ELEMENT(ans, 0, mkans(x));

In the case of SET_ELEMENT() or SET_STRING_ELT() it seems to be safe. For
example I've seen this

  SET_STRING_ELT(ans, 0, mkChar(buf));

in many places. So I'm using it too, even if the SEXP returned by mkChar()
is not protected.
Same here:

  SET_ELEMENT(ans, 0, duplicate(x));

The SEXP returned by duplicate() is not protected.

So everybody seems to assume that SET_ELEMENT(), SET_STRING_ELT(),
SET_NAMES(), etc... can't (and will never) trigger garbage collection.
But what about defineVar()? More generally, how do I know this for the
functions/macros listed in Rdefines.h and Rinternals.h?

Thanks!
H.

> 
>>   
>>> (I don't think you need to  PROTECT elements in the symbol table)
>>>
>>>     
>>   
> 
>


From p.dalgaard at biostat.ku.dk  Wed Jan 16 22:31:39 2008
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 16 Jan 2008 22:31:39 +0100
Subject: [Rd] Pb with defineVar() example in the "Writing R Extensions"
 manual
In-Reply-To: <478E54D6.5040301@fhcrc.org>
References: <478D549E.40406@fhcrc.org> <478DD547.5080608@biostat.ku.dk>
	<478E4577.8040402@fhcrc.org> <478E48CD.3000602@biostat.ku.dk>
	<478E54D6.5040301@fhcrc.org>
Message-ID: <478E77BB.3040400@biostat.ku.dk>

Herve Pages wrote:
> Peter Dalgaard wrote:
>>
>> That's not the problem you raised (argument evaluation order), but
>> there's a CONS inside defineVar, and as far as I can see, it doesn't
>> protect its arguments, so you could well be right.
>>     
>
> This problem is related to my original problem since it would cause the same
> disaster: garbage collection on my unprotected SEXP.
>   
Sure, I just wasn't looking there because you told me to look elsewhere....

> The more general problem I'm facing is to know whether or not it is safe to
> use a function like mkans() (that returns an unprotected SEXP) like this:
>
>   SET_ELEMENT(ans, 0, mkans(x));
>
> In the case of SET_ELEMENT() or SET_STRING_ELT() it seems to be safe. For
> example I've seen this
>
>   SET_STRING_ELT(ans, 0, mkChar(buf));
>
> in many places. So I'm using it too, even if the SEXP returned by mkChar()
> is not protected.
> Same here:
>
>   SET_ELEMENT(ans, 0, duplicate(x));
>
> The SEXP returned by duplicate() is not protected.
>
> So everybody seems to assume that SET_ELEMENT(), SET_STRING_ELT(),
> SET_NAMES(), etc... can't (and will never) trigger garbage collection.
> But what about defineVar()? More generally, how do I know this for the
> functions/macros listed in Rdefines.h and Rinternals.h?
>   
>
Yes, that point was well taken. You can't know unless we write it 
somewhere. You can read the sources, but that is no guarantee that it 
won't change in future versions. We should be better at documenting that 
stuff, if for no other reason then to be able to distinguish between 
YOUR bugs and OUR bugs. 

If you grep through the sources, you'll find a number of instances of 
things like

defineVar(name, mkPromise(...), ...)

which would break along with your case, but that is of course only an 
indication, not proof that you can actually leave the value unprotected.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From hpages at fhcrc.org  Wed Jan 16 23:59:20 2008
From: hpages at fhcrc.org (Herve Pages)
Date: Wed, 16 Jan 2008 14:59:20 -0800
Subject: [Rd] Pb with defineVar() example in the "Writing R Extensions"
 manual
In-Reply-To: <478E77BB.3040400@biostat.ku.dk>
References: <478D549E.40406@fhcrc.org> <478DD547.5080608@biostat.ku.dk>
	<478E4577.8040402@fhcrc.org> <478E48CD.3000602@biostat.ku.dk>
	<478E54D6.5040301@fhcrc.org> <478E77BB.3040400@biostat.ku.dk>
Message-ID: <478E8C48.1060807@fhcrc.org>

Peter Dalgaard wrote:
> Herve Pages wrote:
[...]
>> So everybody seems to assume that SET_ELEMENT(), SET_STRING_ELT(),
>> SET_NAMES(), etc... can't (and will never) trigger garbage collection.
>> But what about defineVar()? More generally, how do I know this for the
>> functions/macros listed in Rdefines.h and Rinternals.h?
>>  
> Yes, that point was well taken. You can't know unless we write it
> somewhere. You can read the sources, but that is no guarantee that it
> won't change in future versions. We should be better at documenting that
> stuff, if for no other reason then to be able to distinguish between
> YOUR bugs and OUR bugs.
> If you grep through the sources, you'll find a number of instances of
> things like
> 
> defineVar(name, mkPromise(...), ...)
> 
> which would break along with your case, but that is of course only an
> indication, not proof that you can actually leave the value unprotected.
> 

Agreed. Thanks for your reply!

H.


From michael.hoehle at gmail.com  Thu Jan 17 20:50:33 2008
From: michael.hoehle at gmail.com (michael.hoehle at gmail.com)
Date: Thu, 17 Jan 2008 20:50:33 +0100 (CET)
Subject: [Rd] Problematic sentence in Section 6.1 (Lists) of "An
	introduction to R" (PR#10583)
Message-ID: <20080117195033.66AB12834843@mail.pubhealth.ku.dk>

Full_Name: Michael H?hle
Version: 2.7.0
OS: Mac Os X 10.4.11
Submission from: (NULL) (84.153.81.41)


Dear R developers,

this is not really a bug, but I was confused by the following sentence in
Section 6.1 on lists in "An introduction to R" available from e.g.
http://cran.r-project.org/doc/manuals/R-intro.html#Lists-and-data-frames

Here it says that:

Additionally, one can also use the names of the list components in double square
brackets, i.e., Lst[["name"]] is the same as Lst$name. 
                              ^^^^^^^^^^^
In the above context this might be right, but if one operates with named lists
the $ notation handles abbrevations, whereas the [[]] notation does not.
As a consequence I was surprised by the following code:

control <- list(nameSpace=1) 
if (is.null(control$name)) control$name <- TRUE

Here control$name is recognized as control$nameSpace and thus control$name is
assigned the value TRUE. Had one used control[["name"]] then things would have
worked differently.  Thus Lst[["name"]] might not be the same as Lst$name. 

I admit the entire case might be pedantic, but maybe an extra sentence could
help.
Just a suggestion.


From michael.hoehle at gmail.com  Fri Jan 18 11:30:27 2008
From: michael.hoehle at gmail.com (michael.hoehle at gmail.com)
Date: Fri, 18 Jan 2008 11:30:27 +0100 (CET)
Subject: [Rd] PR#10583
Message-ID: <20080118103027.A8099282EFF7@mail.pubhealth.ku.dk>

Thank you for your quick reply and for only indirectly scolding me for
abusing the RBugs list. :-) However, I do think there is something
funny in the 2.7.0 docu (or in the code). Things behave as expected and
explained by you for version 2.6.0/2.6.1, but in the development
version 2.7.0 (which I was using) the output is different (see below).

The CHANGES file does mention some changes about the [[ subsetting
operator, partial matching and exact=TRUE, so I still think the
documentation could be
clearer at this point by mentioning abbreviations.

###################Version 2.6.0
> sessionInfo()
R version 2.6.0 Patched (2007-11-12 r43434)
i386-apple-darwin8.10.1

locale:
C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base
> control <- list(nameSpace=FALSE)
> control$name
[1] FALSE
> control[["name"]]
[1] FALSE
Warning message:
In control[["name"]] : partial match of 'name' to 'nameSpace'

###################Version 2.7.0 (development)
> sessionInfo()
R version 2.7.0 Under development (unstable) (2007-12-22 r43762)
i386-apple-darwin8.10.1

locale:
C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

> control <- list(nameSpace=FALSE)
> control$name
[1] FALSE
> control[["name"]]
NULL
^^^^^


Anyhow, with your help I found out that what I really wanted was

control <- list(nameSpace=FALSE)
if (is.null(control[["name",exact=TRUE]])) { control[["name"]] <- TRUE }

Thank your for your help and best regards,

Michael


From ripley at stats.ox.ac.uk  Fri Jan 18 13:05:45 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 18 Jan 2008 12:05:45 +0000 (GMT)
Subject: [Rd] PR#10583
In-Reply-To: <20080118103027.A8099282EFF7@mail.pubhealth.ku.dk>
References: <20080118103027.A8099282EFF7@mail.pubhealth.ku.dk>
Message-ID: <Pine.LNX.4.64.0801181153100.1444@gannet.stats.ox.ac.uk>

On Fri, 18 Jan 2008, michael.hoehle at gmail.com wrote:

> Thank you for your quick reply and for only indirectly scolding me for
> abusing the RBugs list. :-) However, I do think there is something
> funny in the 2.7.0 docu (or in the code). Things behave as expected and
> explained by you for version 2.6.0/2.6.1, but in the development
> version 2.7.0 (which I was using) the output is different (see below).

And so is the help page (Extract.Rd): I don't see anything here not 
working as documented in the version concerned.

> The CHANGES file does mention some changes about the [[ subsetting
> operator, partial matching and exact=TRUE, so I still think the
> documentation could be
> clearer at this point by mentioning abbreviations.

Do you mean the NEWS file?  (There is a CHANGES file, for Windows-specific 
changes.)

2.7.0 is not released (and will not be for ca 3 months), and its 
documentation is far from finalized.  We have asked that comments on 
unreleased versions be sent to the R-devel list and not R-bugs.

Whether an introductory document should mention what happens if you 
abbreviate names is moot: adding information in general makes introductory 
documents less clear, and mentioning something not considered to be good 
practice is also questionable at that level.  (We discourage partial 
matching for $, provide an option to warn about it and have tried to 
eliminate it in code and examples in base R.)

>
> ###################Version 2.6.0
>> sessionInfo()
> R version 2.6.0 Patched (2007-11-12 r43434)
> i386-apple-darwin8.10.1
>
> locale:
> C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>> control <- list(nameSpace=FALSE)
>> control$name
> [1] FALSE
>> control[["name"]]
> [1] FALSE
> Warning message:
> In control[["name"]] : partial match of 'name' to 'nameSpace'
>
> ###################Version 2.7.0 (development)
>> sessionInfo()
> R version 2.7.0 Under development (unstable) (2007-12-22 r43762)
> i386-apple-darwin8.10.1
>
> locale:
> C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
>> control <- list(nameSpace=FALSE)
>> control$name
> [1] FALSE
>> control[["name"]]
> NULL
> ^^^^^
>
>
> Anyhow, with your help I found out that what I really wanted was
>
> control <- list(nameSpace=FALSE)
> if (is.null(control[["name",exact=TRUE]])) { control[["name"]] <- TRUE }
>
> Thank your for your help and best regards,
>
> Michael
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch at stats.uwo.ca  Fri Jan 18 15:39:06 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 18 Jan 2008 09:39:06 -0500
Subject: [Rd] rm: failed to get attributes of `/':
In-Reply-To: <478BEF6A.1070908@stats.uwo.ca>
References: <6afac6e60801091051p54234844oe963c9bc0f53fff7@mail.gmail.com>
	<478BEF6A.1070908@stats.uwo.ca>
Message-ID: <4790BA0A.80205@stats.uwo.ca>

On 1/14/2008 6:25 PM, Duncan Murdoch wrote:
> Recently I have heard reports like the one below a couple of times:
> 
> Tineke Casneuf wrote:
>> However I did encouter an error when trying to install a self-made dummy
>> package. I am sure it is not due to the package because it can be build on
>> someone else's windows PC.
>>
>> The error message is *rm: failed to get attributes of `/': No such file or
>> directory.
> Today I saw one live, and managed to track down the problem.  Cygwin 
> (from which the Windows R toolset gets a number of utilities), stores 
> information on its mounts in the Windows registry.  If you later 
> uninstall it but leave the registry entries in place, you'll get an 
> error like the above.  The rm utility thinks that "/" refers to a 
> directory like c:\cygwin, but such a directory doesn't exist.
> 
> I don't know if this is a bug in the Cygwin uninstaller (which I would 
> say should remove registry entries once they are no longer valid), in rm 
> (which should ignore mounts that don't make sense), or if it is user 
> error.  But the fix is quite simple:  look in the registry (under 
> HKEY_CURRENT_USER\Software\Cygnus Solutions\Cygwin\mounts v2, or the 
> same location in HKEY_LOCAL_MACHINE), and remove any invalid mounts.
> 
> I will modify the Rtools installer to work around this problem.

This is now in place. I also added the ability to manually edit the 
PATH, in case you don't like the automatic edits.

Hopefully I didn't introduce any new bugs at the same time.

Duncan Murdoch


From dieter.menne at menne-biomed.de  Fri Jan 18 15:28:15 2008
From: dieter.menne at menne-biomed.de (Dieter Menne)
Date: Fri, 18 Jan 2008 15:28:15 +0100
Subject: [Rd] Memory loss in RODBC when reading DateTime values (no problem
	with integers)
Message-ID: <000001c859de$5dee01b0$19ca0510$@menne@menne-biomed.de>

This issue might be related to a similar one in

http://article.gmane.org/gmane.comp.lang.r.devel/11452

** Memory is not reclaimed when reading DateTime values, but works Ok when
with integers. 

There is no memory loss when opening/closing of connection is done outside
of the loop. However, opening itself cannot be the problem, since integers
can be read without loss.

I am aware that this is likely a Windows issue, not an R-problem, but
reporting it may help others to track down more complex cases.

Dieter


# assumes a table db.mdb with ANumber (integer) and ADate(DateTime) exists
library(RODBC)
db = "db.mdb"

# Generate Data
tab =  data.frame(ANumber=1:1000)
tab$ADate= Sys.Date()
channel = odbcConnectAccess(db)
sqlQuery(channel, "DELETE * from tab")
sqlSave(channel,tab,rownames=FALSE,append=TRUE)
odbcClose(channel)
# end of data generation

for (i in 1:1000) {
  channel = odbcConnectAccess(db)
  # When reading a number, memory nicely zig-zags within safe gc limits 
#  ret =   sqlQuery(channel, "SELECT ANumber from tab") 
  # Memory is lost
  ret =   sqlQuery(channel, "SELECT ADate from tab")
  odbcClose(channel)
  cat(i,nrow(ret),memory.size(),"\n")
}
# end of example


Package: RODBC
Version: 1.2-2
Date: 2007-10-19

System: Vista Ultimate, German

$platform
[1] "i386-pc-mingw32"

$arch
[1] "i386"

$os
[1] "mingw32"

$system
[1] "i386, mingw32"

$status
[1] ""

$major
[1] "2"

$minor
[1] "6.1"

$year
[1] "2007"

$month
[1] "11"

$day
[1] "26"

$`svn rev`
[1] "43537"

$language
[1] "R"

$version.string
[1] "R version 2.6.1 (2007-11-26)"

>


From finleya at msu.edu  Fri Jan 18 16:19:39 2008
From: finleya at msu.edu (Andrew Finley)
Date: Fri, 18 Jan 2008 10:19:39 -0500
Subject: [Rd] knnFinder package
Message-ID: <4790C38B.5000307@msu.edu>

Hello all,
The ann() function in the yaImpute package provides a more full featured 
interface to the same underlying approximate nearest neighbor library 
(http://www.cs.umd.edu/~mount/ANN) that is called by the nn() function 
in knnFinder. knnFinder is actually calling an older (defunct) version 
of the ANN library which was known to cause some segmentation faults.

I would be willing to adopt knnFinder, but it is now redundant with the 
functions offered in yaImpute. But first a question -- Should we 
maintain existing packages that have been superseded by other packages? 
If so, then I'll adopt knnFinder, but if not then I suggest letting it go.

Kind regards-
Andy


On 14 Jan 2008, Roger Bivand wrote:
 > On Mon, 14 Jan 2008, Gregoire Pau wrote:
 >
 > > Dear all,
 > >
 > > I have found some serious bugs in the knnFinder package (which supports
 > > data structures and algorithms for both exact and approximate nearest
 > > neighbor searching in arbitrarily high dimensions) that may trigger
 > > segmentation faults.
 > > I have fixed them but I had troubles to contact its maintainer 
Samuel E.
 > > Kemp (previously with the University of Glamorgan, UK). Do someone know
 > > where I can reach him ?
 >
 > I have also tried, for the same reason, without result. He seems to have
 > been a student who has now left the university where he wrote the 
package.
 > I also wrote to his apparent supervisor, also without result. My
 > suggestion would be that the package be orphaned, and that if you are
 > willing to replace it with your version, and to adopt it as maintainer,
 > its posting on CRAN can be continued.
 >
 > Roger
 >
 > >
 > > Best regards,
 > >
 > > Greg
 > > ---
 > > Gregoire Pau
 > > EMBL/EBI Cambridge, UK
 > > http://www.ebi.ac.uk/~gpau
 > >
 > > ______________________________________________
 > > R-devel at r-project.org mailing list
 > > https://stat.ethz.ch/mailman/listinfo/r-devel
 > >
 >
 > --
 > Roger Bivand
 > Economic Geography Section, Department of Economics, Norwegian School of
 > Economics and Business Administration, Helleveien 30, N-5045 Bergen,
 > Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
 > e-mail: Roger.Bivand at nhh.no
 >
 > ______________________________________________
 > R-devel at r-project.org mailing list
 > https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Andrew Finley, PhD
Natural Resources Building
Michigan State University
East Lansing, MI 48824-1222
Phone: 517-432-7219
Fax: 517-432-1143
web: http://blue.for.msu.edu


From christos.hatzis at nuverabio.com  Fri Jan 18 18:15:08 2008
From: christos.hatzis at nuverabio.com (Christos Hatzis)
Date: Fri, 18 Jan 2008 12:15:08 -0500
Subject: [Rd] knnFinder package
In-Reply-To: <4790C38B.5000307@msu.edu>
References: <4790C38B.5000307@msu.edu>
Message-ID: <005a01c859f5$ad67a6d0$0e010a0a@headquarters.silicoinsights>

Hello,

Perhaps not directly related to knnFinder package, but since the discussion
is on knn-related algorithms, has anyone looked into incorporating the cover
tree algorithm that was invented by the Yahoo team recently?  It is supposed
to be remarkably fast for exact kNN computations in very large datasets.

The link below has details on the algorithm and a C++ implementation from
the inventor.  I don't know enough C++ to be able to work through the
wrapper myself, so I wanted to pass this on to the list in case there is
interest.

http://hunch.net/~jl/projects/cover_tree/cover_tree.html

All the best,

-Christos

Christos Hatzis, Ph.D.
Nuvera Biosciences, Inc.
400 West Cummings Park
Suite 5350
Woburn, MA 01801
Tel: 781-938-3830
www.nuverabio.com
 

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Andrew Finley
> Sent: Friday, January 18, 2008 10:20 AM
> To: Roger.Bivand at nhh.no; gpau at ebi.ac.uk
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] knnFinder package
> 
> Hello all,
> The ann() function in the yaImpute package provides a more 
> full featured interface to the same underlying approximate 
> nearest neighbor library
> (http://www.cs.umd.edu/~mount/ANN) that is called by the nn() 
> function in knnFinder. knnFinder is actually calling an older 
> (defunct) version of the ANN library which was known to cause 
> some segmentation faults.
> 
> I would be willing to adopt knnFinder, but it is now 
> redundant with the functions offered in yaImpute. But first a 
> question -- Should we maintain existing packages that have 
> been superseded by other packages? 
> If so, then I'll adopt knnFinder, but if not then I suggest 
> letting it go.
> 
> Kind regards-
> Andy
> 
> 
> On 14 Jan 2008, Roger Bivand wrote:
>  > On Mon, 14 Jan 2008, Gregoire Pau wrote:
>  >
>  > > Dear all,
>  > >
>  > > I have found some serious bugs in the knnFinder package 
> (which supports  > > data structures and algorithms for both 
> exact and approximate nearest  > > neighbor searching in 
> arbitrarily high dimensions) that may trigger  > > 
> segmentation faults.
>  > > I have fixed them but I had troubles to contact its 
> maintainer Samuel E.
>  > > Kemp (previously with the University of Glamorgan, UK). 
> Do someone know  > > where I can reach him ?
>  >
>  > I have also tried, for the same reason, without result. He 
> seems to have  > been a student who has now left the 
> university where he wrote the package.
>  > I also wrote to his apparent supervisor, also without 
> result. My  > suggestion would be that the package be 
> orphaned, and that if you are  > willing to replace it with 
> your version, and to adopt it as maintainer,  > its posting 
> on CRAN can be continued.
>  >
>  > Roger
>  >
>  > >
>  > > Best regards,
>  > >
>  > > Greg
>  > > ---
>  > > Gregoire Pau
>  > > EMBL/EBI Cambridge, UK
>  > > http://www.ebi.ac.uk/~gpau
>  > >
>  > > ______________________________________________
>  > > R-devel at r-project.org mailing list
>  > > https://stat.ethz.ch/mailman/listinfo/r-devel
>  > >
>  >
>  > --
>  > Roger Bivand
>  > Economic Geography Section, Department of Economics, 
> Norwegian School of  > Economics and Business Administration, 
> Helleveien 30, N-5045 Bergen,  > Norway. voice: +47 55 95 93 
> 55; fax +47 55 95 95 43  > e-mail: Roger.Bivand at nhh.no  >  > 
> ______________________________________________
>  > R-devel at r-project.org mailing list
>  > https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 
> --
> Andrew Finley, PhD
> Natural Resources Building
> Michigan State University
> East Lansing, MI 48824-1222
> Phone: 517-432-7219
> Fax: 517-432-1143
> web: http://blue.for.msu.edu
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From sgiannerini at gmail.com  Fri Jan 18 20:22:24 2008
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Fri, 18 Jan 2008 20:22:24 +0100
Subject: [Rd] Bug in pacf -- Proposed patch (PR#10455)
In-Reply-To: <20071123173531.8712F2834156@mail.pubhealth.ku.dk>
References: <20071123173531.8712F2834156@mail.pubhealth.ku.dk>
Message-ID: <3c12769c0801181122p9f6754di7e82eec597e5b3eb@mail.gmail.com>

Dear all,

regarding the bug in pacf
I have prepared a patch (attached) and tested it against the latest R devel

platform
x86_64-unknown-linux-gnu
arch
x86_64
os
linux-gnu
system         x86_64,
linux-gnu
status         Under development
(unstable)
major
2
minor          7.0

year
2008
month
01
day
18
svn rev
44040
language
R
version.string R version 2.7.0 Under development (unstable) (2008-01-18
r44040)


Here I reproduce the example I gave in my previous post to trigger the bug

> set.seed(10)
>
> x <- rnorm(1000,sd=10000)
> y <- rnorm(1000,sd=1)
> pacf(ts(cbind(x,y)),plot=FALSE,lag.max=10)

Partial autocorrelations of series 'ts(cbind(x, y))', by lag

, , x

x            y
 0.049 (  1)  0.002 ( -1)
 0.012 (  2) -0.072 ( -2)
 0.002 (  3)  0.036 ( -3)
 0.014 (  4)  0.013 ( -4)
 0.051 (  5)  0.003 ( -5)
 0.033 (  6) -0.018 ( -6)
 0.027 (  7)  0.069 ( -7)
-0.027 (  8)  0.028 ( -8)
-0.010 (  9) -0.015 ( -9)
-0.013 ( 10) -0.015 (-10)

, , y

x            y
 0.041 (  1) -0.045 (  1)
 0.008 (  2) -0.027 (  2)
-0.056 (  3) -0.030 (  3)
 0.013 (  4) -0.020 (  4)
 0.017 (  5)  0.004 (  5)
-0.021 (  6) -0.010 (  6)
 0.022 (  7)  0.061 (  7)
 0.029 (  8) -0.034 (  8)
-0.014 (  9)  0.031 (  9)
-0.002 ( 10)  0.019 ( 10)

below you can find relevant info and an example where I reproduce Wei's book
results.

http://www2.stat.unibo.it/giannerini/R/pacf.htm

The routine is pure R, on the website there is also a F95 version.
I am willing to write a FORTRAN 77 version of the patch if needed but I
think this might replace the bugged routine temporarily. Let me know.

Thanks for your attention

Simone


On Nov 23, 2007 6:35 PM, <sgiannerini at gmail.com> wrote:
> Dear all,
>
> following the thread
>
> http://tolstoy.newcastle.edu.au/R/e2/devel/07/09/4338.html
>
> regarding the bug in the partial autocorrelation function for
> multivariate time series.
> I have prepared a web page with patches and relevant information.
>
> http://www2.stat.unibo.it/giannerini/R/pacf.htm
>
> Please do not hesitate to contact me for further clarifications
>
> regards
>
> Simone
>
> --
> ______________________________________________________
>
> Simone Giannerini
> Dipartimento di Scienze Statistiche "Paolo Fortunati"
> Universita' di Bologna
> Via delle belle arti 41 - 40126  Bologna,  ITALY
> Tel: +39 051 2098262  Fax: +39 051 232153
> http://www2.stat.unibo.it/giannerini/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
______________________________________________________

Simone Giannerini
Dipartimento di Scienze Statistiche "Paolo Fortunati"
Universita' di Bologna
Via delle belle arti 41 - 40126  Bologna,  ITALY
Tel: +39 051 2098262  Fax: +39 051 232153
http://www2.stat.unibo.it/giannerini/
______________________________________________________

From rbaer at atsu.edu  Fri Jan 18 17:40:05 2008
From: rbaer at atsu.edu (rbaer at atsu.edu)
Date: Fri, 18 Jan 2008 17:40:05 +0100 (CET)
Subject: [Rd] Wishlist- Windows Gui (PR#10589)
Message-ID: <20080118164005.412D7283462A@mail.pubhealth.ku.dk>

Full_Name: Robert Baer
Version: 2.6.1
OS: Windows XP
Submission from: (NULL) (198.209.172.95)


It would be wonderful if the CRAN mirror had an easy way to set a "default CRAN
mirror".

Current behavior is to have to choose a CRAN mirror the first time a package is
installed in a session.  The closest mirror site is always the same for me, and
I wouldn't wish to change it unless it were to be unavailable for an extended
period of time.  I expect I could set it in a configuration file somewhere with
some study, but this is the type of thing that is much more easily and
appropriately done through a GUI.


From jfox at mcmaster.ca  Fri Jan 18 23:18:40 2008
From: jfox at mcmaster.ca (John Fox)
Date: Fri, 18 Jan 2008 17:18:40 -0500
Subject: [Rd] Wishlist- Windows Gui (PR#10589)
In-Reply-To: <20080118164005.412D7283462A@mail.pubhealth.ku.dk>
References: <20080118164005.412D7283462A@mail.pubhealth.ku.dk>
Message-ID: <003101c85a20$164d5800$42e80800$@ca>

Dear Robert,

Your wish is granted retroactively; just put

  options(repos=c(CRAN="http://probability.ca/cran",
CRANextra="http://www.stats.ox.ac.uk/pub/RWin"))

in your Rprofile.site file, which lives in R's etc directory (or in another
appropriate startup file -- see ?Startup). Of course, you would adjust CRAN
to point to a CRAN mirror near you.

BTW, this isn't really a bug report, is it?

Regards,
 John

--------------------------------
John Fox, Professor
Department of Sociology
McMaster University
Hamilton, Ontario, Canada L8S 4M4
905-525-9140x23604
http://socserv.mcmaster.ca/jfox


> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
> project.org] On Behalf Of rbaer at atsu.edu
> Sent: January-18-08 11:40 AM
> To: r-devel at stat.math.ethz.ch
> Cc: R-bugs at biostat.ku.dk
> Subject: [Rd] Wishlist- Windows Gui (PR#10589)
> 
> Full_Name: Robert Baer
> Version: 2.6.1
> OS: Windows XP
> Submission from: (NULL) (198.209.172.95)
> 
> 
> It would be wonderful if the CRAN mirror had an easy way to set a
> "default CRAN
> mirror".
> 
> Current behavior is to have to choose a CRAN mirror the first time a
> package is
> installed in a session.  The closest mirror site is always the same for
> me, and
> I wouldn't wish to change it unless it were to be unavailable for an
> extended
> period of time.  I expect I could set it in a configuration file
> somewhere with
> some study, but this is the type of thing that is much more easily and
> appropriately done through a GUI.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jfox at mcmaster.ca  Fri Jan 18 23:20:19 2008
From: jfox at mcmaster.ca (jfox at mcmaster.ca)
Date: Fri, 18 Jan 2008 23:20:19 +0100 (CET)
Subject: [Rd] Wishlist- Windows Gui (PR#10589)
Message-ID: <20080118222019.7733B282EFF6@mail.pubhealth.ku.dk>

Dear Robert,

Your wish is granted retroactively; just put

  options(repos=c(CRAN="http://probability.ca/cran",
CRANextra="http://www.stats.ox.ac.uk/pub/RWin"))

in your Rprofile.site file, which lives in R's etc directory (or in another
appropriate startup file -- see ?Startup). Of course, you would adjust CRAN
to point to a CRAN mirror near you.

BTW, this isn't really a bug report, is it?

Regards,
 John

--------------------------------
John Fox, Professor
Department of Sociology
McMaster University
Hamilton, Ontario, Canada L8S 4M4
905-525-9140x23604
http://socserv.mcmaster.ca/jfox


> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
> project.org] On Behalf Of rbaer at atsu.edu
> Sent: January-18-08 11:40 AM
> To: r-devel at stat.math.ethz.ch
> Cc: R-bugs at biostat.ku.dk
> Subject: [Rd] Wishlist- Windows Gui (PR#10589)
> 
> Full_Name: Robert Baer
> Version: 2.6.1
> OS: Windows XP
> Submission from: (NULL) (198.209.172.95)
> 
> 
> It would be wonderful if the CRAN mirror had an easy way to set a
> "default CRAN
> mirror".
> 
> Current behavior is to have to choose a CRAN mirror the first time a
> package is
> installed in a session.  The closest mirror site is always the same for
> me, and
> I wouldn't wish to change it unless it were to be unavailable for an
> extended
> period of time.  I expect I could set it in a configuration file
> somewhere with
> some study, but this is the type of thing that is much more easily and
> appropriately done through a GUI.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From p.dalgaard at biostat.ku.dk  Fri Jan 18 23:40:20 2008
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Fri, 18 Jan 2008 23:40:20 +0100
Subject: [Rd] Wishlist- Windows Gui (PR#10589)
In-Reply-To: <20080118222019.7733B282EFF6@mail.pubhealth.ku.dk>
References: <20080118222019.7733B282EFF6@mail.pubhealth.ku.dk>
Message-ID: <47912AD4.7060201@biostat.ku.dk>

jfox at mcmaster.ca wrote:
> Dear Robert,
>
> Your wish is granted retroactively; just put
>
>   options(repos=c(CRAN="http://probability.ca/cran",
> CRANextra="http://www.stats.ox.ac.uk/pub/RWin"))
>
> in your Rprofile.site file, which lives in R's etc directory (or in another
> appropriate startup file -- see ?Startup). Of course, you would adjust CRAN
> to point to a CRAN mirror near you.
>
> BTW, this isn't really a bug report, is it?
>   
It's an enhancement request. We do allow those.

The idea seems sound enough: Just have the mirror selection widget offer 
to store the selection - er- somewhere for later use. Point being of 
course that people can never remeber what to write in which 
configuration file in which directory.

One tricky issue is whether we want the GUI to edit the Rprofile 
(probably not) or add yet another configuration file that would be 
overridden (probably not) by or override (probably not either) the 
hand-written Rprofile files....

    -p
> Regards,
>  John
>
> --------------------------------
> John Fox, Professor
> Department of Sociology
> McMaster University
> Hamilton, Ontario, Canada L8S 4M4
> 905-525-9140x23604
> http://socserv.mcmaster.ca/jfox
>
>
>   
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
>> project.org] On Behalf Of rbaer at atsu.edu
>> Sent: January-18-08 11:40 AM
>> To: r-devel at stat.math.ethz.ch
>> Cc: R-bugs at biostat.ku.dk
>> Subject: [Rd] Wishlist- Windows Gui (PR#10589)
>>
>> Full_Name: Robert Baer
>> Version: 2.6.1
>> OS: Windows XP
>> Submission from: (NULL) (198.209.172.95)
>>
>>
>> It would be wonderful if the CRAN mirror had an easy way to set a
>> "default CRAN
>> mirror".
>>
>> Current behavior is to have to choose a CRAN mirror the first time a
>> package is
>> installed in a session.  The closest mirror site is always the same for
>> me, and
>> I wouldn't wish to change it unless it were to be unavailable for an
>> extended
>> period of time.  I expect I could set it in a configuration file
>> somewhere with
>> some study, but this is the type of thing that is much more easily and
>> appropriately done through a GUI.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>     
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From jfox at mcmaster.ca  Sat Jan 19 00:23:49 2008
From: jfox at mcmaster.ca (John Fox)
Date: Fri, 18 Jan 2008 18:23:49 -0500
Subject: [Rd] Wishlist- Windows Gui (PR#10589)
In-Reply-To: <47912AD4.7060201@biostat.ku.dk>
References: <20080118222019.7733B282EFF6@mail.pubhealth.ku.dk>
	<47912AD4.7060201@biostat.ku.dk>
Message-ID: <000101c85a29$2e018670$8a049350$@ca>

Dear Peter,

Actually, "Edit -> Gui preferences" will already edit/generate an Rprofile
file, so mirror selection could be put there. I frankly find it simpler on a
single-user Windows system just to edit Rprofile.site.

Best,
 John


> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
> project.org] On Behalf Of Peter Dalgaard
> Sent: January-18-08 5:40 PM
> To: jfox at mcmaster.ca
> Cc: R-bugs at biostat.ku.dk; r-devel at stat.math.ethz.ch
> Subject: Re: [Rd] Wishlist- Windows Gui (PR#10589)
> 
> jfox at mcmaster.ca wrote:
> > Dear Robert,
> >
> > Your wish is granted retroactively; just put
> >
> >   options(repos=c(CRAN="http://probability.ca/cran",
> > CRANextra="http://www.stats.ox.ac.uk/pub/RWin"))
> >
> > in your Rprofile.site file, which lives in R's etc directory (or in
> another
> > appropriate startup file -- see ?Startup). Of course, you would
> adjust CRAN
> > to point to a CRAN mirror near you.
> >
> > BTW, this isn't really a bug report, is it?
> >
> It's an enhancement request. We do allow those.
> 
> The idea seems sound enough: Just have the mirror selection widget
> offer
> to store the selection - er- somewhere for later use. Point being of
> course that people can never remeber what to write in which
> configuration file in which directory.
> 
> One tricky issue is whether we want the GUI to edit the Rprofile
> (probably not) or add yet another configuration file that would be
> overridden (probably not) by or override (probably not either) the
> hand-written Rprofile files....
> 
>     -p
> > Regards,
> >  John
> >
> > --------------------------------
> > John Fox, Professor
> > Department of Sociology
> > McMaster University
> > Hamilton, Ontario, Canada L8S 4M4
> > 905-525-9140x23604
> > http://socserv.mcmaster.ca/jfox
> >
> >
> >
> >> -----Original Message-----
> >> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
> >> project.org] On Behalf Of rbaer at atsu.edu
> >> Sent: January-18-08 11:40 AM
> >> To: r-devel at stat.math.ethz.ch
> >> Cc: R-bugs at biostat.ku.dk
> >> Subject: [Rd] Wishlist- Windows Gui (PR#10589)
> >>
> >> Full_Name: Robert Baer
> >> Version: 2.6.1
> >> OS: Windows XP
> >> Submission from: (NULL) (198.209.172.95)
> >>
> >>
> >> It would be wonderful if the CRAN mirror had an easy way to set a
> >> "default CRAN
> >> mirror".
> >>
> >> Current behavior is to have to choose a CRAN mirror the first time a
> >> package is
> >> installed in a session.  The closest mirror site is always the same
> for
> >> me, and
> >> I wouldn't wish to change it unless it were to be unavailable for an
> >> extended
> >> period of time.  I expect I could set it in a configuration file
> >> somewhere with
> >> some study, but this is the type of thing that is much more easily
> and
> >> appropriately done through a GUI.
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> 
> --
>    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
>  (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45)
> 35327918
> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45)
> 35327907
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jfox at mcmaster.ca  Sat Jan 19 00:25:14 2008
From: jfox at mcmaster.ca (jfox at mcmaster.ca)
Date: Sat, 19 Jan 2008 00:25:14 +0100 (CET)
Subject: [Rd] Wishlist- Windows Gui (PR#10589)
Message-ID: <20080118232514.AF58E282EFF6@mail.pubhealth.ku.dk>

Dear Peter,

Actually, "Edit -> Gui preferences" will already edit/generate an =
Rprofile
file, so mirror selection could be put there. I frankly find it simpler =
on a
single-user Windows system just to edit Rprofile.site.

Best,
 John


> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
> project.org] On Behalf Of Peter Dalgaard
> Sent: January-18-08 5:40 PM
> To: jfox at mcmaster.ca
> Cc: R-bugs at biostat.ku.dk; r-devel at stat.math.ethz.ch
> Subject: Re: [Rd] Wishlist- Windows Gui (PR#10589)
>=20
> jfox at mcmaster.ca wrote:
> > Dear Robert,
> >
> > Your wish is granted retroactively; just put
> >
> >   options(repos=3Dc(CRAN=3D"http://probability.ca/cran",
> > CRANextra=3D"http://www.stats.ox.ac.uk/pub/RWin"))
> >
> > in your Rprofile.site file, which lives in R's etc directory (or in
> another
> > appropriate startup file -- see ?Startup). Of course, you would
> adjust CRAN
> > to point to a CRAN mirror near you.
> >
> > BTW, this isn't really a bug report, is it?
> >
> It's an enhancement request. We do allow those.
>=20
> The idea seems sound enough: Just have the mirror selection widget
> offer
> to store the selection - er- somewhere for later use. Point being of
> course that people can never remeber what to write in which
> configuration file in which directory.
>=20
> One tricky issue is whether we want the GUI to edit the Rprofile
> (probably not) or add yet another configuration file that would be
> overridden (probably not) by or override (probably not either) the
> hand-written Rprofile files....
>=20
>     -p
> > Regards,
> >  John
> >
> > --------------------------------
> > John Fox, Professor
> > Department of Sociology
> > McMaster University
> > Hamilton, Ontario, Canada L8S 4M4
> > 905-525-9140x23604
> > http://socserv.mcmaster.ca/jfox
> >
> >
> >
> >> -----Original Message-----
> >> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
> >> project.org] On Behalf Of rbaer at atsu.edu
> >> Sent: January-18-08 11:40 AM
> >> To: r-devel at stat.math.ethz.ch
> >> Cc: R-bugs at biostat.ku.dk
> >> Subject: [Rd] Wishlist- Windows Gui (PR#10589)
> >>
> >> Full_Name: Robert Baer
> >> Version: 2.6.1
> >> OS: Windows XP
> >> Submission from: (NULL) (198.209.172.95)
> >>
> >>
> >> It would be wonderful if the CRAN mirror had an easy way to set a
> >> "default CRAN
> >> mirror".
> >>
> >> Current behavior is to have to choose a CRAN mirror the first time =
a
> >> package is
> >> installed in a session.  The closest mirror site is always the same
> for
> >> me, and
> >> I wouldn't wish to change it unless it were to be unavailable for =
an
> >> extended
> >> period of time.  I expect I could set it in a configuration file
> >> somewhere with
> >> some study, but this is the type of thing that is much more easily
> and
> >> appropriately done through a GUI.
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>=20
>=20
> --
>    O__  ---- Peter Dalgaard             =D8ster Farimagsgade 5, Entr.B
>   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
>  (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45)
> 35327918
> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45)
> 35327907
>=20
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Sat Jan 19 01:00:33 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 18 Jan 2008 19:00:33 -0500
Subject: [Rd] Wishlist- Windows Gui (PR#10589)
In-Reply-To: <000101c85a29$2e018670$8a049350$@ca>
References: <20080118222019.7733B282EFF6@mail.pubhealth.ku.dk>	<47912AD4.7060201@biostat.ku.dk>
	<000101c85a29$2e018670$8a049350$@ca>
Message-ID: <47913DA1.60504@stats.uwo.ca>

John Fox wrote:
> Dear Peter,
>
> Actually, "Edit -> Gui preferences" will already edit/generate an Rprofile
> file, so mirror selection could be put there. I frankly find it simpler on a
> single-user Windows system just to edit Rprofile.site.
>   
That edits Rconsole, not Rprofile.  Rconsole has a very limited number 
of entries (a finite list), so that's reasonable.  Rprofile is intended 
to be human editable and is basically unlimited in what it can do; 
computer edits to human editable files are not usually pretty.

The "right" place to store information like this in Windows is in the 
registry, but we've been reluctant to use it, for various historical 
reasons.  In fact, we were just told today that editing the registry is 
not allowed by software used by the US government.  I think they'll be 
moving back to the abacus, if they want to stay with Windows.

Duncan Murdoch
> Best,
>  John
>
>
>   
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
>> project.org] On Behalf Of Peter Dalgaard
>> Sent: January-18-08 5:40 PM
>> To: jfox at mcmaster.ca
>> Cc: R-bugs at biostat.ku.dk; r-devel at stat.math.ethz.ch
>> Subject: Re: [Rd] Wishlist- Windows Gui (PR#10589)
>>
>> jfox at mcmaster.ca wrote:
>>     
>>> Dear Robert,
>>>
>>> Your wish is granted retroactively; just put
>>>
>>>   options(repos=c(CRAN="http://probability.ca/cran",
>>> CRANextra="http://www.stats.ox.ac.uk/pub/RWin"))
>>>
>>> in your Rprofile.site file, which lives in R's etc directory (or in
>>>       
>> another
>>     
>>> appropriate startup file -- see ?Startup). Of course, you would
>>>       
>> adjust CRAN
>>     
>>> to point to a CRAN mirror near you.
>>>
>>> BTW, this isn't really a bug report, is it?
>>>
>>>       
>> It's an enhancement request. We do allow those.
>>
>> The idea seems sound enough: Just have the mirror selection widget
>> offer
>> to store the selection - er- somewhere for later use. Point being of
>> course that people can never remeber what to write in which
>> configuration file in which directory.
>>
>> One tricky issue is whether we want the GUI to edit the Rprofile
>> (probably not) or add yet another configuration file that would be
>> overridden (probably not) by or override (probably not either) the
>> hand-written Rprofile files....
>>
>>     -p
>>     
>>> Regards,
>>>  John
>>>
>>> --------------------------------
>>> John Fox, Professor
>>> Department of Sociology
>>> McMaster University
>>> Hamilton, Ontario, Canada L8S 4M4
>>> 905-525-9140x23604
>>> http://socserv.mcmaster.ca/jfox
>>>
>>>
>>>
>>>       
>>>> -----Original Message-----
>>>> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
>>>> project.org] On Behalf Of rbaer at atsu.edu
>>>> Sent: January-18-08 11:40 AM
>>>> To: r-devel at stat.math.ethz.ch
>>>> Cc: R-bugs at biostat.ku.dk
>>>> Subject: [Rd] Wishlist- Windows Gui (PR#10589)
>>>>
>>>> Full_Name: Robert Baer
>>>> Version: 2.6.1
>>>> OS: Windows XP
>>>> Submission from: (NULL) (198.209.172.95)
>>>>
>>>>
>>>> It would be wonderful if the CRAN mirror had an easy way to set a
>>>> "default CRAN
>>>> mirror".
>>>>
>>>> Current behavior is to have to choose a CRAN mirror the first time a
>>>> package is
>>>> installed in a session.  The closest mirror site is always the same
>>>>         
>> for
>>     
>>>> me, and
>>>> I wouldn't wish to change it unless it were to be unavailable for an
>>>> extended
>>>> period of time.  I expect I could set it in a configuration file
>>>> somewhere with
>>>> some study, but this is the type of thing that is much more easily
>>>>         
>> and
>>     
>>>> appropriately done through a GUI.
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>         
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>       
>> --
>>    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>>   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
>>  (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45)
>> 35327918
>> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45)
>> 35327907
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>     
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ggrothendieck at gmail.com  Sat Jan 19 02:28:22 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 18 Jan 2008 20:28:22 -0500
Subject: [Rd] Updating library
Message-ID: <971536df0801181728r5d2fb752k6c413457ac640563@mail.gmail.com>

On Vista my R installation is in

  C:\Program Files\R\R-2.6.0

and there is a library here:

   %userprofile%\Documents\R\win-library\2.6

If I use the GUI Packages menu to update my library it
works ok _except_ for any packages such as lattice and
the VR bundle that come with R.  For those I get this (this
is what I got when I tried to update lattice but I get a similar
message for the VR bundle as well):

> update.packages(ask='graphics')
--- Please select a CRAN mirror for use in this session ---
Warning in install.packages(update[instlib == l, "Package"], l,
contriburl = contriburl,  :
  'lib = "C:/PROGRA~1/R/R-26~1.0/library"' is not writable
Error in install.packages(update[instlib == l, "Package"], l,
contriburl = contriburl,  :
  unable to install packages

I am using R-2.6.1 (even though the directory says 2.6.0) since I
tend to write over the prior directory if its just an upgrade involving
the last digit of the R version.

> R.version.string
[1] "R version 2.6.1 Patched (2007-12-06 r43610)"

How should I go about updating lattice and the VR bundle?


From huwenb at gmail.com  Sat Jan 19 04:05:55 2008
From: huwenb at gmail.com (=?GB2312?B?zsSyqLr6?=)
Date: Sat, 19 Jan 2008 11:05:55 +0800
Subject: [Rd] a problem when i use JRI package in java
Message-ID: <d36c26c00801181905m4cc00707qc1967a561234607@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080119/ee188e78/attachment.pl 

From ripley at stats.ox.ac.uk  Sat Jan 19 07:45:26 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 19 Jan 2008 06:45:26 +0000 (GMT)
Subject: [Rd] a problem when i use JRI package in java
In-Reply-To: <d36c26c00801181905m4cc00707qc1967a561234607@mail.gmail.com>
References: <d36c26c00801181905m4cc00707qc1967a561234607@mail.gmail.com>
Message-ID: <alpine.LFD.1.00.0801190641260.23137@gannet.stats.ox.ac.uk>

On Sat, 19 Jan 2008, ??? wrote:

>   I used JRI package in java to connect R ,and want to use R do some work
> fo me.
> but most thing is ok, but there is a problem for me

The best thing to do is to ask the maintainer, as the posting guide 
suggests.  Very few of us will be using JRI (or even know Java).

> these is some code of the program:
>
>               re.eval("library(lattice)");
>              y=re.idleEval("print(1:10)");
>              y=re.eval("feq <- read.delim('c:/minist.txt',header=T)");
>              y=re.eval("feq1<-as.matrix(feq)");
>              System.out.println(y=re.eval("feq1[1,]"));
>              y=re.eval("jpeg()");
>              y=re.eval("levelplot(feq1)");
>              re.eval("dev.off()");
>              re.end();
>              System.out.println("end");
>
> in these codes i load package   lattice to plot my data ,but  i cann't  get
> a right picture, the picture created is empty .
> it looks like   this code is not run rightly: y=re.eval("levelplot(feq1)");

See the R FAQ Q7.22: I think this is likely another example of a missing 
print() call.

> can some one  help me thanks!
>
> --
> ?????
> TEL:
>
>
>
> E-MAIL:bbbiiiooo at 163.com
>            huwenb at gmail.com
>
> 	[[alternative HTML version deleted]]

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Sat Jan 19 08:19:15 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 19 Jan 2008 07:19:15 +0000 (GMT)
Subject: [Rd] Updating library
In-Reply-To: <971536df0801181728r5d2fb752k6c413457ac640563@mail.gmail.com>
References: <971536df0801181728r5d2fb752k6c413457ac640563@mail.gmail.com>
Message-ID: <alpine.LFD.1.00.0801190713370.23137@gannet.stats.ox.ac.uk>

You need to use 'Run as admininistrator' for just the session updating 
those packages (assuming you installed R with administrator privileges and 
are running it without: you did not say).

This is covered in rw-FAQ Q2.24.

On Fri, 18 Jan 2008, Gabor Grothendieck wrote:

> On Vista my R installation is in
>
>  C:\Program Files\R\R-2.6.0
>
> and there is a library here:
>
>   %userprofile%\Documents\R\win-library\2.6
>
> If I use the GUI Packages menu to update my library it
> works ok _except_ for any packages such as lattice and
> the VR bundle that come with R.  For those I get this (this
> is what I got when I tried to update lattice but I get a similar
> message for the VR bundle as well):
>
>> update.packages(ask='graphics')
> --- Please select a CRAN mirror for use in this session ---
> Warning in install.packages(update[instlib == l, "Package"], l,
> contriburl = contriburl,  :
>  'lib = "C:/PROGRA~1/R/R-26~1.0/library"' is not writable
> Error in install.packages(update[instlib == l, "Package"], l,
> contriburl = contriburl,  :
>  unable to install packages
>
> I am using R-2.6.1 (even though the directory says 2.6.0) since I
> tend to write over the prior directory if its just an upgrade involving
> the last digit of the R version.
>
>> R.version.string
> [1] "R version 2.6.1 Patched (2007-12-06 r43610)"
>
> How should I go about updating lattice and the VR bundle?
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From p.dalgaard at biostat.ku.dk  Sat Jan 19 09:34:43 2008
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sat, 19 Jan 2008 09:34:43 +0100
Subject: [Rd] Updating library
In-Reply-To: <alpine.LFD.1.00.0801190713370.23137@gannet.stats.ox.ac.uk>
References: <971536df0801181728r5d2fb752k6c413457ac640563@mail.gmail.com>
	<alpine.LFD.1.00.0801190713370.23137@gannet.stats.ox.ac.uk>
Message-ID: <4791B623.2080604@biostat.ku.dk>

Prof Brian Ripley wrote:
> You need to use 'Run as admininistrator' for just the session updating 
> those packages (assuming you installed R with administrator privileges and 
> are running it without: you did not say).
>
> This is covered in rw-FAQ Q2.24.
>
>   
I only have WINE to hand here and package installation doesn't quite 
work there, but shouldn't it also work in the  absense of administrative 
privileges to just install lattice and VR into your private win-library 
and update them there?

    -p

> On Fri, 18 Jan 2008, Gabor Grothendieck wrote:
>
>   
>> On Vista my R installation is in
>>
>>  C:\Program Files\R\R-2.6.0
>>
>> and there is a library here:
>>
>>   %userprofile%\Documents\R\win-library\2.6
>>
>> If I use the GUI Packages menu to update my library it
>> works ok _except_ for any packages such as lattice and
>> the VR bundle that come with R.  For those I get this (this
>> is what I got when I tried to update lattice but I get a similar
>> message for the VR bundle as well):
>>
>>     
>>> update.packages(ask='graphics')
>>>       
>> --- Please select a CRAN mirror for use in this session ---
>> Warning in install.packages(update[instlib == l, "Package"], l,
>> contriburl = contriburl,  :
>>  'lib = "C:/PROGRA~1/R/R-26~1.0/library"' is not writable
>> Error in install.packages(update[instlib == l, "Package"], l,
>> contriburl = contriburl,  :
>>  unable to install packages
>>
>> I am using R-2.6.1 (even though the directory says 2.6.0) since I
>> tend to write over the prior directory if its just an upgrade involving
>> the last digit of the R version.
>>
>>     
>>> R.version.string
>>>       
>> [1] "R version 2.6.1 Patched (2007-12-06 r43610)"
>>
>> How should I go about updating lattice and the VR bundle?
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>     
>
>   


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ggrothendieck at gmail.com  Sat Jan 19 15:00:32 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 19 Jan 2008 09:00:32 -0500
Subject: [Rd] Updating library
In-Reply-To: <alpine.LFD.1.00.0801190713370.23137@gannet.stats.ox.ac.uk>
References: <971536df0801181728r5d2fb752k6c413457ac640563@mail.gmail.com>
	<alpine.LFD.1.00.0801190713370.23137@gannet.stats.ox.ac.uk>
Message-ID: <971536df0801190600y74acfb45q23b3c4e8c2c2bff3@mail.gmail.com>

Thanks.  That did it.

On Jan 19, 2008 2:19 AM, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> You need to use 'Run as admininistrator' for just the session updating
> those packages (assuming you installed R with administrator privileges and
> are running it without: you did not say).
>
> This is covered in rw-FAQ Q2.24.
>
>
> On Fri, 18 Jan 2008, Gabor Grothendieck wrote:
>
> > On Vista my R installation is in
> >
> >  C:\Program Files\R\R-2.6.0
> >
> > and there is a library here:
> >
> >   %userprofile%\Documents\R\win-library\2.6
> >
> > If I use the GUI Packages menu to update my library it
> > works ok _except_ for any packages such as lattice and
> > the VR bundle that come with R.  For those I get this (this
> > is what I got when I tried to update lattice but I get a similar
> > message for the VR bundle as well):
> >
> >> update.packages(ask='graphics')
> > --- Please select a CRAN mirror for use in this session ---
> > Warning in install.packages(update[instlib == l, "Package"], l,
> > contriburl = contriburl,  :
> >  'lib = "C:/PROGRA~1/R/R-26~1.0/library"' is not writable
> > Error in install.packages(update[instlib == l, "Package"], l,
> > contriburl = contriburl,  :
> >  unable to install packages
> >
> > I am using R-2.6.1 (even though the directory says 2.6.0) since I
> > tend to write over the prior directory if its just an upgrade involving
> > the last digit of the R version.
> >
> >> R.version.string
> > [1] "R version 2.6.1 Patched (2007-12-06 r43610)"
> >
> > How should I go about updating lattice and the VR bundle?
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


From ligges at statistik.tu-dortmund.de  Sat Jan 19 15:13:04 2008
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sat, 19 Jan 2008 15:13:04 +0100
Subject: [Rd] Updating library
In-Reply-To: <4791B623.2080604@biostat.ku.dk>
References: <971536df0801181728r5d2fb752k6c413457ac640563@mail.gmail.com>	<alpine.LFD.1.00.0801190713370.23137@gannet.stats.ox.ac.uk>
	<4791B623.2080604@biostat.ku.dk>
Message-ID: <47920570.3040208@statistik.tu-dortmund.de>

hits=-2.6 tests=BAYES_00
X-USF-Spam-Flag: NO



Peter Dalgaard wrote:
> Prof Brian Ripley wrote:
>> You need to use 'Run as admininistrator' for just the session updating 
>> those packages (assuming you installed R with administrator privileges and 
>> are running it without: you did not say).
>>
>> This is covered in rw-FAQ Q2.24.
>>
>>   
> I only have WINE to hand here and package installation doesn't quite 
> work there, but shouldn't it also work in the  absense of administrative 
> privileges to just install lattice and VR into your private win-library 
> and update them there?

Sure, but that works. What Gabor reported is that updating lattice/VR 
and co did not succeed. And it did not, because it was installed in R's 
default library (which can only be updated with administrator privileges 
in his case, we guess).
Gabor could install lattice/VR into his private library and after that 
updating will succeed.

Best,
uwe





> 
>     -p
> 
>> On Fri, 18 Jan 2008, Gabor Grothendieck wrote:
>>
>>   
>>> On Vista my R installation is in
>>>
>>>  C:\Program Files\R\R-2.6.0
>>>
>>> and there is a library here:
>>>
>>>   %userprofile%\Documents\R\win-library\2.6
>>>
>>> If I use the GUI Packages menu to update my library it
>>> works ok _except_ for any packages such as lattice and
>>> the VR bundle that come with R.  For those I get this (this
>>> is what I got when I tried to update lattice but I get a similar
>>> message for the VR bundle as well):
>>>
>>>     
>>>> update.packages(ask='graphics')
>>>>       
>>> --- Please select a CRAN mirror for use in this session ---
>>> Warning in install.packages(update[instlib == l, "Package"], l,
>>> contriburl = contriburl,  :
>>>  'lib = "C:/PROGRA~1/R/R-26~1.0/library"' is not writable
>>> Error in install.packages(update[instlib == l, "Package"], l,
>>> contriburl = contriburl,  :
>>>  unable to install packages
>>>
>>> I am using R-2.6.1 (even though the directory says 2.6.0) since I
>>> tend to write over the prior directory if its just an upgrade involving
>>> the last digit of the R version.
>>>
>>>     
>>>> R.version.string
>>>>       
>>> [1] "R version 2.6.1 Patched (2007-12-06 r43610)"
>>>
>>> How should I go about updating lattice and the VR bundle?
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>     
>>   
> 
>


From ggrothendieck at gmail.com  Sat Jan 19 17:10:25 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 19 Jan 2008 11:10:25 -0500
Subject: [Rd] Updating library
In-Reply-To: <47920570.3040208@statistik.tu-dortmund.de>
References: <971536df0801181728r5d2fb752k6c413457ac640563@mail.gmail.com>
	<alpine.LFD.1.00.0801190713370.23137@gannet.stats.ox.ac.uk>
	<4791B623.2080604@biostat.ku.dk>
	<47920570.3040208@statistik.tu-dortmund.de>
Message-ID: <971536df0801190810o428164bdoa33cc4a1d98b52bc@mail.gmail.com>

Ideally one could just choose the
 packages | update
menu and it would just work.  Possibilities include updating packages into
the private library if they otherwise fail to install or providing an
error message
on what to do.

On Jan 19, 2008 9:13 AM, Uwe Ligges <ligges at statistik.tu-dortmund.de> wrote:
> hits=-2.6 tests=BAYES_00
> X-USF-Spam-Flag: NO
>
>
>
> Peter Dalgaard wrote:
> > Prof Brian Ripley wrote:
> >> You need to use 'Run as admininistrator' for just the session updating
> >> those packages (assuming you installed R with administrator privileges and
> >> are running it without: you did not say).
> >>
> >> This is covered in rw-FAQ Q2.24.
> >>
> >>
> > I only have WINE to hand here and package installation doesn't quite
> > work there, but shouldn't it also work in the  absense of administrative
> > privileges to just install lattice and VR into your private win-library
> > and update them there?
>
> Sure, but that works. What Gabor reported is that updating lattice/VR
> and co did not succeed. And it did not, because it was installed in R's
> default library (which can only be updated with administrator privileges
> in his case, we guess).
> Gabor could install lattice/VR into his private library and after that
> updating will succeed.
>
> Best,
> uwe
>
>
>
>
>
>
> >
> >     -p
> >
> >> On Fri, 18 Jan 2008, Gabor Grothendieck wrote:
> >>
> >>
> >>> On Vista my R installation is in
> >>>
> >>>  C:\Program Files\R\R-2.6.0
> >>>
> >>> and there is a library here:
> >>>
> >>>   %userprofile%\Documents\R\win-library\2.6
> >>>
> >>> If I use the GUI Packages menu to update my library it
> >>> works ok _except_ for any packages such as lattice and
> >>> the VR bundle that come with R.  For those I get this (this
> >>> is what I got when I tried to update lattice but I get a similar
> >>> message for the VR bundle as well):
> >>>
> >>>
> >>>> update.packages(ask='graphics')
> >>>>
> >>> --- Please select a CRAN mirror for use in this session ---
> >>> Warning in install.packages(update[instlib == l, "Package"], l,
> >>> contriburl = contriburl,  :
> >>>  'lib = "C:/PROGRA~1/R/R-26~1.0/library"' is not writable
> >>> Error in install.packages(update[instlib == l, "Package"], l,
> >>> contriburl = contriburl,  :
> >>>  unable to install packages
> >>>
> >>> I am using R-2.6.1 (even though the directory says 2.6.0) since I
> >>> tend to write over the prior directory if its just an upgrade involving
> >>> the last digit of the R version.
> >>>
> >>>
> >>>> R.version.string
> >>>>
> >>> [1] "R version 2.6.1 Patched (2007-12-06 r43610)"
> >>>
> >>> How should I go about updating lattice and the VR bundle?
> >>>
> >>> ______________________________________________
> >>> R-devel at r-project.org mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>>
> >>>
> >>
> >
> >
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From markus.cl at gmx.de  Sun Jan 20 00:05:10 2008
From: markus.cl at gmx.de (Markus)
Date: Sat, 19 Jan 2008 18:05:10 -0500
Subject: [Rd] R_alloc segfaults
Message-ID: <d0bc2a830801191505j24c0e68do834d140cbfdb6799@mail.gmail.com>

I want to write a little stand-alone C program that calls R_alloc, but
I get a segmentation fault:

int main(int argc, char** argv){
   double* d = (double *)R_alloc(2, sizeof(double)); // <- segmentation fault!
   return 0;
}

gdb reveals that sizeof(double) evaluated to 0:
> R_alloc (nelem=2, eltsize=0) at memory.c:1649
so it results in the segfault later.

This is how I compile my program:
$ cd R-2.6.1/src/main
$ gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2
-I../../src/extra/pcre  -I. -I../../src/include -I../../src/include
-I/usr/local/include -DHAVE_CONFIG_H    -g  -c main.c -o main.o
$ gcc -std=gnu99 -Wl,--export-dynamic [lots of R .o and .a files]
-lreadline -lncurses  -ldl -lm

What could cause this strange memory problem? Is the compile command wrong/

I'd be happy to just call malloc instead of R_alloc, but what I
actually want to do is to call lbfgsb (see optim.c), and that uses
R_alloc. When I do call lbfgsb from my stand-alone C program, its
R_alloc call is evaluated with these arguments
> R_alloc (nelem=1, eltsize=-1073870176) at memory.c:1649
and I get a segfault again. When I modify the original optim.c to use
malloc instead of R_alloc, I get the segfault a little later when it
calls S_alloc. So I'd like to fix the R_alloc/S_alloc problem, rather
than modifying the whole optim.c code.

Any hints how I can fix the R_alloc calls and avoid the segmentation faults?

Thanks!
Markus


From ripley at stats.ox.ac.uk  Sun Jan 20 07:41:38 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 20 Jan 2008 06:41:38 +0000 (GMT)
Subject: [Rd] R_alloc segfaults
In-Reply-To: <d0bc2a830801191505j24c0e68do834d140cbfdb6799@mail.gmail.com>
References: <d0bc2a830801191505j24c0e68do834d140cbfdb6799@mail.gmail.com>
Message-ID: <alpine.LFD.1.00.0801200637380.22497@gannet.stats.ox.ac.uk>

You can't call arbitrary R entry points from a standalone C program 
without initializing R -- you have not intialized the memory allocator 
here.

See 'Writing R Extensions' for various ways to embed R in your own 
program.

On Sat, 19 Jan 2008, Markus wrote:

> I want to write a little stand-alone C program that calls R_alloc, but
> I get a segmentation fault:
>
> int main(int argc, char** argv){
>   double* d = (double *)R_alloc(2, sizeof(double)); // <- segmentation fault!
>   return 0;
> }
>
> gdb reveals that sizeof(double) evaluated to 0:
>> R_alloc (nelem=2, eltsize=0) at memory.c:1649
> so it results in the segfault later.
>
> This is how I compile my program:
> $ cd R-2.6.1/src/main
> $ gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2
> -I../../src/extra/pcre  -I. -I../../src/include -I../../src/include
> -I/usr/local/include -DHAVE_CONFIG_H    -g  -c main.c -o main.o
> $ gcc -std=gnu99 -Wl,--export-dynamic [lots of R .o and .a files]
> -lreadline -lncurses  -ldl -lm
>
> What could cause this strange memory problem? Is the compile command wrong/
>
> I'd be happy to just call malloc instead of R_alloc, but what I
> actually want to do is to call lbfgsb (see optim.c), and that uses
> R_alloc. When I do call lbfgsb from my stand-alone C program, its
> R_alloc call is evaluated with these arguments
>> R_alloc (nelem=1, eltsize=-1073870176) at memory.c:1649
> and I get a segfault again. When I modify the original optim.c to use
> malloc instead of R_alloc, I get the segfault a little later when it
> calls S_alloc. So I'd like to fix the R_alloc/S_alloc problem, rather
> than modifying the whole optim.c code.
>
> Any hints how I can fix the R_alloc calls and avoid the segmentation faults?
>
> Thanks!
> Markus
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at stat.berkeley.edu  Mon Jan 21 05:02:39 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sun, 20 Jan 2008 20:02:39 -0800
Subject: [Rd] Great tool
Message-ID: <59d7961d0801202002l1cc15962xe6a2f623d52ccd05@mail.gmail.com>

Hi,

I just have drop a note to say that the 'codetools' (and the part of R
CMD check that use it) is a pleasure to use and saves me from hours of
troubleshooting.  Each time it finds something I am amazed how
accurate it is.  Thanks to Luke T. and everyone else involved in
creating it.

Cheers,

Henrik


From ggrothendieck at gmail.com  Mon Jan 21 05:19:34 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 20 Jan 2008 23:19:34 -0500
Subject: [Rd] Great tool
In-Reply-To: <59d7961d0801202002l1cc15962xe6a2f623d52ccd05@mail.gmail.com>
References: <59d7961d0801202002l1cc15962xe6a2f623d52ccd05@mail.gmail.com>
Message-ID: <971536df0801202019o5f5b63b4td2c58a1d3717c98e@mail.gmail.com>

I agree.  Its incredibly useful.

On Jan 20, 2008 11:02 PM, Henrik Bengtsson <hb at stat.berkeley.edu> wrote:
> Hi,
>
> I just have drop a note to say that the 'codetools' (and the part of R
> CMD check that use it) is a pleasure to use and saves me from hours of
> troubleshooting.  Each time it finds something I am amazed how
> accurate it is.  Thanks to Luke T. and everyone else involved in
> creating it.
>
> Cheers,
>
> Henrik
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From hb at stat.berkeley.edu  Mon Jan 21 05:50:12 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sun, 20 Jan 2008 20:50:12 -0800
Subject: [Rd] Misinformative error message for vector()
Message-ID: <59d7961d0801202050o2bd08ad4y3ac6131305814c53@mail.gmail.com>

Nothing serious, but I just noticed that if you pass a function as the
'length' argument of vector(), you get the following misinformative
error message:

> vector("list", length=function() {})
Error in vector("list", length = function() { :
  negative length vectors are not allowed

whereas if you for instance do:

> vector("list", length="foo")
Error in vector("list", length = "foo") :
  unimplemented type 'character' in 'asVecSize'

which is more informative.

/Henrik


From ripley at stats.ox.ac.uk  Mon Jan 21 09:46:27 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 21 Jan 2008 08:46:27 +0000 (GMT)
Subject: [Rd] Misinformative error message for vector()
In-Reply-To: <59d7961d0801202050o2bd08ad4y3ac6131305814c53@mail.gmail.com>
References: <59d7961d0801202050o2bd08ad4y3ac6131305814c53@mail.gmail.com>
Message-ID: <alpine.LFD.1.00.0801210844470.9081@gannet.stats.ox.ac.uk>

Easy to fix, and less serious than

> vector("list", length=NaN)
list()

On Sun, 20 Jan 2008, Henrik Bengtsson wrote:

> Nothing serious, but I just noticed that if you pass a function as the
> 'length' argument of vector(), you get the following misinformative
> error message:
>
>> vector("list", length=function() {})
> Error in vector("list", length = function() { :
>  negative length vectors are not allowed
>
> whereas if you for instance do:
>
>> vector("list", length="foo")
> Error in vector("list", length = "foo") :
>  unimplemented type 'character' in 'asVecSize'
>
> which is more informative.
>
> /Henrik
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From david.reitter at gmail.com  Sun Jan 20 17:55:24 2008
From: david.reitter at gmail.com (david.reitter at gmail.com)
Date: Sun, 20 Jan 2008 17:55:24 +0100 (CET)
Subject: [Rd] read.table: wrong error message? (PR#10592)
Message-ID: <20080120165524.9D5E82834158@mail.pubhealth.ku.dk>


--Apple-Mail-44--797532055
Content-Type: text/plain;
	charset=US-ASCII;
	format=flowed;
	delsp=yes
Content-Transfer-Encoding: 7bit

I believe read.table may report misleading errors. In this example,  
where a header line in a file has an incorrect number of row names (28  
instead of 29), I get the error message "duplicate row.names are not  
allowed".

However, I cannot not find any duplicate row names. Fixing the header  
line by adding an extra row name, however, avoids the error.

The behavior is confusing - I would expect a different error message,  
even if I should have quoted some row names.

I am attaching a sample file that reproduces the problem with R -- 
vanilla, and then: read.table("m2").  I get it in 2.5.1 and 2.6.0.

PS.:

R version 2.6.0 (2007-10-03)
...
 > x <- read.table("m2", header=T)
Error in read.table("m2", header = T) :
   duplicate 'row.names' are not allowed
 > traceback()
2: stop("duplicate 'row.names' are not allowed")
1: read.table("m2", header = T)
 >

  
--Apple-Mail-44--797532055
Content-Disposition: attachment;
	filename=m2
Content-Type: application/octet-stream;
	x-unix-mode=0644;
	name="m2"
Content-Transfer-Encoding: 7bit

primed rule role dist starttime target.utt rule.freq primeperiod.length dialogue.length dialogue.id words.repeated words.repeated.prop head.repeated head.freq head.pos prime.gaze target.gaze eyecontact familiar convseq length doc.score friend task.familiar same.specrule derivation pathlen distituent
0 vp---vbg-vp i 2 5.67 4 False 172 70 261.5322 1 0 0/7 True na None None None 1 0 1 7 135 - - 1 None - -
0 vp---to-vp r 1 6.03 4 False 758 13 261.5322 1 0 0/6 True na None None None 1 0 1 6 135 - - 1 None - -
0 vp---to-vp i 2 6.03 4 False 758 70 261.5322 1 0 0/6 True na None None None 1 0 1 6 135 - - 1 None - -
0 s---cc-s i 1 11.3 5 False 813 83 261.5322 1 0 2/9 True na None None None 1 0 1 9 135 - - 1 None - -
0 s---cc-s i 3 11.3 5 False 813 70 261.5322 1 0 0/9 True na None None None 1 0 1 9 135 - - 1 None - -
0 s---advp-s i 3 12.71 5 False 440 70 261.5322 1 0 0/8 True na None None None 1 0 1 8 135 - - 1 None - -
1 vp---ber-vp i 1 12.98 5 False 406 83 261.5322 1 0 2/7 True na None None None 1 0 1 7 135 - - 1 None - -
1 vp---vbg-vp i 1 13.11 5 False 172 83 261.5322 1 0 3/7 True na None None None 1 0 1 7 135 - - 1 None - -
1 vp---to-vp i 1 13.52 5 False 758 83 261.5322 1 0 2/6 True na None None None 1 0 1 6 135 - - 1 None - -
1 pp---ql-rp-pp i 1 14.12 5 False 282 83 261.5322 1 0 0/3 True na None None None 1 0 1 3 135 - - 1 None - -
0 pp---ql-rp-pp r 2 14.12 5 False 282 13 261.5322 1 0 0/3 True na None None None 1 0 1 3 135 - - 1 None - -
0 ap---ap r 2 18.75 5 False 120 13 261.5322 1 0 0/1 True na None None None 1 0 1 1 135 - - 1 None - -
0 pp---pp-pp i 3 22.7 6 False 429 13 261.5322 1 0 0/4 True na None None None 1 0 1 4 135 - - 1 None - -
1 pp---ql-rp r 2 22.7 6 False 505 83 261.5322 1 0 1/2 True na None None None 1 0 1 2 135 - - 1 None - -
0 pp---rp-pp r 2 23.54 6 False 1124 83 261.5322 1 0 0/2 True na None None None 1 0 1 2 135 - - 1 None - -
0 pp---pp-cc-rb-pp i 2 25.27 7 False 64 200 261.5322 1 0 1/6 True na None None None 1 0 1 6 135 - - 1 None - -
0 pp---pp-cc-rb-pp r 4 25.27 7 False 64 13 261.5322 1 0 0/6 True na None None None 1 0 1 6 135 - - 1 None - -
1 pp---ql-rp-pp i 2 25.99 7 False 282 200 261.5322 1 0 2/3 True na None None None 1 0 1 3 135 - - 1 None - -
1 pp---ql-rp-pp i 3 25.99 7 False 282 83 261.5322 1 0 0/3 True na None None None 1 0 1 3 135 - - 1 None - -

--Apple-Mail-44--797532055--


From P.Dalgaard at biostat.ku.dk  Mon Jan 21 12:34:04 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Mon, 21 Jan 2008 12:34:04 +0100
Subject: [Rd] read.table: wrong error message? (PR#10592)
In-Reply-To: <20080120165524.9D5E82834158@mail.pubhealth.ku.dk>
References: <20080120165524.9D5E82834158@mail.pubhealth.ku.dk>
Message-ID: <4794832C.6010001@biostat.ku.dk>

david.reitter at gmail.com wrote:
> --Apple-Mail-44--797532055
> Content-Type: text/plain;
> 	charset=US-ASCII;
> 	format=flowed;
> 	delsp=yes
> Content-Transfer-Encoding: 7bit
>
> I believe read.table may report misleading errors. In this example,  
> where a header line in a file has an incorrect number of row names (28  
> instead of 29), I get the error message "duplicate row.names are not  
> allowed".
>
> However, I cannot not find any duplicate row names. Fixing the header  
> line by adding an extra row name, however, avoids the error.
>
> The behavior is confusing - I would expect a different error message,  
> even if I should have quoted some row names.
>   
Arguably, read.table() is too smart for its own good at times, but this
_is_ documented behaviour:


     If 'row.names' is not specified and the header line has one less
     entry than the number of columns, the first column is taken to be
     the row names.  This allows data frames to be read in from the
     format in which they are printed.  If 'row.names' is specified and
     does not refer to the first column, that column is discarded from
     such files.

So, if your COLUMN (sic!) name count is off by one, read.table() takes
the first variable as row.names, and when this is a 0/1 variable, you
will have duplicate names.

> I am attaching a sample file that reproduces the problem with R -- 
> vanilla, and then: read.table("m2").  I get it in 2.5.1 and 2.6.0.
>
> PS.:
>
> R version 2.6.0 (2007-10-03)
> ...
>  > x <- read.table("m2", header=T)
> Error in read.table("m2", header = T) :
>    duplicate 'row.names' are not allowed
>  > traceback()
> 2: stop("duplicate 'row.names' are not allowed")
> 1: read.table("m2", header = T)
>  >
>
>   
> --Apple-Mail-44--797532055
> Content-Disposition: attachment;
> 	filename=m2
> Content-Type: application/octet-stream;
> 	x-unix-mode=0644;
> 	name="m2"
> Content-Transfer-Encoding: 7bit
>
> primed rule role dist starttime target.utt rule.freq primeperiod.length dialogue.length dialogue.id words.repeated words.repeated.prop head.repeated head.freq head.pos prime.gaze target.gaze eyecontact familiar convseq length doc.score friend task.familiar same.specrule derivation pathlen distituent
> 0 vp---vbg-vp i 2 5.67 4 False 172 70 261.5322 1 0 0/7 True na None None None 1 0 1 7 135 - - 1 None - -
> 0 vp---to-vp r 1 6.03 4 False 758 13 261.5322 1 0 0/6 True na None None None 1 0 1 6 135 - - 1 None - -
> 0 vp---to-vp i 2 6.03 4 False 758 70 261.5322 1 0 0/6 True na None None None 1 0 1 6 135 - - 1 None - -
> 0 s---cc-s i 1 11.3 5 False 813 83 261.5322 1 0 2/9 True na None None None 1 0 1 9 135 - - 1 None - -
> 0 s---cc-s i 3 11.3 5 False 813 70 261.5322 1 0 0/9 True na None None None 1 0 1 9 135 - - 1 None - -
> 0 s---advp-s i 3 12.71 5 False 440 70 261.5322 1 0 0/8 True na None None None 1 0 1 8 135 - - 1 None - -
> 1 vp---ber-vp i 1 12.98 5 False 406 83 261.5322 1 0 2/7 True na None None None 1 0 1 7 135 - - 1 None - -
> 1 vp---vbg-vp i 1 13.11 5 False 172 83 261.5322 1 0 3/7 True na None None None 1 0 1 7 135 - - 1 None - -
> 1 vp---to-vp i 1 13.52 5 False 758 83 261.5322 1 0 2/6 True na None None None 1 0 1 6 135 - - 1 None - -
> 1 pp---ql-rp-pp i 1 14.12 5 False 282 83 261.5322 1 0 0/3 True na None None None 1 0 1 3 135 - - 1 None - -
> 0 pp---ql-rp-pp r 2 14.12 5 False 282 13 261.5322 1 0 0/3 True na None None None 1 0 1 3 135 - - 1 None - -
> 0 ap---ap r 2 18.75 5 False 120 13 261.5322 1 0 0/1 True na None None None 1 0 1 1 135 - - 1 None - -
> 0 pp---pp-pp i 3 22.7 6 False 429 13 261.5322 1 0 0/4 True na None None None 1 0 1 4 135 - - 1 None - -
> 1 pp---ql-rp r 2 22.7 6 False 505 83 261.5322 1 0 1/2 True na None None None 1 0 1 2 135 - - 1 None - -
> 0 pp---rp-pp r 2 23.54 6 False 1124 83 261.5322 1 0 0/2 True na None None None 1 0 1 2 135 - - 1 None - -
> 0 pp---pp-cc-rb-pp i 2 25.27 7 False 64 200 261.5322 1 0 1/6 True na None None None 1 0 1 6 135 - - 1 None - -
> 0 pp---pp-cc-rb-pp r 4 25.27 7 False 64 13 261.5322 1 0 0/6 True na None None None 1 0 1 6 135 - - 1 None - -
> 1 pp---ql-rp-pp i 2 25.99 7 False 282 200 261.5322 1 0 2/3 True na None None None 1 0 1 3 135 - - 1 None - -
> 1 pp---ql-rp-pp i 3 25.99 7 False 282 83 261.5322 1 0 0/3 True na None None None 1 0 1 3 135 - - 1 None - -
>
> --Apple-Mail-44--797532055--
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Mon Jan 21 12:40:20 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon, 21 Jan 2008 12:40:20 +0100 (CET)
Subject: [Rd] read.table: wrong error message? (PR#10592)
Message-ID: <20080121114021.05A3A283462D@mail.pubhealth.ku.dk>

On Sun, 20 Jan 2008, david.reitter at gmail.com wrote:

>
> --Apple-Mail-44--797532055
> Content-Type: text/plain;
> 	charset=US-ASCII;
> 	format=flowed;
> 	delsp=yes
> Content-Transfer-Encoding: 7bit
>
> I believe read.table may report misleading errors. In this example,
> where a header line in a file has an incorrect number of row names (28
> instead of 29), I get the error message "duplicate row.names are not
> allowed".

The first column of your file repeats 0 and 1, and your specification 
asked for the first column to be taken as the row names: from the help 
file

      If 'row.names' is not specified and the header line has one less
      entry than the number of columns, the first column is taken to be
      the row names.

> However, I cannot not find any duplicate row names. Fixing the header
> line by adding an extra row name, however, avoids the error.

An extra *column* name?  The behaviour of header=TRUE depends on the 
number of fields on the header line: see the quote above.

> The behavior is confusing - I would expect a different error message,
> even if I should have quoted some row names.

It may have confused you, but it has been in R/S for 20 years and is 
described in the help, the 'R Data Import/Export Manual', most books on 
R/S ....

It is fortunate that you did get an error message: if you give an input 
format different from what you intended it can easily be valid but not 
that you intended.

If you want to be safer, supply the argument 'row.names'.

> I am attaching a sample file that reproduces the problem with R --
> vanilla, and then: read.table("m2").  I get it in 2.5.1 and 2.6.0.

Also 2.6,1 and R-devel, as it is the documented behaviour.

>
> PS.:
>
> R version 2.6.0 (2007-10-03)
> ...
> > x <- read.table("m2", header=T)
> Error in read.table("m2", header = T) :
>   duplicate 'row.names' are not allowed
> > traceback()
> 2: stop("duplicate 'row.names' are not allowed")
> 1: read.table("m2", header = T)
> >
>
>
> --Apple-Mail-44--797532055
> Content-Disposition: attachment;
> 	filename=m2
> Content-Type: application/octet-stream;
> 	x-unix-mode=0644;
> 	name="m2"
> Content-Transfer-Encoding: 7bit
>
> primed rule role dist starttime target.utt rule.freq primeperiod.length dialogue.length dialogue.id words.repeated words.repeated.prop head.repeated head.freq head.pos prime.gaze target.gaze eyecontact familiar convseq length doc.score friend task.familiar same.specrule derivation pathlen distituent
> 0 vp---vbg-vp i 2 5.67 4 False 172 70 261.5322 1 0 0/7 True na None None None 1 0 1 7 135 - - 1 None - -
> 0 vp---to-vp r 1 6.03 4 False 758 13 261.5322 1 0 0/6 True na None None None 1 0 1 6 135 - - 1 None - -
> 0 vp---to-vp i 2 6.03 4 False 758 70 261.5322 1 0 0/6 True na None None None 1 0 1 6 135 - - 1 None - -
> 0 s---cc-s i 1 11.3 5 False 813 83 261.5322 1 0 2/9 True na None None None 1 0 1 9 135 - - 1 None - -
> 0 s---cc-s i 3 11.3 5 False 813 70 261.5322 1 0 0/9 True na None None None 1 0 1 9 135 - - 1 None - -
> 0 s---advp-s i 3 12.71 5 False 440 70 261.5322 1 0 0/8 True na None None None 1 0 1 8 135 - - 1 None - -
> 1 vp---ber-vp i 1 12.98 5 False 406 83 261.5322 1 0 2/7 True na None None None 1 0 1 7 135 - - 1 None - -
> 1 vp---vbg-vp i 1 13.11 5 False 172 83 261.5322 1 0 3/7 True na None None None 1 0 1 7 135 - - 1 None - -
> 1 vp---to-vp i 1 13.52 5 False 758 83 261.5322 1 0 2/6 True na None None None 1 0 1 6 135 - - 1 None - -
> 1 pp---ql-rp-pp i 1 14.12 5 False 282 83 261.5322 1 0 0/3 True na None None None 1 0 1 3 135 - - 1 None - -
> 0 pp---ql-rp-pp r 2 14.12 5 False 282 13 261.5322 1 0 0/3 True na None None None 1 0 1 3 135 - - 1 None - -
> 0 ap---ap r 2 18.75 5 False 120 13 261.5322 1 0 0/1 True na None None None 1 0 1 1 135 - - 1 None - -
> 0 pp---pp-pp i 3 22.7 6 False 429 13 261.5322 1 0 0/4 True na None None None 1 0 1 4 135 - - 1 None - -
> 1 pp---ql-rp r 2 22.7 6 False 505 83 261.5322 1 0 1/2 True na None None None 1 0 1 2 135 - - 1 None - -
> 0 pp---rp-pp r 2 23.54 6 False 1124 83 261.5322 1 0 0/2 True na None None None 1 0 1 2 135 - - 1 None - -
> 0 pp---pp-cc-rb-pp i 2 25.27 7 False 64 200 261.5322 1 0 1/6 True na None None None 1 0 1 6 135 - - 1 None - -
> 0 pp---pp-cc-rb-pp r 4 25.27 7 False 64 13 261.5322 1 0 0/6 True na None None None 1 0 1 6 135 - - 1 None - -
> 1 pp---ql-rp-pp i 2 25.99 7 False 282 200 261.5322 1 0 2/3 True na None None None 1 0 1 3 135 - - 1 None - -
> 1 pp---ql-rp-pp i 3 25.99 7 False 282 83 261.5322 1 0 0/3 True na None None None 1 0 1 3 135 - - 1 None - -
>
> --Apple-Mail-44--797532055--
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Thomas.Petzoldt at tu-dresden.de  Mon Jan 21 14:30:01 2008
From: Thomas.Petzoldt at tu-dresden.de (Thomas Petzoldt)
Date: Mon, 21 Jan 2008 14:30:01 +0100
Subject: [Rd] experiments with slot functions and  possible problems NOTE
Message-ID: <47949E59.9070603@tu-dresden.de>

Hello,

first of all, thanks to LT for \pkg{codeutils}. I agree that it is
indeed very useful to identify errors and also to encourage re-thinking
past solutions. My problem:

I want to compare different sets of related sub-functions which should
be used alternatively by the same top-level function. Sets of related
functions should be bound together (as lists) and the workspace should
be as clean as possible.

Finally, these functions are to be called by top-level functions that
work with such sets.

What's the best way to do this?

- clutter the workspace with lots of functions?
OR:
- ignore "notes about possible problems"
OR:
- a third way?

Thanks in advance

Thomas P.



An example:

##=============================================================
## 1) One possible "set of functions"
flistA <- list(
   foo = function() {
    1:10
   },
   bar = function() {
     log(foo())
   }
)

## .. we may also have alternative sets,
##    e.g. flistB, flistC, ... etc

## 2) Now we try to construct closures

## 2a) non-nested
makefun1 <- function(flist) {
   with(flist,
     function() foo()
   )
}

## 2b) nested call
makefun2 <- function(flist) {
   with(flist,
     function() bar()
   )
}

## 2c) or use an alternative way with a special function
##  addtoenv, suggested by Gabor Grothendieck some times ago:
addtoenv <- function(L, p = parent.frame()) {
   for(nm in names(L)) {
     assign(nm, L[[nm]], p)
     environment(p[[nm]]) <- p
   }
   L
}

makefun3 <- function(flist) {
   addtoenv(flist)
   function() bar()
}

## 3) now we create the "top-level" functions
##    with one particular "set of functions"
m1 <- makefun1(flistA)
m2 <- makefun2(flistA)
m3 <- makefun3(flistA)

m1()
## this was no problem, trivial

m2()
# Error in bar() : could not find function "foo"

m3()
# works, but even in that case we get problems
# if we do this in a package:

# * checking R code for possible problems ... NOTE
# bar: no visible global function definition for 'foo'

## tested with R version 2.6.1 and
## R 2.7.0 Under development, svn rev. 44061





-- 
Thomas Petzoldt
Technische Universitaet Dresden
Institut fuer Hydrobiologie
01062 Dresden
GERMANY

http://tu-dresden.de/Members/thomas.petzoldt


From murdoch at stats.uwo.ca  Mon Jan 21 14:46:28 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 21 Jan 2008 08:46:28 -0500
Subject: [Rd] experiments with slot functions and possible problems NOTE
In-Reply-To: <47949E59.9070603@tu-dresden.de>
References: <47949E59.9070603@tu-dresden.de>
Message-ID: <4794A234.5050008@stats.uwo.ca>

On 1/21/2008 8:30 AM, Thomas Petzoldt wrote:
> Hello,
> 
> first of all, thanks to LT for \pkg{codeutils}. I agree that it is
> indeed very useful to identify errors and also to encourage re-thinking
> past solutions. My problem:
> 
> I want to compare different sets of related sub-functions which should
> be used alternatively by the same top-level function. Sets of related
> functions should be bound together (as lists) and the workspace should
> be as clean as possible.
> 
> Finally, these functions are to be called by top-level functions that
> work with such sets.
> 
> What's the best way to do this?
> 
> - clutter the workspace with lots of functions?
> OR:
> - ignore "notes about possible problems"
> OR:
> - a third way?
> 
> Thanks in advance
> 
> Thomas P.
> 
> 
> 
> An example:
> 
> ##=============================================================
> ## 1) One possible "set of functions"
> flistA <- list(
>    foo = function() {
>     1:10
>    },
>    bar = function() {
>      log(foo())
>    }
> )
> 
> ## .. we may also have alternative sets,
> ##    e.g. flistB, flistC, ... etc
> 
> ## 2) Now we try to construct closures
> 
> ## 2a) non-nested
> makefun1 <- function(flist) {
>    with(flist,
>      function() foo()
>    )
> }
> 
> ## 2b) nested call
> makefun2 <- function(flist) {
>    with(flist,
>      function() bar()
>    )
> }
> ## 2c) or use an alternative way with a special function
> ##  addtoenv, suggested by Gabor Grothendieck some times ago:
> addtoenv <- function(L, p = parent.frame()) {
>    for(nm in names(L)) {
>      assign(nm, L[[nm]], p)
>      environment(p[[nm]]) <- p
>    }
>    L
> }
> 
> makefun3 <- function(flist) {
>    addtoenv(flist)
>    function() bar()
> }
> 
> ## 3) now we create the "top-level" functions
> ##    with one particular "set of functions"
> m1 <- makefun1(flistA)
> m2 <- makefun2(flistA)
> m3 <- makefun3(flistA)
> 
> m1()
> ## this was no problem, trivial
> 
> m2()
> # Error in bar() : could not find function "foo"

That's because the environment of bar was the evaluation frame in effect 
at the time it was created, and foo wasn't in that.  bar looks in its 
environment for non-local bindings.

Gabor's function edits the environment.
> 
> m3()
> # works, but even in that case we get problems
> # if we do this in a package:
> 
> # * checking R code for possible problems ... NOTE
> # bar: no visible global function definition for 'foo'

This is a spurious error:  codetools can't follow the strange stuff 
you're doing.

I'd say the best approach would be to use lots of little functions, and 
a namespace to hide them.  Then codetools will be happy.  For example,

Afoo <- function() {
      1:10
}
Abar <-function() {
       log(Afoo())
}
fListA <- list(foo = Afoo, bar = Abar)

This won't allow global references to foo or bar to escape the watchful 
eye of codetools; if you want those, you'd do something like

foo <- function() stop("foo not initialized")
bar <- function() stop("bar not initialized")

and later have

foo <- makefun1(fListA)
bar <- makefun2(fListA)

Duncan Murdoch


From david.reitter at gmail.com  Mon Jan 21 12:55:14 2008
From: david.reitter at gmail.com (david.reitter at gmail.com)
Date: Mon, 21 Jan 2008 12:55:14 +0100 (CET)
Subject: [Rd] read.table: wrong error message? (PR#10592)
Message-ID: <20080121115514.DBA782834629@mail.pubhealth.ku.dk>


--Apple-Mail-1--729254567
Content-Type: text/plain;
	charset=US-ASCII;
	format=flowed;
	delsp=yes
Content-Transfer-Encoding: 7bit

On 21 Jan 2008, at 11:38, Prof Brian Ripley wrote:
>
> The first column of your file repeats 0 and 1, and your  
> specification asked for the first column to be taken as the row  
> names: from the help file
>
>     If 'row.names' is not specified and the header line has one less
>     entry than the number of columns, the first column is taken to be
>     the row names.

I understand now. Thanks for the explanation.

I would have figured it out myself had I paid attention to the fact  
that the error message reports "row names" rather than "column names",  
or had the error message actually contained the conflicting names  
(either "0" or "1") or the full set of read names.

--
David Reitter
ICCS/HCRC, Informatics, University of Edinburgh
http://www.david-reitter.com





--Apple-Mail-1--729254567
Content-Disposition: attachment;
	filename=smime.p7s
Content-Type: application/pkcs7-signature;
	name=smime.p7s
Content-Transfer-Encoding: base64

MIAGCSqGSIb3DQEHAqCAMIACAQExCzAJBgUrDgMCGgUAMIAGCSqGSIb3DQEHAQAAoIIFxDCCAn0w
ggHmoAMCAQICEEfSZyInpN9bVdFPsdICbiIwDQYJKoZIhvcNAQEFBQAwYjELMAkGA1UEBhMCWkEx
JTAjBgNVBAoTHFRoYXd0ZSBDb25zdWx0aW5nIChQdHkpIEx0ZC4xLDAqBgNVBAMTI1RoYXd0ZSBQ
ZXJzb25hbCBGcmVlbWFpbCBJc3N1aW5nIENBMB4XDTA3MTIwOTIzMDM0OFoXDTA4MTIwODIzMDM0
OFowYjEQMA4GA1UEBBMHUmVpdHRlcjEOMAwGA1UEKhMFRGF2aWQxFjAUBgNVBAMTDURhdmlkIFJl
aXR0ZXIxJjAkBgkqhkiG9w0BCQEWF2RhdmlkLnJlaXR0ZXJAZ21haWwuY29tMIGfMA0GCSqGSIb3
DQEBAQUAA4GNADCBiQKBgQDIS4kZGULD+CxprkxDnEccAnZ2GQQxfn55aiAPoy5kJ+uLhelaZP4p
lgx3Vq8xYK1bjsLepGYp8qzVlHsyQPb6OfvRzrUXHxlJrHME0+Lblx37PBLxGDxc5W8qfZFJpej8
Dk3LUMga8laR9CRghbALoTV3UThUSMqk1cVwTY99KQIDAQABozQwMjAiBgNVHREEGzAZgRdkYXZp
ZC5yZWl0dGVyQGdtYWlsLmNvbTAMBgNVHRMBAf8EAjAAMA0GCSqGSIb3DQEBBQUAA4GBAKU8XIS6
R/R3Hg6ae5p0i4iUJURq+sDVMX9RGB3Ge5V8oKKglIQGaY03leem65pqICL6mdgX/Px21JoaKVAA
8XITLFVEFHL6BfZ/eePnzNi93rnaNe7hLUwLdGztdYmqN8zF0DOCybL1M1JDB3cTr0XwHJwxziSf
oEeENGNETykjMIIDPzCCAqigAwIBAgIBDTANBgkqhkiG9w0BAQUFADCB0TELMAkGA1UEBhMCWkEx
FTATBgNVBAgTDFdlc3Rlcm4gQ2FwZTESMBAGA1UEBxMJQ2FwZSBUb3duMRowGAYDVQQKExFUaGF3
dGUgQ29uc3VsdGluZzEoMCYGA1UECxMfQ2VydGlmaWNhdGlvbiBTZXJ2aWNlcyBEaXZpc2lvbjEk
MCIGA1UEAxMbVGhhd3RlIFBlcnNvbmFsIEZyZWVtYWlsIENBMSswKQYJKoZIhvcNAQkBFhxwZXJz
b25hbC1mcmVlbWFpbEB0aGF3dGUuY29tMB4XDTAzMDcxNzAwMDAwMFoXDTEzMDcxNjIzNTk1OVow
YjELMAkGA1UEBhMCWkExJTAjBgNVBAoTHFRoYXd0ZSBDb25zdWx0aW5nIChQdHkpIEx0ZC4xLDAq
BgNVBAMTI1RoYXd0ZSBQZXJzb25hbCBGcmVlbWFpbCBJc3N1aW5nIENBMIGfMA0GCSqGSIb3DQEB
AQUAA4GNADCBiQKBgQDEpjxVc1X7TrnKmVoeaMB1BHCd3+n/ox7svc31W/Iadr1/DDph8r9RzgHU
5VAKMNcCY1osiRVwjt3J8CuFWqo/cVbLrzwLB+fxH5E2JCoTzyvV84J3PQO+K/67GD4Hv0CAAmTX
p6a7n2XRxSpUhQ9IBH+nttE8YQRAHmQZcmC3+wIDAQABo4GUMIGRMBIGA1UdEwEB/wQIMAYBAf8C
AQAwQwYDVR0fBDwwOjA4oDagNIYyaHR0cDovL2NybC50aGF3dGUuY29tL1RoYXd0ZVBlcnNvbmFs
RnJlZW1haWxDQS5jcmwwCwYDVR0PBAQDAgEGMCkGA1UdEQQiMCCkHjAcMRowGAYDVQQDExFQcml2
YXRlTGFiZWwyLTEzODANBgkqhkiG9w0BAQUFAAOBgQBIjNFQg+oLLswNo2asZw9/r6y+whehQ5aU
nX9MIbj4Nh+qLZ82L8D0HFAgk3A8/a3hYWLD2ToZfoSxmRsAxRoLgnSeJVCUYsfbJ3FXJY3dqZw5
jowgT2Vfldr394fWxghOrvbqNOUQGls1TXfjViF4gtwhGTXeJLHTHUb/XV9lTzGCAo8wggKLAgEB
MHYwYjELMAkGA1UEBhMCWkExJTAjBgNVBAoTHFRoYXd0ZSBDb25zdWx0aW5nIChQdHkpIEx0ZC4x
LDAqBgNVBAMTI1RoYXd0ZSBQZXJzb25hbCBGcmVlbWFpbCBJc3N1aW5nIENBAhBH0mciJ6TfW1XR
T7HSAm4iMAkGBSsOAwIaBQCgggFvMBgGCSqGSIb3DQEJAzELBgkqhkiG9w0BBwEwHAYJKoZIhvcN
AQkFMQ8XDTA4MDEyMTExNTA0NVowIwYJKoZIhvcNAQkEMRYEFJN8Qc4lkZZVU7GKZnk9AnkCkaj4
MIGFBgkrBgEEAYI3EAQxeDB2MGIxCzAJBgNVBAYTAlpBMSUwIwYDVQQKExxUaGF3dGUgQ29uc3Vs
dGluZyAoUHR5KSBMdGQuMSwwKgYDVQQDEyNUaGF3dGUgUGVyc29uYWwgRnJlZW1haWwgSXNzdWlu
ZyBDQQIQR9JnIiek31tV0U+x0gJuIjCBhwYLKoZIhvcNAQkQAgsxeKB2MGIxCzAJBgNVBAYTAlpB
MSUwIwYDVQQKExxUaGF3dGUgQ29uc3VsdGluZyAoUHR5KSBMdGQuMSwwKgYDVQQDEyNUaGF3dGUg
UGVyc29uYWwgRnJlZW1haWwgSXNzdWluZyBDQQIQR9JnIiek31tV0U+x0gJuIjANBgkqhkiG9w0B
AQEFAASBgJaMRB2ro5JDA0vHTeC8kLMSU6sI1OF4hew1+u3BYe5iIEgoTM7rh8ICl5v7v2JUqCme
vIq+bG3Hm81MTr9f3WNumrDyCTJHIthKyn8yJkk8mXT7rGSwR3378iFu0J8IZZ6Fa/895enf9FLs
7119hVIlS0G4t4/d1R8hbCevrUtQAAAAAAAA

--Apple-Mail-1--729254567--


From ripley at stats.ox.ac.uk  Mon Jan 21 15:16:22 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 21 Jan 2008 14:16:22 +0000 (GMT)
Subject: [Rd] read.table: wrong error message? (PR#10592)
In-Reply-To: <680ACB8C-635F-47EB-8A93-66491DFE6FDC@gmail.com>
References: <20080120165524.9D5E82834158@mail.pubhealth.ku.dk>
	<Pine.LNX.4.64.0801211126310.23058@auk.stats>
	<680ACB8C-635F-47EB-8A93-66491DFE6FDC@gmail.com>
Message-ID: <alpine.LFD.1.00.0801211413180.23146@gannet.stats.ox.ac.uk>

On Mon, 21 Jan 2008, David Reitter wrote:

> On 21 Jan 2008, at 11:38, Prof Brian Ripley wrote:
>> 
>> The first column of your file repeats 0 and 1, and your specification asked 
>> for the first column to be taken as the row names: from the help file
>>
>>    If 'row.names' is not specified and the header line has one less
>>    entry than the number of columns, the first column is taken to be
>>    the row names.
>
> I understand now. Thanks for the explanation.
>
> I would have figured it out myself had I paid attention to the fact that the 
> error message reports "row names" rather than "column names", or had the 
> error message actually contained the conflicting names (either "0" or "1") or 
> the full set of read names.

We can fairly easily do something along those lines: I've added code to 
R-devel to do

> library(MASS)
> row.names(hills)[35] <- "Lomonds"
Error in `row.names<-.data.frame`(`*tmp*`, value = c("Greenmantle", "Carnethy",  :
   duplicate 'row.names' are not allowed
In addition: Warning message:
non-unique value when setting 'row.names': ?Lomonds?

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From Thomas.Petzoldt at tu-dresden.de  Mon Jan 21 15:58:41 2008
From: Thomas.Petzoldt at tu-dresden.de (Thomas Petzoldt)
Date: Mon, 21 Jan 2008 15:58:41 +0100
Subject: [Rd] experiments with slot functions and possible problems NOTE
In-Reply-To: <4794A234.5050008@stats.uwo.ca>
References: <47949E59.9070603@tu-dresden.de> <4794A234.5050008@stats.uwo.ca>
Message-ID: <4794B321.6030907@tu-dresden.de>

Hello Duncan,

thank you very much for your prompt reply. When I interpret your answer
correctly there seems to be no alternative than either:

A) using lots of (possibly private) functions in the package or,
B) define dummies for all functions which are in such lists or,
C) ignore the NOTE, knowing that it is spurious (BTW: there are several
prominent packages on CRAN with unresolved NOTEs).

The problem with A is, that it is my intention to have different
versions of particular functions which should be organized as consistent
sets. On the other hand, version B) is similarly inelegant as it
requires lots of "obsolete code". I already had this idea but found it
awkward because it would look more like Pascal where one has separate
interface and implementation.

Duncan Murdoch wrote:
> On 1/21/2008 8:30 AM, Thomas Petzoldt wrote:
>> Hello,
>>
>> first of all, thanks to LT for \pkg{codeutils}. I agree that it is
>> indeed very useful to identify errors and also to encourage re-thinking
>> past solutions. My problem:
>>
>> I want to compare different sets of related sub-functions which should
>> be used alternatively by the same top-level function. Sets of related
>> functions should be bound together (as lists) and the workspace should
>> be as clean as possible.
>>
>> Finally, these functions are to be called by top-level functions that
>> work with such sets.
>>
>> What's the best way to do this?
>>
>> - clutter the workspace with lots of functions?
>> OR:
>> - ignore "notes about possible problems"
>> OR:
>> - a third way?
>>
>> Thanks in advance
>>
>> Thomas P.

>> An example:
>>
>> flistA <- list(
>>    foo = function() {
>>     1:10
>>    },
>>    bar = function() {
>>      log(foo())
>>    }
>> )
>>

[... main part of the example deleted, see original posting (TP)]

>> m2()
>> # Error in bar() : could not find function "foo"
> 
> That's because the environment of bar was the evaluation frame in effect 
> at the time it was created, and foo wasn't in that.  bar looks in its 
> environment for non-local bindings.

Yes, of course. It simply shows that one can use non-nested functions
but not interdependend functions without using attach or environment
manipulations.

> 
> Gabor's function edits the environment.

Yes, that's the intention and it works for me, but several people call
it strange ;-)

>> m3()
>> # works, but even in that case we get problems
>> # if we do this in a package:
>>
>> # * checking R code for possible problems ... NOTE
>> # bar: no visible global function definition for 'foo'
> 
> This is a spurious error:  codetools can't follow the strange stuff 
> you're doing.

It is understandingly, that codetools cannot detect this. What about a
mechanism (e.g. a declaration in the NAMESPACE) where one can state that
one knows about this.

> I'd say the best approach would be to use lots of little functions, and 
> a namespace to hide them.  Then codetools will be happy.  For example,
> 
> Afoo <- function() {
>      1:10
> }
> Abar <-function() {
>       log(Afoo())
> }
> fListA <- list(foo = Afoo, bar = Abar)

Yes, that's version A) after my nomencature.

> 
> This won't allow global references to foo or bar to escape the watchful 
> eye of codetools; if you want those, you'd do something like
> 
> foo <- function() stop("foo not initialized")
> bar <- function() stop("bar not initialized")

Yes, seems like an approach using dummy functions.

> and later have
> 
> foo <- makefun1(fListA)
> bar <- makefun2(fListA)

... but I don't understand yet why you do it this way. In my example foo
and bar are the "sub-functions" but makefun would return the toplevel
functions.

> Duncan Murdoch

Nevertheless, thanks a lot for your assistance. I'm still a little bit
optimistic that there may be a general alternative and I should tolerate
C) (notes of codetools) a little time, but (if there is no alterative)
use a combination between solution A) (default functions) or B) (dummies).


Thomas P.

-- 
Thomas Petzoldt
Technische Universitaet Dresden
Institut fuer Hydrobiologie
01062 Dresden
GERMANY


From murdoch at stats.uwo.ca  Mon Jan 21 16:24:42 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 21 Jan 2008 10:24:42 -0500
Subject: [Rd] experiments with slot functions and possible problems NOTE
In-Reply-To: <4794B321.6030907@tu-dresden.de>
References: <47949E59.9070603@tu-dresden.de> <4794A234.5050008@stats.uwo.ca>
	<4794B321.6030907@tu-dresden.de>
Message-ID: <4794B93A.6050309@stats.uwo.ca>

On 1/21/2008 9:58 AM, Thomas Petzoldt wrote:
> Hello Duncan,
> 
> thank you very much for your prompt reply. When I interpret your answer
> correctly there seems to be no alternative than either:
> 
> A) using lots of (possibly private) functions in the package or,
> B) define dummies for all functions which are in such lists or,
> C) ignore the NOTE, knowing that it is spurious (BTW: there are several
> prominent packages on CRAN with unresolved NOTEs).
> 
> The problem with A is, that it is my intention to have different
> versions of particular functions which should be organized as consistent
> sets. On the other hand, version B) is similarly inelegant as it
> requires lots of "obsolete code". I already had this idea but found it
> awkward because it would look more like Pascal where one has separate
> interface and implementation.

There's another way, which is more R-like, if you really want to avoid 
lots of private functions.  That is to create your lists via a function, 
and define the functions in the lists locally within the creator.  That 
is, something like this:

MakeListA <- function() {
   foo <- function() {
       1:10
   }
   bar <-function() {
        log(foo())
   }
   return(list(foo = foo, bar = bar))
}

fListA <- MakeListA()

This avoids the explicit environment manipulations.  Because both foo 
and bar are defined locally within MakeListA, they share an environment 
there, and can see each other (and anything else you chose to define 
locally within MakeListA.)

A big more way down below...

> 
> Duncan Murdoch wrote:
>> On 1/21/2008 8:30 AM, Thomas Petzoldt wrote:
>>> Hello,
>>>
>>> first of all, thanks to LT for \pkg{codeutils}. I agree that it is
>>> indeed very useful to identify errors and also to encourage re-thinking
>>> past solutions. My problem:
>>>
>>> I want to compare different sets of related sub-functions which should
>>> be used alternatively by the same top-level function. Sets of related
>>> functions should be bound together (as lists) and the workspace should
>>> be as clean as possible.
>>>
>>> Finally, these functions are to be called by top-level functions that
>>> work with such sets.
>>>
>>> What's the best way to do this?
>>>
>>> - clutter the workspace with lots of functions?
>>> OR:
>>> - ignore "notes about possible problems"
>>> OR:
>>> - a third way?
>>>
>>> Thanks in advance
>>>
>>> Thomas P.
> 
>>> An example:
>>>
>>> flistA <- list(
>>>    foo = function() {
>>>     1:10
>>>    },
>>>    bar = function() {
>>>      log(foo())
>>>    }
>>> )
>>>
> 
> [... main part of the example deleted, see original posting (TP)]
> 
>>> m2()
>>> # Error in bar() : could not find function "foo"
>> 
>> That's because the environment of bar was the evaluation frame in effect 
>> at the time it was created, and foo wasn't in that.  bar looks in its 
>> environment for non-local bindings.
> 
> Yes, of course. It simply shows that one can use non-nested functions
> but not interdependend functions without using attach or environment
> manipulations.
> 
>> 
>> Gabor's function edits the environment.
> 
> Yes, that's the intention and it works for me, but several people call
> it strange ;-)
> 
>>> m3()
>>> # works, but even in that case we get problems
>>> # if we do this in a package:
>>>
>>> # * checking R code for possible problems ... NOTE
>>> # bar: no visible global function definition for 'foo'
>> 
>> This is a spurious error:  codetools can't follow the strange stuff 
>> you're doing.
> 
> It is understandingly, that codetools cannot detect this. What about a
> mechanism (e.g. a declaration in the NAMESPACE) where one can state that
> one knows about this.
> 
>> I'd say the best approach would be to use lots of little functions, and 
>> a namespace to hide them.  Then codetools will be happy.  For example,
>> 
>> Afoo <- function() {
>>      1:10
>> }
>> Abar <-function() {
>>       log(Afoo())
>> }
>> fListA <- list(foo = Afoo, bar = Abar)
> 
> Yes, that's version A) after my nomencature.
> 
>> 
>> This won't allow global references to foo or bar to escape the watchful 
>> eye of codetools; if you want those, you'd do something like
>> 
>> foo <- function() stop("foo not initialized")
>> bar <- function() stop("bar not initialized")
> 
> Yes, seems like an approach using dummy functions.
> 
>> and later have
>> 
>> foo <- makefun1(fListA)
>> bar <- makefun2(fListA)
> 
> ... but I don't understand yet why you do it this way. In my example foo
> and bar are the "sub-functions" but makefun would return the toplevel
> functions.

I must have misunderstand your intention here.  I thought makefun1 was 
supposed to extract the foo member from fListA; I don't understand your 
distinction between toplevel and sub-functions.
> 
>> Duncan Murdoch
> 
> Nevertheless, thanks a lot for your assistance. I'm still a little bit
> optimistic that there may be a general alternative and I should tolerate
> C) (notes of codetools) a little time, but (if there is no alterative)
> use a combination between solution A) (default functions) or B) (dummies).

There are lots of possibilities; I'm sure we haven't exhausted them yet.

Duncan Murdoch
> 
> 
> Thomas P.
>


From ggrothendieck at gmail.com  Mon Jan 21 17:49:12 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 21 Jan 2008 11:49:12 -0500
Subject: [Rd] experiments with slot functions and possible problems NOTE
In-Reply-To: <47949E59.9070603@tu-dresden.de>
References: <47949E59.9070603@tu-dresden.de>
Message-ID: <971536df0801210849m3c578513n40b00de45486552b@mail.gmail.com>

If the intention is to place fList's contents in the global environment
then you need to specify that in addtoenv or else it assumes
the parent environment.

> flistA <- list(foo = function () 1:10, bar = function() log(foo()))
> makefun <- function(fList) addtoenv(fList, .GlobalEnv)
> makefun(flistA)
$foo
function() {
   1:10
  }

$bar
function() {
    log(foo())
  }

> foo()
 [1]  1  2  3  4  5  6  7  8  9 10
> bar()
 [1] 0.0000000 0.6931472 1.0986123 1.3862944 1.6094379 1.7917595 1.9459101
 [8] 2.0794415 2.1972246 2.3025851

Note that this takes advantage of the fact that in your example flistA was
defined in the global environment in the first place.  Had that not been the
case we would have had to reset the environment of bar so that it could
find foo.

By the way.  What about just attach(flistA) ?


On Jan 21, 2008 8:30 AM, Thomas Petzoldt <Thomas.Petzoldt at tu-dresden.de> wrote:
> Hello,
>
> first of all, thanks to LT for \pkg{codeutils}. I agree that it is
> indeed very useful to identify errors and also to encourage re-thinking
> past solutions. My problem:
>
> I want to compare different sets of related sub-functions which should
> be used alternatively by the same top-level function. Sets of related
> functions should be bound together (as lists) and the workspace should
> be as clean as possible.
>
> Finally, these functions are to be called by top-level functions that
> work with such sets.
>
> What's the best way to do this?
>
> - clutter the workspace with lots of functions?
> OR:
> - ignore "notes about possible problems"
> OR:
> - a third way?
>
> Thanks in advance
>
> Thomas P.
>
>
>
> An example:
>
> ##=============================================================
> ## 1) One possible "set of functions"
> flistA <- list(
>   foo = function() {
>    1:10
>   },
>   bar = function() {
>     log(foo())
>   }
> )
>
> ## .. we may also have alternative sets,
> ##    e.g. flistB, flistC, ... etc
>
> ## 2) Now we try to construct closures
>
> ## 2a) non-nested
> makefun1 <- function(flist) {
>   with(flist,
>     function() foo()
>   )
> }
>
> ## 2b) nested call
> makefun2 <- function(flist) {
>   with(flist,
>     function() bar()
>   )
> }
>
> ## 2c) or use an alternative way with a special function
> ##  addtoenv, suggested by Gabor Grothendieck some times ago:
> addtoenv <- function(L, p = parent.frame()) {
>   for(nm in names(L)) {
>     assign(nm, L[[nm]], p)
>     environment(p[[nm]]) <- p
>   }
>   L
> }
>
> makefun3 <- function(flist) {
>   addtoenv(flist)
>   function() bar()
> }
>
> ## 3) now we create the "top-level" functions
> ##    with one particular "set of functions"
> m1 <- makefun1(flistA)
> m2 <- makefun2(flistA)
> m3 <- makefun3(flistA)
>
> m1()
> ## this was no problem, trivial
>
> m2()
> # Error in bar() : could not find function "foo"
>
> m3()
> # works, but even in that case we get problems
> # if we do this in a package:
>
> # * checking R code for possible problems ... NOTE
> # bar: no visible global function definition for 'foo'
>
> ## tested with R version 2.6.1 and
> ## R 2.7.0 Under development, svn rev. 44061
>
>
>
>
>
> --
> Thomas Petzoldt
> Technische Universitaet Dresden
> Institut fuer Hydrobiologie
> 01062 Dresden
> GERMANY
>
> http://tu-dresden.de/Members/thomas.petzoldt
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From Thomas.Petzoldt at tu-dresden.de  Mon Jan 21 17:50:24 2008
From: Thomas.Petzoldt at tu-dresden.de (Thomas Petzoldt)
Date: Mon, 21 Jan 2008 17:50:24 +0100
Subject: [Rd] experiments with slot functions and possible problems NOTE
In-Reply-To: <4794B93A.6050309@stats.uwo.ca>
References: <47949E59.9070603@tu-dresden.de>
	<4794A234.5050008@stats.uwo.ca>	<4794B321.6030907@tu-dresden.de>
	<4794B93A.6050309@stats.uwo.ca>
Message-ID: <4794CD50.2080604@tu-dresden.de>

Duncan Murdoch wrote:
> On 1/21/2008 9:58 AM, Thomas Petzoldt wrote:
>> Hello Duncan,
>>
>> thank you very much for your prompt reply. When I interpret your answer
>> correctly there seems to be no alternative than either:
>>
>> A) using lots of (possibly private) functions in the package or,
>> B) define dummies for all functions which are in such lists or,
>> C) ignore the NOTE, knowing that it is spurious (BTW: there are several
>> prominent packages on CRAN with unresolved NOTEs).

[...]

> There's another way, which is more R-like, if you really want to avoid
> lots of private functions.  That is to create your lists via a function,
> and define the functions in the lists locally within the creator.  That
> is, something like this:
>
> MakeListA <- function() {
>   foo <- function() {
>       1:10
>   }
>   bar <-function() {
>        log(foo())
>   }
>   return(list(foo = foo, bar = bar))
> }
>
> fListA <- MakeListA()
>
> This avoids the explicit environment manipulations.  Because both foo
> and bar are defined locally within MakeListA, they share an environment
> there, and can see each other (and anything else you chose to define
> locally within MakeListA.)

[...]

Cool! What about the following (AFAIK getting environments is "legal" as
opposed to setting them):

MakeListA <- function() {
    foo <- function() {
      1:10
    }
    bar <-function() {
      log(foo())
    }
    return(as.list(environment()))
}

fListA <- MakeListA()

makefun <- function(flist) {
   with(flist,
     function() bar() + foo()
   )
}
toplevel <- makefun(fListA)
toplevel()

## but it is not possible to naively replace functions afterwards:
fListA$bar <- function() cos(foo())
toplevel <- makefun(fListA)
toplevel()

## Error in bar() : could not find function "foo"


Note that it's the same in the "explicit" and in the environment version.

-- Thomas P.


From Thomas.Petzoldt at tu-dresden.de  Mon Jan 21 18:06:47 2008
From: Thomas.Petzoldt at tu-dresden.de (Thomas Petzoldt)
Date: Mon, 21 Jan 2008 18:06:47 +0100
Subject: [Rd] experiments with slot functions and possible problems NOTE
In-Reply-To: <971536df0801210849m3c578513n40b00de45486552b@mail.gmail.com>
References: <47949E59.9070603@tu-dresden.de>
	<971536df0801210849m3c578513n40b00de45486552b@mail.gmail.com>
Message-ID: <4794D127.7030708@tu-dresden.de>

Hi Gabor,

nice to see you on this thread.
As you see, I'm back with my old problem.

Gabor Grothendieck wrote:
 > If the intention is to place fList's contents in the global
 > environment
 > then you need to specify that in addtoenv or else it assumes
 > the parent environment.

No, it was the intention to keep the global environment as clean as 
possible and to use local data structures instead.

 >> flistA <- list(foo = function () 1:10, bar = function() log(foo()))
 >> makefun <- function(fList) addtoenv(fList, .GlobalEnv)
 >> makefun(flistA)
 > $foo
 > function() {
 >    1:10
 >   }
 >
 > $bar
 > function() {
 >     log(foo())
 >   }
 >
 >> foo()
 >  [1]  1  2  3  4  5  6  7  8  9 10
 >> bar()
 >  [1] 0.0000000 0.6931472 1.0986123 1.3862944 1.6094379 1.7917595 
1.9459101
 >  [8] 2.0794415 2.1972246 2.3025851
 >
 > Note that this takes advantage of the fact that in your example
 > flistA was
 > defined in the global environment in the first place.  Had that not
 > been the
 > case we would have had to reset the environment of bar so that it
 > could find foo.
 >
 > By the way.  What about just attach(flistA) ?

You are right, attach works. I used it in another package instead of 
addtoenv, but it introduced new problems, even if I use it the following 
way:

attach(flist)
on.exit(detach(flist))

[...]

Additionally, I've never seen attach in another package.

Thomas P.


From murdoch at stats.uwo.ca  Mon Jan 21 18:13:39 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 21 Jan 2008 12:13:39 -0500
Subject: [Rd] experiments with slot functions and possible problems NOTE
In-Reply-To: <4794CD50.2080604@tu-dresden.de>
References: <47949E59.9070603@tu-dresden.de>
	<4794A234.5050008@stats.uwo.ca>	<4794B321.6030907@tu-dresden.de>
	<4794B93A.6050309@stats.uwo.ca> <4794CD50.2080604@tu-dresden.de>
Message-ID: <4794D2C3.3080704@stats.uwo.ca>

On 1/21/2008 11:50 AM, Thomas Petzoldt wrote:
> Duncan Murdoch wrote:
>> On 1/21/2008 9:58 AM, Thomas Petzoldt wrote:
>>> Hello Duncan,
>>>
>>> thank you very much for your prompt reply. When I interpret your answer
>>> correctly there seems to be no alternative than either:
>>>
>>> A) using lots of (possibly private) functions in the package or,
>>> B) define dummies for all functions which are in such lists or,
>>> C) ignore the NOTE, knowing that it is spurious (BTW: there are several
>>> prominent packages on CRAN with unresolved NOTEs).
> 
> [...]
> 
>> There's another way, which is more R-like, if you really want to avoid
>> lots of private functions.  That is to create your lists via a function,
>> and define the functions in the lists locally within the creator.  That
>> is, something like this:
>>
>> MakeListA <- function() {
>>   foo <- function() {
>>       1:10
>>   }
>>   bar <-function() {
>>        log(foo())
>>   }
>>   return(list(foo = foo, bar = bar))
>> }
>>
>> fListA <- MakeListA()
>>
>> This avoids the explicit environment manipulations.  Because both foo
>> and bar are defined locally within MakeListA, they share an environment
>> there, and can see each other (and anything else you chose to define
>> locally within MakeListA.)
> 
> [...]
> 
> Cool! What about the following (AFAIK getting environments is "legal" as
> opposed to setting them):
> 
> MakeListA <- function() {
>     foo <- function() {
>       1:10
>     }
>     bar <-function() {
>       log(foo())
>     }
>     return(as.list(environment()))
> }
> 
> fListA <- MakeListA()

Yes, that's fine.  Another variation is

fListA <- local({
      foo <- function() {
        1:10
      }
      bar <-function() {
        log(foo())
      }
      as.list(environment())
})

This avoids creating the MakeListA function, which may only be used once.

> makefun <- function(flist) {
>    with(flist,
>      function() bar() + foo()
>    )
> }
> toplevel <- makefun(fListA)
> toplevel()
> 
> ## but it is not possible to naively replace functions afterwards:
> fListA$bar <- function() cos(foo())
> toplevel <- makefun(fListA)
> toplevel()
> 
> ## Error in bar() : could not find function "foo"

This is sensible.  Functions in R aren't macros.  When you say 
cos(foo()) you are assumed to mean the cos and the foo that are visible 
in the current environment.  If you had meant the one in fListA, you 
would have said so.

Duncan Murdoch

> 
> 
> Note that it's the same in the "explicit" and in the environment version.
> 
> -- Thomas P.
>


From cberry at tajo.ucsd.edu  Mon Jan 21 18:41:35 2008
From: cberry at tajo.ucsd.edu (Charles C. Berry)
Date: Mon, 21 Jan 2008 09:41:35 -0800
Subject: [Rd] Great tool
In-Reply-To: <971536df0801202019o5f5b63b4td2c58a1d3717c98e@mail.gmail.com>
References: <59d7961d0801202002l1cc15962xe6a2f623d52ccd05@mail.gmail.com>
	<971536df0801202019o5f5b63b4td2c58a1d3717c98e@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0801210936540.10823@tajo.ucsd.edu>

On Sun, 20 Jan 2008, Gabor Grothendieck wrote:

> I agree.  Its incredibly useful.

OK gentlemen, you have piqued my curiosity.

Can you give an example or two of situations you encountered in which a 
codetools function was so helpful?

Chuck


>
> On Jan 20, 2008 11:02 PM, Henrik Bengtsson <hb at stat.berkeley.edu> wrote:
>> Hi,
>>
>> I just have drop a note to say that the 'codetools' (and the part of R
>> CMD check that use it) is a pleasure to use and saves me from hours of
>> troubleshooting.  Each time it finds something I am amazed how
>> accurate it is.  Thanks to Luke T. and everyone else involved in
>> creating it.
>>
>> Cheers,
>>
>> Henrik
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Charles C. Berry                            (858) 534-2098
                                             Dept of Family/Preventive Medicine
E mailto:cberry at tajo.ucsd.edu	            UC San Diego
http://famprevmed.ucsd.edu/faculty/cberry/  La Jolla, San Diego 92093-0901


From ggrothendieck at gmail.com  Mon Jan 21 19:03:10 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 21 Jan 2008 13:03:10 -0500
Subject: [Rd] Great tool
In-Reply-To: <Pine.LNX.4.64.0801210936540.10823@tajo.ucsd.edu>
References: <59d7961d0801202002l1cc15962xe6a2f623d52ccd05@mail.gmail.com>
	<971536df0801202019o5f5b63b4td2c58a1d3717c98e@mail.gmail.com>
	<Pine.LNX.4.64.0801210936540.10823@tajo.ucsd.edu>
Message-ID: <971536df0801211003xfcb3004pff0cddfa31f83a85@mail.gmail.com>

Tracking down the free variables in a function when
reworking old code.

On Jan 21, 2008 12:41 PM, Charles C. Berry <cberry at tajo.ucsd.edu> wrote:
> On Sun, 20 Jan 2008, Gabor Grothendieck wrote:
>
> > I agree.  Its incredibly useful.
>
> OK gentlemen, you have piqued my curiosity.
>
> Can you give an example or two of situations you encountered in which a
> codetools function was so helpful?
>
> Chuck
>
>
>
> >
> > On Jan 20, 2008 11:02 PM, Henrik Bengtsson <hb at stat.berkeley.edu> wrote:
> >> Hi,
> >>
> >> I just have drop a note to say that the 'codetools' (and the part of R
> >> CMD check that use it) is a pleasure to use and saves me from hours of
> >> troubleshooting.  Each time it finds something I am amazed how
> >> accurate it is.  Thanks to Luke T. and everyone else involved in
> >> creating it.
> >>
> >> Cheers,
> >>
> >> Henrik
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>
> Charles C. Berry                            (858) 534-2098
>                                             Dept of Family/Preventive Medicine
> E mailto:cberry at tajo.ucsd.edu               UC San Diego
> http://famprevmed.ucsd.edu/faculty/cberry/  La Jolla, San Diego 92093-0901
>
>
>


From charlie at stat.umn.edu  Tue Jan 22 01:05:32 2008
From: charlie at stat.umn.edu (charlie at stat.umn.edu)
Date: Tue, 22 Jan 2008 01:05:32 +0100 (CET)
Subject: [Rd] gctorture and proc.time (PR#10600)
Message-ID: <20080122000532.E47302834619@mail.pubhealth.ku.dk>

In R version 2.6.1 (2007-11-26)
and R version 2.6.1 Patched (2008-01-19 r44061)
on openSUSE 10.2 (X86-64)

> gctorture()
> proc.time()
Error: protect(): protection stack overflow

The problem with this is that then

R CMD check --use-gct foo

ALWAYS FAILS with

> cat("Time elapsed: ", proc.time() - get("ptime", pos = 'CheckExEnv'),"\n")
Error in proc.time() - get("ptime", pos = "CheckExEnv") :
  non-numeric argument to binary operator

This does not happen in R version 2.4.1 (2006-12-18)

I was going to have my computing class try out --use-gct.
I guess not until this is fixed.

-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From mwkimpel at gmail.com  Tue Jan 22 04:25:47 2008
From: mwkimpel at gmail.com (Mark W Kimpel)
Date: Mon, 21 Jan 2008 22:25:47 -0500
Subject: [Rd] calling MPI parallel C code from R
Message-ID: <4795623B.5040103@gmail.com>

R developers:

I have some parallel C code, written with the MPI library, that I would 
like to call from R, but I get the error message below. 
cocite.mat.true.parallel.so compiles without complaint and I have MPI in 
my path, but R isn't recognizing one of the MPI symbols.

I have a feeling that this is going to be tricky, but I need to get this 
to work. Helpful suggestions? I'd be happy to share more of my R and C 
code if that is helpful, but I wanted to avoid a very long post at this 
point.

Thanks,
Mark

 > dyn.load(x = c.code, local = TRUE, now = TRUE)
Error in dyn.load(x = c.code, local = TRUE, now = TRUE) :
   unable to load shared library 
'/N/u/mkimpel/BigRed/my_C/R.shared.so/cocite.mat.true.parallel.so':
   /N/u/mkimpel/BigRed/my_C/R.shared.so/cocite.mat.true.parallel.so: 
undefined symbol: ompi_mpi_comm_world

 > sessionInfo()
R version 2.7.0 Under development (unstable) (2008-01-05 r43880)
powerpc64-unknown-linux-gnu

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base
 >
-- 

Mark W. Kimpel MD  ** Neuroinformatics ** Dept. of Psychiatry
Indiana University School of Medicine

15032 Hunter Court, Westfield, IN  46074

(317) 490-5129 Work, & Mobile & VoiceMail
(317) 204-4202 Home (no voice mail please)

mwkimpel<at>gmail<dot>com


From p.dalgaard at biostat.ku.dk  Tue Jan 22 08:56:29 2008
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 22 Jan 2008 08:56:29 +0100
Subject: [Rd] gctorture and proc.time (PR#10600)
In-Reply-To: <20080122000532.E47302834619@mail.pubhealth.ku.dk>
References: <20080122000532.E47302834619@mail.pubhealth.ku.dk>
Message-ID: <4795A1AD.1060008@biostat.ku.dk>

charlie at stat.umn.edu wrote:
> In R version 2.6.1 (2007-11-26)
> and R version 2.6.1 Patched (2008-01-19 r44061)
> on openSUSE 10.2 (X86-64)
>
>   
>> gctorture()
>> proc.time()
>>     
> Error: protect(): protection stack overflow
>
> The problem with this is that then
>
> R CMD check --use-gct foo
>
> ALWAYS FAILS with
>
>   
>> cat("Time elapsed: ", proc.time() - get("ptime", pos = 'CheckExEnv'),"\n")
>>     
> Error in proc.time() - get("ptime", pos = "CheckExEnv") :
>   non-numeric argument to binary operator
>
> This does not happen in R version 2.4.1 (2006-12-18)
>
> I was going to have my computing class try out --use-gct.
> I guess not until this is fixed.
>
>   
I can reproduce this on SUSE 10.2 64 bit and Fedora 7 64 bit, but not on 
SUSE 10.3 32 bit and Fedora 8 32 bit. (The OS versions are likely not 
relevant, I bet it is a 64 bit issue somewhere).
 

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From maechler at stat.math.ethz.ch  Tue Jan 22 09:20:15 2008
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Tue, 22 Jan 2008 09:20:15 +0100 (CET)
Subject: [Rd] gctorture and proc.time (PR#10600)
Message-ID: <20080122082015.0CA622834611@mail.pubhealth.ku.dk>

>>>>> "PD" == Peter Dalgaard <p.dalgaard at biostat.ku.dk>
>>>>>     on Tue, 22 Jan 2008 08:56:29 +0100 writes:

    PD> charlie at stat.umn.edu wrote:
    >> In R version 2.6.1 (2007-11-26)
    >> and R version 2.6.1 Patched (2008-01-19 r44061)
    >> on openSUSE 10.2 (X86-64)
    >> 
    >> 
    >>> gctorture()
    >>> proc.time()
    >>> 
    >> Error: protect(): protection stack overflow
    >> 
    >> The problem with this is that then
    >> 
    >> R CMD check --use-gct foo
    >> 
    >> ALWAYS FAILS with
    >> 
    >> 
    >>> cat("Time elapsed: ", proc.time() - get("ptime", pos = 'CheckExEnv'),"\n")
    >>> 
    >> Error in proc.time() - get("ptime", pos = "CheckExEnv") :
    >> non-numeric argument to binary operator
    >> 
    >> This does not happen in R version 2.4.1 (2006-12-18)
    >> 
    >> I was going to have my computing class try out --use-gct.
    >> I guess not until this is fixed.
    >> 
    >> 
    PD> I can reproduce this on SUSE 10.2 64 bit and Fedora 7 64 bit, but not on 
    PD> SUSE 10.3 32 bit and Fedora 8 32 bit. (The OS versions are likely not 
    PD> relevant, I bet it is a 64 bit issue somewhere).

    PD> -- 
    PD> O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
    PD> c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
    PD> (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
    PD> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907

I can confirm that:  64 bit is broken; 32 bit works  {Linux}

A bit embarrassing, given that quite a few R-corers have been using
more 64-bit than 32-bit in recent years.

Thanks a lot, Charlie for the report!
Martin


From milbo at sonic.net  Tue Jan 22 09:31:28 2008
From: milbo at sonic.net (Stephen Milborrow)
Date: Tue, 22 Jan 2008 10:31:28 +0200
Subject: [Rd] gctorture and proc.time (PR#10600)
References: <20080122000532.E47302834619@mail.pubhealth.ku.dk>
	<4795A1AD.1060008@biostat.ku.dk>
Message-ID: <003801c85cd1$6d409b50$6401a8c0@G3>

I'm not sure if this is connected but in R2.6.1 do_proctime is missing some
PROTECTs. The current code is

 SEXP ans = allocVector(REALSXP, 5), nm = allocVector(STRSXP, 5);

and should be

    SEXP ans, nm;
    PROTECT(ans = allocVector(REALSXP, 5));
    PROTECT(nm = allocVector(STRSXP, 5));

A good way of finding these missing PROTECTs is to write say 0xEE to memory
as it is freed (i.e. one must modify the source of memory.c). Then with gc
torture enabled it more obvious if  someone uses a just freed SEXP.  There
is a similar issue in a few other places which I haven't tracked down yet
which I will submit to r-bugs in due course.  These were found using the
0xEE trick and running make check-all.

Steve
www.milbo.users.sonic.net

----- Original Message ----- 
From: "Peter Dalgaard" <p.dalgaard at biostat.ku.dk>
To: <charlie at stat.umn.edu>
Cc: <R-bugs at biostat.ku.dk>; <r-devel at stat.math.ethz.ch>
Sent: Tuesday, January 22, 2008 9:56 AM
Subject: Re: [Rd] gctorture and proc.time (PR#10600)


charlie at stat.umn.edu wrote:
> In R version 2.6.1 (2007-11-26)
> and R version 2.6.1 Patched (2008-01-19 r44061)
> on openSUSE 10.2 (X86-64)
>
>
>> gctorture()
>> proc.time()
>>
> Error: protect(): protection stack overflow
>
> The problem with this is that then
>
> R CMD check --use-gct foo
>
> ALWAYS FAILS with
>
>
>> cat("Time elapsed: ", proc.time() - get("ptime", pos =
>> 'CheckExEnv'),"\n")
>>
> Error in proc.time() - get("ptime", pos = "CheckExEnv") :
>   non-numeric argument to binary operator
>
> This does not happen in R version 2.4.1 (2006-12-18)
>
> I was going to have my computing class try out --use-gct.
> I guess not until this is fixed.
>
>
I can reproduce this on SUSE 10.2 64 bit and Fedora 7 64 bit, but not on
SUSE 10.3 32 bit and Fedora 8 32 bit. (The OS versions are likely not
relevant, I bet it is a 64 bit issue somewhere).


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


__________ NOD32 2813 (20080122) Information __________

This message was checked by NOD32 antivirus system.
http://www.eset.com


From hin-tak.leung at cimr.cam.ac.uk  Wed Jan 23 03:01:00 2008
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Wed, 23 Jan 2008 02:01:00 +0000
Subject: [Rd] gctorture and proc.time (PR#10600)
In-Reply-To: <4795A1AD.1060008@biostat.ku.dk>
References: <20080122000532.E47302834619@mail.pubhealth.ku.dk>
	<4795A1AD.1060008@biostat.ku.dk>
Message-ID: <47969FDC.7050903@cimr.cam.ac.uk>

Peter Dalgaard wrote:
> charlie at stat.umn.edu wrote:
>> In R version 2.6.1 (2007-11-26)
>> and R version 2.6.1 Patched (2008-01-19 r44061)
>> on openSUSE 10.2 (X86-64)
>>
>>   
>>> gctorture()
>>> proc.time()
>>>     
>> Error: protect(): protection stack overflow
>>
>> The problem with this is that then
>>
>> R CMD check --use-gct foo
>>
>> ALWAYS FAILS with
>>
>>   
>>> cat("Time elapsed: ", proc.time() - get("ptime", pos = 'CheckExEnv'),"\n")
>>>     
>> Error in proc.time() - get("ptime", pos = "CheckExEnv") :
>>   non-numeric argument to binary operator
>>
>> This does not happen in R version 2.4.1 (2006-12-18)
>>
>> I was going to have my computing class try out --use-gct.
>> I guess not until this is fixed.
>>
>>   
> I can reproduce this on SUSE 10.2 64 bit and Fedora 7 64 bit, but not on 
> SUSE 10.3 32 bit and Fedora 8 32 bit. (The OS versions are likely not 
> relevant, I bet it is a 64 bit issue somewhere).

I can be a bit more precise - I have both 32-bit R and 64-bit R built 
and installed on fedora 8 64-bit, just one and same box.

32-bit R finishes quite quickly with:

 > proc.time()
    user  system elapsed
   0.772   0.032  10.147

64-bit R takes up 49s CPU time (from ps). This is long compared to 
either 10s (elapse) or 1s (user+sys). And it ends with:
Error: protect(): protection stack overflow

So yes, it looks like a 64-bit R specific bug.


From hin-tak.leung at cimr.cam.ac.uk  Wed Jan 23 03:05:29 2008
From: hin-tak.leung at cimr.cam.ac.uk (hin-tak.leung at cimr.cam.ac.uk)
Date: Wed, 23 Jan 2008 03:05:29 +0100 (CET)
Subject: [Rd] gctorture and proc.time (PR#10600)
Message-ID: <20080123020529.D47F12834156@mail.pubhealth.ku.dk>

Peter Dalgaard wrote:
> charlie at stat.umn.edu wrote:
>> In R version 2.6.1 (2007-11-26)
>> and R version 2.6.1 Patched (2008-01-19 r44061)
>> on openSUSE 10.2 (X86-64)
>>
>>   
>>> gctorture()
>>> proc.time()
>>>     
>> Error: protect(): protection stack overflow
>>
>> The problem with this is that then
>>
>> R CMD check --use-gct foo
>>
>> ALWAYS FAILS with
>>
>>   
>>> cat("Time elapsed: ", proc.time() - get("ptime", pos = 'CheckExEnv'),"\n")
>>>     
>> Error in proc.time() - get("ptime", pos = "CheckExEnv") :
>>   non-numeric argument to binary operator
>>
>> This does not happen in R version 2.4.1 (2006-12-18)
>>
>> I was going to have my computing class try out --use-gct.
>> I guess not until this is fixed.
>>
>>   
> I can reproduce this on SUSE 10.2 64 bit and Fedora 7 64 bit, but not on 
> SUSE 10.3 32 bit and Fedora 8 32 bit. (The OS versions are likely not 
> relevant, I bet it is a 64 bit issue somewhere).

I can be a bit more precise - I have both 32-bit R and 64-bit R built 
and installed on fedora 8 64-bit, just one and same box.

32-bit R finishes quite quickly with:

 > proc.time()
    user  system elapsed
   0.772   0.032  10.147

64-bit R takes up 49s CPU time (from ps). This is long compared to 
either 10s (elapse) or 1s (user+sys). And it ends with:
Error: protect(): protection stack overflow

So yes, it looks like a 64-bit R specific bug.


From zoubidoo at hotmail.com  Wed Jan 23 14:16:55 2008
From: zoubidoo at hotmail.com (Parker Jones)
Date: Thu, 24 Jan 2008 01:16:55 +1200
Subject: [Rd] R command to refresh graphical output?
Message-ID: <BAY103-W3459707EC9ACC215070CB1C03F0@phx.gbl>


Hello,

Is there are an R command to refresh the graphical output?

On a linux system I'm sending commands to R through a named pipe.   The R server is an infinite loop that listens on the pipe and executes received R code.  But I am having a problem refreshing the graphics output.  If I send a plot command down the pipe the graphical output appears.  However, if a window briefly obscures the graphical output, the x11 device won't refresh the display.  It would appear there is no refresh because R is busy interpreting infinite loop.

Is there a way of "manually" refreshing the display?  Or is there another way to get around the refresh problem?

Thanks in advance,
PJ




The R server:
# based on http://tolstoy.newcastle.edu.au/R/help/01c/2886.html
stream <- fifo("R_pipe", "r", blocking=FALSE,)
repeat
 {
  a <- readLines(stream)
  if(length(a) != 0)
   {
    if (inherits(e, "try-error"))
     {
      # error handling code here
      cat("Error", "\n")
     }
   }
 }


The R client:
$ mkfifo R_pipe
$ cat>> R_pipe
 
Now, I can send R commands down the pipe:
 
Client side:
x <- seq(1,10)
x
 
Server side:
> x <- seq(1:10)
> x
 [1]  1  2  3  4  5  6  7  8  9 10
 
So far so good.  Now send a plot, e.g. plot(1:100) and obscure the resulting plot so that it needs a refresh.  Voila, no refresh.


From johannes_graumann at web.de  Wed Jan 23 17:11:04 2008
From: johannes_graumann at web.de (Johannes Graumann)
Date: Wed, 23 Jan 2008 17:11:04 +0100
Subject: [Rd] Package Building and Name Space
Message-ID: <fn7ov3$2d6$1@ger.gmane.org>

... sorry for reposting this in a more appropriate forum than r.general ...

Hello,

I just don't get this and would appreciate if someone could write a line or
two: I'm trying to build this package and it stops installing after I add
the following to the NAMESPACES file:

>importFrom(gsubfn,strapply)

The error during the package test is:

Error in MyPackage::MyFunction :
  package 'MyPackage' has no name space and is not on the search path
Calls: <Anonymous> ... <Anonymous> -> switch -> sys.source -> eval ->
eval -> ::
Execution halted

'MyFunction' contains 'strapply' from gsubfn.

Please tell me where I err.

Thanks, Joh


From murdoch at stats.uwo.ca  Wed Jan 23 17:25:38 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 23 Jan 2008 11:25:38 -0500
Subject: [Rd] Package Building and Name Space
In-Reply-To: <fn7ov3$2d6$1@ger.gmane.org>
References: <fn7ov3$2d6$1@ger.gmane.org>
Message-ID: <47976A82.2060404@stats.uwo.ca>

On 1/23/2008 11:11 AM, Johannes Graumann wrote:
> ... sorry for reposting this in a more appropriate forum than r.general ...
> 
> Hello,
> 
> I just don't get this and would appreciate if someone could write a line or
> two: I'm trying to build this package and it stops installing after I add
> the following to the NAMESPACES file:
> 
>>importFrom(gsubfn,strapply)
> 
> The error during the package test is:
> 
> Error in MyPackage::MyFunction :
>   package 'MyPackage' has no name space and is not on the search path
> Calls: <Anonymous> ... <Anonymous> -> switch -> sys.source -> eval ->
> eval -> ::
> Execution halted
> 
> 'MyFunction' contains 'strapply' from gsubfn.
> 
> Please tell me where I err.

The file is called NAMESPACE, not NAMESPACES.

Duncan Murdoch


From murdoch at stats.uwo.ca  Wed Jan 23 18:24:15 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 23 Jan 2008 12:24:15 -0500
Subject: [Rd] Package Building and Name Space
In-Reply-To: <200801231731.00579.johannes_graumann@web.de>
References: <fn7ov3$2d6$1@ger.gmane.org> <47976A82.2060404@stats.uwo.ca>
	<200801231731.00579.johannes_graumann@web.de>
Message-ID: <4797783F.1020309@stats.uwo.ca>

On 1/23/2008 11:31 AM, Johannes Graumann wrote:
> On Wednesday 23 January 2008 17:25:38 Duncan Murdoch wrote:
>> On 1/23/2008 11:11 AM, Johannes Graumann wrote:
>> > ... sorry for reposting this in a more appropriate forum than r.general
>> > ...
>> >
>> > Hello,
>> >
>> > I just don't get this and would appreciate if someone could write a line
>> > or two: I'm trying to build this package and it stops installing after I
>> > add
>> >
>> > the following to the NAMESPACES file:
>> >>importFrom(gsubfn,strapply)
>> >
>> > The error during the package test is:
>> >
>> > Error in MyPackage::MyFunction :
>> >   package 'MyPackage' has no name space and is not on the search path
>> > Calls: <Anonymous> ... <Anonymous> -> switch -> sys.source -> eval ->
>> > eval -> ::
>> > Execution halted
>> >
>> > 'MyFunction' contains 'strapply' from gsubfn.
>> >
>> > Please tell me where I err.
>>
>> The file is called NAMESPACE, not NAMESPACES.
> 
> And that's what it's called here ... sorry for the typo above. The error 
> remains the same.

With the obscuring you've done it's pretty hard to be sure, but I'd 
assume you have the expression MyPackage::MyFunction somewhere in your 
package, but MyPackage doesn't have a namespace.  In that case, you have 
to make sure it is attached via

library(MyPackage)

or

require(MyPackage)

before you can use the "::" operator.

Duncan Murdoch


From goodrich at fas.harvard.edu  Wed Jan 23 19:45:22 2008
From: goodrich at fas.harvard.edu (goodrich at fas.harvard.edu)
Date: Wed, 23 Jan 2008 19:45:22 +0100 (CET)
Subject: [Rd] [wishlist,
	patch] Removing .bzr/ directory when calling R CMD build (PR#10625)
Message-ID: <20080123184522.41FB0283462B@mail.pubhealth.ku.dk>

Full_Name: Ben Goodrich
Version: 2.6.1
OS: Debian
Submission from: (NULL) (128.103.222.166)


bzr is another version control system and adds a .bzr folder to the top-level
directory of a package, similar to .svn and .git for subversion and git
respectively. However, while R CMD build removes directories called .svn, .git,
and some others, it does not remove .bzr . As a result, the .bzr folder is
unnecessarily included in the cleanly built package and there are accurate but
unnecessary warnings that say certain subdirectories of the .bzr directory are
empty. I believe the following patch, which is lightly tested with R-devel, is
sufficient to remove the .bzr folder and prevent these warnings. It does not,
however, remove the .bzrignore file (if it exists) but perhaps it should be
augmented to do so.

--- src/scripts/build.in        2008-01-23 11:42:47.000000000 -0500
+++ build.in    2008-01-23 11:45:02.000000000 -0500
@@ -215,6 +215,7 @@
        print EXCLUDE "$File::Find::name\n" if(-d $_ && /^\.svn$/);
        print EXCLUDE "$File::Find::name\n" if(-d $_ && /^\.arch-ids$/);
        print EXCLUDE "$File::Find::name\n" if(-d $_ && /^\.git$/);
+       print EXCLUDE "$File::Find::name\n" if(-d $_ && /^\.bzr$/);
        ## Windows DLL resource file
        push(@exclude_patterns, "^src/" . $pkgname . "_res\\.rc");
        my $filename = $File::Find::name;


From ggrothendieck at gmail.com  Wed Jan 23 20:21:01 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 23 Jan 2008 14:21:01 -0500
Subject: [Rd] [wishlist,
	patch] Removing .bzr/ directory when calling R CMD build (PR#10625)
In-Reply-To: <20080123184522.41FB0283462B@mail.pubhealth.ku.dk>
References: <20080123184522.41FB0283462B@mail.pubhealth.ku.dk>
Message-ID: <971536df0801231121u794f416cs92427b82e95c6a77@mail.gmail.com>

If you place an .Rbuildignore file in the top level of
your package with this line single line as its contents:

[.]bzr$

then the .bzr file will not be included.


On Jan 23, 2008 1:45 PM,  <goodrich at fas.harvard.edu> wrote:
> Full_Name: Ben Goodrich
> Version: 2.6.1
> OS: Debian
> Submission from: (NULL) (128.103.222.166)
>
>
> bzr is another version control system and adds a .bzr folder to the top-level
> directory of a package, similar to .svn and .git for subversion and git
> respectively. However, while R CMD build removes directories called .svn, .git,
> and some others, it does not remove .bzr . As a result, the .bzr folder is
> unnecessarily included in the cleanly built package and there are accurate but
> unnecessary warnings that say certain subdirectories of the .bzr directory are
> empty. I believe the following patch, which is lightly tested with R-devel, is
> sufficient to remove the .bzr folder and prevent these warnings. It does not,
> however, remove the .bzrignore file (if it exists) but perhaps it should be
> augmented to do so.
>
> --- src/scripts/build.in        2008-01-23 11:42:47.000000000 -0500
> +++ build.in    2008-01-23 11:45:02.000000000 -0500
> @@ -215,6 +215,7 @@
>        print EXCLUDE "$File::Find::name\n" if(-d $_ && /^\.svn$/);
>        print EXCLUDE "$File::Find::name\n" if(-d $_ && /^\.arch-ids$/);
>        print EXCLUDE "$File::Find::name\n" if(-d $_ && /^\.git$/);
> +       print EXCLUDE "$File::Find::name\n" if(-d $_ && /^\.bzr$/);
>        ## Windows DLL resource file
>        push(@exclude_patterns, "^src/" . $pkgname . "_res\\.rc");
>        my $filename = $File::Find::name;
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From goodrich at fas.harvard.edu  Wed Jan 23 20:23:38 2008
From: goodrich at fas.harvard.edu (Ben Goodrich)
Date: Wed, 23 Jan 2008 14:23:38 -0500
Subject: [Rd] [wishlist,
 patch] Removing .bzr/ directory when calling R CMD build (PR#10625)
In-Reply-To: <971536df0801231121u794f416cs92427b82e95c6a77@mail.gmail.com>
References: <20080123184522.41FB0283462B@mail.pubhealth.ku.dk>
	<971536df0801231121u794f416cs92427b82e95c6a77@mail.gmail.com>
Message-ID: <4797943A.3090407@fas.harvard.edu>

Gabor Grothendieck wrote:
> If you place an .Rbuildignore file in the top level of
> your package with this line single line as its contents:
> 
> [.]bzr$
> 
> then the .bzr file will not be included.

Thank you for the suggestion. In order to remove both the .bzr/
directory and the .bzrignore file, it seems to be necessary to specify

[.]bzr$
[.]bzrignore

in the .Rbuildignore file before calling R CMD build.

This is certainly sufficient in my case, but since the patch is just one
line, perhaps it should be considered for inclusion as well.

Ben


From goodrich at fas.harvard.edu  Wed Jan 23 20:35:24 2008
From: goodrich at fas.harvard.edu (goodrich at fas.harvard.edu)
Date: Wed, 23 Jan 2008 20:35:24 +0100 (CET)
Subject: [Rd] [wishlist,
	patch] Removing .bzr/ directory when calling (PR#10628)
Message-ID: <20080123193524.560ED283462D@mail.pubhealth.ku.dk>

Gabor Grothendieck wrote:
> If you place an .Rbuildignore file in the top level of
> your package with this line single line as its contents:
> 
> [.]bzr$
> 
> then the .bzr file will not be included.

Thank you for the suggestion. In order to remove both the .bzr/
directory and the .bzrignore file, it seems to be necessary to specify

[.]bzr$
[.]bzrignore

in the .Rbuildignore file before calling R CMD build.

This is certainly sufficient in my case, but since the patch is just one
line, perhaps it should be considered for inclusion as well.

Ben


From ggrothendieck at gmail.com  Wed Jan 23 20:39:19 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 23 Jan 2008 14:39:19 -0500
Subject: [Rd] [wishlist,
	patch] Removing .bzr/ directory when calling R CMD build (PR#10625)
In-Reply-To: <4797943A.3090407@fas.harvard.edu>
References: <20080123184522.41FB0283462B@mail.pubhealth.ku.dk>
	<971536df0801231121u794f416cs92427b82e95c6a77@mail.gmail.com>
	<4797943A.3090407@fas.harvard.edu>
Message-ID: <971536df0801231139j1aa9e826s4ff5054cc4bc16fc@mail.gmail.com>

On Jan 23, 2008 2:23 PM, Ben Goodrich <goodrich at fas.harvard.edu> wrote:
> Gabor Grothendieck wrote:
> > If you place an .Rbuildignore file in the top level of
> > your package with this line single line as its contents:
> >
> > [.]bzr$
> >
> > then the .bzr file will not be included.
>
> Thank you for the suggestion. In order to remove both the .bzr/
> directory and the .bzrignore file, it seems to be necessary to specify
>
> [.]bzr$
> [.]bzrignore

or perhaps

[.]bzr.*


From jmacdon at med.umich.edu  Wed Jan 23 20:56:21 2008
From: jmacdon at med.umich.edu (James W. MacDonald)
Date: Wed, 23 Jan 2008 14:56:21 -0500
Subject: [Rd] Package Building and Name Space
In-Reply-To: <47976A82.2060404@stats.uwo.ca>
References: <fn7ov3$2d6$1@ger.gmane.org> <47976A82.2060404@stats.uwo.ca>
Message-ID: <47979BE5.6020902@med.umich.edu>



Duncan Murdoch wrote:
> On 1/23/2008 11:11 AM, Johannes Graumann wrote:
>> ... sorry for reposting this in a more appropriate forum than r.general ...
>>
>> Hello,
>>
>> I just don't get this and would appreciate if someone could write a line or
>> two: I'm trying to build this package and it stops installing after I add
>> the following to the NAMESPACES file:
>>
>>> importFrom(gsubfn,strapply)
>> The error during the package test is:
>>
>> Error in MyPackage::MyFunction :
>>   package 'MyPackage' has no name space and is not on the search path
>> Calls: <Anonymous> ... <Anonymous> -> switch -> sys.source -> eval ->
>> eval -> ::
>> Execution halted
>>
>> 'MyFunction' contains 'strapply' from gsubfn.
>>
>> Please tell me where I err.
> 
> The file is called NAMESPACE, not NAMESPACES.

Plus gsubfn doesn't have a NAMESPACE, so I don't think this will work 
anyway.

Best,

Jim


-- 
James W. MacDonald, M.S.
Biostatistician
Affymetrix and cDNA Microarray Core
University of Michigan Cancer Center
1500 E. Medical Center Drive
7410 CCGC
Ann Arbor MI 48109
734-647-5623


From ripley at stats.ox.ac.uk  Wed Jan 23 23:17:06 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 23 Jan 2008 22:17:06 +0000 (GMT)
Subject: [Rd] gctorture and proc.time (PR#10600)
In-Reply-To: <47969FDC.7050903@cimr.cam.ac.uk>
References: <20080122000532.E47302834619@mail.pubhealth.ku.dk>
	<4795A1AD.1060008@biostat.ku.dk> <47969FDC.7050903@cimr.cam.ac.uk>
Message-ID: <alpine.LFD.1.00.0801232210150.7428@gannet.stats.ox.ac.uk>

Such things are normally easy to find with valgrind and an instrumented 
build of R (see 'Writing R Extensions'), and so was this.  Interestingly I 
got a different error immediately:

> gctorture(TRUE)
> proc.time()
Error: REAL() can only be applied to a 'numeric', not a 'character'

and setting a breakpoint on that message traced it back.

It was a missing PROTECT, and has now been fixed.

On Wed, 23 Jan 2008, Hin-Tak Leung wrote:

> Peter Dalgaard wrote:
>> charlie at stat.umn.edu wrote:
>>> In R version 2.6.1 (2007-11-26)
>>> and R version 2.6.1 Patched (2008-01-19 r44061)
>>> on openSUSE 10.2 (X86-64)
>>>
>>>
>>>> gctorture()
>>>> proc.time()
>>>>
>>> Error: protect(): protection stack overflow
>>>
>>> The problem with this is that then
>>>
>>> R CMD check --use-gct foo
>>>
>>> ALWAYS FAILS with
>>>
>>>
>>>> cat("Time elapsed: ", proc.time() - get("ptime", pos = 'CheckExEnv'),"\n")
>>>>
>>> Error in proc.time() - get("ptime", pos = "CheckExEnv") :
>>>   non-numeric argument to binary operator
>>>
>>> This does not happen in R version 2.4.1 (2006-12-18)
>>>
>>> I was going to have my computing class try out --use-gct.
>>> I guess not until this is fixed.
>>>
>>>
>> I can reproduce this on SUSE 10.2 64 bit and Fedora 7 64 bit, but not on
>> SUSE 10.3 32 bit and Fedora 8 32 bit. (The OS versions are likely not
>> relevant, I bet it is a 64 bit issue somewhere).
>
> I can be a bit more precise - I have both 32-bit R and 64-bit R built
> and installed on fedora 8 64-bit, just one and same box.
>
> 32-bit R finishes quite quickly with:
>
> > proc.time()
>    user  system elapsed
>   0.772   0.032  10.147
>
> 64-bit R takes up 49s CPU time (from ps). This is long compared to
> either 10s (elapse) or 1s (user+sys). And it ends with:
> Error: protect(): protection stack overflow
>
> So yes, it looks like a 64-bit R specific bug.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jfox at mcmaster.ca  Thu Jan 24 00:24:46 2008
From: jfox at mcmaster.ca (John Fox)
Date: Wed, 23 Jan 2008 18:24:46 -0500
Subject: [Rd] pseudo dataframes with RODBC
Message-ID: <000701c85e17$2444da50$6cce8ef0$@ca>

Dear R-devel list members,

For several years, I've maintained for my private use and for demonstrations
a set of functions [e.g., for indexing, with(), summary(), etc.] that employ
the RODBC package and a database to provide a "pseudo" data frame. Row
"indexes" can be specified as SQL queries. I know that the idea isn't
original, and I haven't done anything with these functions because I
expected that others would develop something better, but as near as I can
tell that hasn't happened yet. 

I wonder (1) whether there's sufficient interest to warrant building these
functions into a package, and (2) whether people with more knowledge of SQL
databases would be interested in improving and adding to what I've done. 

The functions can be found at
<http://socserv.mcmaster.ca/jfox/Courses/R-course/Fox-odbc-functions.R>.
I've tested them (at various times) only with PostgreSQL, MySQL, and
MS/Access under Windows, but I don't see why they shouldn't work generally.

Regards,
 John

--------------------------------
John Fox, Professor
Department of Sociology
McMaster University
Hamilton, Ontario, Canada L8S 4M4
905-525-9140x23604
http://socserv.mcmaster.ca/jfox


From timh at insightful.com  Thu Jan 24 01:44:06 2008
From: timh at insightful.com (Tim Hesterberg)
Date: Wed, 23 Jan 2008 16:44:06 -0800
Subject: [Rd] deprecate "freq" argument to hist
Message-ID: <u1w882gtl.fsf@insightful.com>

I request that the "freq" argument to hist be deprecated.

Reason:
One nice thing about SAS is is the consistency of certain inputs
across many PROCs.  In particular, they have "weight" and "freq"
statements.

We have added "weights" and "freq" to a number of functions in S-PLUS,
listed below.  I would like to see the same in R.

In porting the glmpath package to S-PLUS, we found one compatibility
issue - hist.default in R has an argument "freq", interpreted
to be !probability.  S-PLUS uses "freq" for frequencies in hist.

I request that the use of "freq" for !probability be deprecated,
to allow the argument to be used for frequencies in a future release.

Of the functions in R packages that are loaded by default, hist.default
is the only one I found with a "freq" argument.

--------------------------------------------------
These functions have both "weights" and "freq" arguments in S-PLUS:
hist
rowMeans rowSums rowVars
colMeans colSums colVars colQuantiles
cor, var, stdev
density
skewness, kurtosis
qqline
qqnorm.default
quantile

Some others have "weights" but not (yet) "freq", including
mean median ppoints tabulate.  Other functions like lm
have always had a weights argument.

--------------------------------------------------

Tim Hesterberg
Disclaimer - my own opinions, not Insightful's.


From p.murrell at auckland.ac.nz  Thu Jan 24 03:38:25 2008
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Thu, 24 Jan 2008 15:38:25 +1300
Subject: [Rd] seekViewport error
In-Reply-To: <971536df0712261026w6bdebe49re08ed45e28af8873@mail.gmail.com>
References: <971536df0712261026w6bdebe49re08ed45e28af8873@mail.gmail.com>
Message-ID: <4797FA21.3090700@stat.auckland.ac.nz>

Hi


Gabor Grothendieck wrote:
> Why does the seekViewport at the bottom give an error?


Because the viewport is popped after GRID.cellGrob.84 is drawn.

grid.ls() shows the viewport because it recurses down into the legend 
frame grob.  Compare your output with (grid-generated numbering differs) 
  ...

 > grid.ls(recurs=FALSE, view=TRUE)
ROOT
   GRID.rect.28
   plot1.toplevel.vp
     plot1.xlab.vp
       plot1.xlab
       1
     plot1.ylab.vp
       plot1.ylab
       1
     plot1.strip.1.1.off.vp
       GRID.segments.29
       1
     plot1.strip.left.1.1.off.vp
       GRID.segments.30
       GRID.text.31
       1
     plot1.panel.1.1.off.vp
       GRID.segments.32
       GRID.text.33
       GRID.segments.34
       1
     plot1.panel.1.1.vp
       GRID.points.35
       GRID.points.36
       GRID.points.37
       1
     plot1.panel.1.1.off.vp
       GRID.rect.38
       1
     plot1.legend.top.vp
       GRID.frame.9
       1
     plot1.
       1
     1

If you look at what viewports are actually available, via 
current.vpTree(), you'll see that GRID.VP.24 is not there.

The problem (see also 
https://stat.ethz.ch/pipermail/r-help/2008-January/151655.html) is that 
cellGrobs (children of frame grobs) use their 'vp' component to store 
the viewport that positions them within the parent frame.  This means 
that the viewport is pushed and then popped (as per normal behaviour for 
'vp' components).

A possible solution that I am currently trialling uses a special 
'cellvp' slot instead so that the cellGrob viewports are pushed and then 
"upped".  That way they remain available after the cellGrob has drawn, 
so you can downViewport() to them.

The disadvantage of this approach is that the viewports no longer appear 
in the grid.ls() listing (because grid.ls() has no way of knowing about 
special components of grobs that contain viewports).  This effect can 
already be seen by the fact that the viewport for the frame grob 
(GRID.frame.70) is not shown in the grid.ls() output.  On the other 
hand, the viewports will be visible via current.vpTree()  ...

 > current.vpTree()
viewport[ROOT]->(viewport[GRID.VP.1], 
viewport[plot1.toplevel.vp]->(viewport[plot1.], 
viewport[plot1.legend.top.vp]->(viewport[GRID.VP.1]->(viewport[GRID.VP.2], 
viewport[GRID.VP.3], viewport[GRID.VP.4], viewport[GRID.VP.5], 
viewport[GRID.VP.6], viewport[GRID.VP.7], viewport[GRID.VP.8])), 
viewport[plot1.panel.1.1.off.vp], viewport[plot1.panel.1.1.vp], 
viewport[plot1.strip.1.1.off.vp], viewport[plot1.strip.left.1.1.off.vp], 
viewport[plot1.xlab.vp], viewport[plot1.ylab.vp]))

... (in the output above, the grid-generated viewport numbers differ, 
but you can see the idea;  I think GRID.VP.8 corresponds to your GRID.VP.24)

Paul


>> xyplot(Sepal.Length ~ Sepal.Width, iris, group = Species, col = 11:13,
> +   auto.key = TRUE)
>> grid.ls(view = TRUE)
> ROOT
>   GRID.rect.89
>   plot1.toplevel.vp
>     plot1.xlab.vp
>       plot1.xlab
>       1
>     plot1.ylab.vp
>       plot1.ylab
>       1
>     plot1.strip.1.1.off.vp
>       GRID.segments.90
>       1
>     plot1.strip.left.1.1.off.vp
>       GRID.segments.91
>       GRID.text.92
>       1
>     plot1.panel.1.1.off.vp
>       GRID.segments.93
>       GRID.text.94
>       GRID.segments.95
>       1
>     plot1.panel.1.1.vp
>       GRID.points.96
>       GRID.points.97
>       GRID.points.98
>       1
>     plot1.panel.1.1.off.vp
>       GRID.rect.99
>       1
>     plot1.legend.top.vp
>       GRID.frame.70
>         GRID.VP.18
>           GRID.cellGrob.72
>             GRID.rect.71
>           1
>         GRID.VP.19
>           GRID.cellGrob.74
>             GRID.text.73
>           1
>         GRID.VP.20
>           GRID.cellGrob.76GRID.cellGrob.84
>             GRID.text.75
>           1
>         GRID.VP.21
>           GRID.cellGrob.78
>             GRID.text.77
>           1
>         GRID.VP.22
>           GRID.cellGrob.80
>             GRID.points.79
>           1
>         GRID.VP.23
>           GRID.cellGrob.82
>             GRID.points.81
>           1
>         GRID.VP.24
>           GRID.cellGrob.84
>             GRID.points.83
>           1
>       1
>     plot1.
>       1
>     1
>> seekViewport("GRID.VP.24")
> Error in downViewport.vpPath(vpPathDirect(name), strict, recording =
> recording) :
>   Viewport 'GRID.VP.24' was not found
> 
>> R.version.string # Vista
> [1] "R version 2.6.1 Patched (2007-12-06 r43610)"
>> packageDescription("grid")$Version
> [1] "2.6.1"
>> packageDescription("lattice")$Version
> [1] "0.17-2"
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From ggrothendieck at gmail.com  Thu Jan 24 04:22:45 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 23 Jan 2008 22:22:45 -0500
Subject: [Rd] seekViewport error
In-Reply-To: <4797FA21.3090700@stat.auckland.ac.nz>
References: <971536df0712261026w6bdebe49re08ed45e28af8873@mail.gmail.com>
	<4797FA21.3090700@stat.auckland.ac.nz>
Message-ID: <971536df0801231922w17c7f94fr9fdc6d9a46a8853d@mail.gmail.com>

On Jan 23, 2008 9:38 PM, Paul Murrell <p.murrell at auckland.ac.nz> wrote:
> Hi
>
>
> Gabor Grothendieck wrote:
> > Why does the seekViewport at the bottom give an error?
>
>
> Because the viewport is popped after GRID.cellGrob.84 is drawn.
>
> grid.ls() shows the viewport because it recurses down into the legend
> frame grob.  Compare your output with (grid-generated numbering differs)
>  ...
>
>  > grid.ls(recurs=FALSE, view=TRUE)
> ROOT
>   GRID.rect.28
>   plot1.toplevel.vp
>     plot1.xlab.vp
>       plot1.xlab
>       1
>     plot1.ylab.vp
>       plot1.ylab
>       1
>     plot1.strip.1.1.off.vp
>       GRID.segments.29
>       1
>     plot1.strip.left.1.1.off.vp
>       GRID.segments.30
>       GRID.text.31
>       1
>     plot1.panel.1.1.off.vp
>       GRID.segments.32
>       GRID.text.33
>       GRID.segments.34
>       1
>     plot1.panel.1.1.vp
>       GRID.points.35
>       GRID.points.36
>       GRID.points.37
>       1
>     plot1.panel.1.1.off.vp
>       GRID.rect.38
>       1
>     plot1.legend.top.vp
>       GRID.frame.9
>       1
>     plot1.
>       1
>     1
>
> If you look at what viewports are actually available, via
> current.vpTree(), you'll see that GRID.VP.24 is not there.
>
> The problem (see also
> https://stat.ethz.ch/pipermail/r-help/2008-January/151655.html) is that
> cellGrobs (children of frame grobs) use their 'vp' component to store
> the viewport that positions them within the parent frame.  This means
> that the viewport is pushed and then popped (as per normal behaviour for
> 'vp' components).
>
> A possible solution that I am currently trialling uses a special
> 'cellvp' slot instead so that the cellGrob viewports are pushed and then
> "upped".  That way they remain available after the cellGrob has drawn,
> so you can downViewport() to them.
>
> The disadvantage of this approach is that the viewports no longer appear
> in the grid.ls() listing (because grid.ls() has no way of knowing about
> special components of grobs that contain viewports).  This effect can
> already be seen by the fact that the viewport for the frame grob
> (GRID.frame.70) is not shown in the grid.ls() output.  On the other
> hand, the viewports will be visible via current.vpTree()  ...

Perhaps some convention could be adopted which, if followed, would
let grid.ls know?  If that worked at least for graphics generated from
lattice and ggplot2 that would likely satisfy a significant percentage
of uses.


From h.wickham at gmail.com  Thu Jan 24 04:42:45 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Wed, 23 Jan 2008 22:42:45 -0500
Subject: [Rd] seekViewport error
In-Reply-To: <4797FA21.3090700@stat.auckland.ac.nz>
References: <971536df0712261026w6bdebe49re08ed45e28af8873@mail.gmail.com>
	<4797FA21.3090700@stat.auckland.ac.nz>
Message-ID: <f8e6ff050801231942j7cfc2925xdf12c302ce17bed9@mail.gmail.com>

> The problem (see also
> https://stat.ethz.ch/pipermail/r-help/2008-January/151655.html) is that
> cellGrobs (children of frame grobs) use their 'vp' component to store
> the viewport that positions them within the parent frame.  This means
> that the viewport is pushed and then popped (as per normal behaviour for
> 'vp' components).

Why ever 'pop' and not 'up'?  It seems like you would (almost) always
want to leave the viewport around so that others can modify more
easily.  Is it a performance consideration?

Hadley


-- 
http://had.co.nz/


From johannes_graumann at web.de  Wed Jan 23 17:31:00 2008
From: johannes_graumann at web.de (Johannes Graumann)
Date: Wed, 23 Jan 2008 17:31:00 +0100
Subject: [Rd] Package Building and Name Space
In-Reply-To: <47976A82.2060404@stats.uwo.ca>
References: <fn7ov3$2d6$1@ger.gmane.org> <47976A82.2060404@stats.uwo.ca>
Message-ID: <200801231731.00579.johannes_graumann@web.de>

On Wednesday 23 January 2008 17:25:38 Duncan Murdoch wrote:
> On 1/23/2008 11:11 AM, Johannes Graumann wrote:
> > ... sorry for reposting this in a more appropriate forum than r.general
> > ...
> >
> > Hello,
> >
> > I just don't get this and would appreciate if someone could write a line
> > or two: I'm trying to build this package and it stops installing after I
> > add
> >
> > the following to the NAMESPACES file:
> >>importFrom(gsubfn,strapply)
> >
> > The error during the package test is:
> >
> > Error in MyPackage::MyFunction :
> >   package 'MyPackage' has no name space and is not on the search path
> > Calls: <Anonymous> ... <Anonymous> -> switch -> sys.source -> eval ->
> > eval -> ::
> > Execution halted
> >
> > 'MyFunction' contains 'strapply' from gsubfn.
> >
> > Please tell me where I err.
>
> The file is called NAMESPACE, not NAMESPACES.

And that's what it's called here ... sorry for the typo above. The error 
remains the same.

Joh

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 827 bytes
Desc: This is a digitally signed message part.
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20080123/7bd35afb/attachment.bin 

From johannes_graumann at web.de  Wed Jan 23 19:07:57 2008
From: johannes_graumann at web.de (Johannes Graumann)
Date: Wed, 23 Jan 2008 19:07:57 +0100
Subject: [Rd] Package Building and Name Space
In-Reply-To: <4797783F.1020309@stats.uwo.ca>
References: <fn7ov3$2d6$1@ger.gmane.org>
	<200801231731.00579.johannes_graumann@web.de>
	<4797783F.1020309@stats.uwo.ca>
Message-ID: <200801231907.57881.johannes_graumann@web.de>

On Wednesday 23 January 2008 18:24:15 Duncan Murdoch wrote:
> On 1/23/2008 11:31 AM, Johannes Graumann wrote:
> > On Wednesday 23 January 2008 17:25:38 Duncan Murdoch wrote:
> >> On 1/23/2008 11:11 AM, Johannes Graumann wrote:
> >> > ... sorry for reposting this in a more appropriate forum than
> >> > r.general ...
> >> >
> >> > Hello,
> >> >
> >> > I just don't get this and would appreciate if someone could write a
> >> > line or two: I'm trying to build this package and it stops installing
> >> > after I add
> >> >
> >> > the following to the NAMESPACES file:
> >> >>importFrom(gsubfn,strapply)
> >> >
> >> > The error during the package test is:
> >> >
> >> > Error in MyPackage::MyFunction :
> >> >   package 'MyPackage' has no name space and is not on the search path
> >> > Calls: <Anonymous> ... <Anonymous> -> switch -> sys.source -> eval ->
> >> > eval -> ::
> >> > Execution halted
> >> >
> >> > 'MyFunction' contains 'strapply' from gsubfn.
> >> >
> >> > Please tell me where I err.
> >>
> >> The file is called NAMESPACE, not NAMESPACES.
> >
> > And that's what it's called here ... sorry for the typo above. The error
> > remains the same.
>
> With the obscuring you've done it's pretty hard to be sure, but I'd
> assume you have the expression MyPackage::MyFunction somewhere in your
> package, but MyPackage doesn't have a namespace.  In that case, you have
> to make sure it is attached via
>
> library(MyPackage)
>
> or
>
> require(MyPackage)
>
> before you can use the "::" operator.

But it's "mypackage" I'm trying to check ... can't attach that yet since I 
need to package and install it first ...

Joh
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 827 bytes
Desc: This is a digitally signed message part.
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20080123/681deb84/attachment.bin 

From mtmorgan at fhcrc.org  Thu Jan 24 14:47:00 2008
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Thu, 24 Jan 2008 05:47:00 -0800
Subject: [Rd] Package Building and Name Space
In-Reply-To: <200801231907.57881.johannes_graumann@web.de> (Johannes
	Graumann's message of "Wed, 23 Jan 2008 19:07:57 +0100")
References: <fn7ov3$2d6$1@ger.gmane.org>
	<200801231731.00579.johannes_graumann@web.de>
	<4797783F.1020309@stats.uwo.ca>
	<200801231907.57881.johannes_graumann@web.de>
Message-ID: <6phbq7b2v57.fsf@gopher4.fhcrc.org>

Hi Joh --

I guess you have something like

f <- function() {}

MyPackage::f()

If you replace that with

f <- function() {}

.onLoad <- function(libname, pkgname) {
    MyPackage::f()
}

I think you'll be fine. The problem is, as the message says, at the
time of evaluation with your current scheme MyPackage is not on the
search path (has not yet been loaded); the message about no name space
is a bit spurious, since of course something that can not yet be found
cannot have a name space. From ?.onLoad, .onLoad finds the name space
even though the package is not on the search path.

Hope that helps,

Martin

Johannes Graumann <johannes_graumann at web.de> writes:

> On Wednesday 23 January 2008 18:24:15 Duncan Murdoch wrote:
>> On 1/23/2008 11:31 AM, Johannes Graumann wrote:
>> > On Wednesday 23 January 2008 17:25:38 Duncan Murdoch wrote:
>> >> On 1/23/2008 11:11 AM, Johannes Graumann wrote:
>> >> > ... sorry for reposting this in a more appropriate forum than
>> >> > r.general ...
>> >> >
>> >> > Hello,
>> >> >
>> >> > I just don't get this and would appreciate if someone could write a
>> >> > line or two: I'm trying to build this package and it stops installing
>> >> > after I add
>> >> >
>> >> > the following to the NAMESPACES file:
>> >> >>importFrom(gsubfn,strapply)
>> >> >
>> >> > The error during the package test is:
>> >> >
>> >> > Error in MyPackage::MyFunction :
>> >> >   package 'MyPackage' has no name space and is not on the search path
>> >> > Calls: <Anonymous> ... <Anonymous> -> switch -> sys.source -> eval ->
>> >> > eval -> ::
>> >> > Execution halted
>> >> >
>> >> > 'MyFunction' contains 'strapply' from gsubfn.
>> >> >
>> >> > Please tell me where I err.
>> >>
>> >> The file is called NAMESPACE, not NAMESPACES.
>> >
>> > And that's what it's called here ... sorry for the typo above. The error
>> > remains the same.
>>
>> With the obscuring you've done it's pretty hard to be sure, but I'd
>> assume you have the expression MyPackage::MyFunction somewhere in your
>> package, but MyPackage doesn't have a namespace.  In that case, you have
>> to make sure it is attached via
>>
>> library(MyPackage)
>>
>> or
>>
>> require(MyPackage)
>>
>> before you can use the "::" operator.
>
> But it's "mypackage" I'm trying to check ... can't attach that yet since I 
> need to package and install it first ...
>
> Joh
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin Morgan
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M2 B169
Phone: (206) 667-2793


From pgilbert at bank-banque-canada.ca  Thu Jan 24 16:00:58 2008
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Thu, 24 Jan 2008 10:00:58 -0500
Subject: [Rd] Package Building and Name Space
In-Reply-To: <200801231907.57881.johannes_graumann@web.de>
References: <fn7ov3$2d6$1@ger.gmane.org>	<200801231731.00579.johannes_graumann@web.de>	<4797783F.1020309@stats.uwo.ca>
	<200801231907.57881.johannes_graumann@web.de>
Message-ID: <4798A82A.7020003@bank-banque-canada.ca>

I find the error message

 >>>>>Error in MyPackage::MyFunction :

is a bit misleading.  Could it be changed to

     Error in Package::Function

perhaps with a hint: "Possibly Package is not exporting a NAMESPACE."
(At least, I think this does not work unless Package has a namespace.)

Paul Gilbert

Johannes Graumann wrote:
> On Wednesday 23 January 2008 18:24:15 Duncan Murdoch wrote:
> 
>>On 1/23/2008 11:31 AM, Johannes Graumann wrote:
>>
>>>On Wednesday 23 January 2008 17:25:38 Duncan Murdoch wrote:
>>>
>>>>On 1/23/2008 11:11 AM, Johannes Graumann wrote:
>>>>
>>>>>... sorry for reposting this in a more appropriate forum than
>>>>>r.general ...
>>>>>
>>>>>Hello,
>>>>>
>>>>>I just don't get this and would appreciate if someone could write a
>>>>>line or two: I'm trying to build this package and it stops installing
>>>>>after I add
>>>>>
>>>>>the following to the NAMESPACES file:
>>>>>
>>>>>>importFrom(gsubfn,strapply)
>>>>>
>>>>>The error during the package test is:
>>>>>
>>>>>Error in MyPackage::MyFunction :
>>>>>  package 'MyPackage' has no name space and is not on the search path
>>>>>Calls: <Anonymous> ... <Anonymous> -> switch -> sys.source -> eval ->
>>>>>eval -> ::
>>>>>Execution halted
>>>>>
>>>>>'MyFunction' contains 'strapply' from gsubfn.
>>>>>
>>>>>Please tell me where I err.
>>>>
>>>>The file is called NAMESPACE, not NAMESPACES.
>>>
>>>And that's what it's called here ... sorry for the typo above. The error
>>>remains the same.
>>
>>With the obscuring you've done it's pretty hard to be sure, but I'd
>>assume you have the expression MyPackage::MyFunction somewhere in your
>>package, but MyPackage doesn't have a namespace.  In that case, you have
>>to make sure it is attached via
>>
>>library(MyPackage)
>>
>>or
>>
>>require(MyPackage)
>>
>>before you can use the "::" operator.
> 
> 
> But it's "mypackage" I'm trying to check ... can't attach that yet since I 
> need to package and install it first ...
> 
> Joh
> 
> 
> ------------------------------------------------------------------------
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential information, and the Bank of
Canada does not waive any related rights. Any distribution, use, or copying of this
email or the information it contains by other than the intended recipient is
unauthorized. If you received this email in error please delete it immediately from
your system and notify the sender promptly by email that you have done so. 

------------------------------------------------------------------------------------

Le pr?sent courriel peut contenir de l'information privil?gi?e ou confidentielle.
La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute diffusion,
utilisation ou copie de ce courriel ou des renseignements qu'il contient par une
personne autre que le ou les destinataires d?sign?s est interdite. Si vous recevez
ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer sans d?lai ?
l'exp?diteur un message ?lectronique pour l'aviser que vous avez ?limin? de votre
ordinateur toute copie du courriel re?u.

From murdoch at stats.uwo.ca  Thu Jan 24 16:25:54 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 24 Jan 2008 10:25:54 -0500
Subject: [Rd] Package Building and Name Space
In-Reply-To: <4798A82A.7020003@bank-banque-canada.ca>
References: <fn7ov3$2d6$1@ger.gmane.org>	<200801231731.00579.johannes_graumann@web.de>	<4797783F.1020309@stats.uwo.ca>	<200801231907.57881.johannes_graumann@web.de>
	<4798A82A.7020003@bank-banque-canada.ca>
Message-ID: <4798AE02.4020103@stats.uwo.ca>

On 1/24/2008 10:00 AM, Paul Gilbert wrote:
> I find the error message
> 
>  >>>>>Error in MyPackage::MyFunction :
> 
> is a bit misleading.  Could it be changed to
> 
>      Error in Package::Function

I believe "MyPackage" was either the actual name of the package, or what 
Johannes substituted for it.  But this whole thread would be a lot 
clearer if we had an actual reproducible example to look at, rather than 
a report of it that includes typos and substitutions.

> perhaps with a hint: "Possibly Package is not exporting a NAMESPACE."
> (At least, I think this does not work unless Package has a namespace.)

The message looked pretty clear to me, and agrees with the 
documentation.  For "::" to work, the package needs a namespace OR must 
be on the search path.  Apparently neither of those was true in this case.

Duncan Murdoch

> 
> Paul Gilbert
> 
> Johannes Graumann wrote:
>> On Wednesday 23 January 2008 18:24:15 Duncan Murdoch wrote:
>> 
>>>On 1/23/2008 11:31 AM, Johannes Graumann wrote:
>>>
>>>>On Wednesday 23 January 2008 17:25:38 Duncan Murdoch wrote:
>>>>
>>>>>On 1/23/2008 11:11 AM, Johannes Graumann wrote:
>>>>>
>>>>>>... sorry for reposting this in a more appropriate forum than
>>>>>>r.general ...
>>>>>>
>>>>>>Hello,
>>>>>>
>>>>>>I just don't get this and would appreciate if someone could write a
>>>>>>line or two: I'm trying to build this package and it stops installing
>>>>>>after I add
>>>>>>
>>>>>>the following to the NAMESPACES file:
>>>>>>
>>>>>>>importFrom(gsubfn,strapply)
>>>>>>
>>>>>>The error during the package test is:
>>>>>>
>>>>>>Error in MyPackage::MyFunction :
>>>>>>  package 'MyPackage' has no name space and is not on the search path
>>>>>>Calls: <Anonymous> ... <Anonymous> -> switch -> sys.source -> eval ->
>>>>>>eval -> ::
>>>>>>Execution halted
>>>>>>
>>>>>>'MyFunction' contains 'strapply' from gsubfn.
>>>>>>
>>>>>>Please tell me where I err.
>>>>>
>>>>>The file is called NAMESPACE, not NAMESPACES.
>>>>
>>>>And that's what it's called here ... sorry for the typo above. The error
>>>>remains the same.
>>>
>>>With the obscuring you've done it's pretty hard to be sure, but I'd
>>>assume you have the expression MyPackage::MyFunction somewhere in your
>>>package, but MyPackage doesn't have a namespace.  In that case, you have
>>>to make sure it is attached via
>>>
>>>library(MyPackage)
>>>
>>>or
>>>
>>>require(MyPackage)
>>>
>>>before you can use the "::" operator.
>> 
>> 
>> But it's "mypackage" I'm trying to check ... can't attach that yet since I 
>> need to package and install it first ...
>> 
>> Joh
>> 
>> 
>> ------------------------------------------------------------------------
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> ====================================================================================
> 
> La version fran?aise suit le texte anglais.
> 
> ------------------------------------------------------------------------------------
> 
> This email may contain privileged and/or confidential information, and the Bank of
> Canada does not waive any related rights. Any distribution, use, or copying of this
> email or the information it contains by other than the intended recipient is
> unauthorized. If you received this email in error please delete it immediately from
> your system and notify the sender promptly by email that you have done so. 
> 
> ------------------------------------------------------------------------------------
> 
> Le pr?sent courriel peut contenir de l'information privil?gi?e ou confidentielle.
> La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute diffusion,
> utilisation ou copie de ce courriel ou des renseignements qu'il contient par une
> personne autre que le ou les destinataires d?sign?s est interdite. Si vous recevez
> ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer sans d?lai ?
> l'exp?diteur un message ?lectronique pour l'aviser que vous avez ?limin? de votre
> ordinateur toute copie du courriel re?u.
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From pgilbert at bank-banque-canada.ca  Thu Jan 24 16:44:40 2008
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Thu, 24 Jan 2008 10:44:40 -0500
Subject: [Rd] Package Building and Name Space
In-Reply-To: <4798AE02.4020103@stats.uwo.ca>
References: <fn7ov3$2d6$1@ger.gmane.org>	<200801231731.00579.johannes_graumann@web.de>	<4797783F.1020309@stats.uwo.ca>	<200801231907.57881.johannes_graumann@web.de>
	<4798A82A.7020003@bank-banque-canada.ca>
	<4798AE02.4020103@stats.uwo.ca>
Message-ID: <4798B268.2080202@bank-banque-canada.ca>

Sorry, once again I was totally confused.

Paul

Duncan Murdoch wrote:
> On 1/24/2008 10:00 AM, Paul Gilbert wrote:
> 
>> I find the error message
>>
>>  >>>>>Error in MyPackage::MyFunction :
>>
>> is a bit misleading.  Could it be changed to
>>
>>      Error in Package::Function
> 
> 
> I believe "MyPackage" was either the actual name of the package, or what 
> Johannes substituted for it.  But this whole thread would be a lot 
> clearer if we had an actual reproducible example to look at, rather than 
> a report of it that includes typos and substitutions.
> 
>> perhaps with a hint: "Possibly Package is not exporting a NAMESPACE."
>> (At least, I think this does not work unless Package has a namespace.)
> 
> 
> The message looked pretty clear to me, and agrees with the 
> documentation.  For "::" to work, the package needs a namespace OR must 
> be on the search path.  Apparently neither of those was true in this case.
> 
> Duncan Murdoch
> 
>>
>> Paul Gilbert
>>
>> Johannes Graumann wrote:
>>
>>> On Wednesday 23 January 2008 18:24:15 Duncan Murdoch wrote:
>>>
>>>> On 1/23/2008 11:31 AM, Johannes Graumann wrote:
>>>>
>>>>> On Wednesday 23 January 2008 17:25:38 Duncan Murdoch wrote:
>>>>>
>>>>>> On 1/23/2008 11:11 AM, Johannes Graumann wrote:
>>>>>>
>>>>>>> ... sorry for reposting this in a more appropriate forum than
>>>>>>> r.general ...
>>>>>>>
>>>>>>> Hello,
>>>>>>>
>>>>>>> I just don't get this and would appreciate if someone could write a
>>>>>>> line or two: I'm trying to build this package and it stops 
>>>>>>> installing
>>>>>>> after I add
>>>>>>>
>>>>>>> the following to the NAMESPACES file:
>>>>>>>
>>>>>>>> importFrom(gsubfn,strapply)
>>>>>>>
>>>>>>>
>>>>>>> The error during the package test is:
>>>>>>>
>>>>>>> Error in MyPackage::MyFunction :
>>>>>>>  package 'MyPackage' has no name space and is not on the search path
>>>>>>> Calls: <Anonymous> ... <Anonymous> -> switch -> sys.source -> 
>>>>>>> eval ->
>>>>>>> eval -> ::
>>>>>>> Execution halted
>>>>>>>
>>>>>>> 'MyFunction' contains 'strapply' from gsubfn.
>>>>>>>
>>>>>>> Please tell me where I err.
>>>>>>
>>>>>>
>>>>>> The file is called NAMESPACE, not NAMESPACES.
>>>>>
>>>>>
>>>>> And that's what it's called here ... sorry for the typo above. The 
>>>>> error
>>>>> remains the same.
>>>>
>>>>
>>>> With the obscuring you've done it's pretty hard to be sure, but I'd
>>>> assume you have the expression MyPackage::MyFunction somewhere in your
>>>> package, but MyPackage doesn't have a namespace.  In that case, you 
>>>> have
>>>> to make sure it is attached via
>>>>
>>>> library(MyPackage)
>>>>
>>>> or
>>>>
>>>> require(MyPackage)
>>>>
>>>> before you can use the "::" operator.
>>>
>>>
>>>
>>> But it's "mypackage" I'm trying to check ... can't attach that yet 
>>> since I need to package and install it first ...
>>>
>>> Joh
>>>
>>>
>>> ------------------------------------------------------------------------
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>> ==================================================================================== 
>>
>>
>> La version fran?aise suit le texte anglais.
>>
>> ------------------------------------------------------------------------------------ 
>>
>>
>> This email may contain privileged and/or confidential information, and 
>> the Bank of
>> Canada does not waive any related rights. Any distribution, use, or 
>> copying of this
>> email or the information it contains by other than the intended 
>> recipient is
>> unauthorized. If you received this email in error please delete it 
>> immediately from
>> your system and notify the sender promptly by email that you have done 
>> so.
>> ------------------------------------------------------------------------------------ 
>>
>>
>> Le pr?sent courriel peut contenir de l'information privil?gi?e ou 
>> confidentielle.
>> La Banque du Canada ne renonce pas aux droits qui s'y rapportent. 
>> Toute diffusion,
>> utilisation ou copie de ce courriel ou des renseignements qu'il 
>> contient par une
>> personne autre que le ou les destinataires d?sign?s est interdite. Si 
>> vous recevez
>> ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer 
>> sans d?lai ?
>> l'exp?diteur un message ?lectronique pour l'aviser que vous avez 
>> ?limin? de votre
>> ordinateur toute copie du courriel re?u.
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential information, and the Bank of
Canada does not waive any related rights. Any distribution, use, or copying of this
email or the information it contains by other than the intended recipient is
unauthorized. If you received this email in error please delete it immediately from
your system and notify the sender promptly by email that you have done so. 

------------------------------------------------------------------------------------

Le pr?sent courriel peut contenir de l'information privil?gi?e ou confidentielle.
La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute diffusion,
utilisation ou copie de ce courriel ou des renseignements qu'il contient par une
personne autre que le ou les destinataires d?sign?s est interdite. Si vous recevez
ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer sans d?lai ?
l'exp?diteur un message ?lectronique pour l'aviser que vous avez ?limin? de votre
ordinateur toute copie du courriel re?u.

From maechler at stat.math.ethz.ch  Thu Jan 24 18:35:28 2008
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Thu, 24 Jan 2008 18:35:28 +0100 (CET)
Subject: [Rd] [wishlist,
	patch] Removing .bzr/ directory when calling R CMD build (PR#10625)
Message-ID: <20080124173528.8E54C282EFF6@mail.pubhealth.ku.dk>

Thank you, Ben!

I've added your suggestion to R-devel.
Martin


From p.murrell at auckland.ac.nz  Thu Jan 24 22:51:06 2008
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Fri, 25 Jan 2008 10:51:06 +1300
Subject: [Rd] seekViewport error
In-Reply-To: <f8e6ff050801231942j7cfc2925xdf12c302ce17bed9@mail.gmail.com>
References: <971536df0712261026w6bdebe49re08ed45e28af8873@mail.gmail.com>	
	<4797FA21.3090700@stat.auckland.ac.nz>
	<f8e6ff050801231942j7cfc2925xdf12c302ce17bed9@mail.gmail.com>
Message-ID: <4799084A.8080600@stat.auckland.ac.nz>

Hi


hadley wickham wrote:
>> The problem (see also
>> https://stat.ethz.ch/pipermail/r-help/2008-January/151655.html) is that
>> cellGrobs (children of frame grobs) use their 'vp' component to store
>> the viewport that positions them within the parent frame.  This means
>> that the viewport is pushed and then popped (as per normal behaviour for
>> 'vp' components).
> 
> Why ever 'pop' and not 'up'?  It seems like you would (almost) always
> want to leave the viewport around so that others can modify more
> easily.  Is it a performance consideration?


Because 'up' did not exist when the code was first written (and now it's
probably too late ...)

Paul
-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From johannes_graumann at web.de  Thu Jan 24 23:00:58 2008
From: johannes_graumann at web.de (Johannes Graumann)
Date: Thu, 24 Jan 2008 22:00:58 +0000 (UTC)
Subject: [Rd] R CMD check and postscript fonts
Message-ID: <loom.20080124T214916-853@post.gmane.org>

Hello,
I came across this by using R cmd check - otherwise I would probably not have
noticed.
One of my functions does something like this:
# postscript()
# plot(1, xlim = c(0, 10), ylim = c(0, 4), type = "n", ann = FALSE, axes = FALSE)
# text(1:10, 2, c("a","b"), cex = seqcex, family="mono",font=2)

Which results in the error:
Error in text.default(1:10, 2, c("a", "b"), cex = seqcex, family = "mono",  : 
  family 'mono' not included in PostScript device

'mono' is perfectly fine for my x11 device and 
# postscriptFonts()$mono

gives me:
$family
[1] "Courier"

$metrics
[1] "Courier.afm"             "Courier-Bold.afm"       
[3] "Courier-Oblique.afm"     "Courier-BoldOblique.afm"
[5] "Symbol.afm"             

$encoding
[1] "default"

attr(,"class")
[1] "Type1Font"

That looks all right to me no? How to remedy this?

Thanks for your patience, Joh


From johannes_graumann at web.de  Thu Jan 24 23:03:10 2008
From: johannes_graumann at web.de (Johannes Graumann)
Date: Thu, 24 Jan 2008 22:03:10 +0000 (UTC)
Subject: [Rd] Plot definition for custom class
Message-ID: <loom.20080124T220204-273@post.gmane.org>

Hi,

Is there any way to trick R CMD check into not throwing this error after I
created a dedicated "plot" incarnation for my custom function?

* checking S3 generic/method consistency ... WARNING
plot:
  function(x, ...)
plot.MQUSpecMatch:
  function(x, mozlabel, labelcex)

Thanks again, Joh


From ripley at stats.ox.ac.uk  Thu Jan 24 23:11:08 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 24 Jan 2008 22:11:08 +0000 (GMT)
Subject: [Rd] R CMD check and postscript fonts
In-Reply-To: <loom.20080124T214916-853@post.gmane.org>
References: <loom.20080124T214916-853@post.gmane.org>
Message-ID: <Pine.LNX.4.64.0801242210070.9592@auk.stats>

On Thu, 24 Jan 2008, Johannes Graumann wrote:

> Hello,
> I came across this by using R cmd check - otherwise I would probably not have
> noticed.
> One of my functions does something like this:
> # postscript()
> # plot(1, xlim = c(0, 10), ylim = c(0, 4), type = "n", ann = FALSE, axes = FALSE)
> # text(1:10, 2, c("a","b"), cex = seqcex, family="mono",font=2)
>
> Which results in the error:
> Error in text.default(1:10, 2, c("a", "b"), cex = seqcex, family = "mono",  :
>  family 'mono' not included in PostScript device
>
> 'mono' is perfectly fine for my x11 device and
> # postscriptFonts()$mono
>
> gives me:
> $family
> [1] "Courier"
>
> $metrics
> [1] "Courier.afm"             "Courier-Bold.afm"
> [3] "Courier-Oblique.afm"     "Courier-BoldOblique.afm"
> [5] "Symbol.afm"
>
> $encoding
> [1] "default"
>
> attr(,"class")
> [1] "Type1Font"
>
> That looks all right to me no? How to remedy this?

Use the 'fonts' argument to postscript():

    fonts: a character vector specifying additional R graphics font
           family names for font families whose declarations will be
           included in the PostScript file and are available for use
           with the device. See Details.


>
> Thanks for your patience, Joh
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Kurt.Hornik at wu-wien.ac.at  Thu Jan 24 23:14:46 2008
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Thu, 24 Jan 2008 23:14:46 +0100
Subject: [Rd] Plot definition for custom class
In-Reply-To: <loom.20080124T220204-273@post.gmane.org>
References: <loom.20080124T220204-273@post.gmane.org>
Message-ID: <18329.3542.79917.644749@fangorn.hornik.net>

>>>>> Johannes Graumann writes:

> Hi,
> Is there any way to trick R CMD check into not throwing this error after I
> created a dedicated "plot" incarnation for my custom function?

> * checking S3 generic/method consistency ... WARNING
> plot:
>   function(x, ...)
> plot.MQUSpecMatch:
>   function(x, mozlabel, labelcex)

Yes (even though it is a warning and not an error): add the ... args to
the method.

-k

> Thanks again, Joh

> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From johannes_graumann at web.de  Thu Jan 24 23:40:34 2008
From: johannes_graumann at web.de (Johannes Graumann)
Date: Thu, 24 Jan 2008 22:40:34 +0000 (UTC)
Subject: [Rd] R CMD check and postscript fonts
References: <loom.20080124T214916-853@post.gmane.org>
	<Pine.LNX.4.64.0801242210070.9592@auk.stats>
Message-ID: <loom.20080124T223622-976@post.gmane.org>

Prof Brian Ripley <ripley <at> stats.ox.ac.uk> writes:

> 
> On Thu, 24 Jan 2008, Johannes Graumann wrote:
> 
> > Hello,
> > I came across this by using R cmd check - otherwise I would probably not have
> > noticed.
> > One of my functions does something like this:
> > # postscript()
> > # plot(1, xlim = c(0, 10), ylim = c(0, 4), type = "n", ann = FALSE, axes =
FALSE)
> > # text(1:10, 2, c("a","b"), cex = seqcex, family="mono",font=2)
> >
> > Which results in the error:
> > Error in text.default(1:10, 2, c("a", "b"), cex = seqcex, family = "mono",  :
> >  family 'mono' not included in PostScript device
> >
> > 'mono' is perfectly fine for my x11 device and
> > # postscriptFonts()$mono
> >
> > gives me:
> > $family
> > [1] "Courier"
> >
> > $metrics
> > [1] "Courier.afm"             "Courier-Bold.afm"
> > [3] "Courier-Oblique.afm"     "Courier-BoldOblique.afm"
> > [5] "Symbol.afm"
> >
> > $encoding
> > [1] "default"
> >
> > attr(,"class")
> > [1] "Type1Font"
> >
> > That looks all right to me no? How to remedy this?
> 
> Use the 'fonts' argument to postscript():
> 
Hmmm, my actual function contains this bit ... any idea on how to solve this as
generic as possible? I do not want to make this require or prevent postscript as
the dev, but make the test (postscript) pass and enable future use of postscript
... where to put the 'fonts' unobtrusively, so that other devs will still work?

Joh

vectorsequence <- c("A","B")
xreq <- length(vectorsequence)

par(mar=c(1, 1, 1, 1) + 0.1)
plot(1, xlim = c(0, xreq), ylim = c(0, 4), type = "n", ann = FALSE, axes = FALSE)
text(1:xreq, 2, vectorsequence, cex = 2.5, family="mono",font=2)


From jeff.a.ryan at gmail.com  Thu Jan 24 23:41:06 2008
From: jeff.a.ryan at gmail.com (jeff.a.ryan at gmail.com)
Date: Thu, 24 Jan 2008 22:41:06 +0000
Subject: [Rd] Plot definition for custom class
In-Reply-To: <loom.20080124T220204-273@post.gmane.org>
References: <loom.20080124T220204-273@post.gmane.org>
Message-ID: <1596546689-1201214594-cardhu_decombobulator_blackberry.rim.net-547555042-@bxe111.bisx.prod.on.blackberry>

I think you just need to include the '...' as an argument to your function.

Jeff
Sent via BlackBerry from T-Mobile

-----Original Message-----
From: Johannes Graumann <johannes_graumann at web.de>

Date: Thu, 24 Jan 2008 22:03:10 
To:r-devel at stat.math.ethz.ch
Subject: [Rd] Plot definition for custom class


Hi,

Is there any way to trick R CMD check into not throwing this error after I
created a dedicated "plot" incarnation for my custom function?

* checking S3 generic/method consistency ... WARNING
plot:
  function(x, ...)
plot.MQUSpecMatch:
  function(x, mozlabel, labelcex)

Thanks again, Joh

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From johannes_graumann at web.de  Thu Jan 24 23:47:03 2008
From: johannes_graumann at web.de (Johannes Graumann)
Date: Thu, 24 Jan 2008 22:47:03 +0000 (UTC)
Subject: [Rd] Plot definition for custom class
References: <loom.20080124T220204-273@post.gmane.org>
	<18329.3542.79917.644749@fangorn.hornik.net>
Message-ID: <loom.20080124T224617-208@post.gmane.org>

Kurt Hornik <Kurt.Hornik <at> wu-wien.ac.at> writes:

> 
> >>>>> Johannes Graumann writes:
> 
> > Hi,
> > Is there any way to trick R CMD check into not throwing this error after I
> > created a dedicated "plot" incarnation for my custom function?
> 
> > * checking S3 generic/method consistency ... WARNING
> > plot:
> >   function(x, ...)
> > plot.MQUSpecMatch:
> >   function(x, mozlabel, labelcex)
> 
> Yes (even though it is a warning and not an error): add the ... args to
> the method.
Warning get obnoxious in a big project (by my humble standars) ...
Thanks - works like a charm.

Joh


From braunm at MIT.EDU  Fri Jan 25 02:19:01 2008
From: braunm at MIT.EDU (Michael Braun)
Date: Thu, 24 Jan 2008 20:19:01 -0500
Subject: [Rd] Problem building R with Intel MKL v10 BLAS
Message-ID: <47993905.9000206@mit.edu>

NO

Hi.  I'm not sure if this is an R-help or R-devel problem, so I'm 
starting here in the hope that someone can help (and willing to go to 
the other list if it's more appropriate).  I think I am following all of 
the instructions in the various manuals, but clearly I am missing something.

I have an Intel EM64T Dell with 2 dual-core Xeon processors running Red 
Hat EL5.  I would like to build R 2.6.1 with lots of debugging and 
profiling options, and link it to the processor-specific Intel MKL blas. 
The problem is that after I compile R, and do R CMD config BLAS_LIBS, 
the response is
-L/usr/local/lib64/R/lib -lRblas.

This tells me that R is not linked to the Intel BLAS at all.

My config.site file for R is:

#! /bin/sh

R_PAPERSIZE=letter
CFLAGS="-g -O2 -p -pg"
CPPFLAGS="-I/opt/intel/mkl/10.0.1.014/include -I/usr/include 
-I/usr/local/include"
LIBnn=lib64
BLAS_LIBS="-L/opt/intel/mkl/10.0.1.014/lib/em64t -Wl,--start-group 
-lmkl_gf_lp64.so -lmkl_gnu_thread.so -lmkl_core.so -l -l -l -Wl, 
--end-group -lguide -lpthread -lm"

I have set the CONFIG_SITE environment variable to the location of the 
config.site.file.
I am doing everything as superuser.

The command I am using for configure is

./configure --disable-R-profiling --with-blas=no

following the instructions in the R-admin file regarding enabling 
C-level profiling and linking to the external BLAS libraries referenced 
in the config.site file.

The BLAS_LIBS files are different than in the R-admin manual because of 
changes in the Intel MKL for version 10.  These libraries, in this 
order, were taken from the Intel MKL for Linux User's Guide, chapter 5.

So, still no luck linking to the optimized BLAS.  I'd appreciate any 
suggestions.

Thanks,

Michael





-- 
Michael Braun
Assistant Professor of Marketing
MIT Sloan School of Management
One Amherst St., E40-169
Cambridge, MA 02142
USA

braunm at mit.edu
+1 (617) 253-3436


From ripley at stats.ox.ac.uk  Fri Jan 25 07:21:36 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 25 Jan 2008 06:21:36 +0000 (GMT)
Subject: [Rd] R CMD check and postscript fonts
In-Reply-To: <loom.20080124T223622-976@post.gmane.org>
References: <loom.20080124T214916-853@post.gmane.org>
	<Pine.LNX.4.64.0801242210070.9592@auk.stats>
	<loom.20080124T223622-976@post.gmane.org>
Message-ID: <Pine.LNX.4.64.0801250621120.7483@auk.stats>

On Thu, 24 Jan 2008, Johannes Graumann wrote:

> Prof Brian Ripley <ripley <at> stats.ox.ac.uk> writes:
>
>>
>> On Thu, 24 Jan 2008, Johannes Graumann wrote:
>>
>>> Hello,
>>> I came across this by using R cmd check - otherwise I would probably not have
>>> noticed.
>>> One of my functions does something like this:
>>> # postscript()
>>> # plot(1, xlim = c(0, 10), ylim = c(0, 4), type = "n", ann = FALSE, axes =
> FALSE)
>>> # text(1:10, 2, c("a","b"), cex = seqcex, family="mono",font=2)
>>>
>>> Which results in the error:
>>> Error in text.default(1:10, 2, c("a", "b"), cex = seqcex, family = "mono",  :
>>>  family 'mono' not included in PostScript device
>>>
>>> 'mono' is perfectly fine for my x11 device and
>>> # postscriptFonts()$mono
>>>
>>> gives me:
>>> $family
>>> [1] "Courier"
>>>
>>> $metrics
>>> [1] "Courier.afm"             "Courier-Bold.afm"
>>> [3] "Courier-Oblique.afm"     "Courier-BoldOblique.afm"
>>> [5] "Symbol.afm"
>>>
>>> $encoding
>>> [1] "default"
>>>
>>> attr(,"class")
>>> [1] "Type1Font"
>>>
>>> That looks all right to me no? How to remedy this?
>>
>> Use the 'fonts' argument to postscript():
>>
> Hmmm, my actual function contains this bit ... any idea on how to solve this as
> generic as possible? I do not want to make this require or prevent postscript as
> the dev, but make the test (postscript) pass and enable future use of postscript
> ... where to put the 'fonts' unobtrusively, so that other devs will still work?

It is device-specific.

>
> Joh
>
> vectorsequence <- c("A","B")
> xreq <- length(vectorsequence)
>
> par(mar=c(1, 1, 1, 1) + 0.1)
> plot(1, xlim = c(0, xreq), ylim = c(0, 4), type = "n", ann = FALSE, axes = FALSE)
> text(1:xreq, 2, vectorsequence, cex = 2.5, family="mono",font=2)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Fri Jan 25 07:35:41 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 25 Jan 2008 06:35:41 +0000 (GMT)
Subject: [Rd] Problem building R with Intel MKL v10 BLAS
In-Reply-To: <47993905.9000206@mit.edu>
References: <47993905.9000206@mit.edu>
Message-ID: <Pine.LNX.4.64.0801250623420.7483@auk.stats>

On Thu, 24 Jan 2008, Michael Braun wrote:

> NO
>
> Hi.  I'm not sure if this is an R-help or R-devel problem, so I'm

Definitely R-devel.

> starting here in the hope that someone can help (and willing to go to
> the other list if it's more appropriate).  I think I am following all of
> the instructions in the various manuals, but clearly I am missing something.
>
> I have an Intel EM64T Dell with 2 dual-core Xeon processors running Red
> Hat EL5.  I would like to build R 2.6.1 with lots of debugging and
> profiling options, and link it to the processor-specific Intel MKL blas.
> The problem is that after I compile R, and do R CMD config BLAS_LIBS,
> the response is
> -L/usr/local/lib64/R/lib -lRblas.
>
> This tells me that R is not linked to the Intel BLAS at all.

Not so, because Rblas contains any links to an external BLAS.  Check over 
the R-admin manual and note that --enable-BLAS-shlib is the default.
So you need to check

ldd /usr/local/lib64/R/lib/libRblas.so

to see if it linked to MKL.

Check over config.log to see what happened: a common problem is that the 
libraries are not known to ld.so (you may need to include 
/opt/intel/mkl/10.0.1.014/lib/em64t in LD_LIBRARY_PATH)

> My config.site file for R is:
>
> #! /bin/sh
>
> R_PAPERSIZE=letter
> CFLAGS="-g -O2 -p -pg"
> CPPFLAGS="-I/opt/intel/mkl/10.0.1.014/include -I/usr/include
> -I/usr/local/include"
> LIBnn=lib64
> BLAS_LIBS="-L/opt/intel/mkl/10.0.1.014/lib/em64t -Wl,--start-group
> -lmkl_gf_lp64.so -lmkl_gnu_thread.so -lmkl_core.so -l -l -l -Wl,
> --end-group -lguide -lpthread -lm"
>
> I have set the CONFIG_SITE environment variable to the location of the
> config.site.file.
> I am doing everything as superuser.

What compilers are you using?  That would appear to be using 
gcc/gfortran and not the Intel compilers.

>
> The command I am using for configure is
>
> ./configure --disable-R-profiling --with-blas=no
>
> following the instructions in the R-admin file regarding enabling
> C-level profiling and linking to the external BLAS libraries referenced
> in the config.site file.
>
> The BLAS_LIBS files are different than in the R-admin manual because of
> changes in the Intel MKL for version 10.  These libraries, in this
> order, were taken from the Intel MKL for Linux User's Guide, chapter 5.
>
> So, still no luck linking to the optimized BLAS.  I'd appreciate any
> suggestions.
>
> Thanks,
>
> Michael
>
>
>
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From johannes_graumann at web.de  Fri Jan 25 09:14:27 2008
From: johannes_graumann at web.de (Johannes Graumann)
Date: Fri, 25 Jan 2008 09:14:27 +0100
Subject: [Rd] R CMD check and postscript fonts
References: <loom.20080124T214916-853@post.gmane.org>
	<Pine.LNX.4.64.0801242210070.9592@auk.stats>
	<loom.20080124T223622-976@post.gmane.org>
	<Pine.LNX.4.64.0801250621120.7483@auk.stats>
Message-ID: <fnc5pi$15e$1@ger.gmane.org>

Prof Brian Ripley wrote:

> On Thu, 24 Jan 2008, Johannes Graumann wrote:
> 
>> Prof Brian Ripley <ripley <at> stats.ox.ac.uk> writes:
>>
>>>
>>> On Thu, 24 Jan 2008, Johannes Graumann wrote:
>>>
>>>> Hello,
>>>> I came across this by using R cmd check - otherwise I would probably
>>>> not have noticed.
>>>> One of my functions does something like this:
>>>> # postscript()
>>>> # plot(1, xlim = c(0, 10), ylim = c(0, 4), type = "n", ann = FALSE,
>>>> # axes =
>> FALSE)
>>>> # text(1:10, 2, c("a","b"), cex = seqcex, family="mono",font=2)
>>>>
>>>> Which results in the error:
>>>> Error in text.default(1:10, 2, c("a", "b"), cex = seqcex, family =
>>>> "mono",  :
>>>>  family 'mono' not included in PostScript device
>>>>
>>>> 'mono' is perfectly fine for my x11 device and
>>>> # postscriptFonts()$mono
>>>>
>>>> gives me:
>>>> $family
>>>> [1] "Courier"
>>>>
>>>> $metrics
>>>> [1] "Courier.afm"             "Courier-Bold.afm"
>>>> [3] "Courier-Oblique.afm"     "Courier-BoldOblique.afm"
>>>> [5] "Symbol.afm"
>>>>
>>>> $encoding
>>>> [1] "default"
>>>>
>>>> attr(,"class")
>>>> [1] "Type1Font"
>>>>
>>>> That looks all right to me no? How to remedy this?
>>>
>>> Use the 'fonts' argument to postscript():
>>>
>> Hmmm, my actual function contains this bit ... any idea on how to solve
>> this as generic as possible? I do not want to make this require or
>> prevent postscript as the dev, but make the test (postscript) pass and
>> enable future use of postscript ... where to put the 'fonts'
>> unobtrusively, so that other devs will still work?
> 
> It is device-specific.
For now I'm going with 

if(names(dev.list())[length(dev.list())]=="postscript"){
  text(1:xreq, 2, vectorsequence, cex = seqcex, fonts="mono",font=2)
} else {
  text(1:xreq, 2, vectorsequence, cex = seqcex, family="mono",font=2)
}

and will extend as I eun into trouble with more devices. Thanks for your
help.

Joh


From A.R.Runnalls at kent.ac.uk  Fri Jan 25 12:45:12 2008
From: A.R.Runnalls at kent.ac.uk (A.R.Runnalls at kent.ac.uk)
Date: Fri, 25 Jan 2008 12:45:12 +0100 (CET)
Subject: [Rd] strsignif.c, util.c (PR#10635)
Message-ID: <20080125114512.F272D283462C@mail.pubhealth.ku.dk>

In R 2.6.1, a couple of places (discovered using valgrind) where the
requested size of string buffers fails to account correctly for the
trailing null byte:

1. In src/appl/strsignif.c, 'f0' and 'form' at l. 108-9 each need at
least 1 extra byte.

2. In src/main/util.c, 'out' at l. 1081 needs at least one extra byte.

(Remember that the return value of strlen does not include the null byte.)

Andrew Runnalls


From murdoch at stats.uwo.ca  Fri Jan 25 13:09:10 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 25 Jan 2008 07:09:10 -0500
Subject: [Rd] strsignif.c, util.c (PR#10635)
In-Reply-To: <20080125114512.F272D283462C@mail.pubhealth.ku.dk>
References: <20080125114512.F272D283462C@mail.pubhealth.ku.dk>
Message-ID: <4799D166.4060006@stats.uwo.ca>

A.R.Runnalls at kent.ac.uk wrote:
> In R 2.6.1, a couple of places (discovered using valgrind) where the
> requested size of string buffers fails to account correctly for the
> trailing null byte:
>
> 1. In src/appl/strsignif.c, 'f0' and 'form' at l. 108-9 each need at
> least 1 extra byte.
>   
At least this one is still there; I'll fix it (and take a look at the 
other, too).

Thanks!

Duncan Murdoch
> 2. In src/main/util.c, 'out' at l. 1081 needs at least one extra byte.
>
> (Remember that the return value of strlen does not include the null byte.)
>
> Andrew Runnalls
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From A.R.Runnalls at kent.ac.uk  Fri Jan 25 13:11:11 2008
From: A.R.Runnalls at kent.ac.uk (Andrew Runnalls)
Date: Fri, 25 Jan 2008 12:11:11 +0000
Subject: [Rd] do_gsub (PR#10540)
In-Reply-To: <478788A2.80608@cimr.cam.ac.uk>
References: <20080102174538.4B6D7283416A@mail.pubhealth.ku.dk>
	<478788A2.80608@cimr.cam.ac.uk>
Message-ID: <4799D1DF.8040305@kent.ac.uk>

Hin-Tak,

Apologies for the delay in responding.

On 2008/01/11 Hin-Tak Leung wrote:
> I believe STRING_ELT() works even when pat is R_NilValue, so
> the first line "does the right thing" even if the first element does not exist. I think this is intentional and not a bug.
> 
> Other more knowledgeable people please correct me if I am wrong.
> 
> A.R.Runnalls at kent.ac.uk wrote:
>> In character.c within R 2.6.1, the function do_gsub contains the following code:
>>
>> 1199        if (STRING_ELT(pat, 0) == NA_STRING) {
>> 1200            PROTECT(ans = allocVector(STRSXP, n));
>> 1201            for(i = 0; i < n; i++)  SET_STRING_ELT(ans, i, NA_STRING);
>> 1202            UNPROTECT(1);
>> 1203            return ans;
>> 1204        }
>> 1205
>> 1206        if (length(pat) < 1 || length(rep) < 1) error(R_MSG_IA);
>>
>> Line 1206 checks that pat contains at least one element. However,
>> line 1199 has already attempted to access the first element. The check
>> should surely come first. 

Generally speaking, in the interests of software reliability and
maintainability, it is a good idea for part of a program to 'do the
right thing' itself - in the present case, to check that an array is
non-empty before assuming that it is - rather than relying on what is in
fact rather unusual behaviour of another part of the program.  The case
I am concerned about is not in fact where 'pat' is R_NilValue, but when
it is a vector of length zero.  When asked to create such a vector,
memory.c will in fact allocate some element space in the vector, which
is why the above problem doesn't manifest itself as a crash (in the
no-segfault.R test, for example, which explores this case); however, it
seems unwise to rely on this.  And what would happen if that
(redundantly) allocated space just happened already to contain NA_STRING?

Best regards,
Andrew


From ripley at stats.ox.ac.uk  Fri Jan 25 14:25:15 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Fri, 25 Jan 2008 14:25:15 +0100 (CET)
Subject: [Rd] strsignif.c, util.c (PR#10635)
Message-ID: <20080125132515.AF172283462C@mail.pubhealth.ku.dk>

On Fri, 25 Jan 2008, A.R.Runnalls at kent.ac.uk wrote:

> In R 2.6.1, a couple of places (discovered using valgrind) where the
> requested size of string buffers fails to account correctly for the
> trailing null byte:
>
> 1. In src/appl/strsignif.c, 'f0' and 'form' at l. 108-9 each need at
> least 1 extra byte.
>
> 2. In src/main/util.c, 'out' at l. 1081 needs at least one extra byte.
>
> (Remember that the return value of strlen does not include the null byte.)

But it is subtler than that.  R_alloc contains the statement

 	s = allocVector(RAWSXP, size + 1);

and so does over-allocate by at least one (there is a rounding up to a 
multiple of 8).  This is a historical anomaly (it used to allocate a 
CHARSXP that allowed for the null byte), but one which trying to eliminate 
caused too many crashes in package code.

I'd like to see the empirical evidence you have, as I have been unable to 
trigger an overrun here.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hin-tak.leung at cimr.cam.ac.uk  Fri Jan 25 16:43:42 2008
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Fri, 25 Jan 2008 15:43:42 +0000
Subject: [Rd] Problem building R with Intel MKL v10 BLAS
In-Reply-To: <47993905.9000206@mit.edu>
References: <47993905.9000206@mit.edu>
Message-ID: <479A03AE.4070107@cimr.cam.ac.uk>

This part "-lmkl_gf_lp64.so -lmkl_gnu_thread.so -lmkl_core.so"
looks wrong - it should be "-lmkl_gf_lp64 -lmkl_gnu_thread -lmkl_core"
without the ".so" part.

I don't know how BLAS_LIBS does it, but when I was linking against
mkl 9, all I did which different from the usual build (diff from the
two rpm spec file I wrote) was 3 changes:

export LDFLAGS=...  -L/opt/intel/mkl/9.1/lib/em64t/
export FFLAGS=... -ff2c
./configure ... --with-blas="-lmkl -lguide -lpthread"

The FFLAGS ezport was needed because of difference between g77 and 
gfortran.


Michael Braun wrote:
> NO
> 
> Hi.  I'm not sure if this is an R-help or R-devel problem, so I'm 
> starting here in the hope that someone can help (and willing to go to 
> the other list if it's more appropriate).  I think I am following all of 
> the instructions in the various manuals, but clearly I am missing something.
> 
> I have an Intel EM64T Dell with 2 dual-core Xeon processors running Red 
> Hat EL5.  I would like to build R 2.6.1 with lots of debugging and 
> profiling options, and link it to the processor-specific Intel MKL blas. 
> The problem is that after I compile R, and do R CMD config BLAS_LIBS, 
> the response is
> -L/usr/local/lib64/R/lib -lRblas.
> 
> This tells me that R is not linked to the Intel BLAS at all.
> 
> My config.site file for R is:
> 
> #! /bin/sh
> 
> R_PAPERSIZE=letter
> CFLAGS="-g -O2 -p -pg"
> CPPFLAGS="-I/opt/intel/mkl/10.0.1.014/include -I/usr/include 
> -I/usr/local/include"
> LIBnn=lib64
> BLAS_LIBS="-L/opt/intel/mkl/10.0.1.014/lib/em64t -Wl,--start-group 
> -lmkl_gf_lp64.so -lmkl_gnu_thread.so -lmkl_core.so -l -l -l -Wl, 
> --end-group -lguide -lpthread -lm"
> 
> I have set the CONFIG_SITE environment variable to the location of the 
> config.site.file.
> I am doing everything as superuser.
> 
> The command I am using for configure is
> 
> ./configure --disable-R-profiling --with-blas=no
> 
> following the instructions in the R-admin file regarding enabling 
> C-level profiling and linking to the external BLAS libraries referenced 
> in the config.site file.
> 
> The BLAS_LIBS files are different than in the R-admin manual because of 
> changes in the Intel MKL for version 10.  These libraries, in this 
> order, were taken from the Intel MKL for Linux User's Guide, chapter 5.
> 
> So, still no luck linking to the optimized BLAS.  I'd appreciate any 
> suggestions.
> 
> Thanks,
> 
> Michael
> 
> 
> 
> 
>


From murdoch at stats.uwo.ca  Fri Jan 25 16:48:08 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 25 Jan 2008 10:48:08 -0500
Subject: [Rd] strsignif.c, util.c (PR#10635)
In-Reply-To: <20080125132515.AF172283462C@mail.pubhealth.ku.dk>
References: <20080125132515.AF172283462C@mail.pubhealth.ku.dk>
Message-ID: <479A04B8.7010205@stats.uwo.ca>

On 1/25/2008 8:25 AM, ripley at stats.ox.ac.uk wrote:
> On Fri, 25 Jan 2008, A.R.Runnalls at kent.ac.uk wrote:
> 
>> In R 2.6.1, a couple of places (discovered using valgrind) where the
>> requested size of string buffers fails to account correctly for the
>> trailing null byte:
>>
>> 1. In src/appl/strsignif.c, 'f0' and 'form' at l. 108-9 each need at
>> least 1 extra byte.
>>
>> 2. In src/main/util.c, 'out' at l. 1081 needs at least one extra byte.
>>
>> (Remember that the return value of strlen does not include the null byte.)
> 
> But it is subtler than that.  R_alloc contains the statement
> 
>  	s = allocVector(RAWSXP, size + 1);
> 
> and so does over-allocate by at least one (there is a rounding up to a 
> multiple of 8).  This is a historical anomaly (it used to allocate a 
> CHARSXP that allowed for the null byte), but one which trying to eliminate 
> caused too many crashes in package code.
> 
> I'd like to see the empirical evidence you have, as I have been unable to 
> trigger an overrun here.

That is not documented in Writing R Extensions or R Internals, so I 
think a change is needed, either to the docs or the calls.  I've already 
changed these calls.

I'd rather keep the docs as they are, because they give a sensible 
definition to the function.  If the implementation protects against 
sloppy usage that's okay, but I don't think we should take advantage of 
it, in case some future maintainer notices the inconsistency and removes it.

Duncan Murdoch


From ripley at stats.ox.ac.uk  Fri Jan 25 17:08:26 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 25 Jan 2008 16:08:26 +0000 (GMT)
Subject: [Rd] strsignif.c, util.c (PR#10635)
In-Reply-To: <479A04B8.7010205@stats.uwo.ca>
References: <20080125132515.AF172283462C@mail.pubhealth.ku.dk>
	<479A04B8.7010205@stats.uwo.ca>
Message-ID: <Pine.LNX.4.64.0801251605130.17408@auk.stats>

On Fri, 25 Jan 2008, Duncan Murdoch wrote:

> On 1/25/2008 8:25 AM, ripley at stats.ox.ac.uk wrote:
>> On Fri, 25 Jan 2008, A.R.Runnalls at kent.ac.uk wrote:
>> 
>>> In R 2.6.1, a couple of places (discovered using valgrind) where the
>>> requested size of string buffers fails to account correctly for the
>>> trailing null byte:
>>> 
>>> 1. In src/appl/strsignif.c, 'f0' and 'form' at l. 108-9 each need at
>>> least 1 extra byte.
>>> 
>>> 2. In src/main/util.c, 'out' at l. 1081 needs at least one extra byte.
>>> 
>>> (Remember that the return value of strlen does not include the null byte.)
>> 
>> But it is subtler than that.  R_alloc contains the statement
>>
>>  	s = allocVector(RAWSXP, size + 1);
>> 
>> and so does over-allocate by at least one (there is a rounding up to a 
>> multiple of 8).  This is a historical anomaly (it used to allocate a 
>> CHARSXP that allowed for the null byte), but one which trying to eliminate 
>> caused too many crashes in package code.
>> 
>> I'd like to see the empirical evidence you have, as I have been unable to 
>> trigger an overrun here.
>
> That is not documented in Writing R Extensions or R Internals, so I think a 
> change is needed, either to the docs or the calls.  I've already changed 
> these calls.
>
> I'd rather keep the docs as they are, because they give a sensible definition 
> to the function.  If the implementation protects against sloppy usage that's 
> okay, but I don't think we should take advantage of it, in case some future 
> maintainer notices the inconsistency and removes it.

I'm not disagreeing, just saying the analysis appears to me to be 
incorrect, and so there may be a different bug than the one reported.

As I said, I have tried removing it and found ca 10 other places in R 
(which I fixed: acopy_string is recent) and ca 20 packages that relied on 
it.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From braunm at MIT.EDU  Fri Jan 25 17:55:46 2008
From: braunm at MIT.EDU (Michael Braun)
Date: Fri, 25 Jan 2008 11:55:46 -0500
Subject: [Rd] Problem building R with Intel MKL v10 BLAS
In-Reply-To: <479A03AE.4070107@cimr.cam.ac.uk>
References: <47993905.9000206@mit.edu> <479A03AE.4070107@cimr.cam.ac.uk>
Message-ID: <479A1492.1010901@mit.edu>

NO

Thanks for everyone's help.  Unfortunately, still no success.  So I took 
the alternate route suggested in section A.3.1.5 of R-admin, and just 
created a symbolic link from libRblas.so to .../libmkl_gf_lp64.so.  I 
can still multiply 2 matrices together in R, so it looks like this is 
working.  Can you propose any other test to be sure?

Should I make a similar link for LAPACK?

I'm still perplexed as to why configure couldn't find the MKL BLAS, but 
I suppose any solution that works is a good one.

Thanks again.

Michael




Hin-Tak Leung wrote:
> This part "-lmkl_gf_lp64.so -lmkl_gnu_thread.so -lmkl_core.so"
> looks wrong - it should be "-lmkl_gf_lp64 -lmkl_gnu_thread -lmkl_core"
> without the ".so" part.
>
> I don't know how BLAS_LIBS does it, but when I was linking against
> mkl 9, all I did which different from the usual build (diff from the
> two rpm spec file I wrote) was 3 changes:
>
> export LDFLAGS=...  -L/opt/intel/mkl/9.1/lib/em64t/
> export FFLAGS=... -ff2c
> ./configure ... --with-blas="-lmkl -lguide -lpthread"
>
> The FFLAGS ezport was needed because of difference between g77 and 
> gfortran.
>
>
> Michael Braun wrote:
>> NO
>>
>> Hi.  I'm not sure if this is an R-help or R-devel problem, so I'm 
>> starting here in the hope that someone can help (and willing to go to 
>> the other list if it's more appropriate).  I think I am following all 
>> of the instructions in the various manuals, but clearly I am missing 
>> something.
>>
>> I have an Intel EM64T Dell with 2 dual-core Xeon processors running 
>> Red Hat EL5.  I would like to build R 2.6.1 with lots of debugging 
>> and profiling options, and link it to the processor-specific Intel 
>> MKL blas. The problem is that after I compile R, and do R CMD config 
>> BLAS_LIBS, the response is
>> -L/usr/local/lib64/R/lib -lRblas.
>>
>> This tells me that R is not linked to the Intel BLAS at all.
>>
>> My config.site file for R is:
>>
>> #! /bin/sh
>>
>> R_PAPERSIZE=letter
>> CFLAGS="-g -O2 -p -pg"
>> CPPFLAGS="-I/opt/intel/mkl/10.0.1.014/include -I/usr/include 
>> -I/usr/local/include"
>> LIBnn=lib64
>> BLAS_LIBS="-L/opt/intel/mkl/10.0.1.014/lib/em64t -Wl,--start-group 
>> -lmkl_gf_lp64.so -lmkl_gnu_thread.so -lmkl_core.so -l -l -l -Wl, 
>> --end-group -lguide -lpthread -lm"
>>
>> I have set the CONFIG_SITE environment variable to the location of 
>> the config.site.file.
>> I am doing everything as superuser.
>>
>> The command I am using for configure is
>>
>> ./configure --disable-R-profiling --with-blas=no
>>
>> following the instructions in the R-admin file regarding enabling 
>> C-level profiling and linking to the external BLAS libraries 
>> referenced in the config.site file.
>>
>> The BLAS_LIBS files are different than in the R-admin manual because 
>> of changes in the Intel MKL for version 10.  These libraries, in this 
>> order, were taken from the Intel MKL for Linux User's Guide, chapter 5.
>>
>> So, still no luck linking to the optimized BLAS.  I'd appreciate any 
>> suggestions.
>>
>> Thanks,
>>
>> Michael
>>
>>
>>
>>
>>
>


-- 
Michael Braun
Assistant Professor of Marketing
MIT Sloan School of Management
One Amherst St., E40-169
Cambridge, MA 02142
USA

braunm at mit.edu
+1 (617) 253-3436


From ripley at stats.ox.ac.uk  Fri Jan 25 19:25:42 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 25 Jan 2008 18:25:42 +0000 (GMT)
Subject: [Rd] Problem building R with Intel MKL v10 BLAS
In-Reply-To: <479A1492.1010901@mit.edu>
References: <47993905.9000206@mit.edu> <479A03AE.4070107@cimr.cam.ac.uk>
	<479A1492.1010901@mit.edu>
Message-ID: <alpine.LFD.1.00.0801251824560.9123@gannet.stats.ox.ac.uk>

On Fri, 25 Jan 2008, Michael Braun wrote:

> Thanks for everyone's help.  Unfortunately, still no success.  So I took the 
> alternate route suggested in section A.3.1.5 of R-admin, and just created a 
> symbolic link from libRblas.so to .../libmkl_gf_lp64.so.  I can still 
> multiply 2 matrices together in R, so it looks like this is working.  Can you 
> propose any other test to be sure?

Run 'make check' ... it includes some tests specifically for working 
BLAS.

>
> Should I make a similar link for LAPACK?
>
> I'm still perplexed as to why configure couldn't find the MKL BLAS, but I 
> suppose any solution that works is a good one.
>
> Thanks again.
>
> Michael
>
>
>
>
> Hin-Tak Leung wrote:
>> This part "-lmkl_gf_lp64.so -lmkl_gnu_thread.so -lmkl_core.so"
>> looks wrong - it should be "-lmkl_gf_lp64 -lmkl_gnu_thread -lmkl_core"
>> without the ".so" part.
>> 
>> I don't know how BLAS_LIBS does it, but when I was linking against
>> mkl 9, all I did which different from the usual build (diff from the
>> two rpm spec file I wrote) was 3 changes:
>> 
>> export LDFLAGS=...  -L/opt/intel/mkl/9.1/lib/em64t/
>> export FFLAGS=... -ff2c
>> ./configure ... --with-blas="-lmkl -lguide -lpthread"
>> 
>> The FFLAGS ezport was needed because of difference between g77 and 
>> gfortran.
>> 
>> 
>> Michael Braun wrote:
>>> NO
>>> 
>>> Hi.  I'm not sure if this is an R-help or R-devel problem, so I'm starting 
>>> here in the hope that someone can help (and willing to go to the other 
>>> list if it's more appropriate).  I think I am following all of the 
>>> instructions in the various manuals, but clearly I am missing something.
>>> 
>>> I have an Intel EM64T Dell with 2 dual-core Xeon processors running Red 
>>> Hat EL5.  I would like to build R 2.6.1 with lots of debugging and 
>>> profiling options, and link it to the processor-specific Intel MKL blas. 
>>> The problem is that after I compile R, and do R CMD config BLAS_LIBS, the 
>>> response is
>>> -L/usr/local/lib64/R/lib -lRblas.
>>> 
>>> This tells me that R is not linked to the Intel BLAS at all.
>>> 
>>> My config.site file for R is:
>>> 
>>> #! /bin/sh
>>> 
>>> R_PAPERSIZE=letter
>>> CFLAGS="-g -O2 -p -pg"
>>> CPPFLAGS="-I/opt/intel/mkl/10.0.1.014/include -I/usr/include 
>>> -I/usr/local/include"
>>> LIBnn=lib64
>>> BLAS_LIBS="-L/opt/intel/mkl/10.0.1.014/lib/em64t -Wl,--start-group 
>>> -lmkl_gf_lp64.so -lmkl_gnu_thread.so -lmkl_core.so -l -l -l -Wl, 
>>> --end-group -lguide -lpthread -lm"
>>> 
>>> I have set the CONFIG_SITE environment variable to the location of the 
>>> config.site.file.
>>> I am doing everything as superuser.
>>> 
>>> The command I am using for configure is
>>> 
>>> ./configure --disable-R-profiling --with-blas=no
>>> 
>>> following the instructions in the R-admin file regarding enabling C-level 
>>> profiling and linking to the external BLAS libraries referenced in the 
>>> config.site file.
>>> 
>>> The BLAS_LIBS files are different than in the R-admin manual because of 
>>> changes in the Intel MKL for version 10.  These libraries, in this order, 
>>> were taken from the Intel MKL for Linux User's Guide, chapter 5.
>>> 
>>> So, still no luck linking to the optimized BLAS.  I'd appreciate any 
>>> suggestions.
>>> 
>>> Thanks,
>>> 
>>> Michael
>>> 
>>> 
>>> 
>>> 
>>> 
>> 
>
>
> -- 
> Michael Braun
> Assistant Professor of Marketing
> MIT Sloan School of Management
> One Amherst St., E40-169
> Cambridge, MA 02142
> USA
>
> braunm at mit.edu
> +1 (617) 253-3436
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From johannes_graumann at web.de  Fri Jan 25 20:54:11 2008
From: johannes_graumann at web.de (Johannes Graumann)
Date: Fri, 25 Jan 2008 20:54:11 +0100
Subject: [Rd] R CMD check and postscript fonts
References: <loom.20080124T214916-853@post.gmane.org>
	<Pine.LNX.4.64.0801242210070.9592@auk.stats>
	<loom.20080124T223622-976@post.gmane.org>
	<Pine.LNX.4.64.0801250621120.7483@auk.stats>
	<fnc5pi$15e$1@ger.gmane.org>
Message-ID: <fndepi$oa8$1@ger.gmane.org>

Johannes Graumann wrote:

> Prof Brian Ripley wrote:
> 
>> On Thu, 24 Jan 2008, Johannes Graumann wrote:
>> 
>>> Prof Brian Ripley <ripley <at> stats.ox.ac.uk> writes:
>>>
>>>>
>>>> On Thu, 24 Jan 2008, Johannes Graumann wrote:
>>>>
>>>>> Hello,
>>>>> I came across this by using R cmd check - otherwise I would probably
>>>>> not have noticed.
>>>>> One of my functions does something like this:
>>>>> # postscript()
>>>>> # plot(1, xlim = c(0, 10), ylim = c(0, 4), type = "n", ann = FALSE,
>>>>> # axes =
>>> FALSE)
>>>>> # text(1:10, 2, c("a","b"), cex = seqcex, family="mono",font=2)
>>>>>
>>>>> Which results in the error:
>>>>> Error in text.default(1:10, 2, c("a", "b"), cex = seqcex, family =
>>>>> "mono",  :
>>>>>  family 'mono' not included in PostScript device
>>>>>
>>>>> 'mono' is perfectly fine for my x11 device and
>>>>> # postscriptFonts()$mono
>>>>>
>>>>> gives me:
>>>>> $family
>>>>> [1] "Courier"
>>>>>
>>>>> $metrics
>>>>> [1] "Courier.afm"             "Courier-Bold.afm"
>>>>> [3] "Courier-Oblique.afm"     "Courier-BoldOblique.afm"
>>>>> [5] "Symbol.afm"
>>>>>
>>>>> $encoding
>>>>> [1] "default"
>>>>>
>>>>> attr(,"class")
>>>>> [1] "Type1Font"
>>>>>
>>>>> That looks all right to me no? How to remedy this?
>>>>
>>>> Use the 'fonts' argument to postscript():
>>>>
>>> Hmmm, my actual function contains this bit ... any idea on how to solve
>>> this as generic as possible? I do not want to make this require or
>>> prevent postscript as the dev, but make the test (postscript) pass and
>>> enable future use of postscript ... where to put the 'fonts'
>>> unobtrusively, so that other devs will still work?
>> 
>> It is device-specific.
> For now I'm going with
> 
> if(names(dev.list())[length(dev.list())]=="postscript"){
>   text(1:xreq, 2, vectorsequence, cex = seqcex, fonts="mono",font=2)
> } else {
>   text(1:xreq, 2, vectorsequence, cex = seqcex, family="mono",font=2)
> }
This just gives me issues if someone wants to plot to a on-screen device
(like windows or x11) and uses the gui to export to postscript: the plot
was produced with the 'family' option, but the postscript device it is now
piped to will not take it. Is there any way I could code around this
generally?

Thanks, Joh


From A.R.Runnalls at kent.ac.uk  Sat Jan 26 12:28:23 2008
From: A.R.Runnalls at kent.ac.uk (Andrew Runnalls)
Date: Sat, 26 Jan 2008 11:28:23 +0000
Subject: [Rd] strsignif.c, util.c (PR#10635)
In-Reply-To: <alpine.LFD.1.00.0801251310380.29472@gannet.stats.ox.ac.uk>
References: <20080125114512.F272D283462C@mail.pubhealth.ku.dk>
	<alpine.LFD.1.00.0801251310380.29472@gannet.stats.ox.ac.uk>
Message-ID: <479B1957.3080503@kent.ac.uk>

Prof Brian Ripley wrote:
> On Fri, 25 Jan 2008, A.R.Runnalls at kent.ac.uk wrote:
> 
>> In R 2.6.1, a couple of places (discovered using valgrind) where the
>> requested size of string buffers fails to account correctly for the
>> trailing null byte:
>>
>> 1. In src/appl/strsignif.c, 'f0' and 'form' at l. 108-9 each need at
>> least 1 extra byte.
>>
>> 2. In src/main/util.c, 'out' at l. 1081 needs at least one extra byte.
>>
>> (Remember that the return value of strlen does not include the null
>> byte.)
> 
> But it is subtler than that.  R_alloc contains the statement
> 
>     s = allocVector(RAWSXP, size + 1);
> 
> and so does over-allocate by at least one (there is a rounding up to a
> multiple of 8).  This is a historical anomaly (it used to allocate a
> CHARSXP that allowed for the null byte), but one which trying to
> eliminate caused too many crashes in package code.
> 
> I'd like to see the empirical evidence you have, as I have been unable
> to trigger an overrun here.

I should perhaps have explained that I discovered these faults working
on a modified code base, in which in particular the valgrind
instrumentation will pick up an overrun of even a single byte over the
requested block size.  I have no reason to suppose that the faults will
lead to a failure of R as currently engineered; indeed for the reasons
you cite I guess they won't.

However, buffer overruns - when they do manifest themselves - can give
rise to such baffling and hard-to-reproduce failures that they are like
submerged rocks: well worth marking on the chart even if they're not
close to current shipping lanes.

Andrew Runnalls


-- 
Dr Andrew Runnalls,
Computing Laboratory,
University of Kent,
CANTERBURY CT2 7NF, UK

Tel: (0)1227 823821


From ripley at stats.ox.ac.uk  Sun Jan 27 12:49:29 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 27 Jan 2008 11:49:29 +0000 (GMT)
Subject: [Rd] Character encodings and packages
Message-ID: <alpine.LFD.1.00.0801271110140.18478@gannet.stats.ox.ac.uk>

Since R 2.5.0 it has been possible to declare the encodings of character 
strings (at the level of individual elements of a character vector).
As a reminder, here is the announcement in NEWS

     o	R now attempts to keep track of character strings which are
 	known to be in Latin-1 or UTF-8 and print or plot them
 	appropriately in other locales.	 This is primarily intended
 	to make it possible to use data in Western European languages
 	in both Latin-1 and UTF-8 locales.  Currently scan(),
 	read.table(), readLines(), parse() and source() allow
 	encodings to be declared, and console input in suitable
 	locales is also recognized.

 	New function Encoding() can read or set the declared encodings
 	for a character vector.

Whereas R itself is careful to make use of this, I see very little 
recognition of it in packages -- which need to be making use of 
translateChar() rather than CHAR(): see the 'Writing R Extensions' manual. 
(I see it used in only one package, and that mainly in a copy of base R 
code.)

This will become more important as time goes by and more ways are 
introduced to generate marked data.  In particular, in R 2.7.0 under 
Windows 'Unicode' data (as used by NT-based versions of Windows, usually 
UCS-2 but possibly UTF-16) is translated to UTF-8 and marked as such.

In essence, every time you use CHAR() in .Call/.External call in a package 
you should consider if the data can be non-ASCII and if so how you want to 
handle it.  The choices are

- to replace CHAR() by translateChar() and handle the string in the native 
encoding of the current locale.  This needs the package to depend on
'R (>= 2.5.0)'.

- to note the declared encoding and handle the string in that encoding.

- to translate the string to UTF-8 and handle it in UTF-8.  This will be 
easiest to do in R >= 2.7.0 using the function translateCharUTF8().


For writers of graphics devices where is a further twist in R >= 2.7.0: 
currently text is passed to the graphics device in the native encoding, 
but by setting the DevDesc variable hasTextUTF8 to TRUE you can indicate 
to the graphics engine the ability to accept text in UTF-8.  This is done 
in several of the standard devices: for example windows() was already 
re-encoding to UCS-2 for plotting, and postscript()/pdf() also re-encode 
to the selected single-byte encoding.


Character data passed to .C or .Fortran is automatically re-encoded to the 
current locale (for .C, from the encoding specified by ENCODING=, 
otherwise from the declared encoding if any).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From lgautier at gmail.com  Sun Jan 27 15:49:42 2008
From: lgautier at gmail.com (Laurent Gautier)
Date: Sun, 27 Jan 2008 15:49:42 +0100
Subject: [Rd] Strict-prototypes definitions in R includes
Message-ID: <27d1e6020801270649y16e65f13o8bc400591aceb2f2@mail.gmail.com>

  Dear list,

  Whenever the flag "-Wstrict-prototypes" is set in gcc, compiling code that
includes headers in lib/R/include generates often warnings
(example with R-2.6.1:
Rinternals.h:560: warning: function declaration isn't a prototype
).

  All such warnings I looked at were about functions with empty
signatures declared
as "bar foo();" rather than "bar foo(void);". Is there a reason, or is
this just an oversight in the include files ?

  Thanks,


Laurent


From p.murrell at auckland.ac.nz  Sun Jan 27 22:13:02 2008
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Mon, 28 Jan 2008 10:13:02 +1300
Subject: [Rd] seekViewport error
In-Reply-To: <971536df0801231922w17c7f94fr9fdc6d9a46a8853d@mail.gmail.com>
References: <971536df0712261026w6bdebe49re08ed45e28af8873@mail.gmail.com>	
	<4797FA21.3090700@stat.auckland.ac.nz>
	<971536df0801231922w17c7f94fr9fdc6d9a46a8853d@mail.gmail.com>
Message-ID: <479CF3DE.8020007@stat.auckland.ac.nz>

Hi


Gabor Grothendieck wrote:
> On Jan 23, 2008 9:38 PM, Paul Murrell <p.murrell at auckland.ac.nz> wrote:
>> Hi
>>
>>
>> Gabor Grothendieck wrote:
>>> Why does the seekViewport at the bottom give an error?
>>
>> Because the viewport is popped after GRID.cellGrob.84 is drawn.
>>
>> grid.ls() shows the viewport because it recurses down into the legend
>> frame grob.  Compare your output with (grid-generated numbering differs)
>>  ...
>>
>>  > grid.ls(recurs=FALSE, view=TRUE)
>> ROOT
>>   GRID.rect.28
>>   plot1.toplevel.vp
>>     plot1.xlab.vp
>>       plot1.xlab
>>       1
>>     plot1.ylab.vp
>>       plot1.ylab
>>       1
>>     plot1.strip.1.1.off.vp
>>       GRID.segments.29
>>       1
>>     plot1.strip.left.1.1.off.vp
>>       GRID.segments.30
>>       GRID.text.31
>>       1
>>     plot1.panel.1.1.off.vp
>>       GRID.segments.32
>>       GRID.text.33
>>       GRID.segments.34
>>       1
>>     plot1.panel.1.1.vp
>>       GRID.points.35
>>       GRID.points.36
>>       GRID.points.37
>>       1
>>     plot1.panel.1.1.off.vp
>>       GRID.rect.38
>>       1
>>     plot1.legend.top.vp
>>       GRID.frame.9
>>       1
>>     plot1.
>>       1
>>     1
>>
>> If you look at what viewports are actually available, via
>> current.vpTree(), you'll see that GRID.VP.24 is not there.
>>
>> The problem (see also
>> https://stat.ethz.ch/pipermail/r-help/2008-January/151655.html) is that
>> cellGrobs (children of frame grobs) use their 'vp' component to store
>> the viewport that positions them within the parent frame.  This means
>> that the viewport is pushed and then popped (as per normal behaviour for
>> 'vp' components).
>>
>> A possible solution that I am currently trialling uses a special
>> 'cellvp' slot instead so that the cellGrob viewports are pushed and then
>> "upped".  That way they remain available after the cellGrob has drawn,
>> so you can downViewport() to them.
>>
>> The disadvantage of this approach is that the viewports no longer appear
>> in the grid.ls() listing (because grid.ls() has no way of knowing about
>> special components of grobs that contain viewports).  This effect can
>> already be seen by the fact that the viewport for the frame grob
>> (GRID.frame.70) is not shown in the grid.ls() output.  On the other
>> hand, the viewports will be visible via current.vpTree()  ...
> 
> Perhaps some convention could be adopted which, if followed, would
> let grid.ls know?  If that worked at least for graphics generated from
> lattice and ggplot2 that would likely satisfy a significant percentage
> of uses.


The gridList() function used by grid.ls() is generic, so a solution is
to simply write a method for frames and cellGrobs.  I have committed a
fix along these lines.

Paul
-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From ripley at stats.ox.ac.uk  Sun Jan 27 23:36:55 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 27 Jan 2008 22:36:55 +0000 (GMT)
Subject: [Rd] Strict-prototypes definitions in R includes
In-Reply-To: <27d1e6020801270649y16e65f13o8bc400591aceb2f2@mail.gmail.com>
References: <27d1e6020801270649y16e65f13o8bc400591aceb2f2@mail.gmail.com>
Message-ID: <alpine.LFD.1.00.0801272145030.3059@gannet.stats.ox.ac.uk>

I think the answer is 'it depends'.

- such prototypes are not required by C99.
- using (void) is part of some authors' style and not of others. For the
   latter, this is not an 'oversight' but an uglification.
- in some cases the omission is deliberate as the function is used for
   variable sets of arguments (e.g, in GraphicsDevice.h).
- in others the omission is because it seemed safer to leave the
   prototype out than to get it wrong (when passing functions, for
   example).
- some code is taken from other projects and still has K&R style
   declarations.

On Sun, 27 Jan 2008, Laurent Gautier wrote:

>  Dear list,
>
>  Whenever the flag "-Wstrict-prototypes" is set in gcc, compiling code that
> includes headers in lib/R/include generates often warnings
> (example with R-2.6.1:
> Rinternals.h:560: warning: function declaration isn't a prototype
> ).
>
>  All such warnings I looked at were about functions with empty
> signatures declared
> as "bar foo();" rather than "bar foo(void);". Is there a reason, or is
> this just an oversight in the include files ?

It seems you were rather selective in your looking.

>
>  Thanks,
>
>
> Laurent

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hilmar.berger at imise.uni-leipzig.de  Sun Jan 27 23:10:04 2008
From: hilmar.berger at imise.uni-leipzig.de (hilmar.berger at imise.uni-leipzig.de)
Date: Sun, 27 Jan 2008 23:10:04 +0100 (CET)
Subject: [Rd] tapply on empty data.frames (PR#10644)
Message-ID: <20080127221004.5E8F52834158@mail.pubhealth.ku.dk>

Full_Name: Hilmar Berger
Version: 2.4.1/2.6.2alpha
OS: WinXP
Submission from: (NULL) (84.185.128.110)


Hi all,

If I use tapply on an empty data.frame I get an error. I'm not quite sure if one
can actually expect the function to return with a result. However, the error
message suggests that this case does not get handled well.

This happens both in R-2.4.1 and 2.6.2alpha (version 2008-01-26).

> z = data.frame(a = c(1,2,3,4),b=c("a","b","c","d"))
> z1 = subset(z,a == 5)
> tapply(z1$a,z1$b,length)
Error in ansmat[index] <- ans : 
  incompatible types (from NULL to logical) in subassignment type fix

Deleting unused factor levels from the group parameter gives:

> tapply(z1$a,factor(z1$b),length)
logical(0)


Regards,
Hilmar

platform       i386-pc-mingw32                          
arch           i386                                     
os             mingw32                                  
system         i386, mingw32                            
status         alpha                                    
major          2                                        
minor          6.2                                      
year           2008                                     
month          01                                       
day            26                                       
svn rev        44181                                    
language       R                                        
version.string R version 2.6.2 alpha (2008-01-26 r44181)


From lgautier at gmail.com  Mon Jan 28 09:57:42 2008
From: lgautier at gmail.com (Laurent Gautier)
Date: Mon, 28 Jan 2008 09:57:42 +0100
Subject: [Rd] Strict-prototypes definitions in R includes
In-Reply-To: <alpine.LFD.1.00.0801272145030.3059@gannet.stats.ox.ac.uk>
References: <27d1e6020801270649y16e65f13o8bc400591aceb2f2@mail.gmail.com>
	<alpine.LFD.1.00.0801272145030.3059@gannet.stats.ox.ac.uk>
Message-ID: <27d1e6020801280057i5216caefifab3a516a633b640@mail.gmail.com>

Thanks the answer.

Would submitted patches with strict post-K&R prototypes definition,
for the "void" cases and for the includes likely to be used by writers of
R extensions, be accepted ?


Laurent




2008/1/27, Prof Brian Ripley <ripley at stats.ox.ac.uk>:
> I think the answer is 'it depends'.
>
> - such prototypes are not required by C99.
> - using (void) is part of some authors' style and not of others. For the
>    latter, this is not an 'oversight' but an uglification.
> - in some cases the omission is deliberate as the function is used for
>    variable sets of arguments (e.g, in GraphicsDevice.h).
> - in others the omission is because it seemed safer to leave the
>    prototype out than to get it wrong (when passing functions, for
>    example).
> - some code is taken from other projects and still has K&R style
>    declarations.
>
> On Sun, 27 Jan 2008, Laurent Gautier wrote:
>
> >  Dear list,
> >
> >  Whenever the flag "-Wstrict-prototypes" is set in gcc, compiling code that
> > includes headers in lib/R/include generates often warnings
> > (example with R-2.6.1:
> > Rinternals.h:560: warning: function declaration isn't a prototype
> > ).
> >
> >  All such warnings I looked at were about functions with empty
> > signatures declared
> > as "bar foo();" rather than "bar foo(void);". Is there a reason, or is
> > this just an oversight in the include files ?
>
> It seems you were rather selective in your looking.
>
> >
> >  Thanks,
> >
> >
> > Laurent
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


From ripley at stats.ox.ac.uk  Mon Jan 28 10:03:31 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 28 Jan 2008 09:03:31 +0000 (GMT)
Subject: [Rd] Strict-prototypes definitions in R includes
In-Reply-To: <27d1e6020801280057i5216caefifab3a516a633b640@mail.gmail.com>
References: <27d1e6020801270649y16e65f13o8bc400591aceb2f2@mail.gmail.com>
	<alpine.LFD.1.00.0801272145030.3059@gannet.stats.ox.ac.uk>
	<27d1e6020801280057i5216caefifab3a516a633b640@mail.gmail.com>
Message-ID: <alpine.LFD.1.00.0801280858270.9931@gannet.stats.ox.ac.uk>

On Mon, 28 Jan 2008, Laurent Gautier wrote:

> Thanks the answer.
>
> Would submitted patches with strict post-K&R prototypes definition,
> for the "void" cases and for the includes likely to be used by writers of
> R extensions, be accepted ?

Yes, against R-devel.

But some you won't be able to do (e.g. in GraphicsDevice.h, DL_FUNC in 
Rdynload.h), and I am not sure that there are many others in the public 
include files.

>
>
> Laurent
>
>
>
>
> 2008/1/27, Prof Brian Ripley <ripley at stats.ox.ac.uk>:
>> I think the answer is 'it depends'.
>>
>> - such prototypes are not required by C99.
>> - using (void) is part of some authors' style and not of others. For the
>>    latter, this is not an 'oversight' but an uglification.
>> - in some cases the omission is deliberate as the function is used for
>>    variable sets of arguments (e.g, in GraphicsDevice.h).
>> - in others the omission is because it seemed safer to leave the
>>    prototype out than to get it wrong (when passing functions, for
>>    example).
>> - some code is taken from other projects and still has K&R style
>>    declarations.
>>
>> On Sun, 27 Jan 2008, Laurent Gautier wrote:
>>
>>>  Dear list,
>>>
>>>  Whenever the flag "-Wstrict-prototypes" is set in gcc, compiling code that
>>> includes headers in lib/R/include generates often warnings
>>> (example with R-2.6.1:
>>> Rinternals.h:560: warning: function declaration isn't a prototype
>>> ).
>>>
>>>  All such warnings I looked at were about functions with empty
>>> signatures declared
>>> as "bar foo();" rather than "bar foo(void);". Is there a reason, or is
>>> this just an oversight in the include files ?
>>
>> It seems you were rather selective in your looking.
>>
>>>
>>>  Thanks,
>>>
>>>
>>> Laurent
>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Mon Jan 28 18:28:42 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 28 Jan 2008 17:28:42 +0000 (GMT)
Subject: [Rd] Notes for writers of graphics devices
Message-ID: <alpine.LFD.1.00.0801281648290.30748@gannet.stats.ox.ac.uk>

Partly about new features and partly about old features that are not being 
used.

R_exts/GraphicsEngine.h says

/*
  * The current graphics engine (including graphics device) API version
  * MUST be integer
  *
  * This number should be bumped whenever there are changes to
  * GraphicsEngine.h or GraphicsDevice.h so that add-on packages
  * that compile against these headers (graphics systems such as
  * graphics and grid;  graphics devices such as gtkDevice, RSvgDevice)
  * can detect any version mismatch.
  *
  * Version 1:  Introduction of the version number.
  * Version 2:  GEDevDesc *dd dropped from GEcontourLines().
  * Version 3:  R_GE_str2col() added to API.
  * Version 4:  UTF-8 text hooks, useRotatedTextInContour to device interface.
  */

but unfortunately it is unused.  There's a function called
R_GE_checkVersionOrDie to check the API version.  Unfortunately this means 
that devices built under R < 2.7.0 are liable to crash if used under 2.7.0 
(although I've tried to be as defensive as possible).  So please consider 
making use of it. (As the standard devices don't need it, they don't 
provide examples.)

The new features of the device interface are

1) 'useRotatedTextInContour'.  Set this to true if the device can produce 
high-quality rotated text in the standard fonts, which will then be used 
in preference to Hershey fonts for labelling contour lines.  This the new 
default for postscript() and pdf() but not X11().

2) 'hasTextUTF8'  If set, you need to supply functions textUTF8 and 
strWidthUTF8 which are just like text and strWidth but will be passed text 
in UTF-8.  Note that these are alternatives: the graphics engine will only 
use the UTF-8 versions when this avoids re-encoding.

Another thing I see is with metricInfo: in a multibyte locale this is 
passed the Unicode point, and it seems almost all third-party graphics 
devices are ignoring that.  To make things a little simpler, if
hasTextUTF8 is set, Unicode points are sent to metricInfo as negative 
values.  Examples can be seen in e.g. the postcript, pdf and windows 
devices.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sg0000 at gmail.com  Mon Jan 28 19:41:42 2008
From: sg0000 at gmail.com (CapCity)
Date: Mon, 28 Jan 2008 13:41:42 -0500
Subject: [Rd]  Distributing R Programs
Message-ID: <fnl7l7$3g8$1@ger.gmane.org>

We recently developed an R program as part of an application. We'd like to
distribute this, but not allow access to the R source code. Is this
possible?


From ripley at stats.ox.ac.uk  Mon Jan 28 20:45:25 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon, 28 Jan 2008 20:45:25 +0100 (CET)
Subject: [Rd] tapply on empty data.frames (PR#10644)
Message-ID: <20080128194525.79666283462A@mail.pubhealth.ku.dk>

It's not about data frames: you did not pass tapply a data frame.

There's quite a few strange things here.  More likely you intended

> sapply(split(z1$a, z1$b), length)

but that gives list() whereas

> z2 <- subset(z,a == 4)
> sapply(split(z2$a, z2$b), length)
a b c d
0 0 0 1

is as one might expect.  This happens because split(z1$a, z1$b) is NULL, 
not a possible value according to the help page.

Back to tapply: it computes double rather than integer indices, but what 
it does in the end is

ansmat[numeric(0)] <- NULL

for a logical array ansmat.  That fails athough

i) there is nothing to replace
ii) replacing NULL by list() works.

Lots of other places happily promote NULL to list().

So there's something to fix in split() and in either [<- or lapply (or 
both).

The way the code is written it is not easy to make
x[<zero-length>] <- <anything> a no-op, but it think it probably should 
be.


On Sun, 27 Jan 2008, hilmar.berger at imise.uni-leipzig.de wrote:

> Full_Name: Hilmar Berger
> Version: 2.4.1/2.6.2alpha
> OS: WinXP
> Submission from: (NULL) (84.185.128.110)
>
>
> Hi all,
>
> If I use tapply on an empty data.frame I get an error. I'm not quite sure if one
> can actually expect the function to return with a result. However, the error
> message suggests that this case does not get handled well.
>
> This happens both in R-2.4.1 and 2.6.2alpha (version 2008-01-26).
>
>> z = data.frame(a = c(1,2,3,4),b=c("a","b","c","d"))
>> z1 = subset(z,a == 5)
>> tapply(z1$a,z1$b,length)
> Error in ansmat[index] <- ans :
>  incompatible types (from NULL to logical) in subassignment type fix
>
> Deleting unused factor levels from the group parameter gives:
>
>> tapply(z1$a,factor(z1$b),length)
> logical(0)
>
>
> Regards,
> Hilmar
>
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status         alpha
> major          2
> minor          6.2
> year           2008
> month          01
> day            26
> svn rev        44181
> language       R
> version.string R version 2.6.2 alpha (2008-01-26 r44181)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From p.dalgaard at biostat.ku.dk  Mon Jan 28 22:03:57 2008
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Mon, 28 Jan 2008 22:03:57 +0100
Subject: [Rd] Distributing R Programs
In-Reply-To: <fnl7l7$3g8$1@ger.gmane.org>
References: <fnl7l7$3g8$1@ger.gmane.org>
Message-ID: <479E433D.6090507@biostat.ku.dk>

CapCity wrote:
> We recently developed an R program as part of an application. We'd like to
> distribute this, but not allow access to the R source code. Is this
> possible?
>
>   
Not in any obvious way, and I don't think anyone around here would 
volunteer to help you find out.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From sg0000 at braju.com  Mon Jan 28 22:14:11 2008
From: sg0000 at braju.com (CapCity)
Date: Mon, 28 Jan 2008 13:14:11 -0800
Subject: [Rd] Distributing R Programs
In-Reply-To: <fnl7l7$3g8$1@ger.gmane.org>
References: <fnl7l7$3g8$1@ger.gmane.org>
Message-ID: <59d7961d0801281314y6daf55e0iff73eeedb4a43cf8@mail.gmail.com>

Hi there Super-Secret CapCity,

On Jan 28, 2008 10:41 AM, CapCity <sg0000 at gmail.com> wrote:
> We recently developed an R program as part of an application. We'd like to
> distribute this, but not allow access to the R source code. Is this
> possible?

if your code is using the R language (not native code) the short
answer is no and the hacker-safe answer is no.  You can use body() to
fake the source-code of a function, but that is easy to get around.  I
don't know of any R obfuscators.

See also http://www.r-project.org/posting-guide.html

>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From spencer.graves at pdf.com  Mon Jan 28 22:12:15 2008
From: spencer.graves at pdf.com (Spencer Graves)
Date: Mon, 28 Jan 2008 13:12:15 -0800
Subject: [Rd] Distributing R Programs
In-Reply-To: <479E433D.6090507@biostat.ku.dk>
References: <fnl7l7$3g8$1@ger.gmane.org> <479E433D.6090507@biostat.ku.dk>
Message-ID: <479E452F.3040000@pdf.com>

I believe that Insightful supports the distribution of encrypted S-Plus 
code, but you would need to talk with them about whether, how, how much 
money, etc.  If they support that, you can port your R code to S-Plus 
and distribute it as encrypted S-Plus code. 

hope this helps.
Spencer Graves

Peter Dalgaard wrote:
> CapCity wrote:
>   
>> We recently developed an R program as part of an application. We'd like to
>> distribute this, but not allow access to the R source code. Is this
>> possible?
>>
>>   
>>     
> Not in any obvious way, and I don't think anyone around here would 
> volunteer to help you find out.
>
>


From hin-tak.leung at cimr.cam.ac.uk  Mon Jan 28 22:50:54 2008
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Mon, 28 Jan 2008 21:50:54 +0000
Subject: [Rd] Distributing R Programs
In-Reply-To: <479E433D.6090507@biostat.ku.dk>
References: <fnl7l7$3g8$1@ger.gmane.org> <479E433D.6090507@biostat.ku.dk>
Message-ID: <479E4E3E.4080007@cimr.cam.ac.uk>

Peter Dalgaard wrote:
> CapCity wrote:
>> We recently developed an R program as part of an application. We'd like to
>> distribute this, but not allow access to the R source code. Is this
>> possible?
>>
>>   
> Not in any obvious way, and I don't think anyone around here would 
> volunteer to help you find out.

:-). I don't like the idea of hiding source code - I am not an 
open-source fanatic, but a broken piece of software can be fixed by a 
3rd party, otherwise you are at the mercy of the time/financial 
constraints of the author...

That said, since the original poster said 'as a part of an application',
it is probably possible to just uuencode/flatencode/ucs-16 some R-code,
stuff it down as a long char array, and pass the decrypted version one 
line at a time to R_eval() in a C wrapper, just to get around the usual
R ways of getting at the R-based source code.


From hin-tak.leung at cimr.cam.ac.uk  Mon Jan 28 23:01:42 2008
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Mon, 28 Jan 2008 22:01:42 +0000
Subject: [Rd] Problem building R with Intel MKL v10 BLAS
In-Reply-To: <alpine.LFD.1.00.0801251824560.9123@gannet.stats.ox.ac.uk>
References: <47993905.9000206@mit.edu> <479A03AE.4070107@cimr.cam.ac.uk>
	<479A1492.1010901@mit.edu>
	<alpine.LFD.1.00.0801251824560.9123@gannet.stats.ox.ac.uk>
Message-ID: <479E50C6.2050906@cimr.cam.ac.uk>

Prof Brian Ripley wrote:
> On Fri, 25 Jan 2008, Michael Braun wrote:
> 
>> Thanks for everyone's help.  Unfortunately, still no success.  So I 
>> took the alternate route suggested in section A.3.1.5 of R-admin, and 
>> just created a symbolic link from libRblas.so to 
>> .../libmkl_gf_lp64.so.  I can still multiply 2 matrices together in R, 
>> so it looks like this is working.  Can you propose any other test to 
>> be sure?
> 
> Run 'make check' ... it includes some tests specifically for working BLAS.
<snipped>

That reminds me of a discussion I had with our IT guy regarding building 
R 2.5.0 against MKL 8. He had MKL 8.0 against 2.4.x previously and it is
actually faster than 9.x ; but he was having trouble upgrading to R
2.5.0 (with MKL 8).

It turns out that R 2.5.0 added a couple of checks for some
double-complex BLAS/LAPACK routines (I can't remember which), which are 
missing in MKL8, so it is a fact that R 2.5.0 won't build against MKL 8 
- but will build against MKL 9, and once you have built 2.5.0 against 
MKL9, you can swap the libraries (somewhat dangerously) to get the speed
of MKL8 back...

It is not unthinkable that some more checks are added in 2.6.x and
MKL 10 is not passing them... one needs the result of config.log to be sure.


From h.wickham at gmail.com  Tue Jan 29 03:19:58 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Mon, 28 Jan 2008 20:19:58 -0600
Subject: [Rd] A "safe" do.call
Message-ID: <f8e6ff050801281819l223d85deu458c67fd6e0b3693@mail.gmail.com>

Has anyone developed a version of do.call that is safe in the sense
that it silently drops parameters that do not appear in the formals of
the called function? This is useful when ... ends up being used in
multiple further functions.  e.g.

f <- function(a, b) {a + b}
do.call(f, list(a=1, b=2, c=3))  # Errors
safe.call(f, list(a=1, b=2, c=3)) # Returns 3

If have quickly thrown together the following, but it doesn't support
position based calls, and I'd like to avoid reinventing the wheel.

safe.call <- function(f, params, f.params = names(formals(f))) {
  if ("..." %in% f.params) {
    safe.params <- params
  } else {
    safe.params <- params[intersect(f.params, names(params))]
  }
  do.call(f, safe.params)
}

I hope to use safe.call to prevent a wide class of potential bugs in ggplot2.

Hadley

-- 
http://had.co.nz/


From h.wickham at gmail.com  Tue Jan 29 03:30:30 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Mon, 28 Jan 2008 20:30:30 -0600
Subject: [Rd] A "safe" do.call
In-Reply-To: <f8e6ff050801281819l223d85deu458c67fd6e0b3693@mail.gmail.com>
References: <f8e6ff050801281819l223d85deu458c67fd6e0b3693@mail.gmail.com>
Message-ID: <f8e6ff050801281830m3a46e884j715611fed13cf3a8@mail.gmail.com>

Maybe this function won't actually be the help I had hoped it would
be.  Unfortunately some functions (e.g. glm via glm.control) throw
errors when ... contain arguments that don't match some (eventual)
argument list.

Or is this a bug in glm?  It certainly seems that the documentation
should mention that ... is passed to glm.control, which only takes
three arguments.  I realise that this doesn't come up very often
during an interactive model fitting session, and it is easy to remedy
when it does, but it makes writing robust functions hard when a
function with ... does in fact have a fixed argument list.

Hadley

On Jan 28, 2008 8:19 PM, hadley wickham <h.wickham at gmail.com> wrote:
> Has anyone developed a version of do.call that is safe in the sense
> that it silently drops parameters that do not appear in the formals of
> the called function? This is useful when ... ends up being used in
> multiple further functions.  e.g.
>
> f <- function(a, b) {a + b}
> do.call(f, list(a=1, b=2, c=3))  # Errors
> safe.call(f, list(a=1, b=2, c=3)) # Returns 3
>
> If have quickly thrown together the following, but it doesn't support
> position based calls, and I'd like to avoid reinventing the wheel.
>
> safe.call <- function(f, params, f.params = names(formals(f))) {
>   if ("..." %in% f.params) {
>     safe.params <- params
>   } else {
>     safe.params <- params[intersect(f.params, names(params))]
>   }
>   do.call(f, safe.params)
> }
>
> I hope to use safe.call to prevent a wide class of potential bugs in ggplot2.
>
> Hadley
>
> --
> http://had.co.nz/
>



-- 
http://had.co.nz/


From ripley at stats.ox.ac.uk  Tue Jan 29 05:56:19 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 29 Jan 2008 04:56:19 +0000 (GMT)
Subject: [Rd] Problem building R with Intel MKL v10 BLAS
In-Reply-To: <479E50C6.2050906@cimr.cam.ac.uk>
References: <47993905.9000206@mit.edu> <479A03AE.4070107@cimr.cam.ac.uk>
	<479A1492.1010901@mit.edu>
	<alpine.LFD.1.00.0801251824560.9123@gannet.stats.ox.ac.uk>
	<479E50C6.2050906@cimr.cam.ac.uk>
Message-ID: <alpine.LFD.1.00.0801290448060.23305@gannet.stats.ox.ac.uk>

On Mon, 28 Jan 2008, Hin-Tak Leung wrote:

> Prof Brian Ripley wrote:
>> On Fri, 25 Jan 2008, Michael Braun wrote:
>> 
>>> Thanks for everyone's help.  Unfortunately, still no success.  So I took 
>>> the alternate route suggested in section A.3.1.5 of R-admin, and just 
>>> created a symbolic link from libRblas.so to .../libmkl_gf_lp64.so.  I can 
>>> still multiply 2 matrices together in R, so it looks like this is working. 
>>> Can you propose any other test to be sure?
>> 
>> Run 'make check' ... it includes some tests specifically for working BLAS.
> <snipped>
>
> That reminds me of a discussion I had with our IT guy regarding building R 
> 2.5.0 against MKL 8. He had MKL 8.0 against 2.4.x previously and it is
> actually faster than 9.x ; but he was having trouble upgrading to R
> 2.5.0 (with MKL 8).
>
> It turns out that R 2.5.0 added a couple of checks for some
> double-complex BLAS/LAPACK routines (I can't remember which), which are 
> missing in MKL8, so it is a fact that R 2.5.0 won't build against MKL 8 - but 
> will build against MKL 9, and once you have built 2.5.0 against MKL9, you can 
> swap the libraries (somewhat dangerously) to get the speed
> of MKL8 back...
>
> It is not unthinkable that some more checks are added in 2.6.x and
> MKL 10 is not passing them... one needs the result of config.log to be sure.

Looking at the svn logs, the last change to the BLAS configure tests was 
in Nov 2005.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Tue Jan 29 06:29:38 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 29 Jan 2008 05:29:38 +0000 (GMT)
Subject: [Rd] A "safe" do.call
In-Reply-To: <f8e6ff050801281830m3a46e884j715611fed13cf3a8@mail.gmail.com>
References: <f8e6ff050801281819l223d85deu458c67fd6e0b3693@mail.gmail.com>
	<f8e6ff050801281830m3a46e884j715611fed13cf3a8@mail.gmail.com>
Message-ID: <alpine.LFD.1.00.0801290525250.23305@gannet.stats.ox.ac.uk>

On Mon, 28 Jan 2008, hadley wickham wrote:

> Maybe this function won't actually be the help I had hoped it would
> be.  Unfortunately some functions (e.g. glm via glm.control) throw
> errors when ... contain arguments that don't match some (eventual)
> argument list.
>
> Or is this a bug in glm?  It certainly seems that the documentation
> should mention that ... is passed to glm.control, which only takes
> three arguments.  I realise that this doesn't come up very often
> during an interactive model fitting session, and it is easy to remedy
> when it does, but it makes writing robust functions hard when a
> function with ... does in fact have a fixed argument list.

I think the docmentation has conflated '...' for glm and '...' for 
weights.

My recollection is that this was intentional: at least one core developer 
used to dislike '...' as it allowed mistyped argument names to be ignored.
And he has a good point, IMO.

>
> Hadley
>
> On Jan 28, 2008 8:19 PM, hadley wickham <h.wickham at gmail.com> wrote:
>> Has anyone developed a version of do.call that is safe in the sense
>> that it silently drops parameters that do not appear in the formals of
>> the called function? This is useful when ... ends up being used in
>> multiple further functions.  e.g.
>>
>> f <- function(a, b) {a + b}
>> do.call(f, list(a=1, b=2, c=3))  # Errors
>> safe.call(f, list(a=1, b=2, c=3)) # Returns 3
>>
>> If have quickly thrown together the following, but it doesn't support
>> position based calls, and I'd like to avoid reinventing the wheel.
>>
>> safe.call <- function(f, params, f.params = names(formals(f))) {
>>   if ("..." %in% f.params) {
>>     safe.params <- params
>>   } else {
>>     safe.params <- params[intersect(f.params, names(params))]
>>   }
>>   do.call(f, safe.params)
>> }
>>
>> I hope to use safe.call to prevent a wide class of potential bugs in ggplot2.
>>
>> Hadley
>>
>> --
>> http://had.co.nz/
>>
>
>
>
> --
> http://had.co.nz/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at stat.berkeley.edu  Tue Jan 29 07:19:15 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Mon, 28 Jan 2008 22:19:15 -0800
Subject: [Rd] A "safe" do.call
In-Reply-To: <f8e6ff050801281819l223d85deu458c67fd6e0b3693@mail.gmail.com>
References: <f8e6ff050801281819l223d85deu458c67fd6e0b3693@mail.gmail.com>
Message-ID: <59d7961d0801282219x4954ebb3xfea03b7526debdf3@mail.gmail.com>

I tried to do this a couple of years ago, cf. doCall() in R.utils.
It's quite a tricky problem and I recall I wasn't perfectly happy with
the solution but it's a start.

/Henrik

On Jan 28, 2008 6:19 PM, hadley wickham <h.wickham at gmail.com> wrote:
> Has anyone developed a version of do.call that is safe in the sense
> that it silently drops parameters that do not appear in the formals of
> the called function? This is useful when ... ends up being used in
> multiple further functions.  e.g.
>
> f <- function(a, b) {a + b}
> do.call(f, list(a=1, b=2, c=3))  # Errors
> safe.call(f, list(a=1, b=2, c=3)) # Returns 3
>
> If have quickly thrown together the following, but it doesn't support
> position based calls, and I'd like to avoid reinventing the wheel.
>
> safe.call <- function(f, params, f.params = names(formals(f))) {
>  if ("..." %in% f.params) {
>    safe.params <- params
>  } else {
>    safe.params <- params[intersect(f.params, names(params))]
>  }
>  do.call(f, safe.params)
> }
>
> I hope to use safe.call to prevent a wide class of potential bugs in ggplot2.
>
> Hadley
>
> --
> http://had.co.nz/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From h.wickham at gmail.com  Tue Jan 29 16:26:24 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Tue, 29 Jan 2008 09:26:24 -0600
Subject: [Rd] A "safe" do.call
In-Reply-To: <alpine.LFD.1.00.0801290525250.23305@gannet.stats.ox.ac.uk>
References: <f8e6ff050801281819l223d85deu458c67fd6e0b3693@mail.gmail.com>
	<f8e6ff050801281830m3a46e884j715611fed13cf3a8@mail.gmail.com>
	<alpine.LFD.1.00.0801290525250.23305@gannet.stats.ox.ac.uk>
Message-ID: <f8e6ff050801290726u6d07dd3fy4a476aa89e958094@mail.gmail.com>

> > Or is this a bug in glm?  It certainly seems that the documentation
> > should mention that ... is passed to glm.control, which only takes
> > three arguments.  I realise that this doesn't come up very often
> > during an interactive model fitting session, and it is easy to remedy
> > when it does, but it makes writing robust functions hard when a
> > function with ... does in fact have a fixed argument list.
>
> I think the docmentation has conflated '...' for glm and '...' for
> weights.
>
> My recollection is that this was intentional: at least one core developer
> used to dislike '...' as it allowed mistyped argument names to be ignored.
> And he has a good point, IMO.

That seems a perfectly good reason not to use ... - but if you are
going to use ... it seems like you shouldn't warn on mismatched
argument names.  Maybe I can attack the problem in the opposite
direction - instead of matching the parameters of the function I'm
calling, I'll try and remove the parameters that probably belong to
ggplot.

Hadley

-- 
http://had.co.nz/


From bacycho at korea.com  Tue Jan 29 07:25:25 2008
From: bacycho at korea.com (bacycho at korea.com)
Date: Tue, 29 Jan 2008 07:25:25 +0100 (CET)
Subject: [Rd] "ROracle" Packages is not to be installed (PR#10652)
Message-ID: <20080129062525.63CEF2834620@mail.pubhealth.ku.dk>

Full_Name: JinNyong Huh
Version: 2.6.1
OS: Linux(SUSE-9.0)
Submission from: (NULL) (220.75.209.235)


ROracle Packages is not to be installed in my Linux.

The enviroments are as follows:
* O/S Profile
[
export ORACLE_BASE=/opt/oracle

export ORACLE_SID=DEMO10G
export ORACLE_HOME=$ORACLE_BASE/product/10g
export ORACLE_DOC=$ORACLE_HOME/doc
export ORACLE_TERM=vt220
export TERM=vt100
export NLS_LANG=AMERICAN_AMERICA.KO16KSC5601
export ORA_NLS10=$ORACLE_HOME/nls/data
export ORA_NLS33=$ORACLE_HOME/ocommon/nls/admin/data
export ORA_CLIENT_LIB=shared
export TNS_ADMIN=$ORACLE_HOME/network/admin
export PATH=$ORACLE_HOME/bin:.:/opt/R-2.6.1-patched/bin:$PATH
export LIBPATH=$ORACLE_HOME/lib:/usr/lib:/lib:/usr/local/lib
export SHLIB_PATH=/home/ofsa45/ofsa4.5-092-linux/lib:$ORACLE_HOME/lib
export LD_LIBRARY_PATH=/home/ofsa45/ofsa4.5-092-linux/lib:$ORACLE_HOME/lib:/usr/lib:/lib:/usr/local/lib
export LANG=C
export TMP=$ORACLE_HOME/tmp
export TEMP=$ORACLE_HOME/tmp

export R_HOME=/opt/R-2.6.1-patched
export R_LIBS=/opt/R-2.6.1-patched/lib

stty erase ^H
set -o vi

alias src='cd $HOME/dev/src'
alias include='cd $HOME/dev/include'
alias bin='cd $HOME/dev/bin'
alias mak='cd $HOME/dev/mak'
alias lib='cd $HOME/dev/lib'

#stty -parenb -istrip -ixany cs8
export PS1='['''$USER''':''$PWD'']'

export CVSROOT=:pserver:jcs at 147.46.153.178:/oracle/cvs/repository
]

And I has made R-executable and run that.

After logging into R-Prompt, I has inputted the commands as follows
* Commands
[
options(CRAN = "http://cran.us.r-project.org/")
install.packages("ROracle") 
]

But I has met the messages like followings and the packages "ROracle" was not
installed.

* Messages
[
* Installing *source* package 'ROracle' ...
checking for gcc... gcc
checking for C compiler default output... a.out
checking whether the C compiler works... yes
checking whether we are cross compiling... no
checking for suffix of executables...
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ANSI C... none needed
checking how to run the C preprocessor... gcc -E
configure: creating ./config.status
config.status: creating src/Makevars
config.status: creating src/Makefile
** libs
** arch -
make: Warning: File `/opt/R-2.6.1-patched/share/make/vars.mk' has modification
time 7.2e+06 s in the future
R CMD COMPILE RS-DBI.c
make[1]: Entering directory `/tmp/R.INSTALL.Po4474/ROracle/src'
make[1]: Warning: File `/opt/R-2.6.1-patched/share/make/vars.mk' has
modification time 7.2e+06 s in the future
gcc -std=gnu99 -I/opt/R-2.6.1-patched/include -I/opt/R-2.6.1-patched/include
-DRS_ORA_SQLGLS_WORKAROUND -I/usr/local/include    -fpic  -g -O2 -c RS-DBI.c -o
RS-DBI.o
RS-DBI.c: In function `RS_DBI_makeSQLNames':
RS-DBI.c:1175: warning: assignment discards qualifiers from pointer target type
RS-DBI.c:1188: warning: implicit declaration of function `isalpha'
RS-DBI.c: In function `RS_na_set':
RS-DBI.c:1226: warning: assignment discards qualifiers from pointer target type
make[1]: warning:  Clock skew detected.  Your build may be incomplete.
make[1]: Leaving directory `/tmp/R.INSTALL.Po4474/ROracle/src'
proc CODE=ANSI_C MODE=ORACLE INCLUDE=/opt/R-2.6.1-patched/include \
                PARSE=NONE LINES=false PREFETCH=1 RS-Oracle.pc

Pro*C/C++: Release 10.2.0.1.0 - Production on Wed Nov 7 05:54:06 2007

Copyright (c) 1982, 2005, Oracle.  All rights reserved.

System default option values taken from:
/opt/oracle/product/10g/precomp/admin/pcscfg.cfg
R CMD COMPILE RS-Oracle.c
make[1]: Entering directory `/tmp/R.INSTALL.Po4474/ROracle/src'
make[1]: Warning: File `/opt/R-2.6.1-patched/share/make/vars.mk' has
modification time 7.2e+06 s in the future
gcc -std=gnu99 -I/opt/R-2.6.1-patched/include -I/opt/R-2.6.1-patched/include
-DRS_ORA_SQLGLS_WORKAROUND -I/usr/local/include    -fpic  -g -O2 -c RS-Oracle.c
-o RS-Oracle.o
RS-Oracle.c: In function `RS_Ora_prepareStatement':
RS-Oracle.c:2382: warning: implicit declaration of function `isalpha'
RS-Oracle.c:2383: warning: implicit declaration of function `toupper'
RS-Oracle.c:2385: warning: implicit declaration of function `isgraph'
RS-Oracle.c: In function `RS_Ora_setSToOraMappings':
RS-Oracle.c:4673: warning: implicit declaration of function `isdigit'
RS-Oracle.c: In function `RS_Ora_cpyDataFrameToOra':
RS-Oracle.c:4849: warning: assignment discards qualifiers from pointer target
type
RS-Oracle.c: In function `RS_SclassNames_To_StypeIds':
RS-Oracle.c:6569: warning: assignment discards qualifiers from pointer target
type
make[1]: warning:  Clock skew detected.  Your build may be incomplete.
make[1]: Leaving directory `/tmp/R.INSTALL.Po4474/ROracle/src'
R CMD SHLIB -o ROracle.so RS-DBI.o RS-Oracle.o
make[1]: Entering directory `/tmp/R.INSTALL.Po4474/ROracle/src'
make[1]: Warning: File `/opt/R-2.6.1-patched/share/make/vars.mk' has
modification time 7.2e+06 s in the future
gcc -std=gnu99 -shared -L/usr/local/lib -o ROracle.so RS-DBI.o RS-Oracle.o
-L/opt/oracle/product/10g/lib -L/opt/oracle/product/10g/network/lib -lclntst10
-lnbeq10 -lnhost10 -lnu
s10 -lnldap10 -lldapclnt10 -lnsslb10 -lntcp10 -lntcps10 -lnsslb10 -lntcp10
-lntns10 -ldl -lm -lpthread -lnsl -lirc -ldl -lm
/opt/oracle/product/10g/lib/libclntst10.a: file not recognized: File truncated
collect2: ld returned 1 exit status
make[1]: *** [ROracle.so] Error 1
make[1]: Leaving directory `/tmp/R.INSTALL.Po4474/ROracle/src'
make: *** [ROracle.so] Error 2
ERROR: compilation failed for package 'ROracle'
** Removing '/opt/R-2.6.1-patched/library/ROracle'

The downloaded packages are in
        /tmp/Rtmpf9ISDj/downloaded_packages
Updating HTML index of packages in '.Library'
Warning message:
In install.packages("ROracle") :
  installation of package 'ROracle' had non-zero exit status
]

Could you give me any solution on this?

Thank you in advance.


From hin-tak.leung at cimr.cam.ac.uk  Tue Jan 29 21:11:07 2008
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Tue, 29 Jan 2008 20:11:07 +0000
Subject: [Rd] Problem building R with Intel MKL v10 BLAS
In-Reply-To: <alpine.LFD.1.00.0801290448060.23305@gannet.stats.ox.ac.uk>
References: <47993905.9000206@mit.edu> <479A03AE.4070107@cimr.cam.ac.uk>
	<479A1492.1010901@mit.edu>
	<alpine.LFD.1.00.0801251824560.9123@gannet.stats.ox.ac.uk>
	<479E50C6.2050906@cimr.cam.ac.uk>
	<alpine.LFD.1.00.0801290448060.23305@gannet.stats.ox.ac.uk>
Message-ID: <479F885B.20508@cimr.cam.ac.uk>

Prof Brian Ripley wrote:
> On Mon, 28 Jan 2008, Hin-Tak Leung wrote:
> 
>> Prof Brian Ripley wrote:
>>> On Fri, 25 Jan 2008, Michael Braun wrote:
>>>
>>>> Thanks for everyone's help.  Unfortunately, still no success.  So I 
>>>> took the alternate route suggested in section A.3.1.5 of R-admin, 
>>>> and just created a symbolic link from libRblas.so to 
>>>> .../libmkl_gf_lp64.so.  I can still multiply 2 matrices together in 
>>>> R, so it looks like this is working. Can you propose any other test 
>>>> to be sure?
>>>
>>> Run 'make check' ... it includes some tests specifically for working 
>>> BLAS.
>> <snipped>
>>
>> That reminds me of a discussion I had with our IT guy regarding 
>> building R 2.5.0 against MKL 8. He had MKL 8.0 against 2.4.x 
>> previously and it is
>> actually faster than 9.x ; but he was having trouble upgrading to R
>> 2.5.0 (with MKL 8).
>>
>> It turns out that R 2.5.0 added a couple of checks for some
>> double-complex BLAS/LAPACK routines (I can't remember which), which 
>> are missing in MKL8, so it is a fact that R 2.5.0 won't build against 
>> MKL 8 - but will build against MKL 9, and once you have built 2.5.0 
>> against MKL9, you can swap the libraries (somewhat dangerously) to get 
>> the speed
>> of MKL8 back...
>>
>> It is not unthinkable that some more checks are added in 2.6.x and
>> MKL 10 is not passing them... one needs the result of config.log to be 
>> sure.
> 
> Looking at the svn logs, the last change to the BLAS configure tests was 
> in Nov 2005.
> 

That would be in the R 2.2 <-> R 2.3 time frame (maybe our IT guys was 
having problem jumping from 2.2 to 2.5)... Anyway, I am quite sure about
the R 2.5 + MKL 8 failure as I had looked at the config.log myself then.
To see what's wrong with the original poster's set up one needs to look
at the config.log .


From dhinds at sonic.net  Wed Jan 30 00:23:11 2008
From: dhinds at sonic.net (dhinds at sonic.net)
Date: Tue, 29 Jan 2008 23:23:11 +0000 (UTC)
Subject: [Rd] "ROracle" Packages is not to be installed (PR#10652)
References: <20080129062525.63CEF2834620@mail.pubhealth.ku.dk>
Message-ID: <fnocgv$iqj$1@ger.gmane.org>

bacycho at korea.com wrote:

> /opt/oracle/product/10g/lib/libclntst10.a: file not recognized: File truncated

Here:

    http://osdir.com/ml/lang.r.mac/2006-08/msg00031.html

I found a suggestion to do this:

    $ cd $ORACLE_HOME/bin
    $ ./genclntst

-- Dave


From hpages at fhcrc.org  Wed Jan 30 00:40:32 2008
From: hpages at fhcrc.org (Herve Pages)
Date: Tue, 29 Jan 2008 15:40:32 -0800
Subject: [Rd] Problem with new("externalptr")
Message-ID: <479FB970.2060303@fhcrc.org>

Hi,

It seems that new("externalptr") is always returning the same instance, and
not a new one as one would expect from a call to new(). Of course this is hard
to observe:

  > new("externalptr")
  <pointer: (nil)>
  > new("externalptr")
  <pointer: (nil)>

since not a lot of details are displayed.

For example, it's easy to see that 2 consecutive calls to new("environment")
create different instances:

  > new("environment")
  <environment: 0xc89d10>
  > new("environment")
  <environment: 0xc51248>

But for new("externalptr"), I had to use the following C routine:

  SEXP sexp_address(SEXP s)
  {
        SEXP ans;
        char buf[40];

        snprintf(buf, sizeof(buf), "%p", s);
        PROTECT(ans = NEW_CHARACTER(1));
        SET_STRING_ELT(ans, 0, mkChar(buf));
        UNPROTECT(1);
        return ans;
  }

Then I get:

  > .Call("sexp_address", new("externalptr"))
  [1] "0xde2ce0"
  > .Call("sexp_address", new("externalptr"))
  [1] "0xde2ce0"

Isn't that wrong?

I worked around this problem by writing the following C routine:

  SEXP xp_new()
  {
        return R_MakeExternalPtr(NULL, R_NilValue, R_NilValue);
  }

so I can create new "externalptr" instances from R with:

  .Call("xp_new")

I understand that there is not much you can do from R with an "externalptr"
instance and that you will have to manipulate them at the C level anyway.
But since new("externalptr") exists and seems to work, wouldn't that be
better if it was really creating a new instance at each call?

Thanks!
H.


From hpages at fhcrc.org  Wed Jan 30 02:03:18 2008
From: hpages at fhcrc.org (Herve Pages)
Date: Tue, 29 Jan 2008 17:03:18 -0800
Subject: [Rd] Problem with new("externalptr")
In-Reply-To: <479FB970.2060303@fhcrc.org>
References: <479FB970.2060303@fhcrc.org>
Message-ID: <479FCCD6.3090700@fhcrc.org>

Hi again,

Here is an example of an annoyance that I think is directly related to the
problem with new("externalptr"). When you try to extend the "externalptr" class:

  > setClass("ExternalInteger", contains="externalptr")
  [1] "ExternalInteger"

then every call to new("ExternalInteger") will return the same instance too.

I've tried to define an "initialize" method for "ExternalInteger" objects, but,
whatever I do, I end up with the same "ExternalInteger" instance. So in the end
I had to define the "ExternalInteger" class this way:

  > setClass("ExternalInteger", representation(xp="externalptr"))

even if I'd really like to be able to use the "is a" semantic and not the "has a"
semantic.

Then I use my xp_new() C routine (see previous post) for initializing the xp slot:

  setMethod("initialize", "ExternalInteger",
    function(.Object, ...)
    {
        .Object at xp <- .Call("xp_new")
        ...
        .Object
    }
  )

Then everytime I need to pass an "ExternalInteger" instance x to a C routine,
I need to perform one extra step to reach the externalptr (need to pass x at xp to
the routine instead of x itself).

So unfortunately, things are quite ugly and more painful than necessary.

Thanks,
H.


Herve Pages wrote:
> Hi,
> 
> It seems that new("externalptr") is always returning the same instance, and
> not a new one as one would expect from a call to new(). Of course this is hard
> to observe:
> 
>   > new("externalptr")
>   <pointer: (nil)>
>   > new("externalptr")
>   <pointer: (nil)>
> 
> since not a lot of details are displayed.
> 
> For example, it's easy to see that 2 consecutive calls to new("environment")
> create different instances:
> 
>   > new("environment")
>   <environment: 0xc89d10>
>   > new("environment")
>   <environment: 0xc51248>
> 
> But for new("externalptr"), I had to use the following C routine:
> 
>   SEXP sexp_address(SEXP s)
>   {
>         SEXP ans;
>         char buf[40];
> 
>         snprintf(buf, sizeof(buf), "%p", s);
>         PROTECT(ans = NEW_CHARACTER(1));
>         SET_STRING_ELT(ans, 0, mkChar(buf));
>         UNPROTECT(1);
>         return ans;
>   }
> 
> Then I get:
> 
>   > .Call("sexp_address", new("externalptr"))
>   [1] "0xde2ce0"
>   > .Call("sexp_address", new("externalptr"))
>   [1] "0xde2ce0"
> 
> Isn't that wrong?
> 
> I worked around this problem by writing the following C routine:
> 
>   SEXP xp_new()
>   {
>         return R_MakeExternalPtr(NULL, R_NilValue, R_NilValue);
>   }
> 
> so I can create new "externalptr" instances from R with:
> 
>   .Call("xp_new")
> 
> I understand that there is not much you can do from R with an "externalptr"
> instance and that you will have to manipulate them at the C level anyway.
> But since new("externalptr") exists and seems to work, wouldn't that be
> better if it was really creating a new instance at each call?
> 
> Thanks!
> H.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From luke at stat.uiowa.edu  Wed Jan 30 02:09:56 2008
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Tue, 29 Jan 2008 19:09:56 -0600 (CST)
Subject: [Rd] Problem with new("externalptr")
In-Reply-To: <479FCCD6.3090700@fhcrc.org>
References: <479FB970.2060303@fhcrc.org> <479FCCD6.3090700@fhcrc.org>
Message-ID: <Pine.LNX.4.64.0801291906570.17475@localhost.localdomain>

On Tue, 29 Jan 2008, Herve Pages wrote:

> Hi again,
>
> Here is an example of an annoyance that I think is directly related to the
> problem with new("externalptr"). When you try to extend the "externalptr" class:

You don't wnat to do that for the same reason you don't want to do it
with environments: Like environment external pointers are reference
objects, so things like unclass and other attribute changes end up
being destructive.  Create the thing you want as a list wrapper around
the external pointer.  You'll be a lot happier with the result in the
long run.

luke


>
>  > setClass("ExternalInteger", contains="externalptr")
>  [1] "ExternalInteger"
>
> then every call to new("ExternalInteger") will return the same instance too.
>
> I've tried to define an "initialize" method for "ExternalInteger" objects, but,
> whatever I do, I end up with the same "ExternalInteger" instance. So in the end
> I had to define the "ExternalInteger" class this way:
>
>  > setClass("ExternalInteger", representation(xp="externalptr"))
>
> even if I'd really like to be able to use the "is a" semantic and not the "has a"
> semantic.
>
> Then I use my xp_new() C routine (see previous post) for initializing the xp slot:
>
>  setMethod("initialize", "ExternalInteger",
>    function(.Object, ...)
>    {
>        .Object at xp <- .Call("xp_new")
>        ...
>        .Object
>    }
>  )
>
> Then everytime I need to pass an "ExternalInteger" instance x to a C routine,
> I need to perform one extra step to reach the externalptr (need to pass x at xp to
> the routine instead of x itself).
>
> So unfortunately, things are quite ugly and more painful than necessary.
>
> Thanks,
> H.
>
>
> Herve Pages wrote:
>> Hi,
>>
>> It seems that new("externalptr") is always returning the same instance, and
>> not a new one as one would expect from a call to new(). Of course this is hard
>> to observe:
>>
>>  > new("externalptr")
>>   <pointer: (nil)>
>>  > new("externalptr")
>>   <pointer: (nil)>
>>
>> since not a lot of details are displayed.
>>
>> For example, it's easy to see that 2 consecutive calls to new("environment")
>> create different instances:
>>
>>  > new("environment")
>>   <environment: 0xc89d10>
>>  > new("environment")
>>   <environment: 0xc51248>
>>
>> But for new("externalptr"), I had to use the following C routine:
>>
>>   SEXP sexp_address(SEXP s)
>>   {
>>         SEXP ans;
>>         char buf[40];
>>
>>         snprintf(buf, sizeof(buf), "%p", s);
>>         PROTECT(ans = NEW_CHARACTER(1));
>>         SET_STRING_ELT(ans, 0, mkChar(buf));
>>         UNPROTECT(1);
>>         return ans;
>>   }
>>
>> Then I get:
>>
>>  > .Call("sexp_address", new("externalptr"))
>>   [1] "0xde2ce0"
>>  > .Call("sexp_address", new("externalptr"))
>>   [1] "0xde2ce0"
>>
>> Isn't that wrong?
>>
>> I worked around this problem by writing the following C routine:
>>
>>   SEXP xp_new()
>>   {
>>         return R_MakeExternalPtr(NULL, R_NilValue, R_NilValue);
>>   }
>>
>> so I can create new "externalptr" instances from R with:
>>
>>   .Call("xp_new")
>>
>> I understand that there is not much you can do from R with an "externalptr"
>> instance and that you will have to manipulate them at the C level anyway.
>> But since new("externalptr") exists and seems to work, wouldn't that be
>> better if it was really creating a new instance at each call?
>>
>> Thanks!
>> H.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From hpages at fhcrc.org  Wed Jan 30 03:14:12 2008
From: hpages at fhcrc.org (Herve Pages)
Date: Tue, 29 Jan 2008 18:14:12 -0800
Subject: [Rd] Problem with new("externalptr")
In-Reply-To: <Pine.LNX.4.64.0801291906570.17475@localhost.localdomain>
References: <479FB970.2060303@fhcrc.org> <479FCCD6.3090700@fhcrc.org>
	<Pine.LNX.4.64.0801291906570.17475@localhost.localdomain>
Message-ID: <479FDD74.90905@fhcrc.org>

Luke Tierney wrote:
> On Tue, 29 Jan 2008, Herve Pages wrote:
> 
>> Hi again,
>>
>> Here is an example of an annoyance that I think is directly related to
>> the
>> problem with new("externalptr"). When you try to extend the
>> "externalptr" class:
> 
> You don't wnat to do that for the same reason you don't want to do it
> with environments: Like environment external pointers are reference
> objects, so things like unclass and other attribute changes end up
> being destructive.  Create the thing you want as a list wrapper around
> the external pointer.  You'll be a lot happier with the result in the
> long run.

Thanks Luke!

As you've probably seen further below in my post, wrapping instead of extending
is indeed what I'm doing. And I'm explaining why I don't really have the choice
right now.
I understand why, generally speaking, you would recommend wrapping instead of
extending, but, given the context where I'm making use of those external pointers
(the "ExternalInteger" class itself is not exported, only used internally as slots
of higher level objects, never accessed directly, etc..., etc...), I don't think
extending would actually be a problem.

Unfortunately, because of the problem with new("externalptr"), I can't even
experiment the "extending" approach, test it, compare it with the "wrapping"
approach, etc... and make my own opinion.
And even if I stick with the "wrapping" approach, it would help to have
new("externalptr") doing what I think is the right thing to do.

Cheers,
H.


> 
> luke
> 
> 
>>
>>  > setClass("ExternalInteger", contains="externalptr")
>>  [1] "ExternalInteger"
>>
>> then every call to new("ExternalInteger") will return the same
>> instance too.
>>
>> I've tried to define an "initialize" method for "ExternalInteger"
>> objects, but,
>> whatever I do, I end up with the same "ExternalInteger" instance. So
>> in the end
>> I had to define the "ExternalInteger" class this way:
>>
>>  > setClass("ExternalInteger", representation(xp="externalptr"))
>>
>> even if I'd really like to be able to use the "is a" semantic and not
>> the "has a"
>> semantic.
>>
>> Then I use my xp_new() C routine (see previous post) for initializing
>> the xp slot:
>>
>>  setMethod("initialize", "ExternalInteger",
>>    function(.Object, ...)
>>    {
>>        .Object at xp <- .Call("xp_new")
>>        ...
>>        .Object
>>    }
>>  )
>>
>> Then everytime I need to pass an "ExternalInteger" instance x to a C
>> routine,
>> I need to perform one extra step to reach the externalptr (need to
>> pass x at xp to
>> the routine instead of x itself).
>>
>> So unfortunately, things are quite ugly and more painful than necessary.
>>
>> Thanks,
>> H.
>>
>>
>> Herve Pages wrote:
>>> Hi,
>>>
>>> It seems that new("externalptr") is always returning the same
>>> instance, and
>>> not a new one as one would expect from a call to new(). Of course
>>> this is hard
>>> to observe:
>>>
>>>  > new("externalptr")
>>>   <pointer: (nil)>
>>>  > new("externalptr")
>>>   <pointer: (nil)>
>>>
>>> since not a lot of details are displayed.
>>>
>>> For example, it's easy to see that 2 consecutive calls to
>>> new("environment")
>>> create different instances:
>>>
>>>  > new("environment")
>>>   <environment: 0xc89d10>
>>>  > new("environment")
>>>   <environment: 0xc51248>
>>>
>>> But for new("externalptr"), I had to use the following C routine:
>>>
>>>   SEXP sexp_address(SEXP s)
>>>   {
>>>         SEXP ans;
>>>         char buf[40];
>>>
>>>         snprintf(buf, sizeof(buf), "%p", s);
>>>         PROTECT(ans = NEW_CHARACTER(1));
>>>         SET_STRING_ELT(ans, 0, mkChar(buf));
>>>         UNPROTECT(1);
>>>         return ans;
>>>   }
>>>
>>> Then I get:
>>>
>>>  > .Call("sexp_address", new("externalptr"))
>>>   [1] "0xde2ce0"
>>>  > .Call("sexp_address", new("externalptr"))
>>>   [1] "0xde2ce0"
>>>
>>> Isn't that wrong?
>>>
>>> I worked around this problem by writing the following C routine:
>>>
>>>   SEXP xp_new()
>>>   {
>>>         return R_MakeExternalPtr(NULL, R_NilValue, R_NilValue);
>>>   }
>>>
>>> so I can create new "externalptr" instances from R with:
>>>
>>>   .Call("xp_new")
>>>
>>> I understand that there is not much you can do from R with an
>>> "externalptr"
>>> instance and that you will have to manipulate them at the C level
>>> anyway.
>>> But since new("externalptr") exists and seems to work, wouldn't that be
>>> better if it was really creating a new instance at each call?
>>>
>>> Thanks!
>>> H.
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From mwkimpel at gmail.com  Wed Jan 30 05:14:30 2008
From: mwkimpel at gmail.com (Mark W Kimpel)
Date: Tue, 29 Jan 2008 23:14:30 -0500
Subject: [Rd] R package Matrix failing to build with R-devel on Ubuntu AMD64
Message-ID: <479FF9A6.7050005@gmail.com>

Switched back to R-devel tonight after using R-2.6.1 for awhile and when 
I updated my devel packages Matrix installation failed. Not critical for 
me but thought I should report it. I am using Ubuntu Gusty AMD64 OS. 
Tail of install output and sessionInfo follows. Mark

Loading required package: methods
Loading required package: lattice

Attaching package: 'Matrix'


         The following object(s) are masked from package:stats :

          xtabs

Error in new("dgCMatrix") :
   trying to generate an object from a virtual class ("dgCMatrix")
Calls: <Anonymous> ... eval.parent -> eval -> eval -> eval -> eval -> 
new -> .Call
Execution halted
ERROR: installing package indices failed
** Removing '/home/mkimpel/R_HOME/site-library/Matrix'
** Restoring previous '/home/mkimpel/R_HOME/site-library/Matrix'

The downloaded packages are in
         /tmp/RtmpJviXfF/downloaded_packages
Warning message:
In install.packages("Matrix") :
   installation of package 'Matrix' had non-zero exit status
 > sessionInfo()
R version 2.7.0 Under development (unstable) (2008-01-29 r44238)
x86_64-unknown-linux-gnu

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] tools     stats     graphics  grDevices utils     datasets  methods
[8] base

other attached packages:
[1] Biobase_1.17.8

loaded via a namespace (and not attached):
[1] tcltk_2.7.0

-- 

Mark W. Kimpel MD  ** Neuroinformatics ** Dept. of Psychiatry
Indiana University School of Medicine

15032 Hunter Court, Westfield, IN  46074

(317) 490-5129 Work, & Mobile & VoiceMail
(317) 204-4202 Home (no voice mail please)

mwkimpel<at>gmail<dot>com


From rgentlem at fhcrc.org  Wed Jan 30 06:32:54 2008
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Tue, 29 Jan 2008 21:32:54 -0800
Subject: [Rd] Problem with new("externalptr")
In-Reply-To: <479FB970.2060303@fhcrc.org>
References: <479FB970.2060303@fhcrc.org>
Message-ID: <47A00C06.4080706@fhcrc.org>

Hi,

Herve Pages wrote:
> Hi,
> 
> It seems that new("externalptr") is always returning the same instance, and
> not a new one as one would expect from a call to new(). Of course this is hard
> to observe:
> 
>   > new("externalptr")
>   <pointer: (nil)>
>   > new("externalptr")
>   <pointer: (nil)>
> 
> since not a lot of details are displayed.
> 
> For example, it's easy to see that 2 consecutive calls to new("environment")
> create different instances:
> 
>   > new("environment")
>   <environment: 0xc89d10>
>   > new("environment")
>   <environment: 0xc51248>

   getMethod("initialize", "environment")
and

   getMethod("initialize", "externalptr")

  will give some hints about the difference.
> 
> But for new("externalptr"), I had to use the following C routine:
> 
>   SEXP sexp_address(SEXP s)
>   {
>         SEXP ans;
>         char buf[40];
> 
>         snprintf(buf, sizeof(buf), "%p", s);
>         PROTECT(ans = NEW_CHARACTER(1));
>         SET_STRING_ELT(ans, 0, mkChar(buf));
>         UNPROTECT(1);
>         return ans;
>   }
> 
> Then I get:
> 
>   > .Call("sexp_address", new("externalptr"))
>   [1] "0xde2ce0"
>   > .Call("sexp_address", new("externalptr"))
>   [1] "0xde2ce0"
> 
> Isn't that wrong?

   Not what you want, but not wrong. In the absence of an initialize 
method all calls to "new" are guaranteed to return the prototype; so I 
think it behaves as documented.

   new("environment") would also always return the same environment, 
were it not for the initialize method.  So you might want to contribute 
an initialize method for externalptr, but as you said, they are not 
useful at the R level so I don't know just what problem is being solved.

   This piece of code might be useful in such a construction
.Call("R_externalptr_prototype_object", PACKAGE = "methods")

  which does what you would like.

  best wishes
    Robert

> 
> I worked around this problem by writing the following C routine:
> 
>   SEXP xp_new()
>   {
>         return R_MakeExternalPtr(NULL, R_NilValue, R_NilValue);
>   }
> 
> so I can create new "externalptr" instances from R with:
> 
>   .Call("xp_new")
> 
> I understand that there is not much you can do from R with an "externalptr"
> instance and that you will have to manipulate them at the C level anyway.
> But since new("externalptr") exists and seems to work, wouldn't that be
> better if it was really creating a new instance at each call?
> 
> Thanks!
> H.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From nakama at ki.rim.or.jp  Wed Jan 30 09:03:54 2008
From: nakama at ki.rim.or.jp (Ei-ji Nakama)
Date: Wed, 30 Jan 2008 17:03:54 +0900
Subject: [Rd] Problem building R with Intel MKL v10 BLAS
In-Reply-To: <47993905.9000206@mit.edu>
References: <47993905.9000206@mit.edu>
Message-ID: <dc41e1260801300003w58da8908k7b73e694f8fa76e1@mail.gmail.com>

Hi.

2008/1/25, Michael Braun <braunm at mit.edu>:
> NO
>
> Hi.  I'm not sure if this is an R-help or R-devel problem, so I'm
> starting here in the hope that someone can help (and willing to go to
> the other list if it's more appropriate).  I think I am following all of
> the instructions in the various manuals, but clearly I am missing something.
>
> I have an Intel EM64T Dell with 2 dual-core Xeon processors running Red
> Hat EL5.  I would like to build R 2.6.1 with lots of debugging and
> profiling options, and link it to the processor-specific Intel MKL blas.
> The problem is that after I compile R, and do R CMD config BLAS_LIBS,
> the response is
> -L/usr/local/lib64/R/lib -lRblas.
>
> This tells me that R is not linked to the Intel BLAS at all.
>
> My config.site file for R is:
>
> #! /bin/sh
>
> R_PAPERSIZE=letter
> CFLAGS="-g -O2 -p -pg"
> CPPFLAGS="-I/opt/intel/mkl/10.0.1.014/include -I/usr/include
> -I/usr/local/include"
> LIBnn=lib64
> BLAS_LIBS="-L/opt/intel/mkl/10.0.1.014/lib/em64t -Wl,--start-group
> -lmkl_gf_lp64.so -lmkl_gnu_thread.so -lmkl_core.so -l -l -l -Wl,
> --end-group -lguide -lpthread -lm"

I have an AMD 64x2 Debian(etch)
$ gcc-4.2 -v
Using built-in specs.
Target: x86_64-linux-gnu
Configured with: ../gcc-4.2.2/configure -v
--enable-languages=c,c++,fortran,objc,obj-c++,treelang
--prefix=/usr/local/gcc-4.2.2 --enable-shared --disable-multilib
--with-system-zlib --without-included-gettext --enable-threads=posix
--enable-nls --program-suffix=-4.2 --enable-__cxa_atexit
--enable-clocale=gnu --enable-libstdcxx-debug --enable-mpfr
--enable-checking=release x86_64-linux-gnu
Thread model: posix
gcc version 4.2.2

MKL_LIB_PATH=/opt/intel/mkl/10.0.1.014/lib/em64t
MKL="   -L${MKL_LIB_PATH}                               \
        -Wl,--start-group                               \
                ${MKL_LIB_PATH}/libmkl_gf_lp64.a        \
                ${MKL_LIB_PATH}/libmkl_gnu_thread.a     \
                ${MKL_LIB_PATH}/libmkl_core.a           \
        -Wl,--end-group                                 \
        -liomp5 -lguide -lpthread -lgomp"

./configure CC=gcc-4.2\
        CXX=g++-4.2\
        F77=gfortran-4.2\
        FC=gfortran-4.2\
        --with-lapack="$MKL" --with-blas="$MKL"

mkl_core seemed to want to cause libiomp5. dgemm gave a funny result
in matrix of 1000x1000 if I did not link with real libiomp5.

-- 
EI-JI Nakama  <nakama at ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb"  <nakama at ki.rim.or.jp>


From jason at acm.org  Wed Jan 30 09:11:02 2008
From: jason at acm.org (jason at acm.org)
Date: Wed, 30 Jan 2008 00:11:02 -0800
Subject: [Rd] [rfc] Package to access the internal zlib library.
Message-ID: <874pcvu415.fsf@sparse.yi.org>

To make R.matlab's readMat work for me[1] I needed access to zlib's
uncompress function.  R already links with zlib, and sometime last
year I hobbled together a quick package to get at a few functions.
It's my first package, so I would love feedback both on the package
and its purpose.

I've dropped a temporary copy at
  http://jriedy.users.sonic.net/internalzlib_0.1.tar.gz

Could someone with Windows and knowledge of how to decypher Windows
problems test if it works for them?  I still need to try AIX as well.

Jason

Footnotes: 
[1]  I'm cleaning patches to send to the author shortly.  I think
I have readMat working for compressed data, UTF-*, and sparse
matrices now.


From ripley at stats.ox.ac.uk  Wed Jan 30 10:20:13 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 30 Jan 2008 09:20:13 +0000 (GMT)
Subject: [Rd] [rfc] Package to access the internal zlib library.
In-Reply-To: <874pcvu415.fsf@sparse.yi.org>
References: <874pcvu415.fsf@sparse.yi.org>
Message-ID: <alpine.LFD.1.00.0801300907480.6559@gannet.stats.ox.ac.uk>

On Wed, 30 Jan 2008, jason at acm.org wrote:

> To make R.matlab's readMat work for me[1] I needed access to zlib's
> uncompress function.  R already links with zlib, and sometime last

Not so: R can be linked to the system's zlib, and otherwise uses its own 
copy which is not intended for use by packages.

Please check what 'Writing R Extensions' says about using undocumented 
entry points in R.  Ideally none of zlib would be visible, but some 
packages have been making use of undocumented entry points and we took 
pity on them.

Your package will not work as it does not include the header zlib.h, and 
e.g. Windows does not have it.  Expecting the system's zlib.h to work with 
R's internal copy is unsafe.

The *only* safe thing to do is to include your own copy of zlib, and 
compile it into the package (optionally linking instead to the system copy 
if it exists).


> year I hobbled together a quick package to get at a few functions.
> It's my first package, so I would love feedback both on the package
> and its purpose.
>
> I've dropped a temporary copy at
>  http://jriedy.users.sonic.net/internalzlib_0.1.tar.gz
>
> Could someone with Windows and knowledge of how to decypher Windows
> problems test if it works for them?  I still need to try AIX as well.

Please note that Uwe Ligges provides a Windows testing service: see 
'Writing R Extensions' and the R-admin manual.  You don't need to ask 
others to do this for you.

>
> Jason
>
> Footnotes:
> [1]  I'm cleaning patches to send to the author shortly.  I think
> I have readMat working for compressed data, UTF-*, and sparse
> matrices now.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From duncan at wald.ucdavis.edu  Wed Jan 30 10:23:06 2008
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Wed, 30 Jan 2008 22:23:06 +1300
Subject: [Rd] [rfc] Package to access the internal zlib library.
In-Reply-To: <874pcvu415.fsf@sparse.yi.org>
References: <874pcvu415.fsf@sparse.yi.org>
Message-ID: <47A041FA.1060702@wald.ucdavis.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



There is also the Rcompression library from

www.omegahat.org/Rcompression

and directly available via install.packages()
from the  www.omegahat.org/R repository.

This deals with various compression schemes
and does things in memory.
Hopefully there isn't much overlap and the two
might be complementary.

~ D.

jason at acm.org wrote:
| To make R.matlab's readMat work for me[1] I needed access to zlib's
| uncompress function.  R already links with zlib, and sometime last
| year I hobbled together a quick package to get at a few functions.
| It's my first package, so I would love feedback both on the package
| and its purpose.
|
| I've dropped a temporary copy at
|   http://jriedy.users.sonic.net/internalzlib_0.1.tar.gz
|
| Could someone with Windows and knowledge of how to decypher Windows
| problems test if it works for them?  I still need to try AIX as well.
|
| Jason
|
| Footnotes:
| [1]  I'm cleaning patches to send to the author shortly.  I think
| I have readMat working for compressed data, UTF-*, and sparse
| matrices now.
|
| ______________________________________________
| R-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-devel
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.7 (Darwin)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFHoEH69p/Jzwa2QP4RAhbxAJ0e9KiZVrVlnSh14buN0YO0Ig15VACdF+U/
A+TrOmBEOqKpzBY7RTNBXms=
=6IGF
-----END PGP SIGNATURE-----


From maechler at stat.math.ethz.ch  Wed Jan 30 11:41:55 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 30 Jan 2008 11:41:55 +0100
Subject: [Rd] A "safe" do.call
In-Reply-To: <f8e6ff050801290726u6d07dd3fy4a476aa89e958094@mail.gmail.com>
References: <f8e6ff050801281819l223d85deu458c67fd6e0b3693@mail.gmail.com>
	<f8e6ff050801281830m3a46e884j715611fed13cf3a8@mail.gmail.com>
	<alpine.LFD.1.00.0801290525250.23305@gannet.stats.ox.ac.uk>
	<f8e6ff050801290726u6d07dd3fy4a476aa89e958094@mail.gmail.com>
Message-ID: <18336.21619.915655.397877@stat.math.ethz.ch>

>>>>> "hw" == hadley wickham <h.wickham at gmail.com>
>>>>>     on Tue, 29 Jan 2008 09:26:24 -0600 writes:

    >> > Or is this a bug in glm?  It certainly seems that the
    >> documentation > should mention that ... is passed to
    >> glm.control, which only takes > three arguments.  I
    >> realise that this doesn't come up very often > during an
    >> interactive model fitting session, and it is easy to
    >> remedy > when it does, but it makes writing robust
    >> functions hard when a > function with ... does in fact
    >> have a fixed argument list.
    >> 
    >> I think the docmentation has conflated '...' for glm and
    >> '...' for weights.
    >> 
    >> My recollection is that this was intentional: at least
    >> one core developer used to dislike '...' as it allowed
    >> mistyped argument names to be ignored.  And he has a good
    >> point, IMO.

    hw> That seems a perfectly good reason not to use ... - but
    hw> if you are going to use ... it seems like you shouldn't
    hw> warn on mismatched argument names.  

I disagree.

One "famous" example on this was -- in S-plus, early 1990s --
known about S users back then, and it happened here (as well),
not in theory: a scientist who later came for consulting to us
did a logistic regression

  mod1 <- glm(y ~ x1 + x2 + ....,  .......
	      data = ....., famliy = binomial)
  summary(mod1)
  ...

and was wondering about the logistic regression coefficients and
their interpretation and more things
until we found out the small typo above
which made glm() compute a ("gaussian") model even though the
user had clearly said he wanted a logistic one.

Can you see the point?
Martin

    hw> Maybe I can attack the problem in the opposite direction
    hw> - instead of matching the parameters of the function I'm
    hw> calling, I'll try and remove the parameters that
    hw> probably belong to ggplot.

    hw> Hadley

    hw> -- http://had.co.nz/


From P.Dalgaard at biostat.ku.dk  Wed Jan 30 12:00:07 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 30 Jan 2008 12:00:07 +0100
Subject: [Rd] R 2.6.2 scheduled for February 8
Message-ID: <47A058B7.6010501@biostat.ku.dk>

This is to announce that we plan to release R version 2.6.2 on  Friday,
February 8, 2008.

A couple of annoying bugs were discovered after 2.6.1, and given the
weakness of prerelease testing, we find it better to increase the number
of patch releases.

The source tarballs will be made available starting Friday (barring
build troubles) by a cron job running at 4AM CET, and the tarballs can
be picked up at http://cran.r-project.org/src/base-prerelease/ a little
later.  (Actually, the first one has already been made and can be
fetched from CRAN tomorrow or directly from
http://www.pubhealth.ku.dk/~pd/R-pre )

    For the Core Team
    Peter Dalgaard

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From murdoch at stats.uwo.ca  Wed Jan 30 14:36:35 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 30 Jan 2008 08:36:35 -0500
Subject: [Rd] [rfc] Package to access the internal zlib library.
In-Reply-To: <alpine.LFD.1.00.0801300907480.6559@gannet.stats.ox.ac.uk>
References: <874pcvu415.fsf@sparse.yi.org>
	<alpine.LFD.1.00.0801300907480.6559@gannet.stats.ox.ac.uk>
Message-ID: <47A07D63.30403@stats.uwo.ca>

On 1/30/2008 4:20 AM, Prof Brian Ripley wrote:
> On Wed, 30 Jan 2008, jason at acm.org wrote:
> 
>> To make R.matlab's readMat work for me[1] I needed access to zlib's
>> uncompress function.  R already links with zlib, and sometime last
> 
> Not so: R can be linked to the system's zlib, and otherwise uses its own 
> copy which is not intended for use by packages.
> 
> Please check what 'Writing R Extensions' says about using undocumented 
> entry points in R.  Ideally none of zlib would be visible, but some 
> packages have been making use of undocumented entry points and we took 
> pity on them.

rgl is one of those packages.  Over the last couple of days, I've been 
looking at linking it to freetype as well, to allow fonts to be 
specified in the displays.

This is taking me some time, because although freetype has lots of 
support for being built in diverse environments, the environment Rtools 
provides on Windows is different from all of those, and I'm not that 
familiar with debugging complicated GNU Makefiles.

Now it seems to me that some other package might want to make use of 
freetype.  Eventually they'll be able to copy what we do in rgl, but it 
would make more sense for me to wrap up freetype as an R package, so 
they can concentrate on whatever it is that interests them.  This 
package would have no R entry points, it would just package the headers 
libs and source in a standard way, so that other packages could choose 
to statically or dynamically link to it.  On platforms that provide 
freetype as a system library the package might build nothing at all, or 
a user might choose to install it (to get a particular version for 
static linking, for example.)

So would it be feasible to put together another R package type, that is 
essentially just a wrapper for a library like freetype or zlib?  (rgl 
also links to pnglib in R on Windows, also through undocumented methods.)

> Your package will not work as it does not include the header zlib.h, and 
> e.g. Windows does not have it.  Expecting the system's zlib.h to work with 
> R's internal copy is unsafe.

If we did have this new package type, then a zlib package could be part 
of base R, and other packages would have a well defined way to link to it.

Duncan Murdoch

> 
> The *only* safe thing to do is to include your own copy of zlib, and 
> compile it into the package (optionally linking instead to the system copy 
> if it exists).
> 
> 
>> year I hobbled together a quick package to get at a few functions.
>> It's my first package, so I would love feedback both on the package
>> and its purpose.
>>
>> I've dropped a temporary copy at
>>  http://jriedy.users.sonic.net/internalzlib_0.1.tar.gz
>>
>> Could someone with Windows and knowledge of how to decypher Windows
>> problems test if it works for them?  I still need to try AIX as well.
> 
> Please note that Uwe Ligges provides a Windows testing service: see 
> 'Writing R Extensions' and the R-admin manual.  You don't need to ask 
> others to do this for you.
> 
>>
>> Jason
>>
>> Footnotes:
>> [1]  I'm cleaning patches to send to the author shortly.  I think
>> I have readMat working for compressed data, UTF-*, and sparse
>> matrices now.
>


From h.wickham at gmail.com  Wed Jan 30 14:48:06 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Wed, 30 Jan 2008 07:48:06 -0600
Subject: [Rd] A "safe" do.call
In-Reply-To: <18336.21619.915655.397877@stat.math.ethz.ch>
References: <f8e6ff050801281819l223d85deu458c67fd6e0b3693@mail.gmail.com>
	<f8e6ff050801281830m3a46e884j715611fed13cf3a8@mail.gmail.com>
	<alpine.LFD.1.00.0801290525250.23305@gannet.stats.ox.ac.uk>
	<f8e6ff050801290726u6d07dd3fy4a476aa89e958094@mail.gmail.com>
	<18336.21619.915655.397877@stat.math.ethz.ch>
Message-ID: <f8e6ff050801300548m1bbe36dcl72bab45872bc8416@mail.gmail.com>

>     hw> That seems a perfectly good reason not to use ... - but
>     hw> if you are going to use ... it seems like you shouldn't
>     hw> warn on mismatched argument names.
>
> I disagree.
>
> One "famous" example on this was -- in S-plus, early 1990s --
> known about S users back then, and it happened here (as well),
> not in theory: a scientist who later came for consulting to us
> did a logistic regression
>
>   mod1 <- glm(y ~ x1 + x2 + ....,  .......
>               data = ....., famliy = binomial)
>   summary(mod1)
>   ...
>
> and was wondering about the logistic regression coefficients and
> their interpretation and more things
> until we found out the small typo above
> which made glm() compute a ("gaussian") model even though the
> user had clearly said he wanted a logistic one.
>
> Can you see the point?

The point is that glm shouldn't use ... but should explicitly list all
of the arguments that it takes?  Why does glm need to use ... in your
example?

If you know the set of possible arguments in advance, why not list
them explicitly and document them individually, and not use ... at
all?

Hadley

-- 
http://had.co.nz/


From ripley at stats.ox.ac.uk  Wed Jan 30 15:27:55 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 30 Jan 2008 14:27:55 +0000 (GMT)
Subject: [Rd] A "safe" do.call
In-Reply-To: <f8e6ff050801300548m1bbe36dcl72bab45872bc8416@mail.gmail.com>
References: <f8e6ff050801281819l223d85deu458c67fd6e0b3693@mail.gmail.com>
	<f8e6ff050801281830m3a46e884j715611fed13cf3a8@mail.gmail.com>
	<alpine.LFD.1.00.0801290525250.23305@gannet.stats.ox.ac.uk>
	<f8e6ff050801290726u6d07dd3fy4a476aa89e958094@mail.gmail.com>
	<18336.21619.915655.397877@stat.math.ethz.ch>
	<f8e6ff050801300548m1bbe36dcl72bab45872bc8416@mail.gmail.com>
Message-ID: <alpine.LFD.1.00.0801301421380.28684@gannet.stats.ox.ac.uk>

This is a 'White Book' function, not really ours to re-design.
(Although the glm help page in the White Book's description of '...' never 
was correct of any S-PLUS that I used, and doesn't make a great deal of 
sense.)

I never really saw the point of glm.control(), but it might have allowed 
for future expansion that never happened.

On Wed, 30 Jan 2008, hadley wickham wrote:

>>     hw> That seems a perfectly good reason not to use ... - but
>>     hw> if you are going to use ... it seems like you shouldn't
>>     hw> warn on mismatched argument names.
>>
>> I disagree.
>>
>> One "famous" example on this was -- in S-plus, early 1990s --
>> known about S users back then, and it happened here (as well),
>> not in theory: a scientist who later came for consulting to us
>> did a logistic regression
>>
>>   mod1 <- glm(y ~ x1 + x2 + ....,  .......
>>               data = ....., famliy = binomial)
>>   summary(mod1)
>>   ...
>>
>> and was wondering about the logistic regression coefficients and
>> their interpretation and more things
>> until we found out the small typo above
>> which made glm() compute a ("gaussian") model even though the
>> user had clearly said he wanted a logistic one.
>>
>> Can you see the point?
>
> The point is that glm shouldn't use ... but should explicitly list all
> of the arguments that it takes?  Why does glm need to use ... in your
> example?
>
> If you know the set of possible arguments in advance, why not list
> them explicitly and document them individually, and not use ... at
> all?
>
> Hadley
>
> --
> http://had.co.nz/
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jayemerson at gmail.com  Wed Jan 30 16:20:26 2008
From: jayemerson at gmail.com (Jay Emerson)
Date: Wed, 30 Jan 2008 10:20:26 -0500
Subject: [Rd] Understanding an R improvement that already occurred.
Message-ID: <d4588dec0801300720w6dcbe678qef58722d98bf97e6@mail.gmail.com>

I was surprised to observe the following difference between 2.4.1 and
2.6.0 after a long overdue upgrade a few months ago of our
departmental server.  It wasn't a bug fix, but a subtle improvement.
Here's the simplest example I could create.  The size is excessive, on
the order of the Netflix Competition data.

The integer matrix is about 1.12 GB, and if coerced to numeric it is
2.24 GB.  The peak memory consumption of the first (old) operation was
1.2 + 2.24 + 2.24 = 5.6 GB.  The peak memory consumption of the second
(new) operation is 1.12 + 2.24 = 3.36 GB.  (See below)

In contrast, if a numeric matrix is used, there are no differences
between the versions (so the improvement seems related to the integer
type or the decision when/how to do the coercion).  And of course I
realize that x <- x + as.integer(1) is an option, but that isn't the
point of this exercise.

I'm curious, but also spending time on memory-related work.  Someone
deserves a 'thank you' and a pat on the pack for making this sort of
improvement.  Surely someone can step forward and take a bow, and
perhaps explain the nature of the improvement?

On a related note, a new package bigmemoRy will be available soon,
handling massive matrices of double, integer, short, or char in RAM.
In Unix (sorry, Windows), these matrices can also be used with shared
memory (with mutexes implemented) for parallel processing.  It's a
niche market, obviously, ideal for data larger than 1 GB (roughly) but
still within the boundaries of the RAM.  It may be a useful developer
tool for big-data problems.

------------------------
R version 2.4.1 (linux):
> x <- matrix(as.integer(0), 1e+08, 3)
> x <- x + 1
> gc()
           used   (Mb) gc trigger (Mb)  max used   (Mb)
Ncells    233754   12.5     467875   25    350000   18.7
Vcells 300119431 2289.8  787870506 6011 750119944 5723.0
------------------------
R version 2.6.0 (linux):
> x <- matrix(as.integer(0), 1e+08, 3)
> x <- x + 1
> gc()
           used   (Mb) gc trigger   (Mb)  max used   (Mb)
Ncells    137931    7.4     350000   18.7    350000   18.7
Vcells 300126402 2289.8  472877829 3607.8 450126789 3434.2


-- 
John W. Emerson (Jay)
Assistant Professor of Statistics
Director of Graduate Studies (on leave 07-08)
Department of Statistics
Yale University
http://www.stat.yale.edu/~jay
Statistical Consultant, REvolution Computing


From hb at stat.berkeley.edu  Wed Jan 30 16:53:47 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Wed, 30 Jan 2008 07:53:47 -0800
Subject: [Rd] Understanding an R improvement that already occurred.
In-Reply-To: <d4588dec0801300720w6dcbe678qef58722d98bf97e6@mail.gmail.com>
References: <d4588dec0801300720w6dcbe678qef58722d98bf97e6@mail.gmail.com>
Message-ID: <59d7961d0801300753n44a17c8bnc667644f6d656e47@mail.gmail.com>

On Jan 30, 2008 7:20 AM, Jay Emerson <jayemerson at gmail.com> wrote:
> I was surprised to observe the following difference between 2.4.1 and
> 2.6.0 after a long overdue upgrade a few months ago of our
> departmental server.  It wasn't a bug fix, but a subtle improvement.
> Here's the simplest example I could create.  The size is excessive, on
> the order of the Netflix Competition data.
>
> The integer matrix is about 1.12 GB, and if coerced to numeric it is
> 2.24 GB.  The peak memory consumption of the first (old) operation was
> 1.2 + 2.24 + 2.24 = 5.6 GB.  The peak memory consumption of the second
> (new) operation is 1.12 + 2.24 = 3.36 GB.  (See below)
>
> In contrast, if a numeric matrix is used, there are no differences
> between the versions (so the improvement seems related to the integer
> type or the decision when/how to do the coercion).  And of course I
> realize that x <- x + as.integer(1) is an option, but that isn't the
> point of this exercise.
>
> I'm curious, but also spending time on memory-related work.  Someone
> deserves a 'thank you' and a pat on the pack for making this sort of
> improvement.  Surely someone can step forward and take a bow, and
> perhaps explain the nature of the improvement?
>
> On a related note, a new package bigmemoRy will be available soon,
> handling massive matrices of double, integer, short, or char in RAM.
> In Unix (sorry, Windows), these matrices can also be used with shared
> memory (with mutexes implemented) for parallel processing.  It's a
> niche market, obviously, ideal for data larger than 1 GB (roughly) but
> still within the boundaries of the RAM.  It may be a useful developer
> tool for big-data problems.
>
> ------------------------
> R version 2.4.1 (linux):
> > x <- matrix(as.integer(0), 1e+08, 3)
> > x <- x + 1
> > gc()
>            used   (Mb) gc trigger (Mb)  max used   (Mb)
> Ncells    233754   12.5     467875   25    350000   18.7
> Vcells 300119431 2289.8  787870506 6011 750119944 5723.0
> ------------------------
> R version 2.6.0 (linux):
> > x <- matrix(as.integer(0), 1e+08, 3)
> > x <- x + 1
> > gc()
>            used   (Mb) gc trigger   (Mb)  max used   (Mb)
> Ncells    137931    7.4     350000   18.7    350000   18.7
> Vcells 300126402 2289.8  472877829 3607.8 450126789 3434.2

That's interesting - I never noticed that change.  On the same topic,
in R 2.7.0 devel, the (re-)assignment in the following example does no
longer create an extra copy:

> x <- matrix(1, nrow=5000, ncol=5000)
gc()> gc()
           used  (Mb) gc trigger  (Mb) max used  (Mb)
Ncells   132056   7.1     350000  18.7   350000  18.7
Vcells 25136968 191.8   28050871 214.1 25137357 191.8

> x[1,1] <- 2
> gc()
           used  (Mb) gc trigger  (Mb) max used  (Mb)
Ncells   132060   7.1     350000  18.7   350000  18.7
Vcells 25136969 191.8   29533414 225.4 25137357 191.8

In R 2.6.1 that 2nd assignment would result in:

> x[1,1] <- 2
> gc()
           used  (Mb) gc trigger  (Mb) max used  (Mb)
Ncells   138119   7.4     350000  18.7   350000  18.7
Vcells 25126464 191.7   52877950 403.5 50126482 382.5

See https://stat.ethz.ch/pipermail/r-devel/2007-September/047008.html
for background.

Thanks a lot whoever (Luke?) took the time to update matrix().

/Henrik

>
>
> --
> John W. Emerson (Jay)
> Assistant Professor of Statistics
> Director of Graduate Studies (on leave 07-08)
> Department of Statistics
> Yale University
> http://www.stat.yale.edu/~jay
> Statistical Consultant, REvolution Computing
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From clement.raievsky at gmail.com  Tue Jan 29 21:15:29 2008
From: clement.raievsky at gmail.com (clement.raievsky at gmail.com)
Date: Tue, 29 Jan 2008 21:15:29 +0100 (CET)
Subject: [Rd] Documentation of the dev.copy2eps function. (PR#10656)
Message-ID: <20080129201529.E2CBF282EFF7@mail.pubhealth.ku.dk>

Full_Name: clement raievsky
Version: R version 2.4.0 Patched (2006-11-25 r39997)
OS: debian (stable/testing)
Submission from: (NULL) (132.210.56.80)


The documentation of the dev.copy2eps() function should mention the "file"
option which set the output file name

Thanks for the wonderfull software.

Cl?ment.


From ojohnson at progress.com  Tue Jan 29 23:04:05 2008
From: ojohnson at progress.com (Oran Johnson)
Date: Tue, 29 Jan 2008 17:04:05 -0500
Subject: [Rd] The standalone Rmath library and VC++ 2003
Message-ID: <427B18C08050B745B13ADA8EE5A99D9A019769FC@MAIL03.bedford.progress.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080129/a8a190ca/attachment.pl 

From L.Hanson at bom.gov.au  Wed Jan 30 02:10:11 2008
From: L.Hanson at bom.gov.au (L.Hanson at bom.gov.au)
Date: Wed, 30 Jan 2008 02:10:11 +0100 (CET)
Subject: [Rd] R-intro.info.gz ellipsis node bug [SEC=UNCLASSIFIED] (PR#10658)
Message-ID: <20080130011011.B84842834613@mail.pubhealth.ku.dk>

Dear r-bugs,

I think I may have uncovered a bug in the file "R-intro.info.gz"

When running the "info R-intro" command on our Ubuntu 7.10 server,
    on which R 2.6.1 is installed, everything works fine until
    I try to access the node named "The ellipsis argument (...)",
    and then I observe the following error:

    Cannot find node (/usr/share/info/R-intro.info.gz) \
    The ellipsis argument (..'.

I have done some quick investigation, and it seems that the
    parentheses around the ellipsis (...) may be the problem,
    I edited my copy of "/usr/share/info/R-intro.info.gz"
    replacing the (...) with "..." so the character count
    in the file would remain the same, and would not require
    re-indexing, and found that the result operated as expected,
    and I can now read the Node: The ellipsis argument "..."

I hope this may be of some help.

Best regards,

Lawson Hanson
------
Climate Change Group
Centre for Australian Weather and Climate Research
700 Collins Street, Melbourne Docklands, VIC 3008, Australia


From michael.krueckl at chello.at  Wed Jan 30 08:45:04 2008
From: michael.krueckl at chello.at (michael.krueckl at chello.at)
Date: Wed, 30 Jan 2008 08:45:04 +0100 (CET)
Subject: [Rd] numbers after dot missing (PR#10663)
Message-ID: <20080130074504.388642834629@mail.pubhealth.ku.dk>

Full_Name: Michael
Version: 2.6.1
OS: Windows XP
Submission from: (NULL) (81.223.30.219)


i recognized a problem with the numbers behind a dot, an example:

76079320.32+21374.27+7630.04+28432.47
[1] 76136757 // should be 76,136,757.10

> 32+27+4+47 // proof it should be xxx.1
[1] 110

that kind of problem happened more than 1 time

hope u can fix it :)


From sommerfeld at mpil-ploen.mpg.de  Wed Jan 30 11:20:22 2008
From: sommerfeld at mpil-ploen.mpg.de (sommerfeld at mpil-ploen.mpg.de)
Date: Wed, 30 Jan 2008 11:20:22 +0100 (CET)
Subject: [Rd] kruskalmc(pgirmess) (PR#10664)
Message-ID: <20080130102022.2B21A2834154@mail.pubhealth.ku.dk>

Full_Name: Ralf Sommerfeld
Version: 2.3.1
OS: Windows XP
Submission from: (NULL) (193.175.214.49)


The kruskalmc function runs a multiple comparison test after a Kruskal-Wallis
test. I used the function for treatment comparison (default) as compared to a
comparison against a control. The alignment of names and obs.dif is however in
the wrong order!
++++++++++++++
The correct ordering (lines 13-19) is as follows:

         for (i in 2:(length(name))) {
             for (j in 1:(i-1)) {
                 vname <- c(vname, paste(name[j], "-", name[i], 
                   sep = ""))
		 indices <- rbind(indices, c( j, i))
             }
         }

instead of:

        for (i in 1:(length(name) - 1)) {
            for (j in (i + 1):length(name)) {
                vname <- c(vname, paste(name[i], "-", name[j], 
                  sep = ""))
                indices <- rbind(indices, c(i, j))
            }
        }
+++++++++++++++

I did not check the algorithm for ordering a two-sided or one-sided test against
a control.

All the best,
Ralf


From ripley at stats.ox.ac.uk  Wed Jan 30 19:05:19 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Wed, 30 Jan 2008 19:05:19 +0100 (CET)
Subject: [Rd] numbers after dot missing (PR#10663)
Message-ID: <20080130180519.520002834170@mail.pubhealth.ku.dk>

> x <- 76079320.32+21374.27+7630.04+28432.47
> print(x, digits=13)
[1] 76136757.1

If you want trailing zeros printed, use sprintf().

Reading ?print.default will explain this to you -- it is working as 
documented.

On Wed, 30 Jan 2008, michael.krueckl at chello.at wrote:

> Full_Name: Michael
> Version: 2.6.1
> OS: Windows XP
> Submission from: (NULL) (81.223.30.219)
>
>
> i recognized a problem with the numbers behind a dot, an example:
>
> 76079320.32+21374.27+7630.04+28432.47
> [1] 76136757 // should be 76,136,757.10
>
>> 32+27+4+47 // proof it should be xxx.1
> [1] 110
>
> that kind of problem happened more than 1 time
>
> hope u can fix it :)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jeff.a.ryan at gmail.com  Wed Jan 30 19:06:24 2008
From: jeff.a.ryan at gmail.com (Jeff Ryan)
Date: Wed, 30 Jan 2008 12:06:24 -0600
Subject: [Rd] numbers after dot missing (PR#10663)
In-Reply-To: <20080130074504.388642834629@mail.pubhealth.ku.dk>
References: <20080130074504.388642834629@mail.pubhealth.ku.dk>
Message-ID: <e8e755250801301006u52122b1by523124a20c350cac@mail.gmail.com>

YOU can fix the "problem" : )

Try:

> identical(76079320.32 + 21374.27 + 7630.04 + 28432.47,76136757.1)
[1] TRUE

> identical(76079320.32 + 21374.27 + 7630.04 + 28432.47,76136757)
[1] FALSE

> options(digits=10)
> 76079320.32 + 21374.27 + 7630.04 + 28432.47
[1] 76136757.1

> sessionInfo()
R version 2.7.0 Under development (unstable) (2007-12-25 r43783)
i386-apple-darwin8.11.1

locale:
C

attached base packages:
[1] graphics  grDevices utils     datasets  stats     methods   base

other attached packages:
[1] quantmod_0.3-2 Defaults_1.1-1 xts_0.0-6      zoo_1.4-1

loaded via a namespace (and not attached):
[1] grid_2.7.0     lattice_0.17-2 rpart_3.1-36
>


On Jan 30, 2008 1:45 AM,  <michael.krueckl at chello.at> wrote:
> Full_Name: Michael
> Version: 2.6.1
> OS: Windows XP
> Submission from: (NULL) (81.223.30.219)
>
>
> i recognized a problem with the numbers behind a dot, an example:
>
> 76079320.32+21374.27+7630.04+28432.47
> [1] 76136757 // should be 76,136,757.10
>
> > 32+27+4+47 // proof it should be xxx.1
> [1] 110
>
> that kind of problem happened more than 1 time
>
> hope u can fix it :)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
There's a way to do it better - find it.
Thomas A. Edison


From ripley at stats.ox.ac.uk  Wed Jan 30 19:06:17 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 30 Jan 2008 18:06:17 +0000 (GMT)
Subject: [Rd] The standalone Rmath library and VC++ 2003
In-Reply-To: <427B18C08050B745B13ADA8EE5A99D9A019769FC@MAIL03.bedford.progress.com>
References: <427B18C08050B745B13ADA8EE5A99D9A019769FC@MAIL03.bedford.progress.com>
Message-ID: <alpine.LFD.1.00.0801301754240.4291@gannet.stats.ox.ac.uk>

On Tue, 29 Jan 2008, Oran Johnson wrote:

> Linking my VC++ application with the standalone Rmath library yields the
> following;

Looks like you compiled the standalone Rmath library with MinGW.  You 
can't expect to mix-and-match compilers and link together a static library 
built under another compiler.

It is possible that this will work if you try linking to Rmath.dll: 
WIndows' DLLs are fairly portable (although parameter passing conventions 
do differ, and we know 'double complex' is not portable).  I assume you 
know how to make a VC++ import library from a DLL, which you would need to 
do.

If you compiled standalone Rmath under VC++, you would not have got a .a 
but a lib, at least by default.  You are welcome to try that: it has been 
done in the past but is not something we support (nor even would want to 
answer questions about).


> ------ Build started: Project: Complex plugin, Configuration: Debug
> Win32 ------
>
>
>
> Linking...
>
>   Creating library .\../Debug/complex_plugin.lib and object
> .\../Debug/complex_plugin.exp
>
> libRmath.a(mlutils.o) : warning LNK4217: locally defined symbol __iob
> imported in function _REprintf
>
> libRmath.a(dbeta.o) : error LNK2019: unresolved external symbol _log1p
> referenced in function _dbeta
>
> libRmath.a(qbeta.o) : error LNK2019: unresolved external symbol _log1p
> referenced in function _qbeta
>
> libRmath.a(lbeta.o) : error LNK2019: unresolved external symbol _log1p
> referenced in function _lbeta
>
> libRmath.a(toms708.o) : error LNK2001: unresolved external symbol _log1p
>
> libRmath.a(qbeta.o) : error LNK2019: unresolved external symbol _expm1
> referenced in function _qbeta
>
> libRmath.a(mlutils.o) : error LNK2019: unresolved external symbol
> ___fpclassify referenced in function _R_pow
>
> ../Debug/complex_plugin.dll : fatal error LNK1120: 3 unresolved
> externals
>
>
>
> Build log was saved at "file://c:\starting point\Debug\BuildLog.htm"
>
> Complex plugin - 7 error(s), 1 warning(s)
>
>
>
>
>
> ---------------------- Done ----------------------
>
>
>
>    Build: 0 succeeded, 1 failed, 0 skipped
>
>
>
> At first glance, it looks like C:\Rtools\MinGW\lib\libm.a is missing.
> After adding it to my project properties, the results are the same. It
> looks like VC++ is OK with GNU libraries because it appears to accept
> libRmath which was built on the same machine using Rtools. Also it does
> not appear to be a configuration issue, because it's only found
> 'C:\Rtools\MinGW\lib' and VC+ is complaining about not finding it.
>
>
>
> Any ideas?
>
>
>
> Oran
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Jan 30 19:35:47 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 30 Jan 2008 18:35:47 +0000 (GMT)
Subject: [Rd] The standalone Rmath library and VC++ 2003
In-Reply-To: <427B18C08050B745B13ADA8EE5A99D9A01976C32@MAIL03.bedford.progress.com>
References: <427B18C08050B745B13ADA8EE5A99D9A019769FC@MAIL03.bedford.progress.com>
	<alpine.LFD.1.00.0801301754240.4291@gannet.stats.ox.ac.uk>
	<427B18C08050B745B13ADA8EE5A99D9A01976C32@MAIL03.bedford.progress.com>
Message-ID: <alpine.LFD.1.00.0801301830520.5664@gannet.stats.ox.ac.uk>

On Wed, 30 Jan 2008, Oran Johnson wrote:

> Yes, I used Rtools to compile the standalone Rmath library. However,
> C:\Rtools\MinGW\lib\libm.a does not contain log1p;
> C:\Rtools\MinGW\lib\libmingwex.a does. Once I replaced libm.a with
> libmingwex.a, the application linked successfully and the following test
> program was successful:

MinGW's loader will pick up the correct set of default libraries, which 
does include -lmingwex and much else, so if you build a DLL, these entry 
points are compiled in already.

Otherwise, it is down to you to figure out how to link, and it may change 
from time to time. Just the same experience as when you mix-and-match 
compilers on a Unix-alike (try mixing gcc3 and gcc4, or gcc and Sun 
Studio).


>
> #include <iostream>
> #define MATHLIB_STANDALONE
> #include <Rmath.h>
>
> int main()
> {
> 	double d = dbeta(0.5, 2.0, 3.0, 1);
> 	double q = qbeta(0.5, 2.0, 3.0, 1, 0);
> 	double p = pbeta(0.5, 2.0, 3.0, 1, 0);
> 	double r = rbeta(0.5, 2.0);
>
> 	std::cout << "dbeta = " << d << "\n";
> 	std::cout << "qbeta = " << q << "\n";
> 	std::cout << "pbeta = " << p << "\n";
> 	std::cout << "rbeta = " << r << "\n";
> }
>
>
> dbeta = 0.405465
> qbeta = 0.385728
> pbeta = 0.6875
> rbeta = 0.422286
> Press any key to continue
>
> Thanks
> Oran
>
> -----Original Message-----
> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk]
> Sent: Wednesday, January 30, 2008 1:06 PM
> To: Oran Johnson
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] The standalone Rmath library and VC++ 2003
>
> On Tue, 29 Jan 2008, Oran Johnson wrote:
>
>> Linking my VC++ application with the standalone Rmath library yields
> the
>> following;
>
> Looks like you compiled the standalone Rmath library with MinGW.  You
> can't expect to mix-and-match compilers and link together a static
> library
> built under another compiler.
>
> It is possible that this will work if you try linking to Rmath.dll:
> WIndows' DLLs are fairly portable (although parameter passing
> conventions
> do differ, and we know 'double complex' is not portable).  I assume you
> know how to make a VC++ import library from a DLL, which you would need
> to
> do.
>
> If you compiled standalone Rmath under VC++, you would not have got a .a
>
> but a lib, at least by default.  You are welcome to try that: it has
> been
> done in the past but is not something we support (nor even would want to
>
> answer questions about).
>
>
>> ------ Build started: Project: Complex plugin, Configuration: Debug
>> Win32 ------
>>
>>
>>
>> Linking...
>>
>>   Creating library .\../Debug/complex_plugin.lib and object
>> .\../Debug/complex_plugin.exp
>>
>> libRmath.a(mlutils.o) : warning LNK4217: locally defined symbol __iob
>> imported in function _REprintf
>>
>> libRmath.a(dbeta.o) : error LNK2019: unresolved external symbol _log1p
>> referenced in function _dbeta
>>
>> libRmath.a(qbeta.o) : error LNK2019: unresolved external symbol _log1p
>> referenced in function _qbeta
>>
>> libRmath.a(lbeta.o) : error LNK2019: unresolved external symbol _log1p
>> referenced in function _lbeta
>>
>> libRmath.a(toms708.o) : error LNK2001: unresolved external symbol
> _log1p
>>
>> libRmath.a(qbeta.o) : error LNK2019: unresolved external symbol _expm1
>> referenced in function _qbeta
>>
>> libRmath.a(mlutils.o) : error LNK2019: unresolved external symbol
>> ___fpclassify referenced in function _R_pow
>>
>> ../Debug/complex_plugin.dll : fatal error LNK1120: 3 unresolved
>> externals
>>
>>
>>
>> Build log was saved at "file://c:\starting point\Debug\BuildLog.htm"
>>
>> Complex plugin - 7 error(s), 1 warning(s)
>>
>>
>>
>>
>>
>> ---------------------- Done ----------------------
>>
>>
>>
>>    Build: 0 succeeded, 1 failed, 0 skipped
>>
>>
>>
>> At first glance, it looks like C:\Rtools\MinGW\lib\libm.a is missing.
>> After adding it to my project properties, the results are the same. It
>> looks like VC++ is OK with GNU libraries because it appears to accept
>> libRmath which was built on the same machine using Rtools. Also it
> does
>> not appear to be a configuration issue, because it's only found
>> 'C:\Rtools\MinGW\lib' and VC+ is complaining about not finding it.
>>
>>
>>
>> Any ideas?
>>
>>
>>
>> Oran
>>
>>
>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Jan 30 20:28:48 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 30 Jan 2008 19:28:48 +0000 (GMT)
Subject: [Rd] Documentation of the dev.copy2eps function. (PR#10656)
In-Reply-To: <20080129201529.E2CBF282EFF7@mail.pubhealth.ku.dk>
References: <20080129201529.E2CBF282EFF7@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.1.00.0801301752000.4291@gannet.stats.ox.ac.uk>

On Tue, 29 Jan 2008, clement.raievsky at gmail.com wrote:

> Full_Name: clement raievsky
> Version: R version 2.4.0 Patched (2006-11-25 r39997)

which is over a year old: we are at 2.6.2 RC

> OS: debian (stable/testing)
> Submission from: (NULL) (132.210.56.80)
>
>
> The documentation of the dev.copy2eps() function should mention the "file"
> option which set the output file name

Current R says

      ...: Arguments to the 'device' function above. For 'dev.print',
           this includes 'which' and by default any 'postscript'
           arguments.

      For 'dev.copy2eps', 'width' and 'height' are taken from the
      current device unless otherwise specified.  If just one of 'width'
      and 'height' is specified, the other is adjusted to preserve the
      aspect ratio of the device being copied.  The default file name is
      'Rplot.eps'.

I'm not sure why 'file' is more important than any other argument 
mentioned in ..., but we do say what the default is (because it is 
different).  Can you tell us what more we 'should' say in your opinion, 
and why?

>
> Thanks for the wonderfull software.
>
> Cl?ment.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From hpages at fhcrc.org  Thu Jan 31 03:49:09 2008
From: hpages at fhcrc.org (Herve Pages)
Date: Wed, 30 Jan 2008 18:49:09 -0800
Subject: [Rd] segfault in gregexpr()
Message-ID: <47A13725.6060208@fhcrc.org>

Hi,

Tried with R 2.6 and R 2.7:

  > gregexpr("", "abc", fixed=TRUE)

   *** caught segfault ***
  address 0x1c09000, cause 'memory not mapped'

  Traceback:
   1: gregexpr("", "abc", fixed = TRUE)

  Possible actions:
  1: abort (with core dump, if enabled)
  2: normal R exit
  3: exit R without saving workspace
  4: exit R saving workspace
  Selection:


> sessionInfo()
R version 2.7.0 Under development (unstable) (2008-01-29 r44238)
x86_64-unknown-linux-gnu

locale:
LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=en_US;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


Cheers,
H.


From seth at userprimary.net  Thu Jan 31 07:03:37 2008
From: seth at userprimary.net (Seth Falcon)
Date: Wed, 30 Jan 2008 22:03:37 -0800
Subject: [Rd] segfault in gregexpr()
In-Reply-To: <47A13725.6060208@fhcrc.org> (Herve Pages's message of "Wed\,
	30 Jan 2008 18\:49\:09 -0800")
References: <47A13725.6060208@fhcrc.org>
Message-ID: <m2ejbypm4m.fsf@userprimary.net>

Hi Herve,

Thanks for the report.  I can reproduce this with latest R-devel.
perl=TRUE is also broken.  I have a patch which I am testing.  With
it, I get:

    > gregexpr("", "abc") 
    [[1]]
    [1] 1 2 3
    attr(,"match.length")
    [1] 0 0 0
    
    > gregexpr("", "abc", fixed=TRUE)
    [[1]]
    [1] 1 2 3
    attr(,"match.length")
    [1] 0 0 0
    
    > gregexpr("", "abc", perl=TRUE)
    [[1]]
    [1] 1 2 3
    attr(,"match.length")
    [1] 0 0 0


+ seth

-- 
Seth Falcon | seth at userprimary.net | blog: http://userprimary.net/user/


From maechler at stat.math.ethz.ch  Thu Jan 31 11:54:49 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 31 Jan 2008 11:54:49 +0100
Subject: [Rd] R package Matrix failing to build with R-devel on Ubuntu
	AMD64
In-Reply-To: <479FF9A6.7050005@gmail.com>
References: <479FF9A6.7050005@gmail.com>
Message-ID: <18337.43257.162929.54594@stat.math.ethz.ch>

>>>>> "MWK" == Mark W Kimpel <mwkimpel at gmail.com>
>>>>>     on Tue, 29 Jan 2008 23:14:30 -0500 writes:

    MWK> Switched back to R-devel tonight after using R-2.6.1 for awhile and when 
    MWK> I updated my devel packages Matrix installation failed. Not critical for 
    MWK> me but thought I should report it. I am using Ubuntu Gusty AMD64 OS. 
    MWK> Tail of install output and sessionInfo follows. Mark

    MWK> Loading required package: methods
    MWK> Loading required package: lattice

    MWK> Attaching package: 'Matrix'


    MWK> The following object(s) are masked from package:stats :

    MWK> xtabs

    MWK> Error in new("dgCMatrix") :
    MWK> trying to generate an object from a virtual class ("dgCMatrix")
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    MWK> Calls: <Anonymous> ... eval.parent -> eval -> eval -> eval -> eval -> 
    MWK> new -> .Call
    MWK> Execution halted
    MWK> ERROR: installing package indices failed
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    MWK> ** Removing '/home/mkimpel/R_HOME/site-library/Matrix'
    MWK> ** Restoring previous '/home/mkimpel/R_HOME/site-library/Matrix'

    MWK> The downloaded packages are in
    MWK> /tmp/RtmpJviXfF/downloaded_packages
    MWK> Warning message:
    MWK> In install.packages("Matrix") :
    MWK> installation of package 'Matrix' had non-zero exit status
    >> sessionInfo()
    MWK> R version 2.7.0 Under development (unstable) (2008-01-29 r44238)
    MWK> x86_64-unknown-linux-gnu

Thank you, Mark, for the report.

Indeed --- to my own very big astonishment --- 
I *can* reproduce the problem.

In the above messages, it's pretty funny that
"dgCMatrix" is said to be a virtual class (which it is clearly
not from the Matrix source).

The "daily" CRAN package checks don't show the problem yet,
but the checks' R version is

>>  R 2.7.0 Under development (unstable) (2008-01-27 r44199)

which is a bit older, than the one you used 
(and even older than the one I used ..... r44258)

I'm pretty sure I know around where the problem appeared..
More on this later.

Martin Maechler, ETH Zurich


From clement.raievsky at gmail.com  Wed Jan 30 21:23:43 2008
From: clement.raievsky at gmail.com (=?ISO-8859-1?Q?Cl=E9ment_Raievsky?=)
Date: Wed, 30 Jan 2008 15:23:43 -0500
Subject: [Rd] Documentation of the dev.copy2eps function. (PR#10656)
In-Reply-To: <alpine.LFD.1.00.0801301752000.4291@gannet.stats.ox.ac.uk>
References: <20080129201529.E2CBF282EFF7@mail.pubhealth.ku.dk>
	<alpine.LFD.1.00.0801301752000.4291@gannet.stats.ox.ac.uk>
Message-ID: <88f4f35b0801301223l5a260f52w57abda253211946f@mail.gmail.com>

Thanks for replying.

On Jan 30, 2008 2:28 PM, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On Tue, 29 Jan 2008, clement.raievsky at gmail.com wrote:
>
> >
> > The documentation of the dev.copy2eps() function should mention the "file"
> > option which set the output file name
>
> Current R says
>
>       ...: Arguments to the 'device' function above. For 'dev.print',
>            this includes 'which' and by default any 'postscript'
>            arguments.

In my humble opinion, in the sentence "Arguments to the 'device'
function above", it is not clear to what "the 'device' function above"
refers because 'device' is an argument in the text above this
sentence.
Therefore, I think it's difficult to understand which are the possible
arguments for the copy2eps function.


>       For 'dev.copy2eps', 'width' and 'height' are taken from the
>       current device unless otherwise specified.  If just one of 'width'
>       and 'height' is specified, the other is adjusted to preserve the
>       aspect ratio of the device being copied.  The default file name is
>       'Rplot.eps'.
>
> I'm not sure why 'file' is more important than any other argument
> mentioned in ..., but we do say what the default is (because it is
> different).  Can you tell us what more we 'should' say in your opinion,
> and why?

I mentioned the 'file' argument because it was the one which I was
looking for while reading the doc.
Maybe all arguments valid for the postscript device are allowed for
the copy2eps function but it is still not clear to me.

Best regards,

Cl?ment.


From nicolas_simonis at dfci.harvard.edu  Wed Jan 30 18:55:12 2008
From: nicolas_simonis at dfci.harvard.edu (nicolas_simonis at dfci.harvard.edu)
Date: Wed, 30 Jan 2008 18:55:12 +0100 (CET)
Subject: [Rd] logical operator and addition (PR#10665)
Message-ID: <20080130175512.6ED782834170@mail.pubhealth.ku.dk>

Full_Name: Nicolas Simonis
Version: 2.6.1
OS: windows
Submission from: (NULL) (155.52.10.223)


Very funny bug :

> 0.6<0.6
[1] FALSE
> 0.6<0.4+0.2
[1] TRUE

control :

> 0.7<0.7
[1] FALSE
> 0.7<0.4+0.3
[1] FALSE

With R 2.6.1 windows. it's not doing it with R 2.3.1 linux...


From ojohnson at progress.com  Wed Jan 30 19:23:56 2008
From: ojohnson at progress.com (Oran Johnson)
Date: Wed, 30 Jan 2008 13:23:56 -0500
Subject: [Rd] The standalone Rmath library and VC++ 2003
In-Reply-To: <alpine.LFD.1.00.0801301754240.4291@gannet.stats.ox.ac.uk>
References: <427B18C08050B745B13ADA8EE5A99D9A019769FC@MAIL03.bedford.progress.com>
	<alpine.LFD.1.00.0801301754240.4291@gannet.stats.ox.ac.uk>
Message-ID: <427B18C08050B745B13ADA8EE5A99D9A01976C32@MAIL03.bedford.progress.com>

Yes, I used Rtools to compile the standalone Rmath library. However,
C:\Rtools\MinGW\lib\libm.a does not contain log1p;
C:\Rtools\MinGW\lib\libmingwex.a does. Once I replaced libm.a with
libmingwex.a, the application linked successfully and the following test
program was successful:

#include <iostream>
#define MATHLIB_STANDALONE
#include <Rmath.h>

int main()
{
	double d = dbeta(0.5, 2.0, 3.0, 1); 
	double q = qbeta(0.5, 2.0, 3.0, 1, 0); 
	double p = pbeta(0.5, 2.0, 3.0, 1, 0); 
	double r = rbeta(0.5, 2.0);

	std::cout << "dbeta = " << d << "\n";
	std::cout << "qbeta = " << q << "\n"; 
	std::cout << "pbeta = " << p << "\n";
	std::cout << "rbeta = " << r << "\n"; 
}


dbeta = 0.405465
qbeta = 0.385728
pbeta = 0.6875
rbeta = 0.422286
Press any key to continue

Thanks
Oran

-----Original Message-----
From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
Sent: Wednesday, January 30, 2008 1:06 PM
To: Oran Johnson
Cc: r-devel at r-project.org
Subject: Re: [Rd] The standalone Rmath library and VC++ 2003

On Tue, 29 Jan 2008, Oran Johnson wrote:

> Linking my VC++ application with the standalone Rmath library yields
the
> following;

Looks like you compiled the standalone Rmath library with MinGW.  You 
can't expect to mix-and-match compilers and link together a static
library 
built under another compiler.

It is possible that this will work if you try linking to Rmath.dll: 
WIndows' DLLs are fairly portable (although parameter passing
conventions 
do differ, and we know 'double complex' is not portable).  I assume you 
know how to make a VC++ import library from a DLL, which you would need
to 
do.

If you compiled standalone Rmath under VC++, you would not have got a .a

but a lib, at least by default.  You are welcome to try that: it has
been 
done in the past but is not something we support (nor even would want to

answer questions about).


> ------ Build started: Project: Complex plugin, Configuration: Debug
> Win32 ------
>
>
>
> Linking...
>
>   Creating library .\../Debug/complex_plugin.lib and object
> .\../Debug/complex_plugin.exp
>
> libRmath.a(mlutils.o) : warning LNK4217: locally defined symbol __iob
> imported in function _REprintf
>
> libRmath.a(dbeta.o) : error LNK2019: unresolved external symbol _log1p
> referenced in function _dbeta
>
> libRmath.a(qbeta.o) : error LNK2019: unresolved external symbol _log1p
> referenced in function _qbeta
>
> libRmath.a(lbeta.o) : error LNK2019: unresolved external symbol _log1p
> referenced in function _lbeta
>
> libRmath.a(toms708.o) : error LNK2001: unresolved external symbol
_log1p
>
> libRmath.a(qbeta.o) : error LNK2019: unresolved external symbol _expm1
> referenced in function _qbeta
>
> libRmath.a(mlutils.o) : error LNK2019: unresolved external symbol
> ___fpclassify referenced in function _R_pow
>
> ../Debug/complex_plugin.dll : fatal error LNK1120: 3 unresolved
> externals
>
>
>
> Build log was saved at "file://c:\starting point\Debug\BuildLog.htm"
>
> Complex plugin - 7 error(s), 1 warning(s)
>
>
>
>
>
> ---------------------- Done ----------------------
>
>
>
>    Build: 0 succeeded, 1 failed, 0 skipped
>
>
>
> At first glance, it looks like C:\Rtools\MinGW\lib\libm.a is missing.
> After adding it to my project properties, the results are the same. It
> looks like VC++ is OK with GNU libraries because it appears to accept
> libRmath which was built on the same machine using Rtools. Also it
does
> not appear to be a configuration issue, because it's only found
> 'C:\Rtools\MinGW\lib' and VC+ is complaining about not finding it.
>
>
>
> Any ideas?
>
>
>
> Oran
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From t.zumbrunn at unibas.ch  Thu Jan 31 10:55:26 2008
From: t.zumbrunn at unibas.ch (t.zumbrunn at unibas.ch)
Date: Thu, 31 Jan 2008 10:55:26 +0100 (CET)
Subject: [Rd] X11 device distortion (PR#10666)
Message-ID: <20080131095526.718932834620@mail.pubhealth.ku.dk>

Full_Name: Thomas Zumbrunn
Version: 2.6.1
OS: GNU/Linux (openSuse 10.3 2.6.22.13-0.3-default)
Submission from: (NULL) (131.152.125.199)


With my particular X11 settings, the width to height ratio of the x11 device is
distorted, with the width being half that of the height. This results in wrongly
proportioned plots, wrongly positioned text etc.

Other devices are not affected.

I already asked about his on the mailing list
(https://stat.ethz.ch/pipermail/r-help/2007-December/147891.html) but no one
seemed to have an answer.


From jason at acm.org  Wed Jan 30 20:32:16 2008
From: jason at acm.org (jason at acm.org)
Date: Wed, 30 Jan 2008 11:32:16 -0800
Subject: [Rd] [rfc] Package to access the internal zlib library.
In-Reply-To: <alpine.LFD.1.00.0801300907480.6559@gannet.stats.ox.ac.uk> (Brian
	Ripley's message of "Wed, 30 Jan 2008 09:20:13 +0000 (GMT)")
References: <874pcvu415.fsf@sparse.yi.org>
	<alpine.LFD.1.00.0801300907480.6559@gannet.stats.ox.ac.uk>
Message-ID: <87odb3rtxb.fsf@sparse.yi.org>

And Brian Ripley writes:
> The *only* safe thing to do is to include your own copy of
> zlib, and compile it into the package (optionally linking
> instead to the system copy if it exists).

Fair enough, and likely necessary on AIX with XCOFF's
restrictions.  The Rcompression package mentioned by Duncan Lang
has most of what I need, so I should help with Rcompression
instead.

> Please note that Uwe Ligges provides a Windows testing service:
> see 'Writing R Extensions' and the R-admin manual.  You don't
> need to ask others to do this for you.

Great!  Thank you and Uwe Ligges!  I completely missed the
"Services" section.

Jason


From jason at acm.org  Wed Jan 30 20:34:05 2008
From: jason at acm.org (jason at acm.org)
Date: Wed, 30 Jan 2008 11:34:05 -0800
Subject: [Rd] [rfc] Package to access the internal zlib library.
In-Reply-To: <47A041FA.1060702@wald.ucdavis.edu> (Duncan Temple Lang's message
	of "Wed, 30 Jan 2008 22:23:06 +1300")
References: <874pcvu415.fsf@sparse.yi.org> <47A041FA.1060702@wald.ucdavis.edu>
Message-ID: <87ir1brtua.fsf@sparse.yi.org>

And Duncan Temple Lang writes:
> This deals with various compression schemes and does things in
> memory.  Hopefully there isn't much overlap and the two might
> be complementary.

Rcompression provides what's necessary for R.matlab's readMat.
I'll switch to using it instead.  What would it take to move
Rcompression into CRAN?

Jason


From murdoch at stats.uwo.ca  Thu Jan 31 12:39:43 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 31 Jan 2008 06:39:43 -0500
Subject: [Rd] logical operator and addition (PR#10665)
In-Reply-To: <20080130175512.6ED782834170@mail.pubhealth.ku.dk>
References: <20080130175512.6ED782834170@mail.pubhealth.ku.dk>
Message-ID: <47A1B37F.50400@stats.uwo.ca>

nicolas_simonis at dfci.harvard.edu wrote:
> Full_Name: Nicolas Simonis
> Version: 2.6.1
> OS: windows
> Submission from: (NULL) (155.52.10.223)
>
>
> Very funny bug :
>
>   
>> 0.6<0.6
>>     
> [1] FALSE
>   
>> 0.6<0.4+0.2
>>     
> [1] TRUE
>
>   
I don't see a bug here, I see failure to read FAQ 7.31.  The value 0.6 
is less than 0.4+0.2, when the operation is done in floating point 
approximations.  None of those three numbers is exactly representable.

 > (0.4+0.2) - 0.6
[1] 1.110223e-16

Duncan Murdoch
> control :
>
>   
>> 0.7<0.7
>>     
> [1] FALSE
>   
>> 0.7<0.4+0.3
>>     
> [1] FALSE
>
> With R 2.6.1 windows. it's not doing it with R 2.3.1 linux...
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Thu Jan 31 12:50:20 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Thu, 31 Jan 2008 12:50:20 +0100 (CET)
Subject: [Rd] logical operator and addition (PR#10665)
Message-ID: <20080131115020.A7FF5283462E@mail.pubhealth.ku.dk>

This seems another instance of FAQ Q7.31

> 0.6 - (0.4 + 0.2)
[1] -1.110223e-16


On Wed, 30 Jan 2008, nicolas_simonis at dfci.harvard.edu wrote:

> Full_Name: Nicolas Simonis
> Version: 2.6.1
> OS: windows
> Submission from: (NULL) (155.52.10.223)
>
>
> Very funny bug :

(rather a very common FAQ, when asked as a question)

>> 0.6<0.6
> [1] FALSE
>> 0.6<0.4+0.2
> [1] TRUE
>
> control :
>
>> 0.7<0.7
> [1] FALSE
>> 0.7<0.4+0.3
> [1] FALSE
>
> With R 2.6.1 windows. it's not doing it with R 2.3.1 linux...

It depends on the compiler and optimization settings: it is doing it on 
2.3.1 Linux for me (and 2.6.2 RC).

>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Thu Jan 31 12:50:50 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Thu, 31 Jan 2008 12:50:50 +0100 (CET)
Subject: [Rd] X11 device distortion (PR#10666)
Message-ID: <20080131115050.8A07D283462E@mail.pubhealth.ku.dk>

On Thu, 31 Jan 2008, t.zumbrunn at unibas.ch wrote:

> Full_Name: Thomas Zumbrunn
> Version: 2.6.1
> OS: GNU/Linux (openSuse 10.3 2.6.22.13-0.3-default)
> Submission from: (NULL) (131.152.125.199)
>
>
> With my particular X11 settings, the width to height ratio of the x11 device is
> distorted, with the width being half that of the height. This results in wrongly
> proportioned plots, wrongly positioned text etc.

So your X11 settings are wrong: R is just using what X11 tells it.

The most likely setting is DisplaySize in xorg.conf, which controls how
inches are mapped to pixels.

>
> Other devices are not affected.
>
> I already asked about his on the mailing list
> (https://stat.ethz.ch/pipermail/r-help/2007-December/147891.html) but no one
> seemed to have an answer.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From buser at stat.math.ethz.ch  Thu Jan 31 13:54:32 2008
From: buser at stat.math.ethz.ch (Christoph Buser)
Date: Thu, 31 Jan 2008 13:54:32 +0100
Subject: [Rd] S4: setGeneric() and setMethod() with changed argument order
Message-ID: <18337.50440.781965.267262@stat.math.ethz.ch>

Dear R devel team

Using S4 classes in R I found a possible source of mistakes
caused by an inattentive user.

If one uses another order of the arguments for a function in the
setGeneric() as in the setMethod() call, one can get undesired
side effects without any warning.

Would it be desirable to include a warning for such cases? Thank
you for a statement.

R code:

## set generic function "test1" with 3 arguments
setGeneric("test1", function(object, printit = TRUE, name = "tmp")
           standardGeneric("test1"))

## Set method for test1 and class "numeric", but change the order od the 2nd
##  and 3rd arguments -> No warning, everything works well?
setMethod("test1",  signature(object = "numeric"),
          function(object, name = "tmp", printit = TRUE) {
              match.call()
          })

## .local is generated with the order from setGeneric(), but is called
## afterwards with the wrong order from setMethod() which can cause an error
## (if you are lucky) or strange results.
selectMethod("test1", signature = signature(object = "numeric"))

> Method Definition:
> 
> function (object, printit = TRUE, name = "tmp") 
> {
>     .local <- function (object, name = "tmp", printit = TRUE) 
>     {
>         match.call()
>     }
>     .local(object, printit, name)
> }
> 
> Signatures:
>         object   
> target  "numeric"
> defined "numeric"
> 

## Shows that for the argument "name" printit is used. For the argument
## "printit" name is used
test1(pi)

> .local(object = object, name = printit, printit = name)



Best regards,

Christoph Buser

--------------------------------------------------------------
Christoph Buser <buser at stat.math.ethz.ch>
Seminar fuer Statistik, LEO C13
ETH Zurich	8092 Zurich	 SWITZERLAND
phone: x-41-44-632-4673		fax: 632-1228
http://stat.ethz.ch/~buser/


From seth at userprimary.net  Thu Jan 31 16:06:12 2008
From: seth at userprimary.net (Seth Falcon)
Date: Thu, 31 Jan 2008 07:06:12 -0800
Subject: [Rd] segfault in gregexpr()
In-Reply-To: <m2ejbypm4m.fsf@userprimary.net> (Seth Falcon's message of "Wed\,
	30 Jan 2008 22\:03\:37 -0800")
References: <47A13725.6060208@fhcrc.org> <m2ejbypm4m.fsf@userprimary.net>
Message-ID: <m23aseox0b.fsf@userprimary.net>

Hi again,

> Herve wrote:
>   > gregexpr("", "abc", fixed=TRUE)
> 
>    *** caught segfault ***
>   address 0x1c09000, cause 'memory not mapped'

This should be fixed in latest svn.  Thanks for the report.

+ seth

-- 
Seth Falcon | seth at userprimary.net | blog: http://userprimary.net/user/


From hin-tak.leung at cimr.cam.ac.uk  Thu Jan 31 16:45:39 2008
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Thu, 31 Jan 2008 15:45:39 +0000
Subject: [Rd] X11 device distortion (PR#10666)
In-Reply-To: <20080131095526.718932834620@mail.pubhealth.ku.dk>
References: <20080131095526.718932834620@mail.pubhealth.ku.dk>
Message-ID: <47A1ED23.6050704@cimr.cam.ac.uk>

My first thought was that you must be using Xinerama or TwinView -
and you did mention Xinerama in your r-help message but not
in your bug report - this detail is important.

That said, I don't know enough about X11 to say anything - well, maybe
I do, but you'll have to show your xorg.conf , and possibly the result
of xdpyinfo for anybody to help you. I think your Xinerama setup is broken.

for the time being, you could probably run the X11 device through Xnest
to get around this.

t.zumbrunn at unibas.ch wrote:
> Full_Name: Thomas Zumbrunn
> Version: 2.6.1
> OS: GNU/Linux (openSuse 10.3 2.6.22.13-0.3-default)
> Submission from: (NULL) (131.152.125.199)
> 
> 
> With my particular X11 settings, the width to height ratio of the x11 device is
> distorted, with the width being half that of the height. This results in wrongly
> proportioned plots, wrongly positioned text etc.
> 
> Other devices are not affected.
> 
> I already asked about his on the mailing list
> (https://stat.ethz.ch/pipermail/r-help/2007-December/147891.html) but no one
> seemed to have an answer.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From vmakarov at pace.edu  Thu Jan 31 17:37:27 2008
From: vmakarov at pace.edu (Vladmir Makarov)
Date: Thu, 31 Jan 2008 11:37:27 -0500
Subject: [Rd] Problem with R.2.6.1 and JRI - All worked file wih R2.5.1
Message-ID: <7cac4bd80801310837i188a9910padcd0e07ce4219e5@mail.gmail.com>

Hello Members,
I have posted this message at R-HELP listserv, so my apology for
double posting, but members of R_HELP seem not to know/care about the
problem.

I wonder if someone also having a problem with JRI using new R 2.6.1.
To illustrate the problem, there is a simple Java driver problem
below. The program runs just fine on the other computer with R 2.5.1,
but does not run with R 2.6.1. It gives me no error messages either.
Needles to say, I have jri.dll at the classpath. Also, I have
downloaded the rJava package from R program (packages >> install
packages >> rJava), so version must be correct.

Any suggestions are highly appreciated,
Thanks,
Vlad



import org.rosuda.JRI.Rengine;

public class Driver {

	public static void main(String[] args){
		try {
			String[] arg = {};
			Rengine re = new Rengine(arg, false, null);
			if (!Rengine.versionCheck()) {
				Rengine.getVersion();
			    System.err.println("** Version mismatch");
			    System.exit(1);
			}
			if (!re.waitForR()) {
			    System.out.println("** Cannot load R");
			    System.exit(1);
			}
			double d = re.eval("3+5").asDouble();
			System.out.print("D = " + d);
		} catch (RuntimeException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
	}

}


From marc_schwartz at comcast.net  Thu Jan 31 17:40:13 2008
From: marc_schwartz at comcast.net (marc_schwartz at comcast.net)
Date: Thu, 31 Jan 2008 17:40:13 +0100 (CET)
Subject: [Rd] X11 device distortion (PR#10666)
Message-ID: <20080131164013.5E9A92834612@mail.pubhealth.ku.dk>

Just to follow up, largely in synch with the two replies already, it
sounds like there is a good chance that your two displays (the physical
panels or monitors) are either of two different sizes and/or have two
different resolutions. Somewhat more likely is the latter.

In either case, it is likely that the dpi (dots per inch) setting that
is being picked up by the X server is incorrect or biased by one display
over the other. Hence, when you open the display device on the screen,
the size and aspect ratio of the device is wrong.

For example, on my system, I have an internal 15 inch laptop lcd panel
of 1600x1200 with a dpi of 133. I have an external 20 inch lcd panel
which has the same resolution but at 100 dpi. I happen to use TwinView
with an nVidia card, but have to tweak the xorg.conf settings to get the
displays to look reasonably similar. I actually hard code the 100 dpi
setting rather than allowing the server to get the information from the
monitors. My xdpyinfo is:

$ xdpyinfo | grep dimensions
  dimensions:    3200x1200 pixels (813x305 millimeters)

$ xdpyinfo | grep resolution
  resolution:    100x100 dots per inch

Note that using TwinView, my two displays effectively show as one.

I would suggest that you post to a SUSE or generic Linux forum or
perhaps to a graphics card vendor forum specific to your card for
detailed guidance.

HTH,

Marc Schwartz


Hin-Tak Leung wrote:
> My first thought was that you must be using Xinerama or TwinView -
> and you did mention Xinerama in your r-help message but not
> in your bug report - this detail is important.
> 
> That said, I don't know enough about X11 to say anything - well, maybe
> I do, but you'll have to show your xorg.conf , and possibly the result
> of xdpyinfo for anybody to help you. I think your Xinerama setup is broken.
> 
> for the time being, you could probably run the X11 device through Xnest
> to get around this.
> 
> t.zumbrunn at unibas.ch wrote:
>> Full_Name: Thomas Zumbrunn
>> Version: 2.6.1
>> OS: GNU/Linux (openSuse 10.3 2.6.22.13-0.3-default)
>> Submission from: (NULL) (131.152.125.199)
>>
>>
>> With my particular X11 settings, the width to height ratio of the x11 device is
>> distorted, with the width being half that of the height. This results in wrongly
>> proportioned plots, wrongly positioned text etc.
>>
>> Other devices are not affected.
>>
>> I already asked about his on the mailing list
>> (https://stat.ethz.ch/pipermail/r-help/2007-December/147891.html) but no one
>> seemed to have an answer.


From hpages at fhcrc.org  Thu Jan 31 19:26:31 2008
From: hpages at fhcrc.org (hpages at fhcrc.org)
Date: Thu, 31 Jan 2008 10:26:31 -0800
Subject: [Rd] Pb with lapply()
Message-ID: <1201803991.47a212d790acf@webmail.fhcrc.org>

Hi,

If needed, lapply() tries to convert its first argument into a list
before it starts doing something with it:

  > lapply
  function (X, FUN, ...) 
  {
    FUN <- match.fun(FUN)
    if (!is.vector(X) || is.object(X)) 
        X <- as.list(X)
    .Internal(lapply(X, FUN))
  }

But in practice, things don't always seem to "work" as suggested by
this code (at least to the eyes of a naive user).

I have defined an "as.list" method for my S4 class "A":

  > setClass("A", representation(data="list"))
  [1] "A"
  > setMethod("as.list", "A", function(x, ...) x at data)
  Creating a new generic function for "as.list" in ".GlobalEnv"
  [1] "as.list"

Testing it:

  > a <- new("A", data=list(8, 2:0))
  > as.list(a)
  [[1]]
  [1] 8

  [[2]]
  [1] 2 1 0

OK.

But lapply() doesn't work on 'a':

  > lapply(a, typeof)
  Error in as.vector(x, "list") : cannot type 'S4' coerce to vector

I still have to do the 'as.list(a)' part myself for things to work:

  > lapply(as.list(a), typeof)
  [[1]]
  [1] "double"

  [[2]]
  [1] "integer"

Seems like using force() inside lapply() would solve the problem:

  lapply2 <- function(X, FUN, ...)
  {
    FUN <- match.fun(FUN)
    if (!is.vector(X) || is.object(X))
        X <- force(as.list(X))
    .Internal(lapply(X, FUN))
  }

It works now:

  > lapply2(a, typeof)
  [[1]]
  [1] "double"

  [[2]]
  [1] "integer"

Cheers,
H.


From ggrothendieck at gmail.com  Thu Jan 31 19:33:29 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 31 Jan 2008 13:33:29 -0500
Subject: [Rd] Pb with lapply()
In-Reply-To: <1201803991.47a212d790acf@webmail.fhcrc.org>
References: <1201803991.47a212d790acf@webmail.fhcrc.org>
Message-ID: <971536df0801311033x6819be68l6e97658a3e844c96@mail.gmail.com>

The problem of promises not being evaluated in
lists has been discussed before.

I think its fixed in the development version of R. See
r44139 on Jan 24, 2008 in http://developer.r-project.org/R.svnlog.2007

On Jan 31, 2008 1:26 PM,  <hpages at fhcrc.org> wrote:
> Hi,
>
> If needed, lapply() tries to convert its first argument into a list
> before it starts doing something with it:
>
>  > lapply
>  function (X, FUN, ...)
>  {
>    FUN <- match.fun(FUN)
>    if (!is.vector(X) || is.object(X))
>        X <- as.list(X)
>    .Internal(lapply(X, FUN))
>  }
>
> But in practice, things don't always seem to "work" as suggested by
> this code (at least to the eyes of a naive user).
>
> I have defined an "as.list" method for my S4 class "A":
>
>  > setClass("A", representation(data="list"))
>  [1] "A"
>  > setMethod("as.list", "A", function(x, ...) x at data)
>  Creating a new generic function for "as.list" in ".GlobalEnv"
>  [1] "as.list"
>
> Testing it:
>
>  > a <- new("A", data=list(8, 2:0))
>  > as.list(a)
>  [[1]]
>  [1] 8
>
>  [[2]]
>  [1] 2 1 0
>
> OK.
>
> But lapply() doesn't work on 'a':
>
>  > lapply(a, typeof)
>  Error in as.vector(x, "list") : cannot type 'S4' coerce to vector
>
> I still have to do the 'as.list(a)' part myself for things to work:
>
>  > lapply(as.list(a), typeof)
>  [[1]]
>  [1] "double"
>
>  [[2]]
>  [1] "integer"
>
> Seems like using force() inside lapply() would solve the problem:
>
>  lapply2 <- function(X, FUN, ...)
>  {
>    FUN <- match.fun(FUN)
>    if (!is.vector(X) || is.object(X))
>        X <- force(as.list(X))
>    .Internal(lapply(X, FUN))
>  }
>
> It works now:
>
>  > lapply2(a, typeof)
>  [[1]]
>  [1] "double"
>
>  [[2]]
>  [1] "integer"
>
> Cheers,
> H.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From hpages at fhcrc.org  Thu Jan 31 20:33:58 2008
From: hpages at fhcrc.org (hpages at fhcrc.org)
Date: Thu, 31 Jan 2008 11:33:58 -0800
Subject: [Rd] Pb with lapply()
In-Reply-To: <971536df0801311033x6819be68l6e97658a3e844c96@mail.gmail.com>
References: <1201803991.47a212d790acf@webmail.fhcrc.org>
	<971536df0801311033x6819be68l6e97658a3e844c96@mail.gmail.com>
Message-ID: <1201808038.47a222a606da2@webmail.fhcrc.org>

Hi Gabor,

Quoting Gabor Grothendieck <ggrothendieck at gmail.com>:

> The problem of promises not being evaluated in
> lists has been discussed before.
> 
> I think its fixed in the development version of R. See
> r44139 on Jan 24, 2008 in http://developer.r-project.org/R.svnlog.2007
> 

I'm using R-devel r44238 and the problem is still here.

Cheers,
H.

> sessionInfo()
R version 2.7.0 Under development (unstable) (2008-01-29 r44238) 
x86_64-unknown-linux-gnu 

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


From simon.urbanek at r-project.org  Thu Jan 31 20:39:32 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 31 Jan 2008 14:39:32 -0500
Subject: [Rd] Problem with R.2.6.1 and JRI - All worked file wih R2.5.1
In-Reply-To: <7cac4bd80801310837i188a9910padcd0e07ce4219e5@mail.gmail.com>
References: <7cac4bd80801310837i188a9910padcd0e07ce4219e5@mail.gmail.com>
Message-ID: <20DC9696-D003-4B23-A1E1-E9C48C5986B3@r-project.org>

Vladimir,

your example works without problems in R 2.6.1:

C:\Program Files\R\R-2.6.1\library\rJava\jri>javac -cp JRI.jar  
Driver.java
C:\Program Files\R\R-2.6.1\library\rJava\jri>set PATH=C:\Program Files 
\R\R-2.6.1\bin;%PATH%
C:\Program Files\R\R-2.6.1\library\rJava\jri>java -cp JRI.jar;. Driver
D = 8.0

I suspect that you have some setting mismatch left over from your  
previous R version.
Note that you may want to add System.exit(0) or terminate R, otherwise  
your application will be waiting for R to exit.

Cheers,
Simon


On Jan 31, 2008, at 11:37 AM, Vladmir Makarov wrote:

> Hello Members,
> I have posted this message at R-HELP listserv, so my apology for
> double posting, but members of R_HELP seem not to know/care about the
> problem.
>
> I wonder if someone also having a problem with JRI using new R 2.6.1.
> To illustrate the problem, there is a simple Java driver problem
> below. The program runs just fine on the other computer with R 2.5.1,
> but does not run with R 2.6.1. It gives me no error messages either.
> Needles to say, I have jri.dll at the classpath. Also, I have
> downloaded the rJava package from R program (packages >> install
> packages >> rJava), so version must be correct.
>
> Any suggestions are highly appreciated,
> Thanks,
> Vlad
>
>
>
> import org.rosuda.JRI.Rengine;
>
> public class Driver {
>
> 	public static void main(String[] args){
> 		try {
> 			String[] arg = {};
> 			Rengine re = new Rengine(arg, false, null);
> 			if (!Rengine.versionCheck()) {
> 				Rengine.getVersion();
> 			    System.err.println("** Version mismatch");
> 			    System.exit(1);
> 			}
> 			if (!re.waitForR()) {
> 			    System.out.println("** Cannot load R");
> 			    System.exit(1);
> 			}
> 			double d = re.eval("3+5").asDouble();
> 			System.out.print("D = " + d);
> 		} catch (RuntimeException e) {
> 			// TODO Auto-generated catch block
> 			e.printStackTrace();
> 		}
> 		
> 	}
>
> }
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From ggrothendieck at gmail.com  Thu Jan 31 21:44:26 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 31 Jan 2008 15:44:26 -0500
Subject: [Rd] Pb with lapply()
In-Reply-To: <1201808038.47a222a606da2@webmail.fhcrc.org>
References: <1201803991.47a212d790acf@webmail.fhcrc.org>
	<971536df0801311033x6819be68l6e97658a3e844c96@mail.gmail.com>
	<1201808038.47a222a606da2@webmail.fhcrc.org>
Message-ID: <971536df0801311244k33ee6f1bod0d1f496fd32c3b4@mail.gmail.com>

I just checked and the
code that previously triggered the promises in lists
bug seems to work now so I guess it is a different
problem.

# code below previously triggered errors but now works
# R 2.6.2 (2008-01-26 r44181) on Vista
f <- function(x) environment()
z <- as.list(f(7))
dput(z)
structure(list(x = 7), .Names = "x")
z[[1]] == 7
force(z[[1]]) == 7


On Jan 31, 2008 2:33 PM,  <hpages at fhcrc.org> wrote:
> Hi Gabor,
>
> Quoting Gabor Grothendieck <ggrothendieck at gmail.com>:
>
> > The problem of promises not being evaluated in
> > lists has been discussed before.
> >
> > I think its fixed in the development version of R. See
> > r44139 on Jan 24, 2008 in http://developer.r-project.org/R.svnlog.2007
> >
>
> I'm using R-devel r44238 and the problem is still here.
>
> Cheers,
> H.
>
> > sessionInfo()
> R version 2.7.0 Under development (unstable) (2008-01-29 r44238)
> x86_64-unknown-linux-gnu
>
> locale:
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
>
>
>


From t.zumbrunn at unibas.ch  Thu Jan 31 17:18:33 2008
From: t.zumbrunn at unibas.ch (Thomas Zumbrunn)
Date: Thu, 31 Jan 2008 17:18:33 +0100
Subject: [Rd] X11 device distortion (PR#10666)
In-Reply-To: <47A1ED23.6050704@cimr.cam.ac.uk>
References: <20080131095526.718932834620@mail.pubhealth.ku.dk>
	<47A1ED23.6050704@cimr.cam.ac.uk>
Message-ID: <200801311718.33812.t.zumbrunn@unibas.ch>

On Thursday 31 January 2008, Hin-Tak Leung wrote:
> My first thought was that you must be using Xinerama or TwinView -
> and you did mention Xinerama in your r-help message but not
> in your bug report - this detail is important.

Yes, I forgot to mention this.

> That said, I don't know enough about X11 to say anything - well, maybe
> I do, but you'll have to show your xorg.conf , and possibly the result
> of xdpyinfo for anybody to help you. I think your Xinerama setup is broken.

Yes, and as Prof. Ripley correctly guessed that the DisplaySize setting was 
wrong. SaX2, the X11 setup tool of openSUSE, adds up the width values of both 
Xinerama devices, which results in a wrong DisplaySize width value. I filed a 
bug at openSUSE and already got a reaction. It seems unclear whether it is 
correct to add up the values.

> for the time being, you could probably run the X11 device through Xnest
> to get around this.

Thanks for the advice. Correcting the DisplaySize value helped, and it didn't 
break the Xinerama setting.


From stigler3 at etu.unige.ch  Thu Jan 31 14:24:07 2008
From: stigler3 at etu.unige.ch (Matthieu Stigler)
Date: Thu, 31 Jan 2008 14:24:07 +0100
Subject: [Rd] Feature request: about lag(), which.min() and cat().
Message-ID: <47A1CBF7.4090803@etu.unige.ch>

Hello

I'm only user of R and have many little knowledge in programming but I 
permit to send you some whishes/suggestions for R.

which.min
like which(), which.min() should also include an argument arr.ind. Note 
that one can have it with which(a==min(a), arr.ind=TRUE) but if there is 
a reason to build a special function which.min, why not add also this 
nice argument?

lag()
If one wants to construct a time series model, it is often useful to 
have the lags matrix. This is available with embed(ts,k) but the time 
series class disappears. So it would be nice that the argument k of 
lag() also admit values of length >1, which would give the same result 
as embed() but keep the class. In his wish list of 1 January 2008 (point 
8), Gabor Grothendieck spoke about a function Lag. Maybe also a function 
lags otherwise if the idea of length(k)>1 is not good?

cat()
It would be really nice if cat() could also include matrix and lists as 
values. This would allow big improvements for output written in a file.

Thank you for what you make for R, it is a really nice program!


From agalecki at umich.edu  Thu Jan 31 17:55:07 2008
From: agalecki at umich.edu (agalecki at umich.edu)
Date: Thu, 31 Jan 2008 17:55:07 +0100 (CET)
Subject: [Rd] nlme package. Minor change in method print.VarCov (PR#10669)
Message-ID: <20080131165508.05A1C283484A@mail.pubhealth.ku.dk>

Hello,

I would like to propose to make a minor change in  method  print.VarCov 
by inserting one line
            stdevs <-  FALSE                          #  Inserted line
as shown later in this email.

By adding this line we would modify the output from
print(corrmtx) as shown in the illustration below. More specifically the
line with redundant information, which reads  " Standard Deviations: 1 1 1 "
would be skipped from the output.

Otherwise, to omit line with SDs:1 1 1 from the output  we need to use 
more cumbersome syntax:
print(corrmtx, corr=TRUE, stdevs=FALSE).

Output from sessionInfo()  included at the bottom of this email

Sincerely,

Andrzej Galecki



============ Illustration  ========
 > selected.rows <- seq(1,308, by=10)
 > ovary <- Ovary[selected.rows,]       # selected rows
 > fm1 <- gls(follicles ~ sin(2*pi*Time) + cos(2*pi*Time), ovary, 
correlation = corAR1(form = ~ 1 | Mare))
 > vmtx <- getVarCov(fm1)   # Covariance matrix
 > corrmtx <- cov2cor(vmtx)  # Correlation matrix
 > print(corrmtx, corr=TRUE)
Marginal correlation matrix
        [,1]    [,2]    [,3]
[1,] 1.00000 0.39172 0.15345
[2,] 0.39172 1.00000 0.39172
[3,] 0.15345 0.39172 1.00000
  Standard Deviations: 1 1 1
 > print(corrmtx,corr=TRUE,stdevs=FALSE)
Marginal correlation matrix
        [,1]    [,2]    [,3]
[1,] 1.00000 0.39172 0.15345
[2,] 0.39172 1.00000 0.39172
[3,] 0.15345 0.39172 1.00000



==========Part of the Source code with suggested change  =======

 > getS3method("print","VarCov")
function (x, corr = FALSE, stdevs = TRUE, digits = 5, ...)
{
    pvc <- function(x, type, corr, stdevs, digits) {
        cat(c("Random effects", "Conditional", "Marginal")[match(type,
            c("random.effects", "conditional", "marginal"))],
            " ", sep = "")
        x <- as.matrix(x)
        class(x) <- NULL
        attr(x, "group.levels") <- NULL
        if (corr) {
            cat("correlation matrix\n")
            sds <- sqrt(diag(x))
            print(signif(t(x/sds)/sds, digits))
            stdevs <-  FALSE                          #  Inserted line
       }
        else {
            cat("variance covariance matrix\n")
            print(signif(x, digits))
            if (stdevs)
                sds <- sqrt(diag(x))
        }
 


=======================================================================

 > sessionInfo()
R version 2.6.1 (2007-11-26)
i386-pc-mingw32

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
States.1252;LC_MONETARY=English_United 
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] nlme_3.1-86

loaded via a namespace (and not attached):
[1] grid_2.6.1     lattice_0.17-2 tools_2.6.1   
 >


From ggrothendieck at gmail.com  Thu Jan 31 22:12:59 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 31 Jan 2008 16:12:59 -0500
Subject: [Rd] Feature request: about lag(), which.min() and cat().
In-Reply-To: <47A1CBF7.4090803@etu.unige.ch>
References: <47A1CBF7.4090803@etu.unige.ch>
Message-ID: <971536df0801311312w6c00cca2i4d7849b406abaf6d@mail.gmail.com>

On Jan 31, 2008 8:24 AM, Matthieu Stigler <stigler3 at etu.unige.ch> wrote:
> lag()
> If one wants to construct a time series model, it is often useful to
> have the lags matrix. This is available with embed(ts,k) but the time
> series class disappears. So it would be nice that the argument k of
> lag() also admit values of length >1, which would give the same result
> as embed() but keep the class. In his wish list of 1 January 2008 (point
> 8), Gabor Grothendieck spoke about a function Lag. Maybe also a function
> lags otherwise if the idea of length(k)>1 is not good?

It would be nice.  Note that lag.zoo in the zoo package does supports this
for zoo objects.

> library(zoo)
> z <- zoo((11:20)^2)
> lag(z, 1:2)
  lag1 lag2
1  144  169
2  169  196
3  196  225
4  225  256
5  256  289
6  289  324
7  324  361
8  361  400
9  400   NA

> # regress z on lag(z, 1:2) using dyn package
> library(dyn)
> dyn$lm(z ~ lag(z, 1:2))

Call:
lm(formula = dyn(z ~ lag(z, 1:2)))

Coefficients:
 (Intercept)  lag(z, 1:2)1  lag(z, 1:2)2
           2             2            -1

# as a workaround one could convert to zoo and back

> x <- ts((11:20)^2)
> as.ts(lag(as.zoo(x), 1:2))
Time Series:
Start = 1
End = 9
Frequency = 1
  lag1 lag2
1  144  169
2  169  196
3  196  225
4  225  256
5  256  289
6  289  324
7  324  361
8  361  400
9  400   NA
>


From hpages at fhcrc.org  Thu Jan 31 22:21:47 2008
From: hpages at fhcrc.org (Herve Pages)
Date: Thu, 31 Jan 2008 13:21:47 -0800
Subject: [Rd] segfault in gregexpr()
In-Reply-To: <m23aseox0b.fsf@userprimary.net>
References: <47A13725.6060208@fhcrc.org> <m2ejbypm4m.fsf@userprimary.net>
	<m23aseox0b.fsf@userprimary.net>
Message-ID: <47A23BEB.7030100@fhcrc.org>

Hi Seth,

Seth Falcon wrote:
> Hi again,
> 
>> Herve wrote:
>>   > gregexpr("", "abc", fixed=TRUE)
>>
>>    *** caught segfault ***
>>   address 0x1c09000, cause 'memory not mapped'
> 
> This should be fixed in latest svn.  Thanks for the report.

That's great. Thanks!

H.

> 
> + seth
>


