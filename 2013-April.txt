From htl10 at users.sourceforge.net  Mon Apr  1 11:18:45 2013
From: htl10 at users.sourceforge.net (Hin-Tak Leung)
Date: Mon, 1 Apr 2013 10:18:45 +0100 (BST)
Subject: [Rd] R/Sweave/cairo/freetype bug fix.
In-Reply-To: <1364670224.26868.BPMail_high_noncarrier@web172302.mail.ir2.yahoo.com>
Message-ID: <1364807925.91232.YahooMailClassic@web172306.mail.ir2.yahoo.com>

--- On Sat, 30/3/13, Hin-Tak Leung <htl10 at users.sourceforge.net> wrote:

> "... was committed to freetype in January and will form the
> next release (2.4.12)". 

It is perhaps worth repeating the quote:  'The official R binaries for windows ... are compiled against static libraries of cairo 1.10.2 ... are firmly in the "do not work correctly" category'

The minimum version of cairo to work being 1.11.2. On closer examination, the official bundle (http://www.rforge.net/Cairo/files/cairo-current-win.tar.gz) is built with neither fontconfig nor freetype. So even if it is bumped to current version (1.12.x), it does not work correctly.

Perhaps also wasn't clear in the bugzilla thread - everybody from fontconfig/cairo/freetype involved knew it being the issue so it has never been explicitly spelled out - the problem was (is) with cairo's pdf/ps generation, aided by freetype.

> ------------------------------
> On Sat, Mar 30, 2013 18:54 GMT Simon Urbanek wrote:
> 
> >On Mar 30, 2013, at 9:24 AM, Hin-Tak Leung wrote:
> >
> >> Perhaps that's too much details. There is (will be)
> a new freetype because of cairo's unanticipated usage (which
> R uses, among other cairo users). Most people should upgrade
> or request an upgrade eventually, when they are
> comfortable.
> >> 
> >
> >Which versions are affected? R binary for OS X uses
> freetype 2.4.11 (and cairo 1.12.14) so I just need to know
> if there is an action item.
> >
> >Thanks,
> >SImon
> >
> >
> >
> >> --- On Sat, 30/3/13, peter dalgaard <pdalgd at gmail.com>
> wrote:
> >> 
> >> Huh?
> >> 
> >> This is utterly incomprehensible without reading
> the redhat
> >> bugzilla, and even after reading, I'm not sure what
> the
> >> issue is. Something with bold Chinese fonts in X11,
> but
> >> maybe also affecting Latin fonts, ....?
> >> 
> >> Please explain yourself.
> >> 
> >> -pd
> >> 
> >> On Mar 30, 2013, at 09:25 , Hin-Tak Leung wrote:
> >> 
> >>> The problem was first seen with R/Sweave (#c0)
> then
> >> reproduced directly with cairo (#c10) and was
> eventually
> >> traced to freetype. The 5-part bug fix:
> >>> 610ee58e07090ead529849b2a454bb6c503b4995
> >>> da11e5e7647b668dee46fd0418ea5ecbc33ae3b2
> >>> e1a2ac1900f2f16ec48fb4840a6b7965a8373c2b
> >>> 869fb8c49ddf292d6daf4826172a308973d3e11f
> >>> d56e544d653b09c657911629557ffc5277a503e3
> >>> was committed to freetype in January and will
> form the
> >> next release (2.4.12). They were back ported to
> 2.4.11
> >>> https://bugzilla.redhat.com/show_bug.cgi?id=891457#c35
> >>> and the redhat people had further back-ported
> it to
> >> 2.4.10 for fedora 18/19 (#c51).
> >>> 
> >>> The freetype people had reproduced the problem
> with a
> >> latin font, so this affects most people, unlike
> what the
> >> initial report (#c0) suggests.
> >>> 
> >>> Since freetype is part of X11, most unix/linux
> users
> >> would be understandably nervous about breaking X
> (see #c45
> >> for screenshot of broken gnome terminal!) and
> should wait up
> >> to a year before the new and not-yet-released
> 2.4.12 becomes
> >> an official upgrade; or contact their favourite
> unix vendors
> >> and/or Apple for upgrades. AFAIK, current
> up-to-date linux
> >> distributions ships the rather older 2.4.10, with
> the
> >> exception of fedora 18/19 (#c51). Mac OS X 10.5
> ships
> >> freetype 2.3.5 as part of X11; I haven't bother
> looking up
> >> later Mac OS X's.
> >>> 
> >>> The official R binaries for windows and mac OS
> X are
> >> compiled against static libraries of cairo 1.10.2
> (over 2
> >> years old), and cairo 1.11.2 and freetype 2.4.4
> >> respectively, and are firmly in the "do not work
> correctly"
> >> category.
> >>> 
> >>> The long and short of the story is that
> R/Sweave uses a
> >> feature of cairo which wasn't implemented before
> cairo
> >> 1.11.2 (#c13, Jan 2011), which in turn depends on a
> feature
> >> of freetype that has been around since 2005 but did
> not
> >> anticipate cairo's usage. It is commendable that
> the
> >> freetype people did not refer to cairo's usage as
> "misuse"
> >> but took the patience to address the problem,
> unlike some
> >> group's style.
> >>> 
> >>> It has been an interesting few months returning
> to
> >> freetype after about 17 years, I think.
> >>> 
> >>> Here is how to look up what version of freetype
> -
> >> libfreetype.so.x.y.z for most unix platforms, and
> >> /usr/X11/lib/libfreetype.x.y.z.dylib on Mac OS X:
> >>> 
> >>> (excerpt from docs/VERSION.DLL)
> >>> 
> >>>? ? ? version???
> >> x.y.z???date of release
> >>>? ? ? 2.4.11 
> >>? ? 6.10.0? Dec 2012
> >>>? ? ? 2.4.10 
> >>? ? 6.9.0???June 2012
> >>>? ? ? 2.4.9?
> ???
> >> 6.8.1???March 2012
> >>> ...
> >>>? ? ? 2.4.4?
> ???
> >> 6.6.2???Nov 2010? (official R
> mac
> >> binaries)
> >>> ...
> >>>? ? ? 2.3.5?
> ???
> >> 6.3.16? July 2007 (Mac OS X 10.5)
> >>> 
> >>> 
> >>> ______________________________________________
> >>> R-devel at r-project.org
> >> mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-devel
> >> 
> >> -- 
> >> Peter Dalgaard, Professor,
> >> Center for Statistics, Copenhagen Business School
> >> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
> >> Phone: (+45)38153501
> >> Email: pd.mes at cbs.dk 
> >> Priv: PDalgd at gmail.com
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >> ______________________________________________
> >> R-devel at r-project.org
> mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >> 
> >> 
> >
> 
>


From simon.urbanek at r-project.org  Mon Apr  1 14:54:44 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 1 Apr 2013 08:54:44 -0400
Subject: [Rd] R/Sweave/cairo/freetype bug fix.
In-Reply-To: <1364807925.91232.YahooMailClassic@web172306.mail.ir2.yahoo.com>
References: <1364807925.91232.YahooMailClassic@web172306.mail.ir2.yahoo.com>
Message-ID: <379BF6E3-A020-46A4-8989-D25ED92BC622@r-project.org>


On Apr 1, 2013, at 5:18 AM, Hin-Tak Leung wrote:

> --- On Sat, 30/3/13, Hin-Tak Leung <htl10 at users.sourceforge.net> wrote:
> 
>> "... was committed to freetype in January and will form the
>> next release (2.4.12)". 
> 
> It is perhaps worth repeating the quote:  'The official R binaries for windows ... are compiled against static libraries of cairo 1.10.2 ... are firmly in the "do not work correctly" category'
> 
> The minimum version of cairo to work being 1.11.2. On closer examination, the official bundle (http://www.rforge.net/Cairo/files/cairo-current-win.tar.gz) is built with neither fontconfig nor freetype. So even if it is bumped to current version (1.12.x), it does not work correctly.
> 

That is not "the official bundle" - that is merely a convenience binary for the Cairo package (not to be confused with cairo back-end in R) for users that don't have cairographics installed on their system. I don't think that CRAN uses this for R builds.


> Perhaps also wasn't clear in the bugzilla thread - everybody from fontconfig/cairo/freetype involved knew it being the issue so it has never been explicitly spelled out - the problem was (is) with cairo's pdf/ps generation, aided by freetype.
> 

But then why would even the old binary in the Cairo package be an issue? It uses Win32 API, not freetype.

Cheers,
Simon



>> ------------------------------
>> On Sat, Mar 30, 2013 18:54 GMT Simon Urbanek wrote:
>> 
>>> On Mar 30, 2013, at 9:24 AM, Hin-Tak Leung wrote:
>>> 
>>>> Perhaps that's too much details. There is (will be)
>> a new freetype because of cairo's unanticipated usage (which
>> R uses, among other cairo users). Most people should upgrade
>> or request an upgrade eventually, when they are
>> comfortable.
>>>> 
>>> 
>>> Which versions are affected? R binary for OS X uses
>> freetype 2.4.11 (and cairo 1.12.14) so I just need to know
>> if there is an action item.
>>> 
>>> Thanks,
>>> SImon
>>> 
>>> 
>>> 
>>>> --- On Sat, 30/3/13, peter dalgaard <pdalgd at gmail.com>
>> wrote:
>>>> 
>>>> Huh?
>>>> 
>>>> This is utterly incomprehensible without reading
>> the redhat
>>>> bugzilla, and even after reading, I'm not sure what
>> the
>>>> issue is. Something with bold Chinese fonts in X11,
>> but
>>>> maybe also affecting Latin fonts, ....?
>>>> 
>>>> Please explain yourself.
>>>> 
>>>> -pd
>>>> 
>>>> On Mar 30, 2013, at 09:25 , Hin-Tak Leung wrote:
>>>> 
>>>>> The problem was first seen with R/Sweave (#c0)
>> then
>>>> reproduced directly with cairo (#c10) and was
>> eventually
>>>> traced to freetype. The 5-part bug fix:
>>>>> 610ee58e07090ead529849b2a454bb6c503b4995
>>>>> da11e5e7647b668dee46fd0418ea5ecbc33ae3b2
>>>>> e1a2ac1900f2f16ec48fb4840a6b7965a8373c2b
>>>>> 869fb8c49ddf292d6daf4826172a308973d3e11f
>>>>> d56e544d653b09c657911629557ffc5277a503e3
>>>>> was committed to freetype in January and will
>> form the
>>>> next release (2.4.12). They were back ported to
>> 2.4.11
>>>>> https://bugzilla.redhat.com/show_bug.cgi?id=891457#c35
>>>>> and the redhat people had further back-ported
>> it to
>>>> 2.4.10 for fedora 18/19 (#c51).
>>>>> 
>>>>> The freetype people had reproduced the problem
>> with a
>>>> latin font, so this affects most people, unlike
>> what the
>>>> initial report (#c0) suggests.
>>>>> 
>>>>> Since freetype is part of X11, most unix/linux
>> users
>>>> would be understandably nervous about breaking X
>> (see #c45
>>>> for screenshot of broken gnome terminal!) and
>> should wait up
>>>> to a year before the new and not-yet-released
>> 2.4.12 becomes
>>>> an official upgrade; or contact their favourite
>> unix vendors
>>>> and/or Apple for upgrades. AFAIK, current
>> up-to-date linux
>>>> distributions ships the rather older 2.4.10, with
>> the
>>>> exception of fedora 18/19 (#c51). Mac OS X 10.5
>> ships
>>>> freetype 2.3.5 as part of X11; I haven't bother
>> looking up
>>>> later Mac OS X's.
>>>>> 
>>>>> The official R binaries for windows and mac OS
>> X are
>>>> compiled against static libraries of cairo 1.10.2
>> (over 2
>>>> years old), and cairo 1.11.2 and freetype 2.4.4
>>>> respectively, and are firmly in the "do not work
>> correctly"
>>>> category.
>>>>> 
>>>>> The long and short of the story is that
>> R/Sweave uses a
>>>> feature of cairo which wasn't implemented before
>> cairo
>>>> 1.11.2 (#c13, Jan 2011), which in turn depends on a
>> feature
>>>> of freetype that has been around since 2005 but did
>> not
>>>> anticipate cairo's usage. It is commendable that
>> the
>>>> freetype people did not refer to cairo's usage as
>> "misuse"
>>>> but took the patience to address the problem,
>> unlike some
>>>> group's style.
>>>>> 
>>>>> It has been an interesting few months returning
>> to
>>>> freetype after about 17 years, I think.
>>>>> 
>>>>> Here is how to look up what version of freetype
>> -
>>>> libfreetype.so.x.y.z for most unix platforms, and
>>>> /usr/X11/lib/libfreetype.x.y.z.dylib on Mac OS X:
>>>>> 
>>>>> (excerpt from docs/VERSION.DLL)
>>>>> 
>>>>>       version   
>>>> x.y.z   date of release
>>>>>       2.4.11 
>>>>     6.10.0  Dec 2012
>>>>>       2.4.10 
>>>>     6.9.0   June 2012
>>>>>       2.4.9 
>>    
>>>> 6.8.1   March 2012
>>>>> ...
>>>>>       2.4.4 
>>    
>>>> 6.6.2   Nov 2010  (official R
>> mac
>>>> binaries)
>>>>> ...
>>>>>       2.3.5 
>>    
>>>> 6.3.16  July 2007 (Mac OS X 10.5)
>>>>> 
>>>>> 
>>>>> ______________________________________________
>>>>> R-devel at r-project.org
>>>> mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>> 
>>>> -- 
>>>> Peter Dalgaard, Professor,
>>>> Center for Statistics, Copenhagen Business School
>>>> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
>>>> Phone: (+45)38153501
>>>> Email: pd.mes at cbs.dk 
>>>> Priv: PDalgd at gmail.com
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> ______________________________________________
>>>> R-devel at r-project.org
>> mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>> 
>>>> 
>>> 
>> 
>> 
> 
> 


From therneau at mayo.edu  Mon Apr  1 19:10:06 2013
From: therneau at mayo.edu (Terry Therneau)
Date: Mon, 01 Apr 2013 12:10:06 -0500
Subject: [Rd] Timing of SET_VECTOR_ELT
Message-ID: <5159BF6E.5050709@mayo.edu>

Assume a C program invoked by .Call, that returns a list.

  Near the top of the program we allocate space for all the list elements. (It is my habit 
to use "xyz2" for the name of the R object and "xyz" for the pointer to its contents.)

     PROTECT(means2 = allocVector(REALSXP, nvar));
     means = REAL(means2);
     PROTECT(u2 = allocVector(REALSXP, nvar));
     u = REAL(u2);
     PROTECT(loglik2 = allocVector(REALSXP, 2));
     loglik = REAL(loglik2);

     PROTECT(rlist = mknamed(VECSXP, outnames));

Can I assign the individual elements into rlist using SET_VECTOR_ELT at this point, or do 
I need to wait until the end of the program, after I've filled in means[i], u[i], etc.?  I 
likely depends on whether I'm assigning a pointer or a copy.


Terry T.


From simon.urbanek at r-project.org  Mon Apr  1 19:44:51 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 1 Apr 2013 13:44:51 -0400
Subject: [Rd] Timing of SET_VECTOR_ELT
In-Reply-To: <5159BF6E.5050709@mayo.edu>
References: <5159BF6E.5050709@mayo.edu>
Message-ID: <B88959A2-D5E3-4580-9094-CA98FAF9ECA0@r-project.org>


On Apr 1, 2013, at 1:10 PM, Terry Therneau wrote:

> Assume a C program invoked by .Call, that returns a list.
> 
> Near the top of the program we allocate space for all the list elements. (It is my habit to use "xyz2" for the name of the R object and "xyz" for the pointer to its contents.)
> 
>    PROTECT(means2 = allocVector(REALSXP, nvar));
>    means = REAL(means2);
>    PROTECT(u2 = allocVector(REALSXP, nvar));
>    u = REAL(u2);
>    PROTECT(loglik2 = allocVector(REALSXP, 2));
>    loglik = REAL(loglik2);
> 
>    PROTECT(rlist = mknamed(VECSXP, outnames));
> 
> Can I assign the individual elements into rlist using SET_VECTOR_ELT at this point, or do I need to wait until the end of the program, after I've filled in means[i], u[i], etc.?  I likely depends on whether I'm assigning a pointer or a copy.
> 

You're assigning a pointer, so it doesn't matter.

FWIW, you can avoid all the PROTECTion mess if you alloc+assign, e.g.

SEXP rlist = PROTECT(mknamed(VECSXP, outnames));
SEXP means = SET_VECTOR_ELT(rlist, 0, allocVector(REALSXP, nvar));
...

since you only need to protect the parent object.

Cheers,
Simon


From murdoch.duncan at gmail.com  Mon Apr  1 19:54:31 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 01 Apr 2013 13:54:31 -0400
Subject: [Rd] Timing of SET_VECTOR_ELT
In-Reply-To: <5159BF6E.5050709@mayo.edu>
References: <5159BF6E.5050709@mayo.edu>
Message-ID: <5159C9D7.7080808@gmail.com>

On 01/04/2013 1:10 PM, Terry Therneau wrote:
> Assume a C program invoked by .Call, that returns a list.
>
>    Near the top of the program we allocate space for all the list elements. (It is my habit
> to use "xyz2" for the name of the R object and "xyz" for the pointer to its contents.)
>
>       PROTECT(means2 = allocVector(REALSXP, nvar));
>       means = REAL(means2);
>       PROTECT(u2 = allocVector(REALSXP, nvar));
>       u = REAL(u2);
>       PROTECT(loglik2 = allocVector(REALSXP, 2));
>       loglik = REAL(loglik2);
>
>       PROTECT(rlist = mknamed(VECSXP, outnames));
>
> Can I assign the individual elements into rlist using SET_VECTOR_ELT at this point, or do
> I need to wait until the end of the program, after I've filled in means[i], u[i], etc.?  I
> likely depends on whether I'm assigning a pointer or a copy.

You could assign them at this point, but only if you're sure the 
pointers won't change.   You might change the pointers if you reallocate 
a vector to lengthen it or shorten it, for example. Generally speaking 
this won't happen behind your back, but you might forget and do it in 
the future when you modify the function, so I'd say it's safer to wait 
until the last minute to put the pointers in the list.

Duncan Murdoch


From therneau at mayo.edu  Mon Apr  1 20:54:58 2013
From: therneau at mayo.edu (Terry Therneau)
Date: Mon, 01 Apr 2013 13:54:58 -0500
Subject: [Rd] Timing of SET_VECTOR_ELT
In-Reply-To: <B88959A2-D5E3-4580-9094-CA98FAF9ECA0@r-project.org>
References: <5159BF6E.5050709@mayo.edu>
	<B88959A2-D5E3-4580-9094-CA98FAF9ECA0@r-project.org>
Message-ID: <5159D802.6000706@mayo.edu>



On 04/01/2013 12:44 PM, Simon Urbanek wrote:
> On Apr 1, 2013, at 1:10 PM, Terry Therneau wrote:
>
>> Assume a C program invoked by .Call, that returns a list.
>>
>> Near the top of the program we allocate space for all the list elements. (It is my habit to use "xyz2" for the name of the R object and "xyz" for the pointer to its contents.)
>>
>>     PROTECT(means2 = allocVector(REALSXP, nvar));
>>     means = REAL(means2);
>>     PROTECT(u2 = allocVector(REALSXP, nvar));
>>     u = REAL(u2);
>>     PROTECT(loglik2 = allocVector(REALSXP, 2));
>>     loglik = REAL(loglik2);
>>
>>     PROTECT(rlist = mknamed(VECSXP, outnames));
>>
>> Can I assign the individual elements into rlist using SET_VECTOR_ELT at this point, or do I need to wait until the end of the program, after I've filled in means[i], u[i], etc.?  I likely depends on whether I'm assigning a pointer or a copy.
>>
> You're assigning a pointer, so it doesn't matter.
>
> FWIW, you can avoid all the PROTECTion mess if you alloc+assign, e.g.
>
> SEXP rlist = PROTECT(mknamed(VECSXP, outnames));
> SEXP means = SET_VECTOR_ELT(rlist, 0, allocVector(REALSXP, nvar));
> ...
>
> since you only need to protect the parent object.
>
> Cheers,
> Simon
Neat trick.  I take it that SET_VECTOR_ELT returns a pointer to the object that was just 
created?  I haven't found a description of the function in any of the documents, only 
examples of its use, so this is a surprise to me.
    Lacking documentation, can I count on it in the future?

Terry T.


From simon.urbanek at r-project.org  Mon Apr  1 21:11:49 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 1 Apr 2013 15:11:49 -0400
Subject: [Rd] Timing of SET_VECTOR_ELT
In-Reply-To: <5159D802.6000706@mayo.edu>
References: <5159BF6E.5050709@mayo.edu>
	<B88959A2-D5E3-4580-9094-CA98FAF9ECA0@r-project.org>
	<5159D802.6000706@mayo.edu>
Message-ID: <EB694CF2-3A7A-4643-949A-D0B84E92614D@r-project.org>

On Apr 1, 2013, at 2:54 PM, Terry Therneau wrote:

> 
> 
> On 04/01/2013 12:44 PM, Simon Urbanek wrote:
>> On Apr 1, 2013, at 1:10 PM, Terry Therneau wrote:
>> 
>>> Assume a C program invoked by .Call, that returns a list.
>>> 
>>> Near the top of the program we allocate space for all the list elements. (It is my habit to use "xyz2" for the name of the R object and "xyz" for the pointer to its contents.)
>>> 
>>>    PROTECT(means2 = allocVector(REALSXP, nvar));
>>>    means = REAL(means2);
>>>    PROTECT(u2 = allocVector(REALSXP, nvar));
>>>    u = REAL(u2);
>>>    PROTECT(loglik2 = allocVector(REALSXP, 2));
>>>    loglik = REAL(loglik2);
>>> 
>>>    PROTECT(rlist = mknamed(VECSXP, outnames));
>>> 
>>> Can I assign the individual elements into rlist using SET_VECTOR_ELT at this point, or do I need to wait until the end of the program, after I've filled in means[i], u[i], etc.?  I likely depends on whether I'm assigning a pointer or a copy.
>>> 
>> You're assigning a pointer, so it doesn't matter.
>> 
>> FWIW, you can avoid all the PROTECTion mess if you alloc+assign, e.g.
>> 
>> SEXP rlist = PROTECT(mknamed(VECSXP, outnames));
>> SEXP means = SET_VECTOR_ELT(rlist, 0, allocVector(REALSXP, nvar));
>> ...
>> 
>> since you only need to protect the parent object.
>> 
>> Cheers,
>> Simon
> Neat trick.  I take it that SET_VECTOR_ELT returns a pointer to the object that was just created?  I haven't found a description of the function in any of the documents, only examples of its use, so this is a surprise to me.
>   Lacking documentation, can I count on it in the future?
> 

Well, it's a pretty fundamental function, so if its behavior changed, the whole world would collapse ;) so if you can't rely on SET_VECTOR_ELT then I don't know what else you can rely on. Its return value is also used in R itself, so it's not an obscure use. It may look a bit scary as the upper-case may suggest it's a macro, but R-exts clarifies that it is a function so the above is ok (and it's frequently used with allocations in R itself).

Cheers,
Simon


From r.d.morey at rug.nl  Tue Apr  2 01:52:26 2013
From: r.d.morey at rug.nl (Richard D. Morey)
Date: Tue, 2 Apr 2013 01:52:26 +0200
Subject: [Rd] missing exported methods when compiling vignettes in R 3.0.0 RC
In-Reply-To: <mailman.11.1364810408.30516.r-devel@r-project.org>
References: <mailman.11.1364810408.30516.r-devel@r-project.org>
Message-ID: <1B1B843261D34A409EEE3DCAE737981E@rug.nl>

A new problem has cropped up with compiling vignettes for my package BayesFactor. I'm not sure when it started, but I can tell you it didn't occur on R 2.15.3, and it does on 3.0.0 RC (2013-03-31 r62463) (session info is at the bottom of this message).

I have defined methods for which.min and which.max for a class (I've defined both S3 and S4 methods for the class "BFBayesFactor") in my package. I've exported the S4 class using exportMethods, and declared the S3 method with S3method. You can see the NAMESPACE file here:

https://r-forge.r-project.org/scm/viewvc.php/pkg/BayesFactorPCL/NAMESPACE?view=markup&root=bayesfactorpcl

and the methods here:

https://r-forge.r-project.org/scm/viewvc.php/pkg/BayesFactorPCL/R/methods-BFBayesFactor.R?view=markup&root=bayesfactorpcl

I have code in a vignette that calls the which.max method on a BFBayesFactor object. However, when that happens as the vignette is being compiled, I get an error:

which.max(bf)
## Error: no method for coercing this S4 class to a vector



This also occurs with which.min, but oddly not any other method (including the is.na method, which is declared exactly the same way, as far as I can tell). This seems to imply that the which.min and which.max methods are not exported.

When I use double colon notation - which as I understand, only works with exported functions - it works (see below).

When I compile the Rmd file manually, I do not see this problem; I get no errors. This seems to be a problem unique to compiling the vignette. I've tried it in Rstudio, R from the command line, and using Rscript and calling knitr directly. It only occurs when building a vignette for the source package.

Steps to reproduce:
1. Check out latest version of BayesFactor package from R-forge (https://r-forge.r-project.org/scm/?group_id=554) (revision 320)

2. Create a source package (which compiles the vignette)

3. Open tar to see compiled vignette HTML (doc/manual.html - or, alternatively, see https://www.dropbox.com/s/6csznytp8i1akjl/manual.html). Search for second occurrence of "which.max", and see the following lines:

## which model index is the best? 
is(bf, "BFBayesFactor") 
## [1] TRUE 
BayesFactor::which.max(bf) 
## complaints 
## 1 
BayesFactor::which.min(bf) 
## critical + advance 
## 21 
which.max(bf) 
## Error: no method for coercing this S4 class to a vector 
which.min(bf) 
## Error: no method for coercing this S4 class to a vector 



I've been pulling my hair out on this, especially because something seems to have changed over the past few weeks that caused this, but I didn't catch exactly when, and I don't know if the issue lies with R 3.0.0 or my package.

> sessionInfo()
R version 3.0.0 RC (2013-03-31 r62463)
Platform: x86_64-apple-darwin10.8.0 (64-bit)
locale:
[1] en_AU.UTF-8/en_AU.UTF-8/en_AU.UTF-8/C/en_AU.UTF-8/en_AU.UTF-8
attached base packages:
[1] stats graphics grDevices utils datasets methods base 
other attached packages:
[1] BayesFactor_0.9.5 markdown_0.5.4 knitr_1.1.6 coda_0.16-1 lattice_0.20-15 
loaded via a namespace (and not attached):
[1] digest_0.6.3 evaluate_0.4.3 formatR_0.7 grid_3.0.0 mvtnorm_0.9-9994
[6] pbapply_1.0-5 stringr_0.6.2 tools_3.0.0  




Any help would be greatly appreciated,
Richard


From hb at biostat.ucsf.edu  Tue Apr  2 02:37:44 2013
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Mon, 1 Apr 2013 17:37:44 -0700
Subject: [Rd] missing exported methods when compiling vignettes in R
	3.0.0 RC
In-Reply-To: <1B1B843261D34A409EEE3DCAE737981E@rug.nl>
References: <mailman.11.1364810408.30516.r-devel@r-project.org>
	<1B1B843261D34A409EEE3DCAE737981E@rug.nl>
Message-ID: <CAFDcVCQHM+1uj1NBr1kDHbJnArRqXOqxCrbkZ3g+GPZAc0KG2g@mail.gmail.com>

Hi,

things have indeed changed on how non-Sweave vignettes are built (this
happened around R devel 2013-03-05 r62130).  However, it's not clear
to me what changes would be behind your problems, if any.

Build your vignette with the following buildVignette(), which emulates
what R does when it builds vignettes (cf. tools::buildVignettes()).
As you'll see, it reproduces your error:

if (!exists("buildVignette", mode="function")) {
  source("http://r-forge.r-project.org/scm/viewvc.php/*checkout*/pkg/R.rsp/R/buildVignette.R?root=r-dots");
}

EXAMPLE (in a fresh R session):

url <- "http://r-forge.r-project.org/scm/viewvc.php/*checkout*/pkg/BayesFactorPCL/vignettes/manual.Rmd?root=bayesfactorpcl"
if (!file.exists("manual.Rmd")) download.file(url, "manual.Rmd");

output <- buildVignette("manual.Rmd", buildPkg="knitr");
browseURL(output);

bfr <- readLines(output);
idxs <- grep("which.max(bf)", bfr, fixed=TRUE);
idxs <- sort(sapply(idxs, FUN=function(idx) idx+(-5:5)));
cat(sprintf("%03d: %s\n", idxs, bfr[idxs]));

> cat(sprintf("%03d: %s", idxs, bfr[idxs]), sep="\n")
2517: </code></pre>
2518:
2519: <pre><code>## [1] TRUE
2520: </code></pre>
2521:
2522: <pre><code class="r">BayesFactor::which.max(bf)
2523: </code></pre>
2524:
2525: <pre><code>## complaints
2526: ##          1
2527: </code></pre>
2531:
2532: <pre><code>## critical + advance
2533: ##                 21
2534: </code></pre>
2535:
2536: <pre><code class="r">which.max(bf)
2537: </code></pre>
2538:
2539: <pre><code>## Error: no method for coercing this S4 class to a vector
2540: </code></pre>
2541:

So, have a look at browseVignette() and how it calls the 'knitr' weave
function.  That should help you narrow down what's going on.

> sessionInfo()
R version 3.0.0 RC (2013-03-31 r62463)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] tools     stats     graphics  grDevices utils     datasets  methods
[8] base

other attached packages:
[1] BayesFactor_0.9.3 markdown_0.5.4    coda_0.16-1       lattice_0.20-15
[5] knitr_1.1.7

loaded via a namespace (and not attached):
[1] digest_0.6.3     evaluate_0.4.3   formatR_0.7      grid_3.0.0
[5] mvtnorm_0.9-9994 pbapply_1.0-5    stringr_0.6.2

Hope this helps

/Henrik

On Mon, Apr 1, 2013 at 4:52 PM, Richard D. Morey <r.d.morey at rug.nl> wrote:
> A new problem has cropped up with compiling vignettes for my package BayesFactor. I'm not sure when it started, but I can tell you it didn't occur on R 2.15.3, and it does on 3.0.0 RC (2013-03-31 r62463) (session info is at the bottom of this message).
>
> I have defined methods for which.min and which.max for a class (I've defined both S3 and S4 methods for the class "BFBayesFactor") in my package. I've exported the S4 class using exportMethods, and declared the S3 method with S3method. You can see the NAMESPACE file here:
>
> https://r-forge.r-project.org/scm/viewvc.php/pkg/BayesFactorPCL/NAMESPACE?view=markup&root=bayesfactorpcl
>
> and the methods here:
>
> https://r-forge.r-project.org/scm/viewvc.php/pkg/BayesFactorPCL/R/methods-BFBayesFactor.R?view=markup&root=bayesfactorpcl
>
> I have code in a vignette that calls the which.max method on a BFBayesFactor object. However, when that happens as the vignette is being compiled, I get an error:
>
> which.max(bf)
> ## Error: no method for coercing this S4 class to a vector
>
>
>
> This also occurs with which.min, but oddly not any other method (including the is.na method, which is declared exactly the same way, as far as I can tell). This seems to imply that the which.min and which.max methods are not exported.
>
> When I use double colon notation - which as I understand, only works with exported functions - it works (see below).
>
> When I compile the Rmd file manually, I do not see this problem; I get no errors. This seems to be a problem unique to compiling the vignette. I've tried it in Rstudio, R from the command line, and using Rscript and calling knitr directly. It only occurs when building a vignette for the source package.
>
> Steps to reproduce:
> 1. Check out latest version of BayesFactor package from R-forge (https://r-forge.r-project.org/scm/?group_id=554) (revision 320)
>
> 2. Create a source package (which compiles the vignette)
>
> 3. Open tar to see compiled vignette HTML (doc/manual.html - or, alternatively, see https://www.dropbox.com/s/6csznytp8i1akjl/manual.html). Search for second occurrence of "which.max", and see the following lines:
>
> ## which model index is the best?
> is(bf, "BFBayesFactor")
> ## [1] TRUE
> BayesFactor::which.max(bf)
> ## complaints
> ## 1
> BayesFactor::which.min(bf)
> ## critical + advance
> ## 21
> which.max(bf)
> ## Error: no method for coercing this S4 class to a vector
> which.min(bf)
> ## Error: no method for coercing this S4 class to a vector
>
>
>
> I've been pulling my hair out on this, especially because something seems to have changed over the past few weeks that caused this, but I didn't catch exactly when, and I don't know if the issue lies with R 3.0.0 or my package.
>
>> sessionInfo()
> R version 3.0.0 RC (2013-03-31 r62463)
> Platform: x86_64-apple-darwin10.8.0 (64-bit)
> locale:
> [1] en_AU.UTF-8/en_AU.UTF-8/en_AU.UTF-8/C/en_AU.UTF-8/en_AU.UTF-8
> attached base packages:
> [1] stats graphics grDevices utils datasets methods base
> other attached packages:
> [1] BayesFactor_0.9.5 markdown_0.5.4 knitr_1.1.6 coda_0.16-1 lattice_0.20-15
> loaded via a namespace (and not attached):
> [1] digest_0.6.3 evaluate_0.4.3 formatR_0.7 grid_3.0.0 mvtnorm_0.9-9994
> [6] pbapply_1.0-5 stringr_0.6.2 tools_3.0.0
>
>
>
>
> Any help would be greatly appreciated,
> Richard
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From mtmorgan at fhcrc.org  Tue Apr  2 04:02:13 2013
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Mon, 01 Apr 2013 19:02:13 -0700
Subject: [Rd] missing exported methods when compiling vignettes in R
 3.0.0 RC
In-Reply-To: <CAFDcVCQHM+1uj1NBr1kDHbJnArRqXOqxCrbkZ3g+GPZAc0KG2g@mail.gmail.com>
References: <mailman.11.1364810408.30516.r-devel@r-project.org>
	<1B1B843261D34A409EEE3DCAE737981E@rug.nl>
	<CAFDcVCQHM+1uj1NBr1kDHbJnArRqXOqxCrbkZ3g+GPZAc0KG2g@mail.gmail.com>
Message-ID: <515A3C25.30709@fhcrc.org>

On 04/01/2013 05:37 PM, Henrik Bengtsson wrote:
> Hi,
>
> things have indeed changed on how non-Sweave vignettes are built (this
> happened around R devel 2013-03-05 r62130).  However, it's not clear
> to me what changes would be behind your problems, if any.
>
> Build your vignette with the following buildVignette(), which emulates
> what R does when it builds vignettes (cf. tools::buildVignettes()).
> As you'll see, it reproduces your error:

Maybe to further move this along, the vignette can be replaced with

<!--
%\VignetteEngine{knitr}
%\VignetteIndexEntry{Using the BayesFactor package, version 0.9.2+}
-->
```{r}
library(BayesFactor)
which.min
```

and built with

   tools:::buildVignettes(dir="~/tmp/pkg/BayesFactorPCL/")

and the output shows that which.min is not the expected S4 generic.

BayesFactorPCL/vignettes$ tail manual.html
</code></pre>

<pre><code>## function (x)
## .Internal(which.min(x))
## &lt;environment: namespace:base&gt;
</code></pre>

</body>

</html>

This contrasts with, e.g.,

   R -e "knitr::knit2html('~/tmp/pkg/BayesFactorPCL/vignettes/manual.Rmd')"

which gives

BayesFactorPCL/vignettes$ tail manual.html
## function (x)
## standardGeneric(&quot;which.min&quot;)
## &lt;environment: 0x8f5b0c0&gt;
## Methods may be defined for arguments: x
## Use  showMethods(&quot;which.min&quot;)  for currently available ones.
</code></pre>

</body>

</html>

One (or two) other minor points -- which.min / which.max are _not_ S3 generics, 
so I'm not sure it makes sense to define / export S3 methods. The implicit 
generics which.min / which.max need to be documented.

Martin

>
> if (!exists("buildVignette", mode="function")) {
>    source("http://r-forge.r-project.org/scm/viewvc.php/*checkout*/pkg/R.rsp/R/buildVignette.R?root=r-dots");
> }
>
> EXAMPLE (in a fresh R session):
>
> url <- "http://r-forge.r-project.org/scm/viewvc.php/*checkout*/pkg/BayesFactorPCL/vignettes/manual.Rmd?root=bayesfactorpcl"
> if (!file.exists("manual.Rmd")) download.file(url, "manual.Rmd");
>
> output <- buildVignette("manual.Rmd", buildPkg="knitr");
> browseURL(output);
>
> bfr <- readLines(output);
> idxs <- grep("which.max(bf)", bfr, fixed=TRUE);
> idxs <- sort(sapply(idxs, FUN=function(idx) idx+(-5:5)));
> cat(sprintf("%03d: %s\n", idxs, bfr[idxs]));
>
>> cat(sprintf("%03d: %s", idxs, bfr[idxs]), sep="\n")
> 2517: </code></pre>
> 2518:
> 2519: <pre><code>## [1] TRUE
> 2520: </code></pre>
> 2521:
> 2522: <pre><code class="r">BayesFactor::which.max(bf)
> 2523: </code></pre>
> 2524:
> 2525: <pre><code>## complaints
> 2526: ##          1
> 2527: </code></pre>
> 2531:
> 2532: <pre><code>## critical + advance
> 2533: ##                 21
> 2534: </code></pre>
> 2535:
> 2536: <pre><code class="r">which.max(bf)
> 2537: </code></pre>
> 2538:
> 2539: <pre><code>## Error: no method for coercing this S4 class to a vector
> 2540: </code></pre>
> 2541:
>
> So, have a look at browseVignette() and how it calls the 'knitr' weave
> function.  That should help you narrow down what's going on.
>
>> sessionInfo()
> R version 3.0.0 RC (2013-03-31 r62463)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] tools     stats     graphics  grDevices utils     datasets  methods
> [8] base
>
> other attached packages:
> [1] BayesFactor_0.9.3 markdown_0.5.4    coda_0.16-1       lattice_0.20-15
> [5] knitr_1.1.7
>
> loaded via a namespace (and not attached):
> [1] digest_0.6.3     evaluate_0.4.3   formatR_0.7      grid_3.0.0
> [5] mvtnorm_0.9-9994 pbapply_1.0-5    stringr_0.6.2
>
> Hope this helps
>
> /Henrik
>
> On Mon, Apr 1, 2013 at 4:52 PM, Richard D. Morey <r.d.morey at rug.nl> wrote:
>> A new problem has cropped up with compiling vignettes for my package BayesFactor. I'm not sure when it started, but I can tell you it didn't occur on R 2.15.3, and it does on 3.0.0 RC (2013-03-31 r62463) (session info is at the bottom of this message).
>>
>> I have defined methods for which.min and which.max for a class (I've defined both S3 and S4 methods for the class "BFBayesFactor") in my package. I've exported the S4 class using exportMethods, and declared the S3 method with S3method. You can see the NAMESPACE file here:
>>
>> https://r-forge.r-project.org/scm/viewvc.php/pkg/BayesFactorPCL/NAMESPACE?view=markup&root=bayesfactorpcl
>>
>> and the methods here:
>>
>> https://r-forge.r-project.org/scm/viewvc.php/pkg/BayesFactorPCL/R/methods-BFBayesFactor.R?view=markup&root=bayesfactorpcl
>>
>> I have code in a vignette that calls the which.max method on a BFBayesFactor object. However, when that happens as the vignette is being compiled, I get an error:
>>
>> which.max(bf)
>> ## Error: no method for coercing this S4 class to a vector
>>
>>
>>
>> This also occurs with which.min, but oddly not any other method (including the is.na method, which is declared exactly the same way, as far as I can tell). This seems to imply that the which.min and which.max methods are not exported.
>>
>> When I use double colon notation - which as I understand, only works with exported functions - it works (see below).
>>
>> When I compile the Rmd file manually, I do not see this problem; I get no errors. This seems to be a problem unique to compiling the vignette. I've tried it in Rstudio, R from the command line, and using Rscript and calling knitr directly. It only occurs when building a vignette for the source package.
>>
>> Steps to reproduce:
>> 1. Check out latest version of BayesFactor package from R-forge (https://r-forge.r-project.org/scm/?group_id=554) (revision 320)
>>
>> 2. Create a source package (which compiles the vignette)
>>
>> 3. Open tar to see compiled vignette HTML (doc/manual.html - or, alternatively, see https://www.dropbox.com/s/6csznytp8i1akjl/manual.html). Search for second occurrence of "which.max", and see the following lines:
>>
>> ## which model index is the best?
>> is(bf, "BFBayesFactor")
>> ## [1] TRUE
>> BayesFactor::which.max(bf)
>> ## complaints
>> ## 1
>> BayesFactor::which.min(bf)
>> ## critical + advance
>> ## 21
>> which.max(bf)
>> ## Error: no method for coercing this S4 class to a vector
>> which.min(bf)
>> ## Error: no method for coercing this S4 class to a vector
>>
>>
>>
>> I've been pulling my hair out on this, especially because something seems to have changed over the past few weeks that caused this, but I didn't catch exactly when, and I don't know if the issue lies with R 3.0.0 or my package.
>>
>>> sessionInfo()
>> R version 3.0.0 RC (2013-03-31 r62463)
>> Platform: x86_64-apple-darwin10.8.0 (64-bit)
>> locale:
>> [1] en_AU.UTF-8/en_AU.UTF-8/en_AU.UTF-8/C/en_AU.UTF-8/en_AU.UTF-8
>> attached base packages:
>> [1] stats graphics grDevices utils datasets methods base
>> other attached packages:
>> [1] BayesFactor_0.9.5 markdown_0.5.4 knitr_1.1.6 coda_0.16-1 lattice_0.20-15
>> loaded via a namespace (and not attached):
>> [1] digest_0.6.3 evaluate_0.4.3 formatR_0.7 grid_3.0.0 mvtnorm_0.9-9994
>> [6] pbapply_1.0-5 stringr_0.6.2 tools_3.0.0
>>
>>
>>
>>
>> Any help would be greatly appreciated,
>> Richard
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From xie at yihui.name  Tue Apr  2 04:40:52 2013
From: xie at yihui.name (Yihui Xie)
Date: Mon, 1 Apr 2013 21:40:52 -0500
Subject: [Rd] missing exported methods when compiling vignettes in R
	3.0.0 RC
In-Reply-To: <CAFDcVCQHM+1uj1NBr1kDHbJnArRqXOqxCrbkZ3g+GPZAc0KG2g@mail.gmail.com>
References: <mailman.11.1364810408.30516.r-devel@r-project.org>
	<1B1B843261D34A409EEE3DCAE737981E@rug.nl>
	<CAFDcVCQHM+1uj1NBr1kDHbJnArRqXOqxCrbkZ3g+GPZAc0KG2g@mail.gmail.com>
Message-ID: <CANROs4e_bJSTHq-t1Pyb8wxBwV_0w1XY05wQsXZhWTyh-map9Q@mail.gmail.com>

I do not know much about S4, but I figured out one possible solution
on knitr's side, which I do not really understand. In short, your S4
methods need to be evaluated in globalenv(), but knitr uses the
parent.frame() by default, which is not the global environment when it
is called as the vignette builder.

Now I have forced the evaluation to be in the global environment, and
pushed the changes to the knitr development version on Github:
https://github.com/yihui/knitr

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Phone: 515-294-2465 Web: http://yihui.name
Department of Statistics, Iowa State University
2215 Snedecor Hall, Ames, IA


On Mon, Apr 1, 2013 at 7:37 PM, Henrik Bengtsson <hb at biostat.ucsf.edu> wrote:
> Hi,
>
> things have indeed changed on how non-Sweave vignettes are built (this
> happened around R devel 2013-03-05 r62130).  However, it's not clear
> to me what changes would be behind your problems, if any.
>
> Build your vignette with the following buildVignette(), which emulates
> what R does when it builds vignettes (cf. tools::buildVignettes()).
> As you'll see, it reproduces your error:
>
> if (!exists("buildVignette", mode="function")) {
>   source("http://r-forge.r-project.org/scm/viewvc.php/*checkout*/pkg/R.rsp/R/buildVignette.R?root=r-dots");
> }
>
> EXAMPLE (in a fresh R session):
>
> url <- "http://r-forge.r-project.org/scm/viewvc.php/*checkout*/pkg/BayesFactorPCL/vignettes/manual.Rmd?root=bayesfactorpcl"
> if (!file.exists("manual.Rmd")) download.file(url, "manual.Rmd");
>
> output <- buildVignette("manual.Rmd", buildPkg="knitr");
> browseURL(output);
>
> bfr <- readLines(output);
> idxs <- grep("which.max(bf)", bfr, fixed=TRUE);
> idxs <- sort(sapply(idxs, FUN=function(idx) idx+(-5:5)));
> cat(sprintf("%03d: %s\n", idxs, bfr[idxs]));
>
>> cat(sprintf("%03d: %s", idxs, bfr[idxs]), sep="\n")
> 2517: </code></pre>
> 2518:
> 2519: <pre><code>## [1] TRUE
> 2520: </code></pre>
> 2521:
> 2522: <pre><code class="r">BayesFactor::which.max(bf)
> 2523: </code></pre>
> 2524:
> 2525: <pre><code>## complaints
> 2526: ##          1
> 2527: </code></pre>
> 2531:
> 2532: <pre><code>## critical + advance
> 2533: ##                 21
> 2534: </code></pre>
> 2535:
> 2536: <pre><code class="r">which.max(bf)
> 2537: </code></pre>
> 2538:
> 2539: <pre><code>## Error: no method for coercing this S4 class to a vector
> 2540: </code></pre>
> 2541:
>
> So, have a look at browseVignette() and how it calls the 'knitr' weave
> function.  That should help you narrow down what's going on.
>
>> sessionInfo()
> R version 3.0.0 RC (2013-03-31 r62463)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] tools     stats     graphics  grDevices utils     datasets  methods
> [8] base
>
> other attached packages:
> [1] BayesFactor_0.9.3 markdown_0.5.4    coda_0.16-1       lattice_0.20-15
> [5] knitr_1.1.7
>
> loaded via a namespace (and not attached):
> [1] digest_0.6.3     evaluate_0.4.3   formatR_0.7      grid_3.0.0
> [5] mvtnorm_0.9-9994 pbapply_1.0-5    stringr_0.6.2
>
> Hope this helps
>
> /Henrik
>
> On Mon, Apr 1, 2013 at 4:52 PM, Richard D. Morey <r.d.morey at rug.nl> wrote:
>> A new problem has cropped up with compiling vignettes for my package BayesFactor. I'm not sure when it started, but I can tell you it didn't occur on R 2.15.3, and it does on 3.0.0 RC (2013-03-31 r62463) (session info is at the bottom of this message).
>>
>> I have defined methods for which.min and which.max for a class (I've defined both S3 and S4 methods for the class "BFBayesFactor") in my package. I've exported the S4 class using exportMethods, and declared the S3 method with S3method. You can see the NAMESPACE file here:
>>
>> https://r-forge.r-project.org/scm/viewvc.php/pkg/BayesFactorPCL/NAMESPACE?view=markup&root=bayesfactorpcl
>>
>> and the methods here:
>>
>> https://r-forge.r-project.org/scm/viewvc.php/pkg/BayesFactorPCL/R/methods-BFBayesFactor.R?view=markup&root=bayesfactorpcl
>>
>> I have code in a vignette that calls the which.max method on a BFBayesFactor object. However, when that happens as the vignette is being compiled, I get an error:
>>
>> which.max(bf)
>> ## Error: no method for coercing this S4 class to a vector
>>
>>
>>
>> This also occurs with which.min, but oddly not any other method (including the is.na method, which is declared exactly the same way, as far as I can tell). This seems to imply that the which.min and which.max methods are not exported.
>>
>> When I use double colon notation - which as I understand, only works with exported functions - it works (see below).
>>
>> When I compile the Rmd file manually, I do not see this problem; I get no errors. This seems to be a problem unique to compiling the vignette. I've tried it in Rstudio, R from the command line, and using Rscript and calling knitr directly. It only occurs when building a vignette for the source package.
>>
>> Steps to reproduce:
>> 1. Check out latest version of BayesFactor package from R-forge (https://r-forge.r-project.org/scm/?group_id=554) (revision 320)
>>
>> 2. Create a source package (which compiles the vignette)
>>
>> 3. Open tar to see compiled vignette HTML (doc/manual.html - or, alternatively, see https://www.dropbox.com/s/6csznytp8i1akjl/manual.html). Search for second occurrence of "which.max", and see the following lines:
>>
>> ## which model index is the best?
>> is(bf, "BFBayesFactor")
>> ## [1] TRUE
>> BayesFactor::which.max(bf)
>> ## complaints
>> ## 1
>> BayesFactor::which.min(bf)
>> ## critical + advance
>> ## 21
>> which.max(bf)
>> ## Error: no method for coercing this S4 class to a vector
>> which.min(bf)
>> ## Error: no method for coercing this S4 class to a vector
>>
>>
>>
>> I've been pulling my hair out on this, especially because something seems to have changed over the past few weeks that caused this, but I didn't catch exactly when, and I don't know if the issue lies with R 3.0.0 or my package.
>>
>>> sessionInfo()
>> R version 3.0.0 RC (2013-03-31 r62463)
>> Platform: x86_64-apple-darwin10.8.0 (64-bit)
>> locale:
>> [1] en_AU.UTF-8/en_AU.UTF-8/en_AU.UTF-8/C/en_AU.UTF-8/en_AU.UTF-8
>> attached base packages:
>> [1] stats graphics grDevices utils datasets methods base
>> other attached packages:
>> [1] BayesFactor_0.9.5 markdown_0.5.4 knitr_1.1.6 coda_0.16-1 lattice_0.20-15
>> loaded via a namespace (and not attached):
>> [1] digest_0.6.3 evaluate_0.4.3 formatR_0.7 grid_3.0.0 mvtnorm_0.9-9994
>> [6] pbapply_1.0-5 stringr_0.6.2 tools_3.0.0
>>
>>
>>
>>
>> Any help would be greatly appreciated,
>> Richard


From r.d.morey at rug.nl  Tue Apr  2 15:12:27 2013
From: r.d.morey at rug.nl (Richard D. Morey)
Date: Tue, 2 Apr 2013 15:12:27 +0200
Subject: [Rd] missing exported methods when compiling vignettes in R
 3.0.0 RC
In-Reply-To: <CANROs4e_bJSTHq-t1Pyb8wxBwV_0w1XY05wQsXZhWTyh-map9Q@mail.gmail.com>
References: <mailman.11.1364810408.30516.r-devel@r-project.org>
	<1B1B843261D34A409EEE3DCAE737981E@rug.nl>
	<CAFDcVCQHM+1uj1NBr1kDHbJnArRqXOqxCrbkZ3g+GPZAc0KG2g@mail.gmail.com>
	<CANROs4e_bJSTHq-t1Pyb8wxBwV_0w1XY05wQsXZhWTyh-map9Q@mail.gmail.com>
Message-ID: <F28A0D42B4A7492FAFCC24F964A3A8B7@rug.nl>

OK, so I think until we figure this out and/or the fix is on CRAN I can work around it using eval=FALSE with some hidden code blocks to hide the double colon notation. I've installed the latest revision of knitr, and it does fix the problem.





On Tuesday, 2 April 2013 at 4:40 AM, Yihui Xie wrote:

> I do not know much about S4, but I figured out one possible solution
> on knitr's side, which I do not really understand. In short, your S4
> methods need to be evaluated in globalenv(), but knitr uses the
> parent.frame() by default, which is not the global environment when it
> is called as the vignette builder.
> 
> Now I have forced the evaluation to be in the global environment, and
> pushed the changes to the knitr development version on Github:
> https://github.com/yihui/knitr
> 
> Regards,
> Yihui
> --
> Yihui Xie <xieyihui at gmail.com (mailto:xieyihui at gmail.com)>
> Phone: 515-294-2465 Web: http://yihui.name
> Department of Statistics, Iowa State University
> 2215 Snedecor Hall, Ames, IA
> 
> 
> On Mon, Apr 1, 2013 at 7:37 PM, Henrik Bengtsson <hb at biostat.ucsf.edu (mailto:hb at biostat.ucsf.edu)> wrote:
> > Hi,
> > 
> > things have indeed changed on how non-Sweave vignettes are built (this
> > happened around R devel 2013-03-05 r62130). However, it's not clear
> > to me what changes would be behind your problems, if any.
> > 
> > Build your vignette with the following buildVignette(), which emulates
> > what R does when it builds vignettes (cf. tools::buildVignettes()).
> > As you'll see, it reproduces your error:
> > 
> > if (!exists("buildVignette", mode="function")) {
> > source("http://r-forge.r-project.org/scm/viewvc.php/*checkout*/pkg/R.rsp/R/buildVignette.R?root=r-dots");
> > }
> > 
> > EXAMPLE (in a fresh R session):
> > 
> > url <- "http://r-forge.r-project.org/scm/viewvc.php/*checkout*/pkg/BayesFactorPCL/vignettes/manual.Rmd?root=bayesfactorpcl"
> > if (!file.exists("manual.Rmd")) download.file(url, "manual.Rmd");
> > 
> > output <- buildVignette("manual.Rmd", buildPkg="knitr");
> > browseURL(output);
> > 
> > bfr <- readLines(output);
> > idxs <- grep("which.max(bf)", bfr, fixed=TRUE);
> > idxs <- sort(sapply(idxs, FUN=function(idx) idx+(-5:5)));
> > cat(sprintf("%03d: %s\n", idxs, bfr[idxs]));
> > 
> > > cat(sprintf("%03d: %s", idxs, bfr[idxs]), sep="\n")
> > 2517: </code></pre>
> > 2518:
> > 2519: <pre><code>## [1] TRUE
> > 2520: </code></pre>
> > 2521:
> > 2522: <pre><code class="r">BayesFactor::which.max(bf)
> > 2523: </code></pre>
> > 2524:
> > 2525: <pre><code>## complaints
> > 2526: ## 1
> > 2527: </code></pre>
> > 2531:
> > 2532: <pre><code>## critical + advance
> > 2533: ## 21
> > 2534: </code></pre>
> > 2535:
> > 2536: <pre><code class="r">which.max(bf)
> > 2537: </code></pre>
> > 2538:
> > 2539: <pre><code>## Error: no method for coercing this S4 class to a vector
> > 2540: </code></pre>
> > 2541:
> > 
> > So, have a look at browseVignette() and how it calls the 'knitr' weave
> > function. That should help you narrow down what's going on.
> > 
> > > sessionInfo()
> > R version 3.0.0 RC (2013-03-31 r62463)
> > Platform: x86_64-w64-mingw32/x64 (64-bit)
> > 
> > locale:
> > [1] LC_COLLATE=English_United States.1252
> > [2] LC_CTYPE=English_United States.1252
> > [3] LC_MONETARY=English_United States.1252
> > [4] LC_NUMERIC=C
> > [5] LC_TIME=English_United States.1252
> > 
> > attached base packages:
> > [1] tools stats graphics grDevices utils datasets methods
> > [8] base
> > 
> > other attached packages:
> > [1] BayesFactor_0.9.3 markdown_0.5.4 coda_0.16-1 lattice_0.20-15
> > [5] knitr_1.1.7
> > 
> > loaded via a namespace (and not attached):
> > [1] digest_0.6.3 evaluate_0.4.3 formatR_0.7 grid_3.0.0
> > [5] mvtnorm_0.9-9994 pbapply_1.0-5 stringr_0.6.2
> > 
> > Hope this helps
> > 
> > /Henrik
> > 
> > On Mon, Apr 1, 2013 at 4:52 PM, Richard D. Morey <r.d.morey at rug.nl (mailto:r.d.morey at rug.nl)> wrote:
> > > A new problem has cropped up with compiling vignettes for my package BayesFactor. I'm not sure when it started, but I can tell you it didn't occur on R 2.15.3, and it does on 3.0.0 RC (2013-03-31 r62463) (session info is at the bottom of this message).
> > > 
> > > I have defined methods for which.min and which.max for a class (I've defined both S3 and S4 methods for the class "BFBayesFactor") in my package. I've exported the S4 class using exportMethods, and declared the S3 method with S3method. You can see the NAMESPACE file here:
> > > 
> > > https://r-forge.r-project.org/scm/viewvc.php/pkg/BayesFactorPCL/NAMESPACE?view=markup&root=bayesfactorpcl
> > > 
> > > and the methods here:
> > > 
> > > https://r-forge.r-project.org/scm/viewvc.php/pkg/BayesFactorPCL/R/methods-BFBayesFactor.R?view=markup&root=bayesfactorpcl
> > > 
> > > I have code in a vignette that calls the which.max method on a BFBayesFactor object. However, when that happens as the vignette is being compiled, I get an error:
> > > 
> > > which.max(bf)
> > > ## Error: no method for coercing this S4 class to a vector
> > > 
> > > 
> > > 
> > > This also occurs with which.min, but oddly not any other method (including the is.na method, which is declared exactly the same way, as far as I can tell). This seems to imply that the which.min and which.max methods are not exported.
> > > 
> > > When I use double colon notation - which as I understand, only works with exported functions - it works (see below).
> > > 
> > > When I compile the Rmd file manually, I do not see this problem; I get no errors. This seems to be a problem unique to compiling the vignette. I've tried it in Rstudio, R from the command line, and using Rscript and calling knitr directly. It only occurs when building a vignette for the source package.
> > > 
> > > Steps to reproduce:
> > > 1. Check out latest version of BayesFactor package from R-forge (https://r-forge.r-project.org/scm/?group_id=554) (revision 320)
> > > 
> > > 2. Create a source package (which compiles the vignette)
> > > 
> > > 3. Open tar to see compiled vignette HTML (doc/manual.html - or, alternatively, see https://www.dropbox.com/s/6csznytp8i1akjl/manual.html). Search for second occurrence of "which.max", and see the following lines:
> > > 
> > > ## which model index is the best?
> > > is(bf, "BFBayesFactor")
> > > ## [1] TRUE
> > > BayesFactor::which.max(bf)
> > > ## complaints
> > > ## 1
> > > BayesFactor::which.min(bf)
> > > ## critical + advance
> > > ## 21
> > > which.max(bf)
> > > ## Error: no method for coercing this S4 class to a vector
> > > which.min(bf)
> > > ## Error: no method for coercing this S4 class to a vector
> > > 
> > > 
> > > 
> > > I've been pulling my hair out on this, especially because something seems to have changed over the past few weeks that caused this, but I didn't catch exactly when, and I don't know if the issue lies with R 3.0.0 or my package.
> > > 
> > > > sessionInfo()
> > > R version 3.0.0 RC (2013-03-31 r62463)
> > > Platform: x86_64-apple-darwin10.8.0 (64-bit)
> > > locale:
> > > [1] en_AU.UTF-8/en_AU.UTF-8/en_AU.UTF-8/C/en_AU.UTF-8/en_AU.UTF-8
> > > attached base packages:
> > > [1] stats graphics grDevices utils datasets methods base
> > > other attached packages:
> > > [1] BayesFactor_0.9.5 markdown_0.5.4 knitr_1.1.6 coda_0.16-1 lattice_0.20-15
> > > loaded via a namespace (and not attached):
> > > [1] digest_0.6.3 evaluate_0.4.3 formatR_0.7 grid_3.0.0 mvtnorm_0.9-9994
> > > [6] pbapply_1.0-5 stringr_0.6.2 tools_3.0.0
> > > 
> > > 
> > > 
> > > 
> > > Any help would be greatly appreciated,
> > > Richard
> > 
>


From htl10 at users.sourceforge.net  Tue Apr  2 16:01:42 2013
From: htl10 at users.sourceforge.net (Hin-Tak Leung)
Date: Tue, 2 Apr 2013 15:01:42 +0100 (BST)
Subject: [Rd] new window cairo bundle Re: R/Sweave/cairo/freetype bug fix.
In-Reply-To: <1364807925.91232.YahooMailClassic@web172306.mail.ir2.yahoo.com>
Message-ID: <1364911302.48242.YahooMailClassic@web172304.mail.ir2.yahoo.com>

--- On Mon, 1/4/13, Hin-Tak Leung <htl10 at users.sourceforge.net> wrote:
> --- On Sat, 30/3/13, Hin-Tak Leung
> <htl10 at users.sourceforge.net>
> wrote:
> 
> > "... was committed to freetype in January and will form
> the
> > next release (2.4.12)". 
> 
> It is perhaps worth repeating the quote:? 'The official
> R binaries for windows ... are compiled against static
> libraries of cairo 1.10.2 ... are firmly in the "do not work
> correctly" category'
> 
> The minimum version of cairo to work being 1.11.2. On closer
> examination, the official bundle (http://www.rforge.net/Cairo/files/cairo-current-win.tar.gz)
> is built with neither fontconfig nor freetype. So even if it
> is bumped to current version (1.12.x), it does not work
> correctly.

Here is a drop-in replacement for the above:
http://sourceforge.net/projects/outmodedbonsai/files/R/cairo-1.12.14%2Bft%2Bfc-win.tar.gz

Besides being over 2 years more up-to-date, cairo (1.12.14) is also built with fontconfig and freetype enabled, and freetype being 2.4.11 + back-ported patch (https://bugzilla.redhat.com/show_bug.cgi?id=891457#c35) so at least there is a a better chance of R working correctly.

The full list of the tar ball is (a superset of the above, due to addition of fontconfig and freetype and their dependencies):
-------
cairo-1.12.14
pixman-0.26.2
libpng-1.5.13
zlib-1.2.7
fontconfig-2.10.1
freetype-2.4.11 (patched)
glib2-2.34.3
expat-2.1.0
bzip2-1.0.6
libffi-3.0.11
gettext-0.18.2
---------
This allows the C-based cairo bug demo (#c10) to build so I am sure it is sufficient for building windows R. At some stage I'll rebuild a less-buggy R 2.15.3 for windows, but not for a few weeks so if somebody wants to beat me to it, please feel free to do so.

> Perhaps also wasn't clear in the bugzilla thread - everybody
> from fontconfig/cairo/freetype involved knew it being the
> issue so it has never been explicitly spelled out - the
> problem was (is) with cairo's pdf/ps generation, aided by
> freetype.
> 
> > ------------------------------
> > On Sat, Mar 30, 2013 18:54 GMT Simon Urbanek wrote:
> > 
> > >On Mar 30, 2013, at 9:24 AM, Hin-Tak Leung wrote:
> > >
> > >> Perhaps that's too much details. There is
> (will be)
> > a new freetype because of cairo's unanticipated usage
> (which
> > R uses, among other cairo users). Most people should
> upgrade
> > or request an upgrade eventually, when they are
> > comfortable.
> > >> 
> > >
> > >Which versions are affected? R binary for OS X
> uses
> > freetype 2.4.11 (and cairo 1.12.14) so I just need to
> know
> > if there is an action item.
> > >
> > >Thanks,
> > >SImon
> > >
> > >
> > >
> > >> --- On Sat, 30/3/13, peter dalgaard <pdalgd at gmail.com>
> > wrote:
> > >> 
> > >> Huh?
> > >> 
> > >> This is utterly incomprehensible without
> reading
> > the redhat
> > >> bugzilla, and even after reading, I'm not sure
> what
> > the
> > >> issue is. Something with bold Chinese fonts in
> X11,
> > but
> > >> maybe also affecting Latin fonts, ....?
> > >> 
> > >> Please explain yourself.
> > >> 
> > >> -pd
> > >> 
> > >> On Mar 30, 2013, at 09:25 , Hin-Tak Leung
> wrote:
> > >> 
> > >>> The problem was first seen with R/Sweave
> (#c0)
> > then
> > >> reproduced directly with cairo (#c10) and was
> > eventually
> > >> traced to freetype. The 5-part bug fix:
> > >>> 610ee58e07090ead529849b2a454bb6c503b4995
> > >>> da11e5e7647b668dee46fd0418ea5ecbc33ae3b2
> > >>> e1a2ac1900f2f16ec48fb4840a6b7965a8373c2b
> > >>> 869fb8c49ddf292d6daf4826172a308973d3e11f
> > >>> d56e544d653b09c657911629557ffc5277a503e3
> > >>> was committed to freetype in January and
> will
> > form the
> > >> next release (2.4.12). They were back ported
> to
> > 2.4.11
> > >>> https://bugzilla.redhat.com/show_bug.cgi?id=891457#c35
> > >>> and the redhat people had further
> back-ported
> > it to
> > >> 2.4.10 for fedora 18/19 (#c51).
> > >>> 
> > >>> The freetype people had reproduced the
> problem
> > with a
> > >> latin font, so this affects most people,
> unlike
> > what the
> > >> initial report (#c0) suggests.
> > >>> 
> > >>> Since freetype is part of X11, most
> unix/linux
> > users
> > >> would be understandably nervous about breaking
> X
> > (see #c45
> > >> for screenshot of broken gnome terminal!) and
> > should wait up
> > >> to a year before the new and not-yet-released
> > 2.4.12 becomes
> > >> an official upgrade; or contact their
> favourite
> > unix vendors
> > >> and/or Apple for upgrades. AFAIK, current
> > up-to-date linux
> > >> distributions ships the rather older 2.4.10,
> with
> > the
> > >> exception of fedora 18/19 (#c51). Mac OS X
> 10.5
> > ships
> > >> freetype 2.3.5 as part of X11; I haven't
> bother
> > looking up
> > >> later Mac OS X's.
> > >>> 
> > >>> The official R binaries for windows and
> mac OS
> > X are
> > >> compiled against static libraries of cairo
> 1.10.2
> > (over 2
> > >> years old), and cairo 1.11.2 and freetype
> 2.4.4
> > >> respectively, and are firmly in the "do not
> work
> > correctly"
> > >> category.
> > >>> 
> > >>> The long and short of the story is that
> > R/Sweave uses a
> > >> feature of cairo which wasn't implemented
> before
> > cairo
> > >> 1.11.2 (#c13, Jan 2011), which in turn depends
> on a
> > feature
> > >> of freetype that has been around since 2005
> but did
> > not
> > >> anticipate cairo's usage. It is commendable
> that
> > the
> > >> freetype people did not refer to cairo's usage
> as
> > "misuse"
> > >> but took the patience to address the problem,
> > unlike some
> > >> group's style.
> > >>> 
> > >>> It has been an interesting few months
> returning
> > to
> > >> freetype after about 17 years, I think.
> > >>> 
> > >>> Here is how to look up what version of
> freetype
> > -
> > >> libfreetype.so.x.y.z for most unix platforms,
> and
> > >> /usr/X11/lib/libfreetype.x.y.z.dylib on Mac OS
> X:
> > >>> 
> > >>> (excerpt from docs/VERSION.DLL)
> > >>> 
> > >>>? ? ? version???
> > >> x.y.z???date of release
> > >>>? ? ? 2.4.11 
> > >>? ? 6.10.0? Dec 2012
> > >>>? ? ? 2.4.10 
> > >>? ? 6.9.0???June 2012
> > >>>? ? ? 2.4.9?
> > ???
> > >> 6.8.1???March 2012
> > >>> ...
> > >>>? ? ? 2.4.4?
> > ???
> > >> 6.6.2???Nov 2010? (official R
> > mac
> > >> binaries)
> > >>> ...
> > >>>? ? ? 2.3.5?
> > ???
> > >> 6.3.16? July 2007 (Mac OS X 10.5)
> > >>> 
> > >>> 
> > >>>
> ______________________________________________
> > >>> R-devel at r-project.org
> > >> mailing list
> > >>> https://stat.ethz.ch/mailman/listinfo/r-devel
> > >> 
> > >> -- 
> > >> Peter Dalgaard, Professor,
> > >> Center for Statistics, Copenhagen Business
> School
> > >> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
> > >> Phone: (+45)38153501
> > >> Email: pd.mes at cbs.dk 
> > >> Priv: PDalgd at gmail.com
> > >> 
> > >> 
> > >> 
> > >> 
> > >> 
> > >> 
> > >> 
> > >> 
> > >> 
> > >> 
> > >>
> ______________________________________________
> > >> R-devel at r-project.org
> > mailing list
> > >> https://stat.ethz.ch/mailman/listinfo/r-devel
> > >> 
> > >> 
> > >
> > 
> >
>


From michael.weylandt at gmail.com  Tue Apr  2 16:21:37 2013
From: michael.weylandt at gmail.com (Michael Weylandt)
Date: Tue, 2 Apr 2013 09:21:37 -0500
Subject: [Rd] [R] Rpy2 and Mac OS X 10.8.3
In-Reply-To: <CADKu8RGGOTj7C3J1ss0QGwBGzGg+hDPeq4zuOk=JK3r4_Ozn5g@mail.gmail.com>
References: <CADKu8RGGOTj7C3J1ss0QGwBGzGg+hDPeq4zuOk=JK3r4_Ozn5g@mail.gmail.com>
Message-ID: <2BE69B71-0354-4EBE-8B1E-95574A954B5F@gmail.com>

Moving to the more on topic R-devel list. 

On Apr 2, 2013, at 2:14, Craig Watson <craig.o.watson at gmail.com> wrote:

> I am having a strange problem. I have been using python + rpy2 on my Mac
> for quite sometime now. I recently upgraded to OS X 10.8 from 10.6 and
> that's when the problem began.
> 
> Now, when I try to load some R packages (like zoo) using robjects.r, python
> crashes with seg fault 11. Here's an example below:
> 
>>> import rpy2.robjects as ro
>>> ro.r(''' library(zoo) ''')
> 
> This results in the following crash report (see below). Can anyone help me
> debug this and figure out what the problem is?

Almost certainly in rpy2 because library('zoo') is just fine on the R side. Don't have rpy2 around to play further. Have you tried contacting the maintainer directly?

Michael


> 
> Thanks!
> 
> _________________________________________________________________________________________________________________________
> 
> Process:         Python [365]
> Path:
> /opt/local/Library/Frameworks/Python.framework/Versions/2.7/Resources/Python.app/Contents/MacOS/Python
> Identifier:         Python
> Version:            2.7.3 (2.7.3)
> Code Type:        X86-64 (Native)
> Parent Process:  bash [325]
> User ID:             501
> 
> Date/Time:       2013-04-02 02:55:03.684 -0400
> OS Version:      Mac OS X 10.8.3 (12D78)
> Report Version:  10
> 
> Crashed Thread:  0  Dispatch queue: com.apple.main-thread
> 
> Exception Type:  EXC_BAD_ACCESS (SIGSEGV)
> Exception Codes: KERN_INVALID_ADDRESS at 0x0000000000000018
> 
> VM Regions Near 0x18:
> -->
>    __TEXT                 0000000100000000-0000000100001000 [    4K]
> r-x/rwx SM=COW
> /opt/local/Library/Frameworks/Python.framework/Versions/2.7/Resources/Python.app/Contents/MacOS/Python
> 
> Thread 0 Crashed:: Dispatch queue: com.apple.main-thread
> 0   libR.dylib                     0x0000000104aeb1c7 GetNewPage + 183
> (memory.c:806)
> 1   libR.dylib                     0x0000000104aec44b Rf_allocVector + 2235
> (memory.c:2221)
> 2   libR.dylib                     0x0000000104a0816e
> get_package_CEntry_table + 174 (Rinlinedfuns.h:513)
> 3   libR.dylib                     0x0000000104a0825f R_RegisterCCallable +
> 31 (Rdynload.c:1391)
> 4   zoo.so                         0x00000001035e5466 R_init_zoo + 70
> (init.c:46)
> 5   libR.dylib                     0x0000000101007089 AddDLL + 201
> 6   libR.dylib                     0x000000010100737a do_dynload + 170
> 7   libR.dylib                     0x00000001010a6aab bcEval + 10043
> 8   ???                            0x00007fff5fbf4bb0 0 + 140734799760304
> 
> Thread 0 crashed with X86 Thread State (64-bit):
>  rax: 0x0000000000000000  rbx: 0xffffffff1fffffff  rcx: 0x0000000104039608
> rdx: 0x0000000104039608
>  rdi: 0x0000000020000000  rsi: 0x0000000000000000  rbp: 0x00007fff5fbf4240
> rsp: 0x00007fff5fbf4210
>   r8: 0x0000000000000160   r9: 0x0000000000000000  r10: 0x0000000104cf3970
> r11: 0x0000000000000000
>  r12: 0x0000000104cf3830  r13: 0x0000000000000028  r14: 0x0000000000000030
> r15: 0x0000000000000001
>  rip: 0x0000000104aeb1c7  rfl: 0x0000000000010202  cr2: 0x0000000000000018
> Logical CPU: 1
> 
> Binary Images:
>       0x100000000 -        0x100000fff +org.python.python (2.7.3 - 2.7.3)
> <6729542A-9233-A64E-2797-4BAF23C0C942>
> /opt/local/Library/Frameworks/Python.framework/Versions/2.7/Resources/Python.app/Contents/MacOS/Python
>       0x100003000 -        0x10016bfe7 +org.python.python (2.7.3, [c]
> 2004-2012 Python Software Foundation. - 2.7.3)
> <35145595-A1C0-45F9-D397-C603EE0E0B54>
> /opt/local/Library/Frameworks/Python.framework/Versions/2.7/Python
>       0x1002ee000 -        0x1002f3fff +array.so (???)
> <5016C2F6-BC06-2B3A-C0C3-CCA546066A73>
> /opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/lib-dynload/array.so
>       0x1002fb000 -        0x1002fcfff +_hashlib.so (???)
> <D8332168-1C08-96B7-4ADD-FF44E32E6320>
> /opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/lib-dynload/_hashlib.so
>       0x1004b0000 -        0x1004e4ff7 +readline.so (???)
> <10B242AB-3587-74AC-3ED9-ADE7AE715FDE>
> /opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/readline/readline.so
>       0x1004ff000 -        0x100545ff7 +libncurses.5.dylib (5)
> <0BA1D173-3328-C80F-0080-770D3A589FF5> /opt/local/lib/libncurses.5.dylib
>       0x100582000 -        0x100589ff7 +itertools.so (???)
> <A2FF86BD-392B-1694-7585-FC3021FD4915>
> /opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/lib-dynload/itertools.so
>       0x100594000 -        0x1005a3ff7 +_rinterface.so (???)
> <9AD185A0-A567-1D9E-5946-94D22301A7E1>
> /opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/rpy2/rinterface/_rinterface.so
>       0x1005b5000 -        0x1005e1fff +libRblas.dylib (0)
> <79B7884F-707F-3D59-AF76-3C47FF7F7309> /opt/local/lib/*/libRblas.dylib
>       0x1005e4000 -        0x1005efff7 +libgomp.1.dylib (2)
> <5F6F59F5-49D2-32E5-8E1B-845E24643116> /opt/local/lib/*/libgomp.1.dylib
>       0x1005fb000 -        0x1005fcfff +_random.so (???)
> <AAC611D8-D82E-4227-27C0-ACD9589D548C>
> /opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/lib-dynload/_random.so
>       0x100700000 -        0x100729fff +libreadline.6.2.dylib (6.2)
> <E37FDE3E-AE96-525A-DD7C-5444A08C2F30> /opt/local/lib/libreadline.6.2.dylib
>       0x10073f000 -        0x10075ffef +liblzma.5.dylib (6.4)
> <2436EADC-ADA7-800F-87BE-480E010827C4> /opt/local/lib/liblzma.5.dylib
>       0x100765000 -        0x100778fef +libgcc_s.1.dylib (1)
> <9521B0A3-DFB2-30E5-81D1-B6FE12351BF2> /opt/local/lib/*/libgcc_s.1.dylib
>       0x1007c7000 -        0x1007ccfef +math.so (???)
> <E6B861CF-FF7B-01E7-C873-5CCC030C1CE3>
> /opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/lib-dynload/math.so
>       0x1007d3000 -        0x1007d6fef +binascii.so (???)
> <7C14C92D-B218-F27F-4F3A-9809AFAB395A>
> /opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/lib-dynload/binascii.so
>       0x1007da000 -        0x1007ecff7 +libz.1.dylib (1.2.7)
> <CB0AF5A1-4847-4398-FBE4-78483C8F8866> /opt/local/lib/libz.1.dylib
>       0x1007f0000 -        0x1007f1fff +cStringIO.so (???)
> <AE22963C-AD85-3017-3AAA-191802F249C6>
> /opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/lib-dynload/cStringIO.so
>       0x1007f6000 -        0x1007f7ff7 +fcntl.so (???)
> <328E9F46-8B49-5C09-60B7-E3CD93379EE4>
> /opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/lib-dynload/fcntl.so
>       0x1007fa000 -        0x1007fdfff +lattice.so (0)
> <5C6431FB-5B8A-A18A-8018-45A4F96C892D>
> /Library/Frameworks/R.framework/Versions/2.15/Resources/library/lattice/libs/x86_64/lattice.so
>       0x101000000 -        0x1012e1ff7 +libR.dylib (2.15.3)
> <20498FF7-3019-355C-BF42-6C27DFC8CBB4> /opt/local/lib/*/libR.dylib
>       0x1013c3000 -        0x10155bfef +libRlapack.dylib (2.15.3)
> <B02DC98C-CAC5-3CD1-BF9E-0E47A1ED8831> /opt/local/lib/*/libRlapack.dylib
>       0x101564000 -        0x101644fef +libgfortran.3.dylib (4)
> <A7BD0581-0B86-399F-A645-6DB5A87F416C> /opt/local/lib/*/libgfortran.3.dylib
>       0x10169d000 -        0x10179bfef +libiconv.2.dylib (8.1)
> <065A36D7-5F15-7B4C-C3F4-D9B23DFC36A3> /opt/local/lib/libiconv.2.dylib
>       0x1017a9000 -        0x1018cfff7 +libicuuc.49.dylib (49.1.2)
> <0F420069-D07F-0465-C2F3-A5BA51E4FE35> /opt/local/lib/libicuuc.49.dylib
>       0x101932000 -        0x101ac7ff7 +libicui18n.49.dylib (49.1.2)
> <BAC093EA-12B8-5A95-7C4D-95217F78680F> /opt/local/lib/libicui18n.49.dylib
>       0x101b7c000 -        0x102c9bff7 +libicudata.49.dylib (49.1.2)
> <2AE5D81A-8E82-9BDF-3514-B94940A00CB3> /opt/local/lib/libicudata.49.dylib
>       0x102c9d000 -        0x102cf1ff7 +libssl.1.0.0.dylib (1)
> <5955F68C-357C-A2E8-59F3-D20D85403AB3> /opt/local/lib/libssl.1.0.0.dylib
>       0x102d0c000 -        0x102e71ff7 +libcrypto.1.0.0.dylib (1)
> <99B0CA7E-26BF-0EEA-FF9A-9516FA2EF3B6> /opt/local/lib/libcrypto.1.0.0.dylib
>       0x1031d7000 -        0x1031ddfff +methods.so (0)
> <A79F5BAA-658A-3474-B4ED-6D32BB6DE9DE> /opt/local/lib/*/methods.so
>       0x10356e000 -        0x103598fef +grDevices.so (0)
> <843E2588-8755-320E-88E7-B18BFD55F5DB> /opt/local/lib/*/grDevices.so
>       0x1035dc000 -        0x1035defff +time.so (???)
> <CA2CD6C7-8CDD-87EB-9327-C05753093B32>
> /opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/lib-dynload/time.so
>       0x1035e3000 -        0x1035e6ff7 +zoo.so (0)
> <5D2C0F1A-C14A-F98D-D67C-1501DD27AEAB>
> /Library/Frameworks/R.framework/Versions/2.15/Resources/library/zoo/libs/x86_64/zoo.so
>       0x103700000 -        0x103765ff7 +stats.so (0)
> <CAF8A6F0-8339-33F6-9054-9A77DD83A867> /opt/local/lib/*/stats.so
>       0x1037b0000 -        0x1037cbfe7 +grid.so (0)
> <D7803832-352A-3FE7-B6E6-4DA15ED767AE> /opt/local/lib/*/grid.so
>       0x1037d2000 -        0x1037fbff7 +libRblas.dylib (0)
> <A50EB94C-F8EF-CE81-A706-1578808F1BA1>
> /Library/Frameworks/R.framework/Versions/2.15/Resources/lib/libRblas.dylib
>       0x104a03000 -        0x104ccffff +libR.dylib (2.15.3)
> <A5F068D3-7995-316C-83DE-FBF8D6D75330>
> /Library/Frameworks/R.framework/Versions/2.15/Resources/lib/libR.dylib
>       0x104e10000 -        0x104ec6fcf +libgfortran.2.dylib (3)
> <ACF1816E-EA8A-4DB9-A893-A4EF0CEFFFBA>
> /Library/Frameworks/R.framework/Versions/2.15/Resources/lib/libgfortran.2.dylib
>       0x104f0b000 -        0x104f35fd9 +libreadline.5.2.dylib (5.2)
> /Library/Frameworks/R.framework/Versions/2.15/Resources/lib/libreadline.5.2.dylib
>    0x7fff6a11b000 -     0x7fff6a14f93f  dyld (210.2.3)
> <6900F2BA-DB48-3B78-B668-58FC0CF6BCB8> /usr/lib/dyld
>    0x7fff8bdce000 -     0x7fff8bdd0ff7  libunc.dylib (25)
> <92805328-CD36-34FF-9436-571AB0485072> /usr/lib/system/libunc.dylib
>    0x7fff8c05a000 -     0x7fff8c07cff7  libxpc.dylib (140.42)
> <BBE558BD-5E55-35E4-89ED-1AA6B056D05A> /usr/lib/system/libxpc.dylib
>    0x7fff8c07d000 -     0x7fff8c08bfff  libcommonCrypto.dylib (60027)
> <BAAFE0C9-BB86-3CA7-88C0-E3CBA98DA06F> /usr/lib/system/libcommonCrypto.dylib
>    0x7fff8c18b000 -     0x7fff8c1c3fff  libncurses.5.4.dylib (37.3)
> <68D5B5F5-8252-3F1E-AFF1-C6AFE145DBC1> /usr/lib/libncurses.5.4.dylib
>    0x7fff8c5d6000 -     0x7fff8c625ff7  libcorecrypto.dylib (106.2)
> <CE0C29A3-C420-339B-ADAA-52F4683233CC> /usr/lib/system/libcorecrypto.dylib
>    0x7fff8c689000 -     0x7fff8c6a4ff7  libsystem_kernel.dylib
> (2050.22.13) <5A961E2A-CFB8-362B-BC43-122704AEB047>
> /usr/lib/system/libsystem_kernel.dylib
>    0x7fff8c87d000 -     0x7fff8c883fff  libmacho.dylib (829)
> <BF332AD9-E89F-387E-92A4-6E1AB74BD4D9> /usr/lib/system/libmacho.dylib
>    0x7fff8c8b0000 -     0x7fff8c8deff7  libsystem_m.dylib (3022.6)
> <B434BE5C-25AB-3EBD-BAA7-5304B34E3441> /usr/lib/system/libsystem_m.dylib
>    0x7fff8cee9000 -     0x7fff8ceeefff  libcache.dylib (57)
> <65187C6E-3FBF-3EB8-A1AA-389445E2984D> /usr/lib/system/libcache.dylib
>    0x7fff8cfa9000 -     0x7fff8cfb1ff7  libsystem_dnssd.dylib (379.37)
> <616FC901-151E-38BF-B2C4-24A351C5FAAD> /usr/lib/system/libsystem_dnssd.dylib
>    0x7fff8d8a7000 -     0x7fff8d8a7fff  libkeymgr.dylib (25)
> <CC9E3394-BE16-397F-926B-E579B60EE429> /usr/lib/system/libkeymgr.dylib
>    0x7fff8db63000 -     0x7fff8db64fff  libsystem_blocks.dylib (59)
> <D92DCBC3-541C-37BD-AADE-ACC75A0C59C8>
> /usr/lib/system/libsystem_blocks.dylib
>    0x7fff8e33a000 -     0x7fff8e33dff7  libdyld.dylib (210.2.3)
> <F59367C9-C110-382B-A695-9035A6DD387E> /usr/lib/system/libdyld.dylib
>    0x7fff8e33e000 -     0x7fff8e374fff  libsystem_info.dylib (406.17)
> <4FFCA242-7F04-365F-87A6-D4EFB89503C1> /usr/lib/system/libsystem_info.dylib
>    0x7fff8f1dc000 -     0x7fff8f1f1ff7  libdispatch.dylib (228.23)
> <D26996BF-FC57-39EB-8829-F63585561E09> /usr/lib/system/libdispatch.dylib
>    0x7fff8f26b000 -     0x7fff8f26cff7  libremovefile.dylib (23.2)
> <6763BC8E-18B8-3AD9-8FFA-B43713A7264F> /usr/lib/system/libremovefile.dylib
>    0x7fff8f693000 -     0x7fff8f69bfff  liblaunch.dylib (442.26.2)
> <2F71CAF8-6524-329E-AC56-C506658B4C0C> /usr/lib/system/liblaunch.dylib
>    0x7fff8fdb0000 -     0x7fff8fdc2ff7  libz.1.dylib (43)
> <2A1551E8-A272-3DE5-B692-955974FE1416> /usr/lib/libz.1.dylib
>    0x7fff90d1a000 -     0x7fff90f04ff7  com.apple.CoreFoundation (6.8 -
> 744.18) <A60C3C9B-3764-3291-844C-C487ACF77C2C>
> /System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation
>    0x7fff913b8000 -     0x7fff913bffff  libcopyfile.dylib (89)
> <876573D0-E907-3566-A108-577EAD1B6182> /usr/lib/system/libcopyfile.dylib
>    0x7fff9284a000 -     0x7fff92850ff7  libunwind.dylib (35.1)
> <21703D36-2DAB-3D8B-8442-EAAB23C060D3> /usr/lib/system/libunwind.dylib
>    0x7fff934c2000 -     0x7fff934c3fff  libDiagnosticMessagesClient.dylib
> (8) <8548E0DC-0D2F-30B6-B045-FE8A038E76D8>
> /usr/lib/libDiagnosticMessagesClient.dylib
>    0x7fff937d9000 -     0x7fff937daff7  libsystem_sandbox.dylib (220.2)
> <6838A6FD-8626-3356-BB4F-BB4787216207>
> /usr/lib/system/libsystem_sandbox.dylib
>    0x7fff937db000 -     0x7fff938d0fff  libiconv.2.dylib (34)
> <FEE8B996-EB44-37FA-B96E-D379664DEFE1> /usr/lib/libiconv.2.dylib
>    0x7fff953b3000 -     0x7fff954cb92f  libobjc.A.dylib (532.2)
> <90D31928-F48D-3E37-874F-220A51FD9E37> /usr/lib/libobjc.A.dylib
>    0x7fff958a8000 -     0x7fff95910ff7  libc++.1.dylib (65.1)
> <20E31B90-19B9-3C2A-A9EB-474E08F9FE05> /usr/lib/libc++.1.dylib
>    0x7fff95d39000 -     0x7fff95d5eff7  libc++abi.dylib (26)
> <D86169F3-9F31-377A-9AF3-DB17142052E4> /usr/lib/libc++abi.dylib
>    0x7fff95dc2000 -     0x7fff95dcdfff  libsystem_notify.dylib (98.5)
> <C49275CC-835A-3207-AFBA-8C01374927B6>
> /usr/lib/system/libsystem_notify.dylib
>    0x7fff95dd1000 -     0x7fff95e3afff  libstdc++.6.dylib (56)
> <EAA2B53E-EADE-39CF-A0EF-FB9D4940672A> /usr/lib/libstdc++.6.dylib
>    0x7fff95f1e000 -     0x7fff95f20fff  libquarantine.dylib (52)
> <4BE2E642-A14F-340A-B482-5BD2AEFD9C24> /usr/lib/system/libquarantine.dylib
>    0x7fff95f21000 -     0x7fff95f6dff7  libauto.dylib (185.1)
> <73CDC482-16E3-3FC7-9BB4-FBA2DA44DBC2> /usr/lib/libauto.dylib
>    0x7fff96355000 -     0x7fff9635afff  libcompiler_rt.dylib (30)
> <08F8731D-5961-39F1-AD00-4590321D24A9> /usr/lib/system/libcompiler_rt.dylib
>    0x7fff963c4000 -     0x7fff965c4fff  libicucore.A.dylib (491.11.2)
> <FD6282D8-DF3F-3842-8C2E-CF478D2B9669> /usr/lib/libicucore.A.dylib
>    0x7fff973c2000 -     0x7fff9748eff7  libsystem_c.dylib (825.26)
> <4C9EB006-FE1F-3F8F-8074-DFD94CF2CE7B> /usr/lib/system/libsystem_c.dylib
>    0x7fff974b4000 -     0x7fff974b5ff7  libdnsinfo.dylib (453.19)
> <14202FFB-C3CA-3FCC-94B0-14611BF8692D> /usr/lib/system/libdnsinfo.dylib
>    0x7fff98479000 -     0x7fff9847aff7  libSystem.B.dylib (169.3)
> <FF25248A-574C-32DB-952F-B948C389B2A4> /usr/lib/libSystem.B.dylib
>    0x7fff985d4000 -     0x7fff985e2ff7  libsystem_network.dylib (77.10)
> <0D99F24E-56FE-380F-B81B-4A4C630EE587>
> /usr/lib/system/libsystem_network.dylib
> 
> External Modification Summary:
>  Calls made by other processes targeting this process:
>    task_for_pid: 0
>    thread_create: 0
>    thread_set_state: 0
>  Calls made by this process:
>    task_for_pid: 0
>    thread_create: 0
>    thread_set_state: 0
>  Calls made by all processes on this machine:
>    task_for_pid: 178
>    thread_create: 0
>    thread_set_state: 0
> 
> VM Region Summary:
> ReadOnly portion of Libraries: Total=101.2M resident=52.1M(51%)
> swapped_out_or_unallocated=49.1M(49%)
> Writable regions: Total=48.0M written=32.9M(69%) resident=34.6M(72%)
> swapped_out=0K(0%) unallocated=13.3M(28%)
> 
> REGION TYPE                      VIRTUAL
> ===========                      =======
> MALLOC                                  37.8M
> MALLOC guard page                    32K
> STACK GUARD                        56.0M
> Stack                                       8192K
> VM_ALLOCATE                           4K
> __DATA                                  3496K
> __LINKEDIT                               55.9M
> __TEXT                                  45.4M
> __UNICODE                             544K
> shared memory                         12K
> ===========                      =======
> TOTAL                             207.0M
> 
>    [[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From h.wickham at gmail.com  Wed Apr  3 16:38:44 2013
From: h.wickham at gmail.com (Hadley Wickham)
Date: Wed, 3 Apr 2013 09:38:44 -0500
Subject: [Rd] Documentation error in subsitute
Message-ID: <CABdHhvG6gJWcfn0q8CGBOh2uRSzXg6C0eO+60gWrCMcdQ81ZkQ@mail.gmail.com>

Hi all,

The documentation for substitute currently reads:

Substitution takes place by examining each component of the parse
tree as follows: If it is not a bound symbol in ?env?, it is
unchanged.  If it is a promise object, i.e., a formal argument to
a function or explicitly created using ?delayedAssign()?, the
expression slot of the promise replaces the symbol.  If it is an
ordinary variable, its value is substituted, unless ?env? is
?.GlobalEnv? in which case the symbol is left unchanged.

Since the clause referring to the globalenv() is attached to the
discussion of ordinary variables, I thought that it implied that

delayedAssign("a", "test")
substitute(a)

would return "test"  (but actually it returns quote(a))

I'd suggest rewording this paragraph to:

Substitution takes place by examining each component of the parse
tree as follows: If it is not a bound symbol in ?env?, it is
unchanged.  If it is a promise object, i.e., a formal argument to
a function or explicitly created using ?delayedAssign()?, the
expression slot of the promise replaces the symbol.  If it is an
ordinary variable, its value is substituted.  There's one important
exception to these rules: If 'env' is the ?.GlobalEnv?, then no
substitution occurs.

Hadley


--
Chief Scientist, RStudio
http://had.co.nz/


From pgilbert902 at gmail.com  Wed Apr  3 17:00:09 2013
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Wed, 03 Apr 2013 11:00:09 -0400
Subject: [Rd] R-3.0.0  reg-tests-3.R / survival
Message-ID: <515C43F9.60303@gmail.com>


"make check" is failing on reg-test3.R with a message that survival was 
built with an older version of R.  (On my Ubuntu 32 bit and Ubuntu 64 
bit machines). Why would "make check" be looking anywhere that it would 
find something built with an older version of R?

~/RoboAdmin/R-3.0.0/tests$ tail reg-tests-3.Rout.fail
 > print(1.001, digits=16)
[1] 1.001
 > ## 2.4.1 gave  1.001000000000000
 > ## 2.5.0 errs on the side of caution.
 >
 >
 > ## as.matrix.data.frame with coercion
 > library(survival)
Error: package 'survival' was built before R 3.0.0: please re-install it
Execution halted


From s.boehringer at lumc.nl  Wed Apr  3 13:25:19 2013
From: s.boehringer at lumc.nl (Stefan Boehringer)
Date: Wed, 3 Apr 2013 13:25:19 +0200
Subject: [Rd] R-package preparation --as-cran behaving unexpectedly
Message-ID: <515C119F.9040706@lumc.nl>

Dear all,

I am trying to submit an R-package to CRAN. In preparation I do run

R_INSTALL_TAR=/bin/tar R CMD check --as-cran parallelize.dynamic_0.9.tar.gz

and the command finishes without warnings or errors. As a final output I get

NOTE: There was 1 note.
See
?.../Rpackages/parallelize.dynamic/parallelize.dynamic.Rcheck/00check.log?
for details.

The file contains the standard output of the 'R CMD check ...' call 
precisely. If I submit this very tarball to CRAN I get rejected with 
warnings as reported from '--as-cran' checks there. In my case they are 
valid warnings about assignments in .GlobalEnv which I can certainly 
fix. However, my concern is about the discrepancy between the outputs of 
'R CMD check --as-cran' runs locally as compared to the run on the 
CRAN-site.

Any help is appreciated. I am running


R version 2.15.2 (2012-10-26) -- "Trick or Treat"
Platform: x86_64-unknown-linux-gnu (64-bit)

Thanks in advance,

Stefan

-- 
http://visigen.lumc.nl/emgm
http://s-boehringer.org


From murdoch.duncan at gmail.com  Wed Apr  3 17:31:25 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 03 Apr 2013 11:31:25 -0400
Subject: [Rd] R-package preparation --as-cran behaving unexpectedly
In-Reply-To: <515C119F.9040706@lumc.nl>
References: <515C119F.9040706@lumc.nl>
Message-ID: <515C4B4D.70708@gmail.com>

On 03/04/2013 7:25 AM, Stefan Boehringer wrote:
> Dear all,
>
> I am trying to submit an R-package to CRAN. In preparation I do run
>
> R_INSTALL_TAR=/bin/tar R CMD check --as-cran parallelize.dynamic_0.9.tar.gz
>
> and the command finishes without warnings or errors. As a final output I get
>
> NOTE: There was 1 note.
> See
> ?.../Rpackages/parallelize.dynamic/parallelize.dynamic.Rcheck/00check.log?
> for details.
>
> The file contains the standard output of the 'R CMD check ...' call
> precisely. If I submit this very tarball to CRAN I get rejected with
> warnings as reported from '--as-cran' checks there. In my case they are
> valid warnings about assignments in .GlobalEnv which I can certainly
> fix. However, my concern is about the discrepancy between the outputs of
> 'R CMD check --as-cran' runs locally as compared to the run on the
> CRAN-site.
>
> Any help is appreciated. I am running
>
>
> R version 2.15.2 (2012-10-26) -- "Trick or Treat"
> Platform: x86_64-unknown-linux-gnu (64-bit)

Presumably CRAN is now running checks from 3.0.0 (which was released 
today, and has been available for testing for more than a month).  I 
wouldn't be surprised if those are different from the 2.15.2 tests.

Duncan Murdoch


From pdalgd at gmail.com  Wed Apr  3 17:36:19 2013
From: pdalgd at gmail.com (peter dalgaard)
Date: Wed, 3 Apr 2013 17:36:19 +0200
Subject: [Rd] R-3.0.0  reg-tests-3.R / survival
In-Reply-To: <515C43F9.60303@gmail.com>
References: <515C43F9.60303@gmail.com>
Message-ID: <1CFE4B7A-7D3E-4507-924B-6D61956E568E@gmail.com>

Any chance that you might have a personal library, which isn't versioned? If you do and you for some reason installed survival into it, it would explain it.

E.g., I have, with the system-wide R

> .libPaths()
[1] "/Users/pd/Library/R/2.15/library"                                         
[2] "/opt/local/Library/Frameworks/R.framework/Versions/2.15/Resources/library"
> lapply(.libPaths(), list.files)
[[1]]
 [1] "abind"      "aplpack"    "car"        "colorspace" "e1071"     
 [6] "effects"    "ellipse"    "Hmisc"      "ISwR"       "leaps"     
[11] "lmtest"     "matrixcalc" "mclust"     "multcomp"   "mvtnorm"   
[16] "pcaPP"      "Rcmdr"      "relimp"     "represent"  "rgl"       
[21] "robustbase" "rrcov"      "sem"        "xtable"     "zoo"       

[[2]]
 [1] "base"       "boot"       "class"      "cluster"    "codetools" 
 [6] "compiler"   "datasets"   "foreign"    "graphics"   "grDevices" 
[11] "grid"       "KernSmooth" "lattice"    "MASS"       "Matrix"    
[16] "methods"    "mgcv"       "nlme"       "nnet"       "parallel"  
[21] "rpart"      "spatial"    "splines"    "stats"      "stats4"    
[26] "survival"   "tcltk"      "tools"      "utils"     

but the one in my development build tree of 3.0.0 has

> .libPaths()
[1] "/Users/pd/r-release-branch/BUILD-dist/library"

If I explicitly set R_LIBS, I can easily reproduce your error.


On Apr 3, 2013, at 17:00 , Paul Gilbert wrote:

> 
> "make check" is failing on reg-test3.R with a message that survival was built with an older version of R.  (On my Ubuntu 32 bit and Ubuntu 64 bit machines). Why would "make check" be looking anywhere that it would find something built with an older version of R?
> 
> ~/RoboAdmin/R-3.0.0/tests$ tail reg-tests-3.Rout.fail
> > print(1.001, digits=16)
> [1] 1.001
> > ## 2.4.1 gave  1.001000000000000
> > ## 2.5.0 errs on the side of caution.
> >
> >
> > ## as.matrix.data.frame with coercion
> > library(survival)
> Error: package 'survival' was built before R 3.0.0: please re-install it
> Execution halted
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From pgilbert902 at gmail.com  Wed Apr  3 17:36:23 2013
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Wed, 03 Apr 2013 11:36:23 -0400
Subject: [Rd] R-package preparation --as-cran behaving unexpectedly
In-Reply-To: <515C4B4D.70708@gmail.com>
References: <515C119F.9040706@lumc.nl> <515C4B4D.70708@gmail.com>
Message-ID: <515C4C77.1080602@gmail.com>



On 13-04-03 11:31 AM, Duncan Murdoch wrote:
> On 03/04/2013 7:25 AM, Stefan Boehringer wrote:
>> Dear all,
>>
>> I am trying to submit an R-package to CRAN. In preparation I do run
>>
>> R_INSTALL_TAR=/bin/tar R CMD check --as-cran
>> parallelize.dynamic_0.9.tar.gz
>>
>> and the command finishes without warnings or errors. As a final output
>> I get
>>
>> NOTE: There was 1 note.
>> See
>> ?.../Rpackages/parallelize.dynamic/parallelize.dynamic.Rcheck/00check.log?
>>
>> for details.
>>
>> The file contains the standard output of the 'R CMD check ...' call
>> precisely. If I submit this very tarball to CRAN I get rejected with
>> warnings as reported from '--as-cran' checks there. In my case they are
>> valid warnings about assignments in .GlobalEnv which I can certainly
>> fix. However, my concern is about the discrepancy between the outputs of
>> 'R CMD check --as-cran' runs locally as compared to the run on the
>> CRAN-site.
>>
>> Any help is appreciated. I am running
>>
>>
>> R version 2.15.2 (2012-10-26) -- "Trick or Treat"
>> Platform: x86_64-unknown-linux-gnu (64-bit)
>
> Presumably CRAN is now running checks from 3.0.0 (which was released
> today, and has been available for testing for more than a month).  I
> wouldn't be surprised if those are different from the 2.15.2 tests.

Indeed, I think 2.15.3 tests running yesterday were slightly different 
from 2.15.2 tests.

Paul
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ggrothendieck at gmail.com  Wed Apr  3 17:59:35 2013
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 3 Apr 2013 11:59:35 -0400
Subject: [Rd] Documentation error in subsitute
In-Reply-To: <CABdHhvG6gJWcfn0q8CGBOh2uRSzXg6C0eO+60gWrCMcdQ81ZkQ@mail.gmail.com>
References: <CABdHhvG6gJWcfn0q8CGBOh2uRSzXg6C0eO+60gWrCMcdQ81ZkQ@mail.gmail.com>
Message-ID: <CAP01uRkC4Fbx5KXUGWPuEE=Gk=MFR+D2DdJjq940dVhEwrZBGA@mail.gmail.com>

On Wed, Apr 3, 2013 at 10:38 AM, Hadley Wickham <h.wickham at gmail.com> wrote:
> Hi all,
>
> The documentation for substitute currently reads:
>
> Substitution takes place by examining each component of the parse
> tree as follows: If it is not a bound symbol in ?env?, it is
> unchanged.  If it is a promise object, i.e., a formal argument to
> a function or explicitly created using ?delayedAssign()?, the
> expression slot of the promise replaces the symbol.  If it is an
> ordinary variable, its value is substituted, unless ?env? is
> ?.GlobalEnv? in which case the symbol is left unchanged.
>
> Since the clause referring to the globalenv() is attached to the
> discussion of ordinary variables, I thought that it implied that
>
> delayedAssign("a", "test")
> substitute(a)
>
> would return "test"  (but actually it returns quote(a))
>
> I'd suggest rewording this paragraph to:
>
> Substitution takes place by examining each component of the parse
> tree as follows: If it is not a bound symbol in ?env?, it is
> unchanged.  If it is a promise object, i.e., a formal argument to
> a function or explicitly created using ?delayedAssign()?, the
> expression slot of the promise replaces the symbol.  If it is an
> ordinary variable, its value is substituted.  There's one important
> exception to these rules: If 'env' is the ?.GlobalEnv?, then no
> substitution occurs.

It acts differently in the global environment.  Try this:

> f <- function() { delayedAssign("a", "test"); substitute(a) }
> f()
[1] "test"


--
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From pgilbert902 at gmail.com  Wed Apr  3 18:10:17 2013
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Wed, 03 Apr 2013 12:10:17 -0400
Subject: [Rd] R-3.0.0  reg-tests-3.R / survival
In-Reply-To: <1CFE4B7A-7D3E-4507-924B-6D61956E568E@gmail.com>
References: <515C43F9.60303@gmail.com>
	<1CFE4B7A-7D3E-4507-924B-6D61956E568E@gmail.com>
Message-ID: <515C5469.9060200@gmail.com>


"make check" seems to be picking up the setting of my  R_LIBS_SITE which 
is still set for 2.15.3 and had survival in it. At least, when I set 
that to empty then the check passes.  I'm not sure if checking worked 
like that before, I don't think so. I have not usually had base packages 
in my site-library. In any case, it seems like a bad idea for "make 
check" to use an existing setting of R_LIBS_SITE. At least, I think the 
idea is that it should be checking the just built library.

Paul


On 13-04-03 11:36 AM, peter dalgaard wrote:
> Any chance that you might have a personal library, which isn't versioned? If you do and you for some reason installed survival into it, it would explain it.
>
> E.g., I have, with the system-wide R
>
>> .libPaths()
> [1] "/Users/pd/Library/R/2.15/library"
> [2] "/opt/local/Library/Frameworks/R.framework/Versions/2.15/Resources/library"
>> lapply(.libPaths(), list.files)
> [[1]]
>   [1] "abind"      "aplpack"    "car"        "colorspace" "e1071"
>   [6] "effects"    "ellipse"    "Hmisc"      "ISwR"       "leaps"
> [11] "lmtest"     "matrixcalc" "mclust"     "multcomp"   "mvtnorm"
> [16] "pcaPP"      "Rcmdr"      "relimp"     "represent"  "rgl"
> [21] "robustbase" "rrcov"      "sem"        "xtable"     "zoo"
>
> [[2]]
>   [1] "base"       "boot"       "class"      "cluster"    "codetools"
>   [6] "compiler"   "datasets"   "foreign"    "graphics"   "grDevices"
> [11] "grid"       "KernSmooth" "lattice"    "MASS"       "Matrix"
> [16] "methods"    "mgcv"       "nlme"       "nnet"       "parallel"
> [21] "rpart"      "spatial"    "splines"    "stats"      "stats4"
> [26] "survival"   "tcltk"      "tools"      "utils"
>
> but the one in my development build tree of 3.0.0 has
>
>> .libPaths()
> [1] "/Users/pd/r-release-branch/BUILD-dist/library"
>
> If I explicitly set R_LIBS, I can easily reproduce your error.
>
>
> On Apr 3, 2013, at 17:00 , Paul Gilbert wrote:
>
>>
>> "make check" is failing on reg-test3.R with a message that survival was built with an older version of R.  (On my Ubuntu 32 bit and Ubuntu 64 bit machines). Why would "make check" be looking anywhere that it would find something built with an older version of R?
>>
>> ~/RoboAdmin/R-3.0.0/tests$ tail reg-tests-3.Rout.fail
>>> print(1.001, digits=16)
>> [1] 1.001
>>> ## 2.4.1 gave  1.001000000000000
>>> ## 2.5.0 errs on the side of caution.
>>>
>>>
>>> ## as.matrix.data.frame with coercion
>>> library(survival)
>> Error: package 'survival' was built before R 3.0.0: please re-install it
>> Execution halted
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From jmc at r-project.org  Wed Apr  3 23:58:13 2013
From: jmc at r-project.org (John Chambers)
Date: Wed, 3 Apr 2013 14:58:13 -0700
Subject: [Rd] Redefining quote() with reference classes (was: Ref
	classes initFields has incorrect environment?)
In-Reply-To: <3FB0FB82-F3E3-4911-93B9-D2729246AC94@r-project.org>
References: <CABdHhvFOcTbX0YnQ8Uiz6C_QdWX_hu9kuA7gD8XgDLg+voEzrQ@mail.gmail.com>
	<3FB0FB82-F3E3-4911-93B9-D2729246AC94@r-project.org>
Message-ID: <FA387FE8-4AF7-4A6C-A4D2-F3F51DE43D6D@r-project.org>

This should now be fixed in r-devel and 3.0.0 Patched as of revision 62487.

On Mar 29, 2013, at 11:30 AM, John Chambers <jmc at r-project.org> wrote:

> Nothing to do with initFields.  If you trace your redefined quote(), it's called from the <<- assignment of x.
> 
> The "x" element in the environment for the reference class object is implemented as an active binding in order to enforce the class when assigning the field.
> 
> Effectively that makes the assignment behave like a reference class method, and so ends up doing as() and getting back to the malware version of quote().
> 
> The fix will be to  have a more bullet proof (and perhaps more efficient) version of the active binding generated for fields.  A better design anyway, but this will take a little re-organization because the current default binding function is generated by some code manipulation.
> 
> Meanwhile the workaround is: Don't do what the revised subject heading says.
> 
> John
> 
> 
> On Mar 28, 2013, at 11:40 AM, Hadley Wickham <h.wickham at gmail.com> wrote:
> 
>> As suggested by the following code:
>> 
>> A <- setRefClass("A", fields = list(x = "logical"),
>> methods = list(initialize = function(...) {
>>   x <<- FALSE
>>   initFields(...)
>> }))
>> A$new()
>> # Works as expected
>> 
>> quote <- as.character
>> A$new()
>> # Error in function (value)  :
>> #  invalid replacement for field ?x?, should be from class ?logical?
>> or a subclass (was class ?character?)
>> 
>> I get the same error in:
>> * R version 2.15.2 (2012-10-26)
>> * R version 2.15.3 (2013-03-01)
>> * R Under development (unstable) (2013-03-28 r62432)
>> 
>> Hadley
>> 
>> -- 
>> Chief Scientist, RStudio
>> http://had.co.nz/
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From h.wickham at gmail.com  Thu Apr  4 15:49:49 2013
From: h.wickham at gmail.com (Hadley Wickham)
Date: Thu, 4 Apr 2013 08:49:49 -0500
Subject: [Rd] Subtle bug in write.csv
Message-ID: <CABdHhvHsZDUm8BnsMS7TQ56Nc8WnqQgtLgfdoOeSR+szYTCR1w@mail.gmail.com>

There's a subtle bug in write.csv -

write.csv(mtcars, "mtcars.csv", row = FALSE)
# Error in write.table(mtcars, "mtcars.csv", row = FALSE, col.names = NA,  :
#  col.names = NA makes no sense when row.names = FALSE

write.csv(mtcars, "mtcars.csv", row.names = FALSE)
# Works

i.e. the special evaluation used by write.csv has broken R's regular
argument matching mechanics.

This is straightforward to fix.  Replace the first line:

Call <- match.call(expand.dots = TRUE)

with

Call <- match.call(write.table, expand.dots = TRUE)

so the named arguments in write.table are used for argument matching.

Alternatively, I think you could replace the complex call munging just
by calling read.table with different default arguments:

write.csv <- function(x, file = "", sep = ",", qmethod = "double", ...) {
  write.table(x = x, file = file, sep = sep, qmethod = qmethod, ...)
}

but perhaps this introduces some undesirable behaviour that I'm missing.

Hadley

--
Chief Scientist, RStudio
http://had.co.nz/


From Thierry.ONKELINX at inbo.be  Thu Apr  4 16:55:28 2013
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Thu, 4 Apr 2013 14:55:28 +0000
Subject: [Rd] Non-vignette sweave file in package
Message-ID: <AA818EAD2576BC488B4F623941DA7427C28B09B5@inbomail.inbo.be>

Dear all,

I'm documenting an elaborate analysis as a private package. The package writes all required output to a database. I use a Sweave file to transform all the results from the database into a report.

Now I would like to add this Sweave to my package. I'm a bit puzzled on how to do that. It is not a vignette: the data is not available when the package is build and I need to recompile the Sweave file on demand (after the analysis was run).

So I have two questions.
1) Where to put a non-vignette Sweave file in a package.
2) How do I compile that Sweave file.

Best regards,

Thierry

ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature and Forest
team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
Kliniekstraat 25
1070 Anderlecht
Belgium
+ 32 2 525 02 51
+ 32 54 43 61 85
Thierry.Onkelinx at inbo.be
www.inbo.be

To call in the statistician after the experiment is done may be no more than asking him to perform a post-mortem examination: he may be able to say what the experiment died of.
~ Sir Ronald Aylmer Fisher

The plural of anecdote is not data.
~ Roger Brinner

The combination of some data and an aching desire for an answer does not ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey

* * * * * * * * * * * * * D I S C L A I M E R * * * * * * * * * * * * *
Dit bericht en eventuele bijlagen geven enkel de visie van de schrijver weer en binden het INBO onder geen enkel beding, zolang dit bericht niet bevestigd is door een geldig ondertekend document.
The views expressed in this message and any annex are purely those of the writer and may not be regarded as stating an official position of INBO, as long as the message is not confirmed by a duly signed document.


From murdoch.duncan at gmail.com  Thu Apr  4 19:04:04 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 04 Apr 2013 13:04:04 -0400
Subject: [Rd] Non-vignette sweave file in package
In-Reply-To: <AA818EAD2576BC488B4F623941DA7427C28B09B5@inbomail.inbo.be>
References: <AA818EAD2576BC488B4F623941DA7427C28B09B5@inbomail.inbo.be>
Message-ID: <515DB284.8030000@gmail.com>

On 04/04/2013 10:55 AM, ONKELINX, Thierry wrote:
> Dear all,
>
> I'm documenting an elaborate analysis as a private package. The package writes all required output to a database. I use a Sweave file to transform all the results from the database into a report.
>
> Now I would like to add this Sweave to my package. I'm a bit puzzled on how to do that. It is not a vignette: the data is not available when the package is build and I need to recompile the Sweave file on demand (after the analysis was run).
>
> So I have two questions.
> 1) Where to put a non-vignette Sweave file in a package.
> 2) How do I compile that Sweave file.

1) You can put it anywhere you like in the inst directory, but "doc" 
might make sense (if it doesn't trigger warnings about a badly formed 
vignette, I haven't checked).  When installed, it moves up one level.  
So ".../inst/doc/mydoc.Rnw"
will be retrievable as system.file("doc/mydoc.Rnw", package="mypkg").

2) Use Sweave() and tools::texi2pdf().  You might want to write your own 
function that calls those, after saving the data in the appropriate place.

Duncan Murdoch

>
> Best regards,
>
> Thierry
>
> ir. Thierry Onkelinx
> Instituut voor natuur- en bosonderzoek / Research Institute for Nature and Forest
> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
> Kliniekstraat 25
> 1070 Anderlecht
> Belgium
> + 32 2 525 02 51
> + 32 54 43 61 85
> Thierry.Onkelinx at inbo.be
> www.inbo.be
>
> To call in the statistician after the experiment is done may be no more than asking him to perform a post-mortem examination: he may be able to say what the experiment died of.
> ~ Sir Ronald Aylmer Fisher
>
> The plural of anecdote is not data.
> ~ Roger Brinner
>
> The combination of some data and an aching desire for an answer does not ensure that a reasonable answer can be extracted from a given body of data.
> ~ John Tukey
>
> * * * * * * * * * * * * * D I S C L A I M E R * * * * * * * * * * * * *
> Dit bericht en eventuele bijlagen geven enkel de visie van de schrijver weer en binden het INBO onder geen enkel beding, zolang dit bericht niet bevestigd is door een geldig ondertekend document.
> The views expressed in this message and any annex are purely those of the writer and may not be regarded as stating an official position of INBO, as long as the message is not confirmed by a duly signed document.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From hb at biostat.ucsf.edu  Thu Apr  4 20:06:59 2013
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Thu, 4 Apr 2013 11:06:59 -0700
Subject: [Rd] R CMD check --outdir=path gives unknown option '--outdir'
Message-ID: <CAFDcVCQ_ZkQpC=f6CL2L_1sOMrU6nfP1nHE2BKme+ouGsmpVbA@mail.gmail.com>

For 'R CMD check', it appears that option '--outdir' is not recognized
and generates warning "unknown option '--outdir'". R CMD check --help
says:

Usage: R CMD check [options] pkgs
[...]
Options:
[...]
  -o, --outdir=DIR      directory used for logfiles, R output, etc.
                        (default is 'pkg.Rcheck' in current directory,
                        where 'pkg' is the name of the package checked)

Example:

mkdir foo

# Check output is written to foo/
R CMD check -o foo pkg_0.1.tar.gz

# Option is ignored and check output is written to bar.Rcheck/
R CMD check --outdir=foo pkg_0.1.tar.gz
Warning: unknown option '--outdir=foo'

# Also tried with:
R CMD check --outdir foo pkg_0.1.tar.gz
Warning: unknown option '--outdir'

R CMD check -outdir=foo pkg_0.1.tar.gz
Warning: unknown option '-outdir=foo'

R CMD check -outdir foo pkg_0.1.tar.gz
Warning: unknown option '-outdir'

I get this with:

> sessionInfo()
R version 3.0.0 (2013-04-03)
Platform: x86_64-w64-mingw32/x64 (64-bit)

> sessionInfo()
R Under development (unstable) (2013-04-02 r62479)
Platform: x86_64-w64-mingw32/x64 (64-bit)

> sessionInfo()
R version 2.15.3 (2013-03-01)
Platform: x86_64-unknown-linux-gnu (64-bit)


Should I report this to http://bugs.r-project.org/?

/Henrik


From tal.galili at gmail.com  Thu Apr  4 20:38:22 2013
From: tal.galili at gmail.com (Tal Galili)
Date: Thu, 4 Apr 2013 21:38:22 +0300
Subject: [Rd] R 3.0.0: wrong MD5 checksums for Windows?
Message-ID: <CANdJ3dWo_ybrYXZJn4ORJA+HWwbxs9V152w4Nzygus5gUgbXSA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130404/4cd99962/attachment.pl>

From hb at biostat.ucsf.edu  Thu Apr  4 21:06:13 2013
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Thu, 4 Apr 2013 12:06:13 -0700
Subject: [Rd] R 3.0.0: wrong MD5 checksums for Windows?
In-Reply-To: <CANdJ3dWo_ybrYXZJn4ORJA+HWwbxs9V152w4Nzygus5gUgbXSA@mail.gmail.com>
References: <CANdJ3dWo_ybrYXZJn4ORJA+HWwbxs9V152w4Nzygus5gUgbXSA@mail.gmail.com>
Message-ID: <CAFDcVCTRS4uNnyzLk1aK4bRRQWEe8-h118m+kMnRWt+Ge2NHZQ@mail.gmail.com>

I can reproduce this (same setup):

> require(tools);
> checkMD5sums(dir=R.home());

It's a '\n' -> '\r\n' issue:

> filename <- "etc/Rconsole";
> md5 <- readLines(file.path(R.home(), "MD5"));
> md5 <- grep(filename, md5, value=TRUE);
> md5 <- gsub(" .*", "", md5);
> print(md5);
[1] "35d6d6cf7957492f78f50c435e36f08e"

> pathname <- file.path(R.home(), filename);
> md5a <- md5sum(pathname);
> print(md5a);
C:/PROGRA~1/R/R-3.0.0patched/etc/Rconsole
       "7436c369255f36aeacca8ab88b5f96c4"
> bfr <- readChar(pathname, nchars=1e6);
> bfr <- gsub("\r\n", "\n", bfr, fixed=TRUE);
> writeChar(bfr, eos=NULL, con="foo.txt");
> md5b <- md5sum("foo.txt")
> print(md5b);
                           foo.txt
"35d6d6cf7957492f78f50c435e36f08e"
> md5b == md5
foo.txt
   TRUE

/Henrik

On Thu, Apr 4, 2013 at 11:38 AM, Tal Galili <tal.galili at gmail.com> wrote:
> Hello dear R-devel,
>
> When installing R 3.0.0 on Windows 7, and then running:
>
> require(tools)
> checkMD5sums(dir=R.home())
>
> I get the following massage:
> files ?etc/Rconsole?, ?etc/Rprofile.site? have the wrong MD5 checksums
> [1] FALSE
>
> This happens when using the 32 and the 64 bit version of R.
> And was also reported by 2 other users on other machines, as can be seen in
> the comments to this post:
> http://www.r-statistics.com/2013/04/r-3-0-0-is-released-whats-new-and-how-to-upgrade/
>
> The R version was downloaded from this mirror:
> http://cran.rstudio.com/bin/windows/base/
> And installed on both the C and D drive on different computers (to rule-out
> any permission issues during installation).
>
>
>
> I hope I didn't miss anything,
> Tal
>
> ----------------Contact
> Details:-------------------------------------------------------
> Contact me: Tal.Galili at gmail.com |
> Read me: www.talgalili.com (Hebrew) | www.biostatistics.co.il (Hebrew) |
> www.r-statistics.com (English)
> ----------------------------------------------------------------------------------------------
>
>         [[alternative HTML version deleted]]
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From murdoch.duncan at gmail.com  Thu Apr  4 21:10:36 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 04 Apr 2013 15:10:36 -0400
Subject: [Rd] R 3.0.0: wrong MD5 checksums for Windows?
In-Reply-To: <CANdJ3dWo_ybrYXZJn4ORJA+HWwbxs9V152w4Nzygus5gUgbXSA@mail.gmail.com>
References: <CANdJ3dWo_ybrYXZJn4ORJA+HWwbxs9V152w4Nzygus5gUgbXSA@mail.gmail.com>
Message-ID: <515DD02C.9020507@gmail.com>

On 04/04/2013 2:38 PM, Tal Galili wrote:
> Hello dear R-devel,
>
> When installing R 3.0.0 on Windows 7, and then running:
>
> require(tools)
> checkMD5sums(dir=R.home())
>
> I get the following massage:
> files ???etc/Rconsole???, ???etc/Rprofile.site??? have the wrong MD5 checksums
> [1] FALSE

Rprofile.site is likely to be changed when you install R. It's pretty 
easy to change Rconsole as well.

So perhaps the bug is that we are running checksums on those at all.

Duncan Murdoch

>
> This happens when using the 32 and the 64 bit version of R.
> And was also reported by 2 other users on other machines, as can be seen in
> the comments to this post:
> http://www.r-statistics.com/2013/04/r-3-0-0-is-released-whats-new-and-how-to-upgrade/
>
> The R version was downloaded from this mirror:
> http://cran.rstudio.com/bin/windows/base/
> And installed on both the C and D drive on different computers (to rule-out
> any permission issues during installation).
>
>
>
> I hope I didn't miss anything,
> Tal
>
> ----------------Contact
> Details:-------------------------------------------------------
> Contact me: Tal.Galili at gmail.com |
> Read me: www.talgalili.com (Hebrew) | www.biostatistics.co.il (Hebrew) |
> www.r-statistics.com (English)
> ----------------------------------------------------------------------------------------------
>
> 	[[alternative HTML version deleted]]
>
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From hb at biostat.ucsf.edu  Thu Apr  4 21:26:24 2013
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Thu, 4 Apr 2013 12:26:24 -0700
Subject: [Rd] R 3.0.0: wrong MD5 checksums for Windows?
In-Reply-To: <515DD02C.9020507@gmail.com>
References: <CANdJ3dWo_ybrYXZJn4ORJA+HWwbxs9V152w4Nzygus5gUgbXSA@mail.gmail.com>
	<515DD02C.9020507@gmail.com>
Message-ID: <CAFDcVCRGV2E_2L37ZMZEnkGuo0UyUEnrBYYAQWJF9oG79i4a=w@mail.gmail.com>

On Thu, Apr 4, 2013 at 12:10 PM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 04/04/2013 2:38 PM, Tal Galili wrote:
>>
>> Hello dear R-devel,
>>
>> When installing R 3.0.0 on Windows 7, and then running:
>>
>> require(tools)
>> checkMD5sums(dir=R.home())
>>
>> I get the following massage:
>> files ???etc/Rconsole???, ???etc/Rprofile.site??? have the wrong MD5
>> checksums
>> [1] FALSE
>
>
> Rprofile.site is likely to be changed when you install R. It's pretty easy
> to change Rconsole as well.
>
> So perhaps the bug is that we are running checksums on those at all.

Maybe this is what you just implied/said, but if the MD5 checksums are
calculated on files with '\n' line breaks (on the build server) and
then they are simply rewritten "as-is" upon installation (but with
'\n' translated to '\r\n').  This could happen if they are written
using cat() or writeLines(), which writes using text-mode connections
and therefore have all '\n' translated to '\r\n' on Windows, e.g. (on
Windows):

> cat("a\nb", file="foo.txt"); file.info("foo.txt")$size
[1] 4
> cat("a\rb", file="foo.txt"); file.info("foo.txt")$size
[1] 3
> cat("a\r\nb", file="foo.txt"); file.info("foo.txt")$size
[1] 5
> writeChar("a\nb", eos=NULL, con="foo.txt"); file.info("foo.txt")$size
[1] 3

I've been bitten by '\n' -> '\r\n' so many times (e.g. can cause
unnecessary SVN commits/updates).  Out of curiosity, as of 2013, are
there any good reasons for generating '\r\n' - what Windows software
does not handle '\n' these days?

/Henrik

>
> Duncan Murdoch
>
>>
>> This happens when using the 32 and the 64 bit version of R.
>> And was also reported by 2 other users on other machines, as can be seen
>> in
>> the comments to this post:
>>
>> http://www.r-statistics.com/2013/04/r-3-0-0-is-released-whats-new-and-how-to-upgrade/
>>
>> The R version was downloaded from this mirror:
>> http://cran.rstudio.com/bin/windows/base/
>> And installed on both the C and D drive on different computers (to
>> rule-out
>> any permission issues during installation).
>>
>>
>>
>> I hope I didn't miss anything,
>> Tal
>>
>> ----------------Contact
>> Details:-------------------------------------------------------
>> Contact me: Tal.Galili at gmail.com |
>> Read me: www.talgalili.com (Hebrew) | www.biostatistics.co.il (Hebrew) |
>> www.r-statistics.com (English)
>>
>> ----------------------------------------------------------------------------------------------
>>
>>         [[alternative HTML version deleted]]
>>
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From pdalgd at gmail.com  Thu Apr  4 21:43:47 2013
From: pdalgd at gmail.com (peter dalgaard)
Date: Thu, 4 Apr 2013 21:43:47 +0200
Subject: [Rd] R 3.0.0: wrong MD5 checksums for Windows?
In-Reply-To: <CAFDcVCRGV2E_2L37ZMZEnkGuo0UyUEnrBYYAQWJF9oG79i4a=w@mail.gmail.com>
References: <CANdJ3dWo_ybrYXZJn4ORJA+HWwbxs9V152w4Nzygus5gUgbXSA@mail.gmail.com>
	<515DD02C.9020507@gmail.com>
	<CAFDcVCRGV2E_2L37ZMZEnkGuo0UyUEnrBYYAQWJF9oG79i4a=w@mail.gmail.com>
Message-ID: <2611B274-7106-4A01-948F-3920558AF1A5@gmail.com>


On Apr 4, 2013, at 21:26 , Henrik Bengtsson wrote:

> Out of curiosity, as of 2013, are
> there any good reasons for generating '\r\n' - what Windows software
> does not handle '\n' these days?

I'm a bit out of touch with the Windows world, but the usual culprit would be Notepad. 

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From ripley at stats.ox.ac.uk  Thu Apr  4 22:14:46 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 04 Apr 2013 21:14:46 +0100
Subject: [Rd] R 3.0.0: wrong MD5 checksums for Windows?
In-Reply-To: <CAFDcVCRGV2E_2L37ZMZEnkGuo0UyUEnrBYYAQWJF9oG79i4a=w@mail.gmail.com>
References: <CANdJ3dWo_ybrYXZJn4ORJA+HWwbxs9V152w4Nzygus5gUgbXSA@mail.gmail.com>
	<515DD02C.9020507@gmail.com>
	<CAFDcVCRGV2E_2L37ZMZEnkGuo0UyUEnrBYYAQWJF9oG79i4a=w@mail.gmail.com>
Message-ID: <515DDF36.2060807@stats.ox.ac.uk>

On 04/04/2013 20:26, Henrik Bengtsson wrote:
> On Thu, Apr 4, 2013 at 12:10 PM, Duncan Murdoch
> <murdoch.duncan at gmail.com> wrote:
>> On 04/04/2013 2:38 PM, Tal Galili wrote:
>>>
>>> Hello dear R-devel,
>>>
>>> When installing R 3.0.0 on Windows 7, and then running:
>>>
>>> require(tools)
>>> checkMD5sums(dir=R.home())
>>>
>>> I get the following massage:
>>> files ???etc/Rconsole???, ???etc/Rprofile.site??? have the wrong MD5
>>> checksums
>>> [1] FALSE
>>
>>
>> Rprofile.site is likely to be changed when you install R. It's pretty easy
>> to change Rconsole as well.
>>
>> So perhaps the bug is that we are running checksums on those at all.
>
> Maybe this is what you just implied/said, but if the MD5 checksums are
> calculated on files with '\n' line breaks (on the build server) and
> then they are simply rewritten "as-is" upon installation (but with
> '\n' translated to '\r\n').  This could happen if they are written
> using cat() or writeLines(), which writes using text-mode connections
> and therefore have all '\n' translated to '\r\n' on Windows, e.g. (on
> Windows):
>
>> cat("a\nb", file="foo.txt"); file.info("foo.txt")$size
> [1] 4
>> cat("a\rb", file="foo.txt"); file.info("foo.txt")$size
> [1] 3
>> cat("a\r\nb", file="foo.txt"); file.info("foo.txt")$size
> [1] 5
>> writeChar("a\nb", eos=NULL, con="foo.txt"); file.info("foo.txt")$size
> [1] 3
>
> I've been bitten by '\n' -> '\r\n' so many times (e.g. can cause
> unnecessary SVN commits/updates).  Out of curiosity, as of 2013, are
> there any good reasons for generating '\r\n' - what Windows software
> does not handle '\n' these days?

Inno Setup: the installer software!

>
> /Henrik
>
>>
>> Duncan Murdoch
>>
>>>
>>> This happens when using the 32 and the 64 bit version of R.
>>> And was also reported by 2 other users on other machines, as can be seen
>>> in
>>> the comments to this post:
>>>
>>> http://www.r-statistics.com/2013/04/r-3-0-0-is-released-whats-new-and-how-to-upgrade/
>>>
>>> The R version was downloaded from this mirror:
>>> http://cran.rstudio.com/bin/windows/base/
>>> And installed on both the C and D drive on different computers (to
>>> rule-out
>>> any permission issues during installation).
>>>
>>>
>>>
>>> I hope I didn't miss anything,
>>> Tal
>>>
>>> ----------------Contact
>>> Details:-------------------------------------------------------
>>> Contact me: Tal.Galili at gmail.com |
>>> Read me: www.talgalili.com (Hebrew) | www.biostatistics.co.il (Hebrew) |
>>> www.r-statistics.com (English)
>>>
>>> ----------------------------------------------------------------------------------------------
>>>
>>>          [[alternative HTML version deleted]]
>>>
>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From mg14 at sanger.ac.uk  Thu Apr  4 11:56:55 2013
From: mg14 at sanger.ac.uk (Moritz Gerstung)
Date: Thu, 4 Apr 2013 11:56:55 +0200
Subject: [Rd] Changing HTTP proxy configurations at run time
Message-ID: <747C1B90-4052-4C79-8293-596E652A3FC0@sanger.ac.uk>

DeaR developers,

I was recently moving with my laptop between two environments with and without a HTTP proxy server. As the internal proxy configuration is read only once from the environment variables http_proxy/HTTP_PROXY at the first call of download.file(), the proxy configurations couldn't be adjusted at a later stage. (See also the comment in ?download.file). This caused some frustration as I wasn't able to use http functionality in a running R session after moving to an environment with a different/no proxy server.

After some digging I found that this behaviour was caused by RxmlNanoHTTPInit() in src/modules/internet/nanohttp.c, which after its first call refuses to reinitialise the proxy configuration. It does so by setting a variable 'initialized' to 1, and checking whether the string 'proxy' is non-NULL.

I have made a small modification to have RxmlNanoHTTPInit() ignore these variables and to read in the proxy configuration at each call.

$ svn diff
Index: src/modules/internet/nanohttp.c
===================================================================
--- src/modules/internet/nanohttp.c	(revision 62488)
+++ src/modules/internet/nanohttp.c	(working copy)
@@ -255,15 +255,12 @@
     WSADATA wsaData;
 #endif

-    if (initialized)
-	return;
-
 #ifdef _WINSOCKAPI_
     if (WSAStartup(MAKEWORD(1, 1), &wsaData) != 0)
 	return;
 #endif

-    if (proxy == NULL) {
+    proxy = NULL;
 	proxyPort = 80;
 	env = getenv("no_proxy");
 	if (env && ((env[0] == '*') && (env[1] == 0)))
@@ -287,7 +284,7 @@
 #endif
 	    proxyUser = xmlMemStrdup(env);
 	}
-    }
+
  done:
     initialized = 1;
 }


This works fine for me (on a Mac) and I can simply use Sys.setenv(http_proxy=) to adjust the proxy server at run time.

I think this doesn't really cause overhead as the number of calls do download.file() is typically small and parsing the environment variables is simple. On the other hand, if a user alters the proxy environment variables, he/she probably does so for a reason. Googling around I found a few posts of R users demanding this.

A cleaner solution would of course be to write a function that resets the internal proxy configuration, but this would be a bit of an effort to make it user visible.

What are your thoughts?

Best wishes,

Moritz

-- 
 The Wellcome Trust Sanger Institute is operated by Genome Research 
 Limited, a charity registered in England with number 1021457 and a 
 company registered in England with number 2742969, whose registered 
 office is 215 Euston Road, London, NW1 2BE.


From Thierry.ONKELINX at inbo.be  Fri Apr  5 14:01:59 2013
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Fri, 5 Apr 2013 12:01:59 +0000
Subject: [Rd] Non-vignette sweave file in package
In-Reply-To: <515DB284.8030000@gmail.com>
References: <AA818EAD2576BC488B4F623941DA7427C28B09B5@inbomail.inbo.be>
	<515DB284.8030000@gmail.com>
Message-ID: <AA818EAD2576BC488B4F623941DA7427C28B3253@inbomail.inbo.be>

Dear Duncan,

Thanks a lot for the advice.

When I place the Rnw file in inst/doc it is treated as a vignette, which I don't want. Placing it in inst/sweave works fine. I can compile it either as you suggested in R or from the command line with R CMD Sweave --pdf path.to.R.library/mypkg/sweave/mydoc.rnw

Best regards,

ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature and Forest
team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
Kliniekstraat 25
1070 Anderlecht
Belgium
+ 32 2 525 02 51
+ 32 54 43 61 85
Thierry.Onkelinx at inbo.be
www.inbo.be

To call in the statistician after the experiment is done may be no more than asking him to perform a post-mortem examination: he may be able to say what the experiment died of.
~ Sir Ronald Aylmer Fisher

The plural of anecdote is not data.
~ Roger Brinner

The combination of some data and an aching desire for an answer does not ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey


-----Oorspronkelijk bericht-----
Van: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
Verzonden: donderdag 4 april 2013 19:04
Aan: ONKELINX, Thierry
CC: r-devel at r-project.org
Onderwerp: Re: [Rd] Non-vignette sweave file in package

On 04/04/2013 10:55 AM, ONKELINX, Thierry wrote:
> Dear all,
>
> I'm documenting an elaborate analysis as a private package. The package writes all required output to a database. I use a Sweave file to transform all the results from the database into a report.
>
> Now I would like to add this Sweave to my package. I'm a bit puzzled on how to do that. It is not a vignette: the data is not available when the package is build and I need to recompile the Sweave file on demand (after the analysis was run).
>
> So I have two questions.
> 1) Where to put a non-vignette Sweave file in a package.
> 2) How do I compile that Sweave file.

1) You can put it anywhere you like in the inst directory, but "doc"
might make sense (if it doesn't trigger warnings about a badly formed vignette, I haven't checked).  When installed, it moves up one level.
So ".../inst/doc/mydoc.Rnw"
will be retrievable as system.file("doc/mydoc.Rnw", package="mypkg").

2) Use Sweave() and tools::texi2pdf().  You might want to write your own function that calls those, after saving the data in the appropriate place.

Duncan Murdoch

>
> Best regards,
>
> Thierry
>
> ir. Thierry Onkelinx
> Instituut voor natuur- en bosonderzoek / Research Institute for Nature
> and Forest team Biometrie & Kwaliteitszorg / team Biometrics & Quality
> Assurance Kliniekstraat 25
> 1070 Anderlecht
> Belgium
> + 32 2 525 02 51
> + 32 54 43 61 85
> Thierry.Onkelinx at inbo.be
> www.inbo.be
>
> To call in the statistician after the experiment is done may be no more than asking him to perform a post-mortem examination: he may be able to say what the experiment died of.
> ~ Sir Ronald Aylmer Fisher
>
> The plural of anecdote is not data.
> ~ Roger Brinner
>
> The combination of some data and an aching desire for an answer does not ensure that a reasonable answer can be extracted from a given body of data.
> ~ John Tukey
>
> * * * * * * * * * * * * * D I S C L A I M E R * * * * * * * * * * * *
> * Dit bericht en eventuele bijlagen geven enkel de visie van de schrijver weer en binden het INBO onder geen enkel beding, zolang dit bericht niet bevestigd is door een geldig ondertekend document.
> The views expressed in this message and any annex are purely those of the writer and may not be regarded as stating an official position of INBO, as long as the message is not confirmed by a duly signed document.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

* * * * * * * * * * * * * D I S C L A I M E R * * * * * * * * * * * * *
Dit bericht en eventuele bijlagen geven enkel de visie van de schrijver weer en binden het INBO onder geen enkel beding, zolang dit bericht niet bevestigd is door een geldig ondertekend document.
The views expressed in this message and any annex are purely those of the writer and may not be regarded as stating an official position of INBO, as long as the message is not confirmed by a duly signed document.


From Thomas.Petzoldt at TU-Dresden.de  Fri Apr  5 17:53:58 2013
From: Thomas.Petzoldt at TU-Dresden.de (Thomas Petzoldt)
Date: Fri, 05 Apr 2013 17:53:58 +0200
Subject: [Rd] R 3.0 in newsticker of German computer magazine c't
Message-ID: <515EF396.4030006@TU-Dresden.de>

Hi,

just a short notice for the record that the long vectors of R 3.0 have 
been recognized by the news ticker of the leading German computer 
magazine publisher 'Heise Verlag':

http://www.heise.de/newsticker/meldung/Programmiersprache-R-3-0-fuehrt-Lang-Vektoren-ein-1835822.html


Thanks to you all for your great work!


Thomas Petzoldt


From hb at biostat.ucsf.edu  Fri Apr  5 21:23:53 2013
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Fri, 5 Apr 2013 12:23:53 -0700
Subject: [Rd] parallel: Race-condition concern regarding graphics devices in
 a multi-thread environment
Message-ID: <CAFDcVCTdH3wwXapM07UK=+biSC5ppS9pLdX+tLkAjT6UEFXzpA@mail.gmail.com>

Hi,

I'm trying to figure out how to safely make sure that I close the same
graphics device that I opened earlier in a thread (and not one opened
by a parallel thread).  In a *single-thread* environment, one can do
the following to open and close a device:

makePlot <- function(i) {
  filename <- sprintf("foo%d.png", i);
  png(filename);
  idx <- dev.cur();
  on.exit(dev.off(idx));
  plot(1:10, col=i);
  title(main=i);
  filename;
} # makePlot()

However, in a *multi-thread* environment, e.g.

res <- mclapply(1:4, FUN=makePlot, mc.cores=4);

the following race-condition problem may occur, because of the
non-atomicity(?) of (i) png() and (ii) dev.cur():

1. Thread #1: png("foo1.png")
2. Thread #2: png("foo2.png")
3. Thread #1: idx <- dev.cur();  # idx == 3
4. Thread #2: idx <- dev.cur();  # idx == 3 (same device!)
...
5. Thread #1: dev.off(idx); # Closes device #3
6. Thread #2: plot(1:10, col=2); # Trying to plot, which opens a new
on-screen device (or to another active device) since device #3 is
closed.
7. Thread #2: dev.off(idx) # Trying to close device #3, which is already closed.

On this topic, there are some clues/notes on concern in the vignette
of the 'parallel' package, but not enough to answer my concerns/solve
my problems.  Any other references/discussion on this (other that
source code)?


Q1. Is there already a built-in protection against the above race condition?

Q2. If not on Q1, is there a way/strategy to get hold of the device
(index) for the graphics devices that was opened by png() without
using dev.cur()?

If not on Q2, what about transitioning to have graphics device
functions return the opened device (index) (cf. connections), e.g. idx
<- png(...).  A quick look at ?png and ?x11 show that those functions
does not return anything (although code inspections show that they may
return something, but always NULL when I try).


Comments?

Henrik


From simon.urbanek at r-project.org  Fri Apr  5 23:44:38 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 5 Apr 2013 14:44:38 -0700
Subject: [Rd] parallel: Race-condition concern regarding graphics
	devices in a multi-thread environment
In-Reply-To: <CAFDcVCTdH3wwXapM07UK=+biSC5ppS9pLdX+tLkAjT6UEFXzpA@mail.gmail.com>
References: <CAFDcVCTdH3wwXapM07UK=+biSC5ppS9pLdX+tLkAjT6UEFXzpA@mail.gmail.com>
Message-ID: <088FD5D2-2999-4765-A62B-5EE79B57945F@r-project.org>

Henrik,

there are no threads. Hence you're on the wrong track there, it has nothing to do with device numbers/devices.The device number will be the same in all processes and that's ok. The issue here really is which png() pack-end are you using? (You didn't say). Some back-ends (like X11) cannot be run in forked environment, so you can't use them. I don't use png() myself, but I do know that CairoPNG() from the Cairo package works when forked.

Cheers,
Simon


On Apr 5, 2013, at 12:23 PM, Henrik Bengtsson <hb at biostat.ucsf.edu> wrote:

> Hi,
> 
> I'm trying to figure out how to safely make sure that I close the same
> graphics device that I opened earlier in a thread (and not one opened
> by a parallel thread).  In a *single-thread* environment, one can do
> the following to open and close a device:
> 
> makePlot <- function(i) {
>  filename <- sprintf("foo%d.png", i);
>  png(filename);
>  idx <- dev.cur();
>  on.exit(dev.off(idx));
>  plot(1:10, col=i);
>  title(main=i);
>  filename;
> } # makePlot()
> 
> However, in a *multi-thread* environment, e.g.
> 
> res <- mclapply(1:4, FUN=makePlot, mc.cores=4);
> 
> the following race-condition problem may occur, because of the
> non-atomicity(?) of (i) png() and (ii) dev.cur():
> 
> 1. Thread #1: png("foo1.png")
> 2. Thread #2: png("foo2.png")
> 3. Thread #1: idx <- dev.cur();  # idx == 3
> 4. Thread #2: idx <- dev.cur();  # idx == 3 (same device!)
> ...
> 5. Thread #1: dev.off(idx); # Closes device #3
> 6. Thread #2: plot(1:10, col=2); # Trying to plot, which opens a new
> on-screen device (or to another active device) since device #3 is
> closed.
> 7. Thread #2: dev.off(idx) # Trying to close device #3, which is already closed.
> 
> On this topic, there are some clues/notes on concern in the vignette
> of the 'parallel' package, but not enough to answer my concerns/solve
> my problems.  Any other references/discussion on this (other that
> source code)?
> 
> 
> Q1. Is there already a built-in protection against the above race condition?
> 
> Q2. If not on Q1, is there a way/strategy to get hold of the device
> (index) for the graphics devices that was opened by png() without
> using dev.cur()?
> 
> If not on Q2, what about transitioning to have graphics device
> functions return the opened device (index) (cf. connections), e.g. idx
> <- png(...).  A quick look at ?png and ?x11 show that those functions
> does not return anything (although code inspections show that they may
> return something, but always NULL when I try).
> 
> 
> Comments?
> 
> Henrik
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From hb at biostat.ucsf.edu  Sat Apr  6 23:09:34 2013
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Sat, 6 Apr 2013 14:09:34 -0700
Subject: [Rd] parallel: Race-condition concern regarding graphics
 devices in a multi-thread environment
In-Reply-To: <088FD5D2-2999-4765-A62B-5EE79B57945F@r-project.org>
References: <CAFDcVCTdH3wwXapM07UK=+biSC5ppS9pLdX+tLkAjT6UEFXzpA@mail.gmail.com>
	<088FD5D2-2999-4765-A62B-5EE79B57945F@r-project.org>
Message-ID: <CAFDcVCRxLXssrU+4ObnjakFub9EjZ4uHbj789wE2+Jxpx49Zpw@mail.gmail.com>

On Fri, Apr 5, 2013 at 2:44 PM, Simon Urbanek
<simon.urbanek at r-project.org> wrote:
> Henrik,
>
> there are no threads.

Oh my... all this time I've thought mc* were working with threads.
...despite the 'parallel' vignette writing it in black and white: "In
principle the workers could be implemented by threads\footnote{only
`in principle' since the R interpreter is not thread-safe.} or
lightweight processes, but in the current implementation they are full
processes."  Note to self: lapply(rep(c(9,14), times=100),
fortunes::fortune)


> Hence you're on the wrong track there, it has nothing to do with device numbers/devices.The device number will be the same in all processes and that's ok.

Got it; at the moment the main process is forked, each child *process*
gets a copy of the existing list of devices (devices which they then
may interact with but that's bad style - or is ignored?!?), whereas
any newly created graphics device is unique to each child process.
Device indices are local to each child processes.   In case someone
else follows this or finds this thread later, the following example
illustrates this:

library("parallel");
jpeg("foo0.jpg");
idx <- dev.cur();
plot(1:10, main="main");

dummy <- function(i) {
  before <- dev.list();
  filename <- sprintf("foo%d.png", i);
  png(filename);
  plot(1:10, main=i);
  # No dev.off(); tests what happens if you forget
  # to close device (see below).
  list(before=before, after=dev.list());
}

res <- mclapply(1:2, FUN=dummy, mc.cores=2);
str(res);
## List of 2
##  $ :List of 2
##   ..$ before: Named int 2
##   .. ..- attr(*, "names")= chr "jpeg"
##   ..$ after : Named int [1:2] 2 3
##   .. ..- attr(*, "names")= chr [1:2] "jpeg" "png"
##  $ :List of 2
##   ..$ before: Named int 2
##   .. ..- attr(*, "names")= chr "jpeg"
##   ..$ after : Named int [1:2] 2 3
##   .. ..- attr(*, "names")= chr [1:2] "jpeg" "png"

# When child processes finishes, any open devices are closed.
str(dev.list());
##  Named int 2
## - attr(*, "names")= chr "jpeg"

# Close the opened jpeg device.
dev.off(idx);

# All devices closed
str(dev.list())
##  NULL


> The issue here really is which png() pack-end are you using? (You didn't say).

I was considering the general case (where I don't know), e.g.
dev.new(<user specified>).


> Some back-ends (like X11) cannot be run in forked environment, so you can't use them.  I don't use png() myself, but I do know that CairoPNG() from the Cairo package works when forked.

Test/example:

dummy <- function(i) {
  x11();
  plot(1:10, main=i);
}

res <- mclapply(1:2, FUN=dummy, mc.cores=2);
## Warning message:
## In mclapply(1:2, FUN = dummy, mc.cores = 2) :
##   all scheduled cores encountered errors in user code
print(res);
## [[1]]
## [1] "Error in x11() : a forked child should not open a graphics device\n"
## [[2]]
## [1] "Error in x11() : a forked child should not open a graphics device\n"


Thanks for your help Simon,

Henrik

>
> Cheers,
> Simon
>
>
> On Apr 5, 2013, at 12:23 PM, Henrik Bengtsson <hb at biostat.ucsf.edu> wrote:
>
>> Hi,
>>
>> I'm trying to figure out how to safely make sure that I close the same
>> graphics device that I opened earlier in a thread (and not one opened
>> by a parallel thread).  In a *single-thread* environment, one can do
>> the following to open and close a device:
>>
>> makePlot <- function(i) {
>>  filename <- sprintf("foo%d.png", i);
>>  png(filename);
>>  idx <- dev.cur();
>>  on.exit(dev.off(idx));
>>  plot(1:10, col=i);
>>  title(main=i);
>>  filename;
>> } # makePlot()
>>
>> However, in a *multi-thread* environment, e.g.
>>
>> res <- mclapply(1:4, FUN=makePlot, mc.cores=4);
>>
>> the following race-condition problem may occur, because of the
>> non-atomicity(?) of (i) png() and (ii) dev.cur():
>>
>> 1. Thread #1: png("foo1.png")
>> 2. Thread #2: png("foo2.png")
>> 3. Thread #1: idx <- dev.cur();  # idx == 3
>> 4. Thread #2: idx <- dev.cur();  # idx == 3 (same device!)
>> ...
>> 5. Thread #1: dev.off(idx); # Closes device #3
>> 6. Thread #2: plot(1:10, col=2); # Trying to plot, which opens a new
>> on-screen device (or to another active device) since device #3 is
>> closed.
>> 7. Thread #2: dev.off(idx) # Trying to close device #3, which is already closed.
>>
>> On this topic, there are some clues/notes on concern in the vignette
>> of the 'parallel' package, but not enough to answer my concerns/solve
>> my problems.  Any other references/discussion on this (other that
>> source code)?
>>
>>
>> Q1. Is there already a built-in protection against the above race condition?
>>
>> Q2. If not on Q1, is there a way/strategy to get hold of the device
>> (index) for the graphics devices that was opened by png() without
>> using dev.cur()?
>>
>> If not on Q2, what about transitioning to have graphics device
>> functions return the opened device (index) (cf. connections), e.g. idx
>> <- png(...).  A quick look at ?png and ?x11 show that those functions
>> does not return anything (although code inspections show that they may
>> return something, but always NULL when I try).
>>
>>
>> Comments?
>>
>> Henrik
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>


From renaud at mancala.cbio.uct.ac.za  Sun Apr  7 15:37:42 2013
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Sun, 7 Apr 2013 16:37:42 +0300
Subject: [Rd] loadNamespace tries to load an optional dependency from a
	required dependency
Message-ID: <CAHavPHF013CwJksG-qjR9uvdhFvcTE9Dj1TD6DMZRUmqTQKK7A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130407/00314cc4/attachment.pl>

From grassi.e at gmail.com  Sat Apr  6 11:44:23 2013
From: grassi.e at gmail.com (Elena Grassi)
Date: Sat, 6 Apr 2013 11:44:23 +0200
Subject: [Rd] Fwd: Process substitution and read.table/scan
In-Reply-To: <CALp0JQD_Bf1zdMvz+AwNYDQHhTZN_LafXAj45yXQA1i1Kj0U_g@mail.gmail.com>
References: <CALp0JQD_Bf1zdMvz+AwNYDQHhTZN_LafXAj45yXQA1i1Kj0U_g@mail.gmail.com>
Message-ID: <CALp0JQBZAjqb5xUmSuaaDTNRZNwkFa-3S6LxeDFLYEQE+P0riA@mail.gmail.com>

Maybe after all this is more appropriate on r-devel, so I'm forwarding it here.

---------- Forwarded message ----------
From: Elena Grassi <grassi.e at gmail.com>
Date: Wed, Apr 3, 2013 at 2:19 PM
Subject: Process substitution and read.table/scan
To: r-help at r-project.org


Hello, I did the same question on stackoverflow
(http://stackoverflow.com/questions/15784373/process-substitution) but
did not understand completely the issue so I'm reporting it here:

"
I've given a look around about what puzzles me and I only found this:
http://stackoverflow.com/questions/4274171/do-some-programs-not-accept-process-substitution-for-input-files

which is partially helping, but I really would like to understand the
full story. I noticed that some of my R scripts give different (ie.
wrong) results when I use process substitution.

I tried to pinpoint the problem with a test case:

This script:

#!/usr/bin/Rscript

args  <- commandArgs(TRUE)
file  <-args[1]
cat(file)
cat("\n")
data <- read.table(file, header=F)
cat(mean(data$V1))
cat("\n")

with an input file generated in this way:

$ for i in `seq 1 10`; do echo $i >> p; done
$ for i in `seq 1 500`; do cat p >> test; done

leads me to this:

$ ./mean.R test
test
5.5

$ ./mean.R <(cat test)
/dev/fd/63
5.501476

Further tests reveal that some lines are lost...but I would like to
understand why. Does read.table (scan gives the same results) uses
seek?

Ps. with a smaller test file (100) an error is reported:

$./mean.R <(cat test3)
/dev/fd/63
Error in read.table(file, header = F) : no lines available in input
Execution halted
"

Other notes: with a modified script that uses scan the results are the same.
Printing the whole data.frame results in 5001 lines in the first case
(which is correct) and only 3050 with the process redirection.

I checked read.table source code and I saw that it goes around in the
file to check for column types and so on...I thought that this was an
explanation for this problem but I would prefer an error message
reported instead than a result gotten from partial data...then someone
on stackoverflow pointed me to fifo() which solves the problem (i.e
the mean is reported correctly even with the process redirection) and
therefore I'm even more puzzled: does fifo() allows seeks and peeks
around a named pipe?
I'm willing to read the relevant code to understand what's really
happening (and even help if someone thinks that this issue could
represent a small bug) but I would really appreciate some pointers.

Here the sessionInfo() and other possibly relevant things:
> sessionInfo()
R version 3.0.0 beta (2013-03-23 r62384)
Platform: x86_64-pc-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_US.utf8       LC_NUMERIC=C
 [3] LC_TIME=en_US.utf8        LC_COLLATE=en_US.utf8
 [5] LC_MONETARY=en_US.utf8    LC_MESSAGES=en_US.utf8
 [7] LC_PAPER=C                LC_NAME=C
 [9] LC_ADDRESS=C              LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.utf8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

$ uname -a
Linux femto 3.6-trunk-amd64 #1 SMP Debian 3.6.9-1~experimental.1
x86_64 GNU/Linux

I use the debian R package: r-base-core, 3.0.0~20130324-1

Thanks,
Elena Grassi

ps.
I started on R-help as long as this could be of general interest,
sorry if that's a bad call.
--
$ pom


--
$ pom


From xie at yihui.name  Tue Apr  9 00:05:15 2013
From: xie at yihui.name (Yihui Xie)
Date: Mon, 8 Apr 2013 17:05:15 -0500
Subject: [Rd] savePlot() under Windows
Message-ID: <CANROs4f595-uM3SUm4HBfKLYU2UKXPuLkXMOoNdPTQSrEAcfrA@mail.gmail.com>

Hi,

A Windows user asked me a question and I believe this is a bug of R
3.0.0 under Windows:

> plot(1:10)
> savePlot('test.wmf')
Error in .External(C_savePlot, device, filename, type, restoreConsole) :
  Incorrect number of arguments (4), expecting 3 for 'savePlot'

> sessionInfo()
R version 3.0.0 (2013-04-03)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] tools_3.0.0

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Phone: 515-294-2465 Web: http://yihui.name
Department of Statistics, Iowa State University
2215 Snedecor Hall, Ames, IA


From murdoch.duncan at gmail.com  Tue Apr  9 01:28:22 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 08 Apr 2013 19:28:22 -0400
Subject: [Rd] savePlot() under Windows
In-Reply-To: <CANROs4f595-uM3SUm4HBfKLYU2UKXPuLkXMOoNdPTQSrEAcfrA@mail.gmail.com>
References: <CANROs4f595-uM3SUm4HBfKLYU2UKXPuLkXMOoNdPTQSrEAcfrA@mail.gmail.com>
Message-ID: <51635296.5060705@gmail.com>

On 13-04-08 6:05 PM, Yihui Xie wrote:
> Hi,
>
> A Windows user asked me a question and I believe this is a bug of R
> 3.0.0 under Windows:

Yes.  On Windows the external needs 4 args, but on other platforms only 
3.  The check was checked on other platforms.  I'll fix.

Duncan Murdoch

>
>> plot(1:10)
>> savePlot('test.wmf')
> Error in .External(C_savePlot, device, filename, type, restoreConsole) :
>    Incorrect number of arguments (4), expecting 3 for 'savePlot'
>
>> sessionInfo()
> R version 3.0.0 (2013-04-03)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> loaded via a namespace (and not attached):
> [1] tools_3.0.0
>
> Regards,
> Yihui
> --
> Yihui Xie <xieyihui at gmail.com>
> Phone: 515-294-2465 Web: http://yihui.name
> Department of Statistics, Iowa State University
> 2215 Snedecor Hall, Ames, IA
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From sean.oriordain at gmail.com  Tue Apr  9 10:33:07 2013
From: sean.oriordain at gmail.com (Sean O'Riordain)
Date: Tue, 9 Apr 2013 09:33:07 +0100
Subject: [Rd] Fwd: R unzip method gives filenames as character
In-Reply-To: <515D69C2.8020000@3v.ie>
References: <515D69C2.8020000@3v.ie>
Message-ID: <CA+MmmT+Hwk4dL+08ZMFnkxA6ejxyK+d0gdueMXV-JDsQQ1ufGA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130409/f7b27319/attachment.pl>

From ripley at stats.ox.ac.uk  Wed Apr 10 11:41:25 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 10 Apr 2013 10:41:25 +0100
Subject: [Rd] Fwd: R unzip method gives filenames as character
In-Reply-To: <CA+MmmT+Hwk4dL+08ZMFnkxA6ejxyK+d0gdueMXV-JDsQQ1ufGA@mail.gmail.com>
References: <515D69C2.8020000@3v.ie>
	<CA+MmmT+Hwk4dL+08ZMFnkxA6ejxyK+d0gdueMXV-JDsQQ1ufGA@mail.gmail.com>
Message-ID: <516533C5.5090505@stats.ox.ac.uk>

On 09/04/2013 09:33, Sean O'Riordain wrote:
> Question: would it be better if the contents list of the unzip() function
> returned the filenames as character rather than factor since they are
> probably unique strings?

That is what the help page says it does, so this is bug -- now corrected 
in R-patched (for one of the methods, only).

>
>> tmp <- unzip(fnam, list=TRUE)
>> str(tmp)
> 'data.frame':   31 obs. of  3 variables:
>   $ Name  : Factor w/ 31 levels "fred1.csv",..: 1 2 3 4 5 6 7 8 9 10 ...
>   $ Length: num  424486 2664277 219798 442383 480857 ...
>   $ Date  : POSIXct, format: "2012-12-01 04:05:00" "2012-12-02 04:06:00"
> "2012-12-03 04:45:00" "2012-12-04 03:52:00" ...
>
> thanks,
> Sean



-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From stnava at gmail.com  Wed Apr 10 19:53:12 2013
From: stnava at gmail.com (brian avants)
Date: Wed, 10 Apr 2013 13:53:12 -0400
Subject: [Rd] question re: error message --- package error: "functionName"
 not resolved from current namespace
Message-ID: <CABWzF4XhbD_LGy0UeVSiLd-cHbbvH9z+QTMrRQD1_PMvZv-=6w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130410/7da7151f/attachment.pl>

From simon.urbanek at r-project.org  Wed Apr 10 20:15:32 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 10 Apr 2013 14:15:32 -0400
Subject: [Rd] question re: error message --- package error:
	"functionName" not resolved from current namespace
In-Reply-To: <CABWzF4XhbD_LGy0UeVSiLd-cHbbvH9z+QTMrRQD1_PMvZv-=6w@mail.gmail.com>
References: <CABWzF4XhbD_LGy0UeVSiLd-cHbbvH9z+QTMrRQD1_PMvZv-=6w@mail.gmail.com>
Message-ID: <CC350C70-2837-4160-B8EF-F391188D4667@r-project.org>


On Apr 10, 2013, at 1:53 PM, brian avants wrote:

> hello everyone
> 
> we are developing a package that has worked up until R3.0 which we just
> tested.
> 
> the issue is as above .... when we call a function that works in R 2.15.2
> from  R 3.0 we get an error
> 
> Error in .Call("antsImageRead", filename, pixeltype, dimension) :
>  "antsImageRead" not resolved from current namespace (ANTsR)
> 

I won't answer your question directly but some suggestions:
a) does adding PACKAGE="ANTsR" to .Call change anything? (It should really be there if you are using strings as names)
b) you may want to consider use the more efficient registration - either explicit or in NAMESPACE - so in your case you could use
NAMESPACE: useDynLib(ANTsR, antsImageRead, ...)
foo.R: .Call(antsImageRead, ...)

Cheers,
Simon


> this Error occurs when the .Call is made from within the .R function
> wrapper that eases access to the C++ version of antsImageRead.
> 
> however, a direct  .Call("antsImageRead", etc. ) works as usual.
> 
> this happens for some of our functions and not others - not all are .Calls
> ...
> 
> i don't see a pattern to it.
> 
> a hack resolution that "works" is to source the .R files again within the R
> shell.
> 
> of course, this is not a satisfying solution.
> 
> finally, if anyone cares to try to reproduce this error, here is what you
> would do:
> 
> 
> If you have CMake installed, then open R 3.0 and do:
> 
> 
> install.packages(c("devtools", "Rcpp", "methods", "signal", "parallel",
>    "timeSeries", "mFilter", "MASS", "robust", "magic", "knitr",
> "pixmap", "rgl", "misc3d"))
> 
> then Clone or Pull ANTsR from this repository as follows:
> 
> $ git clone git at github.com:stnava/ANTsR.git
> 
>> From the parent directory of the new ANTsR directory, install the package
> as follows:
> 
> $ R CMD INSTALL ANTsR
> 
> 
> finally - the error can be reproduced in R 3.0 as :
> 
> library(ANTsR)
> fi<-antsImageRead( getANTsRData('r16') ,2)
> 
> any help would be appreciated -
> 
> brian
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From stnava at gmail.com  Wed Apr 10 20:25:19 2013
From: stnava at gmail.com (brian avants)
Date: Wed, 10 Apr 2013 14:25:19 -0400
Subject: [Rd] question re: error message --- package error:
 "functionName" not resolved from current namespace
In-Reply-To: <CC350C70-2837-4160-B8EF-F391188D4667@r-project.org>
References: <CABWzF4XhbD_LGy0UeVSiLd-cHbbvH9z+QTMrRQD1_PMvZv-=6w@mail.gmail.com>
	<CC350C70-2837-4160-B8EF-F391188D4667@r-project.org>
Message-ID: <CABWzF4XiwH5=U=Bx9yb4V=Cwu+K38QmEONJ0mMVcwYycdXKyjw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130410/aba5dafd/attachment.pl>

From nalimilan at club.fr  Wed Apr 10 20:43:27 2013
From: nalimilan at club.fr (Milan Bouchet-Valat)
Date: Wed, 10 Apr 2013 20:43:27 +0200
Subject: [Rd] [R] Question on Stopword Removal from a Cyrillic
 (Bulgarian)Text
In-Reply-To: <20130410111716.GA3687@scorpia>
References: <5163BEE2.4090104@gmail.com> <1365537342.2175.59.camel@milan>
	<516519CA.4020907@gmail.com> <1365582567.2175.68.camel@milan>
	<20130410111716.GA3687@scorpia>
Message-ID: <1365619407.29475.12.camel@milan>

Le mercredi 10 avril 2013 ? 13:17 +0200, Ingo Feinerer a ?crit :
> On Wed, Apr 10, 2013 at 10:29:27AM +0200, Milan Bouchet-Valat wrote:
> > Thanks for the reproducible example. Indeed, it does not work here
> > either (Linux with UTF-8 locale). The problem seems to be in the call to
> > gsub() in removeWords: the pattern "\\b" does not match anything when
> > perl=TRUE. With perl=FALSE, it works.
> 
> The \b versus perl versus UTF-8 issue seems to be known, and it is
> advised to use perl = TRUE with \b. See e.g. the warning in the gsub
> help page (?gsub):
> 
> ---8<--------------------------------------------------------------------------
> Warning:
> 
> POSIX 1003.2 mode of ?gsub? and ?gregexpr? does not work correctly with
> repeated word-boundaries (e.g. ?pattern = "\b"?).  Use ?perl = TRUE? for
> such matches (but that may not work as expected with non-ASCII inputs,
> as the meaning of ?word? is system-dependent).
> ---8<--------------------------------------------------------------------------
Thanks for the pointer. Indeed, this allowed me to discover the
existence of the PCRE_UCP (Unicode Character Properties) flag, which
changes matching behavior so that Unicode alphanumerics are not
considered as word boundaries.

This flag should probably be used by R when calling pcre_compile() in
gsub() and friends. At the moment, R's behavior is inconsistent across
platforms:
- on Fedora 18, R 2.15.3 :
gsub("\\bt\\b", "", "t?l?gramme", perl=TRUE)
[1] "?l?gramme"

- on Windows 2008, R 2.15.1 and 3.0.0 :
gsub("\\bt\\b", "", "t?l?gramme", perl=TRUE)
[1] "t?l?gramme"


Luckily, the bug can be fixed at tm's level by adding (*UCP) at the
beginning of the pattern. This works for our examples :

> gsub(sprintf("\\b(%s)\\b", "?????"), "", "?????", perl=TRUE)
[1] "?????"
> gsub(sprintf("(*UCP)\\b(%s)\\b", "?????"), "", "?????", perl=TRUE)
[1] ""

gsub("\\bt\\b", "", "t?l?gramme", perl=TRUE)
[1] "?l?gramme"
gsub("(*UCP)\\bt\\b", "", "t?l?gramme", perl=TRUE)
[1] "t?l?gramme"


Regards


From kanell17 at gmail.com  Wed Apr 10 21:13:43 2013
From: kanell17 at gmail.com (Kanell17)
Date: Wed, 10 Apr 2013 12:13:43 -0700 (PDT)
Subject: [Rd] savePlot() under Windows
In-Reply-To: <51635296.5060705@gmail.com>
References: <CANROs4f595-uM3SUm4HBfKLYU2UKXPuLkXMOoNdPTQSrEAcfrA@mail.gmail.com>
	<51635296.5060705@gmail.com>
Message-ID: <1365621223589-4663903.post@n4.nabble.com>

I am having the same problem and I don't know how to fix it. Has savePlot
been fixed? Is there something else I'm supposed to be doing?



--
View this message in context: http://r.789695.n4.nabble.com/savePlot-under-Windows-tp4663712p4663903.html
Sent from the R devel mailing list archive at Nabble.com.


From seanpor at acm.org  Wed Apr 10 16:20:21 2013
From: seanpor at acm.org (Sean O'Riordain)
Date: Wed, 10 Apr 2013 15:20:21 +0100
Subject: [Rd] Issue with Control-Z in a text file on Windows - readLines()
 appears to truncate
Message-ID: <CA+MmmTL9ssBJ-+mP_CwjKqFcJwZZ7q=pdP2F7WC2k-=Dn7MsGw@mail.gmail.com>

Working on Windows I have had to deal with CSV files that,
unfortunately, contain embedded Control-Zs, i.e. ASCII character 26 in
decimal, and the readLines() function in R on Windows (2.15.2 and
3.0.0) appears to truncate at the control-Z.  There is no problem at
all on Ubuntu Linux with R 3.0.0.

Am I mistaken or is this genuine?

# Create a small file with embedded Control-Z
h3 <- paste('1,34,44.4,"', rawToChar(as.raw(c(65, 26, 65))), '",99')
h3
#  "1,34,44.4,\" A\032A \",99"
writeLines(h3, 'h3.txt')

# now attempt to read the file back in
h3a <- readLines('h3.txt')
# but on Windows 2.15.2 and 3.0.0 I get the message
#Warning message:
#In readLines("h3.txt") : incomplete final line found on 'h3.txt'
h3a
# [1] "1,34,44.4,\" A"
# so it drops from the Control-Z onwards

####
# The following is my rough and ready workaround - I'm sure there is a
cleaner way
fnam <- 'h3.txt'
tmp.bin <- readBin(fnam, raw(), size=1, n=max(2*file.info(fnam)$size, 100))
tmp.char <- rawToChar(tmp.bin)
txt <- unlist(strsplit(tmp.char, '\r\n', fixed=TRUE))
txt
# [1] "1,34,44.4,\" A\032A \",99"

This was on 64-bit R on a 64-bit Windows 7, but it also appears to be
the case in a 32-bit R 2.15.2 on 32-bit Windows-7 inside in a
VirtualBox.

Kind regards,
Sean O'Riordain
Trinity College
Dublin


From xie at yihui.name  Wed Apr 10 21:34:41 2013
From: xie at yihui.name (Yihui Xie)
Date: Wed, 10 Apr 2013 14:34:41 -0500
Subject: [Rd] localeToCharset() returns NA for the Hong Kong locale
Message-ID: <CANROs4eVUctLb1ZUEhAbrbKjtzD1Mgk5U6C_DwBNXO7ohw-fRw@mail.gmail.com>

Hi,

When Sys.getlocale("LC_CTYPE") returns 'Chinese (Traditional)_Hong
Kong S.A.R..950' to some Hong Kong Windows users, localeToCharset()
returns NA instead of CP950 due to:

> localeToCharset
....
    if (.Platform$OS.type == "windows") {
        x <- strsplit(locale, ".", fixed = TRUE)[[1L]]
        if (length(x) != 2)
            return(NA_character_)
        switch(x[2L], `1252` = return("ISO8859-1"), `1257` =
return("ISO8859-13"))
        return(paste0("CP", x[2L]))
    }
....

Perhaps you should not assume length(x) == 2 when the locale string is
split by ., since in this case the dots in S.A.R. have a different
meaning (abbrev for Special Administrative Region). I would suggest
check if length(x) >= 2 and use the last element of x. Maybe you have
good reasons to require length(x) == 2.

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Phone: 515-294-2465 Web: http://yihui.name
Department of Statistics, Iowa State University
2215 Snedecor Hall, Ames, IA


From murdoch.duncan at gmail.com  Wed Apr 10 21:47:32 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 10 Apr 2013 15:47:32 -0400
Subject: [Rd] Issue with Control-Z in a text file on Windows -
 readLines() appears to truncate
In-Reply-To: <CA+MmmTL9ssBJ-+mP_CwjKqFcJwZZ7q=pdP2F7WC2k-=Dn7MsGw@mail.gmail.com>
References: <CA+MmmTL9ssBJ-+mP_CwjKqFcJwZZ7q=pdP2F7WC2k-=Dn7MsGw@mail.gmail.com>
Message-ID: <5165C1D4.3070900@gmail.com>

On 10/04/2013 10:20 AM, Sean O'Riordain wrote:
> Working on Windows I have had to deal with CSV files that,
> unfortunately, contain embedded Control-Zs, i.e. ASCII character 26 in
> decimal, and the readLines() function in R on Windows (2.15.2 and
> 3.0.0) appears to truncate at the control-Z.  There is no problem at
> all on Ubuntu Linux with R 3.0.0.
>
> Am I mistaken or is this genuine?

Ctrl-Z is the old text file EOF marker from MSDOS.  readLines() normally 
reads files in text mode using the Microsoft Visual C libraries, so I 
wouldn't be surprised if they respect Ctrl-Z as EOF.

A simpler workaround than the one you used is to read the file in binary 
mode, e.g.

f <- file("h3.txt", "rb")
readLines(f)
close(f)

See the ?file help topic for a discussion of the limitations this may 
impose on you.

Duncan Murdoch

>
> # Create a small file with embedded Control-Z
> h3 <- paste('1,34,44.4,"', rawToChar(as.raw(c(65, 26, 65))), '",99')
> h3
> #  "1,34,44.4,\" A\032A \",99"
> writeLines(h3, 'h3.txt')
>
> # now attempt to read the file back in
> h3a <- readLines('h3.txt')
> # but on Windows 2.15.2 and 3.0.0 I get the message
> #Warning message:
> #In readLines("h3.txt") : incomplete final line found on 'h3.txt'
> h3a
> # [1] "1,34,44.4,\" A"
> # so it drops from the Control-Z onwards
>
> ####
> # The following is my rough and ready workaround - I'm sure there is a
> cleaner way
> fnam <- 'h3.txt'
> tmp.bin <- readBin(fnam, raw(), size=1, n=max(2*file.info(fnam)$size, 100))
> tmp.char <- rawToChar(tmp.bin)
> txt <- unlist(strsplit(tmp.char, '\r\n', fixed=TRUE))
> txt
> # [1] "1,34,44.4,\" A\032A \",99"
>
> This was on 64-bit R on a 64-bit Windows 7, but it also appears to be
> the case in a 32-bit R 2.15.2 on 32-bit Windows-7 inside in a
> VirtualBox.
>
> Kind regards,
> Sean O'Riordain
> Trinity College
> Dublin
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Wed Apr 10 21:53:59 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 10 Apr 2013 15:53:59 -0400
Subject: [Rd] question re: error message --- package error:
 "functionName" not resolved from current namespace
In-Reply-To: <CABWzF4XiwH5=U=Bx9yb4V=Cwu+K38QmEONJ0mMVcwYycdXKyjw@mail.gmail.com>
References: <CABWzF4XhbD_LGy0UeVSiLd-cHbbvH9z+QTMrRQD1_PMvZv-=6w@mail.gmail.com>
	<CC350C70-2837-4160-B8EF-F391188D4667@r-project.org>
	<CABWzF4XiwH5=U=Bx9yb4V=Cwu+K38QmEONJ0mMVcwYycdXKyjw@mail.gmail.com>
Message-ID: <5165C357.2000204@gmail.com>

On 10/04/2013 2:25 PM, brian avants wrote:
> hi simon
>
> thank you for your questions ---- answers here:
>
> I won't answer your question directly but some suggestions:
> > a) does adding PACKAGE="ANTsR" to .Call change anything? (It should really
> > be there if you are using strings as names)
> >
>
> this does change things .... for instance, this works:
>
> library(ANTsR)
> filename<-getANTsRData('r16')
> .Call("antsImageRead", filename,'double',2) #  Succeeds!
> .Call("antsImageRead", filename,'double',2,PACKAGE=ANTsR) #  Fails!
> # Error in .Call("antsImageRead", filename, "double", 2, PACKAGE = "ANTsR")
> :
> #  "antsImageRead" not available for .Call() for package "ANTsR"

That makes it look as though it is finding that entry point somewhere 
other than in the ANTsR.{so|dll} file installed with the package.
>
> the problem is when we call this function:
>
> antsImageRead <- function( filename , dimension , pixeltype = "float" )
> {
>      rval <- (.Call("antsImageRead", filename, pixeltype, dimension))
>      return(rval)
> }

That's the one where you should be using the PACKAGE declaration.

>
> the we get the error   antsImageRead not resolved from current namespace ,
> e.g.:
>
> > antsImageRead(filename,2)
> Error in .Call("antsImageRead", filename, pixeltype, dimension) :
>    "antsImageRead" not resolved from current namespace (ANTsR)
> >
>
>
> b) you may want to consider use the more efficient registration - either
> > explicit or in NAMESPACE - so in your case you could use
> > NAMESPACE: useDynLib(ANTsR, antsImageRead, ...)
> > foo.R: .Call(antsImageRead, ...)
> >
>
> yes - we have all of our shared libraries registered in the NAMESPACE file
> e.g.
>
> useDynLib(libRantsImageRead)

But this doesn't register the entry point.  List it explicitly, and it 
will create an object called antsImageRead in the package namespace that 
has entry point information.

Duncan Murdoch
>
> etcetera ....
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From stnava at gmail.com  Wed Apr 10 23:35:40 2013
From: stnava at gmail.com (brian avants)
Date: Wed, 10 Apr 2013 17:35:40 -0400
Subject: [Rd] question re: error message --- package error:
 "functionName" not resolved from current namespace
In-Reply-To: <5165C357.2000204@gmail.com>
References: <CABWzF4XhbD_LGy0UeVSiLd-cHbbvH9z+QTMrRQD1_PMvZv-=6w@mail.gmail.com>
	<CC350C70-2837-4160-B8EF-F391188D4667@r-project.org>
	<CABWzF4XiwH5=U=Bx9yb4V=Cwu+K38QmEONJ0mMVcwYycdXKyjw@mail.gmail.com>
	<5165C357.2000204@gmail.com>
Message-ID: <CABWzF4Xn165QfDWvOvXj6FCmXjBSP0bGmVv8gkokTWM=7E+w_g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130410/8285025d/attachment.pl>

From murdoch.duncan at gmail.com  Thu Apr 11 00:18:06 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 10 Apr 2013 18:18:06 -0400
Subject: [Rd] question re: error message --- package error:
 "functionName" not resolved from current namespace
In-Reply-To: <CABWzF4Xn165QfDWvOvXj6FCmXjBSP0bGmVv8gkokTWM=7E+w_g@mail.gmail.com>
References: <CABWzF4XhbD_LGy0UeVSiLd-cHbbvH9z+QTMrRQD1_PMvZv-=6w@mail.gmail.com>
	<CC350C70-2837-4160-B8EF-F391188D4667@r-project.org>
	<CABWzF4XiwH5=U=Bx9yb4V=Cwu+K38QmEONJ0mMVcwYycdXKyjw@mail.gmail.com>
	<5165C357.2000204@gmail.com>
	<CABWzF4Xn165QfDWvOvXj6FCmXjBSP0bGmVv8gkokTWM=7E+w_g@mail.gmail.com>
Message-ID: <5165E51E.9020805@gmail.com>

On 13-04-10 5:35 PM, brian avants wrote:
> Thank you for the advice - the function formed like this:
>
> antsImageRead <- function( filename , dimension , pixeltype = "float" )
> {
>       rval <- (.Call("antsImageRead", filename, pixeltype, dimension))
>       return(rval)
> }
>
> worked up to R 2.15.x  but fails in R 3.0.x
>
> if i include the PACKAGE = 'whatever' , in the .Call above, as here:
>
> antsImageRead <- function( filename , dimension , pixeltype = "float" )
> {
>       rval <- (.Call("antsImageRead", filename, pixeltype, dimension,
> PACKAGE="ANTsR"))
>       return(rval)
> }
>
> then it fails in both 2.15.x and 3.0.x ....
>
> if i source the file
>
> source("ANTsR/R/antsImageRead.R")
>
> after loading the library, then it works fine in 3.0.x without the
> direct call to PACKAGE=ANTsR.
>
> anyway - i hope this clarifies things a bit -
>
> does anyone know of something that might have changed between 2.x and
> 3.x that would relate to this issue?

If you can build a Windows binary or a MacOSX binary of the package, or 
a tarball that the standard tools can install, I'll take a look.

Duncan Murdoch

>
>
>
>
>
> brian
>
>
>
>
> On Wed, Apr 10, 2013 at 3:53 PM, Duncan Murdoch
> <murdoch.duncan at gmail.com <mailto:murdoch.duncan at gmail.com>> wrote:
>
>     On 10/04/2013 2:25 PM, brian avants wrote:
>
>         hi simon
>
>         thank you for your questions ---- answers here:
>
>         I won't answer your question directly but some suggestions:
>          > a) does adding PACKAGE="ANTsR" to .Call change anything? (It
>         should really
>          > be there if you are using strings as names)
>          >
>
>         this does change things .... for instance, this works:
>
>         library(ANTsR)
>         filename<-getANTsRData('r16')
>         .Call("antsImageRead", filename,'double',2) #  Succeeds!
>         .Call("antsImageRead", filename,'double',2,PACKAGE=__ANTsR) #
>           Fails!
>         # Error in .Call("antsImageRead", filename, "double", 2, PACKAGE
>         = "ANTsR")
>         :
>         #  "antsImageRead" not available for .Call() for package "ANTsR"
>
>
>     That makes it look as though it is finding that entry point
>     somewhere other than in the ANTsR.{so|dll} file installed with the
>     package.
>
>
>         the problem is when we call this function:
>
>         antsImageRead <- function( filename , dimension , pixeltype =
>         "float" )
>         {
>               rval <- (.Call("antsImageRead", filename, pixeltype,
>         dimension))
>               return(rval)
>         }
>
>
>     That's the one where you should be using the PACKAGE declaration.
>
>
>
>         the we get the error   antsImageRead not resolved from current
>         namespace ,
>         e.g.:
>
>          > antsImageRead(filename,2)
>         Error in .Call("antsImageRead", filename, pixeltype, dimension) :
>             "antsImageRead" not resolved from current namespace (ANTsR)
>          >
>
>
>         b) you may want to consider use the more efficient registration
>         - either
>          > explicit or in NAMESPACE - so in your case you could use
>          > NAMESPACE: useDynLib(ANTsR, antsImageRead, ...)
>          > foo.R: .Call(antsImageRead, ...)
>          >
>
>         yes - we have all of our shared libraries registered in the
>         NAMESPACE file
>         e.g.
>
>         useDynLib(libRantsImageRead)
>
>
>     But this doesn't register the entry point.  List it explicitly, and
>     it will create an object called antsImageRead in the package
>     namespace that has entry point information.
>
>     Duncan Murdoch
>
>
>         etcetera ....
>
>
>                  [[alternative HTML version deleted]]
>
>         ________________________________________________
>         R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>         https://stat.ethz.ch/mailman/__listinfo/r-devel
>         <https://stat.ethz.ch/mailman/listinfo/r-devel>
>
>
>


From mtmorgan at fhcrc.org  Thu Apr 11 07:29:05 2013
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Wed, 10 Apr 2013 22:29:05 -0700
Subject: [Rd] question re: error message --- package error:
 "functionName" not resolved from current namespace
In-Reply-To: <CABWzF4Xn165QfDWvOvXj6FCmXjBSP0bGmVv8gkokTWM=7E+w_g@mail.gmail.com>
References: <CABWzF4XhbD_LGy0UeVSiLd-cHbbvH9z+QTMrRQD1_PMvZv-=6w@mail.gmail.com>
	<CC350C70-2837-4160-B8EF-F391188D4667@r-project.org>
	<CABWzF4XiwH5=U=Bx9yb4V=Cwu+K38QmEONJ0mMVcwYycdXKyjw@mail.gmail.com>
	<5165C357.2000204@gmail.com>
	<CABWzF4Xn165QfDWvOvXj6FCmXjBSP0bGmVv8gkokTWM=7E+w_g@mail.gmail.com>
Message-ID: <51664A21.8020508@fhcrc.org>

For what it's worth, the package loads many DLLs in its NAMESPACE via repeated 
calls to useDynLib. antsImageRead is not in the first DLL loaded, and from 
NEWS.Rd, the problem comes from

     o   A foreign function call (.C() etc) in a package without a PACKAGE
	argument will only look in the first DLL specified in the NAMESPACE
	file of the package rather than searching all loaded DLLs.  A few
	packages needed PACKAGE arguments added.

 From ?.Call, 'PACKAGE' is I believe meant to name the DLL (libRantsImageRead in 
this case) rather than the R package.

Some archaeology below.

Martin

On 04/10/2013 02:35 PM, brian avants wrote:
> Thank you for the advice - the function formed like this:
>
> antsImageRead <- function( filename , dimension , pixeltype = "float" )
> {
>       rval <- (.Call("antsImageRead", filename, pixeltype, dimension))
>       return(rval)
> }
>
> worked up to R 2.15.x  but fails in R 3.0.x
>
> if i include the PACKAGE = 'whatever' , in the .Call above, as here:
>
> antsImageRead <- function( filename , dimension , pixeltype = "float" )
> {
>       rval <- (.Call("antsImageRead", filename, pixeltype, dimension,
> PACKAGE="ANTsR"))
>       return(rval)
> }
>
> then it fails in both 2.15.x and 3.0.x ....

When .Call has a PACKAGE argument, or when R tries to guess the DLL from the 
fact that .Call is from within a NAMESPACE, only one DLL is found (from 
R_FindNativeSymbolFromDLL in main/dotcode.c:1331, which calls getCallingDLLe). 
the function "antsImageRead" is not in the DLL returned by getCallingDLLe, so 
not found.

 > getNativeSymbolInfo("antsImageRead")$package
DLL name: libRantsImageRead
Filename:
 
/home/mtmorgan/R/x86_64-unknown-linux-gnu-library/3.0-2.13/ANTsR/libs/libRantsImageRead.so
Dynamic lookup: TRUE

 > getCallingDLLe(getNamespace("ANTsR"))
DLL name: libRantsRegistration
Filename:
 
/home/mtmorgan/R/x86_64-unknown-linux-gnu-library/3.0-2.13/ANTsR/libs/libRantsRegistration.so
Dynamic lookup: TRUE

> if i source the file
>
> source("ANTsR/R/antsImageRead.R")
>
> after loading the library, then it works fine in 3.0.x without the direct
> call to PACKAGE=ANTsR.

from the command line, we are not in a NAMESPACE so R uses R_FindSymbol at 
dotcode.c:259; this performs a more general search and finds the appropriate symbol.

The change was somewhere around

------------------------------------------------------------------------
r60607 | ripley | 2012-09-07 10:56:35 -0700 (Fri, 07 Sep 2012) | 1 line
Changed paths:
    M /trunk/doc/NEWS.Rd
    M /trunk/src/main/dotcode.c

confine .C etc in a package to the registered DLL.


>
> anyway - i hope this clarifies things a bit -
>
> does anyone know of something that might have changed between 2.x and 3.x
> that would relate to this issue?
>
>
>
>
>
> brian
>
>
>
>
> On Wed, Apr 10, 2013 at 3:53 PM, Duncan Murdoch <murdoch.duncan at gmail.com>wrote:
>
>> On 10/04/2013 2:25 PM, brian avants wrote:
>>
>>> hi simon
>>>
>>> thank you for your questions ---- answers here:
>>>
>>> I won't answer your question directly but some suggestions:
>>>> a) does adding PACKAGE="ANTsR" to .Call change anything? (It should
>>> really
>>>> be there if you are using strings as names)
>>>>
>>>
>>> this does change things .... for instance, this works:
>>>
>>> library(ANTsR)
>>> filename<-getANTsRData('r16')
>>> .Call("antsImageRead", filename,'double',2) #  Succeeds!
>>> .Call("antsImageRead", filename,'double',2,PACKAGE=**ANTsR) #  Fails!
>>> # Error in .Call("antsImageRead", filename, "double", 2, PACKAGE =
>>> "ANTsR")
>>> :
>>> #  "antsImageRead" not available for .Call() for package "ANTsR"
>>>
>>
>> That makes it look as though it is finding that entry point somewhere
>> other than in the ANTsR.{so|dll} file installed with the package.
>>
>>
>>> the problem is when we call this function:
>>>
>>> antsImageRead <- function( filename , dimension , pixeltype = "float" )
>>> {
>>>       rval <- (.Call("antsImageRead", filename, pixeltype, dimension))
>>>       return(rval)
>>> }
>>>
>>
>> That's the one where you should be using the PACKAGE declaration.
>>
>>
>>
>>> the we get the error   antsImageRead not resolved from current namespace ,
>>> e.g.:
>>>
>>>> antsImageRead(filename,2)
>>> Error in .Call("antsImageRead", filename, pixeltype, dimension) :
>>>     "antsImageRead" not resolved from current namespace (ANTsR)
>>>>
>>>
>>>
>>> b) you may want to consider use the more efficient registration - either
>>>> explicit or in NAMESPACE - so in your case you could use
>>>> NAMESPACE: useDynLib(ANTsR, antsImageRead, ...)
>>>> foo.R: .Call(antsImageRead, ...)
>>>>
>>>
>>> yes - we have all of our shared libraries registered in the NAMESPACE file
>>> e.g.
>>>
>>> useDynLib(libRantsImageRead)
>>>
>>
>> But this doesn't register the entry point.  List it explicitly, and it
>> will create an object called antsImageRead in the package namespace that
>> has entry point information.
>>
>> Duncan Murdoch
>>
>>>
>>> etcetera ....
>>>
>>>
>>>          [[alternative HTML version deleted]]
>>>
>>> ______________________________**________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/**listinfo/r-devel<https://stat.ethz.ch/mailman/listinfo/r-devel>
>>>
>>
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From stnava at gmail.com  Thu Apr 11 10:34:18 2013
From: stnava at gmail.com (brian avants)
Date: Thu, 11 Apr 2013 04:34:18 -0400
Subject: [Rd] question re: error message --- package error:
 "functionName" not resolved from current namespace
In-Reply-To: <51664A21.8020508@fhcrc.org>
References: <CABWzF4XhbD_LGy0UeVSiLd-cHbbvH9z+QTMrRQD1_PMvZv-=6w@mail.gmail.com>
	<CC350C70-2837-4160-B8EF-F391188D4667@r-project.org>
	<CABWzF4XiwH5=U=Bx9yb4V=Cwu+K38QmEONJ0mMVcwYycdXKyjw@mail.gmail.com>
	<5165C357.2000204@gmail.com>
	<CABWzF4Xn165QfDWvOvXj6FCmXjBSP0bGmVv8gkokTWM=7E+w_g@mail.gmail.com>
	<51664A21.8020508@fhcrc.org>
Message-ID: <CABWzF4WgVPNg=ewdGbr2Qsq1FS+oCxozC=M6Y+XfXcGypotBPQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130411/fdfc01b2/attachment.pl>

From ligges at statistik.tu-dortmund.de  Thu Apr 11 10:45:23 2013
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Thu, 11 Apr 2013 10:45:23 +0200
Subject: [Rd] savePlot() under Windows
In-Reply-To: <1365621223589-4663903.post@n4.nabble.com>
References: <CANROs4f595-uM3SUm4HBfKLYU2UKXPuLkXMOoNdPTQSrEAcfrA@mail.gmail.com>
	<51635296.5060705@gmail.com>
	<1365621223589-4663903.post@n4.nabble.com>
Message-ID: <51667823.1080701@statistik.tu-dortmund.de>



On 10.04.2013 21:13, Kanell17 wrote:
> I am having the same problem and I don't know how to fix it. Has savePlot
> been fixed? Is there something else I'm supposed to be doing?


What are you referring to? Please quote!

To see if something was fixed, see the svn log or just try it out. >The 
log shows that Duncan Murdoch fixed it already 3 days ago.

Best,
Uwe Ligges





>
>
>
> --
> View this message in context: http://r.789695.n4.nabble.com/savePlot-under-Windows-tp4663712p4663903.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From Wayne.W.Jones at shell.com  Thu Apr 11 11:31:47 2013
From: Wayne.W.Jones at shell.com (Wayne.W.Jones at shell.com)
Date: Thu, 11 Apr 2013 09:31:47 +0000
Subject: [Rd] savePlot() under Windows
In-Reply-To: <51667823.1080701@statistik.tu-dortmund.de>
References: <CANROs4f595-uM3SUm4HBfKLYU2UKXPuLkXMOoNdPTQSrEAcfrA@mail.gmail.com>
	<51635296.5060705@gmail.com>	<1365621223589-4663903.post@n4.nabble.com>
	<51667823.1080701@statistik.tu-dortmund.de>
Message-ID: <823FB8AD8FD2F44A92284630A4AADF7E266E830C@seacmw-s-53401.europe.shell.com>

I've just downloaded and installed the latest version from here: http://cran.r-project.org/bin/windows/base/ and can confirm that savePlot is still broken under windows. 

> plot(1:10)
> savePlot()
Error in .External(C_savePlot, device, filename, type, restoreConsole) : 
  Incorrect number of arguments (4), expecting 3 for 'savePlot'

Thanks, 

Wayne

-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of Uwe Ligges
Sent: 11 April 2013 09:45
To: Kanell17
Cc: r-devel at r-project.org
Subject: Re: [Rd] savePlot() under Windows



On 10.04.2013 21:13, Kanell17 wrote:
> I am having the same problem and I don't know how to fix it. Has 
> savePlot been fixed? Is there something else I'm supposed to be doing?


What are you referring to? Please quote!

To see if something was fixed, see the svn log or just try it out. >The log shows that Duncan Murdoch fixed it already 3 days ago.

Best,
Uwe Ligges





>
>
>
> --
> View this message in context: 
> http://r.789695.n4.nabble.com/savePlot-under-Windows-tp4663712p4663903
> .html Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From ligges at statistik.tu-dortmund.de  Thu Apr 11 11:41:27 2013
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Thu, 11 Apr 2013 11:41:27 +0200
Subject: [Rd] savePlot() under Windows
In-Reply-To: <823FB8AD8FD2F44A92284630A4AADF7E266E830C@seacmw-s-53401.europe.shell.com>
References: <CANROs4f595-uM3SUm4HBfKLYU2UKXPuLkXMOoNdPTQSrEAcfrA@mail.gmail.com>
	<51635296.5060705@gmail.com>	<1365621223589-4663903.post@n4.nabble.com>
	<51667823.1080701@statistik.tu-dortmund.de>
	<823FB8AD8FD2F44A92284630A4AADF7E266E830C@seacmw-s-53401.europe.shell.com>
Message-ID: <51668547.5040802@statistik.tu-dortmund.de>



On 11.04.2013 11:31, Wayne.W.Jones at shell.com wrote:
> I've just downloaded and installed the latest version from here: http://cran.r-project.org/bin/windows/base/ and can confirm that savePlot is still broken under windows.
>
>> plot(1:10)
>> savePlot()
> Error in .External(C_savePlot, device, filename, type, restoreConsole) :
>    Incorrect number of arguments (4), expecting 3 for 'savePlot'


That is the latest release, i.e. the 3.0.0 release rather than 
R-patched, I guess?

http://cran.r-project.org/bin/windows/base/rpatched.html


Uwe Ligges





> Thanks,
>
> Wayne
>
> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of Uwe Ligges
> Sent: 11 April 2013 09:45
> To: Kanell17
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] savePlot() under Windows
>
>
>
> On 10.04.2013 21:13, Kanell17 wrote:
>> I am having the same problem and I don't know how to fix it. Has
>> savePlot been fixed? Is there something else I'm supposed to be doing?
>
>
> What are you referring to? Please quote!
>
> To see if something was fixed, see the svn log or just try it out. >The log shows that Duncan Murdoch fixed it already 3 days ago.
>
> Best,
> Uwe Ligges
>
>
>
>
>
>>
>>
>>
>> --
>> View this message in context:
>> http://r.789695.n4.nabble.com/savePlot-under-Windows-tp4663712p4663903
>> .html Sent from the R devel mailing list archive at Nabble.com.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From andre_mikulec at hotmail.com  Thu Apr 11 01:27:48 2013
From: andre_mikulec at hotmail.com (Andre Mikulec)
Date: Wed, 10 Apr 2013 19:27:48 -0400
Subject: [Rd] windows compile R from source,
	where do I put the Tcl directory?
Message-ID: <BLU174-W412329522E78B100BDEE869CC70@phx.gbl>

Hi,

I am trying to compile R from source on Windows.
I am following the instructions here

3.1 Building from source
3 Installing R under Windows
file:///F:/ProgramFiles/R/R-2.15.3/doc/manual/R-admin.html

It only says,?

"
The Tcl/Tk support files are contained in Rtools30.exe and?
available as .zips from http://www.stats.ox.ac.uk/pub/Rtools.?
Please make sure you install the right version: there is a 32-bit?
version and a 64-bit version.
"

Anyways,
I collected the support files from here.
http://www.stats.ox.ac.uk/pub/Rtools/R_Tcl_8-5-8.zip

The instructions do not say "where to put my Tcl folder."
So I just guessed, based on ( include, doc, and bin are parallel directories )
in F:\ProgramFiles\R\R-2.15.3\Tcl

I guessed ( and guessed wrong ) ...
M:\YDrive\All_Economics\eclipse_workspace\R-2.15.3\src\Tcl

When Try to compile with?

M:\YDrive\All_Economics\eclipse_workspace\R-2.15.3\src\gnuwin32>make all recommended

I eventually get ...

? "tcltk.h:23:17: fatal error: tcl.h: No such file or directory"

in the message

building package 'tcltk'
making init.d from init.c
making tcltk.d from tcltk.c
making tcltk_win.d from tcltk_win.c
gcc ?-I"../../../../include" -DNDEBUG -I "../../../../Tcl"/include -DWin32 ? ? ? ? -O3 -Wall -gdwarf-2 -std=gnu99 ?-c init.c -o init.o
In file included from init.c:22:0:
tcltk.h:23:17: fatal error: tcl.h: No such file or directory
compilation terminated.
make[4]: *** [init.o] Error 1
make[3]: *** [mksrc-win2] Error 1
make[2]: *** [all] Error 2
make[1]: *** [R] Error 1
make: *** [all] Error 2

Please, help.

Thank you.
Andre Mikulec
Andre_Mikulec at Hotmail.com 		 	   		  

From vinceeval at gmail.com  Wed Apr 10 22:31:10 2013
From: vinceeval at gmail.com (Ventseslav Kozarev)
Date: Wed, 10 Apr 2013 23:31:10 +0300
Subject: [Rd] [R] Question on Stopword Removal from a Cyrillic
	(Bulgarian)Text
In-Reply-To: <1365619407.29475.12.camel@milan>
References: <5163BEE2.4090104@gmail.com> <20130410111716.GA3687@scorpia>
	<1365619407.29475.12.camel@milan>
Message-ID: <5275068.qbQHoXgWlq@bigdesktop.happyfamily>

I just wanted to confirm that Milan's suggestion about adding (*UCP) like in 
the example below:

gsub(sprintf("(*UCP)\\b(%s)\\b", "?????"), "", "?????", perl=TRUE)

solved all problems (under openSuse Linux 12.3 64-bit, R 2.15.2). I reencoded 
input files and stop word list in UTF-8, and now stop words are properly 
removed using the suggested syntax:

sme.corpus<-tm_map(sme.corpus,removeWords.PlainTextDocument,stoplist)

where:
removeWords.PlainTextDocument <- function (x, words)
  gsub(sprintf("(*UCP)\\b(%s)\\b", paste(words, collapse = "|")), "", x, 
perl=TRUE)

and stoplist is a character vector of stop words.

The wordcloud function now also accept the preprocessed corpus without 
warnings or errors. Now, if only I could do stemming in Bulgarian, that would 
have been priceless!

Thanks again, this has been tremendous help indeed!
Vince


On Wednesday 10 April 2013 20:43:27 Milan Bouchet-Valat wrote:
> Le mercredi 10 avril 2013 ? 13:17 +0200, Ingo Feinerer a ?crit :
> > On Wed, Apr 10, 2013 at 10:29:27AM +0200, Milan Bouchet-Valat wrote:
> > > Thanks for the reproducible example. Indeed, it does not work here
> > > either (Linux with UTF-8 locale). The problem seems to be in the call to
> > > gsub() in removeWords: the pattern "\\b" does not match anything when
> > > perl=TRUE. With perl=FALSE, it works.
> > 
> > The \b versus perl versus UTF-8 issue seems to be known, and it is
> > advised to use perl = TRUE with \b. See e.g. the warning in the gsub
> > help page (?gsub):
> > 
> > ---8<---------------------------------------------------------------------
> > ----- Warning:
> > 
> > POSIX 1003.2 mode of ?gsub? and ?gregexpr? does not work correctly with
> > repeated word-boundaries (e.g. ?pattern = "\b"?).  Use ?perl = TRUE? for
> > such matches (but that may not work as expected with non-ASCII inputs,
> > as the meaning of ?word? is system-dependent).
> > ---8<---------------------------------------------------------------------
> > -----
> Thanks for the pointer. Indeed, this allowed me to discover the
> existence of the PCRE_UCP (Unicode Character Properties) flag, which
> changes matching behavior so that Unicode alphanumerics are not
> considered as word boundaries.
> 
> This flag should probably be used by R when calling pcre_compile() in
> gsub() and friends. At the moment, R's behavior is inconsistent across
> platforms:
> - on Fedora 18, R 2.15.3 :
> gsub("\\bt\\b", "", "t?l?gramme", perl=TRUE)
> [1] "?l?gramme"
> 
> - on Windows 2008, R 2.15.1 and 3.0.0 :
> gsub("\\bt\\b", "", "t?l?gramme", perl=TRUE)
> [1] "t?l?gramme"
> 
> 
> Luckily, the bug can be fixed at tm's level by adding (*UCP) at the
> 
> beginning of the pattern. This works for our examples :
> > gsub(sprintf("\\b(%s)\\b", "?????"), "", "?????", perl=TRUE)
> 
> [1] "?????"
> 
> > gsub(sprintf("(*UCP)\\b(%s)\\b", "?????"), "", "?????", perl=TRUE)
> 
> [1] ""
> 
> gsub("\\bt\\b", "", "t?l?gramme", perl=TRUE)
> [1] "?l?gramme"
> gsub("(*UCP)\\bt\\b", "", "t?l?gramme", perl=TRUE)
> [1] "t?l?gramme"
> 
> 
> Regards


From andre_mikulec at hotmail.com  Thu Apr 11 02:02:58 2013
From: andre_mikulec at hotmail.com (Andre Mikulec)
Date: Wed, 10 Apr 2013 20:02:58 -0400
Subject: [Rd] Trying to make DEBUG=T a debug version of R
Message-ID: <BLU174-W18E6D6CCB80C76D1B012C39CC00@phx.gbl>

Hi,

I am trying to make a debug version of R ( for use with gdb later ) on windows.

I am executing the following.

src\gnuwin32>make clean
src\gnuwin32>make DEBUG=T?

In the output, I see many

-O3 flags

I do not see any

?-g -O0 flags?

which ( I believe/I think ) that is what I need to debug R in gdb.

What is the proper way to 'make' a 'Debug version of R'?

Thank you,
Andre Mikulec
Andre_Mikulec at Hotmail.com 		 	   		  

From ripley at stats.ox.ac.uk  Thu Apr 11 13:32:02 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 11 Apr 2013 12:32:02 +0100
Subject: [Rd] windows compile R from source,
	where do I put the Tcl directory?
In-Reply-To: <BLU174-W412329522E78B100BDEE869CC70@phx.gbl>
References: <BLU174-W412329522E78B100BDEE869CC70@phx.gbl>
Message-ID: <51669F32.5030002@stats.ox.ac.uk>

On 11/04/2013 00:27, Andre Mikulec wrote:
> Hi,
>
> I am trying to compile R from source on Windows.
> I am following the instructions here
>
> 3.1 Building from source
> 3 Installing R under Windows
> file:///F:/ProgramFiles/R/R-2.15.3/doc/manual/R-admin.html
>
> It only says,
>
> "
> The Tcl/Tk support files are contained in Rtools30.exe and
> available as .zips from http://www.stats.ox.ac.uk/pub/Rtools.
> Please make sure you install the right version: there is a 32-bit
> version and a 64-bit version.
> "
>
> Anyways,
> I collected the support files from here.
> http://www.stats.ox.ac.uk/pub/Rtools/R_Tcl_8-5-8.zip
>
> The instructions do not say "where to put my Tcl folder."

Rtools30.exe does this for you.  But you put it at the top level in the 
sources.

> So I just guessed, based on ( include, doc, and bin are parallel directories )
> in F:\ProgramFiles\R\R-2.15.3\Tcl
>
> I guessed ( and guessed wrong ) ...
> M:\YDrive\All_Economics\eclipse_workspace\R-2.15.3\src\Tcl

Why in src?  It is a binary distriution.

> When Try to compile with
>
> M:\YDrive\All_Economics\eclipse_workspace\R-2.15.3\src\gnuwin32>make all recommended
>
> I eventually get ...
>
>    "tcltk.h:23:17: fatal error: tcl.h: No such file or directory"
>
> in the message
>
> building package 'tcltk'
> making init.d from init.c
> making tcltk.d from tcltk.c
> making tcltk_win.d from tcltk_win.c
> gcc  -I"../../../../include" -DNDEBUG -I "../../../../Tcl"/include -DWin32         -O3 -Wall -gdwarf-2 -std=gnu99  -c init.c -o init.o
> In file included from init.c:22:0:
> tcltk.h:23:17: fatal error: tcl.h: No such file or directory
> compilation terminated.
> make[4]: *** [init.o] Error 1
> make[3]: *** [mksrc-win2] Error 1
> make[2]: *** [all] Error 2
> make[1]: *** [R] Error 1
> make: *** [all] Error 2
>
> Please, help.
>
> Thank you.
> Andre Mikulec
> Andre_Mikulec at Hotmail.com 		 	   		
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From karl.forner at gmail.com  Thu Apr 11 13:43:23 2013
From: karl.forner at gmail.com (Karl Forner)
Date: Thu, 11 Apr 2013 13:43:23 +0200
Subject: [Rd] parallel::mclapply does not return try-error objects with
	mc.preschedule=TRUE
Message-ID: <CAMd4_AcNj7ErEe8PVON-b9MRRK8eMEbnp3goKGd49aemthrmeg@mail.gmail.com>

Hello,

Consider this:

1)
library(parallel)
res <- mclapply(1:2, stop)
#Warning message:
#In mclapply(1:2, stop) :
# all scheduled cores encountered errors in user code

is(res[[1]], 'try-error')
#[1] FALSE


2)
library(parallel)
res <- mclapply(1:2, stop, mc.preschedule=FALSE)
#Warning message:
#In mclapply(1:2, stop, mc.preschedule = FALSE) :
#  2 function calls resulted in an error

is(res[[1]], 'try-error')
#[1] TRUE

The documentation states that:
'Each forked process runs its job inside try(..., silent = TRUE) so if
errors occur they will be stored as class "try-error" objects in the
return value and a warning will be given.'


Is this a bug ?

Thanks
Karl


> sessionInfo()
R version 2.15.3 (2013-03-01)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=C                 LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] parallel  stats     graphics  grDevices utils     datasets  methods
[8] base

loaded via a namespace (and not attached):
[1] tools_2.15.3


From murdoch.duncan at gmail.com  Thu Apr 11 14:01:36 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 11 Apr 2013 08:01:36 -0400
Subject: [Rd] Trying to make DEBUG=T a debug version of R
In-Reply-To: <BLU174-W18E6D6CCB80C76D1B012C39CC00@phx.gbl>
References: <BLU174-W18E6D6CCB80C76D1B012C39CC00@phx.gbl>
Message-ID: <5166A620.3090103@gmail.com>

On 13-04-10 8:02 PM, Andre Mikulec wrote:
> Hi,
>
> I am trying to make a debug version of R ( for use with gdb later ) on windows.
>
> I am executing the following.
>
> src\gnuwin32>make clean
> src\gnuwin32>make DEBUG=T
>
> In the output, I see many
>
> -O3 flags
>
> I do not see any
>
>   -g -O0 flags
>
> which ( I believe/I think ) that is what I need to debug R in gdb.
>
> What is the proper way to 'make' a 'Debug version of R'?

You don't need -O0 to debug in gdb, you just need the -g flag set 
properly, which DEBUG=T will do for you.  That's how I generally do it.

Setting -O0 might make debugging easier (because it eliminates 
optimizations).  To do that, you'll need to change the CFLAGS setting in 
src/gnuwin32/Makefiles.  (You may also be able to do it with a CFLAGS 
environment variable, I haven't tried.)  I don't usually do this, since 
it changes the code:  if you need gdb, chances are the bug is subtle, 
and its behaviour may change with optimization level.  But you may have 
a different preference.

Duncan Murdoch


From ripley at stats.ox.ac.uk  Thu Apr 11 14:28:18 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 11 Apr 2013 13:28:18 +0100
Subject: [Rd] Trying to make DEBUG=T a debug version of R
In-Reply-To: <5166A620.3090103@gmail.com>
References: <BLU174-W18E6D6CCB80C76D1B012C39CC00@phx.gbl>
	<5166A620.3090103@gmail.com>
Message-ID: <5166AC62.20200@stats.ox.ac.uk>

On 11/04/2013 13:01, Duncan Murdoch wrote:
> On 13-04-10 8:02 PM, Andre Mikulec wrote:
>> Hi,
>>
>> I am trying to make a debug version of R ( for use with gdb later ) on
>> windows.
>>
>> I am executing the following.
>>
>> src\gnuwin32>make clean
>> src\gnuwin32>make DEBUG=T
>>
>> In the output, I see many
>>
>> -O3 flags
>>
>> I do not see any
>>
>>   -g -O0 flags
>>
>> which ( I believe/I think ) that is what I need to debug R in gdb.
>>
>> What is the proper way to 'make' a 'Debug version of R'?
>
> You don't need -O0 to debug in gdb, you just need the -g flag set
> properly, which DEBUG=T will do for you.  That's how I generally do it.

As Duncan says 'set properly'.  Things have changed and are changing 
currently in the gcc/gdb world, so I prefer to be explicit and use 
-gdwarf-2 (which is what DEBUG=T inserts currently).  (At one point that 
was essential, and might be again soon as dwarf-4 is the default in gcc 
4.8.x -- possibly not on Windows, which has other quite fundamental 
changes to exception handling under 4.8.x.)

> Setting -O0 might make debugging easier (because it eliminates
> optimizations).  To do that, you'll need to change the CFLAGS setting in
> src/gnuwin32/Makefiles.  (You may also be able to do it with a CFLAGS
> environment variable, I haven't tried.)  I don't usually do this, since
> it changes the code:  if you need gdb, chances are the bug is subtle,
> and its behaviour may change with optimization level.  But you may have
> a different preference.
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From P.Antczak at liverpool.ac.uk  Thu Apr 11 13:41:57 2013
From: P.Antczak at liverpool.ac.uk (Antczak, Philipp)
Date: Thu, 11 Apr 2013 11:41:57 +0000
Subject: [Rd] La_svd compiler error
Message-ID: <1342FE910E6BB04082C687DADF6CB32910C8C5FF@BHEXMBX1.livad.liv.ac.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130411/a48a9baa/attachment.pl>

From murdoch.duncan at gmail.com  Fri Apr 12 13:13:22 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 12 Apr 2013 07:13:22 -0400
Subject: [Rd] La_svd compiler error
In-Reply-To: <1342FE910E6BB04082C687DADF6CB32910C8C5FF@BHEXMBX1.livad.liv.ac.uk>
References: <1342FE910E6BB04082C687DADF6CB32910C8C5FF@BHEXMBX1.livad.liv.ac.uk>
Message-ID: <5167EC52.6020402@gmail.com>

On 13-04-11 7:41 AM, Antczak, Philipp wrote:
> Dear All,
>
> I have been trying to compile a package for windows that we have written. Since R version 3.0.0 the package doesn't compile any more. (On Linux the package compiles without errors).
> The error specifically says:
>
> gcc -m32 -I"C:/PROGRA~1/R/R-30~1.0/include" -DNDEBUG     -I"d:/RCompile/CRANpkg/extralibs64/local/include"     -O3 -Wall  -std=gnu99 -mtune=core2 -c galgoDistance.c -o galgoDistance.o
> gcc -m32 -I"C:/PROGRA~1/R/R-30~1.0/include" -DNDEBUG     -I"d:/RCompile/CRANpkg/extralibs64/local/include"     -O3 -Wall  -std=gnu99 -mtune=core2 -c galgo_fitnesses.c -o galgo_fitnesses.o
> gcc -m32 -shared -s -static-libgcc -o galgo.dll tmp.def galgoDistance.o galgo_fitnesses.o -LC:/PROGRA~1/R/R-30~1.0/bin/i386 -lRlapack -LC:/PROGRA~1/R/R-30~1.0/bin/i386 -lRblas -lgfortran -Ld:/RCompile/CRANpkg/extralibs64/local/lib/i386 -Ld:/RCompile/CRANpkg/extralibs64/local/lib -LC:/PROGRA~1/R/R-30~1.0/bin/i386 -lR
> galgo_fitnesses.o:galgo_fitnesses.c:(.text+0xda1): undefined reference to `La_svd'
> collect2: ld returned 1 exit status
>
> specifically from the error I understand that error occurs in the link to La_svd which is defined in the first couple of lines in the code:
>
> #include <math.h>
> #include <R.h>
> #include <Rinternals.h>
> #include <Rmath.h>
>
> SEXP La_svd(SEXP jobu, SEXP jobv, SEXP x, SEXP s, SEXP u, SEXP v, SEXP method);
>

You reported this as a bug, and were told what to do to try to fix it. 
Did that work?

Duncan Murdoch


From mdsumner at gmail.com  Fri Apr 12 13:27:58 2013
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 12 Apr 2013 21:27:58 +1000
Subject: [Rd] support for POSIXct classes in image.default axes
Message-ID: <CAAcGz9-aTEH-hfwbE53r1tchdxCYdNHT7qmcvrJLPSoyrv99aQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130412/8943a5b2/attachment.pl>

From ripley at stats.ox.ac.uk  Fri Apr 12 18:23:14 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 12 Apr 2013 17:23:14 +0100
Subject: [Rd] La_svd compiler error
In-Reply-To: <5167EC52.6020402@gmail.com>
References: <1342FE910E6BB04082C687DADF6CB32910C8C5FF@BHEXMBX1.livad.liv.ac.uk>
	<5167EC52.6020402@gmail.com>
Message-ID: <516834F2.9010201@stats.ox.ac.uk>

On 12/04/2013 12:13, Duncan Murdoch wrote:
> On 13-04-11 7:41 AM, Antczak, Philipp wrote:
>> Dear All,
>>
>> I have been trying to compile a package for windows that we have
>> written. Since R version 3.0.0 the package doesn't compile any more.
>> (On Linux the package compiles without errors).
>> The error specifically says:
>>
>> gcc -m32 -I"C:/PROGRA~1/R/R-30~1.0/include" -DNDEBUG
>> -I"d:/RCompile/CRANpkg/extralibs64/local/include"     -O3 -Wall
>> -std=gnu99 -mtune=core2 -c galgoDistance.c -o galgoDistance.o
>> gcc -m32 -I"C:/PROGRA~1/R/R-30~1.0/include" -DNDEBUG
>> -I"d:/RCompile/CRANpkg/extralibs64/local/include"     -O3 -Wall
>> -std=gnu99 -mtune=core2 -c galgo_fitnesses.c -o galgo_fitnesses.o
>> gcc -m32 -shared -s -static-libgcc -o galgo.dll tmp.def
>> galgoDistance.o galgo_fitnesses.o -LC:/PROGRA~1/R/R-30~1.0/bin/i386
>> -lRlapack -LC:/PROGRA~1/R/R-30~1.0/bin/i386 -lRblas -lgfortran
>> -Ld:/RCompile/CRANpkg/extralibs64/local/lib/i386
>> -Ld:/RCompile/CRANpkg/extralibs64/local/lib
>> -LC:/PROGRA~1/R/R-30~1.0/bin/i386 -lR
>> galgo_fitnesses.o:galgo_fitnesses.c:(.text+0xda1): undefined reference
>> to `La_svd'
>> collect2: ld returned 1 exit status
>>
>> specifically from the error I understand that error occurs in the link
>> to La_svd which is defined in the first couple of lines in the code:
>>
>> #include <math.h>
>> #include <R.h>
>> #include <Rinternals.h>
>> #include <Rmath.h>
>>
>> SEXP La_svd(SEXP jobu, SEXP jobv, SEXP x, SEXP s, SEXP u, SEXP v, SEXP
>> method);
>>
>
> You reported this as a bug, and were told what to do to try to fix it.
> Did that work?

Unlikely.  La_svd is not an entry point anywhere in R 3.0.0.
The package may compile on Linux, but that allows unsatisfied entry 
points.  See 'Writing R Extensions'.

There was a non-API entry point of that name in 2.15.x, but that's not 
current.

>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Fri Apr 12 18:33:30 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 12 Apr 2013 17:33:30 +0100
Subject: [Rd] La_svd compiler error
In-Reply-To: <1486514A-7776-4960-927A-A2F284B6E547@liv.ac.uk>
References: <1342FE910E6BB04082C687DADF6CB32910C8C5FF@BHEXMBX1.livad.liv.ac.uk>
	<5167EC52.6020402@gmail.com>, <516834F2.9010201@stats.ox.ac.uk>
	<1486514A-7776-4960-927A-A2F284B6E547@liv.ac.uk>
Message-ID: <5168375A.1090402@stats.ox.ac.uk>

On 12/04/2013 17:28, Antczak, Philipp wrote:
>>From the sounds of it, it doesn't bode well for me compiling this package for windows then?

For any platform, if you want it to actually work.


> Phil
>
> On 12 Apr 2013, at 17:23, "Prof Brian Ripley" <ripley at stats.ox.ac.uk> wrote:
>
>> On 12/04/2013 12:13, Duncan Murdoch wrote:
>>> On 13-04-11 7:41 AM, Antczak, Philipp wrote:
>>>> Dear All,
>>>>
>>>> I have been trying to compile a package for windows that we have
>>>> written. Since R version 3.0.0 the package doesn't compile any more.
>>>> (On Linux the package compiles without errors).
>>>> The error specifically says:
>>>>
>>>> gcc -m32 -I"C:/PROGRA~1/R/R-30~1.0/include" -DNDEBUG
>>>> -I"d:/RCompile/CRANpkg/extralibs64/local/include"     -O3 -Wall
>>>> -std=gnu99 -mtune=core2 -c galgoDistance.c -o galgoDistance.o
>>>> gcc -m32 -I"C:/PROGRA~1/R/R-30~1.0/include" -DNDEBUG
>>>> -I"d:/RCompile/CRANpkg/extralibs64/local/include"     -O3 -Wall
>>>> -std=gnu99 -mtune=core2 -c galgo_fitnesses.c -o galgo_fitnesses.o
>>>> gcc -m32 -shared -s -static-libgcc -o galgo.dll tmp.def
>>>> galgoDistance.o galgo_fitnesses.o -LC:/PROGRA~1/R/R-30~1.0/bin/i386
>>>> -lRlapack -LC:/PROGRA~1/R/R-30~1.0/bin/i386 -lRblas -lgfortran
>>>> -Ld:/RCompile/CRANpkg/extralibs64/local/lib/i386
>>>> -Ld:/RCompile/CRANpkg/extralibs64/local/lib
>>>> -LC:/PROGRA~1/R/R-30~1.0/bin/i386 -lR
>>>> galgo_fitnesses.o:galgo_fitnesses.c:(.text+0xda1): undefined reference
>>>> to `La_svd'
>>>> collect2: ld returned 1 exit status
>>>>
>>>> specifically from the error I understand that error occurs in the link
>>>> to La_svd which is defined in the first couple of lines in the code:
>>>>
>>>> #include <math.h>
>>>> #include <R.h>
>>>> #include <Rinternals.h>
>>>> #include <Rmath.h>
>>>>
>>>> SEXP La_svd(SEXP jobu, SEXP jobv, SEXP x, SEXP s, SEXP u, SEXP v, SEXP
>>>> method);
>>>>
>>>
>>> You reported this as a bug, and were told what to do to try to fix it.
>>> Did that work?
>>
>> Unlikely.  La_svd is not an entry point anywhere in R 3.0.0.
>> The package may compile on Linux, but that allows unsatisfied entry points.  See 'Writing R Extensions'.
>>
>> There was a non-API entry point of that name in 2.15.x, but that's not current.
>>
>>>
>>> Duncan Murdoch
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From P.Antczak at liverpool.ac.uk  Fri Apr 12 13:21:51 2013
From: P.Antczak at liverpool.ac.uk (Antczak, Philipp)
Date: Fri, 12 Apr 2013 11:21:51 +0000
Subject: [Rd] La_svd compiler error
In-Reply-To: <5167EC52.6020402@gmail.com>
References: <1342FE910E6BB04082C687DADF6CB32910C8C5FF@BHEXMBX1.livad.liv.ac.uk>
	<5167EC52.6020402@gmail.com>
Message-ID: <1342FE910E6BB04082C687DADF6CB32910C8CD5E@BHEXMBX1.livad.liv.ac.uk>

I did include the Makevars in the src directory with the following line: 
PKG_LIBS = $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)

But this had no effect at all - still failed at La_svd
As I said in Linux no problem at all - only in windows.

Thanks
Phil

-----Original Message-----
From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com] 
Sent: 12 April 2013 12:13
To: Antczak, Philipp
Cc: 'r-devel at R-project.org'
Subject: Re: [Rd] La_svd compiler error

On 13-04-11 7:41 AM, Antczak, Philipp wrote:
> Dear All,
>
> I have been trying to compile a package for windows that we have written. Since R version 3.0.0 the package doesn't compile any more. (On Linux the package compiles without errors).
> The error specifically says:
>
> gcc -m32 -I"C:/PROGRA~1/R/R-30~1.0/include" -DNDEBUG     -I"d:/RCompile/CRANpkg/extralibs64/local/include"     -O3 -Wall  -std=gnu99 -mtune=core2 -c galgoDistance.c -o galgoDistance.o
> gcc -m32 -I"C:/PROGRA~1/R/R-30~1.0/include" -DNDEBUG     -I"d:/RCompile/CRANpkg/extralibs64/local/include"     -O3 -Wall  -std=gnu99 -mtune=core2 -c galgo_fitnesses.c -o galgo_fitnesses.o
> gcc -m32 -shared -s -static-libgcc -o galgo.dll tmp.def galgoDistance.o galgo_fitnesses.o -LC:/PROGRA~1/R/R-30~1.0/bin/i386 -lRlapack -LC:/PROGRA~1/R/R-30~1.0/bin/i386 -lRblas -lgfortran -Ld:/RCompile/CRANpkg/extralibs64/local/lib/i386 -Ld:/RCompile/CRANpkg/extralibs64/local/lib -LC:/PROGRA~1/R/R-30~1.0/bin/i386 -lR
> galgo_fitnesses.o:galgo_fitnesses.c:(.text+0xda1): undefined reference to `La_svd'
> collect2: ld returned 1 exit status
>
> specifically from the error I understand that error occurs in the link to La_svd which is defined in the first couple of lines in the code:
>
> #include <math.h>
> #include <R.h>
> #include <Rinternals.h>
> #include <Rmath.h>
>
> SEXP La_svd(SEXP jobu, SEXP jobv, SEXP x, SEXP s, SEXP u, SEXP v, SEXP method);
>

You reported this as a bug, and were told what to do to try to fix it. 
Did that work?

Duncan Murdoch


From P.Antczak at liverpool.ac.uk  Fri Apr 12 18:28:52 2013
From: P.Antczak at liverpool.ac.uk (Antczak, Philipp)
Date: Fri, 12 Apr 2013 16:28:52 +0000
Subject: [Rd] La_svd compiler error
In-Reply-To: <516834F2.9010201@stats.ox.ac.uk>
References: <1342FE910E6BB04082C687DADF6CB32910C8C5FF@BHEXMBX1.livad.liv.ac.uk>
	<5167EC52.6020402@gmail.com>,<516834F2.9010201@stats.ox.ac.uk>
Message-ID: <1486514A-7776-4960-927A-A2F284B6E547@liv.ac.uk>

>From the sounds of it, it doesn't bode well for me compiling this package for windows then?

Phil

On 12 Apr 2013, at 17:23, "Prof Brian Ripley" <ripley at stats.ox.ac.uk> wrote:

> On 12/04/2013 12:13, Duncan Murdoch wrote:
>> On 13-04-11 7:41 AM, Antczak, Philipp wrote:
>>> Dear All,
>>> 
>>> I have been trying to compile a package for windows that we have
>>> written. Since R version 3.0.0 the package doesn't compile any more.
>>> (On Linux the package compiles without errors).
>>> The error specifically says:
>>> 
>>> gcc -m32 -I"C:/PROGRA~1/R/R-30~1.0/include" -DNDEBUG
>>> -I"d:/RCompile/CRANpkg/extralibs64/local/include"     -O3 -Wall
>>> -std=gnu99 -mtune=core2 -c galgoDistance.c -o galgoDistance.o
>>> gcc -m32 -I"C:/PROGRA~1/R/R-30~1.0/include" -DNDEBUG
>>> -I"d:/RCompile/CRANpkg/extralibs64/local/include"     -O3 -Wall
>>> -std=gnu99 -mtune=core2 -c galgo_fitnesses.c -o galgo_fitnesses.o
>>> gcc -m32 -shared -s -static-libgcc -o galgo.dll tmp.def
>>> galgoDistance.o galgo_fitnesses.o -LC:/PROGRA~1/R/R-30~1.0/bin/i386
>>> -lRlapack -LC:/PROGRA~1/R/R-30~1.0/bin/i386 -lRblas -lgfortran
>>> -Ld:/RCompile/CRANpkg/extralibs64/local/lib/i386
>>> -Ld:/RCompile/CRANpkg/extralibs64/local/lib
>>> -LC:/PROGRA~1/R/R-30~1.0/bin/i386 -lR
>>> galgo_fitnesses.o:galgo_fitnesses.c:(.text+0xda1): undefined reference
>>> to `La_svd'
>>> collect2: ld returned 1 exit status
>>> 
>>> specifically from the error I understand that error occurs in the link
>>> to La_svd which is defined in the first couple of lines in the code:
>>> 
>>> #include <math.h>
>>> #include <R.h>
>>> #include <Rinternals.h>
>>> #include <Rmath.h>
>>> 
>>> SEXP La_svd(SEXP jobu, SEXP jobv, SEXP x, SEXP s, SEXP u, SEXP v, SEXP
>>> method);
>>> 
>> 
>> You reported this as a bug, and were told what to do to try to fix it.
>> Did that work?
> 
> Unlikely.  La_svd is not an entry point anywhere in R 3.0.0.
> The package may compile on Linux, but that allows unsatisfied entry points.  See 'Writing R Extensions'.
> 
> There was a non-API entry point of that name in 2.15.x, but that's not current.
> 
>> 
>> Duncan Murdoch
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From dtenenba at fhcrc.org  Fri Apr 12 23:34:24 2013
From: dtenenba at fhcrc.org (Dan Tenenbaum)
Date: Fri, 12 Apr 2013 14:34:24 -0700
Subject: [Rd] "Failed to locate the 'texi2pdf' output file"
Message-ID: <CAF42j22B=DNoMVfURMtL=TV1fGd0yh=pXAhTg3AoR2svOk9Pvw@mail.gmail.com>

Hi,
Every day a few Bioconductor packages (different ones each day) fail
to build, on Windows only, with an error like this:

D:\biocbld\bbs-2.13-bioc\meat>D:\biocbld\bbs-2.13-bioc\R\bin\R.exe CMD
build --keep-empty-dirs --no-resave-data OrganismDbi
[...]
Error in find_vignette_product(name, by = "texi2pdf", engine = engine) :
  Failed to locate the 'texi2pdf' output file (by engine
'utils::Sweave') for vignette with name 'OrganismDbi'. The following
files exists in directory '.': 'OrganismDbi.Rnw', 'OrganismDbi.tex',
'databaseTypes.pdf'
Calls: <Anonymous> -> find_vignette_product
Execution halted

This is puzzling to me because I would have thought that
'OrganismDbi.tex' was the file it was looking for, yet it says that
file exists.

These build errors are transient...if I re-run the build, the error
does not recur. So I was hesitant to report the problem because can't
be reproduced consistently. Nevertheless it is a problem.

> sessionInfo()
R version 3.0.0 (2013-04-03)
Platform: i386-w64-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

Thanks,
Dan


From kasperdanielhansen at gmail.com  Sat Apr 13 00:53:50 2013
From: kasperdanielhansen at gmail.com (Kasper Daniel Hansen)
Date: Fri, 12 Apr 2013 18:53:50 -0400
Subject: [Rd] "Failed to locate the 'texi2pdf' output file"
In-Reply-To: <CAF42j22B=DNoMVfURMtL=TV1fGd0yh=pXAhTg3AoR2svOk9Pvw@mail.gmail.com>
References: <CAF42j22B=DNoMVfURMtL=TV1fGd0yh=pXAhTg3AoR2svOk9Pvw@mail.gmail.com>
Message-ID: <CAC2h7uuWUbZJU_kz=6YrsWd6BRXJtarn_XM3nKur1EKE1rBBzw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130412/88b705fa/attachment.pl>

From hb at biostat.ucsf.edu  Sat Apr 13 01:23:11 2013
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Fri, 12 Apr 2013 16:23:11 -0700
Subject: [Rd] "Failed to locate the 'texi2pdf' output file"
In-Reply-To: <CAC2h7uuWUbZJU_kz=6YrsWd6BRXJtarn_XM3nKur1EKE1rBBzw@mail.gmail.com>
References: <CAF42j22B=DNoMVfURMtL=TV1fGd0yh=pXAhTg3AoR2svOk9Pvw@mail.gmail.com>
	<CAC2h7uuWUbZJU_kz=6YrsWd6BRXJtarn_XM3nKur1EKE1rBBzw@mail.gmail.com>
Message-ID: <CAFDcVCQ7RZgNjodqE_T4D0sVTzC4FH5ay6t4j+7BF7nXwOkMvg@mail.gmail.com>

On Fri, Apr 12, 2013 at 3:53 PM, Kasper Daniel Hansen
<kasperdanielhansen at gmail.com> wrote:
> Dan,
>
> This error looks _very_ similar to what I reported regarding the use of
> 'foreach' inside a windows vignette, on the bioc-devel email list.  As you
> say, it looks funny that it lists the tex file, yet fails to find it.

It's not looking for the TeX file, but the PDF file - that is what the
error message is referring to by "Failed to locate the 'texi2pdf'
output file".  [ Note that in this error message I use the term
"vignette" in a conceptual sense, not necessarily the vignette
*source* file (here *.Rnw) - maybe that is what is confusing. ]
Immediately after calling tools::texi2pdf("OrganismDbi.tex"), the code
tries to locate the texi2pdf output file, that is, 'OrganismDbi.pdf',
which it cannot find.  This indicates that tools::texi2pdf() gave an
error (an error message which is currently not reported/available),
which in turn indicates that the 'OrganismDbi.tex' file is
corrupt/incomplete.

>
> The issue had to do with closing relevant connections (for foreach, this
> was a Windows issue because the default foreach backend on Windows uses
> connections).   For my particular case, solving it was a bit difficult
> because I could not just close all connections since a vignette is being
> run inside sink().
>
> The package name makes me suspect a database connection. As a starting
> point I suggest closing all existing connections in the vignette.

I think it's worth looking into what Kasper says - that's hopefully the reason.

/Henrik

PS. I do find it odd that these issues starting to occur now, because
most of the vignette framework is performing the same steps as in R (<
3.0.0).  The main difference is see is that it now validates/asserts
that the expected output file is there *immediately* after trying to
generate them (using weave, tangle, and texi2pdf).  If for some reason
texi2pdf generates the PDF in a background process which is not
completed in full when returning the control to R, then the PDF is not
there and you would get this error.  I don't know if this can happen.
The reason why I came to think of this is because I recall that I've
seen this behavior when using bitmap() and Ghostscript to create PNGs.
 Just a shot from the hip, though.

>
> Kasper
>
>
>
> On Fri, Apr 12, 2013 at 5:34 PM, Dan Tenenbaum <dtenenba at fhcrc.org> wrote:
>
>> Hi,
>> Every day a few Bioconductor packages (different ones each day) fail
>> to build, on Windows only, with an error like this:
>>
>> D:\biocbld\bbs-2.13-bioc\meat>D:\biocbld\bbs-2.13-bioc\R\bin\R.exe CMD
>> build --keep-empty-dirs --no-resave-data OrganismDbi
>> [...]
>> Error in find_vignette_product(name, by = "texi2pdf", engine = engine) :
>>   Failed to locate the 'texi2pdf' output file (by engine
>> 'utils::Sweave') for vignette with name 'OrganismDbi'. The following
>> files exists in directory '.': 'OrganismDbi.Rnw', 'OrganismDbi.tex',
>> 'databaseTypes.pdf'
>> Calls: <Anonymous> -> find_vignette_product
>> Execution halted
>>
>> This is puzzling to me because I would have thought that
>> 'OrganismDbi.tex' was the file it was looking for, yet it says that
>> file exists.
>>
>> These build errors are transient...if I re-run the build, the error
>> does not recur. So I was hesitant to report the problem because can't
>> be reproduced consistently. Nevertheless it is a problem.
>>
>> > sessionInfo()
>> R version 3.0.0 (2013-04-03)
>> Platform: i386-w64-mingw32/i386 (32-bit)
>>
>> locale:
>> [1] LC_COLLATE=English_United States.1252
>> [2] LC_CTYPE=English_United States.1252
>> [3] LC_MONETARY=English_United States.1252
>> [4] LC_NUMERIC=C
>> [5] LC_TIME=English_United States.1252
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> Thanks,
>> Dan
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Sat Apr 13 13:10:30 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 13 Apr 2013 07:10:30 -0400
Subject: [Rd] "Failed to locate the 'texi2pdf' output file"
In-Reply-To: <CAFDcVCQ7RZgNjodqE_T4D0sVTzC4FH5ay6t4j+7BF7nXwOkMvg@mail.gmail.com>
References: <CAF42j22B=DNoMVfURMtL=TV1fGd0yh=pXAhTg3AoR2svOk9Pvw@mail.gmail.com>
	<CAC2h7uuWUbZJU_kz=6YrsWd6BRXJtarn_XM3nKur1EKE1rBBzw@mail.gmail.com>
	<CAFDcVCQ7RZgNjodqE_T4D0sVTzC4FH5ay6t4j+7BF7nXwOkMvg@mail.gmail.com>
Message-ID: <51693D26.9010102@gmail.com>

On 13-04-12 7:23 PM, Henrik Bengtsson wrote:
> On Fri, Apr 12, 2013 at 3:53 PM, Kasper Daniel Hansen
> <kasperdanielhansen at gmail.com> wrote:
>> Dan,
>>
>> This error looks _very_ similar to what I reported regarding the use of
>> 'foreach' inside a windows vignette, on the bioc-devel email list.  As you
>> say, it looks funny that it lists the tex file, yet fails to find it.
>
> It's not looking for the TeX file, but the PDF file - that is what the
> error message is referring to by "Failed to locate the 'texi2pdf'
> output file".  [ Note that in this error message I use the term
> "vignette" in a conceptual sense, not necessarily the vignette
> *source* file (here *.Rnw) - maybe that is what is confusing. ]
> Immediately after calling tools::texi2pdf("OrganismDbi.tex"), the code
> tries to locate the texi2pdf output file, that is, 'OrganismDbi.pdf',
> which it cannot find.  This indicates that tools::texi2pdf() gave an
> error (an error message which is currently not reported/available),
> which in turn indicates that the 'OrganismDbi.tex' file is
> corrupt/incomplete.
>
>>
>> The issue had to do with closing relevant connections (for foreach, this
>> was a Windows issue because the default foreach backend on Windows uses
>> connections).   For my particular case, solving it was a bit difficult
>> because I could not just close all connections since a vignette is being
>> run inside sink().
>>
>> The package name makes me suspect a database connection. As a starting
>> point I suggest closing all existing connections in the vignette.
>
> I think it's worth looking into what Kasper says - that's hopefully the reason.
>
> /Henrik
>
> PS. I do find it odd that these issues starting to occur now, because
> most of the vignette framework is performing the same steps as in R (<
> 3.0.0).  The main difference is see is that it now validates/asserts
> that the expected output file is there *immediately* after trying to
> generate them (using weave, tangle, and texi2pdf).  If for some reason
> texi2pdf generates the PDF in a background process which is not
> completed in full when returning the control to R, then the PDF is not
> there and you would get this error.  I don't know if this can happen.
> The reason why I came to think of this is because I recall that I've
> seen this behavior when using bitmap() and Ghostscript to create PNGs.
>   Just a shot from the hip, though.

I haven't seen this lately, but some time ago we heard of problems 
caused by antivirus scanners.  They put exclusive locks on newly created 
executable files during checking and so the file wasn't immediately 
available.  I imagine they would scan a .pdf, but I don't know if this 
is the issue here.

Duncan Murdoch


>>
>> Kasper
>>
>>
>>
>> On Fri, Apr 12, 2013 at 5:34 PM, Dan Tenenbaum <dtenenba at fhcrc.org> wrote:
>>
>>> Hi,
>>> Every day a few Bioconductor packages (different ones each day) fail
>>> to build, on Windows only, with an error like this:
>>>
>>> D:\biocbld\bbs-2.13-bioc\meat>D:\biocbld\bbs-2.13-bioc\R\bin\R.exe CMD
>>> build --keep-empty-dirs --no-resave-data OrganismDbi
>>> [...]
>>> Error in find_vignette_product(name, by = "texi2pdf", engine = engine) :
>>>    Failed to locate the 'texi2pdf' output file (by engine
>>> 'utils::Sweave') for vignette with name 'OrganismDbi'. The following
>>> files exists in directory '.': 'OrganismDbi.Rnw', 'OrganismDbi.tex',
>>> 'databaseTypes.pdf'
>>> Calls: <Anonymous> -> find_vignette_product
>>> Execution halted
>>>
>>> This is puzzling to me because I would have thought that
>>> 'OrganismDbi.tex' was the file it was looking for, yet it says that
>>> file exists.
>>>
>>> These build errors are transient...if I re-run the build, the error
>>> does not recur. So I was hesitant to report the problem because can't
>>> be reproduced consistently. Nevertheless it is a problem.
>>>
>>>> sessionInfo()
>>> R version 3.0.0 (2013-04-03)
>>> Platform: i386-w64-mingw32/i386 (32-bit)
>>>
>>> locale:
>>> [1] LC_COLLATE=English_United States.1252
>>> [2] LC_CTYPE=English_United States.1252
>>> [3] LC_MONETARY=English_United States.1252
>>> [4] LC_NUMERIC=C
>>> [5] LC_TIME=English_United States.1252
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>
>>> Thanks,
>>> Dan
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>          [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From andre_mikulec at hotmail.com  Sun Apr 14 04:03:48 2013
From: andre_mikulec at hotmail.com (Andre Mikulec)
Date: Sat, 13 Apr 2013 22:03:48 -0400
Subject: [Rd]  windows compile R from source,
 where do I put the Tcl directory?
Message-ID: <BLU174-W12DA3C8A330A301117BE3B9CC30@phx.gbl>

>>Prof Brian Ripley ripley at stats.ox.ac.uk?
>>Thu Apr 11 13:32:02 CEST 2013
>>Previous message: [Rd] windows compile R from source, ?where do I put the Tcl directory?
>>Next message: [Rd] Trying to make DEBUG=T a debug version of R
>>Messages sorted by: [ date ] [ thread ] [ subject ] [ author ]
>>On 11/04/2013 00:27, Andre Mikulec wrote:
>>> Hi,
>>>
>>> I am trying to compile R from source on Windows.
>>> I am following the instructions here
>>>
>>> 3.1 Building from source
>>> 3 Installing R under Windows
>>> file:///F:/ProgramFiles/R/R-2.15.3/doc/manual/R-admin.html
>>>
>>> It only says,
>>>
>>> "
>>> The Tcl/Tk support files are contained in Rtools30.exe and
>>> available as .zips from http://www.stats.ox.ac.uk/pub/Rtools.
>>> Please make sure you install the right version: there is a 32-bit
>>> version and a 64-bit version.
>>> "
>>>
>>> Anyways,
>>> I collected the support files from here.
>>> http://www.stats.ox.ac.uk/pub/Rtools/R_Tcl_8-5-8.zip
>>>
>>> The instructions do not say "where to put my Tcl folder."
>>
>>Rtools30.exe does this for you. ?But you put it at the top level in the?
>>sources.
>>
>>> So I just guessed, based on ( include, doc, and bin are parallel directories )
>>> in F:\ProgramFiles\R\R-2.15.3\Tcl
>>>
>>> I guessed ( and guessed wrong ) ...
>>> M:\YDrive\All_Economics\eclipse_workspace\R-2.15.3\src\Tcl
>>
>>Why in src? ?It is a binary distriution.
>>
>>> When Try to compile with
>>>
>>> M:\YDrive\All_Economics\eclipse_workspace\R-2.15.3\src\gnuwin32>make all recommended
>>>
>>> I eventually get ...
>>>
>>> ? ?"tcltk.h:23:17: fatal error: tcl.h: No such file or directory"
>>>
>>> in the message
>>>
>>> building package 'tcltk'
>>> making init.d from init.c
>>> making tcltk.d from tcltk.c
>>> making tcltk_win.d from tcltk_win.c
>>> gcc ?-I"../../../../include" -DNDEBUG -I "../../../../Tcl"/include -DWin32 ? ? ? ? -O3 -Wall -gdwarf-2 -std=gnu99 ?-c init.c -o init.o
>>> In file included from init.c:22:0:
>>> tcltk.h:23:17: fatal error: tcl.h: No such file or directory
>>> compilation terminated.
>>> make[4]: *** [init.o] Error 1
>>> make[3]: *** [mksrc-win2] Error 1
>>> make[2]: *** [all] Error 2
>>> make[1]: *** [R] Error 1
>>> make: *** [all] Error 2
>>>
>>> Please, help.
>>>
>>> Thank you.
>>> Andre Mikulec
>>> Andre_Mikulec at Hotmail.com ? ? ? ? ? ? ??
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>>--?
>>Brian D. Ripley, ? ? ? ? ? ? ? ? ?ripley at stats.ox.ac.uk
>>Professor of Applied Statistics, ?http://www.stats.ox.ac.uk/~ripley/
>>University of Oxford, ? ? ? ? ? ? Tel: ?+44 1865 272861 (self)
>>1 South Parks Road, ? ? ? ? ? ? ? ? ? ? +44 1865 272866 (PA)
>>Oxford OX1 3TG, UK ? ? ? ? ? ? ? ?Fax: ?+44 1865 272595


"Why in src? ?It is a binary distriution."

Yes, I have the binary distribution ( but it is not found in RTools )

"
Rtools30.exe does this for you. ?But you put it at the top level in the?
sources.
"
Maybe I do not know where the 'top level' is located.

Please, help.

I used "tree /f" and search for?
"tk" and "tcl" files in my

F:\RTools folder

This is only what I have found

tk
--
msstkppg.h
libatkctrs.a
libsoftkbd.a

tcl
---
batclass.h
certcli.h
napenforcementclient.h
portcls.h
libcertcli.a
libeventcls.a
libstclient.a

( no tlc.h and no tk.h files are found )

Here is a "tree" of the directory structure
( If the 'tcl and tk' binaries were once there, they are not there now. )

Note, the RTools GUI installer has a leak in the installation.
In the middle of the installation it spills out my PATH onto?
the GUI install form. ?I can not see any more words or checkboxes or options.

I only have the realistic option to press Finish?
and end the installation there.

Anyways,
Here is a tree of my F:\RTools folder

F:\Rtools>tree

F:.
????bin
????gcc-4.6.3
? ? ????bin
? ? ????bin32
? ? ????bin64
? ? ????i686-w64-mingw32
? ? ? ? ????bin
? ? ? ? ????include
? ? ? ? ? ? ????ddk
? ? ? ? ? ? ????gdiplus
? ? ? ? ? ? ????GL
? ? ? ? ? ? ????psdk_inc
? ? ? ? ? ? ????sdks
? ? ? ? ? ? ????sec_api
? ? ? ? ? ? ? ? ????sys
? ? ? ? ? ? ????sys
? ? ? ? ????lib
? ? ? ? ? ? ????ldscripts
? ? ? ? ????lib64
? ? ????include
? ? ? ? ????c++
? ? ? ? ? ? ????4.6.3
? ? ? ? ? ? ? ? ????backward
? ? ? ? ? ? ? ? ????bits
? ? ? ? ? ? ? ? ????debug
? ? ? ? ? ? ? ? ????decimal
? ? ? ? ? ? ? ? ????ext
? ? ? ? ? ? ? ? ? ? ????pb_ds
? ? ? ? ? ? ? ? ? ? ? ? ????detail
? ? ? ? ? ? ? ? ? ? ? ? ? ? ????basic_tree_policy
? ? ? ? ? ? ? ? ? ? ? ? ? ? FILES
? ? ? ? ? ? ? ? ? ? ? ? ? ? ????trie_policy
? ? ? ? ? ? ? ? ? ? ? ? ? ? ????unordered_iterator
? ? ? ? ? ? ? ? ????i686-w64-mingw32
? ? ? ? ? ? ? ? ? ? ????64
? ? ? ? ? ? ? ? ? ? ? ? ????bits
? ? ? ? ? ? ? ? ? ? ????bits
? ? ? ? ? ? ? ? ????parallel
? ? ? ? ? ? ? ? ????profile
? ? ? ? ? ? ? ? ? ? ????impl
? ? ? ? ? ? ? ? ????tr1
? ? ????lib
? ? ? ? ????gcc
? ? ? ? ? ? ????i686-w64-mingw32
? ? ? ? ? ? ? ? ????4.6.3
? ? ? ? ? ? ? ? ? ? ????64
? ? ? ? ? ? ? ? ? ? ????include
? ? ? ? ? ? ? ? ? ? ? ? ????ssp
? ? ? ? ? ? ? ? ? ? ????include-fixed
? ? ? ? ? ? ? ? ? ? ????install-tools
? ? ? ? ? ? ? ? ? ? ? ? ????include
? ? ????lib64
? ? ????libexec
? ? ? ? ????gcc
? ? ? ? ? ? ????i686-w64-mingw32
? ? ? ? ? ? ? ? ????4.6.3
? ? ? ? ? ? ? ? ? ? ????install-tools
? ? ????share
? ? ? ? ????gdb
? ? ? ? ? ? ????syscalls

F:\Rtools>

No "tcl"and no "tk" folders are found.


What I did do, is download the R_Tcl_8-5-8 files and put them here.

eclipse_workspace\Tcl

A "tree" of the directory shows the following
Below

dlls are here
-------------
eclipse_workspace\Tcl\bin

h files are here
-----------------
eclipse_workspace\Tcl\include

( These include: tcl.h and tk.h - What I need )

M:\YDrive\All_Economics\eclipse_workspace\Tcl>tree

M:.
????bin ?( DLLs ARE FOUND HERE?
????doc
????include ( HEADERS (.h) ARE FOUND HERE )
? ? ????X11
????lib
? ? ????BWidget
? ? ? ? ????BWman
? ? ? ? ????demo
? ? ? ? ????images
? ? ? ? ????lang
? ? ? ? ????tests
? ? ????dde1.3
? ? ????reg1.2
? ? ????tcl8
? ? ? ? ????8.2
? ? ? ? ????8.3
? ? ? ? ????8.4
? ? ? ? ? ? ????platform
? ? ? ? ????8.5
? ? ????tcl8.5
? ? ? ? ????encoding
? ? ? ? ????http1.0
? ? ? ? ????msgs
? ? ? ? ????opt0.4
? ? ? ? ????tzdata
? ? ? ? ? ? ????Africa
? ? ? ? ? ? CONTRIES
? ? ? ? ? ? ????US
? ? ????tk8.5
? ? ? ? ????msgs
? ? ? ? ????ttk
? ? ????Tktable

M:\YDrive\All_Economics\eclipse_workspace\Tcl>


Now, my R_HOME is the following.
My tcl location is the following.

They are in parallel directories.

? eclipse_workspace\ _____ Tcl

My R_HOME is the following location parallel location

? eclipse_workspace\ _____ R\R-2.15.3.BUILD.DEBUG

My build location is the following.

? eclipse_workspace\ ?____ R \R-2.15.3.BUILD.DEBUG\src\gnuwin32>make all

The comiler is looking for the headers here

? ?"../../../../Tcl"/include

I am counting?

? "going back 4 directores" ? ? ? ? ? ? ? ../../../../
? ? "going forwared to the Tcl directory' Tcl
? ? ? "going forward to the include dir ? Tcl/include

This seems to be right.
But I am still at the wrong location.

My error is the following.

building package 'tcltk'
making init.d from init.c
making tcltk.d from tcltk.c
making tcltk_win.d from tcltk_win.c
gcc ?-I"../../../../include" -DNDEBUG -I "../../../../Tcl"/include -DWin32 ?
? -O3 -Wall ?-std=gnu99 ?-c init.c -o init.o
In file included from init.c:22:0:
tcltk.h:23:17: fatal error: tcl.h: No such file or directory
compilation terminated.
make[4]: *** [init.o] Error 1
make[3]: *** [mksrc-win2] Error 1
make[2]: *** [all] Error 2
make[1]: *** [R] Error 1
make: *** [all] Error 2

My question is the following.

Where is the correct place to place the Tcl folder
so that that the process ( that is run from 'make all' )
?can find the tcl.h file. ?Thus, and I do not get
the error?

Please help.

Thank you,
Andre Mikulec
Andre_Mikulec at Hotmail.com 		 	   		  

From andre_mikulec at hotmail.com  Sun Apr 14 04:14:45 2013
From: andre_mikulec at hotmail.com (Andre Mikulec)
Date: Sat, 13 Apr 2013 22:14:45 -0400
Subject: [Rd]  Trying to make DEBUG=T a debug version of R
Message-ID: <BLU174-W20F5E6D998C2193F0E43CB9CC30@phx.gbl>

>>Duncan Murdoch murdoch.duncan at gmail.com?
>>Thu Apr 11 14:01:36 CEST 2013
>>Previous message: [Rd] Trying to make DEBUG=T a debug version of R
>>Next message: [Rd] Trying to make DEBUG=T a debug version of R
>>Messages sorted by: [ date ] [ thread ] [ subject ] [ author ]
>>On 13-04-10 8:02 PM, Andre Mikulec wrote:
>>> Hi,
>>>
>>> I am trying to make a debug version of R ( for use with gdb later ) on windows.
>>>
>>> I am executing the following.
>>>
>>> src\gnuwin32>make clean
>>> src\gnuwin32>make DEBUG=T
>>>
>>> In the output, I see many
>>>
>>> -O3 flags
>>>
>>> I do not see any
>>>
>>> ? -g -O0 flags
>>>
>>> which ( I believe/I think ) that is what I need to debug R in gdb.
>>>
>>> What is the proper way to 'make' a 'Debug version of R'?
>>
>>You don't need -O0 to debug in gdb, you just need the -g flag set?
>>properly, which DEBUG=T will do for you. ?That's how I generally do it.
>>
>>Setting -O0 might make debugging easier (because it eliminates?
>>optimizations). ?To do that, you'll need to change the CFLAGS setting in?
>>src/gnuwin32/Makefiles. ?(You may also be able to do it with a CFLAGS?
>>environment variable, I haven't tried.) ?I don't usually do this, since?
>>it changes the code: ?if you need gdb, chances are the bug is subtle,?
>>and its behaviour may change with optimization level. ?But you may have?
>>a different preference.
>>
>>Duncan Murdoch
>>
>>Previous message: [Rd] Trying to make DEBUG=T a debug version of R
>>Next message: [Rd] Trying to make DEBUG=T a debug version of R
>>Messages sorted by: [ date ] [ thread ] [ subject ] [ author ]
>>More information about the R-devel mailing list

I am still having trouble, ( on Windows )

> Setting -O0 might make debugging easier (because it eliminates
> optimizations). To do that, you'll need to change the CFLAGS setting in ? ?
> src/gnuwin32/Makefiles.?
>
> Duncan Murdoch

I tried that. Changing the CFLAGS setting works early in the compile process.
But later in the compile process when trying to compile
the packages 'base' and 'stats' the optimization revert back to '-O3'

(You may also be able to do it with a CFLAGS
> environment variable,?
>
> Duncan Murdoch

I tried setting th environment variable

set CFLAGS=-O0

This did not work.
I tried both on the commandline followed by typing
?
? make all

and the "System Properties" dialog.
Followed by opening a new command line and typing

? make all

I tried several things

In the Windows compiling and linking with the gnu tools,

the following hacks seem to work ( early in the compiling process ) but not later.

Of the C99FLAGS lines, ?at their ?ends, I just added " -ggdb"

src\gnuwin32\MkRules.rules

? C99FLAG=-std=gnu99 -ggdb

src\gnuwin32\MkRules.local

? C99FLAG=-std=gnu99 -ggdb

In one place I just changed the optimization level.

src\gnuwin32\Makefile

? CFLAGS=-O0 -Wall -pedantic $(EOPTS)
? FFLAGS=-O0 $(EOPTS)

But again, these only work in the early stages of compiling.
Eventually, when I start compiling "base"

-ggdb disappers and -O0 optimization goes back to -O3

Does anyone have any ideas?

Thank you,
Andre Mikulec
Andre_Mikulec at Hotmail.com 		 	   		  

From andre_mikulec at hotmail.com  Sun Apr 14 05:17:22 2013
From: andre_mikulec at hotmail.com (Andre Mikulec)
Date: Sat, 13 Apr 2013 23:17:22 -0400
Subject: [Rd] Compile R with a BLAS.dll and LAPACK.dll on windows?
Message-ID: <BLU174-W33B36F658B9D06853BEFAB9CC30@phx.gbl>

Hi,

I want to install my own windows BLAS.dll and LAPACK.dll
within a compilation of R.

I am following the instructions here.

file:///F:/ProgramFiles/R/R-2.15.3/doc/manual/R-admin.html#Shared-BLAS

If I had linux or a Mac OS, I understand that this is what I would need to run.

configure --with-blas="-L/path/to/BLAS/libs -lblas" --with-lapack="-L/path/to/LAPACK/libs -llapack"

I have my own compiled DLLs already ( I compiled them myself). ?

But I have windows. I can't SEEM to run configure?

Is there some other way?

How could I compile my own BLAS.dll and LAPACK.dll into Windows?

Thank you,
Andre Mikulec
Andre_Mikulec at Hotmail.com 		 	   		  

From renaud at mancala.cbio.uct.ac.za  Sun Apr 14 13:10:54 2013
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Sun, 14 Apr 2013 14:10:54 +0300
Subject: [Rd] Empty package skeleton
Message-ID: <CAHavPHFpYHbCvvfki741fug+Ez_m5-b_z+OSUTY5HKoMD7m_Sw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130414/ae0e992a/attachment.pl>

From murdoch.duncan at gmail.com  Sun Apr 14 13:14:28 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sun, 14 Apr 2013 07:14:28 -0400
Subject: [Rd] windows compile R from source,
	where do I put the Tcl directory?
In-Reply-To: <BLU174-W12DA3C8A330A301117BE3B9CC30@phx.gbl>
References: <BLU174-W12DA3C8A330A301117BE3B9CC30@phx.gbl>
Message-ID: <516A8F94.1040807@gmail.com>

On 13-04-13 10:03 PM, Andre Mikulec wrote:
>>> Prof Brian Ripley ripley at stats.ox.ac.uk
>>> Thu Apr 11 13:32:02 CEST 2013
>>> Previous message: [Rd] windows compile R from source,  where do I put the Tcl directory?
>>> Next message: [Rd] Trying to make DEBUG=T a debug version of R
>>> Messages sorted by: [ date ] [ thread ] [ subject ] [ author ]
>>> On 11/04/2013 00:27, Andre Mikulec wrote:
>>>> Hi,
>>>>
>>>> I am trying to compile R from source on Windows.
>>>> I am following the instructions here
>>>>
>>>> 3.1 Building from source
>>>> 3 Installing R under Windows
>>>> file:///F:/ProgramFiles/R/R-2.15.3/doc/manual/R-admin.html
>>>>
>>>> It only says,
>>>>
>>>> "
>>>> The Tcl/Tk support files are contained in Rtools30.exe and
>>>> available as .zips from http://www.stats.ox.ac.uk/pub/Rtools.
>>>> Please make sure you install the right version: there is a 32-bit
>>>> version and a 64-bit version.
>>>> "
>>>>
>>>> Anyways,
>>>> I collected the support files from here.
>>>> http://www.stats.ox.ac.uk/pub/Rtools/R_Tcl_8-5-8.zip
>>>>
>>>> The instructions do not say "where to put my Tcl folder."
>>>
>>> Rtools30.exe does this for you.  But you put it at the top level in the
>>> sources.
>>>
>>>> So I just guessed, based on ( include, doc, and bin are parallel directories )
>>>> in F:\ProgramFiles\R\R-2.15.3\Tcl
>>>>
>>>> I guessed ( and guessed wrong ) ...
>>>> M:\YDrive\All_Economics\eclipse_workspace\R-2.15.3\src\Tcl
>>>
>>> Why in src?  It is a binary distriution.
>>>
>>>> When Try to compile with
>>>>
>>>> M:\YDrive\All_Economics\eclipse_workspace\R-2.15.3\src\gnuwin32>make all recommended
>>>>
>>>> I eventually get ...
>>>>
>>>>     "tcltk.h:23:17: fatal error: tcl.h: No such file or directory"
>>>>
>>>> in the message
>>>>
>>>> building package 'tcltk'
>>>> making init.d from init.c
>>>> making tcltk.d from tcltk.c
>>>> making tcltk_win.d from tcltk_win.c
>>>> gcc  -I"../../../../include" -DNDEBUG -I "../../../../Tcl"/include -DWin32         -O3 -Wall -gdwarf-2 -std=gnu99  -c init.c -o init.o
>>>> In file included from init.c:22:0:
>>>> tcltk.h:23:17: fatal error: tcl.h: No such file or directory
>>>> compilation terminated.
>>>> make[4]: *** [init.o] Error 1
>>>> make[3]: *** [mksrc-win2] Error 1
>>>> make[2]: *** [all] Error 2
>>>> make[1]: *** [R] Error 1
>>>> make: *** [all] Error 2
>>>>
>>>> Please, help.
>>>>
>>>> Thank you.
>>>> Andre Mikulec
>>>> Andre_Mikulec at Hotmail.com
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>>
>>> --
>>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>>> University of Oxford,             Tel:  +44 1865 272861 (self)
>>> 1 South Parks Road,                     +44 1865 272866 (PA)
>>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
>
> "Why in src?  It is a binary distriution."
>
> Yes, I have the binary distribution ( but it is not found in RTools )
>
> "
> Rtools30.exe does this for you.  But you put it at the top level in the
> sources.
> "
> Maybe I do not know where the 'top level' is located.
>
> Please, help.
>
> I used "tree /f" and search for
> "tk" and "tcl" files in my
>
> F:\RTools folder

The Tcl/Tk files are in Rtools.exe, and are installed to the top level 
of the R directory tree, unless you chose (when running Rtools.exe) not 
to install them.  They are not installed to the Rtools directory tree.

Duncan Murdoch

>
> This is only what I have found
>
> tk
> --
> msstkppg.h
> libatkctrs.a
> libsoftkbd.a
>
> tcl
> ---
> batclass.h
> certcli.h
> napenforcementclient.h
> portcls.h
> libcertcli.a
> libeventcls.a
> libstclient.a
>
> ( no tlc.h and no tk.h files are found )
>
> Here is a "tree" of the directory structure
> ( If the 'tcl and tk' binaries were once there, they are not there now. )
>
> Note, the RTools GUI installer has a leak in the installation.
> In the middle of the installation it spills out my PATH onto
> the GUI install form.  I can not see any more words or checkboxes or options.
>
> I only have the realistic option to press Finish
> and end the installation there.
>
> Anyways,
> Here is a tree of my F:\RTools folder
>
> F:\Rtools>tree
>
> F:.
> ????bin
> ????gcc-4.6.3
>      ????bin
>      ????bin32
>      ????bin64
>      ????i686-w64-mingw32
>      ?   ????bin
>      ?   ????include
>      ?   ?   ????ddk
>      ?   ?   ????gdiplus
>      ?   ?   ????GL
>      ?   ?   ????psdk_inc
>      ?   ?   ????sdks
>      ?   ?   ????sec_api
>      ?   ?   ?   ????sys
>      ?   ?   ????sys
>      ?   ????lib
>      ?   ?   ????ldscripts
>      ?   ????lib64
>      ????include
>      ?   ????c++
>      ?       ????4.6.3
>      ?           ????backward
>      ?           ????bits
>      ?           ????debug
>      ?           ????decimal
>      ?           ????ext
>      ?           ?   ????pb_ds
>      ?           ?       ????detail
>      ?           ?           ????basic_tree_policy
>                              FILES
>      ?           ?           ????trie_policy
>      ?           ?           ????unordered_iterator
>      ?           ????i686-w64-mingw32
>      ?           ?   ????64
>      ?           ?   ?   ????bits
>      ?           ?   ????bits
>      ?           ????parallel
>      ?           ????profile
>      ?           ?   ????impl
>      ?           ????tr1
>      ????lib
>      ?   ????gcc
>      ?       ????i686-w64-mingw32
>      ?           ????4.6.3
>      ?               ????64
>      ?               ????include
>      ?               ?   ????ssp
>      ?               ????include-fixed
>      ?               ????install-tools
>      ?                   ????include
>      ????lib64
>      ????libexec
>      ?   ????gcc
>      ?       ????i686-w64-mingw32
>      ?           ????4.6.3
>      ?               ????install-tools
>      ????share
>          ????gdb
>              ????syscalls
>
> F:\Rtools>
>
> No "tcl"and no "tk" folders are found.
>
>
> What I did do, is download the R_Tcl_8-5-8 files and put them here.
>
> eclipse_workspace\Tcl
>
> A "tree" of the directory shows the following
> Below
>
> dlls are here
> -------------
> eclipse_workspace\Tcl\bin
>
> h files are here
> -----------------
> eclipse_workspace\Tcl\include
>
> ( These include: tcl.h and tk.h - What I need )
>
> M:\YDrive\All_Economics\eclipse_workspace\Tcl>tree
>
> M:.
> ????bin  ( DLLs ARE FOUND HERE
> ????doc
> ????include ( HEADERS (.h) ARE FOUND HERE )
> ?   ????X11
> ????lib
>      ????BWidget
>      ?   ????BWman
>      ?   ????demo
>      ?   ????images
>      ?   ????lang
>      ?   ????tests
>      ????dde1.3
>      ????reg1.2
>      ????tcl8
>      ?   ????8.2
>      ?   ????8.3
>      ?   ????8.4
>      ?   ?   ????platform
>      ?   ????8.5
>      ????tcl8.5
>      ?   ????encoding
>      ?   ????http1.0
>      ?   ????msgs
>      ?   ????opt0.4
>      ?   ????tzdata
>      ?       ????Africa
>              CONTRIES
>      ?       ????US
>      ????tk8.5
>      ?   ????msgs
>      ?   ????ttk
>      ????Tktable
>
> M:\YDrive\All_Economics\eclipse_workspace\Tcl>
>
>
> Now, my R_HOME is the following.
> My tcl location is the following.
>
> They are in parallel directories.
>
>    eclipse_workspace\ _____ Tcl
>
> My R_HOME is the following location parallel location
>
>    eclipse_workspace\ _____ R\R-2.15.3.BUILD.DEBUG
>
> My build location is the following.
>
>    eclipse_workspace\  ____ R \R-2.15.3.BUILD.DEBUG\src\gnuwin32>make all
>
> The comiler is looking for the headers here
>
>     "../../../../Tcl"/include
>
> I am counting
>
>    "going back 4 directores"               ../../../../
>      "going forwared to the Tcl directory' Tcl
>        "going forward to the include dir   Tcl/include
>
> This seems to be right.
> But I am still at the wrong location.
>
> My error is the following.
>
> building package 'tcltk'
> making init.d from init.c
> making tcltk.d from tcltk.c
> making tcltk_win.d from tcltk_win.c
> gcc  -I"../../../../include" -DNDEBUG -I "../../../../Tcl"/include -DWin32
>    -O3 -Wall  -std=gnu99  -c init.c -o init.o
> In file included from init.c:22:0:
> tcltk.h:23:17: fatal error: tcl.h: No such file or directory
> compilation terminated.
> make[4]: *** [init.o] Error 1
> make[3]: *** [mksrc-win2] Error 1
> make[2]: *** [all] Error 2
> make[1]: *** [R] Error 1
> make: *** [all] Error 2
>
> My question is the following.
>
> Where is the correct place to place the Tcl folder
> so that that the process ( that is run from 'make all' )
>   can find the tcl.h file.  Thus, and I do not get
> the error?
>
> Please help.
>
> Thank you,
> Andre Mikulec
> Andre_Mikulec at Hotmail.com 		 	   		
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From edd at debian.org  Sun Apr 14 13:51:38 2013
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sun, 14 Apr 2013 06:51:38 -0500
Subject: [Rd] Empty package skeleton
In-Reply-To: <CAHavPHFpYHbCvvfki741fug+Ez_m5-b_z+OSUTY5HKoMD7m_Sw@mail.gmail.com>
References: <CAHavPHFpYHbCvvfki741fug+Ez_m5-b_z+OSUTY5HKoMD7m_Sw@mail.gmail.com>
Message-ID: <20842.38986.112629.16896@max.nulle.part>


On 14 April 2013 at 14:10, Renaud Gaujoux wrote:
| Hi,
| 
| I know this has been reported/asked before (
| http://tolstoy.newcastle.edu.au/R/e15/devel/11/10/0831.html) but it would
| still be just nice to have a fix for the not user-friendly fact that one
| cannot create a completely empty package skeleton (see previous post for a
| suggested patch).
| 
| In the same vein, I would add to the original suggestion from Herve Pages
| that it would be nice to have a quick way to create an empty package
| skeleton, skipping all objects possibly defined in .GlobalEnv, e.g.
| "package.skeleton('pkg', NA)", although I believe Herve's patch would
| automatically allow/handle a call like "package.skeleton('pkg',
| character())".
| 
| Conclusion, nothing urgent, which could be done in 1min spare time, but
| could save 1min to many friendly future package developers :)

I am also willing to help here as I do not like the fact that the generated
Rd file itself is broken.  A hint from R Core that clean patches would be
taken would be welcomed...

[ And I often call package.skeleton() from a fresh session, that is pretty
close to creating an empty package. ]

Dirk 

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From renaud at mancala.cbio.uct.ac.za  Sun Apr 14 14:07:54 2013
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Sun, 14 Apr 2013 15:07:54 +0300
Subject: [Rd] Empty package skeleton
In-Reply-To: <20842.38986.112629.16896@max.nulle.part>
References: <CAHavPHFpYHbCvvfki741fug+Ez_m5-b_z+OSUTY5HKoMD7m_Sw@mail.gmail.com>
	<20842.38986.112629.16896@max.nulle.part>
Message-ID: <CAHavPHFiqEgdVwYU=9Ei0=Evtok-xmML8Ge5p_YOQwTLsME=pA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130414/6b1293a6/attachment.pl>

From maechler at stat.math.ethz.ch  Sun Apr 14 21:11:38 2013
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sun, 14 Apr 2013 21:11:38 +0200
Subject: [Rd] Empty package skeleton
In-Reply-To: <20842.38986.112629.16896@max.nulle.part>
References: <CAHavPHFpYHbCvvfki741fug+Ez_m5-b_z+OSUTY5HKoMD7m_Sw@mail.gmail.com>
	<20842.38986.112629.16896@max.nulle.part>
Message-ID: <20842.65386.921669.587522@stat.math.ethz.ch>

>>>>> Dirk Eddelbuettel <edd at debian.org>
>>>>>     on Sun, 14 Apr 2013 06:51:38 -0500 writes:

    > On 14 April 2013 at 14:10, Renaud Gaujoux wrote:
    > | Hi,
    > | 
    > | I know this has been reported/asked before (
    > | http://tolstoy.newcastle.edu.au/R/e15/devel/11/10/0831.html) but it would
    > | still be just nice to have a fix for the not user-friendly fact that one
    > | cannot create a completely empty package skeleton (see previous post for a
    > | suggested patch).
    > | 
    > | In the same vein, I would add to the original suggestion from Herve Pages
    > | that it would be nice to have a quick way to create an empty package
    > | skeleton, skipping all objects possibly defined in .GlobalEnv, e.g.
    > | "package.skeleton('pkg', NA)", although I believe Herve's patch would
    > | automatically allow/handle a call like "package.skeleton('pkg',
    > | character())".
    > | 
    > | Conclusion, nothing urgent, which could be done in 1min spare time, but
    > | could save 1min to many friendly future package developers :)

    > I am also willing to help here as I do not like the fact that the generated
    > Rd file itself is broken.  A hint from R Core that clean patches would be
    > taken would be welcomed...

yes,  such patches to package.skeleton   would be welcomed.

I think we had never thought to make package.skeleton() into a
basic, fully-logic, high-standard, ..da-da-da..,.... R function
but rather as a simple way to get beginning package writers
started.
But I have found (in teaching) as well the need for more
"logical" behavior of package.skeleton().

Martin

    > [ And I often call package.skeleton() from a fresh session, that is pretty
    > close to creating an empty package. ]

    > Dirk 

    > -- 
    > Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com

    > ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel


From jfox at mcmaster.ca  Sun Apr 14 23:17:41 2013
From: jfox at mcmaster.ca (John Fox)
Date: Sun, 14 Apr 2013 17:17:41 -0400
Subject: [Rd] package file permissions problem R 3.0.0/Windows OS
Message-ID: <002201ce3955$7ff88580$7fe99080$@mcmaster.ca>

Dear list members,

I'm experiencing a file permissions problem with a package built under
Windows with R 3.0.0. I've encountered the problem on two Windows computers,
one running Windows 7 and the other Windows 8, and both when I build the
package under RStudio or directly in a Windows console via "R CMD build". 

In particular, the cleanup file for the package, which as I understand it
should have permissions set at rwx-r-r, instead has permissions rw-rw-rw.
I've attached two .png screen shots showing how the permissions are set when
the package is built under R 2.5.2 and R 3.0.0. 

I think that my two Windows systems are reasonably vanilla. Here are the
system and session info from R 3.0.0 run from a Windows console:

> Sys.info()
                     sysname                      release
                   "Windows"                      "7 x64"
                     version                     nodename
"build 7601, Service Pack 1"              "JOHN-DELL-XPS"
                     machine                        login
                       "x86"                       "User"
                        user               effective_user
                      "User"                       "User"

> sessionInfo()
R version 3.0.0 (2013-04-03)
Platform: i386-w64-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

I have the latest Rtools30 installed and on my path:

> Sys.which("tar.exe")
                   tar.exe
"c:\\Rtools\\bin\\tar.exe"

Is this a general problem or is it possible that there's something about my
Windows configurations that's causing it?

Any information would be appreciated.

John

-----------------------------------------------
John Fox
Senator McMaster Professor of Social Statistics
Department of Sociology
McMaster University
Hamilton, Ontario, Canada


-------------- next part --------------
A non-text attachment was scrubbed...
Name: permissions-R-3.0.0.png
Type: image/png
Size: 18571 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130414/ad8d50b7/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: permissions-R-2.5.2.png
Type: image/png
Size: 21694 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130414/ad8d50b7/attachment-0001.png>

From timhesterberg at gmail.com  Mon Apr 15 00:22:00 2013
From: timhesterberg at gmail.com (Tim Hesterberg)
Date: Sun, 14 Apr 2013 15:22:00 -0700
Subject: [Rd] R 3.0.0 memory use
Message-ID: <yajfa9p03g8n.fsf@gmail.com>

I did some benchmarking of data frame code, and
it appears that R 3.0.0 is far worse than earlier versions of R
in terms of how many large objects it allocates space for,
for data frame operations - creation, subscripting, subscript replacement.
For a data frame with n rows, it makes either 2 or 4 extra copies of
all of:
        8n bytes (e.g. double precision)
        24n bytes
        32n bytes
E.g., for as.data.frame(numeric vector), instead of allocations
totalling ~8n bytes, it allocates 33 times that much.

Here, compare columns 3 and 5
(columns 2 and 4 are with the dataframe package).

# Summary
#                               R-2.14.2        R-2.15.3        R-3.0.0
#                               w/o     with    w/o     with    w/o
#       as.data.frame(y)        3       1       1       1       5;4;4
#       data.frame(y)           7       3       4       2       6;2;2
#       data.frame(y, z)        7 each  3 each  4       2       8;4;4
#       as.data.frame(l)        8       3       5       2       9;4;4
#       data.frame(l)           13      5       8       3       12;4;4
#       d$z <- z                3,2     1,1     3,1     2,1     7;4;4,1
#       d[["z"]] <- z           4,3     1,1     3,1     2,1     7;4;4,1
#       d[, "z"] <- z           6,4,2   2,2,1   4,2,2   3,2,1   8;4;4,2,2
#       d["z"] <- z             6,5,2   2,2,1   4,2,2   3,2,1   8;4;4,2,2
#       d["z"] <- list(z=z)     6,3,2   2,2,1   4,2,2   3,2,1   8;4;4,2,2
#       d["z"] <- Z #list(z=z)  6,2,2   2,1,1   4,1,2   3,1,1   8;4;4,1,2
#       a <- d["y"]             2       1       2       1       6;4;4
#       a <- d[, "y", drop=F]   2       1       2       1       6;4;4

# Where two numbers are given, they refer to:
#   (copies of the old data frame),
#   (copies of the new column)
# A third number refers to numbers of
#   (copies made of an integer vector of row names)

# For R 3.0.0, I'm getting astounding results - many more copies,
# and also some copies of larger objects; in addition to the data
# vectors of size 80K and 160K, also 240K and 320K.
# Where three numbers are given in form a;c;d, they refer to
#   (copies of 80K; 240K; 320K)

The benchmarks are at
http://www.timhesterberg.net/r-packages/memory.R

I'm using versions of R I installed from source on a Linux box, using e.g.
./configure --prefix=(my path) --enable-memory-profiling --with-readline=no
make
make install


From luke-tierney at uiowa.edu  Mon Apr 15 04:11:31 2013
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Sun, 14 Apr 2013 21:11:31 -0500
Subject: [Rd] R 3.0.0 memory use
In-Reply-To: <yajfa9p03g8n.fsf@gmail.com>
References: <yajfa9p03g8n.fsf@gmail.com>
Message-ID: <alpine.OSX.2.02.1304142106460.26466@lukes-macbook-air.local>

There were a couple of bug fixes to somewhat obscure compound
assignment related bugs that required bumping up internal reference
counts. It's possible that one or more of these are responsible. If so
it is unavoidable for now, but it's worth finding out for sure. With
some stripped down test examples it should be possible to identify
when things changed. I won't have time to look for some time, but if
someone else wanted to nail this down that would be useful.

Best,

luke

On Sun, 14 Apr 2013, Tim Hesterberg wrote:

> I did some benchmarking of data frame code, and
> it appears that R 3.0.0 is far worse than earlier versions of R
> in terms of how many large objects it allocates space for,
> for data frame operations - creation, subscripting, subscript replacement.
> For a data frame with n rows, it makes either 2 or 4 extra copies of
> all of:
>        8n bytes (e.g. double precision)
>        24n bytes
>        32n bytes
> E.g., for as.data.frame(numeric vector), instead of allocations
> totalling ~8n bytes, it allocates 33 times that much.
>
> Here, compare columns 3 and 5
> (columns 2 and 4 are with the dataframe package).
>
> # Summary
> #                               R-2.14.2        R-2.15.3        R-3.0.0
> #                               w/o     with    w/o     with    w/o
> #       as.data.frame(y)        3       1       1       1       5;4;4
> #       data.frame(y)           7       3       4       2       6;2;2
> #       data.frame(y, z)        7 each  3 each  4       2       8;4;4
> #       as.data.frame(l)        8       3       5       2       9;4;4
> #       data.frame(l)           13      5       8       3       12;4;4
> #       d$z <- z                3,2     1,1     3,1     2,1     7;4;4,1
> #       d[["z"]] <- z           4,3     1,1     3,1     2,1     7;4;4,1
> #       d[, "z"] <- z           6,4,2   2,2,1   4,2,2   3,2,1   8;4;4,2,2
> #       d["z"] <- z             6,5,2   2,2,1   4,2,2   3,2,1   8;4;4,2,2
> #       d["z"] <- list(z=z)     6,3,2   2,2,1   4,2,2   3,2,1   8;4;4,2,2
> #       d["z"] <- Z #list(z=z)  6,2,2   2,1,1   4,1,2   3,1,1   8;4;4,1,2
> #       a <- d["y"]             2       1       2       1       6;4;4
> #       a <- d[, "y", drop=F]   2       1       2       1       6;4;4
>
> # Where two numbers are given, they refer to:
> #   (copies of the old data frame),
> #   (copies of the new column)
> # A third number refers to numbers of
> #   (copies made of an integer vector of row names)
>
> # For R 3.0.0, I'm getting astounding results - many more copies,
> # and also some copies of larger objects; in addition to the data
> # vectors of size 80K and 160K, also 240K and 320K.
> # Where three numbers are given in form a;c;d, they refer to
> #   (copies of 80K; 240K; 320K)
>
> The benchmarks are at
> http://www.timhesterberg.net/r-packages/memory.R
>
> I'm using versions of R I installed from source on a Linux box, using e.g.
> ./configure --prefix=(my path) --enable-memory-profiling --with-readline=no
> make
> make install
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From mtmorgan at fhcrc.org  Mon Apr 15 04:15:45 2013
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Sun, 14 Apr 2013 19:15:45 -0700
Subject: [Rd] R 3.0.0 memory use
In-Reply-To: <alpine.OSX.2.02.1304142106460.26466@lukes-macbook-air.local>
References: <yajfa9p03g8n.fsf@gmail.com>
	<alpine.OSX.2.02.1304142106460.26466@lukes-macbook-air.local>
Message-ID: <516B62D1.2010406@fhcrc.org>

On 04/14/2013 07:11 PM, luke-tierney at uiowa.edu wrote:
> There were a couple of bug fixes to somewhat obscure compound
> assignment related bugs that required bumping up internal reference
> counts. It's possible that one or more of these are responsible. If so
> it is unavoidable for now, but it's worth finding out for sure. With
> some stripped down test examples it should be possible to identify
> when things changed. I won't have time to look for some time, but if
> someone else wanted to nail this down that would be useful.

I can't quite tell from Tim's script what he's documenting. In R-2.15.3 I have

 > Rprofmem(); Rprofmem(NULL); readLines("Rprofmem.out", warn=FALSE)
character(0)

(or sometimes [1] "new page:new page:\"Rprofmem\" ")

whereas in R-3.0.0

 > Rprofmem(); Rprofmem(NULL); readLines("Rprofmem.out", warn=FALSE)
[1] "320040 :80040 :240048 :320040 :80040 :240048 :"

I think these are the allocations Tim is seeing. They're from the parser (see 
below) rather than as.data.frame. For Tim's example

   y <- 1:10^4 + 0.0
   Rprofmem(); d <- as.data.frame(y); Rprofmem(NULL); readLines("Rprofmem.out")

[1] "320040 :80040 :240048 :320040 :80040 :240048 :80040 
:\"as.data.frame.numeric\" \"as.data.frame\" "
[2] "320040 :80040 :240048 :320040 :80040 :240048 :"

only the allocation 80040 is from as.data.frame (from the call stack output).

Under R -d gdb

   (gdb) b R_OutputStackTrace
   (gdb) r
   > Rprofmem(); Rprofmem(NULL)

   Breakpoint 1, R_OutputStackTrace (file=0xbd43f0) at 
/home/mtmorgan/src/R-3-0-branch/src/main/memory.c:3434
   3434	{
   (gdb) bt
   #0  R_OutputStackTrace (file=0xbd43f0) at 
/home/mtmorgan/src/R-3-0-branch/src/main/memory.c:3434
   #1  0x00007ffff792ff83 in R_ReportAllocation (size=320040) at 
/home/mtmorgan/src/R-3-0-branch/src/main/memory.c:3456
   #2  Rf_allocVector (type=13, length=80000) at 
/home/mtmorgan/src/R-3-0-branch/src/main/memory.c:2478
   #3  0x00007ffff790bedf in growData () at gram.y:3391

and the memory allocations are from these lines in the parser gram.y

	PROTECT( bigger = allocVector( INTSXP, data_size * DATA_ROWS ) ) ;
	PROTECT( biggertext = allocVector( STRSXP, data_size ) );

I'm not sure why these show up under R 3.0.0, though.

$ R-2-15-branch/bin/R --version
R version 2.15.3 Patched (2013-03-13 r62579) -- "Security Blanket"
Copyright (C) 2013 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: x86_64-unknown-linux-gnu (64-bit)

R-3-0-branch$ bin/R --version
R version 3.0.0 Patched (2013-04-14 r62579) -- "Masked Marvel"
Copyright (C) 2013 The R Foundation for Statistical Computing
Platform: x86_64-unknown-linux-gnu (64-bit)

Martin



>
> Best,
>
> luke
>
> On Sun, 14 Apr 2013, Tim Hesterberg wrote:
>
>> I did some benchmarking of data frame code, and
>> it appears that R 3.0.0 is far worse than earlier versions of R
>> in terms of how many large objects it allocates space for,
>> for data frame operations - creation, subscripting, subscript replacement.
>> For a data frame with n rows, it makes either 2 or 4 extra copies of
>> all of:
>>        8n bytes (e.g. double precision)
>>        24n bytes
>>        32n bytes
>> E.g., for as.data.frame(numeric vector), instead of allocations
>> totalling ~8n bytes, it allocates 33 times that much.
>>
>> Here, compare columns 3 and 5
>> (columns 2 and 4 are with the dataframe package).
>>
>> # Summary
>> #                               R-2.14.2        R-2.15.3        R-3.0.0
>> #                               w/o     with    w/o     with    w/o
>> #       as.data.frame(y)        3       1       1       1       5;4;4
>> #       data.frame(y)           7       3       4       2       6;2;2
>> #       data.frame(y, z)        7 each  3 each  4       2       8;4;4
>> #       as.data.frame(l)        8       3       5       2       9;4;4
>> #       data.frame(l)           13      5       8       3       12;4;4
>> #       d$z <- z                3,2     1,1     3,1     2,1     7;4;4,1
>> #       d[["z"]] <- z           4,3     1,1     3,1     2,1     7;4;4,1
>> #       d[, "z"] <- z           6,4,2   2,2,1   4,2,2   3,2,1   8;4;4,2,2
>> #       d["z"] <- z             6,5,2   2,2,1   4,2,2   3,2,1   8;4;4,2,2
>> #       d["z"] <- list(z=z)     6,3,2   2,2,1   4,2,2   3,2,1   8;4;4,2,2
>> #       d["z"] <- Z #list(z=z)  6,2,2   2,1,1   4,1,2   3,1,1   8;4;4,1,2
>> #       a <- d["y"]             2       1       2       1       6;4;4
>> #       a <- d[, "y", drop=F]   2       1       2       1       6;4;4
>>
>> # Where two numbers are given, they refer to:
>> #   (copies of the old data frame),
>> #   (copies of the new column)
>> # A third number refers to numbers of
>> #   (copies made of an integer vector of row names)
>>
>> # For R 3.0.0, I'm getting astounding results - many more copies,
>> # and also some copies of larger objects; in addition to the data
>> # vectors of size 80K and 160K, also 240K and 320K.
>> # Where three numbers are given in form a;c;d, they refer to
>> #   (copies of 80K; 240K; 320K)
>>
>> The benchmarks are at
>> http://www.timhesterberg.net/r-packages/memory.R
>>
>> I'm using versions of R I installed from source on a Linux box, using e.g.
>> ./configure --prefix=(my path) --enable-memory-profiling --with-readline=no
>> make
>> make install
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From timhesterberg at gmail.com  Mon Apr 15 06:07:05 2013
From: timhesterberg at gmail.com (Tim Hesterberg)
Date: Sun, 14 Apr 2013 21:07:05 -0700
Subject: [Rd] R 3.0.0 memory use
In-Reply-To: <516B62D1.2010406@fhcrc.org> (message from Martin Morgan on Sun, 
	14 Apr 2013 19:15:45 -0700)
References: <yajfa9p03g8n.fsf@gmail.com>
	<alpine.OSX.2.02.1304142106460.26466@lukes-macbook-air.local>
	<516B62D1.2010406@fhcrc.org>
Message-ID: <yajf8v4k309i.fsf@gmail.com>

When I change the data set size, the "extra allocations" do
not change in size. This supports Luke and Martin's diagnosis.

The extra allocations are either 2 or 4 allocations each of size
 80040
240048
320040

Details (you may skip):

(Fresh session of R 3.0.0)
> y <- 1:10^4 + 0.0
> Rprofmem("temp.out", threshold = 10^4)
> d <- as.data.frame(y)
> Rprofmem(NULL); system("cat temp.out")
320040 :80040 :240048 :320040 :80040 :240048 :80040 :"as.data.frame.numeric" "as.data.frame" 
320040 :80040 :240048 :320040 :80040 :240048 :> 
> # Try increasing size by a factor of 10
> y <- 1:10^5 + 0.0
> Rprofmem("temp.out", threshold = 10^4)
> d <- as.data.frame(y)
> Rprofmem(NULL); system("cat temp.out")
320040 :80040 :240048 :320040 :80040 :240048 :800040 :"as.data.frame.numeric" "as.data.frame" 
320040 :80040 :240048 :320040 :80040 :240048 :> 

The number of allocations shown, of different sizes:

        3.0.0   3.0.0   2.15.3  2.15.3
        first   second  first   second
240048  4       4       0       0
320040  4       4       0       0
 80040  5       4       1       0
800040  0       1       0       1

So it looks like both R 2.15.3 and R 3.0.0 are making
one copy of the data, plus extra allocations.

(Fresh session of R 2.15.3)
> y <- 1:10^4 + 0.0
> Rprofmem("temp.out", threshold = 10^4)
> d <- as.data.frame(y)
> Rprofmem(NULL); system("cat temp.out")
80040 :"as.data.frame.numeric" "as.data.frame" 
> # Increase size by factor of 10
> y <- 1:10^5 + 0.0
> Rprofmem("temp.out", threshold = 10^4)
> d <- as.data.frame(y)
> Rprofmem(NULL); system("cat temp.out")
800040 :"as.data.frame.numeric" "as.data.frame" 




On Sun, 14 Apr 2013 19:15:45 -0700 Martin Morgan <mtmorgan at fhcrc.org> wrote:
>On 04/14/2013 07:11 PM, luke-tierney at uiowa.edu wrote:
>> There were a couple of bug fixes to somewhat obscure compound
>> assignment related bugs that required bumping up internal reference
>> counts. It's possible that one or more of these are responsible. If so
>> it is unavoidable for now, but it's worth finding out for sure. With
>> some stripped down test examples it should be possible to identify
>> when things changed. I won't have time to look for some time, but if
>> someone else wanted to nail this down that would be useful.
>
>I can't quite tell from Tim's script what he's documenting. In R-2.15.3 I have
>
> > Rprofmem(); Rprofmem(NULL); readLines("Rprofmem.out", warn=FALSE)
>character(0)
>
>(or sometimes [1] "new page:new page:\"Rprofmem\" ")
>
>whereas in R-3.0.0
>
> > Rprofmem(); Rprofmem(NULL); readLines("Rprofmem.out", warn=FALSE)
>[1] "320040 :80040 :240048 :320040 :80040 :240048 :"
>
>I think these are the allocations Tim is seeing. They're from the parser (see
>below) rather than as.data.frame. For Tim's example
>
>   y <- 1:10^4 + 0.0
>   Rprofmem(); d <- as.data.frame(y); Rprofmem(NULL); readLines("Rprofmem.out")
>
>[1] "320040 :80040 :240048 :320040 :80040 :240048 :80040
>:\"as.data.frame.numeric\" \"as.data.frame\" "
>[2] "320040 :80040 :240048 :320040 :80040 :240048 :"
>
>only the allocation 80040 is from as.data.frame (from the call stack output).
>
>Under R -d gdb
>
>   (gdb) b R_OutputStackTrace
>   (gdb) r
>   > Rprofmem(); Rprofmem(NULL)
>
>   Breakpoint 1, R_OutputStackTrace (file=0xbd43f0) at
>/home/mtmorgan/src/R-3-0-branch/src/main/memory.c:3434
>   3434	{
>   (gdb) bt
>   #0  R_OutputStackTrace (file=0xbd43f0) at
>/home/mtmorgan/src/R-3-0-branch/src/main/memory.c:3434
>   #1  0x00007ffff792ff83 in R_ReportAllocation (size=320040) at
>/home/mtmorgan/src/R-3-0-branch/src/main/memory.c:3456
>   #2  Rf_allocVector (type=13, length=80000) at
>/home/mtmorgan/src/R-3-0-branch/src/main/memory.c:2478
>   #3  0x00007ffff790bedf in growData () at gram.y:3391
>
>and the memory allocations are from these lines in the parser gram.y
>
>	PROTECT( bigger = allocVector( INTSXP, data_size * DATA_ROWS ) ) ;
>	PROTECT( biggertext = allocVector( STRSXP, data_size ) );
>
>I'm not sure why these show up under R 3.0.0, though.
>
>$ R-2-15-branch/bin/R --version
>R version 2.15.3 Patched (2013-03-13 r62579) -- "Security Blanket"
>Copyright (C) 2013 The R Foundation for Statistical Computing
>ISBN 3-900051-07-0
>Platform: x86_64-unknown-linux-gnu (64-bit)
>
>R-3-0-branch$ bin/R --version
>R version 3.0.0 Patched (2013-04-14 r62579) -- "Masked Marvel"
>Copyright (C) 2013 The R Foundation for Statistical Computing
>Platform: x86_64-unknown-linux-gnu (64-bit)
>
>Martin
>
>
>
>>
>> Best,
>>
>> luke
>>
>> On Sun, 14 Apr 2013, Tim Hesterberg wrote:
>>
>>> I did some benchmarking of data frame code, and
>>> it appears that R 3.0.0 is far worse than earlier versions of R
>>> in terms of how many large objects it allocates space for,
>>> for data frame operations - creation, subscripting, subscript replacement.
>>> For a data frame with n rows, it makes either 2 or 4 extra copies of
>>> all of:
>>>        8n bytes (e.g. double precision)
>>>        24n bytes
>>>        32n bytes
>>> E.g., for as.data.frame(numeric vector), instead of allocations
>>> totalling ~8n bytes, it allocates 33 times that much.
>>>
>>> Here, compare columns 3 and 5
>>> (columns 2 and 4 are with the dataframe package).
>>>
>>> # Summary
>>> #                               R-2.14.2        R-2.15.3        R-3.0.0
>>> #                               w/o     with    w/o     with    w/o
>>> #       as.data.frame(y)        3       1       1       1       5;4;4
>>> #       data.frame(y)           7       3       4       2       6;2;2
>>> #       data.frame(y, z)        7 each  3 each  4       2       8;4;4
>>> #       as.data.frame(l)        8       3       5       2       9;4;4
>>> #       data.frame(l)           13      5       8       3       12;4;4
>>> #       d$z <- z                3,2     1,1     3,1     2,1     7;4;4,1
>>> #       d[["z"]] <- z           4,3     1,1     3,1     2,1     7;4;4,1
>>> #       d[, "z"] <- z           6,4,2   2,2,1   4,2,2   3,2,1   8;4;4,2,2
>>> #       d["z"] <- z             6,5,2   2,2,1   4,2,2   3,2,1   8;4;4,2,2
>>> #       d["z"] <- list(z=z)     6,3,2   2,2,1   4,2,2   3,2,1   8;4;4,2,2
>>> #       d["z"] <- Z #list(z=z)  6,2,2   2,1,1   4,1,2   3,1,1   8;4;4,1,2
>>> #       a <- d["y"]             2       1       2       1       6;4;4
>>> #       a <- d[, "y", drop=F]   2       1       2       1       6;4;4
>>>
>>> # Where two numbers are given, they refer to:
>>> #   (copies of the old data frame),
>>> #   (copies of the new column)
>>> # A third number refers to numbers of
>>> #   (copies made of an integer vector of row names)
>>>
>>> # For R 3.0.0, I'm getting astounding results - many more copies,
>>> # and also some copies of larger objects; in addition to the data
>>> # vectors of size 80K and 160K, also 240K and 320K.
>>> # Where three numbers are given in form a;c;d, they refer to
>>> #   (copies of 80K; 240K; 320K)
>>>
>>> The benchmarks are at
>>> http://www.timhesterberg.net/r-packages/memory.R
>>>
>>> I'm using versions of R I installed from source on a Linux box, using e.g.
>>> ./configure --prefix=(my path) --enable-memory-profiling --with-readline=no
>>> make
>>> make install
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>
>
>--
>Computational Biology / Fred Hutchinson Cancer Research Center
>1100 Fairview Ave. N.
>PO Box 19024 Seattle, WA 98109
>
>Location: Arnold Building M1 B861
>Phone: (206) 667-2793


From ripley at stats.ox.ac.uk  Mon Apr 15 07:56:26 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 15 Apr 2013 06:56:26 +0100
Subject: [Rd] package file permissions problem R 3.0.0/Windows OS
In-Reply-To: <002201ce3955$7ff88580$7fe99080$@mcmaster.ca>
References: <002201ce3955$7ff88580$7fe99080$@mcmaster.ca>
Message-ID: <516B968A.8070704@stats.ox.ac.uk>

POSIX-style execute permission isn't a Windows concept, so it was 
fortuitous this ever worked.  One possibility is that Cygwin was 
involved, and a Cygwin emulation got set when tar unpacked the file and 
converted back to the tar representation when Cygwin tar produced the 
tarball. (The tar in Rtools is a fixed version of Cygwin tar, fixed to 
use Windows file paths.)

What are those screen shots of?

R 2.5.2 was a very long time ago.  A recent change is

     ? R CMD build by default uses the internal method of tar() to
       prepare the tarball.  This is more likely to produce a tarball
       compatible with R CMD INSTALL and R CMD check: an external tar
       program, including options, can be specified _via_ the
       environment variable R_BUILD_TAR.

Can you try using an external tar?  (Using the internal tar on Windows 
was first trialled in 2.15.3.)


On 14/04/2013 22:17, John Fox wrote:
> Dear list members,
>
> I'm experiencing a file permissions problem with a package built under
> Windows with R 3.0.0. I've encountered the problem on two Windows computers,
> one running Windows 7 and the other Windows 8, and both when I build the
> package under RStudio or directly in a Windows console via "R CMD build".
>
> In particular, the cleanup file for the package, which as I understand it
> should have permissions set at rwx-r-r, instead has permissions rw-rw-rw.
> I've attached two .png screen shots showing how the permissions are set when
> the package is built under R 2.5.2 and R 3.0.0.
>
> I think that my two Windows systems are reasonably vanilla. Here are the
> system and session info from R 3.0.0 run from a Windows console:
>
>> Sys.info()
>                       sysname                      release
>                     "Windows"                      "7 x64"
>                       version                     nodename
> "build 7601, Service Pack 1"              "JOHN-DELL-XPS"
>                       machine                        login
>                         "x86"                       "User"
>                          user               effective_user
>                        "User"                       "User"
>
>> sessionInfo()
> R version 3.0.0 (2013-04-03)
> Platform: i386-w64-mingw32/i386 (32-bit)
>
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> I have the latest Rtools30 installed and on my path:
>
>> Sys.which("tar.exe")
>                     tar.exe
> "c:\\Rtools\\bin\\tar.exe"
>
> Is this a general problem or is it possible that there's something about my
> Windows configurations that's causing it?
>
> Any information would be appreciated.
>
> John
>
> -----------------------------------------------
> John Fox
> Senator McMaster Professor of Social Statistics
> Department of Sociology
> McMaster University
> Hamilton, Ontario, Canada
>
>
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jfox at mcmaster.ca  Mon Apr 15 15:11:18 2013
From: jfox at mcmaster.ca (John Fox)
Date: Mon, 15 Apr 2013 09:11:18 -0400
Subject: [Rd] package file permissions problem R 3.0.0/Windows OS
In-Reply-To: <516B968A.8070704@stats.ox.ac.uk>
References: <002201ce3955$7ff88580$7fe99080$@mcmaster.ca>
	<516B968A.8070704@stats.ox.ac.uk>
Message-ID: <web-453347265@cgpsrv2.cis.mcmaster.ca>

Dear Brian,

On Mon, 15 Apr 2013 06:56:26 +0100
 Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> POSIX-style execute permission isn't a Windows concept, so it was fortuitous this ever worked.  One possibility is that Cygwin was involved, and a Cygwin emulation got set when tar unpacked the file and converted back to the tar representation when Cygwin tar produced the tarball. (The tar in Rtools is a fixed version of Cygwin tar, fixed to use Windows file paths.)
> 

Recall that the problem was first detected when I submitted to CRAN a new version of the sem package that I built on one of my Windows systems. I'm guessing that you unpacked that on a Linux system. Perhaps I misunderstand the point, but if the problem is in unpacking, then shouldn't I see it when the package is built on R 2.15.2 (not 2.5.2 -- sorry, my typo)?

> What are those screen shots of?

7zip, which I use on Windows to manage file archives.

> 
> R 2.5.2 was a very long time ago.  A recent change is

Indeed. Again, that is my unfortunate typo -- I used 2.15.2. I wanted to confirm that I can build packages with the correct permissions on my Windows systems using an older (but recent) version of R.

> 
>      ? R CMD build by default uses the internal method of tar() to
>        prepare the tarball.  This is more likely to produce a tarball
>        compatible with R CMD INSTALL and R CMD check: an external tar
>        program, including options, can be specified _via_ the
>        environment variable R_BUILD_TAR.
> 

I saw that but didn't understand its import. That makes sense of a difference between R 2.15.2 and 3.0.0, though I'm not sure why this change would introduce a problem with the permissions.

> Can you try using an external tar?  (Using the internal tar on Windows was first trialled in 2.15.3.)
> 

Yes, when I "set R_BUILD_TAR=tar" on my Windows 8 system, the tarball for the package is built with the correct permissions under R 3.0.0. The tar should be found in the Rtools\bin directory, which is first on my path. I don't have Cygwin installed on this machine independently of Rtools.

What's curious to me is that I'm seeing the problem on two different Windows system but, AFAIK, no one else has experienced a similar problem.

Thanks for your help,
 John

> 
> On 14/04/2013 22:17, John Fox wrote:
> > Dear list members,
> >
> > I'm experiencing a file permissions problem with a package built under
> > Windows with R 3.0.0. I've encountered the problem on two Windows computers,
> > one running Windows 7 and the other Windows 8, and both when I build the
> > package under RStudio or directly in a Windows console via "R CMD build".
> >
> > In particular, the cleanup file for the package, which as I understand it
> > should have permissions set at rwx-r-r, instead has permissions rw-rw-rw.
> > I've attached two .png screen shots showing how the permissions are set when
> > the package is built under R 2.5.2 and R 3.0.0.
> >
> > I think that my two Windows systems are reasonably vanilla. Here are the
> > system and session info from R 3.0.0 run from a Windows console:
> >
> >> Sys.info()
> >                       sysname                      release
> >                     "Windows"                      "7 x64"
> >                       version                     nodename
> > "build 7601, Service Pack 1"              "JOHN-DELL-XPS"
> >                       machine                        login
> >                         "x86"                       "User"
> >                          user               effective_user
> >                        "User"                       "User"
> >
> >> sessionInfo()
> > R version 3.0.0 (2013-04-03)
> > Platform: i386-w64-mingw32/i386 (32-bit)
> >
> > locale:
> > [1] LC_COLLATE=English_United States.1252
> > [2] LC_CTYPE=English_United States.1252
> > [3] LC_MONETARY=English_United States.1252
> > [4] LC_NUMERIC=C
> > [5] LC_TIME=English_United States.1252
> >
> > attached base packages:
> > [1] stats     graphics  grDevices utils     datasets  methods   base
> >
> > I have the latest Rtools30 installed and on my path:
> >
> >> Sys.which("tar.exe")
> >                     tar.exe
> > "c:\\Rtools\\bin\\tar.exe"
> >
> > Is this a general problem or is it possible that there's something about my
> > Windows configurations that's causing it?
> >
> > Any information would be appreciated.
> >
> > John
> >
> > -----------------------------------------------
> > John Fox
> > Senator McMaster Professor of Social Statistics
> > Department of Sociology
> > McMaster University
> > Hamilton, Ontario, Canada
> >
> >
> >
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From andre_mikulec at hotmail.com  Mon Apr 15 19:11:02 2013
From: andre_mikulec at hotmail.com (Andre Mikulec)
Date: Mon, 15 Apr 2013 13:11:02 -0400
Subject: [Rd] windows compile R from source,
 where do I put the Tcl directory?
Message-ID: <BLU174-W372B569CECE919D0F2C58E9CCC0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130415/18688d52/attachment.pl>

From murdoch.duncan at gmail.com  Mon Apr 15 19:55:50 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 15 Apr 2013 13:55:50 -0400
Subject: [Rd] windows compile R from source,
	where do I put the Tcl directory?
In-Reply-To: <BLU174-W372B569CECE919D0F2C58E9CCC0@phx.gbl>
References: <BLU174-W372B569CECE919D0F2C58E9CCC0@phx.gbl>
Message-ID: <516C3F26.4010402@gmail.com>

On 13-04-15 1:11 PM, Andre Mikulec wrote:
>> Message: 2
>> Date: Sun, 14 Apr 2013 07:14:28 -0400
>> From: Duncan Murdoch <murdoch.duncan at gmail.com>
>> To: Andre Mikulec <andre_mikulec at hotmail.com>
>> Cc: "r-devel at r-project.org" <r-devel at r-project.org>
>> Subject: Re: [Rd] windows compile R from source, where do I put the
>> Tcl directory?
>> Message-ID: <516A8F94.1040807 at gmail.com>
>> Content-Type: text/plain; charset=KOI8-R; format=flowed
>>
>> On 13-04-13 10:03 PM, Andre Mikulec wrote:
>>>>> Prof Brian Ripley ripley at stats.ox.ac.uk
>>>>> Thu Apr 11 13:32:02 CEST 2013
>>>>> Previous message: [Rd] windows compile R from source, where do I put the Tcl directory?
>>>>> Next message: [Rd] Trying to make DEBUG=T a debug version of R
>>>>> Messages sorted by: [ date ] [ thread ] [ subject ] [ author ]
>>>>> On 11/04/2013 00:27, Andre Mikulec wrote:
>>>>>> Hi,
>>>>>>
>>>>>> I am trying to compile R from source on Windows.
>>>>>> I am following the instructions here
>>>>>>
>>>>>> 3.1 Building from source
>>>>>> 3 Installing R under Windows
>>>>>> file:///F:/ProgramFiles/R/R-2.15.3/doc/manual/R-admin.html
>>>>>>
>>>>>> It only says,
>>>>>>
>>>>>> "
>>>>>> The Tcl/Tk support files are contained in Rtools30.exe and
>>>>>> available as .zips from http://www.stats.ox.ac.uk/pub/Rtools.
>>>>>> Please make sure you install the right version: there is a 32-bit
>>>>>> version and a 64-bit version.
>>>>>> "
>>>>>>
>>>>>> Anyways,
>>>>>> I collected the support files from here.
>>>>>> http://www.stats.ox.ac.uk/pub/Rtools/R_Tcl_8-5-8.zip
>>>>>>
>>>>>> The instructions do not say "where to put my Tcl folder."
>>>>>
>>>>> Rtools30.exe does this for you. But you put it at the top level in the
>>>>> sources.
>>>>>
>>>>>> So I just guessed, based on ( include, doc, and bin are parallel directories )
>>>>>> in F:\ProgramFiles\R\R-2.15.3\Tcl
>>>>>>
>>>>>> I guessed ( and guessed wrong ) ...
>>>>>> M:\YDrive\All_Economics\eclipse_workspace\R-2.15.3\src\Tcl
>>>>>
>>>>> Why in src? It is a binary distriution.
>>>>>
>>>>>> When Try to compile with
>>>>>>
>>>>>> M:\YDrive\All_Economics\eclipse_workspace\R-2.15.3\src\gnuwin32>make all recommended
>>>>>>
>>>>>> I eventually get ...
>>>>>>
>>>>>> "tcltk.h:23:17: fatal error: tcl.h: No such file or directory"
>>>>>>
>>>>>> in the message
>>>>>>
>>>>>> building package 'tcltk'
>>>>>> making init.d from init.c
>>>>>> making tcltk.d from tcltk.c
>>>>>> making tcltk_win.d from tcltk_win.c
>>>>>> gcc -I"../../../../include" -DNDEBUG -I "../../../../Tcl"/include -DWin32 -O3 -Wall -gdwarf-2 -std=gnu99 -c init.c -o init.o
>>>>>> In file included from init.c:22:0:
>>>>>> tcltk.h:23:17: fatal error: tcl.h: No such file or directory
>>>>>> compilation terminated.
>>>>>> make[4]: *** [init.o] Error 1
>>>>>> make[3]: *** [mksrc-win2] Error 1
>>>>>> make[2]: *** [all] Error 2
>>>>>> make[1]: *** [R] Error 1
>>>>>> make: *** [all] Error 2
>>>>>>
>>>>>> Please, help.
>>>>>>
>>>>>> Thank you.
>>>>>> Andre Mikulec
>>>>>> Andre_Mikulec at Hotmail.com
>>>>>> ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> Brian D. Ripley, ripley at stats.ox.ac.uk
>>>>> Professor of Applied Statistics, http://www.stats.ox.ac.uk/~ripley/
>>>>> University of Oxford, Tel: +44 1865 272861 (self)
>>>>> 1 South Parks Road, +44 1865 272866 (PA)
>>>>> Oxford OX1 3TG, UK Fax: +44 1865 272595
>>>
>>>
>>> "Why in src? It is a binary distriution."
>>>
>>> Yes, I have the binary distribution ( but it is not found in RTools )
>>>
>>> "
>>> Rtools30.exe does this for you. But you put it at the top level in the
>>> sources.
>>> "
>>> Maybe I do not know where the 'top level' is located.
>>>
>>> Please, help.
>>>
>>> I used "tree /f" and search for
>>> "tk" and "tcl" files in my
>>>
>>> F:\RTools folder
>>
>> The Tcl/Tk files are in Rtools.exe, and are installed to the top level
>> of the R directory tree, unless you chose (when running Rtools.exe) not
>> to install them. They are not installed to the Rtools directory tree.
>>
>> Duncan Murdoch
>>
>
>
> I have spent 3 attempts to compile R and end up at the very same spot.
>
>
>    "tcltk.h:23:17: fatal error: tcl.h: No such file or directory"
>
>
> RTools.exe does not install a tcl.h file.  It is not there. I looked and looked and looked.

That's because you told it not to.  Run it again, and select one or both 
of the "Extras" under custom installation, or "full installation".

>
>
> R-2.15.3 source code does not have a tcl.h file. I looked and looked and looked.
>
>
> R_Tcl_8-5-8.zip does have a tcl.h file.
>
>
>
> 2. My folder contents are the following.
>
>
>    1. RTools folder,
>    2. R-2.15.3 source code folder
>    3. Tcl folder ( from R_Tcl_8-5-8.zip )
>
>
> Their locations are the following.
>
>
>    1. F:\RTools
>    2. M:\YDrive\All_Economics\eclipse_workspace\R\R-2.15.3
>    3. M:\YDrive\All_Economics\eclipse_workspace\Tcl
>
>
> Where do I stick the "Tcl" folder?

In M:\YDrive\All_Economics\eclipse_workspace\R\R-2.15.3.
>
>
> What is a "top level of the R directory tree?" Where is it?

M:\YDrive\All_Economics\eclipse_workspace\R\R-2.15.3

By the way, I don't think it will be a problem, but that path is getting 
kind of long, and Windows has a 256 character limit on path length.

Duncan Murdoch

>
>
> Thank you,
> Andre Mikulec
> Andre_Mikulec at Hotmail.com
>
>
>
>
>
>    		 	   		
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Mon Apr 15 21:19:21 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 15 Apr 2013 20:19:21 +0100
Subject: [Rd] package file permissions problem R 3.0.0/Windows OS
In-Reply-To: <web-453347265@cgpsrv2.cis.mcmaster.ca>
References: <002201ce3955$7ff88580$7fe99080$@mcmaster.ca>
	<516B968A.8070704@stats.ox.ac.uk>
	<web-453347265@cgpsrv2.cis.mcmaster.ca>
Message-ID: <516C52B9.9020605@stats.ox.ac.uk>

On 15/04/2013 14:11, John Fox wrote:
> Dear Brian,
>
> On Mon, 15 Apr 2013 06:56:26 +0100
>   Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>> POSIX-style execute permission isn't a Windows concept, so it was fortuitous this ever worked.  One possibility is that Cygwin was involved, and a Cygwin emulation got set when tar unpacked the file and converted back to the tar representation when Cygwin tar produced the tarball. (The tar in Rtools is a fixed version of Cygwin tar, fixed to use Windows file paths.)
>>
>
> Recall that the problem was first detected when I submitted to CRAN
> a
new version of the sem package that I built on one of my Windows
systems. I'm guessing that you unpacked that on a Linux system. Perhaps
I misunderstand the point, but if the problem is in unpacking, then
shouldn't I see it when the package is built on R 2.15.2 (not 2.5.2 --
sorry, my typo)?

The puzzle is how you got execute permissions recorded for files on your 
Windows system.  They are not part of the Windows file system: Cygwin 
uses ACLs to emulate them.  Once the ACLs are there, a Cygwin-based tar 
will put them as permissions into the tarball.  But a native Windows 
tool would not (it might or might not capture the ACLs using a tar 
extension, but those would be ignored by most unpacking tools on a 
Unix-alike).

The issue is not really Windows: if you use a FAT file system on a 
Unix-alike you have the same problem -- this is why SMB mounts at least 
did not work on OS X for building R (and much else), and you need to be 
careful transferring directories via USB sticks (which are usually 
FAT-formatted).  That route usually makes the opposite compromise: to 
assume everything is executable.

>> What are those screen shots of?
>
> 7zip, which I use on Windows to manage file archives.

Ah, so that's a listing of the .tar.gz, a graphical form of tar -tvf.

>> R 2.5.2 was a very long time ago.  A recent change is
>
> Indeed. Again, that is my unfortunate typo -- I used 2.15.2. I wanted to confirm that I can build packages with the correct permissions on my Windows systems using an older (but recent) version of R.
>
>>
>>       ? R CMD build by default uses the internal method of tar() to
>>         prepare the tarball.  This is more likely to produce a tarball
>>         compatible with R CMD INSTALL and R CMD check: an external tar
>>         program, including options, can be specified _via_ the
>>         environment variable R_BUILD_TAR.
>>
>
> I saw that but didn't understand its import. That makes sense of a difference between R 2.15.2 and 3.0.0, though I'm not sure why this change would introduce a problem with the permissions.
>
>> Can you try using an external tar?  (Using the internal tar on Windows was first trialled in 2.15.3.)
>>
>
> Yes, when I "set R_BUILD_TAR=tar" on my Windows 8 system, the tarball for the package is built with the correct permissions under R 3.0.0. The tar should be found in the Rtools\bin directory, which is first on my path. I don't have Cygwin installed on this machine independently of Rtools.
>
> What's curious to me is that I'm seeing the problem on two different Windows system but, AFAIK, no one else has experienced a similar problem.

Very few Windows users will ever get a file that appears to 'tar' to 
have execute permissions.  For example, svn checkouts on Windows lose 
execute permissions, something which has caught me for time to time over 
the years.

> Thanks for your help,
>   John
>
>>
>> On 14/04/2013 22:17, John Fox wrote:
>>> Dear list members,
>>>
>>> I'm experiencing a file permissions problem with a package built under
>>> Windows with R 3.0.0. I've encountered the problem on two Windows computers,
>>> one running Windows 7 and the other Windows 8, and both when I build the
>>> package under RStudio or directly in a Windows console via "R CMD build".
>>>
>>> In particular, the cleanup file for the package, which as I understand it
>>> should have permissions set at rwx-r-r, instead has permissions rw-rw-rw.
>>> I've attached two .png screen shots showing how the permissions are set when
>>> the package is built under R 2.5.2 and R 3.0.0.
>>>
>>> I think that my two Windows systems are reasonably vanilla. Here are the
>>> system and session info from R 3.0.0 run from a Windows console:
>>>
>>>> Sys.info()
>>>                        sysname                      release
>>>                      "Windows"                      "7 x64"
>>>                        version                     nodename
>>> "build 7601, Service Pack 1"              "JOHN-DELL-XPS"
>>>                        machine                        login
>>>                          "x86"                       "User"
>>>                           user               effective_user
>>>                         "User"                       "User"
>>>
>>>> sessionInfo()
>>> R version 3.0.0 (2013-04-03)
>>> Platform: i386-w64-mingw32/i386 (32-bit)
>>>
>>> locale:
>>> [1] LC_COLLATE=English_United States.1252
>>> [2] LC_CTYPE=English_United States.1252
>>> [3] LC_MONETARY=English_United States.1252
>>> [4] LC_NUMERIC=C
>>> [5] LC_TIME=English_United States.1252
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>
>>> I have the latest Rtools30 installed and on my path:
>>>
>>>> Sys.which("tar.exe")
>>>                      tar.exe
>>> "c:\\Rtools\\bin\\tar.exe"
>>>
>>> Is this a general problem or is it possible that there's something about my
>>> Windows configurations that's causing it?
>>>
>>> Any information would be appreciated.
>>>
>>> John
>>>
>>> -----------------------------------------------
>>> John Fox
>>> Senator McMaster Professor of Social Statistics
>>> Department of Sociology
>>> McMaster University
>>> Hamilton, Ontario, Canada
>>>
>>>
>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From pgilbert902 at gmail.com  Mon Apr 15 22:07:02 2013
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Mon, 15 Apr 2013 16:07:02 -0400
Subject: [Rd] package file permissions problem R 3.0.0/Windows OS
In-Reply-To: <516C52B9.9020605@stats.ox.ac.uk>
References: <002201ce3955$7ff88580$7fe99080$@mcmaster.ca>
	<516B968A.8070704@stats.ox.ac.uk>
	<web-453347265@cgpsrv2.cis.mcmaster.ca>
	<516C52B9.9020605@stats.ox.ac.uk>
Message-ID: <516C5DE6.5090106@gmail.com>



On 13-04-15 03:19 PM, Prof Brian Ripley wrote:
> On 15/04/2013 14:11, John Fox wrote:
>> Dear Brian,
>>
>> On Mon, 15 Apr 2013 06:56:26 +0100
>>   Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>>> POSIX-style execute permission isn't a Windows concept, so it was
>>> fortuitous this ever worked.  One possibility is that Cygwin was
>>> involved, and a Cygwin emulation got set when tar unpacked the file
>>> and converted back to the tar representation when Cygwin tar produced
>>> the tarball. (The tar in Rtools is a fixed version of Cygwin tar,
>>> fixed to use Windows file paths.)
>>>
>>
>> Recall that the problem was first detected when I submitted to CRAN
>> a
> new version of the sem package that I built on one of my Windows
> systems. I'm guessing that you unpacked that on a Linux system. Perhaps
> I misunderstand the point, but if the problem is in unpacking, then
> shouldn't I see it when the package is built on R 2.15.2 (not 2.5.2 --
> sorry, my typo)?
>
> The puzzle is how you got execute permissions recorded for files on your
> Windows system.  They are not part of the Windows file system: Cygwin
> uses ACLs to emulate them.  Once the ACLs are there, a Cygwin-based tar
> will put them as permissions into the tarball.  But a native Windows
> tool would not (it might or might not capture the ACLs using a tar
> extension, but those would be ignored by most unpacking tools on a
> Unix-alike).
>
> The issue is not really Windows: if you use a FAT file system on a
> Unix-alike you have the same problem -- this is why SMB mounts at least
> did not work on OS X for building R (and much else), and you need to be
> careful transferring directories via USB sticks (which are usually
> FAT-formatted).  That route usually makes the opposite compromise: to
> assume everything is executable.
>
>>> What are those screen shots of?
>>
>> 7zip, which I use on Windows to manage file archives.
>
> Ah, so that's a listing of the .tar.gz, a graphical form of tar -tvf.
>
>>> R 2.5.2 was a very long time ago.  A recent change is
>>
>> Indeed. Again, that is my unfortunate typo -- I used 2.15.2. I wanted
>> to confirm that I can build packages with the correct permissions on
>> my Windows systems using an older (but recent) version of R.
>>
>>>
>>>       ? R CMD build by default uses the internal method of tar() to
>>>         prepare the tarball.  This is more likely to produce a tarball
>>>         compatible with R CMD INSTALL and R CMD check: an external tar
>>>         program, including options, can be specified _via_ the
>>>         environment variable R_BUILD_TAR.
>>>
>>
>> I saw that but didn't understand its import. That makes sense of a
>> difference between R 2.15.2 and 3.0.0, though I'm not sure why this
>> change would introduce a problem with the permissions.
>>
>>> Can you try using an external tar?  (Using the internal tar on
>>> Windows was first trialled in 2.15.3.)
>>>
>>
>> Yes, when I "set R_BUILD_TAR=tar" on my Windows 8 system, the tarball
>> for the package is built with the correct permissions under R 3.0.0.
>> The tar should be found in the Rtools\bin directory, which is first on
>> my path. I don't have Cygwin installed on this machine independently
>> of Rtools.
>>
>> What's curious to me is that I'm seeing the problem on two different
>> Windows system but, AFAIK, no one else has experienced a similar problem.
>
> Very few Windows users will ever get a file that appears to 'tar' to
> have execute permissions.  For example, svn checkouts on Windows lose
> execute permissions, something which has caught me for time to time over
> the years.

I am just having the opposite problem, sliksvn is adding x permission on 
checkout, to some but not all files. Not sure why and I don't want it 
to, so would be happy to hear suggestions.

Paul

>
>> Thanks for your help,
>>   John
>>
>>>
>>> On 14/04/2013 22:17, John Fox wrote:
>>>> Dear list members,
>>>>
>>>> I'm experiencing a file permissions problem with a package built under
>>>> Windows with R 3.0.0. I've encountered the problem on two Windows
>>>> computers,
>>>> one running Windows 7 and the other Windows 8, and both when I build
>>>> the
>>>> package under RStudio or directly in a Windows console via "R CMD
>>>> build".
>>>>
>>>> In particular, the cleanup file for the package, which as I
>>>> understand it
>>>> should have permissions set at rwx-r-r, instead has permissions
>>>> rw-rw-rw.
>>>> I've attached two .png screen shots showing how the permissions are
>>>> set when
>>>> the package is built under R 2.5.2 and R 3.0.0.
>>>>
>>>> I think that my two Windows systems are reasonably vanilla. Here are
>>>> the
>>>> system and session info from R 3.0.0 run from a Windows console:
>>>>
>>>>> Sys.info()
>>>>                        sysname                      release
>>>>                      "Windows"                      "7 x64"
>>>>                        version                     nodename
>>>> "build 7601, Service Pack 1"              "JOHN-DELL-XPS"
>>>>                        machine                        login
>>>>                          "x86"                       "User"
>>>>                           user               effective_user
>>>>                         "User"                       "User"
>>>>
>>>>> sessionInfo()
>>>> R version 3.0.0 (2013-04-03)
>>>> Platform: i386-w64-mingw32/i386 (32-bit)
>>>>
>>>> locale:
>>>> [1] LC_COLLATE=English_United States.1252
>>>> [2] LC_CTYPE=English_United States.1252
>>>> [3] LC_MONETARY=English_United States.1252
>>>> [4] LC_NUMERIC=C
>>>> [5] LC_TIME=English_United States.1252
>>>>
>>>> attached base packages:
>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>>
>>>> I have the latest Rtools30 installed and on my path:
>>>>
>>>>> Sys.which("tar.exe")
>>>>                      tar.exe
>>>> "c:\\Rtools\\bin\\tar.exe"
>>>>
>>>> Is this a general problem or is it possible that there's something
>>>> about my
>>>> Windows configurations that's causing it?
>>>>
>>>> Any information would be appreciated.
>>>>
>>>> John
>>>>
>>>> -----------------------------------------------
>>>> John Fox
>>>> Senator McMaster Professor of Social Statistics
>>>> Department of Sociology
>>>> McMaster University
>>>> Hamilton, Ontario, Canada
>>>>
>>>>
>>>>
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>>
>>> --
>>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>>> University of Oxford,             Tel:  +44 1865 272861 (self)
>>> 1 South Parks Road,                     +44 1865 272866 (PA)
>>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
>


From jfox at mcmaster.ca  Mon Apr 15 22:28:47 2013
From: jfox at mcmaster.ca (John Fox)
Date: Mon, 15 Apr 2013 16:28:47 -0400
Subject: [Rd] package file permissions problem R 3.0.0/Windows OS
In-Reply-To: <516C52B9.9020605@stats.ox.ac.uk>
References: <002201ce3955$7ff88580$7fe99080$@mcmaster.ca>
	<516B968A.8070704@stats.ox.ac.uk>
	<web-453347265@cgpsrv2.cis.mcmaster.ca>
	<516C52B9.9020605@stats.ox.ac.uk>
Message-ID: <web-453468600@cgpsrv2.cis.mcmaster.ca>

Dear Brian,

I hope that I can clarify the issue and not confuse it further. I apologize if I was less than clear.

I originally built the tarball for the sem package on my Windows 7 system using "R CMD build" via RStudio with R 3.0.0. Both my Windows 7 system and the Windows 8 system that I subsequently also used to build the package tarball use the NTFS file system. Of course, these are Windows file systems and don't use the Unix permission scheme, but there are apparently permissions recorded in the tarball, and they caused problems for you when I submitted the package to CRAN. The permissions are visible when I look inside the tarball, e.g., with 7zip. 

When I rebuilt the package using "R CMD build" with R 2.15.2 (as opposed to 3.0.0) on both of these Windows systems, the permissions inside the tarball were correct.

I never built the package on my Linux system, although I did try building it on my Mac. I obtained correct permissions inside the tarball when I did, which isn't surprising. 

If it's the case that package tarballs built under Windows don't have execute permissions set where these are needed (as for cleanup), won't you have the same problem when such tarballs are submitted to CRAN that you had with the sem package?

Also, I'm still not clear why the execute permissions were set properly when I created the tarball having set R_BUILD_TAR=tar or using R 2.15.2.

To reiterate, if this issue is unique to me, I can certainly work around it. I know that it's hard to diagnose this kind of problem long-distance via email.

Best,
 John

On Mon, 15 Apr 2013 20:19:21 +0100
 Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On 15/04/2013 14:11, John Fox wrote:
> > Dear Brian,
> >
> > On Mon, 15 Apr 2013 06:56:26 +0100
> >   Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> >> POSIX-style execute permission isn't a Windows concept, so it was fortuitous this ever worked.  One possibility is that Cygwin was involved, and a Cygwin emulation got set when tar unpacked the file and converted back to the tar representation when Cygwin tar produced the tarball. (The tar in Rtools is a fixed version of Cygwin tar, fixed to use Windows file paths.)
> >>
> >
> > Recall that the problem was first detected when I submitted to CRAN
> > a
> new version of the sem package that I built on one of my Windows
> systems. I'm guessing that you unpacked that on a Linux system. Perhaps
> I misunderstand the point, but if the problem is in unpacking, then
> shouldn't I see it when the package is built on R 2.15.2 (not 2.5.2 --
> sorry, my typo)?
> 
> The puzzle is how you got execute permissions recorded for files on your Windows system.  They are not part of the Windows file system: Cygwin uses ACLs to emulate them.  Once the ACLs are there, a Cygwin-based tar will put them as permissions into the tarball.  But a native Windows tool would not (it might or might not capture the ACLs using a tar extension, but those would be ignored by most unpacking tools on a Unix-alike).
> 
> The issue is not really Windows: if you use a FAT file system on a Unix-alike you have the same problem -- this is why SMB mounts at least did not work on OS X for building R (and much else), and you need to be careful transferring directories via USB sticks (which are usually FAT-formatted).  That route usually makes the opposite compromise: to assume everything is executable.
> 
> >> What are those screen shots of?
> >
> > 7zip, which I use on Windows to manage file archives.
> 
> Ah, so that's a listing of the .tar.gz, a graphical form of tar -tvf.
> 
> >> R 2.5.2 was a very long time ago.  A recent change is
> >
> > Indeed. Again, that is my unfortunate typo -- I used 2.15.2. I wanted to confirm that I can build packages with the correct permissions on my Windows systems using an older (but recent) version of R.
> >
> >>
> >>       ? R CMD build by default uses the internal method of tar() to
> >>         prepare the tarball.  This is more likely to produce a tarball
> >>         compatible with R CMD INSTALL and R CMD check: an external tar
> >>         program, including options, can be specified _via_ the
> >>         environment variable R_BUILD_TAR.
> >>
> >
> > I saw that but didn't understand its import. That makes sense of a difference between R 2.15.2 and 3.0.0, though I'm not sure why this change would introduce a problem with the permissions.
> >
> >> Can you try using an external tar?  (Using the internal tar on Windows was first trialled in 2.15.3.)
> >>
> >
> > Yes, when I "set R_BUILD_TAR=tar" on my Windows 8 system, the tarball for the package is built with the correct permissions under R 3.0.0. The tar should be found in the Rtools\bin directory, which is first on my path. I don't have Cygwin installed on this machine independently of Rtools.
> >
> > What's curious to me is that I'm seeing the problem on two different Windows system but, AFAIK, no one else has experienced a similar problem.
> 
> Very few Windows users will ever get a file that appears to 'tar' to have execute permissions.  For example, svn checkouts on Windows lose execute permissions, something which has caught me for time to time over the years.
> 
> > Thanks for your help,
> >   John
> >
> >>
> >> On 14/04/2013 22:17, John Fox wrote:
> >>> Dear list members,
> >>>
> >>> I'm experiencing a file permissions problem with a package built under
> >>> Windows with R 3.0.0. I've encountered the problem on two Windows computers,
> >>> one running Windows 7 and the other Windows 8, and both when I build the
> >>> package under RStudio or directly in a Windows console via "R CMD build".
> >>>
> >>> In particular, the cleanup file for the package, which as I understand it
> >>> should have permissions set at rwx-r-r, instead has permissions rw-rw-rw.
> >>> I've attached two .png screen shots showing how the permissions are set when
> >>> the package is built under R 2.5.2 and R 3.0.0.
> >>>
> >>> I think that my two Windows systems are reasonably vanilla. Here are the
> >>> system and session info from R 3.0.0 run from a Windows console:
> >>>
> >>>> Sys.info()
> >>>                        sysname                      release
> >>>                      "Windows"                      "7 x64"
> >>>                        version                     nodename
> >>> "build 7601, Service Pack 1"              "JOHN-DELL-XPS"
> >>>                        machine                        login
> >>>                          "x86"                       "User"
> >>>                           user               effective_user
> >>>                         "User"                       "User"
> >>>
> >>>> sessionInfo()
> >>> R version 3.0.0 (2013-04-03)
> >>> Platform: i386-w64-mingw32/i386 (32-bit)
> >>>
> >>> locale:
> >>> [1] LC_COLLATE=English_United States.1252
> >>> [2] LC_CTYPE=English_United States.1252
> >>> [3] LC_MONETARY=English_United States.1252
> >>> [4] LC_NUMERIC=C
> >>> [5] LC_TIME=English_United States.1252
> >>>
> >>> attached base packages:
> >>> [1] stats     graphics  grDevices utils     datasets  methods   base
> >>>
> >>> I have the latest Rtools30 installed and on my path:
> >>>
> >>>> Sys.which("tar.exe")
> >>>                      tar.exe
> >>> "c:\\Rtools\\bin\\tar.exe"
> >>>
> >>> Is this a general problem or is it possible that there's something about my
> >>> Windows configurations that's causing it?
> >>>
> >>> Any information would be appreciated.
> >>>
> >>> John
> >>>
> >>> -----------------------------------------------
> >>> John Fox
> >>> Senator McMaster Professor of Social Statistics
> >>> Department of Sociology
> >>> McMaster University
> >>> Hamilton, Ontario, Canada
> >>>
> >>>
> >>>
> >>>
> >>> ______________________________________________
> >>> R-devel at r-project.org mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>>
> >>
> >>
> >> --
> >> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> >> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> >> University of Oxford,             Tel:  +44 1865 272861 (self)
> >> 1 South Parks Road,                     +44 1865 272866 (PA)
> >> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From adrian at trapletti.org  Tue Apr 16 13:20:23 2013
From: adrian at trapletti.org (Adrian Trapletti)
Date: Tue, 16 Apr 2013 13:20:23 +0200
Subject: [Rd] R package with Java source code
Message-ID: <516D33F7.9070606@trapletti.org>

Dear All,

Are there any plans around that "R CMD INSTALL 
some_package_containing_java_source code" supports Java source code 
compiling in future versions of R similar to compiling C/C++ and/or 
Fortran sources in the src directory?

Best regards
Adrian

-- 
Dr. Adrian Trapletti
Steinstrasse 9b
CH-8610 Uster
Switzerland

Phone : +41 (0) 44 9945630
Mobile : +41 (0) 79 1037131

Email : adrian at trapletti.org
WWW : www.trapletti.org


From murdoch.duncan at gmail.com  Tue Apr 16 13:33:27 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 16 Apr 2013 07:33:27 -0400
Subject: [Rd] R package with Java source code
In-Reply-To: <516D33F7.9070606@trapletti.org>
References: <516D33F7.9070606@trapletti.org>
Message-ID: <516D3707.7020704@gmail.com>

On 13-04-16 7:20 AM, Adrian Trapletti wrote:
> Dear All,
>
> Are there any plans around that "R CMD INSTALL
> some_package_containing_java_source code" supports Java source code
> compiling in future versions of R similar to compiling C/C++ and/or
> Fortran sources in the src directory?

None that I know of.  You can do it already (using your own Makevars or 
Makefile) but you will run into trouble on systems that don't have the 
Java compiler installed, e.g. Windows systems typically don't.

Duncan Murdoch


From ripley at stats.ox.ac.uk  Tue Apr 16 13:44:52 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 16 Apr 2013 12:44:52 +0100
Subject: [Rd] R package with Java source code
In-Reply-To: <516D33F7.9070606@trapletti.org>
References: <516D33F7.9070606@trapletti.org>
Message-ID: <516D39B4.5080100@stats.ox.ac.uk>

On 16/04/2013 12:20, Adrian Trapletti wrote:
> Dear All,
>
> Are there any plans around that "R CMD INSTALL
> some_package_containing_java_source code" supports Java source code
> compiling in future versions of R similar to compiling C/C++ and/or
> Fortran sources in the src directory?
>
> Best regards
> Adrian
>

No.  A Java 'compiler' is not required, but if one is available is it is 
set in etc/Makeconf as JAVAC.

There are many packages which ship jar files with 'compiled' Java code, 
and others with .class files.  It is hard to see a case for compiling at 
install time rather than when preparing the package.  But it would be 
easy to write a suitable rule in src/Makevars.

Note that most systems will not have a JDK, only a JRE.  That includes 
Windows systems, but winbuilder should be able to prepare a binary 
package (it needs a JDK to install rJava, JavaJD ...).

One needs to be slightly careful with Java version requirements.  AFAIR 
OS X Leopard systems only had 1.5 (at least for one of the 
architectures) and R 2.15.x still supported Leopard (and packages are 
still being built for it).  Systems with Java 1.6 aka 6 are still in 
widespread use, even if it past end-of-life according to Oracle.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Tue Apr 16 15:20:21 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 16 Apr 2013 14:20:21 +0100
Subject: [Rd] package file permissions problem R 3.0.0/Windows OS
In-Reply-To: <web-453468600@cgpsrv2.cis.mcmaster.ca>
References: <002201ce3955$7ff88580$7fe99080$@mcmaster.ca>
	<516B968A.8070704@stats.ox.ac.uk>
	<web-453347265@cgpsrv2.cis.mcmaster.ca>
	<516C52B9.9020605@stats.ox.ac.uk>
	<web-453468600@cgpsrv2.cis.mcmaster.ca>
Message-ID: <516D5015.8090300@stats.ox.ac.uk>

John,

Taking this off-list.   I suspect this is pretty much unique to you, but 
we will see.  I am about to add a para to 'Writing R Extensions' along 
the lines of

'Where a non-POSIX file system is in use which does not utilize execute 
permissions, some care is needed with permissions. This applies on 
Windows and to e.g. FAT-formatted drives and SMB-mounted file systems on 
other OSes. The ?mode? of the file recorded in the tarball will be 
whatever file.info() returns. On Windows this will record only 
directories with execute permission and on other OSes it is likely that 
all files have reported ?mode? 0777. A particular issue is packages 
being built on Windows which are intended to contain executable scripts 
such as configure and cleanup: it is difficult to include these from 
Windows but where Cygwin has been used to set a POSIX-like mode, using 
environment variable R_BUILD_TAR=tar.exe may provide a workaround.'

Brian

On 15/04/2013 21:28, John Fox wrote:
> Dear Brian,
>
> I hope that I can clarify the issue and not confuse it further. I apologize if I was less than clear.
>
> I originally built the tarball for the sem package on my Windows 7 system using "R CMD build" via RStudio with R 3.0.0. Both my Windows 7 system and the Windows 8 system that I subsequently also used to build the package tarball use the NTFS file system. Of course, these are Windows file systems and don't use the Unix permission scheme, but there are apparently permissions recorded in the tarball, and they caused problems for you when I submitted the package to CRAN. The permissions are visible when I look inside the tarball, e.g., with 7zip.
>
> When I rebuilt the package using "R CMD build" with R 2.15.2 (as opposed to 3.0.0) on both of these Windows systems, the permissions inside the tarball were correct.
>
> I never built the package on my Linux system, although I did try building it on my Mac. I obtained correct permissions inside the tarball when I did, which isn't surprising.
>
> If it's the case that package tarballs built under Windows don't have execute permissions set where these are needed (as for cleanup), won't you have the same problem when such tarballs are submitted to CRAN that you had with the sem package?
>
> Also, I'm still not clear why the execute permissions were set properly when I created the tarball having set R_BUILD_TAR=tar or using R 2.15.2.
>
> To reiterate, if this issue is unique to me, I can certainly work around it. I know that it's hard to diagnose this kind of problem long-distance via email.
>
> Best,
>   John
>
> On Mon, 15 Apr 2013 20:19:21 +0100
>   Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>> On 15/04/2013 14:11, John Fox wrote:
>>> Dear Brian,
>>>
>>> On Mon, 15 Apr 2013 06:56:26 +0100
>>>    Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>>>> POSIX-style execute permission isn't a Windows concept, so it was fortuitous this ever worked.  One possibility is that Cygwin was involved, and a Cygwin emulation got set when tar unpacked the file and converted back to the tar representation when Cygwin tar produced the tarball. (The tar in Rtools is a fixed version of Cygwin tar, fixed to use Windows file paths.)
>>>>
>>>
>>> Recall that the problem was first detected when I submitted to CRAN
>>> a
>> new version of the sem package that I built on one of my Windows
>> systems. I'm guessing that you unpacked that on a Linux system. Perhaps
>> I misunderstand the point, but if the problem is in unpacking, then
>> shouldn't I see it when the package is built on R 2.15.2 (not 2.5.2 --
>> sorry, my typo)?
>>
>> The puzzle is how you got execute permissions recorded for files on your Windows system.  They are not part of the Windows file system: Cygwin uses ACLs to emulate them.  Once the ACLs are there, a Cygwin-based tar will put them as permissions into the tarball.  But a native Windows tool would not (it might or might not capture the ACLs using a tar extension, but those would be ignored by most unpacking tools on a Unix-alike).
>>
>> The issue is not really Windows: if you use a FAT file system on a Unix-alike you have the same problem -- this is why SMB mounts at least did not work on OS X for building R (and much else), and you need to be careful transferring directories via USB sticks (which are usually FAT-formatted).  That route usually makes the opposite compromise: to assume everything is executable.
>>
>>>> What are those screen shots of?
>>>
>>> 7zip, which I use on Windows to manage file archives.
>>
>> Ah, so that's a listing of the .tar.gz, a graphical form of tar -tvf.
>>
>>>> R 2.5.2 was a very long time ago.  A recent change is
>>>
>>> Indeed. Again, that is my unfortunate typo -- I used 2.15.2. I wanted to confirm that I can build packages with the correct permissions on my Windows systems using an older (but recent) version of R.
>>>
>>>>
>>>>        ? R CMD build by default uses the internal method of tar() to
>>>>          prepare the tarball.  This is more likely to produce a tarball
>>>>          compatible with R CMD INSTALL and R CMD check: an external tar
>>>>          program, including options, can be specified _via_ the
>>>>          environment variable R_BUILD_TAR.
>>>>
>>>
>>> I saw that but didn't understand its import. That makes sense of a difference between R 2.15.2 and 3.0.0, though I'm not sure why this change would introduce a problem with the permissions.
>>>
>>>> Can you try using an external tar?  (Using the internal tar on Windows was first trialled in 2.15.3.)
>>>>
>>>
>>> Yes, when I "set R_BUILD_TAR=tar" on my Windows 8 system, the tarball for the package is built with the correct permissions under R 3.0.0. The tar should be found in the Rtools\bin directory, which is first on my path. I don't have Cygwin installed on this machine independently of Rtools.
>>>
>>> What's curious to me is that I'm seeing the problem on two different Windows system but, AFAIK, no one else has experienced a similar problem.
>>
>> Very few Windows users will ever get a file that appears to 'tar' to have execute permissions.  For example, svn checkouts on Windows lose execute permissions, something which has caught me for time to time over the years.
>>
>>> Thanks for your help,
>>>    John
>>>
>>>>
>>>> On 14/04/2013 22:17, John Fox wrote:
>>>>> Dear list members,
>>>>>
>>>>> I'm experiencing a file permissions problem with a package built under
>>>>> Windows with R 3.0.0. I've encountered the problem on two Windows computers,
>>>>> one running Windows 7 and the other Windows 8, and both when I build the
>>>>> package under RStudio or directly in a Windows console via "R CMD build".
>>>>>
>>>>> In particular, the cleanup file for the package, which as I understand it
>>>>> should have permissions set at rwx-r-r, instead has permissions rw-rw-rw.
>>>>> I've attached two .png screen shots showing how the permissions are set when
>>>>> the package is built under R 2.5.2 and R 3.0.0.
>>>>>
>>>>> I think that my two Windows systems are reasonably vanilla. Here are the
>>>>> system and session info from R 3.0.0 run from a Windows console:
>>>>>
>>>>>> Sys.info()
>>>>>                         sysname                      release
>>>>>                       "Windows"                      "7 x64"
>>>>>                         version                     nodename
>>>>> "build 7601, Service Pack 1"              "JOHN-DELL-XPS"
>>>>>                         machine                        login
>>>>>                           "x86"                       "User"
>>>>>                            user               effective_user
>>>>>                          "User"                       "User"
>>>>>
>>>>>> sessionInfo()
>>>>> R version 3.0.0 (2013-04-03)
>>>>> Platform: i386-w64-mingw32/i386 (32-bit)
>>>>>
>>>>> locale:
>>>>> [1] LC_COLLATE=English_United States.1252
>>>>> [2] LC_CTYPE=English_United States.1252
>>>>> [3] LC_MONETARY=English_United States.1252
>>>>> [4] LC_NUMERIC=C
>>>>> [5] LC_TIME=English_United States.1252
>>>>>
>>>>> attached base packages:
>>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>>>
>>>>> I have the latest Rtools30 installed and on my path:
>>>>>
>>>>>> Sys.which("tar.exe")
>>>>>                       tar.exe
>>>>> "c:\\Rtools\\bin\\tar.exe"
>>>>>
>>>>> Is this a general problem or is it possible that there's something about my
>>>>> Windows configurations that's causing it?
>>>>>
>>>>> Any information would be appreciated.
>>>>>
>>>>> John
>>>>>
>>>>> -----------------------------------------------
>>>>> John Fox
>>>>> Senator McMaster Professor of Social Statistics
>>>>> Department of Sociology
>>>>> McMaster University
>>>>> Hamilton, Ontario, Canada
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>
>>>>
>>>> --
>>>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>>>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>>>> University of Oxford,             Tel:  +44 1865 272861 (self)
>>>> 1 South Parks Road,                     +44 1865 272866 (PA)
>>>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From adrian at trapletti.org  Tue Apr 16 15:56:56 2013
From: adrian at trapletti.org (Adrian Trapletti)
Date: Tue, 16 Apr 2013 15:56:56 +0200
Subject: [Rd] R package with Java source code
In-Reply-To: <516D39B4.5080100@stats.ox.ac.uk>
References: <516D33F7.9070606@trapletti.org> <516D39B4.5080100@stats.ox.ac.uk>
Message-ID: <516D58A8.1000000@trapletti.org>

I don't really like the approach which ship the redundant jar files 
unless it is a "precompiled binary" distribution of a package.

In the meantime I found the following suggestion 
http://romainfrancois.blog.free.fr/index.php?post/2009/03/26/Hello-Java-World 
which is close to what I was thinking of.

Anyhow thanks for the comments.

Best regards
Adrian

On 04/16/2013 01:44 PM, Prof Brian Ripley wrote:
> On 16/04/2013 12:20, Adrian Trapletti wrote:
>> Dear All,
>>
>> Are there any plans around that "R CMD INSTALL
>> some_package_containing_java_source code" supports Java source code
>> compiling in future versions of R similar to compiling C/C++ and/or
>> Fortran sources in the src directory?
>>
>> Best regards
>> Adrian
>>
>
> No.  A Java 'compiler' is not required, but if one is available is it 
> is set in etc/Makeconf as JAVAC.
>
> There are many packages which ship jar files with 'compiled' Java 
> code, and others with .class files.  It is hard to see a case for 
> compiling at install time rather than when preparing the package. But 
> it would be easy to write a suitable rule in src/Makevars.
>
> Note that most systems will not have a JDK, only a JRE.  That includes 
> Windows systems, but winbuilder should be able to prepare a binary 
> package (it needs a JDK to install rJava, JavaJD ...).
>
> One needs to be slightly careful with Java version requirements. AFAIR 
> OS X Leopard systems only had 1.5 (at least for one of the 
> architectures) and R 2.15.x still supported Leopard (and packages are 
> still being built for it).  Systems with Java 1.6 aka 6 are still in 
> widespread use, even if it past end-of-life according to Oracle.
>

-- 
Dr. Adrian Trapletti
Steinstrasse 9b
CH-8610 Uster
Switzerland

Phone : +41 (0) 44 9945630
Mobile : +41 (0) 79 1037131

Email : adrian at trapletti.org
WWW : www.trapletti.org


From simon.urbanek at r-project.org  Tue Apr 16 16:42:41 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 16 Apr 2013 10:42:41 -0400
Subject: [Rd] R package with Java source code
In-Reply-To: <516D58A8.1000000@trapletti.org>
References: <516D33F7.9070606@trapletti.org> <516D39B4.5080100@stats.ox.ac.uk>
	<516D58A8.1000000@trapletti.org>
Message-ID: <5157CBF3-2CEA-45B9-B63D-77CC841559DC@r-project.org>

On Apr 16, 2013, at 9:56 AM, Adrian Trapletti wrote:

> I don't really like the approach which ship the redundant jar files unless it is a "precompiled binary" distribution of a package.
> 

What do you mean by "redundant"? Your package won't work without them ...


> In the meantime I found the following suggestion http://romainfrancois.blog.free.fr/index.php?post/2009/03/26/Hello-Java-World which is close to what I was thinking of.
> 

Well, that's in essence what has been suggested. The point is that *you* have to run build before you publish the package to create the jar file, it can't be done at install time for reasons explained.

Cheers,
Simon


> Anyhow thanks for the comments.
> 
> Best regards
> Adrian
> 
> On 04/16/2013 01:44 PM, Prof Brian Ripley wrote:
>> On 16/04/2013 12:20, Adrian Trapletti wrote:
>>> Dear All,
>>> 
>>> Are there any plans around that "R CMD INSTALL
>>> some_package_containing_java_source code" supports Java source code
>>> compiling in future versions of R similar to compiling C/C++ and/or
>>> Fortran sources in the src directory?
>>> 
>>> Best regards
>>> Adrian
>>> 
>> 
>> No.  A Java 'compiler' is not required, but if one is available is it is set in etc/Makeconf as JAVAC.
>> 
>> There are many packages which ship jar files with 'compiled' Java code, and others with .class files.  It is hard to see a case for compiling at install time rather than when preparing the package. But it would be easy to write a suitable rule in src/Makevars.
>> 
>> Note that most systems will not have a JDK, only a JRE.  That includes Windows systems, but winbuilder should be able to prepare a binary package (it needs a JDK to install rJava, JavaJD ...).
>> 
>> One needs to be slightly careful with Java version requirements. AFAIR OS X Leopard systems only had 1.5 (at least for one of the architectures) and R 2.15.x still supported Leopard (and packages are still being built for it).  Systems with Java 1.6 aka 6 are still in widespread use, even if it past end-of-life according to Oracle.
>> 
> 
> -- 
> Dr. Adrian Trapletti
> Steinstrasse 9b
> CH-8610 Uster
> Switzerland
> 
> Phone : +41 (0) 44 9945630
> Mobile : +41 (0) 79 1037131
> 
> Email : adrian at trapletti.org
> WWW : www.trapletti.org
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From nalimilan at club-internet.fr  Tue Apr 16 16:12:29 2013
From: nalimilan at club-internet.fr (Milan Bouchet-Valat)
Date: Tue, 16 Apr 2013 16:12:29 +0200
Subject: [Rd] Hosting Omegahat package on CRAN?
Message-ID: <455797807.160666.1366121549445.JavaMail.www@wsfrf1325>

Hi list!

For a package providing a GUI intended in particular at R newcomers (RcmdrPlugin.temis[1]), I would like to use the Rstem package [2] by Duncan Temple Lang, which is hosted on Omegahat only. This means the package cannot be installed automatically as a dependency, which I can work around by installing the package from my code when the user needs it. But Omegahat does not provide binaries for Mac OS X, and still does not provide Windows binaries for R 3.0. This is a showstopper for my intended audience, as I cannot ask them to install a working build environment.

What is the best solution here? As Rstem does not have any special dependencies other than a C compiler, uploading it on CRAN would magically make all of these issues go away. I could create a package with a different name but the same contents and upload it to CRAN, but this is sub-optimal. I can also integrate Rstem's code into my package, but this is not really better.


FWIW, the same issue exists with ROpenOffice, though it also depends on RCompression, which makes things slightly more complex.


Regards



1: http://cran.r-project.org/web/packages/RcmdrPlugin.temis/
2: http://www.omegahat.org/Rstem/


From adrian at trapletti.org  Tue Apr 16 17:35:36 2013
From: adrian at trapletti.org (Adrian Trapletti)
Date: Tue, 16 Apr 2013 17:35:36 +0200
Subject: [Rd] R package with Java source code
In-Reply-To: <5157CBF3-2CEA-45B9-B63D-77CC841559DC@r-project.org>
References: <516D33F7.9070606@trapletti.org> <516D39B4.5080100@stats.ox.ac.uk>
	<516D58A8.1000000@trapletti.org>
	<5157CBF3-2CEA-45B9-B63D-77CC841559DC@r-project.org>
Message-ID: <516D6FC8.3070703@trapletti.org>


On 04/16/2013 04:42 PM, Simon Urbanek wrote:
> On Apr 16, 2013, at 9:56 AM, Adrian Trapletti wrote:
>
>> I don't really like the approach which ship the redundant jar files unless it is a "precompiled binary" distribution of a package.
>>
> What do you mean by "redundant"?
jars are often not under version control because of their redundancy and 
all the resulting problems.
> Your package won't work without them ...
:-) yes, I know this (> 20 years of experience with Java, slightly less 
with R).

>> In the meantime I found the following suggestion http://romainfrancois.blog.free.fr/index.php?post/2009/03/26/Hello-Java-World which is close to what I was thinking of.
>>
> Well, that's in essence what has been suggested. The point is that *you* have to run build before you publish the package to create the jar file, it can't be done at install time for reasons explained.

My question was not very precise. In fact I wanted to ask about Java 
source code compilation during the build step.

Best regards
Adrian


>
> Cheers,
> Simon
>
>
>> Anyhow thanks for the comments.
>>
>> Best regards
>> Adrian
>>
>> On 04/16/2013 01:44 PM, Prof Brian Ripley wrote:
>>> On 16/04/2013 12:20, Adrian Trapletti wrote:
>>>> Dear All,
>>>>
>>>> Are there any plans around that "R CMD INSTALL
>>>> some_package_containing_java_source code" supports Java source code
>>>> compiling in future versions of R similar to compiling C/C++ and/or
>>>> Fortran sources in the src directory?
>>>>
>>>> Best regards
>>>> Adrian
>>>>
>>> No.  A Java 'compiler' is not required, but if one is available is it is set in etc/Makeconf as JAVAC.
>>>
>>> There are many packages which ship jar files with 'compiled' Java code, and others with .class files.  It is hard to see a case for compiling at install time rather than when preparing the package. But it would be easy to write a suitable rule in src/Makevars.
>>>
>>> Note that most systems will not have a JDK, only a JRE.  That includes Windows systems, but winbuilder should be able to prepare a binary package (it needs a JDK to install rJava, JavaJD ...).
>>>
>>> One needs to be slightly careful with Java version requirements. AFAIR OS X Leopard systems only had 1.5 (at least for one of the architectures) and R 2.15.x still supported Leopard (and packages are still being built for it).  Systems with Java 1.6 aka 6 are still in widespread use, even if it past end-of-life according to Oracle.
>>>
>> -- 
>> Dr. Adrian Trapletti
>> Steinstrasse 9b
>> CH-8610 Uster
>> Switzerland
>>
>> Phone : +41 (0) 44 9945630
>> Mobile : +41 (0) 79 1037131
>>
>> Email : adrian at trapletti.org
>> WWW : www.trapletti.org
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>

-- 
Dr. Adrian Trapletti
Steinstrasse 9b
CH-8610 Uster
Switzerland

Phone : +41 (0) 44 9945630
Mobile : +41 (0) 79 1037131

Email : adrian at trapletti.org
WWW : www.trapletti.org


From simon.urbanek at r-project.org  Tue Apr 16 17:49:53 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 16 Apr 2013 11:49:53 -0400
Subject: [Rd] R package with Java source code
In-Reply-To: <516D6FC8.3070703@trapletti.org>
References: <516D33F7.9070606@trapletti.org> <516D39B4.5080100@stats.ox.ac.uk>
	<516D58A8.1000000@trapletti.org>
	<5157CBF3-2CEA-45B9-B63D-77CC841559DC@r-project.org>
	<516D6FC8.3070703@trapletti.org>
Message-ID: <0D1F53AA-C83F-4AE2-83E5-C85C49A6C8B6@r-project.org>


On Apr 16, 2013, at 11:35 AM, Adrian Trapletti wrote:

> 
> On 04/16/2013 04:42 PM, Simon Urbanek wrote:
>> On Apr 16, 2013, at 9:56 AM, Adrian Trapletti wrote:
>> 
>>> I don't really like the approach which ship the redundant jar files unless it is a "precompiled binary" distribution of a package.
>>> 
>> What do you mean by "redundant"?
> jars are often not under version control because of their redundancy and all the resulting problems.

Yes, you certainly don't want them under version control - you said yourself "ship" which is the built source tar ball, not your repository ;).


>> Your package won't work without them ...
> :-) yes, I know this (> 20 years of experience with Java, slightly less with R).
> 
>>> In the meantime I found the following suggestion http://romainfrancois.blog.free.fr/index.php?post/2009/03/26/Hello-Java-World which is close to what I was thinking of.
>>> 
>> Well, that's in essence what has been suggested. The point is that *you* have to run build before you publish the package to create the jar file, it can't be done at install time for reasons explained.
> 
> My question was not very precise. In fact I wanted to ask about Java source code compilation during the build step.
> 

Yes. Given that this is done under your control, there is not much support you need from R. The preferred setup is very individual (e.g. I avoid ant in my Java packages), so I don't think it's R's place to step in at that stage. I did consider adding some primitives, but given the individuality I just opted for conventions (like inst/java as a distribution place).

Cheers,
Simon


> Best regards
> Adrian
> 
> 
>> 
>> Cheers,
>> Simon
>> 
>> 
>>> Anyhow thanks for the comments.
>>> 
>>> Best regards
>>> Adrian
>>> 
>>> On 04/16/2013 01:44 PM, Prof Brian Ripley wrote:
>>>> On 16/04/2013 12:20, Adrian Trapletti wrote:
>>>>> Dear All,
>>>>> 
>>>>> Are there any plans around that "R CMD INSTALL
>>>>> some_package_containing_java_source code" supports Java source code
>>>>> compiling in future versions of R similar to compiling C/C++ and/or
>>>>> Fortran sources in the src directory?
>>>>> 
>>>>> Best regards
>>>>> Adrian
>>>>> 
>>>> No.  A Java 'compiler' is not required, but if one is available is it is set in etc/Makeconf as JAVAC.
>>>> 
>>>> There are many packages which ship jar files with 'compiled' Java code, and others with .class files.  It is hard to see a case for compiling at install time rather than when preparing the package. But it would be easy to write a suitable rule in src/Makevars.
>>>> 
>>>> Note that most systems will not have a JDK, only a JRE.  That includes Windows systems, but winbuilder should be able to prepare a binary package (it needs a JDK to install rJava, JavaJD ...).
>>>> 
>>>> One needs to be slightly careful with Java version requirements. AFAIR OS X Leopard systems only had 1.5 (at least for one of the architectures) and R 2.15.x still supported Leopard (and packages are still being built for it).  Systems with Java 1.6 aka 6 are still in widespread use, even if it past end-of-life according to Oracle.
>>>> 
>>> -- 
>>> Dr. Adrian Trapletti
>>> Steinstrasse 9b
>>> CH-8610 Uster
>>> Switzerland
>>> 
>>> Phone : +41 (0) 44 9945630
>>> Mobile : +41 (0) 79 1037131
>>> 
>>> Email : adrian at trapletti.org
>>> WWW : www.trapletti.org
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>>> 
> 
> -- 
> Dr. Adrian Trapletti
> Steinstrasse 9b
> CH-8610 Uster
> Switzerland
> 
> Phone : +41 (0) 44 9945630
> Mobile : +41 (0) 79 1037131
> 
> Email : adrian at trapletti.org
> WWW : www.trapletti.org
> 
> 


From ripley at stats.ox.ac.uk  Wed Apr 17 10:15:57 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 17 Apr 2013 09:15:57 +0100
Subject: [Rd] support for POSIXct classes in image.default axes
In-Reply-To: <CAAcGz9-aTEH-hfwbE53r1tchdxCYdNHT7qmcvrJLPSoyrv99aQ@mail.gmail.com>
References: <CAAcGz9-aTEH-hfwbE53r1tchdxCYdNHT7qmcvrJLPSoyrv99aQ@mail.gmail.com>
Message-ID: <516E5A3D.7060201@stats.ox.ac.uk>

On 12/04/2013 12:27, Michael Sumner wrote:
> Hello, I would like to suggest the following change to image.default in
> src\library\graphics\R\image.R:
>
> 98c98
> <       plot(NA, NA, xlim = xlim, ylim = ylim, type = "n", xaxs = xaxs,
> ---
>>        plot(x[1], y[1], xlim = xlim, ylim = ylim, type = "n", xaxs = xaxs,
>

I think xlim, ylim is a better idea: this relies on range() preserving 
the class.

Done now (in R-devel pro tem).

> This provides all the support of axis.POSIXt that plot.default gives,
> currently the default new plot in image.default uses NAs and the axis class
> is ignored. This is nice for plotting time series data stored in a matrix.
>
> Here's a dummy example that shows usage with my change:
>
> data(volcano)
> x <- list(x = Sys.time() + seq(1, 1e6, length = nrow(volcano)), y =
> 1:ncol(volcano), z = volcano)
>
> ## date-time formatting on the x-axis
> image(x)
>
> ## date-time formatting on the y-axis
> image(x$y, x$x, t(x$z))
>
> Without the change we get the very large underlying numeric values for the
> times on the axis.
>
> We can still override the default axis to do a workaround: :
> image(x, axes = FALSE)
> axis.POSIXct(x$x, side = 1)
>
> Cheers, Mike.
>
>
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From yijuan.hu at emory.edu  Wed Apr 17 03:08:13 2013
From: yijuan.hu at emory.edu (yhu30)
Date: Tue, 16 Apr 2013 18:08:13 -0700 (PDT)
Subject: [Rd] New code in R-devel: Rao score test for glm.
In-Reply-To: <3B67DBA8-A457-4966-A0E1-A3FA6E6EAF92@gmail.com>
References: <3B67DBA8-A457-4966-A0E1-A3FA6E6EAF92@gmail.com>
Message-ID: <1366160892998-4664440.post@n4.nabble.com>

Hi Dr. Dalgaard,

I just googled one of your old posts and find it very useful. I am very
curious about whether your code which implements the score test have been
implemented in the glm function of R (instead of the development version of
R). Thanks a lot!

Yijuan



--
View this message in context: http://r.789695.n4.nabble.com/New-code-in-R-devel-Rao-score-test-for-glm-tp3514262p4664440.html
Sent from the R devel mailing list archive at Nabble.com.


From pdalgd at gmail.com  Wed Apr 17 13:53:19 2013
From: pdalgd at gmail.com (peter dalgaard)
Date: Wed, 17 Apr 2013 13:53:19 +0200
Subject: [Rd] New code in R-devel: Rao score test for glm.
In-Reply-To: <1366160892998-4664440.post@n4.nabble.com>
References: <3B67DBA8-A457-4966-A0E1-A3FA6E6EAF92@gmail.com>
	<1366160892998-4664440.post@n4.nabble.com>
Message-ID: <E8D1BD23-ED5D-40FF-BC00-A631A9A37BB2@gmail.com>

(R-devel is not "Dr. Dalgaard"....)

It's been there since 2.14.0. (So the post was presumably when 2.13.x was current.)

-pd

On Apr 17, 2013, at 03:08 , yhu30 wrote:

> Hi Dr. Dalgaard,
> 
> I just googled one of your old posts and find it very useful. I am very
> curious about whether your code which implements the score test have been
> implemented in the glm function of R (instead of the development version of
> R). Thanks a lot!
> 
> Yijuan
> 
> 
> 
> --
> View this message in context: http://r.789695.n4.nabble.com/New-code-in-R-devel-Rao-score-test-for-glm-tp3514262p4664440.html
> Sent from the R devel mailing list archive at Nabble.com.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From mdsumner at gmail.com  Wed Apr 17 14:09:51 2013
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 17 Apr 2013 22:09:51 +1000
Subject: [Rd] support for POSIXct classes in image.default axes
In-Reply-To: <516E5A3D.7060201@stats.ox.ac.uk>
References: <CAAcGz9-aTEH-hfwbE53r1tchdxCYdNHT7qmcvrJLPSoyrv99aQ@mail.gmail.com>
	<516E5A3D.7060201@stats.ox.ac.uk>
Message-ID: <CAAcGz98PwZNsuDHPe2ByFwrdCUQE_9nDdZA2DyN64eerPyvgOQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130417/63ed03f3/attachment.pl>

From wdunlap at tibco.com  Wed Apr 17 22:10:58 2013
From: wdunlap at tibco.com (William Dunlap)
Date: Wed, 17 Apr 2013 20:10:58 +0000
Subject: [Rd] POSIXt oddness at end of 1969
Message-ID: <E66794E69CFDE04D9A70842786030B931C2DA557@PA-MBX01.na.tibco.com>

A user here noticed the following difference between Linux and Windows versions
of R-2.15.3 (and R-3.0.0, I think) when using times within a second of the end of 1969:

f <- function (sec = -1) 
{
    x1 <- as.POSIXct(c(2 * sec, sec, 0), origin = "1970-01-01",  tz = "UTC")
    x2 <- as.POSIXlt(x1)
    x3 <- as.POSIXct(x2, origin = "1970-01-01", tz = "UTC")
    list(x1 = x1, x2 = x2, x3 = x3)
}

On Windows I get:
  > f(-1)
  $x1
  [1] "1969-12-31 23:59:58 UTC"
  [2] "1969-12-31 23:59:59 UTC"
  [3] "1970-01-01 00:00:00 UTC"

  $x2
  [1] "1969-12-31 23:59:58 UTC"
  [2] "1969-12-31 23:59:59 UTC"
  [3] "1970-01-01 00:00:00 UTC"
  
  $x3
  [1] "1969-12-31 23:59:58 UTC"
  [2] "1969-12-31 23:59:59 UTC"
  [3] "1970-01-01 00:00:00 UTC"

On Linux I get an NA in x3 for 1 second before 1970:
  > f(-1)
  $x1
  [1] "1969-12-31 23:59:58 UTC"
  [2] "1969-12-31 23:59:59 UTC"
  [3] "1970-01-01 00:00:00 UTC"
  
  $x2
  [1] "1969-12-31 23:59:58 UTC"
  [2] "1969-12-31 23:59:59 UTC"
  [3] "1970-01-01 00:00:00 UTC"
  
  $x3
  [1] "1969-12-31 23:59:58 UTC"
  [2] NA
  [3] "1970-01-01 00:00:00 UTC"

On Windows, sessionInfo() is
  R version 2.15.3 (2013-03-01)
  Platform: x86_64-w64-mingw32/x64 (64-bit)
  
  locale:
  [1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252   
  [3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C                          
  [5] LC_TIME=English_United States.1252    
  
  attached base packages:
  [1] stats     graphics  grDevices utils     datasets  methods   base     

On Linux,  sessionInfo() is
  > sessionInfo()
  R version 2.15.3 (2013-03-01)
  Platform: x86_64-unknown-linux-gnu (64-bit)
  
  locale:
   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=en_US.UTF-8
   [4] LC_COLLATE=en_US.UTF-8     LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
   [7] LC_PAPER=C                 LC_NAME=C                  LC_ADDRESS=C
  [10] LC_TELEPHONE=C             LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

  attached base packages:
  [1] stats     graphics  grDevices utils     datasets  methods   base

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com


From lawrence.michael at gene.com  Wed Apr 17 22:25:14 2013
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Wed, 17 Apr 2013 13:25:14 -0700
Subject: [Rd] stack imbalance in max.col for non-real matrices
Message-ID: <CAOQ5NyeJ_PNB3ehDQU9FPchEy+A14fKmhunFnGm4AN8BLpZG=Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130417/95e44f17/attachment.pl>

From pdalgd at gmail.com  Wed Apr 17 23:16:22 2013
From: pdalgd at gmail.com (peter dalgaard)
Date: Wed, 17 Apr 2013 23:16:22 +0200
Subject: [Rd] POSIXt oddness at end of 1969
In-Reply-To: <E66794E69CFDE04D9A70842786030B931C2DA557@PA-MBX01.na.tibco.com>
References: <E66794E69CFDE04D9A70842786030B931C2DA557@PA-MBX01.na.tibco.com>
Message-ID: <E6496482-B5C1-416F-AE1D-DC61D36DC188@gmail.com>

Same thing happens on OS X. A bit of googling (did you know that Jimi Hendrix and the Band of Gypsies played at the Fillmore East on December 31, 1969?) reveals that the root issue is that mktime() returns -1 if the calendar time cannot be represented, which makes the case where the time _can_ be represented as -1 a bit tricky!

People have come up with heuristics to detect this case, but I wonder if it's worth it. Take a look at
http://stackoverflow.com/questions/14049047/unix-c-get-time-at-a-different-zone

There has to be a simpler way, though. 

-pd

On Apr 17, 2013, at 22:10 , William Dunlap wrote:

> A user here noticed the following difference between Linux and Windows versions
> of R-2.15.3 (and R-3.0.0, I think) when using times within a second of the end of 1969:
> 
> f <- function (sec = -1) 
> {
>    x1 <- as.POSIXct(c(2 * sec, sec, 0), origin = "1970-01-01",  tz = "UTC")
>    x2 <- as.POSIXlt(x1)
>    x3 <- as.POSIXct(x2, origin = "1970-01-01", tz = "UTC")
>    list(x1 = x1, x2 = x2, x3 = x3)
> }
> 
> On Windows I get:
>> f(-1)
>  $x1
>  [1] "1969-12-31 23:59:58 UTC"
>  [2] "1969-12-31 23:59:59 UTC"
>  [3] "1970-01-01 00:00:00 UTC"
> 
>  $x2
>  [1] "1969-12-31 23:59:58 UTC"
>  [2] "1969-12-31 23:59:59 UTC"
>  [3] "1970-01-01 00:00:00 UTC"
> 
>  $x3
>  [1] "1969-12-31 23:59:58 UTC"
>  [2] "1969-12-31 23:59:59 UTC"
>  [3] "1970-01-01 00:00:00 UTC"
> 
> On Linux I get an NA in x3 for 1 second before 1970:
>> f(-1)
>  $x1
>  [1] "1969-12-31 23:59:58 UTC"
>  [2] "1969-12-31 23:59:59 UTC"
>  [3] "1970-01-01 00:00:00 UTC"
> 
>  $x2
>  [1] "1969-12-31 23:59:58 UTC"
>  [2] "1969-12-31 23:59:59 UTC"
>  [3] "1970-01-01 00:00:00 UTC"
> 
>  $x3
>  [1] "1969-12-31 23:59:58 UTC"
>  [2] NA
>  [3] "1970-01-01 00:00:00 UTC"
> 
> On Windows, sessionInfo() is
>  R version 2.15.3 (2013-03-01)
>  Platform: x86_64-w64-mingw32/x64 (64-bit)
> 
>  locale:
>  [1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252   
>  [3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C                          
>  [5] LC_TIME=English_United States.1252    
> 
>  attached base packages:
>  [1] stats     graphics  grDevices utils     datasets  methods   base     
> 
> On Linux,  sessionInfo() is
>> sessionInfo()
>  R version 2.15.3 (2013-03-01)
>  Platform: x86_64-unknown-linux-gnu (64-bit)
> 
>  locale:
>   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=en_US.UTF-8
>   [4] LC_COLLATE=en_US.UTF-8     LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>   [7] LC_PAPER=C                 LC_NAME=C                  LC_ADDRESS=C
>  [10] LC_TELEPHONE=C             LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
> 
>  attached base packages:
>  [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> Bill Dunlap
> Spotfire, TIBCO Software
> wdunlap tibco.com
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From pauljohn32 at gmail.com  Thu Apr 18 05:39:33 2013
From: pauljohn32 at gmail.com (Paul Johnson)
Date: Wed, 17 Apr 2013 22:39:33 -0500
Subject: [Rd] Patch proposal for R style consistency (concerning deparse.c)
Message-ID: <CAErODj85saboM+8SaYKKVVDL6cPeX=LVR=PKwY+FZb2ky_cpBg@mail.gmail.com>

Hello, everybody.

I recognize I'm asking you to deal with a not-very-important problem.
But its important to me :)

I've noticed a little inconsistency in the print.function() output. I
traced the matter to deparse.c, for which I attach a patch that
addresses 3 separate things. There's one important thing that I'm
willing to stand behind and 2 litter things that I think would be
good, but won't argue too much about. I ask if this is a legitimate
wishlist item in your bug tracker.

Here are the changes I'm trying to achieve.

1. I want this:

} else {

and not the current
   }
      else {

2 & 3. I want to omit space after if and for.   Since if and for are
functions in R, not keywords, I suggest that there should not be a
space before the opening parentheses.

Item 1 brings the output into line with the advice of the help page
for "if".  The output looks more like the a randomly selected R file
from the R source or the recommended packages. I'm teaching new users
that they should study the R source code itself as a guide for
programming (http://pj.freefaculty.org/R/Rstyle.pdf).  My argument
there would go more smoothly if print.function obeyed the "} else {"
policy that most of your source code and packages adhere to. We do see
r-help questions about the problem that user code can't be run
line-by-line, even when it is styled like the print.function() output.

As you know, this is discussed in R Extensions Section 3.1 on tidying
R code.  In my opinion, the current approach makes code less tidy,
rather than more.

Consider an excerpt from the top of predict.glm.R.  This R code is
correctly formatted, it is consistent with most of the rest of R:

  if (!se.fit) {
        ## No standard errors
        if(missing(newdata)) {
            pred <- switch(type,
                           link = object$linear.predictors,
                           response = object$fitted.values,
                           terms = predict.lm(object,  se.fit=se.fit,
                               scale = 1, type="terms", terms=terms)
                           )
            if(!is.null(na.act)) pred <- napredict(na.act, pred)
        } else {

But the output from '> predict.glm' is not as good:

   if (!se.fit) {
        if (missing(newdata)) {
            pred <- switch(type, link = object$linear.predictors,
                response = object$fitted.values, terms = predict.lm(object,
                  se.fit = se.fit, scale = 1, type = "terms",
                  terms = terms))
            if (!is.null(na.act))
                pred <- napredict(na.act, pred)
        }
        else {


I have applied the attached patch with R 3.0.0. I don't see any damage
from it, just more tidier output:

> predict.glm
function (object, newdata = NULL, type = c("link", "response",
    "terms"), se.fit = FALSE, dispersion = NULL, terms = NULL,
    na.action = na.pass, ...)
{
    type <- match.arg(type)
    na.act <- object$na.action
    object$na.action <- NULL
    if(!se.fit) {
        if(missing(newdata)) {
            pred <- switch(type, link = object$linear.predictors,
                response = object$fitted.values, terms = predict.lm(object,
                  se.fit = se.fit, scale = 1, type = "terms",
                  terms = terms))
            if(!is.null(na.act))
                pred <- napredict(na.act, pred)
        } else {
            pred <- predict.lm(object, newdata, se.fit, scale = 1,
                type = ifelse(type == "link", "response", type),
                terms = terms, na.action = na.action)
            switch(type, response = {
                pred <- family(object)$linkinv(pred)
            }, link = , terms = )
        }
    } else {

Of course, you know much better than I do what else might break as a
result of this change.

In case the email list processor scrubs the patch, please try here:
http://pj.freefaculty.org/scraps/deparse-pj-20130417.patch

pj

--
Paul E. Johnson
Professor, Political Science      Assoc. Director
1541 Lilac Lane, Room 504      Center for Research Methods
University of Kansas                 University of Kansas
http://pj.freefaculty.org               http://quant.ku.edu

From pdalgd at gmail.com  Thu Apr 18 10:05:43 2013
From: pdalgd at gmail.com (peter dalgaard)
Date: Thu, 18 Apr 2013 10:05:43 +0200
Subject: [Rd] Patch proposal for R style consistency (concerning
	deparse.c)
In-Reply-To: <CAErODj85saboM+8SaYKKVVDL6cPeX=LVR=PKwY+FZb2ky_cpBg@mail.gmail.com>
References: <CAErODj85saboM+8SaYKKVVDL6cPeX=LVR=PKwY+FZb2ky_cpBg@mail.gmail.com>
Message-ID: <5478C197-76AB-481D-A1AA-64DB63D8D122@gmail.com>


On Apr 18, 2013, at 05:39 , Paul Johnson wrote:

> 2 & 3. I want to omit space after if and for.   Since if and for are
> functions in R, not keywords, I suggest that there should not be a
> space before the opening parentheses.

Wrong. They are part of language constructs (and they _are_ keywords, not names, that's why ?for won't work). The function calls are `if`(fee, {foo}, {fie}) and something rebarbative for `for`(....). 

Besides, both constructs are harder to read without the spaces. 

-- 
Peter Dalgaard, Professor
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From tag at biostat.ku.dk  Thu Apr 18 07:09:12 2013
From: tag at biostat.ku.dk (Thomas Alexander Gerds)
Date: Thu, 18 Apr 2013 07:09:12 +0200
Subject: [Rd] how to control the environment of a formula
Message-ID: <86bo9ce87b.fsf@biostat.ku.dk>

Dear List

I have experienced that objects generated with one of my packages used
a lot of space when saved on disc (object.size did not show this!).

some debugging revealed that formula and call objects carried the full
environment of subroutines along, including even stuff not needed by the
formula or call. here is a sketch of the problem

,----
| test <- function(x){
|   x <- rnorm(1000000)
|   out <- list()
|   out$f <- a~b
|   out
| }
| v <- test(1)
| save(v,file="~/tmp/v.rda")
| system("ls -lah ~/tmp/v.rda")
| 
| -rw-rw-r-- 1 tag tag 7,4M Apr 18 06:41 /home/tag/tmp/v.rda
`----

I tried to replace line 3 by

,----
| as.formula(a~b,env=emptyenv())
| or
| as.formula(a~b,env=NULL)
`----

without the desired effect. Instead adding either

,----
| environment(out$f) <- emptyenv()
| or
| environment(out$f) <- NULL
`----

has the desired effect (i.e. the saved object size is
shrunken). unfortunately there is a new problem:

,----
| test <- function(x){
|   x <- rnorm(1000000)
|   out <- list()
|   out$f <- a~b
|   environment(out$f) <- emptyenv()
|   out
| }
| d <- data.frame(a=1,b=1)
| v <- test(1)
| model.frame(v$f,data=d)
| 
| Error in eval(expr, envir, enclos) : could not find function "list"
`----

Same with NULL in place of emptyenv()

Finally using .GlobalEnv in place of emptyenv() seems to remove both problems.
My questions:

1)  why does the argument env of as.formula have no effect?
2)  is there a better way to tell formula not to copy unrelated stuff
    into the associated environment?
3)  why does object.size not show the size of the environments that
    formulas can carry along?
    
Regards
Thomas    


--
Thomas A. Gerds -- Assoc. Prof. Department of Biostatistics
University of Copenhagen, ?ster Farimagsgade 5, 1014 Copenhagen, Denmark
Office: CSS-15.2.07 (Gamle Kommunehospital)
tel: 35327914 (sec: 35327901) 

-- 
--
Thomas A. Gerds -- Assoc. Prof. Department of Biostatistics
University of Copenhagen, ?ster Farimagsgade 5, 1014 Copenhagen, Denmark
Office: CSS-15.2.07 (Gamle Kommunehospital)
tel: 35327914 (sec: 35327901) 


From gmx at nicebread.de  Thu Apr 18 13:31:31 2013
From: gmx at nicebread.de (=?iso-8859-1?Q?Felix_Sch=F6nbrodt?=)
Date: Thu, 18 Apr 2013 13:31:31 +0200
Subject: [Rd] Suppress specific warnings
Message-ID: <53248767-3336-47A3-ADD7-FDD3143FCAD0@nicebread.de>

Hello,

is there a convenient way to suppress only *specific* warnings? (I know about ?suppressWarnings)
I depend on another package, from which I want to suppress only some warnings, but not others.

Felix

From murdoch.duncan at gmail.com  Thu Apr 18 14:35:11 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 18 Apr 2013 08:35:11 -0400
Subject: [Rd] how to control the environment of a formula
In-Reply-To: <86bo9ce87b.fsf@biostat.ku.dk>
References: <86bo9ce87b.fsf@biostat.ku.dk>
Message-ID: <516FE87F.90906@gmail.com>

On 13-04-18 1:09 AM, Thomas Alexander Gerds wrote:
> Dear List
>
> I have experienced that objects generated with one of my packages used
> a lot of space when saved on disc (object.size did not show this!).
>
> some debugging revealed that formula and call objects carried the full
> environment of subroutines along, including even stuff not needed by the
> formula or call. here is a sketch of the problem
>
> ,----
> | test <- function(x){
> |   x <- rnorm(1000000)
> |   out <- list()
> |   out$f <- a~b
> |   out
> | }
> | v <- test(1)
> | save(v,file="~/tmp/v.rda")
> | system("ls -lah ~/tmp/v.rda")
> |
> | -rw-rw-r-- 1 tag tag 7,4M Apr 18 06:41 /home/tag/tmp/v.rda
> `----
>
> I tried to replace line 3 by
>
> ,----
> | as.formula(a~b,env=emptyenv())
> | or
> | as.formula(a~b,env=NULL)
> `----
>
> without the desired effect. Instead adding either
>
> ,----
> | environment(out$f) <- emptyenv()
> | or
> | environment(out$f) <- NULL
> `----
>
> has the desired effect (i.e. the saved object size is
> shrunken). unfortunately there is a new problem:
>
> ,----
> | test <- function(x){
> |   x <- rnorm(1000000)
> |   out <- list()
> |   out$f <- a~b
> |   environment(out$f) <- emptyenv()
> |   out
> | }
> | d <- data.frame(a=1,b=1)
> | v <- test(1)
> | model.frame(v$f,data=d)
> |
> | Error in eval(expr, envir, enclos) : could not find function "list"
> `----
>
> Same with NULL in place of emptyenv()
>
> Finally using .GlobalEnv in place of emptyenv() seems to remove both problems.

But it will cause other, less obvious problems.  In a formula, the 
symbols mean something.  By setting the environment to .GlobalEnv you're 
changing the meaning.  You'll get nonsense in certain cases when 
functions look up the meaning of those symbols and find the wrong thing. 
  (I don't have an example at hand, but I imagine it would be easy to 
put one together with update().)

> My questions:
>
> 1)  why does the argument env of as.formula have no effect?

Because the first argument already had an associated environment.  You 
passed a ~ b, which is evaluated to a formula; calling as.formula on a 
formula does nothing. The env argument is only used when a new formula 
needs to be constructed.  (You can see this in the source code; 
as.formula is a very simple function.)

> 2)  is there a better way to tell formula not to copy unrelated stuff
>      into the associated environment?

Yes, delete it.  For example, you could write your function as

  test <- function(x){
    x <- rnorm(1000000)
    out <- list()
    out$f <- a~b
    rm(x)
    out
  }


> 3)  why does object.size not show the size of the environments that
>      formulas can carry along?

Because many objects can share the same environment.  See ?object.size 
for more details.

Duncan Murdoch


From murdoch.duncan at gmail.com  Thu Apr 18 14:57:12 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 18 Apr 2013 08:57:12 -0400
Subject: [Rd] Suppress specific warnings
In-Reply-To: <53248767-3336-47A3-ADD7-FDD3143FCAD0@nicebread.de>
References: <53248767-3336-47A3-ADD7-FDD3143FCAD0@nicebread.de>
Message-ID: <516FEDA8.70003@gmail.com>

On 13-04-18 7:31 AM, Felix Sch?nbrodt wrote:
> Hello,
>
> is there a convenient way to suppress only *specific* warnings? (I know about ?suppressWarnings)
> I depend on another package, from which I want to suppress only some warnings, but not others.

This is difficult in most cases, because most packages don't give enough 
information to distinguish among their warnings.  You could probably do 
it based on the message as follows, but the test won't work if someone 
is running in a locale where the warning message has been translated to 
a different language:

x <- 1:10
x + 1:3   # gives the warning:

In x + 1:3 :
   longer object length is not a multiple of shorter object length

To suppress just this one, try this:

withCallingHandlers(x + 1:3,
    warning=function(w) {
       if (grepl("longer object length", w$message))
          invokeRestart("muffleWarning")
    } )

Duncan Murdoch


From mtmorgan at fhcrc.org  Thu Apr 18 15:29:02 2013
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Thu, 18 Apr 2013 06:29:02 -0700
Subject: [Rd] Suppress specific warnings
In-Reply-To: <516FEDA8.70003@gmail.com>
References: <53248767-3336-47A3-ADD7-FDD3143FCAD0@nicebread.de>
	<516FEDA8.70003@gmail.com>
Message-ID: <516FF51E.5000907@fhcrc.org>

On 04/18/2013 05:57 AM, Duncan Murdoch wrote:
> On 13-04-18 7:31 AM, Felix Sch?nbrodt wrote:
>> Hello,
>>
>> is there a convenient way to suppress only *specific* warnings? (I know about
>> ?suppressWarnings)
>> I depend on another package, from which I want to suppress only some warnings,
>> but not others.
>
> This is difficult in most cases, because most packages don't give enough
> information to distinguish among their warnings.  You could probably do it based

maybe useful to make the point that it isn't hard to for the package you depend 
on to signal different types of warnings

   w = simpleWarning("curves ahead")
   class(w) = c("curves", class(w))
   warning(w)

more below...

> on the message as follows, but the test won't work if someone is running in a
> locale where the warning message has been translated to a different language:
>
> x <- 1:10
> x + 1:3   # gives the warning:
>
> In x + 1:3 :
>    longer object length is not a multiple of shorter object length
>
> To suppress just this one, try this:
>
> withCallingHandlers(x + 1:3,
>     warning=function(w) {
>        if (grepl("longer object length", w$message))
>           invokeRestart("muffleWarning")
>     } )

...which are then caught as

   withCallingHandlers({
       warning(w)                   # 'curves'; caught
       warning("another warning")
   }, curves=function(w) invokeRestart("muffleWarning"))

The tricky part is to come up with an appropriate scheme for classifying warnings.

Martin Morgan

> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From Robert.McGehee at geodecapital.com  Thu Apr 18 17:07:31 2013
From: Robert.McGehee at geodecapital.com (McGehee, Robert)
Date: Thu, 18 Apr 2013 11:07:31 -0400
Subject: [Rd] Rebuild package on R 3.0.0 without source code?
Message-ID: <17B09E7789D3104E8F5EEB0582A8D66FF25B068C6A@MSGRTPCCRF2WIN.DMN1.FMR.COM>

R-developers,
I have a binary R package built using R 2.14.1 that I would like to run on R 3.0.0. Unfortunately, the original source code is unavailable, so I cannot rebuild the package as R 3.0.0 requires.

Is there a straight forward way of converting the package (.rdb, .rdx and .rds files) in the binary package from a 2.14.1 version to a 3.0.0 version without the source code (perhaps uncompressing/recompressing somehow)?

Naturally, since the R code is visible, I know I can output all of the parsed objects in the package to a text file to make a skeleton package that can then be built/installed. Something like this:

       objs <- ls(envir=loadNamespace("binaryPkg"), all.names=TRUE)
       dump(objs, file="code.R", envir=loadNamespace("binaryPkg"))

However, I'd still lose all the man pages, and since I get a couple of "deparse may be incomplete" warnings, I worry that this may be introducing additional bugs.
 
Is there a magic solution here, or is this a fool's errand?

Thanks, Robert

Robert McGehee, CFA
Geode Capital Management, LLC
One Post Office Square, 28th Floor | Boston, MA | 02109
Direct: (617)392-8396


From marc_schwartz at me.com  Thu Apr 18 17:17:16 2013
From: marc_schwartz at me.com (Marc Schwartz)
Date: Thu, 18 Apr 2013 10:17:16 -0500
Subject: [Rd] Rebuild package on R 3.0.0 without source code?
In-Reply-To: <17B09E7789D3104E8F5EEB0582A8D66FF25B068C6A@MSGRTPCCRF2WIN.DMN1.FMR.COM>
References: <17B09E7789D3104E8F5EEB0582A8D66FF25B068C6A@MSGRTPCCRF2WIN.DMN1.FMR.COM>
Message-ID: <5D8AA77B-1666-4541-B995-C7923C492577@me.com>

On Apr 18, 2013, at 10:07 AM, "McGehee, Robert" <Robert.McGehee at geodecapital.com> wrote:

> R-developers,
> I have a binary R package built using R 2.14.1 that I would like to run on R 3.0.0. Unfortunately, the original source code is unavailable, so I cannot rebuild the package as R 3.0.0 requires.
> 
> Is there a straight forward way of converting the package (.rdb, .rdx and .rds files) in the binary package from a 2.14.1 version to a 3.0.0 version without the source code (perhaps uncompressing/recompressing somehow)?
> 
> Naturally, since the R code is visible, I know I can output all of the parsed objects in the package to a text file to make a skeleton package that can then be built/installed. Something like this:
> 
>       objs <- ls(envir=loadNamespace("binaryPkg"), all.names=TRUE)
>       dump(objs, file="code.R", envir=loadNamespace("binaryPkg"))
> 
> However, I'd still lose all the man pages, and since I get a couple of "deparse may be incomplete" warnings, I worry that this may be introducing additional bugs.
> 
> Is there a magic solution here, or is this a fool's errand?
> 
> Thanks, Robert

Robert,

Which package? You might find some older version of the package source code here:

  http://cran.us.r-project.org/src/contrib/Archive/

or have you already looked there?

Regards,

Marc Schwartz


From murdoch.duncan at gmail.com  Thu Apr 18 17:23:18 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 18 Apr 2013 11:23:18 -0400
Subject: [Rd] Rebuild package on R 3.0.0 without source code?
In-Reply-To: <17B09E7789D3104E8F5EEB0582A8D66FF25B068C6A@MSGRTPCCRF2WIN.DMN1.FMR.COM>
References: <17B09E7789D3104E8F5EEB0582A8D66FF25B068C6A@MSGRTPCCRF2WIN.DMN1.FMR.COM>
Message-ID: <51700FE6.30305@gmail.com>

On 18/04/2013 11:07 AM, McGehee, Robert wrote:
> R-developers,
> I have a binary R package built using R 2.14.1 that I would like to run on R 3.0.0. Unfortunately, the original source code is unavailable, so I cannot rebuild the package as R 3.0.0 requires.
>
> Is there a straight forward way of converting the package (.rdb, .rdx and .rds files) in the binary package from a 2.14.1 version to a 3.0.0 version without the source code (perhaps uncompressing/recompressing somehow)?
>
> Naturally, since the R code is visible, I know I can output all of the parsed objects in the package to a text file to make a skeleton package that can then be built/installed. Something like this:
>
>         objs <- ls(envir=loadNamespace("binaryPkg"), all.names=TRUE)
>         dump(objs, file="code.R", envir=loadNamespace("binaryPkg"))
>
> However, I'd still lose all the man pages, and since I get a couple of "deparse may be incomplete" warnings, I worry that this may be introducing additional bugs.
>   
> Is there a magic solution here, or is this a fool's errand?

I'd guess there's no magic solution.  Deparsing is not perfect, so just 
about any automatic solution may introduce additional bugs.

Use it as a lesson:  you shouldn't use closed-source software.

BTW, you're probably aware of this, but others might not be:  if this 
was a CRAN package, it quite likely does have the source for the old 
version still available.  Take a look around the "Archive" link on the 
contributed packages page.  CRAN is very reluctant to delete sources 
once it has made them public. So it's quite safe to install binaries 
from CRAN, just not necessarily from other sources.

Duncan Murdoch


From ripley at stats.ox.ac.uk  Thu Apr 18 17:27:53 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 18 Apr 2013 16:27:53 +0100
Subject: [Rd] Rebuild package on R 3.0.0 without source code?
In-Reply-To: <17B09E7789D3104E8F5EEB0582A8D66FF25B068C6A@MSGRTPCCRF2WIN.DMN1.FMR.COM>
References: <17B09E7789D3104E8F5EEB0582A8D66FF25B068C6A@MSGRTPCCRF2WIN.DMN1.FMR.COM>
Message-ID: <517010F9.5030305@stats.ox.ac.uk>

On 18/04/2013 16:07, McGehee, Robert wrote:
> R-developers,
> I have a binary R package built using R 2.14.1 that I would like to run on R 3.0.0. Unfortunately, the original source code is unavailable, so I cannot rebuild the package as R 3.0.0 requires.
>
> Is there a straight forward way of converting the package (.rdb, .rdx and .rds files) in the binary package from a 2.14.1 version to a 3.0.0 version without the source code (perhaps uncompressing/recompressing somehow)?
>
> Naturally, since the R code is visible, I know I can output all of the parsed objects in the package to a text file to make a skeleton package that can then be built/installed. Something like this:
>
>         objs <- ls(envir=loadNamespace("binaryPkg"), all.names=TRUE)
>         dump(objs, file="code.R", envir=loadNamespace("binaryPkg"))
>
> However, I'd still lose all the man pages, and since I get a couple of "deparse may be incomplete" warnings, I worry that this may be introducing additional bugs.
>
> Is there a magic solution here, or is this a fool's errand?

No magic solution, and the following may not work, but it might.

Make a simple package with the correct DESCRIPTION file.  Install that 
somewhere new.  Then use the installed DESCRIPTION file and 
Meta/package.rds to replace the versions you got from 2.14.1.


It is possible to extract the man pages: the key step is 
tools:::fetchRdDB.  On my system

names(tools:::fetchRdDB('/Users/ripley/R/R-devel/library/MASS/help/MASS'))
tools:::fetchRdDB('/Users/ripley/R/R-devel/library/MASS/help/MASS', 'rlm')

work: the layout of the pages is a little odd.



>
> Thanks, Robert
>
> Robert McGehee, CFA
> Geode Capital Management, LLC
> One Post Office Square, 28th Floor | Boston, MA | 02109
> Direct: (617)392-8396
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From b.rowlingson at lancaster.ac.uk  Thu Apr 18 17:28:47 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 18 Apr 2013 16:28:47 +0100
Subject: [Rd] R CMD INSTALL fail deletes earlier versions
Message-ID: <CANVKczP4-+ZZn2ZNCQJV2OMpUEdDmZSgFCmOdmpuogLtKDrBZg@mail.gmail.com>

Just tried to update devtools for R 2.15.3, and after an error about
it only being available for 3.0.0, I found my previously good-enough
devtools had disappeared. Here's how it happens:

$ R --quiet
> require(devtools)
Loading required package: devtools
pac> packageDescription("devtools")$Version
[1] "1.1"

$ R CMD INSTALL devtools_1.2.99.tar.gz
* installing to library
?/nobackup/rowlings/RLibrary/R/i486-pc-linux-gnu-library/2.15?
ERROR: this R is version 2.15.3, package 'devtools' requires R >= 3.0
* removing ?/nobackup/rowlings/RLibrary/R/i486-pc-linux-gnu-library/2.15/devtools?

Oh well, I'll just carry on with the old...

$ R --quiet
> require(devtools)
Loading required package: devtools
Warning message:
In library(package, lib.loc = lib.loc, character.only = TRUE,
logical.return = TRUE,  :
  there is no package called ?devtools?

 Oh gee thanks. 1.2.99 wouldn't install, so you zapped my otherwise
perfectly good 1.1?

 Feature? Bug? Fixed in 3.0.0 (can't see it in NEWS)?

Barry


From Thomas.Petzoldt at tu-dresden.de  Thu Apr 18 17:38:06 2013
From: Thomas.Petzoldt at tu-dresden.de (Thomas Petzoldt)
Date: Thu, 18 Apr 2013 17:38:06 +0200
Subject: [Rd] Linux distribution with gcc 4.8  and AddressSanitizer ?
Message-ID: <5170135E.7090309@tu-dresden.de>

Dear R developers,

I've got an information from Prof. Ripley regarding a bug found with 
AdressSanitizer in one of our packages. It is now fixed, thank you for 
this information.

Now, I would like to run AddressSanitizer myself before submitting the 
patched package to CRAN.

Is there a recommendation of a suitable Linux distribution with gcc 4.8, 
ideally an ISO image or (even better) a virtual appliance for VMware or 
VirtalBox? My Debian Wheezy machines have only 4.7.2.

Thank you

Thomas Petzoldt


-- 
Dr. Thomas Petzoldt
Technische Universitaet Dresden
Faculty of Environmental Sciences
Institute of Hydrobiology
01062 Dresden, Germany

E-Mail: thomas.petzoldt at tu-dresden.de
http://tu-dresden.de/Members/thomas.petzoldt


From tag at biostat.ku.dk  Thu Apr 18 17:39:04 2013
From: tag at biostat.ku.dk (Thomas Alexander Gerds)
Date: Thu, 18 Apr 2013 17:39:04 +0200
Subject: [Rd] how to control the environment of a formula
In-Reply-To: <516FE87F.90906@gmail.com> (Duncan Murdoch's message of "Thu, 18
	Apr 2013 08:35:11 -0400")
References: <86bo9ce87b.fsf@biostat.ku.dk> <516FE87F.90906@gmail.com>
Message-ID: <86obdbetlz.fsf@biostat.ku.dk>

Dear Duncan 

thank you for taking the time to answer my questions! It will be quite
some work to delete all the objects generated inside the function
... but if there is no other way to avoid a large environment then this
is what I will do.

Cheers
Thomas

Duncan Murdoch <murdoch.duncan at gmail.com> writes:

> On 13-04-18 1:09 AM, Thomas Alexander Gerds wrote:
>> Dear List
>> I have experienced that objects generated with one of my packages
>> used a lot of space when saved on disc (object.size did not show
>> this!).
>> some debugging revealed that formula and call objects carried the
>> full environment of subroutines along, including even stuff not
>> needed by the formula or call. here is a sketch of the problem
>> ,----
>> | test <- function(x){ x <- rnorm(1000000) out <- list() out$f <-
>> | a~b out } v <- test(1) save(v,file="~/tmp/v.rda") system("ls -lah
>> | ~/tmp/v.rda")
>> | -rw-rw-r-- 1 tag tag 7,4M Apr 18 06:41 /home/tag/tmp/v.rda
>> `----
>> I tried to replace line 3 by
>> ,----
>> | as.formula(a~b,env=emptyenv()) or as.formula(a~b,env=NULL)
>> `----
>> without the desired effect. Instead adding either
>> ,----
>> | environment(out$f) <- emptyenv() or environment(out$f) <- NULL
>> `----
>> has the desired effect (i.e. the saved object size is
>> shrunken). unfortunately there is a new problem:
>> ,----
>> | test <- function(x){ x <- rnorm(1000000) out <- list() out$f <-
>> | a~b environment(out$f) <- emptyenv() out } d <-
>> | data.frame(a=1,b=1) v <- test(1) model.frame(v$f,data=d)
>> | Error in eval(expr, envir, enclos) : could not find function
>> | "list"
>> `----
>> Same with NULL in place of emptyenv()
>> Finally using .GlobalEnv in place of emptyenv() seems to remove both
>> problems.
>
> But it will cause other, less obvious problems.  In a formula, the
> symbols mean something.  By setting the environment to .GlobalEnv
> you're changing the meaning.  You'll get nonsense in certain cases
> when functions look up the meaning of those symbols and find the wrong
> thing. (I don't have an example at hand, but I imagine it would be
> easy to put one together with update().)
>
>> My questions:
>> 1) why does the argument env of as.formula have no effect?
>
> Because the first argument already had an associated environment.  You
> passed a ~ b, which is evaluated to a formula; calling as.formula on a
> formula does nothing. The env argument is only used when a new formula
> needs to be constructed.  (You can see this in the source code;
> as.formula is a very simple function.)
>
>> 2) is there a better way to tell formula not to copy unrelated stuff
>> into the associated environment?
>
> Yes, delete it.  For example, you could write your function as
>
>  test <- function(x){ x <- rnorm(1000000) out <- list() out$f <- a~b
> rm(x) out }
>
>> 3) why does object.size not show the size of the environments that
>> formulas can carry along?
>
> Because many objects can share the same environment.  See ?object.size
> for more details.
>
> Duncan Murdoch

-- 
Thomas A. Gerds -- Assoc. Prof. Department of Biostatistics Copenhagen
University of Copenhagen, Oester Farimagsgade 5, 1014 Copenhagen, Denmark


From jaomatos at gmail.com  Thu Apr 18 18:05:18 2013
From: jaomatos at gmail.com (=?ISO-8859-1?Q?Jos=E9?= Matos)
Date: Thu, 18 Apr 2013 17:05:18 +0100
Subject: [Rd] Linux distribution with gcc 4.8  and AddressSanitizer ?
In-Reply-To: <5170135E.7090309@tu-dresden.de>
References: <5170135E.7090309@tu-dresden.de>
Message-ID: <1665624.PmurviQP17@ulysses>

On Thursday 18 April 2013 17:38:06 Thomas Petzoldt wrote:
> Dear R developers,
> 
> I've got an information from Prof. Ripley regarding a bug found with 
> AdressSanitizer in one of our packages. It is now fixed, thank you for 
> this information.
> 
> Now, I would like to run AddressSanitizer myself before submitting the 
> patched package to CRAN.
> 
> Is there a recommendation of a suitable Linux distribution with gcc 4.8, 
> ideally an ISO image or (even better) a virtual appliance for VMware or 
> VirtalBox? My Debian Wheezy machines have only 4.7.2.
> 
> Thank you
> 
> Thomas Petzoldt

I am not sure about all the requisites above (regarding the virtual appliances although I know that they are available) but Fedora 19 (Alpha) that will be released today has gcc 4.8.

Even although it has the Alpha moniker, and the corresponding stage, it is relatively stable and thus suitable for your requirements.

Regards,
-- 
Jos? Ab?lio


From rowe at muxspace.com  Thu Apr 18 18:12:26 2013
From: rowe at muxspace.com (Brian Lee Yung Rowe)
Date: Thu, 18 Apr 2013 12:12:26 -0400
Subject: [Rd] Suppress specific warnings
In-Reply-To: <516FF51E.5000907@fhcrc.org>
References: <53248767-3336-47A3-ADD7-FDD3143FCAD0@nicebread.de>
	<516FEDA8.70003@gmail.com> <516FF51E.5000907@fhcrc.org>
Message-ID: <2F5227B0-4E50-4E36-83E0-3988B23F0990@muxspace.com>

For my logging package (futile.logger) any log statements coming from a package are assigned to a package namespace. This way you have control of log messages at a package level (e.g. I can set the default log threshold to DEBUG, while package 'A' has a log threshold of WARN). 

I seems a hierarchical namespace facility would work for the below case as well. 


On Apr 18, 2013, at 9:29 AM, Martin Morgan <mtmorgan at fhcrc.org> wrote:

>> To suppress just this one, try this:
>> 
>> withCallingHandlers(x + 1:3,
>>    warning=function(w) {
>>       if (grepl("longer object length", w$message))
>>          invokeRestart("muffleWarning")
>>    } )
> 
> ...which are then caught as
> 
>  withCallingHandlers({
>      warning(w)                   # 'curves'; caught
>      warning("another warning")
>  }, curves=function(w) invokeRestart("muffleWarning"))
> 
> The tricky part is to come up with an appropriate scheme for classifying warnings.

?????
Brian Lee Yung Rowe
917 496 4583


From pauljohn32 at gmail.com  Thu Apr 18 18:16:41 2013
From: pauljohn32 at gmail.com (Paul Johnson)
Date: Thu, 18 Apr 2013 11:16:41 -0500
Subject: [Rd] Patch proposal for R style consistency (concerning
	deparse.c)
In-Reply-To: <5478C197-76AB-481D-A1AA-64DB63D8D122@gmail.com>
References: <CAErODj85saboM+8SaYKKVVDL6cPeX=LVR=PKwY+FZb2ky_cpBg@mail.gmail.com>
	<5478C197-76AB-481D-A1AA-64DB63D8D122@gmail.com>
Message-ID: <CAErODj_N+FCjP1zt2H4VHv28o8RDU8sQ-W4qGONkx1gLvC33pg@mail.gmail.com>

OK, I concede that.

Now, how about "} else {"

I will provide patch that does only that change.
?

On Thu, Apr 18, 2013 at 3:05 AM, peter dalgaard <pdalgd at gmail.com> wrote:
>
> On Apr 18, 2013, at 05:39 , Paul Johnson wrote:
>
>> 2 & 3. I want to omit space after if and for.   Since if and for are
>> functions in R, not keywords, I suggest that there should not be a
>> space before the opening parentheses.
>
> Wrong. They are part of language constructs (and they _are_ keywords, not names, that's why ?for won't work). The function calls are `if`(fee, {foo}, {fie}) and something rebarbative for `for`(....).
>
> Besides, both constructs are harder to read without the spaces.
>
> --
> Peter Dalgaard, Professor
> Center for Statistics, Copenhagen Business School
> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
> Phone: (+45)38153501
> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
>



-- 
Paul E. Johnson
Professor, Political Science      Assoc. Director
1541 Lilac Lane, Room 504      Center for Research Methods
University of Kansas                 University of Kansas
http://pj.freefaculty.org               http://quant.ku.edu


From ripley at stats.ox.ac.uk  Thu Apr 18 18:19:08 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 18 Apr 2013 17:19:08 +0100
Subject: [Rd] Linux distribution with gcc 4.8  and AddressSanitizer ?
In-Reply-To: <5170135E.7090309@tu-dresden.de>
References: <5170135E.7090309@tu-dresden.de>
Message-ID: <51701CFC.4000704@stats.ox.ac.uk>

On 18/04/2013 16:38, Thomas Petzoldt wrote:
> Dear R developers,
>
> I've got an information from Prof. Ripley regarding a bug found with
> AddressSanitizer in one of our packages. It is now fixed, thank you for
> this information.
>
> Now, I would like to run AddressSanitizer myself before submitting the
> patched package to CRAN.
>
> Is there a recommendation of a suitable Linux distribution with gcc 4.8,
> ideally an ISO image or (even better) a virtual appliance for VMware or
> VirtalBox? My Debian Wheezy machines have only 4.7.2.
>
> Thank you
>
> Thomas Petzoldt
>

gcc 4.8.0 has only been released for 4 weeks, so I doubt any released 
distro has it.  Fedora Rawhide (19-to-be) has it, and so I am told does 
Debian experimental.

I compiled gcc myself from the sources, but my sysadmins offered to make 
a Rawhide virtual machine or live DVD for me.

For those who do not know what AddressSanitizer is, see 
http://cran.r-project.org/doc/manuals/r-devel/R-exts.html#Using-gctorture-and-memory-access 
.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Robert.McGehee at geodecapital.com  Thu Apr 18 19:42:52 2013
From: Robert.McGehee at geodecapital.com (McGehee, Robert)
Date: Thu, 18 Apr 2013 13:42:52 -0400
Subject: [Rd] Rebuild package on R 3.0.0 without source code?
In-Reply-To: <517010F9.5030305@stats.ox.ac.uk>
References: <17B09E7789D3104E8F5EEB0582A8D66FF25B068C6A@MSGRTPCCRF2WIN.DMN1.FMR.COM>
	<517010F9.5030305@stats.ox.ac.uk>
Message-ID: <17B09E7789D3104E8F5EEB0582A8D66FF25B147D08@MSGRTPCCRF2WIN.DMN1.FMR.COM>

Very nice, thank you! The steps did work. Documentation, demos, examples, functions, external data all load perfectly. For the archive, the step "make ... the correct DESCRIPTION file" only involved copying the binary's DESCRIPTION file and removing the last line ("Built: R 2.14.1...").

To answer Marc's question, the package is not in cran as it's a closed-source R interface package to a proprietary optimization software written in Java (Axioma). I wanted the flexibility to upgrade R even if the vendor decides not to release a new binary package anytime soon. To Duncan's point, agreed! Personally, I generally prefer the open-source optimizers as you can throw tons of CPUs at the problem without running out of software licenses. However, this particular proprietary optimizer is very good at solving quadratically constrained quadratic programs (QCQP), and I haven't yet seen a free R package that can solve this kind of problem (e.g. max q'x - x'Qx subject to x'Qx <= B and Ax=c).

Thanks again!
Robert

-----Original Message-----
From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
Sent: Thursday, April 18, 2013 11:28 AM
To: McGehee, Robert
Cc: R-Devel (r-devel at r-project.org)
Subject: Re: [Rd] Rebuild package on R 3.0.0 without source code?

On 18/04/2013 16:07, McGehee, Robert wrote:
> R-developers,
> I have a binary R package built using R 2.14.1 that I would like to run on R 3.0.0. Unfortunately, the original source code is unavailable, so I cannot rebuild the package as R 3.0.0 requires.
>
> Is there a straight forward way of converting the package (.rdb, .rdx and .rds files) in the binary package from a 2.14.1 version to a 3.0.0 version without the source code (perhaps uncompressing/recompressing somehow)?
>
> Naturally, since the R code is visible, I know I can output all of the parsed objects in the package to a text file to make a skeleton package that can then be built/installed. Something like this:
>
>         objs <- ls(envir=loadNamespace("binaryPkg"), all.names=TRUE)
>         dump(objs, file="code.R", envir=loadNamespace("binaryPkg"))
>
> However, I'd still lose all the man pages, and since I get a couple of "deparse may be incomplete" warnings, I worry that this may be introducing additional bugs.
>
> Is there a magic solution here, or is this a fool's errand?

No magic solution, and the following may not work, but it might.

Make a simple package with the correct DESCRIPTION file.  Install that 
somewhere new.  Then use the installed DESCRIPTION file and 
Meta/package.rds to replace the versions you got from 2.14.1.


It is possible to extract the man pages: the key step is 
tools:::fetchRdDB.  On my system

names(tools:::fetchRdDB('/Users/ripley/R/R-devel/library/MASS/help/MASS'))
tools:::fetchRdDB('/Users/ripley/R/R-devel/library/MASS/help/MASS', 'rlm')

work: the layout of the pages is a little odd.



>
> Thanks, Robert
>
> Robert McGehee, CFA
> Geode Capital Management, LLC
> One Post Office Square, 28th Floor | Boston, MA | 02109
> Direct: (617)392-8396
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From xie at yihui.name  Thu Apr 18 20:41:46 2013
From: xie at yihui.name (Yihui Xie)
Date: Thu, 18 Apr 2013 13:41:46 -0500
Subject: [Rd] Patch proposal for R style consistency (concerning
	deparse.c)
In-Reply-To: <CAErODj_N+FCjP1zt2H4VHv28o8RDU8sQ-W4qGONkx1gLvC33pg@mail.gmail.com>
References: <CAErODj85saboM+8SaYKKVVDL6cPeX=LVR=PKwY+FZb2ky_cpBg@mail.gmail.com>
	<5478C197-76AB-481D-A1AA-64DB63D8D122@gmail.com>
	<CAErODj_N+FCjP1zt2H4VHv28o8RDU8sQ-W4qGONkx1gLvC33pg@mail.gmail.com>
Message-ID: <CANROs4emmr=rGLKWpCQ6z_016mAk7O42=ttA1BLnc9zQ_DTzqQ@mail.gmail.com>

I second the change of "} else {".

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Phone: 515-294-2465 Web: http://yihui.name
Department of Statistics, Iowa State University
2215 Snedecor Hall, Ames, IA


On Thu, Apr 18, 2013 at 11:16 AM, Paul Johnson <pauljohn32 at gmail.com> wrote:
> OK, I concede that.
>
> Now, how about "} else {"
>
> I will provide patch that does only that change.
> ?
>
> On Thu, Apr 18, 2013 at 3:05 AM, peter dalgaard <pdalgd at gmail.com> wrote:
>>
>> On Apr 18, 2013, at 05:39 , Paul Johnson wrote:
>>
>>> 2 & 3. I want to omit space after if and for.   Since if and for are
>>> functions in R, not keywords, I suggest that there should not be a
>>> space before the opening parentheses.
>>
>> Wrong. They are part of language constructs (and they _are_ keywords, not names, that's why ?for won't work). The function calls are `if`(fee, {foo}, {fie}) and something rebarbative for `for`(....).
>>
>> Besides, both constructs are harder to read without the spaces.
>>
>> --
>> Peter Dalgaard, Professor
>> Center for Statistics, Copenhagen Business School
>> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
>> Phone: (+45)38153501
>> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
>>
>
>
>
> --
> Paul E. Johnson
> Professor, Political Science      Assoc. Director
> 1541 Lilac Lane, Room 504      Center for Research Methods
> University of Kansas                 University of Kansas
> http://pj.freefaculty.org               http://quant.ku.edu


From edd at debian.org  Thu Apr 18 20:54:26 2013
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 18 Apr 2013 13:54:26 -0500
Subject: [Rd] Linux distribution with gcc 4.8  and AddressSanitizer ?
In-Reply-To: <51701CFC.4000704@stats.ox.ac.uk>
References: <5170135E.7090309@tu-dresden.de> <51701CFC.4000704@stats.ox.ac.uk>
Message-ID: <20848.16738.901199.167962@max.nulle.part>


On 18 April 2013 at 17:19, Prof Brian Ripley wrote:
| On 18/04/2013 16:38, Thomas Petzoldt wrote:
| > Dear R developers,
| >
| > I've got an information from Prof. Ripley regarding a bug found with
| > AddressSanitizer in one of our packages. It is now fixed, thank you for
| > this information.
| >
| > Now, I would like to run AddressSanitizer myself before submitting the
| > patched package to CRAN.
| >
| > Is there a recommendation of a suitable Linux distribution with gcc 4.8,
| > ideally an ISO image or (even better) a virtual appliance for VMware or
| > VirtalBox? My Debian Wheezy machines have only 4.7.2.
| >
| > Thank you
| >
| > Thomas Petzoldt
| >
| 
| gcc 4.8.0 has only been released for 4 weeks, so I doubt any released 
| distro has it.  Fedora Rawhide (19-to-be) has it, and so I am told does 
| Debian experimental.

Yes, looking at http://packages.debian.org/experimental/gcc-4.8 reveals that
there were build -1 on March 22 and -2 on March 28 --- but also fifteen (15)
prerelease builds going back all the way to Nov 2012.
 
| I compiled gcc myself from the sources, but my sysadmins offered to make 
| a Rawhide virtual machine or live DVD for me.

apt-get could you your friend too.  And virtual machines are pretty easy,
like the virtd / kvm variant (on Linux) quite a bit.

Dirk

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From ripley at stats.ox.ac.uk  Fri Apr 19 10:16:10 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 19 Apr 2013 09:16:10 +0100
Subject: [Rd] stack imbalance in max.col for non-real matrices
In-Reply-To: <CAOQ5NyeJ_PNB3ehDQU9FPchEy+A14fKmhunFnGm4AN8BLpZG=Q@mail.gmail.com>
References: <CAOQ5NyeJ_PNB3ehDQU9FPchEy+A14fKmhunFnGm4AN8BLpZG=Q@mail.gmail.com>
Message-ID: <5170FD4A.4010403@stats.ox.ac.uk>

On 17/04/2013 21:25, Michael Lawrence wrote:
> It's tough to reliably reproduce, but I often get stack imbalance warnings
> when calling max.col() on non-real/double matrix. The code is conditionally
> PROTECTing but not incrementing its nprot counter for the eventual
> UNPROTECT. Pretty sure this would fix (but I haven't tested it):

I can't reproduce it either, but that seems the right fix so 
incorporated now, thanks.

>
> Index: array.c
> ===================================================================
> --- array.c    (revision 61606)
> +++ array.c    (working copy)
> @@ -1614,7 +1614,10 @@
>       SEXP m = CAR(args);
>       int method = asInteger(CADR(args));
>       int nr = nrows(m), nc = ncols(m), nprot = 1;
> -    if (TYPEOF(m) != REALSXP) PROTECT(m = coerceVector(m, REALSXP));
> +    if (TYPEOF(m) != REALSXP) {
> +      PROTECT(m = coerceVector(m, REALSXP));
> +      nprot++;
> +    }
>       SEXP ans = allocVector(INTSXP, nr);
>       PROTECT(ans);
>       R_max_col(REAL(m), &nr, &nc, INTEGER(ans), &method);
>
> Thanks,
> Michael
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From liuyipei at stanford.edu  Fri Apr 19 06:38:12 2013
From: liuyipei at stanford.edu (liuyipei)
Date: Thu, 18 Apr 2013 21:38:12 -0700 (PDT)
Subject: [Rd] Publishing my Package on CRAN
Message-ID: <1366346292344-4664676.post@n4.nabble.com>

Hi,

I have a simple package with two functions. It essentially implements
estimators and data simulation for a paper I am writing  for immunology (and
in some sense, ecology).  How long is the typical CRAN review process -- and
how long will it take to get through the process?  How selective is it?

I have never published a package before, so I am wondering whether you guys
think this is a reasonable thing for me to promise in the paper that the
package will be available on CRAN.

Thank you for your advice in advance!



--
View this message in context: http://r.789695.n4.nabble.com/Publishing-my-Package-on-CRAN-tp4664676.html
Sent from the R devel mailing list archive at Nabble.com.


From therneau at mayo.edu  Fri Apr 19 14:41:21 2013
From: therneau at mayo.edu (Therneau, Terry M., Ph.D.)
Date: Fri, 19 Apr 2013 12:41:21 +0000
Subject: [Rd] how to control the environment of a formula
Message-ID: <CD96A5A0.1540%therneau@mayo.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130419/e508e0c3/attachment.pl>

From mtmorgan at fhcrc.org  Fri Apr 19 15:20:57 2013
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Fri, 19 Apr 2013 06:20:57 -0700
Subject: [Rd] stack imbalance in max.col for non-real matrices
In-Reply-To: <5170FD4A.4010403@stats.ox.ac.uk>
References: <CAOQ5NyeJ_PNB3ehDQU9FPchEy+A14fKmhunFnGm4AN8BLpZG=Q@mail.gmail.com>
	<5170FD4A.4010403@stats.ox.ac.uk>
Message-ID: <517144B9.4020202@fhcrc.org>

On 04/19/2013 01:16 AM, Prof Brian Ripley wrote:
> On 17/04/2013 21:25, Michael Lawrence wrote:
>> It's tough to reliably reproduce, but I often get stack imbalance warnings
>> when calling max.col() on non-real/double matrix. The code is conditionally
>> PROTECTing but not incrementing its nprot counter for the eventual
>> UNPROTECT. Pretty sure this would fix (but I haven't tested it):
>
> I can't reproduce it either, but that seems the right fix so incorporated now,
> thanks.

Why isn't this reproducible? I thought the protection stack would be deterministic.

 > max.col(matrix())
Warning: stack imbalance in 'max.col', 10 then 11
Warning: stack imbalance in '.Internal', 9 then 10
Warning: stack imbalance in '{', 6 then 7
[1] NA

 > sessionInfo()
R Under development (unstable) (2013-04-18 r62615)
Platform: x86_64-unknown-linux-gnu (64-bit)

from config.log

   $ /home/mtmorgan/src/R-devel/configure --enable-memory-profiling 
--disable-byte-compiled-packages --enable-R-shlib CC=clang CFLAGS=-g -O0 
CXX=clang++ CXXFLAGS=-g -O0 --no-create --no-recursion

with

$ clang --version
Ubuntu clang version 3.0-6ubuntu3 (tags/RELEASE_30/final) (based on LLVM 3.0)
Target: x86_64-pc-linux-gnu
Thread model: posix


>
>>
>> Index: array.c
>> ===================================================================
>> --- array.c    (revision 61606)
>> +++ array.c    (working copy)
>> @@ -1614,7 +1614,10 @@
>>       SEXP m = CAR(args);
>>       int method = asInteger(CADR(args));
>>       int nr = nrows(m), nc = ncols(m), nprot = 1;
>> -    if (TYPEOF(m) != REALSXP) PROTECT(m = coerceVector(m, REALSXP));
>> +    if (TYPEOF(m) != REALSXP) {
>> +      PROTECT(m = coerceVector(m, REALSXP));
>> +      nprot++;
>> +    }
>>       SEXP ans = allocVector(INTSXP, nr);
>>       PROTECT(ans);
>>       R_max_col(REAL(m), &nr, &nc, INTEGER(ans), &method);
>>
>> Thanks,
>> Michael
>>
>>     [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>


-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From murdoch.duncan at gmail.com  Fri Apr 19 16:04:00 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 19 Apr 2013 10:04:00 -0400
Subject: [Rd] how to control the environment of a formula
In-Reply-To: <86obdbetlz.fsf@biostat.ku.dk>
References: <86bo9ce87b.fsf@biostat.ku.dk> <516FE87F.90906@gmail.com>
	<86obdbetlz.fsf@biostat.ku.dk>
Message-ID: <51714ED0.3010307@gmail.com>

On 13-04-18 11:39 AM, Thomas Alexander Gerds wrote:
> Dear Duncan
>
> thank you for taking the time to answer my questions! It will be quite
> some work to delete all the objects generated inside the function
> ... but if there is no other way to avoid a large environment then this
> is what I will do.

It's not really that hard.  Use names <- ls() in the function to get a 
list of all of them; remove the names of variables that might be needed 
in the formula (and the name of the formula itself); then use 
rm(list=names) to delete everything else just before returning it.

Duncan Murdoch

>
> Cheers
> Thomas
>
> Duncan Murdoch <murdoch.duncan at gmail.com> writes:
>
>> On 13-04-18 1:09 AM, Thomas Alexander Gerds wrote:
>>> Dear List
>>> I have experienced that objects generated with one of my packages
>>> used a lot of space when saved on disc (object.size did not show
>>> this!).
>>> some debugging revealed that formula and call objects carried the
>>> full environment of subroutines along, including even stuff not
>>> needed by the formula or call. here is a sketch of the problem
>>> ,----
>>> | test <- function(x){ x <- rnorm(1000000) out <- list() out$f <-
>>> | a~b out } v <- test(1) save(v,file="~/tmp/v.rda") system("ls -lah
>>> | ~/tmp/v.rda")
>>> | -rw-rw-r-- 1 tag tag 7,4M Apr 18 06:41 /home/tag/tmp/v.rda
>>> `----
>>> I tried to replace line 3 by
>>> ,----
>>> | as.formula(a~b,env=emptyenv()) or as.formula(a~b,env=NULL)
>>> `----
>>> without the desired effect. Instead adding either
>>> ,----
>>> | environment(out$f) <- emptyenv() or environment(out$f) <- NULL
>>> `----
>>> has the desired effect (i.e. the saved object size is
>>> shrunken). unfortunately there is a new problem:
>>> ,----
>>> | test <- function(x){ x <- rnorm(1000000) out <- list() out$f <-
>>> | a~b environment(out$f) <- emptyenv() out } d <-
>>> | data.frame(a=1,b=1) v <- test(1) model.frame(v$f,data=d)
>>> | Error in eval(expr, envir, enclos) : could not find function
>>> | "list"
>>> `----
>>> Same with NULL in place of emptyenv()
>>> Finally using .GlobalEnv in place of emptyenv() seems to remove both
>>> problems.
>>
>> But it will cause other, less obvious problems.  In a formula, the
>> symbols mean something.  By setting the environment to .GlobalEnv
>> you're changing the meaning.  You'll get nonsense in certain cases
>> when functions look up the meaning of those symbols and find the wrong
>> thing. (I don't have an example at hand, but I imagine it would be
>> easy to put one together with update().)
>>
>>> My questions:
>>> 1) why does the argument env of as.formula have no effect?
>>
>> Because the first argument already had an associated environment.  You
>> passed a ~ b, which is evaluated to a formula; calling as.formula on a
>> formula does nothing. The env argument is only used when a new formula
>> needs to be constructed.  (You can see this in the source code;
>> as.formula is a very simple function.)
>>
>>> 2) is there a better way to tell formula not to copy unrelated stuff
>>> into the associated environment?
>>
>> Yes, delete it.  For example, you could write your function as
>>
>>   test <- function(x){ x <- rnorm(1000000) out <- list() out$f <- a~b
>> rm(x) out }
>>
>>> 3) why does object.size not show the size of the environments that
>>> formulas can carry along?
>>
>> Because many objects can share the same environment.  See ?object.size
>> for more details.
>>
>> Duncan Murdoch
>


From murdoch.duncan at gmail.com  Fri Apr 19 16:05:08 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 19 Apr 2013 10:05:08 -0400
Subject: [Rd] how to control the environment of a formula
In-Reply-To: <CD96A5A0.1540%therneau@mayo.edu>
References: <CD96A5A0.1540%therneau@mayo.edu>
Message-ID: <51714F14.60105@gmail.com>

On 13-04-19 8:41 AM, Therneau, Terry M., Ph.D. wrote:
>   I went through the same problem and discovery process 2 years ago with the survival package.  With pspline()  terms the return object from coxph includes a simple 6 line function for enhanced printout, which by default carried along another 30 irrelevant things some of which were huge.
> I personally think that setting environment(f) <- .Globalenv is the clearest and most simple solution.
> Note that R does not save the environment of functions defined at the top level; the prior line says to treat your function as "one of those".  It works very well as long as your function is an actual function,  i.e. It depends only on its input arguments.
>
> \begin {opinion}
>    S started out as a pure functional language.  That is, a function depends ONLY on its arguments.   Many of the strengths of S/R flow directly from the simplicity and rigor that this gives.
> There is an adage in programming, going back to at least the earliest Fortran compilers,  that all successful languages have a way to break their own rules;  and S indeed had some hidden workarounds.  Formalizing these non-functional back doors as R has done with environments is a good thing.
>
> However, the back doors should be used only with extreme reluctance.  I cringe at each new "how to be sneaky" discussion on the mailing lists.  The 'solution' is rarely worth the long term price.
>   \end{opinion}

Hmmm, it seems to me that your first paragraph contradicts your opinion. 
  If you set the environment of a formula to .GlobalEnv then suddenly 
the way that formula acts depends on all sorts of things that weren't 
there when it was created.

Attaching the formula at the time of creation of a formula means that 
the names within it refer to data that is currently in scope.  That's 
generally a good thing.  It means that code will act the same when you 
run it at the top level or in a function.

For example, consider this:

f <- function() {
    x <- 1:10
    x2 <- x^2
    y <- rnorm(10, mean=x2)
    formula <- y ~ x + x2
    formula
}

fit <- lm(f())
update(fit, . ~ . - x)


This code works fine, all because the formula keeps the environment 
where it was created.  If I modify it like this:

f <- function() {
    x <- 1:10
    x2 <- x^2
    y <- rnorm(10, mean=x2)
    formula <- y ~ x + x2
    environment(formula) <- .GlobalEnv
    formula
}

fit <- lm(f())
update(fit, . ~ . - x)


then I really have no idea what it will produce, because it depends on 
global variables y, x and x2, not the local ones created in the 
function.  If I'm lucky, I'll get an "object not found" error; if I'm 
not lucky, it'll just go find some other variables and use those.

Duncan Murdoch


From Thomas.Petzoldt at tu-dresden.de  Fri Apr 19 19:22:48 2013
From: Thomas.Petzoldt at tu-dresden.de (Thomas Petzoldt)
Date: Fri, 19 Apr 2013 19:22:48 +0200
Subject: [Rd] Linux distribution with gcc 4.8  and AddressSanitizer ?
In-Reply-To: <1665624.PmurviQP17@ulysses>
References: <5170135E.7090309@tu-dresden.de> <1665624.PmurviQP17@ulysses>
Message-ID: <51717D68.4050400@tu-dresden.de>

On 18.04.2013 18:05, Jos? Matos wrote:
> On Thursday 18 April 2013 17:38:06 Thomas Petzoldt wrote:
>> Dear R developers,
>>
>> I've got an information from Prof. Ripley regarding a bug found
>> with AdressSanitizer in one of our packages. It is now fixed, thank
>> you for this information.
>>
>> Now, I would like to run AddressSanitizer myself before submitting
>> the patched package to CRAN.
>>
>> Is there a recommendation of a suitable Linux distribution with gcc
>> 4.8, ideally an ISO image or (even better) a virtual appliance for
>> VMware or VirtalBox? My Debian Wheezy machines have only 4.7.2.
>>
>> Thank you
>>
>> Thomas Petzoldt
>
> I am not sure about all the requisites above (regarding the virtual
> appliances although I know that they are available) but Fedora 19
> (Alpha) that will be released today has gcc 4.8.
>
> Even although it has the Alpha moniker, and the corresponding stage,
> it is relatively stable and thus suitable for your requirements.
>
> Regards,
>

Thank you for the hint to use Fedora 19 Alpha. I have it now running,
together with R 3.0.0. and gcc 4.8.0 20120412 (Red Hat 4.8.0-2).

Compilation and installation of packages (without ASAN) workes out of 
the box.

Then I've set:

export PKG_CFLAGS="-fsanitize=address -fno-omit-frame-pointer"

... and compilation runs and I see that gcc uses the flags, but package
installation still fails:

** testing if installed package can be loaded
Error in dyn.load(file, DLLpath = DLLpath, ...) :
   unable to load shared object
'/home/user/packages/deSolve.Rcheck/deSolve/libs/deSolve.so':
   /home/user/packages/deSolve.Rcheck/deSolve/libs/deSolve.so: undefined
symbol: __asan_report_load8
Error: loading failed
Execution halted
ERROR: loading failed


I see that the address sanitizer cannot work yet (__asan_report_load8)
and that I missed something important, but what?

Thomas Petzoldt



-- 
Thomas Petzoldt
Technische Universitaet Dresden
Faculty of Environmental Sciences
Institute of Hydrobiology
01062 Dresden, Germany

E-Mail: thomas.petzoldt at tu-dresden.de
http://tu-dresden.de/Members/thomas.petzoldt


From therneau at mayo.edu  Fri Apr 19 19:27:12 2013
From: therneau at mayo.edu (Therneau, Terry M., Ph.D.)
Date: Fri, 19 Apr 2013 17:27:12 +0000
Subject: [Rd] how to control the environment of a formula
In-Reply-To: <51714F14.60105@gmail.com>
Message-ID: <CD96E2CF.154C%therneau@mayo.edu>

Duncan,
 I stand by all my comments.  Well behaved function -- those that look
only at their input arguments -- do just fine with a simple env.
 Now as to formulas --- the part of R that has most aggressively messed
with normal evaluation rules.  It is quite possible that there is/was no
other way to implement their functionality set, so I'm not throwing rocks
at that.  However, as soon as they enter the scene the consequences
multiply like rabbits and I feel like I've fallen into a hall of mirrors.
Nothing else has caused me as much ongoing confusion and wonderment in the
survival package.
  As soon as you introduced them all my arguments are irrelevant.

Terry T


On 4/19/13 9:05 AM, "Duncan Murdoch" <murdoch.duncan at gmail.com> wrote:

>On 13-04-19 8:41 AM, Therneau, Terry M., Ph.D. wrote:
>>   I went through the same problem and discovery process 2 years ago
>>with the survival package.  With pspline()  terms the return object from
>>coxph includes a simple 6 line function for enhanced printout, which by
>>default carried along another 30 irrelevant things some of which were
>>huge.
>> I personally think that setting environment(f) <- .Globalenv is the
>>clearest and most simple solution.
>> Note that R does not save the environment of functions defined at the
>>top level; the prior line says to treat your function as "one of those".
>> It works very well as long as your function is an actual function,
>>i.e. It depends only on its input arguments.
>>
>> \begin {opinion}
>>    S started out as a pure functional language.  That is, a function
>>depends ONLY on its arguments.   Many of the strengths of S/R flow
>>directly from the simplicity and rigor that this gives.
>> There is an adage in programming, going back to at least the earliest
>>Fortran compilers,  that all successful languages have a way to break
>>their own rules;  and S indeed had some hidden workarounds.  Formalizing
>>these non-functional back doors as R has done with environments is a
>>good thing.
>>
>> However, the back doors should be used only with extreme reluctance.  I
>>cringe at each new "how to be sneaky" discussion on the mailing lists.
>>The 'solution' is rarely worth the long term price.
>>   \end{opinion}
>
>Hmmm, it seems to me that your first paragraph contradicts your opinion.
>  If you set the environment of a formula to .GlobalEnv then suddenly
>the way that formula acts depends on all sorts of things that weren't
>there when it was created.
>
>Attaching the formula at the time of creation of a formula means that
>the names within it refer to data that is currently in scope.  That's
>generally a good thing.  It means that code will act the same when you
>run it at the top level or in a function.
>
>For example, consider this:
>
>f <- function() {
>    x <- 1:10
>    x2 <- x^2
>    y <- rnorm(10, mean=x2)
>    formula <- y ~ x + x2
>    formula
>}
>
>fit <- lm(f())
>update(fit, . ~ . - x)
>
>
>This code works fine, all because the formula keeps the environment
>where it was created.  If I modify it like this:
>
>f <- function() {
>    x <- 1:10
>    x2 <- x^2
>    y <- rnorm(10, mean=x2)
>    formula <- y ~ x + x2
>    environment(formula) <- .GlobalEnv
>    formula
>}
>
>fit <- lm(f())
>update(fit, . ~ . - x)
>
>
>then I really have no idea what it will produce, because it depends on
>global variables y, x and x2, not the local ones created in the
>function.  If I'm lucky, I'll get an "object not found" error; if I'm
>not lucky, it'll just go find some other variables and use those.
>
>Duncan Murdoch


From ripley at stats.ox.ac.uk  Fri Apr 19 20:19:26 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 19 Apr 2013 19:19:26 +0100
Subject: [Rd] Linux distribution with gcc 4.8  and AddressSanitizer ?
In-Reply-To: <51717D68.4050400@tu-dresden.de>
References: <5170135E.7090309@tu-dresden.de> <1665624.PmurviQP17@ulysses>
	<51717D68.4050400@tu-dresden.de>
Message-ID: <51718AAE.9080108@stats.ox.ac.uk>

On 19/04/2013 18:22, Thomas Petzoldt wrote:
> On 18.04.2013 18:05, Jos? Matos wrote:
>> On Thursday 18 April 2013 17:38:06 Thomas Petzoldt wrote:
>>> Dear R developers,
>>>
>>> I've got an information from Prof. Ripley regarding a bug found
>>> with AdressSanitizer in one of our packages. It is now fixed, thank
>>> you for this information.
>>>
>>> Now, I would like to run AddressSanitizer myself before submitting
>>> the patched package to CRAN.
>>>
>>> Is there a recommendation of a suitable Linux distribution with gcc
>>> 4.8, ideally an ISO image or (even better) a virtual appliance for
>>> VMware or VirtalBox? My Debian Wheezy machines have only 4.7.2.
>>>
>>> Thank you
>>>
>>> Thomas Petzoldt
>>
>> I am not sure about all the requisites above (regarding the virtual
>> appliances although I know that they are available) but Fedora 19
>> (Alpha) that will be released today has gcc 4.8.
>>
>> Even although it has the Alpha moniker, and the corresponding stage,
>> it is relatively stable and thus suitable for your requirements.
>>
>> Regards,
>>
>
> Thank you for the hint to use Fedora 19 Alpha. I have it now running,
> together with R 3.0.0. and gcc 4.8.0 20120412 (Red Hat 4.8.0-2).
>
> Compilation and installation of packages (without ASAN) workes out of
> the box.
>
> Then I've set:
>
> export PKG_CFLAGS="-fsanitize=address -fno-omit-frame-pointer"
>
> ... and compilation runs and I see that gcc uses the flags, but package
> installation still fails:
>
> ** testing if installed package can be loaded
> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>    unable to load shared object
> '/home/user/packages/deSolve.Rcheck/deSolve/libs/deSolve.so':
>    /home/user/packages/deSolve.Rcheck/deSolve/libs/deSolve.so: undefined
> symbol: __asan_report_load8
> Error: loading failed
> Execution halted
> ERROR: loading failed
>
>
> I see that the address sanitizer cannot work yet (__asan_report_load8)
> and that I missed something important, but what?

The manual said

'It requires code to have been compiled and linked with -fsanitize=address'

I don't see that you linked with it ...

I have (in ~/.R/Makevars)

CC="gcc -std=gnu99 -fsanitize=address -fno-omit-frame-pointer"

and similar for F77, CXX ....

I guess PKG_LIBS=-fsanitize=address might work.



'
>
> Thomas Petzoldt
>
>
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From tag at biostat.ku.dk  Fri Apr 19 20:57:22 2013
From: tag at biostat.ku.dk (Thomas Alexander Gerds)
Date: Fri, 19 Apr 2013 20:57:22 +0200
Subject: [Rd] how to control the environment of a formula
In-Reply-To: <51714ED0.3010307@gmail.com> (Duncan Murdoch's message of "Fri,
	19 Apr 2013 10:04:00 -0400")
References: <86bo9ce87b.fsf@biostat.ku.dk> <516FE87F.90906@gmail.com>
	<86obdbetlz.fsf@biostat.ku.dk> <51714ED0.3010307@gmail.com>
Message-ID: <86wqry5ox9.fsf@biostat.ku.dk>


hmm. I have tested a bit more, and found this perhaps more difficult
solve situation. even though I delete x, since x is part of the output
of the formula, the size of the object is twice as much as it should be:

test <- function(x){
  x <- rnorm(1000000)
  out <- list(x=x)
  rm(x)
  out$f <- as.formula(a~b)
  out
}
v <- test(1)
x <- rnorm(1000000)
save(v,file="~/tmp/v.rda")
save(x,file="~/tmp/x.rda")
system("ls -lah ~/tmp/*.rda")

-rw-rw-r-- 1 tag tag  15M Apr 19 20:52 /home/tag/tmp/v.rda
-rw-rw-r-- 1 tag tag 7,4M Apr 19 20:52 /home/tag/tmp/x.rda

can you solve this as well?

thanks!
thomas

Duncan Murdoch <murdoch.duncan at gmail.com> writes:

> On 13-04-18 11:39 AM, Thomas Alexander Gerds wrote:
>> Dear Duncan
>> thank you for taking the time to answer my questions! It will be
>> quite some work to delete all the objects generated inside the
>> function ... but if there is no other way to avoid a large
>> environment then this is what I will do.
>
> It's not really that hard.  Use names <- ls() in the function to get a
> list of all of them; remove the names of variables that might be
> needed in the formula (and the name of the formula itself); then use
> rm(list=names) to delete everything else just before returning it.
>
> Duncan Murdoch
>
-- 
Thomas A. Gerds -- Assoc. Prof. Department of Biostatistics Copenhagen
University of Copenhagen, Oester Farimagsgade 5, 1014 Copenhagen, Denmark


From simon.urbanek at r-project.org  Fri Apr 19 21:36:28 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 19 Apr 2013 15:36:28 -0400
Subject: [Rd] Linux distribution with gcc 4.8  and AddressSanitizer ?
In-Reply-To: <51718AAE.9080108@stats.ox.ac.uk>
References: <5170135E.7090309@tu-dresden.de> <1665624.PmurviQP17@ulysses>
	<51717D68.4050400@tu-dresden.de> <51718AAE.9080108@stats.ox.ac.uk>
Message-ID: <6FEF5F44-C3E9-488C-BA25-AFD595F3AAB5@r-project.org>


On Apr 19, 2013, at 2:19 PM, Prof Brian Ripley wrote:

> On 19/04/2013 18:22, Thomas Petzoldt wrote:
>> On 18.04.2013 18:05, Jos? Matos wrote:
>>> On Thursday 18 April 2013 17:38:06 Thomas Petzoldt wrote:
>>>> Dear R developers,
>>>> 
>>>> I've got an information from Prof. Ripley regarding a bug found
>>>> with AdressSanitizer in one of our packages. It is now fixed, thank
>>>> you for this information.
>>>> 
>>>> Now, I would like to run AddressSanitizer myself before submitting
>>>> the patched package to CRAN.
>>>> 
>>>> Is there a recommendation of a suitable Linux distribution with gcc
>>>> 4.8, ideally an ISO image or (even better) a virtual appliance for
>>>> VMware or VirtalBox? My Debian Wheezy machines have only 4.7.2.
>>>> 
>>>> Thank you
>>>> 
>>>> Thomas Petzoldt
>>> 
>>> I am not sure about all the requisites above (regarding the virtual
>>> appliances although I know that they are available) but Fedora 19
>>> (Alpha) that will be released today has gcc 4.8.
>>> 
>>> Even although it has the Alpha moniker, and the corresponding stage,
>>> it is relatively stable and thus suitable for your requirements.
>>> 
>>> Regards,
>>> 
>> 
>> Thank you for the hint to use Fedora 19 Alpha. I have it now running,
>> together with R 3.0.0. and gcc 4.8.0 20120412 (Red Hat 4.8.0-2).
>> 
>> Compilation and installation of packages (without ASAN) workes out of
>> the box.
>> 
>> Then I've set:
>> 
>> export PKG_CFLAGS="-fsanitize=address -fno-omit-frame-pointer"
>> 
>> ... and compilation runs and I see that gcc uses the flags, but package
>> installation still fails:
>> 
>> ** testing if installed package can be loaded
>> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>>   unable to load shared object
>> '/home/user/packages/deSolve.Rcheck/deSolve/libs/deSolve.so':
>>   /home/user/packages/deSolve.Rcheck/deSolve/libs/deSolve.so: undefined
>> symbol: __asan_report_load8
>> Error: loading failed
>> Execution halted
>> ERROR: loading failed
>> 
>> 
>> I see that the address sanitizer cannot work yet (__asan_report_load8)
>> and that I missed something important, but what?
> 
> The manual said
> 
> 'It requires code to have been compiled and linked with -fsanitize=address'
> 
> I don't see that you linked with it ...
> 
> I have (in ~/.R/Makevars)
> 
> CC="gcc -std=gnu99 -fsanitize=address -fno-omit-frame-pointer"
> 
> and similar for F77, CXX ....
> 
> I guess PKG_LIBS=-fsanitize=address might work.
> 

Just a data point: that didn't work for me on OS X using clang. I had to compile R with clang + asan, because clang seems to embed the run-time only in executables, not shared objects and when linking the .so to the runtime manually it broke. But building R with clang 3.3 from trunk and gfortran from CRAN did work with some tweaking - this is what I used:
CC=/opt/clang/bin/clang CXX=/opt/clang/bin/clang++ 'CFLAGS=-fsanitize=address -O1 -fno-omit-frame-pointer -g -Wall' 'CXXFLAGS=-fsanitize=address -O1 -fno-omit-frame-pointer -g -Wall' 'LDFLAGS=-fsanitize=address -L/usr/local/lib -lgfortran' 'FC=gfortran-4.2 -m64' 'F77=gfortran-4.2 -m64'

Another data point is that R segfaulted on start for me when compiled with gcc 4.8.0-3 from Debian experimental (amd64) with asan enabled (and I gave up when I couldn't get gfortran-4.8 to mix with clang-3.2 to try that route). Those are all very fragile tools, so it's not unexpected, but essentially it seems that it's not trivial to get a working set of tools...

Cheers,
Simon



> 
> 
> '
>> 
>> Thomas Petzoldt
>> 
>> 
>> 
> 
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From kevin.r.coombes at gmail.com  Fri Apr 19 23:37:07 2013
From: kevin.r.coombes at gmail.com (Kevin Coombes)
Date: Fri, 19 Apr 2013 16:37:07 -0500
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
Message-ID: <5171B903.50401@gmail.com>

Having finally found some free time, I was going to use it to update a 
bunch of R packages from 2.15 to 3.0.

I am running Windows 7, 64-bit professional.  This is on a brand-new 
laptop using vanilla settings when installing the operating system.

Problem 1: I installed R3.0 to the default location (C:\Program 
FIles\R\R-3.0.0).  The first thing I tried to do was install 
BioConductor.  This failed (permission denied). Thinking that this might 
be a BioConductor problem, I then tried to install a (semirandom) 
package from CRAN.  This also failed.

In both cases, when using the GUI, the error message is almost 
incomprehensible.  You get a pop-up window that *only* says "Do you want 
to use a private library instead?"  Since this wasn't what I wanted to 
do I said "no".  Only after the pop-up closes does the command window 
print the error message telling me that permission was denied for R to 
write to its own library location.

Dumb Fix to Problem 1: So, I uninstalled R and then reinstalled to a 
nonstandard location (C:\R\R-3.0.0).  Now I can successfully install 
packages from CRAN and BioConductor (hooray!). But I run directly into:

Problem 2: Emacs Speaks Statistics (ESS) can no longer find the R 
binary. When R was installed in the default location, ESS worked. When R 
2.15 (or earlier) was installed in the same nonstandard location, I 
could get ESS to find the R binaries by including (setq 
ess-directory-containing-r "C:") in my .emacs file, but that no longer 
works.

Dumb Fix to Problem 2:  Hack into ess-site.el and put the complete, 
explicit path to the correct binary into
(setq-default inferior-R-program-name 'FULLPATHHERE")
which will break as soon as I upgrade R (assuming I am foolish enough to 
ever do that again).


Now I am ready to rebuild my R packages.  I have this nice perl script 
that goes through the following procedure:

1. Set the path to include the correct Rtools directory.  (For reasons 
that Gabor Grothendieck has pointed out previously, this is not a 
permanent part of the path since doing so would override some built-in 
Windows commands.)
2. Build a source tarball via
     R CMD build $package
3. Build a Windows binary version (as a zip file) via
     R CMD INSTALL --build $tarball
4. Check the package via
     R CMD check --as-cran $tarball
5. Install the package via
     R CMD INSTALL $tarball

Problem 3: Step 3 fails, withe the error message "Running 'zip' failed".

Dumb Fix to Problem 3: Install the GnbuWin32 version of zip, and make 
sure that its location is earlier in ter path than the version that 
comes with Rtools.

Problem 4: Step 4 fails when running the test scripts that accompany the 
package.  The error message is the semicryptic
     "cannot open file 'c:\Users\krc\AppData\Local\Temp\Rtmp....' 
Permission denied"

Dumb Fix to Problem 4: Write this email message and hope someone with 
even more patience than I have has already found a better way to get all 
this stuff to work.

Tired of spinning my wheels,
     Kevin


From murdoch.duncan at gmail.com  Sat Apr 20 02:47:55 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 19 Apr 2013 20:47:55 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <5171B903.50401@gmail.com>
References: <5171B903.50401@gmail.com>
Message-ID: <5171E5BB.9010200@gmail.com>

On 13-04-19 5:37 PM, Kevin Coombes wrote:
> Having finally found some free time, I was going to use it to update a
> bunch of R packages from 2.15 to 3.0.
>
> I am running Windows 7, 64-bit professional.  This is on a brand-new
> laptop using vanilla settings when installing the operating system.
>
> Problem 1: I installed R3.0 to the default location (C:\Program
> FIles\R\R-3.0.0).  The first thing I tried to do was install
> BioConductor.  This failed (permission denied). Thinking that this might
> be a BioConductor problem, I then tried to install a (semirandom)
> package from CRAN.  This also failed.
>
> In both cases, when using the GUI, the error message is almost
> incomprehensible.  You get a pop-up window that *only* says "Do you want
> to use a private library instead?"  Since this wasn't what I wanted to
> do I said "no".  Only after the pop-up closes does the command window
> print the error message telling me that permission was denied for R to
> write to its own library location.

This is a standard Windows problem, to stop viruses from modifying 
installed programs.  The standard Windows solution to it is to run the 
installer as an administrator, taking personal responsibility for 
installing the package/virus.

Since this is a laptop, you could probably do this, but it's possible 
that you are not the administrator on your system.  If that's the case, 
you should ask your administrator to do the install.

>
> Dumb Fix to Problem 1: So, I uninstalled R and then reinstalled to a
> nonstandard location (C:\R\R-3.0.0).  Now I can successfully install
> packages from CRAN and BioConductor (hooray!). But I run directly into:

That's another solution, and a third solution is to accept the offer R 
made, to install your packages somewhere where you as a user have write 
permission.

>
> Problem 2: Emacs Speaks Statistics (ESS) can no longer find the R
> binary. When R was installed in the default location, ESS worked. When R
> 2.15 (or earlier) was installed in the same nonstandard location, I
> could get ESS to find the R binaries by including (setq
> ess-directory-containing-r "C:") in my .emacs file, but that no longer
> works.
>
> Dumb Fix to Problem 2:  Hack into ess-site.el and put the complete,
> explicit path to the correct binary into
> (setq-default inferior-R-program-name 'FULLPATHHERE")
> which will break as soon as I upgrade R (assuming I am foolish enough to
> ever do that again).

I can't help you with ESS.
>
>
> Now I am ready to rebuild my R packages.  I have this nice perl script
> that goes through the following procedure:
>
> 1. Set the path to include the correct Rtools directory.  (For reasons
> that Gabor Grothendieck has pointed out previously, this is not a
> permanent part of the path since doing so would override some built-in
> Windows commands.)

Just curious:  how often do you use the Windows find command?  We have 
put instructions in place for people to run the install process with a 
renamed Rtools find command (which I think is the only conflict). The 
issue is that more users who want to use the command line commands are 
familiar with the Unix variant (which came first, by the way) than the 
Windows one, so renaming the Rtools one would cause trouble for more people.

> 2. Build a source tarball via
>       R CMD build $package
> 3. Build a Windows binary version (as a zip file) via
>       R CMD INSTALL --build $tarball
> 4. Check the package via
>       R CMD check --as-cran $tarball
> 5. Install the package via
>       R CMD INSTALL $tarball
>
> Problem 3: Step 3 fails, withe the error message "Running 'zip' failed".
>
> Dumb Fix to Problem 3: Install the GnbuWin32 version of zip, and make
> sure that its location is earlier in ter path than the version that
> comes with Rtools.

I have no idea about this one.

>
> Problem 4: Step 4 fails when running the test scripts that accompany the
> package.  The error message is the semicryptic
>       "cannot open file 'c:\Users\krc\AppData\Local\Temp\Rtmp....'
> Permission denied"

That's Windows permissions biting you again.  Run as administrator.

Duncan Murdoch

> Dumb Fix to Problem 4: Write this email message and hope someone with
> even more patience than I have has already found a better way to get all
> this stuff to work.
>
> Tired of spinning my wheels,
>       Kevin
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From kevin.r.coombes at gmail.com  Sat Apr 20 03:18:30 2013
From: kevin.r.coombes at gmail.com (Kevin Coombes)
Date: Fri, 19 Apr 2013 20:18:30 -0500
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <5171E5BB.9010200@gmail.com>
References: <5171B903.50401@gmail.com>
	<5171E5BB.9010200@gmail.com>
Message-ID: <CAHJ+2VJ62CLANfTgDY11QnLXpsmEVxAEyHpien8MvcL0fnnAKQ@mail.gmail.com>

That's a reasonable theory.  Unfortunately, it is wrong.  The attached
image shows that I was running the Windows command prompt as an
administrator when I got the error message from R CMD check.

I will also point out that on my two desktops and my old laptop, I was able
to run R CMD check or INSTALL with R 2.15 and never had to explicitly
invoke the command prompt in administrator mode; it was enough that I was
an administrator on the machine.  However, it is still possible that this
is a Windows issue rather than an R 3.0 issue; that's obviously the
difficulty when changing both the machine and the R version at once. It
makes debugging painful.

PS: Apologies to Duncan for sending this to him twice;  I accidentally hit
"reply" instead of "reply all" the first time. I hate working on new
machines when I don't yet have all of my tools installed and have to use
ones that I'm less familiar with....


On Fri, Apr 19, 2013 at 7:47 PM, Duncan Murdoch <murdoch.duncan at gmail.com>wrote:

> On 13-04-19 5:37 PM, Kevin Coombes wrote:
>
>> Having finally found some free time, I was going to use it to update a
>> bunch of R packages from 2.15 to 3.0.
>>
>> I am running Windows 7, 64-bit professional.  This is on a brand-new
>> laptop using vanilla settings when installing the operating system.
>>
>> Problem 1: I installed R3.0 to the default location (C:\Program
>> FIles\R\R-3.0.0).  The first thing I tried to do was install
>> BioConductor.  This failed (permission denied). Thinking that this might
>> be a BioConductor problem, I then tried to install a (semirandom)
>> package from CRAN.  This also failed.
>>
>> In both cases, when using the GUI, the error message is almost
>> incomprehensible.  You get a pop-up window that *only* says "Do you want
>> to use a private library instead?"  Since this wasn't what I wanted to
>> do I said "no".  Only after the pop-up closes does the command window
>> print the error message telling me that permission was denied for R to
>> write to its own library location.
>>
>
> This is a standard Windows problem, to stop viruses from modifying
> installed programs.  The standard Windows solution to it is to run the
> installer as an administrator, taking personal responsibility for
> installing the package/virus.
>
> Since this is a laptop, you could probably do this, but it's possible that
> you are not the administrator on your system.  If that's the case, you
> should ask your administrator to do the install.
>
>
>
>> Dumb Fix to Problem 1: So, I uninstalled R and then reinstalled to a
>> nonstandard location (C:\R\R-3.0.0).  Now I can successfully install
>> packages from CRAN and BioConductor (hooray!). But I run directly into:
>>
>
> That's another solution, and a third solution is to accept the offer R
> made, to install your packages somewhere where you as a user have write
> permission.
>
>
>
>> Problem 2: Emacs Speaks Statistics (ESS) can no longer find the R
>> binary. When R was installed in the default location, ESS worked. When R
>> 2.15 (or earlier) was installed in the same nonstandard location, I
>> could get ESS to find the R binaries by including (setq
>> ess-directory-containing-r "C:") in my .emacs file, but that no longer
>> works.
>>
>> Dumb Fix to Problem 2:  Hack into ess-site.el and put the complete,
>> explicit path to the correct binary into
>> (setq-default inferior-R-program-name 'FULLPATHHERE")
>> which will break as soon as I upgrade R (assuming I am foolish enough to
>> ever do that again).
>>
>
> I can't help you with ESS.
>
>
>>
>> Now I am ready to rebuild my R packages.  I have this nice perl script
>> that goes through the following procedure:
>>
>> 1. Set the path to include the correct Rtools directory.  (For reasons
>> that Gabor Grothendieck has pointed out previously, this is not a
>> permanent part of the path since doing so would override some built-in
>> Windows commands.)
>>
>
> Just curious:  how often do you use the Windows find command?  We have put
> instructions in place for people to run the install process with a renamed
> Rtools find command (which I think is the only conflict). The issue is that
> more users who want to use the command line commands are familiar with the
> Unix variant (which came first, by the way) than the Windows one, so
> renaming the Rtools one would cause trouble for more people.
>
>
>  2. Build a source tarball via
>>       R CMD build $package
>> 3. Build a Windows binary version (as a zip file) via
>>       R CMD INSTALL --build $tarball
>> 4. Check the package via
>>       R CMD check --as-cran $tarball
>> 5. Install the package via
>>       R CMD INSTALL $tarball
>>
>> Problem 3: Step 3 fails, withe the error message "Running 'zip' failed".
>>
>> Dumb Fix to Problem 3: Install the GnbuWin32 version of zip, and make
>> sure that its location is earlier in ter path than the version that
>> comes with Rtools.
>>
>
> I have no idea about this one.
>
>
>
>> Problem 4: Step 4 fails when running the test scripts that accompany the
>> package.  The error message is the semicryptic
>>       "cannot open file 'c:\Users\krc\AppData\Local\**Temp\Rtmp....'
>> Permission denied"
>>
>
> That's Windows permissions biting you again.  Run as administrator.
>
> Duncan Murdoch
>
>  Dumb Fix to Problem 4: Write this email message and hope someone with
>> even more patience than I have has already found a better way to get all
>> this stuff to work.
>>
>> Tired of spinning my wheels,
>>       Kevin
>>
>> ______________________________**________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/**listinfo/r-devel<https://stat.ethz.ch/mailman/listinfo/r-devel>
>>
>>
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: admin-command.png
Type: image/png
Size: 42228 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130419/61fdea84/attachment.png>

From ggrothendieck at gmail.com  Sat Apr 20 04:03:25 2013
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 19 Apr 2013 22:03:25 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <5171E5BB.9010200@gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
Message-ID: <CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>

On Fri, Apr 19, 2013 at 8:47 PM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 13-04-19 5:37 PM, Kevin Coombes wrote:
>>
>> Having finally found some free time, I was going to use it to update a
>> bunch of R packages from 2.15 to 3.0.
>>
>> I am running Windows 7, 64-bit professional.  This is on a brand-new
>> laptop using vanilla settings when installing the operating system.
>>
>> Problem 1: I installed R3.0 to the default location (C:\Program
>> FIles\R\R-3.0.0).  The first thing I tried to do was install
>> BioConductor.  This failed (permission denied). Thinking that this might
>> be a BioConductor problem, I then tried to install a (semirandom)
>> package from CRAN.  This also failed.
>>
>> In both cases, when using the GUI, the error message is almost
>> incomprehensible.  You get a pop-up window that *only* says "Do you want
>> to use a private library instead?"  Since this wasn't what I wanted to
>> do I said "no".  Only after the pop-up closes does the command window
>> print the error message telling me that permission was denied for R to
>> write to its own library location.
>
>
> This is a standard Windows problem, to stop viruses from modifying installed
> programs.  The standard Windows solution to it is to run the installer as an
> administrator, taking personal responsibility for installing the
> package/virus.
>
> Since this is a laptop, you could probably do this, but it's possible that
> you are not the administrator on your system.  If that's the case, you
> should ask your administrator to do the install.
>
>
>>
>> Dumb Fix to Problem 1: So, I uninstalled R and then reinstalled to a
>> nonstandard location (C:\R\R-3.0.0).  Now I can successfully install
>> packages from CRAN and BioConductor (hooray!). But I run directly into:
>
>
> That's another solution, and a third solution is to accept the offer R made,
> to install your packages somewhere where you as a user have write
> permission.
>
>
>>
>> Problem 2: Emacs Speaks Statistics (ESS) can no longer find the R
>> binary. When R was installed in the default location, ESS worked. When R
>> 2.15 (or earlier) was installed in the same nonstandard location, I
>> could get ESS to find the R binaries by including (setq
>> ess-directory-containing-r "C:") in my .emacs file, but that no longer
>> works.
>>
>> Dumb Fix to Problem 2:  Hack into ess-site.el and put the complete,
>> explicit path to the correct binary into
>> (setq-default inferior-R-program-name 'FULLPATHHERE")
>> which will break as soon as I upgrade R (assuming I am foolish enough to
>> ever do that again).
>
>
> I can't help you with ESS.
>
>>
>>
>> Now I am ready to rebuild my R packages.  I have this nice perl script
>> that goes through the following procedure:
>>
>> 1. Set the path to include the correct Rtools directory.  (For reasons
>> that Gabor Grothendieck has pointed out previously, this is not a
>> permanent part of the path since doing so would override some built-in
>> Windows commands.)
>
>
> Just curious:  how often do you use the Windows find command?  We have put
> instructions in place for people to run the install process with a renamed
> Rtools find command (which I think is the only conflict). The issue is that
> more users who want to use the command line commands are familiar with the
> Unix variant (which came first, by the way) than the Windows one, so
> renaming the Rtools one would cause trouble for more people.

Its not just find - its also sort. And really R has no business
clobbering built in Windows commands. This is just wrong and really
causes anyone who does any significant amount of Windows batch
programming (or uses batch programs of any complexity) endless
problems.


From murdoch.duncan at gmail.com  Sat Apr 20 11:36:49 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 20 Apr 2013 05:36:49 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
Message-ID: <517261B1.6060306@gmail.com>

On 13-04-19 10:03 PM, Gabor Grothendieck wrote:
> On Fri, Apr 19, 2013 at 8:47 PM, Duncan Murdoch
> <murdoch.duncan at gmail.com> wrote:
>> On 13-04-19 5:37 PM, Kevin Coombes wrote:
>>>
>>> Having finally found some free time, I was going to use it to update a
>>> bunch of R packages from 2.15 to 3.0.
>>>
>>> I am running Windows 7, 64-bit professional.  This is on a brand-new
>>> laptop using vanilla settings when installing the operating system.
>>>
>>> Problem 1: I installed R3.0 to the default location (C:\Program
>>> FIles\R\R-3.0.0).  The first thing I tried to do was install
>>> BioConductor.  This failed (permission denied). Thinking that this might
>>> be a BioConductor problem, I then tried to install a (semirandom)
>>> package from CRAN.  This also failed.
>>>
>>> In both cases, when using the GUI, the error message is almost
>>> incomprehensible.  You get a pop-up window that *only* says "Do you want
>>> to use a private library instead?"  Since this wasn't what I wanted to
>>> do I said "no".  Only after the pop-up closes does the command window
>>> print the error message telling me that permission was denied for R to
>>> write to its own library location.
>>
>>
>> This is a standard Windows problem, to stop viruses from modifying installed
>> programs.  The standard Windows solution to it is to run the installer as an
>> administrator, taking personal responsibility for installing the
>> package/virus.
>>
>> Since this is a laptop, you could probably do this, but it's possible that
>> you are not the administrator on your system.  If that's the case, you
>> should ask your administrator to do the install.
>>
>>
>>>
>>> Dumb Fix to Problem 1: So, I uninstalled R and then reinstalled to a
>>> nonstandard location (C:\R\R-3.0.0).  Now I can successfully install
>>> packages from CRAN and BioConductor (hooray!). But I run directly into:
>>
>>
>> That's another solution, and a third solution is to accept the offer R made,
>> to install your packages somewhere where you as a user have write
>> permission.
>>
>>
>>>
>>> Problem 2: Emacs Speaks Statistics (ESS) can no longer find the R
>>> binary. When R was installed in the default location, ESS worked. When R
>>> 2.15 (or earlier) was installed in the same nonstandard location, I
>>> could get ESS to find the R binaries by including (setq
>>> ess-directory-containing-r "C:") in my .emacs file, but that no longer
>>> works.
>>>
>>> Dumb Fix to Problem 2:  Hack into ess-site.el and put the complete,
>>> explicit path to the correct binary into
>>> (setq-default inferior-R-program-name 'FULLPATHHERE")
>>> which will break as soon as I upgrade R (assuming I am foolish enough to
>>> ever do that again).
>>
>>
>> I can't help you with ESS.
>>
>>>
>>>
>>> Now I am ready to rebuild my R packages.  I have this nice perl script
>>> that goes through the following procedure:
>>>
>>> 1. Set the path to include the correct Rtools directory.  (For reasons
>>> that Gabor Grothendieck has pointed out previously, this is not a
>>> permanent part of the path since doing so would override some built-in
>>> Windows commands.)
>>
>>
>> Just curious:  how often do you use the Windows find command?  We have put
>> instructions in place for people to run the install process with a renamed
>> Rtools find command (which I think is the only conflict). The issue is that
>> more users who want to use the command line commands are familiar with the
>> Unix variant (which came first, by the way) than the Windows one, so
>> renaming the Rtools one would cause trouble for more people.
>
> Its not just find - its also sort. And really R has no business
> clobbering built in Windows commands. This is just wrong and really
> causes anyone who does any significant amount of Windows batch
> programming (or uses batch programs of any complexity) endless
> problems.

Only those people who choose not to solve them in the recommended way.

Duncan Murdoch


From h.wickham at gmail.com  Sat Apr 20 16:45:31 2013
From: h.wickham at gmail.com (Hadley Wickham)
Date: Sat, 20 Apr 2013 09:45:31 -0500
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
Message-ID: <CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>

>> Just curious:  how often do you use the Windows find command?  We have put
>> instructions in place for people to run the install process with a renamed
>> Rtools find command (which I think is the only conflict). The issue is that
>> more users who want to use the command line commands are familiar with the
>> Unix variant (which came first, by the way) than the Windows one, so
>> renaming the Rtools one would cause trouble for more people.
>
> Its not just find - its also sort. And really R has no business
> clobbering built in Windows commands. This is just wrong and really
> causes anyone who does any significant amount of Windows batch
> programming (or uses batch programs of any complexity) endless
> problems.

Which is presumably why Rtools doesn't modify the path by default.

Better solutions (e.g. Rstudio and devtools) temporarily set the path
on when you're calling R CMD *.

Hadley

--
Chief Scientist, RStudio
http://had.co.nz/


From ggrothendieck at gmail.com  Sat Apr 20 17:09:03 2013
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 20 Apr 2013 11:09:03 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
Message-ID: <CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>

On Sat, Apr 20, 2013 at 10:45 AM, Hadley Wickham <h.wickham at gmail.com> wrote:
>>> Just curious:  how often do you use the Windows find command?  We have put
>>> instructions in place for people to run the install process with a renamed
>>> Rtools find command (which I think is the only conflict). The issue is that
>>> more users who want to use the command line commands are familiar with the
>>> Unix variant (which came first, by the way) than the Windows one, so
>>> renaming the Rtools one would cause trouble for more people.
>>
>> Its not just find - its also sort. And really R has no business
>> clobbering built in Windows commands. This is just wrong and really
>> causes anyone who does any significant amount of Windows batch
>> programming (or uses batch programs of any complexity) endless
>> problems.
>
> Which is presumably why Rtools doesn't modify the path by default.
>
> Better solutions (e.g. Rstudio and devtools) temporarily set the path
> on when you're calling R CMD *.

I am well aware of the various kludges to address this including my
own batchfiles ( http://batchfiles.googlecode.com ) which handles this
by temporarily changing the path as well; however, the real problem is
that Rtools does not play nice with Windows and that needs to be
addressed directly.

--
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From ligges at statistik.tu-dortmund.de  Sat Apr 20 17:42:21 2013
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sat, 20 Apr 2013 17:42:21 +0200
Subject: [Rd] Publishing my Package on CRAN
In-Reply-To: <1366346292344-4664676.post@n4.nabble.com>
References: <1366346292344-4664676.post@n4.nabble.com>
Message-ID: <5172B75D.9060101@statistik.tu-dortmund.de>



On 19.04.2013 06:38, liuyipei wrote:
> Hi,
>
> I have a simple package with two functions. It essentially implements
> estimators and data simulation for a paper I am writing  for immunology (and
> in some sense, ecology).  How long is the typical CRAN review process

Typically less than 12 hours.

> -- and
> how long will it take to get through the process?  How selective is it?

Depends on how well the package is prepared.

Best,
Uwe Ligges



> I have never published a package before, so I am wondering whether you guys
> think this is a reasonable thing for me to promise in the paper that the
> package will be available on CRAN.
>
> Thank you for your advice in advance!
>
>
>
> --
> View this message in context: http://r.789695.n4.nabble.com/Publishing-my-Package-on-CRAN-tp4664676.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From murdoch.duncan at gmail.com  Sat Apr 20 17:49:16 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 20 Apr 2013 11:49:16 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
Message-ID: <5172B8FC.6010004@gmail.com>

On 13-04-20 11:09 AM, Gabor Grothendieck wrote:
> On Sat, Apr 20, 2013 at 10:45 AM, Hadley Wickham <h.wickham at gmail.com> wrote:
>>>> Just curious:  how often do you use the Windows find command?  We have put
>>>> instructions in place for people to run the install process with a renamed
>>>> Rtools find command (which I think is the only conflict). The issue is that
>>>> more users who want to use the command line commands are familiar with the
>>>> Unix variant (which came first, by the way) than the Windows one, so
>>>> renaming the Rtools one would cause trouble for more people.
>>>
>>> Its not just find - its also sort. And really R has no business
>>> clobbering built in Windows commands. This is just wrong and really
>>> causes anyone who does any significant amount of Windows batch
>>> programming (or uses batch programs of any complexity) endless
>>> problems.
>>
>> Which is presumably why Rtools doesn't modify the path by default.
>>
>> Better solutions (e.g. Rstudio and devtools) temporarily set the path
>> on when you're calling R CMD *.
>
> I am well aware of the various kludges to address this including my
> own batchfiles ( http://batchfiles.googlecode.com ) which handles this
> by temporarily changing the path as well; however, the real problem is
> that Rtools does not play nice with Windows and that needs to be
> addressed directly.

It has been.  You ignored it.

Duncan Murdoch


From ggrothendieck at gmail.com  Sat Apr 20 18:30:43 2013
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 20 Apr 2013 12:30:43 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <5172B8FC.6010004@gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
Message-ID: <CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>

On Sat, Apr 20, 2013 at 11:49 AM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 13-04-20 11:09 AM, Gabor Grothendieck wrote:
>>
>> On Sat, Apr 20, 2013 at 10:45 AM, Hadley Wickham <h.wickham at gmail.com>
>> wrote:
>>>>>
>>>>> Just curious:  how often do you use the Windows find command?  We have
>>>>> put
>>>>> instructions in place for people to run the install process with a
>>>>> renamed
>>>>> Rtools find command (which I think is the only conflict). The issue is
>>>>> that
>>>>> more users who want to use the command line commands are familiar with
>>>>> the
>>>>> Unix variant (which came first, by the way) than the Windows one, so
>>>>> renaming the Rtools one would cause trouble for more people.
>>>>
>>>>
>>>> Its not just find - its also sort. And really R has no business
>>>> clobbering built in Windows commands. This is just wrong and really
>>>> causes anyone who does any significant amount of Windows batch
>>>> programming (or uses batch programs of any complexity) endless
>>>> problems.
>>>
>>>
>>> Which is presumably why Rtools doesn't modify the path by default.
>>>
>>> Better solutions (e.g. Rstudio and devtools) temporarily set the path
>>> on when you're calling R CMD *.
>>
>>
>> I am well aware of the various kludges to address this including my
>> own batchfiles ( http://batchfiles.googlecode.com ) which handles this
>> by temporarily changing the path as well; however, the real problem is
>> that Rtools does not play nice with Windows and that needs to be
>> addressed directly.
>
>
> It has been.  You ignored it.
>
> Duncan Murdoch
>

If some change to address this has been made that would be great but
there is no mention of it on the Rtools page in the change history
section (the only documented change relates to the png/tiff/jpeg
libraries), there was no announcement that I saw and Rtools\bin still
contains find and sort so what specifically is the change?

--
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From Thomas.Petzoldt at TU-Dresden.de  Sat Apr 20 19:14:41 2013
From: Thomas.Petzoldt at TU-Dresden.de (Thomas Petzoldt)
Date: Sat, 20 Apr 2013 19:14:41 +0200
Subject: [Rd] Linux distribution with gcc 4.8 and AddressSanitizer --
 solved
In-Reply-To: <1665624.PmurviQP17@ulysses>
References: <5170135E.7090309@tu-dresden.de> <1665624.PmurviQP17@ulysses>
Message-ID: <5172CD01.1050304@TU-Dresden.de>

It works!

After some hours of compilation, reading the docs and testing,
I got it now working and was able to reproduce (and fix) the
reported error message.

Then ingredients of the successful AdressSanitizer (ASAN)
system were:

- Fedora 19 Alpha RC4 with gcc 4.8 on VirtualBox,
- manual installation of several additional libraries
   especially libasan-devel,
- setting of Makevars and a few environment variables,
- compilation of R-devel (2013-04-19) with address-sanitizer
   (and --enable-strict barrier)
   ==> the compilation of R itself went through
       without problems so that R runs without crash.

Finally:
- compilation and ASAN check of the affected package
   that reproduced the error message.
- bugfix and successful final test.


Maybe this was not the most parsimonious approach ;-)
but using a suitable self-compiled R seems to be unavoidable.



Again, many thanks for your help and the great R system!

Thomas P.



-- 
Thomas Petzoldt
Technische Universitaet Dresden
Faculty of Environmental Sciences
Institute of Hydrobiology
01062 Dresden, Germany

E-Mail: thomas.petzoldt at tu-dresden.de
http://tu-dresden.de/Members/thomas.petzoldt


From murdoch.duncan at gmail.com  Sat Apr 20 19:44:35 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 20 Apr 2013 13:44:35 -0400
Subject: [Rd] how to control the environment of a formula
In-Reply-To: <86wqry5ox9.fsf@biostat.ku.dk>
References: <86bo9ce87b.fsf@biostat.ku.dk> <516FE87F.90906@gmail.com>
	<86obdbetlz.fsf@biostat.ku.dk> <51714ED0.3010307@gmail.com>
	<86wqry5ox9.fsf@biostat.ku.dk>
Message-ID: <5172D403.9010307@gmail.com>

On 13-04-19 2:57 PM, Thomas Alexander Gerds wrote:
>
> hmm. I have tested a bit more, and found this perhaps more difficult
> solve situation. even though I delete x, since x is part of the output
> of the formula, the size of the object is twice as much as it should be:
>
> test <- function(x){
>    x <- rnorm(1000000)
>    out <- list(x=x)
>    rm(x)
>    out$f <- as.formula(a~b)
>    out
> }
> v <- test(1)
> x <- rnorm(1000000)
> save(v,file="~/tmp/v.rda")
> save(x,file="~/tmp/x.rda")
> system("ls -lah ~/tmp/*.rda")
>
> -rw-rw-r-- 1 tag tag  15M Apr 19 20:52 /home/tag/tmp/v.rda
> -rw-rw-r-- 1 tag tag 7,4M Apr 19 20:52 /home/tag/tmp/x.rda
>
> can you solve this as well?

Yes, this is tricky.  The problem is that "out" is in the environment of 
out$f, so you get two copies when you save it.  (I think you won't have 
two copies in memory, because R only makes a copy when it needs to, but 
I haven't traced this.)

Here are two solutions, both have some problems.

1.  Don't put out in the environment:

test <- function(x) {
   x <- rnorm(1000000)
   out$x <- list(x=x)
   out$f <- a ~ b    # the as.formula() was never needed
   # temporarily create a new environment
   local({
     # get a copy of what you want to keep
     out <- out
     # remove everything that you don't need from the formula
     rm(list=c("x", "out"), envir=environment(out$f))
     # return the local copy
     out
   })
}

I don't like this because it is too tricky, but you could probably wrap 
the tricky bits into a little function (a variant on return() that 
cleans out the environment first), so it's probably what I would use if 
I was desperate to save space in saved copies.

2. Never evaluate the formula in the first place, so it doesn't pick up 
the environment:

test <- function(x) {
   x <- rnorm(1000000)
   out$x <- list(x=x)
   out$f <- quote(a ~ b)
   out
}

This is a lot simpler, but it might not work with some modelling 
functions, which would be confused by receiving the model formula 
unevaluated.  It also has the problems that you get with using 
.GlobalEnv as the environment of the formula, but maybe to a slightly 
lesser extent:  rather than having what is possibly the wrong 
environment, it doesn't have one at all.

Duncan Murdoch


>
> thanks!
> thomas
>
> Duncan Murdoch <murdoch.duncan at gmail.com> writes:
>
>> On 13-04-18 11:39 AM, Thomas Alexander Gerds wrote:
>>> Dear Duncan
>>> thank you for taking the time to answer my questions! It will be
>>> quite some work to delete all the objects generated inside the
>>> function ... but if there is no other way to avoid a large
>>> environment then this is what I will do.
>>
>> It's not really that hard.  Use names <- ls() in the function to get a
>> list of all of them; remove the names of variables that might be
>> needed in the formula (and the name of the formula itself); then use
>> rm(list=names) to delete everything else just before returning it.
>>
>> Duncan Murdoch
>>


From murdoch.duncan at gmail.com  Sat Apr 20 19:54:41 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 20 Apr 2013 13:54:41 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
Message-ID: <5172D661.4000703@gmail.com>

On 13-04-20 12:30 PM, Gabor Grothendieck wrote:
> On Sat, Apr 20, 2013 at 11:49 AM, Duncan Murdoch
> <murdoch.duncan at gmail.com> wrote:
>> On 13-04-20 11:09 AM, Gabor Grothendieck wrote:
>>>
>>> On Sat, Apr 20, 2013 at 10:45 AM, Hadley Wickham <h.wickham at gmail.com>
>>> wrote:
>>>>>>
>>>>>> Just curious:  how often do you use the Windows find command?  We have
>>>>>> put
>>>>>> instructions in place for people to run the install process with a
>>>>>> renamed
>>>>>> Rtools find command (which I think is the only conflict). The issue is
>>>>>> that
>>>>>> more users who want to use the command line commands are familiar with
>>>>>> the
>>>>>> Unix variant (which came first, by the way) than the Windows one, so
>>>>>> renaming the Rtools one would cause trouble for more people.
>>>>>
>>>>>
>>>>> Its not just find - its also sort. And really R has no business
>>>>> clobbering built in Windows commands. This is just wrong and really
>>>>> causes anyone who does any significant amount of Windows batch
>>>>> programming (or uses batch programs of any complexity) endless
>>>>> problems.
>>>>
>>>>
>>>> Which is presumably why Rtools doesn't modify the path by default.
>>>>
>>>> Better solutions (e.g. Rstudio and devtools) temporarily set the path
>>>> on when you're calling R CMD *.
>>>
>>>
>>> I am well aware of the various kludges to address this including my
>>> own batchfiles ( http://batchfiles.googlecode.com ) which handles this
>>> by temporarily changing the path as well; however, the real problem is
>>> that Rtools does not play nice with Windows and that needs to be
>>> addressed directly.
>>
>>
>> It has been.  You ignored it.
>>
>> Duncan Murdoch
>>
>
> If some change to address this has been made that would be great but
> there is no mention of it on the Rtools page in the change history
> section (the only documented change relates to the png/tiff/jpeg
> libraries), there was no announcement that I saw and Rtools\bin still
> contains find and sort so what specifically is the change?

It's not a change to Rtools, it's a change is to the build system in R: 
  it allows you to rename sort or find in your own copy of Rtools, and R 
will use whatever you specify.  You were informed of this when I did it 
in 2007, and I've mentioned it when the topic comes up here, most 
recently in the message quoted above.  That's a long time ago, so I 
don't remember if you tried it then, but I've never heard a complaint 
from anyone else that it doesn't work.

Duncan Murdoch


From kevin.r.coombes at gmail.com  Sat Apr 20 20:02:55 2013
From: kevin.r.coombes at gmail.com (Kevin Coombes)
Date: Sat, 20 Apr 2013 13:02:55 -0500
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <5172D661.4000703@gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com>
Message-ID: <5172D84F.3060801@gmail.com>


On 4/20/2013 12:54 PM, Duncan Murdoch wrote:
> On 13-04-20 12:30 PM, Gabor Grothendieck wrote:
>> On Sat, Apr 20, 2013 at 11:49 AM, Duncan Murdoch
>> <murdoch.duncan at gmail.com> wrote:
>>> On 13-04-20 11:09 AM, Gabor Grothendieck wrote:
>>>>
>>>> On Sat, Apr 20, 2013 at 10:45 AM, Hadley Wickham <h.wickham at gmail.com>
>>>> wrote:
>>>>>>>
>>>>>>> Just curious:  how often do you use the Windows find command?  
>>>>>>> We have
>>>>>>> put
>>>>>>> instructions in place for people to run the install process with a
>>>>>>> renamed
>>>>>>> Rtools find command (which I think is the only conflict). The 
>>>>>>> issue is
>>>>>>> that
>>>>>>> more users who want to use the command line commands are 
>>>>>>> familiar with
>>>>>>> the
>>>>>>> Unix variant (which came first, by the way) than the Windows 
>>>>>>> one, so
>>>>>>> renaming the Rtools one would cause trouble for more people.
>>>>>>
>>>>>>
>>>>>> Its not just find - its also sort. And really R has no business
>>>>>> clobbering built in Windows commands. This is just wrong and really
>>>>>> causes anyone who does any significant amount of Windows batch
>>>>>> programming (or uses batch programs of any complexity) endless
>>>>>> problems.
>>>>>
>>>>>
>>>>> Which is presumably why Rtools doesn't modify the path by default.
>>>>>
>>>>> Better solutions (e.g. Rstudio and devtools) temporarily set the path
>>>>> on when you're calling R CMD *.
>>>>
>>>>
>>>> I am well aware of the various kludges to address this including my
>>>> own batchfiles ( http://batchfiles.googlecode.com ) which handles this
>>>> by temporarily changing the path as well; however, the real problem is
>>>> that Rtools does not play nice with Windows and that needs to be
>>>> addressed directly.
>>>
>>>
>>> It has been.  You ignored it.
>>>
>>> Duncan Murdoch
>>>
>>
>> If some change to address this has been made that would be great but
>> there is no mention of it on the Rtools page in the change history
>> section (the only documented change relates to the png/tiff/jpeg
>> libraries), there was no announcement that I saw and Rtools\bin still
>> contains find and sort so what specifically is the change?
>
> It's not a change to Rtools, it's a change is to the build system in 
> R:  it allows you to rename sort or find in your own copy of Rtools, 
> and R will use whatever you specify.  You were informed of this when I 
> did it in 2007, and I've mentioned it when the topic comes up here, 
> most recently in the message quoted above.  That's a long time ago, so 
> I don't remember if you tried it then, but I've never heard a 
> complaint from anyone else that it doesn't work.
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

How do you do that?  (More explicitly, what steps would I have to take 
to redefine things like find.exe and sort.exe in Rtools so that R would 
know how to find them and use them? I can't figure that out from the 
earlier parts of these messages.)


From ggrothendieck at gmail.com  Sat Apr 20 20:10:16 2013
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 20 Apr 2013 14:10:16 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <5172D661.4000703@gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com>
Message-ID: <CAP01uRmFN8EgRDJM5QUCnJXP-RHcTva=bWOhpBQHjbez5+=-EA@mail.gmail.com>

On Sat, Apr 20, 2013 at 1:54 PM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 13-04-20 12:30 PM, Gabor Grothendieck wrote:
>>
>> On Sat, Apr 20, 2013 at 11:49 AM, Duncan Murdoch
>> <murdoch.duncan at gmail.com> wrote:
>>>
>>> On 13-04-20 11:09 AM, Gabor Grothendieck wrote:
>>>>
>>>>
>>>> On Sat, Apr 20, 2013 at 10:45 AM, Hadley Wickham <h.wickham at gmail.com>
>>>> wrote:
>>>>>>>
>>>>>>>
>>>>>>> Just curious:  how often do you use the Windows find command?  We
>>>>>>> have
>>>>>>> put
>>>>>>> instructions in place for people to run the install process with a
>>>>>>> renamed
>>>>>>> Rtools find command (which I think is the only conflict). The issue
>>>>>>> is
>>>>>>> that
>>>>>>> more users who want to use the command line commands are familiar
>>>>>>> with
>>>>>>> the
>>>>>>> Unix variant (which came first, by the way) than the Windows one, so
>>>>>>> renaming the Rtools one would cause trouble for more people.
>>>>>>
>>>>>>
>>>>>>
>>>>>> Its not just find - its also sort. And really R has no business
>>>>>> clobbering built in Windows commands. This is just wrong and really
>>>>>> causes anyone who does any significant amount of Windows batch
>>>>>> programming (or uses batch programs of any complexity) endless
>>>>>> problems.
>>>>>
>>>>>
>>>>>
>>>>> Which is presumably why Rtools doesn't modify the path by default.
>>>>>
>>>>> Better solutions (e.g. Rstudio and devtools) temporarily set the path
>>>>> on when you're calling R CMD *.
>>>>
>>>>
>>>>
>>>> I am well aware of the various kludges to address this including my
>>>> own batchfiles ( http://batchfiles.googlecode.com ) which handles this
>>>> by temporarily changing the path as well; however, the real problem is
>>>> that Rtools does not play nice with Windows and that needs to be
>>>> addressed directly.
>>>
>>>
>>>
>>> It has been.  You ignored it.
>>>
>>> Duncan Murdoch
>>>
>>
>> If some change to address this has been made that would be great but
>> there is no mention of it on the Rtools page in the change history
>> section (the only documented change relates to the png/tiff/jpeg
>> libraries), there was no announcement that I saw and Rtools\bin still
>> contains find and sort so what specifically is the change?
>
>
> It's not a change to Rtools, it's a change is to the build system in R:  it
> allows you to rename sort or find in your own copy of Rtools, and R will use
> whatever you specify.  You were informed of this when I did it in 2007, and
> I've mentioned it when the topic comes up here, most recently in the message
> quoted above.  That's a long time ago, so I don't remember if you tried it
> then, but I've never heard a complaint from anyone else that it doesn't
> work.
>

I certainly was not aware of this and posts in this thread suggest
that others were not aware of it either.

Perhaps you could provide some details and links. I am sure many
people would be interested.


--
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From ggrothendieck at gmail.com  Sat Apr 20 20:17:11 2013
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 20 Apr 2013 14:17:11 -0400
Subject: [Rd] how to control the environment of a formula
In-Reply-To: <5172D403.9010307@gmail.com>
References: <86bo9ce87b.fsf@biostat.ku.dk> <516FE87F.90906@gmail.com>
	<86obdbetlz.fsf@biostat.ku.dk> <51714ED0.3010307@gmail.com>
	<86wqry5ox9.fsf@biostat.ku.dk> <5172D403.9010307@gmail.com>
Message-ID: <CAP01uRm0nT7Ur6hMoe0QXBK5vXqQkdkwWrORRpv4itGTgjN2qA@mail.gmail.com>

On Sat, Apr 20, 2013 at 1:44 PM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 13-04-19 2:57 PM, Thomas Alexander Gerds wrote:
>>
>>
>> hmm. I have tested a bit more, and found this perhaps more difficult
>> solve situation. even though I delete x, since x is part of the output
>> of the formula, the size of the object is twice as much as it should be:
>>
>> test <- function(x){
>>    x <- rnorm(1000000)
>>    out <- list(x=x)
>>    rm(x)
>>    out$f <- as.formula(a~b)
>>    out
>> }
>> v <- test(1)
>> x <- rnorm(1000000)
>> save(v,file="~/tmp/v.rda")
>> save(x,file="~/tmp/x.rda")
>> system("ls -lah ~/tmp/*.rda")
>>
>> -rw-rw-r-- 1 tag tag  15M Apr 19 20:52 /home/tag/tmp/v.rda
>> -rw-rw-r-- 1 tag tag 7,4M Apr 19 20:52 /home/tag/tmp/x.rda
>>
>> can you solve this as well?
>
>
> Yes, this is tricky.  The problem is that "out" is in the environment of
> out$f, so you get two copies when you save it.  (I think you won't have two
> copies in memory, because R only makes a copy when it needs to, but I
> haven't traced this.)
>
> Here are two solutions, both have some problems.
>
> 1.  Don't put out in the environment:
>
>
> test <- function(x) {
>   x <- rnorm(1000000)
>   out$x <- list(x=x)
>   out$f <- a ~ b    # the as.formula() was never needed
>   # temporarily create a new environment
>   local({
>     # get a copy of what you want to keep
>     out <- out
>     # remove everything that you don't need from the formula
>     rm(list=c("x", "out"), envir=environment(out$f))
>     # return the local copy
>     out
>   })
> }
>
> I don't like this because it is too tricky, but you could probably wrap the
> tricky bits into a little function (a variant on return() that cleans out
> the environment first), so it's probably what I would use if I was desperate
> to save space in saved copies.
>
> 2. Never evaluate the formula in the first place, so it doesn't pick up the
> environment:
>
>
> test <- function(x) {
>   x <- rnorm(1000000)
>   out$x <- list(x=x)
>   out$f <- quote(a ~ b)
>   out
> }
>
> This is a lot simpler, but it might not work with some modelling functions,
> which would be confused by receiving the model formula unevaluated.  It also
> has the problems that you get with using .GlobalEnv as the environment of
> the formula, but maybe to a slightly lesser extent:  rather than having what
> is possibly the wrong environment, it doesn't have one at all.

An approach along the lines of Duncan's last solution that works with
lm but may or may not work with other regression-style functions is to
use a character string:

fit <- lm("demand ~ Time", BOD)

As long as you are only saving the input you should be OK but if you
are saving the output of lm then you are back to the same problem
since the "lm" object will contain a formula.

> class(formula(fit))
[1] "formula"


From murdoch.duncan at gmail.com  Sat Apr 20 20:21:12 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 20 Apr 2013 14:21:12 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <5172D84F.3060801@gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
Message-ID: <5172DC98.8040308@gmail.com>

On 13-04-20 2:02 PM, Kevin Coombes wrote:
>
> On 4/20/2013 12:54 PM, Duncan Murdoch wrote:
>> On 13-04-20 12:30 PM, Gabor Grothendieck wrote:
>>> On Sat, Apr 20, 2013 at 11:49 AM, Duncan Murdoch
>>> <murdoch.duncan at gmail.com> wrote:
>>>> On 13-04-20 11:09 AM, Gabor Grothendieck wrote:
>>>>>
>>>>> On Sat, Apr 20, 2013 at 10:45 AM, Hadley Wickham <h.wickham at gmail.com>
>>>>> wrote:
>>>>>>>>
>>>>>>>> Just curious:  how often do you use the Windows find command?
>>>>>>>> We have
>>>>>>>> put
>>>>>>>> instructions in place for people to run the install process with a
>>>>>>>> renamed
>>>>>>>> Rtools find command (which I think is the only conflict). The
>>>>>>>> issue is
>>>>>>>> that
>>>>>>>> more users who want to use the command line commands are
>>>>>>>> familiar with
>>>>>>>> the
>>>>>>>> Unix variant (which came first, by the way) than the Windows
>>>>>>>> one, so
>>>>>>>> renaming the Rtools one would cause trouble for more people.
>>>>>>>
>>>>>>>
>>>>>>> Its not just find - its also sort. And really R has no business
>>>>>>> clobbering built in Windows commands. This is just wrong and really
>>>>>>> causes anyone who does any significant amount of Windows batch
>>>>>>> programming (or uses batch programs of any complexity) endless
>>>>>>> problems.
>>>>>>
>>>>>>
>>>>>> Which is presumably why Rtools doesn't modify the path by default.
>>>>>>
>>>>>> Better solutions (e.g. Rstudio and devtools) temporarily set the path
>>>>>> on when you're calling R CMD *.
>>>>>
>>>>>
>>>>> I am well aware of the various kludges to address this including my
>>>>> own batchfiles ( http://batchfiles.googlecode.com ) which handles this
>>>>> by temporarily changing the path as well; however, the real problem is
>>>>> that Rtools does not play nice with Windows and that needs to be
>>>>> addressed directly.
>>>>
>>>>
>>>> It has been.  You ignored it.
>>>>
>>>> Duncan Murdoch
>>>>
>>>
>>> If some change to address this has been made that would be great but
>>> there is no mention of it on the Rtools page in the change history
>>> section (the only documented change relates to the png/tiff/jpeg
>>> libraries), there was no announcement that I saw and Rtools\bin still
>>> contains find and sort so what specifically is the change?
>>
>> It's not a change to Rtools, it's a change is to the build system in
>> R:  it allows you to rename sort or find in your own copy of Rtools,
>> and R will use whatever you specify.  You were informed of this when I
>> did it in 2007, and I've mentioned it when the topic comes up here,
>> most recently in the message quoted above.  That's a long time ago, so
>> I don't remember if you tried it then, but I've never heard a
>> complaint from anyone else that it doesn't work.
>>
>> Duncan Murdoch
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> How do you do that?  (More explicitly, what steps would I have to take
> to redefine things like find.exe and sort.exe in Rtools so that R would
> know how to find them and use them? I can't figure that out from the
> earlier parts of these messages.)
>

Rename them to whatever you want in the Rtools install, then edit the 
definitions.  I think currently they are in src/gnuwin32/Makefile and 
src/gnuwin32/MkRules (one in each), but I'd suggest you just search 
files named M* for the strings "sort" and "find", in case I've got it 
wrong, or it has changed since the last time I looked.

If you try to build R itself rather than just packages, you may need to 
do more edits, because some of the makefiles for things like the jpeg 
libraries weren't written by us, and may have these commands hard-coded.

Duncan Murdoch


From ggrothendieck at gmail.com  Sat Apr 20 20:39:28 2013
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 20 Apr 2013 14:39:28 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <5172DC98.8040308@gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com>
Message-ID: <CAP01uRkDOdxawSgsR7xgXOK=BGm5NZA-t2ys3aXqeecsRpyzAQ@mail.gmail.com>

On Sat, Apr 20, 2013 at 2:21 PM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 13-04-20 2:02 PM, Kevin Coombes wrote:
>>
>>
>> On 4/20/2013 12:54 PM, Duncan Murdoch wrote:
>>>
>>> On 13-04-20 12:30 PM, Gabor Grothendieck wrote:
>>>>
>>>> On Sat, Apr 20, 2013 at 11:49 AM, Duncan Murdoch
>>>> <murdoch.duncan at gmail.com> wrote:
>>>>>
>>>>> On 13-04-20 11:09 AM, Gabor Grothendieck wrote:
>>>>>>
>>>>>>
>>>>>> On Sat, Apr 20, 2013 at 10:45 AM, Hadley Wickham <h.wickham at gmail.com>
>>>>>> wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> Just curious:  how often do you use the Windows find command?
>>>>>>>>> We have
>>>>>>>>> put
>>>>>>>>> instructions in place for people to run the install process with a
>>>>>>>>> renamed
>>>>>>>>> Rtools find command (which I think is the only conflict). The
>>>>>>>>> issue is
>>>>>>>>> that
>>>>>>>>> more users who want to use the command line commands are
>>>>>>>>> familiar with
>>>>>>>>> the
>>>>>>>>> Unix variant (which came first, by the way) than the Windows
>>>>>>>>> one, so
>>>>>>>>> renaming the Rtools one would cause trouble for more people.
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> Its not just find - its also sort. And really R has no business
>>>>>>>> clobbering built in Windows commands. This is just wrong and really
>>>>>>>> causes anyone who does any significant amount of Windows batch
>>>>>>>> programming (or uses batch programs of any complexity) endless
>>>>>>>> problems.
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> Which is presumably why Rtools doesn't modify the path by default.
>>>>>>>
>>>>>>> Better solutions (e.g. Rstudio and devtools) temporarily set the path
>>>>>>> on when you're calling R CMD *.
>>>>>>
>>>>>>
>>>>>>
>>>>>> I am well aware of the various kludges to address this including my
>>>>>> own batchfiles ( http://batchfiles.googlecode.com ) which handles this
>>>>>> by temporarily changing the path as well; however, the real problem is
>>>>>> that Rtools does not play nice with Windows and that needs to be
>>>>>> addressed directly.
>>>>>
>>>>>
>>>>>
>>>>> It has been.  You ignored it.
>>>>>
>>>>> Duncan Murdoch
>>>>>
>>>>
>>>> If some change to address this has been made that would be great but
>>>> there is no mention of it on the Rtools page in the change history
>>>> section (the only documented change relates to the png/tiff/jpeg
>>>> libraries), there was no announcement that I saw and Rtools\bin still
>>>> contains find and sort so what specifically is the change?
>>>
>>>
>>> It's not a change to Rtools, it's a change is to the build system in
>>> R:  it allows you to rename sort or find in your own copy of Rtools,
>>> and R will use whatever you specify.  You were informed of this when I
>>> did it in 2007, and I've mentioned it when the topic comes up here,
>>> most recently in the message quoted above.  That's a long time ago, so
>>> I don't remember if you tried it then, but I've never heard a
>>> complaint from anyone else that it doesn't work.
>>>
>>> Duncan Murdoch
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>> How do you do that?  (More explicitly, what steps would I have to take
>> to redefine things like find.exe and sort.exe in Rtools so that R would
>> know how to find them and use them? I can't figure that out from the
>> earlier parts of these messages.)
>>
>
> Rename them to whatever you want in the Rtools install, then edit the
> definitions.  I think currently they are in src/gnuwin32/Makefile and
> src/gnuwin32/MkRules (one in each), but I'd suggest you just search files
> named M* for the strings "sort" and "find", in case I've got it wrong, or it
> has changed since the last time I looked.
>
> If you try to build R itself rather than just packages, you may need to do
> more edits, because some of the makefiles for things like the jpeg libraries
> weren't written by us, and may have these commands hard-coded.

Are you suggesting that R itself be rebuild?  Rtools be rebuilt?  Some
clarity on this and the process to do it would be helpful.  I was
really looking for a way to do this with an out of the box R
installation since from a practical viewpoint few are going to want to
build their own software.

--
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From hb at biostat.ucsf.edu  Sat Apr 20 20:45:35 2013
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Sat, 20 Apr 2013 11:45:35 -0700
Subject: [Rd] Publishing my Package on CRAN
In-Reply-To: <5172B75D.9060101@statistik.tu-dortmund.de>
References: <1366346292344-4664676.post@n4.nabble.com>
	<5172B75D.9060101@statistik.tu-dortmund.de>
Message-ID: <CAFDcVCRjCxzzif3X5_anA-jpZvF42Hbxae9+NgqbQp9Az59YHA@mail.gmail.com>

If you're not aware of it, you should know of:

http://cran.r-project.org/web/packages/policies.html

/Henrik

On Sat, Apr 20, 2013 at 8:42 AM, Uwe Ligges
<ligges at statistik.tu-dortmund.de> wrote:
>
>
> On 19.04.2013 06:38, liuyipei wrote:
>>
>> Hi,
>>
>> I have a simple package with two functions. It essentially implements
>> estimators and data simulation for a paper I am writing  for immunology
>> (and
>> in some sense, ecology).  How long is the typical CRAN review process
>
>
> Typically less than 12 hours.
>
>
>> -- and
>> how long will it take to get through the process?  How selective is it?
>
>
> Depends on how well the package is prepared.
>
> Best,
> Uwe Ligges
>
>
>
>
>> I have never published a package before, so I am wondering whether you
>> guys
>> think this is a reasonable thing for me to promise in the paper that the
>> package will be available on CRAN.
>>
>> Thank you for your advice in advance!
>>
>>
>>
>> --
>> View this message in context:
>> http://r.789695.n4.nabble.com/Publishing-my-Package-on-CRAN-tp4664676.html
>> Sent from the R devel mailing list archive at Nabble.com.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Sat Apr 20 22:31:14 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 20 Apr 2013 16:31:14 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CAP01uRkDOdxawSgsR7xgXOK=BGm5NZA-t2ys3aXqeecsRpyzAQ@mail.gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com>
	<CAP01uRkDOdxawSgsR7xgXOK=BGm5NZA-t2ys3aXqeecsRpyzAQ@mail.gmail.com>
Message-ID: <5172FB12.6080602@gmail.com>

On 13-04-20 2:39 PM, Gabor Grothendieck wrote:
> On Sat, Apr 20, 2013 at 2:21 PM, Duncan Murdoch
> <murdoch.duncan at gmail.com> wrote:
>> On 13-04-20 2:02 PM, Kevin Coombes wrote:
>>>
>>>
>>> On 4/20/2013 12:54 PM, Duncan Murdoch wrote:
>>>>
>>>> On 13-04-20 12:30 PM, Gabor Grothendieck wrote:
>>>>>
>>>>> On Sat, Apr 20, 2013 at 11:49 AM, Duncan Murdoch
>>>>> <murdoch.duncan at gmail.com> wrote:
>>>>>>
>>>>>> On 13-04-20 11:09 AM, Gabor Grothendieck wrote:
>>>>>>>
>>>>>>>
>>>>>>> On Sat, Apr 20, 2013 at 10:45 AM, Hadley Wickham <h.wickham at gmail.com>
>>>>>>> wrote:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> Just curious:  how often do you use the Windows find command?
>>>>>>>>>> We have
>>>>>>>>>> put
>>>>>>>>>> instructions in place for people to run the install process with a
>>>>>>>>>> renamed
>>>>>>>>>> Rtools find command (which I think is the only conflict). The
>>>>>>>>>> issue is
>>>>>>>>>> that
>>>>>>>>>> more users who want to use the command line commands are
>>>>>>>>>> familiar with
>>>>>>>>>> the
>>>>>>>>>> Unix variant (which came first, by the way) than the Windows
>>>>>>>>>> one, so
>>>>>>>>>> renaming the Rtools one would cause trouble for more people.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> Its not just find - its also sort. And really R has no business
>>>>>>>>> clobbering built in Windows commands. This is just wrong and really
>>>>>>>>> causes anyone who does any significant amount of Windows batch
>>>>>>>>> programming (or uses batch programs of any complexity) endless
>>>>>>>>> problems.
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> Which is presumably why Rtools doesn't modify the path by default.
>>>>>>>>
>>>>>>>> Better solutions (e.g. Rstudio and devtools) temporarily set the path
>>>>>>>> on when you're calling R CMD *.
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> I am well aware of the various kludges to address this including my
>>>>>>> own batchfiles ( http://batchfiles.googlecode.com ) which handles this
>>>>>>> by temporarily changing the path as well; however, the real problem is
>>>>>>> that Rtools does not play nice with Windows and that needs to be
>>>>>>> addressed directly.
>>>>>>
>>>>>>
>>>>>>
>>>>>> It has been.  You ignored it.
>>>>>>
>>>>>> Duncan Murdoch
>>>>>>
>>>>>
>>>>> If some change to address this has been made that would be great but
>>>>> there is no mention of it on the Rtools page in the change history
>>>>> section (the only documented change relates to the png/tiff/jpeg
>>>>> libraries), there was no announcement that I saw and Rtools\bin still
>>>>> contains find and sort so what specifically is the change?
>>>>
>>>>
>>>> It's not a change to Rtools, it's a change is to the build system in
>>>> R:  it allows you to rename sort or find in your own copy of Rtools,
>>>> and R will use whatever you specify.  You were informed of this when I
>>>> did it in 2007, and I've mentioned it when the topic comes up here,
>>>> most recently in the message quoted above.  That's a long time ago, so
>>>> I don't remember if you tried it then, but I've never heard a
>>>> complaint from anyone else that it doesn't work.
>>>>
>>>> Duncan Murdoch
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>> How do you do that?  (More explicitly, what steps would I have to take
>>> to redefine things like find.exe and sort.exe in Rtools so that R would
>>> know how to find them and use them? I can't figure that out from the
>>> earlier parts of these messages.)
>>>
>>
>> Rename them to whatever you want in the Rtools install, then edit the
>> definitions.  I think currently they are in src/gnuwin32/Makefile and
>> src/gnuwin32/MkRules (one in each), but I'd suggest you just search files
>> named M* for the strings "sort" and "find", in case I've got it wrong, or it
>> has changed since the last time I looked.
>>
>> If you try to build R itself rather than just packages, you may need to do
>> more edits, because some of the makefiles for things like the jpeg libraries
>> weren't written by us, and may have these commands hard-coded.
>
> Are you suggesting that R itself be rebuild?  Rtools be rebuilt?  Some
> clarity on this and the process to do it would be helpful.  I was
> really looking for a way to do this with an out of the box R
> installation since from a practical viewpoint few are going to want to
> build their own software.

No. No. Can't help you. So?

Duncan Murdoch


From kevin.r.coombes at gmail.com  Sun Apr 21 00:42:45 2013
From: kevin.r.coombes at gmail.com (Kevin Coombes)
Date: Sat, 20 Apr 2013 17:42:45 -0500
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <5172DC98.8040308@gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com>
Message-ID: <517319E5.4040800@gmail.com>


On 4/20/2013 1:21 PM, Duncan Murdoch wrote:
> On 13-04-20 2:02 PM, Kevin Coombes wrote:
>> On 4/20/2013 12:54 PM, Duncan Murdoch wrote:
>>> It's not a change to Rtools, it's a change is to the build system in
>>> R:  it allows you to rename sort or find in your own copy of Rtools,
>>> and R will use whatever you specify.  You were informed of this when I
>>> did it in 2007, and I've mentioned it when the topic comes up here,
>>> most recently in the message quoted above.  That's a long time ago, so
>>> I don't remember if you tried it then, but I've never heard a
>>> complaint from anyone else that it doesn't work.
>>>
>>> Duncan Murdoch
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>> How do you do that?  (More explicitly, what steps would I have to take
>> to redefine things like find.exe and sort.exe in Rtools so that R would
>> know how to find them and use them? I can't figure that out from the
>> earlier parts of these messages.)
>>
>
> Rename them to whatever you want in the Rtools install, then edit the 
> definitions.  I think currently they are in src/gnuwin32/Makefile and 
> src/gnuwin32/MkRules (one in each), but I'd suggest you just search 
> files named M* for the strings "sort" and "find", in case I've got it 
> wrong, or it has changed since the last time I looked.
>
> If you try to build R itself rather than just packages, you may need 
> to do more edits, because some of the makefiles for things like the 
> jpeg libraries weren't written by us, and may have these commands 
> hard-coded.
>
> Duncan Murdoch

To most Windows users, the "Rtools install"  would seem to refer to 
getting the bundled Rtools30.exe from the CRAN web site, double-clicking 
on it, selecting the options form the GUI windows that appear, and 
clicking "install".  There is no option in this procedure to change the 
names of find or sort.

As far as I can tell, the steps you are recommending take place in an 
earlier build step.  This would require the user who wants to do this to 
rebuild Rtools in its entirety, which is more trouble than it is likely 
to be worth. Especially when you can avoid the problem by using your own 
batch script or perl script to reset the path on those relatively rare 
occasions when you need to use Rtools.  Since buiilding Rtools for a 
Windows machine is something than CRAN does on a regular basis, why 
can't they just change the names there (and not bother the UNIX users, 
and probably not even bother the UNIX users who find themselves banished 
to the Windows wilderness).  Just call them "unixfind" and "unixsort" 
and everyone will be able to figure it out....


From h.wickham at gmail.com  Sun Apr 21 03:13:39 2013
From: h.wickham at gmail.com (Hadley Wickham)
Date: Sat, 20 Apr 2013 20:13:39 -0500
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <517319E5.4040800@gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com> <517319E5.4040800@gmail.com>
Message-ID: <CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>

> As far as I can tell, the steps you are recommending take place in an
> earlier build step.  This would require the user who wants to do this to
> rebuild Rtools in its entirety, which is more trouble than it is likely to
> be worth. Especially when you can avoid the problem by using your own batch
> script or perl script to reset the path on those relatively rare occasions
> when you need to use Rtools.  Since buiilding Rtools for a Windows machine
> is something than CRAN does on a regular basis, why can't they just change
> the names there (and not bother the UNIX users, and probably not even bother
> the UNIX users who find themselves banished to the Windows wilderness).
> Just call them "unixfind" and "unixsort" and everyone will be able to figure
> it out....

Because the point of Rtools is to make windows more like linux, rather
than less?

I really don't understand the complaints in this thread - I have
regularly had classes of 10-20 windows users build a package with no
prior experience, and simply downloading and installing Rtools.  In my
opinion Rtools uses the right defaults, and with a bit of extra
scripting work (painful at first, but only needs to be done once, e.g.
https://github.com/hadley/devtools/blob/master/R/rtools.r) it's
painless to use from R.

Hadley

--
Chief Scientist, RStudio
http://had.co.nz/


From ggrothendieck at gmail.com  Sun Apr 21 04:11:16 2013
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 20 Apr 2013 22:11:16 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com> <517319E5.4040800@gmail.com>
	<CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>
Message-ID: <CAP01uRkq2PXwrQfN5MAjWuE02QtQxVu8raa2uhW4rOi9BGvuzg@mail.gmail.com>

On Sat, Apr 20, 2013 at 9:13 PM, Hadley Wickham <h.wickham at gmail.com> wrote:
>> As far as I can tell, the steps you are recommending take place in an
>> earlier build step.  This would require the user who wants to do this to
>> rebuild Rtools in its entirety, which is more trouble than it is likely to
>> be worth. Especially when you can avoid the problem by using your own batch
>> script or perl script to reset the path on those relatively rare occasions
>> when you need to use Rtools.  Since buiilding Rtools for a Windows machine
>> is something than CRAN does on a regular basis, why can't they just change
>> the names there (and not bother the UNIX users, and probably not even bother
>> the UNIX users who find themselves banished to the Windows wilderness).
>> Just call them "unixfind" and "unixsort" and everyone will be able to figure
>> it out....
>
> Because the point of Rtools is to make windows more like linux, rather
> than less?
>
> I really don't understand the complaints in this thread - I have
> regularly had classes of 10-20 windows users build a package with no
> prior experience, and simply downloading and installing Rtools.  In my
> opinion Rtools uses the right defaults, and with a bit of extra
> scripting work (painful at first, but only needs to be done once, e.g.
> https://github.com/hadley/devtools/blob/master/R/rtools.r) it's
> painless to use from R.

The problem is that if you don't just use the PC for running R but use
it to run other programs too then any program and that utilizes
Windows batch scripts making use of find.exe or sort.exe likely won't
work if Rtools is on your path.

The fact that devtools, batchfiles and Rcpp have workarounds mitigates
it somewhat but the problem should be fixed so it works out-of-the-box
once and for all.

-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From spencer.graves at structuremonitoring.com  Sun Apr 21 06:09:08 2013
From: spencer.graves at structuremonitoring.com (Spencer Graves)
Date: Sat, 20 Apr 2013 21:09:08 -0700
Subject: [Rd] Publishing my Package on CRAN
In-Reply-To: <CAFDcVCRjCxzzif3X5_anA-jpZvF42Hbxae9+NgqbQp9Az59YHA@mail.gmail.com>
References: <1366346292344-4664676.post@n4.nabble.com>
	<5172B75D.9060101@statistik.tu-dortmund.de>
	<CAFDcVCRjCxzzif3X5_anA-jpZvF42Hbxae9+NgqbQp9Az59YHA@mail.gmail.com>
Message-ID: <51736664.2030009@structuremonitoring.com>

       I recommend CRAN submission.  It can make your work more 
available to others, not only by reference from your journal article but 
also the reverse:  Giving other R users access to your journal article.  
Often, I look for publications with software, because the open source 
software makes it easy to understand the algorithm.


       Have you used "sos" and other search tools to check for similar 
capabilities in other CRAN packages?  If yes, and if you see another 
package that seems quite similar but slightly different, I might write 
to the maintainer(s) asking if they would like me to contribute my work 
to their package.  I've gotten both acceptance and rejection doing that.


       I can't speak for the CRAN maintainers, but unless policies have 
changed and I've missed it, CRAN accepts all contributions provided they 
use a standard license like GPL and pass standard tests including "R CMD 
check".  Details for how to do this are in the link Henrik provided.


       Hope this helps.
       Spencer Graves


On 4/20/2013 11:45 AM, Henrik Bengtsson wrote:
> If you're not aware of it, you should know of:
>
> http://cran.r-project.org/web/packages/policies.html
>
> /Henrik
>
> On Sat, Apr 20, 2013 at 8:42 AM, Uwe Ligges
> <ligges at statistik.tu-dortmund.de> wrote:
>>
>> On 19.04.2013 06:38, liuyipei wrote:
>>> Hi,
>>>
>>> I have a simple package with two functions. It essentially implements
>>> estimators and data simulation for a paper I am writing  for immunology
>>> (and
>>> in some sense, ecology).  How long is the typical CRAN review process
>>
>> Typically less than 12 hours.
>>
>>
>>> -- and
>>> how long will it take to get through the process?  How selective is it?
>>
>> Depends on how well the package is prepared.
>>
>> Best,
>> Uwe Ligges
>>
>>
>>
>>
>>> I have never published a package before, so I am wondering whether you
>>> guys
>>> think this is a reasonable thing for me to promise in the paper that the
>>> package will be available on CRAN.
>>>
>>> Thank you for your advice in advance!
>>>
>>>
>>>
>>> --
>>> View this message in context:
>>> http://r.789695.n4.nabble.com/Publishing-my-Package-on-CRAN-tp4664676.html
>>> Sent from the R devel mailing list archive at Nabble.com.
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel


From kevin.hendricks at sympatico.ca  Sun Apr 21 08:15:13 2013
From: kevin.hendricks at sympatico.ca (Kevin Hendricks)
Date: Sun, 21 Apr 2013 02:15:13 -0400
Subject: [Rd] Withdrawal of package Rigroup-0.84.0 from CRAN
Message-ID: <BLU0-SMTP2827B84405BEE16FCC24C987CA0@phx.gbl>

Hi Brian and Uwe,

Given my package passes all checks but I have received no further responses since your initial reply, I assume you are no longer interested in the package Rigroup-0.84.0.  Your concerns about my chosen license being too vague "GPL | LGPL" is in direct contradiction to what your own documents say about not changing your license after a package has been accepted at CRAN.  This is the same license this package has had since it was first accepted in 2006 ("GPL or LGPL your choice").  Your additional requirement was that I explain why I did not reply to your January e-mail thereby forcing you to do "extra work to archive the package" was already met on this very list. As I explained back in March, I never received it (and no Uwe that does not mean I am claiming you never sent it - just that I did not receive it!).  Not quite the "thank you for contributing to R" I hoped for, but after 7 years or so, it is unfortunately what I expected... 

Therefore this is to let you know that I am hereby withdrawing my package Rigroup-0.84.0 from CRAN consideration.  You can obviously keep using the previous (now-archived) version under its license.  But since I will no longer be supporting the package and as its author I ask you to remove all versions from CRAN.  This is of course your choice given the original license Rigroup was released under. If anyone's package depends on Rigroup, please feel free to absorb it into your own packages in any way you want under any GPL *,  BSD, LGPL * licenses.

One thing the developers of R might want to consider is to add the very basic optimization that Rigroup uses to base R so that it can better handle very very large datasets (ala BigData) more effieciently.  That is assuming there is not some other package that does this that I am unaware of or that a similar capability hasn't already been added to R-3.X since 2006.

The primary idea is simple and time worn ...  

Given a large unsorted vector of data whose elements have been assigned to n groups and whose group membership is represented by a second vector of equal length whoses values are members of {1,...,n}, you can easily calculate multiple group statistics for all n groups in just one pass through the unsorted data vector by using the group membership as an index into  one or multiple vectors of statistics such as count, sum, max, min, all, any, average, second moment, variance standard deviation, higher moments, etc ....  Since this is meant for very large vectors, it was implemented in C for speed.

For very very large unsorted data vectors, this one pass approach of using the group membership as an offset into potentially multiple "statistics vectors" is much much faster than trying to sort, or index, or subset the large unsorted data vector using the typical approaches of R and then calculating the stats and will work even if the group membership indicators do not span the set.  This is all that Rigroup did.  Pretty much just common sense to any old programmer who wanted to build portfolios and calculate basic portfolio stats but who has to deal with large amounts of data.    Perhaps sometime over the last 7 years, you have already added something similar, if so, please ignore this.

Given my withdrawl of this package I will also be removing myself from the R-devel mailing list so if you want to contact me for any reason please CC me directly (hopefully the sympatico.ca spam filter will not lose too many of you)!  It was an interesting 7 years.   Good luck to you all.

Take care,

Kevin


From tag at biostat.ku.dk  Sun Apr 21 08:18:29 2013
From: tag at biostat.ku.dk (Thomas Alexander Gerds)
Date: Sun, 21 Apr 2013 08:18:29 +0200
Subject: [Rd] how to control the environment of a formula
In-Reply-To: <5172D403.9010307@gmail.com> (Duncan Murdoch's message of "Sat,
	20 Apr 2013 13:44:35 -0400")
References: <86bo9ce87b.fsf@biostat.ku.dk> <516FE87F.90906@gmail.com>
	<86obdbetlz.fsf@biostat.ku.dk> <51714ED0.3010307@gmail.com>
	<86wqry5ox9.fsf@biostat.ku.dk> <5172D403.9010307@gmail.com>
Message-ID: <868v4cs8y2.fsf@biostat.ku.dk>


thanks. yes, I was considering to use as.character(f) but your solution
2 is much better -- did not know ' was a R function as well. just
checked: model.frame does not get confused and this will be used to
evaluate formula by all functions in my packages.

however, there could be related problems with memory. I noticed that
some of my processes use unexpectedly much memory. how can one trace
this?

I am not desperate to save diskspace: the problem is that file transfer
and sharing (like dropbox) suffer when each simulation results fills 8M
instead of 130K just because a large data set is invisibly sitting in
the saved file.

Duncan Murdoch <murdoch.duncan at gmail.com> writes:

> On 13-04-19 2:57 PM, Thomas Alexander Gerds wrote:
>> hmm. I have tested a bit more, and found this perhaps more difficult
>> solve situation. even though I delete x, since x is part of the
>> output of the formula, the size of the object is twice as much as it
>> should be:
>> test <- function(x){ x <- rnorm(1000000) out <- list(x=x) rm(x)
>> out$f <- as.formula(a~b) out } v <- test(1) x <- rnorm(1000000)
>> save(v,file="~/tmp/v.rda") save(x,file="~/tmp/x.rda") system("ls
>> -lah ~/tmp/*.rda")
>> -rw-rw-r-- 1 tag tag 15M Apr 19 20:52 /home/tag/tmp/v.rda -rw-rw-r--
>> 1 tag tag 7,4M Apr 19 20:52 /home/tag/tmp/x.rda
>> can you solve this as well?
>
> Yes, this is tricky.  The problem is that "out" is in the environment
> of out$f, so you get two copies when you save it.  (I think you won't
> have two copies in memory, because R only makes a copy when it needs
> to, but I haven't traced this.)
>
> Here are two solutions, both have some problems.
>
> 1.  Don't put out in the environment:
>
> test <- function(x) { x <- rnorm(1000000) out$x <- list(x=x) out$f <-
> a ~ b # the as.formula() was never needed # temporarily create a new
> environment local({ # get a copy of what you want to keep out <- out #
> remove everything that you don't need from the formula rm(list=c("x",
> "out"), envir=environment(out$f)) # return the local copy out }) }
>
> I don't like this because it is too tricky, but you could probably
> wrap the tricky bits into a little function (a variant on return()
> that cleans out the environment first), so it's probably what I would
> use if I was desperate to save space in saved copies.
>
> 2. Never evaluate the formula in the first place, so it doesn't pick
> up the environment:
>
> test <- function(x) { x <- rnorm(1000000) out$x <- list(x=x) out$f <-
> quote(a ~ b) out }
>
> This is a lot simpler, but it might not work with some modelling
> functions, which would be confused by receiving the model formula
> unevaluated.  It also has the problems that you get with using
> .GlobalEnv as the environment of the formula, but maybe to a slightly
> lesser extent: rather than having what is possibly the wrong
> environment, it doesn't have one at all.
>
> Duncan Murdoch
>
>> thanks!  thomas
>> Duncan Murdoch <murdoch.duncan at gmail.com> writes:
>>
>>> On 13-04-18 11:39 AM, Thomas Alexander Gerds wrote:
>>>> Dear Duncan thank you for taking the time to answer my questions!
>>>> It will be quite some work to delete all the objects generated
>>>> inside the function ... but if there is no other way to avoid a
>>>> large environment then this is what I will do.
>>> It's not really that hard.  Use names <- ls() in the function to
>>> get a list of all of them; remove the names of variables that might
>>> be needed in the formula (and the name of the formula itself); then
>>> use rm(list=names) to delete everything else just before returning
>>> it.
>>> Duncan Murdoch
>>>

-- 
Thomas A. Gerds -- Assoc. Prof. Department of Biostatistics Copenhagen
University of Copenhagen, Oester Farimagsgade 5, 1014 Copenhagen, Denmark


From h.wickham at gmail.com  Sun Apr 21 14:18:13 2013
From: h.wickham at gmail.com (Hadley Wickham)
Date: Sun, 21 Apr 2013 07:18:13 -0500
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CAP01uRkq2PXwrQfN5MAjWuE02QtQxVu8raa2uhW4rOi9BGvuzg@mail.gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com> <517319E5.4040800@gmail.com>
	<CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>
	<CAP01uRkq2PXwrQfN5MAjWuE02QtQxVu8raa2uhW4rOi9BGvuzg@mail.gmail.com>
Message-ID: <CABdHhvFsiuTmnW8So3TdoKcDVsqtM0sO18NivEjr3JfSG9Bcfg@mail.gmail.com>

> The problem is that if you don't just use the PC for running R but use
> it to run other programs too then any program and that utilizes
> Windows batch scripts making use of find.exe or sort.exe likely won't
> work if Rtools is on your path.
>
> The fact that devtools, batchfiles and Rcpp have workarounds mitigates
> it somewhat but the problem should be fixed so it works out-of-the-box
> once and for all.

I guess I don't see the advantage of that approach (except perhaps for
simplicity), compared to using the registry to store path information
and then using environmental variables to set it when needed. It would
be nice if Rtools didn't override existing windows executables, in the
same way it would be nice if windows worked like linux out of the box.
But since it doesn't, and since in general adding more and more
directories to the path makes it more and more likely for some
conflict to arise, I think Rtools current approach is very reasonable.

Hadley

--
Chief Scientist, RStudio
http://had.co.nz/


From ggrothendieck at gmail.com  Sun Apr 21 15:41:40 2013
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 21 Apr 2013 09:41:40 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CABdHhvFsiuTmnW8So3TdoKcDVsqtM0sO18NivEjr3JfSG9Bcfg@mail.gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com> <517319E5.4040800@gmail.com>
	<CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>
	<CAP01uRkq2PXwrQfN5MAjWuE02QtQxVu8raa2uhW4rOi9BGvuzg@mail.gmail.com>
	<CABdHhvFsiuTmnW8So3TdoKcDVsqtM0sO18NivEjr3JfSG9Bcfg@mail.gmail.com>
Message-ID: <CAP01uRnP1CJSbtYJHEB3X8GY5CfcbfCgZ=R78SwEuAesYOYMUQ@mail.gmail.com>

On Sun, Apr 21, 2013 at 8:18 AM, Hadley Wickham <h.wickham at gmail.com> wrote:
>> The problem is that if you don't just use the PC for running R but use
>> it to run other programs too then any program and that utilizes
>> Windows batch scripts making use of find.exe or sort.exe likely won't
>> work if Rtools is on your path.
>>
>> The fact that devtools, batchfiles and Rcpp have workarounds mitigates
>> it somewhat but the problem should be fixed so it works out-of-the-box
>> once and for all.
>
> I guess I don't see the advantage of that approach (except perhaps for
> simplicity), compared to using the registry to store path information
> and then using environmental variables to set it when needed. It would
> be nice if Rtools didn't override existing windows executables, in the
> same way it would be nice if windows worked like linux out of the box.
> But since it doesn't, and since in general adding more and more
> directories to the path makes it more and more likely for some
> conflict to arise, I think Rtools current approach is very reasonable.

Because it can conflict with other Windows software unless you add a
layer over it.  What other popular software that runs on Windows has
these problems?  I can't think of any.  The closest I can come up with
was that for a short time after git was ported to Windows it would
change the font of the Windows console but there was an immediate hue
and cry about it having no business messing with the rest of Windows
and it was quickly rectified.

Accepting these infelicities just gets one onto a slippery slope.  For
example, as far as I know devtools and Rcpp don't have any current
problems but that could easily change in the future since they keep
databases of Rtools configurations which must be manually updated by
their developers as Rtools evolves -- if Rtools changes they could
stop working for periods of time until new versions are produced.
R.bat in batchfiles was just re-written this year so it is a bit more
robust to such changes but even it would have to be modified if the
changes in Rtools were of sufficient magnitude.  I don't blame these
tools for this but surely this is a symptom that something is
fundamentally wrong with the entire approach since the tight coupling
of what should be independent modules results in the need for ongoing
maintenance.

Some good work was done to rid R and Rtools of dependence on perl but
this effort should not stop there and needs to continue in order to
reduce and eliminate the dependence on third party tools that cause
problems.

(By the way, regarding registry values and environment variables,
R.bat in batchfiles will look at the registry and at environment
variables but it will work even if no registry values or environment
variables have been set by the user provided one uses standard
locations for R and Rtools.  That is, in fact, how I run my own
configuration on Windows.)

-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From h.wickham at gmail.com  Sun Apr 21 15:49:28 2013
From: h.wickham at gmail.com (Hadley Wickham)
Date: Sun, 21 Apr 2013 08:49:28 -0500
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CAP01uRnP1CJSbtYJHEB3X8GY5CfcbfCgZ=R78SwEuAesYOYMUQ@mail.gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com> <517319E5.4040800@gmail.com>
	<CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>
	<CAP01uRkq2PXwrQfN5MAjWuE02QtQxVu8raa2uhW4rOi9BGvuzg@mail.gmail.com>
	<CABdHhvFsiuTmnW8So3TdoKcDVsqtM0sO18NivEjr3JfSG9Bcfg@mail.gmail.com>
	<CAP01uRnP1CJSbtYJHEB3X8GY5CfcbfCgZ=R78SwEuAesYOYMUQ@mail.gmail.com>
Message-ID: <CABdHhvGQYGa2uJSMFYvL=Ckm=cD27ZAGDQqXPMuhuFr3dRsmUg@mail.gmail.com>

> Because it can conflict with other Windows software unless you add a
> layer over it.  What other popular software that runs on Windows has
> these problems?  I can't think of any.  The closest I can come up with
> was that for a short time after git was ported to Windows it would
> change the font of the Windows console but there was an immediate hue
> and cry about it having no business messing with the rest of Windows
> and it was quickly rectified.

I don't understand: unless you modify settings in the default install,
Rtools *does not* affect other windows software in any way.

Hadley

--
Chief Scientist, RStudio
http://had.co.nz/


From ggrothendieck at gmail.com  Sun Apr 21 17:31:54 2013
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 21 Apr 2013 11:31:54 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CABdHhvGQYGa2uJSMFYvL=Ckm=cD27ZAGDQqXPMuhuFr3dRsmUg@mail.gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com> <517319E5.4040800@gmail.com>
	<CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>
	<CAP01uRkq2PXwrQfN5MAjWuE02QtQxVu8raa2uhW4rOi9BGvuzg@mail.gmail.com>
	<CABdHhvFsiuTmnW8So3TdoKcDVsqtM0sO18NivEjr3JfSG9Bcfg@mail.gmail.com>
	<CAP01uRnP1CJSbtYJHEB3X8GY5CfcbfCgZ=R78SwEuAesYOYMUQ@mail.gmail.com>
	<CABdHhvGQYGa2uJSMFYvL=Ckm=cD27ZAGDQqXPMuhuFr3dRsmUg@mail.gmail.com>
Message-ID: <CAP01uRmfY1dqk_-8Cq0GodNuFGCGMGcUU6BhBwrNB7hH6bwHeA@mail.gmail.com>

On Sun, Apr 21, 2013 at 9:49 AM, Hadley Wickham <h.wickham at gmail.com> wrote:
>> Because it can conflict with other Windows software unless you add a
>> layer over it.  What other popular software that runs on Windows has
>> these problems?  I can't think of any.  The closest I can come up with
>> was that for a short time after git was ported to Windows it would
>> change the font of the Windows console but there was an immediate hue
>> and cry about it having no business messing with the rest of Windows
>> and it was quickly rectified.
>
> I don't understand: unless you modify settings in the default install,
> Rtools *does not* affect other windows software in any way.
>

If its the case that it now works from the cmd line without setting
the Rtools path before issuing R CMD ... that would be great. If so it
must have occurred silently at some point since I have spent hours in
past years trying to track down why another program I was using did
not work only to discover that it was Rtools.  Surely this was also
your own understanding since devtools, maintains an Rtools path
database which ought to be unnecessary if R is able to find Rtools
itself.

-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From h.wickham at gmail.com  Sun Apr 21 18:57:40 2013
From: h.wickham at gmail.com (Hadley Wickham)
Date: Sun, 21 Apr 2013 11:57:40 -0500
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CAP01uRmfY1dqk_-8Cq0GodNuFGCGMGcUU6BhBwrNB7hH6bwHeA@mail.gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com> <517319E5.4040800@gmail.com>
	<CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>
	<CAP01uRkq2PXwrQfN5MAjWuE02QtQxVu8raa2uhW4rOi9BGvuzg@mail.gmail.com>
	<CABdHhvFsiuTmnW8So3TdoKcDVsqtM0sO18NivEjr3JfSG9Bcfg@mail.gmail.com>
	<CAP01uRnP1CJSbtYJHEB3X8GY5CfcbfCgZ=R78SwEuAesYOYMUQ@mail.gmail.com>
	<CABdHhvGQYGa2uJSMFYvL=Ckm=cD27ZAGDQqXPMuhuFr3dRsmUg@mail.gmail.com>
	<CAP01uRmfY1dqk_-8Cq0GodNuFGCGMGcUU6BhBwrNB7hH6bwHeA@mail.gmail.com>
Message-ID: <CABdHhvHfW6r3fjJeuGUjyRNq0VOBr2YFDiHnu_jmqu6NE7F_WA@mail.gmail.com>

>>> Because it can conflict with other Windows software unless you add a
>>> layer over it.  What other popular software that runs on Windows has
>>> these problems?  I can't think of any.  The closest I can come up with
>>> was that for a short time after git was ported to Windows it would
>>> change the font of the Windows console but there was an immediate hue
>>> and cry about it having no business messing with the rest of Windows
>>> and it was quickly rectified.
>>
>> I don't understand: unless you modify settings in the default install,
>> Rtools *does not* affect other windows software in any way.
>
> If its the case that it now works from the cmd line without setting
> the Rtools path before issuing R CMD ... that would be great. If so it
> must have occurred silently at some point since I have spent hours in
> past years trying to track down why another program I was using did
> not work only to discover that it was Rtools.  Surely this was also
> your own understanding since devtools, maintains an Rtools path
> database which ought to be unnecessary if R is able to find Rtools
> itself.

I think we are having a failure of communication: Rtools does not set
the path, so that you must do so, every time you use it. There is no
other way to prevent it from interfering from some other windows
software, except by tightly confining the scope in which it enters the
path. When I first starting working with Rtools, I thought this was a
terribly frustrating decision - why didn't the default installer
always put rtools on the path? But now I see it's the only way - it
avoids conflicts with other software, and without that default there'd
be no way to have multiple versions of rtools installed. That said, I
think the logic that Rstudio and devtools uses to find rtools would
have been helpful to include in base R, but that's not so important
now that it's available in a package. (And if any big change was made,
I'd probably argue it'd be better just to always bundle rtools with R
on windows - I think it's a key part of the philosophy of R that users
can easily become developers. But there are obviously other
considerations.)

To clarify, the rtools database in devtools does not contain a list of
locations of rtools, but the directories inside of an rtools
installation that need to be available on the path. This list has
changed over time as the tools needed by R have changed. I don't see
any way of avoiding that (except perhaps by storing those in the
registry, but regardless there's no way to go back in time and fix old
decisions). Devtools (following the logic of rstudio) looks in a
number of places to find rtools, first looking in the path and then in
the registry, and takes considerable care to ensure that the versions
of R and rtools match (another reason why the database is necessary).

Hadley

--
Chief Scientist, RStudio
http://had.co.nz/


From friendly at yorku.ca  Sun Apr 21 19:28:48 2013
From: friendly at yorku.ca (Michael Friendly)
Date: Sun, 21 Apr 2013 13:28:48 -0400
Subject: [Rd] vignettes: problems with PDF compaction
Message-ID: <517421D0.2@yorku.ca>

[Env: OS: Win Xp; R 2.15.2; IDE: eclipse/StatET]

Each time I update my heplots package, I get warnings from R CMD check
on R-Forge,

* checking sizes of PDF files under ?inst/doc? ... WARNING
   ?gs+qpdf? made some significant size reductions:
      compacted ?HE-examples.pdf? from 739Kb to 366Kb

and upon submission to CRAN, a message from maintainers:

On CRAN now: but again there were warnings about significant size
reductions in PDF compaction, which should really be fixed on your end.

however, I am unable to find what to do to fix this on my end. In my 
package directory,
I have the vignette sources all under vignettes/, with copies of the 
.pdf and .Rnw
under inst/doc for historical reasons. [Q: can I now safely delete the 
copies under
inst/doc ?]

inst/doc/
HE-examples.pdf
HE-examples.Rnw
vignettes/
HE-examples.pdf
HE-examples.Rnw
HE-examples.bib
fig/
...

I have qpdf installed:
 > Sys.which(Sys.getenv("R_QPDF", "qpdf"))
qpdf
"c:\\Rtools\\bin\\qpdf.exe"
 >

but, if I try to run it on the vignettes/HE-examples.pdf file, nothing 
happens:

 > 
tools::compactPDF("C:/Documents/workspace/heplots/vignettes/HE-examples.pdf")
 >

Since vignettes are re-built from sources and then installed into 
inst/doc, I don't see why
PDF compaction cannot be run as part of the build process. That is, if
R CMD check --as-cran detects a problem, shouldn't there be some option for
R CMD build that would run gs+qpdf to correct it?

The idea of vignettes for R packages is a good thing, but, this problem 
(and others with vignettes) discourages me from using vignettes in 
packages, a bad thing.

-- 
Michael Friendly     Email: friendly AT yorku DOT ca
Professor, Psychology Dept. & Chair, Quantitative Methods
York University      Voice: 416 736-2100 x66249 Fax: 416 736-5814
4700 Keele Street    Web:   http://www.datavis.ca
Toronto, ONT  M3J 1P3 CANADA


From ligges at statistik.tu-dortmund.de  Sun Apr 21 19:47:51 2013
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sun, 21 Apr 2013 19:47:51 +0200
Subject: [Rd] vignettes: problems with PDF compaction
In-Reply-To: <517421D0.2@yorku.ca>
References: <517421D0.2@yorku.ca>
Message-ID: <51742647.3050407@statistik.tu-dortmund.de>



On 21.04.2013 19:28, Michael Friendly wrote:
> [Env: OS: Win Xp; R 2.15.2; IDE: eclipse/StatET]
>
> Each time I update my heplots package, I get warnings from R CMD check
> on R-Forge,
>
> * checking sizes of PDF files under ?inst/doc? ... WARNING
>    ?gs+qpdf? made some significant size reductions:
>       compacted ?HE-examples.pdf? from 739Kb to 366Kb
>
> and upon submission to CRAN, a message from maintainers:
>
> On CRAN now: but again there were warnings about significant size
> reductions in PDF compaction, which should really be fixed on your end.
>
> however, I am unable to find what to do to fix this on my end. In my
> package directory,
> I have the vignette sources all under vignettes/, with copies of the
> .pdf and .Rnw
> under inst/doc for historical reasons. [Q: can I now safely delete the
> copies under
> inst/doc ?]
>
> inst/doc/
> HE-examples.pdf
> HE-examples.Rnw
> vignettes/
> HE-examples.pdf
> HE-examples.Rnw
> HE-examples.bib
> fig/
> ...
>
> I have qpdf installed:
>  > Sys.which(Sys.getenv("R_QPDF", "qpdf"))
> qpdf
> "c:\\Rtools\\bin\\qpdf.exe"
>  >
>
> but, if I try to run it on the vignettes/HE-examples.pdf file, nothing
> happens:
>
>  >
> tools::compactPDF("C:/Documents/workspace/heplots/vignettes/HE-examples.pdf")
>
>  >
>
> Since vignettes are re-built from sources and then installed into
> inst/doc, I don't see why
> PDF compaction cannot be run as part of the build process. That is, if
> R CMD check --as-cran detects a problem, shouldn't there be some option for
> R CMD build that would run gs+qpdf to correct it?

Yes, see

R CMD build --help


that tells you

   --compact-vignettes=  try to compact PDF files under inst/doc:
                         "no" (default), "qpdf", "gs", "gs+qpdf", "both"


Best,
Uwe Ligges


>
> The idea of vignettes for R packages is a good thing, but, this problem
> (and others with vignettes) discourages me from using vignettes in
> packages, a bad thing.
>


From nashjc at uottawa.ca  Sun Apr 21 19:48:38 2013
From: nashjc at uottawa.ca (Prof J C Nash (U30A))
Date: Sun, 21 Apr 2013 13:48:38 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <mailman.23.1366538407.11707.r-devel@r-project.org>
References: <mailman.23.1366538407.11707.r-devel@r-project.org>
Message-ID: <51742676.7060004@uottawa.ca>


While as a Linux user who has not so far been banished to Winland I have 
not experienced this problem, it seems to be the type of issue where a 
"how to", for example, on the R Wiki, would be helpful. Moreover, surely 
this is a name conflict on different platforms, so possibly a list of 
these in a related location would also be useful. I have been struggling 
unsuccessfully to remember one that bit me recently when I did have to 
help a Windows user. It was not a major disaster, but more of a large 
sucking sound of time being wasted figuring out something that was just 
a shade more than trivial.

If there are folk who can get this started, do include me in an off-list 
copy and I'll be willing to test/edit wiki material.

JN


From ggrothendieck at gmail.com  Sun Apr 21 20:01:30 2013
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 21 Apr 2013 14:01:30 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <51742676.7060004@uottawa.ca>
References: <mailman.23.1366538407.11707.r-devel@r-project.org>
	<51742676.7060004@uottawa.ca>
Message-ID: <CAP01uRk_q8UTQdJrPuHv1+2tTaYVFeYc_u8ndY_nhj-N7_7AqQ@mail.gmail.com>

On Sun, Apr 21, 2013 at 1:48 PM, Prof J C Nash (U30A) <nashjc at uottawa.ca> wrote:
>
> While as a Linux user who has not so far been banished to Winland I have not
> experienced this problem, it seems to be the type of issue where a "how to",
> for example, on the R Wiki, would be helpful. Moreover, surely this is a
> name conflict on different platforms, so possibly a list of these in a
> related location would also be useful. I have been struggling unsuccessfully
> to remember one that bit me recently when I did have to help a Windows user.
> It was not a major disaster, but more of a large sucking sound of time being
> wasted figuring out something that was just a shade more than trivial.
>
> If there are folk who can get this started, do include me in an off-list
> copy and I'll be willing to test/edit wiki material.

The bottom line is that the conflicting executables are find and sort.
 Its best to not put Rtools on your path and its probably simplest
just to use R.bat or Rpathset.bat from my batchfiles
(http://batchfiles.googlecode.com) if you are doing it from the cmd
line or Hadley's devtools (install.packages("devtools")) if you are
working from within R.  Also Rcpp has a workaround built into it as
well which would be applicable when using C++ in conjunction with that
package.

Although this is annoying and can lead to extremely hard to detect
errors if you don't know about it the R Windows environment is
actually quite nice. otherwise  You get a GUI and most of the packages
come as binaries so you don't have to build anything to use packages
off CRAN in almost all cases.

--
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From ggrothendieck at gmail.com  Sun Apr 21 20:02:11 2013
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 21 Apr 2013 14:02:11 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CABdHhvHfW6r3fjJeuGUjyRNq0VOBr2YFDiHnu_jmqu6NE7F_WA@mail.gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com> <517319E5.4040800@gmail.com>
	<CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>
	<CAP01uRkq2PXwrQfN5MAjWuE02QtQxVu8raa2uhW4rOi9BGvuzg@mail.gmail.com>
	<CABdHhvFsiuTmnW8So3TdoKcDVsqtM0sO18NivEjr3JfSG9Bcfg@mail.gmail.com>
	<CAP01uRnP1CJSbtYJHEB3X8GY5CfcbfCgZ=R78SwEuAesYOYMUQ@mail.gmail.com>
	<CABdHhvGQYGa2uJSMFYvL=Ckm=cD27ZAGDQqXPMuhuFr3dRsmUg@mail.gmail.com>
	<CAP01uRmfY1dqk_-8Cq0GodNuFGCGMGcUU6BhBwrNB7hH6bwHeA@mail.gmail.com>
	<CABdHhvHfW6r3fjJeuGUjyRNq0VOBr2YFDiHnu_jmqu6NE7F_WA@mail.gmail.com>
Message-ID: <CAP01uRnLdB6MA=pbW8C6TJCXFGeSso=HssGNq=GtGKcB7BiK9Q@mail.gmail.com>

On Sun, Apr 21, 2013 at 12:57 PM, Hadley Wickham <h.wickham at gmail.com> wrote:
>>>> Because it can conflict with other Windows software unless you add a
>>>> layer over it.  What other popular software that runs on Windows has
>>>> these problems?  I can't think of any.  The closest I can come up with
>>>> was that for a short time after git was ported to Windows it would
>>>> change the font of the Windows console but there was an immediate hue
>>>> and cry about it having no business messing with the rest of Windows
>>>> and it was quickly rectified.
>>>
>>> I don't understand: unless you modify settings in the default install,
>>> Rtools *does not* affect other windows software in any way.
>>
>> If its the case that it now works from the cmd line without setting
>> the Rtools path before issuing R CMD ... that would be great. If so it
>> must have occurred silently at some point since I have spent hours in
>> past years trying to track down why another program I was using did
>> not work only to discover that it was Rtools.  Surely this was also
>> your own understanding since devtools, maintains an Rtools path
>> database which ought to be unnecessary if R is able to find Rtools
>> itself.
>
> I think we are having a failure of communication: Rtools does not set
> the path, so that you must do so, every time you use it. There is no
> other way to prevent it from interfering from some other windows
> software, except by tightly confining the scope in which it enters the
> path. When I first starting working with Rtools, I thought this was a
> terribly frustrating decision - why didn't the default installer
> always put rtools on the path? But now I see it's the only way - it
> avoids conflicts with other software, and without that default there'd
> be no way to have multiple versions of rtools installed. That said, I
> think the logic that Rstudio and devtools uses to find rtools would
> have been helpful to include in base R, but that's not so important
> now that it's available in a package. (And if any big change was made,
> I'd probably argue it'd be better just to always bundle rtools with R
> on windows - I think it's a key part of the philosophy of R that users
> can easily become developers. But there are obviously other
> considerations.)
>
> To clarify, the rtools database in devtools does not contain a list of
> locations of rtools, but the directories inside of an rtools
> installation that need to be available on the path. This list has
> changed over time as the tools needed by R have changed. I don't see
> any way of avoiding that (except perhaps by storing those in the
> registry, but regardless there's no way to go back in time and fix old
> decisions). Devtools (following the logic of rstudio) looks in a
> number of places to find rtools, first looking in the path and then in
> the registry, and takes considerable care to ensure that the versions
> of R and rtools match (another reason why the database is necessary).

Yes, that is what I thought until you seemed to be saying otherwise
but it seems we just misunderstood each  other and, in fact,  no one
disputes the need to put Rtools on the path nor that it conflicts with
other Windows programs and potentially causes other programs on your
PC not to work.  In fact that was one of the motivations I had for
developing the batchfiles as I once spent hours tracking down a
problem due to Rtools.

Also I understand that the devtools database uses relative paths and
wasn't faulting devtools for this but only pointing out that the
database's existence was a consequence of the need to set up the paths
in the first place which is what we were discussing - not devtools.


From friendly at yorku.ca  Sun Apr 21 20:42:25 2013
From: friendly at yorku.ca (Michael Friendly)
Date: Sun, 21 Apr 2013 14:42:25 -0400
Subject: [Rd] vignettes: problems with PDF compaction
In-Reply-To: <51742647.3050407@statistik.tu-dortmund.de>
References: <517421D0.2@yorku.ca> <51742647.3050407@statistik.tu-dortmund.de>
Message-ID: <51743311.6070002@yorku.ca>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130421/618d407f/attachment.pl>

From hb at biostat.ucsf.edu  Mon Apr 22 00:17:45 2013
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Sun, 21 Apr 2013 15:17:45 -0700
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CAP01uRnLdB6MA=pbW8C6TJCXFGeSso=HssGNq=GtGKcB7BiK9Q@mail.gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com> <517319E5.4040800@gmail.com>
	<CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>
	<CAP01uRkq2PXwrQfN5MAjWuE02QtQxVu8raa2uhW4rOi9BGvuzg@mail.gmail.com>
	<CABdHhvFsiuTmnW8So3TdoKcDVsqtM0sO18NivEjr3JfSG9Bcfg@mail.gmail.com>
	<CAP01uRnP1CJSbtYJHEB3X8GY5CfcbfCgZ=R78SwEuAesYOYMUQ@mail.gmail.com>
	<CABdHhvGQYGa2uJSMFYvL=Ckm=cD27ZAGDQqXPMuhuFr3dRsmUg@mail.gmail.com>
	<CAP01uRmfY1dqk_-8Cq0GodNuFGCGMGcUU6BhBwrNB7hH6bwHeA@mail.gmail.com>
	<CABdHhvHfW6r3fjJeuGUjyRNq0VOBr2YFDiHnu_jmqu6NE7F_WA@mail.gmail.com>
	<CAP01uRnLdB6MA=pbW8C6TJCXFGeSso=HssGNq=GtGKcB7BiK9Q@mail.gmail.com>
Message-ID: <CAFDcVCRjpWU=PRAC7BBscAiBm1PFb9tK4BWn3NQjrP6PGo=Nhw@mail.gmail.com>

I (as well) keep a specific Rsetup.bat file for launching Windows
cmd.exe with the proper PATH etc setup for build R packages etc.  It's
only after this thread I gave it a second thought; you can indeed
temporarily set the PATH via ~/.Rprofile or ~/.Renviron, which *are*
processed at the very beginning when calling 'R CMD ...'.

EXAMPLE WITH .Rprofile:

## ~/.Rprofile (e.g. C:/User/foo/.Rprofile):
path <- unlist(strsplit(Sys.getenv("PATH"), ";"));
path <- c("C:\\Rtools\\bin", "C:\\Rtools\\gcc-4.6.3\\bin", path);
Sys.setenv("PATH"=paste(unique(path), collapse=";"));

## DISABLED:
x:\> R --no-init-file CMD INSTALL matrixStats_0.6.2.tar.gz
* installing to library 'C:/Users/hb/R/win-library/3.0'
* installing *source* package 'matrixStats' ...
** libs
*** arch - i386
ERROR: compilation failed for package 'matrixStats'
* removing 'C:/Users/hb/R/win-library/3.0/matrixStats'

## ENABLED:
x:\> R CMD INSTALL matrixStats_0.6.2.tar.gz
* installing to library 'C:/Users/hb/R/win-library/3.0'
* installing *source* package 'matrixStats' ...
** libs
*** arch - i386
gcc -m32 -I"C:/PROGRA~1/R/R-3.0.0patched/include" -DNDEBUG [...]
[...]
* DONE (matrixStats)


EXAMPLE WITH .Renviron:
## ~/.Renviron (e.g. C:/User/foo/.Renviron):
# Backslashes are preserved iff put within quotes
PATH="C:\Rtools\bin;C:\Rtools\gcc-4.6.3\bin;${PATH}"

x:\> R --no-environ CMD INSTALL matrixStats_0.6.2.tar.gz
=> fails

x:\> R CMD INSTALL matrixStats_0.6.2.tar.gz
=> works

As long as R is on the PATH, the above either of the approaches
removes the need to add Rtools to the PATH via a BAT file and it won't
clutter up your PATH.  This begs the question (as somewhat already
proposed), instead of users/developers doing this manually, would it
be possible to have 'R CMD ...' to locate add Rtools to the PATH
internally.  That would certainly lower the barriers for newcomers to
install packages from source that need compilation.  Obviously, this
doesn't make the tools (e.g. make) in Rtools available outside of R,
it does not allow you to build R itself from source, but it does cover
the very common use cases of calling 'R CMD build/INSTALL/check/...'.

/Henrik

PS. Hadley, is this what you meant when you wrote "Better solutions
(e.g. Rstudio and devtools) temporarily set the path on when you're
calling R CMD *.", or those approaches are only when you call 'R CMD'
from the R prompt?  I believe the latter, but I just want to make sure
I didn't miss something.



On Sun, Apr 21, 2013 at 11:02 AM, Gabor Grothendieck
<ggrothendieck at gmail.com> wrote:
> On Sun, Apr 21, 2013 at 12:57 PM, Hadley Wickham <h.wickham at gmail.com> wrote:
>>>>> Because it can conflict with other Windows software unless you add a
>>>>> layer over it.  What other popular software that runs on Windows has
>>>>> these problems?  I can't think of any.  The closest I can come up with
>>>>> was that for a short time after git was ported to Windows it would
>>>>> change the font of the Windows console but there was an immediate hue
>>>>> and cry about it having no business messing with the rest of Windows
>>>>> and it was quickly rectified.
>>>>
>>>> I don't understand: unless you modify settings in the default install,
>>>> Rtools *does not* affect other windows software in any way.
>>>
>>> If its the case that it now works from the cmd line without setting
>>> the Rtools path before issuing R CMD ... that would be great. If so it
>>> must have occurred silently at some point since I have spent hours in
>>> past years trying to track down why another program I was using did
>>> not work only to discover that it was Rtools.  Surely this was also
>>> your own understanding since devtools, maintains an Rtools path
>>> database which ought to be unnecessary if R is able to find Rtools
>>> itself.
>>
>> I think we are having a failure of communication: Rtools does not set
>> the path, so that you must do so, every time you use it. There is no
>> other way to prevent it from interfering from some other windows
>> software, except by tightly confining the scope in which it enters the
>> path. When I first starting working with Rtools, I thought this was a
>> terribly frustrating decision - why didn't the default installer
>> always put rtools on the path? But now I see it's the only way - it
>> avoids conflicts with other software, and without that default there'd
>> be no way to have multiple versions of rtools installed. That said, I
>> think the logic that Rstudio and devtools uses to find rtools would
>> have been helpful to include in base R, but that's not so important
>> now that it's available in a package. (And if any big change was made,
>> I'd probably argue it'd be better just to always bundle rtools with R
>> on windows - I think it's a key part of the philosophy of R that users
>> can easily become developers. But there are obviously other
>> considerations.)
>>
>> To clarify, the rtools database in devtools does not contain a list of
>> locations of rtools, but the directories inside of an rtools
>> installation that need to be available on the path. This list has
>> changed over time as the tools needed by R have changed. I don't see
>> any way of avoiding that (except perhaps by storing those in the
>> registry, but regardless there's no way to go back in time and fix old
>> decisions). Devtools (following the logic of rstudio) looks in a
>> number of places to find rtools, first looking in the path and then in
>> the registry, and takes considerable care to ensure that the versions
>> of R and rtools match (another reason why the database is necessary).
>
> Yes, that is what I thought until you seemed to be saying otherwise
> but it seems we just misunderstood each  other and, in fact,  no one
> disputes the need to put Rtools on the path nor that it conflicts with
> other Windows programs and potentially causes other programs on your
> PC not to work.  In fact that was one of the motivations I had for
> developing the batchfiles as I once spent hours tracking down a
> problem due to Rtools.
>
> Also I understand that the devtools database uses relative paths and
> wasn't faulting devtools for this but only pointing out that the
> database's existence was a consequence of the need to set up the paths
> in the first place which is what we were discussing - not devtools.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From h.wickham at gmail.com  Mon Apr 22 00:57:25 2013
From: h.wickham at gmail.com (Hadley Wickham)
Date: Sun, 21 Apr 2013 17:57:25 -0500
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CAFDcVCRjpWU=PRAC7BBscAiBm1PFb9tK4BWn3NQjrP6PGo=Nhw@mail.gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com> <517319E5.4040800@gmail.com>
	<CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>
	<CAP01uRkq2PXwrQfN5MAjWuE02QtQxVu8raa2uhW4rOi9BGvuzg@mail.gmail.com>
	<CABdHhvFsiuTmnW8So3TdoKcDVsqtM0sO18NivEjr3JfSG9Bcfg@mail.gmail.com>
	<CAP01uRnP1CJSbtYJHEB3X8GY5CfcbfCgZ=R78SwEuAesYOYMUQ@mail.gmail.com>
	<CABdHhvGQYGa2uJSMFYvL=Ckm=cD27ZAGDQqXPMuhuFr3dRsmUg@mail.gmail.com>
	<CAP01uRmfY1dqk_-8Cq0GodNuFGCGMGcUU6BhBwrNB7hH6bwHeA@mail.gmail.com>
	<CABdHhvHfW6r3fjJeuGUjyRNq0VOBr2YFDiHnu_jmqu6NE7F_WA@mail.gmail.com>
	<CAP01uRnLdB6MA=pbW8C6TJCXFGeSso=HssGNq=GtGKcB7BiK9Q@mail.gmail.com>
	<CAFDcVCRjpWU=PRAC7BBscAiBm1PFb9tK4BWn3NQjrP6PGo=Nhw@mail.gmail.com>
Message-ID: <CABdHhvG2hz+foxwePt1sv6CCRYxg2OJKUDxbYo6r67qpYF1=Sw@mail.gmail.com>

> PS. Hadley, is this what you meant when you wrote "Better solutions
> (e.g. Rstudio and devtools) temporarily set the path on when you're
> calling R CMD *.", or those approaches are only when you call 'R CMD'
> from the R prompt?  I believe the latter, but I just want to make sure
> I didn't miss something.

Well both devtools and RStudio allow you to do package development
without leaving R, so neither do anything to your path when you're not
using them.

In teaching windows users to develop R packages, I found the use of
the command line to be a substantial road-block, and if you can
develop packages without leaving R, why not?

Hadley

--
Chief Scientist, RStudio
http://had.co.nz/


From ggrothendieck at gmail.com  Mon Apr 22 01:04:11 2013
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 21 Apr 2013 19:04:11 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CAFDcVCRjpWU=PRAC7BBscAiBm1PFb9tK4BWn3NQjrP6PGo=Nhw@mail.gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com> <517319E5.4040800@gmail.com>
	<CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>
	<CAP01uRkq2PXwrQfN5MAjWuE02QtQxVu8raa2uhW4rOi9BGvuzg@mail.gmail.com>
	<CABdHhvFsiuTmnW8So3TdoKcDVsqtM0sO18NivEjr3JfSG9Bcfg@mail.gmail.com>
	<CAP01uRnP1CJSbtYJHEB3X8GY5CfcbfCgZ=R78SwEuAesYOYMUQ@mail.gmail.com>
	<CABdHhvGQYGa2uJSMFYvL=Ckm=cD27ZAGDQqXPMuhuFr3dRsmUg@mail.gmail.com>
	<CAP01uRmfY1dqk_-8Cq0GodNuFGCGMGcUU6BhBwrNB7hH6bwHeA@mail.gmail.com>
	<CABdHhvHfW6r3fjJeuGUjyRNq0VOBr2YFDiHnu_jmqu6NE7F_WA@mail.gmail.com>
	<CAP01uRnLdB6MA=pbW8C6TJCXFGeSso=HssGNq=GtGKcB7BiK9Q@mail.gmail.com>
	<CAFDcVCRjpWU=PRAC7BBscAiBm1PFb9tK4BWn3NQjrP6PGo=Nhw@mail.gmail.com>
Message-ID: <CAP01uR=Wx9yL2w8WH=VS7PUsMzJxWjfnyoe0Zw8hf6quuMf7ng@mail.gmail.com>

On Sun, Apr 21, 2013 at 6:17 PM, Henrik Bengtsson <hb at biostat.ucsf.edu> wrote:
> I (as well) keep a specific Rsetup.bat file for launching Windows
> cmd.exe with the proper PATH etc setup for build R packages etc.  It's
> only after this thread I gave it a second thought; you can indeed
> temporarily set the PATH via ~/.Rprofile or ~/.Renviron, which *are*
> processed at the very beginning when calling 'R CMD ...'.
>
> EXAMPLE WITH .Rprofile:
>
> ## ~/.Rprofile (e.g. C:/User/foo/.Rprofile):
> path <- unlist(strsplit(Sys.getenv("PATH"), ";"));
> path <- c("C:\\Rtools\\bin", "C:\\Rtools\\gcc-4.6.3\\bin", path);
> Sys.setenv("PATH"=paste(unique(path), collapse=";"));
>
> ## DISABLED:
> x:\> R --no-init-file CMD INSTALL matrixStats_0.6.2.tar.gz
> * installing to library 'C:/Users/hb/R/win-library/3.0'
> * installing *source* package 'matrixStats' ...
> ** libs
> *** arch - i386
> ERROR: compilation failed for package 'matrixStats'
> * removing 'C:/Users/hb/R/win-library/3.0/matrixStats'
>
> ## ENABLED:
> x:\> R CMD INSTALL matrixStats_0.6.2.tar.gz
> * installing to library 'C:/Users/hb/R/win-library/3.0'
> * installing *source* package 'matrixStats' ...
> ** libs
> *** arch - i386
> gcc -m32 -I"C:/PROGRA~1/R/R-3.0.0patched/include" -DNDEBUG [...]
> [...]
> * DONE (matrixStats)
>
>
> EXAMPLE WITH .Renviron:
> ## ~/.Renviron (e.g. C:/User/foo/.Renviron):
> # Backslashes are preserved iff put within quotes
> PATH="C:\Rtools\bin;C:\Rtools\gcc-4.6.3\bin;${PATH}"
>
> x:\> R --no-environ CMD INSTALL matrixStats_0.6.2.tar.gz
> => fails
>
> x:\> R CMD INSTALL matrixStats_0.6.2.tar.gz
> => works
>
> As long as R is on the PATH, the above either of the approaches
> removes the need to add Rtools to the PATH via a BAT file and it won't
> clutter up your PATH.  This begs the question (as somewhat already
> proposed), instead of users/developers doing this manually, would it
> be possible to have 'R CMD ...' to locate add Rtools to the PATH
> internally.  That would certainly lower the barriers for newcomers to
> install packages from source that need compilation.  Obviously, this
> doesn't make the tools (e.g. make) in Rtools available outside of R,
> it does not allow you to build R itself from source, but it does cover
> the very common use cases of calling 'R CMD build/INSTALL/check/...'.
>
> /Henrik
>
> PS. Hadley, is this what you meant when you wrote "Better solutions
> (e.g. Rstudio and devtools) temporarily set the path on when you're
> calling R CMD *.", or those approaches are only when you call 'R CMD'
> from the R prompt?  I believe the latter, but I just want to make sure
> I didn't miss something.

That seems like a reasonable approach although the code shown does
entail more setup and ongoing maintenance by the user than R.bat which
does not require that the user edit any files and additionally locates
R itself and has many other features.  Also, because R.bat locates R
itself it can be useful even if you are not doing development.  On the
other hand if you are looking to do development strictly from within R
then devtools is already developed.


From moshersteven at gmail.com  Mon Apr 22 03:22:21 2013
From: moshersteven at gmail.com (steven mosher)
Date: Sun, 21 Apr 2013 18:22:21 -0700
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CAP01uR=Wx9yL2w8WH=VS7PUsMzJxWjfnyoe0Zw8hf6quuMf7ng@mail.gmail.com>
References: <5171B903.50401@gmail.com> <5171E5BB.9010200@gmail.com>
	<CAP01uR=5F6UQq2B=z4ZSVXodStm726Fmu=kco5xH3bog_RW--A@mail.gmail.com>
	<CABdHhvHmLaeuQkqwqSw=2isbvtdm=zW_akF5rxuu9Tquvo2uMw@mail.gmail.com>
	<CAP01uRkOt06f4m-y8xYuzdxggu4PUGrhNkzMyKb7x7UOwKAjaQ@mail.gmail.com>
	<5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com> <517319E5.4040800@gmail.com>
	<CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>
	<CAP01uRkq2PXwrQfN5MAjWuE02QtQxVu8raa2uhW4rOi9BGvuzg@mail.gmail.com>
	<CABdHhvFsiuTmnW8So3TdoKcDVsqtM0sO18NivEjr3JfSG9Bcfg@mail.gmail.com>
	<CAP01uRnP1CJSbtYJHEB3X8GY5CfcbfCgZ=R78SwEuAesYOYMUQ@mail.gmail.com>
	<CABdHhvGQYGa2uJSMFYvL=Ckm=cD27ZAGDQqXPMuhuFr3dRsmUg@mail.gmail.com>
	<CAP01uRmfY1dqk_-8Cq0GodNuFGCGMGcUU6BhBwrNB7hH6bwHeA@mail.gmail.com>
	<CABdHhvHfW6r3fjJeuGUjyRNq0VOBr2YFDiHnu_jmqu6NE7F_WA@mail.gmail.com>
	<CAP01uRnLdB6MA=pbW8C6TJCXFGeSso=HssGNq=GtGKcB7BiK9Q@mail.gmail.com>
	<CAFDcVCRjpWU=PRAC7BBscAiBm1PFb9tK4BWn3NQjrP6PGo=Nhw@mail.gmail.com>
	<CAP01uR=Wx9yL2w8WH=VS7PUsMzJxWjfnyoe0Zw8hf6quuMf7ng@mail.gmail.com>
Message-ID: <CAFFLneR6_4haqKAMb025-LcVkEOrC_jNMkm-7VFVYHMKrpBBKw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130421/fe4b901e/attachment.pl>

From kevin.r.coombes at gmail.com  Mon Apr 22 03:46:22 2013
From: kevin.r.coombes at gmail.com (Kevin Coombes)
Date: Sun, 21 Apr 2013 20:46:22 -0500
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CAFFLneR6_4haqKAMb025-LcVkEOrC_jNMkm-7VFVYHMKrpBBKw@mail.gmail.com>
References: <5171B903.50401@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com> <517319E5.4040800@gmail.com>
	<CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>
	<CAP01uRkq2PXwrQfN5MAjWuE02QtQxVu8raa2uhW4rOi9BGvuzg@mail.gmail.com>
	<CABdHhvFsiuTmnW8So3TdoKcDVsqtM0sO18NivEjr3JfSG9Bcfg@mail.gmail.com>
	<CAP01uRnP1CJSbtYJHEB3X8GY5CfcbfCgZ=R78SwEuAesYOYMUQ@mail.gmail.com>
	<CABdHhvGQYGa2uJSMFYvL=Ckm=cD27ZAGDQqXPMuhuFr3dRsmUg@mail.gmail.com>
	<CAP01uRmfY1dqk_-8Cq0GodNuFGCGMGcUU6BhBwrNB7hH6bwHeA@mail.gmail.com>
	<CABdHhvHfW6r3fjJeuGUjyRNq0VOBr2YFDiHnu_jmqu6NE7F_WA@mail.gmail.com>
	<CAP01uRnLdB6MA=pbW8C6TJCXFGeSso=HssGNq=GtGKcB7BiK9Q@mail.gmail.com>
	<CAFDcVCRjpWU=PRAC7BBscAiBm1PFb9tK4BWn3NQjrP6PGo=Nhw@mail.gmail.com>
	<CAP01uR=Wx9yL2w8WH=VS7PUsMzJxWjfnyoe0Zw8hf6quuMf7ng@mail.gmail.com>
	<CAFFLneR6_4haqKAMb025-LcVkEOrC_jNMkm-7VFVYHMKrpBBKw@mail.gmail.com>
Message-ID: <5174966E.7000701@gmail.com>

Here's the short answer:  Whatever you used to do should still work.

I started this thread, not knowing that it was going to get sucked into 
a whirlpool on the fringes of an operating system religious war.  My 
sincerest apologies to everyone who has gotten confused as a consequence.

I only ran into problem because I installed R 3.0 and Rtools 3.0 on a 
new machine, and accidentally put Rtools in a different location from 
where it used to reside on the machines I used for R 2.whatever.  And so 
the scripts I used to build packages no longer worked because the path 
was wrong. If you can avoid doing something silly like that, then your 
old methods for building and maintaining packages should work the same 
way they always did.

On 4/21/2013 8:22 PM, steven mosher wrote:
> Well, color me confused as heck. I've upgraded to R 3.0 so that I can bring
> my packages up to date, but the instructions surrounding Rtools30 are not a
> model of clarity.
>
>
> On Sun, Apr 21, 2013 at 4:04 PM, Gabor Grothendieck <ggrothendieck at gmail.com
>> wrote:
>> On Sun, Apr 21, 2013 at 6:17 PM, Henrik Bengtsson <hb at biostat.ucsf.edu>
>> wrote:
>>> I (as well) keep a specific Rsetup.bat file for launching Windows
>>> cmd.exe with the proper PATH etc setup for build R packages etc.  It's
>>> only after this thread I gave it a second thought; you can indeed
>>> temporarily set the PATH via ~/.Rprofile or ~/.Renviron, which *are*
>>> processed at the very beginning when calling 'R CMD ...'.
>>>
>>> EXAMPLE WITH .Rprofile:
>>>
>>> ## ~/.Rprofile (e.g. C:/User/foo/.Rprofile):
>>> path <- unlist(strsplit(Sys.getenv("PATH"), ";"));
>>> path <- c("C:\\Rtools\\bin", "C:\\Rtools\\gcc-4.6.3\\bin", path);
>>> Sys.setenv("PATH"=paste(unique(path), collapse=";"));
>>>
>>> ## DISABLED:
>>> x:\> R --no-init-file CMD INSTALL matrixStats_0.6.2.tar.gz
>>> * installing to library 'C:/Users/hb/R/win-library/3.0'
>>> * installing *source* package 'matrixStats' ...
>>> ** libs
>>> *** arch - i386
>>> ERROR: compilation failed for package 'matrixStats'
>>> * removing 'C:/Users/hb/R/win-library/3.0/matrixStats'
>>>
>>> ## ENABLED:
>>> x:\> R CMD INSTALL matrixStats_0.6.2.tar.gz
>>> * installing to library 'C:/Users/hb/R/win-library/3.0'
>>> * installing *source* package 'matrixStats' ...
>>> ** libs
>>> *** arch - i386
>>> gcc -m32 -I"C:/PROGRA~1/R/R-3.0.0patched/include" -DNDEBUG [...]
>>> [...]
>>> * DONE (matrixStats)
>>>
>>>
>>> EXAMPLE WITH .Renviron:
>>> ## ~/.Renviron (e.g. C:/User/foo/.Renviron):
>>> # Backslashes are preserved iff put within quotes
>>> PATH="C:\Rtools\bin;C:\Rtools\gcc-4.6.3\bin;${PATH}"
>>>
>>> x:\> R --no-environ CMD INSTALL matrixStats_0.6.2.tar.gz
>>> => fails
>>>
>>> x:\> R CMD INSTALL matrixStats_0.6.2.tar.gz
>>> => works
>>>
>>> As long as R is on the PATH, the above either of the approaches
>>> removes the need to add Rtools to the PATH via a BAT file and it won't
>>> clutter up your PATH.  This begs the question (as somewhat already
>>> proposed), instead of users/developers doing this manually, would it
>>> be possible to have 'R CMD ...' to locate add Rtools to the PATH
>>> internally.  That would certainly lower the barriers for newcomers to
>>> install packages from source that need compilation.  Obviously, this
>>> doesn't make the tools (e.g. make) in Rtools available outside of R,
>>> it does not allow you to build R itself from source, but it does cover
>>> the very common use cases of calling 'R CMD build/INSTALL/check/...'.
>>>
>>> /Henrik
>>>
>>> PS. Hadley, is this what you meant when you wrote "Better solutions
>>> (e.g. Rstudio and devtools) temporarily set the path on when you're
>>> calling R CMD *.", or those approaches are only when you call 'R CMD'
>>> from the R prompt?  I believe the latter, but I just want to make sure
>>> I didn't miss something.
>> That seems like a reasonable approach although the code shown does
>> entail more setup and ongoing maintenance by the user than R.bat which
>> does not require that the user edit any files and additionally locates
>> R itself and has many other features.  Also, because R.bat locates R
>> itself it can be useful even if you are not doing development.  On the
>> other hand if you are looking to do development strictly from within R
>> then devtools is already developed.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Mon Apr 22 13:23:52 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 22 Apr 2013 07:23:52 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CAFFLneR6_4haqKAMb025-LcVkEOrC_jNMkm-7VFVYHMKrpBBKw@mail.gmail.com>
References: <5171B903.50401@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com> <517319E5.4040800@gmail.com>
	<CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>
	<CAP01uRkq2PXwrQfN5MAjWuE02QtQxVu8raa2uhW4rOi9BGvuzg@mail.gmail.com>
	<CABdHhvFsiuTmnW8So3TdoKcDVsqtM0sO18NivEjr3JfSG9Bcfg@mail.gmail.com>
	<CAP01uRnP1CJSbtYJHEB3X8GY5CfcbfCgZ=R78SwEuAesYOYMUQ@mail.gmail.com>
	<CABdHhvGQYGa2uJSMFYvL=Ckm=cD27ZAGDQqXPMuhuFr3dRsmUg@mail.gmail.com>
	<CAP01uRmfY1dqk_-8Cq0GodNuFGCGMGcUU6BhBwrNB7hH6bwHeA@mail.gmail.com>
	<CABdHhvHfW6r3fjJeuGUjyRNq0VOBr2YFDiHnu_jmqu6NE7F_WA@mail.gmail.com>
	<CAP01uRnLdB6MA=pbW8C6TJCXFGeSso=HssGNq=GtGKcB7BiK9Q@mail.gmail.com>
	<CAFDcVCRjpWU=PRAC7BBscAiBm1PFb9tK4BWn3NQjrP6PGo=Nhw@mail.gmail.com>
	<CAP01uR=Wx9yL2w8WH=VS7PUsMzJxWjfnyoe0Zw8hf6quuMf7ng@mail.gmail.com>
	<CAFFLneR6_4haqKAMb025-LcVkEOrC_jNMkm-7VFVYHMKrpBBKw@mail.gmail.com>
Message-ID: <51751DC8.9030809@gmail.com>

On 13-04-21 9:22 PM, steven mosher wrote:
> Well, color me confused as heck. I've upgraded to R 3.0 so that I can bring
> my packages up to date, but the instructions surrounding Rtools30 are not a
> model of clarity.

First thing is, you should not pay attention to Gabor's complaints. 
They are valid, but they only matter to a tiny minority of R users, 
those who use software that requires the ancient "sort" and "find" 
utilities from MSDOS.  Rtools installs a minimal Unix emulator, and 
"sort" and "find" act differently there.

You should also ignore many of the instructions that you find on the 
web, because people write them then don't update them when things 
change.  Pay attention to the R Installation and Administration manual 
(which is kept up to date), and the instructions that are installed 
along with the tools (and readable on the web site).

If you can't follow those instructions, point out which ones you don't 
understand.  If you can follow them but things don't work, then describe 
what problems you are having.

Duncan Murdoch

>
>
> On Sun, Apr 21, 2013 at 4:04 PM, Gabor Grothendieck <ggrothendieck at gmail.com
>> wrote:
>
>> On Sun, Apr 21, 2013 at 6:17 PM, Henrik Bengtsson <hb at biostat.ucsf.edu>
>> wrote:
>>> I (as well) keep a specific Rsetup.bat file for launching Windows
>>> cmd.exe with the proper PATH etc setup for build R packages etc.  It's
>>> only after this thread I gave it a second thought; you can indeed
>>> temporarily set the PATH via ~/.Rprofile or ~/.Renviron, which *are*
>>> processed at the very beginning when calling 'R CMD ...'.
>>>
>>> EXAMPLE WITH .Rprofile:
>>>
>>> ## ~/.Rprofile (e.g. C:/User/foo/.Rprofile):
>>> path <- unlist(strsplit(Sys.getenv("PATH"), ";"));
>>> path <- c("C:\\Rtools\\bin", "C:\\Rtools\\gcc-4.6.3\\bin", path);
>>> Sys.setenv("PATH"=paste(unique(path), collapse=";"));
>>>
>>> ## DISABLED:
>>> x:\> R --no-init-file CMD INSTALL matrixStats_0.6.2.tar.gz
>>> * installing to library 'C:/Users/hb/R/win-library/3.0'
>>> * installing *source* package 'matrixStats' ...
>>> ** libs
>>> *** arch - i386
>>> ERROR: compilation failed for package 'matrixStats'
>>> * removing 'C:/Users/hb/R/win-library/3.0/matrixStats'
>>>
>>> ## ENABLED:
>>> x:\> R CMD INSTALL matrixStats_0.6.2.tar.gz
>>> * installing to library 'C:/Users/hb/R/win-library/3.0'
>>> * installing *source* package 'matrixStats' ...
>>> ** libs
>>> *** arch - i386
>>> gcc -m32 -I"C:/PROGRA~1/R/R-3.0.0patched/include" -DNDEBUG [...]
>>> [...]
>>> * DONE (matrixStats)
>>>
>>>
>>> EXAMPLE WITH .Renviron:
>>> ## ~/.Renviron (e.g. C:/User/foo/.Renviron):
>>> # Backslashes are preserved iff put within quotes
>>> PATH="C:\Rtools\bin;C:\Rtools\gcc-4.6.3\bin;${PATH}"
>>>
>>> x:\> R --no-environ CMD INSTALL matrixStats_0.6.2.tar.gz
>>> => fails
>>>
>>> x:\> R CMD INSTALL matrixStats_0.6.2.tar.gz
>>> => works
>>>
>>> As long as R is on the PATH, the above either of the approaches
>>> removes the need to add Rtools to the PATH via a BAT file and it won't
>>> clutter up your PATH.  This begs the question (as somewhat already
>>> proposed), instead of users/developers doing this manually, would it
>>> be possible to have 'R CMD ...' to locate add Rtools to the PATH
>>> internally.  That would certainly lower the barriers for newcomers to
>>> install packages from source that need compilation.  Obviously, this
>>> doesn't make the tools (e.g. make) in Rtools available outside of R,
>>> it does not allow you to build R itself from source, but it does cover
>>> the very common use cases of calling 'R CMD build/INSTALL/check/...'.
>>>
>>> /Henrik
>>>
>>> PS. Hadley, is this what you meant when you wrote "Better solutions
>>> (e.g. Rstudio and devtools) temporarily set the path on when you're
>>> calling R CMD *.", or those approaches are only when you call 'R CMD'
>>> from the R prompt?  I believe the latter, but I just want to make sure
>>> I didn't miss something.
>>
>> That seems like a reasonable approach although the code shown does
>> entail more setup and ongoing maintenance by the user than R.bat which
>> does not require that the user edit any files and additionally locates
>> R itself and has many other features.  Also, because R.bat locates R
>> itself it can be useful even if you are not doing development.  On the
>> other hand if you are looking to do development strictly from within R
>> then devtools is already developed.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From h.wickham at gmail.com  Mon Apr 22 15:14:26 2013
From: h.wickham at gmail.com (Hadley Wickham)
Date: Mon, 22 Apr 2013 08:14:26 -0500
Subject: [Rd] Converting an environment to a list: mget vs. as.list
Message-ID: <CABdHhvHF7_94JuUr8NAD+keW31hBynAPhhBcLuZzJ9WiPbVk_Q@mail.gmail.com>

Hi all,

An interesting discovery: if you want to convert an environment to a
list, and you already know the names of the objects in the
environment, using mget is about twice as fast as using as.list on the
environment.

https://gist.github.com/hadley/5434786

Hadley




--
Chief Scientist, RStudio
http://had.co.nz/


From murdoch.duncan at gmail.com  Mon Apr 22 16:27:17 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 22 Apr 2013 10:27:17 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CABdHhvG2hz+foxwePt1sv6CCRYxg2OJKUDxbYo6r67qpYF1=Sw@mail.gmail.com>
References: <5171B903.50401@gmail.com> <5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com> <517319E5.4040800@gmail.com>
	<CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>
	<CAP01uRkq2PXwrQfN5MAjWuE02QtQxVu8raa2uhW4rOi9BGvuzg@mail.gmail.com>
	<CABdHhvFsiuTmnW8So3TdoKcDVsqtM0sO18NivEjr3JfSG9Bcfg@mail.gmail.com>
	<CAP01uRnP1CJSbtYJHEB3X8GY5CfcbfCgZ=R78SwEuAesYOYMUQ@mail.gmail.com>
	<CABdHhvGQYGa2uJSMFYvL=Ckm=cD27ZAGDQqXPMuhuFr3dRsmUg@mail.gmail.com>
	<CAP01uRmfY1dqk_-8Cq0GodNuFGCGMGcUU6BhBwrNB7hH6bwHeA@mail.gmail.com>
	<CABdHhvHfW6r3fjJeuGUjyRNq0VOBr2YFDiHnu_jmqu6NE7F_WA@mail.gmail.com>
	<CAP01uRnLdB6MA=pbW8C6TJCXFGeSso=HssGNq=GtGKcB7BiK9Q@mail.gmail.com>
	<CAFDcVCRjpWU=PRAC7BBscAiBm1PFb9tK4BWn3NQjrP6PGo=Nhw@mail.gmail.com>
	<CABdHhvG2hz+foxwePt1sv6CCRYxg2OJKUDxbYo6r67qpYF1=Sw@mail.gmail.com>
Message-ID: <517548C5.6050203@gmail.com>

On 21/04/2013 6:57 PM, Hadley Wickham wrote:
> > PS. Hadley, is this what you meant when you wrote "Better solutions
> > (e.g. Rstudio and devtools) temporarily set the path on when you're
> > calling R CMD *.", or those approaches are only when you call 'R CMD'
> > from the R prompt?  I believe the latter, but I just want to make sure
> > I didn't miss something.
>
> Well both devtools and RStudio allow you to do package development
> without leaving R, so neither do anything to your path when you're not
> using them.
>
> In teaching windows users to develop R packages, I found the use of
> the command line to be a substantial road-block, and if you can
> develop packages without leaving R, why not?

The idea of temporary additions to the path during the 
INSTALL/build/check code sounds reasonable.  R could probably do it more 
accurately than devtools or RStudio can (since we know the requirements, 
and you have to guess at them), but could hopefully do it in a way that 
isn't incompatible with those.

The code called by install.packages() and related functions within R is 
essentially the same code as called by R CMD INSTALL etc from the 
command line, so this would help both cases.

Duncan Murdoch


From simon.urbanek at r-project.org  Mon Apr 22 16:34:12 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 22 Apr 2013 10:34:12 -0400
Subject: [Rd] Converting an environment to a list: mget vs. as.list
In-Reply-To: <CABdHhvHF7_94JuUr8NAD+keW31hBynAPhhBcLuZzJ9WiPbVk_Q@mail.gmail.com>
References: <CABdHhvHF7_94JuUr8NAD+keW31hBynAPhhBcLuZzJ9WiPbVk_Q@mail.gmail.com>
Message-ID: <0AA945F7-017B-44FB-980E-2F4ABEF358F8@r-project.org>

On Apr 22, 2013, at 9:14 AM, Hadley Wickham wrote:

> Hi all,
> 
> An interesting discovery: if you want to convert an environment to a
> list, and you already know the names of the objects in the
> environment, using mget is about twice as fast as using as.list on the
> environment.
> 

I'd say the more interesting part is that ls() is so "slow" if you use the ambiguous "name" argument instead of the direct "envir" one:

> microbenchmark(ls(env), ls(envir=env), .Internal(ls(env, FALSE)))
Unit: nanoseconds
                      expr   min    lq median    uq   max neval
                   ls(env) 12445 13422  14450 15144 37505   100
           ls(envir = env)  1741  2020   2331  2643 15574   100
 .Internal(ls(env, FALSE))   631   730    828   910  4157   100

Note that your objects are so small that you cannot distinguish constant cost (e.g. just the method dispatch on as.list) - and that is in fact what causes the difference - not the actual conversion:

> microbenchmark(as.list(env), as.list.environment(env),  mget(c("x", "y"), env))
Unit: microseconds
                     expr min  lq median  uq  max neval
             as.list(env) 4.8 5.5    5.9 6.1 33.1   100
 as.list.environment(env) 1.4 1.9    2.1 2.4  4.8   100
   mget(c("x", "y"), env) 2.6 3.1    3.4 3.7 37.5   100

So be careful with general statements on very small run times. Suddenly it's no longer surprising ...

Cheers,
S


> https://gist.github.com/hadley/5434786
> 
> Hadley
> 
> 
> 
> 
> --
> Chief Scientist, RStudio
> http://had.co.nz/
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From h.wickham at gmail.com  Mon Apr 22 16:41:12 2013
From: h.wickham at gmail.com (Hadley Wickham)
Date: Mon, 22 Apr 2013 09:41:12 -0500
Subject: [Rd] Converting an environment to a list: mget vs. as.list
In-Reply-To: <0AA945F7-017B-44FB-980E-2F4ABEF358F8@r-project.org>
References: <CABdHhvHF7_94JuUr8NAD+keW31hBynAPhhBcLuZzJ9WiPbVk_Q@mail.gmail.com>
	<0AA945F7-017B-44FB-980E-2F4ABEF358F8@r-project.org>
Message-ID: <CABdHhvHMQHxsjPtmDe6o2cC9fA1eGn4skP6ascZBd=hmtu4Mjw@mail.gmail.com>

> I'd say the more interesting part is that ls() is so "slow" if you use the ambiguous "name" argument instead of the direct "envir" one:
>
>> microbenchmark(ls(env), ls(envir=env), .Internal(ls(env, FALSE)))
> Unit: nanoseconds
>                       expr   min    lq median    uq   max neval
>                    ls(env) 12445 13422  14450 15144 37505   100
>            ls(envir = env)  1741  2020   2331  2643 15574   100
>  .Internal(ls(env, FALSE))   631   730    828   910  4157   100

That is interesting!

> Note that your objects are so small that you cannot distinguish constant cost (e.g. just the method dispatch on as.list) - and that is in fact what causes the difference - not the actual conversion:

That's a good point, but the first example was quite a bit larger, and
hence the impact of S3 dispatch slightly less:

env <- environment(plot)
names <- ls(env)

microbenchmark(
  as.list(env),
  as.list.environment(env),
  mget(names, env))

                     expr min lq median uq max neval
             as.list(env)  42 49     51 53 140   100
 as.list.environment(env)  39 44     46 48 117   100
         mget(names, env)  33 35     37 38  83   100

so mget still wins in that case.

Hadley

--
Chief Scientist, RStudio
http://had.co.nz/


From h.wickham at gmail.com  Mon Apr 22 16:44:42 2013
From: h.wickham at gmail.com (Hadley Wickham)
Date: Mon, 22 Apr 2013 09:44:42 -0500
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <517548C5.6050203@gmail.com>
References: <5171B903.50401@gmail.com> <5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com> <517319E5.4040800@gmail.com>
	<CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>
	<CAP01uRkq2PXwrQfN5MAjWuE02QtQxVu8raa2uhW4rOi9BGvuzg@mail.gmail.com>
	<CABdHhvFsiuTmnW8So3TdoKcDVsqtM0sO18NivEjr3JfSG9Bcfg@mail.gmail.com>
	<CAP01uRnP1CJSbtYJHEB3X8GY5CfcbfCgZ=R78SwEuAesYOYMUQ@mail.gmail.com>
	<CABdHhvGQYGa2uJSMFYvL=Ckm=cD27ZAGDQqXPMuhuFr3dRsmUg@mail.gmail.com>
	<CAP01uRmfY1dqk_-8Cq0GodNuFGCGMGcUU6BhBwrNB7hH6bwHeA@mail.gmail.com>
	<CABdHhvHfW6r3fjJeuGUjyRNq0VOBr2YFDiHnu_jmqu6NE7F_WA@mail.gmail.com>
	<CAP01uRnLdB6MA=pbW8C6TJCXFGeSso=HssGNq=GtGKcB7BiK9Q@mail.gmail.com>
	<CAFDcVCRjpWU=PRAC7BBscAiBm1PFb9tK4BWn3NQjrP6PGo=Nhw@mail.gmail.com>
	<CABdHhvG2hz+foxwePt1sv6CCRYxg2OJKUDxbYo6r67qpYF1=Sw@mail.gmail.com>
	<517548C5.6050203@gmail.com>
Message-ID: <CABdHhvG=+qtbKRBAbgwEcUrDYmmxeBJ2rc2UM=Gv3n1hJrVKDw@mail.gmail.com>

> The idea of temporary additions to the path during the INSTALL/build/check
> code sounds reasonable.  R could probably do it more accurately than
> devtools or RStudio can (since we know the requirements, and you have to
> guess at them), but could hopefully do it in a way that isn't incompatible
> with those.

Both devtools and Rstudio check if gcc and ls are on the path already,
and if they are, do nothing, so anything you did should be compatible.
 JJ and I would of course be happy to make any changes if necessary,
and share our code for Rtools detection (along with useful error
messages in all the edge cases).

Hadley

--
Chief Scientist, RStudio
http://had.co.nz/


From ggrothendieck at gmail.com  Mon Apr 22 17:16:00 2013
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 22 Apr 2013 11:16:00 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <517548C5.6050203@gmail.com>
References: <5171B903.50401@gmail.com> <5172B8FC.6010004@gmail.com>
	<CAP01uRmCLc67t=t0qeUjsj4QsTVN1vp9VZnWH6iNCYpzjCXJGQ@mail.gmail.com>
	<5172D661.4000703@gmail.com> <5172D84F.3060801@gmail.com>
	<5172DC98.8040308@gmail.com> <517319E5.4040800@gmail.com>
	<CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>
	<CAP01uRkq2PXwrQfN5MAjWuE02QtQxVu8raa2uhW4rOi9BGvuzg@mail.gmail.com>
	<CABdHhvFsiuTmnW8So3TdoKcDVsqtM0sO18NivEjr3JfSG9Bcfg@mail.gmail.com>
	<CAP01uRnP1CJSbtYJHEB3X8GY5CfcbfCgZ=R78SwEuAesYOYMUQ@mail.gmail.com>
	<CABdHhvGQYGa2uJSMFYvL=Ckm=cD27ZAGDQqXPMuhuFr3dRsmUg@mail.gmail.com>
	<CAP01uRmfY1dqk_-8Cq0GodNuFGCGMGcUU6BhBwrNB7hH6bwHeA@mail.gmail.com>
	<CABdHhvHfW6r3fjJeuGUjyRNq0VOBr2YFDiHnu_jmqu6NE7F_WA@mail.gmail.com>
	<CAP01uRnLdB6MA=pbW8C6TJCXFGeSso=HssGNq=GtGKcB7BiK9Q@mail.gmail.com>
	<CAFDcVCRjpWU=PRAC7BBscAiBm1PFb9tK4BWn3NQjrP6PGo=Nhw@mail.gmail.com>
	<CABdHhvG2hz+foxwePt1sv6CCRYxg2OJKUDxbYo6r67qpYF1=Sw@mail.gmail.com>
	<517548C5.6050203@gmail.com>
Message-ID: <CAP01uRntewgpwxNJAQPZTxhmptDT=8OqP7+gho0ZZVndZEJpHA@mail.gmail.com>

On Mon, Apr 22, 2013 at 10:27 AM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 21/04/2013 6:57 PM, Hadley Wickham wrote:
>>
>> > PS. Hadley, is this what you meant when you wrote "Better solutions
>> > (e.g. Rstudio and devtools) temporarily set the path on when you're
>> > calling R CMD *.", or those approaches are only when you call 'R CMD'
>> > from the R prompt?  I believe the latter, but I just want to make sure
>> > I didn't miss something.
>>
>> Well both devtools and RStudio allow you to do package development
>> without leaving R, so neither do anything to your path when you're not
>> using them.
>>
>> In teaching windows users to develop R packages, I found the use of
>> the command line to be a substantial road-block, and if you can
>> develop packages without leaving R, why not?
>
>
> The idea of temporary additions to the path during the INSTALL/build/check
> code sounds reasonable.  R could probably do it more accurately than
> devtools or RStudio can (since we know the requirements, and you have to
> guess at them), but could hopefully do it in a way that isn't incompatible
> with those.
>
> The code called by install.packages() and related functions within R is
> essentially the same code as called by R CMD INSTALL etc from the command
> line, so this would help both cases.

I would like to comment on this as I have had to implement similar
facilities myself as part R.bat in the batchfiles.

There is an issue of keeping R and Rtools in sync.   Currently
different Rtools versions will work with the same R version.  For
example, I have used both Rtools 1927 and 1930 with the current
version of R.  Its necessary to determine the relative paths that the
version of Rtools in use requires since in principle the relative
Rtools paths can vary from one version of Rtools to the next if the
gcc version changes, say.

Ideally the system would be able to figure this out even if registry
entries and environment variables are not set by looking in standard
locations for the Rtools root and finding the relative paths by
querying some file in the Rtools installation itself.  devtools does
this by querying the Rtools version and uss an internal database of
relative paths keyed by version.   R.bat in batchfiles does it by
scanning the Rtools unins000.dat file and extracting the relative
paths directly from it.  This has the advantage that no database need
be maintained and it also automatically adapts to new versions of
Rtools without any foreknowledge of them.   Of course since you have
control of both ends you alternately could add the relative paths to
an expanded version of the VERSION file or add some additional text
file into Rtools for the purpose of identifying he relative paths..

Another possibility if significant changes were to be considered would
be to make Rtools into an R package thereby leveraging existing
facilities and much simplifying any synchronization.

--
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From friendly at yorku.ca  Mon Apr 22 17:59:24 2013
From: friendly at yorku.ca (Michael Friendly)
Date: Mon, 22 Apr 2013 11:59:24 -0400
Subject: [Rd] vignettes: problems with PDF compaction
In-Reply-To: <517421D0.2@yorku.ca>
References: <517421D0.2@yorku.ca>
Message-ID: <51755E5C.10306@yorku.ca>

On 4/21/2013 1:28 PM, Michael Friendly wrote:
> [Env: OS: Win Xp; R 2.15.2; IDE: eclipse/StatET]
>
> Each time I update my heplots package, I get warnings from R CMD check
> on R-Forge,
>
> * checking sizes of PDF files under ?inst/doc? ... WARNING
>    ?gs+qpdf? made some significant size reductions:
>       compacted ?HE-examples.pdf? from 739Kb to 366Kb
>
To follow up my own post, I did some more checking of whether/how to
compact PDFs on my own system.  My conclusion is that that I am unable
to comply with the request from CRAN maintainers, even though I would
like to.  Once again, I wonder why this cannot be handled on the CRAN
side automatically.

qpdf: running it from a cmd prompt (using the options from 
tools::compactPDF) doesn't do very much compression

C:\R\test>qpdf --stream-data=compress --object-streams=generate 
HE-examples.pdf
HE-examples-comp.pdf

C:\R\test>dir HE-examples*
04/22/2013  10:55 AM           699,191 HE-examples-comp.pdf
04/22/2013  10:28 AM           756,624 HE-examples.pdf

gs:  I have gs installed at C:\Program Files\gs\gs9.07\bin\gswin32.exe,
but the gs installer doesn't put itself on the path, so 
tools::compactPDF sees gs_cmd as empty:

 > gs_cmd = Sys.getenv("R_GSCMD", "")
[1] ""

so it can't run gs+qpdf.  OK, so I try to do it manually:

 > Sys.setenv(R_GSCMD = "C:/Program Files/gs/gs9.07/bin/gswin32.exe")
 > setwd("test")
 >
 > tools::compactPDF("HE-examples.pdf")
 > tools::compactPDF("HE-examples.pdf", gs_quality="ebook")

But this doesn't do anything, not even changing the timestamp on the 
file, because the file size doesn't change enough.

C:\R\test>dir HE-examples.pdf
04/22/2013  10:28 AM           756,624 HE-examples.pdf

-- 
Michael Friendly     Email: friendly AT yorku DOT ca
Professor, Psychology Dept. & Chair, Quantitative Methods
York University      Voice: 416 736-2100 x66249 Fax: 416 736-5814
4700 Keele Street    Web:   http://www.datavis.ca
Toronto, ONT  M3J 1P3 CANADA


From ligges at statistik.tu-dortmund.de  Mon Apr 22 23:51:27 2013
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Mon, 22 Apr 2013 23:51:27 +0200
Subject: [Rd] vignettes: problems with PDF compaction
In-Reply-To: <51755E5C.10306@yorku.ca>
References: <517421D0.2@yorku.ca> <51755E5C.10306@yorku.ca>
Message-ID: <5175B0DF.1080703@statistik.tu-dortmund.de>



On 22.04.2013 17:59, Michael Friendly wrote:
> On 4/21/2013 1:28 PM, Michael Friendly wrote:
>> [Env: OS: Win Xp; R 2.15.2; IDE: eclipse/StatET]
>>
>> Each time I update my heplots package, I get warnings from R CMD check
>> on R-Forge,
>>
>> * checking sizes of PDF files under ?inst/doc? ... WARNING
>>    ?gs+qpdf? made some significant size reductions:
>>       compacted ?HE-examples.pdf? from 739Kb to 366Kb
>>
> To follow up my own post, I did some more checking of whether/how to
> compact PDFs on my own system.  My conclusion is that that I am unable
> to comply with the request from CRAN maintainers, even though I would
> like to.  Once again, I wonder why this cannot be handled on the CRAN
> side automatically.

Because we cannot know if the result is acceptable. This is not a 
lossless compression.



> qpdf: running it from a cmd prompt (using the options from
> tools::compactPDF) doesn't do very much compression
>
> C:\R\test>qpdf --stream-data=compress --object-streams=generate
> HE-examples.pdf
> HE-examples-comp.pdf
>
> C:\R\test>dir HE-examples*
> 04/22/2013  10:55 AM           699,191 HE-examples-comp.pdf
> 04/22/2013  10:28 AM           756,624 HE-examples.pdf
>
> gs:  I have gs installed at C:\Program Files\gs\gs9.07\bin\gswin32.exe,
> but the gs installer doesn't put itself on the path, so
> tools::compactPDF sees gs_cmd as empty:
>
>  > gs_cmd = Sys.getenv("R_GSCMD", "")
> [1] ""
>
> so it can't run gs+qpdf.  OK, so I try to do it manually:
>
>  > Sys.setenv(R_GSCMD = "C:/Program Files/gs/gs9.07/bin/gswin32.exe")
>  > setwd("test")
>  >
>  > tools::compactPDF("HE-examples.pdf")
>  > tools::compactPDF("HE-examples.pdf", gs_quality="ebook")
>
> But this doesn't do anything, not even changing the timestamp on the
> file, because the file size doesn't change enough.

Either you changed it or not, there is no "not enough".

Best,
Uwe



> C:\R\test>dir HE-examples.pdf
> 04/22/2013  10:28 AM           756,624 HE-examples.pdf
>


From hb at biostat.ucsf.edu  Tue Apr 23 02:06:56 2013
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Mon, 22 Apr 2013 17:06:56 -0700
Subject: [Rd] vignettes: problems with PDF compaction
In-Reply-To: <5175B0DF.1080703@statistik.tu-dortmund.de>
References: <517421D0.2@yorku.ca> <51755E5C.10306@yorku.ca>
	<5175B0DF.1080703@statistik.tu-dortmund.de>
Message-ID: <CAFDcVCTJAWLxvShBqnRp9Ukg91SkZ8DBy2hv_P0z1nT882zbFg@mail.gmail.com>

It's certainly not obvious, but you should use 'gswin32c.exe' instead
of 'gswin32.exe'.  From
http://ghostscript.com/doc/current/Install.htm#Install_Windows

"GSWIN32C.EXE  Ghostscript as a 32-bit Windows command line program.
This is usually the preferred executable.
GSWIN32.EXE 32-bit Ghostscript using its own window for commands"

Basically, 'gswin32c.exe' corresponds to 'gs' on Unix systems (the
other one tries to open its own Windows which doesn't work).  If
you're installing the 64-bit version of Ghostscript, use
'gswin64c.exe'.

You can verify that you have the proper setup by:

> Sys.setenv(R_GSCMD="C:/Program Files/gs/gs9.07/bin/gswin32c.exe")
> res <- system2(Sys.getenv("R_GSCMD"), args="--version")
9.07
> res
[1] 0

If you get 127 it indicates an error/command not found, e.g.

> Sys.setenv(R_GSCMD="C:/Program Files/gs/gs9.07/bin/gswin32c.exeHIDE")
> res <- system2(Sys.getenv("R_GSCMD"), args="--version")
> res
[1] 127

So, after confirming that you get res == 0, then retry with:

> tools::compactPDF("HE-examples.pdf", gs_quality="ebook")

FYI, you can set your R_GSCMD in C:/Users/foo/.Renviron, cf. help(".Renviron").

Hope this helps

Henrik

On Mon, Apr 22, 2013 at 2:51 PM, Uwe Ligges
<ligges at statistik.tu-dortmund.de> wrote:
>
>
> On 22.04.2013 17:59, Michael Friendly wrote:
>>
>> On 4/21/2013 1:28 PM, Michael Friendly wrote:
>>>
>>> [Env: OS: Win Xp; R 2.15.2; IDE: eclipse/StatET]
>>>
>>> Each time I update my heplots package, I get warnings from R CMD check
>>> on R-Forge,
>>>
>>> * checking sizes of PDF files under ?inst/doc? ... WARNING
>>>    ?gs+qpdf? made some significant size reductions:
>>>       compacted ?HE-examples.pdf? from 739Kb to 366Kb
>>>
>> To follow up my own post, I did some more checking of whether/how to
>> compact PDFs on my own system.  My conclusion is that that I am unable
>> to comply with the request from CRAN maintainers, even though I would
>> like to.  Once again, I wonder why this cannot be handled on the CRAN
>> side automatically.
>
>
> Because we cannot know if the result is acceptable. This is not a lossless
> compression.
>
>
>
>
>> qpdf: running it from a cmd prompt (using the options from
>> tools::compactPDF) doesn't do very much compression
>>
>> C:\R\test>qpdf --stream-data=compress --object-streams=generate
>> HE-examples.pdf
>> HE-examples-comp.pdf
>>
>> C:\R\test>dir HE-examples*
>> 04/22/2013  10:55 AM           699,191 HE-examples-comp.pdf
>> 04/22/2013  10:28 AM           756,624 HE-examples.pdf
>>
>> gs:  I have gs installed at C:\Program Files\gs\gs9.07\bin\gswin32.exe,
>> but the gs installer doesn't put itself on the path, so
>> tools::compactPDF sees gs_cmd as empty:
>>
>>  > gs_cmd = Sys.getenv("R_GSCMD", "")
>> [1] ""
>>
>> so it can't run gs+qpdf.  OK, so I try to do it manually:
>>
>>  > Sys.setenv(R_GSCMD = "C:/Program Files/gs/gs9.07/bin/gswin32.exe")
>>  > setwd("test")
>>  >
>>  > tools::compactPDF("HE-examples.pdf")
>>  > tools::compactPDF("HE-examples.pdf", gs_quality="ebook")
>>
>> But this doesn't do anything, not even changing the timestamp on the
>> file, because the file size doesn't change enough.
>
>
> Either you changed it or not, there is no "not enough".
>
> Best,
> Uwe
>
>
>
>
>> C:\R\test>dir HE-examples.pdf
>> 04/22/2013  10:28 AM           756,624 HE-examples.pdf
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From johnzhao2835 at gmail.com  Tue Apr 23 09:35:22 2013
From: johnzhao2835 at gmail.com (=?utf-8?B?6LW16Ieq5by6?=)
Date: Tue, 23 Apr 2013 15:35:22 +0800
Subject: [Rd] Help: Where can I find the code for 'C_Cdqrls'?
Message-ID: <000e01ce3ff5$1ec9eb90$5c5dc2b0$@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130423/df85bc3c/attachment.pl>

From rh at knut-krueger.de  Tue Apr 23 11:34:27 2013
From: rh at knut-krueger.de (Knut Krueger)
Date: Tue, 23 Apr 2013 11:34:27 +0200
Subject: [Rd] Line breaks in rd files
Message-ID: <517655A3.1060109@knut-krueger.de>

How can I add a new line in an rd file f.e between references?

Knut


From michael.nelson at sydney.edu.au  Tue Apr 23 08:32:38 2013
From: michael.nelson at sydney.edu.au (Michael Nelson)
Date: Tue, 23 Apr 2013 06:32:38 +0000
Subject: [Rd] httpd error with and help_type = 'html', package = NULL
Message-ID: <6FB5193A6CDCDF499486A833B7AFBDCD6751B606@EX-MBX-PRO-04.mcs.usyd.edu.au>

Having loaded a package that masks an object from another package, calling


help(conflictedname, help_type = 'html')


instead of producing a page giving the choices of help page available

The page produced is

Error in httpd("/library/NULL/help/nobs", NULL, NULL, c(48, 6f, 73, 74,  : 
  replacement has length zero


This example is reproduced using

library(gdata)
help(nobs, help_type = 'html')



sessionInfo()
R version 3.0.0 (2013-04-03)
Platform: i386-w64-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252    LC_MONETARY=English_Australia.1252 LC_NUMERIC=C                       LC_TIME=English_Australia.1252    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] gdata_2.12.0.2

loaded via a namespace (and not attached):
[1] gtools_2.7.1 tools_3.0.0 


There are no issues when using help_type = 'pdf' or help_type = 'text'


Michael


From ligges at statistik.tu-dortmund.de  Tue Apr 23 14:47:21 2013
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Tue, 23 Apr 2013 14:47:21 +0200
Subject: [Rd] Line breaks in rd files
In-Reply-To: <517655A3.1060109@knut-krueger.de>
References: <517655A3.1060109@knut-krueger.de>
Message-ID: <517682D9.1060603@statistik.tu-dortmund.de>



On 23.04.2013 11:34, Knut Krueger wrote:
> How can I add a new line in an rd file f.e between references?

Keep a blank line between references.

Uwe Ligges



>
> Knut
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ligges at statistik.tu-dortmund.de  Tue Apr 23 14:55:12 2013
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Tue, 23 Apr 2013 14:55:12 +0200
Subject: [Rd] Help: Where can I find the code for 'C_Cdqrls'?
In-Reply-To: <000e01ce3ff5$1ec9eb90$5c5dc2b0$@gmail.com>
References: <000e01ce3ff5$1ec9eb90$5c5dc2b0$@gmail.com>
Message-ID: <517684B0.1030703@statistik.tu-dortmund.de>



On 23.04.2013 09:35, ??? wrote:
> Dear all,
>
>                  I???m not sure if it is O.K. to ask this question here.
>
>                  But where can I find the code for the function ???C_Cdqrls??? which is called by the R function ???lsfit???.

Look into the R sources:

grepping for dqrls shows the following relevant files:


./src/appl/dqrls.f:      subroutine 
dqrls(x,n,p,y,ny,tol,b,rsd,qty,k,jpvt,qraux,work)
./src/include/R_ext/Applic.h:void F77_NAME(dqrls)(double *x, int *n, int 
*p, double *y, int *ny,
./src/library/stats/src/init.c:    CALLDEF(Cdqrls, 3),
./src/library/stats/src/lm.c:    z <- .Fortran("dqrls",
./src/library/stats/src/lm.c:SEXP Cdqrls(SEXP x, SEXP y, SEXP tol)
./src/library/stats/src/lm.c:    F77_CALL(dqrls)(REAL(qr), &n, &p, 
REAL(y), &ny, &rtol,
./src/library/stats/src/statsR.h:SEXP Cdqrls(SEXP x, SEXP y, SEXP tol);


Best,
Uwe Ligges


>
>                  Thank you all.
>
>                  Sorry for being na??ve if so.
>
> --------------------
>
> Ziqiang Zhao
>
> 2013-04-23
>
>
>
>
> 	[[alternative HTML version deleted]]
>
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Tue Apr 23 15:01:40 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 23 Apr 2013 14:01:40 +0100
Subject: [Rd] Help: Where can I find the code for 'C_Cdqrls'?
In-Reply-To: <000e01ce3ff5$1ec9eb90$5c5dc2b0$@gmail.com>
References: <000e01ce3ff5$1ec9eb90$5c5dc2b0$@gmail.com>
Message-ID: <51768634.8040805@stats.ox.ac.uk>

First, it is not a function.  It is an R object in the stats namespace 
and you can look at it like any other object:

 > stats:::C_Cdqrls
$name
[1] "Cdqrls"

$address
<pointer: 0x7f8483499750>
attr(,"class")
[1] "RegisteredNativeSymbol"

$dll
DLL name: stats
Filename: /Users/ripley/R/R-devel/library/stats/libs/stats.so
Dynamic lookup: FALSE

$numParameters
[1] 3

attr(,"class")
[1] "CallRoutine"      "NativeSymbolInfo"

That tells you it is invoking a C function called Cdqrls: you can search 
from that in the sources for package stats.  In fact it is in 
src/library/stats/src/lm.c .

You would know to look in the stats namespace since you found this in a 
function from that namespace.

Generally R's own code uses the convention of object C_foo for C entry 
point foo and F_bar for Fortran entry point bar (but there are 
exceptions, more so in R < 3.0.0).


On 23/04/2013 08:35, ??? wrote:
> Dear all,
>
>                  I???m not sure if it is O.K. to ask this question here.
>
>                  But where can I find the code for the function ???C_Cdqrls??? which is called by the R function ???lsfit???.
>
>                  Thank you all.
>
>                  Sorry for being na??ve if so.
>
> --------------------
>
> Ziqiang Zhao
>
> 2013-04-23
>
>
>
>
> 	[[alternative HTML version deleted]]
>
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Tue Apr 23 15:07:46 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 23 Apr 2013 14:07:46 +0100
Subject: [Rd] httpd error with and help_type = 'html', package = NULL
In-Reply-To: <6FB5193A6CDCDF499486A833B7AFBDCD6751B606@EX-MBX-PRO-04.mcs.usyd.edu.au>
References: <6FB5193A6CDCDF499486A833B7AFBDCD6751B606@EX-MBX-PRO-04.mcs.usyd.edu.au>
Message-ID: <517687A2.8040807@stats.ox.ac.uk>

Is this not PR#15282?  No one has got to it yet.

On 23/04/2013 07:32, Michael Nelson wrote:
> Having loaded a package that masks an object from another package, calling
>
>
> help(conflictedname, help_type = 'html')
>
>
> instead of producing a page giving the choices of help page available
>
> The page produced is
>
> Error in httpd("/library/NULL/help/nobs", NULL, NULL, c(48, 6f, 73, 74,  :
>    replacement has length zero
>
>
> This example is reproduced using
>
> library(gdata)
> help(nobs, help_type = 'html')
>
>
>
> sessionInfo()
> R version 3.0.0 (2013-04-03)
> Platform: i386-w64-mingw32/i386 (32-bit)
>
> locale:
> [1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252    LC_MONETARY=English_Australia.1252 LC_NUMERIC=C                       LC_TIME=English_Australia.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] gdata_2.12.0.2
>
> loaded via a namespace (and not attached):
> [1] gtools_2.7.1 tools_3.0.0
>
>
> There are no issues when using help_type = 'pdf' or help_type = 'text'
>
>
> Michael
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Tue Apr 23 15:12:15 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 23 Apr 2013 14:12:15 +0100
Subject: [Rd] parallel::mclapply does not return try-error objects with
 mc.preschedule=TRUE
In-Reply-To: <CAMd4_AcNj7ErEe8PVON-b9MRRK8eMEbnp3goKGd49aemthrmeg@mail.gmail.com>
References: <CAMd4_AcNj7ErEe8PVON-b9MRRK8eMEbnp3goKGd49aemthrmeg@mail.gmail.com>
Message-ID: <517688AF.7050504@stats.ox.ac.uk>

On 11/04/2013 12:43, Karl Forner wrote:
> Hello,
>
> Consider this:
>
> 1)
> library(parallel)
> res <- mclapply(1:2, stop)
> #Warning message:
> #In mclapply(1:2, stop) :
> # all scheduled cores encountered errors in user code
>
> is(res[[1]], 'try-error')
> #[1] FALSE
>
>
> 2)
> library(parallel)
> res <- mclapply(1:2, stop, mc.preschedule=FALSE)
> #Warning message:
> #In mclapply(1:2, stop, mc.preschedule = FALSE) :
> #  2 function calls resulted in an error
>
> is(res[[1]], 'try-error')
> #[1] TRUE
>
> The documentation states that:
> 'Each forked process runs its job inside try(..., silent = TRUE) so if
> errors occur they will be stored as class "try-error" objects in the
> return value and a warning will be given.'
>
>
> Is this a bug ?

Not in parallel.  Something else has changed, and I am about to commit a 
different version that still works as documented.

>
> Thanks
> Karl
>
>
>> sessionInfo()
> R version 2.15.3 (2013-03-01)
> Platform: x86_64-unknown-linux-gnu (64-bit)
>
> locale:
>   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>   [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>   [7] LC_PAPER=C                 LC_NAME=C
>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] parallel  stats     graphics  grDevices utils     datasets  methods
> [8] base
>
> loaded via a namespace (and not attached):
> [1] tools_2.15.3
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch.duncan at gmail.com  Tue Apr 23 15:20:50 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 23 Apr 2013 09:20:50 -0400
Subject: [Rd] Line breaks in rd files
In-Reply-To: <517655A3.1060109@knut-krueger.de>
References: <517655A3.1060109@knut-krueger.de>
Message-ID: <51768AB2.9070706@gmail.com>

On 23/04/2013 5:34 AM, Knut Krueger wrote:
> How can I add a new line in an rd file f.e between references?
>
>

As Uwe said, for a reference list a blank line between references is 
probably best:  in most reference styles, each reference is its own 
paragraph.  For other uses \cr will insert a break.

Duncan Murdoch


From friendly at yorku.ca  Tue Apr 23 15:50:55 2013
From: friendly at yorku.ca (Michael Friendly)
Date: Tue, 23 Apr 2013 09:50:55 -0400
Subject: [Rd] vignettes: problems with PDF compaction
In-Reply-To: <5175B0DF.1080703@statistik.tu-dortmund.de>
References: <517421D0.2@yorku.ca> <51755E5C.10306@yorku.ca>
	<5175B0DF.1080703@statistik.tu-dortmund.de>
Message-ID: <517691BF.5040806@yorku.ca>

On 4/22/2013 5:51 PM, Uwe Ligges wrote:
>> But this doesn't do anything, not even changing the timestamp on the
>> file, because the file size doesn't change enough.
>
> Either you changed it or not, there is no "not enough".

I meant that the code in tools::compact compares the sizes of the old
and new files and only replaces the old file if the change in size is 
"sufficient":

  if (new/old < 0.9 && new < old - 10000) {
                 file.copy(tf, p, overwrite = TRUE)
             }

At any rate, with R_GSCMD now fixed (Thx: Henrik), tools::compactPDF,
with gs_quality="ebook",
still does not reduce the size of my HE-examples.pdf file.

I tried the same on my Ubuntu system (R 2.15.2 also), and there I get

 > tools::compactPDF("HE-examples.pdf", gs_quality="ebook")
   compacted 'HE-examples.pdf' from 739Kb to 366Kb

So, I can now copy the compacted file back to my development tree
on Windows; however, as I understand things, vignettes are re-built
by R CMD build and --compact-vignettes=gs+qpdf has no effect.
So my Ubuntu-compacted file will be overwritten.

It's somewhat maddening to have to spend so much time to save ~373Kb
in order to avoid a CRAN warning.

-- 
Michael Friendly     Email: friendly AT yorku DOT ca
Professor, Psychology Dept. & Chair, Quantitative Methods
York University      Voice: 416 736-2100 x66249 Fax: 416 736-5814
4700 Keele Street    Web:   http://www.datavis.ca
Toronto, ONT  M3J 1P3 CANADA


From David.Pleydell at antilles.inra.fr  Tue Apr 23 16:51:42 2013
From: David.Pleydell at antilles.inra.fr (dpleydell)
Date: Tue, 23 Apr 2013 10:51:42 -0400
Subject: [Rd] Verbose output from R CMD check
Message-ID: <51769FFE.2020604@antilles.inra.fr>

I've been developing a package called foobar for a couple of years now. 
It has evolved through various versions, but has always contained 
compiled C code. Recently, R CMD check has started generating the 
following message

[START QUOTE]

R CMD check foobar_1.7.5.tar.gz
* using log directory ?/home/david/foobar/package/foobar.Rcheck?
* using R version 2.15.2 (2012-10-26)
* using platform: x86_64-unknown-linux-gnu (64-bit)
* using session charset: UTF-8
* checking for file ?foobar/DESCRIPTION? ... OK
[LOTS OF '...OK' CHECK REPORTS REMOVED FOR BREVITY]
* checking compiled code ... NOTE
File ?/home/david/foobar/package/foobar.Rcheck/foobar/libs/foobar.so?:
   Found ?putchar?, possibly from ?putchar? (C)
     Object: ?foobar.o?
   Found ?puts?, possibly from ?printf? (C), ?puts? (C)
     Object: ?foobar.o?

Compiled code should not call functions which might terminate R nor 
write to stdout/stderr instead of to the console.

See ?Writing portable packages? in the ?Writing R Extensions? manual.
* checking examples ... OK
* checking PDF version of manual ... OK

NOTE: There was 1 note.
See ?/home/david/foobar/package/foobar.Rcheck/00check.log? for details.

[END QUOTE]

This message is recent, but appears even when I re-compile and check old 
versions of the package which previously passed the check without any 
such warning messages.

My understanding is that since R 2.15.0 R CMD check has undergone 
numerous modifications, and as a result it is now identifying a 
"problem" that wasn't being identified previously. I'm currently running 
R 2.15.2.

Identifying the source of the message is a non-trivial problem because 
there are a large number of calls to printf and fprintf etc in several 
thousands of lines of code spread over many different *.c files.

So my question... is there a way to obtain a more verbose output that 
could point me to the lines of code that generate the message? Without 
this information debugging is rendered unnecessarily hard, time 
consuming and frustrating.

many thanks
David


-- 
David Pleydell,
INRA,
UMR-1351 CMAEE,
Domaine Duclos,
Prise D'eau,
97122 Petit Bourg,
Guadeloupe
dpleydell at antilles.inra.fr
pleydell at cirad.fr
Tel +33 5 90 25 54 42
Fax +33 5 90 94 03 96


From karl.forner at gmail.com  Tue Apr 23 17:16:59 2013
From: karl.forner at gmail.com (Karl Forner)
Date: Tue, 23 Apr 2013 17:16:59 +0200
Subject: [Rd] parallel::mclapply does not return try-error objects with
	mc.preschedule=TRUE
In-Reply-To: <517688AF.7050504@stats.ox.ac.uk>
References: <CAMd4_AcNj7ErEe8PVON-b9MRRK8eMEbnp3goKGd49aemthrmeg@mail.gmail.com>
	<517688AF.7050504@stats.ox.ac.uk>
Message-ID: <CAMd4_AfkiMC3-9sOupKU74w6RFxa6zw8PyJCR=1wumSPTJ1UeA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130423/6c63b0bc/attachment.pl>

From simon.urbanek at r-project.org  Tue Apr 23 17:21:17 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 23 Apr 2013 11:21:17 -0400
Subject: [Rd] Verbose output from R CMD check
In-Reply-To: <51769FFE.2020604@antilles.inra.fr>
References: <51769FFE.2020604@antilles.inra.fr>
Message-ID: <22AF9B56-93D2-44C3-9879-136AFC61C5A7@r-project.org>


On Apr 23, 2013, at 10:51 AM, dpleydell wrote:

> I've been developing a package called foobar for a couple of years now. It has evolved through various versions, but has always contained compiled C code. Recently, R CMD check has started generating the following message
> 
> [START QUOTE]
> 
> R CMD check foobar_1.7.5.tar.gz
> * using log directory ?/home/david/foobar/package/foobar.Rcheck?
> * using R version 2.15.2 (2012-10-26)
> * using platform: x86_64-unknown-linux-gnu (64-bit)
> * using session charset: UTF-8
> * checking for file ?foobar/DESCRIPTION? ... OK
> [LOTS OF '...OK' CHECK REPORTS REMOVED FOR BREVITY]
> * checking compiled code ... NOTE
> File ?/home/david/foobar/package/foobar.Rcheck/foobar/libs/foobar.so?:
>  Found ?putchar?, possibly from ?putchar? (C)
>    Object: ?foobar.o?
>  Found ?puts?, possibly from ?printf? (C), ?puts? (C)
>    Object: ?foobar.o?
> 
> Compiled code should not call functions which might terminate R nor write to stdout/stderr instead of to the console.
> 
> See ?Writing portable packages? in the ?Writing R Extensions? manual.
> * checking examples ... OK
> * checking PDF version of manual ... OK
> 
> NOTE: There was 1 note.
> See ?/home/david/foobar/package/foobar.Rcheck/00check.log? for details.
> 
> [END QUOTE]
> 
> This message is recent, but appears even when I re-compile and check old versions of the package which previously passed the check without any such warning messages.
> 
> My understanding is that since R 2.15.0 R CMD check has undergone numerous modifications, and as a result it is now identifying a "problem" that wasn't being identified previously. I'm currently running R 2.15.2.
> 
> Identifying the source of the message is a non-trivial problem because there are a large number of calls to printf and fprintf etc in several thousands of lines of code spread over many different *.c files.
> 

There should be none, so apparently you have broken the rules quite a lot ;). This is not a new rule, R just got better at identifying the transgressions. Number of lines in your code is quite irrelevant - that's why there is grep and the search function in editors.


> So my question... is there a way to obtain a more verbose output that could point me to the lines of code that generate the message? Without this information debugging is rendered unnecessarily hard, time consuming and frustrating.
> 

It's not "unnecessarily hard" - it fact it's much easier to find this out from the sources than the compiled code which is how R has to identify it which makes it impossible to track the source (because it could have been from a static library, for example).

Cheers,
Simon


> many thanks
> David
> 
> 
> -- 
> David Pleydell,
> INRA,
> UMR-1351 CMAEE,
> Domaine Duclos,
> Prise D'eau,
> 97122 Petit Bourg,
> Guadeloupe
> dpleydell at antilles.inra.fr
> pleydell at cirad.fr
> Tel +33 5 90 25 54 42
> Fax +33 5 90 94 03 96
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From David.Pleydell at antilles.inra.fr  Tue Apr 23 18:43:36 2013
From: David.Pleydell at antilles.inra.fr (dpleydell)
Date: Tue, 23 Apr 2013 12:43:36 -0400
Subject: [Rd] Verbose output from R CMD check
In-Reply-To: <22AF9B56-93D2-44C3-9879-136AFC61C5A7@r-project.org>
References: <51769FFE.2020604@antilles.inra.fr>
	<22AF9B56-93D2-44C3-9879-136AFC61C5A7@r-project.org>
Message-ID: <5176BA38.1040407@antilles.inra.fr>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130423/21cf12f9/attachment.pl>

From pburns at pburns.seanet.com  Tue Apr 23 19:23:31 2013
From: pburns at pburns.seanet.com (Patrick Burns)
Date: Tue, 23 Apr 2013 18:23:31 +0100
Subject: [Rd] as.name and namespaces
Message-ID: <5176C393.9090802@pburns.seanet.com>

'as.name' doesn't recognize a name with
its namespace extension as a name:

 > as.name("lm")
lm
 > as.name("stats::lm")
`stats::lm`
 > as.name("stats:::lm")
`stats:::lm`


Is there a reason why it shouldn't?

Pat


-- 
Patrick Burns
pburns at pburns.seanet.com
twitter: @burnsstat @portfolioprobe
http://www.portfolioprobe.com/blog
http://www.burns-stat.com
(home of:
  'Impatient R'
  'The R Inferno'
  'Tao Te Programming')


From pdalgd at gmail.com  Tue Apr 23 19:32:52 2013
From: pdalgd at gmail.com (peter dalgaard)
Date: Tue, 23 Apr 2013 19:32:52 +0200
Subject: [Rd] as.name and namespaces
In-Reply-To: <5176C393.9090802@pburns.seanet.com>
References: <5176C393.9090802@pburns.seanet.com>
Message-ID: <3F6D53EB-1C02-42B4-AD2D-085D9E9E94C3@gmail.com>


On Apr 23, 2013, at 19:23 , Patrick Burns wrote:

> 'as.name' doesn't recognize a name with
> its namespace extension as a name:
> 
> > as.name("lm")
> lm
> > as.name("stats::lm")
> `stats::lm`
> > as.name("stats:::lm")
> `stats:::lm`
> 
> 
> Is there a reason why it shouldn't?

Any reason why it should? :: and ::: are operators. foo$bar is not the same as `foo$bar` either.

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From murdoch.duncan at gmail.com  Tue Apr 23 20:01:12 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 23 Apr 2013 14:01:12 -0400
Subject: [Rd] httpd error with and help_type = 'html', package = NULL
In-Reply-To: <517687A2.8040807@stats.ox.ac.uk>
References: <6FB5193A6CDCDF499486A833B7AFBDCD6751B606@EX-MBX-PRO-04.mcs.usyd.edu.au>
	<517687A2.8040807@stats.ox.ac.uk>
Message-ID: <5176CC68.4090403@gmail.com>

On 23/04/2013 9:07 AM, Prof Brian Ripley wrote:
> Is this not PR#15282?  No one has got to it yet.

Fixed now in R-devel; just testing R-patched.

Duncan Murdoch
>
> On 23/04/2013 07:32, Michael Nelson wrote:
> > Having loaded a package that masks an object from another package, calling
> >
> >
> > help(conflictedname, help_type = 'html')
> >
> >
> > instead of producing a page giving the choices of help page available
> >
> > The page produced is
> >
> > Error in httpd("/library/NULL/help/nobs", NULL, NULL, c(48, 6f, 73, 74,  :
> >    replacement has length zero
> >
> >
> > This example is reproduced using
> >
> > library(gdata)
> > help(nobs, help_type = 'html')
> >
> >
> >
> > sessionInfo()
> > R version 3.0.0 (2013-04-03)
> > Platform: i386-w64-mingw32/i386 (32-bit)
> >
> > locale:
> > [1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252    LC_MONETARY=English_Australia.1252 LC_NUMERIC=C                       LC_TIME=English_Australia.1252
> >
> > attached base packages:
> > [1] stats     graphics  grDevices utils     datasets  methods   base
> >
> > other attached packages:
> > [1] gdata_2.12.0.2
> >
> > loaded via a namespace (and not attached):
> > [1] gtools_2.7.1 tools_3.0.0
> >
> >
> > There are no issues when using help_type = 'pdf' or help_type = 'text'
> >
> >
> > Michael
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>
>


From pburns at pburns.seanet.com  Tue Apr 23 21:51:55 2013
From: pburns at pburns.seanet.com (Patrick Burns)
Date: Tue, 23 Apr 2013 20:51:55 +0100
Subject: [Rd] as.name and namespaces
In-Reply-To: <3F6D53EB-1C02-42B4-AD2D-085D9E9E94C3@gmail.com>
References: <5176C393.9090802@pburns.seanet.com>
	<3F6D53EB-1C02-42B4-AD2D-085D9E9E94C3@gmail.com>
Message-ID: <5176E65B.50500@pburns.seanet.com>

Okay, that's a good reason why it shouldn't.

Why it should is that I want to substitute
the first element of a call to be a function
including the namespace.

Pat


On 23/04/2013 18:32, peter dalgaard wrote:
>
> On Apr 23, 2013, at 19:23 , Patrick Burns wrote:
>
>> 'as.name' doesn't recognize a name with
>> its namespace extension as a name:
>>
>>> as.name("lm")
>> lm
>>> as.name("stats::lm")
>> `stats::lm`
>>> as.name("stats:::lm")
>> `stats:::lm`
>>
>>
>> Is there a reason why it shouldn't?
>
> Any reason why it should? :: and ::: are operators. foo$bar is not the same as `foo$bar` either.
>

-- 
Patrick Burns
pburns at pburns.seanet.com
twitter: @burnsstat @portfolioprobe
http://www.portfolioprobe.com/blog
http://www.burns-stat.com
(home of:
  'Impatient R'
  'The R Inferno'
  'Tao Te Programming')


From pdalgd at gmail.com  Tue Apr 23 22:17:21 2013
From: pdalgd at gmail.com (peter dalgaard)
Date: Tue, 23 Apr 2013 22:17:21 +0200
Subject: [Rd] as.name and namespaces
In-Reply-To: <5176E65B.50500@pburns.seanet.com>
References: <5176C393.9090802@pburns.seanet.com>
	<3F6D53EB-1C02-42B4-AD2D-085D9E9E94C3@gmail.com>
	<5176E65B.50500@pburns.seanet.com>
Message-ID: <3E817854-2CDE-468C-8F2D-304442A5267B@gmail.com>


On Apr 23, 2013, at 21:51 , Patrick Burns wrote:

> Okay, that's a good reason why it shouldn't.
> 
> Why it should is that I want to substitute
> the first element of a call to be a function
> including the namespace.

Offhand, I'd say that it shouldn't be a problem, but do you have a more concrete example?

-pd

> 
> Pat
> 
> 
> On 23/04/2013 18:32, peter dalgaard wrote:
>> 
>> On Apr 23, 2013, at 19:23 , Patrick Burns wrote:
>> 
>>> 'as.name' doesn't recognize a name with
>>> its namespace extension as a name:
>>> 
>>>> as.name("lm")
>>> lm
>>>> as.name("stats::lm")
>>> `stats::lm`
>>>> as.name("stats:::lm")
>>> `stats:::lm`
>>> 
>>> 
>>> Is there a reason why it shouldn't?
>> 
>> Any reason why it should? :: and ::: are operators. foo$bar is not the same as `foo$bar` either.
>> 
> 
> -- 
> Patrick Burns
> pburns at pburns.seanet.com
> twitter: @burnsstat @portfolioprobe
> http://www.portfolioprobe.com/blog
> http://www.burns-stat.com
> (home of:
> 'Impatient R'
> 'The R Inferno'
> 'Tao Te Programming')

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From murdoch.duncan at gmail.com  Tue Apr 23 22:18:28 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 23 Apr 2013 16:18:28 -0400
Subject: [Rd] as.name and namespaces
In-Reply-To: <5176E65B.50500@pburns.seanet.com>
References: <5176C393.9090802@pburns.seanet.com>
	<3F6D53EB-1C02-42B4-AD2D-085D9E9E94C3@gmail.com>
	<5176E65B.50500@pburns.seanet.com>
Message-ID: <5176EC94.3060607@gmail.com>

On 13-04-23 3:51 PM, Patrick Burns wrote:
> Okay, that's a good reason why it shouldn't.
>
> Why it should is that I want to substitute
> the first element of a call to be a function
> including the namespace.

Three ways:

1.  Assign the function from the namespace locally, then call the local one.
2.  Import the function in your NAMESPACE (if you know the name in advance).
3.  Construct an expression involving ::, and substitute that in.

For example:

substitute(foo(x), list(foo=quote(baz::bar)))

Duncan Murdoch

>
> Pat
>
>
> On 23/04/2013 18:32, peter dalgaard wrote:
>>
>> On Apr 23, 2013, at 19:23 , Patrick Burns wrote:
>>
>>> 'as.name' doesn't recognize a name with
>>> its namespace extension as a name:
>>>
>>>> as.name("lm")
>>> lm
>>>> as.name("stats::lm")
>>> `stats::lm`
>>>> as.name("stats:::lm")
>>> `stats:::lm`
>>>
>>>
>>> Is there a reason why it shouldn't?
>>
>> Any reason why it should? :: and ::: are operators. foo$bar is not the same as `foo$bar` either.
>>
>


From hpages at fhcrc.org  Wed Apr 24 01:20:00 2013
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 23 Apr 2013 16:20:00 -0700
Subject: [Rd] about the 'length' arg of vector()
Message-ID: <51771720.7020404@fhcrc.org>

Hi,

In the man page for vector():

   length: A non-negative integer specifying the desired length.  Double
           values will be coerced to integer: supplying an argument of
           length other than one is an error.

Since long vectors are supported, it doesn't seem to be true anymore
that "double values will be coerced to integer":

   > bigraw <- vector("raw", 3e9)
   > length(bigraw)
   [1] 3e+09
   > storage.mode(length(bigraw))
   [1] "double"

At least not always...

Thanks,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From simon.urbanek at r-project.org  Wed Apr 24 01:30:55 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 23 Apr 2013 19:30:55 -0400
Subject: [Rd] Verbose output from R CMD check
In-Reply-To: <5176BA38.1040407@antilles.inra.fr>
References: <51769FFE.2020604@antilles.inra.fr>
	<22AF9B56-93D2-44C3-9879-136AFC61C5A7@r-project.org>
	<5176BA38.1040407@antilles.inra.fr>
Message-ID: <ADD5064D-988D-4F77-983F-032A6EFD6059@r-project.org>

On Apr 23, 2013, at 12:43 PM, dpleydell wrote:

> Many thanks Simon for your response
>>> Identifying the source of the message is a non-trivial problem because there are a large number of calls to printf and fprintf etc in several thousands of lines of code spread over many different *.c files.
>>> 
>>> 
>> There should be none, so apparently you have broken the rules quite a lot ;). This is not a new rule, R just got better at identifying the transgressions. Number of lines in your code is quite irrelevant - that's why there is grep and the search function in editors.
>> 
> 
> Well, that wouldn't be the first time I've broken rules ;0)  
> 
> But, how bad could the consequences of my misbehaviour be here?  Are we talking about crashing R or just messing the output a little? 
> 

We're not talking life and death here ;) - yes, frustrated users because of messed up output is the main danger here. Also the behavior changes by GUI and platform, so throw in inconsistency charge as well.

To be precise, there are two issues: a) the output on stdout/stderr is not necessarily visible (e.g. the Windows GUI discards it) and it is separate from the console (e.g. sink() doesn't work on it). More importantly b) it messes up the use of R in streaming, i.e. uses where you are processing input on stdin and streaming output on stdout -- it will break the output. This is most frustrating because the user has no way to control this behavior other than deleting the offending package.


> In Writing R Extensions (current on-line version) the worst they say about printf is
> 
> [QUOTE]
> The most useful function for printing from a C routine compiled into R is Rprintf. This is used in exactly the same way as printf, but is guaranteed to write to R's output (which might be a GUI console rather than a file, and can be re-directed by sink).
> [UNQUOTE]
> 
> and both printf and fprintf are used in section 8.2.2 in the rtest.c example. Also, the manual does not say explicitly what fprintf should be replaced with.
> 

fprintf() is ok as long as you don't use it with stdout/stderr. You can use it for files, no problem there.


> Come to think of it... my package performs MCMC and uses fprintf to write samples to an output file. I have noticed that once in each nth blue-moon (for large n) a single line of output has been dropped or scrambled. More frequently, the updates of the output file seem to lag behind the progress of the algorithm's principal loop - for example, file size becomes non-zero much later than I expect.

Typically, I/O is buffered, so the file is not necessarily updated after you use fprintf(). By default, it will get updated only after the output buffer has been filled. You can use fflush() to flush the output buffer to disk immediately (alternatively you can mark the stream as unbuffered).


> I never understood this behaviour or saw how to rectify it. Perhaps replacing fprintf with something else could "guarantee" the end of this undesirable behaviour? Great! 
> 
> Is there a "safe" way to re-write the following?
> 
> fprintf(fMCMCout, "%d %e %e ", iteration, posteriorLoglik, parameter); 
> if (numberRandomEffects > 1) {
>   for (k=0; k < numberRandomEffects; k++) { 
>     fprintf(fMCMCout, "%e ", randomEffects[k]); 
> }
> fprintf(fMCMCout,"\n");
> 
> This is really a question of 2 parts
> 1) what is the best replacement of fprintf in the above?

If MCMCout is a file, the above is fine.


> and
> 2) Writing R Extensions says "It is wise to write complete lines (including the "\n") before returning to R.", so is it legal to defer \n as in the example above?
> 

Yes, sure.

Cheers,
Simon


> many thanks
> David
> 
> 
> 
> 
> 
> -- 
> David Pleydell,
> INRA,
> UMR-1351 CMAEE,
> Domaine Duclos, 
> Prise D'eau,
> 97122 Petit Bourg,
> Guadeloupe
> 
> dpleydell at antilles.inra.fr
> pleydell at cirad.fr
> 
> Tel +33 5 90 25 54 42
> Fax +33 5 90 94 03 96  
> 


From hpages at fhcrc.org  Wed Apr 24 01:48:42 2013
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 23 Apr 2013 16:48:42 -0700
Subject: [Rd] is.vector(as.vector(x, m), m) not always TRUE
Message-ID: <51771DDA.3040403@fhcrc.org>

In the man page for as.vector() (same as man page for vector()):

      Writers of methods for ?as.vector? need to take care to follow the
      conventions of the default method.  In particular

         ? Argument ?mode? can be ?"any"?, any of the atomic modes,
           ?"list"?, ?"expression"?, ?"symbol"?, ?"pairlist"? or one of
           the aliases ?"double"? and ?"name"?.

         ? The return value should be of the appropriate mode.  For
           ?mode = "any"? this means an atomic vector or list.

         ? Attributes should be treated appropriately: in particular
           when the result is an atomic vector there should be no
           attributes, not even names.

         ? ?is.vector(as.vector(x, m), m)? should be true for any mode
           ?m?, including the default ?"any"?.

But:

   > is.vector(as.vector("a", "name"), "name")
   [1] FALSE

Mmmh, the default method itself doesn't seem to follow its own
conventions :-/

Cheers,
H.

 > sessionInfo()
R version 3.0.0 (2013-04-03)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
  [7] LC_PAPER=C                 LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] tools_3.0.0

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From f.harrell at vanderbilt.edu  Wed Apr 24 05:22:38 2013
From: f.harrell at vanderbilt.edu (Frank Harrell)
Date: Tue, 23 Apr 2013 20:22:38 -0700 (PDT)
Subject: [Rd] Problem with S3 method dispatch and NAMESPACE
Message-ID: <1366773758314-4665179.post@n4.nabble.com>

I have updated the rms package to extensively use NAMESPACE.  I cannot get
certain S3 methods to dispatch.  For example I have in NAMESPACE

S3method(anova, rms)
S3method(latex, anova.rms)

anova.rms produces an object of class "anova.rms" and there is a
latex.anova.rms function in rms.  But when I do latex(anova(fit)) I get an
invocation of latex.default.

I have tried using "anova.rms" and `anova.rms` in S3method() to no avail.

Any help appreciated.  I'm using R 2.15.3
Frank



-----
Frank Harrell
Department of Biostatistics, Vanderbilt University
--
View this message in context: http://r.789695.n4.nabble.com/Problem-with-S3-method-dispatch-and-NAMESPACE-tp4665179.html
Sent from the R devel mailing list archive at Nabble.com.


From hpages at fhcrc.org  Wed Apr 24 08:09:21 2013
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 23 Apr 2013 23:09:21 -0700
Subject: [Rd] multiple issues with is.unsorted()
Message-ID: <51777711.5020507@fhcrc.org>

Hi,

In the man page for is.unsorted():

   Value:

      A length-one logical value.  All objects of length 0 or 1 are
      sorted: the result will be ?NA? for objects of length 2 or more
      except for atomic vectors and objects with a class (where the ?>=?
      or ?>? method is used to compare ?x[i]? with ?x[i-1]? for ?i? in
      ?2:length(x)?).

This contains many incorrect statements:

      > length(NA)
      [1] 1
      > is.unsorted(NA)
      [1] NA
      > length(list(NA))
      [1] 1
      > is.unsorted(list(NA))
      [1] NA

=> Contradicts "all objects of length 0 or 1 are sorted".

      > is.unsorted(raw(2))
      Error in is.unsorted(raw(2)) : unimplemented type 'raw' in 
'isUnsorted'

=> Doesn't agree with the doc (unless "except for atomic vectors"
    means "it might fail for atomic vectors").

      > setClass("A", representation(aa="integer"))
      > a <- new("A", aa=4:1)
      > length(a)
      [1] 1

      > is.unsorted(a)
      [1] FALSE
      Warning message:
      In is.na(x) : is.na() applied to non-(list or vector) of type 'S4'

=> Ok, but it's arguable the warning is useful/justified from a user
    point of view. The warning *seems* to suggest that defining an
    "is.na" method for my objects is required for is.unsorted() to
    work properly but the doc doesn't make this clear.

Anyway, let's define one, so the warning goes away:

      > setMethod("is.na", "A", function(x) is.na(x at aa))
      [1] "is.na"

Let's define a "length" method:

      > setMethod("length", "A", function(x) length(x at aa))
      [1] "length"
      > length(a)
      [1] 4

      > is.unsorted(a)
      [1] FALSE

=> Is this correct? Hard to know. The doc is not clear about what
    should happen for objects of length 2 or more and with a class
    but with no ">=" or ">" methods.

Let's define "[", ">=", and ">":

      > setMethod("[", "A", function(x, i, j, ..., drop=TRUE) new("A", 
aa=x at aa[i]))
      [1] "["
      > rev(a)
      An object of class "A"
      Slot "aa":
      [1] 1 2 3 4

      > setMethod(">=", c("A", "A"), function(e1, e2) {e1 at aa >= e2 at aa})
      [1] ">="
      > a >= a[3]
      [1]  TRUE  TRUE  TRUE FALSE

      > setMethod(">", c("A", "A"), function(e1, e2) {e1 at aa > e2 at aa})
      [1] ">"
      > a > a[3]
      [1]  TRUE  TRUE FALSE FALSE

      > is.unsorted(a)
      [1] FALSE

     > is.unsorted(rev(a))
     [1] FALSE

Still not working as expected. So what's required exactly for making
is.unsorted() work on an object "with a class"?

BTW, is.unsorted() would be *much* faster, at least on atomic vectors,
without those calls to is.na(). The C code could check for NAs, without
having to do this as a first pass on the full vector like it is the
case with the current implementation. If the vector if unsorted, the
C code is typically able to bail out early so the speed-up will
typically be 10000x or more if the vector as millions of elements.

Thanks,
H.

 > sessionInfo()
R version 3.0.0 (2013-04-03)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
  [7] LC_PAPER=C                 LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] tools_3.0.0

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From pdalgd at gmail.com  Wed Apr 24 08:11:08 2013
From: pdalgd at gmail.com (peter dalgaard)
Date: Wed, 24 Apr 2013 08:11:08 +0200
Subject: [Rd] is.vector(as.vector(x, m), m) not always TRUE
In-Reply-To: <51771DDA.3040403@fhcrc.org>
References: <51771DDA.3040403@fhcrc.org>
Message-ID: <6BC93B8B-183D-47BB-9910-C14418B108DE@gmail.com>


On Apr 24, 2013, at 01:48 , Herv? Pag?s wrote:

> In the man page for as.vector() (same as man page for vector()):
> 
>     Writers of methods for ?as.vector? need to take care to follow the
>     conventions of the default method.  In particular
> 
>        ? Argument ?mode? can be ?"any"?, any of the atomic modes,
>          ?"list"?, ?"expression"?, ?"symbol"?, ?"pairlist"? or one of
>          the aliases ?"double"? and ?"name"?.
> 
>        ? The return value should be of the appropriate mode.  For
>          ?mode = "any"? this means an atomic vector or list.
> 
>        ? Attributes should be treated appropriately: in particular
>          when the result is an atomic vector there should be no
>          attributes, not even names.
> 
>        ? ?is.vector(as.vector(x, m), m)? should be true for any mode
>          ?m?, including the default ?"any"?.
> 
> But:
> 
>  > is.vector(as.vector("a", "name"), "name")
>  [1] FALSE
> 
> Mmmh, the default method itself doesn't seem to follow its own
> conventions :-/
> 

Looks like there should be a straightforward fix, since

> is.vector(as.vector("a", "name"), "symbol")
[1] TRUE

so it is just a matter of implementing "name" as synomyous with "symbol".

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From maechler at stat.math.ethz.ch  Wed Apr 24 09:53:13 2013
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 24 Apr 2013 09:53:13 +0200
Subject: [Rd] about the 'length' arg of vector()
In-Reply-To: <51771720.7020404@fhcrc.org>
References: <51771720.7020404@fhcrc.org>
Message-ID: <20855.36713.442488.260920@stat.math.ethz.ch>

>>>>> Herv? Pag?s <hpages at fhcrc.org>
>>>>>     on Tue, 23 Apr 2013 16:20:00 -0700 writes:

    > Hi, In the man page for vector():

    >    length: A non-negative integer specifying the desired
    > length.  Double values will be coerced to integer:
    > supplying an argument of length other than one is an
    > error.

    > Since long vectors are supported, it doesn't seem to be
    > true anymore that "double values will be coerced to
    > integer":

    >> bigraw <- vector("raw", 3e9) length(bigraw)
    >    [1] 3e+09
    >> storage.mode(length(bigraw))
    >    [1] "double"

    > At least not always...

Indeed.  Thank you, Herve!
Change committed to the documentation.

Martin Maechler,
ETH Zurich


    > Thanks, H.
    > -- 
    > Herv? Pag?s


From maechler at stat.math.ethz.ch  Wed Apr 24 11:29:39 2013
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 24 Apr 2013 11:29:39 +0200
Subject: [Rd] multiple issues with is.unsorted()
In-Reply-To: <51777711.5020507@fhcrc.org>
References: <51777711.5020507@fhcrc.org>
Message-ID: <20855.42499.123379.361911@stat.math.ethz.ch>

Dear Herve,

>>>>> Herv? Pag?s <hpages at fhcrc.org>
>>>>>     on Tue, 23 Apr 2013 23:09:21 -0700 writes:

    > Hi, In the man page for is.unsorted():

    >    Value:

    >       A length-one logical value.  All objects of length 0
    > or 1 are sorted: the result will be ?NA? for objects of
    > length 2 or more except for atomic vectors and objects
    > with a class (where the ?>=? or ?>? method is used to
    > compare ?x[i]? with ?x[i-1]? for ?i? in ?2:length(x)?).

    > This contains many incorrect statements:

    >> length(NA)
    >       [1] 1
    >> is.unsorted(NA)
    >       [1] NA
    >> length(list(NA))
    >       [1] 1
    >> is.unsorted(list(NA))
    >       [1] NA

    > => Contradicts "all objects of length 0 or 1 are sorted".

    >> is.unsorted(raw(2))
    >       Error in is.unsorted(raw(2)) : unimplemented type
    > 'raw' in 'isUnsorted'

    > => Doesn't agree with the doc (unless "except for atomic
    > vectors" means "it might fail for atomic vectors").

    >> setClass("A", representation(aa="integer")) a <- new("A",
    >> aa=4:1) length(a)
    >       [1] 1

    >> is.unsorted(a)
    >       [1] FALSE Warning message: In is.na(x) : is.na()
    > applied to non-(list or vector) of type 'S4'

    > => Ok, but it's arguable the warning is useful/justified
    > from a user point of view. The warning *seems* to suggest
    > that defining an "is.na" method for my objects is required
    > for is.unsorted() to work properly but the doc doesn't
    > make this clear.

    > Anyway, let's define one, so the warning goes away:

    >> setMethod("is.na", "A", function(x) is.na(x at aa))
    >       [1] "is.na"

    > Let's define a "length" method:

    >> setMethod("length", "A", function(x) length(x at aa))
    >       [1] "length"
    >> length(a)
    >       [1] 4

    >> is.unsorted(a)
    >       [1] FALSE

    > => Is this correct? Hard to know. The doc is not clear
    > about what should happen for objects of length 2 or more
    > and with a class but with no ">=" or ">" methods.

    > Let's define "[", ">=", and ">":

    >> setMethod("[", "A", function(x, i, j, ..., drop=TRUE)
    >> new("A",
    > aa=x at aa[i])) [1] "["
    >> rev(a)
    >       An object of class "A" Slot "aa": [1] 1 2 3 4

    >> setMethod(">=", c("A", "A"), function(e1, e2) {e1 at aa >=
    >> e2 at aa})
    >       [1] ">="
    >> a >= a[3]
    >       [1] TRUE TRUE TRUE FALSE

    >> setMethod(">", c("A", "A"), function(e1, e2) {e1 at aa >
    >> e2 at aa})
    >       [1] ">"
    >> a > a[3]
    >       [1] TRUE TRUE FALSE FALSE

    >> is.unsorted(a)
    >       [1] FALSE

    >> is.unsorted(rev(a))
    >      [1] FALSE

    > Still not working as expected. So what's required exactly
    > for making is.unsorted() work on an object "with a class"?

well, read the source code. :-) ;-)

More seriously: On another hidden help page, you find

  \code{.gt} and \code{.gtn} are callbacks from \code{\link{rank}} and
  \code{\link{is.unsorted}} used for classed objects.

In other words, you'd need do define a method for 
 .gtn  for S4 objects in this case.

.... yes, indeed I don't know why this is not at all documented.



    > BTW, is.unsorted() would be *much* faster, at least on
    > atomic vectors, without those calls to is.na(). 

Well, in all R versions, apart from R-devel as of yesterday,
the source of is.unsorted() has been

  is.unsorted <- function(x, na.rm = FALSE, strictly = FALSE)
  {
      if(is.null(x)) return(FALSE)
      if(!na.rm && any(is.na(x)))## "FIXME" is.na(<large>) is "too slow"
	  return(NA)
      ## else
      if(na.rm && any(ii <- is.na(x)))
	  x <- x[!ii]
      .Internal(is.unsorted(x, strictly))
  }

so you see the "FIXME".

In R-devel  (and probably  R-patched  in the nearer future),
that line is

      if(!na.rm && anyMissing(x))

so there's no slow code anymore, at least not for the default
case of  na.rm = FALSE.


    > The C code
    > could check for NAs, without having to do this as a first
    > pass on the full vector like it is the case with the
    > current implementation. If the vector if unsorted, the C
    > code is typically able to bail out early so the speed-up
    > will typically be 10000x or more if the vector as millions
    > of elements.

you are right (but again: the most important case na.rm=FALSE
    case has been "solved" already I'd say),
but you know well that we do gratefully accept good patches to
the R sources.


    > Thanks, H.

    >> sessionInfo()
    > R version 3.0.0 (2013-04-03) Platform:
    > x86_64-unknown-linux-gnu (64-bit)

    > locale: [1] LC_CTYPE=en_US.UTF-8 LC_NUMERIC=C [3]
    > LC_TIME=en_US.UTF-8 LC_COLLATE=en_US.UTF-8 [5]
    > LC_MONETARY=en_US.UTF-8 LC_MESSAGES=en_US.UTF-8 [7]
    > LC_PAPER=C LC_NAME=C [9] LC_ADDRESS=C LC_TELEPHONE=C [11]
    > LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

    > attached base packages: [1] stats graphics grDevices utils
    > datasets methods base

    > loaded via a namespace (and not attached): [1] tools_3.0.0

    > -- 
    > Herv? Pag?s

    > Program in Computational Biology Division of Public Health
    > Sciences Fred Hutchinson Cancer Research Center 1100
    > Fairview Ave. N, M1-B514 P.O. Box 19024 Seattle, WA
    > 98109-1024

    > E-mail: hpages at fhcrc.org Phone: (206) 667-5791 Fax: (206)
    > 667-1319

    > ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel


From pburns at pburns.seanet.com  Wed Apr 24 11:29:43 2013
From: pburns at pburns.seanet.com (Patrick Burns)
Date: Wed, 24 Apr 2013 10:29:43 +0100
Subject: [Rd] as.name and namespaces
In-Reply-To: <5176EC94.3060607@gmail.com>
References: <5176C393.9090802@pburns.seanet.com>
	<3F6D53EB-1C02-42B4-AD2D-085D9E9E94C3@gmail.com>
	<5176E65B.50500@pburns.seanet.com> <5176EC94.3060607@gmail.com>
Message-ID: <5177A607.10706@pburns.seanet.com>

Here is an example problem:

 > mycall <- expression(lm(Y ~ x))[[1]]
 > mycall
lm(Y ~ x)
 > newname <- "stats::lm"

 > desiredResult
stats::lm(Y ~ x)

I've solved the problem in the kludgy way of
deparsing, fixing the string and then parsing.

I like Duncan's third method, but it seems like
it assumes the solution.  Moving functions around
is unappetizing for my use -- this is for testing
and keeping things as faithful to real use is a
good thing.

Pat


On 23/04/2013 21:18, Duncan Murdoch wrote:
> On 13-04-23 3:51 PM, Patrick Burns wrote:
>> Okay, that's a good reason why it shouldn't.
>>
>> Why it should is that I want to substitute
>> the first element of a call to be a function
>> including the namespace.
>
> Three ways:
>
> 1.  Assign the function from the namespace locally, then call the local
> one.
> 2.  Import the function in your NAMESPACE (if you know the name in
> advance).
> 3.  Construct an expression involving ::, and substitute that in.
>
> For example:
>
> substitute(foo(x), list(foo=quote(baz::bar)))
>
> Duncan Murdoch
>
>>
>> Pat
>>
>>
>> On 23/04/2013 18:32, peter dalgaard wrote:
>>>
>>> On Apr 23, 2013, at 19:23 , Patrick Burns wrote:
>>>
>>>> 'as.name' doesn't recognize a name with
>>>> its namespace extension as a name:
>>>>
>>>>> as.name("lm")
>>>> lm
>>>>> as.name("stats::lm")
>>>> `stats::lm`
>>>>> as.name("stats:::lm")
>>>> `stats:::lm`
>>>>
>>>>
>>>> Is there a reason why it shouldn't?
>>>
>>> Any reason why it should? :: and ::: are operators. foo$bar is not
>>> the same as `foo$bar` either.
>>>
>>
>
>

-- 
Patrick Burns
pburns at pburns.seanet.com
twitter: @burnsstat @portfolioprobe
http://www.portfolioprobe.com/blog
http://www.burns-stat.com
(home of:
  'Impatient R'
  'The R Inferno'
  'Tao Te Programming')


From pdalgd at gmail.com  Wed Apr 24 11:47:35 2013
From: pdalgd at gmail.com (peter dalgaard)
Date: Wed, 24 Apr 2013 11:47:35 +0200
Subject: [Rd] as.name and namespaces
In-Reply-To: <5177A607.10706@pburns.seanet.com>
References: <5176C393.9090802@pburns.seanet.com>
	<3F6D53EB-1C02-42B4-AD2D-085D9E9E94C3@gmail.com>
	<5176E65B.50500@pburns.seanet.com> <5176EC94.3060607@gmail.com>
	<5177A607.10706@pburns.seanet.com>
Message-ID: <B2C57DB2-44AE-440D-BF43-C44115B3E4D4@gmail.com>

There's also the brute force option:

> mycall <- expression(lm(Y ~ x))[[1]]
> mycall[[1]] <- quote(stats::lm)
> mycall
stats::lm(Y ~ x)
> eval(mycall, list(Y=rnorm(5),x=1:5))

Call:
stats::lm(formula = Y ~ x)

Coefficients:
(Intercept)            x  
    0.07430      0.02981  


On Apr 24, 2013, at 11:29 , Patrick Burns wrote:

> Here is an example problem:
> 
> > mycall <- expression(lm(Y ~ x))[[1]]
> > mycall
> lm(Y ~ x)
> > newname <- "stats::lm"
> 
> > desiredResult
> stats::lm(Y ~ x)
> 
> I've solved the problem in the kludgy way of
> deparsing, fixing the string and then parsing.
> 
> I like Duncan's third method, but it seems like
> it assumes the solution.  Moving functions around
> is unappetizing for my use -- this is for testing
> and keeping things as faithful to real use is a
> good thing.
> 
> Pat

-- 
Peter Dalgaard, Professor
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From h.wickham at gmail.com  Wed Apr 24 15:02:41 2013
From: h.wickham at gmail.com (Hadley Wickham)
Date: Wed, 24 Apr 2013 08:02:41 -0500
Subject: [Rd] as.name and namespaces
In-Reply-To: <5177A607.10706@pburns.seanet.com>
References: <5176C393.9090802@pburns.seanet.com>
	<3F6D53EB-1C02-42B4-AD2D-085D9E9E94C3@gmail.com>
	<5176E65B.50500@pburns.seanet.com> <5176EC94.3060607@gmail.com>
	<5177A607.10706@pburns.seanet.com>
Message-ID: <CABdHhvFBwPTpKL-Ry8Vy47ycnsJngjfF_bOi_H8nt+D4kheOQQ@mail.gmail.com>

On Wed, Apr 24, 2013 at 4:29 AM, Patrick Burns <pburns at pburns.seanet.com> wrote:
> Here is an example problem:
>
>> mycall <- expression(lm(Y ~ x))[[1]]
>> mycall
> lm(Y ~ x)
>> newname <- "stats::lm"
>
>> desiredResult
> stats::lm(Y ~ x)
>
> I've solved the problem in the kludgy way of
> deparsing, fixing the string and then parsing.

I'm working on a comprehensive write up of computing on the language
at the moment. It's still a bit rough, but you might find
https://github.com/hadley/devtools/wiki/Expressions#structure-of-expressions
and https://github.com/hadley/devtools/wiki/Expressions#calls to be
useful.

Hadley

--
Chief Scientist, RStudio
http://had.co.nz/


From f.harrell at vanderbilt.edu  Wed Apr 24 15:59:25 2013
From: f.harrell at vanderbilt.edu (Frank Harrell)
Date: Wed, 24 Apr 2013 06:59:25 -0700 (PDT)
Subject: [Rd] Solved and Question: Problem with S3 method dispatch and
	NAMESPACE
In-Reply-To: <1366773758314-4665179.post@n4.nabble.com>
References: <1366773758314-4665179.post@n4.nabble.com>
Message-ID: <1366811965136-4665216.post@n4.nabble.com>

I found that package quantreg has created a new generic for latex() [I wish
it hadn't; this has been a generic in Hmisc for almost 2 decades].  When I
require(quantreg) after loading rms, latex(anova.rms object) dispatches
latex.default, but everything is fine if I don't load quantreg.  rms has
import(Hmisc) in NAMESPACE and is loaded before quantreg, hence the
conflict.  How do I make the generic from Hmisc take precedence?
Thanks
Frank

Frank Harrell wrote
> I have updated the rms package to extensively use NAMESPACE.  I cannot get
> certain S3 methods to dispatch.  For example I have in NAMESPACE
> 
> S3method(anova, rms)
> S3method(latex, anova.rms)
> 
> anova.rms produces an object of class "anova.rms" and there is a
> latex.anova.rms function in rms.  But when I do latex(anova(fit)) I get an
> invocation of latex.default.
> 
> I have tried using "anova.rms" and `anova.rms` in S3method() to no avail.
> 
> Any help appreciated.  I'm using R 2.15.3
> Frank





-----
Frank Harrell
Department of Biostatistics, Vanderbilt University
--
View this message in context: http://r.789695.n4.nabble.com/Problem-with-S3-method-dispatch-and-NAMESPACE-tp4665179p4665216.html
Sent from the R devel mailing list archive at Nabble.com.


From pdalgd at gmail.com  Wed Apr 24 16:20:39 2013
From: pdalgd at gmail.com (peter dalgaard)
Date: Wed, 24 Apr 2013 16:20:39 +0200
Subject: [Rd] Solved and Question: Problem with S3 method dispatch and
	NAMESPACE
In-Reply-To: <1366811965136-4665216.post@n4.nabble.com>
References: <1366773758314-4665179.post@n4.nabble.com>
	<1366811965136-4665216.post@n4.nabble.com>
Message-ID: <86DC776C-6D88-4A3D-9557-98D50E340CCE@gmail.com>


On Apr 24, 2013, at 15:59 , Frank Harrell wrote:

> I found that package quantreg has created a new generic for latex() [I wish
> it hadn't; this has been a generic in Hmisc for almost 2 decades].  When I
> require(quantreg) after loading rms, latex(anova.rms object) dispatches
> latex.default, but everything is fine if I don't load quantreg.  rms has
> import(Hmisc) in NAMESPACE and is loaded before quantreg, hence the
> conflict.  How do I make the generic from Hmisc take precedence?


library(quantreg, pos=x) with suitably large x is one idea.

> Thanks
> Frank
> 
> Frank Harrell wrote
>> I have updated the rms package to extensively use NAMESPACE.  I cannot get
>> certain S3 methods to dispatch.  For example I have in NAMESPACE
>> 
>> S3method(anova, rms)
>> S3method(latex, anova.rms)
>> 
>> anova.rms produces an object of class "anova.rms" and there is a
>> latex.anova.rms function in rms.  But when I do latex(anova(fit)) I get an
>> invocation of latex.default.
>> 
>> I have tried using "anova.rms" and `anova.rms` in S3method() to no avail.
>> 
>> Any help appreciated.  I'm using R 2.15.3
>> Frank
> 
> 
> 
> 
> 
> -----
> Frank Harrell
> Department of Biostatistics, Vanderbilt University
> --
> View this message in context: http://r.789695.n4.nabble.com/Problem-with-S3-method-dispatch-and-NAMESPACE-tp4665179p4665216.html
> Sent from the R devel mailing list archive at Nabble.com.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From f.harrell at vanderbilt.edu  Wed Apr 24 17:00:59 2013
From: f.harrell at vanderbilt.edu (Frank Harrell)
Date: Wed, 24 Apr 2013 08:00:59 -0700 (PDT)
Subject: [Rd] Solved and Question: Problem with S3 method dispatch and
 NAMESPACE
In-Reply-To: <86DC776C-6D88-4A3D-9557-98D50E340CCE@gmail.com>
References: <1366773758314-4665179.post@n4.nabble.com>
	<1366811965136-4665216.post@n4.nabble.com>
	<86DC776C-6D88-4A3D-9557-98D50E340CCE@gmail.com>
Message-ID: <1366815659704-4665226.post@n4.nabble.com>

Thank you very much Peter.  That did the trick.
Frank

Peter Dalgaard-2 wrote
> On Apr 24, 2013, at 15:59 , Frank Harrell wrote:
> 
>> I found that package quantreg has created a new generic for latex() [I
>> wish
>> it hadn't; this has been a generic in Hmisc for almost 2 decades].  When
>> I
>> require(quantreg) after loading rms, latex(anova.rms object) dispatches
>> latex.default, but everything is fine if I don't load quantreg.  rms has
>> import(Hmisc) in NAMESPACE and is loaded before quantreg, hence the
>> conflict.  How do I make the generic from Hmisc take precedence?
> 
> 
> library(quantreg, pos=x) with suitably large x is one idea.
> 
>> Thanks
>> Frank
>> 
>> Frank Harrell wrote
>>> I have updated the rms package to extensively use NAMESPACE.  I cannot
>>> get
>>> certain S3 methods to dispatch.  For example I have in NAMESPACE
>>> 
>>> S3method(anova, rms)
>>> S3method(latex, anova.rms)
>>> 
>>> anova.rms produces an object of class "anova.rms" and there is a
>>> latex.anova.rms function in rms.  But when I do latex(anova(fit)) I get
>>> an
>>> invocation of latex.default.
>>> 
>>> I have tried using "anova.rms" and `anova.rms` in S3method() to no
>>> avail.
>>> 
>>> Any help appreciated.  I'm using R 2.15.3
>>> Frank
>> 
>> 
>> 
>> 
>> 
>> -----
>> Frank Harrell
>> Department of Biostatistics, Vanderbilt University
>> --
>> View this message in context:
>> http://r.789695.n4.nabble.com/Problem-with-S3-method-dispatch-and-NAMESPACE-tp4665179p4665216.html
>> Sent from the R devel mailing list archive at Nabble.com.
>> 
>> ______________________________________________
>> 

> R-devel@

>  mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> -- 
> Peter Dalgaard, Professor
> Center for Statistics, Copenhagen Business School
> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
> Phone: (+45)38153501
> Email: 

> pd.mes@

>   Priv: 

> PDalgd@

> 
> ______________________________________________

> R-devel@

>  mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel





-----
Frank Harrell
Department of Biostatistics, Vanderbilt University
--
View this message in context: http://r.789695.n4.nabble.com/Problem-with-S3-method-dispatch-and-NAMESPACE-tp4665179p4665226.html
Sent from the R devel mailing list archive at Nabble.com.


From hpages at fhcrc.org  Wed Apr 24 17:39:49 2013
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Wed, 24 Apr 2013 08:39:49 -0700
Subject: [Rd] about the 'length' arg of vector()
In-Reply-To: <20855.36713.442488.260920@stat.math.ethz.ch>
References: <51771720.7020404@fhcrc.org>
	<20855.36713.442488.260920@stat.math.ethz.ch>
Message-ID: <5177FCC5.20006@fhcrc.org>

On 04/24/2013 12:53 AM, Martin Maechler wrote:
>>>>>> Herv? Pag?s <hpages at fhcrc.org>
>>>>>>      on Tue, 23 Apr 2013 16:20:00 -0700 writes:
>
>      > Hi, In the man page for vector():
>
>      >    length: A non-negative integer specifying the desired
>      > length.  Double values will be coerced to integer:
>      > supplying an argument of length other than one is an
>      > error.
>
>      > Since long vectors are supported, it doesn't seem to be
>      > true anymore that "double values will be coerced to
>      > integer":
>
>      >> bigraw <- vector("raw", 3e9) length(bigraw)
>      >    [1] 3e+09
>      >> storage.mode(length(bigraw))
>      >    [1] "double"
>
>      > At least not always...
>
> Indeed.  Thank you, Herve!
> Change committed to the documentation.

Great. Thanks!

H.

>
> Martin Maechler,
> ETH Zurich
>
>
>      > Thanks, H.
>      > --
>      > Herv? Pag?s
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From maechler at stat.math.ethz.ch  Wed Apr 24 17:41:06 2013
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 24 Apr 2013 17:41:06 +0200
Subject: [Rd] multiple issues with is.unsorted()
In-Reply-To: <20855.42499.123379.361911@stat.math.ethz.ch>
References: <51777711.5020507@fhcrc.org>
	<20855.42499.123379.361911@stat.math.ethz.ch>
Message-ID: <20855.64786.289442.27013@stat.math.ethz.ch>

More comments .. see inline

>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Wed, 24 Apr 2013 11:29:39 +0200 writes:

    > Dear Herve,
>>>>> Herv? Pag?s <hpages at fhcrc.org>
>>>>> on Tue, 23 Apr 2013 23:09:21 -0700 writes:

    >> Hi, In the man page for is.unsorted():

    >> Value:

    >> A length-one logical value.  All objects of length 0 or 1
    >> are sorted: the result will be ?NA? for objects of length
    >> 2 or more except for atomic vectors and objects with a
    >> class (where the ?>=? or ?>? method is used to compare
    >> ?x[i]? with ?x[i-1]? for ?i? in ?2:length(x)?).

    >> This contains many incorrect statements:

    >>> length(NA)
    >> [1] 1
    >>> is.unsorted(NA)
    >> [1] NA
    >>> length(list(NA))
    >> [1] 1
    >>> is.unsorted(list(NA))
    >> [1] NA

    >> => Contradicts "all objects of length 0 or 1 are sorted".

Ok.  I really think we should change the above.
If NA is for a missing number, it still cannot be unsorted if it
is of length one.

--> the above will give FALSE  "real soon now".

    >>> is.unsorted(raw(2))
    >> Error in is.unsorted(raw(2)) : unimplemented type 'raw'
    >> in 'isUnsorted'

    >> => Doesn't agree with the doc (unless "except for atomic
    >> vectors" means "it might fail for atomic vectors").

Well, the doc says about 'x'
|  \item{x}{an \R object with a class or a numeric, complex, character or
|    logical vector.}
so strictly, is.unsorted() is not to be used on raw vectors.

However I think you have a point:
Raw vectors didn't exist when  is.unsorted()  was
invented, so where not considered back then.
Originally,  raw vectors were really almost only there for
storage, i.e. basically read and write, but now we have
as '<' , '<=' '=='  etc  working well for raw() ,
we could allow  is.unsorted() to work, too.

Note however, that if you try to sort(<raw>) you also always get
an error about sort() not being implemented for raw(),...
something we could arguably reconsider, as we admitted the 
relational operators (< <= == >= >  != ) to work.
{{anyone donating patches to R-devel for sort()ing raw ?}}


    >>> setClass("A", representation(aa="integer")) 
    >>> new("A", aa=4:1) 
    >>> length(a)
    >> [1] 1

    >>> is.unsorted(a)
    >> [1] FALSE
    >>  Warning message: In is.na(x) : is.na() applied
    >> to non-(list or vector) of type 'S4'

    >> => Ok, but it's arguable the warning is useful/justified
    >> from a user point of view. The warning *seems* to suggest
    >> that defining an "is.na" method for my objects is
    >> required for is.unsorted() to work properly but the doc
    >> doesn't make this clear.

you are right.
We are going to improve on this, at least the documentation.


[.................]

The S4 part I've already started addressing in the last reply.
(and we may get back to that.. )

[.................]

Martin


From hpages at fhcrc.org  Wed Apr 24 17:48:51 2013
From: hpages at fhcrc.org (=?UTF-8?B?SGVydsOpIFBhZ8Oocw==?=)
Date: Wed, 24 Apr 2013 08:48:51 -0700
Subject: [Rd] multiple issues with is.unsorted()
In-Reply-To: <20855.42499.123379.361911@stat.math.ethz.ch>
References: <51777711.5020507@fhcrc.org>
	<20855.42499.123379.361911@stat.math.ethz.ch>
Message-ID: <5177FEE3.30409@fhcrc.org>

Hi Martin,

On 04/24/2013 02:29 AM, Martin Maechler wrote:
> Dear Herve,
>
>>>>>> Herv? Pag?s <hpages at fhcrc.org>
>>>>>>      on Tue, 23 Apr 2013 23:09:21 -0700 writes:
>
>      > Hi, In the man page for is.unsorted():
>
>      >    Value:
>
>      >       A length-one logical value.  All objects of length 0
>      > or 1 are sorted: the result will be ?NA? for objects of
>      > length 2 or more except for atomic vectors and objects
>      > with a class (where the ?>=? or ?>? method is used to
>      > compare ?x[i]? with ?x[i-1]? for ?i? in ?2:length(x)?).
>
>      > This contains many incorrect statements:
>
>      >> length(NA)
>      >       [1] 1
>      >> is.unsorted(NA)
>      >       [1] NA
>      >> length(list(NA))
>      >       [1] 1
>      >> is.unsorted(list(NA))
>      >       [1] NA
>
>      > => Contradicts "all objects of length 0 or 1 are sorted".
>
>      >> is.unsorted(raw(2))
>      >       Error in is.unsorted(raw(2)) : unimplemented type
>      > 'raw' in 'isUnsorted'
>
>      > => Doesn't agree with the doc (unless "except for atomic
>      > vectors" means "it might fail for atomic vectors").
>
>      >> setClass("A", representation(aa="integer")) a <- new("A",
>      >> aa=4:1) length(a)
>      >       [1] 1
>
>      >> is.unsorted(a)
>      >       [1] FALSE Warning message: In is.na(x) : is.na()
>      > applied to non-(list or vector) of type 'S4'
>
>      > => Ok, but it's arguable the warning is useful/justified
>      > from a user point of view. The warning *seems* to suggest
>      > that defining an "is.na" method for my objects is required
>      > for is.unsorted() to work properly but the doc doesn't
>      > make this clear.
>
>      > Anyway, let's define one, so the warning goes away:
>
>      >> setMethod("is.na", "A", function(x) is.na(x at aa))
>      >       [1] "is.na"
>
>      > Let's define a "length" method:
>
>      >> setMethod("length", "A", function(x) length(x at aa))
>      >       [1] "length"
>      >> length(a)
>      >       [1] 4
>
>      >> is.unsorted(a)
>      >       [1] FALSE
>
>      > => Is this correct? Hard to know. The doc is not clear
>      > about what should happen for objects of length 2 or more
>      > and with a class but with no ">=" or ">" methods.
>
>      > Let's define "[", ">=", and ">":
>
>      >> setMethod("[", "A", function(x, i, j, ..., drop=TRUE)
>      >> new("A",
>      > aa=x at aa[i])) [1] "["
>      >> rev(a)
>      >       An object of class "A" Slot "aa": [1] 1 2 3 4
>
>      >> setMethod(">=", c("A", "A"), function(e1, e2) {e1 at aa >=
>      >> e2 at aa})
>      >       [1] ">="
>      >> a >= a[3]
>      >       [1] TRUE TRUE TRUE FALSE
>
>      >> setMethod(">", c("A", "A"), function(e1, e2) {e1 at aa >
>      >> e2 at aa})
>      >       [1] ">"
>      >> a > a[3]
>      >       [1] TRUE TRUE FALSE FALSE
>
>      >> is.unsorted(a)
>      >       [1] FALSE
>
>      >> is.unsorted(rev(a))
>      >      [1] FALSE
>
>      > Still not working as expected. So what's required exactly
>      > for making is.unsorted() work on an object "with a class"?
>
> well, read the source code. :-) ;-)
>
> More seriously: On another hidden help page, you find
>
>    \code{.gt} and \code{.gtn} are callbacks from \code{\link{rank}} and
>    \code{\link{is.unsorted}} used for classed objects.
>
> In other words, you'd need do define a method for
>   .gtn  for S4 objects in this case.

Ah, good to know.

>
> .... yes, indeed I don't know why this is not at all documented.
>
>
>
>      > BTW, is.unsorted() would be *much* faster, at least on
>      > atomic vectors, without those calls to is.na().
>
> Well, in all R versions, apart from R-devel as of yesterday,
> the source of is.unsorted() has been
>
>    is.unsorted <- function(x, na.rm = FALSE, strictly = FALSE)
>    {
>        if(is.null(x)) return(FALSE)
>        if(!na.rm && any(is.na(x)))## "FIXME" is.na(<large>) is "too slow"
> 	  return(NA)
>        ## else
>        if(na.rm && any(ii <- is.na(x)))
> 	  x <- x[!ii]
>        .Internal(is.unsorted(x, strictly))
>    }
>
> so you see the "FIXME".
>
> In R-devel  (and probably  R-patched  in the nearer future),
> that line is
>
>        if(!na.rm && anyMissing(x))
>
> so there's no slow code anymore, at least not for the default
> case of  na.rm = FALSE.
>
>
>      > The C code
>      > could check for NAs, without having to do this as a first
>      > pass on the full vector like it is the case with the
>      > current implementation. If the vector if unsorted, the C
>      > code is typically able to bail out early so the speed-up
>      > will typically be 10000x or more if the vector as millions
>      > of elements.
>
> you are right (but again: the most important case na.rm=FALSE
>      case has been "solved" already I'd say4),
> but you know well that we do gratefully accept good patches to
> the R sources.

Will do. Thanks!

H.

>
>
>      > Thanks, H.
>
>      >> sessionInfo()
>      > R version 3.0.0 (2013-04-03) Platform:
>      > x86_64-unknown-linux-gnu (64-bit)
>
>      > locale: [1] LC_CTYPE=en_US.UTF-8 LC_NUMERIC=C [3]
>      > LC_TIME=en_US.UTF-8 LC_COLLATE=en_US.UTF-8 [5]
>      > LC_MONETARY=en_US.UTF-8 LC_MESSAGES=en_US.UTF-8 [7]
>      > LC_PAPER=C LC_NAME=C [9] LC_ADDRESS=C LC_TELEPHONE=C [11]
>      > LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
>      > attached base packages: [1] stats graphics grDevices utils
>      > datasets methods base
>
>      > loaded via a namespace (and not attached): [1] tools_3.0.0
>
>      > --
>      > Herv? Pag?s
>
>      > Program in Computational Biology Division of Public Health
>      > Sciences Fred Hutchinson Cancer Research Center 1100
>      > Fairview Ave. N, M1-B514 P.O. Box 19024 Seattle, WA
>      > 98109-1024
>
>      > E-mail: hpages at fhcrc.org Phone: (206) 667-5791 Fax: (206)
>      > 667-1319
>
>      > ______________________________________________
>      > R-devel at r-project.org mailing list
>      > https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From pdalgd at gmail.com  Wed Apr 24 18:02:46 2013
From: pdalgd at gmail.com (peter dalgaard)
Date: Wed, 24 Apr 2013 18:02:46 +0200
Subject: [Rd] is.vector(as.vector(x, m), m) not always TRUE
In-Reply-To: <6BC93B8B-183D-47BB-9910-C14418B108DE@gmail.com>
References: <51771DDA.3040403@fhcrc.org>
	<6BC93B8B-183D-47BB-9910-C14418B108DE@gmail.com>
Message-ID: <CD57D592-B6D0-42F4-B320-22981B642407@gmail.com>

This is now fixed in R-devel (never actually bit anyone, did it?)

-pd

On Apr 24, 2013, at 08:11 , peter dalgaard wrote:

>>> 
>>> is.vector(as.vector("a", "name"), "name")
>> [1] FALSE
>> 
>> Mmmh, the default method itself doesn't seem to follow its own
>> conventions :-/
>> 
> 
> Looks like there should be a straightforward fix, since
> 
>> is.vector(as.vector("a", "name"), "symbol")
> [1] TRUE
> 
> so it is just a matter of implementing "name" as synomyous with "symbol".

-- 
Peter Dalgaard, Professor
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From wdunlap at tibco.com  Wed Apr 24 18:13:33 2013
From: wdunlap at tibco.com (William Dunlap)
Date: Wed, 24 Apr 2013 16:13:33 +0000
Subject: [Rd] as.name and namespaces
In-Reply-To: <5177A607.10706@pburns.seanet.com>
References: <5176C393.9090802@pburns.seanet.com>
	<3F6D53EB-1C02-42B4-AD2D-085D9E9E94C3@gmail.com>
	<5176E65B.50500@pburns.seanet.com> <5176EC94.3060607@gmail.com>
	<5177A607.10706@pburns.seanet.com>
Message-ID: <E66794E69CFDE04D9A70842786030B931C2DD9DF@PA-MBX01.na.tibco.com>

Hi Pat,

You could use substitute(), 
  > mycall <- quote(list(lm(Y ~ x1), lm(Y ~ x2)))
  > do.call("substitute", list(mycall, list(lm=quote(stats::lm))))
  list(stats::lm(Y ~ x1), stats::lm(Y ~ x2))
The do.call is necessary because substitute() does not evaluate
its first argument and we want 'mycall' evaluated to become
the call to list(...) before substitute works on it.

substitute replaces all instances of a name in an expression.
bquote lets you be more selective (only names in .() get replaced):
  > mycall2 <- quote(list(lm(Y ~ x1), .(lm)(Y ~ x2)))
  > do.call("bquote", list(mycall2, list(lm=quote(stats::lm), list=quote(base::list))))
  list(lm(Y ~ x1), stats::lm(Y ~ x2))
   
S+'s substitute() has an evaluate=FALSE/TRUE argument to control
whether its first argument is evaluated thus letting you avoid  do.call():
  S+>  mycall <- quote(list(lm(Y ~ x1), lm(Y ~ x2)))
  S+> substitute(mycall, list(lm=quote(stats::lm)), evaluate=TRUE)
  list(stats::lm(Y ~ x1), stats::lm(Y ~ x2))

It is much harder if you want to find and replace expressions more general
than name, e.g., changing "stats::lm" to "lm" or "log(x+1)" to "logp1(x)" .
package::codetools and package::compiler might help.  I have used rapply()
in S+ for this sort of thing but R's rapply() does not work on functions:
  S+> f <- function(x, y) exp(log(x+1) + log(abs(y)+1) + log(z))
  S+> fNew <- rapply(f, how="replace", classes="call",
       function(e) {
         if (identical(e[[1]], quote(log)) && is.call(logArg <- e[[2]])) {
            if (identical(logArg[[1]], quote(`+`)) && identical(logArg[[3]], 1)) {
               e <- call("logp1", logArg[[2]])
            }
         }
         e
       })
  S+> fNew
  function(x, y)
  exp(logp1(x) + logp1(abs(y)) + log(z))
The is pretty ugly code but it did help us quickly install optimizations in
a large mass of code.

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com


> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf
> Of Patrick Burns
> Sent: Wednesday, April 24, 2013 2:30 AM
> To: Duncan Murdoch
> Cc: r-devel
> Subject: Re: [Rd] as.name and namespaces
> 
> Here is an example problem:
> 
>  > mycall <- expression(lm(Y ~ x))[[1]]
>  > mycall
> lm(Y ~ x)
>  > newname <- "stats::lm"
> 
>  > desiredResult
> stats::lm(Y ~ x)
> 
> I've solved the problem in the kludgy way of
> deparsing, fixing the string and then parsing.
> 
> I like Duncan's third method, but it seems like
> it assumes the solution.  Moving functions around
> is unappetizing for my use -- this is for testing
> and keeping things as faithful to real use is a
> good thing.
> 
> Pat
> 
> 
> On 23/04/2013 21:18, Duncan Murdoch wrote:
> > On 13-04-23 3:51 PM, Patrick Burns wrote:
> >> Okay, that's a good reason why it shouldn't.
> >>
> >> Why it should is that I want to substitute
> >> the first element of a call to be a function
> >> including the namespace.
> >
> > Three ways:
> >
> > 1.  Assign the function from the namespace locally, then call the local
> > one.
> > 2.  Import the function in your NAMESPACE (if you know the name in
> > advance).
> > 3.  Construct an expression involving ::, and substitute that in.
> >
> > For example:
> >
> > substitute(foo(x), list(foo=quote(baz::bar)))
> >
> > Duncan Murdoch
> >
> >>
> >> Pat
> >>
> >>
> >> On 23/04/2013 18:32, peter dalgaard wrote:
> >>>
> >>> On Apr 23, 2013, at 19:23 , Patrick Burns wrote:
> >>>
> >>>> 'as.name' doesn't recognize a name with
> >>>> its namespace extension as a name:
> >>>>
> >>>>> as.name("lm")
> >>>> lm
> >>>>> as.name("stats::lm")
> >>>> `stats::lm`
> >>>>> as.name("stats:::lm")
> >>>> `stats:::lm`
> >>>>
> >>>>
> >>>> Is there a reason why it shouldn't?
> >>>
> >>> Any reason why it should? :: and ::: are operators. foo$bar is not
> >>> the same as `foo$bar` either.
> >>>
> >>
> >
> >
> 
> --
> Patrick Burns
> pburns at pburns.seanet.com
> twitter: @burnsstat @portfolioprobe
> http://www.portfolioprobe.com/blog
> http://www.burns-stat.com
> (home of:
>   'Impatient R'
>   'The R Inferno'
>   'Tao Te Programming')
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From wdunlap at tibco.com  Wed Apr 24 18:27:35 2013
From: wdunlap at tibco.com (William Dunlap)
Date: Wed, 24 Apr 2013 16:27:35 +0000
Subject: [Rd] multiple issues with is.unsorted()
In-Reply-To: <20855.64786.289442.27013@stat.math.ethz.ch>
References: <51777711.5020507@fhcrc.org>
	<20855.42499.123379.361911@stat.math.ethz.ch>
	<20855.64786.289442.27013@stat.math.ethz.ch>
Message-ID: <E66794E69CFDE04D9A70842786030B931C2DDA1A@PA-MBX01.na.tibco.com>

>    >>> is.unsorted(NA)
>    >> [1] NA
>    >> => Contradicts "all objects of length 0 or 1 are sorted".
>
> Ok.  I really think we should change the above.
> If NA is for a missing number, it still cannot be unsorted if it
> is of length one.
> 
> --> the above will give FALSE  "real soon now".

It depends what you are using the result of is.unsorted() for.  If you want
to know if you can save time by not calling x<-sort(x)  then is.unsorted(NA)
should not say that NA is sorted, as sort(NA) has length 0.

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com


> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf
> Of Martin Maechler
> Sent: Wednesday, April 24, 2013 8:41 AM
> To: Herv? Pag?s; R-devel at stat.math.ethz.ch
> Cc: Martin Maechler
> Subject: Re: [Rd] multiple issues with is.unsorted()
> 
> More comments .. see inline
> 
> >>>>> Martin Maechler <maechler at stat.math.ethz.ch>
> >>>>>     on Wed, 24 Apr 2013 11:29:39 +0200 writes:
> 
>     > Dear Herve,
> >>>>> Herv? Pag?s <hpages at fhcrc.org>
> >>>>> on Tue, 23 Apr 2013 23:09:21 -0700 writes:
> 
>     >> Hi, In the man page for is.unsorted():
> 
>     >> Value:
> 
>     >> A length-one logical value.  All objects of length 0 or 1
>     >> are sorted: the result will be ?NA? for objects of length
>     >> 2 or more except for atomic vectors and objects with a
>     >> class (where the ?>=? or ?>? method is used to compare
>     >> ?x[i]? with ?x[i-1]? for ?i? in ?2:length(x)?).
> 
>     >> This contains many incorrect statements:
> 
>     >>> length(NA)
>     >> [1] 1
>     >>> is.unsorted(NA)
>     >> [1] NA
>     >>> length(list(NA))
>     >> [1] 1
>     >>> is.unsorted(list(NA))
>     >> [1] NA
> 
>     >> => Contradicts "all objects of length 0 or 1 are sorted".
> 
> Ok.  I really think we should change the above.
> If NA is for a missing number, it still cannot be unsorted if it
> is of length one.
> 
> --> the above will give FALSE  "real soon now".
> 
>     >>> is.unsorted(raw(2))
>     >> Error in is.unsorted(raw(2)) : unimplemented type 'raw'
>     >> in 'isUnsorted'
> 
>     >> => Doesn't agree with the doc (unless "except for atomic
>     >> vectors" means "it might fail for atomic vectors").
> 
> Well, the doc says about 'x'
> |  \item{x}{an \R object with a class or a numeric, complex, character or
> |    logical vector.}
> so strictly, is.unsorted() is not to be used on raw vectors.
> 
> However I think you have a point:
> Raw vectors didn't exist when  is.unsorted()  was
> invented, so where not considered back then.
> Originally,  raw vectors were really almost only there for
> storage, i.e. basically read and write, but now we have
> as '<' , '<=' '=='  etc  working well for raw() ,
> we could allow  is.unsorted() to work, too.
> 
> Note however, that if you try to sort(<raw>) you also always get
> an error about sort() not being implemented for raw(),...
> something we could arguably reconsider, as we admitted the
> relational operators (< <= == >= >  != ) to work.
> {{anyone donating patches to R-devel for sort()ing raw ?}}
> 
> 
>     >>> setClass("A", representation(aa="integer"))
>     >>> new("A", aa=4:1)
>     >>> length(a)
>     >> [1] 1
> 
>     >>> is.unsorted(a)
>     >> [1] FALSE
>     >>  Warning message: In is.na(x) : is.na() applied
>     >> to non-(list or vector) of type 'S4'
> 
>     >> => Ok, but it's arguable the warning is useful/justified
>     >> from a user point of view. The warning *seems* to suggest
>     >> that defining an "is.na" method for my objects is
>     >> required for is.unsorted() to work properly but the doc
>     >> doesn't make this clear.
> 
> you are right.
> We are going to improve on this, at least the documentation.
> 
> 
> [.................]
> 
> The S4 part I've already started addressing in the last reply.
> (and we may get back to that.. )
> 
> [.................]
> 
> Martin
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

From David.Pleydell at antilles.inra.fr  Wed Apr 24 14:59:02 2013
From: David.Pleydell at antilles.inra.fr (dpleydell)
Date: Wed, 24 Apr 2013 08:59:02 -0400
Subject: [Rd] Verbose output from R CMD check
In-Reply-To: <ADD5064D-988D-4F77-983F-032A6EFD6059@r-project.org>
References: <51769FFE.2020604@antilles.inra.fr>
	<22AF9B56-93D2-44C3-9879-136AFC61C5A7@r-project.org>
	<5176BA38.1040407@antilles.inra.fr>
	<ADD5064D-988D-4F77-983F-032A6EFD6059@r-project.org>
Message-ID: <5177D716.10204@antilles.inra.fr>

Many thanks for these comments Simon, that really helps me a lot!

warm regards
David




On 23/04/13 19:30, Simon Urbanek wrote:
> On Apr 23, 2013, at 12:43 PM, dpleydell wrote:
>
>> Many thanks Simon for your response
>>>> Identifying the source of the message is a non-trivial problem because there are a large number of calls to printf and fprintf etc in several thousands of lines of code spread over many different *.c files.
>>>>
>>>>
>>> There should be none, so apparently you have broken the rules quite a lot ;). This is not a new rule, R just got better at identifying the transgressions. Number of lines in your code is quite irrelevant - that's why there is grep and the search function in editors.
>>>
>> Well, that wouldn't be the first time I've broken rules ;0)
>>
>> But, how bad could the consequences of my misbehaviour be here?  Are we talking about crashing R or just messing the output a little?
>>
> We're not talking life and death here ;) - yes, frustrated users because of messed up output is the main danger here. Also the behavior changes by GUI and platform, so throw in inconsistency charge as well.
>
> To be precise, there are two issues: a) the output on stdout/stderr is not necessarily visible (e.g. the Windows GUI discards it) and it is separate from the console (e.g. sink() doesn't work on it). More importantly b) it messes up the use of R in streaming, i.e. uses where you are processing input on stdin and streaming output on stdout -- it will break the output. This is most frustrating because the user has no way to control this behavior other than deleting the offending package.
>
>
>> In Writing R Extensions (current on-line version) the worst they say about printf is
>>
>> [QUOTE]
>> The most useful function for printing from a C routine compiled into R is Rprintf. This is used in exactly the same way as printf, but is guaranteed to write to R's output (which might be a GUI console rather than a file, and can be re-directed by sink).
>> [UNQUOTE]
>>
>> and both printf and fprintf are used in section 8.2.2 in the rtest.c example. Also, the manual does not say explicitly what fprintf should be replaced with.
>>
> fprintf() is ok as long as you don't use it with stdout/stderr. You can use it for files, no problem there.
>
>
>> Come to think of it... my package performs MCMC and uses fprintf to write samples to an output file. I have noticed that once in each nth blue-moon (for large n) a single line of output has been dropped or scrambled. More frequently, the updates of the output file seem to lag behind the progress of the algorithm's principal loop - for example, file size becomes non-zero much later than I expect.
> Typically, I/O is buffered, so the file is not necessarily updated after you use fprintf(). By default, it will get updated only after the output buffer has been filled. You can use fflush() to flush the output buffer to disk immediately (alternatively you can mark the stream as unbuffered).
>
>
>> I never understood this behaviour or saw how to rectify it. Perhaps replacing fprintf with something else could "guarantee" the end of this undesirable behaviour? Great!
>>
>> Is there a "safe" way to re-write the following?
>>
>> fprintf(fMCMCout, "%d %e %e ", iteration, posteriorLoglik, parameter);
>> if (numberRandomEffects > 1) {
>>    for (k=0; k < numberRandomEffects; k++) {
>>      fprintf(fMCMCout, "%e ", randomEffects[k]);
>> }
>> fprintf(fMCMCout,"\n");
>>
>> This is really a question of 2 parts
>> 1) what is the best replacement of fprintf in the above?
> If MCMCout is a file, the above is fine.
>
>
>> and
>> 2) Writing R Extensions says "It is wise to write complete lines (including the "\n") before returning to R.", so is it legal to defer \n as in the example above?
>>
> Yes, sure.
>
> Cheers,
> Simon
>
>
>> many thanks
>> David
>>
>>
>>
>>
>>
>> -- 
>> David Pleydell,
>> INRA,
>> UMR-1351 CMAEE,
>> Domaine Duclos,
>> Prise D'eau,
>> 97122 Petit Bourg,
>> Guadeloupe
>>
>> dpleydell at antilles.inra.fr
>> pleydell at cirad.fr
>>
>> Tel +33 5 90 25 54 42
>> Fax +33 5 90 94 03 96
>>
>


-- 
David Pleydell,
INRA,
UMR-1351 CMAEE,
Domaine Duclos,
Prise D'eau,
97122 Petit Bourg,
Guadeloupe
dpleydell at antilles.inra.fr
pleydell at cirad.fr
Tel +33 5 90 25 54 42
Fax +33 5 90 94 03 96


From hpages at fhcrc.org  Wed Apr 24 21:00:39 2013
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Wed, 24 Apr 2013 12:00:39 -0700
Subject: [Rd] multiple issues with is.unsorted()
In-Reply-To: <E66794E69CFDE04D9A70842786030B931C2DDA1A@PA-MBX01.na.tibco.com>
References: <51777711.5020507@fhcrc.org>
	<20855.42499.123379.361911@stat.math.ethz.ch>
	<20855.64786.289442.27013@stat.math.ethz.ch>
	<E66794E69CFDE04D9A70842786030B931C2DDA1A@PA-MBX01.na.tibco.com>
Message-ID: <51782BD7.6030407@fhcrc.org>

Hi,

On 04/24/2013 09:27 AM, William Dunlap wrote:
>>     >>> is.unsorted(NA)
>>     >> [1] NA
>>     >> => Contradicts "all objects of length 0 or 1 are sorted".
>>
>> Ok.  I really think we should change the above.
>> If NA is for a missing number, it still cannot be unsorted if it
>> is of length one.
>>
>> --> the above will give FALSE  "real soon now".
>
> It depends what you are using the result of is.unsorted() for.  If you want
> to know if you can save time by not calling x<-sort(x)  then is.unsorted(NA)
> should not say that NA is sorted, as sort(NA) has length 0.

Glad you mention this. This is related but actually a different issue
which is that by default is.unsorted() and sort() don't treat NAs
consistently: the former keeps them, the latter removes them. So if
you want to use is.unsorted() for deciding whether or not you're going
to call sort() (without specifying 'na.last'), you should do
'is.unsorted( , na.rm=TRUE)'.

This is why IMO 'is.unsorted( , na.rm=TRUE)' is an important use case
and should be as fast as possible.

If you want to keep NAs, you'll have to sort 'x' with either
na.last=TRUE or na.last=FALSE. So it makes a lot of sense that
is.unsorted(x) returns FALSE if x is a single NA, because, in that
case, 'x' doesn't need to be sorted.

Cheers,
H.

>
> Bill Dunlap
> Spotfire, TIBCO Software
> wdunlap tibco.com
>
>
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf
>> Of Martin Maechler
>> Sent: Wednesday, April 24, 2013 8:41 AM
>> To: Herv? Pag?s; R-devel at stat.math.ethz.ch
>> Cc: Martin Maechler
>> Subject: Re: [Rd] multiple issues with is.unsorted()
>>
>> More comments .. see inline
>>
>>>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>>>      on Wed, 24 Apr 2013 11:29:39 +0200 writes:
>>
>>      > Dear Herve,
>>>>>>> Herv? Pag?s <hpages at fhcrc.org>
>>>>>>> on Tue, 23 Apr 2013 23:09:21 -0700 writes:
>>
>>      >> Hi, In the man page for is.unsorted():
>>
>>      >> Value:
>>
>>      >> A length-one logical value.  All objects of length 0 or 1
>>      >> are sorted: the result will be ?NA? for objects of length
>>      >> 2 or more except for atomic vectors and objects with a
>>      >> class (where the ?>=? or ?>? method is used to compare
>>      >> ?x[i]? with ?x[i-1]? for ?i? in ?2:length(x)?).
>>
>>      >> This contains many incorrect statements:
>>
>>      >>> length(NA)
>>      >> [1] 1
>>      >>> is.unsorted(NA)
>>      >> [1] NA
>>      >>> length(list(NA))
>>      >> [1] 1
>>      >>> is.unsorted(list(NA))
>>      >> [1] NA
>>
>>      >> => Contradicts "all objects of length 0 or 1 are sorted".
>>
>> Ok.  I really think we should change the above.
>> If NA is for a missing number, it still cannot be unsorted if it
>> is of length one.
>>
>> --> the above will give FALSE  "real soon now".
>>
>>      >>> is.unsorted(raw(2))
>>      >> Error in is.unsorted(raw(2)) : unimplemented type 'raw'
>>      >> in 'isUnsorted'
>>
>>      >> => Doesn't agree with the doc (unless "except for atomic
>>      >> vectors" means "it might fail for atomic vectors").
>>
>> Well, the doc says about 'x'
>> |  \item{x}{an \R object with a class or a numeric, complex, character or
>> |    logical vector.}
>> so strictly, is.unsorted() is not to be used on raw vectors.
>>
>> However I think you have a point:
>> Raw vectors didn't exist when  is.unsorted()  was
>> invented, so where not considered back then.
>> Originally,  raw vectors were really almost only there for
>> storage, i.e. basically read and write, but now we have
>> as '<' , '<=' '=='  etc  working well for raw() ,
>> we could allow  is.unsorted() to work, too.
>>
>> Note however, that if you try to sort(<raw>) you also always get
>> an error about sort() not being implemented for raw(),...
>> something we could arguably reconsider, as we admitted the
>> relational operators (< <= == >= >  != ) to work.
>> {{anyone donating patches to R-devel for sort()ing raw ?}}
>>
>>
>>      >>> setClass("A", representation(aa="integer"))
>>      >>> new("A", aa=4:1)
>>      >>> length(a)
>>      >> [1] 1
>>
>>      >>> is.unsorted(a)
>>      >> [1] FALSE
>>      >>  Warning message: In is.na(x) : is.na() applied
>>      >> to non-(list or vector) of type 'S4'
>>
>>      >> => Ok, but it's arguable the warning is useful/justified
>>      >> from a user point of view. The warning *seems* to suggest
>>      >> that defining an "is.na" method for my objects is
>>      >> required for is.unsorted() to work properly but the doc
>>      >> doesn't make this clear.
>>
>> you are right.
>> We are going to improve on this, at least the documentation.
>>
>>
>> [.................]
>>
>> The S4 part I've already started addressing in the last reply.
>> (and we may get back to that.. )
>>
>> [.................]
>>
>> Martin
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From hpages at fhcrc.org  Wed Apr 24 21:06:55 2013
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Wed, 24 Apr 2013 12:06:55 -0700
Subject: [Rd] multiple issues with is.unsorted()
In-Reply-To: <51782BD7.6030407@fhcrc.org>
References: <51777711.5020507@fhcrc.org>
	<20855.42499.123379.361911@stat.math.ethz.ch>
	<20855.64786.289442.27013@stat.math.ethz.ch>
	<E66794E69CFDE04D9A70842786030B931C2DDA1A@PA-MBX01.na.tibco.com>
	<51782BD7.6030407@fhcrc.org>
Message-ID: <51782D4F.10706@fhcrc.org>



On 04/24/2013 12:00 PM, Herv? Pag?s wrote:
> Hi,
>
> On 04/24/2013 09:27 AM, William Dunlap wrote:
>>>     >>> is.unsorted(NA)
>>>     >> [1] NA
>>>     >> => Contradicts "all objects of length 0 or 1 are sorted".
>>>
>>> Ok.  I really think we should change the above.
>>> If NA is for a missing number, it still cannot be unsorted if it
>>> is of length one.
>>>
>>> --> the above will give FALSE  "real soon now".
>>
>> It depends what you are using the result of is.unsorted() for.  If you
>> want
>> to know if you can save time by not calling x<-sort(x)  then
>> is.unsorted(NA)
>> should not say that NA is sorted, as sort(NA) has length 0.
>
> Glad you mention this. This is related but actually a different issue
> which is that by default is.unsorted() and sort() don't treat NAs
> consistently: the former keeps them, the latter removes them. So if
> you want to use is.unsorted() for deciding whether or not you're going
> to call sort() (without specifying 'na.last'), you should do
> 'is.unsorted( , na.rm=TRUE)'.
>
> This is why IMO 'is.unsorted( , na.rm=TRUE)' is an important use case
> and should be as fast as possible.
>
> If you want to keep NAs, you'll have to sort 'x' with either
> na.last=TRUE or na.last=FALSE. So it makes a lot of sense that
> is.unsorted(x) returns FALSE if x is a single NA, because, in that
> case, 'x' doesn't need to be sorted.

And I should add that, for that use case (want to keep NAs when
sorting), is.unsorted() is totally useless anyway because it will
return NA if 'x' has length >= 2 and contains NAs :-/

Cheers,
H.

>
> Cheers,
> H.
>
>>
>> Bill Dunlap
>> Spotfire, TIBCO Software
>> wdunlap tibco.com
>>
>>
>>> -----Original Message-----
>>> From: r-devel-bounces at r-project.org
>>> [mailto:r-devel-bounces at r-project.org] On Behalf
>>> Of Martin Maechler
>>> Sent: Wednesday, April 24, 2013 8:41 AM
>>> To: Herv? Pag?s; R-devel at stat.math.ethz.ch
>>> Cc: Martin Maechler
>>> Subject: Re: [Rd] multiple issues with is.unsorted()
>>>
>>> More comments .. see inline
>>>
>>>>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>>>>      on Wed, 24 Apr 2013 11:29:39 +0200 writes:
>>>
>>>      > Dear Herve,
>>>>>>>> Herv? Pag?s <hpages at fhcrc.org>
>>>>>>>> on Tue, 23 Apr 2013 23:09:21 -0700 writes:
>>>
>>>      >> Hi, In the man page for is.unsorted():
>>>
>>>      >> Value:
>>>
>>>      >> A length-one logical value.  All objects of length 0 or 1
>>>      >> are sorted: the result will be ?NA? for objects of length
>>>      >> 2 or more except for atomic vectors and objects with a
>>>      >> class (where the ?>=? or ?>? method is used to compare
>>>      >> ?x[i]? with ?x[i-1]? for ?i? in ?2:length(x)?).
>>>
>>>      >> This contains many incorrect statements:
>>>
>>>      >>> length(NA)
>>>      >> [1] 1
>>>      >>> is.unsorted(NA)
>>>      >> [1] NA
>>>      >>> length(list(NA))
>>>      >> [1] 1
>>>      >>> is.unsorted(list(NA))
>>>      >> [1] NA
>>>
>>>      >> => Contradicts "all objects of length 0 or 1 are sorted".
>>>
>>> Ok.  I really think we should change the above.
>>> If NA is for a missing number, it still cannot be unsorted if it
>>> is of length one.
>>>
>>> --> the above will give FALSE  "real soon now".
>>>
>>>      >>> is.unsorted(raw(2))
>>>      >> Error in is.unsorted(raw(2)) : unimplemented type 'raw'
>>>      >> in 'isUnsorted'
>>>
>>>      >> => Doesn't agree with the doc (unless "except for atomic
>>>      >> vectors" means "it might fail for atomic vectors").
>>>
>>> Well, the doc says about 'x'
>>> |  \item{x}{an \R object with a class or a numeric, complex,
>>> character or
>>> |    logical vector.}
>>> so strictly, is.unsorted() is not to be used on raw vectors.
>>>
>>> However I think you have a point:
>>> Raw vectors didn't exist when  is.unsorted()  was
>>> invented, so where not considered back then.
>>> Originally,  raw vectors were really almost only there for
>>> storage, i.e. basically read and write, but now we have
>>> as '<' , '<=' '=='  etc  working well for raw() ,
>>> we could allow  is.unsorted() to work, too.
>>>
>>> Note however, that if you try to sort(<raw>) you also always get
>>> an error about sort() not being implemented for raw(),...
>>> something we could arguably reconsider, as we admitted the
>>> relational operators (< <= == >= >  != ) to work.
>>> {{anyone donating patches to R-devel for sort()ing raw ?}}
>>>
>>>
>>>      >>> setClass("A", representation(aa="integer"))
>>>      >>> new("A", aa=4:1)
>>>      >>> length(a)
>>>      >> [1] 1
>>>
>>>      >>> is.unsorted(a)
>>>      >> [1] FALSE
>>>      >>  Warning message: In is.na(x) : is.na() applied
>>>      >> to non-(list or vector) of type 'S4'
>>>
>>>      >> => Ok, but it's arguable the warning is useful/justified
>>>      >> from a user point of view. The warning *seems* to suggest
>>>      >> that defining an "is.na" method for my objects is
>>>      >> required for is.unsorted() to work properly but the doc
>>>      >> doesn't make this clear.
>>>
>>> you are right.
>>> We are going to improve on this, at least the documentation.
>>>
>>>
>>> [.................]
>>>
>>> The S4 part I've already started addressing in the last reply.
>>> (and we may get back to that.. )
>>>
>>> [.................]
>>>
>>> Martin
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From hpages at fhcrc.org  Thu Apr 25 01:15:15 2013
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Wed, 24 Apr 2013 16:15:15 -0700
Subject: [Rd] is.vector(as.vector(x, m), m) not always TRUE
In-Reply-To: <CD57D592-B6D0-42F4-B320-22981B642407@gmail.com>
References: <51771DDA.3040403@fhcrc.org>
	<6BC93B8B-183D-47BB-9910-C14418B108DE@gmail.com>
	<CD57D592-B6D0-42F4-B320-22981B642407@gmail.com>
Message-ID: <51786783.1010409@fhcrc.org>

On 04/24/2013 09:02 AM, peter dalgaard wrote:
> This is now fixed in R-devel (never actually bit anyone, did it?)

Thanks for fixing... before someone gets bitten :-)

as.vector() just made it into the BiocGenerics package, and the man
page for BiocGenerics::as.vector redirects the reader to the man page
for base::as.vector for the conventions that writers of methods for
"as.vector" should follow. Having base::as.vector actually follow
those conventions increases the chances that writers of "as.vector"
methods will follow them too, which is good.

Cheers,
H.


>
> -pd
>
> On Apr 24, 2013, at 08:11 , peter dalgaard wrote:
>
>>>>
>>>> is.vector(as.vector("a", "name"), "name")
>>> [1] FALSE
>>>
>>> Mmmh, the default method itself doesn't seem to follow its own
>>> conventions :-/
>>>
>>
>> Looks like there should be a straightforward fix, since
>>
>>> is.vector(as.vector("a", "name"), "symbol")
>> [1] TRUE
>>
>> so it is just a matter of implementing "name" as synomyous with "symbol".
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From hpages at fhcrc.org  Thu Apr 25 02:08:32 2013
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Wed, 24 Apr 2013 17:08:32 -0700
Subject: [Rd] Patch proposal for R style consistency (concerning
	deparse.c)
In-Reply-To: <CANROs4emmr=rGLKWpCQ6z_016mAk7O42=ttA1BLnc9zQ_DTzqQ@mail.gmail.com>
References: <CAErODj85saboM+8SaYKKVVDL6cPeX=LVR=PKwY+FZb2ky_cpBg@mail.gmail.com>
	<5478C197-76AB-481D-A1AA-64DB63D8D122@gmail.com>
	<CAErODj_N+FCjP1zt2H4VHv28o8RDU8sQ-W4qGONkx1gLvC33pg@mail.gmail.com>
	<CANROs4emmr=rGLKWpCQ6z_016mAk7O42=ttA1BLnc9zQ_DTzqQ@mail.gmail.com>
Message-ID: <51787400.7010305@fhcrc.org>

On 04/18/2013 11:41 AM, Yihui Xie wrote:
> I second the change of "} else {".

Me too. Note that print.function() will screw it only if you use
useSource=FALSE:

   > print.function(foo3, useSource=FALSE)
   function ()
   {
     if (FALSE) {
         letters
     }
     else {
         LETTERS
     }
   }

Otherwise, everything is fine:

   > print.function(foo3)
   function()
   {
     if (FALSE) {
         letters  # some comment
     } else {
         LETTERS
     }
   }

I can't see of any reason why useSource=FALSE would screw my nicely
formatted 'if' statement though. This formatting is ugly, unnecessarily
uses 1 more line, and the 'if' statement cannot be copy/pasted into an
interactive session anymore. So, in a way, you could even consider
this is invalid code.

Thanks,
H.

>
> Regards,
> Yihui
> --
> Yihui Xie <xieyihui at gmail.com>
> Phone: 515-294-2465 Web: http://yihui.name
> Department of Statistics, Iowa State University
> 2215 Snedecor Hall, Ames, IA
>
>
> On Thu, Apr 18, 2013 at 11:16 AM, Paul Johnson <pauljohn32 at gmail.com> wrote:
>> OK, I concede that.
>>
>> Now, how about "} else {"
>>
>> I will provide patch that does only that change.
>> ?
>>
>> On Thu, Apr 18, 2013 at 3:05 AM, peter dalgaard <pdalgd at gmail.com> wrote:
>>>
>>> On Apr 18, 2013, at 05:39 , Paul Johnson wrote:
>>>
>>>> 2 & 3. I want to omit space after if and for.   Since if and for are
>>>> functions in R, not keywords, I suggest that there should not be a
>>>> space before the opening parentheses.
>>>
>>> Wrong. They are part of language constructs (and they _are_ keywords, not names, that's why ?for won't work). The function calls are `if`(fee, {foo}, {fie}) and something rebarbative for `for`(....).
>>>
>>> Besides, both constructs are harder to read without the spaces.
>>>
>>> --
>>> Peter Dalgaard, Professor
>>> Center for Statistics, Copenhagen Business School
>>> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
>>> Phone: (+45)38153501
>>> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
>>>
>>
>>
>>
>> --
>> Paul E. Johnson
>> Professor, Political Science      Assoc. Director
>> 1541 Lilac Lane, Room 504      Center for Research Methods
>> University of Kansas                 University of Kansas
>> http://pj.freefaculty.org               http://quant.ku.edu
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From murdoch.duncan at gmail.com  Thu Apr 25 02:45:12 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 24 Apr 2013 20:45:12 -0400
Subject: [Rd] Patch proposal for R style consistency (concerning
	deparse.c)
In-Reply-To: <51787400.7010305@fhcrc.org>
References: <CAErODj85saboM+8SaYKKVVDL6cPeX=LVR=PKwY+FZb2ky_cpBg@mail.gmail.com>
	<5478C197-76AB-481D-A1AA-64DB63D8D122@gmail.com>
	<CAErODj_N+FCjP1zt2H4VHv28o8RDU8sQ-W4qGONkx1gLvC33pg@mail.gmail.com>
	<CANROs4emmr=rGLKWpCQ6z_016mAk7O42=ttA1BLnc9zQ_DTzqQ@mail.gmail.com>
	<51787400.7010305@fhcrc.org>
Message-ID: <51787C98.2030106@gmail.com>

On 13-04-24 8:08 PM, Herv? Pag?s wrote:
> On 04/18/2013 11:41 AM, Yihui Xie wrote:
>> I second the change of "} else {".
>
> Me too. Note that print.function() will screw it only if you use
> useSource=FALSE:
>
>     > print.function(foo3, useSource=FALSE)
>     function ()
>     {
>       if (FALSE) {
>           letters
>       }
>       else {
>           LETTERS
>       }
>     }
>
> Otherwise, everything is fine:
>
>     > print.function(foo3)
>     function()
>     {
>       if (FALSE) {
>           letters  # some comment
>       } else {
>           LETTERS
>       }
>     }
>
> I can't see of any reason why useSource=FALSE would screw my nicely
> formatted 'if' statement though.

You asked it to reformat it, because you didn't like your original 
formatting.  Otherwise you wouldn't have said useSource=FALSE.

This formatting is ugly, unnecessarily
> uses 1 more line, and the 'if' statement cannot be copy/pasted into an
> interactive session anymore. So, in a way, you could even consider
> this is invalid code.

That's nonsense.

Duncan Murdoch

>
> Thanks,
> H.
>
>>
>> Regards,
>> Yihui
>> --
>> Yihui Xie <xieyihui at gmail.com>
>> Phone: 515-294-2465 Web: http://yihui.name
>> Department of Statistics, Iowa State University
>> 2215 Snedecor Hall, Ames, IA
>>
>>
>> On Thu, Apr 18, 2013 at 11:16 AM, Paul Johnson <pauljohn32 at gmail.com> wrote:
>>> OK, I concede that.
>>>
>>> Now, how about "} else {"
>>>
>>> I will provide patch that does only that change.
>>> ?
>>>
>>> On Thu, Apr 18, 2013 at 3:05 AM, peter dalgaard <pdalgd at gmail.com> wrote:
>>>>
>>>> On Apr 18, 2013, at 05:39 , Paul Johnson wrote:
>>>>
>>>>> 2 & 3. I want to omit space after if and for.   Since if and for are
>>>>> functions in R, not keywords, I suggest that there should not be a
>>>>> space before the opening parentheses.
>>>>
>>>> Wrong. They are part of language constructs (and they _are_ keywords, not names, that's why ?for won't work). The function calls are `if`(fee, {foo}, {fie}) and something rebarbative for `for`(....).
>>>>
>>>> Besides, both constructs are harder to read without the spaces.
>>>>
>>>> --
>>>> Peter Dalgaard, Professor
>>>> Center for Statistics, Copenhagen Business School
>>>> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
>>>> Phone: (+45)38153501
>>>> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
>>>>
>>>
>>>
>>>
>>> --
>>> Paul E. Johnson
>>> Professor, Political Science      Assoc. Director
>>> 1541 Lilac Lane, Room 504      Center for Research Methods
>>> University of Kansas                 University of Kansas
>>> http://pj.freefaculty.org               http://quant.ku.edu
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From krishnaiah.ac at gmail.com  Thu Apr 25 07:20:49 2013
From: krishnaiah.ac at gmail.com (Crish..)
Date: Wed, 24 Apr 2013 22:20:49 -0700 (PDT)
Subject: [Rd] Error Message while creation Package
Message-ID: <1366867249505-4665345.post@n4.nabble.com>

Hello Guys,

I wanted to build a new R package from the R code. I installed all the
required software and made all the path settings. 

When i tried running, 
cmd> RCMD check SamplePackageName 

while "Checking R code for possible errors"

i have encountered a note saying: waning in png(file=Output_FileName,
width=840, height=480, unit="px"): partial argument match of 'file' to
'filename'.

I don't have any idea of what this warning is. Any help is really
appreciated.

Thanks




--
View this message in context: http://r.789695.n4.nabble.com/Error-Message-while-creation-Package-tp4665345.html
Sent from the R devel mailing list archive at Nabble.com.


From krishnaiah.ac at gmail.com  Thu Apr 25 07:21:43 2013
From: krishnaiah.ac at gmail.com (Crish..)
Date: Wed, 24 Apr 2013 22:21:43 -0700 (PDT)
Subject: [Rd] Error Message while Package creation
Message-ID: <1366867303824-4665346.post@n4.nabble.com>

Hello Guys,

I wanted to build a new R package from the R code. I installed all the
required software and made all the path settings. 

When i tried running, 
cmd> RCMD check SamplePackageName 

while "Checking R code for possible errors"

i have encountered a note saying: waning in png(file=Output_FileName,
width=840, height=480, unit="px"): partial argument match of 'file' to
'filename'.

I don't have any idea of what this warning is. Any help is really
appreciated.

Thanks




--
View this message in context: http://r.789695.n4.nabble.com/Error-Message-while-Package-creation-tp4665346.html
Sent from the R devel mailing list archive at Nabble.com.


From bhh at xs4all.nl  Thu Apr 25 07:39:10 2013
From: bhh at xs4all.nl (Berend Hasselman)
Date: Thu, 25 Apr 2013 07:39:10 +0200
Subject: [Rd] Error Message while Package creation
In-Reply-To: <1366867303824-4665346.post@n4.nabble.com>
References: <1366867303824-4665346.post@n4.nabble.com>
Message-ID: <496CE7CD-B6D2-4FB0-8B1D-61D1F3320FD2@xs4all.nl>


On 25-04-2013, at 07:21, Crish.. <krishnaiah.ac at gmail.com> wrote:

> Hello Guys,
> 
> I wanted to build a new R package from the R code. I installed all the
> required software and made all the path settings. 
> 
> When i tried running, 
> cmd> RCMD check SamplePackageName 
> 
> while "Checking R code for possible errors"
> 
> i have encountered a note saying: waning in png(file=Output_FileName,
> width=840, height=480, unit="px"): partial argument match of 'file' to
> 'filename'.
> 
> I don't have any idea of what this warning is. Any help is really
> appreciated.


It is exactly what it says. The relevant argument has name "filename" and not file (an abbreviation).
Use filename=Output_FileName.

Berend


From hpages at fhcrc.org  Thu Apr 25 09:09:09 2013
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Thu, 25 Apr 2013 00:09:09 -0700
Subject: [Rd] Patch proposal for R style consistency (concerning
	deparse.c)
In-Reply-To: <51787C98.2030106@gmail.com>
References: <CAErODj85saboM+8SaYKKVVDL6cPeX=LVR=PKwY+FZb2ky_cpBg@mail.gmail.com>
	<5478C197-76AB-481D-A1AA-64DB63D8D122@gmail.com>
	<CAErODj_N+FCjP1zt2H4VHv28o8RDU8sQ-W4qGONkx1gLvC33pg@mail.gmail.com>
	<CANROs4emmr=rGLKWpCQ6z_016mAk7O42=ttA1BLnc9zQ_DTzqQ@mail.gmail.com>
	<51787400.7010305@fhcrc.org> <51787C98.2030106@gmail.com>
Message-ID: <5178D695.30009@fhcrc.org>

On 04/24/2013 05:45 PM, Duncan Murdoch wrote:
> On 13-04-24 8:08 PM, Herv? Pag?s wrote:
>> On 04/18/2013 11:41 AM, Yihui Xie wrote:
>>> I second the change of "} else {".
>>
>> Me too. Note that print.function() will screw it only if you use
>> useSource=FALSE:
>>
>>     > print.function(foo3, useSource=FALSE)
>>     function ()
>>     {
>>       if (FALSE) {
>>           letters
>>       }
>>       else {
>>           LETTERS
>>       }
>>     }
>>
>> Otherwise, everything is fine:
>>
>>     > print.function(foo3)
>>     function()
>>     {
>>       if (FALSE) {
>>           letters  # some comment
>>       } else {
>>           LETTERS
>>       }
>>     }
>>
>> I can't see of any reason why useSource=FALSE would screw my nicely
>> formatted 'if' statement though.
>
> You asked it to reformat it, because you didn't like your original
> formatting.  Otherwise you wouldn't have said useSource=FALSE.

Yes I did like my original formatting. I used useSource=FALSE to show
the ugly formatting it produces. And don't tell me "if you don't like
the formatting it produces then don't use useSource=FALSE" because
unfortunately, at least for me, I get that ugly formatting for base
functions and functions defined in a package in general, even if I
don't use useSource=FALSE (seems like the original code is lost for
those functions).

>
> This formatting is ugly, unnecessarily
>> uses 1 more line, and the 'if' statement cannot be copy/pasted into an
>> interactive session anymore. So, in a way, you could even consider
>> this is invalid code.
>
> That's nonsense.

What? The formatting produced by useSource=FALSE? Yes.

H.

>
> Duncan Murdoch
>
>>
>> Thanks,
>> H.
>>
>>>
>>> Regards,
>>> Yihui
>>> --
>>> Yihui Xie <xieyihui at gmail.com>
>>> Phone: 515-294-2465 Web: http://yihui.name
>>> Department of Statistics, Iowa State University
>>> 2215 Snedecor Hall, Ames, IA
>>>
>>>
>>> On Thu, Apr 18, 2013 at 11:16 AM, Paul Johnson <pauljohn32 at gmail.com>
>>> wrote:
>>>> OK, I concede that.
>>>>
>>>> Now, how about "} else {"
>>>>
>>>> I will provide patch that does only that change.
>>>> ?
>>>>
>>>> On Thu, Apr 18, 2013 at 3:05 AM, peter dalgaard <pdalgd at gmail.com>
>>>> wrote:
>>>>>
>>>>> On Apr 18, 2013, at 05:39 , Paul Johnson wrote:
>>>>>
>>>>>> 2 & 3. I want to omit space after if and for.   Since if and for are
>>>>>> functions in R, not keywords, I suggest that there should not be a
>>>>>> space before the opening parentheses.
>>>>>
>>>>> Wrong. They are part of language constructs (and they _are_
>>>>> keywords, not names, that's why ?for won't work). The function
>>>>> calls are `if`(fee, {foo}, {fie}) and something rebarbative for
>>>>> `for`(....).
>>>>>
>>>>> Besides, both constructs are harder to read without the spaces.
>>>>>
>>>>> --
>>>>> Peter Dalgaard, Professor
>>>>> Center for Statistics, Copenhagen Business School
>>>>> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
>>>>> Phone: (+45)38153501
>>>>> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
>>>>>
>>>>
>>>>
>>>>
>>>> --
>>>> Paul E. Johnson
>>>> Professor, Political Science      Assoc. Director
>>>> 1541 Lilac Lane, Room 504      Center for Research Methods
>>>> University of Kansas                 University of Kansas
>>>> http://pj.freefaculty.org               http://quant.ku.edu
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From amejia at factset.com  Wed Apr 24 19:55:30 2013
From: amejia at factset.com (Adrian Mejia)
Date: Wed, 24 Apr 2013 17:55:30 +0000
Subject: [Rd] dyn.load inside a package in R >= 3.0
Message-ID: <23F5015AB166A946A49A38282DB0C3E2C2B9A4@EXCHMBOXB01.pc.factset.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130424/793b30d6/attachment.pl>

From krishnaiah.ac at gmail.com  Thu Apr 25 11:58:08 2013
From: krishnaiah.ac at gmail.com (Crish..)
Date: Thu, 25 Apr 2013 02:58:08 -0700 (PDT)
Subject: [Rd] Error Message while Package creation
In-Reply-To: <496CE7CD-B6D2-4FB0-8B1D-61D1F3320FD2@xs4all.nl>
References: <1366867303824-4665346.post@n4.nabble.com>
	<496CE7CD-B6D2-4FB0-8B1D-61D1F3320FD2@xs4all.nl>
Message-ID: <1366883888937-4665371.post@n4.nabble.com>

Thanks Berend!!



--
View this message in context: http://r.789695.n4.nabble.com/Error-Message-while-Package-creation-tp4665346p4665371.html
Sent from the R devel mailing list archive at Nabble.com.


From renaud at mancala.cbio.uct.ac.za  Thu Apr 25 13:29:05 2013
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Thu, 25 Apr 2013 14:29:05 +0300
Subject: [Rd] lsfit: Error in formatting error message
Message-ID: <CAHavPHEd7VWoUzP42KJ2euA1DJ7JyWxOguGHo9HtL9bBMX0Eew@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130425/7f64daf2/attachment.pl>

From dtenenba at fhcrc.org  Thu Apr 25 19:56:21 2013
From: dtenenba at fhcrc.org (Dan Tenenbaum)
Date: Thu, 25 Apr 2013 10:56:21 -0700
Subject: [Rd] "Failed to locate the 'texi2pdf' output file"
In-Reply-To: <18150_1365809013_51689775_18150_776_1_CAFDcVCQ7RZgNjodqE_T4D0sVTzC4FH5ay6t4j+7BF7nXwOkMvg@mail.gmail.com>
References: <CAF42j22B=DNoMVfURMtL=TV1fGd0yh=pXAhTg3AoR2svOk9Pvw@mail.gmail.com>
	<CAC2h7uuWUbZJU_kz=6YrsWd6BRXJtarn_XM3nKur1EKE1rBBzw@mail.gmail.com>
	<18150_1365809013_51689775_18150_776_1_CAFDcVCQ7RZgNjodqE_T4D0sVTzC4FH5ay6t4j+7BF7nXwOkMvg@mail.gmail.com>
Message-ID: <CAF42j21cCgPe53KtwHw0rGfge=cPDRYW5vQDRMWDQppL5eiJxw@mail.gmail.com>

On Fri, Apr 12, 2013 at 4:23 PM, Henrik Bengtsson <hb at biostat.ucsf.edu> wrote:
> On Fri, Apr 12, 2013 at 3:53 PM, Kasper Daniel Hansen
> <kasperdanielhansen at gmail.com> wrote:
>> Dan,
>>
>> This error looks _very_ similar to what I reported regarding the use of
>> 'foreach' inside a windows vignette, on the bioc-devel email list.  As you
>> say, it looks funny that it lists the tex file, yet fails to find it.
>
> It's not looking for the TeX file, but the PDF file - that is what the
> error message is referring to by "Failed to locate the 'texi2pdf'
> output file".  [ Note that in this error message I use the term
> "vignette" in a conceptual sense, not necessarily the vignette
> *source* file (here *.Rnw) - maybe that is what is confusing. ]
> Immediately after calling tools::texi2pdf("OrganismDbi.tex"), the code
> tries to locate the texi2pdf output file, that is, 'OrganismDbi.pdf',
> which it cannot find.  This indicates that tools::texi2pdf() gave an
> error (an error message which is currently not reported/available),
> which in turn indicates that the 'OrganismDbi.tex' file is
> corrupt/incomplete.
>
>>
>> The issue had to do with closing relevant connections (for foreach, this
>> was a Windows issue because the default foreach backend on Windows uses
>> connections).   For my particular case, solving it was a bit difficult
>> because I could not just close all connections since a vignette is being
>> run inside sink().
>>
>> The package name makes me suspect a database connection. As a starting
>> point I suggest closing all existing connections in the vignette.
>
> I think it's worth looking into what Kasper says - that's hopefully the reason.
>
> /Henrik
>
> PS. I do find it odd that these issues starting to occur now, because
> most of the vignette framework is performing the same steps as in R (<
> 3.0.0).  The main difference is see is that it now validates/asserts
> that the expected output file is there *immediately* after trying to
> generate them (using weave, tangle, and texi2pdf).  If for some reason
> texi2pdf generates the PDF in a background process which is not
> completed in full when returning the control to R, then the PDF is not
> there and you would get this error.  I don't know if this can happen.
> The reason why I came to think of this is because I recall that I've
> seen this behavior when using bitmap() and Ghostscript to create PNGs.
>  Just a shot from the hip, though.
>


Just to follow up on this a bit--today we got this error with a data
package that has no dependencies of any kind, and no R code. All the
vignette does is load three datasets which are all data frames.

So this suggests that the problem, in this case anyway, has nothing to
do with database connections or parallelism. Duncan's suggestion about
a virus scanner is a good one, but there is no such software running
on the machine in question.

So it sounds maybe more like what Henrik describes above. Wondering if
there are more insights to be had...

Thanks,
Dan


>>
>> Kasper
>>
>>
>>
>> On Fri, Apr 12, 2013 at 5:34 PM, Dan Tenenbaum <dtenenba at fhcrc.org> wrote:
>>
>>> Hi,
>>> Every day a few Bioconductor packages (different ones each day) fail
>>> to build, on Windows only, with an error like this:
>>>
>>> D:\biocbld\bbs-2.13-bioc\meat>D:\biocbld\bbs-2.13-bioc\R\bin\R.exe CMD
>>> build --keep-empty-dirs --no-resave-data OrganismDbi
>>> [...]
>>> Error in find_vignette_product(name, by = "texi2pdf", engine = engine) :
>>>   Failed to locate the 'texi2pdf' output file (by engine
>>> 'utils::Sweave') for vignette with name 'OrganismDbi'. The following
>>> files exists in directory '.': 'OrganismDbi.Rnw', 'OrganismDbi.tex',
>>> 'databaseTypes.pdf'
>>> Calls: <Anonymous> -> find_vignette_product
>>> Execution halted
>>>
>>> This is puzzling to me because I would have thought that
>>> 'OrganismDbi.tex' was the file it was looking for, yet it says that
>>> file exists.
>>>
>>> These build errors are transient...if I re-run the build, the error
>>> does not recur. So I was hesitant to report the problem because can't
>>> be reproduced consistently. Nevertheless it is a problem.
>>>
>>> > sessionInfo()
>>> R version 3.0.0 (2013-04-03)
>>> Platform: i386-w64-mingw32/i386 (32-bit)
>>>
>>> locale:
>>> [1] LC_COLLATE=English_United States.1252
>>> [2] LC_CTYPE=English_United States.1252
>>> [3] LC_MONETARY=English_United States.1252
>>> [4] LC_NUMERIC=C
>>> [5] LC_TIME=English_United States.1252
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>
>>> Thanks,
>>> Dan
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel


From spencer.graves at structuremonitoring.com  Thu Apr 25 22:00:10 2013
From: spencer.graves at structuremonitoring.com (Spencer Graves)
Date: Thu, 25 Apr 2013 13:00:10 -0700
Subject: [Rd] extracting tables from web pages?
Message-ID: <51798B4A.1000401@structuremonitoring.com>

Hello:


       What tools would you recommend for extracting the table of 
members of the US House of representatives from 
"http://house.gov/representatives/" and 
"http://en.wikipedia.org/wiki/List_of_current_members_of_the_United_States_House_of_Representatives_by_age"? 



       I started writing something using getURL{RCurl}.  However, I'm 
getting bogged down manually selecting character sequences to search for 
and split on.


       Thanks,
       Spencer Graves


From edd at debian.org  Thu Apr 25 22:19:45 2013
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 25 Apr 2013 15:19:45 -0500
Subject: [Rd] extracting tables from web pages?
In-Reply-To: <51798B4A.1000401@structuremonitoring.com>
References: <51798B4A.1000401@structuremonitoring.com>
Message-ID: <20857.36833.377357.554549@max.nulle.part>


On 25 April 2013 at 13:00, Spencer Graves wrote:
| Hello:
| 
| 
|        What tools would you recommend for extracting the table of 
| members of the US House of representatives from 
| "http://house.gov/representatives/" and 
| "http://en.wikipedia.org/wiki/List_of_current_members_of_the_United_States_House_of_Representatives_by_age"? 
| 
| 
| 
|        I started writing something using getURL{RCurl}.  However, I'm 
| getting bogged down manually selecting character sequences to search for 
| and split on.

You could try your own sos package to search what others have done here; the
XML package is popular for it but the whole scheme is fraught with little
pitfalls as html very definitely is not a good format for data-delivery, and
an html page clearly is no API for data access.

Dirk

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From ruipbarradas at sapo.pt  Thu Apr 25 23:36:22 2013
From: ruipbarradas at sapo.pt (Rui Barradas)
Date: Thu, 25 Apr 2013 22:36:22 +0100
Subject: [Rd] extracting tables from web pages?
In-Reply-To: <51798B4A.1000401@structuremonitoring.com>
References: <51798B4A.1000401@structuremonitoring.com>
Message-ID: <5179A1D6.3040802@sapo.pt>

Hello,

The following seems to work.

library(XML)

url <- "http://house.gov/representatives/"
dat <- readHTMLTable(readLines(url), which=1, header=TRUE)
str(dat)
head(dat)


Hope this helps,

Rui Barradas

Em 25-04-2013 21:00, Spencer Graves escreveu:
> Hello:
>
>
>        What tools would you recommend for extracting the table of
> members of the US House of representatives from
> "http://house.gov/representatives/" and
> "http://en.wikipedia.org/wiki/List_of_current_members_of_the_United_States_House_of_Representatives_by_age"?
>
>
>
>        I started writing something using getURL{RCurl}.  However, I'm
> getting bogged down manually selecting character sequences to search for
> and split on.
>
>
>        Thanks,
>        Spencer Graves
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From kjetilbrinchmannhalvorsen at gmail.com  Fri Apr 26 20:39:41 2013
From: kjetilbrinchmannhalvorsen at gmail.com (Kjetil Halvorsen)
Date: Fri, 26 Apr 2013 20:39:41 +0200
Subject: [Rd] Lubuntu 13.04 raring ringtail: Problems installing pnmath_0.0-4
Message-ID: <CACU_Y08zS8PtX1CtxqdmvcUO3d2Bn36np4OQqA-n08mfvUtQvQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130426/6f9e20fa/attachment.pl>

From spencer.graves at structuremonitoring.com  Fri Apr 26 20:42:41 2013
From: spencer.graves at structuremonitoring.com (Spencer Graves)
Date: Fri, 26 Apr 2013 11:42:41 -0700
Subject: [Rd] extracting tables from web pages?
In-Reply-To: <20857.36833.377357.554549@max.nulle.part>
References: <51798B4A.1000401@structuremonitoring.com>
	<20857.36833.377357.554549@max.nulle.part>
Message-ID: <517ACAA1.2010204@structuremonitoring.com>

On 4/25/2013 1:19 PM, Dirk Eddelbuettel wrote:
> On 25 April 2013 at 13:00, Spencer Graves wrote:
> | Hello:
> |
> |
> |        What tools would you recommend for extracting the table of
> | members of the US House of representatives from
> | "http://house.gov/representatives/" and
> | "http://en.wikipedia.org/wiki/List_of_current_members_of_the_United_States_House_of_Representatives_by_age"?
> |
> |
> |
> |        I started writing something using getURL{RCurl}.  However, I'm
> | getting bogged down manually selecting character sequences to search for
> | and split on.
>
> You could try your own sos package to search what others have done here; the
> XML package is popular for it but the whole scheme is fraught with little
> pitfalls as html very definitely is not a good format for data-delivery, and
> an html page clearly is no API for data access.


       Thanks to Gabriel Becker and Dirk Eddelbuettel for suggesting 
XML:  Its "readHTMLTable" solves my problem.


       I confess that I tried "sos" before posting to this list without 
getting useful results:  The search terms I tried returned too many 
matches to be useful.


       And Gabriel was correct in that I should have sent the question 
to R-Help, but I only concluded that after sending it here.


       Thanks again.
       Spencer
>
> Dirk


From lgautier at gmail.com  Fri Apr 26 21:07:00 2013
From: lgautier at gmail.com (Laurent Gautier)
Date: Fri, 26 Apr 2013 21:07:00 +0200
Subject: [Rd] RFC: R_data_class as part of the C-API
Message-ID: <517AD054.9050004@gmail.com>

Hi,

In src/attrib.c, the comment for the function R_data_class is:

```
/* the S4-style class: for dispatch required to be a single string;
    for the new class() function;
    if(!singleString) , keeps S3-style multiple classes.
    Called from the methods package, so exposed.
  */
SEXP R_data_class(SEXP obj, Rboolean singleString)
```

I am obviously writing this because I'd wish to see it in the API,
and I think that the above (a package shipped with R does
need this as part of the API) is a pretty good case for having it.

Best,

Laurent

PS: I have found a similar request made some time in the past (one
of the points in
https://stat.ethz.ch/pipermail/r-devel/2007-October/047070.html
).


From ripley at stats.ox.ac.uk  Sat Apr 27 14:38:35 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 27 Apr 2013 13:38:35 +0100
Subject: [Rd] Lubuntu 13.04 raring ringtail: Problems installing
	pnmath_0.0-4
In-Reply-To: <CACU_Y08zS8PtX1CtxqdmvcUO3d2Bn36np4OQqA-n08mfvUtQvQ@mail.gmail.com>
References: <CACU_Y08zS8PtX1CtxqdmvcUO3d2Bn36np4OQqA-n08mfvUtQvQ@mail.gmail.com>
Message-ID: <517BC6CB.4090502@stats.ox.ac.uk>

AFAIK pnmath is not a package on a public repository, and it seems it is 
using R internals not part of the API and not exposed in R 3.0.0.

I presume you got this from ~luke/R/experimental ... the clue is in the 
directory name.  My understanding was that this would eventually be 
merged into R rather than released as a package.

If you really want to use it you will need to modify the R sources to 
unhide PRIMFUN and SET_PRIMFUN and re-compile.


On 26/04/2013 19:39, Kjetil Halvorsen wrote:
> Hola!
>
> This is 64bit Lubuntu 13.04, with R-3.0.0 installed from
> deb http://ppa.launchpad.net/marutter/rrutter/ubuntu raring  main
> via synaptic.  gcc --version
> gcc (Ubuntu/Linaro 4.7.3-1ubuntu1) 4.7.3
>
>> sessionInfo()
> R version 3.0.0 (2013-04-03)
> Platform: x86_64-pc-linux-gnu (64-bit)
>
> locale:
>   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>   [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>   [7] LC_PAPER=C                 LC_NAME=C
>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] MASS_7.3-26
>
> loaded via a namespace (and not attached):
> [1] compiler_3.0.0 fortunes_1.5-0 tools_3.0.0
>>
> I am trying to install pnmath from the commandline (outside R), this is
> what happens:
> kjetil at kjetil-HP-Pavilion-dv4-Notebook-PC:~/R/src$ sudo  R CMD INSTALL
> pnmath_0.0-4.tar.gz
> * installing to library ???/usr/local/lib/R/site-library???
> * installing *source* package ???pnmath??? ...
> ** libs
> gcc -std=gnu99 -I/usr/share/R/include -DNDEBUG     -fopenmp -fpic  -O2
> -pipe -g  -c bd0.c -o bd0.o
> ...
> ...
> ...
> installing to /usr/local/lib/R/site-library/pnmath/libs
> ** R
> ** byte-compile and prepare package for lazy loading
> ** help
> *** installing help indices
> ** building package indices
> ** testing if installed package can be loaded
> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>    unable to load shared object
> '/usr/local/lib/R/site-library/pnmath/libs/pnmath.so':
>    /usr/local/lib/R/site-library/pnmath/libs/pnmath.so: undefined symbol:
> PRIMFUN
> Error: loading failed
> Execution halted
> ERROR: loading failed
> * removing ???/usr/local/lib/R/site-library/pnmath???
>
> I have installed sufficient libraries as to compile R itself from source
> without problems!
>
> Kjetil
>
> 	[[alternative HTML version deleted]]
>
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From adam at seering.org  Fri Apr 26 16:50:21 2013
From: adam at seering.org (Adam Seering)
Date: Fri, 26 Apr 2013 10:50:21 -0400
Subject: [Rd] Speeding up build-from-source
Message-ID: <517A942D.7000904@seering.org>

Hi,
	I've been playing around with the R source code a little; mostly just 
trying to familiarize myself.  I have access to some computers on a 
reservation system; so I've been reserving a computer, downloading and 
compiling R, and going from there.

	I'm finding that R takes a long time to build, though.  (Well, ok, 
maybe 5 minutes -- I'm impatient :-) )  Most of that time, it's sitting 
there byte-compiling some internal package or another, which uses just 
one CPU core so leaves the system mostly idle.

	I'm just curious if anyone has thought about parallelizing that process?

Thanks,
Adam


From David.Pleydell at antilles.inra.fr  Thu Apr 25 22:01:33 2013
From: David.Pleydell at antilles.inra.fr (dpleydell)
Date: Thu, 25 Apr 2013 16:01:33 -0400
Subject: [Rd] Verbose output from R CMD check
In-Reply-To: <ADD5064D-988D-4F77-983F-032A6EFD6059@r-project.org>
References: <51769FFE.2020604@antilles.inra.fr>
	<22AF9B56-93D2-44C3-9879-136AFC61C5A7@r-project.org>
	<5176BA38.1040407@antilles.inra.fr>
	<ADD5064D-988D-4F77-983F-032A6EFD6059@r-project.org>
Message-ID: <51798B9D.9000406@antilles.inra.fr>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130425/9c495524/attachment.pl>

From mtmorgan at fhcrc.org  Sat Apr 27 15:10:40 2013
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Sat, 27 Apr 2013 06:10:40 -0700
Subject: [Rd] Speeding up build-from-source
In-Reply-To: <517A942D.7000904@seering.org>
References: <517A942D.7000904@seering.org>
Message-ID: <517BCE50.6020403@fhcrc.org>

On 04/26/2013 07:50 AM, Adam Seering wrote:
> Hi,
>      I've been playing around with the R source code a little; mostly just
> trying to familiarize myself.  I have access to some computers on a reservation
> system; so I've been reserving a computer, downloading and compiling R, and
> going from there.
>
>      I'm finding that R takes a long time to build, though.  (Well, ok, maybe 5
> minutes -- I'm impatient :-) )  Most of that time, it's sitting there
> byte-compiling some internal package or another, which uses just one CPU core so
> leaves the system mostly idle.
>
>      I'm just curious if anyone has thought about parallelizing that process?

Hi Adam -- parallel builds are supported by adding the '-j' flag when you invoke 
make

   make -j

The packages are being built in parallel, in as much as this is possible by 
their dependency structure. Also, you can configure without byte compilation, 
see ~/src/R-devel/configure --help to make this part of the build go more 
quickly. And after an initial build subsets of R, e.g., just the 'main' source 
or a single package like 'stats', can be built with (assuming R's source, e.g., 
from svn, is in ~/src/R-devel, and you're building R in ~/bin/R-devel) with

   cd ~/bin/R-devel/src/main
   make -j
   cd ~/bin/R-devel/src/library/stats
   make -j

The definitive source for answers to questions like these is

   > RShowDoc("R-admin")

Martin


>
> Thanks,
> Adam
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From pdalgd at gmail.com  Sat Apr 27 15:20:04 2013
From: pdalgd at gmail.com (peter dalgaard)
Date: Sat, 27 Apr 2013 15:20:04 +0200
Subject: [Rd] Verbose output from R CMD check
In-Reply-To: <51798B9D.9000406@antilles.inra.fr>
References: <51769FFE.2020604@antilles.inra.fr>
	<22AF9B56-93D2-44C3-9879-136AFC61C5A7@r-project.org>
	<5176BA38.1040407@antilles.inra.fr>
	<ADD5064D-988D-4F77-983F-032A6EFD6059@r-project.org>
	<51798B9D.9000406@antilles.inra.fr>
Message-ID: <BB0B0758-BFC7-47B1-A509-537FBAEC1A23@gmail.com>


On Apr 25, 2013, at 22:01 , dpleydell wrote:

> Following Simon's suggestion of replacing printf with Rprintf throughout 
> the source code R CMD check now complains less than before, but it still 
> complains...
> 
> I used the following two BASH lines to replace printf
> 
> find . -maxdepth 1 -type f -name '*.c' -exec sed -i 's\printf\Rprintf\' 
> {} \;
> find . -maxdepth 1 -type f -name '*.c' -exec sed -i 
> 's\fRprintf\fprintf\' {} \;
> 
> and using grep I have confirmed that only fprintf and Rprintf remain in 
> the code.
> 
> the original warning (when printf was in the code) was
> 
> [QUOTE : ORIGINAL R CMD check WARNING]
> 
> R CMD check foobar_1.7.5.tar.gz
> [LOTS OF '...OK' CHECK REPORTS REMOVED FOR BREVITY]
> * checking compiled code ... NOTE
> File '/home/david/foobar/package/foobar.Rcheck/foobar/libs/foobar.so':
>  Found 'putchar', possibly from 'putchar' (C)
>    Object: 'foobar.o'
>  Found 'puts', possibly from 'printf' (C), 'puts' (C)
>    Object: 'foobar.o'
> 
> Compiled code should not call functions which might terminate R nor write to stdout/stderr instead of to the console.
> 
> [end QUOTE : ORIGINAL R CMD check WARNING]
> 
> 
> now printf is no longer in the code the warning message is
> 
> [QUOTE : ORIGINAL R CMD check WARNING]
> 
> R CMD check foobar_1.7.6.tar.gz
> [LOTS OF '...OK' CHECK REPORTS REMOVED FOR BREVITY]
> * checking compiled code ... NOTE
> File '/home/david/foobar/package/foobar.Rcheck/foobar/libs/foobar.so':
>  Found 'puts', possibly from 'printf' (C), 'puts' (C)
>    Object: 'foobar.o'
> 
> Compiled code should not call functions which might terminate R nor write to stdout/stderr instead of to the console.
> 
> [end QUOTE : ORIGINAL R CMD check WARNING]
> 
> Which is better than before, but still not clean.
> 
> Both the following lines return 0 hits
> grep printf *.c|grep -v Rprintf|grep -v fprintf
> grep puts *.c
> 
> Is there some way to detect what has caused this warning about puts? 
> It's not a call to 'puts' or 'printf' because there are none.

Longshot: 

grep '[^Rf]printf' *.c

might turn up cases not found by the pipeline above.

Apart from that, trying out the nm command on your .o and .so files could be enlightening.  If push comes to shove, you might compile to assembler code (gcc -S, as far as I remember) and look for the offending puts symbol in the output.

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From luke-tierney at uiowa.edu  Sat Apr 27 15:39:17 2013
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Sat, 27 Apr 2013 08:39:17 -0500
Subject: [Rd] Lubuntu 13.04 raring ringtail: Problems installing
 pnmath_0.0-4
In-Reply-To: <517BC6CB.4090502@stats.ox.ac.uk>
References: <CACU_Y08zS8PtX1CtxqdmvcUO3d2Bn36np4OQqA-n08mfvUtQvQ@mail.gmail.com>
	<517BC6CB.4090502@stats.ox.ac.uk>
Message-ID: <alpine.DEB.2.02.1304270836350.2145@luke-Latitude>

On Sat, 27 Apr 2013, Prof Brian Ripley wrote:

> AFAIK pnmath is not a package on a public repository, and it seems it is 
> using R internals not part of the API and not exposed in R 3.0.0.
>
> I presume you got this from ~luke/R/experimental ... the clue is in the 
> directory name.  My understanding was that this would eventually be merged 
> into R rather than released as a package.

The intent is t merge it eventually; until that happens the intent is
to keep it working as an experimental package.  It is experimental,
and it's math code has not been updated to reflect improvements in the
R library, so should be used with caution.

>
> If you really want to use it you will need to modify the R sources to unhide 
> PRIMFUN and SET_PRIMFUN and re-compile.

These are now no longer hidden in R-devel and R-patched, so should be
available in the next R release.

Best,

luke

>
>
> On 26/04/2013 19:39, Kjetil Halvorsen wrote:
>> Hola!
>> 
>> This is 64bit Lubuntu 13.04, with R-3.0.0 installed from
>> deb http://ppa.launchpad.net/marutter/rrutter/ubuntu raring  main
>> via synaptic.  gcc --version
>> gcc (Ubuntu/Linaro 4.7.3-1ubuntu1) 4.7.3
>> 
>>> sessionInfo()
>> R version 3.0.0 (2013-04-03)
>> Platform: x86_64-pc-linux-gnu (64-bit)
>> 
>> locale:
>>   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>>   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>   [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>>   [7] LC_PAPER=C                 LC_NAME=C
>>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>> 
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>> 
>> other attached packages:
>> [1] MASS_7.3-26
>> 
>> loaded via a namespace (and not attached):
>> [1] compiler_3.0.0 fortunes_1.5-0 tools_3.0.0
>>> 
>> I am trying to install pnmath from the commandline (outside R), this is
>> what happens:
>> kjetil at kjetil-HP-Pavilion-dv4-Notebook-PC:~/R/src$ sudo  R CMD INSTALL
>> pnmath_0.0-4.tar.gz
>> * installing to library ???/usr/local/lib/R/site-library???
>> * installing *source* package ???pnmath??? ...
>> ** libs
>> gcc -std=gnu99 -I/usr/share/R/include -DNDEBUG     -fopenmp -fpic  -O2
>> -pipe -g  -c bd0.c -o bd0.o
>> ...
>> ...
>> ...
>> installing to /usr/local/lib/R/site-library/pnmath/libs
>> ** R
>> ** byte-compile and prepare package for lazy loading
>> ** help
>> *** installing help indices
>> ** building package indices
>> ** testing if installed package can be loaded
>> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>>    unable to load shared object
>> '/usr/local/lib/R/site-library/pnmath/libs/pnmath.so':
>>    /usr/local/lib/R/site-library/pnmath/libs/pnmath.so: undefined symbol:
>> PRIMFUN
>> Error: loading failed
>> Execution halted
>> ERROR: loading failed
>> * removing ???/usr/local/lib/R/site-library/pnmath???
>> 
>> I have installed sufficient libraries as to compile R itself from source
>> without problems!
>> 
>> Kjetil
>>
>> 	[[alternative HTML version deleted]]
>> 
>> 
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>
>
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu

From adam at seering.org  Sat Apr 27 17:34:58 2013
From: adam at seering.org (Adam Seering)
Date: Sat, 27 Apr 2013 11:34:58 -0400
Subject: [Rd] Speeding up build-from-source
In-Reply-To: <517BCE50.6020403@fhcrc.org>
References: <517A942D.7000904@seering.org> <517BCE50.6020403@fhcrc.org>
Message-ID: <517BF022.9060606@seering.org>



On 04/27/2013 09:10 AM, Martin Morgan wrote:
> On 04/26/2013 07:50 AM, Adam Seering wrote:
>> Hi,
>>      I've been playing around with the R source code a little; mostly
>> just
>> trying to familiarize myself.  I have access to some computers on a
>> reservation
>> system; so I've been reserving a computer, downloading and compiling
>> R, and
>> going from there.
>>
>>      I'm finding that R takes a long time to build, though.  (Well,
>> ok, maybe 5
>> minutes -- I'm impatient :-) )  Most of that time, it's sitting there
>> byte-compiling some internal package or another, which uses just one
>> CPU core so
>> leaves the system mostly idle.
>>
>>      I'm just curious if anyone has thought about parallelizing that
>> process?
>
> Hi Adam -- parallel builds are supported by adding the '-j' flag when
> you invoke make
>
>    make -j
>
> The packages are being built in parallel, in as much as this is possible
> by their dependency structure. Also, you can configure without byte
> compilation, see ~/src/R-devel/configure --help to make this part of the
> build go more quickly. And after an initial build subsets of R, e.g.,
> just the 'main' source or a single package like 'stats', can be built
> with (assuming R's source, e.g., from svn, is in ~/src/R-devel, and
> you're building R in ~/bin/R-devel) with
>
>    cd ~/bin/R-devel/src/main
>    make -j
>    cd ~/bin/R-devel/src/library/stats
>    make -j
>
> The definitive source for answers to questions like these is
>
>    > RShowDoc("R-admin")
>
> Martin

Hi Martin,
	Thanks for the reply -- but I'm afraid the question you've answered 
isn't the question that I intended to ask.

	Based on your response, I think the answer to my question is likely 
"no."  But let me try rephrasing anyway, just in case:

	I'm certainly quite aware of "-j" as a make argument; if I weren't, the 
bottleneck would not be the byte-compilation, and the build would take 
rather more than 5 minutes :-)  That was the very first thing I tried. 
I don't believe that parallel make is as parallel as it theoretically 
could be.  (In fact, I see almost no parallelism between libraries on my 
system; individual .c files are parallelized nicely but only one library 
at a time.  This mostly matters at the compiling-bytecode step, since 
that's the biggest serial operation per library.)  My question is, has 
anyone thought about what it would take to parallelize the build further?

	I'm not sure that this can be done with just the makefiles.  But the 
following comment makes me at least a little suspicious:

""" src/library/Makefile
## FIXME: do some of this in parallel?
"""

	Surely some of the 'for' loops there could be unwound into proper make 
targets with dependency information?  I'm not sure if the dependency 
information would effectively force a serial compilation anyway, though?...

	Another approach, if the above is hard for some reason:  What I'm 
seeing is that the byte compilation is largely serial; but as you note, 
byte-compilation is optional.  Could the makefiles just defer it?; skip 
it up front and then do all the byte-compilations for all of the 
packages concurrently?  From a very cursory read of the code, it looks 
like the relevant code is in src/library/tools/R/makeLazyLoad.R?; and 
that file doesn't immediately look like it's doing anything that 
fundamentally couldn't be parallelized?  (ie., running multiple R 
processes at once, one per library; at a glance the logic looks nicely 
per-library.)

	A third approach could be to try to parallelize the logic in 
makeLazyLoad.R.  I would expect that to be at best much more difficult, 
though.

	Anyway, there are lots of things that look like they could in theory be 
done here.  And I know just enough at this point to be dangerous; not 
enough to contribute :-)  Hence my asking, has anyone thought about 
this?  If not, I assume the best thing for me to do would be to poke at 
it; try to figure out own my own how this works and what's most 
feasible.  But if anyone has any pointers, that would likely save me a 
bunch of time.  And if this is something that you prefer to keep serial 
for some reason, that would be good to know too, so I don't spend time 
on it.

Thanks,
Adam


>
>
>>
>> Thanks,
>> Adam
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From kjetilbrinchmannhalvorsen at gmail.com  Sat Apr 27 19:51:31 2013
From: kjetilbrinchmannhalvorsen at gmail.com (Kjetil Halvorsen)
Date: Sat, 27 Apr 2013 19:51:31 +0200
Subject: [Rd] Lubuntu 13.04 raring ringtail: Problems installing
	pnmath_0.0-4
In-Reply-To: <517BC6CB.4090502@stats.ox.ac.uk>
References: <CACU_Y08zS8PtX1CtxqdmvcUO3d2Bn36np4OQqA-n08mfvUtQvQ@mail.gmail.com>
	<517BC6CB.4090502@stats.ox.ac.uk>
Message-ID: <CACU_Y0-yKhL1Ubm0q61G5xDmk1pkZ7-+o0TxKavP3hrpGcephw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130427/b42834e5/attachment.pl>

From simon.urbanek at r-project.org  Sun Apr 28 00:50:17 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Sat, 27 Apr 2013 18:50:17 -0400
Subject: [Rd] Speeding up build-from-source
In-Reply-To: <517BF022.9060606@seering.org>
References: <517A942D.7000904@seering.org> <517BCE50.6020403@fhcrc.org>
	<517BF022.9060606@seering.org>
Message-ID: <0E4CBA93-9360-4563-B9DF-F201FB054294@r-project.org>

On Apr 27, 2013, at 11:34 AM, Adam Seering wrote:

> 
> 
> On 04/27/2013 09:10 AM, Martin Morgan wrote:
>> On 04/26/2013 07:50 AM, Adam Seering wrote:
>>> Hi,
>>>     I've been playing around with the R source code a little; mostly
>>> just
>>> trying to familiarize myself.  I have access to some computers on a
>>> reservation
>>> system; so I've been reserving a computer, downloading and compiling
>>> R, and
>>> going from there.
>>> 
>>>     I'm finding that R takes a long time to build, though.  (Well,
>>> ok, maybe 5
>>> minutes -- I'm impatient :-) )  Most of that time, it's sitting there
>>> byte-compiling some internal package or another, which uses just one
>>> CPU core so
>>> leaves the system mostly idle.
>>> 
>>>     I'm just curious if anyone has thought about parallelizing that
>>> process?
>> 
>> Hi Adam -- parallel builds are supported by adding the '-j' flag when
>> you invoke make
>> 
>>   make -j
>> 
>> The packages are being built in parallel, in as much as this is possible
>> by their dependency structure. Also, you can configure without byte
>> compilation, see ~/src/R-devel/configure --help to make this part of the
>> build go more quickly. And after an initial build subsets of R, e.g.,
>> just the 'main' source or a single package like 'stats', can be built
>> with (assuming R's source, e.g., from svn, is in ~/src/R-devel, and
>> you're building R in ~/bin/R-devel) with
>> 
>>   cd ~/bin/R-devel/src/main
>>   make -j
>>   cd ~/bin/R-devel/src/library/stats
>>   make -j
>> 
>> The definitive source for answers to questions like these is
>> 
>>   > RShowDoc("R-admin")
>> 
>> Martin
> 
> Hi Martin,
> 	Thanks for the reply -- but I'm afraid the question you've answered isn't the question that I intended to ask.
> 
> 	Based on your response, I think the answer to my question is likely "no."  But let me try rephrasing anyway, just in case:
> 
> 	I'm certainly quite aware of "-j" as a make argument; if I weren't, the bottleneck would not be the byte-compilation, and the build would take rather more than 5 minutes :-)  That was the very first thing I tried. I don't believe that parallel make is as parallel as it theoretically could be.  (In fact, I see almost no parallelism between libraries on my system; individual .c files are parallelized nicely but only one library at a time.  This mostly matters at the compiling-bytecode step, since that's the biggest serial operation per library.)  My question is, has anyone thought about what it would take to parallelize the build further?
> 

I think you may have failed to notice that installation of packages *is* parallelized. The *output* is shown only en-bloc and to avoid mixing outputs of the parallel installations. But there are dependencies among packages, so those that require most of the others have to be built last -- nonetheless, in the current R you can install 9 recommended packages in parallel.


> 	I'm not sure that this can be done with just the makefiles.  But the following comment makes me at least a little suspicious:
> 
> """ src/library/Makefile
> ## FIXME: do some of this in parallel?
> """
> 
> 	Surely some of the 'for' loops there could be unwound into proper make targets with dependency information?  I'm not sure if the dependency information would effectively force a serial compilation anyway, though?...
> 
> 	Another approach, if the above is hard for some reason:  What I'm seeing is that the byte compilation is largely serial; but as you note, byte-compilation is optional.  Could the makefiles just defer it?; skip it up front and then do all the byte-compilations for all of the packages concurrently?

The problem is, again, dependencies - you cannot defer the compilation since it would change the package *after* is has already been used by another package which can cause inconsistencies (note that lazy loading is a red herring - it's used regardless of compilation). That said, you won't save significant amount of time anyway (did you actually profile the time or are you relying on your eyes to deceive you? ;)), so it's not worth the bother (try enabling LTO ;)).

Personally, I simply disable package compilation for all developments builds. You won't notice the difference for testing anyway. Moreover, you'll be barely doing a full build repeatedly, so the 4 minutes it takes are certainly nothing compared to other projects of such size... It becomes more fun when you start building all CRAN packages ;).

Cheers,
Simon


>  From a very cursory read of the code, it looks like the relevant code is in src/library/tools/R/makeLazyLoad.R?; and that file doesn't immediately look like it's doing anything that fundamentally couldn't be parallelized?  (ie., running multiple R processes at once, one per library; at a glance the logic looks nicely per-library.)
> 
> 	A third approach could be to try to parallelize the logic in makeLazyLoad.R.  I would expect that to be at best much more difficult, though.
> 
> 	Anyway, there are lots of things that look like they could in theory be done here.  And I know just enough at this point to be dangerous; not enough to contribute :-)  Hence my asking, has anyone thought about this?  If not, I assume the best thing for me to do would be to poke at it; try to figure out own my own how this works and what's most feasible.  But if anyone has any pointers, that would likely save me a bunch of time.  And if this is something that you prefer to keep serial for some reason, that would be good to know too, so I don't spend time on it.
> 
> Thanks,
> Adam
> 
> 
>> 
>> 
>>> 
>>> Thanks,
>>> Adam
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From ligges at statistik.tu-dortmund.de  Sun Apr 28 16:27:21 2013
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sun, 28 Apr 2013 16:27:21 +0200
Subject: [Rd] dyn.load inside a package in R >= 3.0
In-Reply-To: <23F5015AB166A946A49A38282DB0C3E2C2B9A4@EXCHMBOXB01.pc.factset.com>
References: <23F5015AB166A946A49A38282DB0C3E2C2B9A4@EXCHMBOXB01.pc.factset.com>
Message-ID: <517D31C9.5080101@statistik.tu-dortmund.de>



On 24.04.2013 19:55, Adrian Mejia wrote:
> Hello,
> I am trying to port a package that was built for R 2.15 over to R 3.0. This package has an Initialize method that uses dyn.load to load a dll that was built separately, and then uses .C() to make calls on the functions in that dll. This worked fine in 2.15, however, I see that now for 3.0 .C() will only search in the namespace of your current package. This seems to make it impossible to use dyn.load for loading a dll, as I can't find a way to get the loaded dll to belong to the namespace of the package that is using it. It tells me that the function I'm trying to call is not resolved from the current namespace, or if pass the .C function a value for the PACKAGE optional argument it tells me that the symbol is not available for .C() for the package.
> Is there a way to still use dyn.load to use a dll inside my package? Do I need to change the structure of my project to still be able to use my dll?

If you need an example for such an ugly hack, see how we did it in the 
BRugs package.

Best,
Uwe Ligges





> Thanks
> Adrian
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From thomas.friedrichsmeier at ruhr-uni-bochum.de  Sun Apr 28 18:51:12 2013
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: 28 Apr 2013 18:51:12 +0200
Subject: [Rd] RFC: R_data_class as part of the C-API
In-Reply-To: <517AD054.9050004@gmail.com>
References: <517AD054.9050004@gmail.com>
Message-ID: <3177272.Ab0B0Ube6n@late>

Hi,

On Friday 26 April 2013 21:07:00 Laurent Gautier wrote:
[...]
> SEXP R_data_class(SEXP obj, Rboolean singleString)
> ```
> 
> I am obviously writing this because I'd wish to see it in the API,
[...]

I'd like to second this request, as we'd have use for this in RKWard, too.

Regards
Thomas
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part.
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130428/07509bb3/attachment.bin>

From terry.therneau at gmail.com  Mon Apr 29 03:54:58 2013
From: terry.therneau at gmail.com (Terry Therneau)
Date: Sun, 28 Apr 2013 20:54:58 -0500
Subject: [Rd] Loss of identified points
Message-ID: <CAGzH7UdM7z=Rt_wTTURxUN9thAQF5_qDvV=Dbny24N2FBm1jfw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130428/b99e3100/attachment.pl>

From hlin09pu at gmail.com  Sun Apr 28 18:00:34 2013
From: hlin09pu at gmail.com (Maxpar Lin)
Date: Sun, 28 Apr 2013 12:00:34 -0400
Subject: [Rd] cause 'invalid permissions'
Message-ID: <CAH9vowjUOcFhYC6TzqvwqW41Nk9Z5rXiehvARAD6oLqeOt0-mw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130428/6e341601/attachment.pl>

From ripley at stats.ox.ac.uk  Mon Apr 29 10:52:46 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 29 Apr 2013 09:52:46 +0100
Subject: [Rd] cause 'invalid permissions'
In-Reply-To: <CAH9vowjUOcFhYC6TzqvwqW41Nk9Z5rXiehvARAD6oLqeOt0-mw@mail.gmail.com>
References: <CAH9vowjUOcFhYC6TzqvwqW41Nk9Z5rXiehvARAD6oLqeOt0-mw@mail.gmail.com>
Message-ID: <517E34DE.8050606@stats.ox.ac.uk>

On 28/04/2013 17:00, Maxpar Lin wrote:
> Hi folks,
>
> I am writing a package in C. It works most of the time, but fails
> occasionally by the segfault looking like:
>
> address 0x7f55302e2700, cause 'invalid permissions'
>
> Possible actions:
> 1: abort (with core dump, if enabled)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
>
> I tried gdb and it appears the application hangs at
>
> __kernel_vsyscall ()
>
> Since it happens randomly, I am not sure what is the exactly cause. Anyone
> reached the same problem? Any point is appreciated.

See the debugging section in 'Writing R Extensions' (and look at the 
call stack when you use gdb).  One of the tools there such as ASan or 
valgrind will likely pinpoint your error.

>
> Thanks.
>
> Max
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Mon Apr 29 10:55:17 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 29 Apr 2013 09:55:17 +0100
Subject: [Rd] Loss of identified points
In-Reply-To: <CAGzH7UdM7z=Rt_wTTURxUN9thAQF5_qDvV=Dbny24N2FBm1jfw@mail.gmail.com>
References: <CAGzH7UdM7z=Rt_wTTURxUN9thAQF5_qDvV=Dbny24N2FBm1jfw@mail.gmail.com>
Message-ID: <517E3575.6000208@stats.ox.ac.uk>

On 29/04/2013 02:54, Terry Therneau wrote:
> Minimizing and then restoring a window that contains identified points
> leads to an error on my linux box.

See the posting guide.  NEWS in R-patched says

     ? In R 3.0.0, identify() and locator() did not record information
       correctly, so replaying a graph (e.g. by copying it to another
       device) would fail. (PR#15271)

If your device does not use backing store (mine does) then minimizing 
and replaying will replay the display list.


>
>> sessionInfo()
> R version 3.0.0 (2013-04-03)
> Platform: i686-pc-linux-gnu (32-bit)
>
> locale:
>   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=C
>   [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>   [7] LC_PAPER=C                 LC_NAME=C
>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>> sessionInfo()
> R version 3.0.0 (2013-04-03)
> Platform: i686-pc-linux-gnu (32-bit)
>
> locale:
>   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=C
>   [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>   [7] LC_PAPER=C                 LC_NAME=C
>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
>> plot(1:5, 1:5)
>> identify(1:5, 1:5, letters[2:6])
>
> # Identify a point or two, then minimize the graph window, then restore it
>> Error: first argument must be a string (of length 1) or native symbol
> reference
>
> The graph returns  but the labels are lost.
>
> Terry T.
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ligges at statistik.tu-dortmund.de  Mon Apr 29 11:15:34 2013
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Mon, 29 Apr 2013 11:15:34 +0200
Subject: [Rd] lsfit: Error in formatting error message
In-Reply-To: <CAHavPHEd7VWoUzP42KJ2euA1DJ7JyWxOguGHo9HtL9bBMX0Eew@mail.gmail.com>
References: <CAHavPHEd7VWoUzP42KJ2euA1DJ7JyWxOguGHo9HtL9bBMX0Eew@mail.gmail.com>
Message-ID: <517E3A36.1080409@statistik.tu-dortmund.de>

On 25.04.2013 13:29, Renaud Gaujoux wrote:
> Hi,
>
> in R-3.0 I get the following error when calling lsfit with more
> observations than variables, which seems to come from an error in the
> formatting of the error message (note that this was not happening in
> 2.15.3):
>
>> nobs <- 5; nvar <- 6; lsfit(matrix(runif(nobs*nvar), ncol=nvar),
> runif(nobs), intercept=FALSE)
> Error in sprintf(ngettext(nry, "%d response", "%d responses"), ", ",
> ngettext(ncx,  :
>    invalid format '%d'; use format %s for character objects
>> traceback()
> 3: sprintf(ngettext(nry, "%d response", "%d responses"), ", ",
> ngettext(ncx,
>         "but only %d variable", "but only %d variables"), nry, ncx)
> 2: stop(sprintf(ngettext(nry, "%d response", "%d responses"), ", ",
>         ngettext(ncx, "but only %d variable", "but only %d variables"),
>         nry, ncx), domain = NA)
> 1: lsfit(matrix(runif(nobs * nvar), ncol = nvar), runif(nobs), intercept =
> FALSE)

Thanks, fixed in R-patched and R-devel (plus the wording which was 
inappropriate for more than 10 years, at least).

Best,
Uwe Ligges




>
> Thank you.
>
> Bests,
> Renaud
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From renaud at mancala.cbio.uct.ac.za  Mon Apr 29 13:11:51 2013
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Mon, 29 Apr 2013 14:11:51 +0300
Subject: [Rd] lsfit: Error in formatting error message
In-Reply-To: <517E3A36.1080409@statistik.tu-dortmund.de>
References: <CAHavPHEd7VWoUzP42KJ2euA1DJ7JyWxOguGHo9HtL9bBMX0Eew@mail.gmail.com>
	<517E3A36.1080409@statistik.tu-dortmund.de>
Message-ID: <CAHavPHHJBX0duOT49bJbGu2Q=7YqkSzGL+p=MrZLp18p1f7cEg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130429/503af408/attachment.pl>

From pgilbert902 at gmail.com  Mon Apr 29 13:43:22 2013
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Mon, 29 Apr 2013 07:43:22 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <CAP01uRntewgpwxNJAQPZTxhmptDT=8OqP7+gho0ZZVndZEJpHA@mail.gmail.com>
References: <5171B903.50401@gmail.com> <5172D661.4000703@gmail.com>
	<5172D84F.3060801@gmail.com> <5172DC98.8040308@gmail.com>
	<517319E5.4040800@gmail.com>
	<CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>
	<CAP01uRkq2PXwrQfN5MAjWuE02QtQxVu8raa2uhW4rOi9BGvuzg@mail.gmail.com>
	<CABdHhvFsiuTmnW8So3TdoKcDVsqtM0sO18NivEjr3JfSG9Bcfg@mail.gmail.com>
	<CAP01uRnP1CJSbtYJHEB3X8GY5CfcbfCgZ=R78SwEuAesYOYMUQ@mail.gmail.com>
	<CABdHhvGQYGa2uJSMFYvL=Ckm=cD27ZAGDQqXPMuhuFr3dRsmUg@mail.gmail.com>
	<CAP01uRmfY1dqk_-8Cq0GodNuFGCGMGcUU6BhBwrNB7hH6bwHeA@mail.gmail.com>
	<CABdHhvHfW6r3fjJeuGUjyRNq0VOBr2YFDiHnu_jmqu6NE7F_WA@mail.gmail.com>
	<CAP01uRnLdB6MA=pbW8C6TJCXFGeSso=HssGNq=GtGKcB7BiK9Q@mail.gmail.com>
	<CAFDcVCRjpWU=PRAC7BBscAiBm1PFb9tK4BWn3NQjrP6PGo=Nhw@mail.gmail.com>
	<CABdHhvG2hz+foxwePt1sv6CCRYxg2OJKUDxbYo6r67qpYF1=Sw@mail.gmail.com>
	<517548C5.6050203@gmail.com>
	<CAP01uRntewgpwxNJAQPZTxhmptDT=8OqP7+gho0ZZVndZEJpHA@mail.gmail.com>
Message-ID: <517E5CDA.5060906@gmail.com>

Being generally uninformed about Windows, I have to admit to almost 
total confusion trying to follow this thread. However, since I have 
recently been trying to do something in Windows, I would appreciate a 
newbie friendly explanation of a few points:

-Rtools is used to build R and to build (some?) R packages. If you make 
Rtools an R package, how do you bootstrap the R build process?

-in unix-like OSes, configure is used before make to set things similar 
to the question of where to find Rtools, and what version of various 
tools are available, and give warnings and errors if these are not 
adequate. Is there a reason configure cannot be used in Windows, or is 
there not something similar?

-or am I really confused and should not consider the possibility that 
people actually build R, so the discussion is just about packages?

Thanks,
Paul

On 13-04-22 11:16 AM, Gabor Grothendieck wrote:
> On Mon, Apr 22, 2013 at 10:27 AM, Duncan Murdoch
> <murdoch.duncan at gmail.com> wrote:
>> On 21/04/2013 6:57 PM, Hadley Wickham wrote:
>>>
>>>> PS. Hadley, is this what you meant when you wrote "Better solutions
>>>> (e.g. Rstudio and devtools) temporarily set the path on when you're
>>>> calling R CMD *.", or those approaches are only when you call 'R CMD'
>>>> from the R prompt?  I believe the latter, but I just want to make sure
>>>> I didn't miss something.
>>>
>>> Well both devtools and RStudio allow you to do package development
>>> without leaving R, so neither do anything to your path when you're not
>>> using them.
>>>
>>> In teaching windows users to develop R packages, I found the use of
>>> the command line to be a substantial road-block, and if you can
>>> develop packages without leaving R, why not?
>>
>>
>> The idea of temporary additions to the path during the INSTALL/build/check
>> code sounds reasonable.  R could probably do it more accurately than
>> devtools or RStudio can (since we know the requirements, and you have to
>> guess at them), but could hopefully do it in a way that isn't incompatible
>> with those.
>>
>> The code called by install.packages() and related functions within R is
>> essentially the same code as called by R CMD INSTALL etc from the command
>> line, so this would help both cases.
>
> I would like to comment on this as I have had to implement similar
> facilities myself as part R.bat in the batchfiles.
>
> There is an issue of keeping R and Rtools in sync.   Currently
> different Rtools versions will work with the same R version.  For
> example, I have used both Rtools 1927 and 1930 with the current
> version of R.  Its necessary to determine the relative paths that the
> version of Rtools in use requires since in principle the relative
> Rtools paths can vary from one version of Rtools to the next if the
> gcc version changes, say.
>
> Ideally the system would be able to figure this out even if registry
> entries and environment variables are not set by looking in standard
> locations for the Rtools root and finding the relative paths by
> querying some file in the Rtools installation itself.  devtools does
> this by querying the Rtools version and uss an internal database of
> relative paths keyed by version.   R.bat in batchfiles does it by
> scanning the Rtools unins000.dat file and extracting the relative
> paths directly from it.  This has the advantage that no database need
> be maintained and it also automatically adapts to new versions of
> Rtools without any foreknowledge of them.   Of course since you have
> control of both ends you alternately could add the relative paths to
> an expanded version of the VERSION file or add some additional text
> file into Rtools for the purpose of identifying he relative paths..
>
> Another possibility if significant changes were to be considered would
> be to make Rtools into an R package thereby leveraging existing
> facilities and much simplifying any synchronization.
>
> --
> Statistics & Software Consulting
> GKX Group, GKX Associates Inc.
> tel: 1-877-GKX-GROUP
> email: ggrothendieck at gmail.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From murdoch.duncan at gmail.com  Mon Apr 29 15:08:51 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 29 Apr 2013 09:08:51 -0400
Subject: [Rd] R 3.0, Rtools3.0,l Windows7 64-bit, and permission agony
In-Reply-To: <517E5CDA.5060906@gmail.com>
References: <5171B903.50401@gmail.com> <5172D661.4000703@gmail.com>
	<5172D84F.3060801@gmail.com> <5172DC98.8040308@gmail.com>
	<517319E5.4040800@gmail.com>
	<CABdHhvFSnwMxx7kDs7vw6LvMTwEzw_X_6=WBQOf3FHqGM2piiQ@mail.gmail.com>
	<CAP01uRkq2PXwrQfN5MAjWuE02QtQxVu8raa2uhW4rOi9BGvuzg@mail.gmail.com>
	<CABdHhvFsiuTmnW8So3TdoKcDVsqtM0sO18NivEjr3JfSG9Bcfg@mail.gmail.com>
	<CAP01uRnP1CJSbtYJHEB3X8GY5CfcbfCgZ=R78SwEuAesYOYMUQ@mail.gmail.com>
	<CABdHhvGQYGa2uJSMFYvL=Ckm=cD27ZAGDQqXPMuhuFr3dRsmUg@mail.gmail.com>
	<CAP01uRmfY1dqk_-8Cq0GodNuFGCGMGcUU6BhBwrNB7hH6bwHeA@mail.gmail.com>
	<CABdHhvHfW6r3fjJeuGUjyRNq0VOBr2YFDiHnu_jmqu6NE7F_WA@mail.gmail.com>
	<CAP01uRnLdB6MA=pbW8C6TJCXFGeSso=HssGNq=GtGKcB7BiK9Q@mail.gmail.com>
	<CAFDcVCRjpWU=PRAC7BBscAiBm1PFb9tK4BWn3NQjrP6PGo=Nhw@mail.gmail.com>
	<CABdHhvG2hz+foxwePt1sv6CCRYxg2OJKUDxbYo6r67qpYF1=Sw@mail.gmail.com>
	<517548C5.6050203@gmail.com>
	<CAP01uRntewgpwxNJAQPZTxhmptDT=8OqP7+gho0ZZVndZEJpHA@mail.gmail.com>
	<517E5CDA.5060906@gmail.com>
Message-ID: <517E70E3.4030804@gmail.com>

On 29/04/2013 7:43 AM, Paul Gilbert wrote:
> Being generally uninformed about Windows, I have to admit to almost
> total confusion trying to follow this thread. However, since I have
> recently been trying to do something in Windows, I would appreciate a
> newbie friendly explanation of a few points:
>
> -Rtools is used to build R and to build (some?) R packages. If you make
> Rtools an R package, how do you bootstrap the R build process?

Rtools used to be needed for all packages.  Nowadays packages that 
consist only of R code typically wouldn't need it.

It might be possible to make Rtools into an R package, but it would 
require quite a bit of work, because generally speaking packages don't 
provide command line executables, and we strongly prefer packages to 
contain their own source.  The Rtools source is really quite huge (since 
it contains compilers for C/C++, Fortran, and Objective C/C++, as well 
as a small collection of Unix-like tools).
>
> -in unix-like OSes, configure is used before make to set things similar
> to the question of where to find Rtools, and what version of various
> tools are available, and give warnings and errors if these are not
> adequate. Is there a reason configure cannot be used in Windows, or is
> there not something similar?

Most bare-bones Windows systems can't run configure scripts and could 
not possibly provide the minimal tools necessary to build R, so we 
decided long ago to manually configure R for one particular toolset, 
which we maintain and distribute.

People who have Cygwin installed can use the usual Unix-style tools to 
configure R for Cygwin, but as far as I know no Cygwin maintainer has 
managed to build R so that it passes its tests.  We (in R-core) do not 
support Cygwin, putting our efforts towards the current strategy instead.


>
> -or am I really confused and should not consider the possibility that
> people actually build R, so the discussion is just about packages?

Not very many people build R on Windows, but a few do, and we support 
them by making Rtools available.

Duncan Murdoch

>
> Thanks,
> Paul
>
> On 13-04-22 11:16 AM, Gabor Grothendieck wrote:
> > On Mon, Apr 22, 2013 at 10:27 AM, Duncan Murdoch
> > <murdoch.duncan at gmail.com> wrote:
> >> On 21/04/2013 6:57 PM, Hadley Wickham wrote:
> >>>
> >>>> PS. Hadley, is this what you meant when you wrote "Better solutions
> >>>> (e.g. Rstudio and devtools) temporarily set the path on when you're
> >>>> calling R CMD *.", or those approaches are only when you call 'R CMD'
> >>>> from the R prompt?  I believe the latter, but I just want to make sure
> >>>> I didn't miss something.
> >>>
> >>> Well both devtools and RStudio allow you to do package development
> >>> without leaving R, so neither do anything to your path when you're not
> >>> using them.
> >>>
> >>> In teaching windows users to develop R packages, I found the use of
> >>> the command line to be a substantial road-block, and if you can
> >>> develop packages without leaving R, why not?
> >>
> >>
> >> The idea of temporary additions to the path during the INSTALL/build/check
> >> code sounds reasonable.  R could probably do it more accurately than
> >> devtools or RStudio can (since we know the requirements, and you have to
> >> guess at them), but could hopefully do it in a way that isn't incompatible
> >> with those.
> >>
> >> The code called by install.packages() and related functions within R is
> >> essentially the same code as called by R CMD INSTALL etc from the command
> >> line, so this would help both cases.
> >
> > I would like to comment on this as I have had to implement similar
> > facilities myself as part R.bat in the batchfiles.
> >
> > There is an issue of keeping R and Rtools in sync.   Currently
> > different Rtools versions will work with the same R version.  For
> > example, I have used both Rtools 1927 and 1930 with the current
> > version of R.  Its necessary to determine the relative paths that the
> > version of Rtools in use requires since in principle the relative
> > Rtools paths can vary from one version of Rtools to the next if the
> > gcc version changes, say.
> >
> > Ideally the system would be able to figure this out even if registry
> > entries and environment variables are not set by looking in standard
> > locations for the Rtools root and finding the relative paths by
> > querying some file in the Rtools installation itself.  devtools does
> > this by querying the Rtools version and uss an internal database of
> > relative paths keyed by version.   R.bat in batchfiles does it by
> > scanning the Rtools unins000.dat file and extracting the relative
> > paths directly from it.  This has the advantage that no database need
> > be maintained and it also automatically adapts to new versions of
> > Rtools without any foreknowledge of them.   Of course since you have
> > control of both ends you alternately could add the relative paths to
> > an expanded version of the VERSION file or add some additional text
> > file into Rtools for the purpose of identifying he relative paths..
> >
> > Another possibility if significant changes were to be considered would
> > be to make Rtools into an R package thereby leveraging existing
> > facilities and much simplifying any synchronization.
> >
> > --
> > Statistics & Software Consulting
> > GKX Group, GKX Associates Inc.
> > tel: 1-877-GKX-GROUP
> > email: ggrothendieck at gmail.com
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >


From takahashi.kohske at gmail.com  Tue Apr 30 08:30:56 2013
From: takahashi.kohske at gmail.com (Kohske Takahashi)
Date: Tue, 30 Apr 2013 15:30:56 +0900
Subject: [Rd] trace with reference class
Message-ID: <CAC-jPZpk4NZrrTOReeHXOTZOFxD7sC=8iDAunWeoRTzqYwv8cg@mail.gmail.com>

Hi

The final line of the example in ?setRefClass induces an error:

> ## debugging all objects from class mEdit in method $undo()
> mEdit$trace(undo, browser)
Error in envRefInferField(x, what, getClass(class(x)), selfEnv) :
  'undo' is not a valid field or method name for reference class
"refGeneratorSlot"

$trace tries to embed the trace in the generator object (instead of
the generated object).
Has this functionality been removed?

best,

kohske

--
Kohske Takahashi <takahashi.kohske at gmail.com>

Assistant Professor,
Research Center for Advanced Science and Technology,
The University of  Tokyo, Japan.
http://www.fennel.rcast.u-tokyo.ac.jp/profilee_ktakahashi.html


From suharto_anggono at yahoo.com  Tue Apr 30 09:38:45 2013
From: suharto_anggono at yahoo.com (Suharto Anggono Suharto Anggono)
Date: Tue, 30 Apr 2013 00:38:45 -0700 (PDT)
Subject: [Rd] Subset of a 'table' divided by a 'table' is a 'table',
	but printed by 'print.default'
Message-ID: <1367307525.65406.YahooMailClassic@web125103.mail.ne1.yahoo.com>

This is just info.

I recently got something like this.

> x <- factor(c("A","A","B","B"), levels=c("A","B"))
> y <- factor(c("a","b","a","b"), levels=c("a","b"))
> table(x, y)[, "a"] / table(x)
x
  A   B
0.5 0.5
attr(,"class")
[1] "table"

The printing indicates that the result is of class 'table'. But, the 'print' method of class 'table' does not print attr(,"class"). It seems that 'print.default' is used in the printing. I am OK with it, just unusual.

I think, that is another symptom of an already known behavior as in the following:
- PR#2345: difftime arithmetic
- PR#13209: S4 object does not commute?


> sessionInfo()
R version 3.0.0 (2013-04-03)
Platform: i386-w64-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


From murdoch.duncan at gmail.com  Tue Apr 30 11:49:05 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 30 Apr 2013 05:49:05 -0400
Subject: [Rd] Subset of a 'table' divided by a 'table' is a 'table',
 but printed by 'print.default'
In-Reply-To: <1367307525.65406.YahooMailClassic@web125103.mail.ne1.yahoo.com>
References: <1367307525.65406.YahooMailClassic@web125103.mail.ne1.yahoo.com>
Message-ID: <517F9391.3020406@gmail.com>

On 13-04-30 3:38 AM, Suharto Anggono Suharto Anggono wrote:
> This is just info.
>
> I recently got something like this.
>
>> x <- factor(c("A","A","B","B"), levels=c("A","B"))
>> y <- factor(c("a","b","a","b"), levels=c("a","b"))
>> table(x, y)[, "a"] / table(x)
> x
>    A   B
> 0.5 0.5
> attr(,"class")
> [1] "table"
>
> The printing indicates that the result is of class 'table'. But, the 'print' method of class 'table' does not print attr(,"class"). It seems that 'print.default' is used in the printing. I am OK with it, just unusual.
>
> I think, that is another symptom of an already known behavior as in the following:
> - PR#2345: difftime arithmetic
> - PR#13209: S4 object does not commute?

There are no S4 objects or time objects involved here, so it's likely 
something different.

I notice the following strange behaviour.  If I save the ratio in a 
variable, it prints differently with an explicit print than with auto 
printing:

x <- factor(c("A","A","B","B"), levels=c("A","B"))
y <- factor(c("a","b","a","b"), levels=c("a","b"))
ratio <- table(x, y)[, "a"] / table(x)
ratio          # shows what you saw
print(ratio)   # shows what you expected


Something else that's a little strange:  the numerator does not have 
class "table", so you can get the same results with

ratio <- c(1,1) / table(x)

Looking at the internals, I see that the ratio variable has a class 
attribute, but does not have its "object bit" set.

So it looks like the bug is in the implementation of "/".  Either it 
should drop the class, or it should set the object bit.

The difference in printing between auto-printing and explicit printing 
may be worth addressing, but really objects like ratio shouldn't exist, 
so it's not surprising that they behave strangely.

Duncan Murdoch


>
>
>> sessionInfo()
> R version 3.0.0 (2013-04-03)
> Platform: i386-w64-mingw32/i386 (32-bit)
>
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From David.Pleydell at antilles.inra.fr  Mon Apr 29 15:31:47 2013
From: David.Pleydell at antilles.inra.fr (dpleydell)
Date: Mon, 29 Apr 2013 09:31:47 -0400
Subject: [Rd] Verbose output from R CMD check
In-Reply-To: <BB0B0758-BFC7-47B1-A509-537FBAEC1A23@gmail.com>
References: <51769FFE.2020604@antilles.inra.fr>
	<22AF9B56-93D2-44C3-9879-136AFC61C5A7@r-project.org>
	<5176BA38.1040407@antilles.inra.fr>
	<ADD5064D-988D-4F77-983F-032A6EFD6059@r-project.org>
	<51798B9D.9000406@antilles.inra.fr>
	<BB0B0758-BFC7-47B1-A509-537FBAEC1A23@gmail.com>
Message-ID: <517E7643.5060900@antilles.inra.fr>

>
>> Both the following lines return 0 hits
>> grep printf *.c|grep -v Rprintf|grep -v fprintf
>> grep puts *.c
>>
>> Is there some way to detect what has caused this warning about puts?
>> It's not a call to 'puts' or 'printf' because there are none.
> Longshot:
>
> grep '[^Rf]printf' *.c

Peter's longshot hit the bull's eye, this was the offending line

foobar.c:  if (*smoothOrStochastic==0) Rprintf("0\n"); else (printf("1\n"));

So I clearly need to brush up a little on regular expressions. The 
mistake is the scripting was that I used this

find . -maxdepth 1 -type f -name '*.c' -exec sed -i 's\printf\Rprintf\'{} \;
find . -maxdepth 1 -type f -name '*.c' -exec sed -i 's\fRprintf\fprintf\' {} \;

and not this

find . -maxdepth 1 -type f -name '*.c' -exec sed -i 's\printf\Rprintf\g'{} \;
find . -maxdepth 1 -type f -name '*.c' -exec sed -i 's\fRprintf\fprintf\g' {} \;

Many thanks Simon, Peter and Martin for your suggestions, R CMD check 
now runs clean :-)
David


-- 
David Pleydell,
INRA,
UMR-1351 CMAEE,
Domaine Duclos,
Prise D'eau,
97122 Petit Bourg,
Guadeloupe
dpleydell at antilles.inra.fr
pleydell at cirad.fr
Tel +33 5 90 25 54 42
Fax +33 5 90 94 03 96


From Paul.Ryan at csiro.au  Tue Apr 30 03:51:34 2013
From: Paul.Ryan at csiro.au (Paul.Ryan at csiro.au)
Date: Tue, 30 Apr 2013 01:51:34 +0000
Subject: [Rd] performance issue with as.Date
Message-ID: <FDEB353AE68B414399F294C4E532A972C0F0@exmbx06-cdc.nexus.csiro.au>

We encounted a performance problem when a large number of R scripts are run simulatanously.  A large number of stat() system calls to /etc/timezone was limiting how many scripts could be run effectively.  I traced the problem to as.Date.character where strptime() is called without a timezone argument when there is no format argument.

as.Date.character <- function(x, format="", ...)
{
    charToDate <- function(x) {
        xx <- x[1L]
        if(is.na(xx)) {
            j <- 1L
            while(is.na(xx) && (j <- j+1L) <= length(x)) xx <- x[j]
            if(is.na(xx)) f <- "%Y-%m-%d" # all NAs
        }
        if(is.na(xx) ||
           !is.na(strptime(xx, f <- "%Y-%m-%d", tz="GMT")) ||
           !is.na(strptime(xx, f <- "%Y/%m/%d", tz="GMT"))
           ) return(strptime(x, f))
        stop("character string is not in a standard unambiguous format")
    }
    res <- if(missing(format)) charToDate(x) else strptime(x, format, tz="GMT")
    as.Date(res)
}

We could easily workaround this by specifying a format.  My question is, should strptime(x, f) have a tz argument as in the case where a format is specified?

Thanks,

Paul


From b.rowlingson at lancaster.ac.uk  Tue Apr 30 12:51:30 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 30 Apr 2013 11:51:30 +0100
Subject: [Rd] Subset of a 'table' divided by a 'table' is a 'table',
 but printed by 'print.default'
In-Reply-To: <eba54a80f57a48799228f9b2f8798db4@EX-0-HT0.lancs.local>
References: <1367307525.65406.YahooMailClassic@web125103.mail.ne1.yahoo.com>
	<eba54a80f57a48799228f9b2f8798db4@EX-0-HT0.lancs.local>
Message-ID: <CANVKczOhr5iv4=24JD93F=kF2Ze4zgN1EGMtabmgSo=o5B4T8w@mail.gmail.com>

On Tue, Apr 30, 2013 at 10:49 AM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:

> So it looks like the bug is in the implementation of "/".  Either it
> should drop the class, or it should set the object bit.
>
> The difference in printing between auto-printing and explicit printing
> may be worth addressing, but really objects like ratio shouldn't exist,
> so it's not surprising that they behave strangely.

 Also happens with *, if LHS is not a scalar:

 > c(1,1)*table(x)
x
A B
2 2
attr(,"class")
[1] "table"

 > 1*table(x)
x
A B
2 2

 - similar with + and -, but not unary + and -.

 Nice to see a bug in arithmetic operators that isn't covered by
everyone screaming "FAQ 7.31!!!"

Barry


From murdoch.duncan at gmail.com  Tue Apr 30 13:03:50 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 30 Apr 2013 07:03:50 -0400
Subject: [Rd] Subset of a 'table' divided by a 'table' is a 'table',
 but printed by 'print.default'
In-Reply-To: <CANVKczOhr5iv4=24JD93F=kF2Ze4zgN1EGMtabmgSo=o5B4T8w@mail.gmail.com>
References: <1367307525.65406.YahooMailClassic@web125103.mail.ne1.yahoo.com>
	<eba54a80f57a48799228f9b2f8798db4@EX-0-HT0.lancs.local>
	<CANVKczOhr5iv4=24JD93F=kF2Ze4zgN1EGMtabmgSo=o5B4T8w@mail.gmail.com>
Message-ID: <517FA516.7060003@gmail.com>

On 13-04-30 6:51 AM, Barry Rowlingson wrote:
> On Tue, Apr 30, 2013 at 10:49 AM, Duncan Murdoch
> <murdoch.duncan at gmail.com> wrote:
>
>> So it looks like the bug is in the implementation of "/".  Either it
>> should drop the class, or it should set the object bit.
>>
>> The difference in printing between auto-printing and explicit printing
>> may be worth addressing, but really objects like ratio shouldn't exist,
>> so it's not surprising that they behave strangely.
>
>   Also happens with *, if LHS is not a scalar:
>
>   > c(1,1)*table(x)
> x
> A B
> 2 2
> attr(,"class")
> [1] "table"
>
>   > 1*table(x)
> x
> A B
> 2 2
>
>   - similar with + and -, but not unary + and -.
>
>   Nice to see a bug in arithmetic operators that isn't covered by
> everyone screaming "FAQ 7.31!!!"

Yes :-).

I will fix it.

Duncan Murdoch


From murdoch.duncan at gmail.com  Tue Apr 30 15:36:39 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 30 Apr 2013 09:36:39 -0400
Subject: [Rd] Subset of a 'table' divided by a 'table' is a 'table',
 but printed by 'print.default'
In-Reply-To: <1367307525.65406.YahooMailClassic@web125103.mail.ne1.yahoo.com>
References: <1367307525.65406.YahooMailClassic@web125103.mail.ne1.yahoo.com>
Message-ID: <517FC8E7.3080608@gmail.com>

On 13-04-30 3:38 AM, Suharto Anggono Suharto Anggono wrote:
> This is just info.
>
> I recently got something like this.
>
>> x <- factor(c("A","A","B","B"), levels=c("A","B"))
>> y <- factor(c("a","b","a","b"), levels=c("a","b"))
>> table(x, y)[, "a"] / table(x)
> x
>    A   B
> 0.5 0.5
> attr(,"class")
> [1] "table"
>
> The printing indicates that the result is of class 'table'. But, the 'print' method of class 'table' does not print attr(,"class"). It seems that 'print.default' is used in the printing. I am OK with it, just unusual.

This is fixed as of r62697 in R-devel and R-patched.

The documentation in ?Arithmetic was also inaccurate, and has been 
modified.  The correct description is now:

   The rules for determining the attributes of the result are rather
   complicated.  Most attributes are taken from the longer argument.
   Names will be copied from the first if it is the same length as the
   answer, otherwise from the second if that is.  If the arguments are
   the same length, attributes will be copied from both, with those of
   the first argument taking precedence when the same attribute is
   present in both arguments. For time series, these operations are
   allowed only if the series are compatible, when the class and
   \code{\link{tsp}} attribute of whichever is a time series (the same,
   if both are) are used.  For arrays (and an array result) the
   dimensions and dimnames are taken from first argument if it is an
   array, otherwise the second.

This was true for R 3.0.0 and earlier as well, but before my patch while 
the class was copied from the second argument, the object bit was copied 
from the first argument.  Now things are consistent.

Duncan Murdoch


> I think, that is another symptom of an already known behavior as in the following:
> - PR#2345: difftime arithmetic
> - PR#13209: S4 object does not commute?
>
>
>> sessionInfo()
> R version 3.0.0 (2013-04-03)
> Platform: i386-w64-mingw32/i386 (32-bit)
>
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


