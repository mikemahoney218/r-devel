From enrico.bibbona at unito.it  Tue Nov  3 12:16:47 2015
From: enrico.bibbona at unito.it (Enrico Bibbona)
Date: Tue, 3 Nov 2015 12:16:47 +0100
Subject: [Rd] Fwd: Rcpp sugar dpois
In-Reply-To: <CAFvnaTYbPv8heJK9geL3gTTG7bUqqWv5yN2yjdjjkXzxDz8hkg@mail.gmail.com>
References: <CAFvnaTYbPv8heJK9geL3gTTG7bUqqWv5yN2yjdjjkXzxDz8hkg@mail.gmail.com>
Message-ID: <CAFvnaTaqGzewyfvuMowHHELWDi6p4-0ueYBA5Yd83-6OuskBzQ@mail.gmail.com>

Hi. Here is a piece of cpp code.
It works, but I do not understand the rational for the use of
"R::dpois" to call the function dpois since in the examples I have always
found directly "dpois" or "Rcpp::dpois" that both do not work in my code.
Could anyone be so patient to explain me why should it be like that?
Thaks a lot, Enrico

#include <Rcpp.h>
using namespace Rcpp;
NumericVector pcUtildedatoU(NumericVector z, double j, double par)

{
    int l_z=z.size();
    NumericVector out(l_z);
    for (int w=0; w<= (l_z-1); w++)
    {
        double outcand=0;
        double d=z[w];
        if (d >= j)
            outcand=1;
        else if (d>= -j)
        {
            for(int i=-j; i<=d; i+=2)
                outcand+= R::dpois((i+j)/2, par,false)* R::dpois((j-i)/2,
par,false);
            outcand=outcand/R::dpois(j, 2*par,false);
        }
        out[w]=outcand;
    }
    return out;
}

-- 
Enrico Bibbona
Dipartimento di Matematica
Universit? di Torino
https://sites.google.com/site/enricobibbona/



-- 
Enrico Bibbona
Dipartimento di Matematica
Universit? di Torino
https://sites.google.com/site/enricobibbona/

	[[alternative HTML version deleted]]


From edd at debian.org  Tue Nov  3 13:23:17 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Tue, 3 Nov 2015 06:23:17 -0600
Subject: [Rd] Fwd: Rcpp sugar dpois
In-Reply-To: <CAFvnaTaqGzewyfvuMowHHELWDi6p4-0ueYBA5Yd83-6OuskBzQ@mail.gmail.com>
References: <CAFvnaTYbPv8heJK9geL3gTTG7bUqqWv5yN2yjdjjkXzxDz8hkg@mail.gmail.com>
	<CAFvnaTaqGzewyfvuMowHHELWDi6p4-0ueYBA5Yd83-6OuskBzQ@mail.gmail.com>
Message-ID: <22072.42805.772724.87466@max.nulle.part>


On 3 November 2015 at 12:16, Enrico Bibbona wrote:
| Hi. Here is a piece of cpp code.

Somewhat wrong list -- try rcpp-devel for Rcpp questions.

| It works, but I do not understand the rational for the use of
| "R::dpois" to call the function dpois since in the examples I have always

Choice is good.  In Rcpp, the R namespace also offers the scalar variants of
the d/p/q/r functions described in Rmath.h -- besides the vectorised variants
in the Rcpp namespace.

| found directly "dpois" or "Rcpp::dpois" that both do not work in my code.

As you do not show the non-working code, I cannot help with your problem.
Here is simple feasibility test:

R> cppFunction("NumericVector dp(NumericVector x, double lambda) { return dpois(x, lambda, false); }")
R> dp(0:4, 0.5)
[1] 0.60653066 0.30326533 0.07581633 0.01263606 0.00157951
R> dpois(0:4, 0.5)
[1] 0.60653066 0.30326533 0.07581633 0.01263606 0.00157951
R> 

This uses Rcpp::dpois works with a vectorised first argument at the C++
level, and then behaves identical to the R function we call for
comparison. R::dpois, which you use, takes a scalar 'double' which is why you
need to loop by hand.

Please consider posting on Rcpp-devel next time. Remeber to subscribe before
you attempt to post.

Dirk

| Could anyone be so patient to explain me why should it be like that?
| Thaks a lot, Enrico
| 
| #include <Rcpp.h>
| using namespace Rcpp;
| NumericVector pcUtildedatoU(NumericVector z, double j, double par)
| 
| {
|     int l_z=z.size();
|     NumericVector out(l_z);
|     for (int w=0; w<= (l_z-1); w++)
|     {
|         double outcand=0;
|         double d=z[w];
|         if (d >= j)
|             outcand=1;
|         else if (d>= -j)
|         {
|             for(int i=-j; i<=d; i+=2)
|                 outcand+= R::dpois((i+j)/2, par,false)* R::dpois((j-i)/2,
| par,false);
|             outcand=outcand/R::dpois(j, 2*par,false);
|         }
|         out[w]=outcand;
|     }
|     return out;
| }
| 
| -- 
| Enrico Bibbona
| Dipartimento di Matematica
| Universit? di Torino
| https://sites.google.com/site/enricobibbona/
| 
| 
| 
| -- 
| Enrico Bibbona
| Dipartimento di Matematica
| Universit? di Torino
| https://sites.google.com/site/enricobibbona/
| 
| 	[[alternative HTML version deleted]]
| 
| ______________________________________________
| R-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-devel
-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From jwood000 at gmail.com  Tue Nov  3 23:04:56 2015
From: jwood000 at gmail.com (Joseph Wood)
Date: Tue, 3 Nov 2015 17:04:56 -0500
Subject: [Rd] Major Platform Discrepancies
Message-ID: <CAKDcrShiU0GPOHRR=gTWL33BEi0s6EtUt805FD78q0xMoKb5Zg@mail.gmail.com>

I posted a question on stackoverflow dealing with determining elemental
existence in a vector, and to my surprise, the method that was brutally
slow for me on my PC was insanely fast on one of the member's platform (he
was running Linux).  You can view the details here.

http://stackoverflow.com/questions/33453141/most-efficient-way-to-determine-if-element-exists-in-a-vector

I didn't know if this was something that needed to be addressed.

Regards,
Joseph Wood

	[[alternative HTML version deleted]]


From pdalgd at gmail.com  Tue Nov  3 23:50:18 2015
From: pdalgd at gmail.com (peter dalgaard)
Date: Tue, 3 Nov 2015 23:50:18 +0100
Subject: [Rd] Major Platform Discrepancies
In-Reply-To: <CAKDcrShiU0GPOHRR=gTWL33BEi0s6EtUt805FD78q0xMoKb5Zg@mail.gmail.com>
References: <CAKDcrShiU0GPOHRR=gTWL33BEi0s6EtUt805FD78q0xMoKb5Zg@mail.gmail.com>
Message-ID: <73A7139B-8CA5-42D4-9009-E8773F85A364@gmail.com>


> On 03 Nov 2015, at 23:04 , Joseph Wood <jwood000 at gmail.com> wrote:
> 
> I posted a question on stackoverflow dealing with determining elemental
> existence in a vector, and to my surprise, the method that was brutally
> slow for me on my PC was insanely fast on one of the member's platform (he
> was running Linux).  You can view the details here.
> 
> http://stackoverflow.com/questions/33453141/most-efficient-way-to-determine-if-element-exists-in-a-vector
> 
> I didn't know if this was something that needed to be addressed.

Well, since one platform was R 3.2.1 and the other was R-devel, it might just be worth checking the NEWS.Rd file for items like

     \item \code{match(x, table)} is faster, sometimes by an order of
      magnitude, when \code{x} is of length one and \code{incomparables}
      is unchanged, thanks to Haverty's \PR{16491}.

-pd


> 
> Regards,
> Joseph Wood
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From xavier at 4ecap.com  Wed Nov  4 06:39:00 2015
From: xavier at 4ecap.com (Xavier Faure-Miller)
Date: Wed, 4 Nov 2015 13:39:00 +0800
Subject: [Rd] setOldClass("xts")
Message-ID: <CAM2mAMQoAe8B8fXa-0woF5v6wKgxkgVEf391EFd9nSjY=-_OzA@mail.gmail.com>

Hello,

I apologize that I am cross posting here after getting no answer from
my initial
question on stack overflow
<http://stackoverflow.com/questions/33492601/r-setoldclass-only-if-needed>.
I should certainly have posted it first here..


I am using 3 packages:

   - xts
   - quantmod
   - 'myPackage'

quantmod is creating a union class by doing:

setOldClass("xts");
setClassUnion("xtsORzoo", c("xts","zoo"))

In 'myPackage' I am also creating a union class by doing

setOldClass("xts");
setClassUnion("xtsOrNULL",members=c("xts", "NULL"))

I did not notice any issue until: Since version 3.2.2
<https://cran.r-project.org/doc/manuals/r-release/NEWS.html>, R is
displaying a warning as soon as I manipulate an object of class xts:

Found more than one class "xts" in cache; using the first, from
namespace 'quantmod'Found more than one class "xts" in cache; using
the first, from namespace 'quantmod'


Indeed in this case it seems we are creating 2 virtual class for xts, one
in package environement quantmod and one in package environment myPackage.
Each is extended by different unionClass.

1) is it a problem (appart from this annoying warning?)
2) Should I instead use

if (is.null(.Call(methods:::C_R_getClassFromCache, "xts",
methods:::.classTable))) setOldClass("xts")

So that I create the virtual class only of it has not been created by
someone else in another package (and by the way in this case quantmod
should do the same to avoid issues when packages are loaded in a different
order)

3) and finally, is it not a bug in getClass ? I would have expected it to
first try to get the class definition from the parent environment. The fact
that I get the warning shows that it searches all environements, finds 2
classes from 2 different environments and chooses arbitrarily.

Thank you

*Disclaimer:* This email does not constitute investment advice or counsel
or solicitation for investment of any product or fund. This email does not
constitute or form part of, and should not be construed as, any offer for
sale or subscription of, or any invitation to offer to buy or subscribe
for, any investments, nor should it or any part of it form the basis of, or
be relied on in any connection with, any contract or commitment whatsoever.
FOUR ELEMENTS CAPITAL expressly disclaims any and all responsibility for
any direct or consequential loss or damage of any kind whatsoever arising
directly or indirectly from: (i) the use of this email, (ii) reliance on
any information contained herein, (iii) any error, omission or inaccuracy
in any such information. This communication is confidential, may be
privileged and is meant only for the intended recipient.  If you are not
the intended recipient, please notify the sender by reply and delete this
message from your system.  Any unauthorised dissemination, distribution or
copying hereof is prohibited.

	[[alternative HTML version deleted]]


From aixtools at gmail.com  Wed Nov  4 13:46:25 2015
From: aixtools at gmail.com (aixtools)
Date: Wed, 04 Nov 2015 13:46:25 +0100
Subject: [Rd] Understanding r-patched sources and R-devel sources plus tool
	sync
Message-ID: <5639FE21.3040307@gmail.com>

Is this a patched developed, or patched latest version (e.g., now that 
would be a patched R-3.2.2).

Also, regarding the following:

After downloading the R sources you should also download the recommended 
packages by entering the R source tree and running

     tools/rsync-recommended

Should this be done to "complete" a patched version as well. My understanding now is that there are updates to "tools" that are not included in the daily
-devel and/or -patch releases.

Thank you for the clarification!


From h.wickham at gmail.com  Wed Nov  4 15:00:57 2015
From: h.wickham at gmail.com (Hadley Wickham)
Date: Wed, 4 Nov 2015 09:00:57 -0500
Subject: [Rd] setOldClass("xts")
In-Reply-To: <CAM2mAMQoAe8B8fXa-0woF5v6wKgxkgVEf391EFd9nSjY=-_OzA@mail.gmail.com>
References: <CAM2mAMQoAe8B8fXa-0woF5v6wKgxkgVEf391EFd9nSjY=-_OzA@mail.gmail.com>
Message-ID: <CABdHhvGmMRJc5LmOPDsLXfaAzhobmNz5uBD4QsRMdjrQXLUqRg@mail.gmail.com>

Can you import the xts class from quantmod in your NAMESPACE?

Hadley

On Wed, Nov 4, 2015 at 12:39 AM, Xavier Faure-Miller <xavier at 4ecap.com> wrote:
> Hello,
>
> I apologize that I am cross posting here after getting no answer from
> my initial
> question on stack overflow
> <http://stackoverflow.com/questions/33492601/r-setoldclass-only-if-needed>.
> I should certainly have posted it first here..
>
>
> I am using 3 packages:
>
>    - xts
>    - quantmod
>    - 'myPackage'
>
> quantmod is creating a union class by doing:
>
> setOldClass("xts");
> setClassUnion("xtsORzoo", c("xts","zoo"))
>
> In 'myPackage' I am also creating a union class by doing
>
> setOldClass("xts");
> setClassUnion("xtsOrNULL",members=c("xts", "NULL"))
>
> I did not notice any issue until: Since version 3.2.2
> <https://cran.r-project.org/doc/manuals/r-release/NEWS.html>, R is
> displaying a warning as soon as I manipulate an object of class xts:
>
> Found more than one class "xts" in cache; using the first, from
> namespace 'quantmod'Found more than one class "xts" in cache; using
> the first, from namespace 'quantmod'
>
>
> Indeed in this case it seems we are creating 2 virtual class for xts, one
> in package environement quantmod and one in package environment myPackage.
> Each is extended by different unionClass.
>
> 1) is it a problem (appart from this annoying warning?)
> 2) Should I instead use
>
> if (is.null(.Call(methods:::C_R_getClassFromCache, "xts",
> methods:::.classTable))) setOldClass("xts")
>
> So that I create the virtual class only of it has not been created by
> someone else in another package (and by the way in this case quantmod
> should do the same to avoid issues when packages are loaded in a different
> order)
>
> 3) and finally, is it not a bug in getClass ? I would have expected it to
> first try to get the class definition from the parent environment. The fact
> that I get the warning shows that it searches all environements, finds 2
> classes from 2 different environments and chooses arbitrarily.
>
> Thank you
>
> *Disclaimer:* This email does not constitute investment advice or counsel
> or solicitation for investment of any product or fund. This email does not
> constitute or form part of, and should not be construed as, any offer for
> sale or subscription of, or any invitation to offer to buy or subscribe
> for, any investments, nor should it or any part of it form the basis of, or
> be relied on in any connection with, any contract or commitment whatsoever.
> FOUR ELEMENTS CAPITAL expressly disclaims any and all responsibility for
> any direct or consequential loss or damage of any kind whatsoever arising
> directly or indirectly from: (i) the use of this email, (ii) reliance on
> any information contained herein, (iii) any error, omission or inaccuracy
> in any such information. This communication is confidential, may be
> privileged and is meant only for the intended recipient.  If you are not
> the intended recipient, please notify the sender by reply and delete this
> message from your system.  Any unauthorised dissemination, distribution or
> copying hereof is prohibited.
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 
http://had.co.nz/


From aixtools at gmail.com  Wed Nov  4 16:51:53 2015
From: aixtools at gmail.com (aixtools)
Date: Wed, 04 Nov 2015 16:51:53 +0100
Subject: [Rd] Building R for AIX in 64-bit mode
In-Reply-To: <561FA401.7010207@stats.ox.ac.uk>
References: <CANvxniVBrCaT1C3HosULfg4OfBNkL-vQqnFuTt+j=pfMbovX_Q@mail.gmail.com>
	<561FA401.7010207@stats.ox.ac.uk>
Message-ID: <563A2999.8020104@gmail.com>

On 2015-10-15 15:02, Prof Brian Ripley wrote:
> On 15/10/2015 13:32, Michael Felt wrote:
>> Hi.
>>
>> Just wanted to let you know I am getting close to packaging R for AIX in
>> 64.bit mode.
>
> Which version? (You mentioned 3.1.3 and 3.2.2 far below.)  There is 
> little value in reporting on frozen branches, and most value in 
> reporting on R-devel where all the current changes have been 
> incorporated.
This report is based on R-3.2.2 I shall repeat asap with R-devel and 
report any significant differences.
compiler is:
root at x072:[/data/prj/cran/64/R-3.2.2/src/main]gcc --version
gcc (GCC) 4.7.4
Copyright (C) 2012 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

root at x072:[/data/prj/cran/64/R-3.2.2/src/main]gfortran --version
GNU Fortran (GCC) 4.7.4
Copyright (C) 2012 Free Software Foundation, Inc.

AIX level:
root at x072:[/data/prj/cran/64/R-3.2.2/src/main]oslevel -s
7100-03-05-1524

Non-IBM filesets installed:
root at x072:[/data/prj/cran/64/R-3.2.2/src/main]lslpp -L | grep aixtools
   aixtools.buildaix.man      2.0.1.0    C     F    man pages
   aixtools.buildaix.man.en_US
   aixtools.buildaix.rte      2.0.3.1    C     F    1540 1007 2004
   aixtools.gmp.rte           5.0.5.0    C     F    gmp version 5.0.5 
for powerpc
   aixtools.gmp.share         5.0.5.0    C     F    gmp share and 
documentation
   aixtools.gnu.bash.man.en_US
   aixtools.gnu.bash.rte     4.3.42.0    C     F    1537 0913 1505
   aixtools.gnu.bash.share   4.3.42.0    C     F    universal pages
   aixtools.gnu.coreutils.rte
   aixtools.gnu.gettext.rte  0.19.5.0    C     F    1531 0807 0000
   aixtools.gnu.gettext.share
   aixtools.gnu.make.rte      4.1.0.0    C     F    1523 0613 1158
   aixtools.gnu.wget.man.en_US
   aixtools.gnu.wget.rte     1.16.3.0    C     F    1530 0731 0651
   aixtools.gnu.wget.share   1.16.3.0    C     F    universal pages
   aixtools.libiconv.man     1.14.0.0    C     F    built 1447 1127 1728
   aixtools.libiconv.rte     1.14.0.0    C     F    libiconv 1447 1127 1728
   aixtools.libiconv.share   1.14.0.0    C     F    built 1447 1127 1728
   aixtools.mpc.rte           1.0.2.0    C     F    mpc 2014.Oct.31 
15.44 CUT
   aixtools.mpc.share         1.0.2.0    C     F    share and documentation
   aixtools.mpfr.rte          2.4.2.0    C     F    mpfr 2014.Oct.31 
15.19 CUT
   aixtools.mpfr.share        2.4.2.0    C     F    share and documentation
   aixtools.obj.gcc.man       4.7.4.0    C     F    man pages
   aixtools.obj.gcc.rte       4.7.4.0    C     F    1515 0416 2134
   aixtools.obj.gcc.share     4.7.4.0    C     F    universal pages
   aixtools64.gnu.libiconv.rte

>> export OBJECT_MODE=64
>> export CFLAGS="-maix64 -O2"
>> export FFLAGS="-maix64 -O2"
>
> See the manual: flags such as -maix64 should be part of CC, not 
> CFLAGS.  That explains a lot of what was reported.
> Specifically, 
> https://cran.r-project.org/doc/manuals/r-patched/R-admin.html#Essential-programs-and-libraries 
> and https://cran.r-project.org/doc/manuals/r-patched/R-admin.html#AIX .
>
> It is safer to put such things on the configure command line or in a 
> config.site file (they will be found when updating if you do).
>
Not sure what you mean by a config.site file - perhaps what I use as a 
"setup.env" script.

I followed the suggestion to move the flag -maix64 from CFLAGS and 
FFLAGS (where I think it belongs) to the compiler defintions. It does 
build better, but, still many concerns.

Details - too many lines of duplicate symbol references to paste (not 
wishing to spam the list - for details see 
http://download.aixtools.net/test/R/R-3.2.2-main-nohup.out
> [Lots of test output removed.]
>
The summary is:
ld: 0711-318 ERROR: Undefined symbols were found.
         The following symbols are in error:
  Symbol                    Inpndx  TY CL Source-File(Object-File) OR 
Import-File{Shared-object}
                               RLD: Address  Section  Rld-type 
Referencing Symbol
  ----------------------------------------------------------------------------------------------
  .pthread_mutex_lock       [24]    ER PR 
pcre_jit_compile.c(../extra/pcre/libpcre.a[pcre_jit_compile.o])
                                    000076f8 .text    R_RBR    [118] 
<.sljit_free_exec>
                                    00007940 .text    R_RBR    [120] 
<.sljit_generate_code>
                                    00028c30 .text    R_RBR    [230]   
.pcre_jit_free_unused_memory
  .pthread_mutex_unlock     [26]    ER PR 
pcre_jit_compile.c(../extra/pcre/libpcre.a[pcre_jit_compile.o])
                                    0000777c .text    R_RBR    [118] 
<.sljit_free_exec>
                                    000079cc .text    R_RBR    [120] 
<.sljit_generate_code>
                                    00007b94 .text    R_RBR    [120] 
<.sljit_generate_code>
                                    00008038 .text    R_RBR    [120] 
<.sljit_generate_code>
                                    00028cc4 .text    R_RBR    [230]   
.pcre_jit_free_unused_memory
ER: The return code is 8.
ld: 0711-415 WARNING: Symbol BM_norm_keep is already exported.
ld: 0711-415 WARNING: Symbol LoadInitFile is already exported.
ld: 0711-415 WARNING: Symbol N01_kind is already exported.
ld: 0711-415 WARNING: Symbol R_ReadItemDepth is already exported.
ld: 0711-224 WARNING: Duplicate symbol: BM_norm_keep
ld: 0711-224 WARNING: Duplicate symbol: N01_kind
ld: 0711-224 WARNING: Duplicate symbol: LoadInitFile
ld: 0711-224 WARNING: Duplicate symbol: R_ReadItemDepth
ld: 0711-317 ERROR: Undefined symbol: .pthread_mutex_lock
ld: 0711-317 ERROR: Undefined symbol: .pthread_mutex_unlock
collect2: error: ld returned 8 exit status

The undefined sysbols can be resolved by adding -lpthread to the gcc 
command (and can be automated by adding that to LDFLAGS I expect, but 
imho - better if that gets caught by configure).

It then ends with:

RESOLVE: 6793 of 18448 symbols were kept.
RESOLVE: The return code is 4.
(ld): addgl /usr/lib/glink64.o
ADDGL: Glink code added for 212 symbols.
(ld): er full
ER: There are no unresolved symbols.
(ld): mismatch
MISMATCH: No type mismatches exist.
(ld): comprld
COMPRLD: Kept 52596 of 52596 relocation entries.
(ld): origin page 0x100000000 0x110000000
(ld): libpath 
/usr/local/lib:/opt/lib/gcc/powerpc-ibm-aix5.3.0.0/4.7.4/ppc64:/opt/lib/gcc/powerpc-ibm-aix5.3.0.0/4.7.4/../../../ppc64:/opt/lib/gcc/powerpc-ibm-aix5.3.0.0/4.7.4:/opt/lib/gcc/powerpc-ibm-aix5.3.0.0/4.7.4/../../..:/usr/lib:/lib
LIBPATH: Library path set to 
/usr/local/lib:/opt/lib/gcc/powerpc-ibm-aix5.3.0.0/4.7.4/ppc64:/opt/lib/gcc/powerpc-ibm-aix5.3.0.0/4.7.4/../../../ppc64:/opt/lib/gcc/powerpc-ibm-aix5.3.0.0/4.7.4:/opt/lib/gcc/powerpc-ibm-aix5.3.0.0/4.7.4/../../..:/usr/lib:/lib
(ld): save 1L .
SAVE: Section sizes = 3374479+365673+669656 (0x337D8F+0x59469+0xA37D8 hex)
SAVE: Size of TOC: 5208 (0x1458 hex)
SAVE: No .loader section relocation entries exist for the .text section.
(ld): rc
RC: Highest return code was 4.
ld: 0711-415 WARNING: Symbol BM_norm_keep is already exported.
ld: 0711-415 WARNING: Symbol LoadInitFile is already exported.
ld: 0711-415 WARNING: Symbol N01_kind is already exported.
ld: 0711-415 WARNING: Symbol R_ReadItemDepth is already exported.
ld: 0711-224 WARNING: Duplicate symbol: BM_norm_keep
ld: 0711-224 WARNING: Duplicate symbol: N01_kind
ld: 0711-224 WARNING: Duplicate symbol: LoadInitFile
ld: 0711-224 WARNING: Duplicate symbol: R_ReadItemDepth

a) There is still a non-zero status (rc=4)
b) unhappy about all the duplications, even double exports


From aixtools at gmail.com  Wed Nov  4 17:31:13 2015
From: aixtools at gmail.com (aixtools)
Date: Wed, 04 Nov 2015 17:31:13 +0100
Subject: [Rd] Building R for AIX in 64-bit mode
In-Reply-To: <563A2999.8020104@gmail.com>
References: <CANvxniVBrCaT1C3HosULfg4OfBNkL-vQqnFuTt+j=pfMbovX_Q@mail.gmail.com>
	<561FA401.7010207@stats.ox.ac.uk> <563A2999.8020104@gmail.com>
Message-ID: <563A32D1.5000305@gmail.com>

On 2015-11-04 16:51, aixtools wrote:
> On 2015-10-15 15:02, Prof Brian Ripley wrote:
>> On 15/10/2015 13:32, Michael Felt wrote:
>>> Hi.
>>>
>>> Just wanted to let you know I am getting close to packaging R for 
>>> AIX in
>>> 64.bit mode.
>>
>> Which version? (You mentioned 3.1.3 and 3.2.2 far below.)  There is 
>> little value in reporting on frozen branches, and most value in 
>> reporting on R-devel where all the current changes have been 
>> incorporated.
> This report is based on R-3.2.2 I shall repeat asap with R-devel and 
> report any significant differences.
"A lot of hassle I fear - still not done" - so a brief update - and 
question - is this change (since 2015-10-17) really needed?

R-devel update (compared to R-3.2.2)

configure is now requiring bzlib.h - no idea what adding the file 
actually adds - but will do so.
I guess it is something someone added - when the real issue would be the 
library to link to!

configure:35647: checking bzlib.h presence
configure:35647: gcc -maix64 -E -I/opt/buildaix/include -I/opt/include  
conftest.c
configure:35647: $? = 1
configure: failed program was:
configure:35647: result: no
configure:35647: checking for bzlib.h
configure:35647: result: no
configure:35712: checking whether bzip2 support suffices
configure:35719: error: bzip2 library and headers are required
configure: exit 1

And after adding that:
configure:35689: gcc -maix64 -std=gnu99 -o conftest -I/opt/64/include 
-I/opt/buildaix/include -O2 -mminimal-toc -I/opt/buildaix/include 
-I/opt/include  -L/usr/local/lib conftest.c -lbz2 -lz -lrt -ldl -lm  
-liconv >&5
configure:35689: $? = 0
configure:35689: ./conftest
configure:35689: $? = 1
configure: program exited with status 1
configure: failed program was:
configure:35706: result: no
configure:35712: checking whether bzip2 support suffices
configure:35719: error: bzip2 library and headers are required
configure: exit 1
++++ ++++
root at x072:[/data/prj/cran/64/R-devel]lslpp -w | grep bz2.a
   /usr/opt/freeware/lib/libbz2.a              rpm.rte               File
root at x072:[/data/prj/cran/64/R-devel]find /usr /opt -name libbz2.a
/usr/lib/libbz2.a
/opt/freeware/lib/libbz2.a
root at x072:[/data/prj/cran/64/R-devel]find /usr /opt -name libbz2.a -ls
12472    1 lrwxrwxrwx  1 root      system          30 Oct 12 12:20 
/usr/lib/libbz2.a -> /usr/opt/freeware/lib/libbz2.a
  4119  193 -rwxr-xr-x  1 root      system      197216 Dec 20  2010 
/opt/freeware/lib/libbz2.a
root at x072:[/data/prj/cran/64/R-devel]find /usr /opt -name bzlib.h -ls
66420    7 -rw-r--r--  1 root      system        6245 Nov  3 10:15 
/opt/buildaix/include/bzlib.h

Seems a very specific bzip2 library is desired - 1.0.6 - not what the 
message says!

BZ2_version():1.0.5, 10-Dec-2007

/* end confdefs.h.  */
#include <stdio.h>

#ifdef HAVE_BZLIB_H
#include <bzlib.h>
#endif
int main() {
     char *ver = BZ2_bzlibVersion();
         fprintf(stderr,"BZ2_version():%s\n",ver); /* added by aixtools 
for debugging */
     exit(strcmp(ver, "1.0.6") < 0);
}

So, my question - is this REALLY needed (v1.0.6) as it may break many 
locations!

Updating bzip2 to pass configure...
Now get:
root at x072:[/data/prj/cran/64/R-devel]./xxx
BZ2_version():1.0.6, 6-Sept-2010

And a repeat for lzma it seems... Again, is this really necessary 
(versus convienent).
configure:35706: result: yes
configure:35712: checking whether bzip2 support suffices
configure:35715: result: no
configure:35724: checking for lzma_version_number in -llzma
configure:35757: gcc -maix64 -std=gnu99 -o conftest -I/opt/64/include 
-I/opt/buildaix/include -O2 -mminimal-toc -I/opt/buildaix/include 
-I/opt/include  -L/usr/local/lib conftest.c -llzma  -lbz2 -lz -lrt -ldl 
-lm  -liconv >&5
configure:35757: $? = 1
configure: failed program was:
configure:35766: result: no
configure:35851: error: "liblzma library and headers are required"
configure: exit 1
++++ ++++

p.s. remember - this is something that has appeared since the R-devel of 
17-10-2015! Has R changed in some way to really need all these extra 
checks - versus - they were added for because they are used elsewhere?


From aixtools at gmail.com  Wed Nov  4 17:46:47 2015
From: aixtools at gmail.com (aixtools)
Date: Wed, 04 Nov 2015 17:46:47 +0100
Subject: [Rd] Building R for AIX in 64-bit mode
In-Reply-To: <563A32D1.5000305@gmail.com>
References: <CANvxniVBrCaT1C3HosULfg4OfBNkL-vQqnFuTt+j=pfMbovX_Q@mail.gmail.com>
	<561FA401.7010207@stats.ox.ac.uk> <563A2999.8020104@gmail.com>
	<563A32D1.5000305@gmail.com>
Message-ID: <563A3677.7090900@gmail.com>

On 2015-11-04 17:31, aixtools wrote:
> On 2015-11-04 16:51, aixtools wrote:
>> On 2015-10-15 15:02, Prof Brian Ripley wrote:
>>> On 15/10/2015 13:32, Michael Felt wrote:
>>>> Hi.
>>>>
>>>> Just wanted to let you know I am getting close to packaging R for 
>>>> AIX in
>>>> 64.bit mode.
>>>
>>> Which version? (You mentioned 3.1.3 and 3.2.2 far below.)  There is 
>>> little value in reporting on frozen branches, and most value in 
>>> reporting on R-devel where all the current changes have been 
>>> incorporated.
>> This report is based on R-3.2.2 I shall repeat asap with R-devel and 
>> report any significant differences.
>
In particular - I wonder about lzma as I already knew this (having built 
xz a long time ago. LZMA has been replaced by XZ. Do not know why, and 
do not want to.
BUT there is no reliable source for LZMA5 (the XZ project only reports 
LZMA2 and LZMA4). Please see the wiki at: 
https://en.wikipedia.org/wiki/XZ_Utils

Paused for now - awaiting reply

> configure:35724: checking for lzma_version_number in -llzma
> configure:35757: gcc -maix64 -std=gnu99 -o conftest -I/opt/64/include 
> -I/opt/buildaix/include -O2 -mminimal-toc -I/opt/buildaix/include 
> -I/opt/include  -L/usr/local/lib conftest.c -llzma  -lbz2 -lz -lrt 
> -ldl -lm  -liconv >&5
> configure:35757: $? = 1
> configure: failed program was:
> configure:35766: result: no
> configure:35851: error: "liblzma library and headers are required"
> configure: exit 1
> ++++ ++++


From mdsumner at gmail.com  Thu Nov  5 00:56:33 2015
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 4 Nov 2015 23:56:33 +0000
Subject: [Rd] navigation mode(s) in rgl
Message-ID: <CAAcGz9_ux8OVhdu-1HbHMMynsLzd9=PdG7FKucJ9WRrQ0bJFYQ@mail.gmail.com>

Hello, I've CCd' Duncan Murdoch as the rgl maintainer, but I'm also keen to
hear from the broader community of any insights.

In rgl my understanding is that there's only one rotation-navigation mode,
where you left-click hold and the view pivots abound the centre of the
scene.

In other tools, including Google Earth, that is the default behaviour but
there's also a click-centric mode where the view pivots about the point
clicked on.

I haven't found the right terminology for this, but I call it

1) Data-centric navigation, rotating about the centre of the data in  the
scene (invoked by left-click-drag in rgl and GE and others)
2) Click-centric navigation, rotating about the point clicked on (invoked
by centre-click-drag in GE and others, but not rgl)

My questions:

1) I'd appreciate any guidance on my terminology here, whether I'm making
sense and ask for pointers to resources that explore this properly
2) Is there scope to add this "click-centric" navigation to rgl? I'd
appreciate any pointers to how it could be done - is it an rgl-level
feature, or deeper down?

I know that "click-centric" clicked-on point has a different meaning in
different contexts, in GE clearly it finds the nearest point intersecting
the globe surface since that is a always-present structure, but other tools
must have rules to specify where the pivot point is - either intersecting a
data element or somewhere in the scene.

The data-centric mode is fine for small scenes with a limited scope, but
when the extent covered by data is large it's quite unwieldy to focus in on
specific parts of the scene. I know this could be controlled by
pushing/popping elements in the scene but the navigation mode obviously
offers more flexibility.

Thank you.

Cheers, Mike.

	[[alternative HTML version deleted]]


From murdoch.duncan at gmail.com  Thu Nov  5 04:01:25 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 4 Nov 2015 22:01:25 -0500
Subject: [Rd] navigation mode(s) in rgl
In-Reply-To: <CAAcGz9_ux8OVhdu-1HbHMMynsLzd9=PdG7FKucJ9WRrQ0bJFYQ@mail.gmail.com>
References: <CAAcGz9_ux8OVhdu-1HbHMMynsLzd9=PdG7FKucJ9WRrQ0bJFYQ@mail.gmail.com>
Message-ID: <563AC685.4070901@gmail.com>

On 04/11/2015 6:56 PM, Michael Sumner wrote:
> Hello, I've CCd' Duncan Murdoch as the rgl maintainer, but I'm also keen to
> hear from the broader community of any insights.
> 
> In rgl my understanding is that there's only one rotation-navigation mode,
> where you left-click hold and the view pivots abound the centre of the
> scene.

That's not quite true:  there are several modes built in, and the
possibility of adding your own.

> In other tools, including Google Earth, that is the default behaviour but
> there's also a click-centric mode where the view pivots about the point
> clicked on.
> 
> I haven't found the right terminology for this, but I call it
> 
> 1) Data-centric navigation, rotating about the centre of the data in  the
> scene (invoked by left-click-drag in rgl and GE and others)
> 2) Click-centric navigation, rotating about the point clicked on (invoked
> by centre-click-drag in GE and others, but not rgl)
> 
> My questions:
> 
> 1) I'd appreciate any guidance on my terminology here, whether I'm making
> sense and ask for pointers to resources that explore this properly
> 2) Is there scope to add this "click-centric" navigation to rgl? I'd
> appreciate any pointers to how it could be done - is it an rgl-level
> feature, or deeper down?

If I understand your description properly, you can add it using the
"user" mouse mode (see ?par3d).  You should also see that help topic for
a description of how rendering is done, and ?rgl.setMouseCallbacks
for an example of doing it.

The hard part in doing this is in working out *exactly* what you want
the mouse to do.  If you work that out for the mode you want but find
the "user" mode is unsatisfactory for some reason, I'd be willing to add
it as another built in mode.

Duncan Murdoch

> 
> I know that "click-centric" clicked-on point has a different meaning in
> different contexts, in GE clearly it finds the nearest point intersecting
> the globe surface since that is a always-present structure, but other tools
> must have rules to specify where the pivot point is - either intersecting a
> data element or somewhere in the scene.
> 
> The data-centric mode is fine for small scenes with a limited scope, but
> when the extent covered by data is large it's quite unwieldy to focus in on
> specific parts of the scene. I know this could be controlled by
> pushing/popping elements in the scene but the navigation mode obviously
> offers more flexibility.


From mdsumner at gmail.com  Thu Nov  5 05:30:00 2015
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 5 Nov 2015 04:30:00 +0000
Subject: [Rd] navigation mode(s) in rgl
In-Reply-To: <563AC685.4070901@gmail.com>
References: <CAAcGz9_ux8OVhdu-1HbHMMynsLzd9=PdG7FKucJ9WRrQ0bJFYQ@mail.gmail.com>
	<563AC685.4070901@gmail.com>
Message-ID: <CAAcGz98psEFquR3dS3y8UDw=RAG6CA2gTt3RWqfQKL_F5Nb1jg@mail.gmail.com>

On Thu, 5 Nov 2015 at 14:01 Duncan Murdoch <murdoch.duncan at gmail.com> wrote:

> On 04/11/2015 6:56 PM, Michael Sumner wrote:
> > Hello, I've CCd' Duncan Murdoch as the rgl maintainer, but I'm also keen
> to
> > hear from the broader community of any insights.
> >
> > In rgl my understanding is that there's only one rotation-navigation
> mode,
> > where you left-click hold and the view pivots abound the centre of the
> > scene.
>
> That's not quite true:  there are several modes built in, and the
> possibility of adding your own.
>
> > In other tools, including Google Earth, that is the default behaviour but
> > there's also a click-centric mode where the view pivots about the point
> > clicked on.
> >
> > I haven't found the right terminology for this, but I call it
> >
> > 1) Data-centric navigation, rotating about the centre of the data in  the
> > scene (invoked by left-click-drag in rgl and GE and others)
> > 2) Click-centric navigation, rotating about the point clicked on (invoked
> > by centre-click-drag in GE and others, but not rgl)
> >
> > My questions:
> >
> > 1) I'd appreciate any guidance on my terminology here, whether I'm making
> > sense and ask for pointers to resources that explore this properly
> > 2) Is there scope to add this "click-centric" navigation to rgl? I'd
> > appreciate any pointers to how it could be done - is it an rgl-level
> > feature, or deeper down?
>
> If I understand your description properly, you can add it using the
> "user" mouse mode (see ?par3d).  You should also see that help topic for
> a description of how rendering is done, and ?rgl.setMouseCallbacks
> for an example of doing it.
>
> The hard part in doing this is in working out *exactly* what you want
> the mouse to do.  If you work that out for the mode you want but find
> the "user" mode is unsatisfactory for some reason, I'd be willing to add
> it as another built in mode.
>
> Duncan Murdoch
>
>

Thank you, I can see the way forward now.

Cheers, Mike.




> >
> > I know that "click-centric" clicked-on point has a different meaning in
> > different contexts, in GE clearly it finds the nearest point intersecting
> > the globe surface since that is a always-present structure, but other
> tools
> > must have rules to specify where the pivot point is - either
> intersecting a
> > data element or somewhere in the scene.
> >
> > The data-centric mode is fine for small scenes with a limited scope, but
> > when the extent covered by data is large it's quite unwieldy to focus in
> on
> > specific parts of the scene. I know this could be controlled by
> > pushing/popping elements in the scene but the navigation mode obviously
> > offers more flexibility.
>
>
>
>

	[[alternative HTML version deleted]]


From richierocks at gmail.com  Thu Nov  5 12:43:56 2015
From: richierocks at gmail.com (Richard Cotton)
Date: Thu, 5 Nov 2015 14:43:56 +0300
Subject: [Rd] PDFs and SVGs containing rasterGrobs don't display correctly
 in some other software
Message-ID: <CAPp_+=fpnH32QHdjyxoaNniSPkLwvENW8afBSL1ZPbPX5WxEPA@mail.gmail.com>

I've just been trying to post-process some R-created heatmaps using
Inkscape, but I can't get them to display correctly in that software.

To reproduce:

library(grid)
r <- as.raster(matrix(runif(25), 5, 5))
pdf("test.pdf")
grid.newpage()
grid.raster(r, interpolate = FALSE)
dev.off()

This figure should be a five by five block of grey squares.  This is
what I see in the R GUI device window, and when I open test.pdf in
Abode Reader or SumatraPDF.

However, when I open the file in Inkscape or Firefox, each of the
squares is blurred.

I tried swapping grDevices::pdf for Cairo::CairoPDF and got the same
result.  I also tried generating SVGs using both grDevices::svg and
Cairo::CairoSVG, and also got the same result.

I see the same thing using R-devel and R3.2.2 under Windows, and (with
an older version of R) under Linux.

I don't know whether the problem is with grid's rasterGrobs, or how R
writes PDF and SVG files, or with Inkscape and Firefox's method of
rendering those files, or with me.  Please can you help me narrow it
down.

- Can you reproduce my problem?  That is, when you run the above code,
does the file look OK in a PDF reader but blurry in Inkscape?
- Do you know of any issues with using rasterGrobs in PDFs or SVGs?

-- 
Regards,
Richie

Learning R
4dpiecharts.com


From h.wickham at gmail.com  Thu Nov  5 14:04:40 2015
From: h.wickham at gmail.com (Hadley Wickham)
Date: Thu, 5 Nov 2015 07:04:40 -0600
Subject: [Rd] PDFs and SVGs containing rasterGrobs don't display
 correctly in some other software
In-Reply-To: <CAPp_+=fpnH32QHdjyxoaNniSPkLwvENW8afBSL1ZPbPX5WxEPA@mail.gmail.com>
References: <CAPp_+=fpnH32QHdjyxoaNniSPkLwvENW8afBSL1ZPbPX5WxEPA@mail.gmail.com>
Message-ID: <CABdHhvGVoeEo77rHiPTsie259o94xarFKMHDvN4SABeHLBNzSQ@mail.gmail.com>

On Thu, Nov 5, 2015 at 5:43 AM, Richard Cotton <richierocks at gmail.com> wrote:
> I've just been trying to post-process some R-created heatmaps using
> Inkscape, but I can't get them to display correctly in that software.
>
> To reproduce:
>
> library(grid)
> r <- as.raster(matrix(runif(25), 5, 5))
> pdf("test.pdf")
> grid.newpage()
> grid.raster(r, interpolate = FALSE)
> dev.off()
>
> This figure should be a five by five block of grey squares.  This is
> what I see in the R GUI device window, and when I open test.pdf in
> Abode Reader or SumatraPDF.
>
> However, when I open the file in Inkscape or Firefox, each of the
> squares is blurred.
>
> I tried swapping grDevices::pdf for Cairo::CairoPDF and got the same
> result.  I also tried generating SVGs using both grDevices::svg and
> Cairo::CairoSVG, and also got the same result.
>
> I see the same thing using R-devel and R3.2.2 under Windows, and (with
> an older version of R) under Linux.
>
> I don't know whether the problem is with grid's rasterGrobs, or how R
> writes PDF and SVG files, or with Inkscape and Firefox's method of
> rendering those files, or with me.  Please can you help me narrow it
> down.
>
> - Can you reproduce my problem?  That is, when you run the above code,
> does the file look OK in a PDF reader but blurry in Inkscape?
> - Do you know of any issues with using rasterGrobs in PDFs or SVGs?

Yes - many viewers (esp. OS X preview) interpolate them even when the
PDF requests that they shouldn't be. I worked through this with Paul
Murrell a couple of months ago - we're reasonably certain that R is
doing the right thing, it's the renderers that are failing.

Hadley

-- 
http://had.co.nz/


From henrik.bengtsson at gmail.com  Thu Nov  5 15:59:29 2015
From: henrik.bengtsson at gmail.com (Henrik Bengtsson)
Date: Thu, 5 Nov 2015 08:59:29 -0600
Subject: [Rd] PDFs and SVGs containing rasterGrobs don't display
 correctly in some other software
In-Reply-To: <CAPp_+=fpnH32QHdjyxoaNniSPkLwvENW8afBSL1ZPbPX5WxEPA@mail.gmail.com>
References: <CAPp_+=fpnH32QHdjyxoaNniSPkLwvENW8afBSL1ZPbPX5WxEPA@mail.gmail.com>
Message-ID: <CAFDcVCRReB6YJ-Pao9SwuKru9W2WiaGfGnuaS1_qnc06NNCc7w@mail.gmail.com>

On Nov 5, 2015 03:45, "Richard Cotton" <richierocks at gmail.com> wrote:
>
> I've just been trying to post-process some R-created heatmaps using
> Inkscape, but I can't get them to display correctly in that software.
>
> To reproduce:
>
> library(grid)
> r <- as.raster(matrix(runif(25), 5, 5))
> pdf("test.pdf")
> grid.newpage()
> grid.raster(r, interpolate = FALSE)
> dev.off()
>
> This figure should be a five by five block of grey squares.  This is
> what I see in the R GUI device window, and when I open test.pdf in
> Abode Reader or SumatraPDF.
>
> However, when I open the file in Inkscape or Firefox, each of the
> squares is blurred.

Not sure if it's related to how PNGs are rendered in Firefox, but it sounds
similar to the anti-aliasing used by Firefox when scaling up PNGs:

http://stackoverflow.com/questions/388492/firefox-blurs-an-image-when-scaled-through-external-css-or-inline-style

Firefox made anti-aliasing ("blurring") the new default many years ago.
After complaints they provided a way to control this behavior via (a
Mozilla-specific) CSS specification.  See above thread (which is wire old;
there might be more up-to-date reference out there).

If you output a PNG and insert it in a HTML img where you scale up the
width and height, do you see the same problem in Inkscape as in Firefox?

>
> I tried swapping grDevices::pdf for Cairo::CairoPDF and got the same
> result.  I also tried generating SVGs using both grDevices::svg and
> Cairo::CairoSVG, and also got the same result.

If you inspect your generated SVG, is the raster image embedded as a PNG?
Then SVG is unlikely to change the rendering property compared PNGs
(sic!).  However, you might be able to control the anti-aliasing property
of embedded rather images in SVGs using embedded CSS if you want a
self-contained SVG file that renders properly everywhere. You can also do a
self-contained HTML in a similar way.

Don't know if there exist a workaround for PDFs (didn't even know about it
until you mentioned it).

My $.02

Henrik
(from smartphone so sorry for typos etc)

>
> I see the same thing using R-devel and R3.2.2 under Windows, and (with
> an older version of R) under Linux.
>
> I don't know whether the problem is with grid's rasterGrobs, or how R
> writes PDF and SVG files, or with Inkscape and Firefox's method of
> rendering those files, or with me.  Please can you help me narrow it
> down.
>
> - Can you reproduce my problem?  That is, when you run the above code,
> does the file look OK in a PDF reader but blurry in Inkscape?
> - Do you know of any issues with using rasterGrobs in PDFs or SVGs?
>
> --
> Regards,
> Richie
>
> Learning R
> 4dpiecharts.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

	[[alternative HTML version deleted]]


From hpages at fredhutch.org  Fri Nov  6 00:05:52 2015
From: hpages at fredhutch.org (=?UTF-8?B?SGVydsOpIFBhZ8Oocw==?=)
Date: Thu, 5 Nov 2015 15:05:52 -0800
Subject: [Rd] inconsistency between order() and sort()
Message-ID: <563BE0D0.4030708@fredhutch.org>

Hi,

There is an obvious relationship between order() and sort():

   > x <- c("b", "c", NA, "a")
   > identical(x[order(x, na.last=TRUE)], sort(x, na.last=TRUE))
   [1] TRUE
   > identical(x[order(x, na.last=FALSE)], sort(x, na.last=FALSE))
   [1] TRUE
   > identical(x[order(x, na.last=NA)], sort(x, na.last=NA))
   [1] TRUE

and having this level of consistency between order-related
operations is good.

However:

   > identical(x[order(x)], sort(x))
   [1] FALSE

This is unfortunate and error prone when writing code that
assumes consistent behavior between order() and sort(). The
problem is that order() and sort() use a different default
for the 'na.last' argument (TRUE and NA, respectively). Is
there any reason for that? Any chance this could be revisited?

Thanks,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fredhutch.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From therneau at mayo.edu  Fri Nov  6 14:36:29 2015
From: therneau at mayo.edu (Therneau, Terry M., Ph.D.)
Date: Fri, 06 Nov 2015 07:36:29 -0600
Subject: [Rd] Puzzled by eval
Message-ID: <c10f8b$1q634q@ironport10.mayo.edu>

I am currently puzzled by a seach path behavior.  I have a library of a dozen routines 
getlabs(), getssn(), getecg(), ... that interface to local repositories and pull back 
patient information.  All have a the first 6 arguments in common, and immediately call a 
second routine to do initial processing of these 6.  The functions "joe" and "fred" below 
capture the relevant portion of them.
   My puzzle is this: the last test in the "test" file works fine if these routines are 
sourced and executed at the command line, it fails if the routines are bundled up and 
loaded as a library. That test is motivated by a user who called his data set "t", and 
ended up with a match to base:::t instead of his data, resulting in a strange error 
message out of model.frame  --- you can always count on the users!  (There are a few hundred.)
    I'm attempting to be careful with envr and enclos arguments -- how does base end up 
earlier in the search path?   Perhaps this is clearly stated in the docs and just not 
clear to me?  A working solution to the dilemma is of course more than welcome.

Terry Therneau


code:
joe <- function(id, data, subset, na.action, date1, date2, other.args) {
     Call <- match.call()
     if (!missing(data)) temp <- fred(Call)

     temp
}

fred <- function(Call) {
     # get a first copy of the id and date variables
     index <- match(c("id", "date1", "date2"), names(Call), nomatch=0)
     temp <- Call[c(1, index)]
     temp[[1]] <- as.name("list")

     pf <- parent.frame(2)  # the caller of the caller
     data <- eval(Call$data, envir=pf)

     ldata <- eval(temp, data, enclos= pf)
     date1 <- ldata$date1
     date2 <- ldata$date2

     # Users are allowed great flexibility with dates.  Both can be given
     # as length 1 parameters, both can be in the data set, or one could
     # be in each place.  Call model.frame with a built up formula that
     # includes the id and any dates of length greater than 1. This allows
     # subset and na.action to be applied in the usual way.
     index <- match(c("data", "subset", "na.action"), names(Call), nomatch=0)
     temp <- Call[c(1, index)]
     temp[[1]] <- as.name("model.frame")
     tform <- "~ id"
     if (length(date1) > 1 && is.name(Call$date1))
         tform <- paste(tform, "+", as.character(Call$date1))
     if (length(date2) > 1 && is.name(Call$date2))
         tform <- paste(tform, "+", as.character(Call$date2))

     tform <- as.formula(tform)
     environment(tform) <- pf
     temp$formula <- tform
     mf <- eval(temp, enclos=pf)

     # At this point the real routine has checks for legal dates, date1 <= date2, etc
     #  It returns the tidied up id, date1, date2 vectors.
     list(ldata=ldata, mf=mf)
}

test:
library(puzzle)
tdata <- data.frame(id=1:10,
                     start=as.Date(paste0("1999/", 1:10, "/25")))
xdate <- as.Date(paste0(2001:2010, "/03/10"))

joe(id, tdata, date1= "2001/10/11", date2= xdate[2])
joe(id, tdata, date1=start, date2=xdate)

sqrt <- xdate
cos <- tdata

joe(id, cos, date1=start, date2=sqrt)

DESCRIPTION:
Title: A puzzle
Priority: optional
Package: puzzle
Version: 1.1-1
LazyLoad: Yes
LazyData: Yes
Authors at R: c(person(c("Terry", "M"), "Therneau",
                     email="therneau.terry at mayo.edu",
                 role=c("cre")))
Description: What gives with my tests?
License: GPL

NAMESPACE:
export("joe")


From murdoch.duncan at gmail.com  Fri Nov  6 14:51:08 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 6 Nov 2015 07:51:08 -0600
Subject: [Rd] Puzzled by eval
In-Reply-To: <c10f8b$1q634q@ironport10.mayo.edu>
References: <c10f8b$1q634q@ironport10.mayo.edu>
Message-ID: <563CB04C.6020900@gmail.com>

On 06/11/2015 7:36 AM, Therneau, Terry M., Ph.D. wrote:
> I am currently puzzled by a seach path behavior.  I have a library of a dozen routines
> getlabs(), getssn(), getecg(), ... that interface to local repositories and pull back
> patient information.  All have a the first 6 arguments in common, and immediately call a
> second routine to do initial processing of these 6.  The functions "joe" and "fred" below
> capture the relevant portion of them.
>     My puzzle is this: the last test in the "test" file works fine if these routines are
> sourced and executed at the command line, it fails if the routines are bundled up and
> loaded as a library. That test is motivated by a user who called his data set "t", and
> ended up with a match to base:::t instead of his data, resulting in a strange error
> message out of model.frame  --- you can always count on the users!  (There are a few hundred.)
>      I'm attempting to be careful with envr and enclos arguments -- how does base end up
> earlier in the search path?   Perhaps this is clearly stated in the docs and just not
> clear to me?  A working solution to the dilemma is of course more than welcome.

I haven't followed through all the details in fred(), but I can answer 
the last question.  In package code, the search order is:

- the package environment
- the imports to the package (with base being an implicit import)
- the global environment and the rest of the search list.

In code sourced to the global environment, only the third of these is 
searched.  Since base is in the second one, it is found first in the 
package version.

Duncan Murdoch


>
> Terry Therneau
>
>
> code:
> joe <- function(id, data, subset, na.action, date1, date2, other.args) {
>       Call <- match.call()
>       if (!missing(data)) temp <- fred(Call)
>
>       temp
> }
>
> fred <- function(Call) {
>       # get a first copy of the id and date variables
>       index <- match(c("id", "date1", "date2"), names(Call), nomatch=0)
>       temp <- Call[c(1, index)]
>       temp[[1]] <- as.name("list")
>
>       pf <- parent.frame(2)  # the caller of the caller
>       data <- eval(Call$data, envir=pf)
>
>       ldata <- eval(temp, data, enclos= pf)
>       date1 <- ldata$date1
>       date2 <- ldata$date2
>
>       # Users are allowed great flexibility with dates.  Both can be given
>       # as length 1 parameters, both can be in the data set, or one could
>       # be in each place.  Call model.frame with a built up formula that
>       # includes the id and any dates of length greater than 1. This allows
>       # subset and na.action to be applied in the usual way.
>       index <- match(c("data", "subset", "na.action"), names(Call), nomatch=0)
>       temp <- Call[c(1, index)]
>       temp[[1]] <- as.name("model.frame")
>       tform <- "~ id"
>       if (length(date1) > 1 && is.name(Call$date1))
>           tform <- paste(tform, "+", as.character(Call$date1))
>       if (length(date2) > 1 && is.name(Call$date2))
>           tform <- paste(tform, "+", as.character(Call$date2))
>
>       tform <- as.formula(tform)
>       environment(tform) <- pf
>       temp$formula <- tform
>       mf <- eval(temp, enclos=pf)
>
>       # At this point the real routine has checks for legal dates, date1 <= date2, etc
>       #  It returns the tidied up id, date1, date2 vectors.
>       list(ldata=ldata, mf=mf)
> }
>
> test:
> library(puzzle)
> tdata <- data.frame(id=1:10,
>                       start=as.Date(paste0("1999/", 1:10, "/25")))
> xdate <- as.Date(paste0(2001:2010, "/03/10"))
>
> joe(id, tdata, date1= "2001/10/11", date2= xdate[2])
> joe(id, tdata, date1=start, date2=xdate)
>
> sqrt <- xdate
> cos <- tdata
>
> joe(id, cos, date1=start, date2=sqrt)
>
> DESCRIPTION:
> Title: A puzzle
> Priority: optional
> Package: puzzle
> Version: 1.1-1
> LazyLoad: Yes
> LazyData: Yes
> Authors at R: c(person(c("Terry", "M"), "Therneau",
>                       email="therneau.terry at mayo.edu",
>                   role=c("cre")))
> Description: What gives with my tests?
> License: GPL
>
> NAMESPACE:
> export("joe")
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From aixtools at gmail.com  Fri Nov  6 15:08:48 2015
From: aixtools at gmail.com (aixtools)
Date: Fri, 06 Nov 2015 15:08:48 +0100
Subject: [Rd] Building R for AIX in 64-bit mode
In-Reply-To: <563A3677.7090900@gmail.com>
References: <CANvxniVBrCaT1C3HosULfg4OfBNkL-vQqnFuTt+j=pfMbovX_Q@mail.gmail.com>
	<561FA401.7010207@stats.ox.ac.uk> <563A2999.8020104@gmail.com>
	<563A32D1.5000305@gmail.com> <563A3677.7090900@gmail.com>
Message-ID: <563CB470.3020606@gmail.com>

On 2015-11-04 17:46, aixtools wrote:
> On 2015-11-04 17:31, aixtools wrote:
>> On 2015-11-04 16:51, aixtools wrote:
>>> On 2015-10-15 15:02, Prof Brian Ripley wrote:
>>>> On 15/10/2015 13:32, Michael Felt wrote:
>>>>> Hi.
>>>>>
>>>>> Just wanted to let you know I am getting close to packaging R for 
>>>>> AIX in
>>>>> 64.bit mode.
>>>>
>>>> Which version? (You mentioned 3.1.3 and 3.2.2 far below.)  There is 
>>>> little value in reporting on frozen branches, and most value in 
>>>> reporting on R-devel where all the current changes have been 
>>>> incorporated.
>>> This report is based on R-3.2.2 I shall repeat asap with R-devel and 
>>> report any significant differences.
>>
> In particular - I wonder about lzma as I already knew this (having 
> built xz a long time ago. LZMA has been replaced by XZ. Do not know 
> why, and do not want to.
> BUT there is no reliable source for LZMA5 (the XZ project only reports 
> LZMA2 and LZMA4). Please see the wiki at: 
> https://en.wikipedia.org/wiki/XZ_Utils
>
> Paused for now - awaiting reply
Well, seems I stand corrected - it is not a change since 17 October, but 
since R-3.2.2 and some directories have been removed from R distribution.

However, I am wondering about this logic - of requiring both lzma and 
xz, whereas before xz was required if lzma was not available.
from the diff of R-3.2.2 and R-devel
   ## R_TRE
@@ -3192,11 +3270,10 @@
   ## Try finding liblzma library and headers.
   ## We check that both are installed,
   AC_DEFUN([R_LZMA],
- [if test "x${use_system_xz}" = xyes; then
-   AC_CHECK_LIB(lzma, lzma_version_number, [have_lzma=yes], [have_lzma=no])
-   if test "${have_lzma}" = yes; then
-     AC_CHECK_HEADERS(lzma.h, [have_lzma=yes], [have_lzma=no])
-   fi
+ [AC_CHECK_LIB(lzma, lzma_version_number, [have_lzma=yes], [have_lzma=no])
+ if test "${have_lzma}" = yes; then
+   AC_CHECK_HEADERS(lzma.h, [have_lzma=yes], [have_lzma=no])
+ fi
   if test "x${have_lzma}" = xyes; then
   AC_CACHE_CHECK([if lzma version >= 5.0.3], [r_cv_have_lzma],
   [AC_LANG_PUSH(C)
@@ -3223,11 +3300,9 @@
   if test "x${have_lzma}" = xyes; then
     AC_DEFINE(HAVE_LZMA, 1, [Define if your system has lzma >= 5.0.3.])
     LIBS="-llzma ${LIBS}"
- fi
   else
-   have_lzma="no"
+   AC_MSG_ERROR("liblzma library and headers are required")
   fi
- AM_CONDITIONAL(BUILD_XZ, [test x${have_lzma} != xyes])
   ])# R_LZMA

If I read the XZ portal - they say XZ is based on LZMA (and it seems the 
lzma support you are looking for comes from xz. So, what the false fail 
on lzma - as it seems it is only XZ you are looking for, or need.)
Having this more clear I can now understand the logic of your numbering 
(taking the version # of LZMA from XZ with the compression algorithm 
being LZMA2)

Anything re: gotchas between 3.2.2 and R-devel is appreciated.
>> configure:35724: checking for lzma_version_number in -llzma
>> configure:35757: gcc -maix64 -std=gnu99 -o conftest -I/opt/64/include 
>> -I/opt/buildaix/include -O2 -mminimal-toc -I/opt/buildaix/include 
>> -I/opt/include  -L/usr/local/lib conftest.c -llzma  -lbz2 -lz -lrt 
>> -ldl -lm  -liconv >&5
>> configure:35757: $? = 1
>> configure: failed program was:
>> configure:35766: result: no
>> configure:35851: error: "liblzma library and headers are required"
>> configure: exit 1
>> ++++ ++++
>


From therneau at mayo.edu  Fri Nov  6 15:20:57 2015
From: therneau at mayo.edu (Therneau, Terry M., Ph.D.)
Date: Fri, 06 Nov 2015 08:20:57 -0600
Subject: [Rd] Puzzled by eval
In-Reply-To: <563CB04C.6020900@gmail.com>
References: <c10f8b$1q634q@ironport10.mayo.edu> <563CB04C.6020900@gmail.com>
Message-ID: <c10f8b$1q6iki@ironport10.mayo.edu>

Duncan,
   That's helpful.  Two follow-up questions:
1. Where would I have found this information?  I had looked at eval and model.frame.
2. What stops the following code from falling down the same rabbit hole?  Shouldn't it 
find base::cos first?

    library(survival)
    cos <- lung
    coxph(Surv(time, status) ~ age, data=cos)

Terry T.


On 11/06/2015 07:51 AM, Duncan Murdoch wrote:
> On 06/11/2015 7:36 AM, Therneau, Terry M., Ph.D. wrote:
>> I am currently puzzled by a seach path behavior.  I have a library of a dozen routines
>> getlabs(), getssn(), getecg(), ... that interface to local repositories and pull back
>> patient information.  All have a the first 6 arguments in common, and immediately call a
>> second routine to do initial processing of these 6.  The functions "joe" and "fred" below
>> capture the relevant portion of them.
>>     My puzzle is this: the last test in the "test" file works fine if these routines are
>> sourced and executed at the command line, it fails if the routines are bundled up and
>> loaded as a library. That test is motivated by a user who called his data set "t", and
>> ended up with a match to base:::t instead of his data, resulting in a strange error
>> message out of model.frame  --- you can always count on the users!  (There are a few
>> hundred.)
>>      I'm attempting to be careful with envr and enclos arguments -- how does base end up
>> earlier in the search path?   Perhaps this is clearly stated in the docs and just not
>> clear to me?  A working solution to the dilemma is of course more than welcome.
>
> I haven't followed through all the details in fred(), but I can answer the last question.
> In package code, the search order is:
>
> - the package environment
> - the imports to the package (with base being an implicit import)
> - the global environment and the rest of the search list.
>
> In code sourced to the global environment, only the third of these is searched.  Since
> base is in the second one, it is found first in the package version.
>
> Duncan Murdoch


From edd at debian.org  Fri Nov  6 15:41:46 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 6 Nov 2015 08:41:46 -0600
Subject: [Rd] Building R for AIX in 64-bit mode
In-Reply-To: <563CB470.3020606@gmail.com>
References: <CANvxniVBrCaT1C3HosULfg4OfBNkL-vQqnFuTt+j=pfMbovX_Q@mail.gmail.com>
	<561FA401.7010207@stats.ox.ac.uk> <563A2999.8020104@gmail.com>
	<563A32D1.5000305@gmail.com> <563A3677.7090900@gmail.com>
	<563CB470.3020606@gmail.com>
Message-ID: <22076.48170.85678.939466@max.nulle.part>


Dear aixtools [1],

You may want to acquaint yourself with the NEWS file and for example the fine
blog / website / rss feed running here

  http://developer.r-project.org/blosxom.cgi/R-devel

to keep abreast of what is changing.

Dirk


[1] The handle is nonstandard. We use real names and affiliation here.

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From murdoch.duncan at gmail.com  Fri Nov  6 15:47:33 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 6 Nov 2015 08:47:33 -0600
Subject: [Rd] Puzzled by eval
In-Reply-To: <c10f8b$1q6ikh@ironport10.mayo.edu>
References: <c10f8b$1q634q@ironport10.mayo.edu> <563CB04C.6020900@gmail.com>
	<c10f8b$1q6ikh@ironport10.mayo.edu>
Message-ID: <563CBD85.3090807@gmail.com>

On 06/11/2015 8:20 AM, Therneau, Terry M., Ph.D. wrote:
> Duncan,
>     That's helpful.  Two follow-up questions:
> 1. Where would I have found this information?  I had looked at eval and model.frame.

I think the best description is Luke's article on namespaces, "Name 
space management for R". Luke Tierney, R News, 3(1):2-6, June 2003. 
There's a link to it from the "Technical papers" section of the HTML 
help index.  There's also a short description of this in the R Language 
Definition manual in the "Search path" section 3.5.4.


> 2. What stops the following code from falling down the same rabbit hole?  Shouldn't it
> find base::cos first?
>
>      library(survival)
>      cos <- lung
>      coxph(Surv(time, status) ~ age, data=cos)

If that code is in a function anywhere (package or not), cos will be a 
local variable created there in the evaluation environment created when 
you evaluate the function.  If you execute it at the command line, 
you'll create a variable called "cos" in the global environment.  Local 
variables come ahead of the 3 places I listed.  (This is why Luke's 
article is good:  it doesn't oversimplify.)

There's one other twist.  Even with cos being a local variable, 
cos(theta) would find base::cos, because the evaluator knows it is 
looking for a function (since it's a function call) and will skip over 
the local dataframe named cos.

Duncan Murdoch

>
> Terry T.
>
>
> On 11/06/2015 07:51 AM, Duncan Murdoch wrote:
>> On 06/11/2015 7:36 AM, Therneau, Terry M., Ph.D. wrote:
>>> I am currently puzzled by a seach path behavior.  I have a library of a dozen routines
>>> getlabs(), getssn(), getecg(), ... that interface to local repositories and pull back
>>> patient information.  All have a the first 6 arguments in common, and immediately call a
>>> second routine to do initial processing of these 6.  The functions "joe" and "fred" below
>>> capture the relevant portion of them.
>>>      My puzzle is this: the last test in the "test" file works fine if these routines are
>>> sourced and executed at the command line, it fails if the routines are bundled up and
>>> loaded as a library. That test is motivated by a user who called his data set "t", and
>>> ended up with a match to base:::t instead of his data, resulting in a strange error
>>> message out of model.frame  --- you can always count on the users!  (There are a few
>>> hundred.)
>>>       I'm attempting to be careful with envr and enclos arguments -- how does base end up
>>> earlier in the search path?   Perhaps this is clearly stated in the docs and just not
>>> clear to me?  A working solution to the dilemma is of course more than welcome.
>>
>> I haven't followed through all the details in fred(), but I can answer the last question.
>> In package code, the search order is:
>>
>> - the package environment
>> - the imports to the package (with base being an implicit import)
>> - the global environment and the rest of the search list.
>>
>> In code sourced to the global environment, only the third of these is searched.  Since
>> base is in the second one, it is found first in the package version.
>>
>> Duncan Murdoch


From ggrothendieck at gmail.com  Fri Nov  6 16:10:55 2015
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 6 Nov 2015 10:10:55 -0500
Subject: [Rd] Puzzled by eval
In-Reply-To: <563CBD85.3090807@gmail.com>
References: <c10f8b$1q634q@ironport10.mayo.edu> <563CB04C.6020900@gmail.com>
	<c10f8b$1q6ikh@ironport10.mayo.edu> <563CBD85.3090807@gmail.com>
Message-ID: <CAP01uRmJDZE_x3OHpn_VtKG96Y57D3=vLKOmv2=T6pxRbfjF0Q@mail.gmail.com>

This code which I think I wrote but might have gotten from elsewhere a
long time ago shows the environments that are searched from a given
function, in this case chart.RelativePerformance in
PerformanceAnalytics package.   Try it on some of your functions in
and out of packages to help determine the sequence of environments R
searches along:

library( PerformanceAnalytics )  ## change as needed
x <- environment(chart.RelativePerformance) ## change as needed
str(x)
while (!identical(x, emptyenv())) {
    p <- parent.env(x)
    cat("---- child is above this line and parent is below ----\n")
    str(p)
    if (isBaseNamespace(p)) cat("Same as .BaseNamespaceEnv\n")
    if (identical(p, baseenv())) cat("Same as baseenv()\n")
    if (identical(p, emptyenv())) cat("Same as emptyenv()\n")
    if (identical(p, globalenv())) cat("Same as globalenv()\n")
    x <- p
}

On Fri, Nov 6, 2015 at 9:47 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> On 06/11/2015 8:20 AM, Therneau, Terry M., Ph.D. wrote:
>>
>> Duncan,
>>     That's helpful.  Two follow-up questions:
>> 1. Where would I have found this information?  I had looked at eval and
>> model.frame.
>
>
> I think the best description is Luke's article on namespaces, "Name space
> management for R". Luke Tierney, R News, 3(1):2-6, June 2003. There's a link
> to it from the "Technical papers" section of the HTML help index.  There's
> also a short description of this in the R Language Definition manual in the
> "Search path" section 3.5.4.
>
>
>> 2. What stops the following code from falling down the same rabbit hole?
>> Shouldn't it
>> find base::cos first?
>>
>>      library(survival)
>>      cos <- lung
>>      coxph(Surv(time, status) ~ age, data=cos)
>
>
> If that code is in a function anywhere (package or not), cos will be a local
> variable created there in the evaluation environment created when you
> evaluate the function.  If you execute it at the command line, you'll create
> a variable called "cos" in the global environment.  Local variables come
> ahead of the 3 places I listed.  (This is why Luke's article is good:  it
> doesn't oversimplify.)
>
> There's one other twist.  Even with cos being a local variable, cos(theta)
> would find base::cos, because the evaluator knows it is looking for a
> function (since it's a function call) and will skip over the local dataframe
> named cos.
>
> Duncan Murdoch
>
>>
>> Terry T.
>>
>>
>> On 11/06/2015 07:51 AM, Duncan Murdoch wrote:
>>>
>>> On 06/11/2015 7:36 AM, Therneau, Terry M., Ph.D. wrote:
>>>>
>>>> I am currently puzzled by a seach path behavior.  I have a library of a
>>>> dozen routines
>>>> getlabs(), getssn(), getecg(), ... that interface to local repositories
>>>> and pull back
>>>> patient information.  All have a the first 6 arguments in common, and
>>>> immediately call a
>>>> second routine to do initial processing of these 6.  The functions "joe"
>>>> and "fred" below
>>>> capture the relevant portion of them.
>>>>      My puzzle is this: the last test in the "test" file works fine if
>>>> these routines are
>>>> sourced and executed at the command line, it fails if the routines are
>>>> bundled up and
>>>> loaded as a library. That test is motivated by a user who called his
>>>> data set "t", and
>>>> ended up with a match to base:::t instead of his data, resulting in a
>>>> strange error
>>>> message out of model.frame  --- you can always count on the users!
>>>> (There are a few
>>>> hundred.)
>>>>       I'm attempting to be careful with envr and enclos arguments -- how
>>>> does base end up
>>>> earlier in the search path?   Perhaps this is clearly stated in the docs
>>>> and just not
>>>> clear to me?  A working solution to the dilemma is of course more than
>>>> welcome.
>>>
>>>
>>> I haven't followed through all the details in fred(), but I can answer
>>> the last question.
>>> In package code, the search order is:
>>>
>>> - the package environment
>>> - the imports to the package (with base being an implicit import)
>>> - the global environment and the rest of the search list.
>>>
>>> In code sourced to the global environment, only the third of these is
>>> searched.  Since
>>> base is in the second one, it is found first in the package version.
>>>
>>> Duncan Murdoch
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From h.wickham at gmail.com  Fri Nov  6 17:36:20 2015
From: h.wickham at gmail.com (Hadley Wickham)
Date: Fri, 6 Nov 2015 10:36:20 -0600
Subject: [Rd] Puzzled by eval
In-Reply-To: <c10f8b$1q6iki@ironport10.mayo.edu>
References: <c10f8b$1q634q@ironport10.mayo.edu> <563CB04C.6020900@gmail.com>
	<c10f8b$1q6iki@ironport10.mayo.edu>
Message-ID: <CABdHhvG1RiVLq=8jC7v_4_Qn+9bGLsX21hFM4QaiAMoAN8gwvQ@mail.gmail.com>

On Fri, Nov 6, 2015 at 8:20 AM, Therneau, Terry M., Ph.D.
<therneau at mayo.edu> wrote:
> Duncan,
>   That's helpful.  Two follow-up questions:
> 1. Where would I have found this information?  I had looked at eval and
> model.frame.

You can try http://adv-r.had.co.nz/Environments.html, particularly
http://adv-r.had.co.nz/Environments.html#function-envs.

Hadley


-- 
http://had.co.nz/


From wdunlap at tibco.com  Fri Nov  6 18:54:32 2015
From: wdunlap at tibco.com (William Dunlap)
Date: Fri, 6 Nov 2015 09:54:32 -0800
Subject: [Rd] corrupt PACKAGES.gz?
Message-ID: <CAF8bMcZAPm5Q7VNcB+ofa-y6D0e2eYSokB9cD9mDXmS88yCzDg@mail.gmail.com>

Is it just me, or did a corrupt PACKAGES.gz file get installed in the
bin/windows/contrib/3.2 directory of CRAN mirrors recently?  gzfile()
complains about it and Cygwin's gzip cannot decompress it.  I tried the
following

repos <- "https://cran.rstudio.com"
v <- "3.2"
pkgs.gz <- paste(sep="/", repos, "bin/windows/contrib", v, "PACKAGES.gz")

tfile <- tempfile(fileext=".gz")
download.file(pkgs.gz, dest=tfile)
r.gz <- readLines(gzfile(tfile, "r"))
tail(system(paste("c:\\cygwin\\bin\\gzip -d - ", shQuote(tfile)),
intern=TRUE))

and got

> repos <- "https://cran.rstudio.com"
> v <- "3.2"
> pkgs.gz <- paste(sep="/", repos, "bin/windows/contrib", v, "PACKAGES.gz")
>
> tfile <- tempfile(fileext=".gz")
> download.file(pkgs.gz, dest=tfile)
trying URL 'https://cran.rstudio.com/bin/windows/contrib/3.2/PACKAGES.gz'
Content type 'application/x-gzip' length 188174 bytes (183 KB)
downloaded 183 KB

> r.gz <- readLines(gzfile(tfile, "r"))
Warning message:
In readLines(gzfile(tfile, "r")) :
  seek on a gzfile connection returned an internal error
> tail(system(paste("c:\\cygwin\\bin\\gzip -d - ", shQuote(tfile)),
intern=TRUE))
[1] ""                                    "gzip: stdin: unexpected end of
file"
Warning message:
running command 'c:\cygwin\bin\gzip -d -
 "C:\Users\wdunlap\AppData\Local\Temp\RtmpG42jk4\file2a201a9e4802.gz"' had
status 1

R's gz code seems to recover from the bad seek, but Cygwin's gzip cannot.

> pkgs <- paste(sep="/", repos, "bin/windows/contrib", v, "PACKAGES")
> r <- readLines(url(pkgs, "rt"))
> all.equal(r, r.gz)
[1] TRUE

I get the same results using the Spanish miror, https://ftp.cixug.es/CRAN


Bill Dunlap
TIBCO Software
wdunlap tibco.com

	[[alternative HTML version deleted]]


From ligges at statistik.tu-dortmund.de  Sat Nov  7 09:24:44 2015
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sat, 7 Nov 2015 09:24:44 +0100
Subject: [Rd] corrupt PACKAGES.gz?
In-Reply-To: <CAF8bMcZAPm5Q7VNcB+ofa-y6D0e2eYSokB9cD9mDXmS88yCzDg@mail.gmail.com>
References: <CAF8bMcZAPm5Q7VNcB+ofa-y6D0e2eYSokB9cD9mDXmS88yCzDg@mail.gmail.com>
Message-ID: <563DB54C.2020706@statistik.tu-dortmund.de>

Bill,

thanks for reporting, this is currently true for all PACKAGES.gz files 
my autobuilder is creating, will investigate.

Best,
Uwe


On 06.11.2015 18:54, William Dunlap wrote:
> Is it just me, or did a corrupt PACKAGES.gz file get installed in the
> bin/windows/contrib/3.2 directory of CRAN mirrors recently?  gzfile()
> complains about it and Cygwin's gzip cannot decompress it.  I tried the
> following
>
> repos <- "https://cran.rstudio.com"
> v <- "3.2"
> pkgs.gz <- paste(sep="/", repos, "bin/windows/contrib", v, "PACKAGES.gz")
>
> tfile <- tempfile(fileext=".gz")
> download.file(pkgs.gz, dest=tfile)
> r.gz <- readLines(gzfile(tfile, "r"))
> tail(system(paste("c:\\cygwin\\bin\\gzip -d - ", shQuote(tfile)),
> intern=TRUE))
>
> and got
>
>> repos <- "https://cran.rstudio.com"
>> v <- "3.2"
>> pkgs.gz <- paste(sep="/", repos, "bin/windows/contrib", v, "PACKAGES.gz")
>>
>> tfile <- tempfile(fileext=".gz")
>> download.file(pkgs.gz, dest=tfile)
> trying URL 'https://cran.rstudio.com/bin/windows/contrib/3.2/PACKAGES.gz'
> Content type 'application/x-gzip' length 188174 bytes (183 KB)
> downloaded 183 KB
>
>> r.gz <- readLines(gzfile(tfile, "r"))
> Warning message:
> In readLines(gzfile(tfile, "r")) :
>    seek on a gzfile connection returned an internal error
>> tail(system(paste("c:\\cygwin\\bin\\gzip -d - ", shQuote(tfile)),
> intern=TRUE))
> [1] ""                                    "gzip: stdin: unexpected end of
> file"
> Warning message:
> running command 'c:\cygwin\bin\gzip -d -
>   "C:\Users\wdunlap\AppData\Local\Temp\RtmpG42jk4\file2a201a9e4802.gz"' had
> status 1
>
> R's gz code seems to recover from the bad seek, but Cygwin's gzip cannot.
>
>> pkgs <- paste(sep="/", repos, "bin/windows/contrib", v, "PACKAGES")
>> r <- readLines(url(pkgs, "rt"))
>> all.equal(r, r.gz)
> [1] TRUE
>
> I get the same results using the Spanish miror, https://ftp.cixug.es/CRAN
>
>
> Bill Dunlap
> TIBCO Software
> wdunlap tibco.com
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From wdunlap at tibco.com  Tue Nov 10 23:54:25 2015
From: wdunlap at tibco.com (William Dunlap)
Date: Tue, 10 Nov 2015 14:54:25 -0800
Subject: [Rd] corrupt PACKAGES.gz?
In-Reply-To: <563DB54C.2020706@statistik.tu-dortmund.de>
References: <CAF8bMcZAPm5Q7VNcB+ofa-y6D0e2eYSokB9cD9mDXmS88yCzDg@mail.gmail.com>
	<563DB54C.2020706@statistik.tu-dortmund.de>
Message-ID: <CAF8bMcZxFBWnvhMhBjst73Ed6zHSj-Y1qTsVKPvbVFx378xO1A@mail.gmail.com>

My test may not have been entirely right, but it looks like the PACKAGES.gz
file for windows binary packages for R-3.2.x was a quarter of its usual
size on
Nov 5-6, 2015.  It is now fine.  I used  Revolution's daily CRAN snapshots
to
check.
   mran.revolutionanalytics.com/snapshot/YYYY-MM-DD

Bill Dunlap
TIBCO Software
wdunlap tibco.com

On Sat, Nov 7, 2015 at 12:24 AM, Uwe Ligges <ligges at statistik.tu-dortmund.de
> wrote:

> Bill,
>
> thanks for reporting, this is currently true for all PACKAGES.gz files my
> autobuilder is creating, will investigate.
>
> Best,
> Uwe
>
>
>
> On 06.11.2015 18:54, William Dunlap wrote:
>
>> Is it just me, or did a corrupt PACKAGES.gz file get installed in the
>> bin/windows/contrib/3.2 directory of CRAN mirrors recently?  gzfile()
>> complains about it and Cygwin's gzip cannot decompress it.  I tried the
>> following
>>
>> repos <- "https://cran.rstudio.com"
>> v <- "3.2"
>> pkgs.gz <- paste(sep="/", repos, "bin/windows/contrib", v, "PACKAGES.gz")
>>
>> tfile <- tempfile(fileext=".gz")
>> download.file(pkgs.gz, dest=tfile)
>> r.gz <- readLines(gzfile(tfile, "r"))
>> tail(system(paste("c:\\cygwin\\bin\\gzip -d - ", shQuote(tfile)),
>> intern=TRUE))
>>
>> and got
>>
>> repos <- "https://cran.rstudio.com"
>>> v <- "3.2"
>>> pkgs.gz <- paste(sep="/", repos, "bin/windows/contrib", v, "PACKAGES.gz")
>>>
>>> tfile <- tempfile(fileext=".gz")
>>> download.file(pkgs.gz, dest=tfile)
>>>
>> trying URL 'https://cran.rstudio.com/bin/windows/contrib/3.2/PACKAGES.gz'
>> Content type 'application/x-gzip' length 188174 bytes (183 KB)
>> downloaded 183 KB
>>
>> r.gz <- readLines(gzfile(tfile, "r"))
>>>
>> Warning message:
>> In readLines(gzfile(tfile, "r")) :
>>    seek on a gzfile connection returned an internal error
>>
>>> tail(system(paste("c:\\cygwin\\bin\\gzip -d - ", shQuote(tfile)),
>>>
>> intern=TRUE))
>> [1] ""                                    "gzip: stdin: unexpected end of
>> file"
>> Warning message:
>> running command 'c:\cygwin\bin\gzip -d -
>>   "C:\Users\wdunlap\AppData\Local\Temp\RtmpG42jk4\file2a201a9e4802.gz"'
>> had
>> status 1
>>
>> R's gz code seems to recover from the bad seek, but Cygwin's gzip cannot.
>>
>> pkgs <- paste(sep="/", repos, "bin/windows/contrib", v, "PACKAGES")
>>> r <- readLines(url(pkgs, "rt"))
>>> all.equal(r, r.gz)
>>>
>> [1] TRUE
>>
>> I get the same results using the Spanish miror, https://ftp.cixug.es/CRAN
>>
>>
>> Bill Dunlap
>> TIBCO Software
>> wdunlap tibco.com
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>

	[[alternative HTML version deleted]]


From wdunlap at tibco.com  Fri Nov 13 21:58:11 2015
From: wdunlap at tibco.com (William Dunlap)
Date: Fri, 13 Nov 2015 12:58:11 -0800
Subject: [Rd] R_MakeExternalPtr 'tag' argument
Message-ID: <CAF8bMca-F4pHPdmRMCZ2Wu+_8UbHzq_BV+8+8fvFknS5XghhuA@mail.gmail.com>

Most packages that use the R_MakeExternalPtr function use
Rf_install("pkgSpecificString") for its 'tag' argument (if they don't use
R_NilValue).  A few use Rf_mkChar("pkgSpecificString").

Is there any reason to prefer one over the other?

Bill Dunlap
TIBCO Software
wdunlap tibco.com


From simon.urbanek at r-project.org  Sat Nov 14 14:43:04 2015
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Sat, 14 Nov 2015 08:43:04 -0500
Subject: [Rd] R_MakeExternalPtr 'tag' argument
In-Reply-To: <CAF8bMca-F4pHPdmRMCZ2Wu+_8UbHzq_BV+8+8fvFknS5XghhuA@mail.gmail.com>
References: <CAF8bMca-F4pHPdmRMCZ2Wu+_8UbHzq_BV+8+8fvFknS5XghhuA@mail.gmail.com>
Message-ID: <2D5AFF6B-D196-4583-A355-DAC03DBCF7D0@r-project.org>


On Nov 13, 2015, at 3:58 PM, William Dunlap <wdunlap at tibco.com> wrote:

> Most packages that use the R_MakeExternalPtr function use
> Rf_install("pkgSpecificString") for its 'tag' argument (if they don't use
> R_NilValue).  A few use Rf_mkChar("pkgSpecificString").
> 
> Is there any reason to prefer one over the other?
> 

I think Luke is the definite authority, but IMHO using CHARSXP is illegal since you can only store CHARSXP in STRSXP. R-exts allows "ordinary R objects" so presumably mkString() would be legal.

Cheers,
Simon


From richierocks at gmail.com  Mon Nov 16 10:00:12 2015
From: richierocks at gmail.com (Richard Cotton)
Date: Mon, 16 Nov 2015 12:00:12 +0300
Subject: [Rd] Best way to implement optional functions?
In-Reply-To: <56293F15.80509@gmail.com>
References: <56293F15.80509@gmail.com>
Message-ID: <CAPp_+=di7F_JfbbL2eLk_XM9RXrL=1-sw=gO0o+42donMQ7WwQ@mail.gmail.com>

On 22 October 2015 at 22:55, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> I'm planning on adding some new WebGL functionality to the rgl package, but
> it will pull in a very large number of dependencies. Since many people won't
> need it, I'd like to make the new parts optional.

> Can people suggest other packages that solve this kind of problem in a good
> way?

I had the same issue with the assertive package: it was getting big,
and not everyone wanted all the functionality.

The solution was to create several smaller packages with individual
components of functionality, for example assertive.base contains the
bare-minimum functionality; assertive.numbers contains functionality
related to numbers, etc.

Then the assertive package imports all the functions from the
component packages and reexports them.

That way people who want a small footprint (mostly other package
developers) can specify only what they need, and people who don't care
(mostly end users) can just type library(assertive) and get access to
everything.

-- 
Regards,
Richie

Learning R
4dpiecharts.com


From murdoch.duncan at gmail.com  Mon Nov 16 22:02:24 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 16 Nov 2015 16:02:24 -0500
Subject: [Rd] Best way to implement optional functions?
In-Reply-To: <CAPp_+=di7F_JfbbL2eLk_XM9RXrL=1-sw=gO0o+42donMQ7WwQ@mail.gmail.com>
References: <56293F15.80509@gmail.com>
	<CAPp_+=di7F_JfbbL2eLk_XM9RXrL=1-sw=gO0o+42donMQ7WwQ@mail.gmail.com>
Message-ID: <564A4460.4090105@gmail.com>

On 16/11/2015 4:00 AM, Richard Cotton wrote:
> On 22 October 2015 at 22:55, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>> I'm planning on adding some new WebGL functionality to the rgl package, but
>> it will pull in a very large number of dependencies. Since many people won't
>> need it, I'd like to make the new parts optional.
>
>> Can people suggest other packages that solve this kind of problem in a good
>> way?
>
> I had the same issue with the assertive package: it was getting big,
> and not everyone wanted all the functionality.
>
> The solution was to create several smaller packages with individual
> components of functionality, for example assertive.base contains the
> bare-minimum functionality; assertive.numbers contains functionality
> related to numbers, etc.
>
> Then the assertive package imports all the functions from the
> component packages and reexports them.
>
> That way people who want a small footprint (mostly other package
> developers) can specify only what they need, and people who don't care
> (mostly end users) can just type library(assertive) and get access to
> everything.
>

When you import and re-export functions, do they need to be documented 
in both places?  I forget if we have a simple way to say "this function 
is documented in that package", to avoid duplication.

Duncan Murdoch


From thierry.onkelinx at inbo.be  Mon Nov 16 22:42:02 2015
From: thierry.onkelinx at inbo.be (Thierry Onkelinx)
Date: Mon, 16 Nov 2015 22:42:02 +0100
Subject: [Rd] Best way to implement optional functions?
In-Reply-To: <564A4460.4090105@gmail.com>
References: <56293F15.80509@gmail.com>
	<CAPp_+=di7F_JfbbL2eLk_XM9RXrL=1-sw=gO0o+42donMQ7WwQ@mail.gmail.com>
	<564A4460.4090105@gmail.com>
Message-ID: <CAJuCY5ypwAYfXJKoSOyZRG6Ndy3bQH35hB5fkJp86g=HvbCMuQ@mail.gmail.com>

Roxygen2 documents imported and re-exported functions. See
http://www.r-bloggers.com/roxygen2-5-0-0/

Best regards,

ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature and
Forest
team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
Kliniekstraat 25
1070 Anderlecht
Belgium

To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey

2015-11-16 22:02 GMT+01:00 Duncan Murdoch <murdoch.duncan at gmail.com>:

> On 16/11/2015 4:00 AM, Richard Cotton wrote:
>
>> On 22 October 2015 at 22:55, Duncan Murdoch <murdoch.duncan at gmail.com>
>> wrote:
>>
>>> I'm planning on adding some new WebGL functionality to the rgl package,
>>> but
>>> it will pull in a very large number of dependencies. Since many people
>>> won't
>>> need it, I'd like to make the new parts optional.
>>>
>>
>> Can people suggest other packages that solve this kind of problem in a
>>> good
>>> way?
>>>
>>
>> I had the same issue with the assertive package: it was getting big,
>> and not everyone wanted all the functionality.
>>
>> The solution was to create several smaller packages with individual
>> components of functionality, for example assertive.base contains the
>> bare-minimum functionality; assertive.numbers contains functionality
>> related to numbers, etc.
>>
>> Then the assertive package imports all the functions from the
>> component packages and reexports them.
>>
>> That way people who want a small footprint (mostly other package
>> developers) can specify only what they need, and people who don't care
>> (mostly end users) can just type library(assertive) and get access to
>> everything.
>>
>>
> When you import and re-export functions, do they need to be documented in
> both places?  I forget if we have a simple way to say "this function is
> documented in that package", to avoid duplication.
>
> Duncan Murdoch
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

	[[alternative HTML version deleted]]


From pgrosu at gmail.com  Tue Nov 17 02:11:14 2015
From: pgrosu at gmail.com (Paul Grosu)
Date: Mon, 16 Nov 2015 20:11:14 -0500
Subject: [Rd] Small request of a feature improvement in the next version of R
Message-ID: <0c3401d120d4$db715bd0$92541370$@gmail.com>


Hi Everyone,

Sorry to bother the list with this small request, but I've run into this
issue and was wondering if it could be fixed in the next version of R.
Sorry if it was raised in a previous thread:

So when I try the following I get an error:

> m <- list()
> m[["A3V6HVSALQ835D"]][['profiles']] <- 3
> m[["A3V6HVSALQ835D"]][['stars']] <- c(1, 23)
Error in m[["A3V6HVSALQ835D"]][["stars"]] <- c(1, 23) : 
  more elements supplied than there are to replace
  
As does the following:

> m <- list()
> m[["A3V6HVSALQ835D"]][['profiles']] <- c()
> m[["A3V6HVSALQ835D"]][['stars']] <- c()
> m[["A3V6HVSALQ835D"]][['profiles']] <- 3
> m[["A3V6HVSALQ835D"]][['stars']] <- c(1, 23)
Error in m[["A3V6HVSALQ835D"]][["stars"]] <- c(1, 23) : 
  more elements supplied than there are to replace

But when I reverse the order, I don't:

> m <- list()
> m[["A3V6HVSALQ835D"]][['stars']] <- c(1, 23)
> m[["A3V6HVSALQ835D"]][['profiles']] <- 3

As doesn't the following, with the order reversed for the assignment:

> m <- list()
> m[["A3V6HVSALQ835D"]][['profiles']] <- c()
> m[["A3V6HVSALQ835D"]][['stars']] <- c()
> m[["A3V6HVSALQ835D"]][['stars']] <- c(1, 23)
> m[["A3V6HVSALQ835D"]][['profiles']] <- 3

And when I instantiate it in this way, it does not with the original order:

> m <- list()
> m[["A3V6HVSALQ835D"]][['profiles']] <- c()
> m[["A3V6HVSALQ835D"]][['stars']] <- list()
> m[["A3V6HVSALQ835D"]][['profiles']] <- 3
> m[["A3V6HVSALQ835D"]][['stars']] <- c(1, 23)

The request is so that order-specific assignments would not throw an error,
and I am using version 3.2.2 of R.

Thank you,
Paul


From plummerm at iarc.fr  Tue Nov 17 11:13:11 2015
From: plummerm at iarc.fr (Martyn Plummer)
Date: Tue, 17 Nov 2015 10:13:11 +0000
Subject: [Rd] Small request of a feature improvement in the next version
 of R
In-Reply-To: <0c3401d120d4$db715bd0$92541370$@gmail.com>
References: <0c3401d120d4$db715bd0$92541370$@gmail.com>
Message-ID: <1447755191.19134.45.camel@iarc.fr>

On Mon, 2015-11-16 at 20:11 -0500, Paul Grosu wrote:
> Hi Everyone,
> 
> Sorry to bother the list with this small request, but I've run into this
> issue and was wondering if it could be fixed in the next version of R.
> Sorry if it was raised in a previous thread:
> 
> So when I try the following I get an error:
> 
> > m <- list()
> > m[["A3V6HVSALQ835D"]][['profiles']] <- 3
> > m[["A3V6HVSALQ835D"]][['stars']] <- c(1, 23)
> Error in m[["A3V6HVSALQ835D"]][["stars"]] <- c(1, 23) : 
>   more elements supplied than there are to replace
>   
> As does the following:
> 
> > m <- list()
> > m[["A3V6HVSALQ835D"]][['profiles']] <- c()
> > m[["A3V6HVSALQ835D"]][['stars']] <- c()
> > m[["A3V6HVSALQ835D"]][['profiles']] <- 3
> > m[["A3V6HVSALQ835D"]][['stars']] <- c(1, 23)
> Error in m[["A3V6HVSALQ835D"]][["stars"]] <- c(1, 23) : 
>   more elements supplied than there are to replace
> 
> But when I reverse the order, I don't:
> 
> > m <- list()
> > m[["A3V6HVSALQ835D"]][['stars']] <- c(1, 23)
> > m[["A3V6HVSALQ835D"]][['profiles']] <- 3
> 
> As doesn't the following, with the order reversed for the assignment:
> 
> > m <- list()
> > m[["A3V6HVSALQ835D"]][['profiles']] <- c()
> > m[["A3V6HVSALQ835D"]][['stars']] <- c()
> > m[["A3V6HVSALQ835D"]][['stars']] <- c(1, 23)
> > m[["A3V6HVSALQ835D"]][['profiles']] <- 3
> 
> And when I instantiate it in this way, it does not with the original order:
> 
> > m <- list()
> > m[["A3V6HVSALQ835D"]][['profiles']] <- c()
> > m[["A3V6HVSALQ835D"]][['stars']] <- list()
> > m[["A3V6HVSALQ835D"]][['profiles']] <- 3
> > m[["A3V6HVSALQ835D"]][['stars']] <- c(1, 23)
> 
> The request is so that order-specific assignments would not throw an error,
> and I am using version 3.2.2 of R.

Your example combines two nested calls to the replacement function
"[[<-". It is a lot easier to understand what is going wrong if you
break this down into two separate function calls.

First, the element of m that you want to modify is NULL:

> m <- list()
> m[["A3V"]]
NULL

So the expression 

> m[["A3V"]][['profile']] <- 3

is equivalent to:

> tmp <- NULL
> tmp[['profile']] <- 3
> m[["A3V"]] <- tmp

Inspecting the result:

> m
$A3V
profile 
      3 

> class(m$A3V)
[1] "numeric"

So m$A3V is a numeric vector and not, as you expected, a list. This
behaviour of "[[<-" when applied to NULL objects is documented on the
help page: See help("[[<-")

The solution is to create m[["A3V"]] as a list before modifying its
elements:

> m <- list()
> m[["A3V"]] <- list()
...

Martyn

> Thank you,
> Paul
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-----------------------------------------------------------------------
This message and its attachments are strictly confidenti...{{dropped:8}}


From philip.leifeld at ipw.unibe.ch  Tue Nov 17 18:18:03 2015
From: philip.leifeld at ipw.unibe.ch (Philip Leifeld)
Date: Tue, 17 Nov 2015 18:18:03 +0100
Subject: [Rd] Exporting a method to a cluster object
Message-ID: <564B614B.2020701@ipw.unibe.ch>

Hi,

This is my first message to this list. It would be great if people here 
could help me with the following problem (self-contained code example 
below):

I have a list of matrices and would like to apply a summary function to 
the matrices in the list. The matrices represent social networks, 
therefore I need to apply some specialized summary functions provided by 
the ergm package. These summary statistics are contained in a summary 
method. I can write a function as a wrapper around this summary method 
and use lapply to apply the function to the list of matrices. This gives 
me the result I want:

       [,1] [,2] [,3] [,4] [,5]
edges   94   94   94   94   94
dsp1   227  227  227  227  227

However, when I try to parallelize this by using parLapply or parSapply 
from the parallel package, the results look weird:

        [,1]      [,2]      [,3]      [,4]      [,5]
Length "3"       "3"       "3"       "3"       "3"
Class  "formula" "formula" "formula" "formula" "formula"
Mode   "call"    "call"    "call"    "call"    "call"

And when I export summary.statistics, which is used inside my wrapper 
function, I get an error message:

Error in checkForRemoteErrors(val) :
   2 nodes produced errors; first error: could not find function 
"summary.statistics"

Do I have to export the summary method that is provided by the ergm 
package to the cluster object? If so, how? The following code is a 
self-contained example.

##########

library("ergm")
library("parallel")

# create list of matrices
m <- matrix(rbinom(900, 1, 0.1), nrow = 30)
l <- list(m, m, m, m, m)

# write wrapper function that computes results
fun <- function(mat) {
   s <- summary(mat ~ edges + dsp(1))
   return(s)
}

cl <- makePSOCKcluster(2)  # create cluster object

test1 <- sapply(l, fun)  # works!
test2 <- parSapply(cl, l, fun)  # problem: results look weird!

clusterExport(cl, varlist = "summary.statistics")
test3 <- parSapply(cl, l, fun)  # error!

##########

I found a solution somewhere in a forum:

clusterCall(cl, function() library("ergm"))

However, as I'd like to use the code in a package, the CRAN check tells 
me that using library calls inside a package is uncool. So I guess there 
must be another solution?

Thanks in advance for any hints.

Best,
Philip

(University of Bern)


From mikko.korpela at aalto.fi  Wed Nov 18 10:35:14 2015
From: mikko.korpela at aalto.fi (Mikko Korpela)
Date: Wed, 18 Nov 2015 11:35:14 +0200
Subject: [Rd] Outdated information in regex.Rd
Message-ID: <564C4652.6050700@aalto.fi>

The NEWS for R-devel has the following item:

> The previously included versions of zlib, bzip2, xz and PCRE have
> been removed, so suitable external (usually system) versions are
> required (see the ?R Installation and Administration? manual).

Therefore I believe the following information in
'src/library/base/man/regex.Rd' is no longer valid:

> If PCRE support was compiled from the sources within R, the PCRE
> version is 8.36 as described here.

-- 
Mikko Korpela
Aalto University School of Science
Department of Computer Science


From edd at debian.org  Wed Nov 18 13:47:38 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 18 Nov 2015 06:47:38 -0600
Subject: [Rd] Exporting a method to a cluster object
In-Reply-To: <564B614B.2020701@ipw.unibe.ch>
References: <564B614B.2020701@ipw.unibe.ch>
Message-ID: <22092.29546.861599.111553@max.nulle.part>


On 17 November 2015 at 18:18, Philip Leifeld wrote:
| This is my first message to this list. It would be great if people here 
| could help me with the following problem (self-contained code example 
| below):

It is not really the list for it. Could you try r-sig-hpc (and you first need
to subscribe).

In short, load all required packages on all worker nodes. See the vignette of
the parallel package for a good start.

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From maechler at stat.math.ethz.ch  Thu Nov 19 11:05:35 2015
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 19 Nov 2015 11:05:35 +0100
Subject: [Rd] Outdated information in regex.Rd
In-Reply-To: <564C4652.6050700@aalto.fi>
References: <564C4652.6050700@aalto.fi>
Message-ID: <22093.40687.411376.98127@stat.math.ethz.ch>

>>>>> Mikko Korpela <mikko.korpela at aalto.fi>
>>>>>     on Wed, 18 Nov 2015 11:35:14 +0200 writes:

    > The NEWS for R-devel has the following item:
    >> The previously included versions of zlib, bzip2, xz and PCRE have
    >> been removed, so suitable external (usually system) versions are
    >> required (see the ?R Installation and Administration? manual).

    > Therefore I believe the following information in
    > 'src/library/base/man/regex.Rd' is no longer valid:

    >> If PCRE support was compiled from the sources within R, the PCRE
    >> version is 8.36 as described here.

Not quite.  It is still *valid* : every statement about the
elements of the empty set are true, in the same sense that

   if (FALSE)
     "something or other"

is never invalid, but of course, that information should still
be removed because indeed, it is empty.

Thank you Mikko!
      	  (and excuse the completely unnecessary pickyness ;-)


From mikko.korpela at aalto.fi  Thu Nov 19 11:51:01 2015
From: mikko.korpela at aalto.fi (Mikko Korpela)
Date: Thu, 19 Nov 2015 12:51:01 +0200
Subject: [Rd] Outdated information in regex.Rd
In-Reply-To: <22093.40687.411376.98127@stat.math.ethz.ch>
References: <564C4652.6050700@aalto.fi>
	<22093.40687.411376.98127@stat.math.ethz.ch>
Message-ID: <564DA995.8010904@aalto.fi>

On 19.11.2015 12:05, Martin Maechler wrote:
>>>>>> Mikko Korpela <mikko.korpela at aalto.fi>
>>>>>>     on Wed, 18 Nov 2015 11:35:14 +0200 writes:
> 
>     > The NEWS for R-devel has the following item:
>     >> The previously included versions of zlib, bzip2, xz and PCRE have
>     >> been removed, so suitable external (usually system) versions are
>     >> required (see the ?R Installation and Administration? manual).
> 
>     > Therefore I believe the following information in
>     > 'src/library/base/man/regex.Rd' is no longer valid:
> 
>     >> If PCRE support was compiled from the sources within R, the PCRE
>     >> version is 8.36 as described here.
> 
> Not quite.  It is still *valid* : every statement about the
> elements of the empty set are true, in the same sense that
> 
>    if (FALSE)
>      "something or other"
> 
> is never invalid, but of course, that information should still
> be removed because indeed, it is empty.
> 
> Thank you Mikko!
>       	  (and excuse the completely unnecessary pickyness ;-)

Thanks, I see that you already edited the .Rd file. Furthermore, I
accept your pickiness ;-)

- Mikko


From ripley at stats.ox.ac.uk  Thu Nov 19 14:08:30 2015
From: ripley at stats.ox.ac.uk (Brian Ripley)
Date: Thu, 19 Nov 2015 13:08:30 +0000
Subject: [Rd] Outdated information in regex.Rd
In-Reply-To: <22093.40687.411376.98127@stat.math.ethz.ch>
References: <564C4652.6050700@aalto.fi>
	<22093.40687.411376.98127@stat.math.ethz.ch>
Message-ID: <342F5290-97C0-4C0C-932E-32E73BD04F9E@stats.ox.ac.uk>



On 19 Nov 2015, at 10:05, Martin Maechler <maechler at stat.math.ethz.ch> wrote:

>>>>>> Mikko Korpela <mikko.korpela at aalto.fi>
>>>>>>    on Wed, 18 Nov 2015 11:35:14 +0200 writes:
> 
>> The NEWS for R-devel has the following item:
>>> The previously included versions of zlib, bzip2, xz and PCRE have
>>> been removed, so suitable external (usually system) versions are
>>> required (see the ?R Installation and Administration? manual).
> 
>> Therefore I believe the following information in
>> 'src/library/base/man/regex.Rd' is no longer valid:
> 
>>> If PCRE support was compiled from the sources within R, the PCRE
>>> version is 8.36 as described here.
> 
> Not quite.  It is still *valid* : every statement about the
> elements of the empty set are true, in the same sense that
> 
>   if (FALSE)
>     "something or other"
> 
> is never invalid, but of course, that information should still
> be removed because indeed, it is empty.

Help pages are not intended to be just about the current version of R but also recent versions, and most builds of 3.2.x will meet the condition.

However, as from 3.2.0 a user can find the version of PCRE in use by extSoftVersion, and I have added a comment about that, including for 3.2.3.

> 
> Thank you Mikko!
>            (and excuse the completely unnecessary pickyness ;-)
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From benjamin.hofner at fau.de  Thu Nov 19 19:06:45 2015
From: benjamin.hofner at fau.de (Benjamin Hofner)
Date: Thu, 19 Nov 2015 19:06:45 +0100
Subject: [Rd] format.pval
Message-ID: <564E0FB5.6060703@fau.de>

Today I stumbled upon a very strange behaviour of format.pval. If all p 
values are below the threshold eps one gets

format.pval(c(0.0002, 0.0004), eps = 0.001)
## [1] "< 0.001" "< 0.001"
format.pval(0.0004, eps = 0.001)
## [1] "< 0.001"

i.e., "< [eps]" as described in the manual of format.eps.


Yet, if one ore more are above (and one or more below) one gets

format.pval(c(1, 0.0004), eps = 0.001)
## [1] "1" "<0.001"

i.e., "<[eps]", without the blank after <.


One can also change this by setting digits = 1

format.pval(c(0.0002, 0.0004), eps = 0.001, digits = 1)
## [1] "<0.001" "<0.001"

 From the code I've learned that

sep <- if (digits == 1L && nc <= 6L) "" else " "

if any p values are above eps (nc = max(nchar(pv)) and

sep <- if (digits == 1) "" else " "

if all p values are  smaller than eps.

(Why) is this behaviour intended? I do not see any reason for the 
different outputs (nor for the arbitrary nc threshold). Yet, if it is 
intended it should be documented.

Best,
Benjamin


From julien.ide.fr at gmail.com  Fri Nov 20 09:39:52 2015
From: julien.ide.fr at gmail.com (=?UTF-8?Q?Julien_Id=C3=A9?=)
Date: Fri, 20 Nov 2015 09:39:52 +0100
Subject: [Rd] Good practice for naming classes, builders, attributes,
 getters/setters for object composition
Message-ID: <CAMDmGSb8zz9tbjaxRKn=fT-MPv4NG=h7kToX5x-B4B9YqrCrZw@mail.gmail.com>

Hey everyone,

I am developing a package and I am wondering if there is a good practice
for naming classes, builders, attributes getters and setters when dealing
with object composition. I know that it is usually a good practice to give
to the builder the same name as the class and, if possible, to avoid to use
upper case letters. My problem is that, when I build an object containing
an other object (of an other class), at the end my getters can have the
same name as my builders. Here is an example.

Lets define a first class "bonds" to store atomic bonds information:
bonds <- function(ind1, ind2, order){
  obj <- data.frame(ind1 = ind1, ind2 = ind2, order = order)
  class(obj) <- c("bonds", class(obj))
  return(obj)
}

Now I when to define an other class to store atomic properties.
As atoms can be bonded to each other, I add a "bonds" attribute which is of
class "bonds".
atoms <- function(symb, mass, charge, bonds){
  obj <- data.frame(symb = symb, mass = mass, charge = charge)
  attr(obj, "bonds") <- bonds
  class(obj) <- c("atoms", class(obj))
  return(obj)
}
Now if I when to get the "bonds" attribute of an "atoms" object, I have to
define:
bonds <- function(x)
  UseMethod("bonds")

bonds.atoms <- function(x)
  attr(x, "bonds")

As you can see my getter has the same name as the builder for class "bonds".
Any suggestion?

	[[alternative HTML version deleted]]


From lawrence.michael at gene.com  Fri Nov 20 13:48:55 2015
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Fri, 20 Nov 2015 04:48:55 -0800
Subject: [Rd] Good practice for naming classes, builders, attributes,
 getters/setters for object composition
In-Reply-To: <CAMDmGSb8zz9tbjaxRKn=fT-MPv4NG=h7kToX5x-B4B9YqrCrZw@mail.gmail.com>
References: <CAMDmGSb8zz9tbjaxRKn=fT-MPv4NG=h7kToX5x-B4B9YqrCrZw@mail.gmail.com>
Message-ID: <CAOQ5Nye1ypgeLw2kyX8PKY_cgGtTB8hZd9GdEUjLscv7857iiw@mail.gmail.com>

On Fri, Nov 20, 2015 at 12:39 AM, Julien Id? <julien.ide.fr at gmail.com> wrote:
> Hey everyone,
>
> I am developing a package and I am wondering if there is a good practice
> for naming classes, builders, attributes getters and setters when dealing
> with object composition. I know that it is usually a good practice to give
> to the builder the same name as the class and, if possible, to avoid to use
> upper case letters. My problem is that, when I build an object containing
> an other object (of an other class), at the end my getters can have the
> same name as my builders. Here is an example.
>
> Lets define a first class "bonds" to store atomic bonds information:
> bonds <- function(ind1, ind2, order){
>   obj <- data.frame(ind1 = ind1, ind2 = ind2, order = order)
>   class(obj) <- c("bonds", class(obj))
>   return(obj)
> }
>
> Now I when to define an other class to store atomic properties.
> As atoms can be bonded to each other, I add a "bonds" attribute which is of
> class "bonds".
> atoms <- function(symb, mass, charge, bonds){
>   obj <- data.frame(symb = symb, mass = mass, charge = charge)
>   attr(obj, "bonds") <- bonds
>   class(obj) <- c("atoms", class(obj))
>   return(obj)
> }
> Now if I when to get the "bonds" attribute of an "atoms" object, I have to
> define:
> bonds <- function(x)
>   UseMethod("bonds")
>
> bonds.atoms <- function(x)
>   attr(x, "bonds")
>
> As you can see my getter has the same name as the builder for class "bonds".
> Any suggestion?
>

I would definitely distinguish constructors from accessors somehow. In
Bioconductor, we use capitalized class names, and thus capitalized
constructors. If you don't like capital letters, you will need to
think of something else ;) Like new_bonds(), get_bonds(), etc.

Btw, bonds are not intrinsic to atoms, but rather molecules. You
should consider a molecule class.

>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From Sebastian.Meyer at ifspm.uzh.ch  Fri Nov 20 16:14:05 2015
From: Sebastian.Meyer at ifspm.uzh.ch (Sebastian Meyer)
Date: Fri, 20 Nov 2015 16:14:05 +0100
Subject: [Rd] R-devel no longer supports Ubuntu 14.04 LTS (insufficient PCRE
 version)
Message-ID: <564F38BD.4090000@ifspm.uzh.ch>

Since yesterday's r69662, R no longer ./configure[s] on a standard
Ubuntu 14.04.3 installation, which ships with PCRE 8.31
(http://packages.ubuntu.com/trusty-updates/libpcre3-dev)

I get:

> checking if PCRE version >= 8.32, < 10.0 and has UTF-8 support... no
> checking whether PCRE support suffices... configure: error: pcre library and headers are required

Are there any workarounds for this except for manually compiling and
installing a more recent version of PCRE from source?

Thanks!

	Sebastian


-- 
University of Zurich
Sebastian Meyer
Epidemiology, Biostatistics and Prevention Institute
(Department of Biostatistics)
Hirschengraben 84
CH-8001 Z?rich
Tel: +41 44 63-45485
Fax: +41 44 63-44386
www.biostat.uzh.ch
sebastian.meyer at uzh.ch


From edd at debian.org  Fri Nov 20 16:49:38 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 20 Nov 2015 09:49:38 -0600
Subject: [Rd] R-devel no longer supports Ubuntu 14.04 LTS (insufficient
 PCRE version)
In-Reply-To: <564F38BD.4090000@ifspm.uzh.ch>
References: <564F38BD.4090000@ifspm.uzh.ch>
Message-ID: <22095.16658.433345.705503@max.nulle.part>


On 20 November 2015 at 16:14, Sebastian Meyer wrote:
| Since yesterday's r69662, R no longer ./configure[s] on a standard
| Ubuntu 14.04.3 installation, which ships with PCRE 8.31
| (http://packages.ubuntu.com/trusty-updates/libpcre3-dev)
| 
| I get:
| 
| > checking if PCRE version >= 8.32, < 10.0 and has UTF-8 support... no
| > checking whether PCRE support suffices... configure: error: pcre library and headers are required
| 
| Are there any workarounds for this except for manually compiling and
| installing a more recent version of PCRE from source?

The technical term is 'backport'. You could try and see if someone has taken
the (Debian or Ubuntu) source package for pcre (current, ie >= 8.32) and
created a package on launchpad.net in a PPA.

Otherwise it is pretty easy to do yourself ... and if you just wait a little
Michael will have to do it anyway to get R 3.3 built for 14.04.

(I was just bitten yesterday by R 3.2.2 re-built for Ubuntu 12.04 [ as used
by Travis ] not having libcurl capabilities. But that may well be a more
involved library than pcre so I left it at that.)

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From ripley at stats.ox.ac.uk  Fri Nov 20 22:39:18 2015
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 20 Nov 2015 21:39:18 +0000
Subject: [Rd] R-devel no longer supports Ubuntu 14.04 LTS (insufficient
 PCRE version)
In-Reply-To: <564F38BD.4090000@ifspm.uzh.ch>
References: <564F38BD.4090000@ifspm.uzh.ch>
Message-ID: <564F9306.30707@stats.ox.ac.uk>

I think you have it backwards: Ubuntu 14.04 does not support R-devel ....

PCRE 8.32 is 3 years old, so Ubuntu 14.04 shipped an already quite old 
version 19 months ago.

R has long said that its requirement was

    PCRE (version 8.10 or later, preferably 8.32 or later)

and 8.32 is indeed preferable: the aim is that all the current PCRE 
regex syntax be usable on all platforms.

Given that you appear to be installing R from the sources, PCRE is no 
more difficult to install from source ....

R-devel is 'under development' and months off release: if this proves to 
be too restrictive we can postpone the aim to 3.4.x.


On 20/11/2015 15:14, Sebastian Meyer wrote:
> Since yesterday's r69662, R no longer ./configure[s] on a standard
> Ubuntu 14.04.3 installation, which ships with PCRE 8.31
> (http://packages.ubuntu.com/trusty-updates/libpcre3-dev)
>
> I get:
>
>> checking if PCRE version >= 8.32, < 10.0 and has UTF-8 support... no
>> checking whether PCRE support suffices... configure: error: pcre library and headers are required
>
> Are there any workarounds for this except for manually compiling and
> installing a more recent version of PCRE from source?
>
> Thanks!
>
> 	Sebastian
>
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Emeritus Professor of Applied Statistics, University of Oxford
1 South Parks Road, Oxford OX1 3TG, UK


From pgrosu at gmail.com  Sun Nov 22 05:11:01 2015
From: pgrosu at gmail.com (Paul Grosu)
Date: Sat, 21 Nov 2015 23:11:01 -0500
Subject: [Rd] Small request of a feature improvement in the next version
	of R
In-Reply-To: <1447755191.19134.45.camel@iarc.fr>
References: <0c3401d120d4$db715bd0$92541370$@gmail.com>
	<1447755191.19134.45.camel@iarc.fr>
Message-ID: <1a6701d124db$cd21d7c0$67658740$@gmail.com>

Hi Martyn,

I understand now what is happening and thank you for the nice explanation.
I am wondering now, based on the following definition:

"When $<- is applied to a NULL x, it first coerces x to list(). This is what
also happens with [[<- if the replacement value value is of length greater
than one: if value has length 1 or 0, x is first coerced to a zero-length
vector of the type of value."

The following works as expected:

m <- list()
m$"A3V6HVSALQ835D"$'profiles' <- 3
m$"A3V6HVSALQ835D"$'stars' <- c(1, 23)

But if the object encapsulating them (m) is already a list, why would it not
be sensible for any [[<- assignments underneath it be automatically
converted to a list?  It would be nice to have it automatically have m
become a list if one performs m[["A3V6HVSALQ835D"]][['profiles']] <- 3 on
the first assignment - without having to instantiate m to a list (i.e. m <-
list()).  Since R is heavily influenced by SEXP this would be as natural as
a cons().

For instance, I can create a list of functions but not with any other type:

> a <- function(something="Hi") { print( something ) }
> b <- a
> list( a, b )[[1]]()
[1] "Hi"
> list( a, b )[[2]]("there :)")
[1] "there :)"

In fact vectors become lists:

> c(a,b)
[[1]]
function (something = "Hi") 
{
    print(something)
}

[[2]]
function (something = "Hi") 
{
    print(something)
}

Even matrices become lists:

> as.matrix(c(a,b))
     [,1]
[1,] ?   
[2,] ?   
> as.matrix(c(a,b))[1]
[[1]]
function (something = "Hi") 
{
    print(something)
}

> as.matrix(c(a,b))[2]
[[1]]
function (something = "Hi") 
{
    print(something)
}

Since all become lists and the assignments are list-like, then it would be
nice to have the children of a list to automatically become a list, even
when they are accessed like a list and the parent (m) is not instantiated as
a list, which should automatically become a list.

I know I wrote a lot, but let me know if I should expand on anything for
clarification purposes.

Thank you,
Paul

-----Original Message-----
From: Martyn Plummer [mailto:plummerm at iarc.fr] 
Sent: Tuesday, November 17, 2015 5:13 AM
To: pgrosu at gmail.com
Cc: r-devel at r-project.org
Subject: Re: [Rd] Small request of a feature improvement in the next version
of R

On Mon, 2015-11-16 at 20:11 -0500, Paul Grosu wrote:
> Hi Everyone,
> 
> Sorry to bother the list with this small request, but I've run into 
> this issue and was wondering if it could be fixed in the next version of
R.
> Sorry if it was raised in a previous thread:
> 
> So when I try the following I get an error:
> 
> > m <- list()
> > m[["A3V6HVSALQ835D"]][['profiles']] <- 3 
> > m[["A3V6HVSALQ835D"]][['stars']] <- c(1, 23)
> Error in m[["A3V6HVSALQ835D"]][["stars"]] <- c(1, 23) : 
>   more elements supplied than there are to replace
>   
> As does the following:
> 
> > m <- list()
> > m[["A3V6HVSALQ835D"]][['profiles']] <- c() 
> > m[["A3V6HVSALQ835D"]][['stars']] <- c() 
> > m[["A3V6HVSALQ835D"]][['profiles']] <- 3 
> > m[["A3V6HVSALQ835D"]][['stars']] <- c(1, 23)
> Error in m[["A3V6HVSALQ835D"]][["stars"]] <- c(1, 23) : 
>   more elements supplied than there are to replace
> 
> But when I reverse the order, I don't:
> 
> > m <- list()
> > m[["A3V6HVSALQ835D"]][['stars']] <- c(1, 23) 
> > m[["A3V6HVSALQ835D"]][['profiles']] <- 3
> 
> As doesn't the following, with the order reversed for the assignment:
> 
> > m <- list()
> > m[["A3V6HVSALQ835D"]][['profiles']] <- c() 
> > m[["A3V6HVSALQ835D"]][['stars']] <- c() 
> > m[["A3V6HVSALQ835D"]][['stars']] <- c(1, 23) 
> > m[["A3V6HVSALQ835D"]][['profiles']] <- 3
> 
> And when I instantiate it in this way, it does not with the original
order:
> 
> > m <- list()
> > m[["A3V6HVSALQ835D"]][['profiles']] <- c() 
> > m[["A3V6HVSALQ835D"]][['stars']] <- list() 
> > m[["A3V6HVSALQ835D"]][['profiles']] <- 3 
> > m[["A3V6HVSALQ835D"]][['stars']] <- c(1, 23)
> 
> The request is so that order-specific assignments would not throw an 
> error, and I am using version 3.2.2 of R.

Your example combines two nested calls to the replacement function "[[<-".
It is a lot easier to understand what is going wrong if you break this down
into two separate function calls.

First, the element of m that you want to modify is NULL:

> m <- list()
> m[["A3V"]]
NULL

So the expression 

> m[["A3V"]][['profile']] <- 3

is equivalent to:

> tmp <- NULL
> tmp[['profile']] <- 3
> m[["A3V"]] <- tmp

Inspecting the result:

> m
$A3V
profile 
      3 

> class(m$A3V)
[1] "numeric"

So m$A3V is a numeric vector and not, as you expected, a list. This
behaviour of "[[<-" when applied to NULL objects is documented on the help
page: See help("[[<-")

The solution is to create m[["A3V"]] as a list before modifying its
elements:

> m <- list()
> m[["A3V"]] <- list()
...

Martyn

> Thank you,
> Paul
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-----------------------------------------------------------------------
This message and its attachments are strictly confidenti...{{dropped:8}}


From paul at stat.auckland.ac.nz  Mon Nov 23 01:44:41 2015
From: paul at stat.auckland.ac.nz (Paul Murrell)
Date: Mon, 23 Nov 2015 13:44:41 +1300
Subject: [Rd] R-devel no longer supports Ubuntu 14.04 LTS (insufficient
 PCRE version)
In-Reply-To: <564F9306.30707@stats.ox.ac.uk>
References: <564F38BD.4090000@ifspm.uzh.ch> <564F9306.30707@stats.ox.ac.uk>
Message-ID: <56526179.6090705@stat.auckland.ac.nz>


For the record ...

I'm on Ubuntu 14.04 too (probably until 16.04 comes out)

Paul

On 21/11/15 10:39, Prof Brian Ripley wrote:
> I think you have it backwards: Ubuntu 14.04 does not support R-devel ....
>
> PCRE 8.32 is 3 years old, so Ubuntu 14.04 shipped an already quite old
> version 19 months ago.
>
> R has long said that its requirement was
>
>     PCRE (version 8.10 or later, preferably 8.32 or later)
>
> and 8.32 is indeed preferable: the aim is that all the current PCRE
> regex syntax be usable on all platforms.
>
> Given that you appear to be installing R from the sources, PCRE is no
> more difficult to install from source ....
>
> R-devel is 'under development' and months off release: if this proves to
> be too restrictive we can postpone the aim to 3.4.x.
>
>
> On 20/11/2015 15:14, Sebastian Meyer wrote:
>> Since yesterday's r69662, R no longer ./configure[s] on a standard
>> Ubuntu 14.04.3 installation, which ships with PCRE 8.31
>> (http://packages.ubuntu.com/trusty-updates/libpcre3-dev)
>>
>> I get:
>>
>>> checking if PCRE version >= 8.32, < 10.0 and has UTF-8 support... no
>>> checking whether PCRE support suffices... configure: error: pcre
>>> library and headers are required
>>
>> Are there any workarounds for this except for manually compiling and
>> installing a more recent version of PCRE from source?
>>
>> Thanks!
>>
>>     Sebastian
>>
>>
>
>

-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From richierocks at gmail.com  Mon Nov 23 11:24:55 2015
From: richierocks at gmail.com (Richard Cotton)
Date: Mon, 23 Nov 2015 13:24:55 +0300
Subject: [Rd] Best way to implement optional functions?
In-Reply-To: <564A4460.4090105@gmail.com>
References: <56293F15.80509@gmail.com>
	<CAPp_+=di7F_JfbbL2eLk_XM9RXrL=1-sw=gO0o+42donMQ7WwQ@mail.gmail.com>
	<564A4460.4090105@gmail.com>
Message-ID: <CAPp_+=eMDcA5nNcKh_BqVyQVH3e8MHzimSfLws8ya_RAL_nmow@mail.gmail.com>

Yes, you do need at least a token about of documentation in both
packages.  I keep full documentation in the package where they
originate, and minimal documentation in the rexporting package.  The
roxygen code in the reexporting package looks like this:

#' Some function
#'
#' See \code{\link[originating_pkg]{some_function}}.
#' @name some_function
#' @export
NULL

I borrowed this idea from dplyr's reexporting of magrittr's pipe.

On 17 November 2015 at 00:02, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> On 16/11/2015 4:00 AM, Richard Cotton wrote:
>>
>> On 22 October 2015 at 22:55, Duncan Murdoch <murdoch.duncan at gmail.com>
>> wrote:
>>>
>>> I'm planning on adding some new WebGL functionality to the rgl package,
>>> but
>>> it will pull in a very large number of dependencies. Since many people
>>> won't
>>> need it, I'd like to make the new parts optional.
>>
>>
>>> Can people suggest other packages that solve this kind of problem in a
>>> good
>>> way?
>>
>>
>> I had the same issue with the assertive package: it was getting big,
>> and not everyone wanted all the functionality.
>>
>> The solution was to create several smaller packages with individual
>> components of functionality, for example assertive.base contains the
>> bare-minimum functionality; assertive.numbers contains functionality
>> related to numbers, etc.
>>
>> Then the assertive package imports all the functions from the
>> component packages and reexports them.
>>
>> That way people who want a small footprint (mostly other package
>> developers) can specify only what they need, and people who don't care
>> (mostly end users) can just type library(assertive) and get access to
>> everything.
>>
>
> When you import and re-export functions, do they need to be documented in
> both places?  I forget if we have a simple way to say "this function is
> documented in that package", to avoid duplication.
>
> Duncan Murdoch



-- 
Regards,
Richie

Learning R
4dpiecharts.com


From richierocks at gmail.com  Mon Nov 23 11:31:05 2015
From: richierocks at gmail.com (Richard Cotton)
Date: Mon, 23 Nov 2015 13:31:05 +0300
Subject: [Rd] capturing warnings using capture.output
Message-ID: <CAPp_+=e8fcyxCCqVwxWuYZpZ+sXGJbm04Mw0Zf8MUuht9dh3kA@mail.gmail.com>

>From the Details section of ?capture.output:

Messages sent to stderr() (including those from message, warning and stop)
are captured by type = "message". Note that this can be "unsafe" and should
only be used with care.

Capturing messages works as expected:

capture.output(message("!!!"), type = "message")
## [1] "!!!"

Capturing warnings doesn't seems to work:

capture.output(warning("!!!"), type = "message")
## character(0)
## Warning message:
## In eval(expr, envir, enclos) : !!!

Is the documentation wrong, or is this a bug, or am I doing doing silly?

-- 
Regards,
Richie

Learning R
4dpiecharts.com

	[[alternative HTML version deleted]]


From wdunlap at tibco.com  Mon Nov 23 17:53:26 2015
From: wdunlap at tibco.com (William Dunlap)
Date: Mon, 23 Nov 2015 08:53:26 -0800
Subject: [Rd] capturing warnings using capture.output
In-Reply-To: <CAPp_+=e8fcyxCCqVwxWuYZpZ+sXGJbm04Mw0Zf8MUuht9dh3kA@mail.gmail.com>
References: <CAPp_+=e8fcyxCCqVwxWuYZpZ+sXGJbm04Mw0Zf8MUuht9dh3kA@mail.gmail.com>
Message-ID: <CAF8bMca7sZTX+RtWnn44fUHsxWo2KGMntPTG4rh8380eAxForA@mail.gmail.com>

When options("warn") is 0, the default, the warning is not
printed until capture.output is done.  Use warn=1 to capture
the warnings as messages:

> options(warn=0)
> txt0 <- capture.output({message("A message"); warning("A warning")}, type="message")
Warning message:
In eval(expr, envir, enclos) : A warning
> options(warn=1)
> txt1 <- capture.output({message("A message"); warning("A warning")}, type="message")
> txt0
[1] "A message"
> txt1
[1] "A message"
[2] "Warning in eval(expr, envir, enclos) : A warning"
Bill Dunlap
TIBCO Software
wdunlap tibco.com


On Mon, Nov 23, 2015 at 2:31 AM, Richard Cotton <richierocks at gmail.com> wrote:
> >From the Details section of ?capture.output:
>
> Messages sent to stderr() (including those from message, warning and stop)
> are captured by type = "message". Note that this can be "unsafe" and should
> only be used with care.
>
> Capturing messages works as expected:
>
> capture.output(message("!!!"), type = "message")
> ## [1] "!!!"
>
> Capturing warnings doesn't seems to work:
>
> capture.output(warning("!!!"), type = "message")
> ## character(0)
> ## Warning message:
> ## In eval(expr, envir, enclos) : !!!
>
> Is the documentation wrong, or is this a bug, or am I doing doing silly?
>
> --
> Regards,
> Richie
>
> Learning R
> 4dpiecharts.com
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From pauljohn32 at gmail.com  Mon Nov 23 18:27:30 2015
From: pauljohn32 at gmail.com (Paul Johnson)
Date: Mon, 23 Nov 2015 11:27:30 -0600
Subject: [Rd] MKL Acceleration encouraging; need adjust package builds?
Message-ID: <CAErODj87PsLYoihk8Cd+gd_oLLWx1oaxO-0G3rNe4i5j+AV38w@mail.gmail.com>

Dear R-devel:

The Cluster administrators at KU got enthusiastic about testing
R-3.2.2 with Intel MKL when I asked for some BLAS integration.  Below
I forward a performance report, which is encouraging, and thought you
would like to know the numbers.  Appears to my untrained eye there are
some extraordinary speedups on Cholesky decomposition, determinants,
and matrix inversion.

They had difficulty getting R to compile with  R shared BLAS (don't
know what went wrong there), so they went the other direction.

In his message to me, the technician says that I should consider
adjusting the compilation flags on the packages that use BLAS.  Do you
think that is needed? R is compiled with non-shared BLAS libraries,
won't packages know where to look for BLAS headers?

2. If I need to do that, I wonder how to do it and which packages need
attention.  Eigen and Armadillo packages, and possibly the ones that
depend on them, lme4, anything flowing through Rcpp.

Here's the build for some packages. Are they finding MKL BLAS?  How
would I know?

* installing *source* package 'RcppArmadillo' ...
** package 'RcppArmadillo' successfully unpacked and MD5 sums checked
* checking LAPACK_LIBS: divide-and-conquer complex SVD available via
system LAPACK
** libs
g++ -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include
-I"/panfs/pfs.acf.ku.edu/crmda/tools/lib64/R/3.2/site-library/Rcpp/include"
 -I../inst/include -fpic  -O3 -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2
-fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64
-mtune=generic    -c RcppArmadillo.cpp -o RcppArmadillo.o
g++ -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include
-I"/panfs/pfs.acf.ku.edu/crmda/tools/lib64/R/3.2/site-library/Rcpp/include"
 -I../inst/include -fpic  -O3 -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2
-fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64
-mtune=generic    -c RcppExports.cpp -o RcppExports.o
g++ -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include
-I"/panfs/pfs.acf.ku.edu/crmda/tools/lib64/R/3.2/site-library/Rcpp/include"
 -I../inst/include -fpic  -O3 -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2
-fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64
-mtune=generic    -c fastLm.cpp -o fastLm.o
g++ -shared -L/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/lib
-L/usr/local/lib64 -o RcppArmadillo.so RcppArmadillo.o RcppExports.o
fastLm.o -L/panfs/pfs.acf.ku.edu/cluster/6.2/intel/2015/mkl/lib/intel64
-Wl,--no-as-needed -lmkl_gf_lp64 -Wl,--start-group -lmkl_gnu_thread
-lmkl_core -Wl,--end-group -fopenmp -ldl -lpthread -lm -lgfortran -lm
-L/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/lib -lR
installing to /panfs/pfs.acf.ku.edu/crmda/tools/lib64/R/3.2/site-library/RcppArmadillo/libs
** R
** inst
** preparing package for lazy loading
** help
*** installing help indices
** building package indices
** installing vignettes
** testing if installed package can be loaded
* DONE (RcppArmadillo)

* installing *source* package 'RcppEigen' ...
** package 'RcppEigen' successfully unpacked and MD5 sums checked
** libs
g++ -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include
-I"/panfs/pfs.acf.ku.edu/crmda/tools/lib64/R/3.2/site-library/Rcpp/include"
 -I../inst/include -fpic  -O3 -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2
-fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64
-mtune=generic    -c RcppEigen.cpp -o RcppEigen.o
g++ -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include
-I"/panfs/pfs.acf.ku.edu/crmda/tools/lib64/R/3.2/site-library/Rcpp/include"
 -I../inst/include -fpic  -O3 -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2
-fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64
-mtune=generic    -c RcppExports.cpp -o RcppExports.o
g++ -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include
-I"/panfs/pfs.acf.ku.edu/crmda/tools/lib64/R/3.2/site-library/Rcpp/include"
 -I../inst/include -fpic  -O3 -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2
-fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64
-mtune=generic    -c fastLm.cpp -o fastLm.o
g++ -shared -L/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/lib
-L/usr/local/lib64 -o RcppEigen.so RcppEigen.o RcppExports.o fastLm.o
-L/panfs/pfs.acf.ku.edu/cluster/6.2/intel/2015/mkl/lib/intel64
-Wl,--no-as-needed -lmkl_gf_lp64 -Wl,--start-group -lmkl_gnu_thread
-lmkl_core -Wl,--end-group -fopenmp -ldl -lpthread -lm -lgfortran -lm
-L/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/lib -lR
installing to /panfs/pfs.acf.ku.edu/crmda/tools/lib64/R/3.2/site-library/RcppEigen/libs
** R
** inst
** preparing package for lazy loading
** help
*** installing help indices
** building package indices
** installing vignettes
** testing if installed package can be loaded
* DONE (RcppEigen)

* installing *source* package 'MatrixModels' ...
** package 'MatrixModels' successfully unpacked and MD5 sums checked
** R
** preparing package for lazy loading
Creating a generic function for 'resid' from package 'stats' in
package 'MatrixModels'
Creating a generic function for 'fitted.values' from package 'stats'
in package 'MatrixModels'
Creating a generic function for 'coefficients' from package 'stats' in
package 'MatrixModels'
Creating a generic function for 'formula' from package 'stats' in
package 'MatrixModels'
Creating a generic function for 'coef' from package 'stats' in package
'MatrixModels'
Creating a generic function for 'fitted' from package 'stats' in
package 'MatrixModels'
Creating a generic function for 'residuals' from package 'stats' in
package 'MatrixModels'
** help
*** installing help indices
** building package indices
** testing if installed package can be loaded
* DONE (MatrixModels)
* installing *source* package 'quantreg' ...
** package 'quantreg' successfully unpacked and MD5 sums checked
** libs
gfortran   -fpic  -g -O2  -c akj.f -o akj.o
gfortran   -fpic  -g -O2  -c boot.f -o boot.o
gfortran   -fpic  -g -O2  -c brute.f -o brute.o
gcc -std=gnu99 -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include    -fpic
-I/panfs/pfs.acf.ku.edu/cluster/system/pkg/R/curl7.45_install/include
-L/panfs/pfs.acf.ku.edu/cluster/6.2/R/3.2.2_mkl/lib64  -c chlfct.c -o
chlfct.o
gfortran   -fpic  -g -O2  -c cholesky.f -o cholesky.o
gfortran   -fpic  -g -O2  -c combos.f -o combos.o
gfortran   -fpic  -g -O2  -c crq.f -o crq.o
gfortran   -fpic  -g -O2  -c crqfnb.f -o crqfnb.o
gfortran   -fpic  -g -O2  -c dsel05.f -o dsel05.o
gfortran   -fpic  -g -O2  -c etime.f -o etime.o
gfortran   -fpic  -g -O2  -c extract.f -o extract.o
gfortran   -fpic  -g -O2  -c idmin.f -o idmin.o
gfortran   -fpic  -g -O2  -c iswap.f -o iswap.o
gfortran   -fpic  -g -O2  -c kuantile.f -o kuantile.o
gcc -std=gnu99 -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include    -fpic
-I/panfs/pfs.acf.ku.edu/cluster/system/pkg/R/curl7.45_install/include
-L/panfs/pfs.acf.ku.edu/cluster/6.2/R/3.2.2_mkl/lib64  -c mcmb.c -o
mcmb.o
gfortran   -fpic  -g -O2  -c penalty.f -o penalty.o
gfortran   -fpic  -g -O2  -c powell.f -o powell.o
gfortran   -fpic  -g -O2  -c rls.f -o rls.o
gfortran   -fpic  -g -O2  -c rq0.f -o rq0.o
gfortran   -fpic  -g -O2  -c rq1.f -o rq1.o
gfortran   -fpic  -g -O2  -c rqbr.f -o rqbr.o
gfortran   -fpic  -g -O2  -c rqfn.f -o rqfn.o
gfortran   -fpic  -g -O2  -c rqfnb.f -o rqfnb.o
gfortran   -fpic  -g -O2  -c rqfnc.f -o rqfnc.o
gfortran   -fpic  -g -O2  -c rqs.f -o rqs.o
gfortran   -fpic  -g -O2  -c sparskit2.f -o sparskit2.o
gcc -std=gnu99 -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include    -fpic
-I/panfs/pfs.acf.ku.edu/cluster/system/pkg/R/curl7.45_install/include
-L/panfs/pfs.acf.ku.edu/cluster/6.2/R/3.2.2_mkl/lib64  -c srqfn.c -o
srqfn.o
gcc -std=gnu99 -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include    -fpic
-I/panfs/pfs.acf.ku.edu/cluster/system/pkg/R/curl7.45_install/include
-L/panfs/pfs.acf.ku.edu/cluster/6.2/R/3.2.2_mkl/lib64  -c srqfnc.c -o
srqfnc.o
gfortran   -fpic  -g -O2  -c srtpai.f -o srtpai.o
gcc -std=gnu99 -shared -L/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/lib
-L/usr/local/lib64 -o quantreg.so akj.o boot.o brute.o chlfct.o
cholesky.o combos.o crq.o crqfnb.o dsel05.o etime.o extract.o idmin.o
iswap.o kuantile.o mcmb.o penalty.o powell.o rls.o rq0.o rq1.o rqbr.o
rqfn.o rqfnb.o rqfnc.o rqs.o sparskit2.o srqfn.o srqfnc.o srtpai.o
-L/panfs/pfs.acf.ku.edu/cluster/6.2/intel/2015/mkl/lib/intel64
-Wl,--no-as-needed -lmkl_gf_lp64 -Wl,--start-group -lmkl_gnu_thread
-lmkl_core -Wl,--end-group -fopenmp -ldl -lpthread -lm -lgfortran -lm
-lgfortran -lm -L/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/lib -lR
installing to /panfs/pfs.acf.ku.edu/crmda/tools/lib64/R/3.2/site-library/quantreg/libs
** R
** data
** demo
** inst
** preparing package for lazy loading
** help
*** installing help indices
** building package indices
** installing vignettes
** testing if installed package can be loaded
* DONE (quantreg)


pj



Hi PJ,

We're still running the benchmarks to quantify the performance increase.

The R benchmarks for the MKL version are promising. The performance increase is
varied from test to test, but there isn't any degradation in performance by
using the MKL version. You can expect a 2x to 10x performance increase
depending on the matrix calculations you are performing. Here are the
compilation arguments we used for compiling R with MKL:

--disable-BLAS-shlib
--with-blas="-L/panfs/pfs.acf.ku.edu/cluster/6.2/intel/2015/mkl/lib/intel64 -W
l,--no-as-needed -lmkl_gf_lp64 -Wl,--start-group -lmkl_gnu_thread -lmkl_core
-Wl,--end-group -fopenmp -ldl -lpthread -lm" --with-lapack

You may want to include these while recompiling R packages which use BLAS.


Here are the results of the benchmark for the standard R 3.2.2:

R Benchmark 2.5
===============
Number of times each test is run__________________________: 3

I. Matrix calculation
---------------------
Creation, transp., deformation of a 2500x2500 matrix (sec): 2.69466666666667
2400x2400 normal distributed random matrix ^1000____ (sec): 1.42433333333333
Sorting of 7,000,000 random values__________________ (sec): 2.34466666666667
2800x2800 cross-product matrix (b = a' * a)_________ (sec): 33.187
Linear regr. over a 3000x3000 matrix (c = a \ b')___ (sec): 14.52
--------------------------------------------
Trimmed geom. mean (2 extremes eliminated): 4.51008013606039

II. Matrix functions
--------------------
FFT over 2,400,000 random values____________________ (sec): 1.203
Eigenvalues of a 640x640 random matrix______________ (sec): 1.60599999999999
Determinant of a 2500x2500 random matrix____________ (sec): 7.64266666666667
Cholesky decomposition of a 3000x3000 matrix________ (sec): 8.05900000000001
Inverse of a 1600x1600 random matrix________________ (sec): 8.64166666666667
--------------------------------------------
Trimmed geom. mean (2 extremes eliminated): 4.62477425061321

III. Programmation
------------------
3,500,000 Fibonacci numbers calculation (vector calc)(sec): 1.25633333333335
Creation of a 3000x3000 Hilbert matrix (matrix calc) (sec): 0.894999999999982
Grand common divisors of 400,000 pairs (recursion)__ (sec): 1.714
Creation of a 500x500 Toeplitz matrix (loops)_______ (sec): 1.4013333333333
Escoufier's method on a 45x45 matrix (mixed)________ (sec): 2.041
--------------------------------------------
Trimmed geom. mean (2 extremes eliminated): 1.44505946077978


Total time for all 15 tests_________________________ (sec): 88.6306666666667
Overall mean (sum of I, II and III trimmed means/3)_ (sec): 3.11209972260597
--- End of test ---


Here are the results for the MKL version:

R Benchmark 2.5
===============
Number of times each test is run__________________________: 3

I. Matrix calculation
---------------------
Creation, transp., deformation of a 2500x2500 matrix (sec): 2.88466666666667
2400x2400 normal distributed random matrix ^1000____ (sec): 1.45933333333333
Sorting of 7,000,000 random values__________________ (sec): 2.35166666666667
2800x2800 cross-product matrix (b = a' * a)_________ (sec): 3.37233333333333
Linear regr. over a 3000x3000 matrix (c = a \ b')___ (sec): 1.68666666666666
--------------------------------------------
Trimmed geom. mean (2 extremes eliminated): 2.25337542617509

II. Matrix functions
--------------------
FFT over 2,400,000 random values____________________ (sec): 1.232
Eigenvalues of a 640x640 random matrix______________ (sec): 0.823333333333333
Determinant of a 2500x2500 random matrix____________ (sec): 1.752
Cholesky decomposition of a 3000x3000 matrix________ (sec): 1.417
Inverse of a 1600x1600 random matrix________________ (sec): 1.33833333333334
--------------------------------------------
Trimmed geom. mean (2 extremes eliminated): 1.32693082905282

III. Programmation
------------------
3,500,000 Fibonacci numbers calculation (vector calc)(sec): 1.28600000000001
Creation of a 3000x3000 Hilbert matrix (matrix calc) (sec): 1.00833333333334
Grand common divisors of 400,000 pairs (recursion)__ (sec): 1.82266666666666
Creation of a 500x500 Toeplitz matrix (loops)_______ (sec): 1.40533333333334
Escoufier's method on a 45x45 matrix (mixed)________ (sec): 1.91199999999998
--------------------------------------------
Trimmed geom. mean (2 extremes eliminated): 1.48790723568791


Total time for all 15 tests_________________________ (sec): 25.7516666666667
Overall mean (sum of I, II and III trimmed means/3)_ (sec): 1.64469699141649
--- End of test ---



-- 
Paul E. Johnson
Professor, Political Science        Director
1541 Lilac Lane, Room 504      Center for Research Methods
University of Kansas                 University of Kansas
http://pj.freefaculty.org              http://crmda.ku.edu


From davidsmi at microsoft.com  Mon Nov 23 18:39:25 2015
From: davidsmi at microsoft.com (David Smith)
Date: Mon, 23 Nov 2015 17:39:25 +0000
Subject: [Rd] MKL Acceleration encouraging; need adjust package builds?
In-Reply-To: <CAErODj87PsLYoihk8Cd+gd_oLLWx1oaxO-0G3rNe4i5j+AV38w@mail.gmail.com>
References: <CAErODj87PsLYoihk8Cd+gd_oLLWx1oaxO-0G3rNe4i5j+AV38w@mail.gmail.com>
Message-ID: <DM2PR0301MB0848BF2B851C0D51A49629A3C8070@DM2PR0301MB0848.namprd03.prod.outlook.com>

Hi Paul,

We've been through this process ourselves for the Revolution R Open project. There are a number of pitfalls to avoid, but you can take a look at how we achieved it in the build scripts at:

https://github.com/RevolutionAnalytics/RRO

There are also some very useful notes in the R Installation guide:
https://cran.r-project.org/doc/manuals/r-release/R-admin.html#BLAS 

Most packages do benefit from MKL (or any multi-threaded BLAS) to some degree, although the actual benefit depends on the R functions they call. Some packages (and some built-in R functions) don't call into BLAS endpoints, so you won't see benefits in all cases.

# David Smith

-- 
David M Smith <davidsmi at microsoft.com>
R Community Lead, Revolution Analytics (a Microsoft company)? 
Tel: +1 (312) 9205766 (Chicago IL, USA)
Twitter: @revodavid | Blog: ?http://blog.revolutionanalytics.com
We are hiring engineers for Revolution R and Azure Machine Learning.

-----Original Message-----
From: R-devel [mailto:r-devel-bounces at r-project.org] On Behalf Of Paul Johnson
Sent: Monday, November 23, 2015 09:28
To: R Devel List <r-devel at r-project.org>
Subject: [Rd] MKL Acceleration encouraging; need adjust package builds?

Dear R-devel:

The Cluster administrators at KU got enthusiastic about testing
R-3.2.2 with Intel MKL when I asked for some BLAS integration.  Below I forward a performance report, which is encouraging, and thought you would like to know the numbers.  Appears to my untrained eye there are some extraordinary speedups on Cholesky decomposition, determinants, and matrix inversion.

They had difficulty getting R to compile with  R shared BLAS (don't know what went wrong there), so they went the other direction.

In his message to me, the technician says that I should consider adjusting the compilation flags on the packages that use BLAS.  Do you think that is needed? R is compiled with non-shared BLAS libraries, won't packages know where to look for BLAS headers?

2. If I need to do that, I wonder how to do it and which packages need attention.  Eigen and Armadillo packages, and possibly the ones that depend on them, lme4, anything flowing through Rcpp.

Here's the build for some packages. Are they finding MKL BLAS?  How would I know?

* installing *source* package 'RcppArmadillo' ...
** package 'RcppArmadillo' successfully unpacked and MD5 sums checked
* checking LAPACK_LIBS: divide-and-conquer complex SVD available via system LAPACK
** libs
g++ -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include
-I"/panfs/pfs.acf.ku.edu/crmda/tools/lib64/R/3.2/site-library/Rcpp/include"
 -I../inst/include -fpic  -O3 -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64
-mtune=generic    -c RcppArmadillo.cpp -o RcppArmadillo.o
g++ -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include
-I"/panfs/pfs.acf.ku.edu/crmda/tools/lib64/R/3.2/site-library/Rcpp/include"
 -I../inst/include -fpic  -O3 -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64
-mtune=generic    -c RcppExports.cpp -o RcppExports.o
g++ -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include
-I"/panfs/pfs.acf.ku.edu/crmda/tools/lib64/R/3.2/site-library/Rcpp/include"
 -I../inst/include -fpic  -O3 -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64
-mtune=generic    -c fastLm.cpp -o fastLm.o
g++ -shared -L/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/lib
-L/usr/local/lib64 -o https://na01.safelinks.protection.outlook.com/?url=RcppArmadillo.so&data=01%7c01%7cdavidsmi%40microsoft.com%7c80ae9ec8fef04c42eed808d2f42bf31d%7c72f988bf86f141af91ab2d7cd011db47%7c1&sdata=AwdY1xC74H25uBIyciugr9HeuGhYhnDGKoQkeDUhpeQ%3d RcppArmadillo.o RcppExports.o fastLm.o -L/panfs/pfs.acf.ku.edu/cluster/6.2/intel/2015/mkl/lib/intel64
-Wl,--no-as-needed -lmkl_gf_lp64 -Wl,--start-group -lmkl_gnu_thread -lmkl_core -Wl,--end-group -fopenmp -ldl -lpthread -lm -lgfortran -lm -L/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/lib -lR installing to /panfs/pfs.acf.ku.edu/crmda/tools/lib64/R/3.2/site-library/RcppArmadillo/libs
** R
** inst
** preparing package for lazy loading
** help
*** installing help indices
** building package indices
** installing vignettes
** testing if installed package can be loaded
* DONE (RcppArmadillo)

* installing *source* package 'RcppEigen' ...
** package 'RcppEigen' successfully unpacked and MD5 sums checked
** libs
g++ -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include
-I"/panfs/pfs.acf.ku.edu/crmda/tools/lib64/R/3.2/site-library/Rcpp/include"
 -I../inst/include -fpic  -O3 -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64
-mtune=generic    -c RcppEigen.cpp -o RcppEigen.o
g++ -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include
-I"/panfs/pfs.acf.ku.edu/crmda/tools/lib64/R/3.2/site-library/Rcpp/include"
 -I../inst/include -fpic  -O3 -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64
-mtune=generic    -c RcppExports.cpp -o RcppExports.o
g++ -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include
-I"/panfs/pfs.acf.ku.edu/crmda/tools/lib64/R/3.2/site-library/Rcpp/include"
 -I../inst/include -fpic  -O3 -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64
-mtune=generic    -c fastLm.cpp -o fastLm.o
g++ -shared -L/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/lib
-L/usr/local/lib64 -o https://na01.safelinks.protection.outlook.com/?url=RcppEigen.so&data=01%7c01%7cdavidsmi%40microsoft.com%7c80ae9ec8fef04c42eed808d2f42bf31d%7c72f988bf86f141af91ab2d7cd011db47%7c1&sdata=JKBcv7cUulJ07Du2ksIqghjWlkEkg%2b8RbNL64cvvYus%3d RcppEigen.o RcppExports.o fastLm.o
-L/panfs/pfs.acf.ku.edu/cluster/6.2/intel/2015/mkl/lib/intel64
-Wl,--no-as-needed -lmkl_gf_lp64 -Wl,--start-group -lmkl_gnu_thread -lmkl_core -Wl,--end-group -fopenmp -ldl -lpthread -lm -lgfortran -lm -L/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/lib -lR installing to /panfs/pfs.acf.ku.edu/crmda/tools/lib64/R/3.2/site-library/RcppEigen/libs
** R
** inst
** preparing package for lazy loading
** help
*** installing help indices
** building package indices
** installing vignettes
** testing if installed package can be loaded
* DONE (RcppEigen)

* installing *source* package 'MatrixModels' ...
** package 'MatrixModels' successfully unpacked and MD5 sums checked
** R
** preparing package for lazy loading
Creating a generic function for 'resid' from package 'stats' in package 'MatrixModels'
Creating a generic function for 'fitted.values' from package 'stats'
in package 'MatrixModels'
Creating a generic function for 'coefficients' from package 'stats' in package 'MatrixModels'
Creating a generic function for 'formula' from package 'stats' in package 'MatrixModels'
Creating a generic function for 'coef' from package 'stats' in package 'MatrixModels'
Creating a generic function for 'fitted' from package 'stats' in package 'MatrixModels'
Creating a generic function for 'residuals' from package 'stats' in package 'MatrixModels'
** help
*** installing help indices
** building package indices
** testing if installed package can be loaded
* DONE (MatrixModels)
* installing *source* package 'quantreg' ...
** package 'quantreg' successfully unpacked and MD5 sums checked
** libs
gfortran   -fpic  -g -O2  -c akj.f -o akj.o
gfortran   -fpic  -g -O2  -c boot.f -o boot.o
gfortran   -fpic  -g -O2  -c brute.f -o brute.o
gcc -std=gnu99 -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include    -fpic
-I/panfs/pfs.acf.ku.edu/cluster/system/pkg/R/curl7.45_install/include
-L/panfs/pfs.acf.ku.edu/cluster/6.2/R/3.2.2_mkl/lib64  -c chlfct.c -o chlfct.o
gfortran   -fpic  -g -O2  -c cholesky.f -o cholesky.o
gfortran   -fpic  -g -O2  -c combos.f -o combos.o
gfortran   -fpic  -g -O2  -c crq.f -o crq.o
gfortran   -fpic  -g -O2  -c crqfnb.f -o crqfnb.o
gfortran   -fpic  -g -O2  -c dsel05.f -o dsel05.o
gfortran   -fpic  -g -O2  -c etime.f -o etime.o
gfortran   -fpic  -g -O2  -c extract.f -o extract.o
gfortran   -fpic  -g -O2  -c idmin.f -o idmin.o
gfortran   -fpic  -g -O2  -c iswap.f -o iswap.o
gfortran   -fpic  -g -O2  -c kuantile.f -o kuantile.o
gcc -std=gnu99 -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include    -fpic
-I/panfs/pfs.acf.ku.edu/cluster/system/pkg/R/curl7.45_install/include
-L/panfs/pfs.acf.ku.edu/cluster/6.2/R/3.2.2_mkl/lib64  -c mcmb.c -o mcmb.o
gfortran   -fpic  -g -O2  -c penalty.f -o penalty.o
gfortran   -fpic  -g -O2  -c powell.f -o powell.o
gfortran   -fpic  -g -O2  -c rls.f -o rls.o
gfortran   -fpic  -g -O2  -c rq0.f -o rq0.o
gfortran   -fpic  -g -O2  -c rq1.f -o rq1.o
gfortran   -fpic  -g -O2  -c rqbr.f -o rqbr.o
gfortran   -fpic  -g -O2  -c rqfn.f -o rqfn.o
gfortran   -fpic  -g -O2  -c rqfnb.f -o rqfnb.o
gfortran   -fpic  -g -O2  -c rqfnc.f -o rqfnc.o
gfortran   -fpic  -g -O2  -c rqs.f -o rqs.o
gfortran   -fpic  -g -O2  -c sparskit2.f -o sparskit2.o
gcc -std=gnu99 -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include    -fpic
-I/panfs/pfs.acf.ku.edu/cluster/system/pkg/R/curl7.45_install/include
-L/panfs/pfs.acf.ku.edu/cluster/6.2/R/3.2.2_mkl/lib64  -c srqfn.c -o srqfn.o gcc -std=gnu99 -I/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/include
-I/usr/local/include    -fpic
-I/panfs/pfs.acf.ku.edu/cluster/system/pkg/R/curl7.45_install/include
-L/panfs/pfs.acf.ku.edu/cluster/6.2/R/3.2.2_mkl/lib64  -c srqfnc.c -o srqfnc.o
gfortran   -fpic  -g -O2  -c srtpai.f -o srtpai.o
gcc -std=gnu99 -shared -L/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/lib
-L/usr/local/lib64 -o https://na01.safelinks.protection.outlook.com/?url=quantreg.so&data=01%7c01%7cdavidsmi%40microsoft.com%7c80ae9ec8fef04c42eed808d2f42bf31d%7c72f988bf86f141af91ab2d7cd011db47%7c1&sdata=jwhQtiHxfZFerLI515tW7VRYIEGuxOrLIKktxR4KOlY%3d akj.o boot.o brute.o chlfct.o cholesky.o combos.o crq.o crqfnb.o dsel05.o etime.o extract.o idmin.o iswap.o kuantile.o mcmb.o penalty.o powell.o rls.o rq0.o rq1.o rqbr.o rqfn.o rqfnb.o rqfnc.o rqs.o sparskit2.o srqfn.o srqfnc.o srtpai.o
-L/panfs/pfs.acf.ku.edu/cluster/6.2/intel/2015/mkl/lib/intel64
-Wl,--no-as-needed -lmkl_gf_lp64 -Wl,--start-group -lmkl_gnu_thread -lmkl_core -Wl,--end-group -fopenmp -ldl -lpthread -lm -lgfortran -lm -lgfortran -lm -L/tools/cluster/6.2/R/3.2.2_mkl/lib64/R/lib -lR installing to /panfs/pfs.acf.ku.edu/crmda/tools/lib64/R/3.2/site-library/quantreg/libs
** R
** data
** demo
** inst
** preparing package for lazy loading
** help
*** installing help indices
** building package indices
** installing vignettes
** testing if installed package can be loaded
* DONE (quantreg)


pj



Hi PJ,

We're still running the benchmarks to quantify the performance increase.

The R benchmarks for the MKL version are promising. The performance increase is varied from test to test, but there isn't any degradation in performance by using the MKL version. You can expect a 2x to 10x performance increase depending on the matrix calculations you are performing. Here are the compilation arguments we used for compiling R with MKL:

--disable-BLAS-shlib
--with-blas="-L/panfs/pfs.acf.ku.edu/cluster/6.2/intel/2015/mkl/lib/intel64 -W l,--no-as-needed -lmkl_gf_lp64 -Wl,--start-group -lmkl_gnu_thread -lmkl_core -Wl,--end-group -fopenmp -ldl -lpthread -lm" --with-lapack

You may want to include these while recompiling R packages which use BLAS.


Here are the results of the benchmark for the standard R 3.2.2:

R Benchmark 2.5
===============
Number of times each test is run__________________________: 3

I. Matrix calculation
---------------------
Creation, transp., deformation of a 2500x2500 matrix (sec): 2.69466666666667
2400x2400 normal distributed random matrix ^1000____ (sec): 1.42433333333333 Sorting of 7,000,000 random values__________________ (sec): 2.34466666666667
2800x2800 cross-product matrix (b = a' * a)_________ (sec): 33.187 Linear regr. over a 3000x3000 matrix (c = a \ b')___ (sec): 14.52
--------------------------------------------
Trimmed geom. mean (2 extremes eliminated): 4.51008013606039

II. Matrix functions
--------------------
FFT over 2,400,000 random values____________________ (sec): 1.203 Eigenvalues of a 640x640 random matrix______________ (sec): 1.60599999999999 Determinant of a 2500x2500 random matrix____________ (sec): 7.64266666666667 Cholesky decomposition of a 3000x3000 matrix________ (sec): 8.05900000000001 Inverse of a 1600x1600 random matrix________________ (sec): 8.64166666666667
--------------------------------------------
Trimmed geom. mean (2 extremes eliminated): 4.62477425061321

III. Programmation
------------------
3,500,000 Fibonacci numbers calculation (vector calc)(sec): 1.25633333333335 Creation of a 3000x3000 Hilbert matrix (matrix calc) (sec): 0.894999999999982 Grand common divisors of 400,000 pairs (recursion)__ (sec): 1.714 Creation of a 500x500 Toeplitz matrix (loops)_______ (sec): 1.4013333333333 Escoufier's method on a 45x45 matrix (mixed)________ (sec): 2.041
--------------------------------------------
Trimmed geom. mean (2 extremes eliminated): 1.44505946077978


Total time for all 15 tests_________________________ (sec): 88.6306666666667 Overall mean (sum of I, II and III trimmed means/3)_ (sec): 3.11209972260597
--- End of test ---


Here are the results for the MKL version:

R Benchmark 2.5
===============
Number of times each test is run__________________________: 3

I. Matrix calculation
---------------------
Creation, transp., deformation of a 2500x2500 matrix (sec): 2.88466666666667
2400x2400 normal distributed random matrix ^1000____ (sec): 1.45933333333333 Sorting of 7,000,000 random values__________________ (sec): 2.35166666666667
2800x2800 cross-product matrix (b = a' * a)_________ (sec): 3.37233333333333 Linear regr. over a 3000x3000 matrix (c = a \ b')___ (sec): 1.68666666666666
--------------------------------------------
Trimmed geom. mean (2 extremes eliminated): 2.25337542617509

II. Matrix functions
--------------------
FFT over 2,400,000 random values____________________ (sec): 1.232 Eigenvalues of a 640x640 random matrix______________ (sec): 0.823333333333333 Determinant of a 2500x2500 random matrix____________ (sec): 1.752 Cholesky decomposition of a 3000x3000 matrix________ (sec): 1.417 Inverse of a 1600x1600 random matrix________________ (sec): 1.33833333333334
--------------------------------------------
Trimmed geom. mean (2 extremes eliminated): 1.32693082905282

III. Programmation
------------------
3,500,000 Fibonacci numbers calculation (vector calc)(sec): 1.28600000000001 Creation of a 3000x3000 Hilbert matrix (matrix calc) (sec): 1.00833333333334 Grand common divisors of 400,000 pairs (recursion)__ (sec): 1.82266666666666 Creation of a 500x500 Toeplitz matrix (loops)_______ (sec): 1.40533333333334 Escoufier's method on a 45x45 matrix (mixed)________ (sec): 1.91199999999998
--------------------------------------------
Trimmed geom. mean (2 extremes eliminated): 1.48790723568791


Total time for all 15 tests_________________________ (sec): 25.7516666666667 Overall mean (sum of I, II and III trimmed means/3)_ (sec): 1.64469699141649
--- End of test ---



--
Paul E. Johnson
Professor, Political Science        Director
1541 Lilac Lane, Room 504      Center for Research Methods
University of Kansas                 University of Kansas
https://na01.safelinks.protection.outlook.com/?url=http%3a%2f%2fpj.freefaculty.org&data=01%7c01%7cdavidsmi%40microsoft.com%7c80ae9ec8fef04c42eed808d2f42bf31d%7c72f988bf86f141af91ab2d7cd011db47%7c1&sdata=OQn3ZG5CWA3HRew7kSXouwHTARsGXFvzHHUoicoo%2fBA%3d              https://na01.safelinks.protection.outlook.com/?url=http%3a%2f%2fcrmda.ku.edu&data=01%7c01%7cdavidsmi%40microsoft.com%7c80ae9ec8fef04c42eed808d2f42bf31d%7c72f988bf86f141af91ab2d7cd011db47%7c1&sdata=uCFPVsWJzHYMKd6kWq33qFkOXvj4H51zcEEBcOdvxyI%3d

______________________________________________
R-devel at r-project.org mailing list
https://na01.safelinks.protection.outlook.com/?url=https%3a%2f%2fstat.ethz.ch%2fmailman%2flistinfo%2fr-devel&data=01%7c01%7cdavidsmi%40microsoft.com%7c80ae9ec8fef04c42eed808d2f42bf31d%7c72f988bf86f141af91ab2d7cd011db47%7c1&sdata=YFcT64Zhp8Qi1MMSh%2bhiLESj7t4kTfSp8CYoYtRp2LM%3d


From aixtools at gmail.com  Mon Nov 23 18:52:35 2015
From: aixtools at gmail.com (aixtools)
Date: Mon, 23 Nov 2015 18:52:35 +0100
Subject: [Rd] compile question
Message-ID: <56535263.4010706@gmail.com>

Dear all,

Starting all over again with R-devel of 22-11-2015.

After getting the dependancies (minimal graphics initially) I have been 
able to come this far - with a 64-bit build on AIX.

root at x072:[/data/prj/cran/64/R-devel]make
make[1]: Entering directory '/data/prj/cran/64/R-devel/m4'
make[1]: Nothing to be done for 'R'.
make[1]: Leaving directory '/data/prj/cran/64/R-devel/m4'
make[1]: Entering directory '/data/prj/cran/64/R-devel/tools'
make[1]: Nothing to be done for 'R'.
make[1]: Leaving directory '/data/prj/cran/64/R-devel/tools'
make[1]: Entering directory '/data/prj/cran/64/R-devel/doc'
make[2]: Entering directory '/data/prj/cran/64/R-devel/doc/html'
make[2]: Leaving directory '/data/prj/cran/64/R-devel/doc/html'
make[2]: Entering directory '/data/prj/cran/64/R-devel/doc/manual'
make[2]: Nothing to be done for 'R'.
make[2]: Leaving directory '/data/prj/cran/64/R-devel/doc/manual'
make[1]: Leaving directory '/data/prj/cran/64/R-devel/doc'
make[1]: Entering directory '/data/prj/cran/64/R-devel/etc'
make[1]: Leaving directory '/data/prj/cran/64/R-devel/etc'
make[1]: Entering directory '/data/prj/cran/64/R-devel/share'
make[1]: Leaving directory '/data/prj/cran/64/R-devel/share'
make[1]: Entering directory '/data/prj/cran/64/R-devel/src'
make[2]: Entering directory '/data/prj/cran/64/R-devel/src/scripts'
make[3]: Entering directory '/data/prj/cran/64/R-devel/src/scripts'
make[3]: Leaving directory '/data/prj/cran/64/R-devel/src/scripts'
make[2]: Leaving directory '/data/prj/cran/64/R-devel/src/scripts'
make[2]: Entering directory '/data/prj/cran/64/R-devel/src/include'
/bin/sh: ../../tools/missing:  not found.
Makefile:66: recipe for target 'stamp-h.in' failed
make[2]: *** [stamp-h.in] Error 127
make[2]: Leaving directory '/data/prj/cran/64/R-devel/src/include'
Makefile:28: recipe for target 'R' failed
make[1]: *** [R] Error 1
make[1]: Leaving directory '/data/prj/cran/64/R-devel/src'
Makefile:60: recipe for target 'R' failed
make: *** [R] Error 1

This is my configure call:

#!/usr/bin/ksh
# my_config_test

. /data/prj/cran/64/setup.env

./configure --enable-maintainer-mode  --enable-R-shlib --enable-lto 
--with-libpth-prefix=prefix=/opt \
         --disable-rpath --with-readline=no --with-x=no \
         --with-cairo=no --with-libpng=no --with-jpeglib=no 
--with-libtiff=no \
         --with-system-tre=no \
         --with-recommended-packages=no \
         --with-aix-soname=aix

And the environment is:
root at x072:[/data/prj/cran/64/R-devel]cat ../setup*
export OBJECT_MODE=64
export CC="gcc -maix64"
export CXX="g++ -maix64"
export F77="gfortran -maix64"
export FC="gfortran -maix64"
export LDFLAGS="-L/opt/lib/64 -lpcre"

FYI: configure ends with:
R is now configured for powerpc-ibm-aix7.1.3.0

   Source directory:          .
   Installation directory:    /usr/local

   C compiler:                gcc -maix64 -std=gnu99 -mminimal-toc -g -O2
   Fortran 77 compiler:       gfortran -maix64  -g -O2

   C++ compiler:              g++ -maix64  -g -O2
   C++11 compiler:            g++ -maix64  -std=c++11 -g -O2
   Fortran 90/95 compiler:    gfortran -maix64 -g -O2
   Obj-C compiler:

   Interfaces supported:
   External libraries:        curl
   Additional capabilities:   NLS
   Options enabled:           shared R library, R profiling, maintainer mode

   Capabilities skipped:      PNG, JPEG, TIFF, cairo, ICU
   Options not enabled:       shared BLAS, memory profiling

   Recommended packages:      no

Thanks for your insight re: the missing tools/missing (or whatever it is 
looking for!)

Michael


From edd at debian.org  Mon Nov 23 18:58:21 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 23 Nov 2015 11:58:21 -0600
Subject: [Rd] MKL Acceleration encouraging; need adjust package builds?
In-Reply-To: <CAErODj87PsLYoihk8Cd+gd_oLLWx1oaxO-0G3rNe4i5j+AV38w@mail.gmail.com>
References: <CAErODj87PsLYoihk8Cd+gd_oLLWx1oaxO-0G3rNe4i5j+AV38w@mail.gmail.com>
Message-ID: <22099.21437.853760.178270@max.nulle.part>


We said it before, but it bears repeating: BLAS is an interface.

So unless you use on a static library build, these library can be switch
after compilation and at essentially any point in time.  My (unfinished)
package gcbd shows how in its simple and vignette by comparing a number of
BLAS implementations.  See the (now dated) chart on page 9 of
  https://cran.rstudio.com/web/packages/gcbd/vignettes/gcbd.pdf
or this (old) blog post
  http://dirk.eddelbuettel.com/blog/2010/10/03/

While the charts could do with an update, they do show how eg reference blas
is clearly outperformed by Atlas or GotoBLAS (the predecessor to OpebBLAS).

Hope this helps,  Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From aixtools at gmail.com  Mon Nov 23 22:30:48 2015
From: aixtools at gmail.com (aixtools)
Date: Mon, 23 Nov 2015 22:30:48 +0100
Subject: [Rd] compile question
In-Reply-To: <56535263.4010706@gmail.com>
References: <56535263.4010706@gmail.com>
Message-ID: <56538588.40006@gmail.com>

On 2015-11-23 18:52, aixtools wrote:
> Dear all,
>
> Starting all over again with R-devel of 22-11-2015.
>
> After getting the dependancies (minimal graphics initially) I have 
> been able to come this far - with a 64-bit build on AIX.
>
>
>
> This is my configure call:
>
> #!/usr/bin/ksh
> # my_config_test
>
> . /data/prj/cran/64/setup.env
>
> ./configure --enable-maintainer-mode  --enable-R-shlib --enable-lto 
> --with-libpth-prefix=prefix=/opt \
             --prefix=/opt \
>         --disable-rpath --with-readline=no --with-x=no \
>         --with-cairo=no --with-libpng=no --with-jpeglib=no 
> --with-libtiff=no \
>         --with-aix-soname=aix
>
So, modified the configure call, just incase, to be a bit more 'normal', 
but still getting a failure with:

creating src/scripts/R.fe
make[3]: Entering directory '/data/prj/cran/64/R-devel/src/scripts'
mkdir -p -- ../../bin
make[3]: Leaving directory '/data/prj/cran/64/R-devel/src/scripts'
make[2]: Leaving directory '/data/prj/cran/64/R-devel/src/scripts'
make[2]: Entering directory '/data/prj/cran/64/R-devel/src/include'
mkdir -p -- ../../include
/bin/sh: ../../tools/missing:  not found.
Makefile:66: recipe for target 'stamp-h.in' failed
make[2]: *** [stamp-h.in] Error 127
make[2]: Leaving directory '/data/prj/cran/64/R-devel/src/include'
Makefile:28: recipe for target 'R' failed
make[1]: *** [R] Error 1
make[1]: Leaving directory '/data/prj/cran/64/R-devel/src'
Makefile:60: recipe for target 'R' failed
make: *** [R] Error 1

Everything seems top be in place, but I do not know GNU autotools well 
enough (I thought that is the origin of 'missing')

root at x072:[/data/prj/cran/64/R-devel]cd src/include
root at x072:[/data/prj/cran/64/R-devel/src/include]find ../.. -name missing
../../tools/missing
root at x072:[/data/prj/cran/64/R-devel/src/include]find ../.. -name 
missing -ls
101915983   11 -rwxrwxr-x  1 2300     2300        11135 Nov 14  2013 
../../tools/missing
root at x072:[/data/prj/cran/64/R-devel/src/include]head  ../../tools/missing
#! /bin/sh
# Common stub for a few missing GNU programs while installing.

scriptversion=2006-05-10.23

# Copyright (C) 1996, 1997, 1999, 2000, 2002, 2003, 2004, 2005, 2006
#   Free Software Foundation, Inc.
# Originally by Fran,cois Pinard <pinard at iro.umontreal.ca>, 1996.

# This program is free software; you can redistribute it and/or modify


> And the environment is:
> root at x072:[/data/prj/cran/64/R-devel]cat ../setup*
> export OBJECT_MODE=64
> export CC="gcc -maix64"
> export CXX="g++ -maix64"
> export F77="gfortran -maix64"
> export FC="gfortran -maix64"
> export LDFLAGS="-L/opt/lib/64 -lpcre"
>

> Thanks for your insight re: the missing tools/missing (or whatever it 
> is looking for!)
>
> Michael
>


From pgrosu at gmail.com  Mon Nov 23 23:33:24 2015
From: pgrosu at gmail.com (Paul Grosu)
Date: Mon, 23 Nov 2015 17:33:24 -0500
Subject: [Rd] compile question
In-Reply-To: <56538588.40006@gmail.com>
References: <56535263.4010706@gmail.com> <56538588.40006@gmail.com>
Message-ID: <033401d1263e$f7980ce0$e6c826a0$@gmail.com>

Hi Michael,

I experienced the same thing in the past.  After you get the R-3.2.2.tar.gz
and uncompress it, enter the R-3.2.2 directory and run the ./configure and
make from there, rather than a different one.

One other thing, you probably already did this, but just in case you might
want to double-check this section as well:

https://cran.r-project.org/doc/manuals/r-release/R-admin.html#AIX

Hope it helps,
~p

-----Original Message-----
From: R-devel [mailto:r-devel-bounces at r-project.org] On Behalf Of aixtools
Sent: Monday, November 23, 2015 4:31 PM
To: r-devel at r-project.org
Subject: Re: [Rd] compile question

On 2015-11-23 18:52, aixtools wrote:
> Dear all,
>
> Starting all over again with R-devel of 22-11-2015.
>
> After getting the dependancies (minimal graphics initially) I have 
> been able to come this far - with a 64-bit build on AIX.
>
>
>
> This is my configure call:
>
> #!/usr/bin/ksh
> # my_config_test
>
> . /data/prj/cran/64/setup.env
>
> ./configure --enable-maintainer-mode  --enable-R-shlib --enable-lto 
> --with-libpth-prefix=prefix=/opt \
             --prefix=/opt \
>         --disable-rpath --with-readline=no --with-x=no \
>         --with-cairo=no --with-libpng=no --with-jpeglib=no 
> --with-libtiff=no \
>         --with-aix-soname=aix
>
So, modified the configure call, just incase, to be a bit more 'normal', but
still getting a failure with:

creating src/scripts/R.fe
make[3]: Entering directory '/data/prj/cran/64/R-devel/src/scripts'
mkdir -p -- ../../bin
make[3]: Leaving directory '/data/prj/cran/64/R-devel/src/scripts'
make[2]: Leaving directory '/data/prj/cran/64/R-devel/src/scripts'
make[2]: Entering directory '/data/prj/cran/64/R-devel/src/include'
mkdir -p -- ../../include
/bin/sh: ../../tools/missing:  not found.
Makefile:66: recipe for target 'stamp-h.in' failed
make[2]: *** [stamp-h.in] Error 127
make[2]: Leaving directory '/data/prj/cran/64/R-devel/src/include'
Makefile:28: recipe for target 'R' failed
make[1]: *** [R] Error 1
make[1]: Leaving directory '/data/prj/cran/64/R-devel/src'
Makefile:60: recipe for target 'R' failed
make: *** [R] Error 1

Everything seems top be in place, but I do not know GNU autotools well
enough (I thought that is the origin of 'missing')

root at x072:[/data/prj/cran/64/R-devel]cd src/include
root at x072:[/data/prj/cran/64/R-devel/src/include]find ../.. -name missing
../../tools/missing root at x072:[/data/prj/cran/64/R-devel/src/include]find
../.. -name missing -ls
101915983   11 -rwxrwxr-x  1 2300     2300        11135 Nov 14  2013 
../../tools/missing
root at x072:[/data/prj/cran/64/R-devel/src/include]head  ../../tools/missing
#! /bin/sh # Common stub for a few missing GNU programs while installing.

scriptversion=2006-05-10.23

# Copyright (C) 1996, 1997, 1999, 2000, 2002, 2003, 2004, 2005, 2006
#   Free Software Foundation, Inc.
# Originally by Fran,cois Pinard <pinard at iro.umontreal.ca>, 1996.

# This program is free software; you can redistribute it and/or modify


> And the environment is:
> root at x072:[/data/prj/cran/64/R-devel]cat ../setup* export 
> OBJECT_MODE=64 export CC="gcc -maix64"
> export CXX="g++ -maix64"
> export F77="gfortran -maix64"
> export FC="gfortran -maix64"
> export LDFLAGS="-L/opt/lib/64 -lpcre"
>

> Thanks for your insight re: the missing tools/missing (or whatever it 
> is looking for!)
>
> Michael
>

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From pdalgd at gmail.com  Mon Nov 23 23:43:48 2015
From: pdalgd at gmail.com (peter dalgaard)
Date: Mon, 23 Nov 2015 23:43:48 +0100
Subject: [Rd] compile question
In-Reply-To: <56538588.40006@gmail.com>
References: <56535263.4010706@gmail.com> <56538588.40006@gmail.com>
Message-ID: <81EBBC68-83B0-4843-8236-B9141EAA8988@gmail.com>


> On 23 Nov 2015, at 22:30 , aixtools <aixtools at gmail.com> wrote:
> 
>> 
>> ./configure --enable-maintainer-mode ...

Two things here

- possibly irrelevant, but I'd avoid building in the source directory. (mkdir ../BUILD ; cd ../BUILD; ../R/configure)

- don't turn on mantainer mode. You are not a maintainer, and if you want to play at being one, I think you need extra tools.

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From jeroen.ooms at stat.ucla.edu  Tue Nov 24 00:10:12 2015
From: jeroen.ooms at stat.ucla.edu (Jeroen Ooms)
Date: Tue, 24 Nov 2015 00:10:12 +0100
Subject: [Rd] Custom C finalizers for .Call
Message-ID: <CABFfbXtMz3s5MeQ-5=iaJA=5Kr_dhk9RLB82qeXRz1oa4qOpsw@mail.gmail.com>

WRE explains that R_alloc() can be used to allocate memory which
automatically gets released by R at the end of a .C, .Call or
.External, even in the case of an error or interruption. This is a
really great feature to prevent memory leaks. I was wondering if there
is a way to extend this mechanism to allow for automatically running
UNPROTECT and custom finalizers at the end of a .Call as well.

Currently it is all to easy for package authors to introduce a memory
leak or stack imbalance by calling Rf_error() or
R_CheckUserInterrupt() in a way that skips over the usual cleanup
steps. This holds especially for packages interfacing C libraries
(libcurl, libxml2, openssl, etc) which require xx_new() and xx_free()
functions to allocate/free various types of objects, handles and
contexts. Therefore we cannot use R_alloc() and we need to manually
clean up when returning, which is tricky for irregular exits.

Moreover package authors might benefit from an alternative of
allocVector() which automatically protects the SEXP until the .Call is
done. Perhaps I don't fully appreciate the complexity of the garbage
collector, but one could imagine a variant of PROTECT() which
automatically keeps a counter 'n' for the number of allocated objects
and makes R run UNPROTECT(n) when .Call exists, along with releasing
the R_alloc() memory. Yes, there are cases where it is useful to have
manual control over what can be collected earlier during the .Call
procedure, but these are rare. A lot of C code in packages might
become safer and cleaner if authors would have an option to let this
be automated.

The most general feature would a hook for adding custom C functions to
the .Call exit, similar to on.exit() in R:

  xmlNodePtr *node =  xmlNewNode(...);
  Rf_on_exit(xmlFreeNode, node);
  EVP_PKEY_CTX *ctx = EVP_PKEY_CTX_new(...);
  Rf_on_exit(EVP_PKEY_CTX_free, ctx);
  SEXP out = PROTECT(allocVector(...));
  Rf_on_exit(UNPROTECT, 1);

I don't know R's internals well enough to estimate if something like
this would be possible. I did put together a simple C example of a
linked list with object pointers and their corresponding free
functions, which can easily be free'd with a single call:
http://git.io/vBqRA . So basically what is mostly missing at this
point is a way to trigger this at the end of the .Call in a way that
works for regular returns, errors and interruptions...


From edd at debian.org  Tue Nov 24 04:57:50 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 23 Nov 2015 21:57:50 -0600
Subject: [Rd] R-devel no longer supports Ubuntu 14.04 LTS (insufficient
 PCRE version)
In-Reply-To: <56526179.6090705@stat.auckland.ac.nz>
References: <564F38BD.4090000@ifspm.uzh.ch> <564F9306.30707@stats.ox.ac.uk>
	<56526179.6090705@stat.auckland.ac.nz>
Message-ID: <22099.57406.667438.668290@max.nulle.part>


Sebastian, Paul,

Ubuntu 14.04 builds (for Linux 32 and 64 bit, ie i386 and amd64) of the (most
current) pcre package (ie 8.35-7) for Ubuntu are now in my PPA at

   https://launchpad.net/~edd/+archive/ubuntu/misc/+packages

These should work.  You can add this PPA as I do in some Travis runs via

   sudo add-apt-repository -y ppa:edd/misc

and then just do

   apt-get update; apt-get install libpcre3-dev

which should do the trick -- but I haven't tested.  Contact me off-list if
you fail.

Oh, and I guess we should have had this whole thread over on r-sig-debian.

Best,  Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From atp at piskorski.com  Wed Nov 25 00:20:24 2015
From: atp at piskorski.com (Andrew Piskorski)
Date: Tue, 24 Nov 2015 18:20:24 -0500
Subject: [Rd] Custom C finalizers for .Call
In-Reply-To: <CABFfbXtMz3s5MeQ-5=iaJA=5Kr_dhk9RLB82qeXRz1oa4qOpsw@mail.gmail.com>
References: <CABFfbXtMz3s5MeQ-5=iaJA=5Kr_dhk9RLB82qeXRz1oa4qOpsw@mail.gmail.com>
Message-ID: <20151124232023.GF64589@piskorski.com>

On Tue, Nov 24, 2015 at 12:10:12AM +0100, Jeroen Ooms wrote:

> Currently it is all to easy for package authors to introduce a memory
> leak or stack imbalance by calling Rf_error() or
> R_CheckUserInterrupt() in a way that skips over the usual cleanup
> steps.

I have a more modest request:  Please improve the documentation of
exactly what Rf_error() does and how it should be used!  E.g., does
calling it terminate execution of the C function from which it is
called, or not?  The docs below don't actually say:

  https://cran.r-project.org/doc/manuals/r-devel/R-exts.html#Error-handling
  https://cran.r-project.org/doc/manuals/r-devel/R-ints.html#Warnings-and-errors

The docs imply that these are "C-level equivalents" to the R stop()
function, which of course DOES terminate execution.  I believe
Rf_error() does also, but I really wish it was explicitly stated one
way or the other.

Grepping the R source, I never did find where Rf_error() is actually
implemented.  What am I missing?

In src/include/Rinternals.h, the implementation of error_return()
first calls Rf_error(msg) and then does a separate "return R_NilValue"
in the next statement.  So you might think that Rf_error() must NOT
terminate execution, otherwise why the extra return statement?  But it
also has a comment:

  /* return(.) NOT reached : for -Wall */

Meaning that that return statement is just to silence compiler
warnings, and is not supposed to be reached because Rf_error()
terminates execution.  But this is a ridiculously roundabout way to
infer what the behavior of Rf_error() is supposed to be...

-- 
Andrew Piskorski <atp at piskorski.com>


From murdoch.duncan at gmail.com  Wed Nov 25 00:58:45 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 24 Nov 2015 18:58:45 -0500
Subject: [Rd] Custom C finalizers for .Call
In-Reply-To: <20151124232023.GF64589@piskorski.com>
References: <CABFfbXtMz3s5MeQ-5=iaJA=5Kr_dhk9RLB82qeXRz1oa4qOpsw@mail.gmail.com>
	<20151124232023.GF64589@piskorski.com>
Message-ID: <5654F9B5.2080407@gmail.com>

On 24/11/2015 6:20 PM, Andrew Piskorski wrote:
> On Tue, Nov 24, 2015 at 12:10:12AM +0100, Jeroen Ooms wrote:
>
>> Currently it is all to easy for package authors to introduce a memory
>> leak or stack imbalance by calling Rf_error() or
>> R_CheckUserInterrupt() in a way that skips over the usual cleanup
>> steps.
>
> I have a more modest request:  Please improve the documentation of
> exactly what Rf_error() does and how it should be used!  E.g., does
> calling it terminate execution of the C function from which it is
> called, or not?  The docs below don't actually say:
>
>    https://cran.r-project.org/doc/manuals/r-devel/R-exts.html#Error-handling
>    https://cran.r-project.org/doc/manuals/r-devel/R-ints.html#Warnings-and-errors
>
> The docs imply that these are "C-level equivalents" to the R stop()
> function, which of course DOES terminate execution.  I believe
> Rf_error() does also, but I really wish it was explicitly stated one
> way or the other.

I'd imagine the author of that section thought it *was* explicit.  The 
documentation can't answer every question, or clarify every 
misunderstanding.  That's why R-devel exists.  fortune("source")
is also relevant.  But now that you know the truth, you could suggest 
rewording, as an svn patch against the trunk version of R-exts.texi.

> Grepping the R source, I never did find where Rf_error() is actually
> implemented.  What am I missing?

You probably forgot to grep the .h files:

include\R_ext\Error.h(48): #define error Rf_error

The implementation of the function calls it error(), and uses the define 
to remap that to Rf_error().  You can find the implementation in (where 
else?) src/main/errors.c.

>
> In src/include/Rinternals.h, the implementation of error_return()
> first calls Rf_error(msg) and then does a separate "return R_NilValue"
> in the next statement.  So you might think that Rf_error() must NOT
> terminate execution, otherwise why the extra return statement?  But it
> also has a comment:
>
>    /* return(.) NOT reached : for -Wall */
>
> Meaning that that return statement is just to silence compiler
> warnings, and is not supposed to be reached because Rf_error()
> terminates execution.  But this is a ridiculously roundabout way to
> infer what the behavior of Rf_error() is supposed to be...

I won't disagree that you took a roundabout route to the right conclusion.

Duncan Murdoch


From aixtools at gmail.com  Wed Nov 25 14:45:05 2015
From: aixtools at gmail.com (Michael Felt)
Date: Wed, 25 Nov 2015 14:45:05 +0100
Subject: [Rd] compile question
In-Reply-To: <81EBBC68-83B0-4843-8236-B9141EAA8988@gmail.com>
References: <56535263.4010706@gmail.com> <56538588.40006@gmail.com>
	<81EBBC68-83B0-4843-8236-B9141EAA8988@gmail.com>
Message-ID: <5655BB61.5060303@gmail.com>

On 2015-11-23 23:43, peter dalgaard wrote:
>> On 23 Nov 2015, at 22:30 , aixtools<aixtools at gmail.com>  wrote:
>>
>>> ./configure --enable-maintainer-mode ...
> Two things here
>
> - possibly irrelevant, but I'd avoid building in the source directory. (mkdir ../BUILD ; cd ../BUILD; ../R/configure)
I'll try this. It is a requirement for building gcc.
>
> - don't turn on mantainer mode. You are not a maintainer, and if you want to play at being one, I think you need extra tools.
>
Nope - do not want to be a maintainer (of R) - just hope to have a easy 
to install package. I was trying the flag because it helped spot things 
while packaging httpd. Would not have it on for normal packaging. I was 
thinking more verbose messages.

Thanks.


From aixtools at gmail.com  Wed Nov 25 14:49:57 2015
From: aixtools at gmail.com (Michael Felt)
Date: Wed, 25 Nov 2015 14:49:57 +0100
Subject: [Rd] compile question
In-Reply-To: <033401d1263e$f7980ce0$e6c826a0$@gmail.com>
References: <56535263.4010706@gmail.com> <56538588.40006@gmail.com>
	<033401d1263e$f7980ce0$e6c826a0$@gmail.com>
Message-ID: <5655BC85.6070807@gmail.com>

On 2015-11-23 23:33, Paul Grosu wrote:
> Hi Michael,
>
> I experienced the same thing in the past.  After you get the R-3.2.2.tar.gz
> and uncompress it, enter the R-3.2.2 directory and run the ./configure and
> make from there, rather than a different one.
I have been able to get a 32-bit build, easily, with R-3.1.3, and I 
think also with R-3.2.2. But the 64-bit builds have not been 
straightforward. Unusual and/or unexpected messages.
As a lot of packaging changes have been made - noteably the removal of 
several libraries that must now come from the system - make me think 
that focusing on the R-devel branch is more relevant.

However, I should probably revisit R-3.2.2!

>
> One other thing, you probably already did this, but just in case you might
> want to double-check this section as well:
>
> https://cran.r-project.org/doc/manuals/r-release/R-admin.html#AIX
Yes, I have been using this - and it helps.
>
> Hope it helps,
Thanks!
> ~p
>
> -----Original Message-----
> From: R-devel [mailto:r-devel-bounces at r-project.org] On Behalf Of aixtools
> Sent: Monday, November 23, 2015 4:31 PM
> To: r-devel at r-project.org
> Subject: Re: [Rd] compile question
>
> On 2015-11-23 18:52, aixtools wrote:
>> Dear all,
>>
>> Starting all over again with R-devel of 22-11-2015.
>>
>> After getting the dependancies (minimal graphics initially) I have
>> been able to come this far - with a 64-bit build on AIX.
>>
>>
snip...


From aixtools at gmail.com  Wed Nov 25 16:52:22 2015
From: aixtools at gmail.com (Michael Felt)
Date: Wed, 25 Nov 2015 16:52:22 +0100
Subject: [Rd] compile question - now status update
In-Reply-To: <81EBBC68-83B0-4843-8236-B9141EAA8988@gmail.com>
References: <56535263.4010706@gmail.com> <56538588.40006@gmail.com>
	<81EBBC68-83B0-4843-8236-B9141EAA8988@gmail.com>
Message-ID: <5655D936.5080804@gmail.com>

On 2015-11-23 23:43, peter dalgaard wrote:
>> On 23 Nov 2015, at 22:30 , aixtools<aixtools at gmail.com>  wrote:
>>
>>> ./configure --enable-maintainer-mode ...
> Two things here
>
> - possibly irrelevant, but I'd avoid building in the source directory. (mkdir ../BUILD ; cd ../BUILD; ../R/configure)
>
> - don't turn on mantainer mode. You are not a maintainer, and if you want to play at being one, I think you need extra tools.
>
Took advice, and moving forward. Currently both 32-bit and 64-bit are 
having similar issues - which I prefer to one working perfectly and the 
other having issues.

Main issues are dublicate issues and a missing function - that I would 
expect to be in libm (logf()).

So, for both 32-bit and 64-bit, even with -lm added to LDFLAGS it is 
ending with:

byte-compiling package 'grDevices'
Warning in solve.default(rgb) :
   unable to load shared object 
'/data/prj/cran/32/R-build/modules//lapack.so':
   rtld: 0712-001 Symbol logf was referenced
       from module /data/prj/cran/32/R-build/lib/libRlapack.so(), but a 
runtime definition
             of the symbol was not found.
Error in solve.default(rgb) : LAPACK routines cannot be loaded
Error: unable to load R code in package 'grDevices'
Execution halted
/data/prj/cran/R-devel/share/make/lazycomp.mk:7: recipe for target 
'../../../library/grDevices/R/grDevices.rdb' failed

For the interested, I have captured the screen outputs of the configure 
and make - sub-directory 003 is the last 64-bit I tried, and 
sub-directory 004 is the 32-bit build. See 
http://download.aixtools.net/test/R/2015-11-23/ as I do not want to bog 
down mailers with included files.

* Note that the 32-bit build failed because the 64-bit curl include 
files were still installed. MAYBE it is worth considering having curl
included again in the source distribution. That way the correct include 
files can be included in R directories for packages et al that are being 
built around/based upon R environment.


From simon.urbanek at r-project.org  Wed Nov 25 16:53:35 2015
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 25 Nov 2015 10:53:35 -0500
Subject: [Rd] Custom C finalizers for .Call
In-Reply-To: <CABFfbXtMz3s5MeQ-5=iaJA=5Kr_dhk9RLB82qeXRz1oa4qOpsw@mail.gmail.com>
References: <CABFfbXtMz3s5MeQ-5=iaJA=5Kr_dhk9RLB82qeXRz1oa4qOpsw@mail.gmail.com>
Message-ID: <6FFEA84B-6DD0-4075-A131-0260E9034308@r-project.org>

Jeroen,

I agree that it may be useful to have some kind of "finally"-like infrastructure. However, in the use cases you list there are already ways to do that - the same way that R_alloc uses. First, you don't need to call UNPROTECT - the whole point is that the protection stack is automatically popped in case of an abnormal termination. That is precisely how memory leaks are prevented - as long as you play by the rules it will be released for you. The check for UNPROTECTs at the end of .Call is explicitly there so catch bugs in *normal* termination. So no memory leaks there.

The real case where users may create leaks is if you allocate memory that you don't tell R about. As long as you associate a finalizer with any non-R memory you allocate, there will be no memory leaks -that is how you are supposed to write R packages with external allocations. So the only difference to your example is that you don't register a finalizer with the *function* but rather with the *allocation* you make. That also seems IMHO less error prone.

So to take your example, the way would typically write that code safely is something like

typedef struct {
  xmlNodePtr *node;
 EVP_PKEY_CTX *ctx;
} my_context_t;

// define how to dispose of all things you care about correctly
static void context_fin(SEXP what) {
    my_context_t *c = (my_context_t*) EXTPTR_PTR(what);
    if (!c) return;
    if (c->ctx) EVP_PKEY_CTX_free(c->ctx);
    if (c->node) xmlFreeNode(c->node);
}

[...]
// allocate the context and tell R to manage its protection and finalization
// (you could write a macro to make this one-liner)
my_context_t* c = (my_context_t*) R_Calloc(1, my_context_t);
SEXP res = PROTECT(R_MakeExternalPtr(c, R_NilValue, R_NilValue));
R_RegisterCFinalizer(res, context_fin);

// do all work here ... you safely abort at any point without memory leaks
c->node =  xmlNewNode(...);
c->ctx = EVP_PKEY_CTX_new(...);
[...]

The point of using a finalizer is that no matter what happens the memory is always released. The structure with all allocations is protected until you unprotect it or there is any interrupt/error. Since all regular R rules apply, you can also assign it someplace to make the protection dependent on any other object you care about. This is often useful because you don't need to PROTECT things left and right, but instead you can just have one object that holds references to random things you care about.

Of course, you could write a wrapper for the above with some syntactic sugar to achieve the same - essentially limiting the finalizer to be just a function call on the reference that you create. It may be a bit of overkill since you may end up creating objects for every allocation, but certainly doable. I would argue that in most cases you already tend to have a structure for the things you allocate so the "normal" approach is typically more clear and readable than inlining calls with side-effects, but that may be a matter of taste.

Cheers,
Simon


On Nov 23, 2015, at 6:10 PM, Jeroen Ooms <jeroen.ooms at stat.ucla.edu> wrote:

> WRE explains that R_alloc() can be used to allocate memory which
> automatically gets released by R at the end of a .C, .Call or
> .External, even in the case of an error or interruption. This is a
> really great feature to prevent memory leaks. I was wondering if there
> is a way to extend this mechanism to allow for automatically running
> UNPROTECT and custom finalizers at the end of a .Call as well.
> 
> Currently it is all to easy for package authors to introduce a memory
> leak or stack imbalance by calling Rf_error() or
> R_CheckUserInterrupt() in a way that skips over the usual cleanup
> steps. This holds especially for packages interfacing C libraries
> (libcurl, libxml2, openssl, etc) which require xx_new() and xx_free()
> functions to allocate/free various types of objects, handles and
> contexts. Therefore we cannot use R_alloc() and we need to manually
> clean up when returning, which is tricky for irregular exits.
> 
> Moreover package authors might benefit from an alternative of
> allocVector() which automatically protects the SEXP until the .Call is
> done. Perhaps I don't fully appreciate the complexity of the garbage
> collector, but one could imagine a variant of PROTECT() which
> automatically keeps a counter 'n' for the number of allocated objects
> and makes R run UNPROTECT(n) when .Call exists, along with releasing
> the R_alloc() memory. Yes, there are cases where it is useful to have
> manual control over what can be collected earlier during the .Call
> procedure, but these are rare. A lot of C code in packages might
> become safer and cleaner if authors would have an option to let this
> be automated.
> 
> The most general feature would a hook for adding custom C functions to
> the .Call exit, similar to on.exit() in R:
> 
>  xmlNodePtr *node =  xmlNewNode(...);
>  Rf_on_exit(xmlFreeNode, node);
>  EVP_PKEY_CTX *ctx = EVP_PKEY_CTX_new(...);
>  Rf_on_exit(EVP_PKEY_CTX_free, ctx);
>  SEXP out = PROTECT(allocVector(...));
>  Rf_on_exit(UNPROTECT, 1);
> 
> I don't know R's internals well enough to estimate if something like
> this would be possible. I did put together a simple C example of a
> linked list with object pointers and their corresponding free
> functions, which can easily be free'd with a single call:
> http://git.io/vBqRA . So basically what is mostly missing at this
> point is a way to trigger this at the end of the .Call in a way that
> works for regular returns, errors and interruptions...
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From pauljohn32 at gmail.com  Wed Nov 25 17:51:08 2015
From: pauljohn32 at gmail.com (Paul Johnson)
Date: Wed, 25 Nov 2015 10:51:08 -0600
Subject: [Rd] MKL Acceleration encouraging; need adjust package builds?
In-Reply-To: <DM2PR0301MB0848BF2B851C0D51A49629A3C8070@DM2PR0301MB0848.namprd03.prod.outlook.com>
References: <CAErODj87PsLYoihk8Cd+gd_oLLWx1oaxO-0G3rNe4i5j+AV38w@mail.gmail.com>
	<DM2PR0301MB0848BF2B851C0D51A49629A3C8070@DM2PR0301MB0848.namprd03.prod.outlook.com>
Message-ID: <CAErODj8USYxCbN5e2AB7nfFOX3zErQfPwKxHFew2+fcsHDdnsQ@mail.gmail.com>

On Mon, Nov 23, 2015 at 11:39 AM, David Smith <davidsmi at microsoft.com> wrote:
> Hi Paul,
>
> We've been through this process ourselves for the Revolution R Open project. There are a number of pitfalls to avoid, but you can take a look at how we achieved it in the build scripts at:
>
> https://github.com/RevolutionAnalytics/RRO
>
> There are also some very useful notes in the R Installation guide:
> https://cran.r-project.org/doc/manuals/r-release/R-admin.html#BLAS
>
> Most packages do benefit from MKL (or any multi-threaded BLAS) to some degree, although the actual benefit depends on the R functions they call. Some packages (and some built-in R functions) don't call into BLAS endpoints, so you won't see benefits in all cases.
>
> # David Smith
>
Dear David

I'm in the situation mentioned here in the docs, since BLAS is not shared.

"Note that under Unix (but not under Windows) if R is compiled against
a non-default BLAS and --enable-BLAS-shlib is not used, then all
BLAS-using packages must also be. So if R is re-built to use an
enhanced BLAS then packages such as quantreg will need to be
re-installed. "

I am building all of the modules from scratch, so if the default build
is sufficient, then I'll be done. When I asked the other day, I was
worried that packages would find the wrong shared library. As far as I
can tell now, I should not have been so worried.

Today, while browsing the R installation, I find the Makeconf file and
that has all the information a package should need.  I've verified
that the quantreg package detects this information, and we'll just
hope the others do too :)

In case anybody else comes along later and wonders how R can be
configured to make this go, here's the top of our Makeconf from the
installed R, which has the configure line as well as BLAS_LIBS, which,
so far as I can tell, is making all of this go.

Makeconf content

# etc/Makeconf.  Generated from Makeconf.in by configure.
#
# ${R_HOME}/etc/Makeconf
# R was configured using the following call
# (not including env. vars and site configuration)
# configure  '--prefix=/tools/cluster/6.2/R/3.2.2_mkl' '--with-tcltk'
'--enable-R-shlib' '--enable-shared' '--with-pic'
'--disable-BLAS-shlib'
'--with-blas=-L/panfs/pfs.acf.ku.edu/cluster/6.2/intel/2015/mkl/lib/intel64
-Wl,--no-as-needed -lmkl_gf_lp64 -Wl,--start-group -lmkl_gnu_thread
-lmkl_core  -Wl,--end-group -fopenmp  -ldl -lpthread -lm'
'--with-lapack'
'CFLAGS=-I/panfs/pfs.acf.ku.edu/cluster/system/pkg/R/curl7.45_install/include
-L/panfs/pfs.acf.ku.edu/cluster/6.2/R/3.2.2_mkl/lib64'
'JAVA_HOME=/tools/cluster/6.2/java/jdk1.8.0_66'

## This fails if it contains spaces, or if it is quoted
include $(R_SHARE_DIR)/make/vars.mk

AR = ar
## Used by packages 'maps' and 'mapdata'
AWK = gawk
BLAS_LIBS = -L/panfs/pfs.acf.ku.edu/cluster/6.2/intel/2015/mkl/lib/intel64
-Wl,--no-as-needed -lmkl_gf_lp64 -Wl,--start-group -lmkl_gnu_thread
-lmkl_core  -Wl,--end-group -fopenmp  -ldl -lpthread -lm
C_VISIBILITY = -fvisibility=hidden
...



pj

-- 
Paul E. Johnson
Professor, Political Science        Director
1541 Lilac Lane, Room 504      Center for Research Methods
University of Kansas                 University of Kansas
http://pj.freefaculty.org              http://crmda.ku.edu


From mark.vanderloo at gmail.com  Thu Nov 26 10:07:17 2015
From: mark.vanderloo at gmail.com (Mark van der Loo)
Date: Thu, 26 Nov 2015 09:07:17 +0000
Subject: [Rd] Inconsistency in treating NaN-results?
Message-ID: <CAOKDuOgd4PsfS+wDFS56m=9g_8ULBj0dxxMKbUg7iKJP1GQbrA@mail.gmail.com>

This question is more out of curiosity than a complaint or suggestion, but
I'm just wondering.

The behavior of R on calculations that result in NaN seems a bit
inconsistent.

# this is expected:
> 0/0
[1] NaN

# but this gives a warning
> sin(Inf)
[1] NaN
Warning message:
In sin(Inf) : NaNs produced

# and this again does not
> exp(NaN)
[1] NaN


Conceptually, I like to think that R computes over the real line augmented
with NaN, Inf, -Inf, NaN, and NA (which is technically also NaN). As far as
I know, this set is closed under R's arithmetic operations and mathematical
functions (following the IEEE standard on double precision). If that's the
case, the result sin(Inf)=NaN seems normal to me and a warning is
unnecessary.

So why the choice to have warning on sin(Inf), but not on 0/0 or exp(Nan)?
Is it just historical or am I missing a reasoning or some standard?


Best,
Mark

> sessionInfo()
R version 3.2.2 (2015-08-14)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 14.04.3 LTS

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=nl_NL.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=nl_NL.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=nl_NL.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=nl_NL.UTF-8 LC_IDENTIFICATION=C

	[[alternative HTML version deleted]]


From aixtools at gmail.com  Thu Nov 26 14:38:04 2015
From: aixtools at gmail.com (Michael Felt)
Date: Thu, 26 Nov 2015 14:38:04 +0100
Subject: [Rd] compile question
In-Reply-To: <81EBBC68-83B0-4843-8236-B9141EAA8988@gmail.com>
References: <56535263.4010706@gmail.com> <56538588.40006@gmail.com>
	<81EBBC68-83B0-4843-8236-B9141EAA8988@gmail.com>
Message-ID: <56570B3C.7060108@gmail.com>

On 2015-11-23 23:43, peter dalgaard wrote:
>> On 23 Nov 2015, at 22:30 , aixtools<aixtools at gmail.com>  wrote:
>>
>>> ./configure --enable-maintainer-mode ...
> Two things here
>
> - possibly irrelevant, but I'd avoid building in the source directory. (mkdir ../BUILD ; cd ../BUILD; ../R/configure)
>
> - don't turn on mantainer mode. You are not a maintainer, and if you want to play at being one, I think you need extra tools.
>
I think I may need the extra tools. Besides autoconf and automake (plus 
gnu m4) - what other tools are needed?

I am not able to generate a good configure (yet).

root at x072:[/data/prj/cran/R-devel]autoconf
configure.ac:254: error: possibly undefined macro: AM_CONDITIONAL
       If this token and others are legitimate, please use m4_pattern_allow.
       See the Autoconf documentation.
configure.ac:655: error: possibly undefined macro: AC_DISABLE_STATIC
configure.ac:727: error: possibly undefined macro: AC_CHECK_LIBM
configure.ac:1982: error: possibly undefined macro: AM_LANGINFO_CODESET
configure.ac:2639: error: possibly undefined macro: AM_NLS
configure.ac:2643: error: possibly undefined macro: AM_GNU_GETTEXT_VERSION
configure.ac:2644: error: possibly undefined macro: AM_GNU_GETTEXT

What I changed...

root at x072:[/data/prj/cran]diff -u R-devel_2015-11-26/configure.ac 
R-devel/configure.ac
--- R-devel_2015-11-26/configure.ac     2015-10-18 16:02:55.000000000 +0000
+++ R-devel/configure.ac        2015-11-26 13:29:28.000000000 +0000
@@ -1300,12 +1300,14 @@
       ##ADD: A symbol of memcpy,memset is exported in libR by expall.
       ##ADD: However, for example, symbol in libc of memcpy is 
__memmove,__memmove64.
       ##ADD: This black magic puts lc before lR and pockets this.
+     ## MAMF: This black magic is no longer working, it seems - getting 
duplicate symbol errors now.
       if test "x${OBJECT_MODE}" = "x64"; then
-       main_ldflags="${wl}-brtl ${wl}-bexpall ${wl}-bpT:0x100000000 
${wl}-bpD:0x110000000 -lc"
+       main_ldflags="${wl}-brtl ${wl}-bexpall ${wl}-bpT:0x100000000 
${wl}-bpD:0x110000000"
       else
-       main_ldflags="${wl}-brtl ${wl}-bexpall -lc"
+       main_ldflags="${wl}-brtl ${wl}-bexpall"
       fi
-     shlib_ldflags="${wl}-brtl ${wl}-G ${wl}-bexpall ${wl}-bnoentry -lc"
+     ## MAMF: This black magic is clearly not working, removed from 
main_ldflags to be consistent
+     shlib_ldflags="${wl}-brtl ${wl}-G ${wl}-bexpall ${wl}-bnoentry"
       SHLIB_LIBADD="\$(LIBM)"
       shlib_cxxldflags="${shlib_ldflags}"
       if test "${GCC}" = yes; then

This removes most of the Duplicate symbol messages, although there are 
still several coming from -lR being included
during the build of the shared libraries (.so files).

Another group of Duplicate symbols is coming from the -lm flag being too 
early in the command syntax (autoconf library discovery, so more 
difficult to "move", or "remove".

And I expect the logf() failure is from a program that was dynamically 
linked but the symbol was ignored (as unref/unknown) for some reason. 
I'll continue looking for that.

Regards,
Michael

p.s. is libR still exporting a libc defined symbol? Or is this just very 
old text?


From luke-tierney at uiowa.edu  Thu Nov 26 15:27:02 2015
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Thu, 26 Nov 2015 08:27:02 -0600
Subject: [Rd] Custom C finalizers for .Call
In-Reply-To: <6FFEA84B-6DD0-4075-A131-0260E9034308@r-project.org>
References: <CABFfbXtMz3s5MeQ-5=iaJA=5Kr_dhk9RLB82qeXRz1oa4qOpsw@mail.gmail.com>
	<6FFEA84B-6DD0-4075-A131-0260E9034308@r-project.org>
Message-ID: <alpine.OSX.2.02.1511260823550.45459@lukes-macbook-air.local>

We do have a mechanism in the base C code for ensuring that cleanup
code is run on longjmps; we wouldn't want to expose that in the API in
its current form, but could make a wrapper around it available -- I'll
make a note to look into it. But as Simon describes there are good
options available for packages now.

Best,

luke

On Wed, 25 Nov 2015, Simon Urbanek wrote:

> Jeroen,
>
> I agree that it may be useful to have some kind of "finally"-like infrastructure. However, in the use cases you list there are already ways to do that - the same way that R_alloc uses. First, you don't need to call UNPROTECT - the whole point is that the protection stack is automatically popped in case of an abnormal termination. That is precisely how memory leaks are prevented - as long as you play by the rules it will be released for you. The check for UNPROTECTs at the end of .Call is explicitly there so catch bugs in *normal* termination. So no memory leaks there.
>
> The real case where users may create leaks is if you allocate memory that you don't tell R about. As long as you associate a finalizer with any non-R memory you allocate, there will be no memory leaks -that is how you are supposed to write R packages with external allocations. So the only difference to your example is that you don't register a finalizer with the *function* but rather with the *allocation* you make. That also seems IMHO less error prone.
>
> So to take your example, the way would typically write that code safely is something like
>
> typedef struct {
>  xmlNodePtr *node;
> EVP_PKEY_CTX *ctx;
> } my_context_t;
>
> // define how to dispose of all things you care about correctly
> static void context_fin(SEXP what) {
>    my_context_t *c = (my_context_t*) EXTPTR_PTR(what);
>    if (!c) return;
>    if (c->ctx) EVP_PKEY_CTX_free(c->ctx);
>    if (c->node) xmlFreeNode(c->node);
> }
>
> [...]
> // allocate the context and tell R to manage its protection and finalization
> // (you could write a macro to make this one-liner)
> my_context_t* c = (my_context_t*) R_Calloc(1, my_context_t);
> SEXP res = PROTECT(R_MakeExternalPtr(c, R_NilValue, R_NilValue));
> R_RegisterCFinalizer(res, context_fin);
>
> // do all work here ... you safely abort at any point without memory leaks
> c->node =  xmlNewNode(...);
> c->ctx = EVP_PKEY_CTX_new(...);
> [...]
>
> The point of using a finalizer is that no matter what happens the memory is always released. The structure with all allocations is protected until you unprotect it or there is any interrupt/error. Since all regular R rules apply, you can also assign it someplace to make the protection dependent on any other object you care about. This is often useful because you don't need to PROTECT things left and right, but instead you can just have one object that holds references to random things you care about.
>
> Of course, you could write a wrapper for the above with some syntactic sugar to achieve the same - essentially limiting the finalizer to be just a function call on the reference that you create. It may be a bit of overkill since you may end up creating objects for every allocation, but certainly doable. I would argue that in most cases you already tend to have a structure for the things you allocate so the "normal" approach is typically more clear and readable than inlining calls with side-effects, but that may be a matter of taste.
>
> Cheers,
> Simon
>
>
> On Nov 23, 2015, at 6:10 PM, Jeroen Ooms <jeroen.ooms at stat.ucla.edu> wrote:
>
>> WRE explains that R_alloc() can be used to allocate memory which
>> automatically gets released by R at the end of a .C, .Call or
>> .External, even in the case of an error or interruption. This is a
>> really great feature to prevent memory leaks. I was wondering if there
>> is a way to extend this mechanism to allow for automatically running
>> UNPROTECT and custom finalizers at the end of a .Call as well.
>>
>> Currently it is all to easy for package authors to introduce a memory
>> leak or stack imbalance by calling Rf_error() or
>> R_CheckUserInterrupt() in a way that skips over the usual cleanup
>> steps. This holds especially for packages interfacing C libraries
>> (libcurl, libxml2, openssl, etc) which require xx_new() and xx_free()
>> functions to allocate/free various types of objects, handles and
>> contexts. Therefore we cannot use R_alloc() and we need to manually
>> clean up when returning, which is tricky for irregular exits.
>>
>> Moreover package authors might benefit from an alternative of
>> allocVector() which automatically protects the SEXP until the .Call is
>> done. Perhaps I don't fully appreciate the complexity of the garbage
>> collector, but one could imagine a variant of PROTECT() which
>> automatically keeps a counter 'n' for the number of allocated objects
>> and makes R run UNPROTECT(n) when .Call exists, along with releasing
>> the R_alloc() memory. Yes, there are cases where it is useful to have
>> manual control over what can be collected earlier during the .Call
>> procedure, but these are rare. A lot of C code in packages might
>> become safer and cleaner if authors would have an option to let this
>> be automated.
>>
>> The most general feature would a hook for adding custom C functions to
>> the .Call exit, similar to on.exit() in R:
>>
>>  xmlNodePtr *node =  xmlNewNode(...);
>>  Rf_on_exit(xmlFreeNode, node);
>>  EVP_PKEY_CTX *ctx = EVP_PKEY_CTX_new(...);
>>  Rf_on_exit(EVP_PKEY_CTX_free, ctx);
>>  SEXP out = PROTECT(allocVector(...));
>>  Rf_on_exit(UNPROTECT, 1);
>>
>> I don't know R's internals well enough to estimate if something like
>> this would be possible. I did put together a simple C example of a
>> linked list with object pointers and their corresponding free
>> functions, which can easily be free'd with a single call:
>> http://git.io/vBqRA . So basically what is mostly missing at this
>> point is a way to trigger this at the end of the .Call in a way that
>> works for regular returns, errors and interruptions...
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From pdalgd at gmail.com  Thu Nov 26 17:15:13 2015
From: pdalgd at gmail.com (peter dalgaard)
Date: Thu, 26 Nov 2015 17:15:13 +0100
Subject: [Rd] compile question
In-Reply-To: <56570B3C.7060108@gmail.com>
References: <56535263.4010706@gmail.com> <56538588.40006@gmail.com>
	<81EBBC68-83B0-4843-8236-B9141EAA8988@gmail.com>
	<56570B3C.7060108@gmail.com>
Message-ID: <C2C8DD43-95A4-4207-B124-088C1431C4AF@gmail.com>

If you do want to play with maintainer-mode, first check out

https://developer.r-project.org/R-build-prerelease

it is what is done in the nightly builds on OSX. (Actually Mavericks. The comment is old.)

-pd

On 26 Nov 2015, at 14:38 , Michael Felt <aixtools at gmail.com> wrote:

> On 2015-11-23 23:43, peter dalgaard wrote:
>>> On 23 Nov 2015, at 22:30 , aixtools<aixtools at gmail.com>  wrote:
>>> 
>>>> ./configure --enable-maintainer-mode ...
>> Two things here
>> 
>> - possibly irrelevant, but I'd avoid building in the source directory. (mkdir ../BUILD ; cd ../BUILD; ../R/configure)
>> 
>> - don't turn on mantainer mode. You are not a maintainer, and if you want to play at being one, I think you need extra tools.
>> 
> I think I may need the extra tools. Besides autoconf and automake (plus gnu m4) - what other tools are needed?
> 
> I am not able to generate a good configure (yet).
> 
> root at x072:[/data/prj/cran/R-devel]autoconf
> configure.ac:254: error: possibly undefined macro: AM_CONDITIONAL
>      If this token and others are legitimate, please use m4_pattern_allow.
>      See the Autoconf documentation.
> configure.ac:655: error: possibly undefined macro: AC_DISABLE_STATIC
> configure.ac:727: error: possibly undefined macro: AC_CHECK_LIBM
> configure.ac:1982: error: possibly undefined macro: AM_LANGINFO_CODESET
> configure.ac:2639: error: possibly undefined macro: AM_NLS
> configure.ac:2643: error: possibly undefined macro: AM_GNU_GETTEXT_VERSION
> configure.ac:2644: error: possibly undefined macro: AM_GNU_GETTEXT
> 
> What I changed...
> 
> root at x072:[/data/prj/cran]diff -u R-devel_2015-11-26/configure.ac R-devel/configure.ac
> --- R-devel_2015-11-26/configure.ac     2015-10-18 16:02:55.000000000 +0000
> +++ R-devel/configure.ac        2015-11-26 13:29:28.000000000 +0000
> @@ -1300,12 +1300,14 @@
>      ##ADD: A symbol of memcpy,memset is exported in libR by expall.
>      ##ADD: However, for example, symbol in libc of memcpy is __memmove,__memmove64.
>      ##ADD: This black magic puts lc before lR and pockets this.
> +     ## MAMF: This black magic is no longer working, it seems - getting duplicate symbol errors now.
>      if test "x${OBJECT_MODE}" = "x64"; then
> -       main_ldflags="${wl}-brtl ${wl}-bexpall ${wl}-bpT:0x100000000 ${wl}-bpD:0x110000000 -lc"
> +       main_ldflags="${wl}-brtl ${wl}-bexpall ${wl}-bpT:0x100000000 ${wl}-bpD:0x110000000"
>      else
> -       main_ldflags="${wl}-brtl ${wl}-bexpall -lc"
> +       main_ldflags="${wl}-brtl ${wl}-bexpall"
>      fi
> -     shlib_ldflags="${wl}-brtl ${wl}-G ${wl}-bexpall ${wl}-bnoentry -lc"
> +     ## MAMF: This black magic is clearly not working, removed from main_ldflags to be consistent
> +     shlib_ldflags="${wl}-brtl ${wl}-G ${wl}-bexpall ${wl}-bnoentry"
>      SHLIB_LIBADD="\$(LIBM)"
>      shlib_cxxldflags="${shlib_ldflags}"
>      if test "${GCC}" = yes; then
> 
> This removes most of the Duplicate symbol messages, although there are still several coming from -lR being included
> during the build of the shared libraries (.so files).
> 
> Another group of Duplicate symbols is coming from the -lm flag being too early in the command syntax (autoconf library discovery, so more difficult to "move", or "remove".
> 
> And I expect the logf() failure is from a program that was dynamically linked but the symbol was ignored (as unref/unknown) for some reason. I'll continue looking for that.
> 
> Regards,
> Michael
> 
> p.s. is libR still exporting a libc defined symbol? Or is this just very old text?
> 

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Office: A 4.23
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From aixtools at gmail.com  Fri Nov 27 16:26:02 2015
From: aixtools at gmail.com (Michael Felt)
Date: Fri, 27 Nov 2015 16:26:02 +0100
Subject: [Rd] compile question
In-Reply-To: <C2C8DD43-95A4-4207-B124-088C1431C4AF@gmail.com>
References: <56535263.4010706@gmail.com> <56538588.40006@gmail.com>
	<81EBBC68-83B0-4843-8236-B9141EAA8988@gmail.com>
	<56570B3C.7060108@gmail.com>
	<C2C8DD43-95A4-4207-B124-088C1431C4AF@gmail.com>
Message-ID: <5658760A.5000609@gmail.com>

On 2015-11-26 17:15, peter dalgaard wrote:
> If you do want to play with maintainer-mode, first check out
>
> https://developer.r-project.org/R-build-prerelease
>
> it is what is done in the nightly builds on OSX. (Actually Mavericks. The comment is old.)
>
> -pd
>
Very helpful.
I only ran the "sync", aclocal and autoconf commands - so what else 
(extra) does 'maintainer-mode' do? On AIX I could think of adding 
-Wl,-b:map=${object}.map (one of my new tricks for finding which library 
is going to be used).

Other comments/questions:

a) the small change in configure.ac got rid of a lot of error/rather 
warning messages from the binder (ld: 0711-224 WARNING: Duplicate 
symbol:.myFavSymbol)
b) lost of ld warnings are going to be more difficult to resolve - as 
they are being generated by the autoconf processing of gfortran -v - and 
the placement of XXX_LIBADD flags (basically, in the way now - still 
looking at where they get placed - are there "switches" for Makefile.in 
processing?
c) looking backward and forward - a hint on where to look is 
appreciated. In one of the m4 files /usr/local/include is defined as the 
default include directory. However, it does not actually use 
${prefix}/include which is what I would want. the looking backward part 
- a month ago when I was working with R to get it ready for a project 
(and then 32-bit was too small a memory model) - while compiling and 
installing additional packages I was forced to use /usr/local/lib and 
/usr/local/include. Would like to get away from that, if possible.
d) the biggest bother of all ;-| - a bug in AIX, and an undefined symbol 
in /usr/lib/libm.a - You can look for a LONG time, and never get further 
when an error like that sneaks in with an update!


From pdalgd at gmail.com  Fri Nov 27 17:25:14 2015
From: pdalgd at gmail.com (peter dalgaard)
Date: Fri, 27 Nov 2015 17:25:14 +0100
Subject: [Rd] compile question
In-Reply-To: <5658760A.5000609@gmail.com>
References: <56535263.4010706@gmail.com> <56538588.40006@gmail.com>
	<81EBBC68-83B0-4843-8236-B9141EAA8988@gmail.com>
	<56570B3C.7060108@gmail.com>
	<C2C8DD43-95A4-4207-B124-088C1431C4AF@gmail.com>
	<5658760A.5000609@gmail.com>
Message-ID: <1F0262C8-F669-4AE3-9F39-14AD8880C1C8@gmail.com>


On 27 Nov 2015, at 16:26 , Michael Felt <aixtools at gmail.com> wrote:

> On 2015-11-26 17:15, peter dalgaard wrote:
>> If you do want to play with maintainer-mode, first check out
>> 
>> https://developer.r-project.org/R-build-prerelease
>> 
>> it is what is done in the nightly builds on OSX. (Actually Mavericks. The comment is old.)
>> 
>> -pd
>> 
> Very helpful.
> I only ran the "sync", aclocal and autoconf commands - so what else (extra) does 'maintainer-mode' do? On AIX I could think of adding -Wl,-b:map=${object}.map (one of my new tricks for finding which library is going to be used).


The easiest way to find out is to look through the Makefile.in-s for lines with @MAINTAINER_MODE_TRUE at . E.g. in  src/include/Makefile.in 

$(srcdir)/config.h.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/stamp-h.in
$(srcdir)/stamp-h.in: @MAINTAINER_MODE_TRUE@ $(top_srcdir)/configure.ac $(top_builddir)/aclocal.m4
        @TBD=`cd $(top_builddir); pwd`; \
          cd $(top_srcdir) && $(AUTOHEADER) -I $${TBD}
        @$(ECHO) timestamp > $@ 2> /dev/null

(which I think is what bit you via a missing "autoheader" command). It usually boils down to disabling certain dependencies.)

Notice that in maintainer-mode, the build _will_ (sometimes) modify files under $(top_srcdir), even if building in a separate directory. That is otherwise a big no-no, which is essentially why it is reserved for maintainers. (And the nightly builds try to ensure that not all even maintainers will be modifying certain source files. The tools for making them are somewhat flaky, and we don't all have the appropriate versions.)  


> 
> Other comments/questions:
> 
> a) the small change in configure.ac got rid of a lot of error/rather warning messages from the binder (ld: 0711-224 WARNING: Duplicate symbol:.myFavSymbol)
> b) lost of ld warnings are going to be more difficult to resolve - as they are being generated by the autoconf processing of gfortran -v - and the placement of XXX_LIBADD flags (basically, in the way now - still looking at where they get placed - are there "switches" for Makefile.in processing?
> c) looking backward and forward - a hint on where to look is appreciated. In one of the m4 files /usr/local/include is defined as the default include directory. However, it does not actually use ${prefix}/include which is what I would want. the looking backward part - a month ago when I was working with R to get it ready for a project (and then 32-bit was too small a memory model) - while compiling and installing additional packages I was forced to use /usr/local/lib and /usr/local/include. Would like to get away from that, if possible.
> d) the biggest bother of all ;-| - a bug in AIX, and an undefined symbol in /usr/lib/libm.a - You can look for a LONG time, and never get further when an error like that sneaks in with an update!

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Office: A 4.23
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From aixtools at gmail.com  Fri Nov 27 17:47:12 2015
From: aixtools at gmail.com (Michael Felt)
Date: Fri, 27 Nov 2015 17:47:12 +0100
Subject: [Rd] compile question
In-Reply-To: <1F0262C8-F669-4AE3-9F39-14AD8880C1C8@gmail.com>
References: <56535263.4010706@gmail.com> <56538588.40006@gmail.com>
	<81EBBC68-83B0-4843-8236-B9141EAA8988@gmail.com>
	<56570B3C.7060108@gmail.com>
	<C2C8DD43-95A4-4207-B124-088C1431C4AF@gmail.com>
	<5658760A.5000609@gmail.com>
	<1F0262C8-F669-4AE3-9F39-14AD8880C1C8@gmail.com>
Message-ID: <56588910.2050308@gmail.com>

On 2015-11-27 17:25, peter dalgaard wrote:
> The easiest way to find out is to look through the Makefile.in-s for lines with @MAINTAINER_MODE_TRUE at . E.g. in  src/include/Makefile.in
>
> $(srcdir)/config.h.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/stamp-h.in
> $(srcdir)/stamp-h.in: @MAINTAINER_MODE_TRUE@ $(top_srcdir)/configure.ac $(top_builddir)/aclocal.m4
>          @TBD=`cd $(top_builddir); pwd`; \
>            cd $(top_srcdir)&&  $(AUTOHEADER) -I $${TBD}
>          @$(ECHO) timestamp>  $@ 2>  /dev/null
>
> (which I think is what bit you via a missing "autoheader" command). It usually boils down to disabling certain dependencies.)
>
> Notice that in maintainer-mode, the build_will_  (sometimes) modify files under $(top_srcdir), even if building in a separate directory. That is otherwise a big no-no, which is essentially why it is reserved for maintainers. (And the nightly builds try to ensure that not all even maintainers will be modifying certain source files. The tools for making them are somewhat flaky, and we don't all have the appropriate versions.)
For now, I shall just be a humble-packager.
When I have something I would like to suggest as a change, specific for 
AIX, to configure.ac how can I submit that.

I shall hold back on changes to various Makefile.in (still need to learn 
how automake could help with platform specific things. I see comments of 
platform specific things (e.g., for Solaris), but not how they get 
activated/used.

Regards,
Michael


From mikko.korpela at aalto.fi  Sat Nov 28 13:50:05 2015
From: mikko.korpela at aalto.fi (Mikko Korpela)
Date: Sat, 28 Nov 2015 14:50:05 +0200
Subject: [Rd] [patch] Use JIT for PCRE pattern matching
Message-ID: <5659A2FD.6090904@aalto.fi>

According to ?pcre_config, just-in-time compilation support in the
PCRE library <http://pcre.org/> is "desirable for speed". However, it
seems that the pattern matching functions defined in src/main/grep.c
make no effort to utilize the possible JIT support. Therefore it
appears that currently R does not benefit from JIT support in PCRE.

The attached patch is an attempt to enable JIT in functions using the
PCRE library. It was written by following instructions on the
"pcrejit" man page
<http://pcre.org/original/doc/html/pcrejit.html#SEC4>. The patch also
fixes what I think is an issue of wrong nesting which seems to have
prevented pcre_study() from ever running in grep(l).

I tested the patch with the following code. It defines a vector of 11
strings which is just enough to trigger the use of pcre_study() which
now also runs the JIT compiler. It includes a very long string to
highlight another issue: deep recursion and possible segmentation
faults from PCRE (pcre_exec).

# Initialization code
pattern <- "([^[:alpha:]]|a|b)+"
long_string <- paste0(rep("a", 1023), collapse="")
longer_string <- paste0(rep("a", 1024), collapse="")
longest_string <- paste0(rep("a", 1e7), collapse="")
strings <- c(longest_string, longer_string, long_string, rep("a", 8))
# Calls to functions using PCRE
grepl(pattern, strings, perl = TRUE)
# [1] FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
# (output with R-devel r69712 using the attached patch,
#  PCRE 8.38 with JIT enabled, Ubuntu 14.04 64-bit on x86_64)
grep(pattern, strings, perl = TRUE)
# [1]  3  4  5  6  7  8  9 10 11
# (the same comments as above)
foo <- strsplit(strings, pattern, perl = TRUE)
foo <- sub(pattern, "", strings, perl = TRUE)
foo <- gsub(pattern, "", strings, perl = TRUE)
foo <- regexpr(pattern, strings, perl = TRUE)
foo <- gregexpr(pattern, strings, perl = TRUE)

With the patch applied, the code above runs OK, although the example
pattern runs into some capacity limitations of PCRE when the input is
long.

Without the patch, every command above using PCRE (perl = TRUE) will
result in a segmentation fault. In this case, R must be restarted
between segmentation faults although the R prompt reappears after the
segfault. However, the first segmentation fault seems to kill R on
Windows (Windows 10, R 3.2.2). In my tests on Linux and Mac OS X, less 
than 10000 characters of input is enough for a segfault, but about 62000 
were needed on Windows.

Even with the patch, segmentation faults will occur if the character
vector used as input has less than 11 elements.

The cause of the segmentation fault, namely deep recursion and running
out of stack memory, is explained on the "pcrestack" man page
<http://pcre.org/original/doc/html/pcrestack.html>. Apparently this is
considered to be a feature, not a bug. It would be nice if R could
provide some protection against this, but it seems to be a non-trivial
task. Compiling the PCRE library with --disable-stack-for-recursion is
one solution.

-- 
Mikko Korpela
Aalto University School of Science
Department of Computer Science
-------------- next part --------------
Index: src/main/grep.c
===================================================================
--- src/main/grep.c	(revision 69712)
+++ src/main/grep.c	(working copy)
@@ -52,6 +52,10 @@
 # include <config.h>
 #endif
 
+/* Compatibility with PCRE < 8.20 */
+#ifndef PCRE_STUDY_JIT_COMPILE
+# define PCRE_STUDY_JIT_COMPILE 0
+#endif
 
 /* interval at which to check interrupts */
 #define NINTERRUPT 1000000
@@ -405,7 +409,7 @@
 			    errorptr, split+erroffset);
 		error(_("invalid split pattern '%s'"), split);
 	    }
-	    re_pe = pcre_study(re_pcre, 0, &errorptr);
+	    re_pe = pcre_study(re_pcre, PCRE_STUDY_JIT_COMPILE, &errorptr);
 	    if (errorptr)
 		warning(_("PCRE pattern study error\n\t'%s'\n"), errorptr);
 
@@ -482,7 +486,11 @@
 		}
 		vmaxset(vmax2);
 	    }
+#ifdef PCRE_CONFIG_JIT
+	    pcre_free_study(re_pe);
+#else
 	    pcre_free(re_pe);
+#endif
 	    pcre_free(re_pcre);
 	} else if (!useBytes && use_UTF8) { /* ERE in wchar_t */
 	    regex_t reg;
@@ -867,12 +875,12 @@
 		warning(_("PCRE pattern compilation error\n\t'%s'\n\tat '%s'\n"),
 			errorptr, spat+erroffset);
 	    error(_("invalid regular expression '%s'"), spat);
-	    if (n > 10) {
-		re_pe = pcre_study(re_pcre, 0, &errorptr);
-		if (errorptr)
-		    warning(_("PCRE pattern study error\n\t'%s'\n"), errorptr);
-	    }
 	}
+	if (n > 10) {
+	    re_pe = pcre_study(re_pcre, PCRE_STUDY_JIT_COMPILE, &errorptr);
+	    if (errorptr)
+		warning(_("PCRE pattern study error\n\t'%s'\n"), errorptr);
+	}
     } else {
 	int cflags = REG_NOSUB | REG_EXTENDED;
 	if (igcase_opt) cflags |= REG_ICASE;
@@ -929,7 +937,11 @@
 
     if (fixed_opt);
     else if (perl_opt) {
+#ifdef PCRE_CONFIG_JIT
+	if (re_pe) pcre_free_study(re_pe);
+#else
 	if (re_pe) pcre_free(re_pe);
+#endif
 	pcre_free(re_pcre);
 	pcre_free((void *)tables);
     } else
@@ -1623,7 +1635,7 @@
 	    error(_("invalid regular expression '%s'"), spat);
 	}
 	if (n > 10) {
-	    re_pe = pcre_study(re_pcre, 0, &errorptr);
+	    re_pe = pcre_study(re_pcre, PCRE_STUDY_JIT_COMPILE, &errorptr);
 	    if (errorptr)
 		warning(_("PCRE pattern study error\n\t'%s'\n"), errorptr);
 	}
@@ -1910,7 +1922,11 @@
 
     if (fixed_opt) ;
     else if (perl_opt) {
+#ifdef PCRE_CONFIG_JIT
+	if (re_pe) pcre_free_study(re_pe);
+#else
 	if (re_pe) pcre_free(re_pe);
+#endif
 	pcre_free(re_pcre);
 	pcre_free((void *)tables);
     } else tre_regfree(&reg);
@@ -2421,7 +2437,7 @@
 	    error(_("invalid regular expression '%s'"), spat);
 	}
 	if (n > 10) {
-	    re_pe = pcre_study(re_pcre, 0, &errorptr);
+	    re_pe = pcre_study(re_pcre, PCRE_STUDY_JIT_COMPILE, &errorptr);
 	    if (errorptr)
 		warning(_("PCRE pattern study error\n\t'%s'\n"), errorptr);
 	}
@@ -2599,7 +2615,11 @@
 
     if (fixed_opt) ;
     else if (perl_opt) {
+#ifdef PCRE_CONFIG_JIT
+	if (re_pe) pcre_free_study(re_pe);
+#else
 	if (re_pe) pcre_free(re_pe);
+#endif
 	pcre_free(re_pcre);
 	pcre_free((void *)tables);
 	UNPROTECT(1);

From paul at stat.auckland.ac.nz  Sun Nov 29 20:54:23 2015
From: paul at stat.auckland.ac.nz (Paul Murrell)
Date: Mon, 30 Nov 2015 08:54:23 +1300
Subject: [Rd] R-devel no longer supports Ubuntu 14.04 LTS (insufficient
 PCRE version)
In-Reply-To: <22099.57406.667438.668290@max.nulle.part>
References: <564F38BD.4090000@ifspm.uzh.ch> <564F9306.30707@stats.ox.ac.uk>
	<56526179.6090705@stat.auckland.ac.nz>
	<22099.57406.667438.668290@max.nulle.part>
Message-ID: <565B57EE.9050803@stat.auckland.ac.nz>

Hi

For the record, Dirk (after a couple of false starts and admirable 
persistance!) has got this to work for me.

So on Ubuntu 14.04, adding Dirk's PPA, followed by apt-get update pulls 
down a backport for libpcre3.

Thanks Dirk!

Paul

On 24/11/2015 4:57 p.m., Dirk Eddelbuettel wrote:
>
> Sebastian, Paul,
>
> Ubuntu 14.04 builds (for Linux 32 and 64 bit, ie i386 and amd64) of the (most
> current) pcre package (ie 8.35-7) for Ubuntu are now in my PPA at
>
>     https://launchpad.net/~edd/+archive/ubuntu/misc/+packages
>
> These should work.  You can add this PPA as I do in some Travis runs via
>
>     sudo add-apt-repository -y ppa:edd/misc
>
> and then just do
>
>     apt-get update; apt-get install libpcre3-dev
>
> which should do the trick -- but I haven't tested.  Contact me off-list if
> you fail.
>
> Oh, and I guess we should have had this whole thread over on r-sig-debian.
>
> Best,  Dirk
>

-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From edd at debian.org  Sun Nov 29 21:18:49 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sun, 29 Nov 2015 14:18:49 -0600
Subject: [Rd] R-devel no longer supports Ubuntu 14.04 LTS (insufficient
 PCRE version)
In-Reply-To: <565B57EE.9050803@stat.auckland.ac.nz>
References: <564F38BD.4090000@ifspm.uzh.ch> <564F9306.30707@stats.ox.ac.uk>
	<56526179.6090705@stat.auckland.ac.nz>
	<22099.57406.667438.668290@max.nulle.part>
	<565B57EE.9050803@stat.auckland.ac.nz>
Message-ID: <22107.23977.285617.259573@max.nulle.part>


On 30 November 2015 at 08:54, Paul Murrell wrote:
| For the record, Dirk (after a couple of false starts and admirable 
| persistance!) has got this to work for me.

[ This was entirely due to
  a) Debian transitioning to g++-5 support and relabeling all (rebuilt) C++ 
     libraries with a suffix 'v5' and
  b) this affecting pcre as well and
  c) me being slopping at first not noticing in the core library package and
  d) moreover me not noticing two subordinate pcre packages from the same
     build
  all which lead to the package manager not wanting to upgrade -- which was
  entirely correct.  We got that sorted out.

  "Usually" such transitions are much simpler; pcre happens to create a bunch
  of subpackages. ]

| So on Ubuntu 14.04, adding Dirk's PPA, followed by apt-get update pulls 
| down a backport for libpcre3.

[ Said PPA is at

    https://launchpad.net/~edd/+archive/ubuntu/misc

  and you can install it via
  
    apt-get install python-software-properties 
    add-apt-repository -y "ppa:edd/misc"
    apt-get update
    apt-get install libpcre3-dev    

  which should do it. ]

| Thanks Dirk!

My pleasure!

Dirk
 
| Paul
| 
| On 24/11/2015 4:57 p.m., Dirk Eddelbuettel wrote:
| >
| > Sebastian, Paul,
| >
| > Ubuntu 14.04 builds (for Linux 32 and 64 bit, ie i386 and amd64) of the (most
| > current) pcre package (ie 8.35-7) for Ubuntu are now in my PPA at
| >
| >     https://launchpad.net/~edd/+archive/ubuntu/misc/+packages
| >
| > These should work.  You can add this PPA as I do in some Travis runs via
| >
| >     sudo add-apt-repository -y ppa:edd/misc
| >
| > and then just do
| >
| >     apt-get update; apt-get install libpcre3-dev
| >
| > which should do the trick -- but I haven't tested.  Contact me off-list if
| > you fail.
| >
| > Oh, and I guess we should have had this whole thread over on r-sig-debian.
| >
| > Best,  Dirk
| >
| 
| -- 
| Dr Paul Murrell
| Department of Statistics
| The University of Auckland
| Private Bag 92019
| Auckland
| New Zealand
| 64 9 3737599 x85392
| paul at stat.auckland.ac.nz
| http://www.stat.auckland.ac.nz/~paul/

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From 538280 at gmail.com  Mon Nov 30 23:38:37 2015
From: 538280 at gmail.com (Greg Snow)
Date: Mon, 30 Nov 2015 15:38:37 -0700
Subject: [Rd] Inconsistency in treating NaN-results?
In-Reply-To: <CAOKDuOgd4PsfS+wDFS56m=9g_8ULBj0dxxMKbUg7iKJP1GQbrA@mail.gmail.com>
References: <CAOKDuOgd4PsfS+wDFS56m=9g_8ULBj0dxxMKbUg7iKJP1GQbrA@mail.gmail.com>
Message-ID: <CAFEqCdzQP1cY1xQtK-ko_Eo_Brji4mET7ZDSL+A7+etK5aCnsQ@mail.gmail.com>

R and the S language that it is based on has evolved as much as it has
been designed, so there are often inconsistencies due similar
functionality evolving from different paths.  In some cases these
inconsistencies are resolved, but generally only once someone notices
and care enough to do something about it.  In some other cases the
inconsistencies are left for historical reasons and for back
compatibility (for example some functions use the na.rm option and
other use the na.action option for how to deal with missing values).

That said, your report inconsistencies in some function calls, but
your calls are not completely consistent.  Consider:

> sin(NaN)
[1] NaN

See, no warning, just like your other cases.  Also consider the
difference between log(-1) and log(NaN).  It looks like the warning
comes mainly when going from one type of exception (Inf) to another
(NaN), but not when propagating an NaN.

The 'sin' function (and others) do not know whether the argument was
typed in as Inf, or if it is the result of another function returning
Inf (well technically it could be made to figure out some common
cases, but I for one don't see it worth the effort).  So you could
have typed something like 'sin(myfun(x))' and sin looks like it
assumes that if myfun would have warned about creating an NaN value,
so a second warning is not needed, but myfun may legitimately return
Inf, so sin feels it helpful to warn in that case.  And warnings can
always be turned off and/or ignored.

The only real exception that you show is 0/0 is does not start with
NaN, but produces NaN.  But infix operator functions tend to behave a
bit differently.

On Thu, Nov 26, 2015 at 2:07 AM, Mark van der Loo
<mark.vanderloo at gmail.com> wrote:
> This question is more out of curiosity than a complaint or suggestion, but
> I'm just wondering.
>
> The behavior of R on calculations that result in NaN seems a bit
> inconsistent.
>
> # this is expected:
>> 0/0
> [1] NaN
>
> # but this gives a warning
>> sin(Inf)
> [1] NaN
> Warning message:
> In sin(Inf) : NaNs produced
>
> # and this again does not
>> exp(NaN)
> [1] NaN
>
>
> Conceptually, I like to think that R computes over the real line augmented
> with NaN, Inf, -Inf, NaN, and NA (which is technically also NaN). As far as
> I know, this set is closed under R's arithmetic operations and mathematical
> functions (following the IEEE standard on double precision). If that's the
> case, the result sin(Inf)=NaN seems normal to me and a warning is
> unnecessary.
>
> So why the choice to have warning on sin(Inf), but not on 0/0 or exp(Nan)?
> Is it just historical or am I missing a reasoning or some standard?
>
>
> Best,
> Mark
>
>> sessionInfo()
> R version 3.2.2 (2015-08-14)
> Platform: x86_64-pc-linux-gnu (64-bit)
> Running under: Ubuntu 14.04.3 LTS
>
> locale:
>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>  [3] LC_TIME=nl_NL.UTF-8        LC_COLLATE=en_US.UTF-8
>  [5] LC_MONETARY=nl_NL.UTF-8    LC_MESSAGES=en_US.UTF-8
>  [7] LC_PAPER=nl_NL.UTF-8       LC_NAME=C
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=nl_NL.UTF-8 LC_IDENTIFICATION=C
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 
Gregory (Greg) L. Snow Ph.D.
538280 at gmail.com


