From jrm at ftfl.ca  Tue Aug  1 00:38:52 2017
From: jrm at ftfl.ca (Joseph Mingrone)
Date: Mon, 31 Jul 2017 19:38:52 -0300
Subject: [Rd] reproducible segmentation fault installing packages on FreeBSD
	11.1
Message-ID: <86bmo044g3.fsf@phe.ftfl.ca>

Hi,

This happens when attempting to install any package. There were no such
problems on 11.0.

Some other ways to trigger the problem:

curlGetHeaders("http://bugs.r-project.org")
There are no problems with the first two calls, but then the crash
always happens on the third call.

tf <- tempfile()
download.file("http://cran.r-project.org/",tf,method="libcurl")
This one is ok for the first five calls, but always crashes on the
sixth call.

download.file("http://cran.r-project.org/",tf,method="internal")
does not trigger the issue.

Is there any further information I can provide or anything else I can
test?

Joseph

jrm at phe ~ % R --debugger=gdb
GNU gdb (GDB) 8.0 [GDB v8.0 for FreeBSD]
Copyright (C) 2017 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-portbld-freebsd11.0".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
<http://www.gnu.org/software/gdb/documentation/>.
For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from /usr/local/lib/R/bin/exec/R...(no debugging symbols found)...done.
(gdb) r
Starting program: /usr/local/lib/R/bin/exec/R

R version 3.4.1 (2017-06-30) -- "Single Candle"
Copyright (C) 2017 The R Foundation for Statistical Computing
Platform: amd64-portbld-freebsd11.1 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> install.packages("ggplot2")
Installing package into ?/usr/home/jrm/.R/amd64-portbld-freebsd11.1-library/3.4?
(as ?lib? is unspecified)
--- Please select a CRAN mirror for use in this session ---
[New LWP 100239 of process 56011]
[LWP 100239 of process 56011 exited]

--- snip ---

Selection: 1
[New LWP 100265 of process 56011]
[LWP 100265 of process 56011 exited]
also installing the dependencies ?stringi?, ?magrittr?, ?colorspace?, ?Rcpp?, ?stringr?, ?RColorBrewer?, ?dichromat?, ?munsell?, ?labeling?, ?rlang?, ?digest?, ?gtable?, ?plyr?, ?reshape2?, ?scales?, ?tibble?, ?lazyeval?

trying URL 'https://cloud.r-project.org/src/contrib/stringi_1.1.5.tar.gz'
[New LWP 100267 of process 56011]
[LWP 100267 of process 56011 exited]
Content type 'application/x-gzip' length 3645872 bytes (3.5 MB)
==================================================
downloaded 3.5 MB

trying URL 'https://cloud.r-project.org/src/contrib/magrittr_1.5.tar.gz'
[New LWP 100844 of process 56011]
[LWP 100844 of process 56011 exited]
Content type 'application/x-gzip' length 200504 bytes (195 KB)
==================================================
downloaded 195 KB

trying URL 'https://cloud.r-project.org/src/contrib/colorspace_1.3-2.tar.gz'
[New LWP 100161 of process 56011]
[LWP 100161 of process 56011 exited]
Content type 'application/x-gzip' length 293433 bytes (286 KB)
==================================================
downloaded 286 KB

trying URL 'https://cloud.r-project.org/src/contrib/Rcpp_0.12.12.tar.gz'
[New LWP 100854 of process 56011]

Thread 7 received signal SIGSEGV, Segmentation fault.
[Switching to LWP 100854 of process 56011]
uw_frame_state_for (context=context at entry=0x7fffdfffde20, fs=fs at entry=0x7fffdfffdb70)
    at /usr/ports/lang/gcc5/work/gcc-5.4.0/libgcc/unwind-dw2.c:1249
1249          return MD_FALLBACK_FRAME_STATE_FOR (context, fs);

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 962 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20170731/e5a14214/attachment.sig>

From wdunlap at tibco.com  Tue Aug  1 01:28:43 2017
From: wdunlap at tibco.com (William Dunlap)
Date: Mon, 31 Jul 2017 16:28:43 -0700
Subject: [Rd] force promises inside lapply
In-Reply-To: <374bc000-0a16-e681-516f-4624cdd92f35@gmail.com>
References: <a08cf018-5c19-fe67-9ee8-6d0e403b9cfa@gmail.com>
 <CAF8bMcZOh4W-imEt8tnFpH0zzEEx5PjCVKJO-yhF5X+Tvj_j3w@mail.gmail.com>
 <aa9ac3c1-e8ac-5978-dcd2-693276c3afdc@gmail.com>
 <CAF8bMcaKVnNtrjsb6vFk3+_m=+BuzUk0gPk6CDbANHHiJrWkQQ@mail.gmail.com>
 <374bc000-0a16-e681-516f-4624cdd92f35@gmail.com>
Message-ID: <CAF8bMcbUL4fCPP_57gffuO+XxYag6FwtHmAAzX9fOprdfPX+cA@mail.gmail.com>

quote(expr) will make no changes in expr, it just returns its one argument,
unevaluated.
substitute could be used in your lapply(..., library) example to give
library a name instead
of a character string for an input (which might be necessary if the
character.only argument
were not available)
    lapply(c("MASS", "splines"), function(pkg)
eval(substitute(library(pkg), list(pkg=as.name(pkg)))))
bquote() could be used as well
    lapply(c("MASS", "splines"), function(pkg) eval(bquote(library(.(pkg)),
list(pkg=as.name(pkg)))))
But avoiding such things is much easier.


Bill Dunlap
TIBCO Software
wdunlap tibco.com

On Mon, Jul 31, 2017 at 2:41 PM, Benjamin Tyner <btyner at gmail.com> wrote:

> Thanks again Bill; I agree that substitute is overkill here.
>
> As an aside, for cases where someone may be tempted to use substitute(),
> it seems quote() might be a safer alternative; compare
>
>    > lapply(list(1), function(y) c(quote(y), substitute(y)))
>    [[1]]
>    [[1]][[1]]
>    y
>
>    [[1]][[2]]
>    X[[i]]
>
> versus in R < 3.2,
>
>    > lapply(list(1), function(y) c(quote(y), substitute(y)))
>    [[1]]
>    [[1]][[1]]
>    y
>
>    [[1]][[2]]
>    X[[1L]]
>
> in any case, the lesson seems to be that quote and substitute are not
> interchangeable, even though for example
>
>    > (function() identical(quote({a}), substitute({a})))()
>    [1] TRUE
>
>
> On 07/29/2017 09:39 AM, William Dunlap wrote:
>
>> Functions, like your loader(), that use substitute to let users confound
>> things and their names, should give the user a way to avoid the use of
>> substitute.  E.g., library() has the 'character.only' argument; if TRUE
>> then the package argument is treated as an ordinary argument and not passed
>> through substitute().
>>
>> myLoader <- function(package, quietly = TRUE) {
>>        wrapper <- if (quietly) suppressPackageStartupMessages else `{`
>>        wrapper(library(package = package, character.only=TRUE))
>>    }
>>
>> > lapply(c("MASS","boot"), myLoader, quietly=FALSE)
>> [[1]]
>>  [1] "MASS"  "splines"   "pryr"      "stats"     "graphics"  "grDevices"
>>  [7] "utils" "datasets"  "methods"   "base"
>>
>> [[2]]
>>  [1] "boot"      "MASS"      "splines"   "pryr"      "stats"
>>  "graphics"
>>  [7] "grDevices" "utils"     "datasets"  "methods"   "base"
>>
>> "Non-standard" evaluation (using substitute(), formulas, promises, the
>> rlang or lazyeval packages, etc.) has it uses but I wouldn't use it for
>> such a function as your loader().
>>
>>
>> Bill Dunlap
>> TIBCO Software
>> wdunlap tibco.com <http://tibco.com>
>>
>>
>> On Fri, Jul 28, 2017 at 8:20 PM, Benjamin Tyner <btyner at gmail.com
>> <mailto:btyner at gmail.com>> wrote:
>>
>>     Thanks Bill. I think my confusion may have been in part due to my
>>     conflating two distinct meanings of the term "evaluate"; the help
>>     for force says it "forces the evaluation of a function argument"
>>     whereas the help for eval says it "evaluates the ... argument ...
>>     and returns the computed value". I found it helpful to compare:
>>
>>        > lapply(list(a=1,b=2,c=3), function(x){ force(substitute(x)) })
>>        $a
>>        X[[i]]
>>
>>        $b
>>        X[[i]]
>>
>>        $c
>>        X[[i]]
>>
>>     versus
>>
>>        > lapply(list(a=1,b=2,c=3), function(x){ eval(substitute(x)) })
>>        Error in eval(substitute(x)) : object 'X' not found
>>
>>     Now for the context my question arose in: given a function
>>
>>        loader <- function(package, quietly = TRUE) {
>>
>>            wrapper <- if (quietly) suppressPackageStartupMessages else `{`
>>
>>            expr <- substitute(wrapper(library(package = package)))
>>
>>            eval(expr)
>>        }
>>
>>     prior to R version 3.2, one could do things like
>>
>>         lapply(c("MASS", "boot"), loader)
>>
>>     but not anymore (which is fine; I agree that one should not depend
>>     on lapply's implementation details).
>>
>>     Regards,
>>     Ben
>>
>>
>>     On 07/28/2017 06:53 PM, William Dunlap wrote:
>>
>>         1: substitute(), when given an argument to a function (which
>>         will be a promise) gives you the unevaluated expression given
>>         as the argument:
>>
>>         >  L <- list(a=1, b=2, c=3)
>>         > str(lapply(L, function(x) substitute(x)))
>>         List of 3
>>          $ a: language X[[i]]
>>          $ b: language X[[i]]
>>          $ c: language X[[i]]
>>
>>         The 'X' and 'i' are in a frame constructed by lapply and you
>>         are not really supposed to depend on the precise form of those
>>         expressions.
>>
>>         2: An evaluated promise is still a promise: it has the
>>         'evaled' field set to TRUE and the 'value' field set to the
>>         result of evaluating 'code' in 'env'.
>>
>>         > f <- function(x, force) {
>>              if (force) force(x)
>>              if (pryr::is_promise(x)) promise_info(x)
>>              else "not a promise"
>>          }
>>         > str(f(log(-1), force=FALSE))
>>         List of 4
>>          $ code  : language log(-1)
>>          $ env   :<environment: R_GlobalEnv>
>>          $ evaled: logi FALSE
>>          $ value : NULL
>>         > str(f(log(-1), force=TRUE))
>>         List of 4
>>          $ code  : language log(-1)
>>          $ env   : NULL
>>          $ evaled: logi TRUE
>>          $ value : num NaN
>>         Warning message:
>>         In log(-1) : NaNs produced
>>
>>         Can you give a concrete example of what you are try to accomplish?
>>
>>         Bill Dunlap
>>         TIBCO Software
>>         wdunlap tibco.com <http://tibco.com> <http://tibco.com>
>>
>>
>>         On Fri, Jul 28, 2017 at 3:04 PM, Benjamin Tyner
>>         <btyner at gmail.com <mailto:btyner at gmail.com>
>>         <mailto:btyner at gmail.com <mailto:btyner at gmail.com>>> wrote:
>>
>>             Hi,
>>
>>             I thought I understood the change to lapply semantics
>>         resulting
>>             from this,
>>
>>         https://bugs.r-project.org/bugzilla/show_bug.cgi?id=16093
>>         <https://bugs.r-project.org/bugzilla/show_bug.cgi?id=16093>
>>             <https://bugs.r-project.org/bugzilla/show_bug.cgi?id=16093
>>         <https://bugs.r-project.org/bugzilla/show_bug.cgi?id=16093>>
>>
>>             However, would someone care to explain why this does not work?
>>
>>                > L <- list(a=1, b=2, c=3)
>>                > str(lapply(L, function(x){ y <- substitute(x); force(x);
>>             eval(y) }))
>>                Error in eval(y) : object 'X' not found
>>
>>             Basically, my primary goal is to achieve the same result as,
>>
>>                > str(lapply(L, function(x){ eval.parent(substitute(x)) }))
>>                List of 3
>>                 $ a: num 1
>>                 $ b: num 2
>>                 $ c: num 3
>>
>>             but without having to resort to eval.parent as that seems
>>         to rely
>>             on an implementation detail of lapply.
>>
>>             My secondary goal is to understand why force(x) does not
>>         actually
>>             force the promise here,
>>
>>                > str(lapply(L, function(x){ force(x);
>>         pryr::is_promise(x) }))
>>                List of 3
>>                 $ a: logi TRUE
>>                 $ b: logi TRUE
>>                 $ c: logi TRUE
>>             ,
>>             Regards
>>             Ben
>>
>>             ______________________________________________
>>         R-devel at r-project.org <mailto:R-devel at r-project.org>
>>         <mailto:R-devel at r-project.org <mailto:R-devel at r-project.org>>
>>         mailing list
>>         https://stat.ethz.ch/mailman/listinfo/r-devel
>>         <https://stat.ethz.ch/mailman/listinfo/r-devel>
>>             <https://stat.ethz.ch/mailman/listinfo/r-devel
>>         <https://stat.ethz.ch/mailman/listinfo/r-devel>>
>>
>>
>>
>>
>>
>

	[[alternative HTML version deleted]]


From possenriede at gmail.com  Tue Aug  1 11:19:51 2017
From: possenriede at gmail.com (Daniel Possenriede)
Date: Tue, 1 Aug 2017 11:19:51 +0200
Subject: [Rd] special latin1 do not print as glyphs in current devel on
	windows
In-Reply-To: <CANu2KkMwkC3zOkrc7ijc4D2qdhkdacaxjNnqN2XUxhnBn8rRDw@mail.gmail.com>
References: <CANu2KkMwkC3zOkrc7ijc4D2qdhkdacaxjNnqN2XUxhnBn8rRDw@mail.gmail.com>
Message-ID: <CANu2KkP9jocnj4sa=mDtP4NOiw-VuJwi0WjMF1C28=2RADepdQ@mail.gmail.com>

Upon further inspection, I think these are at least two problems.
First the issue with printing latin1/cp1252 characters in the "80" to "9F"
code range.

x <- c("?", "?", "?")
Encoding(x)
print(x)

I assume that these are Unicode escapes!? (Given that Encoding(x) shows
"latin1" I'd rather expect latin1/cp1252 escapes here, but these would be
e.g. "\x80", right? My locale is LC_COLLATE=German_Germany.1252 btw.)
Now I don't know why print tries to convert to Unicode, but if these indeed
are Unicode escapes, then there is something wrong with the conversion from
cp1252 to Unicode.
In general, most cp1252 char codes translate to Unicode like CP1252: "00"
-> Unicode "0000", "01" -> "0001", "02" -> "0002", etc. see
http://www.cp1252.com/.
The exception is the cp1252 "80" to "9F" code range. E.g. the Euro sign is
"80" in cp1252 but "20AC" in Unicode, endash "96" in cp1252, "2013" in
Unicode.
The same error seems to happen with

enc2utf8(x)

Now with iconv() the result is as expected.

iconv(x, to = "UTF-8")


The second problem IMO is that encoding markers get lost with the enc2*
functions

x_utf8 <- enc2utf8(x)
Encoding(x_utf8)
x_nat <- enc2native(x_utf8)
Encoding(x_nat)

Again, this is not the case with iconv()

x_iutf8 <- iconv(x, to = "UTF-8")
Encoding(x_iutf8)
x_inat <- iconv(x_iutf8, from = "UTF-8")
Encoding(x_inat)

	[[alternative HTML version deleted]]


From possenriede at gmail.com  Tue Aug  1 12:33:47 2017
From: possenriede at gmail.com (Daniel Possenriede)
Date: Tue, 1 Aug 2017 12:33:47 +0200
Subject: [Rd] special latin1 do not print as glyphs in current devel on
	windows
In-Reply-To: <CANu2KkP9jocnj4sa=mDtP4NOiw-VuJwi0WjMF1C28=2RADepdQ@mail.gmail.com>
References: <CANu2KkMwkC3zOkrc7ijc4D2qdhkdacaxjNnqN2XUxhnBn8rRDw@mail.gmail.com>
 <CANu2KkP9jocnj4sa=mDtP4NOiw-VuJwi0WjMF1C28=2RADepdQ@mail.gmail.com>
Message-ID: <CANu2KkPw00EzXWJKN4ZKP4fpY7H2JzveSZ9OekFM3F5uBAtTvQ@mail.gmail.com>

Sorry, I should have included my console output, obviously. So here we go:

Wrong UTF-8 escapes with using print in v3.5.0 devel:

# R Under development (unstable) (2017-07-30 r73000) -- "Unsuffered
Consequences"
# Platform: x86_64-w64-mingw32/x64 (64-bit)

> x <- c("?", "?", "?")
> Encoding(x)
[1] "latin1" "latin1" "latin1"
> print(x)
[1] "\u0080" "\u0096" "\u0089"

Same output with enc2utf8()

> enc2utf8(x)
[1] "\u0080" "\u0096" "\u0089"

With iconv() the result is as expected.

> iconv(x, to = "UTF-8")
[1] "?" "?" "?"

The second problem IMO is that encoding markers get lost with the enc2*
functions

> x_utf8 <- enc2utf8(x)
> Encoding(x_utf8)
[1] "UTF-8" "UTF-8" "UTF-8"
> x_nat <- enc2native(x_utf8)
> Encoding(x_nat)
[1] "unknown" "unknown" "unknown"

This is not the case with iconv()

> x_iutf8 <- iconv(x, to = "UTF-8")
> Encoding(x_iutf8)
[1] "UTF-8" "UTF-8" "UTF-8"
> x_inat <- iconv(x_iutf8, from = "UTF-8")
> Encoding(x_inat)
[1] "latin1" "latin1" "latin1"

	[[alternative HTML version deleted]]


From ripley at stats.ox.ac.uk  Tue Aug  1 13:36:33 2017
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 1 Aug 2017 12:36:33 +0100
Subject: [Rd] special latin1 do not print as glyphs in current devel on
 windows
In-Reply-To: <CANu2KkP9jocnj4sa=mDtP4NOiw-VuJwi0WjMF1C28=2RADepdQ@mail.gmail.com>
References: <CANu2KkMwkC3zOkrc7ijc4D2qdhkdacaxjNnqN2XUxhnBn8rRDw@mail.gmail.com>
 <CANu2KkP9jocnj4sa=mDtP4NOiw-VuJwi0WjMF1C28=2RADepdQ@mail.gmail.com>
Message-ID: <11da8433-17aa-44be-a10b-8497504eb53f@stats.ox.ac.uk>

You seem confused about Latin-1: those characters are not in Latin-1. 
(MicroSoft code pages are a proprietary encoding, some code pages such 
as CP1252 being extensions to Latin-1.)

You have not given the 'at a minimum information' asked for in the 
posting guide so we have no way to reproduce this, and without showing 
us the output on your system, we have no idea what you saw.

[As a convenience to Windows users, R does in some cases assume that 
they are using Latin-1 encodings. If they use extensions to Latin-1 then 
there are no guarantees that code written for strict Latin-1 will work.]

On 01/08/2017 10:19, Daniel Possenriede wrote:
> Upon further inspection, I think these are at least two problems.
> First the issue with printing latin1/cp1252 characters in the "80" to "9F"
> code range.
> 
> x <- c("?", "?", "?")
> Encoding(x)
> print(x)
> 
> I assume that these are Unicode escapes!? (Given that Encoding(x) shows
> "latin1" I'd rather expect latin1/cp1252 escapes here, but these would be	
> e.g. "\x80", right? My locale is LC_COLLATE=German_Germany.1252 btw.)
> Now I don't know why print tries to convert to Unicode, but if these indeed
> are Unicode escapes, then there is something wrong with the conversion from
> cp1252 to Unicode.
> In general, most cp1252 char codes translate to Unicode like CP1252: "00"
> -> Unicode "0000", "01" -> "0001", "02" -> "0002", etc. see
> http://www.cp1252.com/.
> The exception is the cp1252 "80" to "9F" code range. E.g. the Euro sign is
> "80" in cp1252 but "20AC" in Unicode, endash "96" in cp1252, "2013" in
> Unicode.
> The same error seems to happen with
> 
> enc2utf8(x)
> 
> Now with iconv() the result is as expected.
> 
> iconv(x, to = "UTF-8")
> 
> 
> The second problem IMO is that encoding markers get lost with the enc2*
> functions

As you are changing encodings, you do not want to preserve encoding!

> x_utf8 <- enc2utf8(x)
> Encoding(x_utf8)
> x_nat <- enc2native(x_utf8)
> Encoding(x_nat)

In an actual Latin-1 locale on Linux

 > x_utf8 <- c("??", "\u20ac", "\u2013")
 > Encoding(x_utf8)
[1] "latin1" "UTF-8"  "UTF-8"
 > enc2native(x_utf8)
[1] "??"     "<U+20AC>" "<U+2013>"
 > Encoding(.Last.value)
[1] "latin1"  "unknown" "unknown"

as expected.

> Again, this is not the case with iconv()
> 
> x_iutf8 <- iconv(x, to = "UTF-8")
> Encoding(x_iutf8)
> x_inat <- iconv(x_iutf8, from = "UTF-8")
> Encoding(x_inat)

iconv is converting from/to the current locale's encoding, presumably 
CP1252, not from the marked encoding (as the help page states explicitly.)

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Emeritus Professor of Applied Statistics, University of Oxford


From possenriede at gmail.com  Tue Aug  1 14:49:21 2017
From: possenriede at gmail.com (Daniel Possenriede)
Date: Tue, 1 Aug 2017 14:49:21 +0200
Subject: [Rd] special latin1 do not print as glyphs in current devel on
	windows
In-Reply-To: <11da8433-17aa-44be-a10b-8497504eb53f@stats.ox.ac.uk>
References: <CANu2KkMwkC3zOkrc7ijc4D2qdhkdacaxjNnqN2XUxhnBn8rRDw@mail.gmail.com>
 <CANu2KkP9jocnj4sa=mDtP4NOiw-VuJwi0WjMF1C28=2RADepdQ@mail.gmail.com>
 <11da8433-17aa-44be-a10b-8497504eb53f@stats.ox.ac.uk>
Message-ID: <CANu2KkOOSz1yRy0iszE47uTniAms=_LgBOW8ZbEJpCCfhJyUuA@mail.gmail.com>

Thank you!. My apologies again for not including the console output in my
message before. I sent another e-mail with the output in the meantime, so
it should be a bit clearer now, what I am seeing. In case I missed
something, please let me know.

Yes, I am using latin1 and cp1252 interchangebly here, mostly because
Encoding() is reporting the encoding as "latin1". You presumed correctly
that my current/default locale's encoding is CP1252. (I also mentioned that
my locale is LC_COLLATE=German_Germany.1252 before).


As you are changing encodings, you do not want to preserve encoding!
>

I am not interested in preserving encodings. What I am worried about is
that the encoding is not marked anymore, i.e. that Encoding() returns
"unknown".
In cp1252 encoding on Windows (note that I am using the cp1252 escape
"\x80" and not the Unicode "\u20AC")

> x_utf8 <- enc2utf8(c("?", "\x80"))
> Encoding(x_utf8)
[1] "UTF-8" "UTF-8"
> x_nat <- enc2native(x_utf8)
> Encoding(x_nat)
[1] "unknown" "unknown"

See also Kirill's message to this list: "ASCII strings are marked as ASCII
internally, but this information doesn't seem to be available, e.g.,
Encoding() returns "unknown" for such strings "
http://r.789695.n4.nabble.com/source-parse-and-foreign-UTF-8-characters-tp4733523.html

>
> Again, this is not the case with iconv()
>>
>> x_iutf8 <- iconv(x, to = "UTF-8")
>> Encoding(x_iutf8)
>> x_inat <- iconv(x_iutf8, from = "UTF-8")
>> Encoding(x_inat)
>>
>
> iconv is converting from/to the current locale's encoding, presumably
> CP1252, not from the marked encoding (as the help page states explicitly.)
>

I am aware that iconv is not using the marked encoding, but that you either
have to set it explicitly or it uses the current locale's default encoding.
As I said I am worried about the fact that the encoding markers get lost
with the enc2* functions or rather they are not set correctly. I am just
using the iconv example to show that iconv is able to set the encoding
markers correctly. So it seems generally possible.

> x_iutf8 <- iconv(c("?", "\x80"), to = "UTF-8")
> Encoding(x_iutf8)
[1] "UTF-8" "UTF-8"
> x_iutf8
[1] "?" "?"
> x_inat <- iconv(x_iutf8, from = "UTF-8")
> Encoding(x_inat)
[1] "latin1" "latin1"
> x_inat
[1] "\u0080" "\u0080"

	[[alternative HTML version deleted]]


From andrzej.oles at gmail.com  Tue Aug  1 14:50:06 2017
From: andrzej.oles at gmail.com (=?UTF-8?Q?Andrzej_Ole=C5=9B?=)
Date: Tue, 1 Aug 2017 14:50:06 +0200
Subject: [Rd] Problems with S4 methods dispatching on `...` (aka
	dotsMethods)
In-Reply-To: <CAOQ5NyeUcKDvm-7TOL+aYUg4X+EPLzdxfs0e7hmnAcYAvFFDdA@mail.gmail.com>
References: <CAH7mKkiZNJ_W8EsbEvobHmj1wHDcE2NmYVTuPq8Uxc+aGC6YOw@mail.gmail.com>
 <CAOQ5Nye8nD0FK5vuuz83i+5nEOomezMZx0iDjJ6ZKWK9M4Xk_w@mail.gmail.com>
 <CAH7mKkgwa_7FRChyrxmKf8Ub_mDtX-WfREq-A4FbCvanQt8zpg@mail.gmail.com>
 <CAH7mKkgSFg8ki8sS4NXwrnv0m6hL4f_gePAK0SQnnhtGrvu88A@mail.gmail.com>
 <CAOQ5Nyf0C3AQ3HJhyqY-ZW8fPxFVU6eJ6vvyysS5a9DPR408iQ@mail.gmail.com>
 <CAH7mKkgTbdxpuiZz+V+zL-xCk6hQtSkj9UrmseDxzANqGEBkfQ@mail.gmail.com>
 <CAH7mKkg-aD4JF-H_6WKdifqpALHcdTLPCuAss+AvVB9138mZeQ@mail.gmail.com>
 <CAOQ5NyeUcKDvm-7TOL+aYUg4X+EPLzdxfs0e7hmnAcYAvFFDdA@mail.gmail.com>
Message-ID: <CAH7mKkjcYMgjQBWDYJ2QCaGz18EO+S9fi-EOqOUCopJwmRPLLg@mail.gmail.com>

Thank you Michael for updating the 3.4 branch, the `callNextMethod()` now
works for `...` methods as expected. However, I'm still missing your other
patch fixing the handling of arguments in `...` methods. It would be really
great if this bugfix could be integrated into the 3.4 branch as well, such
that the following code doesn't result in an error.

Cheers,
Andrzej


    f = function(x, ..., a = b) {
      b = "missing 'a'"
      print(a)
    }

    f()
    ## [1] missing 'a'

    f(a = 1)
    ## [1] 1

    setGeneric("f", signature = "x")

    # works as the non-generic version
    f()
    ## [1] missing 'a'

    setGeneric("f", signature = "...")

    # unexpectedly fails to find 'b'
    f()
    ## Error in print(a) : object 'b' not found


On Fri, Jul 28, 2017 at 9:15 PM, Michael Lawrence <lawrence.michael at gene.com
> wrote:

> I pushed the patch to the 3.4 branch. Feel free to test.
>
> Michael
>
> On Wed, Jul 26, 2017 at 4:02 AM, Andrzej Ole? <andrzej.oles at gmail.com>
> wrote:
> > Hi Michael,
> >
> > it seems that your patch to S4 generics dispatching on `...` is still
> > available only in R-devel, and was not included in the minor R-3.4.1
> > release. I was wondering what is the policy of incorporating bug fixes
> from
> > the devel branch into release, and whether there is any chance that the
> > broken `...` dispatch is fixed before R-3.5.0?
> >
> > Cheers,
> > Andrzej
> >
> >
> > On Tue, Apr 25, 2017 at 4:15 PM, Andrzej Ole? <andrzej.oles at gmail.com>
> > wrote:
> >>
> >> You're right, I must have mixed up my R versions when running the
> example,
> >> as the problem seems to be resolved in R-devel.
> >>
> >> Sorry for the noise and thanks again for fixing this.
> >>
> >> Andrzej
> >>
> >> On Tue, Apr 25, 2017 at 3:55 PM, Michael Lawrence
> >> <lawrence.michael at gene.com> wrote:
> >>>
> >>> I attempted to fix it, and that example seems to work for me. It's
> >>> also a (passing) regression test in R. Are you sure you're using a new
> >>> enough R-devel?
> >>>
> >>>
> >>> On Tue, Apr 25, 2017 at 2:34 AM, Andrzej Ole? <andrzej.oles at gmail.com>
> >>> wrote:
> >>> > Hi Michael,
> >>> >
> >>> > thanks again for your patch! I've tested it and I'm happy to confirm
> >>> > that
> >>> > `callNextMethod()` works with methods dispatching on `...`.
> >>> >
> >>> > However, the second issue I reported still seems to be unresolved.
> >>> > Consider
> >>> > the following toy example, where the `f()` calls differ in result
> >>> > depending
> >>> > on whether the dispatch happens on a formal argument or the `...`
> >>> > argument.
> >>> >
> >>> >
> >>> >     f = function(x, ..., a = b) {
> >>> >       b = "missing 'a'"
> >>> >       print(a)
> >>> >     }
> >>> >
> >>> >     f()
> >>> >     ## [1] missing 'a'
> >>> >
> >>> >     f(a = 1)
> >>> >     ## [1] 1
> >>> >
> >>> >     setGeneric("f", signature = "x")
> >>> >
> >>> >     # works as the non-generic version
> >>> >     f()
> >>> >     ## [1] missing 'a'
> >>> >
> >>> >     setGeneric("f", signature = "...")
> >>> >
> >>> >     # unexpectedly fails to find 'b'
> >>> >     f()
> >>> >     ## Error in print(a) : object 'b' not found
> >>> >
> >>> >
> >>> > Any chances of fixing this?
> >>> >
> >>> > Cheers,
> >>> > Andrzej
> >>> >
> >>> >
> >>> >
> >>> > On Fri, Apr 21, 2017 at 11:40 AM, Andrzej Ole? <
> andrzej.oles at gmail.com>
> >>> > wrote:
> >>> >>
> >>> >> Great, thanks Michael for you quick response!
> >>> >>
> >>> >> I started off with a question on SO because I was not sure whether
> >>> >> this
> >>> >> was an actual bug or I was just missing something obvious. I'm
> looking
> >>> >> forward to the patch.
> >>> >>
> >>> >> Cheers,
> >>> >> Andrzej
> >>> >>
> >>> >>
> >>> >> On Thu, Apr 20, 2017 at 10:28 PM, Michael Lawrence
> >>> >> <lawrence.michael at gene.com> wrote:
> >>> >>>
> >>> >>> Thanks for pointing out these issues. I have a fix that I will
> commit
> >>> >>> soon.
> >>> >>>
> >>> >>> Btw, I would never have seen the post on Stack Overflow. It's best
> to
> >>> >>> report bugs on the bugzilla.
> >>> >>>
> >>> >>> Michael
> >>> >>>
> >>> >>> On Thu, Apr 20, 2017 at 8:30 AM, Andrzej Ole?
> >>> >>> <andrzej.oles at gmail.com>
> >>> >>> wrote:
> >>> >>> > Hi all,
> >>> >>> >
> >>> >>> > I recently encountered some unexpected behavior with S4 generics
> >>> >>> > dispatching on `...`, which I described in
> >>> >>> >
> >>> >>> >
> >>> >>> > http://stackoverflow.com/questions/43499203/use-
> callnextmethod-with-dotsmethods
> >>> >>> >
> >>> >>> > TL;DR: `callNextMethod()` doesn't work in methods dispatching on
> >>> >>> > `...`,
> >>> >>> > and
> >>> >>> > arguments of such methods are resolved differently than the
> >>> >>> > arguments
> >>> >>> > of
> >>> >>> > methods dispatching on formal arguments.
> >>> >>> >
> >>> >>> > Could this indicate a potential problem with the implementation
> of
> >>> >>> > the
> >>> >>> > `...` dispatch?
> >>> >>> >
> >>> >>> > Cheers,
> >>> >>> > Andrzej
> >>> >>> >
> >>> >>> >         [[alternative HTML version deleted]]
> >>> >>> >
> >>> >>> > ______________________________________________
> >>> >>> > R-devel at r-project.org mailing list
> >>> >>> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >>> >>
> >>> >>
> >>> >
> >>
> >>
> >
>

	[[alternative HTML version deleted]]


From edd at debian.org  Tue Aug  1 16:55:44 2017
From: edd at debian.org (Dirk Eddelbuettel)
Date: Tue, 1 Aug 2017 09:55:44 -0500
Subject: [Rd] reproducible segmentation fault installing packages on
	FreeBSD	11.1
In-Reply-To: <86bmo044g3.fsf@phe.ftfl.ca>
References: <86bmo044g3.fsf@phe.ftfl.ca>
Message-ID: <22912.38512.321590.446866@bud.eddelbuettel.com>


On 31 July 2017 at 19:38, Joseph Mingrone wrote:
| This happens when attempting to install any package. There were no such
| problems on 11.0.
| 
| Some other ways to trigger the problem:
[...]
| trying URL 'https://cloud.r-project.org/src/contrib/Rcpp_0.12.12.tar.gz'
| [New LWP 100854 of process 56011]
| 
| Thread 7 received signal SIGSEGV, Segmentation fault.
| [Switching to LWP 100854 of process 56011]
| uw_frame_state_for (context=context at entry=0x7fffdfffde20, fs=fs at entry=0x7fffdfffdb70)
|     at /usr/ports/lang/gcc5/work/gcc-5.4.0/libgcc/unwind-dw2.c:1249
| 1249          return MD_FALLBACK_FRAME_STATE_FOR (context, fs);

Looks like a gcc error to me. Rcpp itself is pretty widely used and tested
and I am not aware of it having issue per se on any of the *BSDs.

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From ramonfallon at gmail.com  Tue Aug  1 17:29:20 2017
From: ramonfallon at gmail.com (=?UTF-8?Q?Ram=C3=B3n_Fallon?=)
Date: Tue, 1 Aug 2017 16:29:20 +0100
Subject: [Rd] configure.ac
Message-ID: <CA+WKpEu7a3z11xG0P-u_GVfse0LP7ptkh9ab+y+GpmOSajiRng@mail.gmail.com>

Hi,

Just a quick mail to mention that I cannot generate a new configure script
using autoconf or autoreconf. I had edited the configure.ac and thought ...
"oh, that's my fault", but then I tried it on R-patched and R-3.4.1 without
touching configure.ac and had the same problems.

The "building R packages" documentation seems to suggest that "autoconf"
should take care of it, but I must be missing something as I expect it to
be a common task.

I also tried explicit autohell (yes, I know) commands
1) autoreconf --force -v
completes but invoking configure (with no options) gives

checking build system type... x86_64-pc-linux-gnu
checking host system type... x86_64-pc-linux-gnu
loading site script './config.site'
loading build-specific script './config.site'
./configure: line 2982: syntax error near unexpected token `blas'
./configure: line 2982: `  withval=$with_blas; R_ARG_USE(blas)'

OK.. there's a recipe that oen can use, starting with:

libtoolize --force

but you get:

A sequence typical found out there, starting withlibtoolize: putting
auxiliary files in AC_CONFIG_AUX_DIR, `tools'.
libtoolize: linking file `tools/ltmain.sh'
libtoolize: You should add the contents of the following files to
`aclocal.m4':
libtoolize:   `/usr/share/aclocal/libtool.m4'
libtoolize:   `/usr/share/aclocal/ltoptions.m4'
libtoolize:   `/usr/share/aclocal/ltversion.m4'
libtoolize:   `/usr/share/aclocal/ltsugar.m4'
libtoolize:   `/usr/share/aclocal/lt~obsolete.m4'
libtoolize: Consider adding `AC_CONFIG_MACRO_DIR([m4])' to configure.ac and
libtoolize: rerunning libtoolize, to keep the correct libtool macros
in-tree.
libtoolize: Consider adding `-I m4' to ACLOCAL_AMFLAGS in Makefile.am.


then:

aclocal
autoheader
automake --force-missing --add-missing

first two go OK, but the third gives

configure.ac: no proper invocation of
 was found.
configure.ac: You should verify that configure.ac invokes AM_INIT_AUTOMAKE,
configure.ac: that aclocal.m4 is present in the top-level directory,
configure.ac: and that aclocal.m4 was recently regenerated (using aclocal).
automake: no `Makefile.am' found for any configure output

then the following runs OK
autoconf

but running configure gives the same BLAS error.

But I'm farily sure one shouldn't run to see what's wrong with BLAS,ratehr
it's just the configure options not being read properly. The
AM_INIT_AUTOMAKE
issue definitely seems important.

Is there anything I'm missing?

Cheers and thanks in advance!

	[[alternative HTML version deleted]]


From pdalgd at gmail.com  Tue Aug  1 18:26:25 2017
From: pdalgd at gmail.com (peter dalgaard)
Date: Tue, 1 Aug 2017 18:26:25 +0200
Subject: [Rd] configure.ac
In-Reply-To: <CA+WKpEu7a3z11xG0P-u_GVfse0LP7ptkh9ab+y+GpmOSajiRng@mail.gmail.com>
References: <CA+WKpEu7a3z11xG0P-u_GVfse0LP7ptkh9ab+y+GpmOSajiRng@mail.gmail.com>
Message-ID: <C8F34903-00C6-47F7-888F-44551435C279@gmail.com>

If you check developer.r-project.org, you'll find links to the scripts that we use for building releases and pre-releases of R. These are usually run on a Mac, but shouldn't require much change for Linux. In particular, notice this lead-in in the prerelease script:

rm -rf BUILD-dist
mkdir BUILD-dist
cd R
aclocal -I m4
autoconf
cd ../BUILD-dist
....etc....

-pd

> On 1 Aug 2017, at 17:29 , Ram?n Fallon <ramonfallon at gmail.com> wrote:
> 
> Hi,
> 
> Just a quick mail to mention that I cannot generate a new configure script
> using autoconf or autoreconf. I had edited the configure.ac and thought ...
> "oh, that's my fault", but then I tried it on R-patched and R-3.4.1 without
> touching configure.ac and had the same problems.
> 
> The "building R packages" documentation seems to suggest that "autoconf"
> should take care of it, but I must be missing something as I expect it to
> be a common task.
> 
> I also tried explicit autohell (yes, I know) commands
> 1) autoreconf --force -v
> completes but invoking configure (with no options) gives
> 
> checking build system type... x86_64-pc-linux-gnu
> checking host system type... x86_64-pc-linux-gnu
> loading site script './config.site'
> loading build-specific script './config.site'
> ./configure: line 2982: syntax error near unexpected token `blas'
> ./configure: line 2982: `  withval=$with_blas; R_ARG_USE(blas)'
> 
> OK.. there's a recipe that oen can use, starting with:
> 
> libtoolize --force
> 
> but you get:
> 
> A sequence typical found out there, starting withlibtoolize: putting
> auxiliary files in AC_CONFIG_AUX_DIR, `tools'.
> libtoolize: linking file `tools/ltmain.sh'
> libtoolize: You should add the contents of the following files to
> `aclocal.m4':
> libtoolize:   `/usr/share/aclocal/libtool.m4'
> libtoolize:   `/usr/share/aclocal/ltoptions.m4'
> libtoolize:   `/usr/share/aclocal/ltversion.m4'
> libtoolize:   `/usr/share/aclocal/ltsugar.m4'
> libtoolize:   `/usr/share/aclocal/lt~obsolete.m4'
> libtoolize: Consider adding `AC_CONFIG_MACRO_DIR([m4])' to configure.ac and
> libtoolize: rerunning libtoolize, to keep the correct libtool macros
> in-tree.
> libtoolize: Consider adding `-I m4' to ACLOCAL_AMFLAGS in Makefile.am.
> 
> 
> then:
> 
> aclocal
> autoheader
> automake --force-missing --add-missing
> 
> first two go OK, but the third gives
> 
> configure.ac: no proper invocation of
> was found.
> configure.ac: You should verify that configure.ac invokes AM_INIT_AUTOMAKE,
> configure.ac: that aclocal.m4 is present in the top-level directory,
> configure.ac: and that aclocal.m4 was recently regenerated (using aclocal).
> automake: no `Makefile.am' found for any configure output
> 
> then the following runs OK
> autoconf
> 
> but running configure gives the same BLAS error.
> 
> But I'm farily sure one shouldn't run to see what's wrong with BLAS,ratehr
> it's just the configure options not being read properly. The
> AM_INIT_AUTOMAKE
> issue definitely seems important.
> 
> Is there anything I'm missing?
> 
> Cheers and thanks in advance!
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Office: A 4.23
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From ripley at stats.ox.ac.uk  Tue Aug  1 18:43:40 2017
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 1 Aug 2017 17:43:40 +0100
Subject: [Rd] configure.ac
In-Reply-To: <C8F34903-00C6-47F7-888F-44551435C279@gmail.com>
References: <CA+WKpEu7a3z11xG0P-u_GVfse0LP7ptkh9ab+y+GpmOSajiRng@mail.gmail.com>
 <C8F34903-00C6-47F7-888F-44551435C279@gmail.com>
Message-ID: <76682724-14db-f3a4-aad1-d338b8e52592@stats.ox.ac.uk>

On 01/08/2017 17:26, peter dalgaard wrote:
> If you check developer.r-project.org, you'll find links to the scripts that we use for building releases and pre-releases of R. These are usually run on a Mac, but shouldn't require much change for Linux. In particular, notice this lead-in in the prerelease script:
> 
> rm -rf BUILD-dist
> mkdir BUILD-dist
> cd R
> aclocal -I m4
> autoconf
> cd ../BUILD-dist
> ....etc....

Or there is configure --enable-maintainer-mode, after which 'make' 
remakes 'configure' if necessary.  (That is fairly often tested on 
Linux, and occasionally on macOS with the autoconf tools added.)

> 
> -pd
> 
>> On 1 Aug 2017, at 17:29 , Ram?n Fallon <ramonfallon at gmail.com> wrote:
>>
>> Hi,
>>
>> Just a quick mail to mention that I cannot generate a new configure script
>> using autoconf or autoreconf. I had edited the configure.ac and thought ...
>> "oh, that's my fault", but then I tried it on R-patched and R-3.4.1 without
>> touching configure.ac and had the same problems.
>>
>> The "building R packages" documentation seems to suggest that "autoconf"
>> should take care of it, but I must be missing something as I expect it to
>> be a common task.
>>
>> I also tried explicit autohell (yes, I know) commands
>> 1) autoreconf --force -v
>> completes but invoking configure (with no options) gives
>>
>> checking build system type... x86_64-pc-linux-gnu
>> checking host system type... x86_64-pc-linux-gnu
>> loading site script './config.site'
>> loading build-specific script './config.site'
>> ./configure: line 2982: syntax error near unexpected token `blas'
>> ./configure: line 2982: `  withval=$with_blas; R_ARG_USE(blas)'
>>
>> OK.. there's a recipe that oen can use, starting with:
>>
>> libtoolize --force
>>
>> but you get:
>>
>> A sequence typical found out there, starting withlibtoolize: putting
>> auxiliary files in AC_CONFIG_AUX_DIR, `tools'.
>> libtoolize: linking file `tools/ltmain.sh'
>> libtoolize: You should add the contents of the following files to
>> `aclocal.m4':
>> libtoolize:   `/usr/share/aclocal/libtool.m4'
>> libtoolize:   `/usr/share/aclocal/ltoptions.m4'
>> libtoolize:   `/usr/share/aclocal/ltversion.m4'
>> libtoolize:   `/usr/share/aclocal/ltsugar.m4'
>> libtoolize:   `/usr/share/aclocal/lt~obsolete.m4'
>> libtoolize: Consider adding `AC_CONFIG_MACRO_DIR([m4])' to configure.ac and
>> libtoolize: rerunning libtoolize, to keep the correct libtool macros
>> in-tree.
>> libtoolize: Consider adding `-I m4' to ACLOCAL_AMFLAGS in Makefile.am.
>>
>>
>> then:
>>
>> aclocal
>> autoheader
>> automake --force-missing --add-missing
>>
>> first two go OK, but the third gives
>>
>> configure.ac: no proper invocation of
>> was found.
>> configure.ac: You should verify that configure.ac invokes AM_INIT_AUTOMAKE,
>> configure.ac: that aclocal.m4 is present in the top-level directory,
>> configure.ac: and that aclocal.m4 was recently regenerated (using aclocal).
>> automake: no `Makefile.am' found for any configure output
>>
>> then the following runs OK
>> autoconf
>>
>> but running configure gives the same BLAS error.
>>
>> But I'm farily sure one shouldn't run to see what's wrong with BLAS,ratehr
>> it's just the configure options not being read properly. The
>> AM_INIT_AUTOMAKE
>> issue definitely seems important.
>>
>> Is there anything I'm missing?
>>
>> Cheers and thanks in advance!
>>
>> 	[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Emeritus Professor of Applied Statistics, University of Oxford


From suharto_anggono at yahoo.com  Tue Aug  1 18:54:34 2017
From: suharto_anggono at yahoo.com (Suharto Anggono Suharto Anggono)
Date: Tue, 1 Aug 2017 16:54:34 +0000 (UTC)
Subject: [Rd] translateChar in NewName in bind.c
References: <1322401176.3627709.1501606474350.ref@mail.yahoo.com>
Message-ID: <1322401176.3627709.1501606474350@mail.yahoo.com>

For the 2nd example, I say that R 3.4.1 result is acceptable, as names(c(x)) and names(x) are equal.

The change exposed by the 2nd example is in line with statement of the NEWS item corresponding to PR#17284: "c() and unlist() are now more efficient in constructing the names(.) of their return value, ...." However, currently, the NEWS item is for R-devel, not R 3.4.1 patched.

--------------------------------------------
On Mon, 31/7/17, Martin Maechler <maechler at stat.math.ethz.ch> wrote:

 Subject: Re: [Rd] translateChar in NewName in bind.c

 Cc: r-devel at r-project.org
 Date: Monday, 31 July, 2017, 8:38 PM
 
>>>>> Suharto Anggono Suharto Anggono via R-devel <r-devel at r-project.org>
>>>>>     on Sun, 30 Jul 2017 14:57:53 +0000 writes:

    > R devel's bind.c has been ported to R patched. Is it OK while names of 'unlist' or 'c' result may be not strictly the same as in R 3.4.1 because of changed function 'NewName' in bind.c?

    > Using 'translateCharUTF8' instead of 'translateChar' is as it should be. It has an effect in non-UTF-8 locale for this example.

    > x <- list(1:2)
    > names(x) <- "\ue7"
    > res <- unlist(x)
    > charToRaw(names(res)[1])

    > Directly assigning 'tag' to 'ans' is more efficient, but
    > may be different from in R 3.4.1 that involves
    > 'translateCharUTF8', that is also correct. It has an
    > effect for this example. 

    > x <- 0
    > names(x) <- "\xe7"
    > Encoding(names(x)) <- "latin1"
    > res <- c(x)
    > Encoding(names(res))
    > charToRaw(names(res))

Yes, you are right, thank you:

That part of the changes in bind.c was *not* directly related to
the two R-bugs (PR#17284 & PR#17292)... and therefore, maybe I
should not have ported it to R-patched (= R 3.4.1 patched).

Your examples above are instructive..  notably the 2nd one seems
to demonstrate to me, that the change also *did* fix a bug:

   Encoding(names(res))

is "latin1" in R-devel  but interestingly is "UTF-8" in R 3.4.1,
indeed independently of the locale.

I would argue R-devel (and current R-patched) is more faithful
by keeping the Encoding "latin1" that was set for names(x) also
in the  names(c(x)) .

I could revert R-patched's  bind.c (so it only contains the two
official bug fixes PR#172(84|92)   but I wonder if it is
desirable in this case.

I'm glad for further reasoning.
Given current "knowledge"/"evidence",  I would not  revert
R-patched to R 3.4.1's behavior.

Martin


From jrm at ftfl.ca  Tue Aug  1 19:09:27 2017
From: jrm at ftfl.ca (Joseph Mingrone)
Date: Tue, 01 Aug 2017 14:09:27 -0300
Subject: [Rd] reproducible segmentation fault installing packages on
	FreeBSD 11.1
In-Reply-To: <22912.38512.321590.446866@bud.eddelbuettel.com> (Dirk
 Eddelbuettel's message of "Tue, 1 Aug 2017 09:55:44 -0500")
References: <86bmo044g3.fsf@phe.ftfl.ca>
 <22912.38512.321590.446866@bud.eddelbuettel.com>
Message-ID: <86379b43lk.fsf@phe.ftfl.ca>

Dirk Eddelbuettel <edd at debian.org> writes:

> On 31 July 2017 at 19:38, Joseph Mingrone wrote:
> | This happens when attempting to install any package. There were no such
> | problems on 11.0.
> | 
> | Some other ways to trigger the problem:
> [...]
> | trying URL 'https://cloud.r-project.org/src/contrib/Rcpp_0.12.12.tar.gz'
> | [New LWP 100854 of process 56011]
> | 
> | Thread 7 received signal SIGSEGV, Segmentation fault.
> | [Switching to LWP 100854 of process 56011]
> | uw_frame_state_for (context=context at entry=0x7fffdfffde20, fs=fs at entry=0x7fffdfffdb70)
> |     at /usr/ports/lang/gcc5/work/gcc-5.4.0/libgcc/unwind-dw2.c:1249
> | 1249          return MD_FALLBACK_FRAME_STATE_FOR (context, fs);

> Looks like a gcc error to me. Rcpp itself is pretty widely used and tested
> and I am not aware of it having issue per se on any of the *BSDs.

The problem isn't specific to any package or packages in general, but
seems related to libcurl and/or gfortran.

The third call to

CURLcode ret = curl_easy_perform(hnd);

in in_do_curlGetHeaders() from src/modules/internet/libcurl.c triggers
the problem _unless_ R is built with flang instead of gfortran.

For FreeBSD 11.1 R users, there are two workarounds [1].

1) Build the FreeBSD R package with the FLANG option instead of
   GFORTRAN.  FLANG may be the default soon.

2) Add

   options(download.file.method="wget")

   to ~/.Rprofile with a newline after it.  Ensure ftp/wget is
   installed, because it is not pulled in by math/R.

Joseph

[1] Both these workarounds prevent a predictable crash, but have only
been lightly tested.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 962 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20170801/ad211bef/attachment.sig>

From jrm at ftfl.ca  Tue Aug  1 19:12:14 2017
From: jrm at ftfl.ca (Joseph Mingrone)
Date: Tue, 01 Aug 2017 14:12:14 -0300
Subject: [Rd] reproducible segmentation fault installing packages on
	FreeBSD 11.1
In-Reply-To: <86bmo044g3.fsf@phe.ftfl.ca> (Joseph Mingrone's message of "Mon, 
 31 Jul 2017 19:38:52 -0300")
References: <86bmo044g3.fsf@phe.ftfl.ca>
Message-ID: <86vam72owh.fsf@phe.ftfl.ca>

For anyone interested, here is the FreeBSD bug report.

https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=221127
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 962 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20170801/bea861c5/attachment.sig>

From ramonfallon at gmail.com  Tue Aug  1 19:30:01 2017
From: ramonfallon at gmail.com (=?UTF-8?Q?Ram=C3=B3n_Fallon?=)
Date: Tue, 1 Aug 2017 18:30:01 +0100
Subject: [Rd] configure.ac
In-Reply-To: <CA+WKpEu7a3z11xG0P-u_GVfse0LP7ptkh9ab+y+GpmOSajiRng@mail.gmail.com>
References: <CA+WKpEu7a3z11xG0P-u_GVfse0LP7ptkh9ab+y+GpmOSajiRng@mail.gmail.com>
Message-ID: <CA+WKpEsEMdevUy6NqY2OdXBkbK2WCinAnXPSCjx19zegB6XktQ@mail.gmail.com>

Many thanks Peter for your answer.

That page was exactly what I was looking for. I suppose I was in too much
of a hurry. I didn't developer links on the page R page and quick google
didn't give me anything.

That's great, thanks!

On Tue, Aug 1, 2017 at 4:29 PM, Ram?n Fallon <ramonfallon at gmail.com> wrote:

> Hi,
>
> Just a quick mail to mention that I cannot generate a new configure script
> using autoconf or autoreconf. I had edited the configure.ac and thought
> ... "oh, that's my fault", but then I tried it on R-patched and R-3.4.1
> without touching configure.ac and had the same problems.
>
> The "building R packages" documentation seems to suggest that "autoconf"
> should take care of it, but I must be missing something as I expect it to
> be a common task.
>
> I also tried explicit autohell (yes, I know) commands
> 1) autoreconf --force -v
> completes but invoking configure (with no options) gives
>
> checking build system type... x86_64-pc-linux-gnu
> checking host system type... x86_64-pc-linux-gnu
> loading site script './config.site'
> loading build-specific script './config.site'
> ./configure: line 2982: syntax error near unexpected token `blas'
> ./configure: line 2982: `  withval=$with_blas; R_ARG_USE(blas)'
>
> OK.. there's a recipe that oen can use, starting with:
>
> libtoolize --force
>
> but you get:
>
> A sequence typical found out there, starting withlibtoolize: putting
> auxiliary files in AC_CONFIG_AUX_DIR, `tools'.
> libtoolize: linking file `tools/ltmain.sh'
> libtoolize: You should add the contents of the following files to
> `aclocal.m4':
> libtoolize:   `/usr/share/aclocal/libtool.m4'
> libtoolize:   `/usr/share/aclocal/ltoptions.m4'
> libtoolize:   `/usr/share/aclocal/ltversion.m4'
> libtoolize:   `/usr/share/aclocal/ltsugar.m4'
> libtoolize:   `/usr/share/aclocal/lt~obsolete.m4'
> libtoolize: Consider adding `AC_CONFIG_MACRO_DIR([m4])' to configure.ac
> and
> libtoolize: rerunning libtoolize, to keep the correct libtool macros
> in-tree.
> libtoolize: Consider adding `-I m4' to ACLOCAL_AMFLAGS in Makefile.am.
>
>
> then:
>
> aclocal
> autoheader
> automake --force-missing --add-missing
>
> first two go OK, but the third gives
>
> configure.ac: no proper invocation of
>  was found.
> configure.ac: You should verify that configure.ac invokes
> AM_INIT_AUTOMAKE,
> configure.ac: that aclocal.m4 is present in the top-level directory,
> configure.ac: and that aclocal.m4 was recently regenerated (using
> aclocal).
> automake: no `Makefile.am' found for any configure output
>
> then the following runs OK
> autoconf
>
> but running configure gives the same BLAS error.
>
> But I'm farily sure one shouldn't run to see what's wrong with BLAS,ratehr
> it's just the configure options not being read properly. The
> AM_INIT_AUTOMAKE
> issue definitely seems important.
>
> Is there anything I'm missing?
>
> Cheers and thanks in advance!
>
>
>
>

	[[alternative HTML version deleted]]


From petr.pikal at precheza.cz  Wed Aug  2 09:01:55 2017
From: petr.pikal at precheza.cz (PIKAL Petr)
Date: Wed, 2 Aug 2017 07:01:55 +0000
Subject: [Rd] symantec and R instalation info
Message-ID: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAA8A88@SRVEXCHCM301.precheza.cz>

Dear all

I am not sure if this is appropriate for the list, but I have recently found that Symantec blocks R devel from installation. Enclosed is copy of Symantec message.

Our IT installed it but I wont be probably alone with this problem.

> sessionInfo()
R Under development (unstable) (2017-07-31 r73003)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 14393)

Matrix products: default

locale:
[1] LC_COLLATE=Czech_Czech Republic.1250  LC_CTYPE=Czech_Czech Republic.1250
[3] LC_MONETARY=Czech_Czech Republic.1250 LC_NUMERIC=C
[5] LC_TIME=Czech_Czech Republic.1250

attached base packages:
[1] stats     datasets  utils     grDevices graphics  methods   base

other attached packages:
[1] lattice_0.20-35 fun_0.1

loaded via a namespace (and not attached):
[1] compiler_3.5.0 tools_3.5.0    nlme_3.1-131   grid_3.5.0

Best regards
Petr Pikal


________________________________
Tento e-mail a jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou ur?eny pouze jeho adres?t?m.
Jestli?e jste obdr?el(a) tento e-mail omylem, informujte laskav? neprodlen? jeho odes?latele. Obsah tohoto emailu i s p??lohami a jeho kopie vyma?te ze sv?ho syst?mu.
Nejste-li zam??len?m adres?tem tohoto emailu, nejste opr?vn?ni tento email jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu zp?sobenou modifikacemi ?i zpo?d?n?m p?enosu e-mailu.

V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
- vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o uzav?en? smlouvy, a to z jak?hokoliv d?vodu i bez uveden? d?vodu.
- a obsahuje-li nab?dku, je adres?t opr?vn?n nab?dku bezodkladn? p?ijmout; Odes?latel tohoto e-mailu (nab?dky) vylu?uje p?ijet? nab?dky ze strany p??jemce s dodatkem ?i odchylkou.
- trv? odes?latel na tom, ?e p??slu?n? smlouva je uzav?ena teprve v?slovn?m dosa?en?m shody na v?ech jej?ch n?le?itostech.
- odes?latel tohoto emailu informuje, ?e nen? opr?vn?n uzav?rat za spole?nost ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn? zmocn?n nebo p?semn? pov??en a takov? pov??en? nebo pln? moc byly adres?tovi tohoto emailu p??padn? osob?, kterou adres?t zastupuje, p?edlo?eny nebo jejich existence je adres?tovi ?i osob? j?m zastoupen? zn?m?.

This e-mail and any documents attached to it may be confidential and are intended only for its intended recipients.
If you received this e-mail by mistake, please immediately inform its sender. Delete the contents of this e-mail with all attachments and its copies from your system.
If you are not the intended recipient of this e-mail, you are not authorized to use, disseminate, copy or disclose this e-mail in any manner.
The sender of this e-mail shall not be liable for any possible damage caused by modifications of the e-mail or by delay with transfer of the email.

In case that this e-mail forms part of business dealings:
- the sender reserves the right to end negotiations about entering into a contract in any time, for any reason, and without stating any reasoning.
- if the e-mail contains an offer, the recipient is entitled to immediately accept such offer; The sender of this e-mail (offer) excludes any acceptance of the offer on the part of the recipient containing any amendment or variation.
- the sender insists on that the respective contract is concluded only upon an express mutual agreement on all its aspects.
- the sender of this e-mail informs that he/she is not authorized to enter into any contracts on behalf of the company except for cases in which he/she is expressly authorized to do so in writing, and such authorization or power of attorney is submitted to the recipient or the person represented by the recipient, or the existence of such authorization is known to the recipient of the person represented by the recipient.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: symantec.png
Type: image/png
Size: 77809 bytes
Desc: symantec.png
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20170802/9e79e795/attachment.png>

From maechler at stat.math.ethz.ch  Wed Aug  2 10:09:25 2017
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 2 Aug 2017 10:09:25 +0200
Subject: [Rd] symantec treating R-devel r73003 for Windows as malware
In-Reply-To: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAA8A88@SRVEXCHCM301.precheza.cz>
References: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAA8A88@SRVEXCHCM301.precheza.cz>
Message-ID: <22913.34997.686161.34289@stat.math.ethz.ch>

>>>>> PIKAL Petr <petr.pikal at precheza.cz>
>>>>>     on Wed, 2 Aug 2017 07:01:55 +0000 writes:

    > Dear all
    > I am not sure if this is appropriate for the list, but I have recently found that Symantec blocks R devel from installation. Enclosed is copy of Symantec message.

Thank you, Petr.   I do think it is quite appropriate for this list.

    > Our IT installed it but I wont be probably alone with this problem.

We will see...

    >> sessionInfo()
    > R Under development (unstable) (2017-07-31 r73003)
    > Platform: x86_64-w64-mingw32/x64 (64-bit)
    > Running under: Windows 10 x64 (build 14393)

    [..............]

I'm appending a (less compressed but notably correctly cropped)
version of the screen shot (also with a slightly more
descriptive name) because I needed several minutes before I
could correctly view your first attachment

What happens if you try "R 3.4.1-patched" for Windows?
I think they are built with the same tools... and that one is
much more important as closer to release.

Thank you (and others) for diagnosing and giving feedback on this.

Martin Maechler,
ETH Zurich


-------------- next part --------------
A non-text attachment was scrubbed...
Name: symantec_R-devel_r73003.png
Type: image/png
Size: 184353 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20170802/3fdb70cd/attachment.png>

From petr.pikal at precheza.cz  Wed Aug  2 11:46:39 2017
From: petr.pikal at precheza.cz (PIKAL Petr)
Date: Wed, 2 Aug 2017 09:46:39 +0000
Subject: [Rd] symantec treating R-devel r73003 for Windows as malware
In-Reply-To: <22913.34997.686161.34289@stat.math.ethz.ch>
References: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAA8A88@SRVEXCHCM301.precheza.cz>
 <22913.34997.686161.34289@stat.math.ethz.ch>
Message-ID: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAA8B37@SRVEXCHCM301.precheza.cz>

Hallo Martin

The result is the same. The R exe file is downloaded with some note about possible danger. When I try to run it, it is inspected and deleted from its location.

Symantec message is enclosed.

Our IT said it has something to do with installer type, but it is beyond my expertise.

Petr Pikal


> -----Original Message-----
> From: Martin Maechler [mailto:maechler at stat.math.ethz.ch]
> Sent: Wednesday, August 2, 2017 10:09 AM
> To: PIKAL Petr <petr.pikal at precheza.cz>
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] symantec treating R-devel r73003 for Windows as malware
>
> >>>>> PIKAL Petr <petr.pikal at precheza.cz>
> >>>>>     on Wed, 2 Aug 2017 07:01:55 +0000 writes:
>
>     > Dear all
>     > I am not sure if this is appropriate for the list, but I have recently found
> that Symantec blocks R devel from installation. Enclosed is copy of Symantec
> message.
>
> Thank you, Petr.   I do think it is quite appropriate for this list.
>
>     > Our IT installed it but I wont be probably alone with this problem.
>
> We will see...
>
>     >> sessionInfo()
>     > R Under development (unstable) (2017-07-31 r73003)
>     > Platform: x86_64-w64-mingw32/x64 (64-bit)
>     > Running under: Windows 10 x64 (build 14393)
>
>     [..............]
>
> I'm appending a (less compressed but notably correctly cropped) version of the
> screen shot (also with a slightly more descriptive name) because I needed
> several minutes before I could correctly view your first attachment
>
> What happens if you try "R 3.4.1-patched" for Windows?
> I think they are built with the same tools... and that one is much more
> important as closer to release.
>
> Thank you (and others) for diagnosing and giving feedback on this.
>
> Martin Maechler,
> ETH Zurich
>


________________________________
Tento e-mail a jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou ur?eny pouze jeho adres?t?m.
Jestli?e jste obdr?el(a) tento e-mail omylem, informujte laskav? neprodlen? jeho odes?latele. Obsah tohoto emailu i s p??lohami a jeho kopie vyma?te ze sv?ho syst?mu.
Nejste-li zam??len?m adres?tem tohoto emailu, nejste opr?vn?ni tento email jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu zp?sobenou modifikacemi ?i zpo?d?n?m p?enosu e-mailu.

V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
- vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o uzav?en? smlouvy, a to z jak?hokoliv d?vodu i bez uveden? d?vodu.
- a obsahuje-li nab?dku, je adres?t opr?vn?n nab?dku bezodkladn? p?ijmout; Odes?latel tohoto e-mailu (nab?dky) vylu?uje p?ijet? nab?dky ze strany p??jemce s dodatkem ?i odchylkou.
- trv? odes?latel na tom, ?e p??slu?n? smlouva je uzav?ena teprve v?slovn?m dosa?en?m shody na v?ech jej?ch n?le?itostech.
- odes?latel tohoto emailu informuje, ?e nen? opr?vn?n uzav?rat za spole?nost ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn? zmocn?n nebo p?semn? pov??en a takov? pov??en? nebo pln? moc byly adres?tovi tohoto emailu p??padn? osob?, kterou adres?t zastupuje, p?edlo?eny nebo jejich existence je adres?tovi ?i osob? j?m zastoupen? zn?m?.

This e-mail and any documents attached to it may be confidential and are intended only for its intended recipients.
If you received this e-mail by mistake, please immediately inform its sender. Delete the contents of this e-mail with all attachments and its copies from your system.
If you are not the intended recipient of this e-mail, you are not authorized to use, disseminate, copy or disclose this e-mail in any manner.
The sender of this e-mail shall not be liable for any possible damage caused by modifications of the e-mail or by delay with transfer of the email.

In case that this e-mail forms part of business dealings:
- the sender reserves the right to end negotiations about entering into a contract in any time, for any reason, and without stating any reasoning.
- if the e-mail contains an offer, the recipient is entitled to immediately accept such offer; The sender of this e-mail (offer) excludes any acceptance of the offer on the part of the recipient containing any amendment or variation.
- the sender insists on that the respective contract is concluded only upon an express mutual agreement on all its aspects.
- the sender of this e-mail informs that he/she is not authorized to enter into any contracts on behalf of the company except for cases in which he/she is expressly authorized to do so in writing, and such authorization or power of attorney is submitted to the recipient or the person represented by the recipient, or the existence of such authorization is known to the recipient of the person represented by the recipient.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: symantec_R3.4.1._patched.png
Type: image/png
Size: 78255 bytes
Desc: symantec_R3.4.1._patched.png
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20170802/0b451434/attachment.png>

From tomas.kalibera at gmail.com  Wed Aug  2 23:04:41 2017
From: tomas.kalibera at gmail.com (Tomas Kalibera)
Date: Wed, 2 Aug 2017 23:04:41 +0200
Subject: [Rd] symantec treating R-devel r73003 for Windows as malware
In-Reply-To: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAA8B37@SRVEXCHCM301.precheza.cz>
References: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAA8A88@SRVEXCHCM301.precheza.cz>
 <22913.34997.686161.34289@stat.math.ethz.ch>
 <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAA8B37@SRVEXCHCM301.precheza.cz>
Message-ID: <ba9b8148-8185-1b9b-feba-ae4bed0dffeb@gmail.com>

Hi Petr,

I can repeat this behavior (or similar) with Norton Security:

R-devel-win.exe is reported by Download Insight
R-3.4.1patched-win.exe is reported by Download Insight
R-3.4.1-win.exe is fine

And the report is that the binary is very new (released less than 1 week 
ago) and has very few users (less than 5 in "Norton Community"), which 
is not surprising given that these files are updated frequently. There 
is no other report/warning. With Norton Security, one has the option to 
allow execution of the file and to check "Always allow this file (if Run 
is chosen)".

Best
Tomas

On 08/02/2017 11:46 AM, PIKAL Petr wrote:
> Hallo Martin
>
> The result is the same. The R exe file is downloaded with some note about possible danger. When I try to run it, it is inspected and deleted from its location.
>
> Symantec message is enclosed.
>
> Our IT said it has something to do with installer type, but it is beyond my expertise.
>
> Petr Pikal
>
>
>> -----Original Message-----
>> From: Martin Maechler [mailto:maechler at stat.math.ethz.ch]
>> Sent: Wednesday, August 2, 2017 10:09 AM
>> To: PIKAL Petr <petr.pikal at precheza.cz>
>> Cc: r-devel at r-project.org
>> Subject: Re: [Rd] symantec treating R-devel r73003 for Windows as malware
>>
>>>>>>> PIKAL Petr <petr.pikal at precheza.cz>
>>>>>>>      on Wed, 2 Aug 2017 07:01:55 +0000 writes:
>>      > Dear all
>>      > I am not sure if this is appropriate for the list, but I have recently found
>> that Symantec blocks R devel from installation. Enclosed is copy of Symantec
>> message.
>>
>> Thank you, Petr.   I do think it is quite appropriate for this list.
>>
>>      > Our IT installed it but I wont be probably alone with this problem.
>>
>> We will see...
>>
>>      >> sessionInfo()
>>      > R Under development (unstable) (2017-07-31 r73003)
>>      > Platform: x86_64-w64-mingw32/x64 (64-bit)
>>      > Running under: Windows 10 x64 (build 14393)
>>
>>      [..............]
>>
>> I'm appending a (less compressed but notably correctly cropped) version of the
>> screen shot (also with a slightly more descriptive name) because I needed
>> several minutes before I could correctly view your first attachment
>>
>> What happens if you try "R 3.4.1-patched" for Windows?
>> I think they are built with the same tools... and that one is much more
>> important as closer to release.
>>
>> Thank you (and others) for diagnosing and giving feedback on this.
>>
>> Martin Maechler,
>> ETH Zurich
>>
>
> ________________________________
> Tento e-mail a jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou ur?eny pouze jeho adres?t?m.
> Jestli?e jste obdr?el(a) tento e-mail omylem, informujte laskav? neprodlen? jeho odes?latele. Obsah tohoto emailu i s p??lohami a jeho kopie vyma?te ze sv?ho syst?mu.
> Nejste-li zam??len?m adres?tem tohoto emailu, nejste opr?vn?ni tento email jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
> Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu zp?sobenou modifikacemi ?i zpo?d?n?m p?enosu e-mailu.
>
> V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
> - vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o uzav?en? smlouvy, a to z jak?hokoliv d?vodu i bez uveden? d?vodu.
> - a obsahuje-li nab?dku, je adres?t opr?vn?n nab?dku bezodkladn? p?ijmout; Odes?latel tohoto e-mailu (nab?dky) vylu?uje p?ijet? nab?dky ze strany p??jemce s dodatkem ?i odchylkou.
> - trv? odes?latel na tom, ?e p??slu?n? smlouva je uzav?ena teprve v?slovn?m dosa?en?m shody na v?ech jej?ch n?le?itostech.
> - odes?latel tohoto emailu informuje, ?e nen? opr?vn?n uzav?rat za spole?nost ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn? zmocn?n nebo p?semn? pov??en a takov? pov??en? nebo pln? moc byly adres?tovi tohoto emailu p??padn? osob?, kterou adres?t zastupuje, p?edlo?eny nebo jejich existence je adres?tovi ?i osob? j?m zastoupen? zn?m?.
>
> This e-mail and any documents attached to it may be confidential and are intended only for its intended recipients.
> If you received this e-mail by mistake, please immediately inform its sender. Delete the contents of this e-mail with all attachments and its copies from your system.
> If you are not the intended recipient of this e-mail, you are not authorized to use, disseminate, copy or disclose this e-mail in any manner.
> The sender of this e-mail shall not be liable for any possible damage caused by modifications of the e-mail or by delay with transfer of the email.
>
> In case that this e-mail forms part of business dealings:
> - the sender reserves the right to end negotiations about entering into a contract in any time, for any reason, and without stating any reasoning.
> - if the e-mail contains an offer, the recipient is entitled to immediately accept such offer; The sender of this e-mail (offer) excludes any acceptance of the offer on the part of the recipient containing any amendment or variation.
> - the sender insists on that the respective contract is concluded only upon an express mutual agreement on all its aspects.
> - the sender of this e-mail informs that he/she is not authorized to enter into any contracts on behalf of the company except for cases in which he/she is expressly authorized to do so in writing, and such authorization or power of attorney is submitted to the recipient or the person represented by the recipient, or the existence of such authorization is known to the recipient of the person represented by the recipient.
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



	[[alternative HTML version deleted]]


From berwin.turlach at gmail.com  Thu Aug  3 09:27:56 2017
From: berwin.turlach at gmail.com (Berwin A Turlach)
Date: Thu, 3 Aug 2017 15:27:56 +0800
Subject: [Rd] Problem compiling R patched and R devel on Ubuntu
Message-ID: <20170803152756.7477663d@ECM-DTC-716.uniwa.uwa.edu.au>

G'day all,

since about a week my daily re-compilations of R patched and R devel
are falling over, i.e. they stop with an error during "make
check" (while building the 32 bit architecture) on my Ubuntu 16.04.3
LTS machine.  Specifically, a test in graphics-Ex.R seems to fail and
the last lines of graphics-ex.Rout.fail are:

  > ## Extreme outliers; the "FD" rule would take very large number of
  'breaks': 
  > XXL <- c(1:9, c(-1,1)*1e300)
  > hh <- hist(XXL, "FD") # did not work in R <= 3.4.1; now gives
  warning 
  Warning in hist.default(XXL, "FD") :
    'breaks = 4.44796e+299' is too large and set to 1e9
  Error in pretty.default(range(x), n = breaks, min.n = 1) : 
    cannot allocate vector of length 1000000001
  Calls: hist -> hist.default -> pretty -> pretty.default
  Execution halted

My R 3.4.1 installation, the last R patched version that I could
compile (R version 3.4.1 Patched (2017-07-26 r72974)) and the last R
devel version that I could compile (R Under development (unstable)
(2017-07-26 r72974)) give the following results (under the 32bit
architecture and the 64bit architecture):

  > XXL <- c(1:9, c(-1,1)*1e300)
  > hh <- hist(XXL, "FD")
  Error in pretty.default(range(x), n = breaks, min.n = 1) : 
    invalid 'n' argument
  In addition: Warning message:
  In pretty.default(range(x), n = breaks, min.n = 1) :
    NAs introduced by coercion to integer range

Not sure if this is a general problem, or only a problem on my machine.

Cheers,

	Berwin


From maechler at stat.math.ethz.ch  Thu Aug  3 09:57:57 2017
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 3 Aug 2017 09:57:57 +0200
Subject: [Rd] Problem compiling R patched and R devel on Ubuntu
In-Reply-To: <20170803152756.7477663d@ECM-DTC-716.uniwa.uwa.edu.au>
References: <20170803152756.7477663d@ECM-DTC-716.uniwa.uwa.edu.au>
Message-ID: <22914.55173.781810.107937@stat.math.ethz.ch>

>>>>> Berwin A Turlach <berwin.turlach at gmail.com>
>>>>>     on Thu, 3 Aug 2017 15:27:56 +0800 writes:

    > G'day all,
    > since about a week my daily re-compilations of R patched and R devel
    > are falling over, i.e. they stop with an error during "make
    > check" (while building the 32 bit architecture) on my Ubuntu 16.04.3
    > LTS machine.
    
Dear Berwin,

thanks a lot for the report!

    >  Specifically, a test in graphics-Ex.R seems to fail and
    > the last lines of graphics-ex.Rout.fail are:

    >> ## Extreme outliers; the "FD" rule would take very large number of
    > 'breaks': 
    >> XXL <- c(1:9, c(-1,1)*1e300)
    >> hh <- hist(XXL, "FD") # did not work in R <= 3.4.1; now gives
    > warning 
    > Warning in hist.default(XXL, "FD") :
    > 'breaks = 4.44796e+299' is too large and set to 1e9
    > Error in pretty.default(range(x), n = breaks, min.n = 1) : 
    > cannot allocate vector of length 1000000001
    > Calls: hist -> hist.default -> pretty -> pretty.default
    > Execution halted

    > My R 3.4.1 installation, the last R patched version that I could
    > compile (R version 3.4.1 Patched (2017-07-26 r72974)) and the last R
    > devel version that I could compile (R Under development (unstable)
    > (2017-07-26 r72974)) 

  ((well, well ... you could also compile later versions.  It was
    "only"  'make check' that failed ..))

    > give the following results (under the 32bit architecture
    > and the 64bit architecture): 

    >> XXL <- c(1:9, c(-1,1)*1e300)
    >> hh <- hist(XXL, "FD")
    > Error in pretty.default(range(x), n = breaks, min.n = 1) : 
    > invalid 'n' argument
    > In addition: Warning message:
    > In pretty.default(range(x), n = breaks, min.n = 1) :
    > NAs introduced by coercion to integer range

  [yes, that was the bug; see below]

    > Not sure if this is a general problem, or only a problem on my machine.

It is not a problem on 64-bit I think.  This is related to the
bug and bugfix  for PR#17274 
   ( https://bugs.r-project.org/bugzilla/show_bug.cgi?id=17274 )
which I had handled.

Now I see the above, I can well imagine that I had made
assumptions that only worked on my (64-bit) platform.
I'll have a look and will amend the bug fix to also work on
"smaller" platforms - hopefully today.

Martin


From tianxu03 at gmail.com  Thu Aug  3 15:49:57 2017
From: tianxu03 at gmail.com (Victor Tian)
Date: Thu, 3 Aug 2017 09:49:57 -0400
Subject: [Rd] rnorm is not truly random used in the lm function
Message-ID: <CAHJErNB+dUqcPcG9XF3eL34mUrSOZ0pT6hTY3dFFmuZeUuAx5w@mail.gmail.com>

To whom it may concern,

I happened to run the following R code just to check the layout of the
output, but found that the code doesn't work the way I thought it should
work.

''
> lm(rnorm(100) ~ rnorm(100))

Call:
lm(formula = rnorm(100) ~ rnorm(100))

Coefficients:
(Intercept)
   -0.07966

Warning messages:
1: In model.matrix.default(mt, mf, contrasts) :
  the response appeared on the right-hand side and was dropped
2: In model.matrix.default(mt, mf, contrasts) :
  problem with term 1 in model.matrix: no columns are assigned
"

It appears that rnorm(100) produces the same array of numbers on both sides
of the ~ sign.

It can be further verified by having the same error message if we do x <-
rnorm(100) and lm(x ~ x).

I would expect the two rnorm(100) functions in the lm function return two
different arrays of numbers, but am open to hear reasons from the other
side.

Thanks,

-- 
*Xu Tian*

	[[alternative HTML version deleted]]


From maechler at stat.math.ethz.ch  Thu Aug  3 18:11:33 2017
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 3 Aug 2017 18:11:33 +0200
Subject: [Rd] rnorm is not truly random used in the lm function
In-Reply-To: <CAHJErNB+dUqcPcG9XF3eL34mUrSOZ0pT6hTY3dFFmuZeUuAx5w@mail.gmail.com>
References: <CAHJErNB+dUqcPcG9XF3eL34mUrSOZ0pT6hTY3dFFmuZeUuAx5w@mail.gmail.com>
Message-ID: <22915.19253.235214.514050@stat.math.ethz.ch>

>>>>> Victor Tian <tianxu03 at gmail.com>
>>>>>     on Thu, 3 Aug 2017 09:49:57 -0400 writes:

    > To whom it may concern,
    > I happened to run the following R code just to check the layout of the
    > output, but found that the code doesn't work the way I thought it should
    > work.

yes, your expectations were wrong.

    >> lm(rnorm(100) ~ rnorm(100))

    > Call:
    > lm(formula = rnorm(100) ~ rnorm(100))

    > Coefficients:
    > (Intercept)
    > -0.07966

    > Warning messages:
    > 1: In model.matrix.default(mt, mf, contrasts) :
    > the response appeared on the right-hand side and was dropped
    > 2: In model.matrix.default(mt, mf, contrasts) :
    > problem with term 1 in model.matrix: no columns are assigned


    > It appears that rnorm(100) produces the same array of numbers on both sides
    > of the ~ sign.

Indeed.  And all this has nothing to do with lm()  but rather with
how formulas in R have been treated probably "forever".
[I assume not only in R, but rather since the time formulas
 where introduced into the S language (for "S version 3") a few
 years before R was born. But I can no longer verify or disprove
 this assumption.] 

Even more revealing may be this:

> f <- rnorm(9) ~ rnorm(9)
> str(f)
Class 'formula'  language rnorm(9) ~ rnorm(9)
  ..- attr(*, ".Environment")=<environment: R_GlobalEnv> 
> (mm <- model.matrix(f))
  (Intercept)
1           1
2           1
3           1
4           1
5           1
6           1
7           1
8           1
9           1
attr(,"assign")
[1] 0
Warning messages:
1: In model.matrix.default(f) :
  the response appeared on the right-hand side and was dropped
2: In model.matrix.default(f) :
  problem with term 1 in model.matrix: no columns are assigned
> 
---------

BTW: One of the goals of formulas,  notably in R since they got an
environment attached, is a clean way to deal with non-standard
evaluation (=: NSE).
[ Some of us would claim it is the only clean way to deal with NSE in R,
  and all new functionality using NSE should use formulas,
  but recently tidyverse-scholars have claimed to be able to deal
  with it cleanly w/o the use of formulas, but via "tidy evaluation" ]

Using random expressions in a formula is therefore typically not
a good idea, because you don't realy know when the terms in the
formula will be evaluated.
For lm() and all other good formula-based statistical modeling
functions, the evaluation happens via model.matrix().

As you've noticed from that warning, model.matrix() tries to
help the user by checking terms and eliminating those that
appear on both sides of the '~'.
This has been documented on the help page [ ?model.matrix ] for
(almost exactly 14) years, the "Details:" section ending with

 _> By convention, if the response variable also appears on the
 _> right-hand side of the formula it is dropped (with a warning),
 _> although interactions involving the term are retained.


I hope this explains the issue.
And yes:  Do *not* use rnorm() in formulas.

Martin

--
Martin M?chler 
Seminar f?r Statistik, ETH Z?rich //  R Core Team


From tianxu03 at gmail.com  Thu Aug  3 18:33:41 2017
From: tianxu03 at gmail.com (Victor Tian)
Date: Thu, 3 Aug 2017 12:33:41 -0400
Subject: [Rd] rnorm is not truly random used in the lm function
In-Reply-To: <22915.19253.235214.514050@stat.math.ethz.ch>
References: <CAHJErNB+dUqcPcG9XF3eL34mUrSOZ0pT6hTY3dFFmuZeUuAx5w@mail.gmail.com>
 <22915.19253.235214.514050@stat.math.ethz.ch>
Message-ID: <CAHJErNB7x8n3e7D8QVm0Ai7_PL7Tw+pn9qkM0R6nm_SO0c+Byg@mail.gmail.com>

I did it purely based on the intuition I built from elsewhere and maybe in
R as well.

To summarise, it's basically a matter of evaluation ordering issue.

It looks like the model.matrix() function has a higher precedence over
rnorm(100), i.e., outside in rather than inside out in this specific case?
If the inner parts are evaluated first, as in most of the cases, the two
norm(100) expressions will no longer be the same.

I guess it's because they appear the same to model.matrix()? This would
raise another question, how does model.matrix() judges if two variables are
the same on both sides of the ~ sign? By the input literal?

Please clarify.

Thanks,
Victor


On Thu, Aug 3, 2017 at 12:11 PM, Martin Maechler <maechler at stat.math.ethz.ch
> wrote:

> >>>>> Victor Tian <tianxu03 at gmail.com>
> >>>>>     on Thu, 3 Aug 2017 09:49:57 -0400 writes:
>
>     > To whom it may concern,
>     > I happened to run the following R code just to check the layout of
> the
>     > output, but found that the code doesn't work the way I thought it
> should
>     > work.
>
> yes, your expectations were wrong.
>
>     >> lm(rnorm(100) ~ rnorm(100))
>
>     > Call:
>     > lm(formula = rnorm(100) ~ rnorm(100))
>
>     > Coefficients:
>     > (Intercept)
>     > -0.07966
>
>     > Warning messages:
>     > 1: In model.matrix.default(mt, mf, contrasts) :
>     > the response appeared on the right-hand side and was dropped
>     > 2: In model.matrix.default(mt, mf, contrasts) :
>     > problem with term 1 in model.matrix: no columns are assigned
>
>
>     > It appears that rnorm(100) produces the same array of numbers on
> both sides
>     > of the ~ sign.
>
> Indeed.  And all this has nothing to do with lm()  but rather with
> how formulas in R have been treated probably "forever".
> [I assume not only in R, but rather since the time formulas
>  where introduced into the S language (for "S version 3") a few
>  years before R was born. But I can no longer verify or disprove
>  this assumption.]
>
> Even more revealing may be this:
>
> > f <- rnorm(9) ~ rnorm(9)
> > str(f)
> Class 'formula'  language rnorm(9) ~ rnorm(9)
>   ..- attr(*, ".Environment")=<environment: R_GlobalEnv>
> > (mm <- model.matrix(f))
>   (Intercept)
> 1           1
> 2           1
> 3           1
> 4           1
> 5           1
> 6           1
> 7           1
> 8           1
> 9           1
> attr(,"assign")
> [1] 0
> Warning messages:
> 1: In model.matrix.default(f) :
>   the response appeared on the right-hand side and was dropped
> 2: In model.matrix.default(f) :
>   problem with term 1 in model.matrix: no columns are assigned
> >
> ---------
>
> BTW: One of the goals of formulas,  notably in R since they got an
> environment attached, is a clean way to deal with non-standard
> evaluation (=: NSE).
> [ Some of us would claim it is the only clean way to deal with NSE in R,
>   and all new functionality using NSE should use formulas,
>   but recently tidyverse-scholars have claimed to be able to deal
>   with it cleanly w/o the use of formulas, but via "tidy evaluation" ]
>
> Using random expressions in a formula is therefore typically not
> a good idea, because you don't realy know when the terms in the
> formula will be evaluated.
> For lm() and all other good formula-based statistical modeling
> functions, the evaluation happens via model.matrix().
>
> As you've noticed from that warning, model.matrix() tries to
> help the user by checking terms and eliminating those that
> appear on both sides of the '~'.
> This has been documented on the help page [ ?model.matrix ] for
> (almost exactly 14) years, the "Details:" section ending with
>
>  _> By convention, if the response variable also appears on the
>  _> right-hand side of the formula it is dropped (with a warning),
>  _> although interactions involving the term are retained.
>
>
> I hope this explains the issue.
> And yes:  Do *not* use rnorm() in formulas.
>
> Martin
>
> --
> Martin M?chler
> Seminar f?r Statistik, ETH Z?rich //  R Core Team
>



-- 
*Xu Tian*

	[[alternative HTML version deleted]]


From outthere at me.gregwerbin.com  Fri Aug  4 06:32:06 2017
From: outthere at me.gregwerbin.com (Gregory Werbin)
Date: Fri, 4 Aug 2017 00:32:06 -0400
Subject: [Rd] Why is as.function() slower than eval(call("function"())?
Message-ID: <808A59CA-5962-492B-9C48-481A3E42C9B5@me.gregwerbin.com>

(Apologies if this is better suited for R-help.)

On my system (macOS Sierra, late 2014 MacBook Pro; R 3.4.1, Homebrew build), I found that it is faster to construct a function using eval(call("function", ...)) than using as.function(list(...)). Example:

    make_fn_1 <- function(a, b) eval(call("function", a, b), env = parent.frame())
    make_fn_2 <- function(a, b) as.function(c(a, list(b)), env = parent.frame())

    a <- as.pairlist(alist(x = , y = ))
    b <- quote(x + y)

    library("microbenchmark")
    microbenchmark(make_fn_1(a, b), make_fn_2(a, b))

    # Unit: microseconds
    #             expr   min     lq    mean median     uq    max neval cld
    #  make_fn_1(a, b) 1.671 1.8855 2.13297  2.039 2.1950  9.852   100  a
    #  make_fn_2(a, b) 3.541 3.7230 4.13400  3.906 4.1055 23.153   100   b

At first I thought the gap was due to the overhead of calling c(a, list(b)). But this turns out not to be the case:

    make_fn_weird <- function(a, b) as.function(c(a, b), env = parent.frame())
    b_wrapped <- list(b)

    make_fn_weirder <- function(a_b) as.function(a_b, env = parent.frame())
    a_b <- c(a, b_wrapped)

    microbenchmark(make_fn_1(a, b), make_fn_2(a, b),
                   make_fn_weird(a, b_wrapped), make_fn_weirder(a_b))

    # Unit: microseconds
    #                         expr   min     lq    mean median     uq    max neval cld
    #              make_fn_1(a, b) 1.718 1.8990 2.12119 1.9860 2.1605  8.057   100 a
    #              make_fn_2(a, b) 3.393 3.5865 4.03029 3.6655 3.9615 27.499   100   c
    #  make_fn_weird(a, b_wrapped) 3.354 3.5005 3.77190 3.6405 3.9425  6.839   100   c
    #         make_fn_weirder(a_b) 2.488 2.6290 2.83352 2.7215 2.8800  7.007   100  b

One IRC user pointed out that as.function() takes its own path through the code, namely do_asfunction() (in src/main/coerce.c). What is it about this code path that's 50% slower than whatever happens during eval(call("function", a, b))?

Obviously this is a trivial micro-optimization and it doesn't matter to 99% of users. Mostly asking out of curiosity, but also wondering if there's a more general lesson to be learned here.

Thanks!

From josh.m.ulrich at gmail.com  Fri Aug  4 13:18:19 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Fri, 4 Aug 2017 06:18:19 -0500
Subject: [Rd] Why is as.function() slower than eval(call("function"())?
In-Reply-To: <808A59CA-5962-492B-9C48-481A3E42C9B5@me.gregwerbin.com>
References: <808A59CA-5962-492B-9C48-481A3E42C9B5@me.gregwerbin.com>
Message-ID: <CAPPM_gTzg7S__+Q0D1zpzLBjbiSbjFGdJM5nf50L5fOUtNm6AA@mail.gmail.com>

On Thu, Aug 3, 2017 at 11:32 PM, Gregory Werbin
<outthere at me.gregwerbin.com> wrote:
> (Apologies if this is better suited for R-help.)
>
> On my system (macOS Sierra, late 2014 MacBook Pro; R 3.4.1, Homebrew build), I found that it is faster to construct a function using eval(call("function", ...)) than using as.function(list(...)). Example:
>
>     make_fn_1 <- function(a, b) eval(call("function", a, b), env = parent.frame())
>     make_fn_2 <- function(a, b) as.function(c(a, list(b)), env = parent.frame())
>
>     a <- as.pairlist(alist(x = , y = ))
>     b <- quote(x + y)
>
>     library("microbenchmark")
>     microbenchmark(make_fn_1(a, b), make_fn_2(a, b))
>
>     # Unit: microseconds
>     #             expr   min     lq    mean median     uq    max neval cld
>     #  make_fn_1(a, b) 1.671 1.8855 2.13297  2.039 2.1950  9.852   100  a
>     #  make_fn_2(a, b) 3.541 3.7230 4.13400  3.906 4.1055 23.153   100   b
>
> At first I thought the gap was due to the overhead of calling c(a, list(b)). But this turns out not to be the case:
>
>     make_fn_weird <- function(a, b) as.function(c(a, b), env = parent.frame())
>     b_wrapped <- list(b)
>
>     make_fn_weirder <- function(a_b) as.function(a_b, env = parent.frame())
>     a_b <- c(a, b_wrapped)
>
>     microbenchmark(make_fn_1(a, b), make_fn_2(a, b),
>                    make_fn_weird(a, b_wrapped), make_fn_weirder(a_b))
>
>     # Unit: microseconds
>     #                         expr   min     lq    mean median     uq    max neval cld
>     #              make_fn_1(a, b) 1.718 1.8990 2.12119 1.9860 2.1605  8.057   100 a
>     #              make_fn_2(a, b) 3.393 3.5865 4.03029 3.6655 3.9615 27.499   100   c
>     #  make_fn_weird(a, b_wrapped) 3.354 3.5005 3.77190 3.6405 3.9425  6.839   100   c
>     #         make_fn_weirder(a_b) 2.488 2.6290 2.83352 2.7215 2.8800  7.007   100  b
>
> One IRC user pointed out that as.function() takes its own path through the code, namely do_asfunction() (in src/main/coerce.c). What is it about this code path that's 50% slower than whatever happens during eval(call("function", a, b))?
>
> Obviously this is a trivial micro-optimization and it doesn't matter to 99% of users. Mostly asking out of curiosity, but also wondering if there's a more general lesson to be learned here.
>
Agreed that this is minor (~2us), but the majority of the difference
seems to be from S3 method dispatch.  as.function() is generic and has
to dispatch to as.function.default().  The times are very similar if
you call the method directly.

R> make_fn_3 <- function(a, b) as.function.default(c(a, list(b)), env
= parent.frame())
R> microbenchmark(make_fn_1(a, b), make_fn_2(a, b), make_fn_3(a, b))
Unit: microseconds
            expr   min     lq     mean median    uq      max neval
 make_fn_1(a, b) 1.615 1.7595 12.78339 1.9115 2.145 1077.657   100
 make_fn_2(a, b) 3.077 3.3390 19.89423 3.5215 3.862 1589.505   100
 make_fn_3(a, b) 1.629 1.7975 15.40389 1.9505 2.227 1335.306   100

Now the difference is <100ns, which is much harder to investigate.

> Thanks!
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From murdoch.duncan at gmail.com  Fri Aug  4 13:21:00 2017
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 4 Aug 2017 07:21:00 -0400
Subject: [Rd] Why is as.function() slower than eval(call("function"())?
In-Reply-To: <808A59CA-5962-492B-9C48-481A3E42C9B5@me.gregwerbin.com>
References: <808A59CA-5962-492B-9C48-481A3E42C9B5@me.gregwerbin.com>
Message-ID: <b308770e-1b65-b587-7c9b-740b42b549c3@gmail.com>

On 04/08/2017 12:32 AM, Gregory Werbin wrote:
> (Apologies if this is better suited for R-help.)
>
> On my system (macOS Sierra, late 2014 MacBook Pro; R 3.4.1, Homebrew build), I found that it is faster to construct a function using eval(call("function", ...)) than using as.function(list(...)). Example:
>
>     make_fn_1 <- function(a, b) eval(call("function", a, b), env = parent.frame())
>     make_fn_2 <- function(a, b) as.function(c(a, list(b)), env = parent.frame())
>
>     a <- as.pairlist(alist(x = , y = ))
>     b <- quote(x + y)
>
>     library("microbenchmark")
>     microbenchmark(make_fn_1(a, b), make_fn_2(a, b))
>
>     # Unit: microseconds
>     #             expr   min     lq    mean median     uq    max neval cld
>     #  make_fn_1(a, b) 1.671 1.8855 2.13297  2.039 2.1950  9.852   100  a
>     #  make_fn_2(a, b) 3.541 3.7230 4.13400  3.906 4.1055 23.153   100   b
>
> At first I thought the gap was due to the overhead of calling c(a, list(b)). But this turns out not to be the case:
>
>     make_fn_weird <- function(a, b) as.function(c(a, b), env = parent.frame())
>     b_wrapped <- list(b)
>
>     make_fn_weirder <- function(a_b) as.function(a_b, env = parent.frame())
>     a_b <- c(a, b_wrapped)
>
>     microbenchmark(make_fn_1(a, b), make_fn_2(a, b),
>                    make_fn_weird(a, b_wrapped), make_fn_weirder(a_b))
>
>     # Unit: microseconds
>     #                         expr   min     lq    mean median     uq    max neval cld
>     #              make_fn_1(a, b) 1.718 1.8990 2.12119 1.9860 2.1605  8.057   100 a
>     #              make_fn_2(a, b) 3.393 3.5865 4.03029 3.6655 3.9615 27.499   100   c
>     #  make_fn_weird(a, b_wrapped) 3.354 3.5005 3.77190 3.6405 3.9425  6.839   100   c
>     #         make_fn_weirder(a_b) 2.488 2.6290 2.83352 2.7215 2.8800  7.007   100  b
>
> One IRC user pointed out that as.function() takes its own path through the code, namely do_asfunction() (in src/main/coerce.c). What is it about this code path that's 50% slower than whatever happens during eval(call("function", a, b))?
>
> Obviously this is a trivial micro-optimization and it doesn't matter to 99% of users. Mostly asking out of curiosity, but also wondering if there's a more general lesson to be learned here.

The main difference is that `function` is a primitive, while 
as.function() is a generic.  You will get much closer timing if you skip 
the method dispatch by calling as.function.default() directly.

The next part of the difference is that as.function.default is a regular 
R closure:

as.function.default <- function (x, envir = parent.frame(), ...)
if (is.function(x)) x else .Internal(as.function.default(x, envir))

If I skip the is.function(x) test and call .Internal directly, I find it 
is about 10% faster than `function`.  But that is an extremely risky 
optimization; it wouldn't be accepted in a CRAN package.

Duncan Murdoch


From brodie.gaslam at yahoo.com  Sat Aug  5 02:36:09 2017
From: brodie.gaslam at yahoo.com (brodie gaslam)
Date: Sat, 5 Aug 2017 00:36:09 +0000 (UTC)
Subject: [Rd] `c` with lists with "bytes" names encoding
References: <1567965498.24740.1501893369176.ref@mail.yahoo.com>
Message-ID: <1567965498.24740.1501893369176@mail.yahoo.com>

I'm not entirely sure this even qualifies as a bug given how unusual a case it is:
> x <- list('a')
> name.x <- '\x81'
> Encoding(name.x) <- 'bytes'
> names(x) <- name.x
> x
$`\\x81`[1] "a"> c(x)Error: translating strings with "bytes" encoding is not allowed
> unlist(x)
Error in unlist(x) : 
??translating strings with "bytes" encoding is not allowed> letters[name.x]
[1] NA
> letters[[name.x]]
Error: translating strings with "bytes" encoding is not allowed
Presumably the error is coming from `translateCharsUTF8` or similar.? I imagine the "fix" would be to not translate byte encoded names, or not allow them.

This is not really a problem for me as I can easily work around it.? Just an fyi in case it is of interest to you.

Best regards,

Brodie.
P.S.: SessionInfo():
R version 3.4.0 (2017-04-21)
Platform: x86_64-apple-darwin15.6.0 (64-bit)
Running under: macOS Sierra 10.12.6

Matrix products: default
BLAS: /Library/Frameworks/R.framework/Versions/3.4/Resources/lib/libRblas.0.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/3.4/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats???? graphics??grDevices utils???? datasets??methods?? base???? 

other attached packages:
[1] diffobj_0.1.6.9002??unitizer_1.4.2.9003

loaded via a namespace (and not attached):
[1] vetr_0.1.0.9000 compiler_3.4.0??tools_3.4.0???? withr_1.0.2????
[5] crayon_1.3.2????memoise_1.1.0?? digest_0.6.12?? devtools_1.12.0

	[[alternative HTML version deleted]]


From lawrence.michael at gene.com  Mon Aug  7 19:27:45 2017
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Mon, 7 Aug 2017 10:27:45 -0700
Subject: [Rd] Problems with S4 methods dispatching on `...` (aka
	dotsMethods)
In-Reply-To: <CAH7mKkjcYMgjQBWDYJ2QCaGz18EO+S9fi-EOqOUCopJwmRPLLg@mail.gmail.com>
References: <CAH7mKkiZNJ_W8EsbEvobHmj1wHDcE2NmYVTuPq8Uxc+aGC6YOw@mail.gmail.com>
 <CAOQ5Nye8nD0FK5vuuz83i+5nEOomezMZx0iDjJ6ZKWK9M4Xk_w@mail.gmail.com>
 <CAH7mKkgwa_7FRChyrxmKf8Ub_mDtX-WfREq-A4FbCvanQt8zpg@mail.gmail.com>
 <CAH7mKkgSFg8ki8sS4NXwrnv0m6hL4f_gePAK0SQnnhtGrvu88A@mail.gmail.com>
 <CAOQ5Nyf0C3AQ3HJhyqY-ZW8fPxFVU6eJ6vvyysS5a9DPR408iQ@mail.gmail.com>
 <CAH7mKkgTbdxpuiZz+V+zL-xCk6hQtSkj9UrmseDxzANqGEBkfQ@mail.gmail.com>
 <CAH7mKkg-aD4JF-H_6WKdifqpALHcdTLPCuAss+AvVB9138mZeQ@mail.gmail.com>
 <CAOQ5NyeUcKDvm-7TOL+aYUg4X+EPLzdxfs0e7hmnAcYAvFFDdA@mail.gmail.com>
 <CAH7mKkjcYMgjQBWDYJ2QCaGz18EO+S9fi-EOqOUCopJwmRPLLg@mail.gmail.com>
Message-ID: <CAOQ5Nyfj5ojSPAb9eKo2GDwUhEbMWCXUeqkbjQtLuqjpd-E62A@mail.gmail.com>

I ported that over.

On Tue, Aug 1, 2017 at 5:50 AM, Andrzej Ole? <andrzej.oles at gmail.com> wrote:

> Thank you Michael for updating the 3.4 branch, the `callNextMethod()` now
> works for `...` methods as expected. However, I'm still missing your other
> patch fixing the handling of arguments in `...` methods. It would be really
> great if this bugfix could be integrated into the 3.4 branch as well, such
> that the following code doesn't result in an error.
>
> Cheers,
> Andrzej
>
>
>     f = function(x, ..., a = b) {
>       b = "missing 'a'"
>       print(a)
>     }
>
>     f()
>     ## [1] missing 'a'
>
>     f(a = 1)
>     ## [1] 1
>
>     setGeneric("f", signature = "x")
>
>     # works as the non-generic version
>     f()
>     ## [1] missing 'a'
>
>     setGeneric("f", signature = "...")
>
>     # unexpectedly fails to find 'b'
>     f()
>     ## Error in print(a) : object 'b' not found
>
>
> On Fri, Jul 28, 2017 at 9:15 PM, Michael Lawrence <
> lawrence.michael at gene.com> wrote:
>
>> I pushed the patch to the 3.4 branch. Feel free to test.
>>
>> Michael
>>
>> On Wed, Jul 26, 2017 at 4:02 AM, Andrzej Ole? <andrzej.oles at gmail.com>
>> wrote:
>> > Hi Michael,
>> >
>> > it seems that your patch to S4 generics dispatching on `...` is still
>> > available only in R-devel, and was not included in the minor R-3.4.1
>> > release. I was wondering what is the policy of incorporating bug fixes
>> from
>> > the devel branch into release, and whether there is any chance that the
>> > broken `...` dispatch is fixed before R-3.5.0?
>> >
>> > Cheers,
>> > Andrzej
>> >
>> >
>> > On Tue, Apr 25, 2017 at 4:15 PM, Andrzej Ole? <andrzej.oles at gmail.com>
>> > wrote:
>> >>
>> >> You're right, I must have mixed up my R versions when running the
>> example,
>> >> as the problem seems to be resolved in R-devel.
>> >>
>> >> Sorry for the noise and thanks again for fixing this.
>> >>
>> >> Andrzej
>> >>
>> >> On Tue, Apr 25, 2017 at 3:55 PM, Michael Lawrence
>> >> <lawrence.michael at gene.com> wrote:
>> >>>
>> >>> I attempted to fix it, and that example seems to work for me. It's
>> >>> also a (passing) regression test in R. Are you sure you're using a new
>> >>> enough R-devel?
>> >>>
>> >>>
>> >>> On Tue, Apr 25, 2017 at 2:34 AM, Andrzej Ole? <andrzej.oles at gmail.com
>> >
>> >>> wrote:
>> >>> > Hi Michael,
>> >>> >
>> >>> > thanks again for your patch! I've tested it and I'm happy to confirm
>> >>> > that
>> >>> > `callNextMethod()` works with methods dispatching on `...`.
>> >>> >
>> >>> > However, the second issue I reported still seems to be unresolved.
>> >>> > Consider
>> >>> > the following toy example, where the `f()` calls differ in result
>> >>> > depending
>> >>> > on whether the dispatch happens on a formal argument or the `...`
>> >>> > argument.
>> >>> >
>> >>> >
>> >>> >     f = function(x, ..., a = b) {
>> >>> >       b = "missing 'a'"
>> >>> >       print(a)
>> >>> >     }
>> >>> >
>> >>> >     f()
>> >>> >     ## [1] missing 'a'
>> >>> >
>> >>> >     f(a = 1)
>> >>> >     ## [1] 1
>> >>> >
>> >>> >     setGeneric("f", signature = "x")
>> >>> >
>> >>> >     # works as the non-generic version
>> >>> >     f()
>> >>> >     ## [1] missing 'a'
>> >>> >
>> >>> >     setGeneric("f", signature = "...")
>> >>> >
>> >>> >     # unexpectedly fails to find 'b'
>> >>> >     f()
>> >>> >     ## Error in print(a) : object 'b' not found
>> >>> >
>> >>> >
>> >>> > Any chances of fixing this?
>> >>> >
>> >>> > Cheers,
>> >>> > Andrzej
>> >>> >
>> >>> >
>> >>> >
>> >>> > On Fri, Apr 21, 2017 at 11:40 AM, Andrzej Ole? <
>> andrzej.oles at gmail.com>
>> >>> > wrote:
>> >>> >>
>> >>> >> Great, thanks Michael for you quick response!
>> >>> >>
>> >>> >> I started off with a question on SO because I was not sure whether
>> >>> >> this
>> >>> >> was an actual bug or I was just missing something obvious. I'm
>> looking
>> >>> >> forward to the patch.
>> >>> >>
>> >>> >> Cheers,
>> >>> >> Andrzej
>> >>> >>
>> >>> >>
>> >>> >> On Thu, Apr 20, 2017 at 10:28 PM, Michael Lawrence
>> >>> >> <lawrence.michael at gene.com> wrote:
>> >>> >>>
>> >>> >>> Thanks for pointing out these issues. I have a fix that I will
>> commit
>> >>> >>> soon.
>> >>> >>>
>> >>> >>> Btw, I would never have seen the post on Stack Overflow. It's
>> best to
>> >>> >>> report bugs on the bugzilla.
>> >>> >>>
>> >>> >>> Michael
>> >>> >>>
>> >>> >>> On Thu, Apr 20, 2017 at 8:30 AM, Andrzej Ole?
>> >>> >>> <andrzej.oles at gmail.com>
>> >>> >>> wrote:
>> >>> >>> > Hi all,
>> >>> >>> >
>> >>> >>> > I recently encountered some unexpected behavior with S4 generics
>> >>> >>> > dispatching on `...`, which I described in
>> >>> >>> >
>> >>> >>> >
>> >>> >>> > http://stackoverflow.com/questions/43499203/use-callnextmeth
>> od-with-dotsmethods
>> >>> >>> >
>> >>> >>> > TL;DR: `callNextMethod()` doesn't work in methods dispatching on
>> >>> >>> > `...`,
>> >>> >>> > and
>> >>> >>> > arguments of such methods are resolved differently than the
>> >>> >>> > arguments
>> >>> >>> > of
>> >>> >>> > methods dispatching on formal arguments.
>> >>> >>> >
>> >>> >>> > Could this indicate a potential problem with the implementation
>> of
>> >>> >>> > the
>> >>> >>> > `...` dispatch?
>> >>> >>> >
>> >>> >>> > Cheers,
>> >>> >>> > Andrzej
>> >>> >>> >
>> >>> >>> >         [[alternative HTML version deleted]]
>> >>> >>> >
>> >>> >>> > ______________________________________________
>> >>> >>> > R-devel at r-project.org mailing list
>> >>> >>> > https://stat.ethz.ch/mailman/listinfo/r-devel
>> >>> >>
>> >>> >>
>> >>> >
>> >>
>> >>
>> >
>>
>
>

	[[alternative HTML version deleted]]


From wdunlap at tibco.com  Tue Aug  8 20:59:45 2017
From: wdunlap at tibco.com (William Dunlap)
Date: Tue, 8 Aug 2017 11:59:45 -0700
Subject: [Rd] arithmetic with zero-column data.frames
Message-ID: <CAF8bMcbJdWbfxHrk9hYaPn+O9pzeMByBfMAePoTPcDPS0wQH3Q@mail.gmail.com>

Should arithmetic operations work on zero-column data.frames (returning a
zero-column data.frame with the same number of rows as the data.frame
argument(s))?   Currently we get:

> 1 + data.frame(row.names=c("A","B"))
Error in data.frame(value, row.names = rn, check.names = FALSE, check.rows
= FALSE) :
  row names supplied are of the wrong length
> data.frame(row.names=c("A","B")) * 2
Error in data.frame(value, row.names = rn, check.names = FALSE, check.rows
= FALSE) :
  row names supplied are of the wrong length
> data.frame(row.names=c("A","B")) / data.frame(row.names=c("A","B"))
Error in data.frame(value, row.names = rn, check.names = FALSE, check.rows
= FALSE) :
  row names supplied are of the wrong length

Bill Dunlap
TIBCO Software
wdunlap tibco.com

	[[alternative HTML version deleted]]


From maechler at stat.math.ethz.ch  Wed Aug  9 10:45:56 2017
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 9 Aug 2017 10:45:56 +0200
Subject: [Rd] arithmetic with zero-column data.frames
In-Reply-To: <CAF8bMcbJdWbfxHrk9hYaPn+O9pzeMByBfMAePoTPcDPS0wQH3Q@mail.gmail.com>
References: <CAF8bMcbJdWbfxHrk9hYaPn+O9pzeMByBfMAePoTPcDPS0wQH3Q@mail.gmail.com>
Message-ID: <22922.52164.655834.544619@stat.math.ethz.ch>

>>>>> William Dunlap via R-devel <r-devel at r-project.org>
>>>>>     on Tue, 8 Aug 2017 11:59:45 -0700 writes:

    > Should arithmetic operations work on zero-column data.frames (returning a
    > zero-column data.frame with the same number of rows as the data.frame
    > argument(s))?   Currently we get:

    >> 1 + data.frame(row.names=c("A","B"))
    > Error in data.frame(value, row.names = rn, check.names = FALSE, check.rows
    > = FALSE) :
    > row names supplied are of the wrong length
    >> data.frame(row.names=c("A","B")) * 2
    > Error in data.frame(value, row.names = rn, check.names = FALSE, check.rows
    > = FALSE) :
    > row names supplied are of the wrong length
    >> data.frame(row.names=c("A","B")) / data.frame(row.names=c("A","B"))
    > Error in data.frame(value, row.names = rn, check.names = FALSE, check.rows
    > = FALSE) :
    > row names supplied are of the wrong length

    > Bill Dunlap
    > TIBCO Software
    > wdunlap tibco.com

Thank you, Bill.

Yes, indeed, as we have the   Ops.data.frame  and
Math.data.frame group methods  (about which I have not always
been so happy,  but they are inheritance from S),
and as the Math methods work too,  we should get this boundary
case working as well for the Ops.

Martin Maechler
ETH Zurich and R Core


From andrzej.oles at gmail.com  Tue Aug  8 23:37:00 2017
From: andrzej.oles at gmail.com (=?UTF-8?Q?Andrzej_Ole=C5=9B?=)
Date: Tue, 8 Aug 2017 23:37:00 +0200
Subject: [Rd] Problems with S4 methods dispatching on `...` (aka
	dotsMethods)
In-Reply-To: <CAOQ5Nyfj5ojSPAb9eKo2GDwUhEbMWCXUeqkbjQtLuqjpd-E62A@mail.gmail.com>
References: <CAH7mKkiZNJ_W8EsbEvobHmj1wHDcE2NmYVTuPq8Uxc+aGC6YOw@mail.gmail.com>
 <CAOQ5Nye8nD0FK5vuuz83i+5nEOomezMZx0iDjJ6ZKWK9M4Xk_w@mail.gmail.com>
 <CAH7mKkgwa_7FRChyrxmKf8Ub_mDtX-WfREq-A4FbCvanQt8zpg@mail.gmail.com>
 <CAH7mKkgSFg8ki8sS4NXwrnv0m6hL4f_gePAK0SQnnhtGrvu88A@mail.gmail.com>
 <CAOQ5Nyf0C3AQ3HJhyqY-ZW8fPxFVU6eJ6vvyysS5a9DPR408iQ@mail.gmail.com>
 <CAH7mKkgTbdxpuiZz+V+zL-xCk6hQtSkj9UrmseDxzANqGEBkfQ@mail.gmail.com>
 <CAH7mKkg-aD4JF-H_6WKdifqpALHcdTLPCuAss+AvVB9138mZeQ@mail.gmail.com>
 <CAOQ5NyeUcKDvm-7TOL+aYUg4X+EPLzdxfs0e7hmnAcYAvFFDdA@mail.gmail.com>
 <CAH7mKkjcYMgjQBWDYJ2QCaGz18EO+S9fi-EOqOUCopJwmRPLLg@mail.gmail.com>
 <CAOQ5Nyfj5ojSPAb9eKo2GDwUhEbMWCXUeqkbjQtLuqjpd-E62A@mail.gmail.com>
Message-ID: <CAH7mKkiqnnJfNNZNuima1zX9C6HO8CLOEdTjHk4J_fnO+PTCPw@mail.gmail.com>

Awesome, thank you Michael!

On Mon, Aug 7, 2017 at 7:27 PM, Michael Lawrence <lawrence.michael at gene.com>
wrote:

> I ported that over.
>
> On Tue, Aug 1, 2017 at 5:50 AM, Andrzej Ole? <andrzej.oles at gmail.com>
> wrote:
>
>> Thank you Michael for updating the 3.4 branch, the `callNextMethod()` now
>> works for `...` methods as expected. However, I'm still missing your other
>> patch fixing the handling of arguments in `...` methods. It would be really
>> great if this bugfix could be integrated into the 3.4 branch as well, such
>> that the following code doesn't result in an error.
>>
>> Cheers,
>> Andrzej
>>
>>
>>     f = function(x, ..., a = b) {
>>       b = "missing 'a'"
>>       print(a)
>>     }
>>
>>     f()
>>     ## [1] missing 'a'
>>
>>     f(a = 1)
>>     ## [1] 1
>>
>>     setGeneric("f", signature = "x")
>>
>>     # works as the non-generic version
>>     f()
>>     ## [1] missing 'a'
>>
>>     setGeneric("f", signature = "...")
>>
>>     # unexpectedly fails to find 'b'
>>     f()
>>     ## Error in print(a) : object 'b' not found
>>
>>
>> On Fri, Jul 28, 2017 at 9:15 PM, Michael Lawrence <
>> lawrence.michael at gene.com> wrote:
>>
>>> I pushed the patch to the 3.4 branch. Feel free to test.
>>>
>>> Michael
>>>
>>> On Wed, Jul 26, 2017 at 4:02 AM, Andrzej Ole? <andrzej.oles at gmail.com>
>>> wrote:
>>> > Hi Michael,
>>> >
>>> > it seems that your patch to S4 generics dispatching on `...` is still
>>> > available only in R-devel, and was not included in the minor R-3.4.1
>>> > release. I was wondering what is the policy of incorporating bug fixes
>>> from
>>> > the devel branch into release, and whether there is any chance that the
>>> > broken `...` dispatch is fixed before R-3.5.0?
>>> >
>>> > Cheers,
>>> > Andrzej
>>> >
>>> >
>>> > On Tue, Apr 25, 2017 at 4:15 PM, Andrzej Ole? <andrzej.oles at gmail.com>
>>> > wrote:
>>> >>
>>> >> You're right, I must have mixed up my R versions when running the
>>> example,
>>> >> as the problem seems to be resolved in R-devel.
>>> >>
>>> >> Sorry for the noise and thanks again for fixing this.
>>> >>
>>> >> Andrzej
>>> >>
>>> >> On Tue, Apr 25, 2017 at 3:55 PM, Michael Lawrence
>>> >> <lawrence.michael at gene.com> wrote:
>>> >>>
>>> >>> I attempted to fix it, and that example seems to work for me. It's
>>> >>> also a (passing) regression test in R. Are you sure you're using a
>>> new
>>> >>> enough R-devel?
>>> >>>
>>> >>>
>>> >>> On Tue, Apr 25, 2017 at 2:34 AM, Andrzej Ole? <
>>> andrzej.oles at gmail.com>
>>> >>> wrote:
>>> >>> > Hi Michael,
>>> >>> >
>>> >>> > thanks again for your patch! I've tested it and I'm happy to
>>> confirm
>>> >>> > that
>>> >>> > `callNextMethod()` works with methods dispatching on `...`.
>>> >>> >
>>> >>> > However, the second issue I reported still seems to be unresolved.
>>> >>> > Consider
>>> >>> > the following toy example, where the `f()` calls differ in result
>>> >>> > depending
>>> >>> > on whether the dispatch happens on a formal argument or the `...`
>>> >>> > argument.
>>> >>> >
>>> >>> >
>>> >>> >     f = function(x, ..., a = b) {
>>> >>> >       b = "missing 'a'"
>>> >>> >       print(a)
>>> >>> >     }
>>> >>> >
>>> >>> >     f()
>>> >>> >     ## [1] missing 'a'
>>> >>> >
>>> >>> >     f(a = 1)
>>> >>> >     ## [1] 1
>>> >>> >
>>> >>> >     setGeneric("f", signature = "x")
>>> >>> >
>>> >>> >     # works as the non-generic version
>>> >>> >     f()
>>> >>> >     ## [1] missing 'a'
>>> >>> >
>>> >>> >     setGeneric("f", signature = "...")
>>> >>> >
>>> >>> >     # unexpectedly fails to find 'b'
>>> >>> >     f()
>>> >>> >     ## Error in print(a) : object 'b' not found
>>> >>> >
>>> >>> >
>>> >>> > Any chances of fixing this?
>>> >>> >
>>> >>> > Cheers,
>>> >>> > Andrzej
>>> >>> >
>>> >>> >
>>> >>> >
>>> >>> > On Fri, Apr 21, 2017 at 11:40 AM, Andrzej Ole? <
>>> andrzej.oles at gmail.com>
>>> >>> > wrote:
>>> >>> >>
>>> >>> >> Great, thanks Michael for you quick response!
>>> >>> >>
>>> >>> >> I started off with a question on SO because I was not sure whether
>>> >>> >> this
>>> >>> >> was an actual bug or I was just missing something obvious. I'm
>>> looking
>>> >>> >> forward to the patch.
>>> >>> >>
>>> >>> >> Cheers,
>>> >>> >> Andrzej
>>> >>> >>
>>> >>> >>
>>> >>> >> On Thu, Apr 20, 2017 at 10:28 PM, Michael Lawrence
>>> >>> >> <lawrence.michael at gene.com> wrote:
>>> >>> >>>
>>> >>> >>> Thanks for pointing out these issues. I have a fix that I will
>>> commit
>>> >>> >>> soon.
>>> >>> >>>
>>> >>> >>> Btw, I would never have seen the post on Stack Overflow. It's
>>> best to
>>> >>> >>> report bugs on the bugzilla.
>>> >>> >>>
>>> >>> >>> Michael
>>> >>> >>>
>>> >>> >>> On Thu, Apr 20, 2017 at 8:30 AM, Andrzej Ole?
>>> >>> >>> <andrzej.oles at gmail.com>
>>> >>> >>> wrote:
>>> >>> >>> > Hi all,
>>> >>> >>> >
>>> >>> >>> > I recently encountered some unexpected behavior with S4
>>> generics
>>> >>> >>> > dispatching on `...`, which I described in
>>> >>> >>> >
>>> >>> >>> >
>>> >>> >>> > http://stackoverflow.com/questions/43499203/use-callnextmeth
>>> od-with-dotsmethods
>>> >>> >>> >
>>> >>> >>> > TL;DR: `callNextMethod()` doesn't work in methods dispatching
>>> on
>>> >>> >>> > `...`,
>>> >>> >>> > and
>>> >>> >>> > arguments of such methods are resolved differently than the
>>> >>> >>> > arguments
>>> >>> >>> > of
>>> >>> >>> > methods dispatching on formal arguments.
>>> >>> >>> >
>>> >>> >>> > Could this indicate a potential problem with the
>>> implementation of
>>> >>> >>> > the
>>> >>> >>> > `...` dispatch?
>>> >>> >>> >
>>> >>> >>> > Cheers,
>>> >>> >>> > Andrzej
>>> >>> >>> >
>>> >>> >>> >         [[alternative HTML version deleted]]
>>> >>> >>> >
>>> >>> >>> > ______________________________________________
>>> >>> >>> > R-devel at r-project.org mailing list
>>> >>> >>> > https://stat.ethz.ch/mailman/listinfo/r-devel
>>> >>> >>
>>> >>> >>
>>> >>> >
>>> >>
>>> >>
>>> >
>>>
>>
>>
>

	[[alternative HTML version deleted]]


From maechler at stat.math.ethz.ch  Wed Aug  9 12:39:26 2017
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 9 Aug 2017 12:39:26 +0200
Subject: [Rd] arithmetic with zero-column data.frames
In-Reply-To: <22922.52164.655834.544619@stat.math.ethz.ch>
References: <CAF8bMcbJdWbfxHrk9hYaPn+O9pzeMByBfMAePoTPcDPS0wQH3Q@mail.gmail.com>
 <22922.52164.655834.544619@stat.math.ethz.ch>
Message-ID: <22922.58974.921059.698005@stat.math.ethz.ch>

So as often there is more to it than you first think.
Let's consider this an RFC (for experienced long time R users) :

>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Wed, 9 Aug 2017 10:45:56 +0200 writes:

>>>>> William Dunlap via R-devel <r-devel at r-project.org>
>>>>>     on Tue, 8 Aug 2017 11:59:45 -0700 writes:

    >> Should arithmetic operations work on zero-column data.frames (returning a
    >> zero-column data.frame with the same number of rows as the data.frame
    >> argument(s))?   Currently we get:

    >>> 1 + data.frame(row.names=c("A","B"))
    >> Error in data.frame(value, row.names = rn, check.names = FALSE, check.rows
    >> = FALSE) :
    >> row names supplied are of the wrong length
    >>> data.frame(row.names=c("A","B")) * 2
    >> Error in data.frame(value, row.names = rn, check.names = FALSE, check.rows
    >> = FALSE) :
    >> row names supplied are of the wrong length
    >>> data.frame(row.names=c("A","B")) / data.frame(row.names=c("A","B"))
    >> Error in data.frame(value, row.names = rn, check.names = FALSE, check.rows
    >> = FALSE) :
    >> row names supplied are of the wrong length

    >> Bill Dunlap
    >> TIBCO Software
    >> wdunlap tibco.com

    > Thank you, Bill.

    > Yes, indeed, as we have the   Ops.data.frame  and
    > Math.data.frame group methods  (about which I have not always
    > been so happy,  but they are inheritance from S),
    > and as the Math methods work too,  we should get this boundary
    > case working as well for the Ops.

Hmm..  This time, I'd be glad for comments, notably from you, Bill:

In looking at this, I notice that "^" is treated
exceptionally, possibly not on purpose, i.e., accidentally. E.g.,
USArrests ^ 2    returns a matrix  where all other arithmetic
Ops give a data frame.

All non-arithmetic Ops do give a matrix [also not documentedly, AFAICS].
and currently "^"  is treated like them.

Note that Math.data.frame always returns a data frame (when it
does return), so we currently have this ugly inconsistency:

> str(USArrests ^ 0.5)
 num [1:50, 1:4] 3.63 3.16 2.85 2.97 3 ...
 - attr(*, "dimnames")=List of 2
  ..$ : chr [1:50] "Alabama" "Alaska" "Arizona" "Arkansas" ...
  ..$ : chr [1:4] "Murder" "Assault" "UrbanPop" "Rape"
> str(sqrt(USArrests))
'data.frame':	50 obs. of  4 variables:
 $ Murder  : num  3.63 3.16 2.85 2.97 3 ...
 $ Assault : num  15.4 16.2 17.1 13.8 16.6 ...
 $ UrbanPop: num  7.62 6.93 8.94 7.07 9.54 ...
 $ Rape    : num  4.6 6.67 5.57 4.42 6.37 ...
> 

I propose to add "^" to the other arithmetic ops which return a
data frame.  So in the above,  '^ 0.5' would give the same [upto
lowest bit rounding error] as sqrt().

- -- - -- - --

A further inconsistency is that the Math methods directly refuse
to work on a data frame with non-numeric variables, whereas the
Ops methods just go along and give warnings and NA's:

> sqrt(CO2)
Error in Math.data.frame(CO2) : 
  non-numeric variable in data frame: PlantTypeTreatment

> str( CO2 ^ 0.5 )
 num [1:84, 1:5] NA NA NA NA NA NA NA NA NA NA ...
 - attr(*, "dimnames")=List of 2
  ..$ : chr [1:84] "1" "2" "3" "4" ...
  ..$ : chr [1:5] "Plant" "Type" "Treatment" "conc" ...
Warning messages:
1: In Ops.ordered(left, right) : '^' is not meaningful for ordered factors
2: In Ops.factor(left, right) : ?^? not meaningful for factors
3: In Ops.factor(left, right) : ?^? not meaningful for factors
> 

One "clean" radical solution here would be for the  Ops method
to also directly give an error as the Math one.
But that may be undesirable.
Assume people have data frame variables of classes where an Ops method is
defined for it.  Then  the corresponding "op" is applied
everywhere and the result maybe useful and as desired.

So, I'm much less sure what's desireable here.
Should we just document the behavior of this latter inconsistency?




Martin Maechler
ETH Zurich and R Core


From tomas.kalibera at gmail.com  Fri Aug 11 11:46:03 2017
From: tomas.kalibera at gmail.com (Tomas Kalibera)
Date: Fri, 11 Aug 2017 11:46:03 +0200
Subject: [Rd] attributes on symbols
In-Reply-To: <alpine.DEB.2.20.1707071505480.9494@achilles>
References: <CAF8bMcY0Sq9qf-24VKQe3BV+fi4KnLppbU221dXZkkS1_862vQ@mail.gmail.com>
 <alpine.DEB.2.20.1707071505480.9494@achilles>
Message-ID: <23769078-aab1-c80b-2560-12fb49f34e9f@gmail.com>


Thanks for spotting this issue. The short answer is yes, adding 
attributes to a symbol is a bad idea and will be turned into a runtime 
error soon. Maintainers of packages that add attributes to symbols have 
been notified and some have already fixed their code.

At least in one case the package is not working properly, even in 
isolation, because of the global effect of adding an attribute to a 
symbol. Think about an expression "x - x", adding sign 1 to the "first 
x" and then sign -1 to the "second x" ends up with (both) "x" having 
sign "-1", because it is the same "x". The package would need something 
like a symbol, but passed by value (suggestions below).

By design in R symbols are represented by singleton objects registered 
in a global symbol table. Symbols are passed by reference and are fully 
represented by their name or pointer, so they can be quickly compared by 
pointer comparison and they can be used for bindings (naming variables, 
functions). Symbols thus cannot have attributes attached and must be 
treated as immutable. For this reason also attributes on symbols are not 
preserved on serialization (as Radford pointed out).

In some cases one needs to add an attribute to something similar to a 
symbol, but something passed by value. There are multiple ways to do it 
(credits for suggestions to Peter, Michael and others):

- wrap a symbol into an object passed by value, add an attribute to that 
object; such an object can be a list, an S3 or S4 object, an expression, 
etc; in "x - x", there will be two different wrappers of "x"

- encapsulate a symbol and needed meta-data (what would be in the 
attribute) together into an object passed by value, e.g. into S3/S4 
object or a list; in "x - x", there will again be two different objects 
encapsulating "x"

- store the meta-data (what would be in the attribute) in a user 
environment created by new.env(); the meta-data could be conveniently 
looked up by the symbol and the environment can be hashed for fast 
lookup; from Peter:
> attrib <- new.env()
> attributes(sym) ----> attrib$sym
> attr(sym, "foo") ----> attrib$sym[["foo"]]
(the last suggestion will not work for the example "x-x", but may work 
for other where referential semantics is needed, but now in a well 
defined scope)


Best,
Tomas


On 07/07/2017 03:06 PM, Torsten Hothorn wrote:
>
> Here is a simpler example:
>
>> ex <- as.name("a")
>> attr(ex, "test") <- 1
>> quote(a)
> a
> attr(,"test")
> [1] 1
>
> Torsten
>
> On Thu, 6 Jul 2017, William Dunlap wrote:
>
>> The multcomp package has code in multcomp:::expression2coef that 
>> attaches the 'coef' attribute to
>> symbols.  Since there is only one symbol object in a session with a 
>> given name, this means that
>> this attaching has a global effect.  Should this be quietly allowed 
>> or should there be a warning or
>> an error?
>> E.g.,
>>
>> str(quote(Education))
>> # symbol Education
>> lmod <- stats::lm(Fertility ~ ., data = datasets::swiss)
>> glmod <- multcomp::glht(lmod, c("Agriculture=0", "Education=0"))
>> str(quote(Education))
>> # symbol Education
>> # - attr(*, "coef")= num 1
>>
>> Bill Dunlap
>> TIBCO Software
>> wdunlap tibco.com
>>
>>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From lionel at rstudio.com  Fri Aug 11 12:00:40 2017
From: lionel at rstudio.com (Lionel Henry)
Date: Fri, 11 Aug 2017 12:00:40 +0200
Subject: [Rd] attributes on symbols
In-Reply-To: <23769078-aab1-c80b-2560-12fb49f34e9f@gmail.com>
References: <CAF8bMcY0Sq9qf-24VKQe3BV+fi4KnLppbU221dXZkkS1_862vQ@mail.gmail.com>
 <alpine.DEB.2.20.1707071505480.9494@achilles>
 <23769078-aab1-c80b-2560-12fb49f34e9f@gmail.com>
Message-ID: <810F0FEA-E599-4022-AE46-E7D1F69C0192@rstudio.com>

It's probably better to make it a runtime error, but note that it's
not necessarily a bad idea to add attributes to singleton symbols.
Those are used in Emacs Lisp for a variety of purposes. They just need
strong conventions (part of that is that in Emacs many symbols are
prefixed with a "namespace" identifier).

https://www.gnu.org/software/emacs/manual/html_node/elisp/Symbol-Properties.html

Lionel


> On 11 ao?t 2017, at 11:46, Tomas Kalibera <tomas.kalibera at gmail.com> wrote:
> 
> 
> Thanks for spotting this issue. The short answer is yes, adding attributes to a symbol is a bad idea and will be turned into a runtime error soon. Maintainers of packages that add attributes to symbols have been notified and some have already fixed their code.
> 
> At least in one case the package is not working properly, even in isolation, because of the global effect of adding an attribute to a symbol. Think about an expression "x - x", adding sign 1 to the "first x" and then sign -1 to the "second x" ends up with (both) "x" having sign "-1", because it is the same "x". The package would need something like a symbol, but passed by value (suggestions below).
> 
> By design in R symbols are represented by singleton objects registered in a global symbol table. Symbols are passed by reference and are fully represented by their name or pointer, so they can be quickly compared by pointer comparison and they can be used for bindings (naming variables, functions). Symbols thus cannot have attributes attached and must be treated as immutable. For this reason also attributes on symbols are not preserved on serialization (as Radford pointed out).
> 
> In some cases one needs to add an attribute to something similar to a symbol, but something passed by value. There are multiple ways to do it (credits for suggestions to Peter, Michael and others):
> 
> - wrap a symbol into an object passed by value, add an attribute to that object; such an object can be a list, an S3 or S4 object, an expression, etc; in "x - x", there will be two different wrappers of "x"
> 
> - encapsulate a symbol and needed meta-data (what would be in the attribute) together into an object passed by value, e.g. into S3/S4 object or a list; in "x - x", there will again be two different objects encapsulating "x"
> 
> - store the meta-data (what would be in the attribute) in a user environment created by new.env(); the meta-data could be conveniently looked up by the symbol and the environment can be hashed for fast lookup; from Peter:
>> attrib <- new.env()
>> attributes(sym) ----> attrib$sym
>> attr(sym, "foo") ----> attrib$sym[["foo"]]
> (the last suggestion will not work for the example "x-x", but may work for other where referential semantics is needed, but now in a well defined scope)
> 
> 
> Best,
> Tomas
> 
> 
> On 07/07/2017 03:06 PM, Torsten Hothorn wrote:
>> 
>> Here is a simpler example:
>> 
>>> ex <- as.name("a")
>>> attr(ex, "test") <- 1
>>> quote(a)
>> a
>> attr(,"test")
>> [1] 1
>> 
>> Torsten
>> 
>> On Thu, 6 Jul 2017, William Dunlap wrote:
>> 
>>> The multcomp package has code in multcomp:::expression2coef that attaches the 'coef' attribute to
>>> symbols.  Since there is only one symbol object in a session with a given name, this means that
>>> this attaching has a global effect.  Should this be quietly allowed or should there be a warning or
>>> an error?
>>> E.g.,
>>> 
>>> str(quote(Education))
>>> # symbol Education
>>> lmod <- stats::lm(Fertility ~ ., data = datasets::swiss)
>>> glmod <- multcomp::glht(lmod, c("Agriculture=0", "Education=0"))
>>> str(quote(Education))
>>> # symbol Education
>>> # - attr(*, "coef")= num 1
>>> 
>>> Bill Dunlap
>>> TIBCO Software
>>> wdunlap tibco.com
>>> 
>>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From selivanov.dmitriy at gmail.com  Fri Aug 11 15:33:31 2017
From: selivanov.dmitriy at gmail.com (Dmitriy Selivanov)
Date: Fri, 11 Aug 2017 17:33:31 +0400
Subject: [Rd] Help to create bugzilla account
Message-ID: <CAJdZCv3oUhwiqJUTwKy0ZvwkcB=qdA5WcBdfMsdAcJED9f356w@mail.gmail.com>

Hi mailing list and R-core. Could someone from R-core please help me to
create account in bugzilla? I would like to submit issue related to gc() to
wishlist.

Related context is here -
https://stat.ethz.ch/pipermail/r-devel/2017-July/074715.html


-- 
Regards
Dmitriy Selivanov

	[[alternative HTML version deleted]]


From maechler at stat.math.ethz.ch  Fri Aug 11 16:00:56 2017
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 11 Aug 2017 16:00:56 +0200
Subject: [Rd] Help to create bugzilla account
In-Reply-To: <CAJdZCv3oUhwiqJUTwKy0ZvwkcB=qdA5WcBdfMsdAcJED9f356w@mail.gmail.com>
References: <CAJdZCv3oUhwiqJUTwKy0ZvwkcB=qdA5WcBdfMsdAcJED9f356w@mail.gmail.com>
Message-ID: <22925.47256.496267.20679@stat.math.ethz.ch>

>>>>> Dmitriy Selivanov <selivanov.dmitriy at gmail.com>
>>>>>     on Fri, 11 Aug 2017 17:33:31 +0400 writes:

    > Hi mailing list and R-core. Could someone from R-core please help me to
    > create account in bugzilla? I would like to submit issue related to gc() to
    > wishlist.

I will create one.

Your previous e-mails left me pretty clueless about what the
problem is that you want to solve ... but maybe others
understand better what you mean.

Note that in the case of such a relatively sophisticated wish
without a clear sign of a problem (in my view)
chances are not high that anything will change, unless someone
provides a (small footprint) patch towards the (R-devel aka
"trunk") sources *and* reproducible R code that depicts the
problem.

Still: Thank you for trying to make R better by contributing with
careful bug reports !

Best,
Martin


    > Related context is here -
    > https://stat.ethz.ch/pipermail/r-devel/2017-July/074715.html


    > -- 
    > Regards
    > Dmitriy Selivanov

    > [[alternative HTML version deleted]]

    > ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel


From selivanov.dmitriy at gmail.com  Fri Aug 11 16:28:49 2017
From: selivanov.dmitriy at gmail.com (Dmitriy Selivanov)
Date: Fri, 11 Aug 2017 18:28:49 +0400
Subject: [Rd] Help to create bugzilla account
In-Reply-To: <22925.47256.496267.20679@stat.math.ethz.ch>
References: <CAJdZCv3oUhwiqJUTwKy0ZvwkcB=qdA5WcBdfMsdAcJED9f356w@mail.gmail.com>
 <22925.47256.496267.20679@stat.math.ethz.ch>
Message-ID: <CAJdZCv1WtaHP-EZy6sEA5BCKzdOu0h1ntF=RsNmiiQMMsxV2NA@mail.gmail.com>

Thanks Martin, I've received invitation and will create ticket soon.

Regarding issue - basically the problem is that on operating systems which
use glibc memory is not freed (R releases it, but system doesn't trim it).
Setting corresponding environment variable (MALLOC_TRIM_THRESHOLD_) doesn't
help, but manual call to `*malloc_trim*` does.
Implication is following - for long-running jobs linux OOM killer can kill
R process because highly-fragmented pieces of memory never returned back to
OS. Very simple example:

   1. I have 2gb of RAM on the machine.
   2. I create large list of small objects which occupies 1.5 gig.
   3. I remove it (even can manually call gc()) - "top" still shows 1.5 gig
   occupied. If I decide to recreate similar 1.5gig list - ram will be reused.
   4. However if after removal of the list I will decide to create normal
   continuous  integer/double vector of size 500+ mb - R will report that it
   can't allocate vector of such size.

Hope this helped.

2017-08-11 18:00 GMT+04:00 Martin Maechler <maechler at stat.math.ethz.ch>:

> >>>>> Dmitriy Selivanov <selivanov.dmitriy at gmail.com>
> >>>>>     on Fri, 11 Aug 2017 17:33:31 +0400 writes:
>
>     > Hi mailing list and R-core. Could someone from R-core please help me
> to
>     > create account in bugzilla? I would like to submit issue related to
> gc() to
>     > wishlist.
>
> I will create one.
>
> Your previous e-mails left me pretty clueless about what the
> problem is that you want to solve ... but maybe others
> understand better what you mean.
>
> Note that in the case of such a relatively sophisticated wish
> without a clear sign of a problem (in my view)
> chances are not high that anything will change, unless someone
> provides a (small footprint) patch towards the (R-devel aka
> "trunk") sources *and* reproducible R code that depicts the
> problem.
>
> Still: Thank you for trying to make R better by contributing with
> careful bug reports !
>
> Best,
> Martin
>
>
>     > Related context is here -
>     > https://stat.ethz.ch/pipermail/r-devel/2017-July/074715.html
>
>
>     > --
>     > Regards
>     > Dmitriy Selivanov
>
>     > [[alternative HTML version deleted]]
>
>     > ______________________________________________
>     > R-devel at r-project.org mailing list
>     > https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Regards
Dmitriy Selivanov

	[[alternative HTML version deleted]]


From i.ucar86 at gmail.com  Fri Aug 11 18:57:03 2017
From: i.ucar86 at gmail.com (=?UTF-8?B?ScOxYWtpIMOaY2Fy?=)
Date: Fri, 11 Aug 2017 18:57:03 +0200
Subject: [Rd] Help to create bugzilla account
In-Reply-To: <22925.47256.496267.20679@stat.math.ethz.ch>
References: <CAJdZCv3oUhwiqJUTwKy0ZvwkcB=qdA5WcBdfMsdAcJED9f356w@mail.gmail.com>
 <22925.47256.496267.20679@stat.math.ethz.ch>
Message-ID: <CALEXWq1qcUU=cR-YT2fujXfB4HNd-7zJFdKhyuJ9icWRkV9-HQ@mail.gmail.com>

2017-08-11 16:00 GMT+02:00 Martin Maechler <maechler at stat.math.ethz.ch>:
>>>>>> Dmitriy Selivanov <selivanov.dmitriy at gmail.com>
>>>>>>     on Fri, 11 Aug 2017 17:33:31 +0400 writes:
>
>     > Hi mailing list and R-core. Could someone from R-core please help me to
>     > create account in bugzilla? I would like to submit issue related to gc() to
>     > wishlist.
>
> I will create one.
>
> Your previous e-mails left me pretty clueless about what the
> problem is that you want to solve ... but maybe others
> understand better what you mean.
>
> Note that in the case of such a relatively sophisticated wish
> without a clear sign of a problem (in my view)
> chances are not high that anything will change, unless someone
> provides a (small footprint) patch towards the (R-devel aka
> "trunk") sources *and* reproducible R code that depicts the
> problem.

How to reproduce it:

a <- replicate(2e6, new.env()) # ~ 1.4 GB of memory
rm(a)
gc() # the R process still has the memory assigned

I?aki


From suharto_anggono at yahoo.com  Fri Aug 11 19:11:06 2017
From: suharto_anggono at yahoo.com (Suharto Anggono Suharto Anggono)
Date: Fri, 11 Aug 2017 17:11:06 +0000 (UTC)
Subject: [Rd] Issues of R_pretty in src/appl/pretty.c
References: <511389049.5625.1502471466049.ref@mail.yahoo.com>
Message-ID: <511389049.5625.1502471466049@mail.yahoo.com>

See https://stat.ethz.ch/pipermail/r-devel/2017-August/074746.html for the origin of the example here.

That
pretty(c(-1,1)*1e300, n = 1e9, min.n = 1) gave 20 intervals, far from 1e9, but
pretty(c(-1,1)*1e300, n = 1e6, min.n = 1) gave 1000000 intervals
(on a machine), made me trace through the code to function 'R_pretty' in https://svn.r-project.org/R/trunk/src/appl/pretty.c .

*lo is -1e300, *up is 1e300.
cell = fmax2(fabs(*lo),fabs(*up));
'cell' is 1e300.
i_small = dx < cell * U * imax2(1,*ndiv) * DBL_EPSILON *3;
When *ndiv is (int) 1e9, apparently cell * U * imax2(1,*ndiv) overflows to infinity and 'i_small' is 1 (true). It doesn't happen when *ndiv is (int) 1e6.

Putting parentheses may avoid the floating point overflow. For example,
i_small = dx < cell * (U * imax2(1,*ndiv) * DBL_EPSILON) *3;

The part
U = (1 + (h5 >= 1.5*h+.5)) ? 1/(1+h) : 1.5/(1+h5);
is strange. Because (h5 >= 1.5*h+.5) is 1 or 0, (1 + (h5 >= 1.5*h+.5)) is never zero and 1/(1+h) will always be chosen.

The comment for 'rounding_eps' says "1e-7 is consistent with seq.default()". Currently, seq.default() uses 1e-10 as fuzz.


From simon.urbanek at r-project.org  Sat Aug 12 16:09:05 2017
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Sat, 12 Aug 2017 10:09:05 -0400
Subject: [Rd] Help to create bugzilla account
In-Reply-To: <CALEXWq1qcUU=cR-YT2fujXfB4HNd-7zJFdKhyuJ9icWRkV9-HQ@mail.gmail.com>
References: <CAJdZCv3oUhwiqJUTwKy0ZvwkcB=qdA5WcBdfMsdAcJED9f356w@mail.gmail.com>
 <22925.47256.496267.20679@stat.math.ethz.ch>
 <CALEXWq1qcUU=cR-YT2fujXfB4HNd-7zJFdKhyuJ9icWRkV9-HQ@mail.gmail.com>
Message-ID: <BB27F8C5-00DD-42D2-AD1E-5BB8E9E2AE81@r-project.org>


> On Aug 11, 2017, at 12:57 PM, I?aki ?car <i.ucar86 at gmail.com> wrote:
> 
> 2017-08-11 16:00 GMT+02:00 Martin Maechler <maechler at stat.math.ethz.ch>:
>>>>>>> Dmitriy Selivanov <selivanov.dmitriy at gmail.com>
>>>>>>>    on Fri, 11 Aug 2017 17:33:31 +0400 writes:
>> 
>>> Hi mailing list and R-core. Could someone from R-core please help me to
>>> create account in bugzilla? I would like to submit issue related to gc() to
>>> wishlist.
>> 
>> I will create one.
>> 
>> Your previous e-mails left me pretty clueless about what the
>> problem is that you want to solve ... but maybe others
>> understand better what you mean.
>> 
>> Note that in the case of such a relatively sophisticated wish
>> without a clear sign of a problem (in my view)
>> chances are not high that anything will change, unless someone
>> provides a (small footprint) patch towards the (R-devel aka
>> "trunk") sources *and* reproducible R code that depicts the
>> problem.
> 
> How to reproduce it:
> 
> a <- replicate(2e6, new.env()) # ~ 1.4 GB of memory
> rm(a)
> gc() # the R process still has the memory assigned
> 

Right, but that's unavoidable because of the way Linux allocates memory - see FAQ 7.42
The memory is free, Linux just keeps it for future allocations.

Running malloc.trim doesn't help, because the issue is fragmentation due to the linear design of the pool - you likely will have another object on top so in most practical cases malloc.trim() doesn't actually do anything. You can always call malloc.trim() yourself is you think it helps, but it doesn't in the general case. The only way to address that would be to move allocated objects from top of the pool down, but that's not something R can allow, because it cannot know which code still has SEXP pointers referring to that object.

Cheers,
Simon


From selivanov.dmitriy at gmail.com  Sat Aug 12 16:35:44 2017
From: selivanov.dmitriy at gmail.com (Dmitriy Selivanov)
Date: Sat, 12 Aug 2017 18:35:44 +0400
Subject: [Rd] Help to create bugzilla account
In-Reply-To: <BB27F8C5-00DD-42D2-AD1E-5BB8E9E2AE81@r-project.org>
References: <CAJdZCv3oUhwiqJUTwKy0ZvwkcB=qdA5WcBdfMsdAcJED9f356w@mail.gmail.com>
 <22925.47256.496267.20679@stat.math.ethz.ch>
 <CALEXWq1qcUU=cR-YT2fujXfB4HNd-7zJFdKhyuJ9icWRkV9-HQ@mail.gmail.com>
 <BB27F8C5-00DD-42D2-AD1E-5BB8E9E2AE81@r-project.org>
Message-ID: <CAJdZCv0NAMf9qYodsondd5BHF1JSsP2G=wU63UXuTwfQahRmjA@mail.gmail.com>

Strange because in my all my experiments calling malloc.trim always helped
- memory reported by top decreased to the level it supposed to be. Do you
have in mind case when calling malloc.trim won't do anything? Also
shouldn't MALLOC_TRIM_THRESHOLD_ env variable has impact on malloc.trim
calls? At the moment seems any value is ignored...

12 ???. 2017 ?. 6:09 ?? ???????????? "Simon Urbanek" <
simon.urbanek at r-project.org> ???????:

>
> > On Aug 11, 2017, at 12:57 PM, I?aki ?car <i.ucar86 at gmail.com> wrote:
> >
> > 2017-08-11 16:00 GMT+02:00 Martin Maechler <maechler at stat.math.ethz.ch>:
> >>>>>>> Dmitriy Selivanov <selivanov.dmitriy at gmail.com>
> >>>>>>>    on Fri, 11 Aug 2017 17:33:31 +0400 writes:
> >>
> >>> Hi mailing list and R-core. Could someone from R-core please help me to
> >>> create account in bugzilla? I would like to submit issue related to
> gc() to
> >>> wishlist.
> >>
> >> I will create one.
> >>
> >> Your previous e-mails left me pretty clueless about what the
> >> problem is that you want to solve ... but maybe others
> >> understand better what you mean.
> >>
> >> Note that in the case of such a relatively sophisticated wish
> >> without a clear sign of a problem (in my view)
> >> chances are not high that anything will change, unless someone
> >> provides a (small footprint) patch towards the (R-devel aka
> >> "trunk") sources *and* reproducible R code that depicts the
> >> problem.
> >
> > How to reproduce it:
> >
> > a <- replicate(2e6, new.env()) # ~ 1.4 GB of memory
> > rm(a)
> > gc() # the R process still has the memory assigned
> >
>
> Right, but that's unavoidable because of the way Linux allocates memory -
> see FAQ 7.42
> The memory is free, Linux just keeps it for future allocations.
>
> Running malloc.trim doesn't help, because the issue is fragmentation due
> to the linear design of the pool - you likely will have another object on
> top so in most practical cases malloc.trim() doesn't actually do anything.
> You can always call malloc.trim() yourself is you think it helps, but it
> doesn't in the general case. The only way to address that would be to move
> allocated objects from top of the pool down, but that's not something R can
> allow, because it cannot know which code still has SEXP pointers referring
> to that object.
>
> Cheers,
> Simon
>
>
>

	[[alternative HTML version deleted]]


From luke-tierney at uiowa.edu  Sat Aug 12 22:10:01 2017
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Sat, 12 Aug 2017 15:10:01 -0500 (CDT)
Subject: [Rd] Help to create bugzilla account
In-Reply-To: <CAJdZCv0NAMf9qYodsondd5BHF1JSsP2G=wU63UXuTwfQahRmjA@mail.gmail.com>
References: <CAJdZCv3oUhwiqJUTwKy0ZvwkcB=qdA5WcBdfMsdAcJED9f356w@mail.gmail.com>
 <22925.47256.496267.20679@stat.math.ethz.ch>
 <CALEXWq1qcUU=cR-YT2fujXfB4HNd-7zJFdKhyuJ9icWRkV9-HQ@mail.gmail.com>
 <BB27F8C5-00DD-42D2-AD1E-5BB8E9E2AE81@r-project.org>
 <CAJdZCv0NAMf9qYodsondd5BHF1JSsP2G=wU63UXuTwfQahRmjA@mail.gmail.com>
Message-ID: <alpine.DEB.2.20.1708121453120.4008@luke-Latitude>

On Sat, 12 Aug 2017, Dmitriy Selivanov wrote:

> Strange because in my all my experiments calling malloc.trim always helped
> - memory reported by top decreased to the level it supposed to be. Do you
> have in mind case when calling malloc.trim won't do anything? Also
> shouldn't MALLOC_TRIM_THRESHOLD_ env variable has impact on malloc.trim
> calls? At the moment seems any value is ignored...

This is a question for glibc developers. For that matter, this entire
thread is really about tuning of the malloc in glibc and should
ideally be addressed upstream.

There has been some discussion of this in other contexts, e.g. Python at

https://nuald.blogspot.com/2013/06/memory-reclaiming-in-python.html

and emacs at

http://notes.secretsauce.net/notes/2016/04/08_glibc-malloc-inefficiency.html

As the Python posts poitns out, it is possible to use alternate malloc
implementations, either rebuilding R to use them or using LD_PRELOAD.
On Ubuntu for example, you can have R use jemalloc with

sudo apt-get install libjemalloc1
env LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libjemalloc.so.1 R

This does not seem to hold onto memory to the same degree, but I don't
know about any other aspect of its performance.

The emacs post suggests that calling malloc_trim may have more of an
effect in some cases: the post describes callign it via gdb on all
running processes and sees a substantial memory footprint drop for
emacs, Xorg and opera. I tried the same experiment on my system with
emacs, Xorg and firefox and didn't see what that post saw -- maybe 1
few percent recovery.

At this point I'm not sure we have enough data to show that adding
malloc_trim calls at the end of each GC, say, would warrant the
nusance of having to add configure checks. It would also be necessary
to make sure that adding this doesn't significantly ompact malloc
performance.

I don't know if this issue exists on Windows as well; it might as the
basic malloc we use there is the same as used in glibc (Dog Lea's
malloc).

Best,

luke


>
> 12 ???. 2017 ?. 6:09 ?? ???????????? "Simon Urbanek" <
> simon.urbanek at r-project.org> ???????:
>
>>
>> > On Aug 11, 2017, at 12:57 PM, I?aki ?car <i.ucar86 at gmail.com> wrote:
>> >
>> > 2017-08-11 16:00 GMT+02:00 Martin Maechler <maechler at stat.math.ethz.ch>:
>> >>>>>>> Dmitriy Selivanov <selivanov.dmitriy at gmail.com>
>> >>>>>>>    on Fri, 11 Aug 2017 17:33:31 +0400 writes:
>> >>
>> >>> Hi mailing list and R-core. Could someone from R-core please help me to
>> >>> create account in bugzilla? I would like to submit issue related to
>> gc() to
>> >>> wishlist.
>> >>
>> >> I will create one.
>> >>
>> >> Your previous e-mails left me pretty clueless about what the
>> >> problem is that you want to solve ... but maybe others
>> >> understand better what you mean.
>> >>
>> >> Note that in the case of such a relatively sophisticated wish
>> >> without a clear sign of a problem (in my view)
>> >> chances are not high that anything will change, unless someone
>> >> provides a (small footprint) patch towards the (R-devel aka
>> >> "trunk") sources *and* reproducible R code that depicts the
>> >> problem.
>> >
>> > How to reproduce it:
>> >
>> > a <- replicate(2e6, new.env()) # ~ 1.4 GB of memory
>> > rm(a)
>> > gc() # the R process still has the memory assigned
>> >
>>
>> Right, but that's unavoidable because of the way Linux allocates memory -
>> see FAQ 7.42
>> The memory is free, Linux just keeps it for future allocations.
>>
>> Running malloc.trim doesn't help, because the issue is fragmentation due
>> to the linear design of the pool - you likely will have another object on
>> top so in most practical cases malloc.trim() doesn't actually do anything.
>> You can always call malloc.trim() yourself is you think it helps, but it
>> doesn't in the general case. The only way to address that would be to move
>> allocated objects from top of the pool down, but that's not something R can
>> allow, because it cannot know which code still has SEXP pointers referring
>> to that object.
>>
>> Cheers,
>> Simon
>>
>>
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Luke Tierney
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu

From edd at debian.org  Sat Aug 12 23:36:36 2017
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sat, 12 Aug 2017 16:36:36 -0500
Subject: [Rd] Help to create bugzilla account
In-Reply-To: <alpine.DEB.2.20.1708121453120.4008@luke-Latitude>
References: <CAJdZCv3oUhwiqJUTwKy0ZvwkcB=qdA5WcBdfMsdAcJED9f356w@mail.gmail.com>
 <22925.47256.496267.20679@stat.math.ethz.ch>
 <CALEXWq1qcUU=cR-YT2fujXfB4HNd-7zJFdKhyuJ9icWRkV9-HQ@mail.gmail.com>
 <BB27F8C5-00DD-42D2-AD1E-5BB8E9E2AE81@r-project.org>
 <CAJdZCv0NAMf9qYodsondd5BHF1JSsP2G=wU63UXuTwfQahRmjA@mail.gmail.com>
 <alpine.DEB.2.20.1708121453120.4008@luke-Latitude>
Message-ID: <22927.29924.782435.781870@bud.eddelbuettel.com>


On 12 August 2017 at 15:10, luke-tierney at uiowa.edu wrote:
| As the Python posts poitns out, it is possible to use alternate malloc
| implementations, either rebuilding R to use them or using LD_PRELOAD.
| On Ubuntu for example, you can have R use jemalloc with
| 
| sudo apt-get install libjemalloc1
| env LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libjemalloc.so.1 R
| 
| This does not seem to hold onto memory to the same degree, but I don't
| know about any other aspect of its performance.

Interesting.

I don't really know anything about malloc versus jemalloc internals but I can
affirm that redis -- an in-memory database written in single-threaded C for
high performance -- in its Debian builds has been using jemalloc for years,
presumably by choice of the maintainer. (We are very happy users of [a gently
patched] redis at work; lots of writes; very good uptime.)

Having the ability to switch to jemalloc, we could design a test bench and
compare what the impact is.

Similarly, if someone cared, I could (presumably) alter the default R build
for Debian and Ubunto to also switch to jemalloc.

Anybody feel like doing some empirics?

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From selivanov.dmitriy at gmail.com  Sun Aug 13 13:15:10 2017
From: selivanov.dmitriy at gmail.com (Dmitriy Selivanov)
Date: Sun, 13 Aug 2017 15:15:10 +0400
Subject: [Rd] Help to create bugzilla account
In-Reply-To: <22927.29924.782435.781870@bud.eddelbuettel.com>
References: <CAJdZCv3oUhwiqJUTwKy0ZvwkcB=qdA5WcBdfMsdAcJED9f356w@mail.gmail.com>
 <22925.47256.496267.20679@stat.math.ethz.ch>
 <CALEXWq1qcUU=cR-YT2fujXfB4HNd-7zJFdKhyuJ9icWRkV9-HQ@mail.gmail.com>
 <BB27F8C5-00DD-42D2-AD1E-5BB8E9E2AE81@r-project.org>
 <CAJdZCv0NAMf9qYodsondd5BHF1JSsP2G=wU63UXuTwfQahRmjA@mail.gmail.com>
 <alpine.DEB.2.20.1708121453120.4008@luke-Latitude>
 <22927.29924.782435.781870@bud.eddelbuettel.com>
Message-ID: <CAJdZCv1-8xBGKvxi9a702eiYPNo5rT1eB43n=aB7Az6vfSHuKA@mail.gmail.com>

Very interesting information about switching glibc malloc to jemalloc.

So I see action plan as following:

   1. set up some benchmark (need to think about design)
   2. Run it on ubuntu machine with default glibc malloc
   3. Run it with malloc_trim passed with reg.finalizer()
   4. Run it with jemalloc
   5. Review results and if they will look better than with glibc malloc -
   possibly consider switch R builds to use jemalloc on Debian, Ubuntu

Can't promise about timeline, but I will definitely try to investigate.

2017-08-13 1:36 GMT+04:00 Dirk Eddelbuettel <edd at debian.org>:

>
> On 12 August 2017 at 15:10, luke-tierney at uiowa.edu wrote:
> | As the Python posts poitns out, it is possible to use alternate malloc
> | implementations, either rebuilding R to use them or using LD_PRELOAD.
> | On Ubuntu for example, you can have R use jemalloc with
> |
> | sudo apt-get install libjemalloc1
> | env LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libjemalloc.so.1 R
> |
> | This does not seem to hold onto memory to the same degree, but I don't
> | know about any other aspect of its performance.
>
> Interesting.
>
> I don't really know anything about malloc versus jemalloc internals but I
> can
> affirm that redis -- an in-memory database written in single-threaded C for
> high performance -- in its Debian builds has been using jemalloc for years,
> presumably by choice of the maintainer. (We are very happy users of [a
> gently
> patched] redis at work; lots of writes; very good uptime.)
>
> Having the ability to switch to jemalloc, we could design a test bench and
> compare what the impact is.
>
> Similarly, if someone cared, I could (presumably) alter the default R build
> for Debian and Ubunto to also switch to jemalloc.
>
> Anybody feel like doing some empirics?
>
> Dirk
>
> --
> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>



-- 
Regards
Dmitriy Selivanov

	[[alternative HTML version deleted]]


From edd at debian.org  Sun Aug 13 15:02:13 2017
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sun, 13 Aug 2017 08:02:13 -0500
Subject: [Rd] Help to create bugzilla account
In-Reply-To: <CAJdZCv1-8xBGKvxi9a702eiYPNo5rT1eB43n=aB7Az6vfSHuKA@mail.gmail.com>
References: <CAJdZCv3oUhwiqJUTwKy0ZvwkcB=qdA5WcBdfMsdAcJED9f356w@mail.gmail.com>
 <22925.47256.496267.20679@stat.math.ethz.ch>
 <CALEXWq1qcUU=cR-YT2fujXfB4HNd-7zJFdKhyuJ9icWRkV9-HQ@mail.gmail.com>
 <BB27F8C5-00DD-42D2-AD1E-5BB8E9E2AE81@r-project.org>
 <CAJdZCv0NAMf9qYodsondd5BHF1JSsP2G=wU63UXuTwfQahRmjA@mail.gmail.com>
 <alpine.DEB.2.20.1708121453120.4008@luke-Latitude>
 <22927.29924.782435.781870@bud.eddelbuettel.com>
 <CAJdZCv1-8xBGKvxi9a702eiYPNo5rT1eB43n=aB7Az6vfSHuKA@mail.gmail.com>
Message-ID: <22928.19925.454641.28153@bud.eddelbuettel.com>


On 13 August 2017 at 15:15, Dmitriy Selivanov wrote:
| Very interesting information about switching glibc malloc to jemalloc.
| 
| So I see action plan as following:
| 
|    1. set up some benchmark (need to think about design)
|    2. Run it on ubuntu machine with default glibc malloc
|    3. Run it with malloc_trim passed with reg.finalizer()
|    4. Run it with jemalloc
|    5. Review results and if they will look better than with glibc malloc -
|    possibly consider switch R builds to use jemalloc on Debian, Ubuntu
| 
| Can't promise about timeline, but I will definitely try to investigate.

Thumbs up!

If you set up a (public) git repo I will try to help. I have access to boxen
running these OSs ranging from 2gb ram (old netbook) to 100+gb ram (at work).

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From simon.urbanek at r-project.org  Sun Aug 13 20:22:00 2017
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Sun, 13 Aug 2017 14:22:00 -0400
Subject: [Rd] Help to create bugzilla account
In-Reply-To: <alpine.DEB.2.20.1708121453120.4008@luke-Latitude>
References: <CAJdZCv3oUhwiqJUTwKy0ZvwkcB=qdA5WcBdfMsdAcJED9f356w@mail.gmail.com>
 <22925.47256.496267.20679@stat.math.ethz.ch>
 <CALEXWq1qcUU=cR-YT2fujXfB4HNd-7zJFdKhyuJ9icWRkV9-HQ@mail.gmail.com>
 <BB27F8C5-00DD-42D2-AD1E-5BB8E9E2AE81@r-project.org>
 <CAJdZCv0NAMf9qYodsondd5BHF1JSsP2G=wU63UXuTwfQahRmjA@mail.gmail.com>
 <alpine.DEB.2.20.1708121453120.4008@luke-Latitude>
Message-ID: <9761328B-B2AC-4592-AA74-5E3E15B11613@r-project.org>

FWIW if we are talking about alternative allocators, tcmalloc is another candidate that we are using for our projects where we care about allocations and performance (another upshot is that it's very flexible so you can do a lot of cool things if you care). However I didn't try it with R - I'll have a look if it can address the issue we're talking about.


> On Aug 12, 2017, at 4:10 PM, luke-tierney at uiowa.edu wrote:
> 
> On Sat, 12 Aug 2017, Dmitriy Selivanov wrote:
> 
>> Strange because in my all my experiments calling malloc.trim always helped
>> - memory reported by top decreased to the level it supposed to be. Do you
>> have in mind case when calling malloc.trim won't do anything? Also
>> shouldn't MALLOC_TRIM_THRESHOLD_ env variable has impact on malloc.trim
>> calls? At the moment seems any value is ignored...
> 
> This is a question for glibc developers. For that matter, this entire
> thread is really about tuning of the malloc in glibc and should
> ideally be addressed upstream.
> 
> There has been some discussion of this in other contexts, e.g. Python at
> 
> https://nuald.blogspot.com/2013/06/memory-reclaiming-in-python.html
> 
> and emacs at
> 
> http://notes.secretsauce.net/notes/2016/04/08_glibc-malloc-inefficiency.html
> 
> As the Python posts poitns out, it is possible to use alternate malloc
> implementations, either rebuilding R to use them or using LD_PRELOAD.
> On Ubuntu for example, you can have R use jemalloc with
> 
> sudo apt-get install libjemalloc1
> env LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libjemalloc.so.1 R
> 
> This does not seem to hold onto memory to the same degree, but I don't
> know about any other aspect of its performance.
> 
> The emacs post suggests that calling malloc_trim may have more of an
> effect in some cases: the post describes callign it via gdb on all
> running processes and sees a substantial memory footprint drop for
> emacs, Xorg and opera. I tried the same experiment on my system with
> emacs, Xorg and firefox and didn't see what that post saw -- maybe 1
> few percent recovery.
> 
> At this point I'm not sure we have enough data to show that adding
> malloc_trim calls at the end of each GC, say, would warrant the
> nusance of having to add configure checks. It would also be necessary
> to make sure that adding this doesn't significantly ompact malloc
> performance.
> 
> I don't know if this issue exists on Windows as well; it might as the
> basic malloc we use there is the same as used in glibc (Dog Lea's
> malloc).
> 
> Best,
> 
> luke
> 
> 
>> 
>> 12 ???. 2017 ?. 6:09 ?? ???????????? "Simon Urbanek" <
>> simon.urbanek at r-project.org> ???????:
>> 
>>> 
>>> > On Aug 11, 2017, at 12:57 PM, I?aki ?car <i.ucar86 at gmail.com> wrote:
>>> >
>>> > 2017-08-11 16:00 GMT+02:00 Martin Maechler <maechler at stat.math.ethz.ch>:
>>> >>>>>>> Dmitriy Selivanov <selivanov.dmitriy at gmail.com>
>>> >>>>>>>    on Fri, 11 Aug 2017 17:33:31 +0400 writes:
>>> >>
>>> >>> Hi mailing list and R-core. Could someone from R-core please help me to
>>> >>> create account in bugzilla? I would like to submit issue related to
>>> gc() to
>>> >>> wishlist.
>>> >>
>>> >> I will create one.
>>> >>
>>> >> Your previous e-mails left me pretty clueless about what the
>>> >> problem is that you want to solve ... but maybe others
>>> >> understand better what you mean.
>>> >>
>>> >> Note that in the case of such a relatively sophisticated wish
>>> >> without a clear sign of a problem (in my view)
>>> >> chances are not high that anything will change, unless someone
>>> >> provides a (small footprint) patch towards the (R-devel aka
>>> >> "trunk") sources *and* reproducible R code that depicts the
>>> >> problem.
>>> >
>>> > How to reproduce it:
>>> >
>>> > a <- replicate(2e6, new.env()) # ~ 1.4 GB of memory
>>> > rm(a)
>>> > gc() # the R process still has the memory assigned
>>> >
>>> 
>>> Right, but that's unavoidable because of the way Linux allocates memory -
>>> see FAQ 7.42
>>> The memory is free, Linux just keeps it for future allocations.
>>> 
>>> Running malloc.trim doesn't help, because the issue is fragmentation due
>>> to the linear design of the pool - you likely will have another object on
>>> top so in most practical cases malloc.trim() doesn't actually do anything.
>>> You can always call malloc.trim() yourself is you think it helps, but it
>>> doesn't in the general case. The only way to address that would be to move
>>> allocated objects from top of the pool down, but that's not something R can
>>> allow, because it cannot know which code still has SEXP pointers referring
>>> to that object.
>>> 
>>> Cheers,
>>> Simon
>>> 
>>> 
>>> 
>> 
>> 	[[alternative HTML version deleted]]
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> -- 
> Luke Tierney
> Ralph E. Wareham Professor of Mathematical Sciences
> University of Iowa                  Phone:             319-335-3386
> Department of Statistics and        Fax:               319-335-3017
>   Actuarial Science
> 241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From sgrubb at redhat.com  Mon Aug 14 04:16:43 2017
From: sgrubb at redhat.com (Steve Grubb)
Date: Sun, 13 Aug 2017 22:16:43 -0400
Subject: [Rd] Help to create bugzilla account
In-Reply-To: <22927.29924.782435.781870@bud.eddelbuettel.com>
References: <CAJdZCv3oUhwiqJUTwKy0ZvwkcB=qdA5WcBdfMsdAcJED9f356w@mail.gmail.com>
 <alpine.DEB.2.20.1708121453120.4008@luke-Latitude>
 <22927.29924.782435.781870@bud.eddelbuettel.com>
Message-ID: <7748612.7Mr2eFXGTA@x2>

On Saturday, August 12, 2017 5:36:36 PM EDT Dirk Eddelbuettel wrote:
> On 12 August 2017 at 15:10, luke-tierney at uiowa.edu wrote:
> | As the Python posts poitns out, it is possible to use alternate malloc
> | implementations, either rebuilding R to use them or using LD_PRELOAD.
> | On Ubuntu for example, you can have R use jemalloc with
> | 
> | sudo apt-get install libjemalloc1
> | env LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libjemalloc.so.1 R
> | 
> | This does not seem to hold onto memory to the same degree, but I don't
> | know about any other aspect of its performance.
> 
> Interesting.
> 
> I don't really know anything about malloc versus jemalloc internals but I
> can affirm that redis -- an in-memory database written in single-threaded C
> for high performance -- in its Debian builds has been using jemalloc for
> years, presumably by choice of the maintainer. (We are very happy users of
> [a gently patched] redis at work; lots of writes; very good uptime.)
> 
> Having the ability to switch to jemalloc, we could design a test bench and
> compare what the impact is.
> 
> Similarly, if someone cared, I could (presumably) alter the default R build
> for Debian and Ubunto to also switch to jemalloc.

Depending on how this turns out, Fedora, RHEL, Centos also have jemalloc and 
tcmalloc. Meaning, if its good on those two, its good on Linux in general. 
Basically, jemalloc is faster for many work loads but its harder to spot 
problems. Glibc is better at spotting memory bugs but not as fast.

-Steve

> Anybody feel like doing some empirics?
> 
> Dirk


From maechler at stat.math.ethz.ch  Mon Aug 14 11:46:07 2017
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 14 Aug 2017 11:46:07 +0200
Subject: [Rd] Issues of R_pretty in src/appl/pretty.c
In-Reply-To: <511389049.5625.1502471466049@mail.yahoo.com>
References: <511389049.5625.1502471466049.ref@mail.yahoo.com>
 <511389049.5625.1502471466049@mail.yahoo.com>
Message-ID: <22929.29023.99646.669047@stat.math.ethz.ch>

>>>>> Suharto Anggono Suharto Anggono via R-devel <r-devel at r-project.org>
>>>>>     on Fri, 11 Aug 2017 17:11:06 +0000 writes:
>>>>> Suharto Anggono Suharto Anggono via R-devel <r-devel at r-project.org>
>>>>>     on Fri, 11 Aug 2017 17:11:06 +0000 writes:

    > See https://stat.ethz.ch/pipermail/r-devel/2017-August/074746.html for the origin of the example here.

    > That
    > pretty(c(-1,1)*1e300, n = 1e9, min.n = 1) gave 20 intervals, far from 1e9, but
    > pretty(c(-1,1)*1e300, n = 1e6, min.n = 1) gave 1000000 intervals
    > (on a machine), made me trace through the code to function 'R_pretty' in https://svn.r-project.org/R/trunk/src/appl/pretty.c .

thank you.

    > *lo is -1e300, *up is 1e300.
    > cell = fmax2(fabs(*lo),fabs(*up));
    > 'cell' is 1e300.
    > i_small = dx < cell * U * imax2(1,*ndiv) * DBL_EPSILON *3;
    > When *ndiv is (int) 1e9, apparently cell * U * imax2(1,*ndiv) overflows to infinity and 'i_small' is 1 (true). It doesn't happen when *ndiv is (int) 1e6.

well spotted!

    > Putting parentheses may avoid the floating point overflow. For example,
    > i_small = dx < cell * (U * imax2(1,*ndiv) * DBL_EPSILON) *3;

yes... but only if the compiler optimization steps  "keep the parentheses".
AFAIK, there is no guarantee for that.
To make sure, I'd replace the above by

   U *= imax2(1,*ndiv) * DBL_EPSILON;
   i_small = dx < cell * U * 3;


    > The part
    > U = (1 + (h5 >= 1.5*h+.5)) ? 1/(1+h) : 1.5/(1+h5);
    > is strange. Because (h5 >= 1.5*h+.5) is 1 or 0, (1 + (h5 >= 1.5*h+.5)) is never zero and 1/(1+h) will always be chosen.

Yes, strange indeed!
here was as a change (not by me!) adding wrong parentheses
there (or maybe adding what the previously "missing" parens
      implied, but not what they intended!).
The original code had been
     
    U = 1 + (h5 >= 1.5*h+.5) ? 1/(1+h) : 1.5/(1+h5);

and "of course" was intended to mean

    U = 1 + ((h5 >= 1.5*h+.5) ? 1/(1+h) : 1.5/(1+h5));

and this what I'll change it to, now.


    > The comment for 'rounding_eps' says "1e-7 is consistent with seq.default()". Currently, seq.default() uses 1e-10 as fuzz.

Hmm, yes, thank you; this was correct when written,
but seq.default had been changed in the mean time,
namely in  svn r51095 | 2010-02-03

Usually we are cautious / reluctant to change such things w/o
any bug that we see to fix.
OTOH, we did have  bug cases we'd wanted to amend for seq() /
seq.int();
and I'll look into updating the "pretty - epsilon" also to
1e-10.

Thank you for your analysis and suggestions!

Martin


From maechler at stat.math.ethz.ch  Mon Aug 14 14:44:14 2017
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 14 Aug 2017 14:44:14 +0200
Subject: [Rd] arithmetic with zero-column data.frames
In-Reply-To: <22922.58974.921059.698005@stat.math.ethz.ch>
References: <CAF8bMcbJdWbfxHrk9hYaPn+O9pzeMByBfMAePoTPcDPS0wQH3Q@mail.gmail.com>
 <22922.52164.655834.544619@stat.math.ethz.ch>
 <22922.58974.921059.698005@stat.math.ethz.ch>
Message-ID: <22929.39710.340465.807334@stat.math.ethz.ch>

>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Wed, 9 Aug 2017 12:39:26 +0200 writes:

    > So as often there is more to it than you first think.
    > Let's consider this an RFC (for experienced long time R users) :

>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Wed, 9 Aug 2017 10:45:56 +0200 writes:

>>>>> William Dunlap via R-devel <r-devel at r-project.org>
>>>>>     on Tue, 8 Aug 2017 11:59:45 -0700 writes:

    >>> Should arithmetic operations work on zero-column data.frames (returning a
    >>> zero-column data.frame with the same number of rows as the data.frame
    >>> argument(s))?   Currently we get:

    >>>> 1 + data.frame(row.names=c("A","B"))
    >>> Error in data.frame(value, row.names = rn, check.names = FALSE, check.rows
    >>> = FALSE) :
    >>> row names supplied are of the wrong length
    >>>> data.frame(row.names=c("A","B")) * 2
    >>> Error in data.frame(value, row.names = rn, check.names = FALSE, check.rows
    >>> = FALSE) :
    >>> row names supplied are of the wrong length
    >>>> data.frame(row.names=c("A","B")) / data.frame(row.names=c("A","B"))
    >>> Error in data.frame(value, row.names = rn, check.names = FALSE, check.rows
    >>> = FALSE) :
    >>> row names supplied are of the wrong length

    >>> Bill Dunlap
    >>> TIBCO Software
    >>> wdunlap tibco.com

    >> Thank you, Bill.

    >> Yes, indeed, as we have the   Ops.data.frame  and
    >> Math.data.frame group methods  (about which I have not always
    >> been so happy,  but they are inheritance from S),
    >> and as the Math methods work too,  we should get this boundary
    >> case working as well for the Ops.

    > Hmm..  This time, I'd be glad for comments, notably from you, Bill:

    > In looking at this, I notice that "^" is treated
    > exceptionally, possibly not on purpose, i.e., accidentally. E.g.,
    > USArrests ^ 2    returns a matrix  where all other arithmetic
    > Ops give a data frame.

    > All non-arithmetic Ops do give a matrix [also not documentedly, AFAICS].
    > and currently "^"  is treated like them.

    > Note that Math.data.frame always returns a data frame (when it
    > does return), so we currently have this ugly inconsistency:

    >> str(USArrests ^ 0.5)
    > num [1:50, 1:4] 3.63 3.16 2.85 2.97 3 ...
    > - attr(*, "dimnames")=List of 2
    > ..$ : chr [1:50] "Alabama" "Alaska" "Arizona" "Arkansas" ...
    > ..$ : chr [1:4] "Murder" "Assault" "UrbanPop" "Rape"
    >> str(sqrt(USArrests))
    > 'data.frame':	50 obs. of  4 variables:
    > $ Murder  : num  3.63 3.16 2.85 2.97 3 ...
    > $ Assault : num  15.4 16.2 17.1 13.8 16.6 ...
    > $ UrbanPop: num  7.62 6.93 8.94 7.07 9.54 ...
    > $ Rape    : num  4.6 6.67 5.57 4.42 6.37 ...
    >> 

    > I propose to add "^" to the other arithmetic ops which return a
    > data frame.  So in the above,  '^ 0.5' would give the same [upto
    > lowest bit rounding error] as sqrt().

    > - -- - -- - --

    > A further inconsistency is that the Math methods directly refuse
    > to work on a data frame with non-numeric variables, whereas the
    > Ops methods just go along and give warnings and NA's:

    >> sqrt(CO2)
    > Error in Math.data.frame(CO2) : 
    > non-numeric variable in data frame: PlantTypeTreatment

    >> str( CO2 ^ 0.5 )
    > num [1:84, 1:5] NA NA NA NA NA NA NA NA NA NA ...
    > - attr(*, "dimnames")=List of 2
    > ..$ : chr [1:84] "1" "2" "3" "4" ...
    > ..$ : chr [1:5] "Plant" "Type" "Treatment" "conc" ...
    > Warning messages:
    > 1: In Ops.ordered(left, right) : '^' is not meaningful for ordered factors
    > 2: In Ops.factor(left, right) : ?^? not meaningful for factors
    > 3: In Ops.factor(left, right) : ?^? not meaningful for factors
    >> 

    > One "clean" radical solution here would be for the  Ops method
    > to also directly give an error as the Math one.
    > But that may be undesirable.
    > Assume people have data frame variables of classes where an Ops method is
    > defined for it.  Then  the corresponding "op" is applied
    > everywhere and the result maybe useful and as desired.

    > So, I'm much less sure what's desireable here.
    > Should we just document the behavior of this latter inconsistency?

as there was no feedback from anyone,
I have now committed -- to R-devel only, svn 73093 -- what I had proposed
above:

- arithmetic for 0-column data frames now works

- "Arith"metic giving data frames, also for '^'

- the other "Ops", i.e., "Compare" and "Logic" continue
  to return a logical matrix, and this is now documented.

Martin Maechler
ETH Zurich and R Core


From maechler at stat.math.ethz.ch  Tue Aug 15 10:55:10 2017
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 15 Aug 2017 10:55:10 +0200
Subject: [Rd] Issues of R_pretty in src/appl/pretty.c
In-Reply-To: <22929.29023.99646.669047@stat.math.ethz.ch>
References: <511389049.5625.1502471466049.ref@mail.yahoo.com>
 <511389049.5625.1502471466049@mail.yahoo.com>
 <22929.29023.99646.669047@stat.math.ethz.ch>
Message-ID: <22930.46830.529142.139055@stat.math.ethz.ch>

>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Mon, 14 Aug 2017 11:46:07 +0200 writes:

>>>>> Suharto Anggono Suharto Anggono via R-devel <r-devel at r-project.org>
>>>>>     on Fri, 11 Aug 2017 17:11:06 +0000 writes:
>>>>> Suharto Anggono Suharto Anggono via R-devel <r-devel at r-project.org>
>>>>>     on Fri, 11 Aug 2017 17:11:06 +0000 writes:

    >> See https://stat.ethz.ch/pipermail/r-devel/2017-August/074746.html for the origin of the example here.

    >> That
    >> pretty(c(-1,1)*1e300, n = 1e9, min.n = 1) gave 20 intervals, far from 1e9, but
    >> pretty(c(-1,1)*1e300, n = 1e6, min.n = 1) gave 1000000 intervals
    >> (on a machine), made me trace through the code to function 'R_pretty' in https://svn.r-project.org/R/trunk/src/appl/pretty.c .

    > thank you.

    >> *lo is -1e300, *up is 1e300.
    >> cell = fmax2(fabs(*lo),fabs(*up));
    >> 'cell' is 1e300.
    >> i_small = dx < cell * U * imax2(1,*ndiv) * DBL_EPSILON *3;
    >> When *ndiv is (int) 1e9, apparently cell * U * imax2(1,*ndiv) overflows to infinity and 'i_small' is 1 (true). It doesn't happen when *ndiv is (int) 1e6.

    > well spotted!

    >> Putting parentheses may avoid the floating point overflow. For example,
    >> i_small = dx < cell * (U * imax2(1,*ndiv) * DBL_EPSILON) *3;

    > yes... but only if the compiler optimization steps  "keep the parentheses".
    > AFAIK, there is no guarantee for that.
    > To make sure, I'd replace the above by

    > U *= imax2(1,*ndiv) * DBL_EPSILON;
    > i_small = dx < cell * U * 3;


    >> The part
    >> U = (1 + (h5 >= 1.5*h+.5)) ? 1/(1+h) : 1.5/(1+h5);
    >> is strange. Because (h5 >= 1.5*h+.5) is 1 or 0, (1 + (h5 >= 1.5*h+.5)) is never zero and 1/(1+h) will always be chosen.

    > Yes, strange indeed!
    > here was as a change (not by me!) adding wrong parentheses
    > there (or maybe adding what the previously "missing" parens
    > implied, but not what they intended!).
    > The original code had been
     
    > U = 1 + (h5 >= 1.5*h+.5) ? 1/(1+h) : 1.5/(1+h5);

    > and "of course" was intended to mean

    > U = 1 + ((h5 >= 1.5*h+.5) ? 1/(1+h) : 1.5/(1+h5));

    > and this what I'll change it to, now.


    >> The comment for 'rounding_eps' says "1e-7 is consistent with seq.default()". Currently, seq.default() uses 1e-10 as fuzz.

    > Hmm, yes, thank you; this was correct when written,
    > but seq.default had been changed in the mean time,
    > namely in  svn r51095 | 2010-02-03

    > Usually we are cautious / reluctant to change such things w/o
    > any bug that we see to fix.
    > OTOH, we did have  bug cases we'd wanted to amend for seq() /
    > seq.int();
    > and I'll look into updating the "pretty - epsilon" also to
    > 1e-10.

    > Thank you for your analysis and suggestions!

I've committed now what I think has been suggested
above ... to R-devel only :
------------------------------------------------------------------------
r73094 | maechler | 2017-08-15 09:10:27 +0200 (Tue, 15. Aug 2017) | 1 Zeile
Ge?nderte Pfade:
   M doc/NEWS.Rd
   M src/appl/pretty.c
   M src/main/engine.c
   M tests/reg-large.R
   M tests/reg-tests-2.Rout.save

pretty(x, n) fix overflow for large n suggested by Suhartu Aggano, R-devel, 2017-08-11


From petr.pikal at precheza.cz  Tue Aug 15 16:03:42 2017
From: petr.pikal at precheza.cz (PIKAL Petr)
Date: Tue, 15 Aug 2017 14:03:42 +0000
Subject: [Rd] strange behaviour read.table and clipboard
Message-ID: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAAB50@SRVEXCHCM301.precheza.cz>

Dear all

I used to transfer data from excel to R by simple ctrl-c and read.delim("clipboard") construction. I know it is a bad practice but it is easy and for quick exploratory work it is OK. However after changing to new R devel few days ago I encountered weird behaviour. I tried one or two columns.

In case of 2 columns, header is repeated after 526 items
> mar<-read.delim("clipboard")
> which(mar$a2=="a1")
[1]  525 1051 1577
> diff(which(mar$a2=="a1"))
[1] 526 526
and only first header item is repeated.

In case of one column, header is repeated after 1107 items

> mar<-read.delim("clipboard")
> diff(which(mar$a2=="a2"))
[1] 1107 1107

And all items in object are therefore changed to factor.

BTW, readxl package works on same excel file smoothly.

I will try to download the most recent R version to check it, but it could take some time due to our IT issues.

Best regards
Petr

> version
               _
platform       x86_64-w64-mingw32
arch           x86_64
os             mingw32
system         x86_64, mingw32
status         Under development (unstable)
major          3
minor          5.0
year           2017
month          07
day            31
svn rev        73003
language       R
version.string R Under development (unstable) (2017-07-31 r73003)
nickname       Unsuffered Consequences


________________________________
Tento e-mail a jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou ur?eny pouze jeho adres?t?m.
Jestli?e jste obdr?el(a) tento e-mail omylem, informujte laskav? neprodlen? jeho odes?latele. Obsah tohoto emailu i s p??lohami a jeho kopie vyma?te ze sv?ho syst?mu.
Nejste-li zam??len?m adres?tem tohoto emailu, nejste opr?vn?ni tento email jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu zp?sobenou modifikacemi ?i zpo?d?n?m p?enosu e-mailu.

V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
- vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o uzav?en? smlouvy, a to z jak?hokoliv d?vodu i bez uveden? d?vodu.
- a obsahuje-li nab?dku, je adres?t opr?vn?n nab?dku bezodkladn? p?ijmout; Odes?latel tohoto e-mailu (nab?dky) vylu?uje p?ijet? nab?dky ze strany p??jemce s dodatkem ?i odchylkou.
- trv? odes?latel na tom, ?e p??slu?n? smlouva je uzav?ena teprve v?slovn?m dosa?en?m shody na v?ech jej?ch n?le?itostech.
- odes?latel tohoto emailu informuje, ?e nen? opr?vn?n uzav?rat za spole?nost ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn? zmocn?n nebo p?semn? pov??en a takov? pov??en? nebo pln? moc byly adres?tovi tohoto emailu p??padn? osob?, kterou adres?t zastupuje, p?edlo?eny nebo jejich existence je adres?tovi ?i osob? j?m zastoupen? zn?m?.

This e-mail and any documents attached to it may be confidential and are intended only for its intended recipients.
If you received this e-mail by mistake, please immediately inform its sender. Delete the contents of this e-mail with all attachments and its copies from your system.
If you are not the intended recipient of this e-mail, you are not authorized to use, disseminate, copy or disclose this e-mail in any manner.
The sender of this e-mail shall not be liable for any possible damage caused by modifications of the e-mail or by delay with transfer of the email.

In case that this e-mail forms part of business dealings:
- the sender reserves the right to end negotiations about entering into a contract in any time, for any reason, and without stating any reasoning.
- if the e-mail contains an offer, the recipient is entitled to immediately accept such offer; The sender of this e-mail (offer) excludes any acceptance of the offer on the part of the recipient containing any amendment or variation.
- the sender insists on that the respective contract is concluded only upon an express mutual agreement on all its aspects.
- the sender of this e-mail informs that he/she is not authorized to enter into any contracts on behalf of the company except for cases in which he/she is expressly authorized to do so in writing, and such authorization or power of attorney is submitted to the recipient or the person represented by the recipient, or the existence of such authorization is known to the recipient of the person represented by the recipient.

From murdoch.duncan at gmail.com  Wed Aug 16 00:34:51 2017
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 15 Aug 2017 18:34:51 -0400
Subject: [Rd] strange behaviour read.table and clipboard
In-Reply-To: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAAB50@SRVEXCHCM301.precheza.cz>
References: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAAB50@SRVEXCHCM301.precheza.cz>
Message-ID: <da145467-18b0-bc61-e3b1-6f18281d88ac@gmail.com>

On 15/08/2017 10:03 AM, PIKAL Petr wrote:
> Dear all
>
> I used to transfer data from excel to R by simple ctrl-c and read.delim("clipboard") construction. I know it is a bad practice but it is easy and for quick exploratory work it is OK. However after changing to new R devel few days ago I encountered weird behaviour. I tried one or two columns.

You haven't posted something that is reproducible.  I don't have Excel, 
but I can cut and paste from Libreoffice, and I don't see this. 
However, it's not the same spreadsheet as you used, so I wouldn't be 
comfortable saying I did what you did.

Please reduce the size of your spreadsheet if you can, and then post 
instructions for how to construct it, and what to cut and paste from it. 
  Then others can try what you did and see if this is specific to your 
machine, to that particular version of R-devel, to Excel, etc.

Duncan Murdoch


> In case of 2 columns, header is repeated after 526 items
>> mar<-read.delim("clipboard")
>> which(mar$a2=="a1")
> [1]  525 1051 1577
>> diff(which(mar$a2=="a1"))
> [1] 526 526
> and only first header item is repeated.
>
> In case of one column, header is repeated after 1107 items
>
>> mar<-read.delim("clipboard")
>> diff(which(mar$a2=="a2"))
> [1] 1107 1107
>
> And all items in object are therefore changed to factor.
>
> BTW, readxl package works on same excel file smoothly.
>
> I will try to download the most recent R version to check it, but it could take some time due to our IT issues.
>
> Best regards
> Petr
>
>> version
>                _
> platform       x86_64-w64-mingw32
> arch           x86_64
> os             mingw32
> system         x86_64, mingw32
> status         Under development (unstable)
> major          3
> minor          5.0
> year           2017
> month          07
> day            31
> svn rev        73003
> language       R
> version.string R Under development (unstable) (2017-07-31 r73003)
> nickname       Unsuffered Consequences
>
>
> ________________________________
> Tento e-mail a jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou ur?eny pouze jeho adres?t?m.
> Jestli?e jste obdr?el(a) tento e-mail omylem, informujte laskav? neprodlen? jeho odes?latele. Obsah tohoto emailu i s p??lohami a jeho kopie vyma?te ze sv?ho syst?mu.
> Nejste-li zam??len?m adres?tem tohoto emailu, nejste opr?vn?ni tento email jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
> Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu zp?sobenou modifikacemi ?i zpo?d?n?m p?enosu e-mailu.
>
> V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
> - vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o uzav?en? smlouvy, a to z jak?hokoliv d?vodu i bez uveden? d?vodu.
> - a obsahuje-li nab?dku, je adres?t opr?vn?n nab?dku bezodkladn? p?ijmout; Odes?latel tohoto e-mailu (nab?dky) vylu?uje p?ijet? nab?dky ze strany p??jemce s dodatkem ?i odchylkou.
> - trv? odes?latel na tom, ?e p??slu?n? smlouva je uzav?ena teprve v?slovn?m dosa?en?m shody na v?ech jej?ch n?le?itostech.
> - odes?latel tohoto emailu informuje, ?e nen? opr?vn?n uzav?rat za spole?nost ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn? zmocn?n nebo p?semn? pov??en a takov? pov??en? nebo pln? moc byly adres?tovi tohoto emailu p??padn? osob?, kterou adres?t zastupuje, p?edlo?eny nebo jejich existence je adres?tovi ?i osob? j?m zastoupen? zn?m?.
>
> This e-mail and any documents attached to it may be confidential and are intended only for its intended recipients.
> If you received this e-mail by mistake, please immediately inform its sender. Delete the contents of this e-mail with all attachments and its copies from your system.
> If you are not the intended recipient of this e-mail, you are not authorized to use, disseminate, copy or disclose this e-mail in any manner.
> The sender of this e-mail shall not be liable for any possible damage caused by modifications of the e-mail or by delay with transfer of the email.
>
> In case that this e-mail forms part of business dealings:
> - the sender reserves the right to end negotiations about entering into a contract in any time, for any reason, and without stating any reasoning.
> - if the e-mail contains an offer, the recipient is entitled to immediately accept such offer; The sender of this e-mail (offer) excludes any acceptance of the offer on the part of the recipient containing any amendment or variation.
> - the sender insists on that the respective contract is concluded only upon an express mutual agreement on all its aspects.
> - the sender of this e-mail informs that he/she is not authorized to enter into any contracts on behalf of the company except for cases in which he/she is expressly authorized to do so in writing, and such authorization or power of attorney is submitted to the recipient or the person represented by the recipient, or the existence of such authorization is known to the recipient of the person represented by the recipient.
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From petr.pikal at precheza.cz  Wed Aug 16 08:25:48 2017
From: petr.pikal at precheza.cz (PIKAL Petr)
Date: Wed, 16 Aug 2017 06:25:48 +0000
Subject: [Rd] strange behaviour read.table and clipboard
In-Reply-To: <da145467-18b0-bc61-e3b1-6f18281d88ac@gmail.com>
References: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAAB50@SRVEXCHCM301.precheza.cz>
 <da145467-18b0-bc61-e3b1-6f18281d88ac@gmail.com>
Message-ID: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAABF0@SRVEXCHCM301.precheza.cz>

Hi Duncan

The simples spreadsheet is:

Put a name in the cell, let say "a1"
Put number e.g. 1 below "a1"
Copy the number to enough rows
Select this column and press ctrl-c

result is

> temp<- read.delim("clipboard")
> str(temp)
'data.frame':   1513 obs. of  1 variable:
 $ a1: Factor w/ 2 levels "1","a1": 1 1 1 1 1 1 1 1 1 1 ...
> which(temp$a1=="a1")
[1] 1365
>
I tested it in vanilla R

> sessionInfo()
R Under development (unstable) (2017-07-31 r73003)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 14393)

Matrix products: default

locale:
[1] LC_COLLATE=Czech_Czech Republic.1250  LC_CTYPE=Czech_Czech Republic.1250
[3] LC_MONETARY=Czech_Czech Republic.1250 LC_NUMERIC=C
[5] LC_TIME=Czech_Czech Republic.1250

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] compiler_3.5.0
>

Excel 16 or 15 I am not sure.

R-devel 2015 (69443) works as expected so it started a believe around May or June this year, when I installed new R version.

I hope it could help to trace the problem. If I can help any further, let me know.

Best regards
Petr



> -----Original Message-----
> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> Sent: Wednesday, August 16, 2017 12:35 AM
> To: PIKAL Petr <petr.pikal at precheza.cz>; r-devel at r-project.org
> Subject: Re: [Rd] strange behaviour read.table and clipboard
>
> On 15/08/2017 10:03 AM, PIKAL Petr wrote:
> > Dear all
> >
> > I used to transfer data from excel to R by simple ctrl-c and
> read.delim("clipboard") construction. I know it is a bad practice but it is easy
> and for quick exploratory work it is OK. However after changing to new R devel
> few days ago I encountered weird behaviour. I tried one or two columns.
>
> You haven't posted something that is reproducible.  I don't have Excel, but I can
> cut and paste from Libreoffice, and I don't see this.
> However, it's not the same spreadsheet as you used, so I wouldn't be
> comfortable saying I did what you did.
>
> Please reduce the size of your spreadsheet if you can, and then post
> instructions for how to construct it, and what to cut and paste from it.
>   Then others can try what you did and see if this is specific to your machine, to
> that particular version of R-devel, to Excel, etc.
>
> Duncan Murdoch
>
>
> > In case of 2 columns, header is repeated after 526 items
> >> mar<-read.delim("clipboard")
> >> which(mar$a2=="a1")
> > [1]  525 1051 1577
> >> diff(which(mar$a2=="a1"))
> > [1] 526 526
> > and only first header item is repeated.
> >
> > In case of one column, header is repeated after 1107 items
> >
> >> mar<-read.delim("clipboard")
> >> diff(which(mar$a2=="a2"))
> > [1] 1107 1107
> >
> > And all items in object are therefore changed to factor.
> >
> > BTW, readxl package works on same excel file smoothly.
> >
> > I will try to download the most recent R version to check it, but it could take
> some time due to our IT issues.
> >
> > Best regards
> > Petr
> >
> >> version
> >                _
> > platform       x86_64-w64-mingw32
> > arch           x86_64
> > os             mingw32
> > system         x86_64, mingw32
> > status         Under development (unstable)
> > major          3
> > minor          5.0
> > year           2017
> > month          07
> > day            31
> > svn rev        73003
> > language       R
> > version.string R Under development (unstable) (2017-07-31 r73003)
> > nickname       Unsuffered Consequences
> >
> >
> > ________________________________
> > Tento e-mail a jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou
> ur?eny pouze jeho adres?t?m.
> > Jestli?e jste obdr?el(a) tento e-mail omylem, informujte laskav? neprodlen?
> jeho odes?latele. Obsah tohoto emailu i s p??lohami a jeho kopie vyma?te ze
> sv?ho syst?mu.
> > Nejste-li zam??len?m adres?tem tohoto emailu, nejste opr?vn?ni tento email
> jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
> > Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu zp?sobenou modifikacemi
> ?i zpo?d?n?m p?enosu e-mailu.
> >
> > V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
> > - vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o uzav?en? smlouvy, a
> to z jak?hokoliv d?vodu i bez uveden? d?vodu.
> > - a obsahuje-li nab?dku, je adres?t opr?vn?n nab?dku bezodkladn? p?ijmout;
> Odes?latel tohoto e-mailu (nab?dky) vylu?uje p?ijet? nab?dky ze strany p??jemce s
> dodatkem ?i odchylkou.
> > - trv? odes?latel na tom, ?e p??slu?n? smlouva je uzav?ena teprve v?slovn?m
> dosa?en?m shody na v?ech jej?ch n?le?itostech.
> > - odes?latel tohoto emailu informuje, ?e nen? opr?vn?n uzav?rat za spole?nost
> ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn? zmocn?n nebo
> p?semn? pov??en a takov? pov??en? nebo pln? moc byly adres?tovi tohoto
> emailu p??padn? osob?, kterou adres?t zastupuje, p?edlo?eny nebo jejich
> existence je adres?tovi ?i osob? j?m zastoupen? zn?m?.
> >
> > This e-mail and any documents attached to it may be confidential and are
> intended only for its intended recipients.
> > If you received this e-mail by mistake, please immediately inform its sender.
> Delete the contents of this e-mail with all attachments and its copies from your
> system.
> > If you are not the intended recipient of this e-mail, you are not authorized to
> use, disseminate, copy or disclose this e-mail in any manner.
> > The sender of this e-mail shall not be liable for any possible damage caused
> by modifications of the e-mail or by delay with transfer of the email.
> >
> > In case that this e-mail forms part of business dealings:
> > - the sender reserves the right to end negotiations about entering into a
> contract in any time, for any reason, and without stating any reasoning.
> > - if the e-mail contains an offer, the recipient is entitled to immediately
> accept such offer; The sender of this e-mail (offer) excludes any acceptance of
> the offer on the part of the recipient containing any amendment or variation.
> > - the sender insists on that the respective contract is concluded only upon an
> express mutual agreement on all its aspects.
> > - the sender of this e-mail informs that he/she is not authorized to enter into
> any contracts on behalf of the company except for cases in which he/she is
> expressly authorized to do so in writing, and such authorization or power of
> attorney is submitted to the recipient or the person represented by the
> recipient, or the existence of such authorization is known to the recipient of the
> person represented by the recipient.
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >


________________________________
Tento e-mail a jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou ur?eny pouze jeho adres?t?m.
Jestli?e jste obdr?el(a) tento e-mail omylem, informujte laskav? neprodlen? jeho odes?latele. Obsah tohoto emailu i s p??lohami a jeho kopie vyma?te ze sv?ho syst?mu.
Nejste-li zam??len?m adres?tem tohoto emailu, nejste opr?vn?ni tento email jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu zp?sobenou modifikacemi ?i zpo?d?n?m p?enosu e-mailu.

V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
- vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o uzav?en? smlouvy, a to z jak?hokoliv d?vodu i bez uveden? d?vodu.
- a obsahuje-li nab?dku, je adres?t opr?vn?n nab?dku bezodkladn? p?ijmout; Odes?latel tohoto e-mailu (nab?dky) vylu?uje p?ijet? nab?dky ze strany p??jemce s dodatkem ?i odchylkou.
- trv? odes?latel na tom, ?e p??slu?n? smlouva je uzav?ena teprve v?slovn?m dosa?en?m shody na v?ech jej?ch n?le?itostech.
- odes?latel tohoto emailu informuje, ?e nen? opr?vn?n uzav?rat za spole?nost ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn? zmocn?n nebo p?semn? pov??en a takov? pov??en? nebo pln? moc byly adres?tovi tohoto emailu p??padn? osob?, kterou adres?t zastupuje, p?edlo?eny nebo jejich existence je adres?tovi ?i osob? j?m zastoupen? zn?m?.

This e-mail and any documents attached to it may be confidential and are intended only for its intended recipients.
If you received this e-mail by mistake, please immediately inform its sender. Delete the contents of this e-mail with all attachments and its copies from your system.
If you are not the intended recipient of this e-mail, you are not authorized to use, disseminate, copy or disclose this e-mail in any manner.
The sender of this e-mail shall not be liable for any possible damage caused by modifications of the e-mail or by delay with transfer of the email.

In case that this e-mail forms part of business dealings:
- the sender reserves the right to end negotiations about entering into a contract in any time, for any reason, and without stating any reasoning.
- if the e-mail contains an offer, the recipient is entitled to immediately accept such offer; The sender of this e-mail (offer) excludes any acceptance of the offer on the part of the recipient containing any amendment or variation.
- the sender insists on that the respective contract is concluded only upon an express mutual agreement on all its aspects.
- the sender of this e-mail informs that he/she is not authorized to enter into any contracts on behalf of the company except for cases in which he/she is expressly authorized to do so in writing, and such authorization or power of attorney is submitted to the recipient or the person represented by the recipient, or the existence of such authorization is known to the recipient of the person represented by the recipient.

From maechler at stat.math.ethz.ch  Wed Aug 16 09:41:14 2017
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 16 Aug 2017 09:41:14 +0200
Subject: [Rd] strange behaviour read.table and clipboard
In-Reply-To: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAABF0@SRVEXCHCM301.precheza.cz>
References: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAAB50@SRVEXCHCM301.precheza.cz>
 <da145467-18b0-bc61-e3b1-6f18281d88ac@gmail.com>
 <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAABF0@SRVEXCHCM301.precheza.cz>
Message-ID: <22931.63258.575157.518757@stat.math.ethz.ch>

>>>>> PIKAL Petr <petr.pikal at precheza.cz>
>>>>>     on Wed, 16 Aug 2017 06:25:48 +0000 writes:

    > Hi Duncan The simples spreadsheet is:

    > Put a name in the cell, let say "a1" Put number e.g. 1
    > below "a1" Copy the number to enough rows Select this
    > column and press ctrl-c

    > result is

    >> temp<- read.delim("clipboard") str(temp)
    > 'data.frame': 1513 obs. of 1 variable: $ a1: Factor w/ 2
    > levels "1","a1": 1 1 1 1 1 1 1 1 1 1 ...
    >> which(temp$a1=="a1")
    > [1] 1365
    >> 

To make this much easier to diagnose,
use something like

  str(ll <- readLines("clipboard"))

and do this both in R 3.4.1 (or R 3.4.1 patched) and R-devel.
(very easy if you use Emacs ESS also on Windows and have several
 versions of R installed)

I just did that and both versions of R behaved identically,
i.e., returned the same 'll'

(I've tried with different versions of Copy regions from excel;
 my version of Windows (2008 Server R2, fully uptodate with
 updates) is very different than yours; Office is said to be
 Office 2013).

Martin




    > I tested it in vanilla R

    >> sessionInfo()
    > R Under development (unstable) (2017-07-31 r73003)
    > Platform: x86_64-w64-mingw32/x64 (64-bit) Running under:
    > Windows 10 x64 (build 14393)

    > Matrix products: default

    > locale: [1] LC_COLLATE=Czech_Czech Republic.1250
    > LC_CTYPE=Czech_Czech Republic.1250 [3]
    > LC_MONETARY=Czech_Czech Republic.1250 LC_NUMERIC=C [5]
    > LC_TIME=Czech_Czech Republic.1250

    > attached base packages: [1] stats graphics grDevices utils
    > datasets methods base

    > loaded via a namespace (and not attached): [1]
    > compiler_3.5.0
    >> 

    > Excel 16 or 15 I am not sure.

    > R-devel 2015 (69443) works as expected so it started a
    > believe around May or June this year, when I installed new
    > R version.

    > I hope it could help to trace the problem. If I can help
    > any further, let me know.

    > Best regards Petr



    >> -----Original Message----- From: Duncan Murdoch
    >> [mailto:murdoch.duncan at gmail.com] Sent: Wednesday, August
    >> 16, 2017 12:35 AM To: PIKAL Petr
    >> <petr.pikal at precheza.cz>; r-devel at r-project.org Subject:
    >> Re: [Rd] strange behaviour read.table and clipboard
    >> 
    >> On 15/08/2017 10:03 AM, PIKAL Petr wrote: > Dear all
    >> >
    >> > I used to transfer data from excel to R by simple
    >> ctrl-c and read.delim("clipboard") construction. I know
    >> it is a bad practice but it is easy and for quick
    >> exploratory work it is OK. However after changing to new
    >> R devel few days ago I encountered weird behaviour. I
    >> tried one or two columns.
    >> 
    >> You haven't posted something that is reproducible.  I
    >> don't have Excel, but I can cut and paste from
    >> Libreoffice, and I don't see this.  However, it's not the
    >> same spreadsheet as you used, so I wouldn't be
    >> comfortable saying I did what you did.
    >> 
    >> Please reduce the size of your spreadsheet if you can,
    >> and then post instructions for how to construct it, and
    >> what to cut and paste from it.  Then others can try what
    >> you did and see if this is specific to your machine, to
    >> that particular version of R-devel, to Excel, etc.
    >> 
    >> Duncan Murdoch
    >> 
    >> 
    >> > In case of 2 columns, header is repeated after 526
    >> items >> mar<-read.delim("clipboard") >>
    >> which(mar$a2=="a1") > [1] 525 1051 1577 >>
    >> diff(which(mar$a2=="a1")) > [1] 526 526 > and only first
    >> header item is repeated.
    >> >
    >> > In case of one column, header is repeated after 1107
    >> items
    >> >
    >> >> mar<-read.delim("clipboard") >>
    >> diff(which(mar$a2=="a2")) > [1] 1107 1107
    >> >
    >> > And all items in object are therefore changed to
    >> factor.
    >> >
    >> > BTW, readxl package works on same excel file smoothly.
    >> >
    >> > I will try to download the most recent R version to
    >> check it, but it could take some time due to our IT
    >> issues.
    >> >
    >> > Best regards > Petr
    >> >
    >> >> version > _ > platform x86_64-w64-mingw32 > arch
    >> x86_64 > os mingw32 > system x86_64, mingw32 > status
    >> Under development (unstable) > major 3 > minor 5.0 > year
    >> 2017 > month 07 > day 31 > svn rev 73003 > language R >
    >> version.string R Under development (unstable) (2017-07-31
    >> r73003) > nickname Unsuffered Consequences
    >> >
    >> >
    >> > ________________________________ > Tento e-mail a
    >> jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou
    >> ur?eny pouze jeho adres?t?m.  > Jestli?e jste obdr?el(a)
    >> tento e-mail omylem, informujte laskav? neprodlen? jeho
    >> odes?latele. Obsah tohoto emailu i s p??lohami a jeho
    >> kopie vyma?te ze sv?ho syst?mu.  > Nejste-li zam??len?m
    >> adres?tem tohoto emailu, nejste opr?vn?ni tento email
    >> jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.  >
    >> Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu
    >> zp?sobenou modifikacemi ?i zpo?d?n?m p?enosu e-mailu.
    >> >
    >> > V p??pad?, ?e je tento e-mail sou??st? obchodn?ho
    >> jedn?n?: > - vyhrazuje si odes?latel pr?vo ukon?it
    >> kdykoliv jedn?n? o uzav?en? smlouvy, a to z jak?hokoliv
    >> d?vodu i bez uveden? d?vodu.  > - a obsahuje-li nab?dku,
    >> je adres?t opr?vn?n nab?dku bezodkladn? p?ijmout;
    >> Odes?latel tohoto e-mailu (nab?dky) vylu?uje p?ijet?
    >> nab?dky ze strany p??jemce s dodatkem ?i odchylkou.  > -
    >> trv? odes?latel na tom, ?e p??slu?n? smlouva je uzav?ena
    >> teprve v?slovn?m dosa?en?m shody na v?ech jej?ch
    >> n?le?itostech.  > - odes?latel tohoto emailu informuje,
    >> ?e nen? opr?vn?n uzav?rat za spole?nost ??dn? smlouvy s
    >> v?jimkou p??pad?, kdy k tomu byl p?semn? zmocn?n nebo
    >> p?semn? pov??en a takov? pov??en? nebo pln? moc byly
    >> adres?tovi tohoto emailu p??padn? osob?, kterou adres?t
    >> zastupuje, p?edlo?eny nebo jejich existence je adres?tovi
    >> ?i osob? j?m zastoupen? zn?m?.
    >> >
    >> > This e-mail and any documents attached to it may be
    >> confidential and are intended only for its intended
    >> recipients.  > If you received this e-mail by mistake,
    >> please immediately inform its sender.  Delete the
    >> contents of this e-mail with all attachments and its
    >> copies from your system.  > If you are not the intended
    >> recipient of this e-mail, you are not authorized to use,
    >> disseminate, copy or disclose this e-mail in any manner.
    >> > The sender of this e-mail shall not be liable for any
    >> possible damage caused by modifications of the e-mail or
    >> by delay with transfer of the email.
    >> >
    >> > In case that this e-mail forms part of business
    >> dealings: > - the sender reserves the right to end
    >> negotiations about entering into a contract in any time,
    >> for any reason, and without stating any reasoning.  > -
    >> if the e-mail contains an offer, the recipient is
    >> entitled to immediately accept such offer; The sender of
    >> this e-mail (offer) excludes any acceptance of the offer
    >> on the part of the recipient containing any amendment or
    >> variation.  > - the sender insists on that the respective
    >> contract is concluded only upon an express mutual
    >> agreement on all its aspects.  > - the sender of this
    >> e-mail informs that he/she is not authorized to enter
    >> into any contracts on behalf of the company except for
    >> cases in which he/she is expressly authorized to do so in
    >> writing, and such authorization or power of attorney is
    >> submitted to the recipient or the person represented by
    >> the recipient, or the existence of such authorization is
    >> known to the recipient of the person represented by the
    >> recipient.  >
    >> ______________________________________________ >
    >> R-devel at r-project.org mailing list >
    >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> >


    > ________________________________ Tento e-mail a jak?koliv
    > k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou ur?eny
    > pouze jeho adres?t?m.  Jestli?e jste obdr?el(a) tento
    > e-mail omylem, informujte laskav? neprodlen? jeho
    > odes?latele. Obsah tohoto emailu i s p??lohami a jeho
    > kopie vyma?te ze sv?ho syst?mu.  Nejste-li zam??len?m
    > adres?tem tohoto emailu, nejste opr?vn?ni tento email
    > jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
    > Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu
    > zp?sobenou modifikacemi ?i zpo?d?n?m p?enosu e-mailu.

    > V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
    > - vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o
    > uzav?en? smlouvy, a to z jak?hokoliv d?vodu i bez uveden?
    > d?vodu.  - a obsahuje-li nab?dku, je adres?t opr?vn?n
    > nab?dku bezodkladn? p?ijmout; Odes?latel tohoto e-mailu
    > (nab?dky) vylu?uje p?ijet? nab?dky ze strany p??jemce s
    > dodatkem ?i odchylkou.  - trv? odes?latel na tom, ?e
    > p??slu?n? smlouva je uzav?ena teprve v?slovn?m dosa?en?m
    > shody na v?ech jej?ch n?le?itostech.  - odes?latel tohoto
    > emailu informuje, ?e nen? opr?vn?n uzav?rat za spole?nost
    > ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn?
    > zmocn?n nebo p?semn? pov??en a takov? pov??en? nebo pln?
    > moc byly adres?tovi tohoto emailu p??padn? osob?, kterou
    > adres?t zastupuje, p?edlo?eny nebo jejich existence je
    > adres?tovi ?i osob? j?m zastoupen? zn?m?.

    > This e-mail and any documents attached to it may be
    > confidential and are intended only for its intended
    > recipients.  If you received this e-mail by mistake,
    > please immediately inform its sender. Delete the contents
    > of this e-mail with all attachments and its copies from
    > your system.  If you are not the intended recipient of
    > this e-mail, you are not authorized to use, disseminate,
    > copy or disclose this e-mail in any manner.  The sender of
    > this e-mail shall not be liable for any possible damage
    > caused by modifications of the e-mail or by delay with
    > transfer of the email.

    > In case that this e-mail forms part of business dealings:
    > - the sender reserves the right to end negotiations about
    > entering into a contract in any time, for any reason, and
    > without stating any reasoning.  - if the e-mail contains
    > an offer, the recipient is entitled to immediately accept
    > such offer; The sender of this e-mail (offer) excludes any
    > acceptance of the offer on the part of the recipient
    > containing any amendment or variation.  - the sender
    > insists on that the respective contract is concluded only
    > upon an express mutual agreement on all its aspects.  -
    > the sender of this e-mail informs that he/she is not
    > authorized to enter into any contracts on behalf of the
    > company except for cases in which he/she is expressly
    > authorized to do so in writing, and such authorization or
    > power of attorney is submitted to the recipient or the
    > person represented by the recipient, or the existence of
    > such authorization is known to the recipient of the person
    > represented by the recipient.
    > ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel


From petr.pikal at precheza.cz  Wed Aug 16 10:37:22 2017
From: petr.pikal at precheza.cz (PIKAL Petr)
Date: Wed, 16 Aug 2017 08:37:22 +0000
Subject: [Rd] strange behaviour read.table and clipboard
In-Reply-To: <22931.63258.575157.518757@stat.math.ethz.ch>
References: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAAB50@SRVEXCHCM301.precheza.cz>
 <da145467-18b0-bc61-e3b1-6f18281d88ac@gmail.com>
 <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAABF0@SRVEXCHCM301.precheza.cz>
 <22931.63258.575157.518757@stat.math.ethz.ch>
Message-ID: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAAC5E@SRVEXCHCM301.precheza.cz>

Hi

recent version, and the problem is also in most recent version (r73093 - tested on different PC)

> version
               _
platform       i386-w64-mingw32
arch           i386
os             mingw32
system         i386, mingw32
status         Under development (unstable)
major          3
minor          5.0
year           2017
month          07
day            31
svn rev        73003
language       R
version.string R Under development (unstable) (2017-07-31 r73003)
nickname       Unsuffered Consequences
>

> str(ll <- readLines("clipboard"))
 chr [1:2846] "a1" "1" "1" "1" "1" "1" "1" "1" "1" "1" "1" "1" "1" "1" "1" ...
Warning message:
In readLines("clipboard") : incomplete final line found on 'clipboard'
> diff(which(ll=="a1"))
[1] 1365 1365
>

>

> str(ll <- readLines("clipboard"))
 chr [1:2846] "a1" "1" "1" "1" "1" "1" "1" "1" "1" "1" ...
> diff(which(ll=="a1"))
[1] 1365 1365

================================================================

version 11.01.2017
> version
               _
platform       x86_64-w64-mingw32
arch           x86_64
os             mingw32
system         x86_64, mingw32
status         Under development (unstable)
major          3
minor          4.0
year           2017
month          01
day            11
svn rev        71964
language       R
version.string R Under development (unstable) (2017-01-11 r71964)
nickname       Unsuffered Consequences
> str(ll <- readLines("clipboard"))
 chr "str(ll <- readLines(\"clipboard\"))"
> str(ll <- readLines("clipboard"))
 chr [1:2846] "a1" "1" "1" "1" "1" "1" "1" "1" "1" "1" "1" "1" "1" "1" "1" ...
> diff(which(ll=="a1"))
integer(0)
>

So it works for R-devel version from the beginning of this year.

Cheers
Petr



> -----Original Message-----
> From: Martin Maechler [mailto:maechler at stat.math.ethz.ch]
> Sent: Wednesday, August 16, 2017 9:41 AM
> To: PIKAL Petr <petr.pikal at precheza.cz>
> Cc: Duncan Murdoch <murdoch.duncan at gmail.com>; r-devel at r-project.org
> Subject: Re: [Rd] strange behaviour read.table and clipboard
>
> >>>>> PIKAL Petr <petr.pikal at precheza.cz>
> >>>>>     on Wed, 16 Aug 2017 06:25:48 +0000 writes:
>
>     > Hi Duncan The simples spreadsheet is:
>
>     > Put a name in the cell, let say "a1" Put number e.g. 1
>     > below "a1" Copy the number to enough rows Select this
>     > column and press ctrl-c
>
>     > result is
>
>     >> temp<- read.delim("clipboard") str(temp)
>     > 'data.frame': 1513 obs. of 1 variable: $ a1: Factor w/ 2
>     > levels "1","a1": 1 1 1 1 1 1 1 1 1 1 ...
>     >> which(temp$a1=="a1")
>     > [1] 1365
>     >>
>
> To make this much easier to diagnose,
> use something like
>
>   str(ll <- readLines("clipboard"))
>
> and do this both in R 3.4.1 (or R 3.4.1 patched) and R-devel.
> (very easy if you use Emacs ESS also on Windows and have several  versions of
> R installed)
>
> I just did that and both versions of R behaved identically, i.e., returned the
> same 'll'
>
> (I've tried with different versions of Copy regions from excel;  my version of
> Windows (2008 Server R2, fully uptodate with
>  updates) is very different than yours; Office is said to be  Office 2013).
>
> Martin
>
>
>
>
>     > I tested it in vanilla R
>
>     >> sessionInfo()
>     > R Under development (unstable) (2017-07-31 r73003)
>     > Platform: x86_64-w64-mingw32/x64 (64-bit) Running under:
>     > Windows 10 x64 (build 14393)
>
>     > Matrix products: default
>
>     > locale: [1] LC_COLLATE=Czech_Czech Republic.1250
>     > LC_CTYPE=Czech_Czech Republic.1250 [3]
>     > LC_MONETARY=Czech_Czech Republic.1250 LC_NUMERIC=C [5]
>     > LC_TIME=Czech_Czech Republic.1250
>
>     > attached base packages: [1] stats graphics grDevices utils
>     > datasets methods base
>
>     > loaded via a namespace (and not attached): [1]
>     > compiler_3.5.0
>     >>
>
>     > Excel 16 or 15 I am not sure.
>
>     > R-devel 2015 (69443) works as expected so it started a
>     > believe around May or June this year, when I installed new
>     > R version.
>
>     > I hope it could help to trace the problem. If I can help
>     > any further, let me know.
>
>     > Best regards Petr
>
>
>
>     >> -----Original Message----- From: Duncan Murdoch
>     >> [mailto:murdoch.duncan at gmail.com] Sent: Wednesday, August
>     >> 16, 2017 12:35 AM To: PIKAL Petr
>     >> <petr.pikal at precheza.cz>; r-devel at r-project.org Subject:
>     >> Re: [Rd] strange behaviour read.table and clipboard
>     >>
>     >> On 15/08/2017 10:03 AM, PIKAL Petr wrote: > Dear all
>     >> >
>     >> > I used to transfer data from excel to R by simple
>     >> ctrl-c and read.delim("clipboard") construction. I know
>     >> it is a bad practice but it is easy and for quick
>     >> exploratory work it is OK. However after changing to new
>     >> R devel few days ago I encountered weird behaviour. I
>     >> tried one or two columns.
>     >>
>     >> You haven't posted something that is reproducible.  I
>     >> don't have Excel, but I can cut and paste from
>     >> Libreoffice, and I don't see this.  However, it's not the
>     >> same spreadsheet as you used, so I wouldn't be
>     >> comfortable saying I did what you did.
>     >>
>     >> Please reduce the size of your spreadsheet if you can,
>     >> and then post instructions for how to construct it, and
>     >> what to cut and paste from it.  Then others can try what
>     >> you did and see if this is specific to your machine, to
>     >> that particular version of R-devel, to Excel, etc.
>     >>
>     >> Duncan Murdoch
>     >>
>     >>
>     >> > In case of 2 columns, header is repeated after 526
>     >> items >> mar<-read.delim("clipboard") >>
>     >> which(mar$a2=="a1") > [1] 525 1051 1577 >>
>     >> diff(which(mar$a2=="a1")) > [1] 526 526 > and only first
>     >> header item is repeated.
>     >> >
>     >> > In case of one column, header is repeated after 1107
>     >> items
>     >> >
>     >> >> mar<-read.delim("clipboard") >>
>     >> diff(which(mar$a2=="a2")) > [1] 1107 1107
>     >> >
>     >> > And all items in object are therefore changed to
>     >> factor.
>     >> >
>     >> > BTW, readxl package works on same excel file smoothly.
>     >> >
>     >> > I will try to download the most recent R version to
>     >> check it, but it could take some time due to our IT
>     >> issues.
>     >> >
>     >> > Best regards > Petr
>     >> >
>     >> >> version > _ > platform x86_64-w64-mingw32 > arch
>     >> x86_64 > os mingw32 > system x86_64, mingw32 > status
>     >> Under development (unstable) > major 3 > minor 5.0 > year
>     >> 2017 > month 07 > day 31 > svn rev 73003 > language R >
>     >> version.string R Under development (unstable) (2017-07-31
>     >> r73003) > nickname Unsuffered Consequences
>     >> >
>     >> >
>     >> > ________________________________ > Tento e-mail a
>     >> jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou
>     >> ur?eny pouze jeho adres?t?m.  > Jestli?e jste obdr?el(a)
>     >> tento e-mail omylem, informujte laskav? neprodlen? jeho
>     >> odes?latele. Obsah tohoto emailu i s p??lohami a jeho
>     >> kopie vyma?te ze sv?ho syst?mu.  > Nejste-li zam??len?m
>     >> adres?tem tohoto emailu, nejste opr?vn?ni tento email
>     >> jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.  >
>     >> Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu
>     >> zp?sobenou modifikacemi ?i zpo?d?n?m p?enosu e-mailu.
>     >> >
>     >> > V p??pad?, ?e je tento e-mail sou??st? obchodn?ho
>     >> jedn?n?: > - vyhrazuje si odes?latel pr?vo ukon?it
>     >> kdykoliv jedn?n? o uzav?en? smlouvy, a to z jak?hokoliv
>     >> d?vodu i bez uveden? d?vodu.  > - a obsahuje-li nab?dku,
>     >> je adres?t opr?vn?n nab?dku bezodkladn? p?ijmout;
>     >> Odes?latel tohoto e-mailu (nab?dky) vylu?uje p?ijet?
>     >> nab?dky ze strany p??jemce s dodatkem ?i odchylkou.  > -
>     >> trv? odes?latel na tom, ?e p??slu?n? smlouva je uzav?ena
>     >> teprve v?slovn?m dosa?en?m shody na v?ech jej?ch
>     >> n?le?itostech.  > - odes?latel tohoto emailu informuje,
>     >> ?e nen? opr?vn?n uzav?rat za spole?nost ??dn? smlouvy s
>     >> v?jimkou p??pad?, kdy k tomu byl p?semn? zmocn?n nebo
>     >> p?semn? pov??en a takov? pov??en? nebo pln? moc byly
>     >> adres?tovi tohoto emailu p??padn? osob?, kterou adres?t
>     >> zastupuje, p?edlo?eny nebo jejich existence je adres?tovi
>     >> ?i osob? j?m zastoupen? zn?m?.
>     >> >
>     >> > This e-mail and any documents attached to it may be
>     >> confidential and are intended only for its intended
>     >> recipients.  > If you received this e-mail by mistake,
>     >> please immediately inform its sender.  Delete the
>     >> contents of this e-mail with all attachments and its
>     >> copies from your system.  > If you are not the intended
>     >> recipient of this e-mail, you are not authorized to use,
>     >> disseminate, copy or disclose this e-mail in any manner.
>     >> > The sender of this e-mail shall not be liable for any
>     >> possible damage caused by modifications of the e-mail or
>     >> by delay with transfer of the email.
>     >> >
>     >> > In case that this e-mail forms part of business
>     >> dealings: > - the sender reserves the right to end
>     >> negotiations about entering into a contract in any time,
>     >> for any reason, and without stating any reasoning.  > -
>     >> if the e-mail contains an offer, the recipient is
>     >> entitled to immediately accept such offer; The sender of
>     >> this e-mail (offer) excludes any acceptance of the offer
>     >> on the part of the recipient containing any amendment or
>     >> variation.  > - the sender insists on that the respective
>     >> contract is concluded only upon an express mutual
>     >> agreement on all its aspects.  > - the sender of this
>     >> e-mail informs that he/she is not authorized to enter
>     >> into any contracts on behalf of the company except for
>     >> cases in which he/she is expressly authorized to do so in
>     >> writing, and such authorization or power of attorney is
>     >> submitted to the recipient or the person represented by
>     >> the recipient, or the existence of such authorization is
>     >> known to the recipient of the person represented by the
>     >> recipient.  >
>     >> ______________________________________________ >
>     >> R-devel at r-project.org mailing list >
>     >> https://stat.ethz.ch/mailman/listinfo/r-devel
>     >> >
>
>
>     > ________________________________ Tento e-mail a jak?koliv
>     > k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou ur?eny
>     > pouze jeho adres?t?m.  Jestli?e jste obdr?el(a) tento
>     > e-mail omylem, informujte laskav? neprodlen? jeho
>     > odes?latele. Obsah tohoto emailu i s p??lohami a jeho
>     > kopie vyma?te ze sv?ho syst?mu.  Nejste-li zam??len?m
>     > adres?tem tohoto emailu, nejste opr?vn?ni tento email
>     > jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
>     > Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu
>     > zp?sobenou modifikacemi ?i zpo?d?n?m p?enosu e-mailu.
>
>     > V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
>     > - vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o
>     > uzav?en? smlouvy, a to z jak?hokoliv d?vodu i bez uveden?
>     > d?vodu.  - a obsahuje-li nab?dku, je adres?t opr?vn?n
>     > nab?dku bezodkladn? p?ijmout; Odes?latel tohoto e-mailu
>     > (nab?dky) vylu?uje p?ijet? nab?dky ze strany p??jemce s
>     > dodatkem ?i odchylkou.  - trv? odes?latel na tom, ?e
>     > p??slu?n? smlouva je uzav?ena teprve v?slovn?m dosa?en?m
>     > shody na v?ech jej?ch n?le?itostech.  - odes?latel tohoto
>     > emailu informuje, ?e nen? opr?vn?n uzav?rat za spole?nost
>     > ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn?
>     > zmocn?n nebo p?semn? pov??en a takov? pov??en? nebo pln?
>     > moc byly adres?tovi tohoto emailu p??padn? osob?, kterou
>     > adres?t zastupuje, p?edlo?eny nebo jejich existence je
>     > adres?tovi ?i osob? j?m zastoupen? zn?m?.
>
>     > This e-mail and any documents attached to it may be
>     > confidential and are intended only for its intended
>     > recipients.  If you received this e-mail by mistake,
>     > please immediately inform its sender. Delete the contents
>     > of this e-mail with all attachments and its copies from
>     > your system.  If you are not the intended recipient of
>     > this e-mail, you are not authorized to use, disseminate,
>     > copy or disclose this e-mail in any manner.  The sender of
>     > this e-mail shall not be liable for any possible damage
>     > caused by modifications of the e-mail or by delay with
>     > transfer of the email.
>
>     > In case that this e-mail forms part of business dealings:
>     > - the sender reserves the right to end negotiations about
>     > entering into a contract in any time, for any reason, and
>     > without stating any reasoning.  - if the e-mail contains
>     > an offer, the recipient is entitled to immediately accept
>     > such offer; The sender of this e-mail (offer) excludes any
>     > acceptance of the offer on the part of the recipient
>     > containing any amendment or variation.  - the sender
>     > insists on that the respective contract is concluded only
>     > upon an express mutual agreement on all its aspects.  -
>     > the sender of this e-mail informs that he/she is not
>     > authorized to enter into any contracts on behalf of the
>     > company except for cases in which he/she is expressly
>     > authorized to do so in writing, and such authorization or
>     > power of attorney is submitted to the recipient or the
>     > person represented by the recipient, or the existence of
>     > such authorization is known to the recipient of the person
>     > represented by the recipient.
>     > ______________________________________________
>     > R-devel at r-project.org mailing list
>     > https://stat.ethz.ch/mailman/listinfo/r-devel

________________________________
Tento e-mail a jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou ur?eny pouze jeho adres?t?m.
Jestli?e jste obdr?el(a) tento e-mail omylem, informujte laskav? neprodlen? jeho odes?latele. Obsah tohoto emailu i s p??lohami a jeho kopie vyma?te ze sv?ho syst?mu.
Nejste-li zam??len?m adres?tem tohoto emailu, nejste opr?vn?ni tento email jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu zp?sobenou modifikacemi ?i zpo?d?n?m p?enosu e-mailu.

V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
- vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o uzav?en? smlouvy, a to z jak?hokoliv d?vodu i bez uveden? d?vodu.
- a obsahuje-li nab?dku, je adres?t opr?vn?n nab?dku bezodkladn? p?ijmout; Odes?latel tohoto e-mailu (nab?dky) vylu?uje p?ijet? nab?dky ze strany p??jemce s dodatkem ?i odchylkou.
- trv? odes?latel na tom, ?e p??slu?n? smlouva je uzav?ena teprve v?slovn?m dosa?en?m shody na v?ech jej?ch n?le?itostech.
- odes?latel tohoto emailu informuje, ?e nen? opr?vn?n uzav?rat za spole?nost ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn? zmocn?n nebo p?semn? pov??en a takov? pov??en? nebo pln? moc byly adres?tovi tohoto emailu p??padn? osob?, kterou adres?t zastupuje, p?edlo?eny nebo jejich existence je adres?tovi ?i osob? j?m zastoupen? zn?m?.

This e-mail and any documents attached to it may be confidential and are intended only for its intended recipients.
If you received this e-mail by mistake, please immediately inform its sender. Delete the contents of this e-mail with all attachments and its copies from your system.
If you are not the intended recipient of this e-mail, you are not authorized to use, disseminate, copy or disclose this e-mail in any manner.
The sender of this e-mail shall not be liable for any possible damage caused by modifications of the e-mail or by delay with transfer of the email.

In case that this e-mail forms part of business dealings:
- the sender reserves the right to end negotiations about entering into a contract in any time, for any reason, and without stating any reasoning.
- if the e-mail contains an offer, the recipient is entitled to immediately accept such offer; The sender of this e-mail (offer) excludes any acceptance of the offer on the part of the recipient containing any amendment or variation.
- the sender insists on that the respective contract is concluded only upon an express mutual agreement on all its aspects.
- the sender of this e-mail informs that he/she is not authorized to enter into any contracts on behalf of the company except for cases in which he/she is expressly authorized to do so in writing, and such authorization or power of attorney is submitted to the recipient or the person represented by the recipient, or the existence of such authorization is known to the recipient of the person represented by the recipient.


From petr.pikal at precheza.cz  Wed Aug 16 12:49:35 2017
From: petr.pikal at precheza.cz (PIKAL Petr)
Date: Wed, 16 Aug 2017 10:49:35 +0000
Subject: [Rd] strange behaviour read.table and clipboard
In-Reply-To: <22932.6089.568293.479188@stat.math.ethz.ch>
References: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAAB50@SRVEXCHCM301.precheza.cz>
 <da145467-18b0-bc61-e3b1-6f18281d88ac@gmail.com>
 <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAABF0@SRVEXCHCM301.precheza.cz>
 <22931.63258.575157.518757@stat.math.ethz.ch>
 <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAAC5E@SRVEXCHCM301.precheza.cz>
 <22932.6089.568293.479188@stat.math.ethz.ch>
Message-ID: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAAD23@SRVEXCHCM301.precheza.cz>

Hi

> -----Original Message-----
> From: Martin Maechler [mailto:maechler at stat.math.ethz.ch]
> Sent: Wednesday, August 16, 2017 12:01 PM
> To: PIKAL Petr <petr.pikal at precheza.cz>
> Cc: Martin Maechler <maechler at stat.math.ethz.ch>; Duncan Murdoch
> <murdoch.duncan at gmail.com>
> Subject: RE: [Rd] strange behaviour read.table and clipboard
>
> (not to R-devel)
>
> More questions, please answer to R-devel:
>
> - Does it show the problem only with such a long column?
> [- if yes, is really 2846 the minimal number which shows the problem? ]
>
There is certain minimal number of rows/items after which this feature/bug appears.

For 2 columns it appears after 525 rows in case of whole numbers, but in case fractional numbers it appears after 235 rows.

> - Can you make a minimally small *.xls file available on the
>   web, so that other R Windows users can try?

https://drive.google.com/open?id=0B-hUB8Dm7X_VaWhtdDFoaVMxWWc

Cheers
Petr

>
> - In addition to  diff(which(ll == "a1"))
>
>      table(ll)
>
>   maybe a bit more revealing
>
>   ((and 'll' was a bad variable name I've chosen;
>        'l' ("ell") is too easily confused with '1' ("one")))
>
> Thank you, Petr,
> Martin
>
>
> >>>>> PIKAL Petr <petr.pikal at precheza.cz>
> >>>>>     on Wed, 16 Aug 2017 08:37:22 +0000 writes:
>
>     > Hi recent version, and the problem is also in most recent
>     > version (r73093 - tested on different PC)
>
>     >> version
>     >                _ platform i386-w64-mingw32 arch i386 os
>     > mingw32 system i386, mingw32 status Under development
>     > (unstable) major 3 minor 5.0 year 2017 month 07 day 31 svn
>     > rev 73003 language R version.string R Under development
>     > (unstable) (2017-07-31 r73003) nickname Unsuffered
>     > Consequences
>     >>
>
>     >> str(ll <- readLines("clipboard"))
>     >  chr [1:2846] "a1" "1" "1" "1" "1" "1" "1" "1" "1" "1" "1"
>     > "1" "1" "1" "1" ...  Warning message: In
>     > readLines("clipboard") : incomplete final line found on
>     > 'clipboard'
>     >> diff(which(ll=="a1"))
>     > [1] 1365 1365
>     >>
>
>     >>
>
>     >> str(ll <- readLines("clipboard"))
>     >  chr [1:2846] "a1" "1" "1" "1" "1" "1" "1" "1" "1" "1" ...
>     >> diff(which(ll=="a1"))
>     > [1] 1365 1365
>
>     >
> ================================================================
>
>     > version 11.01.2017
>     >> version
>     >                _ platform x86_64-w64-mingw32 arch x86_64
>     > os mingw32 system x86_64, mingw32 status Under development
>     > (unstable) major 3 minor 4.0 year 2017 month 01 day 11 svn
>     > rev 71964 language R version.string R Under development
>     > (unstable) (2017-01-11 r71964) nickname Unsuffered
>     > Consequences
>     >> str(ll <- readLines("clipboard"))
>     >  chr "str(ll <- readLines(\"clipboard\"))"
>     >> str(ll <- readLines("clipboard"))
>     >  chr [1:2846] "a1" "1" "1" "1" "1" "1" "1" "1" "1" "1" "1"
>     > "1" "1" "1" "1" ...
>     >> diff(which(ll=="a1"))
>     > integer(0)
>     >>
>
>     > So it works for R-devel version from the beginning of this
>     > year.
>
>     > Cheers Petr
>
>
>
>     >> -----Original Message----- From: Martin Maechler
>     >> [mailto:maechler at stat.math.ethz.ch] Sent: Wednesday,
>     >> August 16, 2017 9:41 AM To: PIKAL Petr
>     >> <petr.pikal at precheza.cz> Cc: Duncan Murdoch
>     >> <murdoch.duncan at gmail.com>; r-devel at r-project.org
>     >> Subject: Re: [Rd] strange behaviour read.table and
>     >> clipboard
>     >>
>     >> >>>>> PIKAL Petr <petr.pikal at precheza.cz> >>>>> on Wed,
>     >> 16 Aug 2017 06:25:48 +0000 writes:
>     >>
>     >> > Hi Duncan The simples spreadsheet is:
>     >>
>     >> > Put a name in the cell, let say "a1" Put number e.g. 1
>     >> > below "a1" Copy the number to enough rows Select this >
>     >> column and press ctrl-c
>     >>
>     >> > result is
>     >>
>     >> >> temp<- read.delim("clipboard") str(temp) >
>     >> 'data.frame': 1513 obs. of 1 variable: $ a1: Factor w/ 2
>     >> > levels "1","a1": 1 1 1 1 1 1 1 1 1 1 ...  >>
>     >> which(temp$a1=="a1") > [1] 1365
>     >> >>
>     >>
>     >> To make this much easier to diagnose, use something like
>     >>
>     >> str(ll <- readLines("clipboard"))
>     >>
>     >> and do this both in R 3.4.1 (or R 3.4.1 patched) and
>     >> R-devel.  (very easy if you use Emacs ESS also on Windows
>     >> and have several versions of R installed)
>     >>
>     >> I just did that and both versions of R behaved
>     >> identically, i.e., returned the same 'll'
>     >>
>     >> (I've tried with different versions of Copy regions from
>     >> excel; my version of Windows (2008 Server R2, fully
>     >> uptodate with updates) is very different than yours;
>     >> Office is said to be Office 2013).
>     >>
>     >> Martin
>     >>
>     >>
>     >>
>     >>
>     >> > I tested it in vanilla R
>     >>
>     >> >> sessionInfo() > R Under development (unstable)
>     >> (2017-07-31 r73003) > Platform: x86_64-w64-mingw32/x64
>     >> (64-bit) Running under: > Windows 10 x64 (build 14393)
>     >>
>     >> > Matrix products: default
>     >>
>     >> > locale: [1] LC_COLLATE=Czech_Czech Republic.1250 >
>     >> LC_CTYPE=Czech_Czech Republic.1250 [3] >
>     >> LC_MONETARY=Czech_Czech Republic.1250 LC_NUMERIC=C [5] >
>     >> LC_TIME=Czech_Czech Republic.1250
>     >>
>     >> > attached base packages: [1] stats graphics grDevices
>     >> utils > datasets methods base
>     >>
>     >> > loaded via a namespace (and not attached): [1] >
>     >> compiler_3.5.0
>     >> >>
>     >>
>     >> > Excel 16 or 15 I am not sure.
>     >>
>     >> > R-devel 2015 (69443) works as expected so it started a
>     >> > believe around May or June this year, when I installed
>     >> new > R version.
>     >>
>     >> > I hope it could help to trace the problem. If I can
>     >> help > any further, let me know.
>     >>
>     >> > Best regards Petr
>     >>
>     >>
>     >>
>     >> >> -----Original Message----- From: Duncan Murdoch >>
>     >> [mailto:murdoch.duncan at gmail.com] Sent: Wednesday, August
>     >> >> 16, 2017 12:35 AM To: PIKAL Petr >>
>     >> <petr.pikal at precheza.cz>; r-devel at r-project.org Subject:
>     >> >> Re: [Rd] strange behaviour read.table and clipboard
>     >> >>
>     >> >> On 15/08/2017 10:03 AM, PIKAL Petr wrote: > Dear all
>     >> >> >
>     >> >> > I used to transfer data from excel to R by simple >>
>     >> ctrl-c and read.delim("clipboard") construction. I know
>     >> >> it is a bad practice but it is easy and for quick >>
>     >> exploratory work it is OK. However after changing to new
>     >> >> R devel few days ago I encountered weird behaviour. I
>     >> >> tried one or two columns.
>     >> >>
>     >> >> You haven't posted something that is reproducible.  I
>     >> >> don't have Excel, but I can cut and paste from >>
>     >> Libreoffice, and I don't see this.  However, it's not the
>     >> >> same spreadsheet as you used, so I wouldn't be >>
>     >> comfortable saying I did what you did.
>     >> >>
>     >> >> Please reduce the size of your spreadsheet if you can,
>     >> >> and then post instructions for how to construct it,
>     >> and >> what to cut and paste from it.  Then others can
>     >> try what >> you did and see if this is specific to your
>     >> machine, to >> that particular version of R-devel, to
>     >> Excel, etc.
>     >> >>
>     >> >> Duncan Murdoch
>     >> >>
>     >> >>
>     >> >> > In case of 2 columns, header is repeated after 526
>     >> >> items >> mar<-read.delim("clipboard") >> >>
>     >> which(mar$a2=="a1") > [1] 525 1051 1577 >> >>
>     >> diff(which(mar$a2=="a1")) > [1] 526 526 > and only first
>     >> >> header item is repeated.
>     >> >> >
>     >> >> > In case of one column, header is repeated after 1107
>     >> >> items
>     >> >> >
>     >> >> >> mar<-read.delim("clipboard") >> >>
>     >> diff(which(mar$a2=="a2")) > [1] 1107 1107
>     >> >> >
>     >> >> > And all items in object are therefore changed to >>
>     >> factor.
>     >> >> >
>     >> >> > BTW, readxl package works on same excel file
>     >> smoothly.
>     >> >> >
>     >> >> > I will try to download the most recent R version to
>     >> >> check it, but it could take some time due to our IT >>
>     >> issues.
>     >> >> >
>     >> >> > Best regards > Petr
>     >> >> >
>     >> >> >> version > _ > platform x86_64-w64-mingw32 > arch >>
>     >> x86_64 > os mingw32 > system x86_64, mingw32 > status >>
>     >> Under development (unstable) > major 3 > minor 5.0 > year
>     >> >> 2017 > month 07 > day 31 > svn rev 73003 > language R
>     >> > >> version.string R Under development (unstable)
>     >> (2017-07-31 >> r73003) > nickname Unsuffered Consequences
>     >> >> >
>     >> >> >
>     >> >> > ________________________________ > Tento e-mail a >>
>     >> jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou
>     >> >> ur?eny pouze jeho adres?t?m.  > Jestli?e jste
>     >> obdr?el(a) >> tento e-mail omylem, informujte laskav?
>     >> neprodlen? jeho >> odes?latele. Obsah tohoto emailu i s
>     >> p??lohami a jeho >> kopie vyma?te ze sv?ho syst?mu.  >
>     >> Nejste-li zam??len?m >> adres?tem tohoto emailu, nejste
>     >> opr?vn?ni tento email >> jakkoliv u??vat, roz?i?ovat,
>     >> kop?rovat ?i zve?ej?ovat.  > >> Odes?latel e-mailu
>     >> neodpov?d? za eventu?ln? ?kodu >> zp?sobenou modifikacemi
>     >> ?i zpo?d?n?m p?enosu e-mailu.
>     >> >> >
>     >> >> > V p??pad?, ?e je tento e-mail sou??st? obchodn?ho >>
>     >> jedn?n?: > - vyhrazuje si odes?latel pr?vo ukon?it >>
>     >> kdykoliv jedn?n? o uzav?en? smlouvy, a to z jak?hokoliv
>     >> >> d?vodu i bez uveden? d?vodu.  > - a obsahuje-li
>     >> nab?dku, >> je adres?t opr?vn?n nab?dku bezodkladn?
>     >> p?ijmout; >> Odes?latel tohoto e-mailu (nab?dky) vylu?uje
>     >> p?ijet? >> nab?dky ze strany p??jemce s dodatkem ?i
>     >> odchylkou.  > - >> trv? odes?latel na tom, ?e p??slu?n?
>     >> smlouva je uzav?ena >> teprve v?slovn?m dosa?en?m shody
>     >> na v?ech jej?ch >> n?le?itostech.  > - odes?latel tohoto
>     >> emailu informuje, >> ?e nen? opr?vn?n uzav?rat za
>     >> spole?nost ??dn? smlouvy s >> v?jimkou p??pad?, kdy k
>     >> tomu byl p?semn? zmocn?n nebo >> p?semn? pov??en a takov?
>     >> pov??en? nebo pln? moc byly >> adres?tovi tohoto emailu
>     >> p??padn? osob?, kterou adres?t >> zastupuje, p?edlo?eny
>     >> nebo jejich existence je adres?tovi >> ?i osob? j?m
>     >> zastoupen? zn?m?.
>     >> >> >
>     >> >> > This e-mail and any documents attached to it may be
>     >> >> confidential and are intended only for its intended >>
>     >> recipients.  > If you received this e-mail by mistake, >>
>     >> please immediately inform its sender.  Delete the >>
>     >> contents of this e-mail with all attachments and its >>
>     >> copies from your system.  > If you are not the intended
>     >> >> recipient of this e-mail, you are not authorized to
>     >> use, >> disseminate, copy or disclose this e-mail in any
>     >> manner.  >> > The sender of this e-mail shall not be
>     >> liable for any >> possible damage caused by modifications
>     >> of the e-mail or >> by delay with transfer of the email.
>     >> >> >
>     >> >> > In case that this e-mail forms part of business >>
>     >> dealings: > - the sender reserves the right to end >>
>     >> negotiations about entering into a contract in any time,
>     >> >> for any reason, and without stating any reasoning.  >
>     >> - >> if the e-mail contains an offer, the recipient is >>
>     >> entitled to immediately accept such offer; The sender of
>     >> >> this e-mail (offer) excludes any acceptance of the
>     >> offer >> on the part of the recipient containing any
>     >> amendment or >> variation.  > - the sender insists on
>     >> that the respective >> contract is concluded only upon an
>     >> express mutual >> agreement on all its aspects.  > - the
>     >> sender of this >> e-mail informs that he/she is not
>     >> authorized to enter >> into any contracts on behalf of
>     >> the company except for >> cases in which he/she is
>     >> expressly authorized to do so in >> writing, and such
>     >> authorization or power of attorney is >> submitted to the
>     >> recipient or the person represented by >> the recipient,
>     >> or the existence of such authorization is >> known to the
>     >> recipient of the person represented by the >> recipient.
>     >> > >> ______________________________________________ > >>
>     >> R-devel at r-project.org mailing list > >>
>     >> https://stat.ethz.ch/mailman/listinfo/r-devel
>     >> >> >
>     >>
>     >>
>     >> > ________________________________ Tento e-mail a
>     >> jak?koliv > k n?mu p?ipojen? dokumenty jsou d?v?rn? a
>     >> jsou ur?eny > pouze jeho adres?t?m.  Jestli?e jste
>     >> obdr?el(a) tento > e-mail omylem, informujte laskav?
>     >> neprodlen? jeho > odes?latele. Obsah tohoto emailu i s
>     >> p??lohami a jeho > kopie vyma?te ze sv?ho syst?mu.
>     >> Nejste-li zam??len?m > adres?tem tohoto emailu, nejste
>     >> opr?vn?ni tento email > jakkoliv u??vat, roz?i?ovat,
>     >> kop?rovat ?i zve?ej?ovat.  > Odes?latel e-mailu
>     >> neodpov?d? za eventu?ln? ?kodu > zp?sobenou modifikacemi
>     >> ?i zpo?d?n?m p?enosu e-mailu.
>     >>
>     >> > V p??pad?, ?e je tento e-mail sou??st? obchodn?ho
>     >> jedn?n?: > - vyhrazuje si odes?latel pr?vo ukon?it
>     >> kdykoliv jedn?n? o > uzav?en? smlouvy, a to z jak?hokoliv
>     >> d?vodu i bez uveden? > d?vodu.  - a obsahuje-li nab?dku,
>     >> je adres?t opr?vn?n > nab?dku bezodkladn? p?ijmout;
>     >> Odes?latel tohoto e-mailu > (nab?dky) vylu?uje p?ijet?
>     >> nab?dky ze strany p??jemce s > dodatkem ?i odchylkou.  -
>     >> trv? odes?latel na tom, ?e > p??slu?n? smlouva je
>     >> uzav?ena teprve v?slovn?m dosa?en?m > shody na v?ech
>     >> jej?ch n?le?itostech.  - odes?latel tohoto > emailu
>     >> informuje, ?e nen? opr?vn?n uzav?rat za spole?nost >
>     >> ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn?
>     >> > zmocn?n nebo p?semn? pov??en a takov? pov??en? nebo
>     >> pln? > moc byly adres?tovi tohoto emailu p??padn? osob?,
>     >> kterou > adres?t zastupuje, p?edlo?eny nebo jejich
>     >> existence je > adres?tovi ?i osob? j?m zastoupen? zn?m?.
>     >>
>     >> > This e-mail and any documents attached to it may be >
>     >> confidential and are intended only for its intended >
>     >> recipients.  If you received this e-mail by mistake, >
>     >> please immediately inform its sender. Delete the contents
>     >> > of this e-mail with all attachments and its copies from
>     >> > your system.  If you are not the intended recipient of
>     >> > this e-mail, you are not authorized to use,
>     >> disseminate, > copy or disclose this e-mail in any
>     >> manner.  The sender of > this e-mail shall not be liable
>     >> for any possible damage > caused by modifications of the
>     >> e-mail or by delay with > transfer of the email.
>     >>
>     >> > In case that this e-mail forms part of business
>     >> dealings: > - the sender reserves the right to end
>     >> negotiations about > entering into a contract in any
>     >> time, for any reason, and > without stating any
>     >> reasoning.  - if the e-mail contains > an offer, the
>     >> recipient is entitled to immediately accept > such offer;
>     >> The sender of this e-mail (offer) excludes any >
>     >> acceptance of the offer on the part of the recipient >
>     >> containing any amendment or variation.  - the sender >
>     >> insists on that the respective contract is concluded only
>     >> > upon an express mutual agreement on all its aspects.  -
>     >> > the sender of this e-mail informs that he/she is not >
>     >> authorized to enter into any contracts on behalf of the >
>     >> company except for cases in which he/she is expressly >
>     >> authorized to do so in writing, and such authorization or
>     >> > power of attorney is submitted to the recipient or the
>     >> > person represented by the recipient, or the existence
>     >> of > such authorization is known to the recipient of the
>     >> person > represented by the recipient.  >
>     >> ______________________________________________ >
>     >> R-devel at r-project.org mailing list >
>     >> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>     > ________________________________ Tento e-mail a jak?koliv
>     > k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou ur?eny
>     > pouze jeho adres?t?m.  Jestli?e jste obdr?el(a) tento
>     > e-mail omylem, informujte laskav? neprodlen? jeho
>     > odes?latele. Obsah tohoto emailu i s p??lohami a jeho
>     > kopie vyma?te ze sv?ho syst?mu.  Nejste-li zam??len?m
>     > adres?tem tohoto emailu, nejste opr?vn?ni tento email
>     > jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
>     > Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu
>     > zp?sobenou modifikacemi ?i zpo?d?n?m p?enosu e-mailu.
>
>     > V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
>     > - vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o
>     > uzav?en? smlouvy, a to z jak?hokoliv d?vodu i bez uveden?
>     > d?vodu.  - a obsahuje-li nab?dku, je adres?t opr?vn?n
>     > nab?dku bezodkladn? p?ijmout; Odes?latel tohoto e-mailu
>     > (nab?dky) vylu?uje p?ijet? nab?dky ze strany p??jemce s
>     > dodatkem ?i odchylkou.  - trv? odes?latel na tom, ?e
>     > p??slu?n? smlouva je uzav?ena teprve v?slovn?m dosa?en?m
>     > shody na v?ech jej?ch n?le?itostech.  - odes?latel tohoto
>     > emailu informuje, ?e nen? opr?vn?n uzav?rat za spole?nost
>     > ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn?
>     > zmocn?n nebo p?semn? pov??en a takov? pov??en? nebo pln?
>     > moc byly adres?tovi tohoto emailu p??padn? osob?, kterou
>     > adres?t zastupuje, p?edlo?eny nebo jejich existence je
>     > adres?tovi ?i osob? j?m zastoupen? zn?m?.
>
>     > This e-mail and any documents attached to it may be
>     > confidential and are intended only for its intended
>     > recipients.  If you received this e-mail by mistake,
>     > please immediately inform its sender. Delete the contents
>     > of this e-mail with all attachments and its copies from
>     > your system.  If you are not the intended recipient of
>     > this e-mail, you are not authorized to use, disseminate,
>     > copy or disclose this e-mail in any manner.  The sender of
>     > this e-mail shall not be liable for any possible damage
>     > caused by modifications of the e-mail or by delay with
>     > transfer of the email.
>
>     > In case that this e-mail forms part of business dealings:
>     > - the sender reserves the right to end negotiations about
>     > entering into a contract in any time, for any reason, and
>     > without stating any reasoning.  - if the e-mail contains
>     > an offer, the recipient is entitled to immediately accept
>     > such offer; The sender of this e-mail (offer) excludes any
>     > acceptance of the offer on the part of the recipient
>     > containing any amendment or variation.  - the sender
>     > insists on that the respective contract is concluded only
>     > upon an express mutual agreement on all its aspects.  -
>     > the sender of this e-mail informs that he/she is not
>     > authorized to enter into any contracts on behalf of the
>     > company except for cases in which he/she is expressly
>     > authorized to do so in writing, and such authorization or
>     > power of attorney is submitted to the recipient or the
>     > person represented by the recipient, or the existence of
>     > such authorization is known to the recipient of the person
>     > represented by the recipient.

________________________________
Tento e-mail a jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou ur?eny pouze jeho adres?t?m.
Jestli?e jste obdr?el(a) tento e-mail omylem, informujte laskav? neprodlen? jeho odes?latele. Obsah tohoto emailu i s p??lohami a jeho kopie vyma?te ze sv?ho syst?mu.
Nejste-li zam??len?m adres?tem tohoto emailu, nejste opr?vn?ni tento email jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu zp?sobenou modifikacemi ?i zpo?d?n?m p?enosu e-mailu.

V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
- vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o uzav?en? smlouvy, a to z jak?hokoliv d?vodu i bez uveden? d?vodu.
- a obsahuje-li nab?dku, je adres?t opr?vn?n nab?dku bezodkladn? p?ijmout; Odes?latel tohoto e-mailu (nab?dky) vylu?uje p?ijet? nab?dky ze strany p??jemce s dodatkem ?i odchylkou.
- trv? odes?latel na tom, ?e p??slu?n? smlouva je uzav?ena teprve v?slovn?m dosa?en?m shody na v?ech jej?ch n?le?itostech.
- odes?latel tohoto emailu informuje, ?e nen? opr?vn?n uzav?rat za spole?nost ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn? zmocn?n nebo p?semn? pov??en a takov? pov??en? nebo pln? moc byly adres?tovi tohoto emailu p??padn? osob?, kterou adres?t zastupuje, p?edlo?eny nebo jejich existence je adres?tovi ?i osob? j?m zastoupen? zn?m?.

This e-mail and any documents attached to it may be confidential and are intended only for its intended recipients.
If you received this e-mail by mistake, please immediately inform its sender. Delete the contents of this e-mail with all attachments and its copies from your system.
If you are not the intended recipient of this e-mail, you are not authorized to use, disseminate, copy or disclose this e-mail in any manner.
The sender of this e-mail shall not be liable for any possible damage caused by modifications of the e-mail or by delay with transfer of the email.

In case that this e-mail forms part of business dealings:
- the sender reserves the right to end negotiations about entering into a contract in any time, for any reason, and without stating any reasoning.
- if the e-mail contains an offer, the recipient is entitled to immediately accept such offer; The sender of this e-mail (offer) excludes any acceptance of the offer on the part of the recipient containing any amendment or variation.
- the sender insists on that the respective contract is concluded only upon an express mutual agreement on all its aspects.
- the sender of this e-mail informs that he/she is not authorized to enter into any contracts on behalf of the company except for cases in which he/she is expressly authorized to do so in writing, and such authorization or power of attorney is submitted to the recipient or the person represented by the recipient, or the existence of such authorization is known to the recipient of the person represented by the recipient.


From rbaer at atsu.edu  Wed Aug 16 15:03:37 2017
From: rbaer at atsu.edu (Robert Baer)
Date: Wed, 16 Aug 2017 08:03:37 -0500
Subject: [Rd] strange behaviour read.table and clipboard
In-Reply-To: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAABF0@SRVEXCHCM301.precheza.cz>
References: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAAB50@SRVEXCHCM301.precheza.cz>
 <da145467-18b0-bc61-e3b1-6f18281d88ac@gmail.com>
 <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAABF0@SRVEXCHCM301.precheza.cz>
Message-ID: <e6fd3266-28fb-6836-40e3-90743aecb2db@atsu.edu>

You said, "put a name in the cell".  Does that mean you forgot a header 
= TRUE?



On 8/16/2017 1:25 AM, PIKAL Petr wrote:
> Hi Duncan
>
> The simples spreadsheet is:
>
> Put a name in the cell, let say "a1"
> Put number e.g. 1 below "a1"
> Copy the number to enough rows
> Select this column and press ctrl-c
>
> result is
>
>> temp<- read.delim("clipboard")
>> str(temp)
> 'data.frame':   1513 obs. of  1 variable:
>   $ a1: Factor w/ 2 levels "1","a1": 1 1 1 1 1 1 1 1 1 1 ...
>> which(temp$a1=="a1")
> [1] 1365
> I tested it in vanilla R
>
>> sessionInfo()
> R Under development (unstable) (2017-07-31 r73003)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 10 x64 (build 14393)
>
> Matrix products: default
>
> locale:
> [1] LC_COLLATE=Czech_Czech Republic.1250  LC_CTYPE=Czech_Czech Republic.1250
> [3] LC_MONETARY=Czech_Czech Republic.1250 LC_NUMERIC=C
> [5] LC_TIME=Czech_Czech Republic.1250
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> loaded via a namespace (and not attached):
> [1] compiler_3.5.0
> Excel 16 or 15 I am not sure.
>
> R-devel 2015 (69443) works as expected so it started a believe around May or June this year, when I installed new R version.
>
> I hope it could help to trace the problem. If I can help any further, let me know.
>
> Best regards
> Petr
>
>
>
>> -----Original Message-----
>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>> Sent: Wednesday, August 16, 2017 12:35 AM
>> To: PIKAL Petr <petr.pikal at precheza.cz>; r-devel at r-project.org
>> Subject: Re: [Rd] strange behaviour read.table and clipboard
>>
>> On 15/08/2017 10:03 AM, PIKAL Petr wrote:
>>> Dear all
>>>
>>> I used to transfer data from excel to R by simple ctrl-c and
>> read.delim("clipboard") construction. I know it is a bad practice but it is easy
>> and for quick exploratory work it is OK. However after changing to new R devel
>> few days ago I encountered weird behaviour. I tried one or two columns.
>>
>> You haven't posted something that is reproducible.  I don't have Excel, but I can
>> cut and paste from Libreoffice, and I don't see this.
>> However, it's not the same spreadsheet as you used, so I wouldn't be
>> comfortable saying I did what you did.
>>
>> Please reduce the size of your spreadsheet if you can, and then post
>> instructions for how to construct it, and what to cut and paste from it.
>>    Then others can try what you did and see if this is specific to your machine, to
>> that particular version of R-devel, to Excel, etc.
>>
>> Duncan Murdoch
>>
>>
>>> In case of 2 columns, header is repeated after 526 items
>>>> mar<-read.delim("clipboard")
>>>> which(mar$a2=="a1")
>>> [1]  525 1051 1577
>>>> diff(which(mar$a2=="a1"))
>>> [1] 526 526
>>> and only first header item is repeated.
>>>
>>> In case of one column, header is repeated after 1107 items
>>>
>>>> mar<-read.delim("clipboard")
>>>> diff(which(mar$a2=="a2"))
>>> [1] 1107 1107
>>>
>>> And all items in object are therefore changed to factor.
>>>
>>> BTW, readxl package works on same excel file smoothly.
>>>
>>> I will try to download the most recent R version to check it, but it could take
>> some time due to our IT issues.
>>> Best regards
>>> Petr
>>>
>>>> version
>>>                 _
>>> platform       x86_64-w64-mingw32
>>> arch           x86_64
>>> os             mingw32
>>> system         x86_64, mingw32
>>> status         Under development (unstable)
>>> major          3
>>> minor          5.0
>>> year           2017
>>> month          07
>>> day            31
>>> svn rev        73003
>>> language       R
>>> version.string R Under development (unstable) (2017-07-31 r73003)
>>> nickname       Unsuffered Consequences
>>>
>>>
>>> ________________________________
>>> Tento e-mail a jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou
>> ur?eny pouze jeho adres?t?m.
>>> Jestli?e jste obdr?el(a) tento e-mail omylem, informujte laskav? neprodlen?
>> jeho odes?latele. Obsah tohoto emailu i s p??lohami a jeho kopie vyma?te ze
>> sv?ho syst?mu.
>>> Nejste-li zam??len?m adres?tem tohoto emailu, nejste opr?vn?ni tento email
>> jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
>>> Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu zp?sobenou modifikacemi
>> ?i zpo?d?n?m p?enosu e-mailu.
>>> V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
>>> - vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o uzav?en? smlouvy, a
>> to z jak?hokoliv d?vodu i bez uveden? d?vodu.
>>> - a obsahuje-li nab?dku, je adres?t opr?vn?n nab?dku bezodkladn? p?ijmout;
>> Odes?latel tohoto e-mailu (nab?dky) vylu?uje p?ijet? nab?dky ze strany p??jemce s
>> dodatkem ?i odchylkou.
>>> - trv? odes?latel na tom, ?e p??slu?n? smlouva je uzav?ena teprve v?slovn?m
>> dosa?en?m shody na v?ech jej?ch n?le?itostech.
>>> - odes?latel tohoto emailu informuje, ?e nen? opr?vn?n uzav?rat za spole?nost
>> ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn? zmocn?n nebo
>> p?semn? pov??en a takov? pov??en? nebo pln? moc byly adres?tovi tohoto
>> emailu p??padn? osob?, kterou adres?t zastupuje, p?edlo?eny nebo jejich
>> existence je adres?tovi ?i osob? j?m zastoupen? zn?m?.
>>> This e-mail and any documents attached to it may be confidential and are
>> intended only for its intended recipients.
>>> If you received this e-mail by mistake, please immediately inform its sender.
>> Delete the contents of this e-mail with all attachments and its copies from your
>> system.
>>> If you are not the intended recipient of this e-mail, you are not authorized to
>> use, disseminate, copy or disclose this e-mail in any manner.
>>> The sender of this e-mail shall not be liable for any possible damage caused
>> by modifications of the e-mail or by delay with transfer of the email.
>>> In case that this e-mail forms part of business dealings:
>>> - the sender reserves the right to end negotiations about entering into a
>> contract in any time, for any reason, and without stating any reasoning.
>>> - if the e-mail contains an offer, the recipient is entitled to immediately
>> accept such offer; The sender of this e-mail (offer) excludes any acceptance of
>> the offer on the part of the recipient containing any amendment or variation.
>>> - the sender insists on that the respective contract is concluded only upon an
>> express mutual agreement on all its aspects.
>>> - the sender of this e-mail informs that he/she is not authorized to enter into
>> any contracts on behalf of the company except for cases in which he/she is
>> expressly authorized to do so in writing, and such authorization or power of
>> attorney is submitted to the recipient or the person represented by the
>> recipient, or the existence of such authorization is known to the recipient of the
>> person represented by the recipient.
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>
> ________________________________
> Tento e-mail a jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou ur?eny pouze jeho adres?t?m.
> Jestli?e jste obdr?el(a) tento e-mail omylem, informujte laskav? neprodlen? jeho odes?latele. Obsah tohoto emailu i s p??lohami a jeho kopie vyma?te ze sv?ho syst?mu.
> Nejste-li zam??len?m adres?tem tohoto emailu, nejste opr?vn?ni tento email jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
> Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu zp?sobenou modifikacemi ?i zpo?d?n?m p?enosu e-mailu.
>
> V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
> - vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o uzav?en? smlouvy, a to z jak?hokoliv d?vodu i bez uveden? d?vodu.
> - a obsahuje-li nab?dku, je adres?t opr?vn?n nab?dku bezodkladn? p?ijmout; Odes?latel tohoto e-mailu (nab?dky) vylu?uje p?ijet? nab?dky ze strany p??jemce s dodatkem ?i odchylkou.
> - trv? odes?latel na tom, ?e p??slu?n? smlouva je uzav?ena teprve v?slovn?m dosa?en?m shody na v?ech jej?ch n?le?itostech.
> - odes?latel tohoto emailu informuje, ?e nen? opr?vn?n uzav?rat za spole?nost ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn? zmocn?n nebo p?semn? pov??en a takov? pov??en? nebo pln? moc byly adres?tovi tohoto emailu p??padn? osob?, kterou adres?t zastupuje, p?edlo?eny nebo jejich existence je adres?tovi ?i osob? j?m zastoupen? zn?m?.
>
> This e-mail and any documents attached to it may be confidential and are intended only for its intended recipients.
> If you received this e-mail by mistake, please immediately inform its sender. Delete the contents of this e-mail with all attachments and its copies from your system.
> If you are not the intended recipient of this e-mail, you are not authorized to use, disseminate, copy or disclose this e-mail in any manner.
> The sender of this e-mail shall not be liable for any possible damage caused by modifications of the e-mail or by delay with transfer of the email.
>
> In case that this e-mail forms part of business dealings:
> - the sender reserves the right to end negotiations about entering into a contract in any time, for any reason, and without stating any reasoning.
> - if the e-mail contains an offer, the recipient is entitled to immediately accept such offer; The sender of this e-mail (offer) excludes any acceptance of the offer on the part of the recipient containing any amendment or variation.
> - the sender insists on that the respective contract is concluded only upon an express mutual agreement on all its aspects.
> - the sender of this e-mail informs that he/she is not authorized to enter into any contracts on behalf of the company except for cases in which he/she is expressly authorized to do so in writing, and such authorization or power of attorney is submitted to the recipient or the person represented by the recipient, or the existence of such authorization is known to the recipient of the person represented by the recipient.
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 


--
Robert W. Baer, Ph.D.
Professor of Physiology
Kirksville College of Osteopathic Medicine
A T Still University of Health Sciences
800 W. Jefferson St
Kirksville, MO 63501
660-626-2321 Department
660-626-2965 FAX


From cm.triggs at auckland.ac.nz  Thu Aug 17 00:31:18 2017
From: cm.triggs at auckland.ac.nz (Chris Triggs)
Date: Wed, 16 Aug 2017 22:31:18 +0000
Subject: [Rd] Problem with a regular expression.
Message-ID: <65e225958ba74a7dbcf0bc4688387e9d@uxcn13-ogg-c.UoA.auckland.ac.nz>

Hi...

I have come upon a problem with a regular expression which causes base-R to freeze.  I have reproduced the phenomenon on several machines running R under Windows 10, and also under OSX  on different Apple MACs.

The minimal example is:-
Oldterm is a vector of characters, e.g. "A", "B", "A", "*", "B"
The regular expression is "\\\\)"

The call which freezes R is
strsplit(Oldterm, "\\\\)" )

Thomas - after he had reproduced the problem - suggested that I submit it to r-devel.

Best wishes....
           Chris Triggs


	[[alternative HTML version deleted]]


From peter.langfelder at gmail.com  Thu Aug 17 01:27:56 2017
From: peter.langfelder at gmail.com (Peter Langfelder)
Date: Wed, 16 Aug 2017 16:27:56 -0700
Subject: [Rd] Problem with a regular expression.
In-Reply-To: <65e225958ba74a7dbcf0bc4688387e9d@uxcn13-ogg-c.UoA.auckland.ac.nz>
References: <65e225958ba74a7dbcf0bc4688387e9d@uxcn13-ogg-c.UoA.auckland.ac.nz>
Message-ID: <CA+hbrhUUzF+G0oDiaYe8_x88k4xwpeTT4R15qqo1US-9OYBn-g@mail.gmail.com>

FWIW, I tried it on my linux box. The memory use shot through the roof, the
system crawled to a halt due to constant swapping, and after a minute or so
top showed memory use of 47GB, at which point I killed the R process. On
linux at least R is not frozen but the strsplit call gobbles up memory (and
does not seem to end) which makes it look like it's frozen.

Peter

> sessionInfo()
R version 3.4.1 Patched (2017-08-11 r73090)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Fedora 26 (Twenty Six)

Matrix products: default
BLAS: /usr/local/atlas/lib/libtatlas.so
LAPACK: /usr/local/lib64/R-3.4.1-patched-atlas-parallel/lib/libRlapack.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] compiler_3.4.1



On Wed, Aug 16, 2017 at 3:31 PM, Chris Triggs <cm.triggs at auckland.ac.nz>
wrote:

> Hi...
>
> I have come upon a problem with a regular expression which causes base-R
> to freeze.  I have reproduced the phenomenon on several machines running R
> under Windows 10, and also under OSX  on different Apple MACs.
>
> The minimal example is:-
> Oldterm is a vector of characters, e.g. "A", "B", "A", "*", "B"
> The regular expression is "\\\\)"
>
> The call which freezes R is
> strsplit(Oldterm, "\\\\)" )
>
> Thomas - after he had reproduced the problem - suggested that I submit it
> to r-devel.
>
> Best wishes....
>            Chris Triggs
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

	[[alternative HTML version deleted]]


From ruipbarradas at sapo.pt  Thu Aug 17 09:26:19 2017
From: ruipbarradas at sapo.pt (Rui Barradas)
Date: Thu, 17 Aug 2017 08:26:19 +0100
Subject: [Rd] Problem with a regular expression.
In-Reply-To: <65e225958ba74a7dbcf0bc4688387e9d@uxcn13-ogg-c.UoA.auckland.ac.nz>
References: <65e225958ba74a7dbcf0bc4688387e9d@uxcn13-ogg-c.UoA.auckland.ac.nz>
Message-ID: <5995451B.5040708@sapo.pt>

Hello,

This seems to be serious.
RGui.exe, fresh session. I've clicked File > New Script and wrote

Oldterm <- c("A", "B", "A", "*", "B")
strsplit(Oldterm, "\\\\)" )

Ran each instruction at a time with Ctrl+r and with the strsplit call 
the system froze.

Ctrl+Alt+Del didn't work, I had to go for the power switch button.

sessionInfo()
R version 3.4.1 (2017-06-30)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 7 x64 (build 7601) Service Pack 1

Matrix products: default

locale:
[1] LC_COLLATE=Portuguese_Portugal.1252 
LC_CTYPE=Portuguese_Portugal.1252
[3] LC_MONETARY=Portuguese_Portugal.1252 LC_NUMERIC=C 

[5] LC_TIME=Portuguese_Portugal.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] compiler_3.4.1


Rui Barradas

Em 16-08-2017 23:31, Chris Triggs escreveu:
> Hi...
>
> I have come upon a problem with a regular expression which causes base-R to freeze.  I have reproduced the phenomenon on several machines running R under Windows 10, and also under OSX  on different Apple MACs.
>
> The minimal example is:-
> Oldterm is a vector of characters, e.g. "A", "B", "A", "*", "B"
> The regular expression is "\\\\)"
>
> The call which freezes R is
> strsplit(Oldterm, "\\\\)" )
>
> Thomas - after he had reproduced the problem - suggested that I submit it to r-devel.
>
> Best wishes....
>             Chris Triggs
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From m_olshansky at yahoo.com  Thu Aug 17 09:45:02 2017
From: m_olshansky at yahoo.com (Moshe Olshansky)
Date: Thu, 17 Aug 2017 07:45:02 +0000 (UTC)
Subject: [Rd] Problem with a regular expression.
In-Reply-To: <5995451B.5040708@sapo.pt>
References: <65e225958ba74a7dbcf0bc4688387e9d@uxcn13-ogg-c.UoA.auckland.ac.nz>
 <5995451B.5040708@sapo.pt>
Message-ID: <1783369282.3222160.1502955902026@mail.yahoo.com>

I tried this on a Linux (Ubuntu) server invoking R from the command line and the result was the same, except that I could kill the R session from another terminal window.


      From: Rui Barradas <ruipbarradas at sapo.pt>
 To: Chris Triggs <cm.triggs at auckland.ac.nz>; "r-devel at r-project.org" <r-devel at r-project.org> 
Cc: Thomas Lumley <t.lumley at auckland.ac.nz>
 Sent: Thursday, 17 August 2017, 17:26
 Subject: Re: [Rd] Problem with a regular expression.
   
Hello,

This seems to be serious.
RGui.exe, fresh session. I've clicked File > New Script and wrote

Oldterm <- c("A", "B", "A", "*", "B")
strsplit(Oldterm, "\\\\)" )

Ran each instruction at a time with Ctrl+r and with the strsplit call 
the system froze.

Ctrl+Alt+Del didn't work, I had to go for the power switch button.

sessionInfo()
R version 3.4.1 (2017-06-30)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 7 x64 (build 7601) Service Pack 1

Matrix products: default

locale:
[1] LC_COLLATE=Portuguese_Portugal.1252 
LC_CTYPE=Portuguese_Portugal.1252
[3] LC_MONETARY=Portuguese_Portugal.1252 LC_NUMERIC=C 

[5] LC_TIME=Portuguese_Portugal.1252

attached base packages:
[1] stats? ? graphics? grDevices utils? ? datasets? methods? base

loaded via a namespace (and not attached):
[1] compiler_3.4.1


Rui Barradas

Em 16-08-2017 23:31, Chris Triggs escreveu:
> Hi...
>
> I have come upon a problem with a regular expression which causes base-R to freeze.? I have reproduced the phenomenon on several machines running R under Windows 10, and also under OSX? on different Apple MACs.
>
> The minimal example is:-
> Oldterm is a vector of characters, e.g. "A", "B", "A", "*", "B"
> The regular expression is "\\\\)"
>
> The call which freezes R is
> strsplit(Oldterm, "\\\\)" )
>
> Thomas - after he had reproduced the problem - suggested that I submit it to r-devel.
>
> Best wishes....
>? ? ? ? ? ? Chris Triggs
>
>
> ??? [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


   
	[[alternative HTML version deleted]]


From tomas.kalibera at gmail.com  Thu Aug 17 10:14:05 2017
From: tomas.kalibera at gmail.com (Tomas Kalibera)
Date: Thu, 17 Aug 2017 10:14:05 +0200
Subject: [Rd] Problem with a regular expression.
In-Reply-To: <1783369282.3222160.1502955902026@mail.yahoo.com>
References: <65e225958ba74a7dbcf0bc4688387e9d@uxcn13-ogg-c.UoA.auckland.ac.nz>
 <5995451B.5040708@sapo.pt> <1783369282.3222160.1502955902026@mail.yahoo.com>
Message-ID: <d697b033-1eff-d82a-160d-95f7e718c5aa@gmail.com>


The problem is in TRE library, in regcomp, while compiling the regular 
expression.

This is enough to trigger in R (to do this without re-boot: ulimit -v 
500000 ):
 > strsplit("", "\\\\)")

To repeat in TRE, one can build TRE from sources and run
 > ./src/agrep "\\\\)" README.md

Tomas


On 08/17/2017 09:45 AM, Moshe Olshansky via R-devel wrote:
> I tried this on a Linux (Ubuntu) server invoking R from the command line and the result was the same, except that I could kill the R session from another terminal window.
>
>
>        From: Rui Barradas <ruipbarradas at sapo.pt>
>   To: Chris Triggs <cm.triggs at auckland.ac.nz>; "r-devel at r-project.org" <r-devel at r-project.org>
> Cc: Thomas Lumley <t.lumley at auckland.ac.nz>
>   Sent: Thursday, 17 August 2017, 17:26
>   Subject: Re: [Rd] Problem with a regular expression.
>     
> Hello,
>
> This seems to be serious.
> RGui.exe, fresh session. I've clicked File > New Script and wrote
>
> Oldterm <- c("A", "B", "A", "*", "B")
> strsplit(Oldterm, "\\\\)" )
>
> Ran each instruction at a time with Ctrl+r and with the strsplit call
> the system froze.
>
> Ctrl+Alt+Del didn't work, I had to go for the power switch button.
>
> sessionInfo()
> R version 3.4.1 (2017-06-30)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 7 x64 (build 7601) Service Pack 1
>
> Matrix products: default
>
> locale:
> [1] LC_COLLATE=Portuguese_Portugal.1252
> LC_CTYPE=Portuguese_Portugal.1252
> [3] LC_MONETARY=Portuguese_Portugal.1252 LC_NUMERIC=C
>
> [5] LC_TIME=Portuguese_Portugal.1252
>
> attached base packages:
> [1] stats    graphics  grDevices utils    datasets  methods  base
>
> loaded via a namespace (and not attached):
> [1] compiler_3.4.1
>
>
> Rui Barradas
>
> Em 16-08-2017 23:31, Chris Triggs escreveu:
>> Hi...
>>
>> I have come upon a problem with a regular expression which causes base-R to freeze.  I have reproduced the phenomenon on several machines running R under Windows 10, and also under OSX  on different Apple MACs.
>>
>> The minimal example is:-
>> Oldterm is a vector of characters, e.g. "A", "B", "A", "*", "B"
>> The regular expression is "\\\\)"
>>
>> The call which freezes R is
>> strsplit(Oldterm, "\\\\)" )
>>
>> Thomas - after he had reproduced the problem - suggested that I submit it to r-devel.
>>
>> Best wishes....
>>              Chris Triggs
>>
>>
>>      [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>     
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From petr.pikal at precheza.cz  Thu Aug 17 10:37:50 2017
From: petr.pikal at precheza.cz (PIKAL Petr)
Date: Thu, 17 Aug 2017 08:37:50 +0000
Subject: [Rd] strange behaviour read.table and clipboard
In-Reply-To: <e6fd3266-28fb-6836-40e3-90743aecb2db@atsu.edu>
References: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAAB50@SRVEXCHCM301.precheza.cz>
 <da145467-18b0-bc61-e3b1-6f18281d88ac@gmail.com>
 <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAABF0@SRVEXCHCM301.precheza.cz>
 <e6fd3266-28fb-6836-40e3-90743aecb2db@atsu.edu>
Message-ID: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAAE54@SRVEXCHCM301.precheza.cz>

Hi

> -----Original Message-----
> From: Robert Baer [mailto:rbaer at atsu.edu]
> Sent: Wednesday, August 16, 2017 3:04 PM
> To: PIKAL Petr <petr.pikal at precheza.cz>; Duncan Murdoch
> <murdoch.duncan at gmail.com>
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] strange behaviour read.table and clipboard
>
> You said, "put a name in the cell".  Does that mean you forgot a header =
> TRUE?

No

for read.delim header=TRUE is default option.

The mentioned issue starts between R-devel r71964 and r73003

I cannot narrow this range as I do not have available other versions between this date range.

I tested other read.* functions and all seems to work as expected.

The problem is connected **only** with reading from clipboard. Maybe it is the issue of Windows, but I cannot see anything weird when copying e.g. from Excel to Notepad

Cheers
Petr

>
>
>
> On 8/16/2017 1:25 AM, PIKAL Petr wrote:
> > Hi Duncan
> >
> > The simples spreadsheet is:
> >
> > Put a name in the cell, let say "a1"
> > Put number e.g. 1 below "a1"
> > Copy the number to enough rows
> > Select this column and press ctrl-c
> >
> > result is
> >
> >> temp<- read.delim("clipboard")
> >> str(temp)
> > 'data.frame':   1513 obs. of  1 variable:
> >   $ a1: Factor w/ 2 levels "1","a1": 1 1 1 1 1 1 1 1 1 1 ...
> >> which(temp$a1=="a1")
> > [1] 1365
> > I tested it in vanilla R
> >
> >> sessionInfo()
> > R Under development (unstable) (2017-07-31 r73003)
> > Platform: x86_64-w64-mingw32/x64 (64-bit)
> > Running under: Windows 10 x64 (build 14393)
> >
> > Matrix products: default
> >
> > locale:
> > [1] LC_COLLATE=Czech_Czech Republic.1250  LC_CTYPE=Czech_Czech
> Republic.1250
> > [3] LC_MONETARY=Czech_Czech Republic.1250 LC_NUMERIC=C
> > [5] LC_TIME=Czech_Czech Republic.1250
> >
> > attached base packages:
> > [1] stats     graphics  grDevices utils     datasets  methods   base
> >
> > loaded via a namespace (and not attached):
> > [1] compiler_3.5.0
> > Excel 16 or 15 I am not sure.
> >
> > R-devel 2015 (69443) works as expected so it started a believe around May
> or June this year, when I installed new R version.
> >
> > I hope it could help to trace the problem. If I can help any further, let me
> know.
> >
> > Best regards
> > Petr
> >
> >
> >
> >> -----Original Message-----
> >> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> >> Sent: Wednesday, August 16, 2017 12:35 AM
> >> To: PIKAL Petr <petr.pikal at precheza.cz>; r-devel at r-project.org
> >> Subject: Re: [Rd] strange behaviour read.table and clipboard
> >>
> >> On 15/08/2017 10:03 AM, PIKAL Petr wrote:
> >>> Dear all
> >>>
> >>> I used to transfer data from excel to R by simple ctrl-c and
> >> read.delim("clipboard") construction. I know it is a bad practice but it is easy
> >> and for quick exploratory work it is OK. However after changing to new R
> devel
> >> few days ago I encountered weird behaviour. I tried one or two columns.
> >>
> >> You haven't posted something that is reproducible.  I don't have Excel, but I
> can
> >> cut and paste from Libreoffice, and I don't see this.
> >> However, it's not the same spreadsheet as you used, so I wouldn't be
> >> comfortable saying I did what you did.
> >>
> >> Please reduce the size of your spreadsheet if you can, and then post
> >> instructions for how to construct it, and what to cut and paste from it.
> >>    Then others can try what you did and see if this is specific to your machine,
> to
> >> that particular version of R-devel, to Excel, etc.
> >>
> >> Duncan Murdoch
> >>
> >>
> >>> In case of 2 columns, header is repeated after 526 items
> >>>> mar<-read.delim("clipboard")
> >>>> which(mar$a2=="a1")
> >>> [1]  525 1051 1577
> >>>> diff(which(mar$a2=="a1"))
> >>> [1] 526 526
> >>> and only first header item is repeated.
> >>>
> >>> In case of one column, header is repeated after 1107 items
> >>>
> >>>> mar<-read.delim("clipboard")
> >>>> diff(which(mar$a2=="a2"))
> >>> [1] 1107 1107
> >>>
> >>> And all items in object are therefore changed to factor.
> >>>
> >>> BTW, readxl package works on same excel file smoothly.
> >>>
> >>> I will try to download the most recent R version to check it, but it could
> take
> >> some time due to our IT issues.
> >>> Best regards
> >>> Petr
> >>>
> >>>> version
> >>>                 _
> >>> platform       x86_64-w64-mingw32
> >>> arch           x86_64
> >>> os             mingw32
> >>> system         x86_64, mingw32
> >>> status         Under development (unstable)
> >>> major          3
> >>> minor          5.0
> >>> year           2017
> >>> month          07
> >>> day            31
> >>> svn rev        73003
> >>> language       R
> >>> version.string R Under development (unstable) (2017-07-31 r73003)
> >>> nickname       Unsuffered Consequences
> >>>
> >>>
> >>> ________________________________
> >>> Tento e-mail a jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou
> >> ur?eny pouze jeho adres?t?m.
> >>> Jestli?e jste obdr?el(a) tento e-mail omylem, informujte laskav? neprodlen?
> >> jeho odes?latele. Obsah tohoto emailu i s p??lohami a jeho kopie vyma?te ze
> >> sv?ho syst?mu.
> >>> Nejste-li zam??len?m adres?tem tohoto emailu, nejste opr?vn?ni tento
> email
> >> jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
> >>> Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu zp?sobenou
> modifikacemi
> >> ?i zpo?d?n?m p?enosu e-mailu.
> >>> V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
> >>> - vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o uzav?en? smlouvy,
> a
> >> to z jak?hokoliv d?vodu i bez uveden? d?vodu.
> >>> - a obsahuje-li nab?dku, je adres?t opr?vn?n nab?dku bezodkladn? p?ijmout;
> >> Odes?latel tohoto e-mailu (nab?dky) vylu?uje p?ijet? nab?dky ze strany
> p??jemce s
> >> dodatkem ?i odchylkou.
> >>> - trv? odes?latel na tom, ?e p??slu?n? smlouva je uzav?ena teprve v?slovn?m
> >> dosa?en?m shody na v?ech jej?ch n?le?itostech.
> >>> - odes?latel tohoto emailu informuje, ?e nen? opr?vn?n uzav?rat za
> spole?nost
> >> ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn? zmocn?n nebo
> >> p?semn? pov??en a takov? pov??en? nebo pln? moc byly adres?tovi tohoto
> >> emailu p??padn? osob?, kterou adres?t zastupuje, p?edlo?eny nebo jejich
> >> existence je adres?tovi ?i osob? j?m zastoupen? zn?m?.
> >>> This e-mail and any documents attached to it may be confidential and are
> >> intended only for its intended recipients.
> >>> If you received this e-mail by mistake, please immediately inform its
> sender.
> >> Delete the contents of this e-mail with all attachments and its copies from
> your
> >> system.
> >>> If you are not the intended recipient of this e-mail, you are not authorized
> to
> >> use, disseminate, copy or disclose this e-mail in any manner.
> >>> The sender of this e-mail shall not be liable for any possible damage caused
> >> by modifications of the e-mail or by delay with transfer of the email.
> >>> In case that this e-mail forms part of business dealings:
> >>> - the sender reserves the right to end negotiations about entering into a
> >> contract in any time, for any reason, and without stating any reasoning.
> >>> - if the e-mail contains an offer, the recipient is entitled to immediately
> >> accept such offer; The sender of this e-mail (offer) excludes any acceptance
> of
> >> the offer on the part of the recipient containing any amendment or
> variation.
> >>> - the sender insists on that the respective contract is concluded only upon
> an
> >> express mutual agreement on all its aspects.
> >>> - the sender of this e-mail informs that he/she is not authorized to enter
> into
> >> any contracts on behalf of the company except for cases in which he/she is
> >> expressly authorized to do so in writing, and such authorization or power of
> >> attorney is submitted to the recipient or the person represented by the
> >> recipient, or the existence of such authorization is known to the recipient of
> the
> >> person represented by the recipient.
> >>> ______________________________________________
> >>> R-devel at r-project.org mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>>
> >
> > ________________________________
> > Tento e-mail a jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou
> ur?eny pouze jeho adres?t?m.
> > Jestli?e jste obdr?el(a) tento e-mail omylem, informujte laskav? neprodlen?
> jeho odes?latele. Obsah tohoto emailu i s p??lohami a jeho kopie vyma?te ze
> sv?ho syst?mu.
> > Nejste-li zam??len?m adres?tem tohoto emailu, nejste opr?vn?ni tento email
> jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
> > Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu zp?sobenou modifikacemi
> ?i zpo?d?n?m p?enosu e-mailu.
> >
> > V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
> > - vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o uzav?en? smlouvy, a
> to z jak?hokoliv d?vodu i bez uveden? d?vodu.
> > - a obsahuje-li nab?dku, je adres?t opr?vn?n nab?dku bezodkladn? p?ijmout;
> Odes?latel tohoto e-mailu (nab?dky) vylu?uje p?ijet? nab?dky ze strany p??jemce s
> dodatkem ?i odchylkou.
> > - trv? odes?latel na tom, ?e p??slu?n? smlouva je uzav?ena teprve v?slovn?m
> dosa?en?m shody na v?ech jej?ch n?le?itostech.
> > - odes?latel tohoto emailu informuje, ?e nen? opr?vn?n uzav?rat za spole?nost
> ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn? zmocn?n nebo
> p?semn? pov??en a takov? pov??en? nebo pln? moc byly adres?tovi tohoto
> emailu p??padn? osob?, kterou adres?t zastupuje, p?edlo?eny nebo jejich
> existence je adres?tovi ?i osob? j?m zastoupen? zn?m?.
> >
> > This e-mail and any documents attached to it may be confidential and are
> intended only for its intended recipients.
> > If you received this e-mail by mistake, please immediately inform its sender.
> Delete the contents of this e-mail with all attachments and its copies from your
> system.
> > If you are not the intended recipient of this e-mail, you are not authorized to
> use, disseminate, copy or disclose this e-mail in any manner.
> > The sender of this e-mail shall not be liable for any possible damage caused
> by modifications of the e-mail or by delay with transfer of the email.
> >
> > In case that this e-mail forms part of business dealings:
> > - the sender reserves the right to end negotiations about entering into a
> contract in any time, for any reason, and without stating any reasoning.
> > - if the e-mail contains an offer, the recipient is entitled to immediately
> accept such offer; The sender of this e-mail (offer) excludes any acceptance of
> the offer on the part of the recipient containing any amendment or variation.
> > - the sender insists on that the respective contract is concluded only upon an
> express mutual agreement on all its aspects.
> > - the sender of this e-mail informs that he/she is not authorized to enter into
> any contracts on behalf of the company except for cases in which he/she is
> expressly authorized to do so in writing, and such authorization or power of
> attorney is submitted to the recipient or the person represented by the
> recipient, or the existence of such authorization is known to the recipient of the
> person represented by the recipient.
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
>
> --
>
>
> --
> Robert W. Baer, Ph.D.
> Professor of Physiology
> Kirksville College of Osteopathic Medicine
> A T Still University of Health Sciences
> 800 W. Jefferson St
> Kirksville, MO 63501
> 660-626-2321 Department
> 660-626-2965 FAX


________________________________
Tento e-mail a jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou ur?eny pouze jeho adres?t?m.
Jestli?e jste obdr?el(a) tento e-mail omylem, informujte laskav? neprodlen? jeho odes?latele. Obsah tohoto emailu i s p??lohami a jeho kopie vyma?te ze sv?ho syst?mu.
Nejste-li zam??len?m adres?tem tohoto emailu, nejste opr?vn?ni tento email jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu zp?sobenou modifikacemi ?i zpo?d?n?m p?enosu e-mailu.

V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
- vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o uzav?en? smlouvy, a to z jak?hokoliv d?vodu i bez uveden? d?vodu.
- a obsahuje-li nab?dku, je adres?t opr?vn?n nab?dku bezodkladn? p?ijmout; Odes?latel tohoto e-mailu (nab?dky) vylu?uje p?ijet? nab?dky ze strany p??jemce s dodatkem ?i odchylkou.
- trv? odes?latel na tom, ?e p??slu?n? smlouva je uzav?ena teprve v?slovn?m dosa?en?m shody na v?ech jej?ch n?le?itostech.
- odes?latel tohoto emailu informuje, ?e nen? opr?vn?n uzav?rat za spole?nost ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn? zmocn?n nebo p?semn? pov??en a takov? pov??en? nebo pln? moc byly adres?tovi tohoto emailu p??padn? osob?, kterou adres?t zastupuje, p?edlo?eny nebo jejich existence je adres?tovi ?i osob? j?m zastoupen? zn?m?.

This e-mail and any documents attached to it may be confidential and are intended only for its intended recipients.
If you received this e-mail by mistake, please immediately inform its sender. Delete the contents of this e-mail with all attachments and its copies from your system.
If you are not the intended recipient of this e-mail, you are not authorized to use, disseminate, copy or disclose this e-mail in any manner.
The sender of this e-mail shall not be liable for any possible damage caused by modifications of the e-mail or by delay with transfer of the email.

In case that this e-mail forms part of business dealings:
- the sender reserves the right to end negotiations about entering into a contract in any time, for any reason, and without stating any reasoning.
- if the e-mail contains an offer, the recipient is entitled to immediately accept such offer; The sender of this e-mail (offer) excludes any acceptance of the offer on the part of the recipient containing any amendment or variation.
- the sender insists on that the respective contract is concluded only upon an express mutual agreement on all its aspects.
- the sender of this e-mail informs that he/she is not authorized to enter into any contracts on behalf of the company except for cases in which he/she is expressly authorized to do so in writing, and such authorization or power of attorney is submitted to the recipient or the person represented by the recipient, or the existence of such authorization is known to the recipient of the person represented by the recipient.

From tomas.kalibera at gmail.com  Thu Aug 17 11:58:41 2017
From: tomas.kalibera at gmail.com (Tomas Kalibera)
Date: Thu, 17 Aug 2017 11:58:41 +0200
Subject: [Rd] strange behaviour read.table and clipboard
In-Reply-To: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAAE54@SRVEXCHCM301.precheza.cz>
References: <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAAB50@SRVEXCHCM301.precheza.cz>
 <da145467-18b0-bc61-e3b1-6f18281d88ac@gmail.com>
 <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAABF0@SRVEXCHCM301.precheza.cz>
 <e6fd3266-28fb-6836-40e3-90743aecb2db@atsu.edu>
 <6E8D8DFDE5FA5D4ABCB8508389D1BF88FFAAAE54@SRVEXCHCM301.precheza.cz>
Message-ID: <2db5f6b0-e83e-3a27-8d0f-37beafa6c47e@gmail.com>

Thank you for the report, it is a bug in buffering in R (not specific to 
Windows) and will be fixed.

Best
Tomas

On 08/17/2017 10:37 AM, PIKAL Petr wrote:
> Hi
>
>> -----Original Message-----
>> From: Robert Baer [mailto:rbaer at atsu.edu]
>> Sent: Wednesday, August 16, 2017 3:04 PM
>> To: PIKAL Petr <petr.pikal at precheza.cz>; Duncan Murdoch
>> <murdoch.duncan at gmail.com>
>> Cc: r-devel at r-project.org
>> Subject: Re: [Rd] strange behaviour read.table and clipboard
>>
>> You said, "put a name in the cell".  Does that mean you forgot a header =
>> TRUE?
> No
>
> for read.delim header=TRUE is default option.
>
> The mentioned issue starts between R-devel r71964 and r73003
>
> I cannot narrow this range as I do not have available other versions between this date range.
>
> I tested other read.* functions and all seems to work as expected.
>
> The problem is connected **only** with reading from clipboard. Maybe it is the issue of Windows, but I cannot see anything weird when copying e.g. from Excel to Notepad
>
> Cheers
> Petr
>
>>
>>
>> On 8/16/2017 1:25 AM, PIKAL Petr wrote:
>>> Hi Duncan
>>>
>>> The simples spreadsheet is:
>>>
>>> Put a name in the cell, let say "a1"
>>> Put number e.g. 1 below "a1"
>>> Copy the number to enough rows
>>> Select this column and press ctrl-c
>>>
>>> result is
>>>
>>>> temp<- read.delim("clipboard")
>>>> str(temp)
>>> 'data.frame':   1513 obs. of  1 variable:
>>>    $ a1: Factor w/ 2 levels "1","a1": 1 1 1 1 1 1 1 1 1 1 ...
>>>> which(temp$a1=="a1")
>>> [1] 1365
>>> I tested it in vanilla R
>>>
>>>> sessionInfo()
>>> R Under development (unstable) (2017-07-31 r73003)
>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>> Running under: Windows 10 x64 (build 14393)
>>>
>>> Matrix products: default
>>>
>>> locale:
>>> [1] LC_COLLATE=Czech_Czech Republic.1250  LC_CTYPE=Czech_Czech
>> Republic.1250
>>> [3] LC_MONETARY=Czech_Czech Republic.1250 LC_NUMERIC=C
>>> [5] LC_TIME=Czech_Czech Republic.1250
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>
>>> loaded via a namespace (and not attached):
>>> [1] compiler_3.5.0
>>> Excel 16 or 15 I am not sure.
>>>
>>> R-devel 2015 (69443) works as expected so it started a believe around May
>> or June this year, when I installed new R version.
>>> I hope it could help to trace the problem. If I can help any further, let me
>> know.
>>> Best regards
>>> Petr
>>>
>>>
>>>
>>>> -----Original Message-----
>>>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>>>> Sent: Wednesday, August 16, 2017 12:35 AM
>>>> To: PIKAL Petr <petr.pikal at precheza.cz>; r-devel at r-project.org
>>>> Subject: Re: [Rd] strange behaviour read.table and clipboard
>>>>
>>>> On 15/08/2017 10:03 AM, PIKAL Petr wrote:
>>>>> Dear all
>>>>>
>>>>> I used to transfer data from excel to R by simple ctrl-c and
>>>> read.delim("clipboard") construction. I know it is a bad practice but it is easy
>>>> and for quick exploratory work it is OK. However after changing to new R
>> devel
>>>> few days ago I encountered weird behaviour. I tried one or two columns.
>>>>
>>>> You haven't posted something that is reproducible.  I don't have Excel, but I
>> can
>>>> cut and paste from Libreoffice, and I don't see this.
>>>> However, it's not the same spreadsheet as you used, so I wouldn't be
>>>> comfortable saying I did what you did.
>>>>
>>>> Please reduce the size of your spreadsheet if you can, and then post
>>>> instructions for how to construct it, and what to cut and paste from it.
>>>>     Then others can try what you did and see if this is specific to your machine,
>> to
>>>> that particular version of R-devel, to Excel, etc.
>>>>
>>>> Duncan Murdoch
>>>>
>>>>
>>>>> In case of 2 columns, header is repeated after 526 items
>>>>>> mar<-read.delim("clipboard")
>>>>>> which(mar$a2=="a1")
>>>>> [1]  525 1051 1577
>>>>>> diff(which(mar$a2=="a1"))
>>>>> [1] 526 526
>>>>> and only first header item is repeated.
>>>>>
>>>>> In case of one column, header is repeated after 1107 items
>>>>>
>>>>>> mar<-read.delim("clipboard")
>>>>>> diff(which(mar$a2=="a2"))
>>>>> [1] 1107 1107
>>>>>
>>>>> And all items in object are therefore changed to factor.
>>>>>
>>>>> BTW, readxl package works on same excel file smoothly.
>>>>>
>>>>> I will try to download the most recent R version to check it, but it could
>> take
>>>> some time due to our IT issues.
>>>>> Best regards
>>>>> Petr
>>>>>
>>>>>> version
>>>>>                  _
>>>>> platform       x86_64-w64-mingw32
>>>>> arch           x86_64
>>>>> os             mingw32
>>>>> system         x86_64, mingw32
>>>>> status         Under development (unstable)
>>>>> major          3
>>>>> minor          5.0
>>>>> year           2017
>>>>> month          07
>>>>> day            31
>>>>> svn rev        73003
>>>>> language       R
>>>>> version.string R Under development (unstable) (2017-07-31 r73003)
>>>>> nickname       Unsuffered Consequences
>>>>>
>>>>>
>>>>> ________________________________
>>>>> Tento e-mail a jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou
>>>> ur?eny pouze jeho adres?t?m.
>>>>> Jestli?e jste obdr?el(a) tento e-mail omylem, informujte laskav? neprodlen?
>>>> jeho odes?latele. Obsah tohoto emailu i s p??lohami a jeho kopie vyma?te ze
>>>> sv?ho syst?mu.
>>>>> Nejste-li zam??len?m adres?tem tohoto emailu, nejste opr?vn?ni tento
>> email
>>>> jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
>>>>> Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu zp?sobenou
>> modifikacemi
>>>> ?i zpo?d?n?m p?enosu e-mailu.
>>>>> V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
>>>>> - vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o uzav?en? smlouvy,
>> a
>>>> to z jak?hokoliv d?vodu i bez uveden? d?vodu.
>>>>> - a obsahuje-li nab?dku, je adres?t opr?vn?n nab?dku bezodkladn? p?ijmout;
>>>> Odes?latel tohoto e-mailu (nab?dky) vylu?uje p?ijet? nab?dky ze strany
>> p??jemce s
>>>> dodatkem ?i odchylkou.
>>>>> - trv? odes?latel na tom, ?e p??slu?n? smlouva je uzav?ena teprve v?slovn?m
>>>> dosa?en?m shody na v?ech jej?ch n?le?itostech.
>>>>> - odes?latel tohoto emailu informuje, ?e nen? opr?vn?n uzav?rat za
>> spole?nost
>>>> ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn? zmocn?n nebo
>>>> p?semn? pov??en a takov? pov??en? nebo pln? moc byly adres?tovi tohoto
>>>> emailu p??padn? osob?, kterou adres?t zastupuje, p?edlo?eny nebo jejich
>>>> existence je adres?tovi ?i osob? j?m zastoupen? zn?m?.
>>>>> This e-mail and any documents attached to it may be confidential and are
>>>> intended only for its intended recipients.
>>>>> If you received this e-mail by mistake, please immediately inform its
>> sender.
>>>> Delete the contents of this e-mail with all attachments and its copies from
>> your
>>>> system.
>>>>> If you are not the intended recipient of this e-mail, you are not authorized
>> to
>>>> use, disseminate, copy or disclose this e-mail in any manner.
>>>>> The sender of this e-mail shall not be liable for any possible damage caused
>>>> by modifications of the e-mail or by delay with transfer of the email.
>>>>> In case that this e-mail forms part of business dealings:
>>>>> - the sender reserves the right to end negotiations about entering into a
>>>> contract in any time, for any reason, and without stating any reasoning.
>>>>> - if the e-mail contains an offer, the recipient is entitled to immediately
>>>> accept such offer; The sender of this e-mail (offer) excludes any acceptance
>> of
>>>> the offer on the part of the recipient containing any amendment or
>> variation.
>>>>> - the sender insists on that the respective contract is concluded only upon
>> an
>>>> express mutual agreement on all its aspects.
>>>>> - the sender of this e-mail informs that he/she is not authorized to enter
>> into
>>>> any contracts on behalf of the company except for cases in which he/she is
>>>> expressly authorized to do so in writing, and such authorization or power of
>>>> attorney is submitted to the recipient or the person represented by the
>>>> recipient, or the existence of such authorization is known to the recipient of
>> the
>>>> person represented by the recipient.
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>> ________________________________
>>> Tento e-mail a jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou
>> ur?eny pouze jeho adres?t?m.
>>> Jestli?e jste obdr?el(a) tento e-mail omylem, informujte laskav? neprodlen?
>> jeho odes?latele. Obsah tohoto emailu i s p??lohami a jeho kopie vyma?te ze
>> sv?ho syst?mu.
>>> Nejste-li zam??len?m adres?tem tohoto emailu, nejste opr?vn?ni tento email
>> jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
>>> Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu zp?sobenou modifikacemi
>> ?i zpo?d?n?m p?enosu e-mailu.
>>> V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
>>> - vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o uzav?en? smlouvy, a
>> to z jak?hokoliv d?vodu i bez uveden? d?vodu.
>>> - a obsahuje-li nab?dku, je adres?t opr?vn?n nab?dku bezodkladn? p?ijmout;
>> Odes?latel tohoto e-mailu (nab?dky) vylu?uje p?ijet? nab?dky ze strany p??jemce s
>> dodatkem ?i odchylkou.
>>> - trv? odes?latel na tom, ?e p??slu?n? smlouva je uzav?ena teprve v?slovn?m
>> dosa?en?m shody na v?ech jej?ch n?le?itostech.
>>> - odes?latel tohoto emailu informuje, ?e nen? opr?vn?n uzav?rat za spole?nost
>> ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn? zmocn?n nebo
>> p?semn? pov??en a takov? pov??en? nebo pln? moc byly adres?tovi tohoto
>> emailu p??padn? osob?, kterou adres?t zastupuje, p?edlo?eny nebo jejich
>> existence je adres?tovi ?i osob? j?m zastoupen? zn?m?.
>>> This e-mail and any documents attached to it may be confidential and are
>> intended only for its intended recipients.
>>> If you received this e-mail by mistake, please immediately inform its sender.
>> Delete the contents of this e-mail with all attachments and its copies from your
>> system.
>>> If you are not the intended recipient of this e-mail, you are not authorized to
>> use, disseminate, copy or disclose this e-mail in any manner.
>>> The sender of this e-mail shall not be liable for any possible damage caused
>> by modifications of the e-mail or by delay with transfer of the email.
>>> In case that this e-mail forms part of business dealings:
>>> - the sender reserves the right to end negotiations about entering into a
>> contract in any time, for any reason, and without stating any reasoning.
>>> - if the e-mail contains an offer, the recipient is entitled to immediately
>> accept such offer; The sender of this e-mail (offer) excludes any acceptance of
>> the offer on the part of the recipient containing any amendment or variation.
>>> - the sender insists on that the respective contract is concluded only upon an
>> express mutual agreement on all its aspects.
>>> - the sender of this e-mail informs that he/she is not authorized to enter into
>> any contracts on behalf of the company except for cases in which he/she is
>> expressly authorized to do so in writing, and such authorization or power of
>> attorney is submitted to the recipient or the person represented by the
>> recipient, or the existence of such authorization is known to the recipient of the
>> person represented by the recipient.
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> --
>>
>>
>> --
>> Robert W. Baer, Ph.D.
>> Professor of Physiology
>> Kirksville College of Osteopathic Medicine
>> A T Still University of Health Sciences
>> 800 W. Jefferson St
>> Kirksville, MO 63501
>> 660-626-2321 Department
>> 660-626-2965 FAX
>
> ________________________________
> Tento e-mail a jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn? a jsou ur?eny pouze jeho adres?t?m.
> Jestli?e jste obdr?el(a) tento e-mail omylem, informujte laskav? neprodlen? jeho odes?latele. Obsah tohoto emailu i s p??lohami a jeho kopie vyma?te ze sv?ho syst?mu.
> Nejste-li zam??len?m adres?tem tohoto emailu, nejste opr?vn?ni tento email jakkoliv u??vat, roz?i?ovat, kop?rovat ?i zve?ej?ovat.
> Odes?latel e-mailu neodpov?d? za eventu?ln? ?kodu zp?sobenou modifikacemi ?i zpo?d?n?m p?enosu e-mailu.
>
> V p??pad?, ?e je tento e-mail sou??st? obchodn?ho jedn?n?:
> - vyhrazuje si odes?latel pr?vo ukon?it kdykoliv jedn?n? o uzav?en? smlouvy, a to z jak?hokoliv d?vodu i bez uveden? d?vodu.
> - a obsahuje-li nab?dku, je adres?t opr?vn?n nab?dku bezodkladn? p?ijmout; Odes?latel tohoto e-mailu (nab?dky) vylu?uje p?ijet? nab?dky ze strany p??jemce s dodatkem ?i odchylkou.
> - trv? odes?latel na tom, ?e p??slu?n? smlouva je uzav?ena teprve v?slovn?m dosa?en?m shody na v?ech jej?ch n?le?itostech.
> - odes?latel tohoto emailu informuje, ?e nen? opr?vn?n uzav?rat za spole?nost ??dn? smlouvy s v?jimkou p??pad?, kdy k tomu byl p?semn? zmocn?n nebo p?semn? pov??en a takov? pov??en? nebo pln? moc byly adres?tovi tohoto emailu p??padn? osob?, kterou adres?t zastupuje, p?edlo?eny nebo jejich existence je adres?tovi ?i osob? j?m zastoupen? zn?m?.
>
> This e-mail and any documents attached to it may be confidential and are intended only for its intended recipients.
> If you received this e-mail by mistake, please immediately inform its sender. Delete the contents of this e-mail with all attachments and its copies from your system.
> If you are not the intended recipient of this e-mail, you are not authorized to use, disseminate, copy or disclose this e-mail in any manner.
> The sender of this e-mail shall not be liable for any possible damage caused by modifications of the e-mail or by delay with transfer of the email.
>
> In case that this e-mail forms part of business dealings:
> - the sender reserves the right to end negotiations about entering into a contract in any time, for any reason, and without stating any reasoning.
> - if the e-mail contains an offer, the recipient is entitled to immediately accept such offer; The sender of this e-mail (offer) excludes any acceptance of the offer on the part of the recipient containing any amendment or variation.
> - the sender insists on that the respective contract is concluded only upon an express mutual agreement on all its aspects.
> - the sender of this e-mail informs that he/she is not authorized to enter into any contracts on behalf of the company except for cases in which he/she is expressly authorized to do so in writing, and such authorization or power of attorney is submitted to the recipient or the person represented by the recipient, or the existence of such authorization is known to the recipient of the person represented by the recipient.
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From wollschlaeger at uni-mainz.de  Thu Aug 17 11:06:55 2017
From: wollschlaeger at uni-mainz.de (Wollschlaeger, Daniel)
Date: Thu, 17 Aug 2017 09:06:55 +0000
Subject: [Rd]  Problem with a regular expression.
In-Reply-To: <d697b033-1eff-d82a-160d-95f7e718c5aa@gmail.com>
References: <65e225958ba74a7dbcf0bc4688387e9d@uxcn13-ogg-c.UoA.auckland.ac.nz>
 <5995451B.5040708@sapo.pt>
 <1783369282.3222160.1502955902026@mail.yahoo.com>,
 <d697b033-1eff-d82a-160d-95f7e718c5aa@gmail.com>
Message-ID: <d6335c46b0554853ba8ae1d8ecf1e949@uni-mainz.de>

The issue seems related to R bug report 15012:

https://bugs.r-project.org/bugzilla3/show_bug.cgi?id=15012

As mentioned in the comments there, a pull request to the TRE library has recently been made, but I don't know about its status.

Daniel

________________________________________
Von: R-devel <r-devel-bounces at r-project.org> im Auftrag von Tomas Kalibera <tomas.kalibera at gmail.com>
Gesendet: Donnerstag, 17. August 2017 10:14
An: r-devel at r-project.org
Betreff: Re: [Rd] Problem with a regular expression.

The problem is in TRE library, in regcomp, while compiling the regular
expression.

This is enough to trigger in R (to do this without re-boot: ulimit -v
500000 ):
 > strsplit("", "\\\\)")

To repeat in TRE, one can build TRE from sources and run
 > ./src/agrep "\\\\)" README.md

Tomas


On 08/17/2017 09:45 AM, Moshe Olshansky via R-devel wrote:
> I tried this on a Linux (Ubuntu) server invoking R from the command line and the result was the same, except that I could kill the R session from another terminal window.
>
>
>        From: Rui Barradas <ruipbarradas at sapo.pt>
>   To: Chris Triggs <cm.triggs at auckland.ac.nz>; "r-devel at r-project.org" <r-devel at r-project.org>
> Cc: Thomas Lumley <t.lumley at auckland.ac.nz>
>   Sent: Thursday, 17 August 2017, 17:26
>   Subject: Re: [Rd] Problem with a regular expression.
>
> Hello,
>
> This seems to be serious.
> RGui.exe, fresh session. I've clicked File > New Script and wrote
>
> Oldterm <- c("A", "B", "A", "*", "B")
> strsplit(Oldterm, "\\\\)" )
>
> Ran each instruction at a time with Ctrl+r and with the strsplit call
> the system froze.
>
> Ctrl+Alt+Del didn't work, I had to go for the power switch button.
>
> sessionInfo()
> R version 3.4.1 (2017-06-30)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 7 x64 (build 7601) Service Pack 1
>
> Matrix products: default
>
> locale:
> [1] LC_COLLATE=Portuguese_Portugal.1252
> LC_CTYPE=Portuguese_Portugal.1252
> [3] LC_MONETARY=Portuguese_Portugal.1252 LC_NUMERIC=C
>
> [5] LC_TIME=Portuguese_Portugal.1252
>
> attached base packages:
> [1] stats    graphics  grDevices utils    datasets  methods  base
>
> loaded via a namespace (and not attached):
> [1] compiler_3.4.1
>
>
> Rui Barradas
>
> Em 16-08-2017 23:31, Chris Triggs escreveu:
>> Hi...
>>
>> I have come upon a problem with a regular expression which causes base-R to freeze.  I have reproduced the phenomenon on several machines running R under Windows 10, and also under OSX  on different Apple MACs.
>>
>> The minimal example is:-
>> Oldterm is a vector of characters, e.g. "A", "B", "A", "*", "B"
>> The regular expression is "\\\\)"
>>
>> The call which freezes R is
>> strsplit(Oldterm, "\\\\)" )
>>
>> Thomas - after he had reproduced the problem - suggested that I submit it to r-devel.
>>
>> Best wishes....
>>              Chris Triggs
>>
>>
>>      [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>
>       [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From suharto_anggono at yahoo.com  Fri Aug 18 17:44:06 2017
From: suharto_anggono at yahoo.com (Suharto Anggono Suharto Anggono)
Date: Fri, 18 Aug 2017 15:44:06 +0000 (UTC)
Subject: [Rd] Issues of R_pretty in src/appl/pretty.c
References: <973411292.327791.1503071046156.ref@mail.yahoo.com>
Message-ID: <973411292.327791.1503071046156@mail.yahoo.com>

Examples similar to
pretty(c(-1,1)*1e300, n = 1e9, min.n = 1)
with smaller 'n':
pretty(c(-1,1)*1e304, n = 1e5, min.n = 1)
pretty(c(-1,1)*1e306, n = 1e3, min.n = 1)

A report on 'pretty' when working with integers, similar to what led to change of 'seq' fuzz, is https://bugs.r-project.org/bugzilla3/show_bug.cgi?id=15137

--------------------------------------------
On Tue, 15/8/17, Martin Maechler <maechler at stat.math.ethz.ch> wrote:

 Subject: Re: [Rd] Issues of R_pretty in src/appl/pretty.c
 To: "Martin Maechler" <maechler at stat.math.ethz.ch>

@r-project.org
 Date: Tuesday, 15 August, 2017, 3:55 PM

>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>? ?? on Mon, 14 Aug 2017 11:46:07 +0200 writes:

>>>>> Suharto Anggono Suharto Anggono via R-devel <r-devel at r-project.org>
>>>>>? ?? on Fri, 11 Aug 2017 17:11:06 +0000 writes:
>>>>> Suharto Anggono Suharto Anggono via R-devel <r-devel at r-project.org>
>>>>>? ?? on Fri, 11 Aug 2017 17:11:06 +0000 writes:

? ? >> See https://stat.ethz.ch/pipermail/r-devel/2017-August/074746.html for the origin of the example here.

? ? >> That
? ? >> pretty(c(-1,1)*1e300, n = 1e9, min.n = 1) gave 20 intervals, far from 1e9, but
? ? >> pretty(c(-1,1)*1e300, n = 1e6, min.n = 1) gave 1000000 intervals
? ? >> (on a machine), made me trace through the code to function 'R_pretty' in https://svn.r-project.org/R/trunk/src/appl/pretty.c .

? ? > thank you.

? ? >> *lo is -1e300, *up is 1e300.
? ? >> cell = fmax2(fabs(*lo),fabs(*up));
? ? >> 'cell' is 1e300.
? ? >> i_small = dx < cell * U * imax2(1,*ndiv) * DBL_EPSILON *3;
? ? >> When *ndiv is (int) 1e9, apparently cell * U * imax2(1,*ndiv) overflows to infinity and 'i_small' is 1 (true). It doesn't happen when *ndiv is (int) 1e6.

[[elided Yahoo spam]]

? ? >> Putting parentheses may avoid the floating point overflow. For example,
? ? >> i_small = dx < cell * (U * imax2(1,*ndiv) * DBL_EPSILON) *3;

? ? > yes... but only if the compiler optimization steps? "keep the parentheses".
? ? > AFAIK, there is no guarantee for that.
? ? > To make sure, I'd replace the above by

? ? > U *= imax2(1,*ndiv) * DBL_EPSILON;
? ? > i_small = dx < cell * U * 3;


? ? >> The part
? ? >> U = (1 + (h5 >= 1.5*h+.5)) ? 1/(1+h) : 1.5/(1+h5);
? ? >> is strange. Because (h5 >= 1.5*h+.5) is 1 or 0, (1 + (h5 >= 1.5*h+.5)) is never zero and 1/(1+h) will always be chosen.

[[elided Yahoo spam]]
? ? > here was as a change (not by me!) adding wrong parentheses
? ? > there (or maybe adding what the previously "missing" parens
? ? > implied, but not what they intended!).
? ? > The original code had been
? ?? 
? ? > U = 1 + (h5 >= 1.5*h+.5) ? 1/(1+h) : 1.5/(1+h5);

? ? > and "of course" was intended to mean

? ? > U = 1 + ((h5 >= 1.5*h+.5) ? 1/(1+h) : 1.5/(1+h5));

? ? > and this what I'll change it to, now.


? ? >> The comment for 'rounding_eps' says "1e-7 is consistent with seq.default()". Currently, seq.default() uses 1e-10 as fuzz.

? ? > Hmm, yes, thank you; this was correct when written,
? ? > but seq.default had been changed in the mean time,
? ? > namely in? svn r51095 | 2010-02-03

? ? > Usually we are cautious / reluctant to change such things w/o
? ? > any bug that we see to fix.
? ? > OTOH, we did have? bug cases we'd wanted to amend for seq() /
? ? > seq.int();
? ? > and I'll look into updating the "pretty - epsilon" also to
? ? > 1e-10.

[[elided Yahoo spam]]

I've committed now what I think has been suggested
above ... to R-devel only :
------------------------------------------------------------------------
r73094 | maechler | 2017-08-15 09:10:27 +0200 (Tue, 15. Aug 2017) | 1 Zeile
Ge?nderte Pfade:
?? M doc/NEWS.Rd
?? M src/appl/pretty.c
?? M src/main/engine.c
?? M tests/reg-large.R
?? M tests/reg-tests-2.Rout.save

pretty(x, n) fix overflow for large n suggested by Suhartu Aggano, R-devel, 2017-08-11


From maechler at stat.math.ethz.ch  Sat Aug 19 14:47:25 2017
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 19 Aug 2017 14:47:25 +0200
Subject: [Rd] Issues of R_pretty in src/appl/pretty.c
In-Reply-To: <973411292.327791.1503071046156@mail.yahoo.com>
References: <973411292.327791.1503071046156.ref@mail.yahoo.com>
 <973411292.327791.1503071046156@mail.yahoo.com>
Message-ID: <22936.13149.795298.273855@stat.math.ethz.ch>

>>>>> Suharto Anggono Suharto Anggono via R-devel <r-devel at r-project.org>
>>>>>     on Fri, 18 Aug 2017 15:44:06 +0000 writes:

    > Examples similar to
    > pretty(c(-1,1)*1e300, n = 1e9, min.n = 1)
    > with smaller 'n':
    > pretty(c(-1,1)*1e304, n = 1e5, min.n = 1)
    > pretty(c(-1,1)*1e306, n = 1e3, min.n = 1)


Thank you.

"But" all these work now (in R-devel, rev >= 73094) as they should,
at least for me, right?

Are you mentioning the  "small n" examples so we could use them
as regression tests  (instead of the regression test I had added
to tests/reg-large.R  which needs enough GB and is slowish ) --
or are you seeing a platform where the above cases still don't
work in (new enough) R-devel ?


    > A report on 'pretty' when working with integers, similar to what led to change of 'seq' fuzz, is https://bugs.r-project.org/bugzilla3/show_bug.cgi?id=15137

    > --------------------------------------------
    > On Tue, 15/8/17, Martin Maechler <maechler at stat.math.ethz.ch> wrote:

    > Subject: Re: [Rd] Issues of R_pretty in src/appl/pretty.c
    > To: "Martin Maechler" <maechler at stat.math.ethz.ch>

    > @r-project.org
    > Date: Tuesday, 15 August, 2017, 3:55 PM

>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
    >>>>>> ? ?? on Mon, 14 Aug 2017 11:46:07 +0200 writes:

>>>>> Suharto Anggono Suharto Anggono via R-devel <r-devel at r-project.org>
    >>>>>> ? ?? on Fri, 11 Aug 2017 17:11:06 +0000 writes:
>>>>> Suharto Anggono Suharto Anggono via R-devel <r-devel at r-project.org>
    >>>>>> ? ?? on Fri, 11 Aug 2017 17:11:06 +0000 writes:

    > ? ? >> See https://stat.ethz.ch/pipermail/r-devel/2017-August/074746.html for the origin of the example here.

    > ? ? >> That
    > ? ? >> pretty(c(-1,1)*1e300, n = 1e9, min.n = 1) gave 20 intervals, far from 1e9, but
    > ? ? >> pretty(c(-1,1)*1e300, n = 1e6, min.n = 1) gave 1000000 intervals
    > ? ? >> (on a machine), made me trace through the code to function 'R_pretty' in https://svn.r-project.org/R/trunk/src/appl/pretty.c .

    > ? ? > thank you.

    > ? ? >> *lo is -1e300, *up is 1e300.
    > ? ? >> cell = fmax2(fabs(*lo),fabs(*up));
    > ? ? >> 'cell' is 1e300.
    > ? ? >> i_small = dx < cell * U * imax2(1,*ndiv) * DBL_EPSILON *3;
    > ? ? >> When *ndiv is (int) 1e9, apparently cell * U * imax2(1,*ndiv) overflows to infinity and 'i_small' is 1 (true). It doesn't happen when *ndiv is (int) 1e6.

    > [[elided Yahoo spam]]

    > ? ? >> Putting parentheses may avoid the floating point overflow. For example,
    > ? ? >> i_small = dx < cell * (U * imax2(1,*ndiv) * DBL_EPSILON) *3;

    > ? ? > yes... but only if the compiler optimization steps? "keep the parentheses".
    > ? ? > AFAIK, there is no guarantee for that.
    > ? ? > To make sure, I'd replace the above by

    > ? ? > U *= imax2(1,*ndiv) * DBL_EPSILON;
    > ? ? > i_small = dx < cell * U * 3;


    > ? ? >> The part
    > ? ? >> U = (1 + (h5 >= 1.5*h+.5)) ? 1/(1+h) : 1.5/(1+h5);
    > ? ? >> is strange. Because (h5 >= 1.5*h+.5) is 1 or 0, (1 + (h5 >= 1.5*h+.5)) is never zero and 1/(1+h) will always be chosen.

    > [[elided Yahoo spam]]
    > ? ? > here was as a change (not by me!) adding wrong parentheses
    > ? ? > there (or maybe adding what the previously "missing" parens
    > ? ? > implied, but not what they intended!).
    > ? ? > The original code had been
    > ? ?? 
    > ? ? > U = 1 + (h5 >= 1.5*h+.5) ? 1/(1+h) : 1.5/(1+h5);

    > ? ? > and "of course" was intended to mean

    > ? ? > U = 1 + ((h5 >= 1.5*h+.5) ? 1/(1+h) : 1.5/(1+h5));

    > ? ? > and this what I'll change it to, now.


    > ? ? >> The comment for 'rounding_eps' says "1e-7 is consistent with seq.default()". Currently, seq.default() uses 1e-10 as fuzz.

    > ? ? > Hmm, yes, thank you; this was correct when written,
    > ? ? > but seq.default had been changed in the mean time,
    > ? ? > namely in? svn r51095 | 2010-02-03

    > ? ? > Usually we are cautious / reluctant to change such things w/o
    > ? ? > any bug that we see to fix.
    > ? ? > OTOH, we did have? bug cases we'd wanted to amend for seq() /
    > ? ? > seq.int();
    > ? ? > and I'll look into updating the "pretty - epsilon" also to
    > ? ? > 1e-10.

    > [[elided Yahoo spam]]

    > I've committed now what I think has been suggested
    > above ... to R-devel only :
    > ------------------------------------------------------------------------
    > r73094 | maechler | 2017-08-15 09:10:27 +0200 (Tue, 15. Aug 2017) | 1 Zeile
    > Ge?nderte Pfade:
    > ?? M doc/NEWS.Rd
    > ?? M src/appl/pretty.c
    > ?? M src/main/engine.c
    > ?? M tests/reg-large.R
    > ?? M tests/reg-tests-2.Rout.save

    > pretty(x, n) fix overflow for large n suggested by Suhartu Aggano, R-devel, 2017-08-11

    > ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel



    > --------------------------------------------
    > On Tue, 15/8/17, Martin Maechler <maechler at stat.math.ethz.ch> wrote:

    > Subject: Re: [Rd] Issues of R_pretty in src/appl/pretty.c
    > To: "Martin Maechler" <maechler at stat.math.ethz.ch>

    > @r-project.org
    > Date: Tuesday, 15 August, 2017, 3:55 PM

>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
    >>>>>> ? ?? on Mon, 14 Aug 2017 11:46:07 +0200 writes:

>>>>> Suharto Anggono Suharto Anggono via R-devel <r-devel at r-project.org>
    >>>>>> ? ?? on Fri, 11 Aug 2017 17:11:06 +0000 writes:
>>>>> Suharto Anggono Suharto Anggono via R-devel <r-devel at r-project.org>
    >>>>>> ? ?? on Fri, 11 Aug 2017 17:11:06 +0000 writes:

    > ? ? >> See https://stat.ethz.ch/pipermail/r-devel/2017-August/074746.html for the origin of the example here.

    > ? ? >> That
    > ? ? >> pretty(c(-1,1)*1e300, n = 1e9, min.n = 1) gave 20 intervals, far from 1e9, but
    > ? ? >> pretty(c(-1,1)*1e300, n = 1e6, min.n = 1) gave 1000000 intervals
    > ? ? >> (on a machine), made me trace through the code to function 'R_pretty' in https://svn.r-project.org/R/trunk/src/appl/pretty.c .

    > ? ? > thank you.

    > ? ? >> *lo is -1e300, *up is 1e300.
    > ? ? >> cell = fmax2(fabs(*lo),fabs(*up));
    > ? ? >> 'cell' is 1e300.
    > ? ? >> i_small = dx < cell * U * imax2(1,*ndiv) * DBL_EPSILON *3;
    > ? ? >> When *ndiv is (int) 1e9, apparently cell * U * imax2(1,*ndiv) overflows to infinity and 'i_small' is 1 (true). It doesn't happen when *ndiv is (int) 1e6.

    > [[elided Yahoo spam]]

    > ? ? >> Putting parentheses may avoid the floating point overflow. For example,
    > ? ? >> i_small = dx < cell * (U * imax2(1,*ndiv) * DBL_EPSILON) *3;

    > ? ? > yes... but only if the compiler optimization steps? "keep the parentheses".
    > ? ? > AFAIK, there is no guarantee for that.
    > ? ? > To make sure, I'd replace the above by

    > ? ? > U *= imax2(1,*ndiv) * DBL_EPSILON;
    > ? ? > i_small = dx < cell * U * 3;


    > ? ? >> The part
    > ? ? >> U = (1 + (h5 >= 1.5*h+.5)) ? 1/(1+h) : 1.5/(1+h5);
    > ? ? >> is strange. Because (h5 >= 1.5*h+.5) is 1 or 0, (1 + (h5 >= 1.5*h+.5)) is never zero and 1/(1+h) will always be chosen.

    > [[elided Yahoo spam]]
    > ? ? > here was as a change (not by me!) adding wrong parentheses
    > ? ? > there (or maybe adding what the previously "missing" parens
    > ? ? > implied, but not what they intended!).
    > ? ? > The original code had been
    > ? ?? 
    > ? ? > U = 1 + (h5 >= 1.5*h+.5) ? 1/(1+h) : 1.5/(1+h5);

    > ? ? > and "of course" was intended to mean

    > ? ? > U = 1 + ((h5 >= 1.5*h+.5) ? 1/(1+h) : 1.5/(1+h5));

    > ? ? > and this what I'll change it to, now.


    > ? ? >> The comment for 'rounding_eps' says "1e-7 is consistent with seq.default()". Currently, seq.default() uses 1e-10 as fuzz.

    > ? ? > Hmm, yes, thank you; this was correct when written,
    > ? ? > but seq.default had been changed in the mean time,
    > ? ? > namely in? svn r51095 | 2010-02-03

    > ? ? > Usually we are cautious / reluctant to change such things w/o
    > ? ? > any bug that we see to fix.
    > ? ? > OTOH, we did have? bug cases we'd wanted to amend for seq() /
    > ? ? > seq.int();
    > ? ? > and I'll look into updating the "pretty - epsilon" also to
    > ? ? > 1e-10.

    > [[elided Yahoo spam]]

    > I've committed now what I think has been suggested
    > above ... to R-devel only :
    > ------------------------------------------------------------------------
    > r73094 | maechler | 2017-08-15 09:10:27 +0200 (Tue, 15. Aug 2017) | 1 Zeile
    > Ge?nderte Pfade:
    > ?? M doc/NEWS.Rd
    > ?? M src/appl/pretty.c
    > ?? M src/main/engine.c
    > ?? M tests/reg-large.R
    > ?? M tests/reg-tests-2.Rout.save

    > pretty(x, n) fix overflow for large n suggested by Suhartu Aggano, R-devel, 2017-08-11


From suharto_anggono at yahoo.com  Sat Aug 19 16:35:07 2017
From: suharto_anggono at yahoo.com (Suharto Anggono Suharto Anggono)
Date: Sat, 19 Aug 2017 14:35:07 +0000 (UTC)
Subject: [Rd] Issues of R_pretty in src/appl/pretty.c
References: <1272671307.772044.1503153307226.ref@mail.yahoo.com>
Message-ID: <1272671307.772044.1503153307226@mail.yahoo.com>

Yes, they work now.

I mentioned them partly because the commit description said overflow for large n and partly to be considered for regression tests.

--------------------------------------------
On Sat, 19/8/17, Martin Maechler <maechler at stat.math.ethz.ch> wrote:

 Subject: Re: [Rd] Issues of R_pretty in src/appl/pretty.c

 Cc: r-devel at r-project.org
 Date: Saturday, 19 August, 2017, 7:47 PM

>>>>> Suharto Anggono Suharto Anggono via R-devel <r-devel at r-project.org>
>>>>>     on Fri, 18 Aug 2017 15:44:06 +0000 writes:

    > Examples similar to
    > pretty(c(-1,1)*1e300, n = 1e9, min.n = 1)
    > with smaller 'n':
    > pretty(c(-1,1)*1e304, n = 1e5, min.n = 1)
    > pretty(c(-1,1)*1e306, n = 1e3, min.n = 1)


Thank you.

"But" all these work now (in R-devel, rev >= 73094) as they should,
at least for me, right?

Are you mentioning the  "small n" examples so we could use them
as regression tests  (instead of the regression test I had added
to tests/reg-large.R  which needs enough GB and is slowish ) --
or are you seeing a platform where the above cases still don't
work in (new enough) R-devel ?


    > A report on 'pretty' when working with integers, similar to what led to change of 'seq' fuzz, is https://bugs.r-project.org/bugzilla3/show_bug.cgi?id=15137

    > --------------------------------------------
    > On Tue, 15/8/17, Martin Maechler <maechler at stat.math.ethz.ch> wrote:

    > Subject: Re: [Rd] Issues of R_pretty in src/appl/pretty.c
    > To: "Martin Maechler" <maechler at stat.math.ethz.ch>

    > @r-project.org
    > Date: Tuesday, 15 August, 2017, 3:55 PM

[snip]

    > I've committed now what I think has been suggested
    > above ... to R-devel only :
    > ------------------------------------------------------------------------
    > r73094 | maechler | 2017-08-15 09:10:27 +0200 (Tue, 15. Aug 2017) | 1 Zeile
    > Ge?nderte Pfade:
    >    M doc/NEWS.Rd
    >    M src/appl/pretty.c
    >    M src/main/engine.c
    >    M tests/reg-large.R
    >    M tests/reg-tests-2.Rout.save

    > pretty(x, n) fix overflow for large n suggested by Suhartu Aggano, R-devel, 2017-08-11


From ghislain.durif at inria.fr  Mon Aug 21 14:55:47 2017
From: ghislain.durif at inria.fr (Ghislain Durif)
Date: Mon, 21 Aug 2017 14:55:47 +0200
Subject: [Rd] Control multi-threading in standard matrix product
Message-ID: <825dace5-8fca-3660-b8b2-fd9f115b29ac@inria.fr>

Dear R Core Team,

I wish to report what can be viewed as a bug or at least a strange 
behavior in R-3.4.1. I ask my question here (as recommended on 
https://www.r-project.org/bugs.html) since I am not member of the R's 
Bugzilla.

When running 'R --vanilla' from the command line, the standard matrix 
product is by default based on BLAS and multi-threaded on all cores 
available on the machine, c.f. following examples:

n=10000
p=1000
q=5000
A = matrix(runif(n*p),nrow=n, ncol=p)
B = matrix(runif(p*q),nrow=p, ncol=q)
C = A %*% B # multi-threaded matrix product


However, the default behavior to use all available cores can be an 
issue, especially on shared computing resources or when the matrix 
product is used in parallelized section of codes (for instance with 
'mclapply' from the 'parallel' package). For instance, the default 
matrix product is single-threaded in R-3.3.2 (I ran a test on my 
machine), this new features will deeply affect the behavior of existing 
R packages that use other multi-threading solutions.

Thanks to this stackoverflow question 
(https://stackoverflow.com/questions/45794290/in-r-how-to-control-multi-threading-in-blas-parallel-matrix-product), 
I now know that it is possible to control the number of BLAS threads 
thanks to the package 'RhpcBLASctl'. However, being able to control the 
number of threads should maybe not require to use an additional package.

In addition, the doc 'matmult' does not mention this point, it points to 
the 'options' doc page and especially the 'matprod' section, in which 
the multi-threading is not discussed.


Here is the results of the 'sessionInfo()' function on my machine for 
R-3.4.1:
R version 3.4.1 (2017-06-30)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 16.04.3 LTS

Matrix products: default
BLAS: /usr/lib/openblas-base/libblas.so.3
LAPACK: /usr/lib/libopenblasp-r0.2.18.so

locale:
  [1] LC_CTYPE=fr_FR.utf8       LC_NUMERIC=C
  [3] LC_TIME=fr_FR.utf8        LC_COLLATE=fr_FR.utf8
  [5] LC_MONETARY=fr_FR.utf8    LC_MESSAGES=fr_FR.utf8
  [7] LC_PAPER=fr_FR.utf8       LC_NAME=C
  [9] LC_ADDRESS=C              LC_TELEPHONE=C
[11] LC_MEASUREMENT=fr_FR.utf8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods base

loaded via a namespace (and not attached):
[1] compiler_3.4.1



and for R-3.3.2:
R version 3.3.2 (2016-10-31)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 16.04.3 LTS

locale:
  [1] LC_CTYPE=fr_FR.utf8       LC_NUMERIC=C
  [3] LC_TIME=fr_FR.utf8        LC_COLLATE=fr_FR.utf8
  [5] LC_MONETARY=fr_FR.utf8    LC_MESSAGES=fr_FR.utf8
  [7] LC_PAPER=fr_FR.utf8       LC_NAME=C
  [9] LC_ADDRESS=C              LC_TELEPHONE=C
[11] LC_MEASUREMENT=fr_FR.utf8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods base


Thanks in advance,
Best regards
||

-- 
Ghislain Durif
--------------------------
Research engineer THOTH TEAM
INRIA Grenoble Alpes (France)


	[[alternative HTML version deleted]]


From tomas.kalibera at gmail.com  Mon Aug 21 15:53:15 2017
From: tomas.kalibera at gmail.com (Tomas Kalibera)
Date: Mon, 21 Aug 2017 15:53:15 +0200
Subject: [Rd] Control multi-threading in standard matrix product
In-Reply-To: <825dace5-8fca-3660-b8b2-fd9f115b29ac@inria.fr>
References: <825dace5-8fca-3660-b8b2-fd9f115b29ac@inria.fr>
Message-ID: <50f32a42-786d-e7c7-71e5-ed0efa975f0a@gmail.com>

Hi Ghislain,

I think you might be comparing two versions of R with different BLAS 
implementations, one that is single threaded (is your 3.3.2 used with 
reference blas?) and one that is multi threaded (3.4.1 with openblas). 
Could you check with "perf"? E.g. run your benchmark with "perf record" 
in both cases and you should see the names of the hot BLAS functions and 
this should reveal the BLAS implementation (look for dgemm).

In Ubuntu, if you install R from the package system, whenever you run it 
it will use the BLAS currently installed via the package system. However 
if you build R from source on Ubuntu, by default, it will use the 
reference BLAS which is distributed with R. Section "Linear algebra" of 
"R Installation and Administration" has details on how to build R with 
different BLAS/LAPACK implementations.

Sadly there is no standard way to specify the number of BLAS worker 
threads. RhpcBLASctl has specific code for several existing 
implementations, but R itself does not attempt to control BLAS multi 
threading in any way. It is expected the user/system administrator will 
configure their BLAS implementation of choice to use the number of 
threads they need. A similar problem exists in other internally 
multi-threaded third-party libraries, used by packages - R cannot 
control how many threads they run.

Best
Tomas

On 08/21/2017 02:55 PM, Ghislain Durif wrote:
> Dear R Core Team,
>
> I wish to report what can be viewed as a bug or at least a strange
> behavior in R-3.4.1. I ask my question here (as recommended on
> https://www.r-project.org/bugs.html) since I am not member of the R's
> Bugzilla.
>
> When running 'R --vanilla' from the command line, the standard matrix
> product is by default based on BLAS and multi-threaded on all cores
> available on the machine, c.f. following examples:
>
> n=10000
> p=1000
> q=5000
> A = matrix(runif(n*p),nrow=n, ncol=p)
> B = matrix(runif(p*q),nrow=p, ncol=q)
> C = A %*% B # multi-threaded matrix product
>
>
> However, the default behavior to use all available cores can be an
> issue, especially on shared computing resources or when the matrix
> product is used in parallelized section of codes (for instance with
> 'mclapply' from the 'parallel' package). For instance, the default
> matrix product is single-threaded in R-3.3.2 (I ran a test on my
> machine), this new features will deeply affect the behavior of existing
> R packages that use other multi-threading solutions.
>
> Thanks to this stackoverflow question
> (https://stackoverflow.com/questions/45794290/in-r-how-to-control-multi-threading-in-blas-parallel-matrix-product),
> I now know that it is possible to control the number of BLAS threads
> thanks to the package 'RhpcBLASctl'. However, being able to control the
> number of threads should maybe not require to use an additional package.
>
> In addition, the doc 'matmult' does not mention this point, it points to
> the 'options' doc page and especially the 'matprod' section, in which
> the multi-threading is not discussed.
>
>
> Here is the results of the 'sessionInfo()' function on my machine for
> R-3.4.1:
> R version 3.4.1 (2017-06-30)
> Platform: x86_64-pc-linux-gnu (64-bit)
> Running under: Ubuntu 16.04.3 LTS
>
> Matrix products: default
> BLAS: /usr/lib/openblas-base/libblas.so.3
> LAPACK: /usr/lib/libopenblasp-r0.2.18.so
>
> locale:
>    [1] LC_CTYPE=fr_FR.utf8       LC_NUMERIC=C
>    [3] LC_TIME=fr_FR.utf8        LC_COLLATE=fr_FR.utf8
>    [5] LC_MONETARY=fr_FR.utf8    LC_MESSAGES=fr_FR.utf8
>    [7] LC_PAPER=fr_FR.utf8       LC_NAME=C
>    [9] LC_ADDRESS=C              LC_TELEPHONE=C
> [11] LC_MEASUREMENT=fr_FR.utf8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods base
>
> loaded via a namespace (and not attached):
> [1] compiler_3.4.1
>
>
>
> and for R-3.3.2:
> R version 3.3.2 (2016-10-31)
> Platform: x86_64-pc-linux-gnu (64-bit)
> Running under: Ubuntu 16.04.3 LTS
>
> locale:
>    [1] LC_CTYPE=fr_FR.utf8       LC_NUMERIC=C
>    [3] LC_TIME=fr_FR.utf8        LC_COLLATE=fr_FR.utf8
>    [5] LC_MONETARY=fr_FR.utf8    LC_MESSAGES=fr_FR.utf8
>    [7] LC_PAPER=fr_FR.utf8       LC_NAME=C
>    [9] LC_ADDRESS=C              LC_TELEPHONE=C
> [11] LC_MEASUREMENT=fr_FR.utf8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods base
>
>
> Thanks in advance,
> Best regards
> ||
>


From luke-tierney at uiowa.edu  Mon Aug 21 16:07:02 2017
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Mon, 21 Aug 2017 09:07:02 -0500 (CDT)
Subject: [Rd] Control multi-threading in standard matrix product
In-Reply-To: <50f32a42-786d-e7c7-71e5-ed0efa975f0a@gmail.com>
References: <825dace5-8fca-3660-b8b2-fd9f115b29ac@inria.fr>
 <50f32a42-786d-e7c7-71e5-ed0efa975f0a@gmail.com>
Message-ID: <alpine.DEB.2.20.1708210905360.2616@luke-Latitude>

Many, though not all, threaded BLAS honor the OpenMP environment
variables; you might see whether setting OMP_THEAD_LIMIT or
OMP_NUM_THREADS does what you want.

Best,

luke

On Mon, 21 Aug 2017, Tomas Kalibera wrote:

> Hi Ghislain,
>
> I think you might be comparing two versions of R with different BLAS 
> implementations, one that is single threaded (is your 3.3.2 used with 
> reference blas?) and one that is multi threaded (3.4.1 with openblas). Could 
> you check with "perf"? E.g. run your benchmark with "perf record" in both 
> cases and you should see the names of the hot BLAS functions and this should 
> reveal the BLAS implementation (look for dgemm).
>
> In Ubuntu, if you install R from the package system, whenever you run it it 
> will use the BLAS currently installed via the package system. However if you 
> build R from source on Ubuntu, by default, it will use the reference BLAS 
> which is distributed with R. Section "Linear algebra" of "R Installation and 
> Administration" has details on how to build R with different BLAS/LAPACK 
> implementations.
>
> Sadly there is no standard way to specify the number of BLAS worker threads. 
> RhpcBLASctl has specific code for several existing implementations, but R 
> itself does not attempt to control BLAS multi threading in any way. It is 
> expected the user/system administrator will configure their BLAS 
> implementation of choice to use the number of threads they need. A similar 
> problem exists in other internally multi-threaded third-party libraries, used 
> by packages - R cannot control how many threads they run.
>
> Best
> Tomas
>
> On 08/21/2017 02:55 PM, Ghislain Durif wrote:
>> Dear R Core Team,
>> 
>> I wish to report what can be viewed as a bug or at least a strange
>> behavior in R-3.4.1. I ask my question here (as recommended on
>> https://www.r-project.org/bugs.html) since I am not member of the R's
>> Bugzilla.
>> 
>> When running 'R --vanilla' from the command line, the standard matrix
>> product is by default based on BLAS and multi-threaded on all cores
>> available on the machine, c.f. following examples:
>> 
>> n=10000
>> p=1000
>> q=5000
>> A = matrix(runif(n*p),nrow=n, ncol=p)
>> B = matrix(runif(p*q),nrow=p, ncol=q)
>> C = A %*% B # multi-threaded matrix product
>> 
>> 
>> However, the default behavior to use all available cores can be an
>> issue, especially on shared computing resources or when the matrix
>> product is used in parallelized section of codes (for instance with
>> 'mclapply' from the 'parallel' package). For instance, the default
>> matrix product is single-threaded in R-3.3.2 (I ran a test on my
>> machine), this new features will deeply affect the behavior of existing
>> R packages that use other multi-threading solutions.
>> 
>> Thanks to this stackoverflow question
>> (https://stackoverflow.com/questions/45794290/in-r-how-to-control-multi-threading-in-blas-parallel-matrix-product),
>> I now know that it is possible to control the number of BLAS threads
>> thanks to the package 'RhpcBLASctl'. However, being able to control the
>> number of threads should maybe not require to use an additional package.
>> 
>> In addition, the doc 'matmult' does not mention this point, it points to
>> the 'options' doc page and especially the 'matprod' section, in which
>> the multi-threading is not discussed.
>> 
>> 
>> Here is the results of the 'sessionInfo()' function on my machine for
>> R-3.4.1:
>> R version 3.4.1 (2017-06-30)
>> Platform: x86_64-pc-linux-gnu (64-bit)
>> Running under: Ubuntu 16.04.3 LTS
>> 
>> Matrix products: default
>> BLAS: /usr/lib/openblas-base/libblas.so.3
>> LAPACK: /usr/lib/libopenblasp-r0.2.18.so
>> 
>> locale:
>>    [1] LC_CTYPE=fr_FR.utf8       LC_NUMERIC=C
>>    [3] LC_TIME=fr_FR.utf8        LC_COLLATE=fr_FR.utf8
>>    [5] LC_MONETARY=fr_FR.utf8    LC_MESSAGES=fr_FR.utf8
>>    [7] LC_PAPER=fr_FR.utf8       LC_NAME=C
>>    [9] LC_ADDRESS=C              LC_TELEPHONE=C
>> [11] LC_MEASUREMENT=fr_FR.utf8 LC_IDENTIFICATION=C
>> 
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods base
>> 
>> loaded via a namespace (and not attached):
>> [1] compiler_3.4.1
>> 
>> 
>> 
>> and for R-3.3.2:
>> R version 3.3.2 (2016-10-31)
>> Platform: x86_64-pc-linux-gnu (64-bit)
>> Running under: Ubuntu 16.04.3 LTS
>> 
>> locale:
>>    [1] LC_CTYPE=fr_FR.utf8       LC_NUMERIC=C
>>    [3] LC_TIME=fr_FR.utf8        LC_COLLATE=fr_FR.utf8
>>    [5] LC_MONETARY=fr_FR.utf8    LC_MESSAGES=fr_FR.utf8
>>    [7] LC_PAPER=fr_FR.utf8       LC_NAME=C
>>    [9] LC_ADDRESS=C              LC_TELEPHONE=C
>> [11] LC_MEASUREMENT=fr_FR.utf8 LC_IDENTIFICATION=C
>> 
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods base
>> 
>> 
>> Thanks in advance,
>> Best regards
>> ||
>> 
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From ghislain.durif at inria.fr  Mon Aug 21 16:13:21 2017
From: ghislain.durif at inria.fr (Ghislain Durif)
Date: Mon, 21 Aug 2017 16:13:21 +0200
Subject: [Rd] Control multi-threading in standard matrix product
In-Reply-To: <50f32a42-786d-e7c7-71e5-ed0efa975f0a@gmail.com>
References: <825dace5-8fca-3660-b8b2-fd9f115b29ac@inria.fr>
 <50f32a42-786d-e7c7-71e5-ed0efa975f0a@gmail.com>
Message-ID: <49ca2606-ee0d-d6ea-b894-81816bc5fad4@inria.fr>

Hi Tomas,

Thanks for your answer.

Indeed, I checked and my R-3.4.1 installed from the ubuntu repository 
use 'libopenblasp-r0.2.18.so' while my R-3.3.2 that I did compiled on my 
machine use 'libRblas.so' which explain the difference of behavior.

I will use RhpcBLASctl to avoid issue when combining matrix product and 
other multi-threading package.

Maybe this point regarding multi-threading with BLAS could be added in 
the R doc.

Thanks again,
Best,

Ghislain

Ghislain Durif
--------------------------
Research engineer THOTH TEAM
INRIA Grenoble Alpes (France)

Le 21/08/2017 ? 15:53, Tomas Kalibera a ?crit :
> Hi Ghislain,
>
> I think you might be comparing two versions of R with different BLAS 
> implementations, one that is single threaded (is your 3.3.2 used with 
> reference blas?) and one that is multi threaded (3.4.1 with openblas). 
> Could you check with "perf"? E.g. run your benchmark with "perf 
> record" in both cases and you should see the names of the hot BLAS 
> functions and this should reveal the BLAS implementation (look for 
> dgemm).
>
> In Ubuntu, if you install R from the package system, whenever you run 
> it it will use the BLAS currently installed via the package system. 
> However if you build R from source on Ubuntu, by default, it will use 
> the reference BLAS which is distributed with R. Section "Linear 
> algebra" of "R Installation and Administration" has details on how to 
> build R with different BLAS/LAPACK implementations.
>
> Sadly there is no standard way to specify the number of BLAS worker 
> threads. RhpcBLASctl has specific code for several existing 
> implementations, but R itself does not attempt to control BLAS multi 
> threading in any way. It is expected the user/system administrator 
> will configure their BLAS implementation of choice to use the number 
> of threads they need. A similar problem exists in other internally 
> multi-threaded third-party libraries, used by packages - R cannot 
> control how many threads they run.
>
> Best
> Tomas
>
> On 08/21/2017 02:55 PM, Ghislain Durif wrote:
>> Dear R Core Team,
>>
>> I wish to report what can be viewed as a bug or at least a strange
>> behavior in R-3.4.1. I ask my question here (as recommended on
>> https://www.r-project.org/bugs.html) since I am not member of the R's
>> Bugzilla.
>>
>> When running 'R --vanilla' from the command line, the standard matrix
>> product is by default based on BLAS and multi-threaded on all cores
>> available on the machine, c.f. following examples:
>>
>> n=10000
>> p=1000
>> q=5000
>> A = matrix(runif(n*p),nrow=n, ncol=p)
>> B = matrix(runif(p*q),nrow=p, ncol=q)
>> C = A %*% B # multi-threaded matrix product
>>
>>
>> However, the default behavior to use all available cores can be an
>> issue, especially on shared computing resources or when the matrix
>> product is used in parallelized section of codes (for instance with
>> 'mclapply' from the 'parallel' package). For instance, the default
>> matrix product is single-threaded in R-3.3.2 (I ran a test on my
>> machine), this new features will deeply affect the behavior of existing
>> R packages that use other multi-threading solutions.
>>
>> Thanks to this stackoverflow question
>> (https://stackoverflow.com/questions/45794290/in-r-how-to-control-multi-threading-in-blas-parallel-matrix-product), 
>>
>> I now know that it is possible to control the number of BLAS threads
>> thanks to the package 'RhpcBLASctl'. However, being able to control the
>> number of threads should maybe not require to use an additional package.
>>
>> In addition, the doc 'matmult' does not mention this point, it points to
>> the 'options' doc page and especially the 'matprod' section, in which
>> the multi-threading is not discussed.
>>
>>
>> Here is the results of the 'sessionInfo()' function on my machine for
>> R-3.4.1:
>> R version 3.4.1 (2017-06-30)
>> Platform: x86_64-pc-linux-gnu (64-bit)
>> Running under: Ubuntu 16.04.3 LTS
>>
>> Matrix products: default
>> BLAS: /usr/lib/openblas-base/libblas.so.3
>> LAPACK: /usr/lib/libopenblasp-r0.2.18.so
>>
>> locale:
>>    [1] LC_CTYPE=fr_FR.utf8       LC_NUMERIC=C
>>    [3] LC_TIME=fr_FR.utf8        LC_COLLATE=fr_FR.utf8
>>    [5] LC_MONETARY=fr_FR.utf8    LC_MESSAGES=fr_FR.utf8
>>    [7] LC_PAPER=fr_FR.utf8       LC_NAME=C
>>    [9] LC_ADDRESS=C              LC_TELEPHONE=C
>> [11] LC_MEASUREMENT=fr_FR.utf8 LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods base
>>
>> loaded via a namespace (and not attached):
>> [1] compiler_3.4.1
>>
>>
>>
>> and for R-3.3.2:
>> R version 3.3.2 (2016-10-31)
>> Platform: x86_64-pc-linux-gnu (64-bit)
>> Running under: Ubuntu 16.04.3 LTS
>>
>> locale:
>>    [1] LC_CTYPE=fr_FR.utf8       LC_NUMERIC=C
>>    [3] LC_TIME=fr_FR.utf8        LC_COLLATE=fr_FR.utf8
>>    [5] LC_MONETARY=fr_FR.utf8    LC_MESSAGES=fr_FR.utf8
>>    [7] LC_PAPER=fr_FR.utf8       LC_NAME=C
>>    [9] LC_ADDRESS=C              LC_TELEPHONE=C
>> [11] LC_MEASUREMENT=fr_FR.utf8 LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods base
>>
>>
>> Thanks in advance,
>> Best regards
>> ||
>>
>


From istazahn at gmail.com  Mon Aug 21 17:28:10 2017
From: istazahn at gmail.com (Ista Zahn)
Date: Mon, 21 Aug 2017 11:28:10 -0400
Subject: [Rd] Control multi-threading in standard matrix product
In-Reply-To: <49ca2606-ee0d-d6ea-b894-81816bc5fad4@inria.fr>
References: <825dace5-8fca-3660-b8b2-fd9f115b29ac@inria.fr>
 <50f32a42-786d-e7c7-71e5-ed0efa975f0a@gmail.com>
 <49ca2606-ee0d-d6ea-b894-81816bc5fad4@inria.fr>
Message-ID: <CA+vqiLE50rq-2StKUV5zxueLqxtXsDKNBVw_so9WC-kj-1T2fg@mail.gmail.com>

Hi Ghislain,

The documentation at
https://cran.r-project.org/doc/manuals/r-release/R-admin.html#BLAS
provides a fair bit of information. What specifically would you like
to see added?

Best,
Ista

On Mon, Aug 21, 2017 at 10:13 AM, Ghislain Durif
<ghislain.durif at inria.fr> wrote:
> Hi Tomas,
>
> Thanks for your answer.
>
> Indeed, I checked and my R-3.4.1 installed from the ubuntu repository use
> 'libopenblasp-r0.2.18.so' while my R-3.3.2 that I did compiled on my machine
> use 'libRblas.so' which explain the difference of behavior.
>
> I will use RhpcBLASctl to avoid issue when combining matrix product and
> other multi-threading package.
>
> Maybe this point regarding multi-threading with BLAS could be added in the R
> doc.
>
> Thanks again,
> Best,
>
> Ghislain
>
> Ghislain Durif
> --------------------------
> Research engineer THOTH TEAM
> INRIA Grenoble Alpes (France)
>
> Le 21/08/2017 ? 15:53, Tomas Kalibera a ?crit :
>>
>> Hi Ghislain,
>>
>> I think you might be comparing two versions of R with different BLAS
>> implementations, one that is single threaded (is your 3.3.2 used with
>> reference blas?) and one that is multi threaded (3.4.1 with openblas). Could
>> you check with "perf"? E.g. run your benchmark with "perf record" in both
>> cases and you should see the names of the hot BLAS functions and this should
>> reveal the BLAS implementation (look for dgemm).
>>
>> In Ubuntu, if you install R from the package system, whenever you run it
>> it will use the BLAS currently installed via the package system. However if
>> you build R from source on Ubuntu, by default, it will use the reference
>> BLAS which is distributed with R. Section "Linear algebra" of "R
>> Installation and Administration" has details on how to build R with
>> different BLAS/LAPACK implementations.
>>
>> Sadly there is no standard way to specify the number of BLAS worker
>> threads. RhpcBLASctl has specific code for several existing implementations,
>> but R itself does not attempt to control BLAS multi threading in any way. It
>> is expected the user/system administrator will configure their BLAS
>> implementation of choice to use the number of threads they need. A similar
>> problem exists in other internally multi-threaded third-party libraries,
>> used by packages - R cannot control how many threads they run.
>>
>> Best
>> Tomas
>>
>> On 08/21/2017 02:55 PM, Ghislain Durif wrote:
>>>
>>> Dear R Core Team,
>>>
>>> I wish to report what can be viewed as a bug or at least a strange
>>> behavior in R-3.4.1. I ask my question here (as recommended on
>>> https://www.r-project.org/bugs.html) since I am not member of the R's
>>> Bugzilla.
>>>
>>> When running 'R --vanilla' from the command line, the standard matrix
>>> product is by default based on BLAS and multi-threaded on all cores
>>> available on the machine, c.f. following examples:
>>>
>>> n=10000
>>> p=1000
>>> q=5000
>>> A = matrix(runif(n*p),nrow=n, ncol=p)
>>> B = matrix(runif(p*q),nrow=p, ncol=q)
>>> C = A %*% B # multi-threaded matrix product
>>>
>>>
>>> However, the default behavior to use all available cores can be an
>>> issue, especially on shared computing resources or when the matrix
>>> product is used in parallelized section of codes (for instance with
>>> 'mclapply' from the 'parallel' package). For instance, the default
>>> matrix product is single-threaded in R-3.3.2 (I ran a test on my
>>> machine), this new features will deeply affect the behavior of existing
>>> R packages that use other multi-threading solutions.
>>>
>>> Thanks to this stackoverflow question
>>>
>>> (https://stackoverflow.com/questions/45794290/in-r-how-to-control-multi-threading-in-blas-parallel-matrix-product),
>>> I now know that it is possible to control the number of BLAS threads
>>> thanks to the package 'RhpcBLASctl'. However, being able to control the
>>> number of threads should maybe not require to use an additional package.
>>>
>>> In addition, the doc 'matmult' does not mention this point, it points to
>>> the 'options' doc page and especially the 'matprod' section, in which
>>> the multi-threading is not discussed.
>>>
>>>
>>> Here is the results of the 'sessionInfo()' function on my machine for
>>> R-3.4.1:
>>> R version 3.4.1 (2017-06-30)
>>> Platform: x86_64-pc-linux-gnu (64-bit)
>>> Running under: Ubuntu 16.04.3 LTS
>>>
>>> Matrix products: default
>>> BLAS: /usr/lib/openblas-base/libblas.so.3
>>> LAPACK: /usr/lib/libopenblasp-r0.2.18.so
>>>
>>> locale:
>>>    [1] LC_CTYPE=fr_FR.utf8       LC_NUMERIC=C
>>>    [3] LC_TIME=fr_FR.utf8        LC_COLLATE=fr_FR.utf8
>>>    [5] LC_MONETARY=fr_FR.utf8    LC_MESSAGES=fr_FR.utf8
>>>    [7] LC_PAPER=fr_FR.utf8       LC_NAME=C
>>>    [9] LC_ADDRESS=C              LC_TELEPHONE=C
>>> [11] LC_MEASUREMENT=fr_FR.utf8 LC_IDENTIFICATION=C
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods base
>>>
>>> loaded via a namespace (and not attached):
>>> [1] compiler_3.4.1
>>>
>>>
>>>
>>> and for R-3.3.2:
>>> R version 3.3.2 (2016-10-31)
>>> Platform: x86_64-pc-linux-gnu (64-bit)
>>> Running under: Ubuntu 16.04.3 LTS
>>>
>>> locale:
>>>    [1] LC_CTYPE=fr_FR.utf8       LC_NUMERIC=C
>>>    [3] LC_TIME=fr_FR.utf8        LC_COLLATE=fr_FR.utf8
>>>    [5] LC_MONETARY=fr_FR.utf8    LC_MESSAGES=fr_FR.utf8
>>>    [7] LC_PAPER=fr_FR.utf8       LC_NAME=C
>>>    [9] LC_ADDRESS=C              LC_TELEPHONE=C
>>> [11] LC_MEASUREMENT=fr_FR.utf8 LC_IDENTIFICATION=C
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods base
>>>
>>>
>>> Thanks in advance,
>>> Best regards
>>> ||
>>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ghislain.durif at inria.fr  Mon Aug 21 17:40:54 2017
From: ghislain.durif at inria.fr (Ghislain Durif)
Date: Mon, 21 Aug 2017 17:40:54 +0200
Subject: [Rd] Control multi-threading in standard matrix product
In-Reply-To: <CA+vqiLE50rq-2StKUV5zxueLqxtXsDKNBVw_so9WC-kj-1T2fg@mail.gmail.com>
References: <825dace5-8fca-3660-b8b2-fd9f115b29ac@inria.fr>
 <50f32a42-786d-e7c7-71e5-ed0efa975f0a@gmail.com>
 <49ca2606-ee0d-d6ea-b894-81816bc5fad4@inria.fr>
 <CA+vqiLE50rq-2StKUV5zxueLqxtXsDKNBVw_so9WC-kj-1T2fg@mail.gmail.com>
Message-ID: <429f4393-2b0e-5451-a311-d7d74c142e3a@inria.fr>

Hi Ista,

Maybe a little comment in the 'matmult {base}' doc page or on the 
'options {base}' in the field 'matprod' would be useful to remind users 
to be cautious regarding BLAS multi-threading?

I understand why this is a BLAS related issue and not directly an R 
related issue. Nonetheless, my concern was for non-advanced R users, 
that may don't even know what BLAS is. For instance, I have a package on 
the CRAN that use 'mclapply' from the 'parallel' package and the 
multi-threading from BLAS (when using OpenBLAS) totally messes up with 
my multi-threading (regarding computing performance). Hence, I think 
that some of the users of my package, if not aware of that, may 
encounter severe issues, especially because this package is mainly used 
to analyse bioinformatics data, which requires important computing 
resources.

Anyway, it works well on my machine now, and I will modify my package to 
ensure that users won't encounter this case of "multi" multi-threading.

Thanks again,
Best,

Ghislain

Ghislain Durif
--------------------------
Research engineer THOTH TEAM
INRIA Grenoble Alpes (France)

Le 21/08/2017 ? 17:28, Ista Zahn a ?crit :
> Hi Ghislain,
>
> The documentation at
> https://cran.r-project.org/doc/manuals/r-release/R-admin.html#BLAS
> provides a fair bit of information. What specifically would you like
> to see added?
>
> Best,
> Ista
>
> On Mon, Aug 21, 2017 at 10:13 AM, Ghislain Durif
> <ghislain.durif at inria.fr> wrote:
>> Hi Tomas,
>>
>> Thanks for your answer.
>>
>> Indeed, I checked and my R-3.4.1 installed from the ubuntu repository use
>> 'libopenblasp-r0.2.18.so' while my R-3.3.2 that I did compiled on my machine
>> use 'libRblas.so' which explain the difference of behavior.
>>
>> I will use RhpcBLASctl to avoid issue when combining matrix product and
>> other multi-threading package.
>>
>> Maybe this point regarding multi-threading with BLAS could be added in the R
>> doc.
>>
>> Thanks again,
>> Best,
>>
>> Ghislain
>>
>> Ghislain Durif
>> --------------------------
>> Research engineer THOTH TEAM
>> INRIA Grenoble Alpes (France)
>>
>> Le 21/08/2017 ? 15:53, Tomas Kalibera a ?crit :
>>> Hi Ghislain,
>>>
>>> I think you might be comparing two versions of R with different BLAS
>>> implementations, one that is single threaded (is your 3.3.2 used with
>>> reference blas?) and one that is multi threaded (3.4.1 with openblas). Could
>>> you check with "perf"? E.g. run your benchmark with "perf record" in both
>>> cases and you should see the names of the hot BLAS functions and this should
>>> reveal the BLAS implementation (look for dgemm).
>>>
>>> In Ubuntu, if you install R from the package system, whenever you run it
>>> it will use the BLAS currently installed via the package system. However if
>>> you build R from source on Ubuntu, by default, it will use the reference
>>> BLAS which is distributed with R. Section "Linear algebra" of "R
>>> Installation and Administration" has details on how to build R with
>>> different BLAS/LAPACK implementations.
>>>
>>> Sadly there is no standard way to specify the number of BLAS worker
>>> threads. RhpcBLASctl has specific code for several existing implementations,
>>> but R itself does not attempt to control BLAS multi threading in any way. It
>>> is expected the user/system administrator will configure their BLAS
>>> implementation of choice to use the number of threads they need. A similar
>>> problem exists in other internally multi-threaded third-party libraries,
>>> used by packages - R cannot control how many threads they run.
>>>
>>> Best
>>> Tomas
>>>
>>> On 08/21/2017 02:55 PM, Ghislain Durif wrote:
>>>> Dear R Core Team,
>>>>
>>>> I wish to report what can be viewed as a bug or at least a strange
>>>> behavior in R-3.4.1. I ask my question here (as recommended on
>>>> https://www.r-project.org/bugs.html) since I am not member of the R's
>>>> Bugzilla.
>>>>
>>>> When running 'R --vanilla' from the command line, the standard matrix
>>>> product is by default based on BLAS and multi-threaded on all cores
>>>> available on the machine, c.f. following examples:
>>>>
>>>> n=10000
>>>> p=1000
>>>> q=5000
>>>> A = matrix(runif(n*p),nrow=n, ncol=p)
>>>> B = matrix(runif(p*q),nrow=p, ncol=q)
>>>> C = A %*% B # multi-threaded matrix product
>>>>
>>>>
>>>> However, the default behavior to use all available cores can be an
>>>> issue, especially on shared computing resources or when the matrix
>>>> product is used in parallelized section of codes (for instance with
>>>> 'mclapply' from the 'parallel' package). For instance, the default
>>>> matrix product is single-threaded in R-3.3.2 (I ran a test on my
>>>> machine), this new features will deeply affect the behavior of existing
>>>> R packages that use other multi-threading solutions.
>>>>
>>>> Thanks to this stackoverflow question
>>>>
>>>> (https://stackoverflow.com/questions/45794290/in-r-how-to-control-multi-threading-in-blas-parallel-matrix-product),
>>>> I now know that it is possible to control the number of BLAS threads
>>>> thanks to the package 'RhpcBLASctl'. However, being able to control the
>>>> number of threads should maybe not require to use an additional package.
>>>>
>>>> In addition, the doc 'matmult' does not mention this point, it points to
>>>> the 'options' doc page and especially the 'matprod' section, in which
>>>> the multi-threading is not discussed.
>>>>
>>>>
>>>> Here is the results of the 'sessionInfo()' function on my machine for
>>>> R-3.4.1:
>>>> R version 3.4.1 (2017-06-30)
>>>> Platform: x86_64-pc-linux-gnu (64-bit)
>>>> Running under: Ubuntu 16.04.3 LTS
>>>>
>>>> Matrix products: default
>>>> BLAS: /usr/lib/openblas-base/libblas.so.3
>>>> LAPACK: /usr/lib/libopenblasp-r0.2.18.so
>>>>
>>>> locale:
>>>>     [1] LC_CTYPE=fr_FR.utf8       LC_NUMERIC=C
>>>>     [3] LC_TIME=fr_FR.utf8        LC_COLLATE=fr_FR.utf8
>>>>     [5] LC_MONETARY=fr_FR.utf8    LC_MESSAGES=fr_FR.utf8
>>>>     [7] LC_PAPER=fr_FR.utf8       LC_NAME=C
>>>>     [9] LC_ADDRESS=C              LC_TELEPHONE=C
>>>> [11] LC_MEASUREMENT=fr_FR.utf8 LC_IDENTIFICATION=C
>>>>
>>>> attached base packages:
>>>> [1] stats     graphics  grDevices utils     datasets  methods base
>>>>
>>>> loaded via a namespace (and not attached):
>>>> [1] compiler_3.4.1
>>>>
>>>>
>>>>
>>>> and for R-3.3.2:
>>>> R version 3.3.2 (2016-10-31)
>>>> Platform: x86_64-pc-linux-gnu (64-bit)
>>>> Running under: Ubuntu 16.04.3 LTS
>>>>
>>>> locale:
>>>>     [1] LC_CTYPE=fr_FR.utf8       LC_NUMERIC=C
>>>>     [3] LC_TIME=fr_FR.utf8        LC_COLLATE=fr_FR.utf8
>>>>     [5] LC_MONETARY=fr_FR.utf8    LC_MESSAGES=fr_FR.utf8
>>>>     [7] LC_PAPER=fr_FR.utf8       LC_NAME=C
>>>>     [9] LC_ADDRESS=C              LC_TELEPHONE=C
>>>> [11] LC_MEASUREMENT=fr_FR.utf8 LC_IDENTIFICATION=C
>>>>
>>>> attached base packages:
>>>> [1] stats     graphics  grDevices utils     datasets  methods base
>>>>
>>>>
>>>> Thanks in advance,
>>>> Best regards
>>>> ||
>>>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel


From stefanML at collocations.de  Mon Aug 21 23:44:45 2017
From: stefanML at collocations.de (Stefan Evert)
Date: Mon, 21 Aug 2017 23:44:45 +0200
Subject: [Rd] Control multi-threading in standard matrix product
In-Reply-To: <429f4393-2b0e-5451-a311-d7d74c142e3a@inria.fr>
References: <825dace5-8fca-3660-b8b2-fd9f115b29ac@inria.fr>
 <50f32a42-786d-e7c7-71e5-ed0efa975f0a@gmail.com>
 <49ca2606-ee0d-d6ea-b894-81816bc5fad4@inria.fr>
 <CA+vqiLE50rq-2StKUV5zxueLqxtXsDKNBVw_so9WC-kj-1T2fg@mail.gmail.com>
 <429f4393-2b0e-5451-a311-d7d74c142e3a@inria.fr>
Message-ID: <7BC03A9E-B7C8-481E-AB2B-D06562177DF0@collocations.de>


> On 21 Aug 2017, at 17:40, Ghislain Durif <ghislain.durif at inria.fr> wrote:
> 
> I understand why this is a BLAS related issue and not directly an R related issue. Nonetheless, my concern was for non-advanced R users, that may don't even know what BLAS is. For instance, I have a package on the CRAN that use 'mclapply' from the 'parallel' package and the multi-threading from BLAS (when using OpenBLAS) totally messes up with my multi-threading (regarding computing performance). Hence, I think that some of the users of my package, if not aware of that, may encounter severe issues, especially because this package is mainly used to analyse bioinformatics data, which requires important computing resources.

Why do you expect that users who don't know what BLAS is would explicitly install a multi-threaded BLAS on their Ubuntu machine? 

Best,
Stefan

From tomas.kalibera at gmail.com  Tue Aug 22 11:49:36 2017
From: tomas.kalibera at gmail.com (Tomas Kalibera)
Date: Tue, 22 Aug 2017 11:49:36 +0200
Subject: [Rd] Problem with a regular expression.
In-Reply-To: <d6335c46b0554853ba8ae1d8ecf1e949@uni-mainz.de>
References: <65e225958ba74a7dbcf0bc4688387e9d@uxcn13-ogg-c.UoA.auckland.ac.nz>
 <5995451B.5040708@sapo.pt> <1783369282.3222160.1502955902026@mail.yahoo.com>
 <d697b033-1eff-d82a-160d-95f7e718c5aa@gmail.com>
 <d6335c46b0554853ba8ae1d8ecf1e949@uni-mainz.de>
Message-ID: <e458b363-dd2f-ff97-f1f2-098c540df372@gmail.com>

Thanks, I patched the TRE sources in R-devel 73107 and closed the PR.
Tomas

On 08/17/2017 11:06 AM, Wollschlaeger, Daniel wrote:
> The issue seems related to R bug report 15012:
>
> https://bugs.r-project.org/bugzilla3/show_bug.cgi?id=15012
>
> As mentioned in the comments there, a pull request to the TRE library has recently been made, but I don't know about its status.
>
> Daniel
>
> ________________________________________
> Von: R-devel <r-devel-bounces at r-project.org> im Auftrag von Tomas Kalibera <tomas.kalibera at gmail.com>
> Gesendet: Donnerstag, 17. August 2017 10:14
> An: r-devel at r-project.org
> Betreff: Re: [Rd] Problem with a regular expression.
>
> The problem is in TRE library, in regcomp, while compiling the regular
> expression.
>
> This is enough to trigger in R (to do this without re-boot: ulimit -v
> 500000 ):
>   > strsplit("", "\\\\)")
>
> To repeat in TRE, one can build TRE from sources and run
>   > ./src/agrep "\\\\)" README.md
>
> Tomas
>
>
> On 08/17/2017 09:45 AM, Moshe Olshansky via R-devel wrote:
>> I tried this on a Linux (Ubuntu) server invoking R from the command line and the result was the same, except that I could kill the R session from another terminal window.
>>
>>
>>         From: Rui Barradas <ruipbarradas at sapo.pt>
>>    To: Chris Triggs <cm.triggs at auckland.ac.nz>; "r-devel at r-project.org" <r-devel at r-project.org>
>> Cc: Thomas Lumley <t.lumley at auckland.ac.nz>
>>    Sent: Thursday, 17 August 2017, 17:26
>>    Subject: Re: [Rd] Problem with a regular expression.
>>
>> Hello,
>>
>> This seems to be serious.
>> RGui.exe, fresh session. I've clicked File > New Script and wrote
>>
>> Oldterm <- c("A", "B", "A", "*", "B")
>> strsplit(Oldterm, "\\\\)" )
>>
>> Ran each instruction at a time with Ctrl+r and with the strsplit call
>> the system froze.
>>
>> Ctrl+Alt+Del didn't work, I had to go for the power switch button.
>>
>> sessionInfo()
>> R version 3.4.1 (2017-06-30)
>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>
>> Matrix products: default
>>
>> locale:
>> [1] LC_COLLATE=Portuguese_Portugal.1252
>> LC_CTYPE=Portuguese_Portugal.1252
>> [3] LC_MONETARY=Portuguese_Portugal.1252 LC_NUMERIC=C
>>
>> [5] LC_TIME=Portuguese_Portugal.1252
>>
>> attached base packages:
>> [1] stats    graphics  grDevices utils    datasets  methods  base
>>
>> loaded via a namespace (and not attached):
>> [1] compiler_3.4.1
>>
>>
>> Rui Barradas
>>
>> Em 16-08-2017 23:31, Chris Triggs escreveu:
>>> Hi...
>>>
>>> I have come upon a problem with a regular expression which causes base-R to freeze.  I have reproduced the phenomenon on several machines running R under Windows 10, and also under OSX  on different Apple MACs.
>>>
>>> The minimal example is:-
>>> Oldterm is a vector of characters, e.g. "A", "B", "A", "*", "B"
>>> The regular expression is "\\\\)"
>>>
>>> The call which freezes R is
>>> strsplit(Oldterm, "\\\\)" )
>>>
>>> Thomas - after he had reproduced the problem - suggested that I submit it to r-devel.
>>>
>>> Best wishes....
>>>               Chris Triggs
>>>
>>>
>>>       [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>>
>>        [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Tue Aug 22 12:48:13 2017
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 22 Aug 2017 12:48:13 +0200
Subject: [Rd] Issues of R_pretty in src/appl/pretty.c
In-Reply-To: <1272671307.772044.1503153307226@mail.yahoo.com>
References: <1272671307.772044.1503153307226.ref@mail.yahoo.com>
 <1272671307.772044.1503153307226@mail.yahoo.com>
Message-ID: <22940.3053.770580.186224@stat.math.ethz.ch>

>>>>> Suharto Anggono <suharto_anggono at yahoo.com>
>>>>>     on Sat, 19 Aug 2017 14:35:07 +0000 writes:

    > Yes, they work now.  I mentioned them partly because the
    > commit description said overflow for large n and partly to
    > be considered for regression tests.

Thank you, Suharto.

I subsequently have amended NEWS and added such regression tests
(in svn r73108 | 2017-08-19).

Martin

    > --------------------------------------------
    > On Sat, 19/8/17, Martin Maechler
    > <maechler at stat.math.ethz.ch> wrote:

    > Subject: Re: [Rd] Issues of R_pretty in src/appl/pretty.c
    > To: "Suharto Anggono Suharto Anggono" <suharto_anggono at yahoo.com>
    > Cc: r-devel at r-project.org
    > Date: Saturday, 19 August, 2017, 7:47 PM
 
>>>>> Suharto Anggono Suharto Anggono via R-devel <r-devel at r-project.org>
>>>>>     on Fri, 18 Aug 2017 15:44:06 +0000 writes:

    >> Examples similar to
    >> pretty(c(-1,1)*1e300, n = 1e9, min.n = 1)
    >> with smaller 'n':
    >> pretty(c(-1,1)*1e304, n = 1e5, min.n = 1)
    >> pretty(c(-1,1)*1e306, n = 1e3, min.n = 1)


    > Thank you.

    > "But" all these work now (in R-devel, rev >= 73094) as they should,
    > at least for me, right?

    > Are you mentioning the  "small n" examples so we could use them
    > as regression tests  (instead of the regression test I had added
    > to tests/reg-large.R  which needs enough GB and is slowish ) --
    > or are you seeing a platform where the above cases still don't
    > work in (new enough) R-devel ?

    [...............]


From Francis.Burton at glasgow.ac.uk  Tue Aug 22 13:14:05 2017
From: Francis.Burton at glasgow.ac.uk (Francis Burton)
Date: Tue, 22 Aug 2017 11:14:05 +0000
Subject: [Rd] Bug report: saving plot as wmf file - extra white space
Message-ID: <82E404174906234C8959023CCB3DD5410FCAE582@CMS12-01.campus.gla.ac.uk>

Saving a plot to Windows metafile (wmf) now includes additional unwanted space to the right of and below the plot.

The bug can be reproduced with the following code:

win.metafile("test.wmf")
plot(c(1,4,2,3))
dev.off()

# png output for comparison
png("test.png")
plot(c(1,4,2,3))
dev.off()

I expected the blank space around the plot in the wmf file to be minimal, and comparable to that in the equivalent png file. This means such wmf files cannot e.g. be programmatically inserted into PowerPoint slides because the extra white space causes problems by covering other elements. They would have to be cropped first.

It works as expected on

Windows 7
platform       x86_64-w64-mingw32          
version.string R version 3.4.0 (2017-04-21)

but not on

Windows 10
platform       x86_64-w64-mingw32          
version.string R version 3.4.1 (2017-06-30)

I don't know if this problem is related to R version issue or is a Windows 7/10 issue.

Francis


From Peter.Bosa at oregonmetro.gov  Tue Aug 22 16:39:50 2017
From: Peter.Bosa at oregonmetro.gov (Peter Bosa)
Date: Tue, 22 Aug 2017 14:39:50 +0000
Subject: [Rd] Possible repeat{} / break function bug in R 3.4.1
Message-ID: <1f22e392cb594b52ac3907d9f79992dd@MEX2.metro-region.org>

Hello, I've noticed the following error using repeat{} / break in R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit environments).

When running a repeat function, the break command causes an error message if the repeat command refers to code within a file, but does not produce an error if the code is contained within the repeat{} command.

For example, the following code runs fine:

x <- 1
y <- 5

repeat {
  if(x < y) {
    print("No Break Dance :-(")
    x = x + 1
  } else {
    print("Break Dance!")
    break
  }
}

[1] "No Break Dance :("
[1] "No Break Dance :("
[1] "No Break Dance :("
[1] "No Break Dance :("
[1] "No Break Dance :("
[1] "Break Dance!"
>

However, if I take the loop contents of the repeat{} function, and save them to a file (breakTest.R) that contains the following:

if(x < y) {
  print("No Break Dance :-(")
  x = x + 1
} else {
  print("Break Dance!")
  break
}

And then run the following code:

x <- 1
y <- 5

repeat{
  source("./breakTest.R")
}

I get the following error:

[1] "No Break Dance :("
[1] "No Break Dance :("
[1] "No Break Dance :("
[1] "No Break Dance :("
[1] "No Break Dance :("
[1] "Break Dance!"
Error in eval(ei, envir) : no loop for break/next, jumping to top level
>

This was not an issue with previous versions of R that I have used, including 3.3.3.

Any suggestions? Is this a known bug with 3.4.1?

Cheers-
Peter



----------------------------------------------------------------
peter bosa
metro
modeling services
600 ne grand ave
portland, or  97232

peter.bosa at oregonmetro.gov<mailto:peter.bosa at oregonmetro.gov>
503.797.1771

metro | making a great place
www.oregonmetro.gov


	[[alternative HTML version deleted]]


From maechler at stat.math.ethz.ch  Wed Aug 23 09:10:20 2017
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 23 Aug 2017 09:10:20 +0200
Subject: [Rd] Possible repeat{} / break function bug in R 3.4.1
In-Reply-To: <1f22e392cb594b52ac3907d9f79992dd@MEX2.metro-region.org>
References: <1f22e392cb594b52ac3907d9f79992dd@MEX2.metro-region.org>
Message-ID: <22941.10844.382587.277767@stat.math.ethz.ch>

>>>>> Peter Bosa <Peter.Bosa at oregonmetro.gov>
>>>>>     on Tue, 22 Aug 2017 14:39:50 +0000 writes:

    > Hello, I've noticed the following error using repeat{} / break in R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit environments).
    > When running a repeat function, the break command causes an error message if the repeat command refers to code within a file, but does not produce an error if the code is contained within the repeat{} command.

  > Hello, I've noticed the following error using repeat{} / break in R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit environments).
  > 
  > When running a repeat function, the break command causes an error message if the repeat command refers to code within a file, but does not produce an error if the code is contained within the repeat{} command.
  > 
  > For example, the following code runs fine:
  > 
  > x <- 1
  > y <- 5
  > 
  > repeat {
  >   if(x < y) {
  >     print("No Break Dance :-(")
  >     x = x + 1
  >   } else {
  >     print("Break Dance!")
  >     break
  >   }
  > }
  > 
  > [1] "No Break Dance :("
  > [1] "No Break Dance :("
  > [1] "No Break Dance :("
  > [1] "No Break Dance :("
  > [1] "No Break Dance :("
  > [1] "Break Dance!"
  > >
  > 
  > However, if I take the loop contents of the repeat{} function, and save them to a file (breakTest.R) that contains the following:
  > 
  > if(x < y) {
  >   print("No Break Dance :-(")
  >   x = x + 1
  > } else {
  >   print("Break Dance!")
  >   break
  > }
  > 
  > And then run the following code:
  > 
  > x <- 1
  > y <- 5
  > 
  > repeat{
  >   source("./breakTest.R")
  > }
  > 
  > I get the following error:
  > 
  > [1] "No Break Dance :("
  > [1] "No Break Dance :("
  > [1] "No Break Dance :("
  > [1] "No Break Dance :("
  > [1] "No Break Dance :("
  > [1] "Break Dance!"
  > Error in eval(ei, envir) : no loop for break/next, jumping to top level
  > >
  > 
  > This was not an issue with previous versions of R that I have used, including 3.3.3.
  > 
  > Any suggestions? Is this a known bug with 3.4.1?

Thank you, Peter!

I can confirm what you are seeing (on Linux) in R version 3.4.0,
3.4.1, and "R devel", and also that this had worked w/o a
problem in earlier versions of R, where I've looked at
R version 3.3.3 and 3.2.5.

I do think this is a bug, but it was not known till now.

For ease of use, I attach the two R files to easily reproduce.
Note I use  writeLines() instead of print() as its output is "nicer".

Best regards,
Martin Maechler, ETH Zurich



From maechler at stat.math.ethz.ch  Wed Aug 23 09:17:24 2017
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 23 Aug 2017 09:17:24 +0200
Subject: [Rd] Possible repeat{} / break function bug in R 3.4.1
In-Reply-To: <22941.10844.382587.277767@stat.math.ethz.ch>
References: <1f22e392cb594b52ac3907d9f79992dd@MEX2.metro-region.org>
 <22941.10844.382587.277767@stat.math.ethz.ch>
Message-ID: <22941.11268.787310.511504@stat.math.ethz.ch>

>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Wed, 23 Aug 2017 09:10:20 +0200 writes:

>>>>> Peter Bosa <Peter.Bosa at oregonmetro.gov>
>>>>>     on Tue, 22 Aug 2017 14:39:50 +0000 writes:

    >> Hello, I've noticed the following error using repeat{} / break in R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit environments).
    >> When running a repeat function, the break command causes an error message if the repeat command refers to code within a file, but does not produce an error if the code is contained within the repeat{} command.

    >> Hello, I've noticed the following error using repeat{} / break in R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit environments).
    >> 
    >> When running a repeat function, the break command causes an error message if the repeat command refers to code within a file, but does not produce an error if the code is contained within the repeat{} command.
    >> 
    >> For example, the following code runs fine:
    >> 
    >> x <- 1
    >> y <- 5
    >> 
    >> repeat {
    >> if(x < y) {
    >> print("No Break Dance :-(")
    >> x = x + 1
    >> } else {
    >> print("Break Dance!")
    >> break
    >> }
    >> }
    >> 
    >> [1] "No Break Dance :("
    >> [1] "No Break Dance :("
    >> [1] "No Break Dance :("
    >> [1] "No Break Dance :("
    >> [1] "No Break Dance :("
    >> [1] "Break Dance!"
    >> >
    >> 
    >> However, if I take the loop contents of the repeat{} function, and save them to a file (breakTest.R) that contains the following:
    >> 
    >> if(x < y) {
    >> print("No Break Dance :-(")
    >> x = x + 1
    >> } else {
    >> print("Break Dance!")
    >> break
    >> }
    >> 
    >> And then run the following code:
    >> 
    >> x <- 1
    >> y <- 5
    >> 
    >> repeat{
    >> source("./breakTest.R")
    >> }
    >> 
    >> I get the following error:
    >> 
    >> [1] "No Break Dance :("
    >> [1] "No Break Dance :("
    >> [1] "No Break Dance :("
    >> [1] "No Break Dance :("
    >> [1] "No Break Dance :("
    >> [1] "Break Dance!"
    >> Error in eval(ei, envir) : no loop for break/next, jumping to top level
    >> >
    >> 
    >> This was not an issue with previous versions of R that I have used, including 3.3.3.
    >> 
    >> Any suggestions? Is this a known bug with 3.4.1?

    > Thank you, Peter!

    > I can confirm what you are seeing (on Linux) in R version 3.4.0,
    > 3.4.1, and "R devel", and also that this had worked w/o a
    > problem in earlier versions of R, where I've looked at
    > R version 3.3.3 and 3.2.5.

    > I do think this is a bug, but it was not known till now.

    > For ease of use, I attach the two R files to easily reproduce.
    > Note I use  writeLines() instead of print() as its output is "nicer".

    > Best regards,
    > Martin Maechler, ETH Zurich

Trying again with the two attachment.  Yes, I of all people (!!)
should know that they must have an allowed MIME type; in this
case  text/plain !

Martin

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: breakTest.R
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20170823/9ee1b2d7/attachment.ksh>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: break-source_R341.R
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20170823/9ee1b2d7/attachment-0001.ksh>

From lionel at rstudio.com  Wed Aug 23 09:22:24 2017
From: lionel at rstudio.com (Lionel Henry)
Date: Wed, 23 Aug 2017 09:22:24 +0200
Subject: [Rd] Possible repeat{} / break function bug in R 3.4.1
In-Reply-To: <22941.11268.787310.511504@stat.math.ethz.ch>
References: <1f22e392cb594b52ac3907d9f79992dd@MEX2.metro-region.org>
 <22941.10844.382587.277767@stat.math.ethz.ch>
 <22941.11268.787310.511504@stat.math.ethz.ch>
Message-ID: <60DC6C3E-1BF9-4F20-8A99-20D4C129755D@rstudio.com>

I don't think that's a bug. source() uses eval(), and eval() creates a
new function-like context frame. In a way expecting `break` to work
inside source() is like expecting `break` to cross stack frames:

    my_break <- function() break
    repeat(my_break())

Lionel


> On 23 ao?t 2017, at 09:17, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
> 
>>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>>    on Wed, 23 Aug 2017 09:10:20 +0200 writes:
> 
>>>>>> Peter Bosa <Peter.Bosa at oregonmetro.gov>
>>>>>>    on Tue, 22 Aug 2017 14:39:50 +0000 writes:
> 
>>> Hello, I've noticed the following error using repeat{} / break in R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit environments).
>>> When running a repeat function, the break command causes an error message if the repeat command refers to code within a file, but does not produce an error if the code is contained within the repeat{} command.
> 
>>> Hello, I've noticed the following error using repeat{} / break in R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit environments).
>>> 
>>> When running a repeat function, the break command causes an error message if the repeat command refers to code within a file, but does not produce an error if the code is contained within the repeat{} command.
>>> 
>>> For example, the following code runs fine:
>>> 
>>> x <- 1
>>> y <- 5
>>> 
>>> repeat {
>>> if(x < y) {
>>> print("No Break Dance :-(")
>>> x = x + 1
>>> } else {
>>> print("Break Dance!")
>>> break
>>> }
>>> }
>>> 
>>> [1] "No Break Dance :("
>>> [1] "No Break Dance :("
>>> [1] "No Break Dance :("
>>> [1] "No Break Dance :("
>>> [1] "No Break Dance :("
>>> [1] "Break Dance!"
>>>> 
>>> 
>>> However, if I take the loop contents of the repeat{} function, and save them to a file (breakTest.R) that contains the following:
>>> 
>>> if(x < y) {
>>> print("No Break Dance :-(")
>>> x = x + 1
>>> } else {
>>> print("Break Dance!")
>>> break
>>> }
>>> 
>>> And then run the following code:
>>> 
>>> x <- 1
>>> y <- 5
>>> 
>>> repeat{
>>> source("./breakTest.R")
>>> }
>>> 
>>> I get the following error:
>>> 
>>> [1] "No Break Dance :("
>>> [1] "No Break Dance :("
>>> [1] "No Break Dance :("
>>> [1] "No Break Dance :("
>>> [1] "No Break Dance :("
>>> [1] "Break Dance!"
>>> Error in eval(ei, envir) : no loop for break/next, jumping to top level
>>>> 
>>> 
>>> This was not an issue with previous versions of R that I have used, including 3.3.3.
>>> 
>>> Any suggestions? Is this a known bug with 3.4.1?
> 
>> Thank you, Peter!
> 
>> I can confirm what you are seeing (on Linux) in R version 3.4.0,
>> 3.4.1, and "R devel", and also that this had worked w/o a
>> problem in earlier versions of R, where I've looked at
>> R version 3.3.3 and 3.2.5.
> 
>> I do think this is a bug, but it was not known till now.
> 
>> For ease of use, I attach the two R files to easily reproduce.
>> Note I use  writeLines() instead of print() as its output is "nicer".
> 
>> Best regards,
>> Martin Maechler, ETH Zurich
> 
> Trying again with the two attachment.  Yes, I of all people (!!)
> should know that they must have an allowed MIME type; in this
> case  text/plain !
> 
> Martin
> 
> ## see ./break-source_R341.R
> if(x < y) {
>  writeLines("No Break Dance :-(")
>  x <- x + 1
> } else {
>  writeLines("Break Dance!")
>  break
> }
> ## From: Peter Bosa <Peter.Bosa at oregonmetro.gov>
> ## To: "R-devel at r-project.org" <R-devel at r-project.org>
> ## Subject: [Rd] Possible repeat{} / break function bug in R 3.4.1
> ## Date: Tue, 22 Aug 2017 14:39:50 +0000
> 
> ## Hello, I've noticed the following error using repeat{} / break in R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit environments).
> 
> ## When running a repeat function, the break command causes an error message if the repeat command refers to code within a file, but does not produce an error if the code is contained within the repeat{} command.
> 
> ## For example, the following code runs fine:
> 
> x <- 1
> y <- 5
> repeat {
>  if(x < y) {
>    writeLines("No Break Dance :-(")
>    x <- x + 1
>  } else {
>    writeLines("Break Dance!")
>    break
>  }
> }
> ## No Break Dance :(
> ## No Break Dance :(
> ## No Break Dance :(
> ## No Break Dance :(
> ## No Break Dance :(
> ## Break Dance!
> ## >
> 
> ## However, if I take the loop contents of the repeat{} function, and save
> ## them to a file (breakTest.R) that contains the following:
> ##                 ^^^^^^^^^^^
> ##                __SEE THAT FILE__
> ## if(x < y) {
> ##   writeLines("No Break Dance :-(")
> ##   x = x + 1
> ## } else {
> ##   writeLines("Break Dance!")
> ##   break
> ## }
> 
> ## And then run the following code:
> 
> x <- 1
> y <- 5
> repeat{
>  source("./breakTest.R")
> }
> cat("successfully finished\n")
> 
> ## I get the following error:
> 
> ## No Break Dance :(
> ## No Break Dance :(
> ## No Break Dance :(
> ## No Break Dance :(
> ## No Break Dance :(
> ## Break Dance!
> ## Error in eval(ei, envir) : no loop for break/next, jumping to top level
> ## ^^^^^^^^^^^^^^^^^^^^
> 
> 
> ## This was not an issue with previous versions of R that I have used, including 3.3.3.
> 
> ## MM: It does work in R 3.3.3, indeed
> ## --  it fails in R 3.4.0 and later
> 
> 
> ## Any suggestions? Is this a known bug with 3.4.1?
> 
> ## Cheers-
> ## Peter
> 
> 
> ## ----------------------------------------------------------------
> ## peter bosa
> ## metro
> ## modeling services
> ## 600 ne grand ave
> ## portland, or  97232
> 
> ## peter.bosa at oregonmetro.gov<mailto:peter.bosa at oregonmetro.gov>
> ## 503.797.1771
> 
> ## metro | making a great place
> ## www.oregonmetro.gov
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From tomas.kalibera at gmail.com  Wed Aug 23 09:24:34 2017
From: tomas.kalibera at gmail.com (Tomas Kalibera)
Date: Wed, 23 Aug 2017 09:24:34 +0200
Subject: [Rd] Possible repeat{} / break function bug in R 3.4.1
In-Reply-To: <60DC6C3E-1BF9-4F20-8A99-20D4C129755D@rstudio.com>
References: <1f22e392cb594b52ac3907d9f79992dd@MEX2.metro-region.org>
 <22941.10844.382587.277767@stat.math.ethz.ch>
 <22941.11268.787310.511504@stat.math.ethz.ch>
 <60DC6C3E-1BF9-4F20-8A99-20D4C129755D@rstudio.com>
Message-ID: <ba631996-db0b-12d1-e149-c14e6a20f802@gmail.com>

It is a bug in the byte-code compiler. I will fix
Tomas

On 08/23/2017 09:22 AM, Lionel Henry wrote:
> I don't think that's a bug. source() uses eval(), and eval() creates a
> new function-like context frame. In a way expecting `break` to work
> inside source() is like expecting `break` to cross stack frames:
>
>      my_break <- function() break
>      repeat(my_break())
>
> Lionel
>
>
>> On 23 ao?t 2017, at 09:17, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
>>
>>>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>>>     on Wed, 23 Aug 2017 09:10:20 +0200 writes:
>>>>>>> Peter Bosa <Peter.Bosa at oregonmetro.gov>
>>>>>>>     on Tue, 22 Aug 2017 14:39:50 +0000 writes:
>>>> Hello, I've noticed the following error using repeat{} / break in R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit environments).
>>>> When running a repeat function, the break command causes an error message if the repeat command refers to code within a file, but does not produce an error if the code is contained within the repeat{} command.
>>>> Hello, I've noticed the following error using repeat{} / break in R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit environments).
>>>>
>>>> When running a repeat function, the break command causes an error message if the repeat command refers to code within a file, but does not produce an error if the code is contained within the repeat{} command.
>>>>
>>>> For example, the following code runs fine:
>>>>
>>>> x <- 1
>>>> y <- 5
>>>>
>>>> repeat {
>>>> if(x < y) {
>>>> print("No Break Dance :-(")
>>>> x = x + 1
>>>> } else {
>>>> print("Break Dance!")
>>>> break
>>>> }
>>>> }
>>>>
>>>> [1] "No Break Dance :("
>>>> [1] "No Break Dance :("
>>>> [1] "No Break Dance :("
>>>> [1] "No Break Dance :("
>>>> [1] "No Break Dance :("
>>>> [1] "Break Dance!"
>>>> However, if I take the loop contents of the repeat{} function, and save them to a file (breakTest.R) that contains the following:
>>>>
>>>> if(x < y) {
>>>> print("No Break Dance :-(")
>>>> x = x + 1
>>>> } else {
>>>> print("Break Dance!")
>>>> break
>>>> }
>>>>
>>>> And then run the following code:
>>>>
>>>> x <- 1
>>>> y <- 5
>>>>
>>>> repeat{
>>>> source("./breakTest.R")
>>>> }
>>>>
>>>> I get the following error:
>>>>
>>>> [1] "No Break Dance :("
>>>> [1] "No Break Dance :("
>>>> [1] "No Break Dance :("
>>>> [1] "No Break Dance :("
>>>> [1] "No Break Dance :("
>>>> [1] "Break Dance!"
>>>> Error in eval(ei, envir) : no loop for break/next, jumping to top level
>>>> This was not an issue with previous versions of R that I have used, including 3.3.3.
>>>>
>>>> Any suggestions? Is this a known bug with 3.4.1?
>>> Thank you, Peter!
>>> I can confirm what you are seeing (on Linux) in R version 3.4.0,
>>> 3.4.1, and "R devel", and also that this had worked w/o a
>>> problem in earlier versions of R, where I've looked at
>>> R version 3.3.3 and 3.2.5.
>>> I do think this is a bug, but it was not known till now.
>>> For ease of use, I attach the two R files to easily reproduce.
>>> Note I use  writeLines() instead of print() as its output is "nicer".
>>> Best regards,
>>> Martin Maechler, ETH Zurich
>> Trying again with the two attachment.  Yes, I of all people (!!)
>> should know that they must have an allowed MIME type; in this
>> case  text/plain !
>>
>> Martin
>>
>> ## see ./break-source_R341.R
>> if(x < y) {
>>   writeLines("No Break Dance :-(")
>>   x <- x + 1
>> } else {
>>   writeLines("Break Dance!")
>>   break
>> }
>> ## From: Peter Bosa <Peter.Bosa at oregonmetro.gov>
>> ## To: "R-devel at r-project.org" <R-devel at r-project.org>
>> ## Subject: [Rd] Possible repeat{} / break function bug in R 3.4.1
>> ## Date: Tue, 22 Aug 2017 14:39:50 +0000
>>
>> ## Hello, I've noticed the following error using repeat{} / break in R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit environments).
>>
>> ## When running a repeat function, the break command causes an error message if the repeat command refers to code within a file, but does not produce an error if the code is contained within the repeat{} command.
>>
>> ## For example, the following code runs fine:
>>
>> x <- 1
>> y <- 5
>> repeat {
>>   if(x < y) {
>>     writeLines("No Break Dance :-(")
>>     x <- x + 1
>>   } else {
>>     writeLines("Break Dance!")
>>     break
>>   }
>> }
>> ## No Break Dance :(
>> ## No Break Dance :(
>> ## No Break Dance :(
>> ## No Break Dance :(
>> ## No Break Dance :(
>> ## Break Dance!
>> ## >
>>
>> ## However, if I take the loop contents of the repeat{} function, and save
>> ## them to a file (breakTest.R) that contains the following:
>> ##                 ^^^^^^^^^^^
>> ##                __SEE THAT FILE__
>> ## if(x < y) {
>> ##   writeLines("No Break Dance :-(")
>> ##   x = x + 1
>> ## } else {
>> ##   writeLines("Break Dance!")
>> ##   break
>> ## }
>>
>> ## And then run the following code:
>>
>> x <- 1
>> y <- 5
>> repeat{
>>   source("./breakTest.R")
>> }
>> cat("successfully finished\n")
>>
>> ## I get the following error:
>>
>> ## No Break Dance :(
>> ## No Break Dance :(
>> ## No Break Dance :(
>> ## No Break Dance :(
>> ## No Break Dance :(
>> ## Break Dance!
>> ## Error in eval(ei, envir) : no loop for break/next, jumping to top level
>> ## ^^^^^^^^^^^^^^^^^^^^
>>
>>
>> ## This was not an issue with previous versions of R that I have used, including 3.3.3.
>>
>> ## MM: It does work in R 3.3.3, indeed
>> ## --  it fails in R 3.4.0 and later
>>
>>
>> ## Any suggestions? Is this a known bug with 3.4.1?
>>
>> ## Cheers-
>> ## Peter
>>
>>
>> ## ----------------------------------------------------------------
>> ## peter bosa
>> ## metro
>> ## modeling services
>> ## 600 ne grand ave
>> ## portland, or  97232
>>
>> ## peter.bosa at oregonmetro.gov<mailto:peter.bosa at oregonmetro.gov>
>> ## 503.797.1771
>>
>> ## metro | making a great place
>> ## www.oregonmetro.gov
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From lionel at rstudio.com  Wed Aug 23 09:46:34 2017
From: lionel at rstudio.com (Lionel Henry)
Date: Wed, 23 Aug 2017 09:46:34 +0200
Subject: [Rd] Possible repeat{} / break function bug in R 3.4.1
In-Reply-To: <ba631996-db0b-12d1-e149-c14e6a20f802@gmail.com>
References: <1f22e392cb594b52ac3907d9f79992dd@MEX2.metro-region.org>
 <22941.10844.382587.277767@stat.math.ethz.ch>
 <22941.11268.787310.511504@stat.math.ethz.ch>
 <60DC6C3E-1BF9-4F20-8A99-20D4C129755D@rstudio.com>
 <ba631996-db0b-12d1-e149-c14e6a20f802@gmail.com>
Message-ID: <2200F45E-9C76-44CB-B1F4-FD13ECC50E4C@rstudio.com>

oops, I should have tried it:

    expr <- quote(break)
    repeat(eval(expr))


So eval() has hybrid semantics where `break` has more reach than
return(), weird.

    expr <- quote(return())
    repeat(eval(expr))  # infloop

Lionel


> On 23 ao?t 2017, at 09:24, Tomas Kalibera <tomas.kalibera at gmail.com> wrote:
> 
> It is a bug in the byte-code compiler. I will fix
> Tomas
> 
> On 08/23/2017 09:22 AM, Lionel Henry wrote:
>> I don't think that's a bug. source() uses eval(), and eval() creates a
>> new function-like context frame. In a way expecting `break` to work
>> inside source() is like expecting `break` to cross stack frames:
>> 
>>     my_break <- function() break
>>     repeat(my_break())
>> 
>> Lionel
>> 
>> 
>>> On 23 ao?t 2017, at 09:17, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
>>> 
>>>>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>>>>    on Wed, 23 Aug 2017 09:10:20 +0200 writes:
>>>>>>>> Peter Bosa <Peter.Bosa at oregonmetro.gov>
>>>>>>>>    on Tue, 22 Aug 2017 14:39:50 +0000 writes:
>>>>> Hello, I've noticed the following error using repeat{} / break in R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit environments).
>>>>> When running a repeat function, the break command causes an error message if the repeat command refers to code within a file, but does not produce an error if the code is contained within the repeat{} command.
>>>>> Hello, I've noticed the following error using repeat{} / break in R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit environments).
>>>>> 
>>>>> When running a repeat function, the break command causes an error message if the repeat command refers to code within a file, but does not produce an error if the code is contained within the repeat{} command.
>>>>> 
>>>>> For example, the following code runs fine:
>>>>> 
>>>>> x <- 1
>>>>> y <- 5
>>>>> 
>>>>> repeat {
>>>>> if(x < y) {
>>>>> print("No Break Dance :-(")
>>>>> x = x + 1
>>>>> } else {
>>>>> print("Break Dance!")
>>>>> break
>>>>> }
>>>>> }
>>>>> 
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "Break Dance!"
>>>>> However, if I take the loop contents of the repeat{} function, and save them to a file (breakTest.R) that contains the following:
>>>>> 
>>>>> if(x < y) {
>>>>> print("No Break Dance :-(")
>>>>> x = x + 1
>>>>> } else {
>>>>> print("Break Dance!")
>>>>> break
>>>>> }
>>>>> 
>>>>> And then run the following code:
>>>>> 
>>>>> x <- 1
>>>>> y <- 5
>>>>> 
>>>>> repeat{
>>>>> source("./breakTest.R")
>>>>> }
>>>>> 
>>>>> I get the following error:
>>>>> 
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "Break Dance!"
>>>>> Error in eval(ei, envir) : no loop for break/next, jumping to top level
>>>>> This was not an issue with previous versions of R that I have used, including 3.3.3.
>>>>> 
>>>>> Any suggestions? Is this a known bug with 3.4.1?
>>>> Thank you, Peter!
>>>> I can confirm what you are seeing (on Linux) in R version 3.4.0,
>>>> 3.4.1, and "R devel", and also that this had worked w/o a
>>>> problem in earlier versions of R, where I've looked at
>>>> R version 3.3.3 and 3.2.5.
>>>> I do think this is a bug, but it was not known till now.
>>>> For ease of use, I attach the two R files to easily reproduce.
>>>> Note I use  writeLines() instead of print() as its output is "nicer".
>>>> Best regards,
>>>> Martin Maechler, ETH Zurich
>>> Trying again with the two attachment.  Yes, I of all people (!!)
>>> should know that they must have an allowed MIME type; in this
>>> case  text/plain !
>>> 
>>> Martin
>>> 
>>> ## see ./break-source_R341.R
>>> if(x < y) {
>>>  writeLines("No Break Dance :-(")
>>>  x <- x + 1
>>> } else {
>>>  writeLines("Break Dance!")
>>>  break
>>> }
>>> ## From: Peter Bosa <Peter.Bosa at oregonmetro.gov>
>>> ## To: "R-devel at r-project.org" <R-devel at r-project.org>
>>> ## Subject: [Rd] Possible repeat{} / break function bug in R 3.4.1
>>> ## Date: Tue, 22 Aug 2017 14:39:50 +0000
>>> 
>>> ## Hello, I've noticed the following error using repeat{} / break in R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit environments).
>>> 
>>> ## When running a repeat function, the break command causes an error message if the repeat command refers to code within a file, but does not produce an error if the code is contained within the repeat{} command.
>>> 
>>> ## For example, the following code runs fine:
>>> 
>>> x <- 1
>>> y <- 5
>>> repeat {
>>>  if(x < y) {
>>>    writeLines("No Break Dance :-(")
>>>    x <- x + 1
>>>  } else {
>>>    writeLines("Break Dance!")
>>>    break
>>>  }
>>> }
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## Break Dance!
>>> ## >
>>> 
>>> ## However, if I take the loop contents of the repeat{} function, and save
>>> ## them to a file (breakTest.R) that contains the following:
>>> ##                 ^^^^^^^^^^^
>>> ##                __SEE THAT FILE__
>>> ## if(x < y) {
>>> ##   writeLines("No Break Dance :-(")
>>> ##   x = x + 1
>>> ## } else {
>>> ##   writeLines("Break Dance!")
>>> ##   break
>>> ## }
>>> 
>>> ## And then run the following code:
>>> 
>>> x <- 1
>>> y <- 5
>>> repeat{
>>>  source("./breakTest.R")
>>> }
>>> cat("successfully finished\n")
>>> 
>>> ## I get the following error:
>>> 
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## Break Dance!
>>> ## Error in eval(ei, envir) : no loop for break/next, jumping to top level
>>> ## ^^^^^^^^^^^^^^^^^^^^
>>> 
>>> 
>>> ## This was not an issue with previous versions of R that I have used, including 3.3.3.
>>> 
>>> ## MM: It does work in R 3.3.3, indeed
>>> ## --  it fails in R 3.4.0 and later
>>> 
>>> 
>>> ## Any suggestions? Is this a known bug with 3.4.1?
>>> 
>>> ## Cheers-
>>> ## Peter
>>> 
>>> 
>>> ## ----------------------------------------------------------------
>>> ## peter bosa
>>> ## metro
>>> ## modeling services
>>> ## 600 ne grand ave
>>> ## portland, or  97232
>>> 
>>> ## peter.bosa at oregonmetro.gov<mailto:peter.bosa at oregonmetro.gov>
>>> ## 503.797.1771
>>> 
>>> ## metro | making a great place
>>> ## www.oregonmetro.gov
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From tomas.kalibera at gmail.com  Wed Aug 23 09:54:08 2017
From: tomas.kalibera at gmail.com (Tomas Kalibera)
Date: Wed, 23 Aug 2017 09:54:08 +0200
Subject: [Rd] Possible repeat{} / break function bug in R 3.4.1
In-Reply-To: <ba631996-db0b-12d1-e149-c14e6a20f802@gmail.com>
References: <1f22e392cb594b52ac3907d9f79992dd@MEX2.metro-region.org>
 <22941.10844.382587.277767@stat.math.ethz.ch>
 <22941.11268.787310.511504@stat.math.ethz.ch>
 <60DC6C3E-1BF9-4F20-8A99-20D4C129755D@rstudio.com>
 <ba631996-db0b-12d1-e149-c14e6a20f802@gmail.com>
Message-ID: <a30bb23c-39ac-68f5-1951-52a5e3ae4504@gmail.com>

Fixed in 73112.

If you needed to run this code in unpatched versions of R, you can 
disable the problematic compiler optimization in the loop for instance 
by adding "eval(NULL)" to the body of the loop. However, please do not 
forget to remove this for future versions of R and specifically do not 
assume this would turn off a particular compiler optimization in future 
versions.

Best
Tomas




On 08/23/2017 09:24 AM, Tomas Kalibera wrote:
> It is a bug in the byte-code compiler. I will fix
> Tomas
>
> On 08/23/2017 09:22 AM, Lionel Henry wrote:
>> I don't think that's a bug. source() uses eval(), and eval() creates a
>> new function-like context frame. In a way expecting `break` to work
>> inside source() is like expecting `break` to cross stack frames:
>>
>>      my_break <- function() break
>>      repeat(my_break())
>>
>> Lionel
>>
>>
>>> On 23 ao?t 2017, at 09:17, Martin Maechler 
>>> <maechler at stat.math.ethz.ch> wrote:
>>>
>>>>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>>>>     on Wed, 23 Aug 2017 09:10:20 +0200 writes:
>>>>>>>> Peter Bosa <Peter.Bosa at oregonmetro.gov>
>>>>>>>>     on Tue, 22 Aug 2017 14:39:50 +0000 writes:
>>>>> Hello, I've noticed the following error using repeat{} / break in 
>>>>> R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit 
>>>>> environments).
>>>>> When running a repeat function, the break command causes an error 
>>>>> message if the repeat command refers to code within a file, but 
>>>>> does not produce an error if the code is contained within the 
>>>>> repeat{} command.
>>>>> Hello, I've noticed the following error using repeat{} / break in 
>>>>> R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit 
>>>>> environments).
>>>>>
>>>>> When running a repeat function, the break command causes an error 
>>>>> message if the repeat command refers to code within a file, but 
>>>>> does not produce an error if the code is contained within the 
>>>>> repeat{} command.
>>>>>
>>>>> For example, the following code runs fine:
>>>>>
>>>>> x <- 1
>>>>> y <- 5
>>>>>
>>>>> repeat {
>>>>> if(x < y) {
>>>>> print("No Break Dance :-(")
>>>>> x = x + 1
>>>>> } else {
>>>>> print("Break Dance!")
>>>>> break
>>>>> }
>>>>> }
>>>>>
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "Break Dance!"
>>>>> However, if I take the loop contents of the repeat{} function, and 
>>>>> save them to a file (breakTest.R) that contains the following:
>>>>>
>>>>> if(x < y) {
>>>>> print("No Break Dance :-(")
>>>>> x = x + 1
>>>>> } else {
>>>>> print("Break Dance!")
>>>>> break
>>>>> }
>>>>>
>>>>> And then run the following code:
>>>>>
>>>>> x <- 1
>>>>> y <- 5
>>>>>
>>>>> repeat{
>>>>> source("./breakTest.R")
>>>>> }
>>>>>
>>>>> I get the following error:
>>>>>
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "Break Dance!"
>>>>> Error in eval(ei, envir) : no loop for break/next, jumping to top 
>>>>> level
>>>>> This was not an issue with previous versions of R that I have 
>>>>> used, including 3.3.3.
>>>>>
>>>>> Any suggestions? Is this a known bug with 3.4.1?
>>>> Thank you, Peter!
>>>> I can confirm what you are seeing (on Linux) in R version 3.4.0,
>>>> 3.4.1, and "R devel", and also that this had worked w/o a
>>>> problem in earlier versions of R, where I've looked at
>>>> R version 3.3.3 and 3.2.5.
>>>> I do think this is a bug, but it was not known till now.
>>>> For ease of use, I attach the two R files to easily reproduce.
>>>> Note I use  writeLines() instead of print() as its output is "nicer".
>>>> Best regards,
>>>> Martin Maechler, ETH Zurich
>>> Trying again with the two attachment.  Yes, I of all people (!!)
>>> should know that they must have an allowed MIME type; in this
>>> case  text/plain !
>>>
>>> Martin
>>>
>>> ## see ./break-source_R341.R
>>> if(x < y) {
>>>   writeLines("No Break Dance :-(")
>>>   x <- x + 1
>>> } else {
>>>   writeLines("Break Dance!")
>>>   break
>>> }
>>> ## From: Peter Bosa <Peter.Bosa at oregonmetro.gov>
>>> ## To: "R-devel at r-project.org" <R-devel at r-project.org>
>>> ## Subject: [Rd] Possible repeat{} / break function bug in R 3.4.1
>>> ## Date: Tue, 22 Aug 2017 14:39:50 +0000
>>>
>>> ## Hello, I've noticed the following error using repeat{} / break in 
>>> R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit 
>>> environments).
>>>
>>> ## When running a repeat function, the break command causes an error 
>>> message if the repeat command refers to code within a file, but does 
>>> not produce an error if the code is contained within the repeat{} 
>>> command.
>>>
>>> ## For example, the following code runs fine:
>>>
>>> x <- 1
>>> y <- 5
>>> repeat {
>>>   if(x < y) {
>>>     writeLines("No Break Dance :-(")
>>>     x <- x + 1
>>>   } else {
>>>     writeLines("Break Dance!")
>>>     break
>>>   }
>>> }
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## Break Dance!
>>> ## >
>>>
>>> ## However, if I take the loop contents of the repeat{} function, 
>>> and save
>>> ## them to a file (breakTest.R) that contains the following:
>>> ##                 ^^^^^^^^^^^
>>> ##                __SEE THAT FILE__
>>> ## if(x < y) {
>>> ##   writeLines("No Break Dance :-(")
>>> ##   x = x + 1
>>> ## } else {
>>> ##   writeLines("Break Dance!")
>>> ##   break
>>> ## }
>>>
>>> ## And then run the following code:
>>>
>>> x <- 1
>>> y <- 5
>>> repeat{
>>>   source("./breakTest.R")
>>> }
>>> cat("successfully finished\n")
>>>
>>> ## I get the following error:
>>>
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## Break Dance!
>>> ## Error in eval(ei, envir) : no loop for break/next, jumping to top 
>>> level
>>> ## ^^^^^^^^^^^^^^^^^^^^
>>>
>>>
>>> ## This was not an issue with previous versions of R that I have 
>>> used, including 3.3.3.
>>>
>>> ## MM: It does work in R 3.3.3, indeed
>>> ## --  it fails in R 3.4.0 and later
>>>
>>>
>>> ## Any suggestions? Is this a known bug with 3.4.1?
>>>
>>> ## Cheers-
>>> ## Peter
>>>
>>>
>>> ## ----------------------------------------------------------------
>>> ## peter bosa
>>> ## metro
>>> ## modeling services
>>> ## 600 ne grand ave
>>> ## portland, or  97232
>>>
>>> ## peter.bosa at oregonmetro.gov<mailto:peter.bosa at oregonmetro.gov>
>>> ## 503.797.1771
>>>
>>> ## metro | making a great place
>>> ## www.oregonmetro.gov
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From tomas.kalibera at gmail.com  Wed Aug 23 10:07:27 2017
From: tomas.kalibera at gmail.com (Tomas Kalibera)
Date: Wed, 23 Aug 2017 10:07:27 +0200
Subject: [Rd] Possible repeat{} / break function bug in R 3.4.1
In-Reply-To: <2200F45E-9C76-44CB-B1F4-FD13ECC50E4C@rstudio.com>
References: <1f22e392cb594b52ac3907d9f79992dd@MEX2.metro-region.org>
 <22941.10844.382587.277767@stat.math.ethz.ch>
 <22941.11268.787310.511504@stat.math.ethz.ch>
 <60DC6C3E-1BF9-4F20-8A99-20D4C129755D@rstudio.com>
 <ba631996-db0b-12d1-e149-c14e6a20f802@gmail.com>
 <2200F45E-9C76-44CB-B1F4-FD13ECC50E4C@rstudio.com>
Message-ID: <e1953a9d-90ab-783b-e902-6fde81bc60af@gmail.com>


return can be used to set the return value of an expression evaluated by 
"eval"

expr <- quote(if (x) return(1) else return(2))
x <- FALSE
eval(expr) #2

Tomas

On 08/23/2017 09:46 AM, Lionel Henry wrote:
> oops, I should have tried it:
>
>      expr <- quote(break)
>      repeat(eval(expr))
>
>
> So eval() has hybrid semantics where `break` has more reach than
> return(), weird.
>
>      expr <- quote(return())
>      repeat(eval(expr))  # infloop
>
> Lionel
>
>
>> On 23 ao?t 2017, at 09:24, Tomas Kalibera <tomas.kalibera at gmail.com> wrote:
>>
>> It is a bug in the byte-code compiler. I will fix
>> Tomas
>>
>> On 08/23/2017 09:22 AM, Lionel Henry wrote:
>>> I don't think that's a bug. source() uses eval(), and eval() creates a
>>> new function-like context frame. In a way expecting `break` to work
>>> inside source() is like expecting `break` to cross stack frames:
>>>
>>>      my_break <- function() break
>>>      repeat(my_break())
>>>
>>> Lionel
>>>
>>>
>>>> On 23 ao?t 2017, at 09:17, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
>>>>
>>>>>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>>>>>     on Wed, 23 Aug 2017 09:10:20 +0200 writes:
>>>>>>>>> Peter Bosa <Peter.Bosa at oregonmetro.gov>
>>>>>>>>>     on Tue, 22 Aug 2017 14:39:50 +0000 writes:
>>>>>> Hello, I've noticed the following error using repeat{} / break in R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit environments).
>>>>>> When running a repeat function, the break command causes an error message if the repeat command refers to code within a file, but does not produce an error if the code is contained within the repeat{} command.
>>>>>> Hello, I've noticed the following error using repeat{} / break in R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit environments).
>>>>>>
>>>>>> When running a repeat function, the break command causes an error message if the repeat command refers to code within a file, but does not produce an error if the code is contained within the repeat{} command.
>>>>>>
>>>>>> For example, the following code runs fine:
>>>>>>
>>>>>> x <- 1
>>>>>> y <- 5
>>>>>>
>>>>>> repeat {
>>>>>> if(x < y) {
>>>>>> print("No Break Dance :-(")
>>>>>> x = x + 1
>>>>>> } else {
>>>>>> print("Break Dance!")
>>>>>> break
>>>>>> }
>>>>>> }
>>>>>>
>>>>>> [1] "No Break Dance :("
>>>>>> [1] "No Break Dance :("
>>>>>> [1] "No Break Dance :("
>>>>>> [1] "No Break Dance :("
>>>>>> [1] "No Break Dance :("
>>>>>> [1] "Break Dance!"
>>>>>> However, if I take the loop contents of the repeat{} function, and save them to a file (breakTest.R) that contains the following:
>>>>>>
>>>>>> if(x < y) {
>>>>>> print("No Break Dance :-(")
>>>>>> x = x + 1
>>>>>> } else {
>>>>>> print("Break Dance!")
>>>>>> break
>>>>>> }
>>>>>>
>>>>>> And then run the following code:
>>>>>>
>>>>>> x <- 1
>>>>>> y <- 5
>>>>>>
>>>>>> repeat{
>>>>>> source("./breakTest.R")
>>>>>> }
>>>>>>
>>>>>> I get the following error:
>>>>>>
>>>>>> [1] "No Break Dance :("
>>>>>> [1] "No Break Dance :("
>>>>>> [1] "No Break Dance :("
>>>>>> [1] "No Break Dance :("
>>>>>> [1] "No Break Dance :("
>>>>>> [1] "Break Dance!"
>>>>>> Error in eval(ei, envir) : no loop for break/next, jumping to top level
>>>>>> This was not an issue with previous versions of R that I have used, including 3.3.3.
>>>>>>
>>>>>> Any suggestions? Is this a known bug with 3.4.1?
>>>>> Thank you, Peter!
>>>>> I can confirm what you are seeing (on Linux) in R version 3.4.0,
>>>>> 3.4.1, and "R devel", and also that this had worked w/o a
>>>>> problem in earlier versions of R, where I've looked at
>>>>> R version 3.3.3 and 3.2.5.
>>>>> I do think this is a bug, but it was not known till now.
>>>>> For ease of use, I attach the two R files to easily reproduce.
>>>>> Note I use  writeLines() instead of print() as its output is "nicer".
>>>>> Best regards,
>>>>> Martin Maechler, ETH Zurich
>>>> Trying again with the two attachment.  Yes, I of all people (!!)
>>>> should know that they must have an allowed MIME type; in this
>>>> case  text/plain !
>>>>
>>>> Martin
>>>>
>>>> ## see ./break-source_R341.R
>>>> if(x < y) {
>>>>   writeLines("No Break Dance :-(")
>>>>   x <- x + 1
>>>> } else {
>>>>   writeLines("Break Dance!")
>>>>   break
>>>> }
>>>> ## From: Peter Bosa <Peter.Bosa at oregonmetro.gov>
>>>> ## To: "R-devel at r-project.org" <R-devel at r-project.org>
>>>> ## Subject: [Rd] Possible repeat{} / break function bug in R 3.4.1
>>>> ## Date: Tue, 22 Aug 2017 14:39:50 +0000
>>>>
>>>> ## Hello, I've noticed the following error using repeat{} / break in R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit environments).
>>>>
>>>> ## When running a repeat function, the break command causes an error message if the repeat command refers to code within a file, but does not produce an error if the code is contained within the repeat{} command.
>>>>
>>>> ## For example, the following code runs fine:
>>>>
>>>> x <- 1
>>>> y <- 5
>>>> repeat {
>>>>   if(x < y) {
>>>>     writeLines("No Break Dance :-(")
>>>>     x <- x + 1
>>>>   } else {
>>>>     writeLines("Break Dance!")
>>>>     break
>>>>   }
>>>> }
>>>> ## No Break Dance :(
>>>> ## No Break Dance :(
>>>> ## No Break Dance :(
>>>> ## No Break Dance :(
>>>> ## No Break Dance :(
>>>> ## Break Dance!
>>>> ## >
>>>>
>>>> ## However, if I take the loop contents of the repeat{} function, and save
>>>> ## them to a file (breakTest.R) that contains the following:
>>>> ##                 ^^^^^^^^^^^
>>>> ##                __SEE THAT FILE__
>>>> ## if(x < y) {
>>>> ##   writeLines("No Break Dance :-(")
>>>> ##   x = x + 1
>>>> ## } else {
>>>> ##   writeLines("Break Dance!")
>>>> ##   break
>>>> ## }
>>>>
>>>> ## And then run the following code:
>>>>
>>>> x <- 1
>>>> y <- 5
>>>> repeat{
>>>>   source("./breakTest.R")
>>>> }
>>>> cat("successfully finished\n")
>>>>
>>>> ## I get the following error:
>>>>
>>>> ## No Break Dance :(
>>>> ## No Break Dance :(
>>>> ## No Break Dance :(
>>>> ## No Break Dance :(
>>>> ## No Break Dance :(
>>>> ## Break Dance!
>>>> ## Error in eval(ei, envir) : no loop for break/next, jumping to top level
>>>> ## ^^^^^^^^^^^^^^^^^^^^
>>>>
>>>>
>>>> ## This was not an issue with previous versions of R that I have used, including 3.3.3.
>>>>
>>>> ## MM: It does work in R 3.3.3, indeed
>>>> ## --  it fails in R 3.4.0 and later
>>>>
>>>>
>>>> ## Any suggestions? Is this a known bug with 3.4.1?
>>>>
>>>> ## Cheers-
>>>> ## Peter
>>>>
>>>>
>>>> ## ----------------------------------------------------------------
>>>> ## peter bosa
>>>> ## metro
>>>> ## modeling services
>>>> ## 600 ne grand ave
>>>> ## portland, or  97232
>>>>
>>>> ## peter.bosa at oregonmetro.gov<mailto:peter.bosa at oregonmetro.gov>
>>>> ## 503.797.1771
>>>>
>>>> ## metro | making a great place
>>>> ## www.oregonmetro.gov
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>


From mark.vanderloo at gmail.com  Wed Aug 23 11:10:50 2017
From: mark.vanderloo at gmail.com (Mark van der Loo)
Date: Wed, 23 Aug 2017 09:10:50 +0000
Subject: [Rd] bugs in documentation of stats::stl
Message-ID: <CAOKDuOiVcpeXgH80WJtOcME1JPQpxb=oC76v32T1vVc3Wo7B_g@mail.gmail.com>

Dear list, R-core,


The documentation of stats::stl explicitly refers to the paper by
Cleveland[1] to explain the parameters. However, the description is
confusing, with two descriptions seeming to refer to the same parameter in
the paper.

s.window: [...] the loess window for seasonal extraction, which should be
odd and at least 7, according to Cleveland et al

--> The phrase 'odd and at least 7' refers to Cleveland's parameter n_(s),
section 3.5 of [1].

Confusing: Cleveland calls this 'seasonal smoothing', not extraction.


l.window:  the span (in lags) of the loess window of the low-pass filter
used for each subseries.[...]

--> The description 'low-pass filter used for each subseries' also seems to
correspond to Cleveland's parameter n_(s), in step two of the algorithm in
the reference. (section 2.2 of [1]).

Confusing: Cleveland does not apply a low-pass filter to each subseries[2].
The subseries are reconstructed to a single series and after that a
low-pass filter is applied (step 3 of the algorithm in section 2.2 of [1])


So what should it be? A literal reference to Cleveland's n_(s), n_(l), and
n_(t) would be really helpful here.



Thank you,
Best,
Mark


[1] https://www.wessa.net/download/stl.pdf
[2] well, technically he does in step 2 of the algorithm, but it is not
called a low-pass filter in the paper.

	[[alternative HTML version deleted]]


From marc_grt at yahoo.fr  Wed Aug 23 14:12:53 2017
From: marc_grt at yahoo.fr (Marc Girondot)
Date: Wed, 23 Aug 2017 14:12:53 +0200
Subject: [Rd] MASS:::dropterm.glm() and MASS:::addterm.glm() should use
 ... for extractAIC()
In-Reply-To: <89d0ae23-3560-8c1a-fcd9-4ead33a49496@yahoo.fr>
References: <89d0ae23-3560-8c1a-fcd9-4ead33a49496@yahoo.fr>
Message-ID: <ec5ad8c4-31c0-3213-8ea8-73547adfa773@yahoo.fr>

Hi,
I have sent this message to this list the July, 7th. It was about a 
problem in MASS package.
Until now there is no change in the devel version.
As the problem occurs in a package and not in the R-core, I don't know 
if the message should have been sent here. Anyway, I have added a copy 
to Pr Ripley.
I hope it could have been fixed.
Sincerely
Marc

Le 09/07/2017 ? 16:05, Marc Girondot via R-devel a ?crit?:
> Here is a change required from MASS:::dropterm.glm() and 
> MASS:::addterm.glm().
>
> Thanks
>
> Marc
>
>
> The stepAIC() function from package MASS uses extractAIC() to get the 
> AIC from a model.
> Several methods exist:
> extractAIC.glm() for example, some in MASS packages and some in stats 
> package.
>
> The parameters for extractAIC() are:
> fit, scale, k = 2, ...
>
> The ... are not used in most of the extractAIC.xxx() methods, from 
> example in stats:::extractAIC.glm() or MASS:::extractAIC.loglm() but 
> its presence could be necessary if extractAIC() is changed to use for 
> example to use AICc rather than AIC.
>
> Within stepAIC(), extractAIC() uses always the ... parameter. So all 
> is ok for that.
>
> However, stepAIC() uses dropterm() or addterm().
>
> Within MASS:::dropterm.glm() and MASS:::addterm.glm(), extractAIC() is 
> also used but without the ... parameter.
>
> It prevents to use new version of extractAIC() that could use this 
> parameter.
>
> The solution is simple:
> In MASS:::dropterm.glm(), line 60 and MASS:::addterm.glm(), line 84:
> aic <- aic + (extractAIC(object, k = k)[2L] - aic[1L])
> must be changed to
> aic <- aic + (extractAIC(object, k = k, ...)[2L] - aic[1L])
>
> Other dropterm.xxx() and addterm.xxx() do not suffer this problem.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From Peter.Bosa at oregonmetro.gov  Wed Aug 23 22:48:05 2017
From: Peter.Bosa at oregonmetro.gov (Peter Bosa)
Date: Wed, 23 Aug 2017 20:48:05 +0000
Subject: [Rd] Possible repeat{} / break function bug in R 3.4.1
In-Reply-To: <a30bb23c-39ac-68f5-1951-52a5e3ae4504@gmail.com>
References: <1f22e392cb594b52ac3907d9f79992dd@MEX2.metro-region.org>
 <22941.10844.382587.277767@stat.math.ethz.ch>
 <22941.11268.787310.511504@stat.math.ethz.ch>
 <60DC6C3E-1BF9-4F20-8A99-20D4C129755D@rstudio.com>
 <ba631996-db0b-12d1-e149-c14e6a20f802@gmail.com>,
 <a30bb23c-39ac-68f5-1951-52a5e3ae4504@gmail.com>
Message-ID: <1503521286171.8465@oregonmetro.gov>

Thank you, Gentlemen...much appreciated!

----------------------------------------------------------------
peter bosa
metro
transportation research and modeling services
600 ne grand ave
portland, or  97232
 
peter.bosa at oregonmetro.gov
503.797.1771
 
metro | making a great place
www.oregonmetro.gov
________________________________________
From: Tomas Kalibera <tomas.kalibera at gmail.com>
Sent: Wednesday, August 23, 2017 12:54 AM
To: Peter Bosa
Cc: Lionel Henry; Martin Maechler; R-devel at r-project.org
Subject: Re: [Rd] Possible repeat{} / break function bug in R 3.4.1

Fixed in 73112.

If you needed to run this code in unpatched versions of R, you can
disable the problematic compiler optimization in the loop for instance
by adding "eval(NULL)" to the body of the loop. However, please do not
forget to remove this for future versions of R and specifically do not
assume this would turn off a particular compiler optimization in future
versions.

Best
Tomas




On 08/23/2017 09:24 AM, Tomas Kalibera wrote:
> It is a bug in the byte-code compiler. I will fix
> Tomas
>
> On 08/23/2017 09:22 AM, Lionel Henry wrote:
>> I don't think that's a bug. source() uses eval(), and eval() creates a
>> new function-like context frame. In a way expecting `break` to work
>> inside source() is like expecting `break` to cross stack frames:
>>
>>      my_break <- function() break
>>      repeat(my_break())
>>
>> Lionel
>>
>>
>>> On 23 ao?t 2017, at 09:17, Martin Maechler
>>> <maechler at stat.math.ethz.ch> wrote:
>>>
>>>>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>>>>     on Wed, 23 Aug 2017 09:10:20 +0200 writes:
>>>>>>>> Peter Bosa <Peter.Bosa at oregonmetro.gov>
>>>>>>>>     on Tue, 22 Aug 2017 14:39:50 +0000 writes:
>>>>> Hello, I've noticed the following error using repeat{} / break in
>>>>> R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit
>>>>> environments).
>>>>> When running a repeat function, the break command causes an error
>>>>> message if the repeat command refers to code within a file, but
>>>>> does not produce an error if the code is contained within the
>>>>> repeat{} command.
>>>>> Hello, I've noticed the following error using repeat{} / break in
>>>>> R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit
>>>>> environments).
>>>>>
>>>>> When running a repeat function, the break command causes an error
>>>>> message if the repeat command refers to code within a file, but
>>>>> does not produce an error if the code is contained within the
>>>>> repeat{} command.
>>>>>
>>>>> For example, the following code runs fine:
>>>>>
>>>>> x <- 1
>>>>> y <- 5
>>>>>
>>>>> repeat {
>>>>> if(x < y) {
>>>>> print("No Break Dance :-(")
>>>>> x = x + 1
>>>>> } else {
>>>>> print("Break Dance!")
>>>>> break
>>>>> }
>>>>> }
>>>>>
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "Break Dance!"
>>>>> However, if I take the loop contents of the repeat{} function, and
>>>>> save them to a file (breakTest.R) that contains the following:
>>>>>
>>>>> if(x < y) {
>>>>> print("No Break Dance :-(")
>>>>> x = x + 1
>>>>> } else {
>>>>> print("Break Dance!")
>>>>> break
>>>>> }
>>>>>
>>>>> And then run the following code:
>>>>>
>>>>> x <- 1
>>>>> y <- 5
>>>>>
>>>>> repeat{
>>>>> source("./breakTest.R")
>>>>> }
>>>>>
>>>>> I get the following error:
>>>>>
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "No Break Dance :("
>>>>> [1] "Break Dance!"
>>>>> Error in eval(ei, envir) : no loop for break/next, jumping to top
>>>>> level
>>>>> This was not an issue with previous versions of R that I have
>>>>> used, including 3.3.3.
>>>>>
>>>>> Any suggestions? Is this a known bug with 3.4.1?
>>>> Thank you, Peter!
>>>> I can confirm what you are seeing (on Linux) in R version 3.4.0,
>>>> 3.4.1, and "R devel", and also that this had worked w/o a
>>>> problem in earlier versions of R, where I've looked at
>>>> R version 3.3.3 and 3.2.5.
>>>> I do think this is a bug, but it was not known till now.
>>>> For ease of use, I attach the two R files to easily reproduce.
>>>> Note I use  writeLines() instead of print() as its output is "nicer".
>>>> Best regards,
>>>> Martin Maechler, ETH Zurich
>>> Trying again with the two attachment.  Yes, I of all people (!!)
>>> should know that they must have an allowed MIME type; in this
>>> case  text/plain !
>>>
>>> Martin
>>>
>>> ## see ./break-source_R341.R
>>> if(x < y) {
>>>   writeLines("No Break Dance :-(")
>>>   x <- x + 1
>>> } else {
>>>   writeLines("Break Dance!")
>>>   break
>>> }
>>> ## From: Peter Bosa <Peter.Bosa at oregonmetro.gov>
>>> ## To: "R-devel at r-project.org" <R-devel at r-project.org>
>>> ## Subject: [Rd] Possible repeat{} / break function bug in R 3.4.1
>>> ## Date: Tue, 22 Aug 2017 14:39:50 +0000
>>>
>>> ## Hello, I've noticed the following error using repeat{} / break in
>>> R 3.4.1 running on Windows 10 and Windows Server 2008 (both 64-bit
>>> environments).
>>>
>>> ## When running a repeat function, the break command causes an error
>>> message if the repeat command refers to code within a file, but does
>>> not produce an error if the code is contained within the repeat{}
>>> command.
>>>
>>> ## For example, the following code runs fine:
>>>
>>> x <- 1
>>> y <- 5
>>> repeat {
>>>   if(x < y) {
>>>     writeLines("No Break Dance :-(")
>>>     x <- x + 1
>>>   } else {
>>>     writeLines("Break Dance!")
>>>     break
>>>   }
>>> }
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## Break Dance!
>>> ## >
>>>
>>> ## However, if I take the loop contents of the repeat{} function,
>>> and save
>>> ## them to a file (breakTest.R) that contains the following:
>>> ##                 ^^^^^^^^^^^
>>> ##                __SEE THAT FILE__
>>> ## if(x < y) {
>>> ##   writeLines("No Break Dance :-(")
>>> ##   x = x + 1
>>> ## } else {
>>> ##   writeLines("Break Dance!")
>>> ##   break
>>> ## }
>>>
>>> ## And then run the following code:
>>>
>>> x <- 1
>>> y <- 5
>>> repeat{
>>>   source("./breakTest.R")
>>> }
>>> cat("successfully finished\n")
>>>
>>> ## I get the following error:
>>>
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## No Break Dance :(
>>> ## Break Dance!
>>> ## Error in eval(ei, envir) : no loop for break/next, jumping to top
>>> level
>>> ## ^^^^^^^^^^^^^^^^^^^^
>>>
>>>
>>> ## This was not an issue with previous versions of R that I have
>>> used, including 3.3.3.
>>>
>>> ## MM: It does work in R 3.3.3, indeed
>>> ## --  it fails in R 3.4.0 and later
>>>
>>>
>>> ## Any suggestions? Is this a known bug with 3.4.1?
>>>
>>> ## Cheers-
>>> ## Peter
>>>
>>>
>>> ## ----------------------------------------------------------------
>>> ## peter bosa
>>> ## metro
>>> ## modeling services
>>> ## 600 ne grand ave
>>> ## portland, or  97232
>>>
>>> ## peter.bosa at oregonmetro.gov<mailto:peter.bosa at oregonmetro.gov>
>>> ## 503.797.1771
>>>
>>> ## metro | making a great place
>>> ## www.oregonmetro.gov
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>



From jon.armond at gmail.com  Thu Aug 24 08:10:08 2017
From: jon.armond at gmail.com (Jonathan Armond)
Date: Thu, 24 Aug 2017 07:10:08 +0100
Subject: [Rd] [patch] Fix typo in 'rank' documentation
Message-ID: <CAOyQ9sberX+Hm7W=E9F4Z51n1hA6WE-vCDj3HMoEgHGc3QVsaw@mail.gmail.com>

I noticed a typo in the documentation for the 'rank' function.
Specifically, it describes ties.method="first" and contrasts with...
ties.method="first", when it should be ties.method="last".

Thanks,
Jon
-------------- next part --------------
Index: src/library/base/man/rank.Rd
===================================================================
--- src/library/base/man/rank.Rd	(revision 73116)
+++ src/library/base/man/rank.Rd	(working copy)
@@ -34,7 +34,7 @@
   (called \sQuote{ties}), the argument \code{ties.method} determines the
   result at the corresponding indices.  The \code{"first"} method results
   in a permutation with increasing values at each index set of ties, and
-  analogously \code{"first"} with decreasing values.  The
+  analogously \code{"last"} with decreasing values.  The
   \code{"random"} method puts these in random order whereas the
   default, \code{"average"}, replaces them by their mean, and
   \code{"max"} and \code{"min"} replaces them by their maximum and

From maechler at stat.math.ethz.ch  Thu Aug 24 11:06:50 2017
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 24 Aug 2017 11:06:50 +0200
Subject: [Rd] [patch] Fix typo in 'rank' documentation
In-Reply-To: <CAOyQ9sberX+Hm7W=E9F4Z51n1hA6WE-vCDj3HMoEgHGc3QVsaw@mail.gmail.com>
References: <CAOyQ9sberX+Hm7W=E9F4Z51n1hA6WE-vCDj3HMoEgHGc3QVsaw@mail.gmail.com>
Message-ID: <22942.38698.389460.776346@stat.math.ethz.ch>

>>>>> Jonathan Armond <jon.armond at gmail.com>
>>>>>     on Thu, 24 Aug 2017 07:10:08 +0100 writes:

    > I noticed a typo in the documentation for the 'rank' function.
    > Specifically, it describes ties.method="first" and contrasts with...
    > ties.method="first", when it should be ties.method="last".

    > Thanks,
    > Jon

    > ----------------------------------------------------------------------
    > Index: src/library/base/man/rank.Rd
    > ===================================================================
    > --- src/library/base/man/rank.Rd	(revision 73116)
    > +++ src/library/base/man/rank.Rd	(working copy)
    ...........

Thank you, Jon.

Seems my mistake, I'm going to correct it.

Martin Maechler
ETH Zurich


From gbayon at gmail.com  Thu Aug 24 16:42:36 2017
From: gbayon at gmail.com (Gustavo Fernandez Bayon)
Date: Thu, 24 Aug 2017 16:42:36 +0200
Subject: [Rd] Are r2dtable and C_r2dtable behaving correctly?
Message-ID: <CALxJP_bGTshNpaeb2KmuzL=RboY8fd7+N4YHs1_E6155iESQnQ@mail.gmail.com>

Hello,

While doing some enrichment tests using chisq.test() with simulated
p-values, I noticed some strange behaviour. The computed p-value was
extremely small, so I decided to dig a little deeper and debug
chisq.test(). I noticed then that the simulated statistics returned by the
following call

tmp <- .Call(C_chisq_sim, sr, sc, B, E)

were all the same, very small numbers. This, at first, seemed strange to
me. So I decided to do some simulations myself, and started playing around
with the r2dtable() function. Problem is, using my row and column
marginals, r2dtable() always returns the same matrix. Let's provide a
minimal example:

rr <- c(209410, 276167)
cc <- c(25000, 460577)
ms <- r2dtable(3, rr, cc)

I have tested this code in two machines and it always returned the same
list of length three containing the same matrix three times. The repeated
matrix is the following:

[[1]]
      [,1]   [,2]
[1,] 10782 198628
[2,] 14218 261949

[[2]]
      [,1]   [,2]
[1,] 10782 198628
[2,] 14218 261949

[[3]]
      [,1]   [,2]
[1,] 10782 198628
[2,] 14218 261949

I also coded a small function returning the value of the chi-squared
statistic using the previous fixed marginals and taking the value at [1, 1]
as input. This helped me to plot a curve and notice that the repeating
matrix was the one that yielded the minimum chi-squared statistic.

This behaviour persists if I use greater marginals (summing 100000 to every
element of the marginal for example),

> rr <- c(309410, 376167)
> cc <- c(125000, 560577)
> r2dtable(3, rr, cc)
[[1]]
      [,1]   [,2]
[1,] 56414 252996
[2,] 68586 307581

[[2]]
      [,1]   [,2]
[1,] 56414 252996
[2,] 68586 307581

[[3]]
      [,1]   [,2]
[1,] 56414 252996
[2,] 68586 307581

 but not if we use smaller ones:

> rr <- c(9410, 76167)
> cc <- c(25000, 60577)
> r2dtable(3, rr, cc)
[[1]]
      [,1]  [,2]
[1,]  2721  6689
[2,] 22279 53888

[[2]]
      [,1]  [,2]
[1,]  2834  6576
[2,] 22166 54001

[[3]]
      [,1]  [,2]
[1,]  2778  6632
[2,] 22222 53945

I have looked inside the C code for the C_r2dtable() and rcont2()
functions, but I cannot do much more than guess where this behaviour could
originate, so I would like to ask for help from anybody more experienced in
the R implementation. Guess there is some kind of inflection point
depending on the total sample size of the table, or maybe the generation
algorithm tends to output matrices concentrated around the minimum.

This is the output from my sessionInfo()

> sessionInfo()
R version 3.4.0 (2017-04-21)
Platform: x86_64-redhat-linux-gnu (64-bit)
Running under: CentOS Linux 7 (Core)

Matrix products: default
BLAS/LAPACK: /usr/lib64/R/lib/libRblas.so

locale:
 [1] LC_CTYPE=es_ES.UTF-8       LC_NUMERIC=C
LC_TIME=es_ES.UTF-8
 [4] LC_COLLATE=es_ES.UTF-8     LC_MONETARY=es_ES.UTF-8
 LC_MESSAGES=es_ES.UTF-8
 [7] LC_PAPER=es_ES.UTF-8       LC_NAME=C                  LC_ADDRESS=C

[10] LC_TELEPHONE=C             LC_MEASUREMENT=es_ES.UTF-8
LC_IDENTIFICATION=C

attached base packages:
[1] stats4    parallel  stats     graphics  grDevices utils     datasets
 methods   base

other attached packages:
 [1] profvis_0.3.3                           bindrcpp_0.2

 [3] FDb.InfiniumMethylation.hg19_2.2.0      org.Hs.eg.db_3.4.1

 [5] TxDb.Hsapiens.UCSC.hg19.knownGene_3.2.2 GenomicFeatures_1.28.4

 [7] AnnotationDbi_1.38.2                    Biobase_2.36.2

 [9] GenomicRanges_1.28.4                    GenomeInfoDb_1.12.2

[11] IRanges_2.10.2                          S4Vectors_0.14.3

[13] BiocGenerics_0.22.0                     epian_0.1.0


loaded via a namespace (and not attached):
 [1] SummarizedExperiment_1.6.3 purrr_0.2.3                reshape2_1.4.2

 [4] lattice_0.20-35            htmltools_0.3.6
 rtracklayer_1.36.4
 [7] blob_1.1.0                 XML_3.98-1.9               rlang_0.1.2

[10] foreign_0.8-67             glue_1.1.1                 DBI_0.7

[13] BiocParallel_1.10.1        bit64_0.9-7
 matrixStats_0.52.2
[16] GenomeInfoDbData_0.99.0    bindr_0.1                  plyr_1.8.4

[19] stringr_1.2.0              zlibbioc_1.22.0
 Biostrings_2.44.2
[22] htmlwidgets_0.9            psych_1.7.5                memoise_1.1.0

[25] biomaRt_2.32.1             broom_0.4.2                Rcpp_0.12.12

[28] DelayedArray_0.2.7         XVector_0.16.0             bit_1.1-12

[31] Rsamtools_1.28.0           mnormt_1.5-5               digest_0.6.12

[34] stringi_1.1.5              dplyr_0.7.2                grid_3.4.0

[37] tools_3.4.0                bitops_1.0-6               magrittr_1.5

[40] RCurl_1.95-4.8             tibble_1.3.3               RSQLite_2.0

[43] tidyr_0.7.0                pkgconfig_2.0.1            Matrix_1.2-9

[46] assertthat_0.2.0           R6_2.2.2
GenomicAlignments_1.12.1
[49] nlme_3.1-131               compiler_3.4.0

Any hint or help would be much appreciated. We do not use a lot the
simulated version of the chisq.test at the lab, but I would like to
understand better what is happening.

Kind regards,
Gustavo

	[[alternative HTML version deleted]]


From lukas.stadler at oracle.com  Thu Aug 24 17:15:16 2017
From: lukas.stadler at oracle.com (Lukas Stadler)
Date: Thu, 24 Aug 2017 17:15:16 +0200
Subject: [Rd] loop compilation problem
Message-ID: <8EA1A94F-EB30-4AE0-A399-C9F73BC33EB5@oracle.com>

Hi!

We?ve seen a problem with the compiler in specific cases of matrix updates:

> { m <- matrix(1:4, 2) ; z <- 0; for(i in 1) { m[z <- z + 1,z <- z + 1] <- 99; } ; m }
     [,1] [,2]
[1,]    1    3
[2,]    2   99

Here, it modifies element [2,2], which is unexpected.
It behaves correct without the loop:

> { m <- matrix(1:4, 2) ; z <- 0; m[z <- z + 1,z <- z + 1] <- 99 ; m }
     [,1] [,2]
[1,]    1   99
[2,]    2    4

? and without the jit:

> enableJIT(0)
[1] 3
> { m <- matrix(1:4, 2) ; z <- 0; for(i in 1) { m[z <- z + 1,z <- z + 1] <- 99; } ; m }
     [,1] [,2]
[1,]    1   99
[2,]    2    4

I checked with "R Under development (unstable) (2017-08-23 r73116)?, and the problem is still there.

- Lukas

From luke-tierney at uiowa.edu  Thu Aug 24 18:10:58 2017
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Thu, 24 Aug 2017 11:10:58 -0500 (CDT)
Subject: [Rd] loop compilation problem
In-Reply-To: <8EA1A94F-EB30-4AE0-A399-C9F73BC33EB5@oracle.com>
References: <8EA1A94F-EB30-4AE0-A399-C9F73BC33EB5@oracle.com>
Message-ID: <alpine.DEB.2.20.1708241110230.2616@luke-Latitude>

Thanks.

Here is a simplified version:

library(compiler)
zero <- 0
one <- 1
expr <- quote((z <- zero + one) + (z <- z + 1))
eval(compiler::compile(expr))

Sill fix shortly.

Best,

luke

On Thu, 24 Aug 2017, Lukas Stadler wrote:

> Hi!
>
> We?ve seen a problem with the compiler in specific cases of matrix updates:
>
>> { m <- matrix(1:4, 2) ; z <- 0; for(i in 1) { m[z <- z + 1,z <- z + 1] <- 99; } ; m }
>     [,1] [,2]
> [1,]    1    3
> [2,]    2   99
>
> Here, it modifies element [2,2], which is unexpected.
> It behaves correct without the loop:
>
>> { m <- matrix(1:4, 2) ; z <- 0; m[z <- z + 1,z <- z + 1] <- 99 ; m }
>     [,1] [,2]
> [1,]    1   99
> [2,]    2    4
>
> ? and without the jit:
>
>> enableJIT(0)
> [1] 3
>> { m <- matrix(1:4, 2) ; z <- 0; for(i in 1) { m[z <- z + 1,z <- z + 1] <- 99; } ; m }
>     [,1] [,2]
> [1,]    1   99
> [2,]    2    4
>
> I checked with "R Under development (unstable) (2017-08-23 r73116)?, and the problem is still there.
>
> - Lukas
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Luke Tierney
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu

From carlganz at gmail.com  Thu Aug 24 23:17:15 2017
From: carlganz at gmail.com (Carl Ganz)
Date: Thu, 24 Aug 2017 14:17:15 -0700
Subject: [Rd] Bug in tools::toTitleCase
Message-ID: <CALbY4SOyzJaa0gSHy4Utwz6_JkYi6kSw0OXGc-BH7QoxmRv_eg@mail.gmail.com>

Hello,

I believe there is a bug in tools::toTitleCase, because it converts NAs
into the string "NA".

tools::toTitleCase(NA_character_)

The issue appears to be with the C function splitString since this also
returns "NA":

.Call('C_splitString', NA_character_, " -/\"()\n", PACKAGE = "tools")

Kind Regards,
Carl Ganz

	[[alternative HTML version deleted]]


From maechler at stat.math.ethz.ch  Fri Aug 25 10:30:49 2017
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 25 Aug 2017 10:30:49 +0200
Subject: [Rd] Are r2dtable and C_r2dtable behaving correctly?
In-Reply-To: <CALxJP_bGTshNpaeb2KmuzL=RboY8fd7+N4YHs1_E6155iESQnQ@mail.gmail.com>
References: <CALxJP_bGTshNpaeb2KmuzL=RboY8fd7+N4YHs1_E6155iESQnQ@mail.gmail.com>
Message-ID: <22943.57401.129802.474678@stat.math.ethz.ch>

>>>>> Gustavo Fernandez Bayon <gbayon at gmail.com>
>>>>>     on Thu, 24 Aug 2017 16:42:36 +0200 writes:

    > Hello,
    > While doing some enrichment tests using chisq.test() with simulated
    > p-values, I noticed some strange behaviour. The computed p-value was
    > extremely small, so I decided to dig a little deeper and debug
    > chisq.test(). I noticed then that the simulated statistics returned by the
    > following call

    > tmp <- .Call(C_chisq_sim, sr, sc, B, E)

    > were all the same, very small numbers. This, at first, seemed strange to
    > me. So I decided to do some simulations myself, and started playing around
    > with the r2dtable() function. Problem is, using my row and column
    > marginals, r2dtable() always returns the same matrix. Let's provide a
    > minimal example:

    > rr <- c(209410, 276167)
    > cc <- c(25000, 460577)
    > ms <- r2dtable(3, rr, cc)

    > I have tested this code in two machines and it always returned the same
    > list of length three containing the same matrix three times. The repeated
    > matrix is the following:

    > [[1]]
    > [,1]   [,2]
    > [1,] 10782 198628
    > [2,] 14218 261949

    > [[2]]
    > [,1]   [,2]
    > [1,] 10782 198628
    > [2,] 14218 261949

    > [[3]]
    > [,1]   [,2]
    > [1,] 10782 198628
    > [2,] 14218 261949

Yes.  You can also do

   unique(r2dtable(100, rr, cc))

and see that the result is constant.

I'm pretty sure this is still due to some integer overflow,

in spite of the fact that I had spent quite some time to fix
such problem in Dec 2003, see the 14 years old bug PR#5701 
  https://bugs.r-project.org/bugzilla/show_bug.cgi?id=5701#c2

It has to be said that this is based on an algorithm published
in 1981, specifically - from  help(r2dtable) - 

     Patefield, W. M. (1981) Algorithm AS159.  An efficient method of
     generating r x c tables with given row and column totals.
     _Applied Statistics_ *30*, 91-97.

   For those with JSTOR access (typically via your University),
   available at http://www.jstor.org/stable/2346669

When I start reading it, indeed the algorithm seems start from the
expected value of a cell entry and then "explore from there"...
and I do wonder if there is not a flaw somewhere in the
algorithm:

I've now found that a bit more than a year ago, 'paljenczy' found on SO
  https://stackoverflow.com/questions/37309276/r-r2dtable-contingency-tables-are-too-concentrated
that indeed the generated tables seem to be too much around the mean.
Basically his example:

https://stackoverflow.com/questions/37309276/r-r2dtable-contingency-tables-are-too-concentrated


> set.seed(1); system.time(tabs <- r2dtable(1e6, c(100, 100), c(100, 100))); A11 <- vapply(tabs, function(x) x[1, 1], numeric(1))
   user  system elapsed 
  0.218   0.025   0.244 
> table(A11)

    34     35     36     37     38     39     40     41     42     43 
     2     17     40    129    334    883   2026   4522   8766  15786 
    44     45     46     47     48     49     50     51     52     53 
 26850  42142  59535  78851  96217 107686 112438 108237  95761  78737 
    54     55     56     57     58     59     60     61     62     63 
 59732  41474  26939  16006   8827   4633   2050    865    340    116 
    64     65     66     67 
    38     13      7      1 
> 

For a  2x2  table, there's really only one degree of freedom,
hence the above characterizes the full distribution for that
case.

I would have expected to see all possible values in  0:100
instead of such a "normal like" distribution with carrier only
in [34, 67].

There are newer publications and maybe algorithms.
So maybe the algorithm is "flawed by design" for really large
total number of observations, rather than wrong
Seems interesting ...

Martin Maechler


From jari.oksanen at oulu.fi  Fri Aug 25 11:23:19 2017
From: jari.oksanen at oulu.fi (Jari Oksanen)
Date: Fri, 25 Aug 2017 09:23:19 +0000
Subject: [Rd] Are r2dtable and C_r2dtable behaving correctly?
In-Reply-To: <22943.57401.129802.474678@stat.math.ethz.ch>
References: <CALxJP_bGTshNpaeb2KmuzL=RboY8fd7+N4YHs1_E6155iESQnQ@mail.gmail.com>,
 <22943.57401.129802.474678@stat.math.ethz.ch>
Message-ID: <1503652999326.82111@oulu.fi>

It is not about "really arge total number of observations", but:

set.seed(4711);tabs <- r2dtable(1e6, c(2, 2), c(2, 2)); A11 <- vapply(tabs, function(x) x[1, 1], numeric(1));table(A11)

A11
     0      1      2 
166483 666853 166664 

There are three possible matrices, and these come out in proportions 1:4:1, the one with all cells filled with ones being
most common.

Cheers, Jari O.
________________________________________
From: R-devel <r-devel-bounces at r-project.org> on behalf of Martin Maechler <maechler at stat.math.ethz.ch>
Sent: 25 August 2017 11:30
To: Gustavo Fernandez Bayon
Cc: r-devel at r-project.org
Subject: Re: [Rd] Are r2dtable and C_r2dtable behaving correctly?

>>>>> Gustavo Fernandez Bayon <gbayon at gmail.com>
>>>>>     on Thu, 24 Aug 2017 16:42:36 +0200 writes:

    > Hello,
    > While doing some enrichment tests using chisq.test() with simulated
    > p-values, I noticed some strange behaviour. The computed p-value was
    > extremely small, so I decided to dig a little deeper and debug
    > chisq.test(). I noticed then that the simulated statistics returned by the
    > following call

    > tmp <- .Call(C_chisq_sim, sr, sc, B, E)

    > were all the same, very small numbers. This, at first, seemed strange to
    > me. So I decided to do some simulations myself, and started playing around
    > with the r2dtable() function. Problem is, using my row and column
    > marginals, r2dtable() always returns the same matrix. Let's provide a
    > minimal example:

    > rr <- c(209410, 276167)
    > cc <- c(25000, 460577)
    > ms <- r2dtable(3, rr, cc)

    > I have tested this code in two machines and it always returned the same
    > list of length three containing the same matrix three times. The repeated
    > matrix is the following:

    > [[1]]
    > [,1]   [,2]
    > [1,] 10782 198628
    > [2,] 14218 261949

    > [[2]]
    > [,1]   [,2]
    > [1,] 10782 198628
    > [2,] 14218 261949

    > [[3]]
    > [,1]   [,2]
    > [1,] 10782 198628
    > [2,] 14218 261949

Yes.  You can also do

   unique(r2dtable(100, rr, cc))

and see that the result is constant.

I'm pretty sure this is still due to some integer overflow,

in spite of the fact that I had spent quite some time to fix
such problem in Dec 2003, see the 14 years old bug PR#5701
  https://bugs.r-project.org/bugzilla/show_bug.cgi?id=5701#c2

It has to be said that this is based on an algorithm published
in 1981, specifically - from  help(r2dtable) -

     Patefield, W. M. (1981) Algorithm AS159.  An efficient method of
     generating r x c tables with given row and column totals.
     _Applied Statistics_ *30*, 91-97.

   For those with JSTOR access (typically via your University),
   available at http://www.jstor.org/stable/2346669

When I start reading it, indeed the algorithm seems start from the
expected value of a cell entry and then "explore from there"...
and I do wonder if there is not a flaw somewhere in the
algorithm:

I've now found that a bit more than a year ago, 'paljenczy' found on SO
  https://stackoverflow.com/questions/37309276/r-r2dtable-contingency-tables-are-too-concentrated
that indeed the generated tables seem to be too much around the mean.
Basically his example:

https://stackoverflow.com/questions/37309276/r-r2dtable-contingency-tables-are-too-concentrated


> set.seed(1); system.time(tabs <- r2dtable(1e6, c(100, 100), c(100, 100))); A11 <- vapply(tabs, function(x) x[1, 1], numeric(1))
   user  system elapsed
  0.218   0.025   0.244
> table(A11)

    34     35     36     37     38     39     40     41     42     43
     2     17     40    129    334    883   2026   4522   8766  15786
    44     45     46     47     48     49     50     51     52     53
 26850  42142  59535  78851  96217 107686 112438 108237  95761  78737
    54     55     56     57     58     59     60     61     62     63
 59732  41474  26939  16006   8827   4633   2050    865    340    116
    64     65     66     67
    38     13      7      1
>

For a  2x2  table, there's really only one degree of freedom,
hence the above characterizes the full distribution for that
case.

I would have expected to see all possible values in  0:100
instead of such a "normal like" distribution with carrier only
in [34, 67].

There are newer publications and maybe algorithms.
So maybe the algorithm is "flawed by design" for really large
total number of observations, rather than wrong
Seems interesting ...

Martin Maechler

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From pdalgd at gmail.com  Fri Aug 25 11:43:40 2017
From: pdalgd at gmail.com (Peter Dalgaard)
Date: Fri, 25 Aug 2017 11:43:40 +0200
Subject: [Rd] Are r2dtable and C_r2dtable behaving correctly?
In-Reply-To: <22943.57401.129802.474678@stat.math.ethz.ch>
References: <CALxJP_bGTshNpaeb2KmuzL=RboY8fd7+N4YHs1_E6155iESQnQ@mail.gmail.com>
 <22943.57401.129802.474678@stat.math.ethz.ch>
Message-ID: <87D3C0A4-E127-45AC-AD08-2030FB2AFDE1@gmail.com>


> On 25 Aug 2017, at 10:30 , Martin Maechler <maechler at stat.math.ethz.ch> wrote:
> 
[...]
> https://stackoverflow.com/questions/37309276/r-r2dtable-contingency-tables-are-too-concentrated
> 
> 
>> set.seed(1); system.time(tabs <- r2dtable(1e6, c(100, 100), c(100, 100))); A11 <- vapply(tabs, function(x) x[1, 1], numeric(1))
>   user  system elapsed 
>  0.218   0.025   0.244 
>> table(A11)
> 
>    34     35     36     37     38     39     40     41     42     43 
>     2     17     40    129    334    883   2026   4522   8766  15786 
>    44     45     46     47     48     49     50     51     52     53 
> 26850  42142  59535  78851  96217 107686 112438 108237  95761  78737 
>    54     55     56     57     58     59     60     61     62     63 
> 59732  41474  26939  16006   8827   4633   2050    865    340    116 
>    64     65     66     67 
>    38     13      7      1 
>> 
> 
> For a  2x2  table, there's really only one degree of freedom,
> hence the above characterizes the full distribution for that
> case.
> 
> I would have expected to see all possible values in  0:100
> instead of such a "normal like" distribution with carrier only
> in [34, 67].

Hmm, am I missing a point here?

> round(dhyper(0:100,100,100,100)*1e6)
  [1]      0      0      0      0      0      0      0      0      0      0
 [11]      0      0      0      0      0      0      0      0      0      0
 [21]      0      0      0      0      0      0      0      0      0      0
 [31]      0      0      0      1      4     13     43    129    355    897
 [41]   2087   4469   8819  16045  26927  41700  59614  78694  95943 108050
 [51] 112416 108050  95943  78694  59614  41700  26927  16045   8819   4469
 [61]   2087    897    355    129     43     13      4      1      0      0
 [71]      0      0      0      0      0      0      0      0      0      0
 [81]      0      0      0      0      0      0      0      0      0      0
 [91]      0      0      0      0      0      0      0      0      0      0
[101]      0


-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Office: A 4.23
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From pdalgd at gmail.com  Fri Aug 25 12:04:58 2017
From: pdalgd at gmail.com (Peter Dalgaard)
Date: Fri, 25 Aug 2017 12:04:58 +0200
Subject: [Rd] Are r2dtable and C_r2dtable behaving correctly?
In-Reply-To: <1503652999326.82111@oulu.fi>
References: <CALxJP_bGTshNpaeb2KmuzL=RboY8fd7+N4YHs1_E6155iESQnQ@mail.gmail.com>
 <22943.57401.129802.474678@stat.math.ethz.ch> <1503652999326.82111@oulu.fi>
Message-ID: <F3F2FF42-6F62-4A60-86CA-B7071EDA6429@gmail.com>


> On 25 Aug 2017, at 11:23 , Jari Oksanen <jari.oksanen at oulu.fi> wrote:
> 
> It is not about "really arge total number of observations", but:
> 
> set.seed(4711);tabs <- r2dtable(1e6, c(2, 2), c(2, 2)); A11 <- vapply(tabs, function(x) x[1, 1], numeric(1));table(A11)
> 
> A11
>     0      1      2 
> 166483 666853 166664 
> 
> There are three possible matrices, and these come out in proportions 1:4:1, the one with all cells filled with ones being
> most common.

... and

> dhyper(0:2,2,2,2)
[1] 0.1666667 0.6666667 0.1666667
> dhyper(0:2,2,2,2) *6
[1] 1 4 1

so that is exactly what you would expect. However,

> dhyper(10782,209410, 276167, 25000)
[1] 0.005230889

so you wouldn't expect 10782 to recur. It is close to the mean of the hypergeometric distribution, but 

> sim <- rhyper(1e6,209410, 276167, 25000)
> mean(sim)
[1] 10781.53
> sd(sim)
[1] 76.14209

(and incidentally, rhyper is plenty fast enough that you don't really need r2dtable for the 2x2 case)

-pd

> 
> Cheers, Jari O.
> ________________________________________
> From: R-devel <r-devel-bounces at r-project.org> on behalf of Martin Maechler <maechler at stat.math.ethz.ch>
> Sent: 25 August 2017 11:30
> To: Gustavo Fernandez Bayon
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] Are r2dtable and C_r2dtable behaving correctly?
> 
>>>>>> Gustavo Fernandez Bayon <gbayon at gmail.com>
>>>>>>    on Thu, 24 Aug 2017 16:42:36 +0200 writes:
> 
>> Hello,
>> While doing some enrichment tests using chisq.test() with simulated
>> p-values, I noticed some strange behaviour. The computed p-value was
>> extremely small, so I decided to dig a little deeper and debug
>> chisq.test(). I noticed then that the simulated statistics returned by the
>> following call
> 
>> tmp <- .Call(C_chisq_sim, sr, sc, B, E)
> 
>> were all the same, very small numbers. This, at first, seemed strange to
>> me. So I decided to do some simulations myself, and started playing around
>> with the r2dtable() function. Problem is, using my row and column
>> marginals, r2dtable() always returns the same matrix. Let's provide a
>> minimal example:
> 
>> rr <- c(209410, 276167)
>> cc <- c(25000, 460577)
>> ms <- r2dtable(3, rr, cc)
> 
>> I have tested this code in two machines and it always returned the same
>> list of length three containing the same matrix three times. The repeated
>> matrix is the following:
> 
>> [[1]]
>> [,1]   [,2]
>> [1,] 10782 198628
>> [2,] 14218 261949
> 
>> [[2]]
>> [,1]   [,2]
>> [1,] 10782 198628
>> [2,] 14218 261949
> 
>> [[3]]
>> [,1]   [,2]
>> [1,] 10782 198628
>> [2,] 14218 261949
> 
> Yes.  You can also do
> 
>   unique(r2dtable(100, rr, cc))
> 
> and see that the result is constant.
> 
> I'm pretty sure this is still due to some integer overflow,
> 
> in spite of the fact that I had spent quite some time to fix
> such problem in Dec 2003, see the 14 years old bug PR#5701
>  https://bugs.r-project.org/bugzilla/show_bug.cgi?id=5701#c2
> 
> It has to be said that this is based on an algorithm published
> in 1981, specifically - from  help(r2dtable) -
> 
>     Patefield, W. M. (1981) Algorithm AS159.  An efficient method of
>     generating r x c tables with given row and column totals.
>     _Applied Statistics_ *30*, 91-97.
> 
>   For those with JSTOR access (typically via your University),
>   available at http://www.jstor.org/stable/2346669
> 
> When I start reading it, indeed the algorithm seems start from the
> expected value of a cell entry and then "explore from there"...
> and I do wonder if there is not a flaw somewhere in the
> algorithm:
> 
> I've now found that a bit more than a year ago, 'paljenczy' found on SO
>  https://stackoverflow.com/questions/37309276/r-r2dtable-contingency-tables-are-too-concentrated
> that indeed the generated tables seem to be too much around the mean.
> Basically his example:
> 
> https://stackoverflow.com/questions/37309276/r-r2dtable-contingency-tables-are-too-concentrated
> 
> 
>> set.seed(1); system.time(tabs <- r2dtable(1e6, c(100, 100), c(100, 100))); A11 <- vapply(tabs, function(x) x[1, 1], numeric(1))
>   user  system elapsed
>  0.218   0.025   0.244
>> table(A11)
> 
>    34     35     36     37     38     39     40     41     42     43
>     2     17     40    129    334    883   2026   4522   8766  15786
>    44     45     46     47     48     49     50     51     52     53
> 26850  42142  59535  78851  96217 107686 112438 108237  95761  78737
>    54     55     56     57     58     59     60     61     62     63
> 59732  41474  26939  16006   8827   4633   2050    865    340    116
>    64     65     66     67
>    38     13      7      1
>> 
> 
> For a  2x2  table, there's really only one degree of freedom,
> hence the above characterizes the full distribution for that
> case.
> 
> I would have expected to see all possible values in  0:100
> instead of such a "normal like" distribution with carrier only
> in [34, 67].
> 
> There are newer publications and maybe algorithms.
> So maybe the algorithm is "flawed by design" for really large
> total number of observations, rather than wrong
> Seems interesting ...
> 
> Martin Maechler
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Office: A 4.23
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From maechler at stat.math.ethz.ch  Fri Aug 25 18:06:53 2017
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 25 Aug 2017 18:06:53 +0200
Subject: [Rd] Are r2dtable and C_r2dtable behaving correctly?
In-Reply-To: <87D3C0A4-E127-45AC-AD08-2030FB2AFDE1@gmail.com>
References: <CALxJP_bGTshNpaeb2KmuzL=RboY8fd7+N4YHs1_E6155iESQnQ@mail.gmail.com>
 <22943.57401.129802.474678@stat.math.ethz.ch>
 <87D3C0A4-E127-45AC-AD08-2030FB2AFDE1@gmail.com>
Message-ID: <22944.19229.766470.147579@stat.math.ethz.ch>

>>>>> Peter Dalgaard <pdalgd at gmail.com>
>>>>>     on Fri, 25 Aug 2017 11:43:40 +0200 writes:

    >> On 25 Aug 2017, at 10:30 , Martin Maechler <maechler at stat.math.ethz.ch> wrote:
    >> 
    > [...]
    >> https://stackoverflow.com/questions/37309276/r-r2dtable-contingency-tables-are-too-concentrated
    >> 
    >> 
    >>> set.seed(1); system.time(tabs <- r2dtable(1e6, c(100, 100), c(100, 100))); A11 <- vapply(tabs, function(x) x[1, 1], numeric(1))
    >> user  system elapsed 
    >> 0.218   0.025   0.244 
    >>> table(A11)
    >> 
    >> 34     35     36     37     38     39     40     41     42     43 
    >> 2     17     40    129    334    883   2026   4522   8766  15786 
    >> 44     45     46     47     48     49     50     51     52     53 
    >> 26850  42142  59535  78851  96217 107686 112438 108237  95761  78737 
    >> 54     55     56     57     58     59     60     61     62     63 
    >> 59732  41474  26939  16006   8827   4633   2050    865    340    116 
    >> 64     65     66     67 
    >> 38     13      7      1 
    >>> 
    >> 
    >> For a  2x2  table, there's really only one degree of freedom,
    >> hence the above characterizes the full distribution for that
    >> case.
    >> 
    >> I would have expected to see all possible values in  0:100
    >> instead of such a "normal like" distribution with carrier only
    >> in [34, 67].

    > Hmm, am I missing a point here?

    >> round(dhyper(0:100,100,100,100)*1e6)
    > [1]      0      0      0      0      0      0      0      0      0      0
    > [11]      0      0      0      0      0      0      0      0      0      0
    > [21]      0      0      0      0      0      0      0      0      0      0
    > [31]      0      0      0      1      4     13     43    129    355    897
    > [41]   2087   4469   8819  16045  26927  41700  59614  78694  95943 108050
    > [51] 112416 108050  95943  78694  59614  41700  26927  16045   8819   4469
    > [61]   2087    897    355    129     43     13      4      1      0      0
    > [71]      0      0      0      0      0      0      0      0      0      0
    > [81]      0      0      0      0      0      0      0      0      0      0
    > [91]      0      0      0      0      0      0      0      0      0      0
    > [101]      0

No, you ain't,  I was. :-(
Martin

    > -- 
    > Peter Dalgaard, Professor,
    > Center for Statistics, Copenhagen Business School
    > Solbjerg Plads 3, 2000 Frederiksberg, Denmark
    > Phone: (+45)38153501
    > Office: A 4.23
    > Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From pdalgd at gmail.com  Fri Aug 25 19:15:02 2017
From: pdalgd at gmail.com (peter dalgaard)
Date: Fri, 25 Aug 2017 19:15:02 +0200
Subject: [Rd] Are r2dtable and C_r2dtable behaving correctly?
In-Reply-To: <F3F2FF42-6F62-4A60-86CA-B7071EDA6429@gmail.com>
References: <CALxJP_bGTshNpaeb2KmuzL=RboY8fd7+N4YHs1_E6155iESQnQ@mail.gmail.com>
 <22943.57401.129802.474678@stat.math.ethz.ch> <1503652999326.82111@oulu.fi>
 <F3F2FF42-6F62-4A60-86CA-B7071EDA6429@gmail.com>
Message-ID: <D5EDB385-1D8A-4BCC-AAD2-39EBC5310D44@gmail.com>


> On 25 Aug 2017, at 12:04 , Peter Dalgaard <pdalgd at gmail.com> wrote:
> 
>> There are three possible matrices, and these come out in proportions 1:4:1, the one with all cells filled with ones being
>> most common.
> 
> ... and
> 
>> dhyper(0:2,2,2,2)
> [1] 0.1666667 0.6666667 0.1666667
>> dhyper(0:2,2,2,2) *6
> [1] 1 4 1
> 
> so that is exactly what you would expect.

And, incidentally, this is the "statistician's socks" puzzle from introductory probability: 

A statistician has 2 white socks and 2 black socks. Late for work a dark November morning, he puts on two socks at random. What is the probability that he goes to work with different colored socks?

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Office: A 4.23
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From eric-r_dev at omnifarious.org  Sat Aug 26 01:11:41 2017
From: eric-r_dev at omnifarious.org (Eric Hopper)
Date: Fri, 25 Aug 2017 16:11:41 -0700
Subject: [Rd] A problem with headless R on WIndows
Message-ID: <CAJWcbJHB69QxiVv3NjsxPGyZ4O_6RS6R_gEcd4oPfEJTObWRnw@mail.gmail.com>

I need a version of R that has no dependency on GDI32.dll. Ideally, this
would be a version of R that had no dependency on rgraphapp.dll.

Is there a way to configure the build system to build a version of R like
this? I've looked through the ./configure --help for seemingly appropriate
flags, and haven't found any. OTOH, rgraphapp is in the extras folder, so
it seems like R should be able to work without it.

Again, is this possible?

Thank you.

	[[alternative HTML version deleted]]


From suharto_anggono at yahoo.com  Sun Aug 27 14:10:05 2017
From: suharto_anggono at yahoo.com (Suharto Anggono Suharto Anggono)
Date: Sun, 27 Aug 2017 12:10:05 +0000 (UTC)
Subject: [Rd] R_xlen_t is an integer type
References: <1601411538.1678664.1503835805460.ref@mail.yahoo.com>
Message-ID: <1601411538.1678664.1503835805460@mail.yahoo.com>

A recent R devel NEWS item: approx(), spline(), splinefun() and approxfun() also work for long vectors.

In current R devel, in function 'approx1' in src/library/stats/src/approx.c and in function 'spline_eval' in src/library/stats/splines.c, in
#ifdef LONG_VECTOR_SUPPORT
there is a comment "R_xlen_t is double". It is incorrect. In Rinternals.h, in
#ifdef LONG_VECTOR_SUPPORT
R_xlen_t is defined as ptrdiff_t , an integer type.

In function 'approx1' in src/library/stats/src/approx.c,
	R_xlen_t ij = (i+j) / 2;
can be used unconditionally.

In function 'spline_eval' in src/library/stats/src/splines.c,
		R_xlen_t k = (i+j) / 2;
can be used unconditionally.


From pperry at stern.nyu.edu  Sun Aug 27 17:40:44 2017
From: pperry at stern.nyu.edu (Patrick Perry)
Date: Sun, 27 Aug 2017 11:40:44 -0400
Subject: [Rd] special latin1 do not print as glyphs in current devel on
 windows
In-Reply-To: <CANu2KkOOSz1yRy0iszE47uTniAms=_LgBOW8ZbEJpCCfhJyUuA@mail.gmail.com>
References: <CANu2KkOOSz1yRy0iszE47uTniAms=_LgBOW8ZbEJpCCfhJyUuA@mail.gmail.com>
Message-ID: <59A2E7FC.9090303@stern.nyu.edu>

Regarding the Windows character encoding issues Daniel Possenriede 
posted about earlier this month, where non-Latin-1 strings were getting 
marked as such 
(https://stat.ethz.ch/pipermail/r-devel/2017-August/074731.html ):

The issue is that on Windows, when the character locale is Windows-1252, 
R marks some (possibly all) native non-ASCII strings as "latin1". I 
posted a related bug report: 
https://bugs.r-project.org/bugzilla/show_bug.cgi?id=17329 . The bug 
report also includes a link to a fix for a related issue: converting 
strings from Windows native to UTF-8.

There is a work-around for this bug in the current development version 
of the 'corpus' package (not on CRAN yet). See 
https://github.com/patperry/r-corpus/issues/5 . I have tested this on a 
Windows-1252 install of R, but I have not tested it on a Windows install 
in another locale. It'd be great if someone with such an install would 
test the fix and report back, either here or on the github issue.


Patrick


From r_goertz at web.de  Mon Aug 28 09:33:31 2017
From: r_goertz at web.de (Ralf Goertz)
Date: Mon, 28 Aug 2017 09:33:31 +0200
Subject: [Rd] patch: automatically adjust width option when terminal is
	resized
Message-ID: <20170828093331.39607d5b@delligoertz.fritz.box>

Hi,

I guess there have been discussions about this in the past and from what
I understood hooking an R-function to facilitate automatic adjustment is
problematic. So why not doing it like this:

--- R-3.4.1/src/unix/sys-std.c  2017-03-24 00:03:59.000000000 +0100
+++ R-3.4.1/src/unix/sys-std.patched.c  2017-08-28 09:16:02.714204023 +0200
@@ -1005,6 +1005,9 @@
                // introduced in readline 4.0: only used for >= 6.3
 #ifdef HAVE_RL_RESIZE_TERMINAL
                rl_resize_terminal();
+               int rl_height, rl_width;
+               rl_get_screen_size(&rl_height,&rl_width);
+               R_SetOptionWidth(rl_width);
 #endif
             }
 #endif


I tried it out and it works perfectly here. Of course there should be
an option to switch this on and off but you get the idea. What do you
think?

Thanks,

Ralf


From vladimirpanfilov at gmail.com  Mon Aug 28 11:27:07 2017
From: vladimirpanfilov at gmail.com (=?UTF-8?B?0JLQu9Cw0LTQuNC80LjRgCDQn9Cw0L3RhNC40LvQvtCy?=)
Date: Mon, 28 Aug 2017 12:27:07 +0300
Subject: [Rd] =?utf-8?q?=5Bbug_report=5D_Cyrillic_letter_=22=D1=8F=22_inte?=
	=?utf-8?q?rrupts_script_execution_via_R_source_function?=
Message-ID: <CAP0xjkcG_Dkgd+WJ4bcrJnrywJPy9am02jeASqkfqmQ+YC0Ujw@mail.gmail.com>

Hello,

I do not have an account on R Bugzilla, so I will post my bug report here.
I want to report a very old bug in base R *source()* function. It relates
to sourcing some R scripts in UTF-8 encoding on Windows machines. For some
reason if the UTF-8 script is containing cyrillic letter *"?"*, the script
execution is interrupted directly on this letter (btw the same scripts are
sourcing fine when they are encoded in the systems CP1251 encoding).

Let's consider the following script that prints random russian words:


>
>
> *print("?????")print("????")print("???????")print("????")*


When this script is sourced we get INCOMPLETE_STRING error:


>
>
>
>
> *source('D:/R code/test_cyr_letter.R', encoding = 'UTF-8', echo=TRUE)Error
> in source("D:/R code/test_cyr_letter.R", encoding = "UTF-8", echo = TRUE)
> :   D:/R code/test_cyr_letter.R:3:7: unexpected INCOMPLETE_STRING2:
> print("????")3: print("??         ^*


Note that this bug is not triggered when the same file is executed using
*eval(parse(...))*:


>
>
>
> *> eval(parse('D:/R code/test_cyr_letter.R', encoding="UTF-8"))[1]
> "?????"[1] "????"[1] "???????"[1] "????"*


I made some reserach and noticed that *source* and *parse* functions have
similar parts of code for reading files. After analyzing code of *source()*
function I found out that commenting one line from it fixes this bug and
the overrided function works fine. See this part of *source()* function
code:

*... *
>
> *filename <- file*
>
> *        file <- file(filename, "r")*
>
> *        # on.exit(close(file))  #### COMMENT THIS LINE ####*
>
> *        if (isTRUE(keep.source)) {*
>
> *          lines <- scan(file, what="character", encoding = encoding, sep
>> = "\n")*
>
> *          on.exit()*
>
> *          close(file)*
>
> *          srcfile <- srcfilecopy(filename, lines,
>> file.mtime(filename)[1], *
>
> *                                 isFile = TRUE)*
>
> *        } *
>
> *...*
>
>
I do not fully understand this weird behaviour, so I ask help of R Core
developers to fix this annoying bug that prevents using unicode scripts
with cyrillic on Windows.
Maybe you should make that part of *source()* function read files like
*parse()* function?

*Session and encoding info:*

> > sessionInfo()
> R version 3.4.1 (2017-06-30)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 7 x64 (build 7601) Service Pack 1
> Matrix products: default
> locale:
> [1] LC_COLLATE=Russian_Russia.1251  LC_CTYPE=Russian_Russia.1251
>  LC_MONETARY=Russian_Russia.1251
> [4] LC_NUMERIC=C                    LC_TIME=Russian_Russia.1251
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> loaded via a namespace (and not attached):
> [1] compiler_3.4.1 tools_3.4.1



> > l10n_info()
> $MBCS
> [1] FALSE
> $`UTF-8`
> [1] FALSE
> $`Latin-1`
> [1] FALSE
> $codepage
> [1] 1251

From pperry at stern.nyu.edu  Mon Aug 28 14:24:31 2017
From: pperry at stern.nyu.edu (Patrick Perry)
Date: Mon, 28 Aug 2017 08:24:31 -0400
Subject: [Rd]
 =?utf-8?q?=5Bbug_report=5D_Cyrillic_letter_=22=D1=8F=22_inte?=
 =?utf-8?q?rrupts_script_execution_via_R_source_function?=
In-Reply-To: <CAP0xjkcG_Dkgd+WJ4bcrJnrywJPy9am02jeASqkfqmQ+YC0Ujw@mail.gmail.com>
References: <CAP0xjkcG_Dkgd+WJ4bcrJnrywJPy9am02jeASqkfqmQ+YC0Ujw@mail.gmail.com>
Message-ID: <59A40B7F.3050307@stern.nyu.edu>

My understanding (which could be wrong) is that when you source a file, 
it first gets translated to your native locale and then parsed. When you 
parse a character vector, it does not get translated.

In your locale, every "?" character  (U+044F) gets replaced by the byte 
"\xFF":

>  iconv("\u044f", "UTF-8", "Windows-1251")
[1] "\xff"

I suspect that particular value causes trouble for the R parser, which 
uses a stack of previously-seen characters (include/Defn.h):

LibExtern char    R_ParseContext[PARSE_CONTEXT_SIZE] INI_as("");

And at various places checks whether the context character is EOF. That 
character is defined as

#define R_EOF    -1

Which, when cast to a char, is 0xFF.

I suspect that your example is revealing two bugs:

1) The R parser seems to have trouble with native characters encoded as 
0xFF. It's possible that, since R strings can't contain 0x00, this can 
be fixed by changing the definition of R_EOF to

#define R_EOF     0


2) The other bug is that, as I understand the situation, "source" will 
fail if the file contains a character that cannot be represented in your 
native locale. This is a harder bug to tackle because of the way file() 
and the other connection methods are designed, where they translate the 
input to your native locale. I don't know if it's possible to override 
this behavior, and have them translate input to UTF-8 instead.



Patrick


---

On Mon Aug 28 11:27:07 CEST 2017 ???????? ???????? 
<vladimirpanfilov at gmail.com> wrote:

Hello,

I do not have an account on R Bugzilla, so I will post my bug report here.
I want to report a very old bug in base R *source()* function. It relates
to sourcing some R scripts in UTF-8 encoding on Windows machines. For some
reason if the UTF-8 script is containing cyrillic letter *"?"*, the script
execution is interrupted directly on this letter (btw the same scripts are
sourcing fine when they are encoded in the systems CP1251 encoding).

Let's consider the following script that prints random russian words:


>/
/>/
/>/  *print("?????")print("????")print("???????")print("????")*
/

When this script is sourced we get INCOMPLETE_STRING error:


>/
/>/
/>/
/>/
/>/  *source('D:/R code/test_cyr_letter.R', encoding = 'UTF-8', echo=TRUE)Error
/>/  in source("D:/R code/test_cyr_letter.R", encoding = "UTF-8", echo = TRUE)
/>/  :   D:/R code/test_cyr_letter.R:3:7: unexpected INCOMPLETE_STRING2:
/>/  print("????")3: print("??         ^*
/

Note that this bug is not triggered when the same file is executed using
*eval(parse(...))*:


>/
/>/
/>/
/>/  *>  eval(parse('D:/R code/test_cyr_letter.R', encoding="UTF-8"))[1]
/>/  "?????"[1] "????"[1] "???????"[1] "????"*
/

I made some reserach and noticed that *source* and *parse* functions have
similar parts of code for reading files. After analyzing code of *source()*
function I found out that commenting one line from it fixes this bug and
the overrided function works fine. See this part of *source()* function
code:

*... *
>/
/>/  *filename<- file*
/>/
/>/  *        file<- file(filename, "r")*
/>/
/>/  *        # on.exit(close(file))  #### COMMENT THIS LINE ####*
/>/
/>/  *        if (isTRUE(keep.source)) {*
/>/
/>/  *          lines<- scan(file, what="character", encoding = encoding, sep
/>>/  = "\n")*
/>/
/>/  *          on.exit()*
/>/
/>/  *          close(file)*
/>/
/>/  *          srcfile<- srcfilecopy(filename, lines,
/>>/  file.mtime(filename)[1], *
/>/
/>/  *                                 isFile = TRUE)*
/>/
/>/  *        } *
/>/
/>/  *...*
/>/
/>/
/I do not fully understand this weird behaviour, so I ask help of R Core
developers to fix this annoying bug that prevents using unicode scripts
with cyrillic on Windows.
Maybe you should make that part of *source()* function read files like
*parse()* function?

*Session and encoding info:*

>/  >  sessionInfo()
/>/  R version 3.4.1 (2017-06-30)
/>/  Platform: x86_64-w64-mingw32/x64 (64-bit)
/>/  Running under: Windows 7 x64 (build 7601) Service Pack 1
/>/  Matrix products: default
/>/  locale:
/>/  [1] LC_COLLATE=Russian_Russia.1251  LC_CTYPE=Russian_Russia.1251
/>/   LC_MONETARY=Russian_Russia.1251
/>/  [4] LC_NUMERIC=C                    LC_TIME=Russian_Russia.1251
/>/  attached base packages:
/>/  [1] stats     graphics  grDevices utils     datasets  methods   base
/>/  loaded via a namespace (and not attached):
/>/  [1] compiler_3.4.1 tools_3.4.1
/


>/  >  l10n_info()
/>/  $MBCS
/>/  [1] FALSE
/>/  $`UTF-8`
/>/  [1] FALSE
/>/  $`Latin-1`
/>/  [1] FALSE
/>/  $codepage
/>/  [1] 1251/



	[[alternative HTML version deleted]]


From henrik.bengtsson at gmail.com  Wed Aug 30 01:19:04 2017
From: henrik.bengtsson at gmail.com (Henrik Bengtsson)
Date: Tue, 29 Aug 2017 16:19:04 -0700
Subject: [Rd] BUG: HMTL-based help.search() on vignettes may generate error
	(with PATCH)
Message-ID: <CAFDcVCQgEvHhGFsRSt+tmg_kaW3F1=B_y-20KcsNW-DJGjx4Rw@mail.gmail.com>

REPRODUCIBLE EXAMPLE:

With the R.rsp package installed, the following search, which gives a hit:

    options(help_type = "html")
    help.search("rsp")

generates:

    Error in if (nchar(Outfile)) Outfile else File :
      argument is not interpretable as logical

in the browser (e.g. http://127.0.0.1:30410/doc/html/Search?results=1).

Another example is help.search("tm") with jsonlite installed.


TROUBLESHOOTING:

This occurs because utils:::merge_vignette_index() uses:

    base[, "Name"] <- sub("\\.[^.]*$", "", basename(vDB$File))
    base[, "Topic"] <- base[, "Name"]

which assumes that the 'Name' (and hence the 'Topic') can be inferred
from the basename of the vignette source file by dropping the filename
extension.  This assumption was valid in R (< 3.0.0), but with the
introduction of generic vignette engines, we may now have multiple
("nested") file-name extensions on vignette source files.  For
instance, vignette source file 'vignette.tex.rsp' outputs
'vignette.pdf'.  Another example is 'vignette.pdf.asis' that outputs
'vignette.pdf'.

Now, the assumption on a single file-name extension is still valid on
the vignette output product file, where we can only have file name
extensions *.pdf and *.html.  Because of this, a solution is to use
'basename(vDB$PDF)' instead of 'basename(vDB$File)'.  This is also
what tools:::httpd() uses internally and the difference between the
two approach is what causes the error in help.search() above.


PATCH:

A patch (against R-devel) is:

svn diff src/library/utils/R/help.search.R
Index: src/library/utils/R/help.search.R
===================================================================
--- src/library/utils/R/help.search.R (revision 73159)
+++ src/library/utils/R/help.search.R (working copy)
@@ -43,7 +43,7 @@
  base[, "LibPath"] <- path
  id <- as.character(1:nrow(vDB) + NROW(hDB[[1L]]))
  base[, "ID"] <- id
- base[, "Name"] <- sub("\\.[^.]*$", "", basename(vDB$File))
+ base[, "Name"] <- tools::file_path_sans_ext(basename(vDB$PDF))
  base[, "Topic"] <- base[, "Name"]
  base[, "Title"] <- vDB$Title
  base[, "Type"] <- "vignette"

I have verified that the above patch solves the problem.  I thought it
is ok to use tools::file_path_sans_ext() since other functions in
'utils' already do so.

I'm happy to submit this one via https://bugs.r-project.org/bugzilla3/ as well.


APPENDIX:

> sessionInfo()
R version 3.4.1 (2017-06-30)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 16.04.3 LTS

Matrix products: default
BLAS: /usr/lib/atlas-base/atlas/libblas.so.3.0
LAPACK: /usr/lib/atlas-base/atlas/liblapack.so.3.0

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] compiler_3.4.1

/Henrik


From luke-tierney at uiowa.edu  Thu Aug 31 00:01:42 2017
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Wed, 30 Aug 2017 17:01:42 -0500 (CDT)
Subject: [Rd] loop compilation problem
In-Reply-To: <alpine.DEB.2.20.1708241110230.2616@luke-Latitude>
References: <8EA1A94F-EB30-4AE0-A399-C9F73BC33EB5@oracle.com>
 <alpine.DEB.2.20.1708241110230.2616@luke-Latitude>
Message-ID: <alpine.DEB.2.20.1708301701220.2616@luke-Latitude>

What is happening here is that the compiler makes a legitimate
optimization, but that runs into a long-standing issue, not related to
compilation, with certain assignment expressions in arguments. The
general issue will take some time to address; hopefully it will be
resolved in time for the next major release. In the interim, to avoid
the particular discrepancy reported here the compiler has been
adjusted to not optimize assignments within argument expressions.
This adjustment is in R-devel (r73161) and R-patched (r73162).

Best,

luke

On Thu, 24 Aug 2017, luke-tierney at uiowa.edu wrote:

> Thanks.
>
> Here is a simplified version:
>
> library(compiler)
> zero <- 0
> one <- 1
> expr <- quote((z <- zero + one) + (z <- z + 1))
> eval(compiler::compile(expr))
>
> Sill fix shortly.
>
> Best,
>
> luke
>
> On Thu, 24 Aug 2017, Lukas Stadler wrote:
>
>> Hi!
>>
>> We?ve seen a problem with the compiler in specific cases of matrix 
> updates:
>>
>>> { m <- matrix(1:4, 2) ; z <- 0; for(i in 1) { m[z <- z + 1,z <- z + 1] <- 
> 99; } ; m }
>>     [,1] [,2]
>> [1,]    1    3
>> [2,]    2   99
>>
>> Here, it modifies element [2,2], which is unexpected.
>> It behaves correct without the loop:
>>
>>> { m <- matrix(1:4, 2) ; z <- 0; m[z <- z + 1,z <- z + 1] <- 99 ; m }
>>     [,1] [,2]
>> [1,]    1   99
>> [2,]    2    4
>>
>> ? and without the jit:
>>
>>> enableJIT(0)
>> [1] 3
>>> { m <- matrix(1:4, 2) ; z <- 0; for(i in 1) { m[z <- z + 1,z <- z + 1] <- 
> 99; } ; m }
>>     [,1] [,2]
>> [1,]    1   99
>> [2,]    2    4
>>
>> I checked with "R Under development (unstable) (2017-08-23 r73116)?, and 
> the problem is still there.
>>
>> - Lukas
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Luke Tierney
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu

From pd.mes at cbs.dk  Thu Aug 31 14:46:18 2017
From: pd.mes at cbs.dk (Peter Dalgaard)
Date: Thu, 31 Aug 2017 12:46:18 +0000
Subject: [Rd] R 3.4.2  scheduled for September 28
Message-ID: <C9C9C9EB-50D7-4656-A3E7-FA53A86BE199@cbs.dk>

Full schedule available on developer.r-project.org (pending auto-update from SVN)

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Office: A 4.23
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From _ at thomaslevine.com  Thu Aug 31 21:03:55 2017
From: _ at thomaslevine.com (Thomas Levine)
Date: Thu, 31 Aug 2017 19:03:55 +0000
Subject: [Rd] I have corrected a dead link in the treering documentation
In-Reply-To: <20170728185317.E246C7E65E@mailuser.nyi.internal>
References: <20170728185317.E246C7E65E@mailuser.nyi.internal>
Message-ID: <20170831190404.8B3117FA6A@mailuser.nyi.internal>

This dead link is still present in the svn HEAD.


From therneau at mayo.edu  Thu Aug 31 23:08:24 2017
From: therneau at mayo.edu (Therneau, Terry M., Ph.D.)
Date: Thu, 31 Aug 2017 16:08:24 -0500
Subject: [Rd] Missing y label
Message-ID: <9153c6$7s2gdm@ironport10.mayo.edu>

My on-screen plots with the latest build are acting strange.  If the y label is longer 
than some small value it is not shown.

Here is the script of a job.  A pdf graph is fine.  I use xubuntu as the windowing system.


tmt-local1334% R --vanilla

R Under development (unstable) (2017-08-31 r73172) -- "Unsuffered Consequences"
Copyright (C) 2017 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

   Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

 > sessionInfo()
R Under development (unstable) (2017-08-31 r73172)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 16.04.2 LTS

Matrix products: default
BLAS: /usr/local/src/R-devel/lib/libRblas.so
LAPACK: /usr/local/src/R-devel/lib/libRlapack.so

locale:
  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=C
  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods base

loaded via a namespace (and not attached):
[1] compiler_3.5.0
 > plot(1:5, 1:5, ylab="abcde")  # has a y label
 > plot(1:5, 1:5, ylab="abcdefghi")  # no label


From mcquesten at gmail.com  Thu Aug 31 23:38:27 2017
From: mcquesten at gmail.com (Paul McQuesten)
Date: Thu, 31 Aug 2017 16:38:27 -0500
Subject: [Rd] Natural vs National in R signon banner?
Message-ID: <CAN6Gc-2OHSQfs3c+Wyyf8xPUzfnRYMGhYQjrjvLMfD6TC6pc9Q@mail.gmail.com>

The R signon banner includes this statement:
     Natural language support but running in an English locale

Should that not say 'National' instead of 'Natural'?
Meaning that LOCALE support is enabled, not that the interface understands
human language?

Please ignore this and forgive me if this is an inappropriate post. I am a
N00B in R.

	[[alternative HTML version deleted]]


