From pauljohn32 at gmail.com  Wed Jun  1 01:59:45 2016
From: pauljohn32 at gmail.com (Paul Johnson)
Date: Tue, 31 May 2016 18:59:45 -0500
Subject: [Rd] Suggestion: pdf.options(embed=TRUE)
Message-ID: <CAErODj-UA62MUB4YAak-nAc9LwUy69csRa=aN+JRT9Hr1kDtPw@mail.gmail.com>

I learned last week that I generated a lot of PDFs and forgot to go
back and embed the fonts in them.

It would be very pleasant for me if pdf.options included an argument
to turn on font embedding and have fonts always embedded. Always.

Thanks for your time, as always.

-- 
Paul E. Johnson   http://pj.freefaculty.org
Director, Center for Research Methods and Data Analysis http://crmda.ku.edu

I only use this account for email list memberships. To write directly,
address me at pauljohn
at ku.edu.


From dwinsemius at comcast.net  Wed Jun  1 03:19:24 2016
From: dwinsemius at comcast.net (David Winsemius)
Date: Tue, 31 May 2016 18:19:24 -0700
Subject: [Rd] Suggestion: pdf.options(embed=TRUE)
In-Reply-To: <CAErODj-UA62MUB4YAak-nAc9LwUy69csRa=aN+JRT9Hr1kDtPw@mail.gmail.com>
References: <CAErODj-UA62MUB4YAak-nAc9LwUy69csRa=aN+JRT9Hr1kDtPw@mail.gmail.com>
Message-ID: <6FBB20FF-F376-4FC4-ACBF-14506528F560@comcast.net>


> On May 31, 2016, at 4:59 PM, Paul Johnson <pauljohn32 at gmail.com> wrote:
> 
> I learned last week that I generated a lot of PDFs and forgot to go
> back and embed the fonts in them.
> 
> It would be very pleasant for me if pdf.options included an argument
> to turn on font embedding and have fonts always embedded. Always.
> 
> Thanks for your time, as always.

I wondered if it would be fairly simple to use .Rprofile to overwrite `pdf` with your own version that sets the value of `fonts' to a call to `options` and then also set the options("pdf_embed")-value to your choice of font(s), possibly defaulting to the current values of `names(pdfFonts())`.

Looking at the code for `pdf`, however, I see that a call to `check.options` might require a mere complex set of parameters perhaps involving disabling the check on the fonts option value.

I ended up wondering if instead the function to modify might not be `grDevices:::initPSandPDFfonts`

-- 
David.
> 
> -- 
> Paul E. Johnson   http://pj.freefaculty.org
> Director, Center for Research Methods and Data Analysis http://crmda.ku.edu
> 
> I only use this account for email list memberships. To write directly,
> address me at pauljohn
> at ku.edu.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

David Winsemius
Alameda, CA, USA


From maechler at stat.math.ethz.ch  Wed Jun  1 15:07:10 2016
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 1 Jun 2016 15:07:10 +0200
Subject: [Rd] segfault / crash when asking for large memory via strrep()
In-Reply-To: <CAOwvMDz1u9SyF=FFe2K-Z88TY_D30g8rZC4KEjOVaOaMLHXh9Q@mail.gmail.com>
References: <CAOwvMDwWZTyhMPXwaw7zCKeXQ0S6ncuYOvLS2ReniSBNGV9yzg@mail.gmail.com>
	<loom.20160528T173936-714@post.gmane.org>
	<22345.51614.595312.481673@stat.math.ethz.ch>
	<CAOwvMDz1u9SyF=FFe2K-Z88TY_D30g8rZC4KEjOVaOaMLHXh9Q@mail.gmail.com>
Message-ID: <22350.56830.805199.781497@stat.math.ethz.ch>

We've had this more general topic on R-help,  and also in R-devel recently.
There's one case here where I get the feeling R never gets into
swapping but more directly aborts possibly from a bug we can
more easily fix.

Today I've been working (successfully! - not yet committed) at
fixing  str() for very large strings.

In this process, I've found that

   pc <- function(.) paste(., collapse=".1.2.3.4.5.")
   p  <- function(.) strrep(pc(.), 64L)
   p(p(p(p(LETTERS))))

produces a (memory related) segmentation fault (aka "crash")
very reproducibly and relatively quickly
both on my Linux (Fedora 22) desktop and on our Windows server.

 *** caught segfault ***
address 0x7fc52dc89000, cause 'memory not mapped'

Traceback:
 1: strrep(pc(.), 64L)
 2: p(p(p(p(LETTERS))))
 3: system.time(L2 <- p(p(p(p(LETTERS)))))

In the debugger, the symptoms point to the possibility of a
bug just in the C parts of strrep() :


Program received signal SIGSEGV, Segmentation fault.
0x00007ffff54d6223 in __strcpy_sse2_unaligned () from /usr/lib64/libc.so.6
Missing separate debuginfos, use: dnf debuginfo-install bzip2-libs-1.0.6-14.fc22.x86_64 libgcc-5.3.1-6.fc22.x86_64 libgfortran-5.3.1-6.fc22.x86_64 libgomp-5.3.1-6.fc22.x86_64 libicu-54.1-4.fc22.x86_64 libquadmath-5.3.1-6.fc22.x86_64 libstdc++-5.3.1-6.fc22.x86_64 ncurses-libs-5.9-18.20150214.fc22.x86_64 pcre-8.38-4.fc22.x86_64 readline-6.3-5.fc22.x86_64 xz-libs-5.2.0-2.fc22.x86_64 zlib-1.2.8-7.fc22.x86_64
(gdb) bt
#0  0x00007ffff54d6223 in __strcpy_sse2_unaligned () from /usr/lib64/libc.so.6
#1  0x0000000000457def in do_strrep (call=<optimized out>, op=<optimized out>, args=<optimized out>, 
    env=<optimized out>) at ../../../R/src/main/character.c:1658
#2  0x00000000004d6844 in bcEval (body=body at entry=0xd66840, rho=rho at entry=0x45253b8, 
    useCache=useCache at entry=TRUE) at ../../../R/src/main/eval.c:5648
#3  0x00000000004dd240 in Rf_eval (e=0xd66840, rho=0x45253b8) at ../../../R/src/main/eval.c:616
#4  0x00000000004dedaf in Rf_applyClosure (call=call at entry=0x45250a8, op=op at entry=0xd668e8, 
    arglist=0x45251f8, rho=rho at entry=0x4525000, suppliedvars=0xa57188)
    at ../../../R/src/main/eval.c:1134
#5  0x00000000004dd3b1 in Rf_eval (e=0x45250a8, rho=0x4525000) at ../../../R/src/main/eval.c:732
#6  0x00000000004dedaf in Rf_applyClosure (call=call at entry=0x4525718, op=op at entry=0x4524d28, 
    arglist=0x4524f90, rho=rho at entry=0xa8ea30, suppliedvars=0xa57188)
    at ../../../R/src/main/eval.c:1134
#7  0x00000000004dd3b1 in Rf_eval (e=0x4525718, rho=0xa8ea30) at ../../../R/src/main/eval.c:732
#8  0x00000000004e0cde in do_set (call=0x4525670, op=0xa61358, args=<optimized out>, rho=0xa8ea30)
    at ../../../R/src/main/eval.c:2196


From luke-tierney at uiowa.edu  Wed Jun  1 16:31:45 2016
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Wed, 1 Jun 2016 09:31:45 -0500
Subject: [Rd] segfault / crash when asking for large memory via strrep()
In-Reply-To: <22350.56830.805199.781497@stat.math.ethz.ch>
References: <CAOwvMDwWZTyhMPXwaw7zCKeXQ0S6ncuYOvLS2ReniSBNGV9yzg@mail.gmail.com>
	<loom.20160528T173936-714@post.gmane.org>
	<22345.51614.595312.481673@stat.math.ethz.ch>
	<CAOwvMDz1u9SyF=FFe2K-Z88TY_D30g8rZC4KEjOVaOaMLHXh9Q@mail.gmail.com>
	<22350.56830.805199.781497@stat.math.ethz.ch>
Message-ID: <alpine.DEB.2.10.1606010921590.2522@luke-Latitude>

That would be because the product nc * ni overflows in

     cbuf = buf = CallocCharBuf(nc * ni);

Since we disallow strings with more than 2^31-1 bytes we could test
and reject this. It might be more future-proof to change the
declaration of

     int j, ni, nc;

to

     R_xlen_t j, ni, nc;

and let the character allocation code reject, but that would create a
memory leak since the Free call isn't reached. This is a problem in
any case though, as

SET_STRING_ELT(s, is, markKnown(cbuf, STRING_ELT(x, ix)));

could throw errors for a number of reasons and then the Free() is not
reached. It would be better to use R_alloc or register a cleanup
function to call Free on a jump.

Best,

luke

On Wed, 1 Jun 2016, Martin Maechler wrote:

> We've had this more general topic on R-help,  and also in R-devel recently.
> There's one case here where I get the feeling R never gets into
> swapping but more directly aborts possibly from a bug we can
> more easily fix.
>
> Today I've been working (successfully! - not yet committed) at
> fixing  str() for very large strings.
>
> In this process, I've found that
>
>   pc <- function(.) paste(., collapse=".1.2.3.4.5.")
>   p  <- function(.) strrep(pc(.), 64L)
>   p(p(p(p(LETTERS))))
>
> produces a (memory related) segmentation fault (aka "crash")
> very reproducibly and relatively quickly
> both on my Linux (Fedora 22) desktop and on our Windows server.
>
> *** caught segfault ***
> address 0x7fc52dc89000, cause 'memory not mapped'
>
> Traceback:
> 1: strrep(pc(.), 64L)
> 2: p(p(p(p(LETTERS))))
> 3: system.time(L2 <- p(p(p(p(LETTERS)))))
>
> In the debugger, the symptoms point to the possibility of a
> bug just in the C parts of strrep() :
>
>
> Program received signal SIGSEGV, Segmentation fault.
> 0x00007ffff54d6223 in __strcpy_sse2_unaligned () from /usr/lib64/libc.so.6
> Missing separate debuginfos, use: dnf debuginfo-install bzip2-libs-1.0.6-14.fc22.x86_64 libgcc-5.3.1-6.fc22.x86_64 libgfortran-5.3.1-6.fc22.x86_64 libgomp-5.3.1-6.fc22.x86_64 libicu-54.1-4.fc22.x86_64 libquadmath-5.3.1-6.fc22.x86_64 libstdc++-5.3.1-6.fc22.x86_64 ncurses-libs-5.9-18.20150214.fc22.x86_64 pcre-8.38-4.fc22.x86_64 readline-6.3-5.fc22.x86_64 xz-libs-5.2.0-2.fc22.x86_64 zlib-1.2.8-7.fc22.x86_64
> (gdb) bt
> #0  0x00007ffff54d6223 in __strcpy_sse2_unaligned () from /usr/lib64/libc.so.6
> #1  0x0000000000457def in do_strrep (call=<optimized out>, op=<optimized out>, args=<optimized out>,
>    env=<optimized out>) at ../../../R/src/main/character.c:1658
> #2  0x00000000004d6844 in bcEval (body=body at entry=0xd66840, rho=rho at entry=0x45253b8,
>    useCache=useCache at entry=TRUE) at ../../../R/src/main/eval.c:5648
> #3  0x00000000004dd240 in Rf_eval (e=0xd66840, rho=0x45253b8) at ../../../R/src/main/eval.c:616
> #4  0x00000000004dedaf in Rf_applyClosure (call=call at entry=0x45250a8, op=op at entry=0xd668e8,
>    arglist=0x45251f8, rho=rho at entry=0x4525000, suppliedvars=0xa57188)
>    at ../../../R/src/main/eval.c:1134
> #5  0x00000000004dd3b1 in Rf_eval (e=0x45250a8, rho=0x4525000) at ../../../R/src/main/eval.c:732
> #6  0x00000000004dedaf in Rf_applyClosure (call=call at entry=0x4525718, op=op at entry=0x4524d28,
>    arglist=0x4524f90, rho=rho at entry=0xa8ea30, suppliedvars=0xa57188)
>    at ../../../R/src/main/eval.c:1134
> #7  0x00000000004dd3b1 in Rf_eval (e=0x4525718, rho=0xa8ea30) at ../../../R/src/main/eval.c:732
> #8  0x00000000004e0cde in do_set (call=0x4525670, op=0xa61358, args=<optimized out>, rho=0xa8ea30)
>    at ../../../R/src/main/eval.c:2196
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From luke-tierney at uiowa.edu  Wed Jun  1 20:38:34 2016
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Wed, 1 Jun 2016 13:38:34 -0500
Subject: [Rd] segfault / crash when asking for large memory via strrep()
In-Reply-To: <alpine.DEB.2.10.1606010921590.2522@luke-Latitude>
References: <CAOwvMDwWZTyhMPXwaw7zCKeXQ0S6ncuYOvLS2ReniSBNGV9yzg@mail.gmail.com>
	<loom.20160528T173936-714@post.gmane.org>
	<22345.51614.595312.481673@stat.math.ethz.ch>
	<CAOwvMDz1u9SyF=FFe2K-Z88TY_D30g8rZC4KEjOVaOaMLHXh9Q@mail.gmail.com>
	<22350.56830.805199.781497@stat.math.ethz.ch>
	<alpine.DEB.2.10.1606010921590.2522@luke-Latitude>
Message-ID: <alpine.DEB.2.10.1606011336380.2522@luke-Latitude>

I've added a size/overflow check before the buffer allocation in
R-devel and R-patched.

It would be a good idea sometime to review the use of

calloc
...
free

patterns to make sure the ... can't raise an error or otherwise jump
and leave the memory pointer dangling.

Best,

luke

On Wed, 1 Jun 2016, luke-tierney at uiowa.edu wrote:

> That would be because the product nc * ni overflows in
>
>    cbuf = buf = CallocCharBuf(nc * ni);
>
> Since we disallow strings with more than 2^31-1 bytes we could test
> and reject this. It might be more future-proof to change the
> declaration of
>
>    int j, ni, nc;
>
> to
>
>    R_xlen_t j, ni, nc;
>
> and let the character allocation code reject, but that would create a
> memory leak since the Free call isn't reached. This is a problem in
> any case though, as
>
> SET_STRING_ELT(s, is, markKnown(cbuf, STRING_ELT(x, ix)));
>
> could throw errors for a number of reasons and then the Free() is not
> reached. It would be better to use R_alloc or register a cleanup
> function to call Free on a jump.
>
> Best,
>
> luke
>
> On Wed, 1 Jun 2016, Martin Maechler wrote:
>
>> We've had this more general topic on R-help,  and also in R-devel 
>> recently.
>> There's one case here where I get the feeling R never gets into
>> swapping but more directly aborts possibly from a bug we can
>> more easily fix.
>> 
>> Today I've been working (successfully! - not yet committed) at
>> fixing  str() for very large strings.
>> 
>> In this process, I've found that
>>
>>   pc <- function(.) paste(., collapse=".1.2.3.4.5.")
>>   p  <- function(.) strrep(pc(.), 64L)
>>   p(p(p(p(LETTERS))))
>> 
>> produces a (memory related) segmentation fault (aka "crash")
>> very reproducibly and relatively quickly
>> both on my Linux (Fedora 22) desktop and on our Windows server.
>> 
>> *** caught segfault ***
>> address 0x7fc52dc89000, cause 'memory not mapped'
>> 
>> Traceback:
>> 1: strrep(pc(.), 64L)
>> 2: p(p(p(p(LETTERS))))
>> 3: system.time(L2 <- p(p(p(p(LETTERS)))))
>> 
>> In the debugger, the symptoms point to the possibility of a
>> bug just in the C parts of strrep() :
>> 
>> 
>> Program received signal SIGSEGV, Segmentation fault.
>> 0x00007ffff54d6223 in __strcpy_sse2_unaligned () from 
>> /usr/lib64/libc.so.6
>> Missing separate debuginfos, use: dnf debuginfo-install 
>> bzip2-libs-1.0.6-14.fc22.x86_64 libgcc-5.3.1-6.fc22.x86_64 
>> libgfortran-5.3.1-6.fc22.x86_64 libgomp-5.3.1-6.fc22.x86_64 
>> libicu-54.1-4.fc22.x86_64 libquadmath-5.3.1-6.fc22.x86_64 
>> libstdc++-5.3.1-6.fc22.x86_64 ncurses-libs-5.9-18.20150214.fc22.x86_64 
>> pcre-8.38-4.fc22.x86_64 readline-6.3-5.fc22.x86_64 
>> xz-libs-5.2.0-2.fc22.x86_64 zlib-1.2.8-7.fc22.x86_64
>> (gdb) bt
>> #0  0x00007ffff54d6223 in __strcpy_sse2_unaligned () from 
>> /usr/lib64/libc.so.6
>> #1  0x0000000000457def in do_strrep (call=<optimized out>, op=<optimized 
>> out>, args=<optimized out>,
>>    env=<optimized out>) at ../../../R/src/main/character.c:1658
>> #2  0x00000000004d6844 in bcEval (body=body at entry=0xd66840, 
>> rho=rho at entry=0x45253b8,
>>    useCache=useCache at entry=TRUE) at ../../../R/src/main/eval.c:5648
>> #3  0x00000000004dd240 in Rf_eval (e=0xd66840, rho=0x45253b8) at 
>> ../../../R/src/main/eval.c:616
>> #4  0x00000000004dedaf in Rf_applyClosure (call=call at entry=0x45250a8, 
>> op=op at entry=0xd668e8,
>>    arglist=0x45251f8, rho=rho at entry=0x4525000, suppliedvars=0xa57188)
>>    at ../../../R/src/main/eval.c:1134
>> #5  0x00000000004dd3b1 in Rf_eval (e=0x45250a8, rho=0x4525000) at 
>> ../../../R/src/main/eval.c:732
>> #6  0x00000000004dedaf in Rf_applyClosure (call=call at entry=0x4525718, 
>> op=op at entry=0x4524d28,
>>    arglist=0x4524f90, rho=rho at entry=0xa8ea30, suppliedvars=0xa57188)
>>    at ../../../R/src/main/eval.c:1134
>> #7  0x00000000004dd3b1 in Rf_eval (e=0x4525718, rho=0xa8ea30) at 
>> ../../../R/src/main/eval.c:732
>> #8  0x00000000004e0cde in do_set (call=0x4525670, op=0xa61358, 
>> args=<optimized out>, rho=0xa8ea30)
>>    at ../../../R/src/main/eval.c:2196
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>
>

-- 
Luke Tierney
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From lexcarvalho at gmail.com  Thu Jun  2 04:25:28 2016
From: lexcarvalho at gmail.com (Luis Carvalho)
Date: Wed, 1 Jun 2016 22:25:28 -0400
Subject: [Rd] [RfC] Family dispersion
Message-ID: <20160602022528.GA17181@debian>

Hi,

I'd like to hear your opinion about the following proposal to make the
computation of dispersion in GLMs more flexible. Dispersion is used in
summary.glm; the relevant code chunk with the dispersion calculation is listed
below (from glm.R):


summary.glm <- function(object, dispersion = NULL,
			correlation = FALSE, symbolic.cor = FALSE, ...)
{
  est.disp <- FALSE
  df.r <- object$df.residual
  if(is.null(dispersion))	# calculate dispersion if needed
    dispersion <-
      if(object$family$family %in% c("poisson", "binomial"))  1
      else if(df.r > 0) {
        est.disp <- TRUE
        if(any(object$weights==0))
          warning("observations with zero weight not used for calculating dispersion")
        sum((object$weights*object$residuals^2)[object$weights > 0])/ df.r
      } else {
        est.disp <- TRUE
        NaN
      }
  # ...
}


Many exponential families have unit dispersion, or can be cast to have unit
dispersion, e.g. hypergeometric, negative binomial, and so on. However,
summary.glm only assigns unit dispersion to Poisson and binomial families, as
the code above indicates. My suggestion is to make this check more general by
having a 'dispersion' slot in the family class; for instance, we would have
poisson(...)$dispersion = 1 and binomial(...)$dispersion = 1. The updated
summary.glm would be:


default.dispersion <- function (object, ...) {
  df.r <- object$df.residual
  if (df.r > 0) {
    if (any(object$weights == 0))
      warning("observations with zero weight not used for calculating dispersion")
    sum((object$weights * object$residuals ^ 2)[object$weights > 0]) / df.r
  }
  else NaN
}

summary.glm <- function(object, dispersion = default.dispersion,
			correlation = FALSE, symbolic.cor = FALSE, ...)
{
  if (!is.null(object$family$dispersion)) # use family dispersion?
    dispersion <- object$family$dispersion
  est.disp <- is.function(dispersion)
  dispersion <- if (est.disp) dispersion(object, ...) else dispersion

  df.r <- object$df.residual
  # ... (unchanged code below)
}


Note that 'dispersion' can be a function taking a glm object or a number
(e.g. 1). Here are some examples:

R> library(MASS)
R> gm <- glm(formula, family=Gamma())
R> summary(gm, dispersion = gamma.dispersion) # ML estimate of dispersion

R> set.dispersion <- function (fam, disp) # update family dispersion
R>   structure(within(unclass(fam), dispersion <- disp), class = "family")
R> gm <- glm(formula, family=set.dispersion(Gamma(), gamma.dispersion))
R> summary(gm) # use family dispersion
R> Exp <- function (...) set.dispersion(Gamma(...), 1)

Thanks in advance for the feedback.

Cheers,
Luis


-- 
Computers are useless. They can only give you answers.
                -- Pablo Picasso

-- 
Luis Carvalho
Associate Professor
Dept. of Mathematics and Statistics
Boston University
http://math.bu.edu/people/lecarval


From suharto_anggono at yahoo.com  Fri Jun  3 21:13:11 2016
From: suharto_anggono at yahoo.com (Suharto Anggono Suharto Anggono)
Date: Fri, 3 Jun 2016 19:13:11 +0000 (UTC)
Subject: [Rd] complex NA's match(),
 etc: not back-compatible change proposal
References: <1365929142.898558.1464981191452.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <1365929142.898558.1464981191452.JavaMail.yahoo@mail.yahoo.com>

With 'z' of length 8 below, or of length 12 previously, one may try
sapply(rev(z), match, table = rev(z))
match(rev(z), rev(z))

I found that the two results were different in R devel r70604.

A shorter one:

> z <- complex(real = c(0,NaN,NaN), imaginary = c(NA,NA,0))
> sapply(z, match, table = z)
[1] 1 1 2
> match(z, z)
[1] 1 1 3

An explanation of the behavior: With normal equality, if z[2] is equal to z[1] and z[3] is not equal to z[1], z[3] is not equal to z[2]. It is not the case here with 'cequal'. However, it seems that the property is assumed in usual case of 'match'.

For it, just changing 'cequal' so that a complex number that has both NA and NaN matches NA and doesn't match NaN is enough. It also makes length(unique(.)) not order-dependent.

For more change, I am fine with '1 A'.
--------------------------------------------
On Mon, 30/5/16, Martin Maechler <maechler at stat.math.ethz.ch> wrote:

 Subject: Re: [Rd] complex NA's match(), etc: not back-compatible change proposal

 Cc: R-devel at r-project.org
 Date: Monday, 30 May, 2016, 5:48 PM

 >>>>> Suharto Anggono

 >>>>>? ???on Sat, 28 May
 2016 09:34:08 +0000 writes:

 ? ? > On 'factor', I meant the case where
 'levels' is not
 ? ? > specified, where 'unique' is called.

 I see, thank you.
 ? ? 
 ? ? >> factor(c(complex(real=NaN),
 complex(imaginary=NaN)))
 ? ? > [1] NaN+0i <NA>
 ? ? > Levels: NaN+0i

 ? ? > Look at <NA> in the result above.
 Yes, it happens in
 ? ? > earlier versions of R, too.

 Yes; let's call this "problem 1"

 ? ? > On matching both NA and NaN, another
 consequence is that
 ? ? > length(unique(.)) may depend on order. 
 ? ? > Example using R devel r70604:

 ? ? >> x0 <- c(0,1, NA, NaN); z <-
 outer(x0,x0, complex, length.out=1); rm(x0)
 ? ? >> (z <- z[is.na(z)])
 ? ? > [1]? ? ???NA
 NaN+? 0i? ? ???NA NaN+?
 1i? ? ???NA? ?
 ???NA? ? ???NA?
 ? ???NA
 ? ? >
 [9]???0+NaNi???1+NaNi?
 ? ???NA NaN+NaNi
 ? ? >> length(print(unique(z)))
 ? ? > [1]? ???NA NaN+0i
 ? ? > [1] 2
 ? ? >> length(print(unique(c(z[8],
 z[-8]))))
 ? ? > [1] NA
 ? ? > [1] 1
 ? ? >
 --------------------------------------------

 Thank you, Suharto. I agree these are even more convincing
 reasons to consider changing.
 Let's call this ("matching both NA and NaN")? "problem
 2".

 I think we agree that the R-devel -- comparted to previous
 versions -- *is* consistent in its (C level) functions
 cequal()
 and? chash() and also is consistent with the
 documentation
 of match()/unique()/duplicated().

 Hence I think a change would have to affect all of the
 above,
 including a change of documentation.

 Also, resolution of "problem 1" and "problem 2" are related,
 but
 --I think-- almost separate.
 For the following, let's use a vector notation for complex
 numbers, say
 ? ? (a, b) :== complex(real = a, imaginary = b)

 With R? (showing relevant examples):
 ##------------------------------------------------------------------------------
 options(width = max(85, getOption("width"))) # so 'z' prints
 in one line
 p.z <- function(z)
 print(noquote(paste0("(",Re(z),",",Im(z),")")))
 z <- c(1,NA,NaN); z <- outer(z,z, complex,
 length.out=1); (z <- z[is.na(z)])
 ##? ???NA NaN+? 1i? ?
 ???NA? ? ???NA?
 ? ???NA???1+NaNi?
 ? ???NA NaN+NaNi
 p.z(z)
 ##? (NA,1)? (NaN,1)? (1,NA)?
 (NA,NA)? (NaN,NA)? (1,NaN)? (NA,NaN)?
 (NaN,NaN)
 length(p.z(unique(z[ 1:8 ])))
 ## [1] (NA,1)? (NaN,1)
 ## [1] 2
 length(p.z(unique(z[ c(8,1:7) ])))
 ## [1] (NaN,NaN) (NA,1)
 ## [1] 2
 length(p.z(unique(z[ c(7:8,1:6) ])))
 ## [1] (NA,NaN)
 ## [1] 1
 ##------------------------------------------------------------------------------

 Problem 1:
 ? To me, at the moment, it would seem most "natural" to
 consider a
 ? change where the match()/unique()/duplicated()?
 behavior? matched
 ? the behavior of print()/format()/as.character()?
 for such
 ? complex vectors.
 ? I think this would automatically solve the issue that
 sometimes

 ??? length(unique(as.character(x))) >
 length(unique(x))

 ? The are principally two solutions to this:

 ? A: change? match()/unique()/duplicated()
 ? B: change? print()/format()/as.character()
 ? 
 ? For A -- which seems "less disruptive" and more
 desirable to
 ? me -- we would have to change cequal() {and chash()!}
 and say
 ? that complex numbers with NA|NaN? "match" if
 they have any NA, but
 ? otherwise, both the regular (r,i) and the NaN must be
 at the
 ? exact same places (and *different* NaNs should match,
 of course).


 Problem 2:???unique(z[i])? depends on
 the permutation 'i'

 ? What should a change be here ...? notably after
 the "proposed"
 ? (rather only "considered") change???'1
 A' above ?

 ? Can "the" new behavior easily be described in words
 (if '1 A'
 ? above is already assumed)?

 At the moment, I would not tackle Problem 2.
 It would become less problematic once? Problem 1 is
 solved
 according to '1 A', because it least? length(unique(.))
 would
 not change:? It would contain *one* z[] with an NA, and
 all the
 other z[]s.

 Opinions ?? Thank you in advance for chiming in..

 Martin Maechler,
 ETH Zurich

 ? ? > On Mon, 23/5/16, Martin Maechler <maechler at stat.math.ethz.ch>
 wrote:

 ? ? > Subject: Re: [Rd] complex NA's match(),
 etc: not back-compatible change proposal

 ? ? > Cc: R-devel at r-project.org
 ? ? > Date: Monday, 23 May, 2016, 11:06 PM

 ? ? >>>>>> 
 ? ? > Suharto Anggono Suharto Anggono via
 R-devel <r-devel at r-project.org>
 ? ? >>>>>> ? ???on Fri, 13
 ? ? > May 2016 16:33:05 +0000 writes:

 ? ? > ? ? > That, for example,
 complex(real=NaN)
 ? ? > and complex(imaginary=NaN) are regarded
 as equal makes it
 ? ? > possible that 

 ? ? > ? ? >?
 ? ? > length(unique(as.character(x))) >
 length(unique(x)) 

 ? ? > ? ? > (current code of
 ? ? > function 'factor' doesn't expect it). 

 ? ? > Thank you, that is an
 ? ? > interesting remark - but is already
 true,
 ? ? > in
 ? ? > [[elided Yahoo spam]]

 ? ? > ..
 ? ? > and of course this is because we do
 ? ? > *print*???0+NaNi? etc,
 ? ? > i.e., we
 ? ? > differentiate the? non-NA-but-NaN
 complex values in
 ? ? > formatting / printing but not in
 match(),
 ? ? > unique() ...

 ? ? > and indeed,
 ? ? > with the? 'z'? example below,
 ? ? > ?
 ? ? > fz <- factor(z,z)
 ? ? > gives a warnings about
 ? ? > duplicated levels and gives such
 warnings
 ? ? > also in current (and previous) versions
 of R,
 ? ? > at least for the slightly
 ? ? > larger z?
 ? ? > I've used in the tests/reg-tests-1c.R
 example.

 ? ? > For the moment I can live with
 ? ? > that warning, as I don't think
 ? ? > factor()s
 ? ? > are constructed from complex numbers
 "often"...
 ? ? > and the performance of factor() in the
 more
 ? ? > regular cases is important.

 ? ? >> Yes, an argument for the behavior is
 that
 ? ? > NA and NaN are of one kind.
 ? ? >> On my
 ? ? > system, using 32-bit R for Windows from
 binary from CRAN,
 ? ? > the result of sapply(z, match, table = z)
 (not in current
 ? ? > R-devel) may be different from below:
 ? ? > ? ?
 ? ? >> 1 2 3 4 1 3 7 8 2 4 8 12? # R
 2.10.1, different from
 ? ? > below
 ? ? > ? ? > 1 2 3 4 1 3 7 8 2 4 8 12?
 ? ? > # R 3.2.5, different from below

 ? ? > interesting, thank you... and another
 reason
 ? ? > why the change
 ? ? > (currently only in R-devel)
 ? ? > may have been a good one: More
 uniformity.

 ? ? > ? ? > I noticed that, by
 ? ? > function 'cequal' in unique.c, a complex
 number that
 ? ? > has both NA and NaN matches NA and also
 matches NaN.

 ? ? > ? ? >> x0 <- c(0,1,
 ? ? > NA, NaN); z <- outer(x0,x0, complex,
 length.out=1);
 ? ? > rm(x0)
 ? ? > ? ? >> (z <-
 ? ? > z[is.na(z)])
 ? ? > ? ? > [1]? ?
 ? ? > ???NA NaN+? 0i? ? ???NA NaN+?
 1i?
 ? ? > ? ???NA? ? ???NA? ?
 ? ? > ???NA? ? ???NA
 ? ? > ? ?
 ? ? >> [9]???0+NaNi???1+NaNi? ?
 ? ? > ???NA NaN+NaNi

 ? ? > ? ? >> sapply(z, match, table =
 ? ? > z[8])
 ? ? > ? ? > [1] 1 1 1 1 1 1 1 1 1 1 1
 ? ? > 1
 ? ? > ? ? >> match(z, z[8])
 ? ? > ? ? > [1] 1 1 1 1 1 1 1 1 1 1 1 1

 ? ? > Yes, I see the same. But is
 ? ? > n't it what we expect:

 ? ? > All of our z[] entries has at least one
 NA or a
 ? ? > NaN in its real
 ? ? > or imaginary, and since z[8]
 ? ? > has both, it does match with all
 ? ? > z[]'s
 ? ? > either because of the NA or because of
 the NaN in common.

 ? ? > Hence, currently, I don't
 ? ? > think this needs to be changed...
 ? ? > but if
 ? ? > there are other reasons / arguments ...

 ? ? > Thank you again,
 ? ? > Martin
 ? ? > Maechler


 ? ? > ? ? >> sessionInfo()
 ? ? > ?
 ? ? > ? > R Under development (unstable)
 (2016-05-12
 ? ? > r70604)
 ? ? > ? ? > Platform:
 ? ? > i386-w64-mingw32/i386 (32-bit)
 ? ? > ? ? >
 ? ? > Running under: Windows XP (build 2600)
 Service Pack 2

 ? ? > ? ? > locale:
 ? ? > ? ? > [1] LC_COLLATE=English_United
 ? ? > States.1252
 ? ? > ? ? > [2]
 ? ? > LC_CTYPE=English_United States.1252
 ? ? > ? ?
 ? ? >> [3] LC_MONETARY=English_United
 States.1252
 ? ? > ? ? > [4] LC_NUMERIC=C
 ? ? > ?
 ? ? > ? > [5] LC_TIME=English_United
 States.1252

 ? ? > ? ? > attached base
 ? ? > packages:
 ? ? > ? ? > [1] stats?
 ? ? > ???graphics? grDevices utils?
 ? ? > ???datasets? methods???base

 ? ? > ? ? >
 ? ? > -----------------
 ? ? >>>>>> 
 ? ? > Martin Maechler <maechler at
 stat.math.ethz.ch>
 ? ? >>>>>> ? ???on Tue, 10
 ? ? > May 2016 16:08:39 +0200 writes:

 ? ? > ? ? >> This is an RFC /
 announcement
 ? ? > related to the 2nd part of PR#16885
 ? ? > ? ?
 ? ? >>> https://bugs.r-project.org/bugzilla/show_bug.cgi?id=16885
 ? ? > ? ? >> about? complex NA's.

 ? ? > ? ? >> The (somewhat
 ? ? > rare) incompatibility in R's 3.3.0
 match() behavior for
 ? ? > the
 ? ? > ? ? >> case of complex numbers
 ? ? > with NA & NaN's {which has been fixed
 for R 3.3.0
 ? ? > ? ? >> patched in the mean time}
 ? ? > triggered some more comprehensive
 "research".

 ? ? > ? ? >> I found that we
 ? ? > have had a long-standing inconsistency at
 least between
 ? ? > the
 ? ? > ? ? >> documented and the real
 ? ? > behavior.? I am claiming that the
 documented
 ? ? > ? ? >> behavior is desirable and
 hence
 ? ? > R's current "real" behavior is bugous,
 and
 ? ? > ? ? >> I am proposing to change
 it, in
 ? ? > R-devel (to be 3.4.0) for now.

 ? ? > ? ? > After the? "roaring
 ? ? > unanimous" assent? (one private msg
 ? ? > ?
 ? ? > ? > encouraging me to go forward, no
 dissenting voice,
 ? ? > hence an
 ? ? > ? ? > "odds ratio"
 ? ? > of? +Inf? in favor ;-)

 ? ? > ?
 ? ? > ? > I have now committed my proposal
 to R-devel (svn
 ? ? > rev. 70597) and
 ? ? > ? ? > some of us will
 ? ? > be seeing the effect in package space
 within a
 ? ? > ? ? > day or so, in the CRAN checks
 ? ? > against R-devel (not for
 ? ? > ? ? >
 ? ? > bioconductor AFAIK; their checks using
 R-devel only when it
 ? ? > less
 ? ? > ? ? > than ca 6 months from
 ? ? > release).

 ? ? > ? ? >
 ? ? > It's still worthwhile to discuss the
 issue, if you come
 ? ? > late
 ? ? > ? ? > to it, notably as
 ? ? > ---paraphrasing Dirk on the
 R-package-devel list---
 ? ? > ? ? > the release of 3.4.0 is almost
 a
 ? ? > year away, and so now is the
 ? ? > ? ? > best
 ? ? > time to tinker with the API, in other
 words, consider
 ? ? > breaking
 ? ? > ? ? > rarely used legacy
 ? ? > APIs..

 ? ? > ? ? > Martin


 ? ? > ? ?
 ? ? >>> In help(match) we have been
 saying

 ? ? > ? ? >> |? Exactly
 ? ? > what matches what is to some extent a
 matter of
 ? ? > definition.
 ? ? > ? ? >> |? For all
 ? ? > types, \code{NA} matches \code{NA} and no
 other value.
 ? ? > ? ? >> |? For real and complex
 values,
 ? ? > \code{NaN} values are regarded
 ? ? > ? ?
 ? ? >>> |? as matching any other
 \code{NaN} value, but not
 ? ? > matching \code{NA}.

 ? ? > ? ?
 ? ? >>> for at least 10 years.? But we
 don't do that
 ? ? > at all in the
 ? ? > ? ? >> complex case
 ? ? > (and AFAIK never got a bug report about
 it).

 ? ? > ? ? >> Also, e.g.,
 ? ? > print(.) or format(.) do simply use?
 "NA" for
 ? ? > all
 ? ? > ? ? >> the different complex
 ? ? > NA-containing numbers, where OTOH,
 ? ? > ? ?
 ? ? >>> non-NA NaN's { <=>?
 !is.nan(z) &
 ? ? > is.na(z) }
 ? ? > ? ? >> in format() or
 ? ? > print() do show the NaN in real and/or
 imaginary
 ? ? > ? ? >> parts; for an example,
 look at
 ? ? > the "format" column of the matrix
 ? ? > ? ? >> below, after
 ? ? > 'print(cbind' ...

 ? ? > ? ? >> The current match()---and
 ? ? > duplicated(), unique() which are based on
 the same
 ? ? > ? ? >> C code---*do* distinguish
 almost
 ? ? > all complex NA / NaN's which is
 ? ? > ? ?
 ? ? >>> NOT according to documentation. I
 have found that
 ? ? > this is just because of 
 ? ? > ? ? >> of
 ? ? > our hashing function for the complex
 case, chash() in
 ? ? > R/src/main/unique.c,
 ? ? > ? ? >> is
 ? ? > bogous in the sense that it is not
 compatible with the above
 ? ? > documentation
 ? ? > ? ? >> and also not
 ? ? > with the cequal() function (in the same
 file uniqu.c) for
 ? ? > checking
 ? ? > ? ? >> equality of complex
 ? ? > numbers.

 ? ? > ? ? >> As
 ? ? > I have found,, a *simplified* version of
 the chash()
 ? ? > function
 ? ? > ? ? >> to make it
 ? ? > compatible with cequal() does solve all
 the problems
 ? ? > I've
 ? ? > ? ? >> indicated,? and the
 ? ? > current plan is to commit that change ---
 after some
 ? ? > ? ? >> discussion time, here on
 R-devel
 ? ? > ---? to the code base.

 ? ? > ?
 ? ? > ? >> My change passes? 'make
 check-all'
 ? ? > fine, but I'm 100% sure that there will
 ? ? > ? ? >> be effects in
 package-space. ...
 ? ? > one reason for this posting.

 ? ? > ? ? >> As mentioned above, note
 that
 ? ? > the chash() function has been in
 ? ? > ? ?
 ? ? >>> use for all three functions
 ? ? > ? ?
 ? ? >>> match()
 ? ? > ? ? >>
 ? ? > duplicated()
 ? ? > ? ? >> unique()
 ? ? > ? ? >> and the change will affect
 all
 ? ? > three --- but just for the case of
 complex
 ? ? > ? ? >> vectors with NA or NaN's.

 ? ? > ? ? >> To show more, a
 ? ? > small R session -- using my version of
 R-devel
 ? ? > ? ? >> == the proposition: 
 ? ? > ? ? >> The R script
 ? ? > ('complex-NA-short.R') for (a bit more
 than) the
 ? ? > ? ? >> session is attached {{you
 can
 ? ? > attach? text/plain easily}}:

 ? ? > ? ? >>> x0 <- c(0,1, NA,
 NaN); z
 ? ? > <- outer(x0,x0, complex,
 length.out=1); rm(x0)
 ? ? > ? ? >>> ##? ? ? ?
 ? ? > ???--- = NA_real_? but that does not
 exist e.g.,
 ? ? > in R 2.3.1
 ? ? > ? ? >>> ##? ? ? ?
 ? ? > ? ? ? ? ???similarly,? '1L',
 ? ? > '2L', .. do not exist e.g., in R 2.3.1
 ? ? > ? ? >>> (z <- z[is.na(z)])
 ? ? > ? ? >> [1]? ? ???NA NaN+?
 ? ? > 0i? ? ???NA NaN+? 1i? ?
 ???NA?
 ? ? > ? ???NA? ? ???NA? ?
 ? ? > ???NA
 ? ? > ? ? >>
 ? ? > [9]???0+NaNi???1+NaNi? ?
 ? ? > ???NA NaN+NaNi
 ? ? > ? ? >>>
 ? ? > outerID <- function(x,y, ...) { ##
 ugly; can we get
 ? ? > outer() to work ?
 ? ? > ? ? >> +?
 ? ? > ???r <- matrix( , length(x),
 length(y))
 ? ? > ? ? >> +? ???for(i in
 ? ? > seq(along=x))
 ? ? > ? ? >> +? ? ?
 ? ? > ???for(j in seq(along=y))
 ? ? > ? ?
 ? ? >>> +? ? ? ? ? ???r[i,j]
 <-
 ? ? > identical(z[i], z[j], ...)
 ? ? > ? ? >>
 ? ? > +? ???r
 ? ? > ? ? >> + }
 ? ? > ? ? >>> ## Very strictly - in
 the
 ? ? > sense of identical() -- these 12 complex
 numbers all
 ? ? > differ:
 ? ? > ? ? >>> ## a version that
 ? ? > works in older versions of R, where
 identical() had fewer
[[elided Yahoo spam]]
 ? ? > ? ? >>> outerID.picky
 ? ? > <- function(x,y) {
 ? ? > ? ? >> +?
 ? ? > ???nF <- length(formals(identical))
 - 2
 ? ? > ? ? >> +?
 ? ? > ???do.call("outerID", c(list(x, y),
 ? ? > as.list(rep(FALSE, nF))))
 ? ? > ? ? >> +
 ? ? > }
 ? ? > ? ? >>> oldR <-
 ? ? > !exists("getRversion") || getRversion()
 <
 ? ? > "3.0.0" ## << FIXME: 3.0.0 is? a
 wild
 ? ? > guess
 ? ? > ? ? >>> symnum(id.z <-
 ? ? > outerID.picky(z,z)) ## == Diagonal matrix
 [newer versions of
 ? ? > R]
 ? ? > ? ? ? ? ? ? ? ? ? ? ? ? ?
 ? ? > ???
 ? ? > ? ? >> [1,] | . . . .
 ? ? > . . . . . . .
 ? ? > ? ? >> [2,] . | . . .
 ? ? > . . . . . . .
 ? ? > ? ? >> [3,] . . | . .
 ? ? > . . . . . . .
 ? ? > ? ? >> [4,] . . . | .
 ? ? > . . . . . . .
 ? ? > ? ? >> [5,] . . . . |
 ? ? > . . . . . . .
 ? ? > ? ? >> [6,] . . . . .
 ? ? > | . . . . . .
 ? ? > ? ? >> [7,] . . . . .
 ? ? > . | . . . . .
 ? ? > ? ? >> [8,] . . . . .
 ? ? > . . | . . . .
 ? ? > ? ? >> [9,] . . . . .
 ? ? > . . . | . . .
 ? ? > ? ? >> [10,] . . . . .
 ? ? > . . . . | . .
 ? ? > ? ? >> [11,] . . . . .
 ? ? > . . . . . | .
 ? ? > ? ? >> [12,] . . . . .
 ? ? > . . . . . . |
 ? ? > ? ? >>> try(# for
 ? ? > older R versions
 ? ? > ? ? >> +
 ? ? > stopifnot(identical(id.z, outerID(z,z)),
 oldR ||
 ? ? > identical(id.z, diag(12) == 1))
 ? ? > ? ?
 ? ? >>> + )
 ? ? > ? ? >>> (mz <-
 ? ? > match(z, z)) # currently different
 {NA,NaN} patterns differ
 ? ? > - not in print()/format() _FIXME_
 ? ? > ? ?
 ? ? >>> [1] 1 2 1 2 1 1 1 1 2 2 1 2
 ? ? > ? ?
 ? ? >>>> zRI <- rbind(Re=Re(z),
 Im=Im(z)) # and see
 ? ? > the pattern :
 ? ? > ? ? >>>
 ? ? > print(cbind(format = format(z), t(zRI),
 mz), quote=FALSE)
 ? ? > ? ? >>
 ? ? > format???Re???Im???mz
 ? ? > ? ? >> [1,]? ? ???NA
 ? ? > <NA> 0? ? 1 
 ? ? > ? ? >> [2,]
 ? ? > NaN+? 0i NaN? 0? ? 2 
 ? ? > ? ? >>
 ? ? > [3,]? ? ???NA <NA> 1? ? 1 
 ? ? > ? ? >> [4,] NaN+? 1i NaN? 1?
 ? 2

 ? ? > ? ? >> [5,]? ? ???NA
 ? ? > 0? ? <NA> 1 
 ? ? > ? ? >> [6,]?
 ? ? > ? ???NA 1? ? <NA> 1 
 ? ? > ?
 ? ? > ? >> [7,]? ? ???NA <NA>
 <NA>
 ? ? > 1 
 ? ? > ? ? >> [8,]? ? ???NA
 ? ? > NaN? <NA> 1 
 ? ? > ? ? >>
 ? ? > [9,]???0+NaNi 0? ? NaN? 2 
 ? ? > ?
 ? ? > ? >> [10,]???1+NaNi 1? ?
 NaN? 2 
 ? ? > ? ? >> [11,]? ? ???NA
 ? ? > <NA> NaN? 1 
 ? ? > ? ? >> [12,]
 ? ? > NaN+NaNi NaN? NaN? 2 
 ? ? > ? ? >>>

 ? ? > ? ? >>
 ? ? > -------------------------------
 ? ? > ? ?
 ? ? >>> Note that 'mz <- match(z, z)'
 and hence
 ? ? > the last column of the matrix above
 ? ? > ? ?
 ? ? >>> are very different in current R,

 ? ? > ? ? >> distinguishing most kinds
 of NA
 ? ? > / NaN? against the documentation (and
 the
 ? ? > ? ? >> real/numeric case).

 ? ? > ? ? >> Martin
 ? ? > Maechler
 ? ? > ? ? >> R Core Team


 ? ? > ? ?
 ? ? >>> ### Basically a shortened version
 of? the PR#16885
 ? ? > -- complex part b)
 ? ? > ? ? >> ### of?
 ? ? > R/tests/reg-tests-1c.R

 ? ? > ?
 ? ? > ? >> ## b) complex 'x' with
 different kinds
 ? ? > of NaN
 ? ? > ? ? >> x0 <- c(0,1, NA,
 ? ? > NaN); z <- outer(x0,x0, complex,
 length.out=1); rm(x0)
 ? ? > ? ? >> ##? ? ? ? ???---
 ? ? > = NA_real_? but that does not exist
 e.g., in R 2.3.1
 ? ? > ? ? >> ##? ? ? ? ? ? ? ?
 ? ? > ???similarly,? '1L', '2L', .. do
 ? ? > not exist e.g., in R 2.3.1
 ? ? > ? ? >> (z
 ? ? > <- z[is.na(z)])
 ? ? > ? ? >> outerID
 ? ? > <- function(x,y, ...) { ## ugly; can
 we get outer() to
 ? ? > work ?
 ? ? > ? ? >> r <- matrix( ,
 ? ? > length(x), length(y))
 ? ? > ? ? >> for(i
 ? ? > in seq(along=x))
 ? ? > ? ? >> for(j in
 ? ? > seq(along=y))
 ? ? > ? ? >> r[i,j] <-
 ? ? > identical(z[i], z[j], ...)
 ? ? > ? ? >>
 ? ? > r
 ? ? > ? ? >> }
 ? ? > ? ?
 ? ? >>> ## Very strictly - in the sense
 of identical() --
 ? ? > these 12 complex numbers all differ:
 ? ? > ? ?
 ? ? >>> ## a version that works in older
 versions of R,
 ? ? > [[elided Yahoo spam]]
 ? ? > ? ?
 ? ? >>> outerID.picky <- function(x,y)
 {
 ? ? > ? ? >> nF <-
 ? ? > length(formals(identical)) - 2
 ? ? > ? ?
 ? ? >>> do.call("outerID", c(list(x, y),
 ? ? > as.list(rep(FALSE, nF))))
 ? ? > ? ? >>
 ? ? > }
 ? ? > ? ? >> oldR <-
 ? ? > !exists("getRversion") || getRversion()
 <
 ? ? > "3.0.0" ## << FIXME: 3.0.0 is? a
 wild
 ? ? > guess
 ? ? > ? ? >> symnum(id.z <-
 ? ? > outerID.picky(z,z)) ## == Diagonal matrix
 [newer versions of
 ? ? > R]
 ? ? > ? ? >> try(# for older R
 ? ? > versions
 ? ? > ? ? >>
 ? ? > stopifnot(identical(id.z, outerID(z,z)),
 oldR ||
 ? ? > identical(id.z, diag(12) == 1))
 ? ? > ? ?
 ? ? >>> )
 ? ? > ? ? >> (mz <- match(z,
 ? ? > z)) # currently different {NA,NaN}
 patterns differ - not in
 ? ? > print()/format() _FIXME_
 ? ? > ? ? >> zRI
 ? ? > <- rbind(Re=Re(z), Im=Im(z)) # and see
 the pattern :
 ? ? > ? ? >> print(cbind(format =
 format(z),
 ? ? > t(zRI), mz), quote=FALSE)

 ? ? > ? ? >> ## compute? match(z[i],
 z) ,
 ? ? > for? i = 1,2,..,12? :
 ? ? > ? ? >> (m1z
 ? ? > <- sapply(z, match, table = z))
 ? ? > ? ?
 ? ? >>> ## 1 2 1 2 2 2 1 2 2 2 1 2???#
 R 1.2.3?
 ? ? > (2001-04-26)
 ? ? > ? ? >> ## 1 2 3 4 1 3 7
 ? ? > 8 2 4 8 7???# R 1.4.1? (2002-01-30)
 ? ? > ? ? >> ## 1 2 3 4 1 3 7 8 2 4 8
 12? #
 ? ? > R 1.5.1? (2002-06-17)
 ? ? > ? ? >> ## 1 2
 ? ? > 3 4 1 3 7 8 2 4 8 12? # R 1.8.1?
 (2003-11-21)
 ? ? > ? ? >> ## 1 2 3 4 1 3 7 8 2 4 8
 12? #
 ? ? > R 2.0.1? (2004-11-15)
 ? ? > ? ? >> ## 1 2
 ? ? > 3 4 1 3 7 4 2 4 4 12? # R 2.1.1?
 (2005-06-20)
 ? ? > ? ? >> ## 1 2 3 4 1 3 7 4 2 4 4
 12? #
 ? ? > R 2.3.1? (2006-06-01)
 ? ? > ? ? >> ## 1 2
 ? ? > 3 4 1 3 7 8 2 4 8 12? # R 2.5.1?
 (2007-06-27)
 ? ? > ? ? >> ## 1 2 3 4 1 3 7 4 2 4 4
 12? #
 ? ? > R 2.10.1 (2009-12-14)
 ? ? > ? ? >> ## 1 2
 ? ? > 3 4 1 3 7 4 2 4 4 12? # R 3.1.1?
 (2014-07-10)
 ? ? > ? ? >> ## 1 2 3 4 1 3 7 4 2 4 4
 12? #
 ? ? > R 3.2.5 -- and 3.3.0 patched
 ? ? > ? ? >>
 ? ? > ## 1 2 1 2 1 1 1 1 2 2 1 2???#
 <<--
 ? ? > Martin's R-devel and proposed future R

 ? ? > ? ? >>
 ? ? > if(!exists("anyNA", mode="function"))
 ? ? > anyNA <- function(x) any(is.na(x))
 ? ? > ? ?
 ? ? >>> stopifnot(apply(zRI, 2, anyNA)) #
 *all* are? NA
 ? ? > *or* NaN (or both)
 ? ? > ? ? >> is.NA
 ? ? > <- function(.) is.na(.) &
 !is.nan(.)
 ? ? > ? ? >> (iNaN <- apply(zRI, 2,
 ? ? > function(.) any(is.nan(.))))
 ? ? > ? ? >>
 ? ? > (iNA <-? apply(zRI, 2, function(.)
 any(is.NA (.)))) #
 ? ? > has non-NaN NA's
 ? ? > ? ? >> ## In
 ? ? > Martin's version of R-devel :
 ? ? > ? ?
 ? ? >>> stopifnot(identical(m1z == 1,
 iNA),
 ? ? > ? ? >> identical(m1z == 2,
 !iNA))
 ? ? > ? ? >> ## m1z uses match(x, *)
 with
 ? ? > length(x) == 1 and failed in R 3.3.0
 ? ? > ? ?
 ? ? >>> stopifnot(identical(m1z, mz))
 ? ? > ? ?
 ? ? >>>
 ______________________________________________
 ? ? > ? ? >> R-devel at r-project.org
 mailing
 ? ? > list
 ? ? > ? ? >> https://stat.ethz.ch/mailman/listinfo/r-devel

 ? ? > ? ? >
 ? ? >
 ______________________________________________
 ? ? > ? ? > R-devel at r-project.org
 ? ? > mailing list
 ? ? > ? ? > https://stat.ethz.ch/mailman/listinfo/r-devel

 ? ? >
 ______________________________________________
 ? ? > R-devel at r-project.org
 mailing list
 ? ? > https://stat.ethz.ch/mailman/listinfo/r-devel


From luckbuttered at gmail.com  Sat Jun  4 18:45:09 2016
From: luckbuttered at gmail.com (Luck Buttered)
Date: Sat, 4 Jun 2016 11:45:09 -0500
Subject: [Rd] Submitting an updated package version to CRAN (Warning:
 non-ASCII characters)
In-Reply-To: <1f8e8a28-03f5-dcab-405c-cd52bf00d331@stats.ox.ac.uk>
References: <CAGRPoRQ7m-L6+hp3-nB++YNneJpM-xusTcpy68Yp0_TM=OAuOw@mail.gmail.com>
	<1f8e8a28-03f5-dcab-405c-cd52bf00d331@stats.ox.ac.uk>
Message-ID: <CAGRPoRQZJi=yWX2S5NLfG4oOvcX94Rjm71tNsUZnWjJ-YcmMOA@mail.gmail.com>

Thank you, Prof Brian Ripley. That is a helpful resource!

Since my only non-ASCII characters are in an example data frame, I think I
will use the iconv() function to convert that example data frame into
UTF-8. Then, I will indicate that R version >=2.10 must be in the Depends
field of the DESCRIPTION file, as the resource indicates.


On Mon, May 23, 2016 at 3:46 AM, Prof Brian Ripley <ripley at stats.ox.ac.uk>
wrote:

> On 21/05/2016 21:25, Luck Buttered wrote:
>
>> Dear all:
>>
>> I am updating the version of an R package I submitted last year on CRAN
>> and
>> came across two questions that I would be grateful to seek any input
>> about:
>>
>> 1) In the updated version of the package, I am adding a second example
>> dataset. This example dataset is a subset of a public database that
>> contains thousands of names. Upon running devtools::check(), I am only
>> getting one warning. ("Warning: found non-ASCII strings").
>>
>> It seems this warning is coming from special characters in some of the
>> names. As it is ideal that the names should not be altered, I did not know
>> what approach to take. Should I simply include a note in my CRAN
>> submission
>> indicating that the non-ASCII characters are meaningfully inherent to the
>> example data? Or, should I convert the names to ASCII characters (if that
>> is easily possible for so many cases), and indicate to users that names
>> have been altered (special characters removed)?
>>
>
> You should follow the advice of the manual:
> https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Encoding-issues
> .  There is not enough detail here to know what you currently do (let alone
> what you should do), but that message indicates that the encoding of
> non-ASCII stings (what you call 'special characters') has not been declared
> (and to be portable they should be in UTF-8).
>
> 2) I have never submitted an updated version of a package to CRAN. I am
>> considering following a similar process to what I did to submit my
>> original
>> version of the package to CRAN. That is, using devtools::release() and
>> including a note in a file called cran-comments.md to indicate that this
>> is
>> not an original version submission, but rather, an updated version
>> submission. I found these advice on Hadley Wickhams site (
>> http://r-pkgs.had.co.nz/release.html), but could not determine if this
>> was
>> appropriate for version update submissions as well.
>>
>
> There is a list for discussing package preparation, r-package-devel.
>
>
> Thank you for sharing any advice!
>>
>
>
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Emeritus Professor of Applied Statistics, University of Oxford
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

	[[alternative HTML version deleted]]


From maechler at stat.math.ethz.ch  Sat Jun  4 19:32:04 2016
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 4 Jun 2016 19:32:04 +0200
Subject: [Rd] factors with non-unique ("duplicated") levels have been
 deprecated since 2009 -- are *more* deprecated now -- and why you should be
 hesitant misusing suppressWarnings()
Message-ID: <CAPRP4-dqk7nxM9NEbMnrgD12Xf6xGBh3rQ+AJVnNnknT2Ty=Ew@mail.gmail.com>

>From this bug report (it's a proposal for speedup only, not a bug),
   https://bugs.r-project.org/bugzilla/show_bug.cgi?id=16895#c6
the fact that you can construct factors with non-unique aka
"duplicated" levels in R  has been re-raised.  As mentioned there,
we had a small discussion here (on 'R-devel') a bit more than 7 years
ago,  where I had said that indeed R core had decided
that factors with duplicated levels will be deprecated from R version
2.10.0 on ... indeed a while ago.

As factors are not S4 objects, there is no really formal class
definition and no inherent class validation, but even then in 2009, we
had changed
`levels<-` such that it raised a warning when the levels were not unique:

> aba <- c("a","b","a"); x <- factor(aba, levels=aba)
Warning message:
In `levels<-`(`*tmp*`, value = if (nl == nL) as.character(labels) else
paste0(labels,  :
  duplicated levels in factors are deprecated
>

We've finally decided to make this an error in R-devel  (which is
planned for release, probably as R 3.4.0, in April 2017):

> aba <- c("a","b","a"); x <- factor(aba, levels=aba)
Error in `levels<-`(`*tmp*`, value = if (nl == nL)
as.character(labels) else paste0(labels,  :
  factor level [3] is duplicated
>

If you know R well, you'll know that it is still very easy to
construct factors in R with invalid levels.
For this reason, also *printing* such factors now produces a warning:

> f
[1] 1 2 2 3 3 2 2 1
Levels: 1 2 2 3
Warning message:
In print.factor(x) : duplicated level [3] in factor
>
----------------------------------------------------------------------------------------

We have found at least two packages that are affected by this change
by no longer passing 'R CMD check' on R-devel:
1) plyr --- but there it is just a check which has previously checked
the *warning* mentioned above, which now is an error.  So only the
check must be amended (quite easily)
2) MicroDatosEs: now fails in  example(censo2010).
  and that is the reason for this posting:   I would claim that it is
not primarily the fault of 'MicroDatosEs' maintainer,  but actually of
a package that it depends on, 'memisc'.
 Now that has a "nice" S4 method for producing  factor from
"item.vector"  (though I would find an  as(..) method [defined via
setAs(..)] much more natural than an 'as.factor()' method) :

> selectMethod("as.factor", "item.vector")
Method Definition:

function (x)
{
    labels <- x at value.labels
    if (length(labels)) {
        values <- labels at values
        labels <- labels at .Data
    }
    else {
        values <- labels <- sort(unique(x at .Data))
    }
    filter <- x at value.filter
    use.levels <- if (length(filter))
        is.valid2(values, filter)
    else TRUE
    f <- suppressWarnings(factor(x at .Data, levels = values[use.levels],
        labels = labels[use.levels]))
    if (length(attr(x, "contrasts")))
        contrasts(f) <- contrasts(x)
    f
}
<environment: namespace:memisc>


and the  suppressWarnings(..)   has  "ensured"  all these years since
2009  that users and package writer were never alerted to the
programming "glitch" (of not ensuring levels/labels were correct.
They should have seen that factor() was called sometimes in situations
it produced an invalid factor namely one where some levels were
duplicated, and so the memisc authors could have
ensured that the above method would produce correct factors.

Martin Maechler,
R core team / ETH Zurich


From henrik.bengtsson at gmail.com  Sat Jun  4 21:40:41 2016
From: henrik.bengtsson at gmail.com (Henrik Bengtsson)
Date: Sat, 4 Jun 2016 12:40:41 -0700
Subject: [Rd] RProfmem output format
In-Reply-To: <BANLkTimiLvxHYaV3DT9FVsh+p6nxPoW+5g@mail.gmail.com>
References: <BANLkTinazNHgW44pYFycun576E6C9U1L=Q@mail.gmail.com>
	<BANLkTim=QW62QLuduMsXuPp+5N-rTMjdjg@mail.gmail.com>
	<BANLkTike1kM-wN_GYJEH5WVKQHJMdRijMQ@mail.gmail.com>
	<BANLkTimiLvxHYaV3DT9FVsh+p6nxPoW+5g@mail.gmail.com>
Message-ID: <CAFDcVCQjTW-aWXmYiPZP023YMx10SJY+uBz7mET+OuBF84AQdQ@mail.gmail.com>

I'm picking up this 5-year old thread.

1. About the four memory allocations without a stacktrace

I think the four memory allocations without a stacktrace reported by Rprofmem():

> Rprofmem(); x <- raw(2000); Rprofmem("")
> cat(readLines("Rprofmem.out", n=5, warn=FALSE), sep="\n")
192 :360 :360 :1064 :2040 :"raw"

are due to some initialization of R that is independent of Rprofmem(),
because they can be avoided if one allocates some memory before (in a
fresh R session):

> z <- raw(1000); dummy <- gc()
> Rprofmem(); x <- raw(2000); Rprofmem("")
> cat(readLines("Rprofmem.out", n=5, warn=FALSE), sep="\n")
2040 :"raw"


2. About missing newlines when stacktrace is empty

As a refresher, the problem is that memory allocations an empty
stracktrace are reported without newlines, i.e.

192 :360 :360 :1064 :2040 :"raw"

The question is why this is not reported as:

192 :
360 :
360 :
1064 :
2040 :"raw"

This was/is because C function R_OutputStackTrace() - part of
src/main/memory.c  - looks like:

static void R_OutputStackTrace(FILE *file)
{
    int newline = 0;
    RCNTXT *cptr;

    for (cptr = R_GlobalContext; cptr; cptr = cptr->nextcontext) {
        if ((cptr->callflag & (CTXT_FUNCTION | CTXT_BUILTIN))
           && TYPEOF(cptr->call) == LANGSXP) {
           SEXP fun = CAR(cptr->call);
           if (!newline) newline = 1;
           fprintf(file, "\"%s\" ",
               TYPEOF(fun) == SYMSXP ? CHAR(PRINTNAME(fun)) :
               "<Anonymous>");
        }
    }
    if (newline) fprintf(file, "\n");
}


Thomas, your last comment was:

> Yes. It's obviously better to always print a newline, and so clearly
> deliberate not to, that I suspect there may have been a good reason.
> If I can't work it out (after my grant deadline this week) I will just
> assume it's wrong.

When I search the code and the commit history
(https://github.com/wch/r-source/commit/3d5eb2a09f2d75893efdc8bbf1c72d17603886a0),
it appears that this was there from the very first commit.  Also,
searching the code for usages of R_OutputStackTrace(), I only find
R_ReportAllocation() and R_ReportNewPage(), both part of of
src/main/memory.c (see below).

static void R_ReportAllocation(R_size_t size)
{
    if (R_IsMemReporting) {
if(size > R_MemReportingThreshold) {
   fprintf(R_MemReportingOutfile, "%lu :", (unsigned long) size);
   R_OutputStackTrace(R_MemReportingOutfile);
}
    }
    return;
}

static void R_ReportNewPage(void)
{
    if (R_IsMemReporting) {
fprintf(R_MemReportingOutfile, "new page:");
R_OutputStackTrace(R_MemReportingOutfile);
    }
    return;
}


Could it be that when you wrote it you had another usage for
R_OutputStackTrace() in mind as well?  If so, it makes sense that
R_OutputStackTrace() shouldn't output a newline if the stack trace was
empty.  But if the above is the only usage, to me it looks pretty safe
to always add a newline.

> sessionInfo()
R version 3.3.0 Patched (2016-05-26 r70682)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 7 x64 (build 7601) Service Pack 1

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

/Henrik


On Sun, May 15, 2011 at 1:16 PM, Thomas Lumley <tlumley at uw.edu> wrote:
> On Mon, May 16, 2011 at 1:02 AM, Hadley Wickham <hadley at rice.edu> wrote:
>> So what causes allocations when the call stack is empty?  Something
>> internal?  Does the garbage collector trigger allocations (i.e. could
>> it be caused by moving data to contiguous memory)?
>
> The garbage collector doesn't move anything, it just swaps pointers in
> a linked list.
>
> The lexer, parser, and evaluator all have  to do some work before a
> function context is set up for the top-level function, so I assume
> that's where it is happening.
>
>> Any ideas what the correct thing to do with these memory allocations?
>> Ignore them because they're not really related to the function they're
>> attributed to?  Sum them up?
>>
>>> I don't see why this is done, and I may well be the person who did it
>>> (I don't have svn on this computer to check), but it is clearly
>>> deliberate.
>>
>> It seems like it would be more consistent to always print a newline,
>> and then it would obvious those allocations occurred when the call
>> stack was empty.  This would make parsing the file a little bit
>> easier.
>
> Yes. It's obviously better to always print a newline, and so clearly
> deliberate not to, that I suspect there may have been a good reason.
> If I can't work it out (after my grant deadline this week) I will just
> assume it's wrong.
>
>
>    -thomas
>
> --
> Thomas Lumley
> Professor of Biostatistics
> University of Auckland
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From adam.obeng at columbia.edu  Mon Jun  6 12:11:21 2016
From: adam.obeng at columbia.edu (Adam Obeng)
Date: Mon, 06 Jun 2016 11:11:21 +0100
Subject: [Rd] readlines() truncates text file with Codepage 437 encoding
Message-ID: <1465207881.3622652.629066105.5F14D407@webmail.messagingengine.com>

Hello r-devel,


The attached Code page 437-encoded file contains 245 characters
(including the final newline), but readLines only reads 242 of them:

> test_text <- readLines(file('437__characters.txt', encoding='437'))
Warning message:
In readLines(file("437__characters.txt",  :
  incomplete final line found on '437__characters.txt'
> test_text
[1]
"\v\f\016\017\020\021\022\023\024\025\026\027\030\031\032\033\034\035\036\037
!\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\177
?????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????"
> nchar(test_text)
[1] 242

You'll note that readLines hasn't read the final characters "??\n".

# Diagnostics

My best guess is that this is something to do with how readLines()
determines when it has reached EOF, because of the following:

- The file is terminated with an ASCII LF (0x0a), but R gives an
'incomplete final line found' warning. Note that in some implementations
of Code page 437, 0x0a is interpreted as a graphical character rather
than a control character, but this does not seem to be the problem here.
The same problem occurs if the file ends with 0x0d or 0x0d 0x0a.
- Adding seven or more characters to the end of the file makes it read
correctly
- Similarly, the file is read correctly if you remove three characters
from anywhere in the file
- The same issue seems to occur with reading files encoded in other DOS
code pages

# Additional information

> sessionInfo()
R version 3.2.3 (2015-12-10)
Platform: x86_64-apple-darwin14.5.0 (64-bit)
Running under: OS X 10.10.5 (Yosemite)

locale:
[1] en_GB.UTF-8/en_GB.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

The same behaviour occurs under R 2.15.1 on a Linux server.

In case the attached file is somehow corrupted, here is a hexdump:

00000000: 0b0c 0e0f 1011 1213 1415 1617 1819 1a1b  ................
00000010: 1c1d 1e1f 2021 2223 2425 2627 2829 2a2b  .... !"#$%&'()*+
00000020: 2c2d 2e2f 3031 3233 3435 3637 3839 3a3b  ,-./0123456789:;
00000030: 3c3d 3e3f 4041 4243 4445 4647 4849 4a4b  <=>?@ABCDEFGHIJK
00000040: 4c4d 4e4f 5051 5253 5455 5657 5859 5a5b  LMNOPQRSTUVWXYZ[
00000050: 5c5d 5e5f 6061 6263 6465 6667 6869 6a6b  \]^_`abcdefghijk
00000060: 6c6d 6e6f 7071 7273 7475 7677 7879 7a7b  lmnopqrstuvwxyz{
00000070: 7c7d 7e7f ffad 9b9c 9da6 aeaa f8f1 fde6  |}~.............
00000080: faa7 afac aba8 8e8f 9280 90a5 999a e185  ................
00000090: a083 8486 9187 8a82 8889 8da1 8c8b a495  ................
000000a0: a293 94f6 97a3 9681 989f e2e9 e4e8 eae0  ................
000000b0: ebee e3e5 e7ed fc9e f9fb ecef f7f0 f3f2  ................
000000c0: a9f4 f5c4 b3da bfc0 d9c3 b4c2 c1c5 cdba  ................
000000d0: d5d6 c9b8 b7bb d4d3 c8be bdbc c6c7 ccb5  ................
000000e0: b6b9 d1d2 cbcf d0ca d8d7 cedf dcdb ddde  ................
000000f0: b0b1 b2fe 0a                             .....


Has anyone encountered something similar?


Kind regards,

Adam Obeng

From frederik at ofb.net  Tue Jun  7 03:38:45 2016
From: frederik at ofb.net (frederik at ofb.net)
Date: Mon, 6 Jun 2016 18:38:45 -0700
Subject: [Rd] getGraphicsEvent on X11 and event queuing
Message-ID: <20160607013845.GA21587@ofb.net>

Hi R-Devel,

I've been working on an oscilloscope project using an Arduino
microcontroller board. I found that it's quite easy to get realtime
updates, e.g. 30+ frames per second, if I read data from the board in
a little Rcpp library. I have to use dev.hold() and dev.flush() to
keep the plot from flickering, which restricts me to the "cairo" X11
device.

I'd like to be able to add interactivity to the oscilloscope display,
for instance to bind a key to save the current plot to a file, or to
bind keys for adjusting the time scale etc.

However, I ran into two problems:

(1) setGraphicsEventHandlers only works on the "Xlib" X11 device,
which doesn't support buffering via dev.hold() - it flickers.

(2) getGraphicsEvent and friends lack some interface features which
are needed to use the functions in an asynchronous fashion. Typically,
event listener library functions have a "timeout" parameter, and the
ability to return already-queued events. But getGraphicsEvent() has
neither - it waits indefinitely (you can't set a timeout), and it
seems to ignore events which occurred before it was called (I can't
figure out why, from the code, I guess the normal R event processing
grabs events which occur between calls to getGraphicsEvent?).

It seems like it should be possible to set a handler for keyboard
events and have it execute in between plot updates when the user
presses a key - yet without blocking further updates if no key has
been pressed.

Is anyone interested in fixing (1) and (2)? Or is there some other
library or workaround to solve my problems?

Here is some code I used to play around with these functions:

    X11(type="Xlib");

    keydown = function(key) {
      cat("Got key: ",key);
        lastkey <<- key
        }

    setGraphicsEventHandlers(onKeybd = keydown);

    plot(c(0,0));
    getGraphicsEvent();

Well, I think it's great that getGraphicsEvent exists at all, and want
to salute Duncan Murdoch who is listed as the author. I hope I may
have helped by describing some new possible uses for these functions.

Thank you,

Frederick


From mikko.korpela at helsinki.fi  Tue Jun  7 11:41:54 2016
From: mikko.korpela at helsinki.fi (Mikko Korpela)
Date: Tue, 7 Jun 2016 12:41:54 +0300
Subject: [Rd] Small mistake in ?raw
Message-ID: <575696E2.4060903@helsinki.fi>

In ?raw (src/library/base/man/raw.Rd), the final line of Examples seems 
to be off:

> isASCII("\x9c25.63") # false (in Latin-1, this is an amount in UK pounds)

The character "\x9c" is a control character in Latin-1. Maybe the 
example should use "\xa3" instead:

 > iconv("\x9c25.63", from = "latin1")
[1] "\u009c25.63"
 > iconv("\xa325.63", from = "latin1")
[1] "?25.63"

-- 
Mikko Korpela
Department of Geosciences and Geography
University of Helsinki


From frederik at ofb.net  Wed Jun  8 00:20:05 2016
From: frederik at ofb.net (frederik at ofb.net)
Date: Tue, 7 Jun 2016 15:20:05 -0700
Subject: [Rd] getGraphicsEvent on X11 and event queuing
In-Reply-To: <20160607013845.GA21587@ofb.net>
References: <20160607013845.GA21587@ofb.net>
Message-ID: <20160607222005.GB6983@ofb.net>

... I just realized that setGraphicsEventHandlers or getGraphicsEvent
could have an 'onIdle' callback, to be called somewhere in the polling
loop of gevents.c:163 - I think this would solve my problem #2 in a
minimally disruptive way.

On Mon, Jun 06, 2016 at 06:38:45PM -0700, frederik at ofb.net wrote:
> Hi R-Devel,
> 
> I've been working on an oscilloscope project using an Arduino
> microcontroller board. I found that it's quite easy to get realtime
> updates, e.g. 30+ frames per second, if I read data from the board in
> a little Rcpp library. I have to use dev.hold() and dev.flush() to
> keep the plot from flickering, which restricts me to the "cairo" X11
> device.
> 
> I'd like to be able to add interactivity to the oscilloscope display,
> for instance to bind a key to save the current plot to a file, or to
> bind keys for adjusting the time scale etc.
> 
> However, I ran into two problems:
> 
> (1) setGraphicsEventHandlers only works on the "Xlib" X11 device,
> which doesn't support buffering via dev.hold() - it flickers.
> 
> (2) getGraphicsEvent and friends lack some interface features which
> are needed to use the functions in an asynchronous fashion. Typically,
> event listener library functions have a "timeout" parameter, and the
> ability to return already-queued events. But getGraphicsEvent() has
> neither - it waits indefinitely (you can't set a timeout), and it
> seems to ignore events which occurred before it was called (I can't
> figure out why, from the code, I guess the normal R event processing
> grabs events which occur between calls to getGraphicsEvent?).
> 
> It seems like it should be possible to set a handler for keyboard
> events and have it execute in between plot updates when the user
> presses a key - yet without blocking further updates if no key has
> been pressed.
> 
> Is anyone interested in fixing (1) and (2)? Or is there some other
> library or workaround to solve my problems?
> 
> Here is some code I used to play around with these functions:
> 
>     X11(type="Xlib");
> 
>     keydown = function(key) {
>       cat("Got key: ",key);
>         lastkey <<- key
>         }
> 
>     setGraphicsEventHandlers(onKeybd = keydown);
> 
>     plot(c(0,0));
>     getGraphicsEvent();
> 
> Well, I think it's great that getGraphicsEvent exists at all, and want
> to salute Duncan Murdoch who is listed as the author. I hope I may
> have helped by describing some new possible uses for these functions.
> 
> Thank you,
> 
> Frederick
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From maechler at stat.math.ethz.ch  Wed Jun  8 10:50:49 2016
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 8 Jun 2016 10:50:49 +0200
Subject: [Rd] readlines() truncates text file with Codepage 437 encoding
In-Reply-To: <1465207881.3622652.629066105.5F14D407@webmail.messagingengine.com>
References: <1465207881.3622652.629066105.5F14D407@webmail.messagingengine.com>
Message-ID: <22359.56425.827298.364303@stat.math.ethz.ch>

Appended is the file -- you need to tell your e-mail software to use
one of the MIME types that R-devel does accept;  text/plain
is what I chose

((Yes, as R mailing list server "operator", with a bit of detective work,
  I was able to find the "uncleaned" e-mail and extract the
  attachment from it))

Martin Maechler
ETH Zurich


-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 437__characters.txt
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20160608/d0b88325/attachment.txt>
-------------- next part --------------

>>>>> Adam Obeng <adam.obeng at columbia.edu>
>>>>>     on Mon, 6 Jun 2016 11:11:21 +0100 writes:

    > Hello r-devel, The attached Code page 437-encoded file
    > contains 245 characters (including the final newline), but
    > readLines only reads 242 of them:

    >> test_text <- readLines(file('437__characters.txt',
    >> encoding='437'))
    > Warning message: In readLines(file("437__characters.txt",
    > : incomplete final line found on '437__characters.txt'
    >> test_text
    > [1]
    > "\v\f\016\017\020\021\022\023\024\025\026\027\030\031\032\033\034\035\036\037
    > !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\177
    > ?????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????"
    >> nchar(test_text)
    > [1] 242

    > You'll note that readLines hasn't read the final
    > characters "??\n".

    > # Diagnostics

    > My best guess is that this is something to do with how
    > readLines() determines when it has reached EOF, because of
    > the following:

    > - The file is terminated with an ASCII LF (0x0a), but R
    > gives an 'incomplete final line found' warning. Note that
    > in some implementations of Code page 437, 0x0a is
    > interpreted as a graphical character rather than a control
    > character, but this does not seem to be the problem here.
    > The same problem occurs if the file ends with 0x0d or 0x0d
    > 0x0a.  - Adding seven or more characters to the end of the
    > file makes it read correctly - Similarly, the file is read
    > correctly if you remove three characters from anywhere in
    > the file - The same issue seems to occur with reading
    > files encoded in other DOS code pages

    > # Additional information

    >> sessionInfo()
    > R version 3.2.3 (2015-12-10) Platform:
    > x86_64-apple-darwin14.5.0 (64-bit) Running under: OS X
    > 10.10.5 (Yosemite)

    > locale: [1]
    > en_GB.UTF-8/en_GB.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8

    > attached base packages: [1] stats graphics grDevices utils
    > datasets methods base

    > The same behaviour occurs under R 2.15.1 on a Linux
    > server.

    > In case the attached file is somehow corrupted, here is a
    > hexdump:

    > 00000000: 0b0c 0e0f 1011 1213 1415 1617 1819 1a1b
    > ................  00000010: 1c1d 1e1f 2021 2223 2425 2627
    > 2829 2a2b .... !"#$%&'()*+ 00000020: 2c2d 2e2f 3031 3233
    > 3435 3637 3839 3a3b ,-./0123456789:; 00000030: 3c3d 3e3f
    > 4041 4243 4445 4647 4849 4a4b <=>?@ABCDEFGHIJK 00000040:
    > 4c4d 4e4f 5051 5253 5455 5657 5859 5a5b LMNOPQRSTUVWXYZ[
    > 00000050: 5c5d 5e5f 6061 6263 6465 6667 6869 6a6b
    > \]^_`abcdefghijk 00000060: 6c6d 6e6f 7071 7273 7475 7677
    > 7879 7a7b lmnopqrstuvwxyz{ 00000070: 7c7d 7e7f ffad 9b9c
    > 9da6 aeaa f8f1 fde6 |}~.............  00000080: faa7 afac
    > aba8 8e8f 9280 90a5 999a e185 ................  00000090:
    > a083 8486 9187 8a82 8889 8da1 8c8b a495 ................
    > 000000a0: a293 94f6 97a3 9681 989f e2e9 e4e8 eae0
    > ................  000000b0: ebee e3e5 e7ed fc9e f9fb ecef
    > f7f0 f3f2 ................  000000c0: a9f4 f5c4 b3da bfc0
    > d9c3 b4c2 c1c5 cdba ................  000000d0: d5d6 c9b8
    > b7bb d4d3 c8be bdbc c6c7 ccb5 ................  000000e0:
    > b6b9 d1d2 cbcf d0ca d8d7 cedf dcdb ddde ................
    > 000000f0: b0b1 b2fe 0a .....


    > Has anyone encountered something similar?


    > Kind regards,

    > Adam Obeng ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel

From maechler at stat.math.ethz.ch  Wed Jun  8 13:01:17 2016
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 8 Jun 2016 13:01:17 +0200
Subject: [Rd] Small mistake in ?raw
In-Reply-To: <575696E2.4060903@helsinki.fi>
References: <575696E2.4060903@helsinki.fi>
Message-ID: <22359.64253.313880.371318@stat.math.ethz.ch>

>>>>> Mikko Korpela <mikko.korpela at helsinki.fi>
>>>>>     on Tue, 7 Jun 2016 12:41:54 +0300 writes:

    > In ?raw (src/library/base/man/raw.Rd), the final line of Examples seems 
    > to be off:

    >> isASCII("\x9c25.63") # false (in Latin-1, this is an amount in UK pounds)

    > The character "\x9c" is a control character in Latin-1. Maybe the 
    > example should use "\xa3" instead:

    >> iconv("\x9c25.63", from = "latin1")
    > [1] "\u009c25.63"
    >> iconv("\xa325.63", from = "latin1")
    > [1] "?25.63"

Thank you, Mikko,  I've confirmed what you say  and changed the
comment  (and also added a tiny bit more to the ex. section).

Martin

    > -- 
    > Mikko Korpela
    > Department of Geosciences and Geography
    > University of Helsinki


From marc_schwartz at me.com  Wed Jun  8 21:13:40 2016
From: marc_schwartz at me.com (Marc Schwartz)
Date: Wed, 08 Jun 2016 14:13:40 -0500
Subject: [Rd] Trivial patch for merge.Rd
Message-ID: <9EB38238-E9F2-4ED5-ACBD-5FEF2D816241@me.com>

Hi all,

After replying to r-help earlier today on the merge() related thread, I noted a trivial grammatical error in the description for the 'suffixes' argument in it's help file.

A patch against the current SVN trunk version of merge.Rd in ..library/base/man is attached and pasted here:

--- merge1.Rd	2016-06-08 13:34:35.000000000 -0500
+++ merge2.Rd	2016-06-08 14:03:34.000000000 -0500
@@ -42,7 +42,7 @@
    columns?}
  \item{suffixes}{a character vector of length 2 specifying the suffixes
    to be used for making unique the names of columns in the result
-    which not used for merging (appearing in \code{by} etc).}
+    which are not used for merging (appearing in \code{by} etc).}
  \item{incomparables}{values which cannot be matched.  See
    \code{\link{match}}.  This is intended to be used for merging on one
    column, so these are incomparable values of that column.}


Thanks,

Marc Schwartz


-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: diff.txt
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20160608/e34b3f91/attachment.txt>

From maechler at stat.math.ethz.ch  Thu Jun  9 09:35:16 2016
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 9 Jun 2016 09:35:16 +0200
Subject: [Rd] Trivial patch for merge.Rd
In-Reply-To: <9EB38238-E9F2-4ED5-ACBD-5FEF2D816241@me.com>
References: <9EB38238-E9F2-4ED5-ACBD-5FEF2D816241@me.com>
Message-ID: <22361.7220.870248.761555@stat.math.ethz.ch>

>>>>> Marc Schwartz <marc_schwartz at me.com>
>>>>>     on Wed, 8 Jun 2016 21:13:40 +0200 writes:

    >    Hi all,
   > After replying to r-help earlier today on the merge() related thread, I
   > noted a trivial grammatical error in the description for the 'suffixes'
   > argument in it's help file.
   > A patch against the current SVN trunk version of merge.Rd in
   > ..library/base/man is attached and pasted here:
   > --- merge1.Rd   2016-06-08 13:34:35.000000000 -0500
   > +++ merge2.Rd   2016-06-08 14:03:34.000000000 -0500
   > @@ -42,7 +42,7 @@
   >     columns?}
   >   \item{suffixes}{a character vector of length 2 specifying the
   > suffixes
   >     to be used for making unique the names of columns in the result
   > -    which not used for merging (appearing in \code{by} etc).}
   > +    which are not used for merging (appearing in \code{by} etc).}
   >   \item{incomparables}{values which cannot be matched.  See
   >     \code{\link{match}}.  This is intended to be used for merging on
   > one
   >     column, so these are incomparable values of that column.}
   > Thanks,
   > Marc Schwartz

Thank you, Marc!
Committed to R-devel and R-patched (to be R 3.3.1, in ~ 11 days)


From edzer.pebesma at uni-muenster.de  Thu Jun  9 10:13:55 2016
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 9 Jun 2016 10:13:55 +0200
Subject: [Rd] cumsum method in Math group
Message-ID: <57592543.8010302@uni-muenster.de>

When running

a = runif(10)
class(a) = "foo"
Math.foo = function(x, ...) {
    NextMethod(.Generic)
}
signif(a, 3)
cumsum(a)


I don't understand why cumsum strips the class, but signif does not.
Both claim in the documentation that "These are generic functions:
methods can be defined for them individually or via the ?Math? group
generic."

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/
Spatial Statistics Society http://www.spatialstatistics.info

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20160609/e233e21f/attachment.bin>

From lawrence.michael at gene.com  Thu Jun  9 14:34:36 2016
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Thu, 9 Jun 2016 05:34:36 -0700
Subject: [Rd] cumsum method in Math group
In-Reply-To: <57592543.8010302@uni-muenster.de>
References: <57592543.8010302@uni-muenster.de>
Message-ID: <CAOQ5Nyf8iNTbd+aUrKnfF=ByzJWbcLJ3XoMa1grJyQ7qOmFQxg@mail.gmail.com>

On Thu, Jun 9, 2016 at 1:13 AM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:
> When running
>
> a = runif(10)
> class(a) = "foo"
> Math.foo = function(x, ...) {
>     NextMethod(.Generic)
> }
> signif(a, 3)
> cumsum(a)
>
>
> I don't understand why cumsum strips the class, but signif does not.
> Both claim in the documentation that "These are generic functions:
> methods can be defined for them individually or via the ?Math? group
> generic."
>

There's no contract that the class be preserved. Only that dispatch
will happen. It's fairly unpredictable when R will preserve
attributes, like class. It's safest to cast the result in your Math
method. In general, who is to say whether the cumsum() of an object is
a valid instance of the same class? This also implies that, while
initially tempting, extending base types, in particular vector types,
will ultimately lead to unpredictable behavior and frustration.
Consider composition instead.

> --
> Edzer Pebesma
> Institute for Geoinformatics  (ifgi),  University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
> Journal of Statistical Software:   http://www.jstatsoft.org/
> Computers & Geosciences:   http://elsevier.com/locate/cageo/
> Spatial Statistics Society http://www.spatialstatistics.info
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Thu Jun  9 16:40:42 2016
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 9 Jun 2016 16:40:42 +0200
Subject: [Rd] readlines() truncates text file with Codepage 437 encoding
In-Reply-To: <22359.56425.827298.364303@stat.math.ethz.ch>
References: <1465207881.3622652.629066105.5F14D407@webmail.messagingengine.com>
	<22359.56425.827298.364303@stat.math.ethz.ch>
Message-ID: <22361.32746.740403.420171@stat.math.ethz.ch>

I can reproduce the issue on Linux (Fedora F22),
R 3.3.0 patched of today.

Here's code for experimenting which allows to reproduce the
issue without the need for an attached file (there's a temporary
file created and removed as part of the function below) :

##---------------------------------------------------------------------------

##' @title write-binary-readLines testing
##' @param i  vector of integers in 0:255 to be used as character codes
##' @param file.name optional
##' @param encoding "437" is the one where the problem has been reported
##' @return the readLines() resulting character string with attributes
##' @author Martin Maechler
wb.readL <- function(i, file.name = tempfile("bin"), encoding = "437") {
    stopifnot(is.integer(i), 0 <= i, i <= 255,
              is.character(file.name))
    ff <- file(file.name, "wb")
    writeBin(as.raw(i), ff)
    close(ff) ; on.exit(unlink(file.name))
    ## Now read "as codepage" :
    ch <- readLines(file(file.name, encoding = encoding))
    ##    ---------                 -------------------  typically gives warning
    structure(ch,
              fSize = file.size(file.name),
              nchars = c(b = nchar(ch, "b"),
                         c = nchar(ch, "c"),
                         w = nchar(ch, "w")))
}

ii <- c(11:12, 14:255, 10L)
(cc <- wb.readL(ii))

##---------------------------------------------------------------------------


gives

> (cc <- wb.readL(ii))
[1] "\v\f\016\017\020\021\022\023\024\025\026\027\030\031\032\033\034\035\036\037 !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\177?????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????"
attr(,"fSize")
[1] 245
attr(,"nchars")
  b   c   w
427 241 241
Warning message:
In readLines(file(file.name, encoding = encoding)) :
  incomplete final line found on '/tmp/RtmpaPyDyp/bin65842896d5f1'
>


From maechler at stat.math.ethz.ch  Thu Jun  9 16:52:26 2016
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 9 Jun 2016 16:52:26 +0200
Subject: [Rd] getGraphicsEvent on X11 and event queuing
In-Reply-To: <20160607222005.GB6983@ofb.net>
References: <20160607013845.GA21587@ofb.net>
	<20160607222005.GB6983@ofb.net>
Message-ID: <22361.33450.594773.902489@stat.math.ethz.ch>

Hi Frederik,

>>>>>   <frederik at ofb.net>
>>>>>     on Tue, 7 Jun 2016 15:20:05 -0700 writes:

    > ... I just realized that setGraphicsEventHandlers or
    > getGraphicsEvent could have an 'onIdle' callback, to be
    > called somewhere in the polling loop of gevents.c:163 - I
    > think this would solve my problem #2 in a minimally
    > disruptive way.

I hope you will get some feedback about this by one of the
graphics/devices experts from within R core.
I'm not among them at all, but they may be busy or travelling
currently.

Also, as you are studying the C code and the issues anyway, it
may be worthwhile to consider (as small as possible!) patches to
the source you could also post to the bugzilla site if you
prefer; attaching as text/plain to R-devel does work fine, too.

Best regards,
Martin

    > On Mon, Jun 06, 2016 at 06:38:45PM -0700, frederik at ofb.net
    > wrote:
    >> Hi R-Devel,
    >> 
    >> I've been working on an oscilloscope project using an
    >> Arduino microcontroller board. I found that it's quite
    >> easy to get realtime updates, e.g. 30+ frames per second,
    >> if I read data from the board in a little Rcpp library. I
    >> have to use dev.hold() and dev.flush() to keep the plot
    >> from flickering, which restricts me to the "cairo" X11
    >> device.
    >> 
    >> I'd like to be able to add interactivity to the
    >> oscilloscope display, for instance to bind a key to save
    >> the current plot to a file, or to bind keys for adjusting
    >> the time scale etc.
    >> 
    >> However, I ran into two problems:
    >> 
    >> (1) setGraphicsEventHandlers only works on the "Xlib" X11
    >> device, which doesn't support buffering via dev.hold() -
    >> it flickers.
    >> 
    >> (2) getGraphicsEvent and friends lack some interface
    >> features which are needed to use the functions in an
    >> asynchronous fashion. Typically, event listener library
    >> functions have a "timeout" parameter, and the ability to
    >> return already-queued events. But getGraphicsEvent() has
    >> neither - it waits indefinitely (you can't set a
    >> timeout), and it seems to ignore events which occurred
    >> before it was called (I can't figure out why, from the
    >> code, I guess the normal R event processing grabs events
    >> which occur between calls to getGraphicsEvent?).
    >> 
    >> It seems like it should be possible to set a handler for
    >> keyboard events and have it execute in between plot
    >> updates when the user presses a key - yet without
    >> blocking further updates if no key has been pressed.
    >> 
    >> Is anyone interested in fixing (1) and (2)? Or is there
    >> some other library or workaround to solve my problems?
    >> 
    >> Here is some code I used to play around with these
    >> functions:
    >> 
    >> X11(type="Xlib");
    >> 
    >> keydown = function(key) { cat("Got key: ",key); lastkey <<- key }
    >> 
    >> setGraphicsEventHandlers(onKeybd = keydown);
    >> 
    >> plot(c(0,0)); getGraphicsEvent();
    >> 
    >> Well, I think it's great that getGraphicsEvent exists at
    >> all, and want to salute Duncan Murdoch who is listed as
    >> the author. I hope I may have helped by describing some
    >> new possible uses for these functions.
    >> 
    >> Thank you,
    >> 
    >> Frederick
    >> 
    >> ______________________________________________
    >> R-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 

    > ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel


From hpages at fredhutch.org  Fri Jun 10 22:26:09 2016
From: hpages at fredhutch.org (=?UTF-8?B?SGVydsOpIFBhZ8Oocw==?=)
Date: Fri, 10 Jun 2016 13:26:09 -0700
Subject: [Rd] collapsing list of NULLs dimnames into a NULL
Message-ID: <575B2261.9000103@fredhutch.org>

Hi,

Here are two different ways to create a 0 x 0 logical matrix:

   m1 <- matrix(nrow=0, ncol=0)
   m1
   # <0 x 0 matrix>

   m2 <- as.matrix(data.frame())
   m2
   # <0 x 0 matrix>

Surprisingly:

   identical(m1, m2)
   # [1] FALSE

That's because of their dimnames:

   dimnames(m1)
   # NULL

   dimnames(m2)
   # [[1]]
   # NULL
   #
   # [[2]]
   # NULL

More generally this can be observed with 0-col matrices:

   m1 <- matrix(nrow=5, ncol=0)
   m2 <- as.matrix(data.frame(stuff=11:15)[0])
   identical(m1, m2)  # FALSE

The culprit is this line in as.matrix.data.frame():

   dimnames(X) <- list(dn[[1L]], unlist(collabs, use.names = FALSE))

Shouldn't as.matrix.data.frame() collapse the list of NULLs into a NULL
before setting the dimnames?

Alternatively, maybe a more general solution could be to have the
dimnames() setter take care of this. There seems to be a lot of
code around that is potentially setting a list of NULLs as the dimnames
of an object, so having dimnames<- do the collapse would fix the problem
in one place once for all and avoid a lot of repeated code.

Finally, having this functionality available at the C level would be
great. Would basically be a wrapper to

   Rf_setAttrib(x, R_DimNamesSymbol, dimnames)

that takes care of the collapse. The SET_DIMNAMES macro could be
redefined to call that wrapper instead...

Thanks,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fredhutch.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From bbolker at gmail.com  Fri Jun 10 23:20:10 2016
From: bbolker at gmail.com (Ben Bolker)
Date: Fri, 10 Jun 2016 17:20:10 -0400
Subject: [Rd] typosquatting and trojan horses in packages
Message-ID: <575B2F0A.8010900@gmail.com>

A friend passed along this interesting link:
http://incolumitas.com/2016/06/08/typosquatting-package-managers/ about
the strategy of using "typosquatting" (packages with very similar names
to existing packages) to trick users into downloading/installing
packages with malicious code).  They made fake trojans (with empty
payloads) for Ruby, Python and NodeJS and experimented to see how widely
they would be distributed (we can discuss the ethics of this experiment
later ...)

  For those who don't want to read the whole thing, the author points
that this attack vector is enabled by

1. The possibility of registering any package name and uploading code
without supervision.

   [CRAN is obviously supervised, but I'm not sure if there might be
ways to evade CRAN scrutiny and achieve this goal -- a lot of
obfuscation plus a test that avoided the malicious behavior if "running
on CRAN" was detected?  I know there has been discussion in the past
about how to have a package not do things like run long tests when on
CRAN ... I think CRAN maintainers would probably notice an attempt at
typosquatting on a common package (e.g. "ggplot" for "ggplot2", "nmle"
for "nlme"), but again I'm not sure ...)

2. The feasibility to achieve code execution upon package installation
on the host system.

  [I think this one is true, due to the possibility of including a
generic Makefile?]

I've pasted the author's comments about defense below. The whole page is
definitely worth reading.

  Thoughts?

  Ben Bolker


=================
Defenses against typo squatting

In short, read the thesis. If you are too lazy, do the following:

Prevent Direct Code Execution on Installations This one is easy. Make
sure that the software that unpacks and installs a third party package
(pip or npm) does not allow the execution of code that originates from
the package itself. Only when the user explicitly loads the package, the
library code should be executed.

Generate a List of Potential Typo Candidates Generate Levenshtein
distance candidates for the most downloaded N packages of the repository
and alarm administrators on registration of such a candidate.

Analyze 404 logfiles and prevent registration of often shadow installed
packages Whenever a user makes a typo by installing a package and the
package is not registered yet, a 404 logfile entry on the repository
server is created (because the install HTTP requests targets a
non-existent resource). Parse these failed installations and prevent all
such names that are shadow-installed more than a reasonable threshold
per month.


From hpages at fredhutch.org  Fri Jun 10 23:22:22 2016
From: hpages at fredhutch.org (=?UTF-8?B?SGVydsOpIFBhZ8Oocw==?=)
Date: Fri, 10 Jun 2016 14:22:22 -0700
Subject: [Rd] as.array() on a data.frame
Message-ID: <575B2F8E.8030500@fredhutch.org>

Wouldn't it make sense to have as.array() work on a data.frame and
be equivalent to as.matrix()?

   df <- data.frame(stuff=1:3)

   # as.matrix(df)
   #      stuff
   # [1,]     1
   # [2,]     2
   # [3,]     3

   as.array(df)
   # Error in `dimnames<-.data.frame`(`*tmp*`, value = list(n)) :
   #   invalid 'dimnames' given for data frame

Note that as.array() actually works on a 0-col data.frame but
seems broken (it returns a data.frame instead of an array):

   as.array(df[0])
   # data frame with 0 columns and 3 rows

FWIW the returned data.frame is an invalid object:

   attributes(as.array(df[0]))
   # $row.names
   # [1] 1 2 3
   #
   # $class
   # [1] "data.frame"
   #
   # $dim
   # [1] 0

   validObject(as.array(df[0]))
   # Error in validObject(as.array(df[0])) :
   #   invalid class ?data.frame? object: slots in class definition but
   #   not in object: "names"

Cheers,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fredhutch.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From frederik at ofb.net  Sun Jun 12 05:49:20 2016
From: frederik at ofb.net (frederik at ofb.net)
Date: Sat, 11 Jun 2016 20:49:20 -0700
Subject: [Rd] getGraphicsEvent on X11 and event queuing; Makefile.in
In-Reply-To: <22361.33450.594773.902489@stat.math.ethz.ch>
References: <20160607013845.GA21587@ofb.net> <20160607222005.GB6983@ofb.net>
	<22361.33450.594773.902489@stat.math.ethz.ch>
Message-ID: <20160612034920.GE6983@ofb.net>

Hi Martin,

Thanks for getting back about getGraphicsEvent.

I got an off-list reply from someone who echoed the annoyance with
lack of Cairo support, and also provided some interesting examples of
his own use of getGraphicsEvent. Thank you for the invitation to
contribute patches; I don't know what my upcoming priorities will be
like but it's good to know that you would consider using my code.

Speaking of which, I just did an 'svn update' and noticed that
Makefile.in has the same line that I asked about earlier:

        @if test ! -f "$(srcdir)/doc/FAQ" || test -f non-tarball ; then \

But, my earlier suggestion to change this to $(srcdir)/non-tarball was
wrong because it doesn't seem to fix anything. In fact the
"non-tarball" exists in the build directory so it was OK to test for
it there. Sorry about that!

Apparently building in a separate directory, when a build has already
been started in the source directory, is still broken. I just checked
this with a clean "svn checkout". Even if I start a successful build
in a separate build directory, cancel it with SIGINT, start a build in
the source directory, cancel that, and then try to continue the
build-directory build, I get an error:

    make[1]: Entering directory '/home/frederik/pkg-tmp/R-svn-build/doc/manual'
    make[1]: Nothing to be done for 'front-matter'.
    make[1]: Nothing to be done for 'html-non-svn'.
    make[1]: Leaving directory '/home/frederik/pkg-tmp/R-svn-build/doc/manual'
    SVN-REVISION is unchanged
    make[1]: Entering directory '/home/frederik/pkg-tmp/R-svn-build/m4'
    make[1]: Nothing to be done for 'R'.
    make[1]: Leaving directory '/home/frederik/pkg-tmp/R-svn-build/m4'
    make[1]: Entering directory '/home/frederik/pkg-tmp/R-svn-build/tools'
    make[1]: Nothing to be done for 'R'.
    make[1]: Leaving directory '/home/frederik/pkg-tmp/R-svn-build/tools'
    make[1]: Entering directory '/home/frederik/pkg-tmp/R-svn-build/doc'
    /usr/bin/install: cannot stat '../../R-svn/doc/NEWS': No such file or directory
    /usr/bin/install: cannot stat '../../R-svn/doc/NEWS.pdf': No such file or directory
    Makefile:164: recipe for target 'svnonly' failed
    make[1]: *** [svnonly] Error 1
    make[1]: Leaving directory '/home/frederik/pkg-tmp/R-svn-build/doc'
    Makefile:60: recipe for target 'R' failed
    make: *** [R] Error 1

I'm somewhat stumped... I had thought that removing doc/FAQ would fix
it, but it doesn't. I don't know what else could have been done by
'make' in the source directory which is confusing the build-directory
build.

Thanks,

Frederick

On Thu, Jun 09, 2016 at 04:52:26PM +0200, Martin Maechler wrote:
> Hi Frederik,
> 
> >>>>>   <frederik at ofb.net>
> >>>>>     on Tue, 7 Jun 2016 15:20:05 -0700 writes:
> 
>     > ... I just realized that setGraphicsEventHandlers or
>     > getGraphicsEvent could have an 'onIdle' callback, to be
>     > called somewhere in the polling loop of gevents.c:163 - I
>     > think this would solve my problem #2 in a minimally
>     > disruptive way.
> 
> I hope you will get some feedback about this by one of the
> graphics/devices experts from within R core.
> I'm not among them at all, but they may be busy or travelling
> currently.
> 
> Also, as you are studying the C code and the issues anyway, it
> may be worthwhile to consider (as small as possible!) patches to
> the source you could also post to the bugzilla site if you
> prefer; attaching as text/plain to R-devel does work fine, too.
> 
> Best regards,
> Martin
> 
>     > On Mon, Jun 06, 2016 at 06:38:45PM -0700, frederik at ofb.net
>     > wrote:
>     >> Hi R-Devel,
>     >> 
>     >> I've been working on an oscilloscope project using an
>     >> Arduino microcontroller board. I found that it's quite
>     >> easy to get realtime updates, e.g. 30+ frames per second,
>     >> if I read data from the board in a little Rcpp library. I
>     >> have to use dev.hold() and dev.flush() to keep the plot
>     >> from flickering, which restricts me to the "cairo" X11
>     >> device.
>     >> 
>     >> I'd like to be able to add interactivity to the
>     >> oscilloscope display, for instance to bind a key to save
>     >> the current plot to a file, or to bind keys for adjusting
>     >> the time scale etc.
>     >> 
>     >> However, I ran into two problems:
>     >> 
>     >> (1) setGraphicsEventHandlers only works on the "Xlib" X11
>     >> device, which doesn't support buffering via dev.hold() -
>     >> it flickers.
>     >> 
>     >> (2) getGraphicsEvent and friends lack some interface
>     >> features which are needed to use the functions in an
>     >> asynchronous fashion. Typically, event listener library
>     >> functions have a "timeout" parameter, and the ability to
>     >> return already-queued events. But getGraphicsEvent() has
>     >> neither - it waits indefinitely (you can't set a
>     >> timeout), and it seems to ignore events which occurred
>     >> before it was called (I can't figure out why, from the
>     >> code, I guess the normal R event processing grabs events
>     >> which occur between calls to getGraphicsEvent?).
>     >> 
>     >> It seems like it should be possible to set a handler for
>     >> keyboard events and have it execute in between plot
>     >> updates when the user presses a key - yet without
>     >> blocking further updates if no key has been pressed.
>     >> 
>     >> Is anyone interested in fixing (1) and (2)? Or is there
>     >> some other library or workaround to solve my problems?
>     >> 
>     >> Here is some code I used to play around with these
>     >> functions:
>     >> 
>     >> X11(type="Xlib");
>     >> 
>     >> keydown = function(key) { cat("Got key: ",key); lastkey <<- key }
>     >> 
>     >> setGraphicsEventHandlers(onKeybd = keydown);
>     >> 
>     >> plot(c(0,0)); getGraphicsEvent();
>     >> 
>     >> Well, I think it's great that getGraphicsEvent exists at
>     >> all, and want to salute Duncan Murdoch who is listed as
>     >> the author. I hope I may have helped by describing some
>     >> new possible uses for these functions.
>     >> 
>     >> Thank you,
>     >> 
>     >> Frederick
>     >> 
>     >> ______________________________________________
>     >> R-devel at r-project.org mailing list
>     >> https://stat.ethz.ch/mailman/listinfo/r-devel
>     >> 
> 
>     > ______________________________________________
>     > R-devel at r-project.org mailing list
>     > https://stat.ethz.ch/mailman/listinfo/r-devel
>


From J.Gorecki at wit.edu.pl  Tue Jun 14 16:54:28 2016
From: J.Gorecki at wit.edu.pl (=?UTF-8?B?SmFuIEfDs3JlY2tp?=)
Date: Tue, 14 Jun 2016 15:54:28 +0100
Subject: [Rd] new function to tools/utils package: dependencies based on
 DESCRIPTION file
Message-ID: <CABE2sp6e_kyX4vhR-uLAqpwNZxDyG-FD+AMBHE0uXp=c+UPQhw@mail.gmail.com>

Hi all,

Packages tools and utils have a lot of useful stuff for R developers.
I find one task still not as straightforward as it could. Simply to
extract dependencies of a package from DESCRIPTION file (before it is
even installed to library). This would be valuable in automation of CI
setup in a more meta-data driven way.
The simple function below, I know it is short and simple, but having
it to be defined in each CI workflow is a pain, it could be already
available in tools or utils namespace.

package.dependencies.dcf <- function(file = "DESCRIPTION", which =
c("Depends","Imports","LinkingTo")) {
    stopifnot(file.exists(file), is.character(which))
    which_all <- c("Depends", "Imports", "LinkingTo", "Suggests", "Enhances")
    if (identical(which, "all"))
        which <- which_all
    else if (identical(which, "most"))
        which <- c("Depends", "Imports", "LinkingTo", "Suggests")
    stopifnot(which %in% which_all)
    dcf <- read.dcf(file, which)
    # parse fields
    raw.deps <- unlist(strsplit(dcf[!is.na(dcf)], ",", fixed = TRUE))
    # strip stated dependency version
    deps <- trimws(sapply(strsplit(trimws(raw.deps), "(", fixed =
TRUE), `[[`, 1L))
    # exclude base R pkgs
    base.pkgs <- c("R", rownames(installed.packages(priority = "base")))
    setdiff(deps, base.pkgs)
}

This allows to easily install all package dependencies just based on
DESCRIPTION file, so simplify that in custom CI workflows to:

if (length(pkgs<-package.dependencies.dcf(which="all"))) install.packages(pkgs)

And would not require to install custom packages or shell scripts.

Regards,
Jan Gorecki


From thierry.onkelinx at inbo.be  Tue Jun 14 17:17:52 2016
From: thierry.onkelinx at inbo.be (Thierry Onkelinx)
Date: Tue, 14 Jun 2016 17:17:52 +0200
Subject: [Rd] new function to tools/utils package: dependencies based on
 DESCRIPTION file
In-Reply-To: <CABE2sp6e_kyX4vhR-uLAqpwNZxDyG-FD+AMBHE0uXp=c+UPQhw@mail.gmail.com>
References: <CABE2sp6e_kyX4vhR-uLAqpwNZxDyG-FD+AMBHE0uXp=c+UPQhw@mail.gmail.com>
Message-ID: <CAJuCY5zfVudo7gyCi3NY1X012WgLyL7Tbkt7QeHy6zf0ZrQ2CA@mail.gmail.com>

Dear Jan,

Similar functionality is available in devtools::dev_package_deps()

Best regards,

ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature and
Forest
team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
Kliniekstraat 25
1070 Anderlecht
Belgium

To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey

2016-06-14 16:54 GMT+02:00 Jan G?recki <J.Gorecki at wit.edu.pl>:

> Hi all,
>
> Packages tools and utils have a lot of useful stuff for R developers.
> I find one task still not as straightforward as it could. Simply to
> extract dependencies of a package from DESCRIPTION file (before it is
> even installed to library). This would be valuable in automation of CI
> setup in a more meta-data driven way.
> The simple function below, I know it is short and simple, but having
> it to be defined in each CI workflow is a pain, it could be already
> available in tools or utils namespace.
>
> package.dependencies.dcf <- function(file = "DESCRIPTION", which =
> c("Depends","Imports","LinkingTo")) {
>     stopifnot(file.exists(file), is.character(which))
>     which_all <- c("Depends", "Imports", "LinkingTo", "Suggests",
> "Enhances")
>     if (identical(which, "all"))
>         which <- which_all
>     else if (identical(which, "most"))
>         which <- c("Depends", "Imports", "LinkingTo", "Suggests")
>     stopifnot(which %in% which_all)
>     dcf <- read.dcf(file, which)
>     # parse fields
>     raw.deps <- unlist(strsplit(dcf[!is.na(dcf)], ",", fixed = TRUE))
>     # strip stated dependency version
>     deps <- trimws(sapply(strsplit(trimws(raw.deps), "(", fixed =
> TRUE), `[[`, 1L))
>     # exclude base R pkgs
>     base.pkgs <- c("R", rownames(installed.packages(priority = "base")))
>     setdiff(deps, base.pkgs)
> }
>
> This allows to easily install all package dependencies just based on
> DESCRIPTION file, so simplify that in custom CI workflows to:
>
> if (length(pkgs<-package.dependencies.dcf(which="all")))
> install.packages(pkgs)
>
> And would not require to install custom packages or shell scripts.
>
> Regards,
> Jan Gorecki
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

	[[alternative HTML version deleted]]


From frederik at ofb.net  Tue Jun 14 17:34:13 2016
From: frederik at ofb.net (frederik at ofb.net)
Date: Tue, 14 Jun 2016 08:34:13 -0700
Subject: [Rd] getGraphicsEvent on X11 and event queuing
In-Reply-To: <22361.33450.594773.902489@stat.math.ethz.ch>
References: <20160607013845.GA21587@ofb.net> <20160607222005.GB6983@ofb.net>
	<22361.33450.594773.902489@stat.math.ethz.ch>
Message-ID: <20160614153413.GA24958@ofb.net>

Hi Martin,

> Also, as you are studying the C code and the issues anyway, it
> may be worthwhile to consider (as small as possible!) patches to
> the source you could also post to the bugzilla site if you
> prefer; attaching as text/plain to R-devel does work fine, too.

Well, after your kind solicitation I went through all the touble of
locally fixing getGraphicsEvent Cairo support and implementing an
onIdle handler.

However, I noticed that the first part actually already has a patch on
the R bug tracker, which is exactly the same as the fix I implemented!
(minus documentation)

https://bugs.r-project.org/bugzilla/show_bug.cgi?id=14364

Problem: somebody ignored the patch and closed the bug. Who closed it?
YOU!

So, I guess since that patch (fixing Cairo support) was sent in 2010,
and my patch (fixing both problems) is about 8 times longer, I can
expect you to ignore my patch until at least 2063 (a tight lower bound
if you apply Hugo's patch this year). :)

I posted my patch here:

https://bugs.r-project.org/bugzilla/show_bug.cgi?id=16951

Frederick


From J.Gorecki at wit.edu.pl  Tue Jun 14 18:29:06 2016
From: J.Gorecki at wit.edu.pl (=?UTF-8?B?SmFuIEfDs3JlY2tp?=)
Date: Tue, 14 Jun 2016 17:29:06 +0100
Subject: [Rd] new function to tools/utils package: dependencies based on
 DESCRIPTION file
In-Reply-To: <CAJuCY5zfVudo7gyCi3NY1X012WgLyL7Tbkt7QeHy6zf0ZrQ2CA@mail.gmail.com>
References: <CABE2sp6e_kyX4vhR-uLAqpwNZxDyG-FD+AMBHE0uXp=c+UPQhw@mail.gmail.com>
	<CAJuCY5zfVudo7gyCi3NY1X012WgLyL7Tbkt7QeHy6zf0ZrQ2CA@mail.gmail.com>
Message-ID: <CABE2sp7SrJtPDg-yZwdBDuNmSDoXv936i2biZzxUUaVEeQLa+g@mail.gmail.com>

Hi Thierry,

I'm perfectly aware of it. Any idea when devtools would be shipped as
a base R package, or at least recommended package? To actually answer
the problem described in my email.
I have range of useful functions available tools/utils packages which
are shipped together with R. They doesn't require any OS dependencies
or R dependencies, unlike devtools which requires both. Installing
unnecessary OS dependencies and R dependencies just for such a simple
wrapper doesn't seem to be an elegant way to address it, therefore my
proposal to include that simple function in tools, or utils package.

Regards,
Jan Gorecki

On 14 June 2016 at 16:17, Thierry Onkelinx <thierry.onkelinx at inbo.be> wrote:
> Dear Jan,
>
> Similar functionality is available in devtools::dev_package_deps()
>
> Best regards,
>
> ir. Thierry Onkelinx
> Instituut voor natuur- en bosonderzoek / Research Institute for Nature and
> Forest
> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
> Kliniekstraat 25
> 1070 Anderlecht
> Belgium
>
> To call in the statistician after the experiment is done may be no more than
> asking him to perform a post-mortem examination: he may be able to say what
> the experiment died of. ~ Sir Ronald Aylmer Fisher
> The plural of anecdote is not data. ~ Roger Brinner
> The combination of some data and an aching desire for an answer does not
> ensure that a reasonable answer can be extracted from a given body of data.
> ~ John Tukey
>
> 2016-06-14 16:54 GMT+02:00 Jan G?recki <J.Gorecki at wit.edu.pl>:
>>
>> Hi all,
>>
>> Packages tools and utils have a lot of useful stuff for R developers.
>> I find one task still not as straightforward as it could. Simply to
>> extract dependencies of a package from DESCRIPTION file (before it is
>> even installed to library). This would be valuable in automation of CI
>> setup in a more meta-data driven way.
>> The simple function below, I know it is short and simple, but having
>> it to be defined in each CI workflow is a pain, it could be already
>> available in tools or utils namespace.
>>
>> package.dependencies.dcf <- function(file = "DESCRIPTION", which =
>> c("Depends","Imports","LinkingTo")) {
>>     stopifnot(file.exists(file), is.character(which))
>>     which_all <- c("Depends", "Imports", "LinkingTo", "Suggests",
>> "Enhances")
>>     if (identical(which, "all"))
>>         which <- which_all
>>     else if (identical(which, "most"))
>>         which <- c("Depends", "Imports", "LinkingTo", "Suggests")
>>     stopifnot(which %in% which_all)
>>     dcf <- read.dcf(file, which)
>>     # parse fields
>>     raw.deps <- unlist(strsplit(dcf[!is.na(dcf)], ",", fixed = TRUE))
>>     # strip stated dependency version
>>     deps <- trimws(sapply(strsplit(trimws(raw.deps), "(", fixed =
>> TRUE), `[[`, 1L))
>>     # exclude base R pkgs
>>     base.pkgs <- c("R", rownames(installed.packages(priority = "base")))
>>     setdiff(deps, base.pkgs)
>> }
>>
>> This allows to easily install all package dependencies just based on
>> DESCRIPTION file, so simplify that in custom CI workflows to:
>>
>> if (length(pkgs<-package.dependencies.dcf(which="all")))
>> install.packages(pkgs)
>>
>> And would not require to install custom packages or shell scripts.
>>
>> Regards,
>> Jan Gorecki
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From jorismeys at gmail.com  Thu Jun 16 09:37:05 2016
From: jorismeys at gmail.com (Joris Meys)
Date: Thu, 16 Jun 2016 09:37:05 +0200
Subject: [Rd] new function to tools/utils package: dependencies based on
 DESCRIPTION file
In-Reply-To: <CAO1zAVa69_0kh1ioXuqwq=R2t=5SeOHEZn0h7UJqjcKup45=xA@mail.gmail.com>
References: <CABE2sp6e_kyX4vhR-uLAqpwNZxDyG-FD+AMBHE0uXp=c+UPQhw@mail.gmail.com>
	<CAJuCY5zfVudo7gyCi3NY1X012WgLyL7Tbkt7QeHy6zf0ZrQ2CA@mail.gmail.com>
	<CABE2sp7SrJtPDg-yZwdBDuNmSDoXv936i2biZzxUUaVEeQLa+g@mail.gmail.com>
	<CAO1zAVY9uAi3qEFUSBVDGdn50ijuhBDmJGHRL7cRNjaU01s6kA@mail.gmail.com>
	<CAO1zAVa69_0kh1ioXuqwq=R2t=5SeOHEZn0h7UJqjcKup45=xA@mail.gmail.com>
Message-ID: <CAO1zAVZ9Crr370SsRM9y17JJPsLBcV_GT7P4LT7Cv5Zh2xy48Q@mail.gmail.com>

Dear Jan,

It is unavoidable to have OS and R dependencies for devtools. The building
process for packages is both OS and R dependent, so devtools has to be too
according to my understanding.

Cheers
Joris
On 14 Jun 2016 18:56, "Jan G?recki" <J.Gorecki at wit.edu.pl> wrote:

Hi Thierry,

I'm perfectly aware of it. Any idea when devtools would be shipped as
a base R package, or at least recommended package? To actually answer
the problem described in my email.
I have range of useful functions available tools/utils packages which
are shipped together with R. They doesn't require any OS dependencies
or R dependencies, unlike devtools which requires both. Installing
unnecessary OS dependencies and R dependencies just for such a simple
wrapper doesn't seem to be an elegant way to address it, therefore my
proposal to include that simple function in tools, or utils package.

Regards,
Jan Gorecki

On 14 June 2016 at 16:17, Thierry Onkelinx <thierry.onkelinx at inbo.be> wrote:
> Dear Jan,
>
> Similar functionality is available in devtools::dev_package_deps()
>
> Best regards,
>
> ir. Thierry Onkelinx
> Instituut voor natuur- en bosonderzoek / Research Institute for Nature and
> Forest
> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
> Kliniekstraat 25
> 1070 Anderlecht
> Belgium
>
> To call in the statistician after the experiment is done may be no more
than
> asking him to perform a post-mortem examination: he may be able to say
what
> the experiment died of. ~ Sir Ronald Aylmer Fisher
> The plural of anecdote is not data. ~ Roger Brinner
> The combination of some data and an aching desire for an answer does not
> ensure that a reasonable answer can be extracted from a given body of
data.
> ~ John Tukey
>
> 2016-06-14 16:54 GMT+02:00 Jan G?recki <J.Gorecki at wit.edu.pl>:
>>
>> Hi all,
>>
>> Packages tools and utils have a lot of useful stuff for R developers.
>> I find one task still not as straightforward as it could. Simply to
>> extract dependencies of a package from DESCRIPTION file (before it is
>> even installed to library). This would be valuable in automation of CI
>> setup in a more meta-data driven way.
>> The simple function below, I know it is short and simple, but having
>> it to be defined in each CI workflow is a pain, it could be already
>> available in tools or utils namespace.
>>
>> package.dependencies.dcf <- function(file = "DESCRIPTION", which =
>> c("Depends","Imports","LinkingTo")) {
>>     stopifnot(file.exists(file), is.character(which))
>>     which_all <- c("Depends", "Imports", "LinkingTo", "Suggests",
>> "Enhances")
>>     if (identical(which, "all"))
>>         which <- which_all
>>     else if (identical(which, "most"))
>>         which <- c("Depends", "Imports", "LinkingTo", "Suggests")
>>     stopifnot(which %in% which_all)
>>     dcf <- read.dcf(file, which)
>>     # parse fields
>>     raw.deps <- unlist(strsplit(dcf[!is.na(dcf)], ",", fixed = TRUE))
>>     # strip stated dependency version
>>     deps <- trimws(sapply(strsplit(trimws(raw.deps), "(", fixed =
>> TRUE), `[[`, 1L))
>>     # exclude base R pkgs
>>     base.pkgs <- c("R", rownames(installed.packages(priority = "base")))
>>     setdiff(deps, base.pkgs)
>> }
>>
>> This allows to easily install all package dependencies just based on
>> DESCRIPTION file, so simplify that in custom CI workflows to:
>>
>> if (length(pkgs<-package.dependencies.dcf(which="all")))
>> install.packages(pkgs)
>>
>> And would not require to install custom packages or shell scripts.
>>
>> Regards,
>> Jan Gorecki
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

	[[alternative HTML version deleted]]


From csardi.gabor at gmail.com  Thu Jun 16 10:15:55 2016
From: csardi.gabor at gmail.com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Thu, 16 Jun 2016 09:15:55 +0100
Subject: [Rd] new function to tools/utils package: dependencies based on
 DESCRIPTION file
In-Reply-To: <CAO1zAVZ9Crr370SsRM9y17JJPsLBcV_GT7P4LT7Cv5Zh2xy48Q@mail.gmail.com>
References: <CABE2sp6e_kyX4vhR-uLAqpwNZxDyG-FD+AMBHE0uXp=c+UPQhw@mail.gmail.com>
	<CAJuCY5zfVudo7gyCi3NY1X012WgLyL7Tbkt7QeHy6zf0ZrQ2CA@mail.gmail.com>
	<CABE2sp7SrJtPDg-yZwdBDuNmSDoXv936i2biZzxUUaVEeQLa+g@mail.gmail.com>
	<CAO1zAVY9uAi3qEFUSBVDGdn50ijuhBDmJGHRL7cRNjaU01s6kA@mail.gmail.com>
	<CAO1zAVa69_0kh1ioXuqwq=R2t=5SeOHEZn0h7UJqjcKup45=xA@mail.gmail.com>
	<CAO1zAVZ9Crr370SsRM9y17JJPsLBcV_GT7P4LT7Cv5Zh2xy48Q@mail.gmail.com>
Message-ID: <CABtg=K=8Uw1KaN-72=t=vC=E+CQRBFjVCGYr7UQOMfyeAFmv=g@mail.gmail.com>

FWIW, the `desc` package can extract dependencies from a local
DESCRIPTION, and it is lightweight. It only depends on small, R-only
packages (R6 and crayon).

? desc::desc_get_deps(".")
     type       package version
1 Imports           DBI       *
2 Imports      markdown       *
3 Imports rhandsontable       *
4 Imports       RSQLite       *
5 Imports         shiny       *
6 Imports      shinyAce       *
7 Imports       shinyjs       *
8 Imports   shinytoastr       *
9 Imports       whisker       *

Another alternative is the 'remotes' package, this has no dependencies at all:

? remotes::local_package_deps(".")
[1] "DBI"           "markdown"      "rhandsontable" "RSQLite"
[5] "shiny"         "shinyAce"      "shinyjs"       "shinytoastr"
[9] "whisker"

It is at https://github.com/MangoTheCat/remotes, but note that it does
have some other bugs: https://github.com/MangoTheCat/remotes/issues

Disclaimer: I wrote most of 'desc' and parts of 'remotes', and maintain both.

G?bor

On Thu, Jun 16, 2016 at 8:37 AM, Joris Meys <jorismeys at gmail.com> wrote:
> Dear Jan,
>
> It is unavoidable to have OS and R dependencies for devtools. The building
> process for packages is both OS and R dependent, so devtools has to be too
> according to my understanding.
>
> Cheers
> Joris
> On 14 Jun 2016 18:56, "Jan G?recki" <J.Gorecki at wit.edu.pl> wrote:
>
> Hi Thierry,
>
> I'm perfectly aware of it. Any idea when devtools would be shipped as
> a base R package, or at least recommended package? To actually answer
> the problem described in my email.
> I have range of useful functions available tools/utils packages which
> are shipped together with R. They doesn't require any OS dependencies
> or R dependencies, unlike devtools which requires both. Installing
> unnecessary OS dependencies and R dependencies just for such a simple
> wrapper doesn't seem to be an elegant way to address it, therefore my
> proposal to include that simple function in tools, or utils package.
>
> Regards,
> Jan Gorecki
>
> On 14 June 2016 at 16:17, Thierry Onkelinx <thierry.onkelinx at inbo.be> wrote:
>> Dear Jan,
>>
>> Similar functionality is available in devtools::dev_package_deps()
>>
>> Best regards,
>>
>> ir. Thierry Onkelinx
>> Instituut voor natuur- en bosonderzoek / Research Institute for Nature and
>> Forest
>> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
>> Kliniekstraat 25
>> 1070 Anderlecht
>> Belgium
>>
>> To call in the statistician after the experiment is done may be no more
> than
>> asking him to perform a post-mortem examination: he may be able to say
> what
>> the experiment died of. ~ Sir Ronald Aylmer Fisher
>> The plural of anecdote is not data. ~ Roger Brinner
>> The combination of some data and an aching desire for an answer does not
>> ensure that a reasonable answer can be extracted from a given body of
> data.
>> ~ John Tukey
>>
>> 2016-06-14 16:54 GMT+02:00 Jan G?recki <J.Gorecki at wit.edu.pl>:
>>>
>>> Hi all,
>>>
>>> Packages tools and utils have a lot of useful stuff for R developers.
>>> I find one task still not as straightforward as it could. Simply to
>>> extract dependencies of a package from DESCRIPTION file (before it is
>>> even installed to library). This would be valuable in automation of CI
>>> setup in a more meta-data driven way.
>>> The simple function below, I know it is short and simple, but having
>>> it to be defined in each CI workflow is a pain, it could be already
>>> available in tools or utils namespace.
>>>
>>> package.dependencies.dcf <- function(file = "DESCRIPTION", which =
>>> c("Depends","Imports","LinkingTo")) {
>>>     stopifnot(file.exists(file), is.character(which))
>>>     which_all <- c("Depends", "Imports", "LinkingTo", "Suggests",
>>> "Enhances")
>>>     if (identical(which, "all"))
>>>         which <- which_all
>>>     else if (identical(which, "most"))
>>>         which <- c("Depends", "Imports", "LinkingTo", "Suggests")
>>>     stopifnot(which %in% which_all)
>>>     dcf <- read.dcf(file, which)
>>>     # parse fields
>>>     raw.deps <- unlist(strsplit(dcf[!is.na(dcf)], ",", fixed = TRUE))
>>>     # strip stated dependency version
>>>     deps <- trimws(sapply(strsplit(trimws(raw.deps), "(", fixed =
>>> TRUE), `[[`, 1L))
>>>     # exclude base R pkgs
>>>     base.pkgs <- c("R", rownames(installed.packages(priority = "base")))
>>>     setdiff(deps, base.pkgs)
>>> }
>>>
>>> This allows to easily install all package dependencies just based on
>>> DESCRIPTION file, so simplify that in custom CI workflows to:
>>>
>>> if (length(pkgs<-package.dependencies.dcf(which="all")))
>>> install.packages(pkgs)
>>>
>>> And would not require to install custom packages or shell scripts.
>>>
>>> Regards,
>>> Jan Gorecki
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From J.Gorecki at wit.edu.pl  Thu Jun 16 10:42:52 2016
From: J.Gorecki at wit.edu.pl (=?UTF-8?B?SmFuIEfDs3JlY2tp?=)
Date: Thu, 16 Jun 2016 09:42:52 +0100
Subject: [Rd] new function to tools/utils package: dependencies based on
 DESCRIPTION file
In-Reply-To: <CAO1zAVZ9Crr370SsRM9y17JJPsLBcV_GT7P4LT7Cv5Zh2xy48Q@mail.gmail.com>
References: <CABE2sp6e_kyX4vhR-uLAqpwNZxDyG-FD+AMBHE0uXp=c+UPQhw@mail.gmail.com>
	<CAJuCY5zfVudo7gyCi3NY1X012WgLyL7Tbkt7QeHy6zf0ZrQ2CA@mail.gmail.com>
	<CABE2sp7SrJtPDg-yZwdBDuNmSDoXv936i2biZzxUUaVEeQLa+g@mail.gmail.com>
	<CAO1zAVY9uAi3qEFUSBVDGdn50ijuhBDmJGHRL7cRNjaU01s6kA@mail.gmail.com>
	<CAO1zAVa69_0kh1ioXuqwq=R2t=5SeOHEZn0h7UJqjcKup45=xA@mail.gmail.com>
	<CAO1zAVZ9Crr370SsRM9y17JJPsLBcV_GT7P4LT7Cv5Zh2xy48Q@mail.gmail.com>
Message-ID: <CABE2sp4XfD8oSOdMdKEmxT=BFh05ZEPtKif7h+KdACLEWYuLDw@mail.gmail.com>

Dear Joris,

So it does looks like the proposed function makes a lot sense then, isn't it?

Cheers,
Jan

On 16 June 2016 at 08:37, Joris Meys <jorismeys at gmail.com> wrote:
> Dear Jan,
>
> It is unavoidable to have OS and R dependencies for devtools. The building
> process for packages is both OS and R dependent, so devtools has to be too
> according to my understanding.
>
> Cheers
> Joris
>
> On 14 Jun 2016 18:56, "Jan G?recki" <J.Gorecki at wit.edu.pl> wrote:
>
> Hi Thierry,
>
> I'm perfectly aware of it. Any idea when devtools would be shipped as
> a base R package, or at least recommended package? To actually answer
> the problem described in my email.
> I have range of useful functions available tools/utils packages which
> are shipped together with R. They doesn't require any OS dependencies
> or R dependencies, unlike devtools which requires both. Installing
> unnecessary OS dependencies and R dependencies just for such a simple
> wrapper doesn't seem to be an elegant way to address it, therefore my
> proposal to include that simple function in tools, or utils package.
>
> Regards,
> Jan Gorecki
>
> On 14 June 2016 at 16:17, Thierry Onkelinx <thierry.onkelinx at inbo.be> wrote:
>> Dear Jan,
>>
>> Similar functionality is available in devtools::dev_package_deps()
>>
>> Best regards,
>>
>> ir. Thierry Onkelinx
>> Instituut voor natuur- en bosonderzoek / Research Institute for Nature and
>> Forest
>> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
>> Kliniekstraat 25
>> 1070 Anderlecht
>> Belgium
>>
>> To call in the statistician after the experiment is done may be no more
>> than
>> asking him to perform a post-mortem examination: he may be able to say
>> what
>> the experiment died of. ~ Sir Ronald Aylmer Fisher
>> The plural of anecdote is not data. ~ Roger Brinner
>> The combination of some data and an aching desire for an answer does not
>> ensure that a reasonable answer can be extracted from a given body of
>> data.
>> ~ John Tukey
>>
>> 2016-06-14 16:54 GMT+02:00 Jan G?recki <J.Gorecki at wit.edu.pl>:
>>>
>>> Hi all,
>>>
>>> Packages tools and utils have a lot of useful stuff for R developers.
>>> I find one task still not as straightforward as it could. Simply to
>>> extract dependencies of a package from DESCRIPTION file (before it is
>>> even installed to library). This would be valuable in automation of CI
>>> setup in a more meta-data driven way.
>>> The simple function below, I know it is short and simple, but having
>>> it to be defined in each CI workflow is a pain, it could be already
>>> available in tools or utils namespace.
>>>
>>> package.dependencies.dcf <- function(file = "DESCRIPTION", which =
>>> c("Depends","Imports","LinkingTo")) {
>>>     stopifnot(file.exists(file), is.character(which))
>>>     which_all <- c("Depends", "Imports", "LinkingTo", "Suggests",
>>> "Enhances")
>>>     if (identical(which, "all"))
>>>         which <- which_all
>>>     else if (identical(which, "most"))
>>>         which <- c("Depends", "Imports", "LinkingTo", "Suggests")
>>>     stopifnot(which %in% which_all)
>>>     dcf <- read.dcf(file, which)
>>>     # parse fields
>>>     raw.deps <- unlist(strsplit(dcf[!is.na(dcf)], ",", fixed = TRUE))
>>>     # strip stated dependency version
>>>     deps <- trimws(sapply(strsplit(trimws(raw.deps), "(", fixed =
>>> TRUE), `[[`, 1L))
>>>     # exclude base R pkgs
>>>     base.pkgs <- c("R", rownames(installed.packages(priority = "base")))
>>>     setdiff(deps, base.pkgs)
>>> }
>>>
>>> This allows to easily install all package dependencies just based on
>>> DESCRIPTION file, so simplify that in custom CI workflows to:
>>>
>>> if (length(pkgs<-package.dependencies.dcf(which="all")))
>>> install.packages(pkgs)
>>>
>>> And would not require to install custom packages or shell scripts.
>>>
>>> Regards,
>>> Jan Gorecki
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From lawrence.michael at gene.com  Thu Jun 16 15:00:26 2016
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Thu, 16 Jun 2016 06:00:26 -0700
Subject: [Rd] new function to tools/utils package: dependencies based on
 DESCRIPTION file
In-Reply-To: <CABE2sp4XfD8oSOdMdKEmxT=BFh05ZEPtKif7h+KdACLEWYuLDw@mail.gmail.com>
References: <CABE2sp6e_kyX4vhR-uLAqpwNZxDyG-FD+AMBHE0uXp=c+UPQhw@mail.gmail.com>
	<CAJuCY5zfVudo7gyCi3NY1X012WgLyL7Tbkt7QeHy6zf0ZrQ2CA@mail.gmail.com>
	<CABE2sp7SrJtPDg-yZwdBDuNmSDoXv936i2biZzxUUaVEeQLa+g@mail.gmail.com>
	<CAO1zAVY9uAi3qEFUSBVDGdn50ijuhBDmJGHRL7cRNjaU01s6kA@mail.gmail.com>
	<CAO1zAVa69_0kh1ioXuqwq=R2t=5SeOHEZn0h7UJqjcKup45=xA@mail.gmail.com>
	<CAO1zAVZ9Crr370SsRM9y17JJPsLBcV_GT7P4LT7Cv5Zh2xy48Q@mail.gmail.com>
	<CABE2sp4XfD8oSOdMdKEmxT=BFh05ZEPtKif7h+KdACLEWYuLDw@mail.gmail.com>
Message-ID: <CAOQ5NyccwgSaL9VD0aWDZovm7gq0FT2OCoQh_3RfeBBUm2kqGA@mail.gmail.com>

I agree that the utils package needs some improvements related to
this, and hope to make them eventually. This type of feedback is very
helpful.

Thanks,
Michael



On Thu, Jun 16, 2016 at 1:42 AM, Jan G?recki <J.Gorecki at wit.edu.pl> wrote:
> Dear Joris,
>
> So it does looks like the proposed function makes a lot sense then, isn't it?
>
> Cheers,
> Jan
>
> On 16 June 2016 at 08:37, Joris Meys <jorismeys at gmail.com> wrote:
>> Dear Jan,
>>
>> It is unavoidable to have OS and R dependencies for devtools. The building
>> process for packages is both OS and R dependent, so devtools has to be too
>> according to my understanding.
>>
>> Cheers
>> Joris
>>
>> On 14 Jun 2016 18:56, "Jan G?recki" <J.Gorecki at wit.edu.pl> wrote:
>>
>> Hi Thierry,
>>
>> I'm perfectly aware of it. Any idea when devtools would be shipped as
>> a base R package, or at least recommended package? To actually answer
>> the problem described in my email.
>> I have range of useful functions available tools/utils packages which
>> are shipped together with R. They doesn't require any OS dependencies
>> or R dependencies, unlike devtools which requires both. Installing
>> unnecessary OS dependencies and R dependencies just for such a simple
>> wrapper doesn't seem to be an elegant way to address it, therefore my
>> proposal to include that simple function in tools, or utils package.
>>
>> Regards,
>> Jan Gorecki
>>
>> On 14 June 2016 at 16:17, Thierry Onkelinx <thierry.onkelinx at inbo.be> wrote:
>>> Dear Jan,
>>>
>>> Similar functionality is available in devtools::dev_package_deps()
>>>
>>> Best regards,
>>>
>>> ir. Thierry Onkelinx
>>> Instituut voor natuur- en bosonderzoek / Research Institute for Nature and
>>> Forest
>>> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
>>> Kliniekstraat 25
>>> 1070 Anderlecht
>>> Belgium
>>>
>>> To call in the statistician after the experiment is done may be no more
>>> than
>>> asking him to perform a post-mortem examination: he may be able to say
>>> what
>>> the experiment died of. ~ Sir Ronald Aylmer Fisher
>>> The plural of anecdote is not data. ~ Roger Brinner
>>> The combination of some data and an aching desire for an answer does not
>>> ensure that a reasonable answer can be extracted from a given body of
>>> data.
>>> ~ John Tukey
>>>
>>> 2016-06-14 16:54 GMT+02:00 Jan G?recki <J.Gorecki at wit.edu.pl>:
>>>>
>>>> Hi all,
>>>>
>>>> Packages tools and utils have a lot of useful stuff for R developers.
>>>> I find one task still not as straightforward as it could. Simply to
>>>> extract dependencies of a package from DESCRIPTION file (before it is
>>>> even installed to library). This would be valuable in automation of CI
>>>> setup in a more meta-data driven way.
>>>> The simple function below, I know it is short and simple, but having
>>>> it to be defined in each CI workflow is a pain, it could be already
>>>> available in tools or utils namespace.
>>>>
>>>> package.dependencies.dcf <- function(file = "DESCRIPTION", which =
>>>> c("Depends","Imports","LinkingTo")) {
>>>>     stopifnot(file.exists(file), is.character(which))
>>>>     which_all <- c("Depends", "Imports", "LinkingTo", "Suggests",
>>>> "Enhances")
>>>>     if (identical(which, "all"))
>>>>         which <- which_all
>>>>     else if (identical(which, "most"))
>>>>         which <- c("Depends", "Imports", "LinkingTo", "Suggests")
>>>>     stopifnot(which %in% which_all)
>>>>     dcf <- read.dcf(file, which)
>>>>     # parse fields
>>>>     raw.deps <- unlist(strsplit(dcf[!is.na(dcf)], ",", fixed = TRUE))
>>>>     # strip stated dependency version
>>>>     deps <- trimws(sapply(strsplit(trimws(raw.deps), "(", fixed =
>>>> TRUE), `[[`, 1L))
>>>>     # exclude base R pkgs
>>>>     base.pkgs <- c("R", rownames(installed.packages(priority = "base")))
>>>>     setdiff(deps, base.pkgs)
>>>> }
>>>>
>>>> This allows to easily install all package dependencies just based on
>>>> DESCRIPTION file, so simplify that in custom CI workflows to:
>>>>
>>>> if (length(pkgs<-package.dependencies.dcf(which="all")))
>>>> install.packages(pkgs)
>>>>
>>>> And would not require to install custom packages or shell scripts.
>>>>
>>>> Regards,
>>>> Jan Gorecki
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From karl.forner at gmail.com  Thu Jun 16 18:09:53 2016
From: karl.forner at gmail.com (Karl Forner)
Date: Thu, 16 Jun 2016 18:09:53 +0200
Subject: [Rd] mcparallel (parallel:::mcexit) does not call finalizers
Message-ID: <CAMd4_Ae42V+4BmbD3xh6YP_0yA7Ox4nqd1USFZEqO6eHA0SZvw@mail.gmail.com>

Hello,

In the context of trying to cover a package code that use parallelized
tests using the covr package, I realized that code executed using
mcparallel() was not covered,
cf https://github.com/jimhester/covr/issues/189#issuecomment-226492623

>From my understanding, it seems that the package finalizer set by covr (cf
https://github.com/jimhester/covr/blob/79f7e0434f3d14a48c6fea994b67b9814b34e4e5/R/covr.R#L348)
is not called, because the forked process exits using parallel:::mcexit,
which is a non standard exit and does not call some of the cleanup code
(e.g. the R_CleanUp function is not called).

I was wondering if a modification of the parallel mcexit could be
considered, to make it call the finalizers, possibly triggered by a
parameter or an option, or if there are solid reasons not to do so.

Regards,
Karl Forner

	[[alternative HTML version deleted]]


From spencer.graves at prodsyse.com  Sat Jun 18 04:21:20 2016
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Fri, 17 Jun 2016 21:21:20 -0500
Subject: [Rd] Error in texi2dvi
Message-ID: <8dde17ae-a358-7b0b-028b-62359a2be35e@prodsyse.com>

Hello:


       Changes in R seem to have broken the sos vignette, and I don't 
know how to fix it.  The build on R-forge, 
"https://r-forge.r-project.org/R/?group_id=235&log=build_src&pkg=sos&flavor=patched", 
ends as follows:


Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
   Running 'texi2dvi' on 'sos.tex' failed.
LaTeX errors:
! Undefined control sequence.
l.1 \Sconcordance
                  {concordance:sos.tex:sos.Rnw:%
The control sequence at the end of the top line
of your error message was never \def'ed. If you have
Calls:  -> texi2pdf -> texi2dvi
Execution halted


       I stepped through the vignette line by line without seeing an 
error message.  However, when I do "R CMD build sos" on my own computer, 
it stops with a similar error message:


Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
   Running 'texi2dvi' on 'sos.tex' failed.
BibTeX errors:
The top-level auxiliary file: sos.aux
The style file: abbrvnat.bst
I found no \bibdata command---while reading file sos.aux
Calls: <Anonymous> -> texi2pdf -> texi2dvi


       When I clicked, "Compile PDF" in RStudio, I first got a pop-up 
saying, 'Sweave Noweb syntax? It seems you are using the Sweave-specific 
syntax in line(s) 9, 15, 145, 172, 186, 189, 208, 211, 218, 225, 231, 
243, 246, 283, 365, 390; you may need Sweave2knitr("sos.Rnw") to convert 
it to knitr'.  When I click, "OK", it stops on LIne 146, "Error in 
eval(expr, envir, enclos) : object 'hide' not found".  Line 145 reads, 
"<<summary.PL,results=hide>>=".


       What can I do to get this vignette to working again with the 
least amount of work?


       Thanks,
       Spencer Graves


From spencer.graves at prodsyse.com  Sat Jun 18 04:50:47 2016
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Fri, 17 Jun 2016 21:50:47 -0500
Subject: [Rd] vignette output: word_document problems
Message-ID: <a6b8a410-5a38-5b40-4949-2658bc86157d@prodsyse.com>

Hello:


        Clicking "Knit Word" in RStudio 0.99.893 with R 3.3.0, works 
fine with a vignette with "output: word_document".  However, "R CMD 
build" throws the following error:


$ R CMD build pkgW2vignettes
* checking for file ?pkgW2vignettes/DESCRIPTION? ... OK
* preparing ?pkgW2vignettes?:
* checking DESCRIPTION meta-information ... OK
* installing the package to build vignettes
* creating vignettes ... ERROR
Error: processing vignette 'vignette2word_document.Rmd' failed with 
diagnostics:
Failed to locate the ?weave? output file (by engine ?knitr::rmarkdown?) 
for vignette with name ?vignette2word_document?. The following files 
exist in directory ?.?: ?vignette1createsObject1.R?, 
?vignette1createsObject1.Rmd?, ?vignette1createsObject1.html?, 
?vignette2confusedByObject1.R?, ?vignette2confusedByObject1.Rmd?, 
?vignette2confusedByObject1.html?, ?vignette2word_document.Rmd?, 
?vignette2word_document.docx?
Execution halted


        A toy example showing this problem is in rev. 239 of 
"vignette2word_document.Rmd" in "pkgW2vignettes" on R-Forge 
(https://r-forge.r-project.org/R/?group_id=235).


        Is there a way to get "R CMD build" to work with a vignette with 
output: word_document?


        Thanks,
        Spencer Graves


pkgW2vignettes


I can knit
with a vignette using RStudio 0.99.893 with R 3.3.0, I can knit




  > sessionInfo()
R version 3.3.0 (2016-05-03)
Platform: x86_64-apple-darwin13.4.0 (64-bit)
Running under: OS X 10.11.5 (El Capitan)

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets
[6] methods   base

other attached packages:
[1] WriteXLS_4.0.0 sos_1.3-8      brew_1.0-6

loaded via a namespace (and not attached):
[1] htmltools_0.3.5 tools_3.3.0     yaml_2.1.13
[4] Rcpp_0.12.5     rmarkdown_0.9.6 knitr_1.13
[7] digest_0.6.9
  >


From murdoch.duncan at gmail.com  Sat Jun 18 13:20:48 2016
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 18 Jun 2016 07:20:48 -0400
Subject: [Rd] Error in texi2dvi
In-Reply-To: <8dde17ae-a358-7b0b-028b-62359a2be35e@prodsyse.com>
References: <8dde17ae-a358-7b0b-028b-62359a2be35e@prodsyse.com>
Message-ID: <f0e97759-d749-44e0-578f-57f8a8a7779c@gmail.com>

On 17/06/2016 10:21 PM, Spencer Graves wrote:
> Hello:
>
>
>        Changes in R seem to have broken the sos vignette, and I don't
> know how to fix it.  The build on R-forge,
> "https://r-forge.r-project.org/R/?group_id=235&log=build_src&pkg=sos&flavor=patched",
> ends as follows:
>
>
> Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
>    Running 'texi2dvi' on 'sos.tex' failed.
> LaTeX errors:
> ! Undefined control sequence.
> l.1 \Sconcordance
>                   {concordance:sos.tex:sos.Rnw:%
> The control sequence at the end of the top line
> of your error message was never \def'ed. If you have
> Calls:  -> texi2pdf -> texi2dvi
> Execution halted
>
>
>        I stepped through the vignette line by line without seeing an
> error message.  However, when I do "R CMD build sos" on my own computer,
> it stops with a similar error message:
>
>
> Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
>    Running 'texi2dvi' on 'sos.tex' failed.
> BibTeX errors:
> The top-level auxiliary file: sos.aux
> The style file: abbrvnat.bst
> I found no \bibdata command---while reading file sos.aux
> Calls: <Anonymous> -> texi2pdf -> texi2dvi
>

I can't help you with R-forge.  You'll need to write to their admin to ask.

>
>        When I clicked, "Compile PDF" in RStudio, I first got a pop-up
> saying, 'Sweave Noweb syntax? It seems you are using the Sweave-specific
> syntax in line(s) 9, 15, 145, 172, 186, 189, 208, 211, 218, 225, 231,
> 243, 246, 283, 365, 390; you may need Sweave2knitr("sos.Rnw") to convert
> it to knitr'.  When I click, "OK", it stops on LIne 146, "Error in
> eval(expr, envir, enclos) : object 'hide' not found".  Line 145 reads,
> "<<summary.PL,results=hide>>=".

In RStudio, you are running knitr rather than Sweave, but your vignette 
uses Sweave syntax.  This is an option you can set in "Global options" 
and "Project options"; the latter take precedence.

Duncan Murdoch

>
>
>        What can I do to get this vignette to working again with the
> least amount of work?
>
>
>        Thanks,
>        Spencer Graves
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From murdoch.duncan at gmail.com  Sat Jun 18 13:22:38 2016
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 18 Jun 2016 07:22:38 -0400
Subject: [Rd] vignette output: word_document problems
In-Reply-To: <a6b8a410-5a38-5b40-4949-2658bc86157d@prodsyse.com>
References: <a6b8a410-5a38-5b40-4949-2658bc86157d@prodsyse.com>
Message-ID: <346795ab-182a-b800-124b-4b59a8000bf7@gmail.com>

On 17/06/2016 10:50 PM, Spencer Graves wrote:
> Hello:
>
>
>         Clicking "Knit Word" in RStudio 0.99.893 with R 3.3.0, works
> fine with a vignette with "output: word_document".  However, "R CMD
> build" throws the following error:
>
>
> $ R CMD build pkgW2vignettes
> * checking for file ?pkgW2vignettes/DESCRIPTION? ... OK
> * preparing ?pkgW2vignettes?:
> * checking DESCRIPTION meta-information ... OK
> * installing the package to build vignettes
> * creating vignettes ... ERROR
> Error: processing vignette 'vignette2word_document.Rmd' failed with
> diagnostics:
> Failed to locate the ?weave? output file (by engine ?knitr::rmarkdown?)
> for vignette with name ?vignette2word_document?. The following files
> exist in directory ?.?: ?vignette1createsObject1.R?,
> ?vignette1createsObject1.Rmd?, ?vignette1createsObject1.html?,
> ?vignette2confusedByObject1.R?, ?vignette2confusedByObject1.Rmd?,
> ?vignette2confusedByObject1.html?, ?vignette2word_document.Rmd?,
> ?vignette2word_document.docx?
> Execution halted
>
>
>         A toy example showing this problem is in rev. 239 of
> "vignette2word_document.Rmd" in "pkgW2vignettes" on R-Forge
> (https://r-forge.r-project.org/R/?group_id=235).
>
>
>         Is there a way to get "R CMD build" to work with a vignette with
> output: word_document?
>

Not easily.  Vignette outputs need to be HTML or PDF.  You'll need to 
add another step to the processing to convert the .docx file to one of 
those.

Duncan Murdoch

>
>         Thanks,
>         Spencer Graves
>
>
> pkgW2vignettes
>
>
> I can knit
> with a vignette using RStudio 0.99.893 with R 3.3.0, I can knit
>
>
>
>
>   > sessionInfo()
> R version 3.3.0 (2016-05-03)
> Platform: x86_64-apple-darwin13.4.0 (64-bit)
> Running under: OS X 10.11.5 (El Capitan)
>
> locale:
> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets
> [6] methods   base
>
> other attached packages:
> [1] WriteXLS_4.0.0 sos_1.3-8      brew_1.0-6
>
> loaded via a namespace (and not attached):
> [1] htmltools_0.3.5 tools_3.3.0     yaml_2.1.13
> [4] Rcpp_0.12.5     rmarkdown_0.9.6 knitr_1.13
> [7] digest_0.6.9
>   >
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From spencer.graves at prodsyse.com  Sat Jun 18 15:09:28 2016
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Sat, 18 Jun 2016 08:09:28 -0500
Subject: [Rd] Error in texi2dvi
In-Reply-To: <f0e97759-d749-44e0-578f-57f8a8a7779c@gmail.com>
References: <8dde17ae-a358-7b0b-028b-62359a2be35e@prodsyse.com>
	<f0e97759-d749-44e0-578f-57f8a8a7779c@gmail.com>
Message-ID: <b1d30444-8575-a8d6-1bd3-30f391678b50@prodsyse.com>

Hi, Duncan:  Please excuse:  I mixed 2 questions in one email.


       My first question was why "texi2dvi" failed.  It fails with "R 
CMD build" on my notebook computer and on R-Forge, but don't know how to 
make it fail otherwise.  AND it fails in something I don't think I've 
changed in years.  I mentioned R-Forge, because that provides a 
replicable example.  All CRAN tests now show Status: NOTE, but when I 
click on "NOTE", I get nothing.  In Safari and FireFox, nothing 
happens.  In Chrome, the screen goes blank.


       I'll try to refer the second question to someone at RStudio.


       Thanks,
       Spencer Graves


On 6/18/2016 6:20 AM, Duncan Murdoch wrote:
> On 17/06/2016 10:21 PM, Spencer Graves wrote:
>> Hello:
>>
>>
>>        Changes in R seem to have broken the sos vignette, and I don't
>> know how to fix it.  The build on R-forge,
>> "https://r-forge.r-project.org/R/?group_id=235&log=build_src&pkg=sos&flavor=patched", 
>>
>> ends as follows:
>>
>>
>> Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = 
>> quiet,  :
>>    Running 'texi2dvi' on 'sos.tex' failed.
>> LaTeX errors:
>> ! Undefined control sequence.
>> l.1 \Sconcordance
>>                   {concordance:sos.tex:sos.Rnw:%
>> The control sequence at the end of the top line
>> of your error message was never \def'ed. If you have
>> Calls:  -> texi2pdf -> texi2dvi
>> Execution halted
>>
>>
>>        I stepped through the vignette line by line without seeing an
>> error message.  However, when I do "R CMD build sos" on my own computer,
>> it stops with a similar error message:
>>
>>
>> Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = 
>> quiet,  :
>>    Running 'texi2dvi' on 'sos.tex' failed.
>> BibTeX errors:
>> The top-level auxiliary file: sos.aux
>> The style file: abbrvnat.bst
>> I found no \bibdata command---while reading file sos.aux
>> Calls: <Anonymous> -> texi2pdf -> texi2dvi
>>
>
> I can't help you with R-forge.  You'll need to write to their admin to 
> ask.
>
>>
>>        When I clicked, "Compile PDF" in RStudio, I first got a pop-up
>> saying, 'Sweave Noweb syntax? It seems you are using the Sweave-specific
>> syntax in line(s) 9, 15, 145, 172, 186, 189, 208, 211, 218, 225, 231,
>> 243, 246, 283, 365, 390; you may need Sweave2knitr("sos.Rnw") to convert
>> it to knitr'.  When I click, "OK", it stops on LIne 146, "Error in
>> eval(expr, envir, enclos) : object 'hide' not found".  Line 145 reads,
>> "<<summary.PL,results=hide>>=".
>
> In RStudio, you are running knitr rather than Sweave, but your 
> vignette uses Sweave syntax.  This is an option you can set in "Global 
> options" and "Project options"; the latter take precedence.
>
> Duncan Murdoch
>
>>
>>
>>        What can I do to get this vignette to working again with the
>> least amount of work?
>>
>>
>>        Thanks,
>>        Spencer Graves
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>


From mikko.korpela at helsinki.fi  Mon Jun 20 13:50:16 2016
From: mikko.korpela at helsinki.fi (Mikko Korpela)
Date: Mon, 20 Jun 2016 14:50:16 +0300
Subject: [Rd] Error in texi2dvi
In-Reply-To: <8dde17ae-a358-7b0b-028b-62359a2be35e@prodsyse.com>
References: <8dde17ae-a358-7b0b-028b-62359a2be35e@prodsyse.com>
Message-ID: <5767D878.7070003@helsinki.fi>

On 18/06/16 05:21, Spencer Graves wrote:
> Hello:
>
>
>        Changes in R seem to have broken the sos vignette, and I don't
> know how to fix it.  The build on R-forge,
> "https://r-forge.r-project.org/R/?group_id=235&log=build_src&pkg=sos&flavor=patched",
> ends as follows:
>
>
> Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
>    Running 'texi2dvi' on 'sos.tex' failed.
> LaTeX errors:
> ! Undefined control sequence.
> l.1 \Sconcordance
>                   {concordance:sos.tex:sos.Rnw:%
> The control sequence at the end of the top line
> of your error message was never \def'ed. If you have
> Calls:  -> texi2pdf -> texi2dvi
> Execution halted
>

...

>        What can I do to get this vignette to working again with the
> least amount of work?

Try commenting out (removing) the following line in your vignette:

\SweaveOpts{concordance=TRUE}

The package builds just fine after doing that, on this computer. The 
R-Forge history of sos.Rnw shows the line was added on May 12, revision 237.

-- 
Mikko Korpela
Department of Geosciences and Geography
University of Helsinki


From spencer.graves at prodsyse.com  Mon Jun 20 16:19:18 2016
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Mon, 20 Jun 2016 09:19:18 -0500
Subject: [Rd] RODBC on Mac & _R_CHECK_FORCE_SUGGESTS_
Message-ID: <d8fa2836-d7e8-0858-9349-026b1f268029@prodsyse.com>

        "R CMD check sos" with R 3.3.0 under Mac OS X 10.11.5 ends as 
follows:


  >* checking package dependencies ... ERROR
  >Package suggested but not available: ?RODBC?
  >
  >The suggested packages are required for a complete check.
  >Checking can be attempted without them by setting the environment
  >variable _R_CHECK_FORCE_SUGGESTS_ to a false value.


        Unfortunately, "install.packages('RODBC')" says it's only 
available in source form.  When I  attempt to install from sources, it 
fails as follows:


  >checking for sqlext.h... no
  >configure: error: "ODBC headers sql.h and sqlext.h not found"
  >ERROR: configuration failed for package ?RODBC?
  >* removing 
?/Library/Frameworks/R.framework/Versions/3.3/Resources/library/RODBC?
  >Warning in install.packages :
  >  installation of package ?RODBC? had non-zero exit status


        The CRAN checks for RODBC also failed for the same reason 
(https://cloud.r-project.org/web/checks/check_results_RODBC.html).



        I'm not sure how to set "the environment variable 
_R_CHECK_FORCE_SUGGESTS_ to a false value" on my Mac, and I'd rather not 
do it permanently.  I tried various versions of "R CMD check 
_R_CHECK_FORCE_SUGGESTS_=FALSE sos_1.3-9.tar.gz" and "R CMD check 
_R_CHECK_FORCE_SUGGESTS_=0 sos_1.3-9.tar.gz", none of which worked. 
Somewhere I found a suggestion to try, "R CMD check --as-cran 
sos_1.3-9.tar.gz".  That also failed for me.


        Suggestions?
        Thanks,
        Spencer Graves


From josh.m.ulrich at gmail.com  Mon Jun 20 16:56:51 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Mon, 20 Jun 2016 09:56:51 -0500
Subject: [Rd] RODBC on Mac & _R_CHECK_FORCE_SUGGESTS_
In-Reply-To: <d8fa2836-d7e8-0858-9349-026b1f268029@prodsyse.com>
References: <d8fa2836-d7e8-0858-9349-026b1f268029@prodsyse.com>
Message-ID: <CAPPM_gR2T-8rpWepd_kTABKSMmJSb1WPzK7x3NXfABcNG5gB4w@mail.gmail.com>

On Mon, Jun 20, 2016 at 9:19 AM, Spencer Graves
<spencer.graves at prodsyse.com> wrote:
>        "R CMD check sos" with R 3.3.0 under Mac OS X 10.11.5 ends as
> follows:
>
>
>  >* checking package dependencies ... ERROR
>  >Package suggested but not available: ?RODBC?
>  >
>  >The suggested packages are required for a complete check.
>  >Checking can be attempted without them by setting the environment
>  >variable _R_CHECK_FORCE_SUGGESTS_ to a false value.
>
>
>        Unfortunately, "install.packages('RODBC')" says it's only available
> in source form.  When I  attempt to install from sources, it fails as
> follows:
>
>
>  >checking for sqlext.h... no
>  >configure: error: "ODBC headers sql.h and sqlext.h not found"
>  >ERROR: configuration failed for package ?RODBC?
>  >* removing
> ?/Library/Frameworks/R.framework/Versions/3.3/Resources/library/RODBC?
>  >Warning in install.packages :
>  >  installation of package ?RODBC? had non-zero exit status
>
>
>        The CRAN checks for RODBC also failed for the same reason
> (https://cloud.r-project.org/web/checks/check_results_RODBC.html).
>
>
>
>        I'm not sure how to set "the environment variable
> _R_CHECK_FORCE_SUGGESTS_ to a false value" on my Mac, and I'd rather not do
> it permanently.  I tried various versions of "R CMD check
> _R_CHECK_FORCE_SUGGESTS_=FALSE sos_1.3-9.tar.gz" and "R CMD check
> _R_CHECK_FORCE_SUGGESTS_=0 sos_1.3-9.tar.gz", none of which worked.
> Somewhere I found a suggestion to try, "R CMD check --as-cran
> sos_1.3-9.tar.gz".  That also failed for me.
>
_R_CHECK_FORCE_SUGGESTS_=FALSE R CMD check sos_1.3-9.tar.gz

>
>        Suggestions?
>        Thanks,
>        Spencer Graves
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From marc_schwartz at me.com  Mon Jun 20 17:00:01 2016
From: marc_schwartz at me.com (Marc Schwartz)
Date: Mon, 20 Jun 2016 10:00:01 -0500
Subject: [Rd] RODBC on Mac & _R_CHECK_FORCE_SUGGESTS_
In-Reply-To: <d8fa2836-d7e8-0858-9349-026b1f268029@prodsyse.com>
References: <d8fa2836-d7e8-0858-9349-026b1f268029@prodsyse.com>
Message-ID: <96CEA5EF-938B-4F42-BB95-166C6EBE1CD6@me.com>


> On Jun 20, 2016, at 9:19 AM, Spencer Graves <spencer.graves at prodsyse.com> wrote:
> 
>       "R CMD check sos" with R 3.3.0 under Mac OS X 10.11.5 ends as follows:
> 
> 
> >* checking package dependencies ... ERROR
> >Package suggested but not available: ?RODBC?
> >
> >The suggested packages are required for a complete check.
> >Checking can be attempted without them by setting the environment
> >variable _R_CHECK_FORCE_SUGGESTS_ to a false value.
> 
> 
>       Unfortunately, "install.packages('RODBC')" says it's only available in source form.  When I  attempt to install from sources, it fails as follows:
> 
> 
> >checking for sqlext.h... no
> >configure: error: "ODBC headers sql.h and sqlext.h not found"
> >ERROR: configuration failed for package ?RODBC?
> >* removing ?/Library/Frameworks/R.framework/Versions/3.3/Resources/library/RODBC?
> >Warning in install.packages :
> >  installation of package ?RODBC? had non-zero exit status
> 
> 
>       The CRAN checks for RODBC also failed for the same reason (https://cloud.r-project.org/web/checks/check_results_RODBC.html).
> 
> 
> 
>       I'm not sure how to set "the environment variable _R_CHECK_FORCE_SUGGESTS_ to a false value" on my Mac, and I'd rather not do it permanently.  I tried various versions of "R CMD check _R_CHECK_FORCE_SUGGESTS_=FALSE sos_1.3-9.tar.gz" and "R CMD check _R_CHECK_FORCE_SUGGESTS_=0 sos_1.3-9.tar.gz", none of which worked. Somewhere I found a suggestion to try, "R CMD check --as-cran sos_1.3-9.tar.gz".  That also failed for me.
> 
> 
>       Suggestions?
>       Thanks,
>       Spencer Graves


Spencer,

The RODBC related error is a common issue and is covered in the vignette for the RODBC package in Appendix A "Installation":

  https://cran.r-project.org/web/packages/RODBC/vignettes/RODBC.pdf

You are missing the two iODBC header files that are required to compile the RODBC package from source code.

When I install RODBC on my Mac running 10.11.5 (El Capitan), I use:

install.packages("RODBC", type = "source", 
                 configure.args = "--with-odbc-include=/Users/marcschwartz/R.Files/SourceAndBinaries/OSX-Tools/iODBC/libiodbc-3.52.10/include/")

where I have placed the extracted iODBC source tarball in:

  /Users/marcschwartz/R.Files/SourceAndBinaries/OSX-Tools/iODBC

The:

  configure.args = "--with-odbc-include=..." 

part of the function call points to where the header files are located after extraction from the tarball as per the vignette.

The iODBC source tarball can be downloaded from:

  http://www.iodbc.org/dataspace/iodbc/wiki/iODBC/Downloads


If you want to temporarily set the OS X environment variable, you can open an OS X Terminal and in the console, use:

  export _R_CHECK_FORCE_SUGGESTS_=FALSE 

You can then check to see if it is set by using:

  env 

in the Terminal and/or with the following in an R console run from within that same Terminal session:

> Sys.getenv("_R_CHECK_FORCE_SUGGESTS_")
[1] "FALSE"


Once you close that Terminal session, that modified environment is lost.

Also, at least the RODBC part of the issue should have been posted to R-SIG-DB (https://stat.ethz.ch/mailman/listinfo/r-sig-db), since it is DB interface specific. Most queries about RODBC are there in the archives, including those covering the missing headers.

The part that covers issues vis-a-vis checking your own package should go to R-Package-Devel:

  https://stat.ethz.ch/mailman/listinfo/r-package-devel

rather than R-Devel.

Regards,

Marc Schwartz


From spencer.graves at prodsyse.com  Mon Jun 20 17:48:47 2016
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Mon, 20 Jun 2016 10:48:47 -0500
Subject: [Rd] RODBC on Mac & _R_CHECK_FORCE_SUGGESTS_
In-Reply-To: <CAPPM_gR2T-8rpWepd_kTABKSMmJSb1WPzK7x3NXfABcNG5gB4w@mail.gmail.com>
References: <d8fa2836-d7e8-0858-9349-026b1f268029@prodsyse.com>
	<CAPPM_gR2T-8rpWepd_kTABKSMmJSb1WPzK7x3NXfABcNG5gB4w@mail.gmail.com>
Message-ID: <01f750bb-677c-8ccc-651a-2eec2c94bd58@prodsyse.com>

Hi, Joshua et al.:


       Could someone add Joshua's fix to "Writing R Extensions"?


       This seems like a problem that could affect others, and it would 
be great to have this documented there.  (It worked for me!)


       Thanks,
       Spencer


On 6/20/2016 9:56 AM, Joshua Ulrich wrote:
> On Mon, Jun 20, 2016 at 9:19 AM, Spencer Graves
> <spencer.graves at prodsyse.com> wrote:
>>         "R CMD check sos" with R 3.3.0 under Mac OS X 10.11.5 ends as
>> follows:
>>
>>
>>   >* checking package dependencies ... ERROR
>>   >Package suggested but not available: ?RODBC?
>>   >
>> <snip>
>>
> _R_CHECK_FORCE_SUGGESTS_=FALSE R CMD check sos_1.3-9.tar.gz
>
>>         Suggestions?
>>         Thanks,
>>         Spencer Graves
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From d.scott at auckland.ac.nz  Mon Jun 20 19:28:23 2016
From: d.scott at auckland.ac.nz (David Scott)
Date: Tue, 21 Jun 2016 05:28:23 +1200
Subject: [Rd] [FORGED] Re:  Error in texi2dvi
In-Reply-To: <5767D878.7070003@helsinki.fi>
References: <8dde17ae-a358-7b0b-028b-62359a2be35e@prodsyse.com>
	<5767D878.7070003@helsinki.fi>
Message-ID: <af787738-70a2-080b-a6f6-b6ce9f56d973@auckland.ac.nz>



On 20/06/2016 11:50 p.m., Mikko Korpela wrote:
> On 18/06/16 05:21, Spencer Graves wrote:
>> Hello:
>>
>>
>>        Changes in R seem to have broken the sos vignette, and I don't
>> know how to fix it.  The build on R-forge,
>> "https://r-forge.r-project.org/R/?group_id=235&log=build_src&pkg=sos&flavor=patched", 
>>
>> ends as follows:
>>
>>
>> Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = 
>> quiet,  :
>>    Running 'texi2dvi' on 'sos.tex' failed.
>> LaTeX errors:
>> ! Undefined control sequence.
>> l.1 \Sconcordance
>>                   {concordance:sos.tex:sos.Rnw:%
>> The control sequence at the end of the top line
>> of your error message was never \def'ed. If you have
>> Calls:  -> texi2pdf -> texi2dvi
>> Execution halted
>>
>
> ...
>
>>        What can I do to get this vignette to working again with the
>> least amount of work?
>
> Try commenting out (removing) the following line in your vignette:
>
> \SweaveOpts{concordance=TRUE}
>
> The package builds just fine after doing that, on this computer. The 
> R-Forge history of sos.Rnw shows the line was added on May 12, 
> revision 237.
>
This is an annoying RStudio *feature*.

Much as I appreciate RStudio's contribution to the R community, I don't 
approve of software which adds code to your document without informing you.

David Scott

-- 
_________________________________________________________________
David Scott	Department of Statistics
		The University of Auckland, PB 92019
		Auckland 1142,    NEW ZEALAND
Phone: +64 9 923 5055, or +64 9 373 7599 ext 85055
Email:	d.scott at auckland.ac.nz,  Fax: +64 9 373 7018


From frederik at ofb.net  Mon Jun 20 20:43:46 2016
From: frederik at ofb.net (frederik at ofb.net)
Date: Mon, 20 Jun 2016 11:43:46 -0700
Subject: [Rd] getGraphicsEvent on X11 and event queuing
In-Reply-To: <20160614153413.GA24958@ofb.net>
References: <20160607013845.GA21587@ofb.net> <20160607222005.GB6983@ofb.net>
	<22361.33450.594773.902489@stat.math.ethz.ch>
	<20160614153413.GA24958@ofb.net>
Message-ID: <20160620184346.GF32398@ofb.net>

Hi R-Devel and Duncan,

Any ideas about my patch? I'm including Duncan Murdoch since he was
actually the one who made the "fix" to Hugo's bug in September 2010.
Duncan chose to "fix" Cairo support by formally disabling it, rather
than by enabling it as Hugo had proposed. I don't see a reply to
Hugo's January 2011 question, asking why this was done. Hugo's patch
was pretty simple:

        if(!using cairo) {
            xlib stuff
    -        set up for getGraphicsEvent
        }
    +    set up for getGraphicsEvent

Sorry to be annoying, but I'm not sure how long I should wait for an
acknowledgment. Perhaps Duncan is waiting for someone else to take the
lead in this? I think it would be great if R maintainers could
delegate commit powers to more people so that time isn't wasted by
eager contributors duplicating each other's no-brainer patches which
were ignored many years ago. I guess there is a lot more interest in
Windows than Linux, but maybe that means that someone should be
assigned to handle Linux-specific changes who cares about them. (I see
a lot of Word-document, Windows-character-set, and RStudio stuff on
this list, so I sympathize with any disinterest there may be in Linux
Xlib problems)

Let me know if you'd like to divorce the "onIdle" part of my patch
from the Cairo-enabling part and discuss those separately, perhaps
that would make sense if time is short.

Thanks for handling my recent Readline patches.

Frederick

On Tue, Jun 14, 2016 at 08:34:13AM -0700, frederik at ofb.net wrote:
> Hi Martin,
> 
> > Also, as you are studying the C code and the issues anyway, it
> > may be worthwhile to consider (as small as possible!) patches to
> > the source you could also post to the bugzilla site if you
> > prefer; attaching as text/plain to R-devel does work fine, too.
> 
> Well, after your kind solicitation I went through all the touble of
> locally fixing getGraphicsEvent Cairo support and implementing an
> onIdle handler.
> 
> However, I noticed that the first part actually already has a patch on
> the R bug tracker, which is exactly the same as the fix I implemented!
> (minus documentation)
> 
> https://bugs.r-project.org/bugzilla/show_bug.cgi?id=14364
> 
> Problem: somebody ignored the patch and closed the bug. Who closed it?
> YOU!
> 
> So, I guess since that patch (fixing Cairo support) was sent in 2010,
> and my patch (fixing both problems) is about 8 times longer, I can
> expect you to ignore my patch until at least 2063 (a tight lower bound
> if you apply Hugo's patch this year). :)
> 
> I posted my patch here:
> 
> https://bugs.r-project.org/bugzilla/show_bug.cgi?id=16951
> 
> Frederick
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From spencer.graves at prodsyse.com  Mon Jun 20 22:27:05 2016
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Mon, 20 Jun 2016 15:27:05 -0500
Subject: [Rd] Error in texi2dvi
In-Reply-To: <5767D878.7070003@helsinki.fi>
References: <8dde17ae-a358-7b0b-028b-62359a2be35e@prodsyse.com>
	<5767D878.7070003@helsinki.fi>
Message-ID: <775600aa-32d6-c0d7-f35e-c50f3699fc28@prodsyse.com>


On 6/20/2016 6:50 AM, Mikko Korpela wrote:
> On 18/06/16 05:21, Spencer Graves wrote:
>> Hello:
>>
>>
>>        Changes in R seem to have broken the sos vignette, and I don't
>> know how to fix it.  The build on R-forge,
>> "https://r-forge.r-project.org/R/?group_id=235&log=build_src&pkg=sos&flavor=patched", 
>>
>> ends as follows:
>>
>>
>> Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = 
>> quiet,  :
>>    Running 'texi2dvi' on 'sos.tex' failed.
>> LaTeX errors:
>> ! Undefined control sequence.
>> l.1 \Sconcordance
>>                   {concordance:sos.tex:sos.Rnw:%
>> The control sequence at the end of the top line
>> of your error message was never \def'ed. If you have
>> Calls:  -> texi2pdf -> texi2dvi
>> Execution halted
>>
>
> ...
>
>>        What can I do to get this vignette to working again with the
>> least amount of work?
>
> Try commenting out (removing) the following line in your vignette:
>
> \SweaveOpts{concordance=TRUE}
>
> The package builds just fine after doing that, on this computer. The 
> R-Forge history of sos.Rnw shows the line was added on May 12, 
> revision 237.
>

       Thanks so much.  It worked like you indicated.


       That offending line is added automatically by RStudio.  I must 
have saved it without realizing it.  Then it either passed "R CMD build" 
under R 3.2 or I committed that change without realizing I had not 
tested it with "R CMD check".


       RStudio is a great product -- except for this feature.  I 
documented this on Stackoverflow and sent an email to Yihui Xe, who 
works for (or did work for) RStudio, reporting the issue.  I did not 
mention your name, as I assumed you would have published your answer.


       Thanks again,
       Spencer Graves


From izmirlig at mail.nih.gov  Mon Jun 20 23:47:50 2016
From: izmirlig at mail.nih.gov (Izmirlian, Grant (NIH/NCI) [E])
Date: Mon, 20 Jun 2016 21:47:50 +0000
Subject: [Rd] xxx not available for .C  in package yyy
Message-ID: <7E3AADC23AECB243A343EB0165E6DE6089BFAA8B@msgb06.nih.gov>

Hi R package developers. This is literally the strangest thing I've ever seen.
Latest (as of a month ago) R under cygwin64.  I'm teaching an intern package
building and using the .C interface.  The package compiles, but when it gets
to "setting up lazy load" or some such it throws the error "triang" not available for .C()
in package "randpkg".  Upon checking, after removing the current version of the package
incrementing the package number just to make sure, commenting out the portion of the
R code that calls .C(), then building, INSTALLING again, this time works. We are able
to call .C("trian", ...) by hand inside of R, but then when we uncomment out the call
in the .R file, it throws the error again. We've even retyped that portion of code, we've
even dos2unix 'd everything.  Any thoughts?


Grant Izmirlian, Ph.D.
Mathematical Statistician
izmirlig at mail.nih.gov

Delivery Address:
9609 Medical Center Dr, RM 5E130
Rockville MD 20850

Postal Address:
BG 9609 RM 5E130 MSC 9789
9609 Medical Center Dr
Bethesda, MD 20892-9789

 ofc:  240-276-7025
 cell: 240-888-7367
  fax: 240-276-7845


	[[alternative HTML version deleted]]


From spencer.graves at prodsyse.com  Tue Jun 21 01:36:36 2016
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Mon, 20 Jun 2016 18:36:36 -0500
Subject: [Rd] RODBC on Mac & _R_CHECK_FORCE_SUGGESTS_
In-Reply-To: <96CEA5EF-938B-4F42-BB95-166C6EBE1CD6@me.com>
References: <d8fa2836-d7e8-0858-9349-026b1f268029@prodsyse.com>
	<96CEA5EF-938B-4F42-BB95-166C6EBE1CD6@me.com>
Message-ID: <c368e336-bc47-29dc-81f2-cc1231a2c476@prodsyse.com>

Hi, Marc:


       Thanks very much.  Your instructions provided the keys required 
to unlock the door.  Since I had to read your email several times before 
I got it to work, I will summarize here what I think were the crucial 
steps:


             1.   I went to 
"http://www.iodbc.org/dataspace/iodbc/wiki/iODBC/Downloads", as you 
suggested, and clicked on "tarball from Sourceforge".  That downloaded 
"libiodbc-3.52.10.tar.gz".  (Before I did that, I found "Mac OS X" on 
that page and dowloaded and installed "mxkozzzz.dmg". That was not 
enough to install RODBC.)


             2.  I created a directory similar to what you described 
(/Users/sbgraves/R.Files/SourceAndBinaries/OSX-Tools/iODBC/libiodbc-3.52.10/include/) 
and moved "libiodbc-3.52.10.tar.gz" into it.  Then I extracted a folder 
"libiodbc-3.52.10" from it in the aforementioned directory.


             3.  In R, I then tried the following:


install.packages("RODBC", type = "source", configure.args =
"--with-odbc-include=/Users/sbgraves/R.Files/SourceAndBinaries/OSX-Tools/iODBC/libiodbc-3.52.10/include/")


       It worked.


       Thanks,
       sg


On 6/20/2016 10:00 AM, Marc Schwartz wrote:
>> On Jun 20, 2016, at 9:19 AM, Spencer Graves <spencer.graves at prodsyse.com> wrote:
>>
>>        "R CMD check sos" with R 3.3.0 under Mac OS X 10.11.5 ends as follows:
>>
>>
>>> * checking package dependencies ... ERROR
>>> Package suggested but not available: ?RODBC?
>>>
>>> The suggested packages are required for a complete check.
>>> Checking can be attempted without them by setting the environment
>>> variable _R_CHECK_FORCE_SUGGESTS_ to a false value.
>>
>>        Unfortunately, "install.packages('RODBC')" says it's only available in source form.  When I  attempt to install from sources, it fails as follows:
>>
>>
>>> checking for sqlext.h... no
>>> configure: error: "ODBC headers sql.h and sqlext.h not found"
>>> ERROR: configuration failed for package ?RODBC?
>>> * removing ?/Library/Frameworks/R.framework/Versions/3.3/Resources/library/RODBC?
>>> Warning in install.packages :
>>>   installation of package ?RODBC? had non-zero exit status
>>
>>        The CRAN checks for RODBC also failed for the same reason (https://cloud.r-project.org/web/checks/check_results_RODBC.html).
>>
>>
>>
>>        I'm not sure how to set "the environment variable _R_CHECK_FORCE_SUGGESTS_ to a false value" on my Mac, and I'd rather not do it permanently.  I tried various versions of "R CMD check _R_CHECK_FORCE_SUGGESTS_=FALSE sos_1.3-9.tar.gz" and "R CMD check _R_CHECK_FORCE_SUGGESTS_=0 sos_1.3-9.tar.gz", none of which worked. Somewhere I found a suggestion to try, "R CMD check --as-cran sos_1.3-9.tar.gz".  That also failed for me.
>>
>>
>>        Suggestions?
>>        Thanks,
>>        Spencer Graves
>
> Spencer,
>
> The RODBC related error is a common issue and is covered in the vignette for the RODBC package in Appendix A "Installation":
>
>    https://cran.r-project.org/web/packages/RODBC/vignettes/RODBC.pdf
>
> You are missing the two iODBC header files that are required to compile the RODBC package from source code.
>
> When I install RODBC on my Mac running 10.11.5 (El Capitan), I use:
>
> install.packages("RODBC", type = "source",
>                   configure.args = "--with-odbc-include=/Users/marcschwartz/R.Files/SourceAndBinaries/OSX-Tools/iODBC/libiodbc-3.52.10/include/")
>
> where I have placed the extracted iODBC source tarball in:
>
>    /Users/marcschwartz/R.Files/SourceAndBinaries/OSX-Tools/iODBC
>
> The:
>
>    configure.args = "--with-odbc-include=..."
>
> part of the function call points to where the header files are located after extraction from the tarball as per the vignette.
>
> The iODBC source tarball can be downloaded from:
>
>    http://www.iodbc.org/dataspace/iodbc/wiki/iODBC/Downloads
>
>
> If you want to temporarily set the OS X environment variable, you can open an OS X Terminal and in the console, use:
>
>    export _R_CHECK_FORCE_SUGGESTS_=FALSE
>
> You can then check to see if it is set by using:
>
>    env
>
> in the Terminal and/or with the following in an R console run from within that same Terminal session:
>
>> Sys.getenv("_R_CHECK_FORCE_SUGGESTS_")
> [1] "FALSE"
>
>
> Once you close that Terminal session, that modified environment is lost.
>
> Also, at least the RODBC part of the issue should have been posted to R-SIG-DB (https://stat.ethz.ch/mailman/listinfo/r-sig-db), since it is DB interface specific. Most queries about RODBC are there in the archives, including those covering the missing headers.
>
> The part that covers issues vis-a-vis checking your own package should go to R-Package-Devel:
>
>    https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> rather than R-Devel.
>
> Regards,
>
> Marc Schwartz
>
>


From murdoch.duncan at gmail.com  Tue Jun 21 02:05:29 2016
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 20 Jun 2016 20:05:29 -0400
Subject: [Rd] xxx not available for .C in package yyy
In-Reply-To: <7E3AADC23AECB243A343EB0165E6DE6089BFAA8B@msgb06.nih.gov>
References: <7E3AADC23AECB243A343EB0165E6DE6089BFAA8B@msgb06.nih.gov>
Message-ID: <3f5a5e26-9cc4-497f-8acf-0ef0f34c16d8@gmail.com>

On 20/06/2016 5:47 PM, Izmirlian, Grant (NIH/NCI) [E] wrote:
> Hi R package developers. This is literally the strangest thing I've ever seen.
> Latest (as of a month ago) R under cygwin64.  I'm teaching an intern package
> building and using the .C interface.  The package compiles, but when it gets
> to "setting up lazy load" or some such it throws the error "triang" not available for .C()
> in package "randpkg".  Upon checking, after removing the current version of the package
> incrementing the package number just to make sure, commenting out the portion of the
> R code that calls .C(), then building, INSTALLING again, this time works. We are able
> to call .C("trian", ...) by hand inside of R, but then when we uncomment out the call
> in the .R file, it throws the error again. We've even retyped that portion of code, we've
> even dos2unix 'd everything.  Any thoughts?

We don't support Cygwin builds.

If you get this using one of our builds, put together a simple 
reproducible instance of it and make it available.  If it's only in 
Cygwin, you should do the same, and send it to someone there.

Duncan Murdoch


From edd at debian.org  Tue Jun 21 02:46:22 2016
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 20 Jun 2016 19:46:22 -0500
Subject: [Rd] xxx not available for .C  in package yyy
In-Reply-To: <7E3AADC23AECB243A343EB0165E6DE6089BFAA8B@msgb06.nih.gov>
References: <7E3AADC23AECB243A343EB0165E6DE6089BFAA8B@msgb06.nih.gov>
Message-ID: <22376.36446.886154.980097@max.nulle.part>


Grant,

On 20 June 2016 at 21:47, Izmirlian, Grant (NIH/NCI) [E] wrote:
| Hi R package developers. This is literally the strangest thing I've ever seen.
| Latest (as of a month ago) R under cygwin64.  I'm teaching an intern package
| building and using the .C interface.  The package compiles, but when it gets
| to "setting up lazy load" or some such it throws the error "triang" not available for .C()
| in package "randpkg".  Upon checking, after removing the current version of the package
| incrementing the package number just to make sure, commenting out the portion of the
| R code that calls .C(), then building, INSTALLING again, this time works. We are able
| to call .C("trian", ...) by hand inside of R, but then when we uncomment out the call
| in the .R file, it throws the error again. We've even retyped that portion of code, we've
| even dos2unix 'd everything.  Any thoughts?

In the top-level file NAMESPACE, do you have

   useDynLib("randpkg")

to ensure the dynamic library is loaded?

Dirk

PS Please consider using .Call() instead of .C(). 

--
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From winstonchang1 at gmail.com  Wed Jun 22 03:35:30 2016
From: winstonchang1 at gmail.com (Winston Chang)
Date: Tue, 21 Jun 2016 20:35:30 -0500
Subject: [Rd] dowload.file(method="libcurl") and GET vs. HEAD requests
Message-ID: <CAFOpNVFRX0QDySGgEM-Qv2Oq9veF1HNY3rgkbfU3pzQKGwYZmw@mail.gmail.com>

In R 3.2.4, if you ran download.file(method="libcurl"), it issues a
HTTP GET request for the file. However, in R 3.3.0, it issues a HTTP
HEAD request first, and then a GET requet. This can result in problems
when the web server gives an error for a HEAD request, even if the
file is available with a GET request.

Is it possible to tell download.file to simply send a GET request,
without first sending a HEAD request?


In theory, web servers should give the same response for HEAD and GET
requests, except that for a HEAD request, it sends only headers, and
not the content. However, not all web servers do this for all files.
I've seen this problem come up in two different places.

The first is from an issue that someone filed for the downloader
package. The following works in R 3.2.4, but in R 3.3.0, it fails with
a 404 (tested on a Mac):
  options(internet.info=1) # Show verbose download info
  url <- "https://census.edina.ac.uk/ukborders/easy_download/prebuilt/shape/England_lad_2011_gen.zip"
 download.file(url, destfile = "out.zip", method="libcurl")

In R 3.3.0, the download succeeds with method="wget", and
method="curl". It's only method="libcurl" that has problems.


The second place I've encountered a problem is in downloading attached
files from a GitHub release.
  options(internet.info=1) # Show verbose download info
  url <- "https://github.com/wch/webshot/releases/download/v0.3/phantomjs-2.1.1-macosx.zip"
  download.file(url, destfile = "out.zip")

This one fails with a 403 Forbidden because it gets redirected to a
URL in Amazon S3, where a signature of the file is embedded in the
URL. However, the signature is computed with the request type (HEAD
vs. GET), and so the same URL doesn't work for both. (See
http://stackoverflow.com/a/20580036/412655)

Any help would be appreciated!
-Winston


From martin.morgan at roswellpark.org  Wed Jun 22 04:45:11 2016
From: martin.morgan at roswellpark.org (Martin Morgan)
Date: Tue, 21 Jun 2016 22:45:11 -0400
Subject: [Rd] dowload.file(method="libcurl") and GET vs. HEAD requests
In-Reply-To: <CAFOpNVFRX0QDySGgEM-Qv2Oq9veF1HNY3rgkbfU3pzQKGwYZmw@mail.gmail.com>
References: <CAFOpNVFRX0QDySGgEM-Qv2Oq9veF1HNY3rgkbfU3pzQKGwYZmw@mail.gmail.com>
Message-ID: <5769FBB7.1080100@roswellpark.org>

On 06/21/2016 09:35 PM, Winston Chang wrote:
> In R 3.2.4, if you ran download.file(method="libcurl"), it issues a
> HTTP GET request for the file. However, in R 3.3.0, it issues a HTTP
> HEAD request first, and then a GET requet. This can result in problems
> when the web server gives an error for a HEAD request, even if the
> file is available with a GET request.
>
> Is it possible to tell download.file to simply send a GET request,
> without first sending a HEAD request?
>
>
> In theory, web servers should give the same response for HEAD and GET
> requests, except that for a HEAD request, it sends only headers, and
> not the content. However, not all web servers do this for all files.
> I've seen this problem come up in two different places.
>
> The first is from an issue that someone filed for the downloader
> package. The following works in R 3.2.4, but in R 3.3.0, it fails with
> a 404 (tested on a Mac):
>    options(internet.info=1) # Show verbose download info
>    url <- "https://census.edina.ac.uk/ukborders/easy_download/prebuilt/shape/England_lad_2011_gen.zip"
>   download.file(url, destfile = "out.zip", method="libcurl")
>
> In R 3.3.0, the download succeeds with method="wget", and
> method="curl". It's only method="libcurl" that has problems.
>
>
> The second place I've encountered a problem is in downloading attached
> files from a GitHub release.
>    options(internet.info=1) # Show verbose download info
>    url <- "https://github.com/wch/webshot/releases/download/v0.3/phantomjs-2.1.1-macosx.zip"
>    download.file(url, destfile = "out.zip")
>
> This one fails with a 403 Forbidden because it gets redirected to a
> URL in Amazon S3, where a signature of the file is embedded in the
> URL. However, the signature is computed with the request type (HEAD
> vs. GET), and so the same URL doesn't work for both. (See
> http://stackoverflow.com/a/20580036/412655)
>
> Any help would be appreciated!

I think I introduced this, in

------------------------------------------------------------------------
r69280 | morgan | 2015-09-03 06:24:49 -0400 (Thu, 03 Sep 2015) | 4 lines

don't create empty file on 404 and similar errors

- download.file(method="libcurl")

------------------------------------------------------------------------

The idea was to test that the file can be downloaded before trying to 
download it; previously R would download the error page as though it 
were the content.

I'll give this some thought.

Martin Morgan


> -Winston
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


This email message may contain legally privileged and/or...{{dropped:2}}


From winstonchang1 at gmail.com  Wed Jun 22 18:01:39 2016
From: winstonchang1 at gmail.com (Winston Chang)
Date: Wed, 22 Jun 2016 11:01:39 -0500
Subject: [Rd] dowload.file(method="libcurl") and GET vs. HEAD requests
In-Reply-To: <5769FBB7.1080100@roswellpark.org>
References: <CAFOpNVFRX0QDySGgEM-Qv2Oq9veF1HNY3rgkbfU3pzQKGwYZmw@mail.gmail.com>
	<5769FBB7.1080100@roswellpark.org>
Message-ID: <CAFOpNVGGdbgZx_+daEGf94fi50wurk7pU_vxVVQTuzUuDNGXJQ@mail.gmail.com>

Thanks for looking into it. Is there a way to avoid the HEAD request
in R 3.3.0? I'm asking because if there isn't, then I'll add a
workaround in a package I'm working on.

-Winston

On Tue, Jun 21, 2016 at 9:45 PM, Martin Morgan
<martin.morgan at roswellpark.org> wrote:
> On 06/21/2016 09:35 PM, Winston Chang wrote:
>>
>> In R 3.2.4, if you ran download.file(method="libcurl"), it issues a
>> HTTP GET request for the file. However, in R 3.3.0, it issues a HTTP
>> HEAD request first, and then a GET requet. This can result in problems
>> when the web server gives an error for a HEAD request, even if the
>> file is available with a GET request.
>>
>> Is it possible to tell download.file to simply send a GET request,
>> without first sending a HEAD request?
>>
>>
>> In theory, web servers should give the same response for HEAD and GET
>> requests, except that for a HEAD request, it sends only headers, and
>> not the content. However, not all web servers do this for all files.
>> I've seen this problem come up in two different places.
>>
>> The first is from an issue that someone filed for the downloader
>> package. The following works in R 3.2.4, but in R 3.3.0, it fails with
>> a 404 (tested on a Mac):
>>    options(internet.info=1) # Show verbose download info
>>    url <-
>> "https://census.edina.ac.uk/ukborders/easy_download/prebuilt/shape/England_lad_2011_gen.zip"
>>   download.file(url, destfile = "out.zip", method="libcurl")
>>
>> In R 3.3.0, the download succeeds with method="wget", and
>> method="curl". It's only method="libcurl" that has problems.
>>
>>
>> The second place I've encountered a problem is in downloading attached
>> files from a GitHub release.
>>    options(internet.info=1) # Show verbose download info
>>    url <-
>> "https://github.com/wch/webshot/releases/download/v0.3/phantomjs-2.1.1-macosx.zip"
>>    download.file(url, destfile = "out.zip")
>>
>> This one fails with a 403 Forbidden because it gets redirected to a
>> URL in Amazon S3, where a signature of the file is embedded in the
>> URL. However, the signature is computed with the request type (HEAD
>> vs. GET), and so the same URL doesn't work for both. (See
>> http://stackoverflow.com/a/20580036/412655)
>>
>> Any help would be appreciated!
>
>
> I think I introduced this, in
>
> ------------------------------------------------------------------------
> r69280 | morgan | 2015-09-03 06:24:49 -0400 (Thu, 03 Sep 2015) | 4 lines
>
> don't create empty file on 404 and similar errors
>
> - download.file(method="libcurl")
>
> ------------------------------------------------------------------------
>
> The idea was to test that the file can be downloaded before trying to
> download it; previously R would download the error page as though it were
> the content.
>
> I'll give this some thought.
>
> Martin Morgan
>
>
>> -Winston
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
> This email message may contain legally privileged and/or confidential
> information.  If you are not the intended recipient(s), or the employee or
> agent responsible for the delivery of this message to the intended
> recipient(s), you are hereby notified that any disclosure, copying,
> distribution, or use of this email message is prohibited.  If you have
> received this message in error, please notify the sender immediately by
> e-mail and delete this email message from your computer. Thank you.


From Martin.Morgan at roswellpark.org  Wed Jun 22 18:09:45 2016
From: Martin.Morgan at roswellpark.org (Morgan, Martin)
Date: Wed, 22 Jun 2016 16:09:45 +0000
Subject: [Rd] dowload.file(method="libcurl") and GET vs. HEAD requests
In-Reply-To: <CAFOpNVGGdbgZx_+daEGf94fi50wurk7pU_vxVVQTuzUuDNGXJQ@mail.gmail.com>
References: <CAFOpNVFRX0QDySGgEM-Qv2Oq9veF1HNY3rgkbfU3pzQKGwYZmw@mail.gmail.com>
	<5769FBB7.1080100@roswellpark.org>,
	<CAFOpNVGGdbgZx_+daEGf94fi50wurk7pU_vxVVQTuzUuDNGXJQ@mail.gmail.com>
Message-ID: <BLUPR12MB05780CDB856CC8076B9B3DE0E12C0@BLUPR12MB0578.namprd12.prod.outlook.com>


No I don't think there is a way to avoid the HEAD request.
________________________________________
From: Winston Chang <winstonchang1 at gmail.com>
Sent: Wednesday, June 22, 2016 12:01:39 PM
To: Morgan, Martin
Cc: R Devel List
Subject: Re: [Rd] dowload.file(method="libcurl") and GET vs. HEAD requests

Thanks for looking into it. Is there a way to avoid the HEAD request
in R 3.3.0? I'm asking because if there isn't, then I'll add a
workaround in a package I'm working on.

-Winston

On Tue, Jun 21, 2016 at 9:45 PM, Martin Morgan
<martin.morgan at roswellpark.org> wrote:
> On 06/21/2016 09:35 PM, Winston Chang wrote:
>>
>> In R 3.2.4, if you ran download.file(method="libcurl"), it issues a
>> HTTP GET request for the file. However, in R 3.3.0, it issues a HTTP
>> HEAD request first, and then a GET requet. This can result in problems
>> when the web server gives an error for a HEAD request, even if the
>> file is available with a GET request.
>>
>> Is it possible to tell download.file to simply send a GET request,
>> without first sending a HEAD request?
>>
>>
>> In theory, web servers should give the same response for HEAD and GET
>> requests, except that for a HEAD request, it sends only headers, and
>> not the content. However, not all web servers do this for all files.
>> I've seen this problem come up in two different places.
>>
>> The first is from an issue that someone filed for the downloader
>> package. The following works in R 3.2.4, but in R 3.3.0, it fails with
>> a 404 (tested on a Mac):
>>    options(internet.info=1) # Show verbose download info
>>    url <-
>> "https://census.edina.ac.uk/ukborders/easy_download/prebuilt/shape/England_lad_2011_gen.zip"
>>   download.file(url, destfile = "out.zip", method="libcurl")
>>
>> In R 3.3.0, the download succeeds with method="wget", and
>> method="curl". It's only method="libcurl" that has problems.
>>
>>
>> The second place I've encountered a problem is in downloading attached
>> files from a GitHub release.
>>    options(internet.info=1) # Show verbose download info
>>    url <-
>> "https://github.com/wch/webshot/releases/download/v0.3/phantomjs-2.1.1-macosx.zip"
>>    download.file(url, destfile = "out.zip")
>>
>> This one fails with a 403 Forbidden because it gets redirected to a
>> URL in Amazon S3, where a signature of the file is embedded in the
>> URL. However, the signature is computed with the request type (HEAD
>> vs. GET), and so the same URL doesn't work for both. (See
>> http://stackoverflow.com/a/20580036/412655)
>>
>> Any help would be appreciated!
>
>
> I think I introduced this, in
>
> ------------------------------------------------------------------------
> r69280 | morgan | 2015-09-03 06:24:49 -0400 (Thu, 03 Sep 2015) | 4 lines
>
> don't create empty file on 404 and similar errors
>
> - download.file(method="libcurl")
>
> ------------------------------------------------------------------------
>
> The idea was to test that the file can be downloaded before trying to
> download it; previously R would download the error page as though it were
> the content.
>
> I'll give this some thought.
>
> Martin Morgan
>
>
>> -Winston
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
> This email message may contain legally privileged and/or confidential
> information.  If you are not the intended recipient(s), or the employee or
> agent responsible for the delivery of this message to the intended
> recipient(s), you are hereby notified that any disclosure, copying,
> distribution, or use of this email message is prohibited.  If you have
> received this message in error, please notify the sender immediately by
> e-mail and delete this email message from your computer. Thank you.


This email message may contain legally privileged and/or confidential information.  If you are not the intended recipient(s), or the employee or agent responsible for the delivery of this message to the intended recipient(s), you are hereby notified that any disclosure, copying, distribution, or use of this email message is prohibited.  If you have received this message in error, please notify the sender immediately by e-mail and delete this email message from your computer. Thank you.

From kevinushey at gmail.com  Sat Jun 25 21:46:24 2016
From: kevinushey at gmail.com (Kevin Ushey)
Date: Sat, 25 Jun 2016 12:46:24 -0700
Subject: [Rd] strange behavior in 'inherits' check for loaded S4 object
Message-ID: <CAJXgQP3ap2QSemxr533=AAHNKA+J_xMWns6EB_ky7FPGpSsQwg@mail.gmail.com>

Hi,

(sorry for the wall of text; the issue here appears to be rather complicated)

I'm seeing a somewhat strange case where checking whether an S4 object
inherits from a parent class defined from another package with
'inherits' fails if that object is materialized through a call to
'load'. That's a mouthful, so I've put together a relatively small
reproducible example online here:

https://github.com/kevinushey/s4inherits

This package, 's4inherits', defines an S4 class, 'SubMatrix', that
inherits from the 'dsyMatrix' class defined in the Matrix package.
After installing the package, I run some simple tests:

$ R -f test-save.R

> library(s4inherits)
> data <- SubMatrix(1)
>
> is(data, "SubMatrix")
[1] TRUE
> inherits(data, "SubMatrix")
[1] TRUE
>
> is(data, "dsyMatrix")
[1] TRUE
> inherits(data, "dsyMatrix")
[1] TRUE
>
> save(data, file = "test.RData")
>

All the inheritance checks report as we would expect. I check that the
inheritance reports are as expected, then save that object to
'test.RData'. I then load that data file in a new R session and run
the same checks:

$ R -f test-load.R

> library(methods)
> load("test.RData")
>
> inherits(data, "SubMatrix")
Loading required package: s4inherits
[1] TRUE
> is(data, "SubMatrix")
[1] TRUE
>
> inherits(data, "dsyMatrix")
[1] FALSE # (??)
> is(data, "dsyMatrix")
[1] TRUE
>

Note that R now reports that my loaded object does _not_ inherit from
"dsyMatrix", yet this occurs only when checked with 'inherits()' --
'is' produces the expected result.

I do not see the behavior if I explicitly load / attach the
's4inherits' package before loading the associated data file; it only
occurs if the package namespace is loaded in response to loading the
data object hosting a 'SubMatrix' object.

More precisely, the package namespace is loaded when the promise
hosting the data object is evaluated; that promise being generated by
'load', if I understand correctly. Somehow, evaluation of that promise
within the call to 'inherits' in this very special case causes the
unexpected behavior -- ie, if the first thing that you do with the
loaded object is check its class with 'inherits', then you get this
unexpected result.

Even more, this behavior seems to go away if the 's4inherits' package
explicitly exports the class -- however, you could imagine this class
normally being internal to the package, and so it may be undesirable
to export it.

I checked a bit into the C code, and IIUC the check here looks up the
class hierarchy in the R_S4_extends_table object defined in
'attrib.c', so it seems like that mapping is potentially not getting
constructed with the full hierarchy (although hopefully someone with
more knowledge of the S4 internals + interaction with S3 can
elaborate).

(FWIW, this was distilled from a case where S3 dispatch on a similar
loaded S4 object failed, due to failure to resolve the class hierarchy
for the S3 dispatch context.)

Thanks,
Kevin

---

$ R --slave -e "utils::sessionInfo()"
R Under development (unstable) (2016-06-13 r70769)
Platform: x86_64-apple-darwin15.5.0 (64-bit)
Running under: OS X 10.11.5 (El Capitan)


From hpages at fredhutch.org  Sun Jun 26 22:21:00 2016
From: hpages at fredhutch.org (=?UTF-8?B?SGVydsOpIFBhZ8Oocw==?=)
Date: Sun, 26 Jun 2016 13:21:00 -0700
Subject: [Rd] 3 minor issues with getClass 'resolve.msg' arg
Message-ID: <5770392C.8090809@fredhutch.org>

Hi,

It turns out that two packages (1 Bioconductor, 1 CRAN) define an
S4 class called "Annotated":

   library(S4Vectors)  # see (*) at bottom for how to install
   library(RNeXML)

1st issue
---------

getClass() issues the same warning twice:

   tmp <- getClass("Annotated")
   Found more than one class "Annotated" in cache; using the first, from 
namespace 'S4Vectors'
   Found more than one class "Annotated" in cache; using the first, from 
namespace 'S4Vectors'

2nd issue
---------

It would be very helpful if the warning message was giving the name of
the other package. I was in a session with 50+ packages attached or
loaded via a namespace when I saw the warning. Took me a while to
identify the other package, which I finally managed to do with:

   names(.Call(methods:::C_R_getClassFromCache, "Annotated", 
methods:::.classTable))

3rd issue
---------

Calling getClass() with 'resolve.msg=FALSE' only removes one of the 2
warnings:

   > tmp <- getClass("Annotated", resolve.msg=FALSE)
   Found more than one class "Annotated" in cache; using the first, from 
namespace 'S4Vectors'

Thanks,
H.

(*) Install S4Vectors with:

   source("https://bioconductor.org/biocLite.R")
   biocLite("S4Vectors")

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fredhutch.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From rdonnelly at continuum.io  Mon Jun 27 12:58:08 2016
From: rdonnelly at continuum.io (Ray Donnelly)
Date: Mon, 27 Jun 2016 11:58:08 +0100
Subject: [Rd] Two minor build system patches.
Message-ID: <CAF5kcVWhd3gdgYhmS8b49EHCTmri96HFBj=AwyaX_i-hqcx4Hw@mail.gmail.com>

Hi all,

I ran into a few problems building R 3.3.1 and came up wth the
attached patches (fingers crossed they don't get stripped, I've also
sent this email to Jeroen since that worked last time). Would it be
possible to review and merge them if they are OK?

The first one uses AC_SEARCH_LIBS instead of AC_CHECK_LIB, looking for
ncursesw before ncurses since ncurses is usually build with wide
character support in which case non-w prefixed libraries are not
created. ArchLinux (and Conda) then make fake ld linker libraries for
the non-w prefixed ones.

The second patch fixes a typo where CPPFLAGS is misspelt as CPPLAGS
which causes them to be forgotten about in the middle of configure.



Best regards,

Ray.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-Use-AC_SEARCH_LIBS-to-search-for-ncursesw-then-ncurs.patch
Type: text/x-patch
Size: 4268 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20160627/19522c26/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0002-configure-Fix-typo-CPPLAGS.patch
Type: text/x-patch
Size: 1197 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20160627/19522c26/attachment-0001.bin>

From murdoch.duncan at gmail.com  Mon Jun 27 13:07:56 2016
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 27 Jun 2016 07:07:56 -0400
Subject: [Rd] Two minor build system patches.
In-Reply-To: <CAF5kcVWhd3gdgYhmS8b49EHCTmri96HFBj=AwyaX_i-hqcx4Hw@mail.gmail.com>
References: <CAF5kcVWhd3gdgYhmS8b49EHCTmri96HFBj=AwyaX_i-hqcx4Hw@mail.gmail.com>
Message-ID: <d62f4e2f-6133-4978-aa38-0ef2e7c62762@gmail.com>

On 27/06/2016 6:58 AM, Ray Donnelly wrote:
> Hi all,
>
> I ran into a few problems building R 3.3.1 and came up wth the
> attached patches (fingers crossed they don't get stripped, I've also
> sent this email to Jeroen since that worked last time). Would it be
> possible to review and merge them if they are OK?
>
> The first one uses AC_SEARCH_LIBS instead of AC_CHECK_LIB, looking for
> ncursesw before ncurses since ncurses is usually build with wide
> character support in which case non-w prefixed libraries are not
> created. ArchLinux (and Conda) then make fake ld linker libraries for
> the non-w prefixed ones.
>
> The second patch fixes a typo where CPPFLAGS is misspelt as CPPLAGS
> which causes them to be forgotten about in the middle of configure.
>
>

Your patches were attached.  I'll apply the second one, but I'll leave 
the first one for someone who knows the issues.

Duncan Murdoch


From rdonnelly at continuum.io  Mon Jun 27 13:41:35 2016
From: rdonnelly at continuum.io (Ray Donnelly)
Date: Mon, 27 Jun 2016 12:41:35 +0100
Subject: [Rd] Two minor build system patches.
In-Reply-To: <d62f4e2f-6133-4978-aa38-0ef2e7c62762@gmail.com>
References: <CAF5kcVWhd3gdgYhmS8b49EHCTmri96HFBj=AwyaX_i-hqcx4Hw@mail.gmail.com>
	<d62f4e2f-6133-4978-aa38-0ef2e7c62762@gmail.com>
Message-ID: <CAF5kcVXLN_bOrqmFh7gL4VG4RXbS3TNrSd=7jvLf9tyOoZOPCA@mail.gmail.com>

On Mon, Jun 27, 2016 at 12:07 PM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 27/06/2016 6:58 AM, Ray Donnelly wrote:
>>
>> Hi all,
>>
>> I ran into a few problems building R 3.3.1 and came up wth the
>> attached patches (fingers crossed they don't get stripped, I've also
>> sent this email to Jeroen since that worked last time). Would it be
>> possible to review and merge them if they are OK?
>>
>> The first one uses AC_SEARCH_LIBS instead of AC_CHECK_LIB, looking for
>> ncursesw before ncurses since ncurses is usually build with wide
>> character support in which case non-w prefixed libraries are not
>> created. ArchLinux (and Conda) then make fake ld linker libraries for
>> the non-w prefixed ones.
>>
>> The second patch fixes a typo where CPPFLAGS is misspelt as CPPLAGS
>> which causes them to be forgotten about in the middle of configure.
>>
>>
>
> Your patches were attached.  I'll apply the second one, but I'll leave the
> first one for someone who knows the issues.

Thanks Duncan.

>
> Duncan Murdoch
>


From ggrothendieck at gmail.com  Mon Jun 27 19:39:12 2016
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 27 Jun 2016 13:39:12 -0400
Subject: [Rd] stack problem
Message-ID: <CAP01uRkHWezoiKQNbKCV6oCT9tqDiiQU5mzQO0iS_GCyEVMkLQ@mail.gmail.com>

stack() seems to drop empty levels.  Perhaps there could be a
drop=FALSE argument if one wanted all the original levels.  In the
example below, we may wish to retain level "b" in s$ind even though
component LL$b has length 0.

> LL <- list(a = 1:3, b = list())
> s <- stack(LL)
> str(s)
'data.frame':   3 obs. of  2 variables:
 $ values: int  1 2 3
 $ ind   : Factor w/ 1 level "a": 1 1 1


-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From lawrence.michael at gene.com  Mon Jun 27 20:55:52 2016
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Mon, 27 Jun 2016 11:55:52 -0700
Subject: [Rd] stack problem
In-Reply-To: <CAP01uRkHWezoiKQNbKCV6oCT9tqDiiQU5mzQO0iS_GCyEVMkLQ@mail.gmail.com>
References: <CAP01uRkHWezoiKQNbKCV6oCT9tqDiiQU5mzQO0iS_GCyEVMkLQ@mail.gmail.com>
Message-ID: <CAOQ5Nydf=F8BCPc3a2+JYmU28zUfy9zg32bfK2m7JX_RKCxgUg@mail.gmail.com>

I'll add the drop argument but I'm wondering about the order of the
levels. Should we set the levels to unique(names(x)) or sort them,
too?

On Mon, Jun 27, 2016 at 10:39 AM, Gabor Grothendieck
<ggrothendieck at gmail.com> wrote:
> stack() seems to drop empty levels.  Perhaps there could be a
> drop=FALSE argument if one wanted all the original levels.  In the
> example below, we may wish to retain level "b" in s$ind even though
> component LL$b has length 0.
>
>> LL <- list(a = 1:3, b = list())
>> s <- stack(LL)
>> str(s)
> 'data.frame':   3 obs. of  2 variables:
>  $ values: int  1 2 3
>  $ ind   : Factor w/ 1 level "a": 1 1 1
>
>
> --
> Statistics & Software Consulting
> GKX Group, GKX Associates Inc.
> tel: 1-877-GKX-GROUP
> email: ggrothendieck at gmail.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ggrothendieck at gmail.com  Mon Jun 27 21:49:25 2016
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 27 Jun 2016 15:49:25 -0400
Subject: [Rd] stack problem
In-Reply-To: <CAOQ5Nydf=F8BCPc3a2+JYmU28zUfy9zg32bfK2m7JX_RKCxgUg@mail.gmail.com>
References: <CAP01uRkHWezoiKQNbKCV6oCT9tqDiiQU5mzQO0iS_GCyEVMkLQ@mail.gmail.com>
	<CAOQ5Nydf=F8BCPc3a2+JYmU28zUfy9zg32bfK2m7JX_RKCxgUg@mail.gmail.com>
Message-ID: <CAP01uRmBQ8yu=8iN_m672mDA_ks68rXEtb4LDHifRnR3uobzcA@mail.gmail.com>

One would normally want the original order that so that one can stack
a list, operate on the result and then unstack it back with the
unstacked result having the same ordering as the original.

LL <- list(z = 1:3, a = list())
# since we can't do s <- stack(LL,. drop = FALSE) do this instead:
s <- transform(stack(LL), ind = factor(as.character(ind), levels = names(LL)))
unstack(s)




On Mon, Jun 27, 2016 at 2:55 PM, Michael Lawrence
<lawrence.michael at gene.com> wrote:
> I'll add the drop argument but I'm wondering about the order of the
> levels. Should we set the levels to unique(names(x)) or sort them,
> too?
>
> On Mon, Jun 27, 2016 at 10:39 AM, Gabor Grothendieck
> <ggrothendieck at gmail.com> wrote:
>> stack() seems to drop empty levels.  Perhaps there could be a
>> drop=FALSE argument if one wanted all the original levels.  In the
>> example below, we may wish to retain level "b" in s$ind even though
>> component LL$b has length 0.
>>
>>> LL <- list(a = 1:3, b = list())
>>> s <- stack(LL)
>>> str(s)
>> 'data.frame':   3 obs. of  2 variables:
>>  $ values: int  1 2 3
>>  $ ind   : Factor w/ 1 level "a": 1 1 1
>>
>>
>> --
>> Statistics & Software Consulting
>> GKX Group, GKX Associates Inc.
>> tel: 1-877-GKX-GROUP
>> email: ggrothendieck at gmail.com
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>



-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From lawrence.michael at gene.com  Mon Jun 27 21:58:54 2016
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Mon, 27 Jun 2016 12:58:54 -0700
Subject: [Rd] stack problem
In-Reply-To: <CAP01uRmBQ8yu=8iN_m672mDA_ks68rXEtb4LDHifRnR3uobzcA@mail.gmail.com>
References: <CAP01uRkHWezoiKQNbKCV6oCT9tqDiiQU5mzQO0iS_GCyEVMkLQ@mail.gmail.com>
	<CAOQ5Nydf=F8BCPc3a2+JYmU28zUfy9zg32bfK2m7JX_RKCxgUg@mail.gmail.com>
	<CAP01uRmBQ8yu=8iN_m672mDA_ks68rXEtb4LDHifRnR3uobzcA@mail.gmail.com>
Message-ID: <CAOQ5Nyfmk4_wMkrsEASwz1ZMvtZA3owmGq9frWkKYzE256zbew@mail.gmail.com>

Agreed. Just putting that out there.

On Mon, Jun 27, 2016 at 12:49 PM, Gabor Grothendieck
<ggrothendieck at gmail.com> wrote:
> One would normally want the original order that so that one can stack
> a list, operate on the result and then unstack it back with the
> unstacked result having the same ordering as the original.
>
> LL <- list(z = 1:3, a = list())
> # since we can't do s <- stack(LL,. drop = FALSE) do this instead:
> s <- transform(stack(LL), ind = factor(as.character(ind), levels = names(LL)))
> unstack(s)
>
>
>
>
> On Mon, Jun 27, 2016 at 2:55 PM, Michael Lawrence
> <lawrence.michael at gene.com> wrote:
>> I'll add the drop argument but I'm wondering about the order of the
>> levels. Should we set the levels to unique(names(x)) or sort them,
>> too?
>>
>> On Mon, Jun 27, 2016 at 10:39 AM, Gabor Grothendieck
>> <ggrothendieck at gmail.com> wrote:
>>> stack() seems to drop empty levels.  Perhaps there could be a
>>> drop=FALSE argument if one wanted all the original levels.  In the
>>> example below, we may wish to retain level "b" in s$ind even though
>>> component LL$b has length 0.
>>>
>>>> LL <- list(a = 1:3, b = list())
>>>> s <- stack(LL)
>>>> str(s)
>>> 'data.frame':   3 obs. of  2 variables:
>>>  $ values: int  1 2 3
>>>  $ ind   : Factor w/ 1 level "a": 1 1 1
>>>
>>>
>>> --
>>> Statistics & Software Consulting
>>> GKX Group, GKX Associates Inc.
>>> tel: 1-877-GKX-GROUP
>>> email: ggrothendieck at gmail.com
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>
>
>
> --
> Statistics & Software Consulting
> GKX Group, GKX Associates Inc.
> tel: 1-877-GKX-GROUP
> email: ggrothendieck at gmail.com
>


From hhoeflin at gmail.com  Tue Jun 28 13:38:28 2016
From: hhoeflin at gmail.com (Holger Hoefling)
Date: Tue, 28 Jun 2016 13:38:28 +0200
Subject: [Rd] A package requiring cmake
Message-ID: <CAFDswJuraxNHcTVEwuFmQbbGXcASmy7NW6q+v0ew9E+=N788ng@mail.gmail.com>

Hi,

I am currently preparing a package for hdf5 that ships and compiles from
source on windows. The intention here is to avoid having to ship or
download a binary from an unknown source. As a dependency, I need the cmake
program installed.

Here my question:
1. Is cmake installed on win-builder? If not, could it be installed? If
yes, in a specified standard location or available through the PATH
variable?
2. How do I specify that a package is only intended for a specific OS?

On another note here:
The package I am preparing would only compile the binaries on windows. On
other systems, I would prefer to have people install them thought native
services (e.g. apt-get) to make configuration etc. more manageable for
system administrators (even though that puts a little more burden on the
end-user on these systems).

Second question:
Is there a way to specify an OS-specific dependency? As the hdf5lib package
is rather large and intended for windows only, I would prefer if it isn't
downloaded anywhere else.

thanks for your help

Holger

	[[alternative HTML version deleted]]


From brian at braverock.com  Tue Jun 28 13:51:30 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Tue, 28 Jun 2016 06:51:30 -0500
Subject: [Rd] A package requiring cmake
In-Reply-To: <CAFDswJuraxNHcTVEwuFmQbbGXcASmy7NW6q+v0ew9E+=N788ng@mail.gmail.com>
References: <CAFDswJuraxNHcTVEwuFmQbbGXcASmy7NW6q+v0ew9E+=N788ng@mail.gmail.com>
Message-ID: <1467114690.17165.53.camel@brian-rcg>

wrong list.  This belongs on the r-package-devel list.

https://stat.ethz.ch/mailman/listinfo/r-package-devel

Brian

On Tue, 2016-06-28 at 13:38 +0200, Holger Hoefling wrote:
> Hi,
> 
> I am currently preparing a package for hdf5 that ships and compiles from
> source on windows. The intention here is to avoid having to ship or
> download a binary from an unknown source. As a dependency, I need the cmake
> program installed.
> 
> Here my question:
> 1. Is cmake installed on win-builder? If not, could it be installed? If
> yes, in a specified standard location or available through the PATH
> variable?
> 2. How do I specify that a package is only intended for a specific OS?
> 
> On another note here:
> The package I am preparing would only compile the binaries on windows. On
> other systems, I would prefer to have people install them thought native
> services (e.g. apt-get) to make configuration etc. more manageable for
> system administrators (even though that puts a little more burden on the
> end-user on these systems).
> 
> Second question:
> Is there a way to specify an OS-specific dependency? As the hdf5lib package
> is rather large and intended for windows only, I would prefer if it isn't
> downloaded anywhere else.
> 
> thanks for your help
> 
> Holger
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Tue Jun 28 14:01:45 2016
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 28 Jun 2016 08:01:45 -0400
Subject: [Rd] A package requiring cmake
In-Reply-To: <CAFDswJuraxNHcTVEwuFmQbbGXcASmy7NW6q+v0ew9E+=N788ng@mail.gmail.com>
References: <CAFDswJuraxNHcTVEwuFmQbbGXcASmy7NW6q+v0ew9E+=N788ng@mail.gmail.com>
Message-ID: <8b95a715-e126-6921-d863-28d12c698368@gmail.com>

On 28/06/2016 7:38 AM, Holger Hoefling wrote:
> Hi,
>
> I am currently preparing a package for hdf5 that ships and compiles from
> source on windows. The intention here is to avoid having to ship or
> download a binary from an unknown source. As a dependency, I need the cmake
> program installed.
>
> Here my question:
> 1. Is cmake installed on win-builder? If not, could it be installed? If
> yes, in a specified standard location or available through the PATH
> variable?

It's not on the Winbuilder path.

> 2. How do I specify that a package is only intended for a specific OS?

Use the OS_type field in the DESCRIPTION file.

>
> On another note here:
> The package I am preparing would only compile the binaries on windows. On
> other systems, I would prefer to have people install them thought native
> services (e.g. apt-get) to make configuration etc. more manageable for
> system administrators (even though that puts a little more burden on the
> end-user on these systems).

List the libraries as SystemRequirements in the DESCRIPTION.
>
> Second question:
> Is there a way to specify an OS-specific dependency? As the hdf5lib package
> is rather large and intended for windows only, I would prefer if it isn't
> downloaded anywhere else.

You can make a Windows-only package that contains it, but it's quite 
possible CRAN won't accept it.  See their policy document statement on 
portable code.

Duncan Murdoch
>
> thanks for your help
>
> Holger
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From luis.henrique.usier at gmail.com  Thu Jun 30 22:51:58 2016
From: luis.henrique.usier at gmail.com (Luis Usier)
Date: Thu, 30 Jun 2016 21:51:58 +0100
Subject: [Rd] Calling C implementations of rnorm and friends
Message-ID: <CAOeuMBBshUcPrwBbgZdMZTgRYo3WEqia0O9DSWp4GEmuO7R=oQ@mail.gmail.com>

Hi all,

Looking at the body for the function rnorm, I see that the body of the
function is:

    .Call(C_rnorm, n, mean, sd)

I want to implement functions that generate normal (and other) random
variables. Now, I understand that I can perfectly well just call the R
wrapper for these functions and that will be almost indistinguishable for
most purposes, but for whatever reason I wanted to try and call the C
function directly. My first instinct was to call them as:

    .Call(C_rnorm, 1, 1, 1)

This doesn't work because R assumes C_rnorm is an object. Looking at the
documentation for .Call, I try passing it in as a string:

    .Call("C_rnorm", 1, 1, 1, PACKAGE = "stats")

This doesn't work either. The help page links to getNativeSymbolInfo(),
which I can't make work either. It also refers me to the dyn.load()
function and the "Writing R  Extensions" manual.

After reading and trying to digest those, I try

    getDLLRegisteredRoutines("stats")

which shows me all the C and Fortran functions as registered routines,
along with their number of parameters. I retrieve rnorm from the list and
pass it on to .Call, which then works fine.

However, is there an easier way to do this? Specifically, I would like to
call the DLL registered routines from within functions in a package I am
writing. The manual tells me I should use useDynLib(). So if I added
useDynLib("stats") to my namespace, would that work? Could I then have a
function such as:

    function(x, y, z) .Call(C_rnorm, x, y, z)

in my package? If not, what is the proper way of calling these functions
from other packages? Should I use "C_rnorm" or "norm"?

Also, I was looking for the C source code of rnorm, because I wanted to
understand how the function works. Looking at Winston Chang's github R
mirror, I found rnorm in the random.c file in the stats package. However,
the code I find for it:



#define DEFRAND2_REAL(name) \
SEXP do_##name(SEXP sn, SEXP sa, SEXP sb) { \
    return random2(sn, sa, sb, name, REALSXP); \
}
DEFRAND2_REAL(rnorm)


Doesn't help me at all in understanding how it works. It should create a
function random2(sn, sa, sb, norm, REALSXP); I understand that is a version
of the random2 function that returns a real S expression taking sn, sa and
sb as parameters. But how does find the actual functional form for the
normal distribution?

I am asking because I would like to rewrite some of the other functions,
such as parameterizing rbeta by the mean and sample size rather than by the
number of successes and failures and rgamma by the mean and total time
elapsed instead of the number of events. Once I understand how the C source
code works, it would be hopefully not very difficult to reparameterize them.

Thanks,

Luis Usier

	[[alternative HTML version deleted]]


From gmbecker at ucdavis.edu  Thu Jun 30 23:38:56 2016
From: gmbecker at ucdavis.edu (Gabriel Becker)
Date: Thu, 30 Jun 2016 14:38:56 -0700
Subject: [Rd] Calling C implementations of rnorm and friends
In-Reply-To: <CAOeuMBBshUcPrwBbgZdMZTgRYo3WEqia0O9DSWp4GEmuO7R=oQ@mail.gmail.com>
References: <CAOeuMBBshUcPrwBbgZdMZTgRYo3WEqia0O9DSWp4GEmuO7R=oQ@mail.gmail.com>
Message-ID: <CADwqtCNxchG_VL3Fe0Hqvvco7-BoiJ1SvRA1SAz7uVSa8yW4qA@mail.gmail.com>

Luis,

C_rnorm is a symbol but it's not exported.  This means that you *can* do
this by using stats:::C_rnorm.

That said, it's not exported, which means that it's not supported to do
this. So your package likely would not be allowed on CRAN, for example.

Best,
~G
On Jun 30, 2016 2:08 PM, "Luis Usier" <luis.henrique.usier at gmail.com> wrote:

> Hi all,
>
> Looking at the body for the function rnorm, I see that the body of the
> function is:
>
>     .Call(C_rnorm, n, mean, sd)
>
> I want to implement functions that generate normal (and other) random
> variables. Now, I understand that I can perfectly well just call the R
> wrapper for these functions and that will be almost indistinguishable for
> most purposes, but for whatever reason I wanted to try and call the C
> function directly. My first instinct was to call them as:
>
>     .Call(C_rnorm, 1, 1, 1)
>
> This doesn't work because R assumes C_rnorm is an object. Looking at the
> documentation for .Call, I try passing it in as a string:
>
>     .Call("C_rnorm", 1, 1, 1, PACKAGE = "stats")
>
> This doesn't work either. The help page links to getNativeSymbolInfo(),
> which I can't make work either. It also refers me to the dyn.load()
> function and the "Writing R  Extensions" manual.
>
> After reading and trying to digest those, I try
>
>     getDLLRegisteredRoutines("stats")
>
> which shows me all the C and Fortran functions as registered routines,
> along with their number of parameters. I retrieve rnorm from the list and
> pass it on to .Call, which then works fine.
>
> However, is there an easier way to do this? Specifically, I would like to
> call the DLL registered routines from within functions in a package I am
> writing. The manual tells me I should use useDynLib(). So if I added
> useDynLib("stats") to my namespace, would that work? Could I then have a
> function such as:
>
>     function(x, y, z) .Call(C_rnorm, x, y, z)
>
> in my package? If not, what is the proper way of calling these functions
> from other packages? Should I use "C_rnorm" or "norm"?
>
> Also, I was looking for the C source code of rnorm, because I wanted to
> understand how the function works. Looking at Winston Chang's github R
> mirror, I found rnorm in the random.c file in the stats package. However,
> the code I find for it:
>
>
>
> #define DEFRAND2_REAL(name) \
> SEXP do_##name(SEXP sn, SEXP sa, SEXP sb) { \
>     return random2(sn, sa, sb, name, REALSXP); \
> }
> DEFRAND2_REAL(rnorm)
>
>
> Doesn't help me at all in understanding how it works. It should create a
> function random2(sn, sa, sb, norm, REALSXP); I understand that is a version
> of the random2 function that returns a real S expression taking sn, sa and
> sb as parameters. But how does find the actual functional form for the
> normal distribution?
>
> I am asking because I would like to rewrite some of the other functions,
> such as parameterizing rbeta by the mean and sample size rather than by the
> number of successes and failures and rgamma by the mean and total time
> elapsed instead of the number of events. Once I understand how the C source
> code works, it would be hopefully not very difficult to reparameterize
> them.
>
> Thanks,
>
> Luis Usier
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

	[[alternative HTML version deleted]]


