From jramaza at gmail.com  Thu Nov  1 00:38:35 2012
From: jramaza at gmail.com (jose ramon mazaira)
Date: Thu, 1 Nov 2012 00:38:35 +0100
Subject: [Rd] Retrieving data from aspx pages
In-Reply-To: <509163D3.5040703@gmail.com>
References: <CAMd97KyY-PMRFZ=ktgqp2t-u73vs2_frcWLE31uOivU9T-j5Yg@mail.gmail.com>
	<508FCA3F.2070104@gmail.com>
	<CADwqtCNafNe=daUD7BAcvb2wS8rgNvtCJPynBuukqvNOtO0BbA@mail.gmail.com>
	<508FD791.6090209@gmail.com>
	<CAMd97KztkXTpj99JsMxOzSy=cmg9PmM15Fq43t1tLFNBfeVaoA@mail.gmail.com>
	<509026FB.6000302@gmail.com>
	<CAMd97KyACq9nv0vpc+iVTYAXjxXBmNL2ScjcCgaL+1r=NZ3BaQ@mail.gmail.com>
	<509163D3.5040703@gmail.com>
Message-ID: <CAMd97Kw1714MWHn2PEG89wmj=Ez3Sdf5BZf0Omj1Cfq2Hb_ZjA@mail.gmail.com>

Yes, you're right, I was wrong. I've been trying to use the postForm
method in RCurl but it doesn't work. I'll check the source code in
this package to see if I can improve it.

2012/10/31, Paul Gilbert <pgilbert902 at gmail.com>:
> I must be really dense, I know RCurl provides a POST capability, but I
> don't see how this allows "interaction". Suppose the example actually
> worked, which it does not. (Unfortunately many of the examples in RCurl
> seem to be marked \dontrun{} or disabled with some if() condition.) When
> you post to a page like this you will often get something back that has
> a dynamically generated URI, and you will need  to post more information
> to that page. But how do you find out the URI of that next dynamically
> generated page? Even when you know what you will need to post, you need
> the URI to do it. If RCurl provided interaction you would be able get
> the URI so you could post to the next page. Maybe you can do that, but I
> have not discover how. If you know how, I would appreciate a real
> working example.
>
> Paul
>
> On 12-10-31 12:14 PM, jose ramon mazaira wrote:
>> I'd like to make you note that I've discovered that package RCurl
>> already provides a utility that allows interaction via POST requests
>> with servers. In fact, the FAQ for RCurl contains specifically an
>> example with an aspx page:
>>
>> x = postForm("http://www.fas.usda.gov/psdonline/psdResult.aspx",
>>               style = "post",
>>              .params = list(visited="1",
>>                            lstGroup = "all",
>>                            lstCommodity="2631000",
>>                            lstAttribute="88",
>>                            lstCountry="**",
>>                            lstDate="2011",
>>                            lstColumn="Year",
>>                            lstOrder="Commodity%2FAttribute%2FCountry"))
>>
>> Check this link: http://www.omegahat.org/RCurl
>> However, I think that it would be more useful to automate the
>> interaction with servers retrieving automatically the name-value pairs
>> required by the server (parsing the page source code) instead of
>> examining in each web page the appropiate fields.
>>
>> 2012/10/30, Paul Gilbert <pgilbert902 at gmail.com>:
>>> Jose
>>>
>>> As far as getting to the data, I think the best way to do this sort of
>>> thing would be if the site supports a SOAP or REST interface. When they
>>> don't (yet) then one is faced with clicking through some pages. Python
>>> or Java is one way to automate the process of clicking through the
>>> pages. I don't know how to do that in R, but would like to know if it is
>>> possible.
>>>
>>> But, I guess I was confused about the part you want to improve. What I
>>> have works fairly smoothly parsing and passing back JSON data, converted
>>> from a csv file, into R. The downside is that this approach requires
>>> more than R to be installed on the client machine. But if the object you
>>> get back is ASPX, then you either need to parse it directly, or convert
>>> it to JSON, or something else you can deal with. I suspect that will be
>>> fairly specific to a particular web site, but I don't really know enough
>>> about ASPX to be sure.
>>>
>>> Paul
>>>
>>> On 12-10-30 01:12 PM, jose ramon mazaira wrote:
>>>> Thanks for your interest, Paul.
>>>> I've checked the source code of TSjson and I've seen that what it does
>>>> is to call a Python script to retrieve the data. In fact, I've already
>>>> done this with Java using the URLConnection class and sending the
>>>> requested values to fill the form.
>>>> However, I think it would be more useful to open a connection with R
>>>> and to send the requested values within R, and not through an external
>>>> program.
>>>> The application I've designed, like yours, is also page-specific
>>>> (i.e., designed for
>>>> http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx),
>>>> but I think that our applications would be more powerful if they were
>>>> able to parse the name-value pairs generated from ASPX (or of any
>>>> other dynamically generated web page) and ask the user to select the
>>>> appropiate values.
>>>>
>>>> 2012/10/30, Paul Gilbert <pgilbert902 at gmail.com>:
>>>>> I think RHTMLForms works if you have a single form, but I have not
>>>>> been
>>>>> able to see how to use it when you need to go through a sequence of
>>>>> dynamically generated forms (like you can do with Python mechanize).
>>>>>
>>>>> Paul
>>>>>
>>>>> On 12-10-30 09:08 AM, Gabriel Becker wrote:
>>>>>> I haven't used it extensively myself, and can't speak to it's current
>>>>>> state but on quick inspection RHTMLForms seems worth a look for what
>>>>>> you
>>>>>> want.
>>>>>>
>>>>>> http://www.omegahat.org/RHTMLForms/
>>>>>>
>>>>>> ~G
>>>>>>
>>>>>> On Tue, Oct 30, 2012 t 5:38 AM, Paul Gilbert <pgilbert902 at gmail.com
>>>>>> <mailto:pgilbert902 at gmail.com>> wrote:
>>>>>>
>>>>>>       I don't know of an easy way to do this in R. I've been doing
>>>>>>       something similar with python scripts called from R. If anyone
>>>>>> knows
>>>>>>       how to do this with just R, I would appreciate hearing too.
>>>>>>
>>>>>>       Paul
>>>>>>
>>>>>>
>>>>>>       On 12-10-29 04:11 PM, jose ramon mazaira wrote:
>>>>>>
>>>>>>           Hi. I'm trying to write an application to retrieve
>>>>>> financial
>>>>>> data
>>>>>>           (specially bonds data) from FINRA. The web page is served
>>>>>>           dynamically
>>>>>>           from an asp.net <http://asp.net> application:
>>>>>>
>>>>>>
>>>>>> http://cxa.gtm.__idmanagedsolutions.com/finra/__BondCenter/AdvancedScreener.__aspx
>>>>>>
>>>>>> <http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx>
>>>>>>
>>>>>>           I'd like to know if it's possible to fill dynamically the
>>>>>> web
>>>>>> page
>>>>>>           form from R and, after filling it (with the issuer name),
>>>>>>           retrieve the
>>>>>>           web page, parse the data, and covert it to appropiate R
>>>>>> objects.
>>>>>>           For example, suppose I want to search data for AT&T bonds.
>>>>>> I'd
>>>>>>           like to
>>>>>>           know if it's possible, within R, to fill the page served
>>>>>> from:
>>>>>>
>>>>>>
>>>>>> http://cxa.gtm.__idmanagedsolutions.com/finra/__BondCenter/AdvancedScreener.__aspx
>>>>>>
>>>>>> <http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx>
>>>>>>
>>>>>>           select the "corporate" option and fill with AT&T the field
>>>>>> for
>>>>>>           "Issuer
>>>>>>           name", ask the page to display the results, and retrieve
>>>>>> the
>>>>>> results
>>>>>>           for each of the bonds issued by AT&T (for example:
>>>>>>
>>>>>>
>>>>>> http://cxa.gtm.__idmanagedsolutions.com/finra/__BondCenter/BondDetail.aspx?ID=__MDAxOTU3Qko3
>>>>>>
>>>>>> <http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/BondDetail.aspx?ID=MDAxOTU3Qko3>)
>>>>>>
>>>>>>           and parsing the data from the web page.
>>>>>>
>>>>>>           Thanks in advance.
>>>>>>
>>>>>>           ________________________________________________
>>>>>>           R-devel at r-project.org <mailto:R-devel at r-project.org>
>>>>>> mailing
>>>>>> list
>>>>>>           https://stat.ethz.ch/mailman/__listinfo/r-devel
>>>>>>           <https://stat.ethz.ch/mailman/listinfo/r-devel>
>>>>>>
>>>>>>
>>>>>>       ________________________________________________
>>>>>>       R-devel at r-project.org <mailto:R-devel at r-project.org> mailing
>>>>>> list
>>>>>>       https://stat.ethz.ch/mailman/__listinfo/r-devel
>>>>>>       <https://stat.ethz.ch/mailman/listinfo/r-devel>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>> --
>>>>>> Gabriel Becker
>>>>>> Graduate Student
>>>>>> Statistics Department
>>>>>> University of California, Davis
>>>>>>
>>>>>
>>>
>


From mdowle at mdowle.plus.com  Thu Nov  1 16:48:54 2012
From: mdowle at mdowle.plus.com (Matthew Dowle)
Date: Thu, 1 Nov 2012 15:48:54 -0000
Subject: [Rd] There is pmin and pmax each taking na.rm, how about psum?
Message-ID: <029ad04ced1bc1522c4a1e276b5dcba1.squirrel@webmail.plus.net>


Justin Talbot <jtalbot <at> stanford.edu> writes:
>
> > Because that's inconsistent with pmin and pmax when two NAs are summed.
> >
> > x = c(1,3,NA,NA,5)
> > y = c(2,NA,4,NA,1)
> > colSums(rbind(x, y), na.rm = TRUE)
> > [1] 3 3 4 0 6    # actual
> > [1] 3 3 4 NA 6   # desired
>
> But your desired result would be inconsistent with sum:
> sum(NA,NA,na.rm=TRUE)
> [1] 0
>
> >From a language definition perspective I think having psum return 0
> here is right choice.

Ok, you've sold me. psum(NA,NA,na.rm=TRUE) returning 0 sounds good. And
pprod(NA,NA,na.rm=TRUE) returning 1, consistent with prod then.

Then the case for psum is more for convenience and speed -vs-
colSums(rbind(x,y), na.rm=TRUE)), since rbind will copy x and y into a new
matrix. The case for pprod is similar, plus colProds doesn't exist.

> Thus, + should have the signature: `+`(..., na.rm=FALSE), which would
> allow you to do things like:
>
> `+`(c(1,2),c(1,2),c(1,2),NA, na.rm=TRUE) = c(3,6)
>
> If you don't like typing `+`, you could always alias psum to `+`.

But there would be a cost, wouldn't there? `+` is a dyadic .Primitive.
Changing that to take `...` and `na.rm` could slow it down (iiuc), and any
changes to the existing language are risky.  For example :
    `+`(1,2,3)
is currently an error. Changing that to do something might have
implications for some of the 4,000 packages (some might rely on that being
an error), with a possible speed cost too.

In contrast, adding two functions that didn't exist before: psum and pprod,
seems to be a safer and simpler proposition.

Matthew


From spencer.graves at prodsyse.com  Thu Nov  1 20:00:55 2012
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Thu, 01 Nov 2012 12:00:55 -0700
Subject: [Rd] if(!CRAN()){...}
Message-ID: <5092C6E7.6030406@prodsyse.com>

Hello, All:


       What changes are being considered / planned in the management and 
funding of CRAN and R-Forge to handle the near-exponential growth in the 
number of packages?


       I ask, because the developers for fda were asked to cut the test 
time on CRAN to below 5 seconds per *.Rd file.  After spending a few 
days on this, we reluctantly eliminated tests using if(!CRAN()){...} in 
the \examples.  Restricting test times and similar changes will keep the 
current system running a little longer, but would not seem to be 
adequate long term.


       Thanks,
       Spencer


From murdoch.duncan at gmail.com  Thu Nov  1 20:16:27 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 01 Nov 2012 15:16:27 -0400
Subject: [Rd] if(!CRAN()){...}
In-Reply-To: <5092C6E7.6030406@prodsyse.com>
References: <5092C6E7.6030406@prodsyse.com>
Message-ID: <5092CA8B.7000502@gmail.com>

On 01/11/2012 3:00 PM, Spencer Graves wrote:
> Hello, All:
>
>
>         What changes are being considered / planned in the management and
> funding of CRAN and R-Forge to handle the near-exponential growth in the
> number of packages?
>
>
>         I ask, because the developers for fda were asked to cut the test
> time on CRAN to below 5 seconds per *.Rd file.  After spending a few
> days on this, we reluctantly eliminated tests using if(!CRAN()){...} in
> the \examples.  Restricting test times and similar changes will keep the
> current system running a little longer, but would not seem to be
> adequate long term.

You're writing to the wrong place:  you should be asking CRAN this 
question.  Their email is cran at r-project.org.  They generally don't 
discuss their operations in R-devel.

Duncan Murdoch


From h.wickham at gmail.com  Thu Nov  1 23:20:20 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Thu, 1 Nov 2012 17:20:20 -0500
Subject: [Rd] if(!CRAN()){...}
In-Reply-To: <5092CA8B.7000502@gmail.com>
References: <5092C6E7.6030406@prodsyse.com> <5092CA8B.7000502@gmail.com>
Message-ID: <CABdHhvH0E+46m1ctDh7u0_C_7j3eUsCN-USRTX_g64DPhHXpTA@mail.gmail.com>

> You're writing to the wrong place:  you should be asking CRAN this question.
> Their email is cran at r-project.org.  They generally don't discuss their
> operations in R-devel.

Who is CRAN?  Is that publicly available information?

Hadley

-- 
RStudio / Rice University
http://had.co.nz/


From murdoch.duncan at gmail.com  Fri Nov  2 00:37:46 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 01 Nov 2012 19:37:46 -0400
Subject: [Rd] if(!CRAN()){...}
In-Reply-To: <CABdHhvH0E+46m1ctDh7u0_C_7j3eUsCN-USRTX_g64DPhHXpTA@mail.gmail.com>
References: <5092C6E7.6030406@prodsyse.com> <5092CA8B.7000502@gmail.com>
	<CABdHhvH0E+46m1ctDh7u0_C_7j3eUsCN-USRTX_g64DPhHXpTA@mail.gmail.com>
Message-ID: <509307CA.503@gmail.com>

On 12-11-01 6:20 PM, Hadley Wickham wrote:
>> You're writing to the wrong place:  you should be asking CRAN this question.
>> Their email is cran at r-project.org.  They generally don't discuss their
>> operations in R-devel.
>
> Who is CRAN?  Is that publicly available information?

Why don't you ask them?  If they don't want to discuss things in 
R-devel, it seems rather rude to talk *about* them here.

Duncan Murdoch


From hpages at fhcrc.org  Fri Nov  2 01:13:05 2012
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Thu, 01 Nov 2012 17:13:05 -0700
Subject: [Rd] unedited copy/paste from install.packages man page to
 update.packages man page
Message-ID: <50931011.3050508@fhcrc.org>

Hi,

Found in the man page for update.packages:

    repos: character vector, the base URL(s) of the repositories to use,
           i.e., the URL of the CRAN master such as
           ?"http://cran.r-project.org"? or its Statlib mirror,
           ?"http://lib.stat.cmu.edu/R/CRAN"?.Can be ?NULL? to install
           from local files (?.tar.gz? for source packages).

- Using "e.g." instead of "i.e." would seem more appropriate.

- But more importantly, is repos = NULL really supported for
   update.packages? I wonder where I need to place the local files
   for this to work. I tried to put them in the current working
   directory but that didn't work:

     > packageVersion("BSgenome")
     [1] ?1.27.1?
     > dir()
     [1] "BSgenome_2.0.0.tar.gz"
     > update.packages(repos=NULL)

   This description of the 'repos' arg looks more like a copy/paste from
   the man page for install.packages that needed some edit.

- Another copy/paste is the \examples section for update.packages that
   shows in fact an example for install.packages, which is the same
   example that is shown in the man page for install.packages.

Could those minor things be corrected?

Thanks,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From edd at debian.org  Fri Nov  2 02:02:37 2012
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 1 Nov 2012 20:02:37 -0500
Subject: [Rd] if(!CRAN()){...}
In-Reply-To: <CABdHhvH0E+46m1ctDh7u0_C_7j3eUsCN-USRTX_g64DPhHXpTA@mail.gmail.com>
References: <5092C6E7.6030406@prodsyse.com> <5092CA8B.7000502@gmail.com>
	<CABdHhvH0E+46m1ctDh7u0_C_7j3eUsCN-USRTX_g64DPhHXpTA@mail.gmail.com>
Message-ID: <20627.7085.271354.649455@max.nulle.part>


On 1 November 2012 at 17:20, Hadley Wickham wrote:
| > You're writing to the wrong place:  you should be asking CRAN this question.
| > Their email is cran at r-project.org.  They generally don't discuss their
| > operations in R-devel.
| 
| Who is CRAN?  Is that publicly available information?

"Sort of" --- quoting from the top of the 'CRAN Repository Policy' page:

      CRAN is maintained by the efforts of volunteers (the ?CRAN team?) and
      the resources of the R Foundation and the employers of those volunteers
      (WU Wien, TU Dortmund, U Oxford, AT&T Research).

Dirk

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com  


From ivan.popivanov at gmail.com  Fri Nov  2 01:46:42 2012
From: ivan.popivanov at gmail.com (Ivan Popivanov)
Date: Thu, 1 Nov 2012 20:46:42 -0400
Subject: [Rd] An idea: Extend mclapply's mc.set.seed with an initial seed
	value?
Message-ID: <CAK7-yAiAfdBZQVbh2iqRknV9Q6Sjt1HRk4cgNRMgCbbDWeqCCw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121101/b425d0da/attachment.pl>

From i.costigan at me.com  Fri Nov  2 10:28:01 2012
From: i.costigan at me.com (Imanuel Costigan)
Date: Fri, 02 Nov 2012 20:28:01 +1100
Subject: [Rd] Can't install.packages() from local repo in 2.15.2
Message-ID: <68F6B03EA32F4411AA92B12E16E7A973@me.com>

Hi guys  

I think there's a high chance this is a bug. But I can't rule out that I can be blamed for this. I've posted this to bugzilla (#15092). Then I read that I probably should have posted it to R-develop first. Sorry for doing this in the wrong order.

I've set up a local repo on my local drive (happens to be mapped to L:/). It has the following structure (as per http://cran.r-project.org/doc/manuals/R-admin.html#Setting-up-a-package-repository):  

L:/R/bin/windows/contrib/  
2.11/  
2.12/  
2.13/  
2.14/  
2.15/  
L:/R/src/contrib  

I created a bare bones package (`anRpackage`) using `package.skeleton`. I cleaned it up and added a basic function, checked it and built it from command line using `R CMD INSTALL --build .`. That generates `anRpackage_1.0.zip` with no errors. Note:

 ```  
$ R CMD INSTALL --build --version  
R add-on package installer: 2.15.2 (r61015)  
```  

I have Rtools 2.16 installed (as this is for R >2.15.1 to R 2.16.x). I have also followed the instructions here: http://cran.r-project.org/doc/manuals/R-admin.html#The-Windows-toolset

I copy that to L:/R/bin/windows/contrib/2.15 (for example), run `tools::write_PACKAGES()` in that directory. That successfully generates the packages file. I also run `tools::write_PACKAGES()` in L:/R/src/contrib to generate an empty PACKAGES file.  

I have the following in my .Rprofile (among other things):  

```  
.First <- function ()  
{  
   options( repos = c(CRAN = "http://cran.csiro.au/",  
                               LREPO = "file:///L:/R/"))  
}  
```  

I run `install.packages("anRpackage") and I get the following error:  

```  
Installing package(s) into ?C:/Program Files/R/R-2.15.2/library?  
(as ?lib? is unspecified)  
Warning in install.packages : package ?anRpackage? is not available (for R version 2.15.2)  
```  

Same issue on another Windows machine.

However, if I run `install.packages("L:/R/bin/windows/contrib/2.15/anRpackage_1.0.zip", repos=NULL)`, it installs successfully.  

I do not have this problem in R 2.15.1.

NB: If I provide full file path to install.packages and set repos=NULL, and then check the package's DESCRIPTION file in the help, I see this at the bottom:  

`Built: R 2.15.2; ; 2012-11-01 00:22:07 UTC; windows`  

(when I've built package using 2.15.2 obviously)

Thanks.  


From nashjc at uottawa.ca  Fri Nov  2 13:34:17 2012
From: nashjc at uottawa.ca (U30A J C Nash)
Date: Fri, 02 Nov 2012 08:34:17 -0400
Subject: [Rd] if(!CRAN()){...} / Repository policies
In-Reply-To: <mailman.25.1351854007.9519.r-devel@r-project.org>
References: <mailman.25.1351854007.9519.r-devel@r-project.org>
Message-ID: <5093BDC9.1020507@uottawa.ca>

If CRAN were a passive repository, the discussion about its policies 
would not be relevant to this list e.g., SourceForge. However, the 
development of R and its packages are very intimately connected to the 
CRAN repository policy.

I doubt any of the players in building our current R ecosystem ever 
imagined it would become this big. The serious implications of 
repository and related policies for future development and health of 
this ecosystem and its community members deserve transparent debate. As 
with any movement based on volunteer contribution, R will adapt or be 
replaced.

As far as I'm aware -- and welcome correction -- we don't have a list to 
discuss policies by CRAN or other actors. This list seems appropriate 
because it generally involves those doing development for R. Whether 
R-core should or should not listen to such deliberations is also open to 
debate. My own view -- which could change depending on how things evolve 
-- is that a small central committee is fine as long as they are able to 
both support and be supported by the wider development community that 
provides the packages giving R its strength. Unfortunately, I sense that 
the time demands of what is now a major software system are such that 
communications (and tempers) are getting frayed. I urge attention to 
this, and also to ideas of organizational behaviour and evolution, so we 
keep R healthy. Those who know me will realize I'm willing to put in 
time to act as the glue in building communications.

I'm also a bit surprised nobody has mentioned the mirrors -- if the 
mirror repositories choose, say, the Alternative R Archive Network, 
which might also include sweater patterns, the effectiveness of the CRAN 
system would be crippled.

John Nash


From pgilbert902 at gmail.com  Fri Nov  2 16:10:02 2012
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Fri, 02 Nov 2012 11:10:02 -0400
Subject: [Rd] An idea: Extend mclapply's mc.set.seed with an initial
 seed value?
In-Reply-To: <CAK7-yAiAfdBZQVbh2iqRknV9Q6Sjt1HRk4cgNRMgCbbDWeqCCw@mail.gmail.com>
References: <CAK7-yAiAfdBZQVbh2iqRknV9Q6Sjt1HRk4cgNRMgCbbDWeqCCw@mail.gmail.com>
Message-ID: <5093E24A.1030700@gmail.com>

I appreciate your problem, and getting reproducible random generator 
results on a parallel system is something to be careful about. However, 
I would avoid making it too easy to have a fixed seed. In earlier days 
there were mistakes too often made by users inadvertently using the same 
seed over and over again (on simple single processor systems), for 
example, by reloading a session with the seed set.

Paul

On 12-11-01 08:46 PM, Ivan Popivanov wrote:
> Hello,
>
> Have been thinking that sometimes users may want each process to initialize
> its random seed with a specific value rather then the current seed. This
> could be keyed off depending whether mc.set.seed is logical, preserving the
> current behaviour, or numerical, using the value in a call to set.seed.
> Does this make sense?
>
> If you wonder how I came up with the idea: I spent a couple of hours
> debugging "unstable" results from parallel tuning of svms, which was caused
> by the parallel execution. In my case I can simply do the set.seed in the
> FUN argument function, but that may not be always the case.
>
> Ivan
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Fri Nov  2 16:39:29 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 2 Nov 2012 15:39:29 +0000 (GMT)
Subject: [Rd] An idea: Extend mclapply's mc.set.seed with an initial
 seed value?
In-Reply-To: <5093E24A.1030700@gmail.com>
References: <CAK7-yAiAfdBZQVbh2iqRknV9Q6Sjt1HRk4cgNRMgCbbDWeqCCw@mail.gmail.com>
	<5093E24A.1030700@gmail.com>
Message-ID: <alpine.LFD.2.02.1211021533130.10164@toucan.stats.ox.ac.uk>

On Fri, 2 Nov 2012, Paul Gilbert wrote:

> I appreciate your problem, and getting reproducible random generator results 
> on a parallel system is something to be careful about. However, I would avoid 
> making it too easy to have a fixed seed. In earlier days there were mistakes 
> too often made by users inadvertently using the same seed over and over again 
> (on simple single processor systems), for example, by reloading a session 
> with the seed set.

But R already makes what I take to be the wish really easy:

set.seed(123)
mclapply(...)

sets the same seed on each child.

And the other option, mc.set.seed = TRUE, makes it easy to have 
reproducibly different seeds on each child.  See 
?parallel::mcparallel .

>
> Paul
>
> On 12-11-01 08:46 PM, Ivan Popivanov wrote:
>> Hello,
>> 
>> Have been thinking that sometimes users may want each process to initialize
>> its random seed with a specific value rather then the current seed. This
>> could be keyed off depending whether mc.set.seed is logical, preserving the
>> current behaviour, or numerical, using the value in a call to set.seed.
>> Does this make sense?
>> 
>> If you wonder how I came up with the idea: I spent a couple of hours
>> debugging "unstable" results from parallel tuning of svms, which was caused
>> by the parallel execution. In my case I can simply do the set.seed in the
>> FUN argument function, but that may not be always the case.
>> 
>> Ivan

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Sat Nov  3 16:37:24 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 03 Nov 2012 15:37:24 +0000
Subject: [Rd] if(!CRAN()){...}
In-Reply-To: <509307CA.503@gmail.com>
References: <5092C6E7.6030406@prodsyse.com> <5092CA8B.7000502@gmail.com>
	<CABdHhvH0E+46m1ctDh7u0_C_7j3eUsCN-USRTX_g64DPhHXpTA@mail.gmail.com>
	<509307CA.503@gmail.com>
Message-ID: <50953A34.6060801@stats.ox.ac.uk>

On 01/11/2012 23:37, Duncan Murdoch wrote:
> On 12-11-01 6:20 PM, Hadley Wickham wrote:
>>> You're writing to the wrong place:  you should be asking CRAN this
>>> question.
>>> Their email is cran at r-project.org.  They generally don't discuss their
>>> operations in R-devel.
>>
>> Who is CRAN?  Is that publicly available information?
>
> Why don't you ask them?  If they don't want to discuss things in
> R-devel, it seems rather rude to talk *about* them here.
>
> Duncan Murdoch

CRAN is not a single operation: it is a repository for packages, a 
website, an ftp and rsync server, a set of mirrors, a distributed check 
farm ....  Many aspects, e.g. the task views, binary packages, are 
delegated.

'Who is CRAN' implies a single person, but hundreds of people help 
operate the services.  The instigator (in 1997) and prime mover is Kurt 
Hornik (but you knew that).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Sun Nov  4 10:32:10 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 04 Nov 2012 09:32:10 +0000
Subject: [Rd] Can't install.packages() from local repo in 2.15.2
In-Reply-To: <68F6B03EA32F4411AA92B12E16E7A973@me.com>
References: <68F6B03EA32F4411AA92B12E16E7A973@me.com>
Message-ID: <5096361A.4010105@stats.ox.ac.uk>

Your subject line isn't truthful.  At the very least you are talking 
about binary packages on Windows using a file:// repository ('local' 
does not usually mean that, and is specified by NULL).

I think you have not understood the NEWS item: most likely you do not 
have a parallel source repository.

     * For a Windows or Mac OS X binary package install,
       install.packages() will check if a source package is available on
       the same repositories, and report if it is a later version or
       there is a source package but no binary package available.

       This check can be suppressed: see the help page.

I guess you did not do so.  Try
options(install.packages.check.source = FALSE)
which works for me.

You could also specify contriburl, as you have a partial repository.



On 02/11/2012 09:28, Imanuel Costigan wrote:
> Hi guys
>
> I think there's a high chance this is a bug. But I can't rule out that I can be blamed for this. I've posted this to bugzilla (#15092). Then I read that I probably should have posted it to R-develop first. Sorry for doing this in the wrong order.
>
> I've set up a local repo on my local drive (happens to be mapped to L:/). It has the following structure (as per http://cran.r-project.org/doc/manuals/R-admin.html#Setting-up-a-package-repository):
>
> L:/R/bin/windows/contrib/
> 2.11/
> 2.12/
> 2.13/
> 2.14/
> 2.15/
> L:/R/src/contrib
>
> I created a bare bones package (`anRpackage`) using `package.skeleton`. I cleaned it up and added a basic function, checked it and built it from command line using `R CMD INSTALL --build .`. That generates `anRpackage_1.0.zip` with no errors. Note:
>
>   ```
> $ R CMD INSTALL --build --version
> R add-on package installer: 2.15.2 (r61015)
> ```
>
> I have Rtools 2.16 installed (as this is for R >2.15.1 to R 2.16.x). I have also followed the instructions here: http://cran.r-project.org/doc/manuals/R-admin.html#The-Windows-toolset
>
> I copy that to L:/R/bin/windows/contrib/2.15 (for example), run `tools::write_PACKAGES()` in that directory. That successfully generates the packages file. I also run `tools::write_PACKAGES()` in L:/R/src/contrib to generate an empty PACKAGES file.
>
> I have the following in my .Rprofile (among other things):
>
> ```
> .First <- function ()
> {
>     options( repos = c(CRAN = "http://cran.csiro.au/",
>                                 LREPO = "file:///L:/R/"))
> }
> ```
>
> I run `install.packages("anRpackage") and I get the following error:
>
> ```
> Installing package(s) into ?C:/Program Files/R/R-2.15.2/library?
> (as ?lib? is unspecified)
> Warning in install.packages : package ?anRpackage? is not available (for R version 2.15.2)
> ```
>
> Same issue on another Windows machine.
>
> However, if I run `install.packages("L:/R/bin/windows/contrib/2.15/anRpackage_1.0.zip", repos=NULL)`, it installs successfully.
>
> I do not have this problem in R 2.15.1.
>
> NB: If I provide full file path to install.packages and set repos=NULL, and then check the package's DESCRIPTION file in the help, I see this at the bottom:
>
> `Built: R 2.15.2; ; 2012-11-01 00:22:07 UTC; windows`
>
> (when I've built package using 2.15.2 obviously)
>
> Thanks.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jtalbot at stanford.edu  Sun Nov  4 15:35:57 2012
From: jtalbot at stanford.edu (Justin Talbot)
Date: Sun, 4 Nov 2012 06:35:57 -0800
Subject: [Rd] There is pmin and pmax each taking na.rm, how about psum?
In-Reply-To: <029ad04ced1bc1522c4a1e276b5dcba1.squirrel@webmail.plus.net>
References: <029ad04ced1bc1522c4a1e276b5dcba1.squirrel@webmail.plus.net>
Message-ID: <CALLn38MyFMvY1vdOkumvMz6-iQrp6HPL_v6SZqJQPzK-TqZ+UA@mail.gmail.com>

>
> Then the case for psum is more for convenience and speed -vs-
> colSums(rbind(x,y), na.rm=TRUE)), since rbind will copy x and y into a new
> matrix. The case for pprod is similar, plus colProds doesn't exist.
>

Right, and consistency; for what that's worth.

>> Thus, + should have the signature: `+`(..., na.rm=FALSE), which would
>> allow you to do things like:
>>
>> `+`(c(1,2),c(1,2),c(1,2),NA, na.rm=TRUE) = c(3,6)
>>
>> If you don't like typing `+`, you could always alias psum to `+`.
>
> But there would be a cost, wouldn't there? `+` is a dyadic .Primitive.
> Changing that to take `...` and `na.rm` could slow it down (iiuc), and any
> changes to the existing language are risky.  For example :
>     `+`(1,2,3)
> is currently an error. Changing that to do something might have
> implications for some of the 4,000 packages (some might rely on that being
> an error), with a possible speed cost too.
>

There would be a very slight performance cost for the current
interpreter. For the new bytecode compiler though there would be no
performance cost since the common binary form can be detected at
compile time and an optimized bytecode can be emitted for it.

Taking what's currently an error and making it legal is a pretty safe
change; unless someone is currently relying on `+`(1,2,3) to return an
error, which I doubt. I think the bigger question on making this
change work would be on the S3 dispatch logic. I don't understand the
intricacies of S3 well enough to know if this change is plausible or
not.

> In contrast, adding two functions that didn't exist before: psum and pprod,
> seems to be a safer and simpler proposition.

Definitely easier. Leaves the language a bit more complicated, but
that might be the right trade off. I would strongly suggest adding
pany and pall as well. I find myself wishing for them all the time.
prange would be nice as well.

Justin


From hb at biostat.ucsf.edu  Sun Nov  4 18:39:21 2012
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Sun, 4 Nov 2012 09:39:21 -0800
Subject: [Rd] There is pmin and pmax each taking na.rm, how about psum?
In-Reply-To: <CALLn38MyFMvY1vdOkumvMz6-iQrp6HPL_v6SZqJQPzK-TqZ+UA@mail.gmail.com>
References: <029ad04ced1bc1522c4a1e276b5dcba1.squirrel@webmail.plus.net>
	<CALLn38MyFMvY1vdOkumvMz6-iQrp6HPL_v6SZqJQPzK-TqZ+UA@mail.gmail.com>
Message-ID: <CAFDcVCTmL8koRHMG=V=gqxPuTanW0TinVJng+26QZz68=vnh3A@mail.gmail.com>

On Sun, Nov 4, 2012 at 6:35 AM, Justin Talbot <jtalbot at stanford.edu> wrote:
>>
>> Then the case for psum is more for convenience and speed -vs-
>> colSums(rbind(x,y), na.rm=TRUE)), since rbind will copy x and y into a new
>> matrix. The case for pprod is similar, plus colProds doesn't exist.
>>
>
> Right, and consistency; for what that's worth.
>
>>> Thus, + should have the signature: `+`(..., na.rm=FALSE), which would
>>> allow you to do things like:
>>>
>>> `+`(c(1,2),c(1,2),c(1,2),NA, na.rm=TRUE) = c(3,6)
>>>
>>> If you don't like typing `+`, you could always alias psum to `+`.
>>
>> But there would be a cost, wouldn't there? `+` is a dyadic .Primitive.
>> Changing that to take `...` and `na.rm` could slow it down (iiuc), and any
>> changes to the existing language are risky.  For example :
>>     `+`(1,2,3)
>> is currently an error. Changing that to do something might have
>> implications for some of the 4,000 packages (some might rely on that being
>> an error), with a possible speed cost too.
>>
>
> There would be a very slight performance cost for the current
> interpreter. For the new bytecode compiler though there would be no
> performance cost since the common binary form can be detected at
> compile time and an optimized bytecode can be emitted for it.
>
> Taking what's currently an error and making it legal is a pretty safe
> change; unless someone is currently relying on `+`(1,2,3) to return an
> error, which I doubt. I think the bigger question on making this
> change work would be on the S3 dispatch logic. I don't understand the
> intricacies of S3 well enough to know if this change is plausible or
> not.
>
>> In contrast, adding two functions that didn't exist before: psum and pprod,
>> seems to be a safer and simpler proposition.
>
> Definitely easier. Leaves the language a bit more complicated, but
> that might be the right trade off. I would strongly suggest adding
> pany and pall as well. I find myself wishing for them all the time.
> prange would be nice as well.

Have a look at the matrixStats package; it might bring what you're looking for:

  http://cran.r-project.org/web/packages/matrixStats

/Henrik

>
> Justin
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From mtmorgan at fhcrc.org  Sun Nov  4 21:29:00 2012
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Sun, 04 Nov 2012 12:29:00 -0800
Subject: [Rd] parallel::mclapply list coercion limits opportunities for code
	re-use?
Message-ID: <5096D00C.2020101@fhcrc.org>

The attached diff address the following issues in mclapply

mclapply coerces non-lists or objects (S3 or S4) to lists, but a list may not be 
an efficient representation and is not required if the object implements length, 
[, and [[ methods (lapply must also work on the object, either through coercion 
to a list at the 'inner.do' level or through other means, e.g., promoting lapply 
to a generic and writing a method specialized for the object). As written 
someone wishing to implement mclapply on an object not efficiently represented 
as a list would need to promote mclapply to a generic, and then re-implement an 
mclapply method for their object, rather than re-using the existing code.

mcparallel is not consistently invoked with a 'name' argument; a name seems to 
be superfluous to the code.

Creating the variable 'schedule' makes a full copy of a potentially large object 
in the master process; delaying until required in the inner.do function may (?) 
result in less copying.

Avoiding coercion to a list is similar to a suggestion for pvec.

   https://stat.ethz.ch/pipermail/r-devel/2012-October/065097.html

Martin
-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mclapply.diff
Type: text/x-patch
Size: 1924 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121104/8c735cb6/attachment.bin>

From mdowle at mdowle.plus.com  Sun Nov  4 22:28:35 2012
From: mdowle at mdowle.plus.com (Matthew Dowle)
Date: Sun, 4 Nov 2012 21:28:35 -0000
Subject: [Rd] There is pmin and pmax each taking na.rm, how about psum?
In-Reply-To: <CAFDcVCTmL8koRHMG=V=gqxPuTanW0TinVJng+26QZz68=vnh3A@mail.gmail.com>
References: <029ad04ced1bc1522c4a1e276b5dcba1.squirrel@webmail.plus.net>
	<CALLn38MyFMvY1vdOkumvMz6-iQrp6HPL_v6SZqJQPzK-TqZ+UA@mail.gmail.com>
	<CAFDcVCTmL8koRHMG=V=gqxPuTanW0TinVJng+26QZz68=vnh3A@mail.gmail.com>
Message-ID: <21df57b42fc82b1a4e65b51e1b9a6e0a.squirrel@webmail.plus.net>

> On Sun, Nov 4, 2012 at 6:35 AM, Justin Talbot <jtalbot at stanford.edu>
> wrote:
>>>
>>> Then the case for psum is more for convenience and speed -vs-
>>> colSums(rbind(x,y), na.rm=TRUE)), since rbind will copy x and y into a
>>> new
>>> matrix. The case for pprod is similar, plus colProds doesn't exist.
>>>
>>
>> Right, and consistency; for what that's worth.
>>
>>>> Thus, + should have the signature: `+`(..., na.rm=FALSE), which would
>>>> allow you to do things like:
>>>>
>>>> `+`(c(1,2),c(1,2),c(1,2),NA, na.rm=TRUE) = c(3,6)
>>>>
>>>> If you don't like typing `+`, you could always alias psum to `+`.
>>>
>>> But there would be a cost, wouldn't there? `+` is a dyadic .Primitive.
>>> Changing that to take `...` and `na.rm` could slow it down (iiuc), and
>>> any
>>> changes to the existing language are risky.  For example :
>>>     `+`(1,2,3)
>>> is currently an error. Changing that to do something might have
>>> implications for some of the 4,000 packages (some might rely on that
>>> being
>>> an error), with a possible speed cost too.
>>>
>>
>> There would be a very slight performance cost for the current
>> interpreter. For the new bytecode compiler though there would be no
>> performance cost since the common binary form can be detected at
>> compile time and an optimized bytecode can be emitted for it.
>>
>> Taking what's currently an error and making it legal is a pretty safe
>> change; unless someone is currently relying on `+`(1,2,3) to return an
>> error, which I doubt. I think the bigger question on making this
>> change work would be on the S3 dispatch logic. I don't understand the
>> intricacies of S3 well enough to know if this change is plausible or
>> not.

Interesting. Sounds more possible than I thought.

>>
>>> In contrast, adding two functions that didn't exist before: psum and
>>> pprod,
>>> seems to be a safer and simpler proposition.
>>
>> Definitely easier. Leaves the language a bit more complicated, but
>> that might be the right trade off. I would strongly suggest adding
>> pany and pall as well. I find myself wishing for them all the time.
>> prange would be nice as well.
>
> Have a look at the matrixStats package; it might bring what you're looking
> for:
>
>   http://cran.r-project.org/web/packages/matrixStats
>
> /Henrik

Nice package and very handy. It has colProds, too. But its functions take
a matrix.

' Then the case for psum is more for convenience and speed
-vs-colSums(rbind(x,y), na.rm=TRUE)), since rbind will copy x and y into a
new matrix. '

Matthew


From i.costigan at me.com  Mon Nov  5 11:16:23 2012
From: i.costigan at me.com (Imanuel Costigan)
Date: Mon, 05 Nov 2012 21:16:23 +1100
Subject: [Rd] Can't install.packages() from local repo in 2.15.2
In-Reply-To: <5096361A.4010105@stats.ox.ac.uk>
References: <68F6B03EA32F4411AA92B12E16E7A973@me.com>
	<5096361A.4010105@stats.ox.ac.uk>
Message-ID: <656F68320FF84D38AE941CE09B032B1D@me.com>


Hi Prof. Ripley,

There is in fact a parallel source repository (see my initial email):

L:/R/src/contrib

I had also run tools:write_PACKAGES() therein, generating an empty PACKAGES file as I have chosen not to release source packages.  

I would like to make two comments.

First, I believe the behaviour of install.packages isn't documented in at least the case that I found myself in. Namely, when the source package doesn't exist (and the src tree does exist), but the binary does, then the binary cannot be installed. Unless, of course, you specify the option install.packages.check.source = FALSE. I can confirm that this does resolve my error.

> For binary installs, the function also checks for the availability of a source package on the same repository, and reports if the source package has a later version, or is available but no binary version is.
  
Second, the error message could be improved to better specify what is causing the problem.

> Warning in install.packages : package ?anRpackage? is not available (for R version 2.15.2)

This is a bit vague. My suggestion, would be for the error message, in the case I found myself in, to read something like:

> Warning in install.packages : package 'anRpackage' is not available in the source tree

The R version number is a red-herring, except to the extent that this check didn't (appear to) occur in R 2.15.1. But given that most users will know they are using R 2.15.2 and that the repo structure doesn't require you to drill down past 2.15, this ending doesn't make much sense to me.  

In any case, thanks for your hard work in giving us such great software to use. I really appreciate it.  

On Sunday, 4 November 2012 at 8:32 PM, Prof Brian Ripley wrote:

> Your subject line isn't truthful. At the very least you are talking  
> about binary packages on Windows using a file:// repository ('local'  
> does not usually mean that, and is specified by NULL).
>  
> I think you have not understood the NEWS item: most likely you do not  
> have a parallel source repository.
>  
> * For a Windows or Mac OS X binary package install,
> install.packages() will check if a source package is available on
> the same repositories, and report if it is a later version or
> there is a source package but no binary package available.
>  
> This check can be suppressed: see the help page.
>  
> I guess you did not do so. Try
> options(install.packages.check.source = FALSE)
> which works for me.
>  
> You could also specify contriburl, as you have a partial repository.
>  
>  
>  
> On 02/11/2012 09:28, Imanuel Costigan wrote:
> > Hi guys
> >  
> > I think there's a high chance this is a bug. But I can't rule out that I can be blamed for this. I've posted this to bugzilla (#15092). Then I read that I probably should have posted it to R-develop first. Sorry for doing this in the wrong order.
> >  
> > I've set up a local repo on my local drive (happens to be mapped to L:/). It has the following structure (as per http://cran.r-project.org/doc/manuals/R-admin.html#Setting-up-a-package-repository):
> >  
> > L:/R/bin/windows/contrib/
> > 2.11/
> > 2.12/
> > 2.13/
> > 2.14/
> > 2.15/
> > L:/R/src/contrib
> >  
> > I created a bare bones package (`anRpackage`) using `package.skeleton`. I cleaned it up and added a basic function, checked it and built it from command line using `R CMD INSTALL --build .`. That generates `anRpackage_1.0.zip` with no errors. Note:
> >  
> > ```
> > $ R CMD INSTALL --build --version
> > R add-on package installer: 2.15.2 (r61015)
> > ```
> >  
> > I have Rtools 2.16 installed (as this is for R >2.15.1 to R 2.16.x). I have also followed the instructions here: http://cran.r-project.org/doc/manuals/R-admin.html#The-Windows-toolset
> >  
> > I copy that to L:/R/bin/windows/contrib/2.15 (for example), run `tools::write_PACKAGES()` in that directory. That successfully generates the packages file. I also run `tools::write_PACKAGES()` in L:/R/src/contrib to generate an empty PACKAGES file.
> >  
> > I have the following in my .Rprofile (among other things):
> >  
> > ```
> > .First <- function ()
> > {
> > options( repos = c(CRAN = "http://cran.csiro.au/",
> > LREPO = "file:///L:/R/"))
> > }
> > ```
> >  
> > I run `install.packages("anRpackage") and I get the following error:
> >  
> > ```
> > Installing package(s) into ?C:/Program Files/R/R-2.15.2/library?
> > (as ?lib? is unspecified)
> > Warning in install.packages : package ?anRpackage? is not available (for R version 2.15.2)
> > ```
> >  
> > Same issue on another Windows machine.
> >  
> > However, if I run `install.packages("L:/R/bin/windows/contrib/2.15/anRpackage_1.0.zip", repos=NULL)`, it installs successfully.
> >  
> > I do not have this problem in R 2.15.1.
> >  
> > NB: If I provide full file path to install.packages and set repos=NULL, and then check the package's DESCRIPTION file in the help, I see this at the bottom:
> >  
> > `Built: R 2.15.2; ; 2012-11-01 00:22:07 UTC; windows`
> >  
> > (when I've built package using 2.15.2 obviously)
> >  
> > Thanks.
> >  
> > ______________________________________________
> > R-devel at r-project.org (mailto:R-devel at r-project.org) (mailto:R-devel at r-project.org) mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >  
>  
>  
>  
>  
> --  
> Brian D. Ripley, ripley at stats.ox.ac.uk (mailto:ripley at stats.ox.ac.uk) (mailto:ripley at stats.ox.ac.uk)
> Professor of Applied Statistics, http://www.stats.ox.ac.uk/~ripley/
> University of Oxford, Tel: +44 1865 272861 (self)
> 1 South Parks Road, +44 1865 272866 (PA)
> Oxford OX1 3TG, UK Fax: +44 1865 272595
>  


From h.wickham at gmail.com  Mon Nov  5 15:47:00 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Mon, 5 Nov 2012 08:47:00 -0600
Subject: [Rd] Ops.data.frame
Message-ID: <CABdHhvHKAC=VLLaED03cHa2XkLoYJ1VgFFLgZW8FVRK3_=n0AQ@mail.gmail.com>

Hi all,

Where are the semantics for Ops.data.frame documented?  I've tried
looking in ?Ops.data.frame, ?data.frame, the "R language definition"
(by searching for data frame), and "An Introduction to R" (similarly),
but haven't found anything.  What am I missing?

Hadley

-- 
RStudio / Rice University
http://had.co.nz/


From suharto_anggono at yahoo.com  Mon Nov  5 17:49:39 2012
From: suharto_anggono at yahoo.com (Suharto Anggono Suharto Anggono)
Date: Mon, 5 Nov 2012 08:49:39 -0800 (PST)
Subject: [Rd] Another code to drop factor levels
Message-ID: <1352134179.7158.BPMail_low_carrier@web125105.mail.ne1.yahoo.com>


I apologize if this is not appropriate for this mailing list.

In R, there is already functionality to drop unused factor levels. However, I am proposing the code below that I wrote. In some occasions, it was faster than applying function 'factor'. In any case, there is no restriction for anyone to use the code below.

droplevels2 <- function(x) {
if (is.null(levels(x)))
 stop("no 'levels' attribute")
nlev <- length(levels(x))
y <- unclass(x)
tb <- tabulate(y, nlev)
used <- as.logical(tb)
tb[used] <-
 seq(length=sum(used))
y[] <- tb[y]
levels(y) <- levels(x)[used]
attr(y, "class") <-
 attr(x, "class")
y
}

Alternatively, one may use 'levels<-.factor' by assigning NA to unused levels, like below.

levels(x)[ tabulate(
unclass(x),
length(levels(x))) == 0 ] <-
NA


From cgenolin at u-paris10.fr  Tue Nov  6 17:19:09 2012
From: cgenolin at u-paris10.fr (Christophe Genolini)
Date: Tue, 06 Nov 2012 17:19:09 +0100
Subject: [Rd] Depends/Imports/Suggest/Enhence
Message-ID: <5099387D.1060805@u-paris10.fr>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121106/352c9879/attachment.pl>

From simon.urbanek at r-project.org  Tue Nov  6 17:36:32 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 6 Nov 2012 11:36:32 -0500
Subject: [Rd] Depends/Imports/Suggest/Enhence
In-Reply-To: <5099387D.1060805@u-paris10.fr>
References: <5099387D.1060805@u-paris10.fr>
Message-ID: <74B4544F-4D67-49AC-A293-3AAE59CFFF25@r-project.org>


On Nov 6, 2012, at 11:19 AM, Christophe Genolini wrote:

> Hi the list
> 
> In the DESCRIPTION file of my package foo0, I have:
> 
> Depends: foo1
> Imports: foo2
> Suggest: foo3
> Enhence: foo4
> 

(it is really "Suggests" and "Enhances" - the above are typos I presume and thus won't be recognized)


> If I understand correctly, to install foo0 on my computer, I need to already have foo1, foo2, foo3. 
> foo4 is not necessary.
> 

No, you only need foo1 and foo2. The other two are optional.


> I my R sesssion, when I will write: library(foo0), then the package foo1 will be attach. foo2, foo3 
> and foo4 will not. Is that correct?
> 

Yes


> But what is the difference between Import and Suggest?
> 

"Imports" means that symbols are imported form the namespace, so they are mandatory for the package to operate. "Suggests" means that symbols from the package are not required, but they are used in examples or vignettes, so the listed package(s) will be needed for a full check. They are not needed for the operation of the package, though.

Cheers,
Simon


> Christophe
> 
> -- 
> Christophe Genolini
> Ma?tre de conf?rences en bio-statistique
> Vice pr?sident Communication interne et animation du campus
> Universit? Paris Ouest Nanterre La D?fense
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From cgenolin at u-paris10.fr  Tue Nov  6 17:55:57 2012
From: cgenolin at u-paris10.fr (Christophe Genolini)
Date: Tue, 06 Nov 2012 17:55:57 +0100
Subject: [Rd] Depends/Imports/Suggest/Enhence
In-Reply-To: <74B4544F-4D67-49AC-A293-3AAE59CFFF25@r-project.org>
References: <5099387D.1060805@u-paris10.fr>
	<74B4544F-4D67-49AC-A293-3AAE59CFFF25@r-project.org>
Message-ID: <5099411D.6020608@u-paris10.fr>

  Thanks a lot for your answer.

> (it is really "Suggests" and "Enhances" - the above are typos I presume and thus won't be recognized)
Yes, it was typo. Sorry
> No, you only need foo1 and foo2. The other two are optional.
I get:

* checking package dependencies ... ERROR
Package suggested but not available: 'foo3'

> "Imports" means that symbols are imported form the namespace, so they are mandatory for the 
> package to operate. "Suggests" means that symbols from the package are not required, but they are 
> used in examples or vignettes, so the listed package(s) will be needed for a full check. They are 
> not needed for the operation of the package, though.
That's very clear, thanks a lot.
So I will use


  - 'Depends:foo1' if there is a function in foo1 that my package use often
  - 'Imports:foo2' if there is a function in foo2 that my package might use rarely
  - 'Suggest:foo3' if an example .Rd in foo0 needs a function in foo3

Right?

> Cheers, Simon
>> Christophe
>>
>> -- 
>> Christophe Genolini
>> Ma?tre de conf?rences en bio-statistique
>> Vice pr?sident Communication interne et animation du campus
>> Universit? Paris Ouest Nanterre La D?fense
>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Christophe Genolini
Ma?tre de conf?rences en bio-statistique
Vice pr?sident Communication interne et animation du campus
Universit? Paris Ouest Nanterre La D?fense


From marc_schwartz at me.com  Tue Nov  6 18:00:32 2012
From: marc_schwartz at me.com (Marc Schwartz)
Date: Tue, 06 Nov 2012 11:00:32 -0600
Subject: [Rd] Depends/Imports/Suggest/Enhence
In-Reply-To: <74B4544F-4D67-49AC-A293-3AAE59CFFF25@r-project.org>
References: <5099387D.1060805@u-paris10.fr>
	<74B4544F-4D67-49AC-A293-3AAE59CFFF25@r-project.org>
Message-ID: <096C9794-BF6C-4326-9FB7-D3621A516A86@me.com>


On Nov 6, 2012, at 10:36 AM, Simon Urbanek <Simon.Urbanek at r-project.org> wrote:

> 
> On Nov 6, 2012, at 11:19 AM, Christophe Genolini wrote:
> 
>> Hi the list
>> 
>> In the DESCRIPTION file of my package foo0, I have:
>> 
>> Depends: foo1
>> Imports: foo2
>> Suggest: foo3
>> Enhence: foo4
>> 
> 
> (it is really "Suggests" and "Enhances" - the above are typos I presume and thus won't be recognized)
> 
> 
>> If I understand correctly, to install foo0 on my computer, I need to already have foo1, foo2, foo3. 
>> foo4 is not necessary.
>> 
> 
> No, you only need foo1 and foo2. The other two are optional.


Just to add another option here, you need not have foo1 and foo2 already installed to install foo0. You can use:

  install.packages("foo0", dependencies = TRUE)

and that will install foo1 and foo2 at the same time. 'dependencies' defaults to FALSE. See ?install.packages for more info.

Regards,

Marc Schwartz


> 
>> I my R sesssion, when I will write: library(foo0), then the package foo1 will be attach. foo2, foo3 
>> and foo4 will not. Is that correct?
>> 
> 
> Yes
> 
> 
>> But what is the difference between Import and Suggest?
>> 
> 
> "Imports" means that symbols are imported form the namespace, so they are mandatory for the package to operate. "Suggests" means that symbols from the package are not required, but they are used in examples or vignettes, so the listed package(s) will be needed for a full check. They are not needed for the operation of the package, though.
> 
> Cheers,
> Simon
> 
> 
>> Christophe


From marc_schwartz at me.com  Tue Nov  6 18:18:40 2012
From: marc_schwartz at me.com (Marc Schwartz)
Date: Tue, 06 Nov 2012 11:18:40 -0600
Subject: [Rd] Depends/Imports/Suggest/Enhence
In-Reply-To: <096C9794-BF6C-4326-9FB7-D3621A516A86@me.com>
References: <5099387D.1060805@u-paris10.fr>
	<74B4544F-4D67-49AC-A293-3AAE59CFFF25@r-project.org>
	<096C9794-BF6C-4326-9FB7-D3621A516A86@me.com>
Message-ID: <7937CE23-F5C3-44A4-AA1A-3B07B34A6FFD@me.com>


On Nov 6, 2012, at 11:00 AM, Marc Schwartz <marc_schwartz at me.com> wrote:

> 
> On Nov 6, 2012, at 10:36 AM, Simon Urbanek <Simon.Urbanek at r-project.org> wrote:
> 
>> 
>> On Nov 6, 2012, at 11:19 AM, Christophe Genolini wrote:
>> 
>>> Hi the list
>>> 
>>> In the DESCRIPTION file of my package foo0, I have:
>>> 
>>> Depends: foo1
>>> Imports: foo2
>>> Suggest: foo3
>>> Enhence: foo4
>>> 
>> 
>> (it is really "Suggests" and "Enhances" - the above are typos I presume and thus won't be recognized)
>> 
>> 
>>> If I understand correctly, to install foo0 on my computer, I need to already have foo1, foo2, foo3. 
>>> foo4 is not necessary.
>>> 
>> 
>> No, you only need foo1 and foo2. The other two are optional.
> 
> 
> Just to add another option here, you need not have foo1 and foo2 already installed to install foo0. You can use:
> 
>  install.packages("foo0", dependencies = TRUE)
> 
> and that will install foo1 and foo2 at the same time. 'dependencies' defaults to FALSE. See ?install.packages for more info.


Actually, a correction here. 'dependencies' defaults to NA, which will handle Depends, Imports and LinkingTo for the packages explicitly listed in the 'pkgs' argument.

TRUE adds handling for Suggests in the packages listed in the 'pkgs' argument and then additional Depends, Imports and LinkingTo in other packages brought in as further dependencies. So if you get into nested package dependencies, you would want to use this.

Marc


> 
> Regards,
> 
> Marc Schwartz
> 
> 
>> 
>>> I my R sesssion, when I will write: library(foo0), then the package foo1 will be attach. foo2, foo3 
>>> and foo4 will not. Is that correct?
>>> 
>> 
>> Yes
>> 
>> 
>>> But what is the difference between Import and Suggest?
>>> 
>> 
>> "Imports" means that symbols are imported form the namespace, so they are mandatory for the package to operate. "Suggests" means that symbols from the package are not required, but they are used in examples or vignettes, so the listed package(s) will be needed for a full check. They are not needed for the operation of the package, though.
>> 
>> Cheers,
>> Simon
>> 
>> 
>>> Christophe
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From marc_schwartz at me.com  Tue Nov  6 18:38:30 2012
From: marc_schwartz at me.com (Marc Schwartz)
Date: Tue, 06 Nov 2012 11:38:30 -0600
Subject: [Rd] Depends/Imports/Suggest/Enhence
In-Reply-To: <5099411D.6020608@u-paris10.fr>
References: <5099387D.1060805@u-paris10.fr>
	<74B4544F-4D67-49AC-A293-3AAE59CFFF25@r-project.org>
	<5099411D.6020608@u-paris10.fr>
Message-ID: <BA33989B-D2FA-4C7B-827E-0793DFBC61E8@me.com>


On Nov 6, 2012, at 10:55 AM, Christophe Genolini <cgenolin at u-paris10.fr> wrote:

> Thanks a lot for your answer.
> 
>> (it is really "Suggests" and "Enhances" - the above are typos I presume and thus won't be recognized)
> Yes, it was typo. Sorry
>> No, you only need foo1 and foo2. The other two are optional.
> I get:
> 
> * checking package dependencies ... ERROR
> Package suggested but not available: 'foo3'


This is presumably coming from:

  R CMD check foo0

'foo3', as a 'Suggests', is not needed to install 'foo0' for an end user of your package 'foo0'. 

However, 'foo3' is required to run R CMD check on 'foo0' when you are testing your package to be sure that it passes all checks. This includes testing for the presence of the packages you indicate in the DESCRIPTION file as well as running examples in your .Rd files.

Regards,

Marc


> 
>> "Imports" means that symbols are imported form the namespace, so they are mandatory for the package to operate. "Suggests" means that symbols from the package are not required, but they are used in examples or vignettes, so the listed package(s) will be needed for a full check. They are not needed for the operation of the package, though.
> That's very clear, thanks a lot.
> So I will use
> 
> 
> - 'Depends:foo1' if there is a function in foo1 that my package use often
> - 'Imports:foo2' if there is a function in foo2 that my package might use rarely
> - 'Suggest:foo3' if an example .Rd in foo0 needs a function in foo3
> 
> Right?
> 
>> Cheers, Simon
>>> Christophe


From ligges at statistik.tu-dortmund.de  Tue Nov  6 18:49:00 2012
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Tue, 06 Nov 2012 18:49:00 +0100
Subject: [Rd] Depends/Imports/Suggest/Enhence
In-Reply-To: <5099411D.6020608@u-paris10.fr>
References: <5099387D.1060805@u-paris10.fr>
	<74B4544F-4D67-49AC-A293-3AAE59CFFF25@r-project.org>
	<5099411D.6020608@u-paris10.fr>
Message-ID: <50994D8C.6020903@statistik.tu-dortmund.de>



On 06.11.2012 17:55, Christophe Genolini wrote:
>   Thanks a lot for your answer.
>
>> (it is really "Suggests" and "Enhances" - the above are typos I
>> presume and thus won't be recognized)
> Yes, it was typo. Sorry
>> No, you only need foo1 and foo2. The other two are optional.
> I get:
>
> * checking package dependencies ... ERROR
> Package suggested but not available: 'foo3'
>
>> "Imports" means that symbols are imported form the namespace, so they
>> are mandatory for the package to operate. "Suggests" means that
>> symbols from the package are not required, but they are used in
>> examples or vignettes, so the listed package(s) will be needed for a
>> full check. They are not needed for the operation of the package, though.
> That's very clear, thanks a lot.
> So I will use
>
>
>   - 'Depends:foo1' if there is a function in foo1 that my package use often

No, better make use of Namespace imports all the time and only use 
"Depends" if you really need the other package to be installed. This is 
rarely needed.

Uwe Ligges





>   - 'Imports:foo2' if there is a function in foo2 that my package might
> use rarely
>   - 'Suggest:foo3' if an example .Rd in foo0 needs a function in foo3
>
> Right?
>
>> Cheers, Simon
>>> Christophe
>>>
>>> --
>>> Christophe Genolini
>>> Ma?tre de conf?rences en bio-statistique
>>> Vice pr?sident Communication interne et animation du campus
>>> Universit? Paris Ouest Nanterre La D?fense
>>>
>>>
>>>     [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>


From cgenolin at u-paris10.fr  Tue Nov  6 19:03:28 2012
From: cgenolin at u-paris10.fr (Christophe Genolini)
Date: Tue, 06 Nov 2012 19:03:28 +0100
Subject: [Rd] LazyData: no / yes
Message-ID: <509950F0.503@u-paris10.fr>

Hi the list

I have package foo0 with a big dataset 'myData'.
In DESCRIPTION, if I use 'LazyData: no', then I get:

  - when I open a R session : memory used=20 908
  - when I attach 'library(foo0)' : memory used=24364
  - then I load the set 'data(myData)' : memory used=39 668

If I use LazyData: yes', then I get
  - when I open a R session : memory used=20 908
- when I attach 'library(foo0)' : memory used=52 760.

In this second example, after 'library(foo0)', I was expecting the memory to rize up to 39 668, not 
to 52 760... Where does the difference come from?

Thanks
Christophe


-- 
Christophe Genolini
Ma?tre de conf?rences en bio-statistique
Vice pr?sident Communication interne et animation du campus
Universit? Paris Ouest Nanterre La D?fense


From asr at ufl.edu  Tue Nov  6 19:04:30 2012
From: asr at ufl.edu (Allen S. Rout)
Date: Tue, 6 Nov 2012 13:04:30 -0500
Subject: [Rd] Depends/Imports/Suggest/Enhence
In-Reply-To: <74B4544F-4D67-49AC-A293-3AAE59CFFF25@r-project.org>
References: <5099387D.1060805@u-paris10.fr>
	<74B4544F-4D67-49AC-A293-3AAE59CFFF25@r-project.org>
Message-ID: <k7bjfc$gep$1@ger.gmane.org>

On 11/06/2012 11:36 AM, Simon Urbanek wrote:
> 
> On Nov 6, 2012, at 11:19 AM, Christophe Genolini wrote:
> 
>> Hi the list
>>
>> In the DESCRIPTION file of my package foo0, I have:
>>
>> Depends: foo1
>> Imports: foo2
>> Suggest: foo3
>> Enhence: foo4

> 
> No, you only need foo1 and foo2. The other two are optional.

Unless you want to CHECK the package.   In that case, you'll need
Suggests, too.

- Allen S. Rout


From asr at ufl.edu  Tue Nov  6 19:08:55 2012
From: asr at ufl.edu (Allen S. Rout)
Date: Tue, 6 Nov 2012 13:08:55 -0500
Subject: [Rd] Depends/Imports/Suggest/Enhence
In-Reply-To: <50994D8C.6020903@statistik.tu-dortmund.de>
References: <5099387D.1060805@u-paris10.fr>
	<74B4544F-4D67-49AC-A293-3AAE59CFFF25@r-project.org>
	<5099411D.6020608@u-paris10.fr>
	<50994D8C.6020903@statistik.tu-dortmund.de>
Message-ID: <k7bjnn$k5k$1@ger.gmane.org>

On 11/06/2012 12:49 PM, Uwe Ligges wrote:
> 
>>
>>
>>   - 'Depends:foo1' if there is a function in foo1 that my package use often
> 
> No, better make use of Namespace imports all the time and only use 
> "Depends" if you really need the other package to be installed. This is 
> rarely needed.
> 

Could you discuss this further?  It seems counterintuitive to me.

I'd expect every package which my package code calls to be a dependency.



We're short of vocabulary for the true pedants here, because I could see
the vignettes being described as something "my package calls", but I
don't mean that.

- Allen S. Rout


From simon.urbanek at r-project.org  Tue Nov  6 19:49:45 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 6 Nov 2012 13:49:45 -0500
Subject: [Rd] LazyData: no / yes
In-Reply-To: <509950F0.503@u-paris10.fr>
References: <509950F0.503@u-paris10.fr>
Message-ID: <EEACC0F5-723B-40F7-958D-7080481DE84F@r-project.org>


On Nov 6, 2012, at 1:03 PM, Christophe Genolini wrote:

> Hi the list
> 
> I have package foo0 with a big dataset 'myData'.
> In DESCRIPTION, if I use 'LazyData: no', then I get:
> 
> - when I open a R session : memory used=20 908
> - when I attach 'library(foo0)' : memory used=24364
> - then I load the set 'data(myData)' : memory used=39 668
> 
> If I use LazyData: yes', then I get
> - when I open a R session : memory used=20 908
> - when I attach 'library(foo0)' : memory used=52 760.
> 
> In this second example, after 'library(foo0)', I was expecting the memory to rize up to 39 668, not to 52 760... Where does the difference come from?
> 

What do you mean by "memory used" - i.e. where do you get that from? After GC?
This certainly doesn't look like a "big dataset" by the numbers - I would classify that as tiny :)

Cheers,
Simon


> Thanks
> Christophe
> 
> 
> -- 
> Christophe Genolini
> Ma?tre de conf?rences en bio-statistique
> Vice pr?sident Communication interne et animation du campus
> Universit? Paris Ouest Nanterre La D?fense
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From cubranic at stat.ubc.ca  Tue Nov  6 20:44:08 2012
From: cubranic at stat.ubc.ca (Davor Cubranic)
Date: Tue, 6 Nov 2012 11:44:08 -0800
Subject: [Rd] Depends/Imports/Suggest/Enhence
In-Reply-To: <50994D8C.6020903@statistik.tu-dortmund.de>
References: <5099387D.1060805@u-paris10.fr>
	<74B4544F-4D67-49AC-A293-3AAE59CFFF25@r-project.org>
	<5099411D.6020608@u-paris10.fr>
	<50994D8C.6020903@statistik.tu-dortmund.de>
Message-ID: <23B7066B-96E1-4C93-91B8-FCD2BF0E769B@stat.ubc.ca>

On 2012-11-06, at 9:49 AM, Uwe Ligges wrote:

> On 06.11.2012 17:55, Christophe Genolini wrote:
>> 
>>> "Imports" means that symbols are imported form the namespace, so they
>>> are mandatory for the package to operate. "Suggests" means that
>>> symbols from the package are not required, but they are used in
>>> examples or vignettes, so the listed package(s) will be needed for a
>>> full check. They are not needed for the operation of the package, though.
>> That's very clear, thanks a lot.
>> So I will use
>> 
>> 
>>  - 'Depends:foo1' if there is a function in foo1 that my package use often
> 
> No, better make use of Namespace imports all the time and only use "Depends" if you really need the other package to be installed. This is rarely needed.

Uwe, did you mean to say "only use 'Depends' if the other package really needs to be *attached*"? Because in terms of determining dependencies for `install.package`, I thought "Imports" and "Depends" are no different. (Unless the user explicitly chooses otherwise in the 'dependencies' argument, that is.)

>> - 'Imports:foo2' if there is a function in foo2 that my package might
>> use rarely


I don't think choosing to declare "Imports" has anything to do with frequency of use. But if you do use it, then don't forget to include "imports(foo2)" or "importsFrom(foo2, ...)" in the NAMESPACE file.

Davor


From hpages at fhcrc.org  Tue Nov  6 21:17:12 2012
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 06 Nov 2012 12:17:12 -0800
Subject: [Rd] unedited copy/paste from install.packages man page to
 update.packages man page
In-Reply-To: <50931011.3050508@fhcrc.org>
References: <50931011.3050508@fhcrc.org>
Message-ID: <50997048.6040808@fhcrc.org>

Hi,

Looks like this was addressed in revision 61083, thanks!
Note that the example provided for update.packages is still the
same i.e. it shows how to use install.packages instead of
update.packages.

Cheers,
H.

On 11/01/2012 05:13 PM, Herv? Pag?s wrote:
> Hi,
>
> Found in the man page for update.packages:
>
>     repos: character vector, the base URL(s) of the repositories to use,
>            i.e., the URL of the CRAN master such as
>            ?"http://cran.r-project.org"? or its Statlib mirror,
>            ?"http://lib.stat.cmu.edu/R/CRAN"?.Can be ?NULL? to install
>            from local files (?.tar.gz? for source packages).
>
> - Using "e.g." instead of "i.e." would seem more appropriate.
>
> - But more importantly, is repos = NULL really supported for
>    update.packages? I wonder where I need to place the local files
>    for this to work. I tried to put them in the current working
>    directory but that didn't work:
>
>      > packageVersion("BSgenome")
>      [1] ?1.27.1?
>      > dir()
>      [1] "BSgenome_2.0.0.tar.gz"
>      > update.packages(repos=NULL)
>
>    This description of the 'repos' arg looks more like a copy/paste from
>    the man page for install.packages that needed some edit.
>
> - Another copy/paste is the \examples section for update.packages that
>    shows in fact an example for install.packages, which is the same
>    example that is shown in the man page for install.packages.
>
> Could those minor things be corrected?
>
> Thanks,
> H.
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From simon.urbanek at r-project.org  Tue Nov  6 21:17:41 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 6 Nov 2012 15:17:41 -0500
Subject: [Rd] Depends/Imports/Suggest/Enhence
In-Reply-To: <23B7066B-96E1-4C93-91B8-FCD2BF0E769B@stat.ubc.ca>
References: <5099387D.1060805@u-paris10.fr>
	<74B4544F-4D67-49AC-A293-3AAE59CFFF25@r-project.org>
	<5099411D.6020608@u-paris10.fr>
	<50994D8C.6020903@statistik.tu-dortmund.de>
	<23B7066B-96E1-4C93-91B8-FCD2BF0E769B@stat.ubc.ca>
Message-ID: <FF59BA39-5654-4A33-9A26-F1CE28ECDE8D@r-project.org>


On Nov 6, 2012, at 2:44 PM, Davor Cubranic wrote:

> On 2012-11-06, at 9:49 AM, Uwe Ligges wrote:
> 
>> On 06.11.2012 17:55, Christophe Genolini wrote:
>>> 
>>>> "Imports" means that symbols are imported form the namespace, so they
>>>> are mandatory for the package to operate. "Suggests" means that
>>>> symbols from the package are not required, but they are used in
>>>> examples or vignettes, so the listed package(s) will be needed for a
>>>> full check. They are not needed for the operation of the package, though.
>>> That's very clear, thanks a lot.
>>> So I will use
>>> 
>>> 
>>> - 'Depends:foo1' if there is a function in foo1 that my package use often
>> 
>> No, better make use of Namespace imports all the time and only use "Depends" if you really need the other package to be installed. This is rarely needed.
> 
> Uwe, did you mean to say "only use 'Depends' if the other package really needs to be *attached*"?

I think so.

BTW: this Depends/Imports is an interesting aspect that it may look trivial for package developers, but can be quite confusing for users. Uwe was suggesting Imports over Depends which is clean from a technical point of view (no namespace collisions etc.), but as an R user I have to say I find it bad since I used to be able to just load one package and not have to load (=attach) every package in the dependency tree that I may want to use myself by hand, but if people really decide to go that route, you'll have to do it for every single package which is a real pain. (Also it's a very bad thing for debugging - you can't even ask users to test things since the imports will be hidden). In addition, it hides declared methods which is, again, a pain when using R interactively, since you can't simply check what a certain method definition looks like - you'd have to hunt for it through namespaces (this is also related to not exporting methods). There is a difference in treating R as a scripting language versus an interactive analytics system and I find that recently focus has been shifting to the former aspect, while, personally, I think it's actually more useful as the latter. (Just my $0.02 off topic ;))

Cheers,
Simon


> Because in terms of determining dependencies for `install.package`, I thought "Imports" and "Depends" are no different. (Unless the user explicitly chooses otherwise in the 'dependencies' argument, that is.)
> 
>>> - 'Imports:foo2' if there is a function in foo2 that my package might
>>> use rarely
> 
> 
> I don't think choosing to declare "Imports" has anything to do with frequency of use. But if you do use it, then don't forget to include "imports(foo2)" or "importsFrom(foo2, ...)" in the NAMESPACE file.
> 
> Davor
> 
> 


From hpages at fhcrc.org  Tue Nov  6 21:21:11 2012
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 06 Nov 2012 12:21:11 -0800
Subject: [Rd] mysterious description of download.packages
Message-ID: <50997137.1090409@fhcrc.org>

Hi,

\description paragraph in man page for download.packages doesn't
seem to have anything to do with download.packages:

   These functions can be used to automatically compare the version
   numbers of installed packages with the newest available version on
   the repositories and update outdated packages on the fly.

But maybe I'm missing some secret capabilities of download.packages...

Thanks!
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From ligges at statistik.tu-dortmund.de  Tue Nov  6 21:43:24 2012
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Tue, 06 Nov 2012 21:43:24 +0100
Subject: [Rd] Depends/Imports/Suggest/Enhence
In-Reply-To: <FF59BA39-5654-4A33-9A26-F1CE28ECDE8D@r-project.org>
References: <5099387D.1060805@u-paris10.fr>
	<74B4544F-4D67-49AC-A293-3AAE59CFFF25@r-project.org>
	<5099411D.6020608@u-paris10.fr>
	<50994D8C.6020903@statistik.tu-dortmund.de>
	<23B7066B-96E1-4C93-91B8-FCD2BF0E769B@stat.ubc.ca>
	<FF59BA39-5654-4A33-9A26-F1CE28ECDE8D@r-project.org>
Message-ID: <5099766C.9020206@statistik.tu-dortmund.de>



On 06.11.2012 21:17, Simon Urbanek wrote:
>
> On Nov 6, 2012, at 2:44 PM, Davor Cubranic wrote:
>
>> On 2012-11-06, at 9:49 AM, Uwe Ligges wrote:
>>
>>> On 06.11.2012 17:55, Christophe Genolini wrote:
>>>>
>>>>> "Imports" means that symbols are imported form the namespace, so they
>>>>> are mandatory for the package to operate. "Suggests" means that
>>>>> symbols from the package are not required, but they are used in
>>>>> examples or vignettes, so the listed package(s) will be needed for a
>>>>> full check. They are not needed for the operation of the package, though.
>>>> That's very clear, thanks a lot.
>>>> So I will use
>>>>
>>>>
>>>> - 'Depends:foo1' if there is a function in foo1 that my package use often
>>>
>>> No, better make use of Namespace imports all the time and only use "Depends" if you really need the other package to be installed. This is rarely needed.
>>
>> Uwe, did you mean to say "only use 'Depends' if the other package really needs to be *attached*"?
>
> I think so.

Yes, sure, sorry for causing confusion.


> BTW: this Depends/Imports is an interesting aspect that it may look trivial for package developers, but can be quite confusing for users. Uwe was suggesting Imports over Depends which is clean from a technical point of view (no namespace collisions etc.), but as an R user I have to say I find it bad since I used to be able to just load one package and not have to load (=attach) every package in the dependency tree that I may want to use myself by hand, but if people really decide to go that route, you'll have to do it for every single package which is a real pain. (Also it's a very bad thing for debugging - you can't even ask users to test things since the imports will be hidden). In addition, it hides declared methods which is, again, a pain when using R interactively, since you can't simply check what a certain method definition looks like - you'd have to hunt for it through namespaces (this is also related to not exporting methods). There is a difference in treating R as
  a scri
pting language versus an interactive analytics system and I find that recently focus has been shifting to the former aspect, while, personally, I think it's actually more useful as the latter. (Just my $0.02 off topic ;))

Yes, fair enough. From my point of view that shift already started with 
formal (S4) classes/methods. I still find reading S4 code much more 
complicated than hunting through namespaces, but that point of view may 
just be biased by amount of experience in those different aspects.

Best,
Uwe





> Cheers,
> Simon
>
>
>> Because in terms of determining dependencies for `install.package`, I thought "Imports" and "Depends" are no different. (Unless the user explicitly chooses otherwise in the 'dependencies' argument, that is.)
>>
>>>> - 'Imports:foo2' if there is a function in foo2 that my package might
>>>> use rarely
>>
>>
>> I don't think choosing to declare "Imports" has anything to do with frequency of use. But if you do use it, then don't forget to include "imports(foo2)" or "importsFrom(foo2, ...)" in the NAMESPACE file.
>>
>> Davor
>>
>>
>


From hpages at fhcrc.org  Tue Nov  6 21:54:58 2012
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 06 Nov 2012 12:54:58 -0800
Subject: [Rd] \value section for write_PACKAGES not updated
Message-ID: <50997922.7060200@fhcrc.org>

Hi,

Found in \value section of man page for tools::write_PACKAGES:

   Invisibly returns the number of packages described in the resulting
   \file{PACKAGES} and \file{PACKAGES.gz} files.  If \code{0}, no
   packages were found and no files were written.

Those days (don't know when this has changed exactly), PACKAGES and
PACKAGES.gz are written, even if no packages were found (which is a
good thing BTW).

Thanks,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From simon.urbanek at r-project.org  Tue Nov  6 22:06:49 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 6 Nov 2012 16:06:49 -0500
Subject: [Rd] Depends/Imports/Suggest/Enhence
In-Reply-To: <5099766C.9020206@statistik.tu-dortmund.de>
References: <5099387D.1060805@u-paris10.fr>
	<74B4544F-4D67-49AC-A293-3AAE59CFFF25@r-project.org>
	<5099411D.6020608@u-paris10.fr>
	<50994D8C.6020903@statistik.tu-dortmund.de>
	<23B7066B-96E1-4C93-91B8-FCD2BF0E769B@stat.ubc.ca>
	<FF59BA39-5654-4A33-9A26-F1CE28ECDE8D@r-project.org>
	<5099766C.9020206@statistik.tu-dortmund.de>
Message-ID: <27B63E5B-F1FF-45EF-BA92-C14F4C64CA9A@r-project.org>


On Nov 6, 2012, at 3:43 PM, Uwe Ligges wrote:

> 
> 
> On 06.11.2012 21:17, Simon Urbanek wrote:
>> 
>> On Nov 6, 2012, at 2:44 PM, Davor Cubranic wrote:
>> 
>>> On 2012-11-06, at 9:49 AM, Uwe Ligges wrote:
>>> 
>>>> On 06.11.2012 17:55, Christophe Genolini wrote:
>>>>> 
>>>>>> "Imports" means that symbols are imported form the namespace, so they
>>>>>> are mandatory for the package to operate. "Suggests" means that
>>>>>> symbols from the package are not required, but they are used in
>>>>>> examples or vignettes, so the listed package(s) will be needed for a
>>>>>> full check. They are not needed for the operation of the package, though.
>>>>> That's very clear, thanks a lot.
>>>>> So I will use
>>>>> 
>>>>> 
>>>>> - 'Depends:foo1' if there is a function in foo1 that my package use often
>>>> 
>>>> No, better make use of Namespace imports all the time and only use "Depends" if you really need the other package to be installed. This is rarely needed.
>>> 
>>> Uwe, did you mean to say "only use 'Depends' if the other package really needs to be *attached*"?
>> 
>> I think so.
> 
> Yes, sure, sorry for causing confusion.
> 
> 
>> BTW: this Depends/Imports is an interesting aspect that it may look trivial for package developers, but can be quite confusing for users. Uwe was suggesting Imports over Depends which is clean from a technical point of view (no namespace collisions etc.), but as an R user I have to say I find it bad since I used to be able to just load one package and not have to load (=attach) every package in the dependency tree that I may want to use myself by hand, but if people really decide to go that route, you'll have to do it for every single package which is a real pain. (Also it's a very bad thing for debugging - you can't even ask users to test things since the imports will be hidden). In addition, it hides declared methods which is, again, a pain when using R interactively, since you can't simply check what a certain method definition looks like - you'd have to hunt for it through namespaces (this is also related to not exporting methods). There is a difference in treating R as
> a scri
> pting language versus an interactive analytics system and I find that recently focus has been shifting to the former aspect, while, personally, I think it's actually more useful as the latter. (Just my $0.02 off topic ;))
> 
> Yes, fair enough. From my point of view that shift already started with formal (S4) classes/methods. I still find reading S4 code much more complicated than hunting through namespaces, but that point of view may just be biased by amount of experience in those different aspects.
> 

Yes, no argument there, I won't even start about that aspect of S4 ;)

Cheers,
Simon


> 
> 
>> Cheers,
>> Simon
>> 
>> 
>>> Because in terms of determining dependencies for `install.package`, I thought "Imports" and "Depends" are no different. (Unless the user explicitly chooses otherwise in the 'dependencies' argument, that is.)
>>> 
>>>>> - 'Imports:foo2' if there is a function in foo2 that my package might
>>>>> use rarely
>>> 
>>> 
>>> I don't think choosing to declare "Imports" has anything to do with frequency of use. But if you do use it, then don't forget to include "imports(foo2)" or "importsFrom(foo2, ...)" in the NAMESPACE file.
>>> 
>>> Davor
>>> 
>>> 
>> 
> 
> 


From cgenolin at u-paris10.fr  Tue Nov  6 23:13:43 2012
From: cgenolin at u-paris10.fr (Christophe Genolini)
Date: Tue, 06 Nov 2012 23:13:43 +0100
Subject: [Rd] LazyData: no / yes
In-Reply-To: <EEACC0F5-723B-40F7-958D-7080481DE84F@r-project.org>
References: <509950F0.503@u-paris10.fr>
	<EEACC0F5-723B-40F7-958D-7080481DE84F@r-project.org>
Message-ID: <50998B97.2040401@u-paris10.fr>

I get it from windows tack manager (under Window 7). I guess it is in K something.
My point was not about "how big is my dataset" (anyway, it is a fake dataset, so it can be as big as 
I want) but more about "where on hell are lost the 52 760 - 39 668 K ?"
:-)
Christophe

>   
> On Nov 6, 2012, at 1:03 PM, Christophe Genolini wrote:
>
>> Hi the list
>>
>> I have package foo0 with a big dataset 'myData'.
>> In DESCRIPTION, if I use 'LazyData: no', then I get:
>>
>> - when I open a R session : memory used=20 908
>> - when I attach 'library(foo0)' : memory used=24364
>> - then I load the set 'data(myData)' : memory used=39 668
>>
>> If I use LazyData: yes', then I get
>> - when I open a R session : memory used=20 908
>> - when I attach 'library(foo0)' : memory used=52 760.
>>
>> In this second example, after 'library(foo0)', I was expecting the memory to rize up to 39 668, not to 52 760... Where does the difference come from?
>>
> What do you mean by "memory used" - i.e. where do you get that from? After GC?
> This certainly doesn't look like a "big dataset" by the numbers - I would classify that as tiny :)
>
> Cheers,
> Simon
>
>
>> Thanks
>> Christophe
>>
>>
>> -- 
>> Christophe Genolini
>> Ma?tre de conf?rences en bio-statistique
>> Vice pr?sident Communication interne et animation du campus
>> Universit? Paris Ouest Nanterre La D?fense
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>


-- 
Christophe Genolini
Ma?tre de conf?rences en bio-statistique
Vice pr?sident Communication interne et animation du campus
Universit? Paris Ouest Nanterre La D?fense


From simon.urbanek at r-project.org  Tue Nov  6 23:24:55 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 6 Nov 2012 17:24:55 -0500
Subject: [Rd] LazyData: no / yes
In-Reply-To: <50998B97.2040401@u-paris10.fr>
References: <509950F0.503@u-paris10.fr>
	<EEACC0F5-723B-40F7-958D-7080481DE84F@r-project.org>
	<50998B97.2040401@u-paris10.fr>
Message-ID: <FEBB4EC2-F0C8-4C9E-B5F0-FD153E55DB25@r-project.org>


On Nov 6, 2012, at 5:13 PM, Christophe Genolini wrote:

> I get it from windows tack manager (under Window 7). I guess it is in K something.
> My point was not about "how big is my dataset" (anyway, it is a fake dataset, so it can be as big as I want) but more about "where on hell are lost the 52 760 - 39 668 K ?"
> :-)

Ask your system ;) - you're comparing wrong things: a) you didn't run garbage collection so there will be temporary objects around and b) see FAQ 7.42 why what you're looking at has no real meaning.

Cheers,
Simon



> Christophe
> 
>>  On Nov 6, 2012, at 1:03 PM, Christophe Genolini wrote:
>> 
>>> Hi the list
>>> 
>>> I have package foo0 with a big dataset 'myData'.
>>> In DESCRIPTION, if I use 'LazyData: no', then I get:
>>> 
>>> - when I open a R session : memory used=20 908
>>> - when I attach 'library(foo0)' : memory used=24364
>>> - then I load the set 'data(myData)' : memory used=39 668
>>> 
>>> If I use LazyData: yes', then I get
>>> - when I open a R session : memory used=20 908
>>> - when I attach 'library(foo0)' : memory used=52 760.
>>> 
>>> In this second example, after 'library(foo0)', I was expecting the memory to rize up to 39 668, not to 52 760... Where does the difference come from?
>>> 
>> What do you mean by "memory used" - i.e. where do you get that from? After GC?
>> This certainly doesn't look like a "big dataset" by the numbers - I would classify that as tiny :)
>> 
>> Cheers,
>> Simon
>> 
>> 
>>> Thanks
>>> Christophe
>>> 
>>> 
>>> -- 
>>> Christophe Genolini
>>> Ma?tre de conf?rences en bio-statistique
>>> Vice pr?sident Communication interne et animation du campus
>>> Universit? Paris Ouest Nanterre La D?fense
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>>> 
>> 
> 
> 
> -- 
> Christophe Genolini
> Ma?tre de conf?rences en bio-statistique
> Vice pr?sident Communication interne et animation du campus
> Universit? Paris Ouest Nanterre La D?fense
> 
> 


From cgenolin at u-paris10.fr  Tue Nov  6 23:42:00 2012
From: cgenolin at u-paris10.fr (Christophe Genolini)
Date: Tue, 06 Nov 2012 23:42:00 +0100
Subject: [Rd] LazyData: no / yes
In-Reply-To: <FEBB4EC2-F0C8-4C9E-B5F0-FD153E55DB25@r-project.org>
References: <509950F0.503@u-paris10.fr>
	<EEACC0F5-723B-40F7-958D-7080481DE84F@r-project.org>
	<50998B97.2040401@u-paris10.fr>
	<FEBB4EC2-F0C8-4C9E-B5F0-FD153E55DB25@r-project.org>
Message-ID: <50999238.2000505@u-paris10.fr>

My real point was to explore the LazyData mechanism. So I try with LazyData: no and with LazyData: 
yes to see the difference, to see if I understand correctly the "WRE". The difference of the memory 
allocation pointed by the task manager alarm me, but you are right (I read the FAQ 7.42): my 
question has no real meaning.
Thanks for pointing me the 7.42.

Christophe
> On Nov 6, 2012, at 5:13 PM, Christophe Genolini wrote:
>
>> I get it from windows tack manager (under Window 7). I guess it is in K something.
>> My point was not about "how big is my dataset" (anyway, it is a fake dataset, so it can be as big as I want) but more about "where on hell are lost the 52 760 - 39 668 K ?"
>> :-)
> Ask your system ;) - you're comparing wrong things: a) you didn't run garbage collection so there will be temporary objects around and b) see FAQ 7.42 why what you're looking at has no real meaning.
>
> Cheers,
> Simon
>
>
>
>> Christophe
>>
>>>   On Nov 6, 2012, at 1:03 PM, Christophe Genolini wrote:
>>>
>>>> Hi the list
>>>>
>>>> I have package foo0 with a big dataset 'myData'.
>>>> In DESCRIPTION, if I use 'LazyData: no', then I get:
>>>>
>>>> - when I open a R session : memory used=20 908
>>>> - when I attach 'library(foo0)' : memory used=24364
>>>> - then I load the set 'data(myData)' : memory used=39 668
>>>>
>>>> If I use LazyData: yes', then I get
>>>> - when I open a R session : memory used=20 908
>>>> - when I attach 'library(foo0)' : memory used=52 760.
>>>>
>>>> In this second example, after 'library(foo0)', I was expecting the memory to rize up to 39 668, not to 52 760... Where does the difference come from?
>>>>
>>> What do you mean by "memory used" - i.e. where do you get that from? After GC?
>>> This certainly doesn't look like a "big dataset" by the numbers - I would classify that as tiny :)
>>>
>>> Cheers,
>>> Simon
>>>
>>>
>>>> Thanks
>>>> Christophe
>>>>
>>>>
>>>> -- 
>>>> Christophe Genolini
>>>> Ma?tre de conf?rences en bio-statistique
>>>> Vice pr?sident Communication interne et animation du campus
>>>> Universit? Paris Ouest Nanterre La D?fense
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>
>>
>> -- 
>> Christophe Genolini
>> Ma?tre de conf?rences en bio-statistique
>> Vice pr?sident Communication interne et animation du campus
>> Universit? Paris Ouest Nanterre La D?fense
>>
>>
>


-- 
Christophe Genolini
Ma?tre de conf?rences en bio-statistique
Vice pr?sident Communication interne et animation du campus
Universit? Paris Ouest Nanterre La D?fense


From sleepingwell at gmail.com  Wed Nov  7 02:25:44 2012
From: sleepingwell at gmail.com (Simon Knapp)
Date: Wed, 7 Nov 2012 12:25:44 +1100
Subject: [Rd] Strange behaviour in as.Date
Message-ID: <CAA+5f=1OucQt+btpTjssDLJg-jRaK6P73r_3Dw8K-9Q4o49chA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121107/15847482/attachment.pl>

From mauricio.zambrano at jrc.ec.europa.eu  Wed Nov  7 10:04:11 2012
From: mauricio.zambrano at jrc.ec.europa.eu (Mauricio Zambrano-Bigiarini)
Date: Wed, 07 Nov 2012 10:04:11 +0100
Subject: [Rd] Correct use of Depends, Imports and ::
Message-ID: <509A240B.3050308@jrc.ec.europa.eu>

Dear R developers,

Taking advantage of the yesterday discussion about the use of 
Depends/Import/Suggests/Enhances, I would like to add a related question.

Let's assume, in the DESCRIPTION file of my package foo0, I have:

Depends: foo1
Imports: foo2

while in the NAMESPACE file of my package I have

importFrom("foo2", f2)


and within my package I use the following two external functions:

f1, from package foo1
f2, from package foo2


If I want to use the two previous functions within a function of my 
package foo0, is it correct to call them as follow ( assuming 'x' is the 
only argument of 'f1' and 'f2'):

f1(x)
foo2::f2(x)

OR should I use

foo1::f1(x)
f2(x)

OR

f1(x)
f2(x)

OR

something else (the correct way of doing it in R) ?



Finally, can I use the following call in the body of a function of my 
package foo0:

foo3::f3(x)

without declaring the package 'foo3' in the Imports section of my 
DESCRIPTION file ?


Thanks in advance for your help,


Mauricio Zambrano-Bigiarini

-- 
=================================================
Water Resources Unit
Institute for Environment and Sustainability (IES)
Joint Research Centre (JRC), European Commission
TP 261, Via Enrico Fermi 2749, 21027 Ispra (VA), IT
webinfo    : http://floods.jrc.ec.europa.eu/
=================================================
DISCLAIMER:\ "The views expressed are purely those of th...{{dropped:11}}


From cgenolin at u-paris10.fr  Wed Nov  7 10:26:26 2012
From: cgenolin at u-paris10.fr (Christophe Genolini)
Date: Wed, 07 Nov 2012 10:26:26 +0100
Subject: [Rd] Comments in the DESCRIPTION file
Message-ID: <509A2942.3050004@u-paris10.fr>

Hi all,

Is it possible to add comments in the DESCRIPTION file?

Sincerely
Christophe

-- 
Christophe Genolini
Ma?tre de conf?rences en bio-statistique
Vice pr?sident Communication interne et animation du campus
Universit? Paris Ouest Nanterre La D?fense


From murdoch.duncan at gmail.com  Wed Nov  7 10:53:46 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 07 Nov 2012 04:53:46 -0500
Subject: [Rd] Comments in the DESCRIPTION file
In-Reply-To: <509A2942.3050004@u-paris10.fr>
References: <509A2942.3050004@u-paris10.fr>
Message-ID: <509A2FAA.1030404@gmail.com>

On 12-11-07 4:26 AM, Christophe Genolini wrote:
> Hi all,
>
> Is it possible to add comments in the DESCRIPTION file?


The read.dcf function is used to read the DESCRIPTION file, and it 
doesn't support comments.  (The current Debian control format 
description does appear to support comments with leading # markers, but 
R's read.dcf function doesn't support these.)

You could probably get away with something like

#: this is a comment

since unrecognized fields are ignored, but I think this fact is 
undocumented so I would say it's safer to assume that comments are not 
supported.

Duncan Murdoch


From ripley at stats.ox.ac.uk  Wed Nov  7 11:01:25 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 07 Nov 2012 10:01:25 +0000
Subject: [Rd] Comments in the DESCRIPTION file
In-Reply-To: <509A2FAA.1030404@gmail.com>
References: <509A2942.3050004@u-paris10.fr> <509A2FAA.1030404@gmail.com>
Message-ID: <509A3175.7010100@stats>

On 07/11/12 09:53, Duncan Murdoch wrote:
> On 12-11-07 4:26 AM, Christophe Genolini wrote:
>> Hi all,
>>
>> Is it possible to add comments in the DESCRIPTION file?
>
>
> The read.dcf function is used to read the DESCRIPTION file, and it
> doesn't support comments.  (The current Debian control format
> description does appear to support comments with leading # markers, but
> R's read.dcf function doesn't support these.)
>
> You could probably get away with something like
>
> #: this is a comment
>
> since unrecognized fields are ignored, but I think this fact is
> undocumented so I would say it's safer to assume that comments are not
> supported.

In that form, but lots of people have fields like

Note: this is a comment

and CRAN uses

X-CRAN-Comment:

You can also add comments in Authors at R fields.

>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From simon.urbanek at r-project.org  Wed Nov  7 15:25:35 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 7 Nov 2012 09:25:35 -0500
Subject: [Rd] Correct use of Depends, Imports and ::
In-Reply-To: <509A240B.3050308@jrc.ec.europa.eu>
References: <509A240B.3050308@jrc.ec.europa.eu>
Message-ID: <7FF8666C-81E1-46FB-8B87-583726314989@r-project.org>

On Nov 7, 2012, at 4:04 AM, Mauricio Zambrano-Bigiarini wrote:

> Dear R developers,
> 
> Taking advantage of the yesterday discussion about the use of Depends/Import/Suggests/Enhances, I would like to add a related question.
> 
> Let's assume, in the DESCRIPTION file of my package foo0, I have:
> 
> Depends: foo1
> Imports: foo2
> 
> while in the NAMESPACE file of my package I have
> 
> importFrom("foo2", f2)
> 
> 
> and within my package I use the following two external functions:
> 
> f1, from package foo1
> f2, from package foo2
> 
> 
> If I want to use the two previous functions within a function of my package foo0, is it correct to call them as follow ( assuming 'x' is the only argument of 'f1' and 'f2'):
> 
> f1(x)
> foo2::f2(x)
> 
> OR should I use
> 
> foo1::f1(x)
> f2(x)
> 
> OR
> 
> f1(x)
> f2(x)
> 

Yes, this one. You have imported f2 so the whole point of that is that it will be inserted as "f2" into your imports environment, so you want to use it that way. When you use foo2:: you are skipping over imports and addressing the namespace of foo2 directly which sort of defeats the purpose (and is slower).

As for f1, you have attached the package so it is available. I would not use foo1:: for the same reason as above, but there is a risk that it may get clobbered since the call will go through the search path so you may not get f1 from foo1 necessarily - this may or may not be a good thing depending on your intentions. You could import it via import(foo1) to make sure you don't need to go through the search path - that's what I would do if I don't intend overrides. (Whether you want to use Depends or Imports in that case is related to what you intend for the user to see as I was saying in my last comment - if I expect users to use foo1 as well, I would use Depends, otherwise Imports is good enough.)


> OR
> 
> something else (the correct way of doing it in R) ?
> 
> 
> 
> Finally, can I use the following call in the body of a function of my package foo0:
> 
> foo3::f3(x)
> 
> without declaring the package 'foo3' in the Imports section of my DESCRIPTION file ?
> 

No, it has to be at least in Enhances or Suggests (see R-exts 1.1.1).

Cheers,
Simon


> 
> Thanks in advance for your help,
> 
> 
> Mauricio Zambrano-Bigiarini
> 
> -- 
> =================================================
> Water Resources Unit
> Institute for Environment and Sustainability (IES)
> Joint Research Centre (JRC), European Commission
> TP 261, Via Enrico Fermi 2749, 21027 Ispra (VA), IT
> webinfo    : http://floods.jrc.ec.europa.eu/
> =================================================
> DISCLAIMER:\ "The views expressed are purely those of th...{{dropped:11}}
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From simon.urbanek at r-project.org  Wed Nov  7 15:39:29 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 7 Nov 2012 09:39:29 -0500
Subject: [Rd] Correct use of Depends, Imports and ::
In-Reply-To: <7FF8666C-81E1-46FB-8B87-583726314989@r-project.org>
References: <509A240B.3050308@jrc.ec.europa.eu>
	<7FF8666C-81E1-46FB-8B87-583726314989@r-project.org>
Message-ID: <D1BE25EA-2FE3-4744-A10F-3B831258AF89@r-project.org>


On Nov 7, 2012, at 9:25 AM, Simon Urbanek wrote:

> On Nov 7, 2012, at 4:04 AM, Mauricio Zambrano-Bigiarini wrote:
> 
>> Dear R developers,
>> 
>> Taking advantage of the yesterday discussion about the use of Depends/Import/Suggests/Enhances, I would like to add a related question.
>> 
>> Let's assume, in the DESCRIPTION file of my package foo0, I have:
>> 
>> Depends: foo1
>> Imports: foo2
>> 
>> while in the NAMESPACE file of my package I have
>> 
>> importFrom("foo2", f2)
>> 
>> 
>> and within my package I use the following two external functions:
>> 
>> f1, from package foo1
>> f2, from package foo2
>> 
>> 
>> If I want to use the two previous functions within a function of my package foo0, is it correct to call them as follow ( assuming 'x' is the only argument of 'f1' and 'f2'):
>> 
>> f1(x)
>> foo2::f2(x)
>> 
>> OR should I use
>> 
>> foo1::f1(x)
>> f2(x)
>> 
>> OR
>> 
>> f1(x)
>> f2(x)
>> 
> 
> Yes, this one. You have imported f2 so the whole point of that is that it will be inserted as "f2" into your imports environment, so you want to use it that way. When you use foo2:: you are skipping over imports and addressing the namespace of foo2 directly which sort of defeats the purpose (and is slower).
> 
> As for f1, you have attached the package so it is available. I would not use foo1:: for the same reason as above, but there is a risk that it may get clobbered since the call will go through the search path so you may not get f1 from foo1 necessarily - this may or may not be a good thing depending on your intentions. You could import it via import(foo1) to make sure you don't need to go through the search path - that's what I would do if I don't intend overrides. (Whether you want to use Depends or Imports in that case is related to what you intend for the user to see as I was saying in my last comment - if I expect users to use foo1 as well, I would use Depends, otherwise Imports is good enough.)
> 
> 
>> OR
>> 
>> something else (the correct way of doing it in R) ?
>> 
>> 
>> 
>> Finally, can I use the following call in the body of a function of my package foo0:
>> 
>> foo3::f3(x)
>> 
>> without declaring the package 'foo3' in the Imports section of my DESCRIPTION file ?
>> 
> 
> No, it has to be at least in Enhances or Suggests (see R-exts 1.1.1).
> 

This should have been "Yes, but it has ..."


> Cheers,
> Simon
> 
> 
>> 
>> Thanks in advance for your help,
>> 
>> 
>> Mauricio Zambrano-Bigiarini
>> 
>> -- 
>> =================================================
>> Water Resources Unit
>> Institute for Environment and Sustainability (IES)
>> Joint Research Centre (JRC), European Commission
>> TP 261, Via Enrico Fermi 2749, 21027 Ispra (VA), IT
>> webinfo    : http://floods.jrc.ec.europa.eu/
>> =================================================
>> DISCLAIMER:\ "The views expressed are purely those of th...{{dropped:11}}
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From suharto_anggono at yahoo.com  Wed Nov  7 17:24:44 2012
From: suharto_anggono at yahoo.com (Suharto Anggono Suharto Anggono)
Date: Wed, 7 Nov 2012 08:24:44 -0800 (PST)
Subject: [Rd] Another code to drop factor levels
Message-ID: <1352305484.78549.BPMail_low_carrier@web125102.mail.ne1.yahoo.com>


This is a variant that does not use 'tabulate'. As before, there is no restriction for anyone to use this code.

droplevels2i <- function(x)
{
if (is.null(levels(x)))
 stop("no 'levels' attribute")
nlev <- length(levels(x))
y <- unclass(x)
used <- logical(nlev)
used[] <- FALSE
used[y] <- TRUE
tb <- used
tb[used] <-
 seq(length=sum(used))
y[] <- tb[y]
levels(y) <- levels(x)[used]
attr(y, "class") <-
 attr(x, "class")
y
}
------------------------------
 Pada Sen, 5 Nov 2012 23:49 ICT Suharto Anggono Suharto Anggono menulis:

 >
 >I apologize if this is not appropriate for this mailing list.
 >
 >In R, there is already functionality to drop unused factor levels. However, I am proposing the code below that I wrote. In some occasions, it was faster than applying function 'factor'. In any case, there is no restriction for anyone to use the code below.
 >
 >droplevels2 <- function(x) {
 >if (is.null(levels(x)))
 > stop("no 'levels' attribute")
 >nlev <- length(levels(x))
 >y <- unclass(x)
 >tb <- tabulate(y, nlev)
 >used <- as.logical(tb)
 >tb[used] <-
 > seq(length=sum(used))
 >y[] <- tb[y]
 >levels(y) <- levels(x)[used]
 >attr(y, "class") <-
 > attr(x, "class")
 >y
 >}
 >
 >Alternatively, one may use 'levels<-.factor' by assigning NA to unused levels, like below.
 >
 >levels(x)[ tabulate(
 >unclass(x),
 >length(levels(x))) == 0 ] <-
 >NA


From mauricio.zambrano at jrc.ec.europa.eu  Wed Nov  7 18:52:02 2012
From: mauricio.zambrano at jrc.ec.europa.eu (mauricio zambrano)
Date: Wed, 07 Nov 2012 18:52:02 +0100
Subject: [Rd] Correct use of Depends, Imports and ::
In-Reply-To: <D1BE25EA-2FE3-4744-A10F-3B831258AF89@r-project.org>
References: <509A240B.3050308@jrc.ec.europa.eu>
	<7FF8666C-81E1-46FB-8B87-583726314989@r-project.org>
	<D1BE25EA-2FE3-4744-A10F-3B831258AF89@r-project.org>
Message-ID: <73d0dce76a2f.509aadd2@jrc.ec.europa.eu>



On 11/07/12, Simon Urbanek  <simon.urbanek at r-project.org> wrote:

> On Nov 7, 2012, at 9:25 AM, Simon Urbanek wrote:
> 
> > On Nov 7, 2012, at 4:04 AM, Mauricio Zambrano-Bigiarini wrote:
> > 
> >> Dear R developers,
> >> 
> >> Taking advantage of the yesterday discussion about the use of Depends/Import/Suggests/Enhances, I would like to add a related question.
> >> 
> >> Let's assume, in the DESCRIPTION file of my package foo0, I have:
> >> 
> >> Depends: foo1
> >> Imports: foo2
> >> 
> >> while in the NAMESPACE file of my package I have
> >> 
> >> importFrom("foo2", f2)
> >> 
> >> 
> >> and within my package I use the following two external functions:
> >> 
> >> f1, from package foo1
> >> f2, from package foo2
> >> 
> >> 
> >> If I want to use the two previous functions within a function of my package foo0, is it correct to call them as follow ( assuming 'x' is the only argument of 'f1' and 'f2'):
> >> 
> >> f1(x)
> >> foo2::f2(x)
> >> 
> >> OR should I use
> >> 
> >> foo1::f1(x)
> >> f2(x)
> >> 
> >> OR
> >> 
> >> f1(x)
> >> f2(x)
> >> 
> > 
> > Yes, this one. You have imported f2 so the whole point of that is that it will be inserted as "f2" into your imports environment, so you want to use it that way. When you use foo2:: you are skipping over imports and addressing the namespace of foo2 directly which sort of defeats the purpose (and is slower).

Thanks Simon for making the point related to f2 clearer for me.

> > 
> > As for f1, you have attached the package so it is available. I would not use foo1:: for the same reason as above, but there is a risk that it may get clobbered since the call will go through the search path so you may not get f1 from foo1 necessarily - this may or may not be a good thing depending on your intentions. You could import it via import(foo1) to make sure you don't need to go through the search path - that's what I would do if I don't intend overrides. (Whether you want to use Depends or Imports in that case is related to what you intend for the user to see as I was saying in my last comment - if I expect users to use foo1 as well, I would use Depends, otherwise Imports is good enough.)

So, if I'm only using a few functions of foo1, I shouldn't declare them in Depends, but only in Imports, which also will allow me to be sure that the functions come from foo1 and not from another package that have functions with the same, right ?

> > 
> > 
> >> OR
> >> 
> >> something else (the correct way of doing it in R) ?
> >> 
> >> 
> >> 
> >> Finally, can I use the following call in the body of a function of my package foo0:
> >> 
> >> foo3::f3(x)
> >> 
> >> without declaring the package 'foo3' in the Imports section of my DESCRIPTION file ?
> >> 
> > 
> > No, it has to be at least in Enhances or Suggests (see R-exts 1.1.1).
> > 
> 
> This should have been "Yes, but it has ..."

Thanks again,

Mauricio

=====================================
Linux user #454569 -- Ubuntu user #17469
=====================================
"If you torture any data set long enough, 
it will confess anything!" (Murray Lark)


From ripley at stats.ox.ac.uk  Wed Nov  7 21:00:03 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 07 Nov 2012 20:00:03 +0000
Subject: [Rd] Correct use of Depends, Imports and ::
In-Reply-To: <73d0dce76a2f.509aadd2@jrc.ec.europa.eu>
References: <509A240B.3050308@jrc.ec.europa.eu>
	<7FF8666C-81E1-46FB-8B87-583726314989@r-project.org>
	<D1BE25EA-2FE3-4744-A10F-3B831258AF89@r-project.org>
	<73d0dce76a2f.509aadd2@jrc.ec.europa.eu>
Message-ID: <509ABDC3.9030801@stats.ox.ac.uk>

On 07/11/2012 17:52, mauricio zambrano wrote:
>
>
> On 11/07/12, Simon Urbanek  <simon.urbanek at r-project.org> wrote:
>
>> On Nov 7, 2012, at 9:25 AM, Simon Urbanek wrote:
>>
>>> On Nov 7, 2012, at 4:04 AM, Mauricio Zambrano-Bigiarini wrote:
>>>
>>>> Dear R developers,
>>>>
>>>> Taking advantage of the yesterday discussion about the use of
>>>> Depends/Import/Suggests/Enhances, I would like to add a related
>>>> question.
>>>>
>>>> Let's assume, in the DESCRIPTION file of my package foo0, I
>>>> have:
>>>>
>>>> Depends: foo1 Imports: foo2
>>>>
>>>> while in the NAMESPACE file of my package I have
>>>>
>>>> importFrom("foo2", f2)
>>>>
>>>>
>>>> and within my package I use the following two external
>>>> functions:
>>>>
>>>> f1, from package foo1 f2, from package foo2
>>>>
>>>>
>>>> If I want to use the two previous functions within a function
>>>> of my package foo0, is it correct to call them as follow (
>>>> assuming 'x' is the only argument of 'f1' and 'f2'):
>>>>
>>>> f1(x) foo2::f2(x)
>>>>
>>>> OR should I use
>>>>
>>>> foo1::f1(x) f2(x)
>>>>
>>>> OR
>>>>
>>>> f1(x) f2(x)
>>>>
>>>
>>> Yes, this one. You have imported f2 so the whole point of that is
>>> that it will be inserted as "f2" into your imports environment,
>>> so you want to use it that way. When you use foo2:: you are
>>> skipping over imports and addressing the namespace of foo2
>>> directly which sort of defeats the purpose (and is slower).
>
> Thanks Simon for making the point related to f2 clearer for me.
>
>>>
>>> As for f1, you have attached the package so it is available. I
>>> would not use foo1:: for the same reason as above, but there is a
>>> risk that it may get clobbered since the call will go through the
>>> search path so you may not get f1 from foo1 necessarily - this
>>> may or may not be a good thing depending on your intentions. You
>>> could import it via import(foo1) to make sure you don't need to
>>> go through the search path - that's what I would do if I don't
>>> intend overrides. (Whether you want to use Depends or Imports in
>>> that case is related to what you intend for the user to see as I
>>> was saying in my last comment - if I expect users to use foo1 as
>>> well, I would use Depends, otherwise Imports is good enough.)

Or declare in Depends but also import in the NAMESPACE.

> So, if I'm only using a few functions of foo1, I shouldn't declare
> them in Depends, but only in Imports, which also will allow me to be
> sure that the functions come from foo1 and not from another package
> that have functions with the same, right ?

Yes, but it would be better to use importsFrom() with just the functions 
you need (the list of exported functions from foo1 could change over time).

I've just been through this advising an author of a package who needs to 
use intersect() from rgeos, not intersect() from base.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From diy at stat.oregonstate.edu  Wed Nov  7 21:26:53 2012
From: diy at stat.oregonstate.edu (Yanming Di)
Date: Wed, 7 Nov 2012 12:26:53 -0800
Subject: [Rd] alternative to .Fortran("dqrls", ...)
In-Reply-To: <509ABDC3.9030801@stats.ox.ac.uk>
References: <509A240B.3050308@jrc.ec.europa.eu><7FF8666C-81E1-46FB-8B87-583726314989@r-project.org><D1BE25EA-2FE3-4744-A10F-3B831258AF89@r-project.org><73d0dce76a2f.509aadd2@jrc.ec.europa.eu>
	<509ABDC3.9030801@stats.ox.ac.uk>
Message-ID: <0D8B0CF6466B4BBB90D28169EF30BB69@science.oregonstate.edu>

Hi all,

In a package I maintain, I use the "dqrls" from the base package to fit 
regression models. However, I was informed that directly calling functions 
from the base package is no longer allowed:

"CRAN packages should use only the public API. Hence they should not use
entry points not declared as API in installed headers nor .Internal()
nor .Call() etc calls to base packages. Such usages can cause packages
to break at any time, even in patched versions of R."

Prof. Ripley suggested that one can replace such calls with lm.wfit, which 
will work.

However, in my package, the call will need to be implemented hundreds of 
thousands times. Using lm.wfit is much slower. I am wondering whether there 
is alternative ways that are more efficient. I can program in C if needed.

Many thanks.

Best regards,
Yanming


From ripley at stats.ox.ac.uk  Wed Nov  7 22:15:03 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 07 Nov 2012 21:15:03 +0000
Subject: [Rd] alternative to .Fortran("dqrls", ...)
In-Reply-To: <0D8B0CF6466B4BBB90D28169EF30BB69@science.oregonstate.edu>
References: <509A240B.3050308@jrc.ec.europa.eu><7FF8666C-81E1-46FB-8B87-583726314989@r-project.org><D1BE25EA-2FE3-4744-A10F-3B831258AF89@r-project.org><73d0dce76a2f.509aadd2@jrc.ec.europa.eu>
	<509ABDC3.9030801@stats.ox.ac.uk>
	<0D8B0CF6466B4BBB90D28169EF30BB69@science.oregonstate.edu>
Message-ID: <509ACF57.80801@stats.ox.ac.uk>

On 07/11/2012 20:26, Yanming Di wrote:
> Hi all,
>
> In a package I maintain, I use the "dqrls" from the base package to fit
> regression models. However, I was informed that directly calling
> functions from the base package is no longer allowed:
>
> "CRAN packages should use only the public API. Hence they should not use
> entry points not declared as API in installed headers nor .Internal()
> nor .Call() etc calls to base packages. Such usages can cause packages
> to break at any time, even in patched versions of R."

And dqrls is no longer available via .Fortran in R-devel.

> Prof. Ripley suggested that one can replace such calls with lm.wfit,
> which will work.
>
> However, in my package, the call will need to be implemented hundreds of
> thousands times. Using lm.wfit is much slower. I am wondering whether
> there is alternative ways that are more efficient. I can program in C if
> needed.

If the licence of your package allows it, you can copy the Fortran code 
into your package and write your own interface via .Fortran, .C or .Call.

The .Fortran interface is itself quite costly, especially in R < 2.15.1: 
in some cases lm.wfit is actually faster as it uses .Call.

>
> Many thanks.
>
> Best regards,
> Yanming
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sdmorris at u.washington.edu  Wed Nov  7 22:25:13 2012
From: sdmorris at u.washington.edu (Stephanie M. Gogarten)
Date: Wed, 07 Nov 2012 13:25:13 -0800
Subject: [Rd] Correct use of Depends, Imports and ::
In-Reply-To: <509ABDC3.9030801@stats.ox.ac.uk>
References: <509A240B.3050308@jrc.ec.europa.eu>
	<7FF8666C-81E1-46FB-8B87-583726314989@r-project.org>
	<D1BE25EA-2FE3-4744-A10F-3B831258AF89@r-project.org>
	<73d0dce76a2f.509aadd2@jrc.ec.europa.eu>
	<509ABDC3.9030801@stats.ox.ac.uk>
Message-ID: <509AD1B9.4010205@u.washington.edu>



On 11/7/12 12:00 PM, Prof Brian Ripley wrote:
> On 07/11/2012 17:52, mauricio zambrano wrote:
>>
>>
>> On 11/07/12, Simon Urbanek  <simon.urbanek at r-project.org> wrote:
>>
>>> On Nov 7, 2012, at 9:25 AM, Simon Urbanek wrote:
>>>
>>>> On Nov 7, 2012, at 4:04 AM, Mauricio Zambrano-Bigiarini wrote:
>>>>
>>>>> Dear R developers,
>>>>>
>>>>> Taking advantage of the yesterday discussion about the use of
>>>>> Depends/Import/Suggests/Enhances, I would like to add a related
>>>>> question.
>>>>>
>>>>> Let's assume, in the DESCRIPTION file of my package foo0, I
>>>>> have:
>>>>>
>>>>> Depends: foo1 Imports: foo2
>>>>>
>>>>> while in the NAMESPACE file of my package I have
>>>>>
>>>>> importFrom("foo2", f2)
>>>>>
>>>>>
>>>>> and within my package I use the following two external
>>>>> functions:
>>>>>
>>>>> f1, from package foo1 f2, from package foo2
>>>>>
>>>>>
>>>>> If I want to use the two previous functions within a function
>>>>> of my package foo0, is it correct to call them as follow (
>>>>> assuming 'x' is the only argument of 'f1' and 'f2'):
>>>>>
>>>>> f1(x) foo2::f2(x)
>>>>>
>>>>> OR should I use
>>>>>
>>>>> foo1::f1(x) f2(x)
>>>>>
>>>>> OR
>>>>>
>>>>> f1(x) f2(x)
>>>>>
>>>>
>>>> Yes, this one. You have imported f2 so the whole point of that is
>>>> that it will be inserted as "f2" into your imports environment,
>>>> so you want to use it that way. When you use foo2:: you are
>>>> skipping over imports and addressing the namespace of foo2
>>>> directly which sort of defeats the purpose (and is slower).
>>
>> Thanks Simon for making the point related to f2 clearer for me.
>>
>>>>
>>>> As for f1, you have attached the package so it is available. I
>>>> would not use foo1:: for the same reason as above, but there is a
>>>> risk that it may get clobbered since the call will go through the
>>>> search path so you may not get f1 from foo1 necessarily - this
>>>> may or may not be a good thing depending on your intentions. You
>>>> could import it via import(foo1) to make sure you don't need to
>>>> go through the search path - that's what I would do if I don't
>>>> intend overrides. (Whether you want to use Depends or Imports in
>>>> that case is related to what you intend for the user to see as I
>>>> was saying in my last comment - if I expect users to use foo1 as
>>>> well, I would use Depends, otherwise Imports is good enough.)
>
> Or declare in Depends but also import in the NAMESPACE.

This is especially a good idea if there is any chance that anyone else 
will ever want to import your package.  If a package is in Depends but 
the functions you use are not explicitly imported in the NAMESPACE (with 
imports or importsFrom), it can cause problems as described in this thread:

https://stat.ethz.ch/pipermail/r-devel/2011-September/062043.html


>
>> So, if I'm only using a few functions of foo1, I shouldn't declare
>> them in Depends, but only in Imports, which also will allow me to be
>> sure that the functions come from foo1 and not from another package
>> that have functions with the same, right ?
>
> Yes, but it would be better to use importsFrom() with just the functions
> you need (the list of exported functions from foo1 could change over time).
>
> I've just been through this advising an author of a package who needs to
> use intersect() from rgeos, not intersect() from base.
>
>

Stephanie Gogarten
Research Scientist, Biostatistics
University of Washington


From hzambran.newsgroups at gmail.com  Thu Nov  8 00:10:58 2012
From: hzambran.newsgroups at gmail.com (Mauricio Zambrano-Bigiarini)
Date: Thu, 8 Nov 2012 00:10:58 +0100
Subject: [Rd] Correct use of Depends, Imports and ::
In-Reply-To: <509ABDC3.9030801@stats.ox.ac.uk>
References: <509A240B.3050308@jrc.ec.europa.eu>
	<7FF8666C-81E1-46FB-8B87-583726314989@r-project.org>
	<D1BE25EA-2FE3-4744-A10F-3B831258AF89@r-project.org>
	<73d0dce76a2f.509aadd2@jrc.ec.europa.eu>
	<509ABDC3.9030801@stats.ox.ac.uk>
Message-ID: <CAHYf9P=XJ8WT1Mfu+5NQHVQhBGKgF_NMb3dGCm=GzpzRFMEpWg@mail.gmail.com>

2012/11/7 Prof Brian Ripley <ripley at stats.ox.ac.uk>:
> On 07/11/2012 17:52, mauricio zambrano wrote:
>>
>>
>>
>> On 11/07/12, Simon Urbanek  <simon.urbanek at r-project.org> wrote:
>>
>>> On Nov 7, 2012, at 9:25 AM, Simon Urbanek wrote:
>>>
>>>> On Nov 7, 2012, at 4:04 AM, Mauricio Zambrano-Bigiarini wrote:
>>>>
>>>>> Dear R developers,
>>>>>
>>>>> Taking advantage of the yesterday discussion about the use of
>>>>> Depends/Import/Suggests/Enhances, I would like to add a related
>>>>> question.
>>>>>
>>>>> Let's assume, in the DESCRIPTION file of my package foo0, I
>>>>> have:
>>>>>
>>>>> Depends: foo1 Imports: foo2
>>>>>
>>>>> while in the NAMESPACE file of my package I have
>>>>>
>>>>> importFrom("foo2", f2)
>>>>>
>>>>>
>>>>> and within my package I use the following two external
>>>>> functions:
>>>>>
>>>>> f1, from package foo1 f2, from package foo2
>>>>>
>>>>>
>>>>> If I want to use the two previous functions within a function
>>>>> of my package foo0, is it correct to call them as follow (
>>>>> assuming 'x' is the only argument of 'f1' and 'f2'):
>>>>>
>>>>> f1(x) foo2::f2(x)
>>>>>
>>>>> OR should I use
>>>>>
>>>>> foo1::f1(x) f2(x)
>>>>>
>>>>> OR
>>>>>
>>>>> f1(x) f2(x)
>>>>>
>>>>
>>>> Yes, this one. You have imported f2 so the whole point of that is
>>>> that it will be inserted as "f2" into your imports environment,
>>>> so you want to use it that way. When you use foo2:: you are
>>>> skipping over imports and addressing the namespace of foo2
>>>> directly which sort of defeats the purpose (and is slower).
>>
>>
>> Thanks Simon for making the point related to f2 clearer for me.
>>
>>>>
>>>> As for f1, you have attached the package so it is available. I
>>>> would not use foo1:: for the same reason as above, but there is a
>>>> risk that it may get clobbered since the call will go through the
>>>> search path so you may not get f1 from foo1 necessarily - this
>>>> may or may not be a good thing depending on your intentions. You
>>>> could import it via import(foo1) to make sure you don't need to
>>>> go through the search path - that's what I would do if I don't
>>>> intend overrides. (Whether you want to use Depends or Imports in
>>>> that case is related to what you intend for the user to see as I
>>>> was saying in my last comment - if I expect users to use foo1 as
>>>> well, I would use Depends, otherwise Imports is good enough.)
>
>
> Or declare in Depends but also import in the NAMESPACE.
>
>
>> So, if I'm only using a few functions of foo1, I shouldn't declare
>> them in Depends, but only in Imports, which also will allow me to be
>> sure that the functions come from foo1 and not from another package
>> that have functions with the same, right ?
>
>
> Yes, but it would be better to use importsFrom() with just the functions you
> need (the list of exported functions from foo1 could change over time).

That is what I wanted to say (although I was not explicit):
to declare the dependency of package foo1 in the Imports section of
the DESCRIPTION file, and then import the specific functions in the
NAMESPACE file by using importFrom("foo1", f11,...,f1n)

Thank you very much for this useful advise.


Mauricio Zambrano-Bigiarini
--
=====================================
Water Resources Unit
Institute for Environment and Sustainability
Joint Research Centre, European Commission
webinfo    : http://floods.jrc.ec.europa.eu/
=====================================
DISCLAIMER:\ "The views expressed are purely those of th...{{dropped:15}}


From hzambran.newsgroups at gmail.com  Thu Nov  8 00:30:06 2012
From: hzambran.newsgroups at gmail.com (Mauricio Zambrano-Bigiarini)
Date: Thu, 8 Nov 2012 00:30:06 +0100
Subject: [Rd] Correct use of Depends, Imports and ::
In-Reply-To: <509AD1B9.4010205@u.washington.edu>
References: <509A240B.3050308@jrc.ec.europa.eu>
	<7FF8666C-81E1-46FB-8B87-583726314989@r-project.org>
	<D1BE25EA-2FE3-4744-A10F-3B831258AF89@r-project.org>
	<73d0dce76a2f.509aadd2@jrc.ec.europa.eu>
	<509ABDC3.9030801@stats.ox.ac.uk>
	<509AD1B9.4010205@u.washington.edu>
Message-ID: <CAHYf9Pn8hMrHXF7f1B8ynVjtOythnmZL_pc+Bi+iVEtG+YhfWw@mail.gmail.com>

2012/11/7 Stephanie M. Gogarten <sdmorris at u.washington.edu>:
>
>
> On 11/7/12 12:00 PM, Prof Brian Ripley wrote:
>>
>> On 07/11/2012 17:52, mauricio zambrano wrote:
>>>
>>>
>>>
>>> On 11/07/12, Simon Urbanek  <simon.urbanek at r-project.org> wrote:
>>>
>>>> On Nov 7, 2012, at 9:25 AM, Simon Urbanek wrote:
>>>>
>>>>> On Nov 7, 2012, at 4:04 AM, Mauricio Zambrano-Bigiarini wrote:
>>>>>
>>>>>> Dear R developers,
>>>>>>
>>>>>> Taking advantage of the yesterday discussion about the use of
>>>>>> Depends/Import/Suggests/Enhances, I would like to add a related
>>>>>> question.
>>>>>>
>>>>>> Let's assume, in the DESCRIPTION file of my package foo0, I
>>>>>> have:
>>>>>>
>>>>>> Depends: foo1 Imports: foo2
>>>>>>
>>>>>> while in the NAMESPACE file of my package I have
>>>>>>
>>>>>> importFrom("foo2", f2)
>>>>>>
>>>>>>
>>>>>> and within my package I use the following two external
>>>>>> functions:
>>>>>>
>>>>>> f1, from package foo1 f2, from package foo2
>>>>>>
>>>>>>
>>>>>> If I want to use the two previous functions within a function
>>>>>> of my package foo0, is it correct to call them as follow (
>>>>>> assuming 'x' is the only argument of 'f1' and 'f2'):
>>>>>>
>>>>>> f1(x) foo2::f2(x)
>>>>>>
>>>>>> OR should I use
>>>>>>
>>>>>> foo1::f1(x) f2(x)
>>>>>>
>>>>>> OR
>>>>>>
>>>>>> f1(x) f2(x)
>>>>>>
>>>>>
>>>>> Yes, this one. You have imported f2 so the whole point of that is
>>>>> that it will be inserted as "f2" into your imports environment,
>>>>> so you want to use it that way. When you use foo2:: you are
>>>>> skipping over imports and addressing the namespace of foo2
>>>>> directly which sort of defeats the purpose (and is slower).
>>>
>>>
>>> Thanks Simon for making the point related to f2 clearer for me.
>>>
>>>>>
>>>>> As for f1, you have attached the package so it is available. I
>>>>> would not use foo1:: for the same reason as above, but there is a
>>>>> risk that it may get clobbered since the call will go through the
>>>>> search path so you may not get f1 from foo1 necessarily - this
>>>>> may or may not be a good thing depending on your intentions. You
>>>>> could import it via import(foo1) to make sure you don't need to
>>>>> go through the search path - that's what I would do if I don't
>>>>> intend overrides. (Whether you want to use Depends or Imports in
>>>>> that case is related to what you intend for the user to see as I
>>>>> was saying in my last comment - if I expect users to use foo1 as
>>>>> well, I would use Depends, otherwise Imports is good enough.)
>>
>>
>> Or declare in Depends but also import in the NAMESPACE.
>
>
> This is especially a good idea if there is any chance that anyone else will
> ever want to import your package.  If a package is in Depends but the
> functions you use are not explicitly imported in the NAMESPACE (with imports
> or importsFrom), it can cause problems as described in this thread:
>
> https://stat.ethz.ch/pipermail/r-devel/2011-September/062043.html

So, no matter if the package providing the functions I'm using within
my package (e.g., foo1) are declared in the Depends or Imports section
of the DESCRIPTION file, it is always a "good practice" to specify all
the imported functions with import(foo1) or importFrom("foo1",
f11,...,f1n) in the NAMESPACE file of my package, in order to avoid
problems as the one described in the previous link.

Thanks Prof. Ripley and Stephanie for the advice,

All the best,

Mauricio
--
=====================================
Water Resources Unit
Institute for Environment and Sustainability
Joint Research Centre, European Commission
webinfo    : http://floods.jrc.ec.europa.eu/
=====================================
DISCLAIMER:\ "The views expressed are purely those of th...{{dropped:11}}


From gianluca.mastrantonio at yahoo.it  Thu Nov  8 21:19:33 2012
From: gianluca.mastrantonio at yahoo.it (niandra)
Date: Thu, 8 Nov 2012 12:19:33 -0800 (PST)
Subject: [Rd] unable to load shared object - opencv
Message-ID: <1352405973652-4648958.post@n4.nabble.com>

Hi all

i'm trying to use the opencv's function into R.

i wrote a simple script, just for try to understand how use c++ in R, it
loads an image and write it with a different name (i know it ), and then
write "Hello, World". The file is names prova2.cpp (is the first time i try
to use c++ )

#include <stdio.h>
#include <opencv/cv.h>
#include <opencv2/core/core.hpp>
#include <opencv2/highgui/highgui.hpp>
#include <opencv/highgui.h>
#include <opencv/cv.h> 
#include <R.h>
#include <Rinternals.h>

extern "C" SEXP provaR(void) {
cv::Mat gravit;
gravit=cv::imread("imm.jpg");
cv::imwrite("imm_dop.jpg",gravit);
Rprintf("Hello, World!nn");
return R_NilValue;
}

Now in the terminal  i type R CMD SHLIB  prova2.cpp to create the file
prova2.so and this happen without error.

In R i type dyn.load("prova2.so") and get this error:

Errore in dyn.load("prova2.so") : 
  unable to load shared object
'/Users/niandra/Desktop/statistico/r/builtpack/ProvaScript/prova2.so':
 
dlopen(/Users/niandra/Desktop/statistico/r/builtpack/ProvaScript/prova2.so,
6): Symbol not found: __ZN2cv11_InputArrayC1ERKNS_3MatE
  Referenced from:
/Users/niandra/Desktop/statistico/r/builtpack/ProvaScript/prova2.so
  Expected in: flat namespace
 in /Users/niandra/Desktop/statistico/r/builtpack/ProvaScript/prova2.so

I understand that the problem is because i should tell R where to find the
opencv library, but i really don't know how do it.








--
View this message in context: http://r.789695.n4.nabble.com/unable-to-load-shared-object-opencv-tp4648958.html
Sent from the R devel mailing list archive at Nabble.com.


From simon.urbanek at r-project.org  Thu Nov  8 21:26:54 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 8 Nov 2012 15:26:54 -0500
Subject: [Rd] unable to load shared object - opencv
In-Reply-To: <1352405973652-4648958.post@n4.nabble.com>
References: <1352405973652-4648958.post@n4.nabble.com>
Message-ID: <41EEA755-C100-4F04-9E02-92CF7F1294B8@r-project.org>


On Nov 8, 2012, at 3:19 PM, niandra wrote:

> Hi all
> 
> i'm trying to use the opencv's function into R.
> 
> i wrote a simple script, just for try to understand how use c++ in R, it
> loads an image and write it with a different name (i know it ), and then
> write "Hello, World". The file is names prova2.cpp (is the first time i try
> to use c++ )
> 
> #include <stdio.h>
> #include <opencv/cv.h>
> #include <opencv2/core/core.hpp>
> #include <opencv2/highgui/highgui.hpp>
> #include <opencv/highgui.h>
> #include <opencv/cv.h> 
> #include <R.h>
> #include <Rinternals.h>
> 
> extern "C" SEXP provaR(void) {
> cv::Mat gravit;
> gravit=cv::imread("imm.jpg");
> cv::imwrite("imm_dop.jpg",gravit);
> Rprintf("Hello, World!nn");
> return R_NilValue;
> }
> 
> Now in the terminal  i type R CMD SHLIB  prova2.cpp to create the file
> prova2.so and this happen without error.
> 
> In R i type dyn.load("prova2.so") and get this error:
> 
> Errore in dyn.load("prova2.so") : 
>  unable to load shared object
> '/Users/niandra/Desktop/statistico/r/builtpack/ProvaScript/prova2.so':
> 
> dlopen(/Users/niandra/Desktop/statistico/r/builtpack/ProvaScript/prova2.so,
> 6): Symbol not found: __ZN2cv11_InputArrayC1ERKNS_3MatE
>  Referenced from:
> /Users/niandra/Desktop/statistico/r/builtpack/ProvaScript/prova2.so
>  Expected in: flat namespace
> in /Users/niandra/Desktop/statistico/r/builtpack/ProvaScript/prova2.so
> 
> I understand that the problem is because i should tell R where to find the
> opencv library, but i really don't know how do it.
> 

add the necessary -l flags (see your configuration or pkgconfig) to R CMD SHLIB

Cheers,
S


> 
> 
> 
> 
> 
> 
> 
> --
> View this message in context: http://r.789695.n4.nabble.com/unable-to-load-shared-object-opencv-tp4648958.html
> Sent from the R devel mailing list archive at Nabble.com.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From gianluca.mastrantonio at yahoo.it  Thu Nov  8 21:34:14 2012
From: gianluca.mastrantonio at yahoo.it (niandra)
Date: Thu, 8 Nov 2012 12:34:14 -0800 (PST)
Subject: [Rd] unable to load shared object - opencv
In-Reply-To: <1352405973652-4648958.post@n4.nabble.com>
References: <1352405973652-4648958.post@n4.nabble.com>
Message-ID: <1352406854272-4648960.post@n4.nabble.com>

Sorry but i'm really a beginner.

If when i use opencv with Xcode i need to set the following path 
/System/Library/Frameworks
/usr/local/include
/usr/local/lib 

how can i specify this in  R CMD SHLIB?



--
View this message in context: http://r.789695.n4.nabble.com/unable-to-load-shared-object-opencv-tp4648958p4648960.html
Sent from the R devel mailing list archive at Nabble.com.


From gianluca.mastrantonio at yahoo.it  Thu Nov  8 21:53:28 2012
From: gianluca.mastrantonio at yahoo.it (niandra)
Date: Thu, 8 Nov 2012 12:53:28 -0800 (PST)
Subject: [Rd] unable to load shared object - opencv
In-Reply-To: <41EEA755-C100-4F04-9E02-92CF7F1294B8@r-project.org>
References: <1352405973652-4648958.post@n4.nabble.com>
	<41EEA755-C100-4F04-9E02-92CF7F1294B8@r-project.org>
Message-ID: <1352408008560-4648963.post@n4.nabble.com>

Edit

i try to use this comman in terminal:
R CMD SHLIB  prova2.cpp -l/usr/local/lib -l/usr/local/include
-l/System/Library/Frameworks  and gave me this error

g++ -arch x86_64 -dynamiclib -Wl,-headerpad_max_install_names -undefined
dynamic_lookup -single_module -multiply_defined suppress -L/usr/local/lib -o
prova2.so prova2.o -l/usr/local/lib -l/usr/local/include
-l/System/Library/Frameworks -F/Library/Frameworks/R.framework/.. -framework
R -Wl,-framework -Wl,CoreFoundation
ld: library not found for -l/usr/local/lib
collect2: ld returned 1 exit status
make: *** [prova2.so] Error 1

Then when i use dyn.load("prova2.so") i get 

Errore in dyn.load("prova2.so") : 
  unable to load shared object
'/Users/niandra/Desktop/statistico/r/builtpack/ProvaScript/prova2.so':
 
dlopen(/Users/niandra/Desktop/statistico/r/builtpack/ProvaScript/prova2.so,
6): image not found



--
View this message in context: http://r.789695.n4.nabble.com/unable-to-load-shared-object-opencv-tp4648958p4648963.html
Sent from the R devel mailing list archive at Nabble.com.


From edd at debian.org  Thu Nov  8 22:58:29 2012
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 8 Nov 2012 15:58:29 -0600
Subject: [Rd] unable to load shared object - opencv
In-Reply-To: <1352408008560-4648963.post@n4.nabble.com>
References: <1352405973652-4648958.post@n4.nabble.com>
	<41EEA755-C100-4F04-9E02-92CF7F1294B8@r-project.org>
	<1352408008560-4648963.post@n4.nabble.com>
Message-ID: <20636.11013.708607.145261@max.nulle.part>


On 8 November 2012 at 12:53, niandra wrote:
| Edit
| 
| i try to use this comman in terminal:
| R CMD SHLIB  prova2.cpp -l/usr/local/lib -l/usr/local/include
| -l/System/Library/Frameworks  and gave me this error

You may want to go back to some introduction to Unix and its toolchains and
revisit the differences between

    -I

    -L

    -l

They may look the same, especially with a typewriter font, but trust me that
they are not.

Dirk

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From gianluca.mastrantonio at yahoo.it  Thu Nov  8 23:08:49 2012
From: gianluca.mastrantonio at yahoo.it (gianluca mastrantonio)
Date: Thu, 8 Nov 2012 23:08:49 +0100
Subject: [Rd] unable to load shared object - opencv
In-Reply-To: <20636.11013.708607.145261@max.nulle.part>
References: <1352405973652-4648958.post@n4.nabble.com>
	<41EEA755-C100-4F04-9E02-92CF7F1294B8@r-project.org>
	<1352408008560-4648963.post@n4.nabble.com>
	<20636.11013.708607.145261@max.nulle.part>
Message-ID: <29969369-7A92-4D0D-9B6B-2FF34808588B@yahoo.it>

Yes i know, i need to study.

i'm trying to understand all this stuff, i never use c++ or Unix.
G.M.


Il giorno 08/nov/2012, alle ore 22:58, Dirk Eddelbuettel <edd at debian.org> ha scritto:

> 
> On 8 November 2012 at 12:53, niandra wrote:
> | Edit
> | 
> | i try to use this comman in terminal:
> | R CMD SHLIB  prova2.cpp -l/usr/local/lib -l/usr/local/include
> | -l/System/Library/Frameworks  and gave me this error
> 
> You may want to go back to some introduction to Unix and its toolchains and
> revisit the differences between
> 
>    -I
> 
>    -L
> 
>    -l
> 
> They may look the same, especially with a typewriter font, but trust me that
> they are not.
> 
> Dirk
> 
> -- 
> Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com  


From simon.urbanek at r-project.org  Fri Nov  9 01:09:14 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 8 Nov 2012 19:09:14 -0500
Subject: [Rd] unable to load shared object - opencv
In-Reply-To: <1352406854272-4648960.post@n4.nabble.com>
References: <1352405973652-4648958.post@n4.nabble.com>
	<1352406854272-4648960.post@n4.nabble.com>
Message-ID: <9B3071E7-EA83-430D-9505-B4385625BDA3@r-project.org>


On Nov 8, 2012, at 3:34 PM, niandra wrote:

> Sorry but i'm really a beginner.
> 
> If when i use opencv with Xcode i need to set the following path 
> /System/Library/Frameworks
> /usr/local/include
> /usr/local/lib 
> 
> how can i specify this in  R CMD SHLIB?
> 

Those are essentially default so no need to specify any of those. The real thing you need to specify are the actual libraries to link against, typically something like -lopencv_core ... If you use a framework it may be just something like -framework OpenCV - we don't know since you didn't tell us what your'e really using.


From cgenolin at u-paris10.fr  Fri Nov  9 10:02:19 2012
From: cgenolin at u-paris10.fr (Christophe Genolini)
Date: Fri, 09 Nov 2012 10:02:19 +0100
Subject: [Rd] What is the INDEX file for?
Message-ID: <509CC69B.1090908@u-paris10.fr>

Hi the list,

In WRE (or in Rdindex), we can find how the INDEX is make, how to change it, but I do not manage to 
find the purpose of this file. So what is the INDEX file for?

Thanks
Christophe

-- 
Christophe Genolini
Ma?tre de conf?rences en bio-statistique
Vice pr?sident Communication interne et animation du campus
Universit? Paris Ouest Nanterre La D?fense


From btyner at gmail.com  Fri Nov  9 04:47:29 2012
From: btyner at gmail.com (Benjamin Tyner)
Date: Thu, 08 Nov 2012 22:47:29 -0500
Subject: [Rd] built-in NAMED(obj) from within R
Message-ID: <509C7CD1.7080105@gmail.com>

Hello,

Is it possible to retrieve the 'named' field within the header (sxpinfo) 
of a object, without resorting to a debugger, external code, etc? In 
other words is there a built-in equivalent to the "getnamed" subroutine 
described here:

http://tolstoy.newcastle.edu.au/R/e2/devel/07/09/4496.html

The goal is to ascertain whether a copy of an object has been made.

Thanks,
Ben


From mdowle at mdowle.plus.com  Fri Nov  9 13:04:44 2012
From: mdowle at mdowle.plus.com (Matthew Dowle)
Date: Fri, 9 Nov 2012 12:04:44 +0000
Subject: [Rd] built-in NAMED(obj) from within R
References: <509C7CD1.7080105@gmail.com>
Message-ID: <loom.20121109T125440-643@post.gmane.org>

Benjamin Tyner <btyner <at> gmail.com> writes:

> 
> Hello,
> 
> Is it possible to retrieve the 'named' field within the header (sxpinfo) 
> of a object, without resorting to a debugger, external code, etc? 

And much more than just NAMED :

    .Internal(inspect(x))

> The goal is to ascertain whether a copy of an object has been made.

Then :

    ?tracemem

One demonstration of using both together is here :

    http://stackoverflow.com/a/10312843/403310

Matthew


From gianluca.mastrantonio at yahoo.it  Fri Nov  9 13:25:38 2012
From: gianluca.mastrantonio at yahoo.it (gianluca mastrantonio)
Date: Fri, 9 Nov 2012 13:25:38 +0100
Subject: [Rd] unable to load shared object - opencv
In-Reply-To: <9B3071E7-EA83-430D-9505-B4385625BDA3@r-project.org>
References: <1352405973652-4648958.post@n4.nabble.com>
	<1352406854272-4648960.post@n4.nabble.com>
	<9B3071E7-EA83-430D-9505-B4385625BDA3@r-project.org>
Message-ID: <EEE86E35-F10D-468A-97D7-BCD421997523@yahoo.it>

Ok, sorry.

I need the library libopencv_core.2.4.0.dylib and libopencv_highgui.2.4.0.dylib.

Thanks
G.M.



Il giorno 09/nov/2012, alle ore 01:09, Simon Urbanek <simon.urbanek at r-project.org> ha scritto:

> 
> On Nov 8, 2012, at 3:34 PM, niandra wrote:
> 
>> Sorry but i'm really a beginner.
>> 
>> If when i use opencv with Xcode i need to set the following path 
>> /System/Library/Frameworks
>> /usr/local/include
>> /usr/local/lib 
>> 
>> how can i specify this in  R CMD SHLIB?
>> 
> 
> Those are essentially default so no need to specify any of those. The real thing you need to specify are the actual libraries to link against, typically something like -lopencv_core ... If you use a framework it may be just something like -framework OpenCV - we don't know since you didn't tell us what your'e really using.
> 
> 


From h.wickham at gmail.com  Fri Nov  9 14:00:46 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Fri, 9 Nov 2012 07:00:46 -0600
Subject: [Rd] built-in NAMED(obj) from within R
In-Reply-To: <loom.20121109T125440-643@post.gmane.org>
References: <509C7CD1.7080105@gmail.com>
	<loom.20121109T125440-643@post.gmane.org>
Message-ID: <CABdHhvFMGGU_jFSeYq8i4C1vH9=poJ21PJv1eO=S0wFm76e=uQ@mail.gmail.com>

>> The goal is to ascertain whether a copy of an object has been made.
>
> Then :
>
>     ?tracemem
>
> One demonstration of using both together is here :
>
>     http://stackoverflow.com/a/10312843/403310

Note that tracemem detects duplications (in a technical R sense), not
copies - i.e.

x <- 1:10
tracemem(x)
x[11] <- 11L

although all the individual elements are copied, the vector is not
duplicated.  This confused me at first, so I thought I'd point it out.

Hadley

-- 
RStudio / Rice University
http://had.co.nz/


From gianluca.mastrantonio at yahoo.it  Fri Nov  9 23:12:19 2012
From: gianluca.mastrantonio at yahoo.it (gianluca mastrantonio)
Date: Fri, 9 Nov 2012 23:12:19 +0100
Subject: [Rd] unable to load shared object - opencv
In-Reply-To: <9B3071E7-EA83-430D-9505-B4385625BDA3@r-project.org>
References: <1352405973652-4648958.post@n4.nabble.com>
	<1352406854272-4648960.post@n4.nabble.com>
	<9B3071E7-EA83-430D-9505-B4385625BDA3@r-project.org>
Message-ID: <E9C67488-18EC-4D38-AF58-BFD762E2A18D@yahoo.it>

Thanks to all, now this problem is solved

G.M.


Il giorno 09/nov/2012, alle ore 01:09, Simon Urbanek <simon.urbanek at r-project.org> ha scritto:

> 
> On Nov 8, 2012, at 3:34 PM, niandra wrote:
> 
>> Sorry but i'm really a beginner.
>> 
>> If when i use opencv with Xcode i need to set the following path 
>> /System/Library/Frameworks
>> /usr/local/include
>> /usr/local/lib 
>> 
>> how can i specify this in  R CMD SHLIB?
>> 
> 
> Those are essentially default so no need to specify any of those. The real thing you need to specify are the actual libraries to link against, typically something like -lopencv_core ... If you use a framework it may be just something like -framework OpenCV - we don't know since you didn't tell us what your'e really using.
> 
> 


From gianluca.mastrantonio at yahoo.it  Fri Nov  9 23:31:51 2012
From: gianluca.mastrantonio at yahoo.it (niandra)
Date: Fri, 9 Nov 2012 14:31:51 -0800 (PST)
Subject: [Rd] Crash - cause 'memory not mapped'
Message-ID: <1352500311165-4649141.post@n4.nabble.com>

i'm using the following  c++ code
using namespace std;
#include <iostream>
#include <stdio.h>
#include <opencv/cv.h>
#include <opencv2/core/core.hpp>
#include <opencv2/highgui/highgui.hpp>
#include <opencv/highgui.h>
#include <opencv/cv.h> 
#include <R.h>
#include <Rinternals.h>
#include <Rmath.h>

extern "C" {
SEXP FiltroGaus(SEXP size1_r, SEXP size2_r, SEXP sigma_r) {

    int size1 = INTEGER(size1_r)[0];
    int size2 = INTEGER(size2_r)[0];
    double sigma = REAL(sigma_r)[0];
   
}
}

The compilation go without errors but when in R i type 
.C("FiltroGaus",3,3,2)
the message is:  Errore: INTEGER() can only be applied to a 'integer', not a
'NULL'
if i type .C("FiltroGaus",as.integer(3),as.integer(3),as.double(2))
the message is Errore: INTEGER() can only be applied to a 'integer', not a
'closure'

while if i type .Call("FiltroGaus",as.integer(3),as.integer(3),as.double(2))
the message is 
NULL

 *** caught segfault ***
address 0x200000be, cause 'memory not mapped'

Possible actions:
1: abort (with core dump, if enabled)
2: normal R exit
3: exit R without saving workspace
4: exit R saving workspace


I now, i need to study and i know also for sure the answer is in some book
(i have  lot). I swear i read a lot and i'm still reading, but i really need
help :)



--
View this message in context: http://r.789695.n4.nabble.com/Crash-cause-memory-not-mapped-tp4649141.html
Sent from the R devel mailing list archive at Nabble.com.


From gianluca.mastrantonio at yahoo.it  Sat Nov 10 00:05:24 2012
From: gianluca.mastrantonio at yahoo.it (gianluca mastrantonio)
Date: Sat, 10 Nov 2012 00:05:24 +0100
Subject: [Rd] Crash - cause 'memory not mapped'
In-Reply-To: <CA+hbrhX8xFdsK0D2fvOy-=+8=6-wWM4gUhqomSEKV0xkTA=Bng@mail.gmail.com>
References: <1352500311165-4649141.post@n4.nabble.com>
	<CA+hbrhX8xFdsK0D2fvOy-=+8=6-wWM4gUhqomSEKV0xkTA=Bng@mail.gmail.com>
Message-ID: <C82D3210-6C35-4F60-9B18-415838FEB365@yahoo.it>

the error "memory non mapped" happen also if i use
void FiltroGaus(SEXP size1_r, SEXP size2_r, SEXP sigma_r) 
instead
SEXP FiltroGaus(SEXP size1_r, SEXP size2_r, SEXP sigma_r) {


Il giorno 09/nov/2012, alle ore 23:58, Peter Langfelder <peter.langfelder at gmail.com> ha scritto:

> I'm not an expert, but from what I know you should certainly use the
> .Call interface when you define a function as you did. The problem is
> that your function must return a value (of type SEXP) which it does
> not. If you don't return a value, all bets are off as to what will
> happen, and if the internal R code uses a pointer to the result of
> your function, you can easily get memory map errors.
> 
> HTH,
> 
> Peter
> 
> On Fri, Nov 9, 2012 at 2:31 PM, niandra <gianluca.mastrantonio at yahoo.it> wrote:
>> i'm using the following  c++ code
>> using namespace std;
>> #include <iostream>
>> #include <stdio.h>
>> #include <opencv/cv.h>
>> #include <opencv2/core/core.hpp>
>> #include <opencv2/highgui/highgui.hpp>
>> #include <opencv/highgui.h>
>> #include <opencv/cv.h>
>> #include <R.h>
>> #include <Rinternals.h>
>> #include <Rmath.h>
>> 
>> extern "C" {
>> SEXP FiltroGaus(SEXP size1_r, SEXP size2_r, SEXP sigma_r) {
>> 
>>    int size1 = INTEGER(size1_r)[0];
>>    int size2 = INTEGER(size2_r)[0];
>>    double sigma = REAL(sigma_r)[0];
>> 
>> }
>> }
>> 
>> The compilation go without errors but when in R i type
>> .C("FiltroGaus",3,3,2)
>> the message is:  Errore: INTEGER() can only be applied to a 'integer', not a
>> 'NULL'
>> if i type .C("FiltroGaus",as.integer(3),as.integer(3),as.double(2))
>> the message is Errore: INTEGER() can only be applied to a 'integer', not a
>> 'closure'
>> 
>> while if i type .Call("FiltroGaus",as.integer(3),as.integer(3),as.double(2))
>> the message is
>> NULL
>> 
>> *** caught segfault ***
>> address 0x200000be, cause 'memory not mapped'
>> 
>> Possible actions:
>> 1: abort (with core dump, if enabled)
>> 2: normal R exit
>> 3: exit R without saving workspace
>> 4: exit R saving workspace
>> 
>> 
>> I now, i need to study and i know also for sure the answer is in some book
>> (i have  lot). I swear i read a lot and i'm still reading, but i really need
>> help :)
>> 
>> 
>> 
>> --
>> View this message in context: http://r.789695.n4.nabble.com/Crash-cause-memory-not-mapped-tp4649141.html
>> Sent from the R devel mailing list archive at Nabble.com.
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel


From edd at debian.org  Sat Nov 10 00:10:36 2012
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 9 Nov 2012 17:10:36 -0600
Subject: [Rd] Crash - cause 'memory not mapped'
In-Reply-To: <1352500311165-4649141.post@n4.nabble.com>
References: <1352500311165-4649141.post@n4.nabble.com>
Message-ID: <20637.36204.152417.614901@max.nulle.part>


On 9 November 2012 at 14:31, niandra wrote:
| extern "C" {
| SEXP FiltroGaus(SEXP size1_r, SEXP size2_r, SEXP sigma_r) {

[...]
 
| The compilation go without errors but when in R i type 
| .C("FiltroGaus",3,3,2)

You missed the part in "Writing R Extension" about .C() and .Call()
arguments.  You are mixing both approaches here, which usually ends badly.

Do some more reading, and maybe study some existing (simpler) examples /
packages.  You really do not need to engage OpenCV headers and libraries
before you understand the basics better.  

Dirk

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From btyner at gmail.com  Sat Nov 10 02:26:04 2012
From: btyner at gmail.com (Benjamin Tyner)
Date: Fri, 09 Nov 2012 20:26:04 -0500
Subject: [Rd] built-in NAMED(obj) from within R
In-Reply-To: <CABdHhvFMGGU_jFSeYq8i4C1vH9=poJ21PJv1eO=S0wFm76e=uQ@mail.gmail.com>
References: <CABdHhvFMGGU_jFSeYq8i4C1vH9=poJ21PJv1eO=S0wFm76e=uQ@mail.gmail.com>
Message-ID: <509DAD2C.5070500@gmail.com>

Thanks Matthew and Hadley; that is exactly what I was looking for, and them some.

Regards,
Ben

> >>/ The goal is to ascertain whether a copy of an object has been made.
> />/
> />/ Then :
> />/
> />/     ?tracemem
> />/
> />/ One demonstration of using both together is here :
> />/
> />/     http://stackoverflow.com/a/10312843/403310
> /
> Note that tracemem detects duplications (in a technical R sense), not
> copies - i.e.
>
> x <- 1:10
> tracemem(x)
> x[11] <- 11L
>
> although all the individual elements are copied, the vector is not
> duplicated.  This confused me at first, so I thought I'd point it out.
>
> Hadley
>
> -- 
> RStudio / Rice University
> http://had.co.nz/


From simon.urbanek at r-project.org  Sat Nov 10 02:59:46 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 9 Nov 2012 20:59:46 -0500
Subject: [Rd] built-in NAMED(obj) from within R
In-Reply-To: <CABdHhvFMGGU_jFSeYq8i4C1vH9=poJ21PJv1eO=S0wFm76e=uQ@mail.gmail.com>
References: <509C7CD1.7080105@gmail.com>
	<loom.20121109T125440-643@post.gmane.org>
	<CABdHhvFMGGU_jFSeYq8i4C1vH9=poJ21PJv1eO=S0wFm76e=uQ@mail.gmail.com>
Message-ID: <BA1B8718-4D98-4C04-8D40-E409D1A774E0@r-project.org>


On Nov 9, 2012, at 8:00 AM, Hadley Wickham wrote:

>>> The goal is to ascertain whether a copy of an object has been made.
>> 
>> Then :
>> 
>>    ?tracemem
>> 
>> One demonstration of using both together is here :
>> 
>>    http://stackoverflow.com/a/10312843/403310
> 
> Note that tracemem detects duplications (in a technical R sense), not
> copies - i.e.
> 
> x <- 1:10
> tracemem(x)
> x[11] <- 11L
> 
> although all the individual elements are copied,

No elements are copied - this is a subassignment and it is done in place hence there is neither duplication nor copying - simply the value of the 11th element is changed.


> the vector is not duplicated.  This confused me at first, so I thought I'd point it out.
> 

I'm not quite sure what is your distinction you are trying to make there...

Cheers,
Simon


> Hadley
> 
> -- 
> RStudio / Rice University
> http://had.co.nz/
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From h.wickham at gmail.com  Sat Nov 10 03:46:38 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Fri, 9 Nov 2012 20:46:38 -0600
Subject: [Rd] built-in NAMED(obj) from within R
In-Reply-To: <BA1B8718-4D98-4C04-8D40-E409D1A774E0@r-project.org>
References: <509C7CD1.7080105@gmail.com>
	<loom.20121109T125440-643@post.gmane.org>
	<CABdHhvFMGGU_jFSeYq8i4C1vH9=poJ21PJv1eO=S0wFm76e=uQ@mail.gmail.com>
	<BA1B8718-4D98-4C04-8D40-E409D1A774E0@r-project.org>
Message-ID: <CABdHhvEp_Pfn72GP5q-0RdxzW--MKL_1z-rHNCEFbvoC8ws44Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121109/a0cdf3c8/attachment.pl>

From simon.urbanek at r-project.org  Sat Nov 10 04:01:49 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 9 Nov 2012 22:01:49 -0500
Subject: [Rd] built-in NAMED(obj) from within R
In-Reply-To: <CABdHhvEp_Pfn72GP5q-0RdxzW--MKL_1z-rHNCEFbvoC8ws44Q@mail.gmail.com>
References: <509C7CD1.7080105@gmail.com>
	<loom.20121109T125440-643@post.gmane.org>
	<CABdHhvFMGGU_jFSeYq8i4C1vH9=poJ21PJv1eO=S0wFm76e=uQ@mail.gmail.com>
	<BA1B8718-4D98-4C04-8D40-E409D1A774E0@r-project.org>
	<CABdHhvEp_Pfn72GP5q-0RdxzW--MKL_1z-rHNCEFbvoC8ws44Q@mail.gmail.com>
Message-ID: <CA9FBAA4-15BF-400F-911D-5B58DB26085F@r-project.org>

On Nov 9, 2012, at 9:46 PM, Hadley Wickham wrote:

> On Friday, November 9, 2012, Simon Urbanek wrote:
> 
> On Nov 9, 2012, at 8:00 AM, Hadley Wickham wrote:
> 
> >>> The goal is to ascertain whether a copy of an object has been made.
> >>
> >> Then :
> >>
> >>    ?tracemem
> >>
> >> One demonstration of using both together is here :
> >>
> >>    http://stackoverflow.com/a/10312843/403310
> >
> > Note that tracemem detects duplications (in a technical R sense), not
> > copies - i.e.
> >
> > x <- 1:10
> > tracemem(x)
> > x[11] <- 11L
> >
> > although all the individual elements are copied,
> 
> No elements are copied - this is a subassignment and it is done in place hence there is neither duplication nor copying - simply the value of the 11th element is changed.
> 
>  But there was no 11th element - it was only 10 long. 
> 

Ah, I see what you mean - the misleading part is rather that x is now a new object that is no longer traced - this is not about duplication or copying.

Cheers,
Simon


From peter.langfelder at gmail.com  Fri Nov  9 23:58:06 2012
From: peter.langfelder at gmail.com (Peter Langfelder)
Date: Fri, 9 Nov 2012 14:58:06 -0800
Subject: [Rd] Crash - cause 'memory not mapped'
In-Reply-To: <1352500311165-4649141.post@n4.nabble.com>
References: <1352500311165-4649141.post@n4.nabble.com>
Message-ID: <CA+hbrhX8xFdsK0D2fvOy-=+8=6-wWM4gUhqomSEKV0xkTA=Bng@mail.gmail.com>

I'm not an expert, but from what I know you should certainly use the
.Call interface when you define a function as you did. The problem is
that your function must return a value (of type SEXP) which it does
not. If you don't return a value, all bets are off as to what will
happen, and if the internal R code uses a pointer to the result of
your function, you can easily get memory map errors.

HTH,

Peter

On Fri, Nov 9, 2012 at 2:31 PM, niandra <gianluca.mastrantonio at yahoo.it> wrote:
> i'm using the following  c++ code
> using namespace std;
> #include <iostream>
> #include <stdio.h>
> #include <opencv/cv.h>
> #include <opencv2/core/core.hpp>
> #include <opencv2/highgui/highgui.hpp>
> #include <opencv/highgui.h>
> #include <opencv/cv.h>
> #include <R.h>
> #include <Rinternals.h>
> #include <Rmath.h>
>
> extern "C" {
> SEXP FiltroGaus(SEXP size1_r, SEXP size2_r, SEXP sigma_r) {
>
>     int size1 = INTEGER(size1_r)[0];
>     int size2 = INTEGER(size2_r)[0];
>     double sigma = REAL(sigma_r)[0];
>
> }
> }
>
> The compilation go without errors but when in R i type
> .C("FiltroGaus",3,3,2)
> the message is:  Errore: INTEGER() can only be applied to a 'integer', not a
> 'NULL'
> if i type .C("FiltroGaus",as.integer(3),as.integer(3),as.double(2))
> the message is Errore: INTEGER() can only be applied to a 'integer', not a
> 'closure'
>
> while if i type .Call("FiltroGaus",as.integer(3),as.integer(3),as.double(2))
> the message is
> NULL
>
>  *** caught segfault ***
> address 0x200000be, cause 'memory not mapped'
>
> Possible actions:
> 1: abort (with core dump, if enabled)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
>
>
> I now, i need to study and i know also for sure the answer is in some book
> (i have  lot). I swear i read a lot and i'm still reading, but i really need
> help :)
>
>
>
> --
> View this message in context: http://r.789695.n4.nabble.com/Crash-cause-memory-not-mapped-tp4649141.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From peter.langfelder at gmail.com  Sat Nov 10 00:33:31 2012
From: peter.langfelder at gmail.com (Peter Langfelder)
Date: Fri, 9 Nov 2012 15:33:31 -0800
Subject: [Rd] Crash - cause 'memory not mapped'
In-Reply-To: <C82D3210-6C35-4F60-9B18-415838FEB365@yahoo.it>
References: <1352500311165-4649141.post@n4.nabble.com>
	<CA+hbrhX8xFdsK0D2fvOy-=+8=6-wWM4gUhqomSEKV0xkTA=Bng@mail.gmail.com>
	<C82D3210-6C35-4F60-9B18-415838FEB365@yahoo.it>
Message-ID: <CA+hbrhX8Vp9bEBFpmyc4V+WvbtbaOoq1-BSumsJsP_MUHk7kdQ@mail.gmail.com>

On Fri, Nov 9, 2012 at 3:05 PM, gianluca mastrantonio
<gianluca.mastrantonio at yahoo.it> wrote:
> the error "memory non mapped" happen also if i use
> void FiltroGaus(SEXP size1_r, SEXP size2_r, SEXP sigma_r)
> instead
> SEXP FiltroGaus(SEXP size1_r, SEXP size2_r, SEXP sigma_r) {
>

If you use a .Call on a function, the function must return a SEXP, it
cannot be have a void return value.

Peter


From tlumley at uw.edu  Mon Nov 12 03:16:31 2012
From: tlumley at uw.edu (Thomas Lumley)
Date: Mon, 12 Nov 2012 15:16:31 +1300
Subject: [Rd] Crash - cause 'memory not mapped'
In-Reply-To: <CA+hbrhX8Vp9bEBFpmyc4V+WvbtbaOoq1-BSumsJsP_MUHk7kdQ@mail.gmail.com>
References: <1352500311165-4649141.post@n4.nabble.com>
	<CA+hbrhX8xFdsK0D2fvOy-=+8=6-wWM4gUhqomSEKV0xkTA=Bng@mail.gmail.com>
	<C82D3210-6C35-4F60-9B18-415838FEB365@yahoo.it>
	<CA+hbrhX8Vp9bEBFpmyc4V+WvbtbaOoq1-BSumsJsP_MUHk7kdQ@mail.gmail.com>
Message-ID: <CAJ55+d+sj=tBE3RjpS_C85zhyQ1KxP1rB3dK1oJv+5m4E=+Row@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121112/7b1a00c0/attachment.pl>

From tlumley at uw.edu  Mon Nov 12 03:24:27 2012
From: tlumley at uw.edu (Thomas Lumley)
Date: Mon, 12 Nov 2012 15:24:27 +1300
Subject: [Rd] What is the INDEX file for?
In-Reply-To: <509CC69B.1090908@u-paris10.fr>
References: <509CC69B.1090908@u-paris10.fr>
Message-ID: <CAJ55+dK-Bzjb6Nuhzka88D3NLxMW1Z60faFfBwDHmH6Cc7_TZw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121112/22e02e9f/attachment.pl>

From talbot.denis at courrier.uqam.ca  Wed Nov 14 15:22:00 2012
From: talbot.denis at courrier.uqam.ca (Denis Talbot)
Date: Wed, 14 Nov 2012 09:22:00 -0500
Subject: [Rd] accented charatchers in a package manual
Message-ID: <CAJPXubXxm956Roscu8x9L+Emb9tiX3P5u1+G1pQFYiCVxM+7Vw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121114/9de75a9e/attachment.pl>

From murdoch.duncan at gmail.com  Wed Nov 14 16:24:18 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 14 Nov 2012 10:24:18 -0500
Subject: [Rd] accented charatchers in a package manual
In-Reply-To: <CAJPXubXxm956Roscu8x9L+Emb9tiX3P5u1+G1pQFYiCVxM+7Vw@mail.gmail.com>
References: <CAJPXubXxm956Roscu8x9L+Emb9tiX3P5u1+G1pQFYiCVxM+7Vw@mail.gmail.com>
Message-ID: <50A3B7A2.3090604@gmail.com>

On 14/11/2012 9:22 AM, Denis Talbot wrote:
> Dear list,
>
> I am writing an R package manual and there is still a warning when I run "R
> CMD check" about "NON-ASCII contents without declared encoding". I do get
> the warning comes from an accent in the name of one of the author
> (Genevi?ve), but I can't find what I am supposed to do about it. I know
> there is a section about encoding in the "Writing R extension" manual, but
> I couldn't understand what I should do from reading it.
>
> Any help is welcomed.
>

You need to declare what encoding you are using.  Put a line in your 
DESCRIPTION file like

Encoding:  utf-8

If you don't know what encoding you are using, you can probably find out 
by reading the docs for your text editor, or just guess:  If you are on 
Windows it is likely latin1, on Linux it is likely utf-8.  If you guess 
wrong you'll get errors or ugly text when R produces the manual.

Duncan Murdoch


From ripley at stats.ox.ac.uk  Wed Nov 14 18:34:38 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 14 Nov 2012 17:34:38 +0000
Subject: [Rd] accented charatchers in a package manual
In-Reply-To: <50A3B7A2.3090604@gmail.com>
References: <CAJPXubXxm956Roscu8x9L+Emb9tiX3P5u1+G1pQFYiCVxM+7Vw@mail.gmail.com>
	<50A3B7A2.3090604@gmail.com>
Message-ID: <50A3D62E.1070507@stats.ox.ac.uk>

On 14/11/2012 15:24, Duncan Murdoch wrote:
> On 14/11/2012 9:22 AM, Denis Talbot wrote:
>> Dear list,
>>
>> I am writing an R package manual and there is still a warning when I
>> run "R
>> CMD check" about "NON-ASCII contents without declared encoding". I do get
>> the warning comes from an accent in the name of one of the author
>> (Genevi?ve), but I can't find what I am supposed to do about it. I know
>> there is a section about encoding in the "Writing R extension" manual,
>> but
>> I couldn't understand what I should do from reading it.
>>
>> Any help is welcomed.
>>
>
> You need to declare what encoding you are using.  Put a line in your
> DESCRIPTION file like
>
> Encoding:  utf-8
>
> If you don't know what encoding you are using, you can probably find out
> by reading the docs for your text editor, or just guess:  If you are on
> Windows it is likely latin1, on Linux it is likely utf-8.  If you guess
> wrong you'll get errors or ugly text when R produces the manual.

But note the manual says

'Only encoding names latin1, latin2 and UTF-8 are known to be portable.'

'utf-8' is never correct and may or may not be accepted.

The error message 'Non-ASCII contents without declared encoding' (sic) 
occurs in processing Rd files.  So you would probably do better to add a 
\encoding{} line to the Rd file where the name occurs.  There are many 
examples in the R sources, e.g. src/library/graphics/man/text.Rd .

>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From info at aghmed.fsnet.co.uk  Wed Nov 14 19:15:51 2012
From: info at aghmed.fsnet.co.uk (Michael Dewey)
Date: Wed, 14 Nov 2012 18:15:51 +0000
Subject: [Rd] Typo in documentation for reshape?
Message-ID: <Zen-1TYhVJ-0000St-FS@smarthost03.mail.zen.net.uk>

When I go ?reshape I get told, amongst other things

new.row.names
logical; if TRUE and direction = "wide", create new row names in long 
format from the values of the id and time variables.

This seems to me to be illogical, surely it should read direction = "long"?

Reading the code and observing its behaviour I find that (a) the 
default for new.row.names is in fact NULL (b) the default seems to 
give the behaviour described above for TRUE (c) it is tested in the 
code only as if(is.null(new.row.names)) or if(!is.null(new.row.names))

Note I am not complaining about the behaviour, it does what I would 
want and what seems to me to be the natural thing but I do not think 
it is quite as documented.

R version 2.15.2 (2012-10-26)
Platform: i386-w64-mingw32/i386 (32-bit)



Michael Dewey
info at aghmed.fsnet.co.uk
http://www.aghmed.fsnet.co.uk/home.html


From pdalgd at gmail.com  Wed Nov 14 20:10:45 2012
From: pdalgd at gmail.com (peter dalgaard)
Date: Wed, 14 Nov 2012 20:10:45 +0100
Subject: [Rd] Typo in documentation for reshape?
In-Reply-To: <Zen-1TYhVJ-0000St-FS@smarthost03.mail.zen.net.uk>
References: <Zen-1TYhVJ-0000St-FS@smarthost03.mail.zen.net.uk>
Message-ID: <570D420F-640F-420E-93B6-87ED4AAFF28A@gmail.com>


On Nov 14, 2012, at 19:15 , Michael Dewey wrote:

> When I go ?reshape I get told, amongst other things
> 
> new.row.names
> logical; if TRUE and direction = "wide", create new row names in long format from the values of the id and time variables.
> 
> This seems to me to be illogical, surely it should read direction = "long"?
> 
> Reading the code and observing its behaviour I find that (a) the default for new.row.names is in fact NULL (b) the default seems to give the behaviour described above for TRUE (c) it is tested in the code only as if(is.null(new.row.names)) or if(!is.null(new.row.names))
> 
> Note I am not complaining about the behaviour, it does what I would want and what seems to me to be the natural thing but I do not think it is quite as documented.
> 

I believe this, and a bit more, is in bug #15102. 

The report hasn't been acted upon, but not been dismissed either, so presumably there's general agreement that something is wrong, but someone needs to check the suggested fixups in detail.

It's quite amusing how issues can go unnoticed for years and then be reported by two different people within a week. Or is there perhaps a more direct reason that the two of you should happen to be on the same page?

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From info at aghmed.fsnet.co.uk  Wed Nov 14 21:28:57 2012
From: info at aghmed.fsnet.co.uk (Michael Dewey)
Date: Wed, 14 Nov 2012 20:28:57 +0000
Subject: [Rd] Typo in documentation for reshape?
In-Reply-To: <570D420F-640F-420E-93B6-87ED4AAFF28A@gmail.com>
References: <Zen-1TYhVJ-0000St-FS@smarthost03.mail.zen.net.uk>
	<570D420F-640F-420E-93B6-87ED4AAFF28A@gmail.com>
Message-ID: <Zen-1TYjZy-0007PE-M8@smarthost02.mail.zen.net.uk>

At 19:10 14/11/2012, peter dalgaard wrote:

>On Nov 14, 2012, at 19:15 , Michael Dewey wrote:
>
> > When I go ?reshape I get told, amongst other things
> >
> > new.row.names
> > logical; if TRUE and direction = "wide", create new row names in 
> long format from the values of the id and time variables.
> >
> > This seems to me to be illogical, surely it should read direction = "long"?
> >
> > Reading the code and observing its behaviour I find that (a) the 
> default for new.row.names is in fact NULL (b) the default seems to 
> give the behaviour described above for TRUE (c) it is tested in the 
> code only as if(is.null(new.row.names)) or if(!is.null(new.row.names))
> >
> > Note I am not complaining about the behaviour, it does what I 
> would want and what seems to me to be the natural thing but I do 
> not think it is quite as documented.
> >
>
>I believe this, and a bit more, is in bug #15102.
>
>The report hasn't been acted upon, but not been dismissed either, so 
>presumably there's general agreement that something is wrong, but 
>someone needs to check the suggested fixups in detail.
>
>It's quite amusing how issues can go unnoticed for years and then be 
>reported by two different people within a week. Or is there perhaps 
>a more direct reason that the two of you should happen to be on the same page?

I am not sure how to find who authored the bug report but I have not 
used reshape for a while and I found the documentation issue this 
afternoon and so must assume this is just a coincidence. As I implied 
originally I do not think it is a bug, more of an undocumented feature.


>--
>Peter Dalgaard, Professor,
>Center for Statistics, Copenhagen Business School
>Solbjerg Plads 3, 2000 Frederiksberg, Denmark
>Phone: (+45)38153501
>Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com

Michael Dewey
info at aghmed.fsnet.co.uk
http://www.aghmed.fsnet.co.uk/home.html


From hpages at fhcrc.org  Thu Nov 15 06:42:07 2012
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Wed, 14 Nov 2012 21:42:07 -0800
Subject: [Rd] bug with mapply() on an S4 object
Message-ID: <50A480AF.1030901@fhcrc.org>

Hi,

Starting with ordinary vectors, so we know what to expect:

   > mapply(function(x, y) {x * y}, 101:106, rep(1:3, 2))
   [1] 101 204 309 104 210 318

   > mapply(function(x, y) {x * y}, 101:106, 1:3)
   [1] 101 204 309 104 210 318

Now with an S4 object:

   setClass("A", representation(aa="integer"))
   a <- new("A", aa=101:106)

   > length(a)
   [1] 1

Implementing length():

   setMethod("length", "A", function(x) length(x at aa))

Testing length():

   > length(a)  # sanity check
   [1] 6

No [[ yet for those objects so the following error is expected:

   > mapply(function(x, y) {x * y}, a, rep(1:3, 2))
   Error in dots[[1L]][[1L]] : this S4 class is not subsettable

Implementing [[:

   setMethod("[[", "A", function(x, i, j, ...) x at aa[[i]])

Testing [[:

   > a[[1]]
   [1] 101
   > a[[5]]
   [1] 105

Trying mapply again:

   > mapply(function(x, y) {x * y}, a, rep(1:3, 2))
   [1] 101 202 303 101 202 303

Wrong. It looks like internally a[[1]] is always used instead of a[[i]].

The real problem it seems is that 'a' is treated as if it was of
length 1:

   > mapply(function(x, y) {x * y}, a, 1:3)
   [1] 101 202 303
   > mapply(function(x, y) {x * y}, a, 5)
   [1] 505

In other words, internal dispatch works for [[ but not for length().

Thanks,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From kogalurshear at gmail.com  Wed Nov 14 22:22:15 2012
From: kogalurshear at gmail.com (Udaya B. Kogalur)
Date: Wed, 14 Nov 2012 16:22:15 -0500
Subject: [Rd] Protocol for setting default number of cores
Message-ID: <CACsjJ_fGQQty+uGmviFTbqfeUBcW82ga-HWqJyLEjt2JCgmR-Q@mail.gmail.com>

We recently posted randomForestSRC on CRAN.  It uses OpenMP in the
native code extensively.  We set the default number of cores to two
(2), but we typically run it at the maximum (omp_get_max_threads())
during analysis.  Currently, users need to set options(), set an
environment variable, or edit their .Rprofile to use more than two
cores.  We followed the protocol for mc.cores in mclapply() in the
package parallel.  R CMD CHECK aside, is it acceptable to set the
default to the maximum or is this not recommended?

ubk

-- 
kogalurshear at gmail.com (preferred)
udaya at kogalur-shear.com

Phone:     919-824-9825
Fax:         919-890-3868
Website:  www.kogalur-shear.com

Udaya B. Kogalur, Ph.D.
Adjunct Staff, Dept of Quantitative Health Sciences, Cleveland Clinic Foundation
Consultant, Kogalur Shear Corporation
6887 Idols Road, Suite B
Clemmons, NC 27012


From georgi.boshnakov at manchester.ac.uk  Thu Nov 15 13:43:35 2012
From: georgi.boshnakov at manchester.ac.uk (Georgi Boshnakov)
Date: Thu, 15 Nov 2012 12:43:35 +0000
Subject: [Rd] R-devel Digest, Vol 117, Issue 13
In-Reply-To: <mailman.29.1352977208.18757.r-devel@r-project.org>
References: <mailman.29.1352977208.18757.r-devel@r-project.org>
Message-ID: <438D2EC9EAFE5946B2D5864670EA468E3AB4A3CF@MBXP01.ds.man.ac.uk>

Hi, 

> ... Wrong. It looks like internally a[[1]] is always used instead of a[[i]].
> The real problem it seems is that 'a' is treated as if it was of
> ength 1:
>
>  > mapply(function(x, y) {x * y}, a, 1:3)
>  [1] 101 202 303
>   > mapply(function(x, y) {x * y}, a, 5)
>   [1] 505
>
> In other words, internal dispatch works for [[ but not for length().

Documentation of mapply says 
> Arguments are recycled if necessary.

So, the function seems to work as documented. 

One may be tempted to expect that what 'length()' says should take precedence but  
the '...' arguments in 'mapply' are documented as
>  ...: arguments to vectorize over (vectors or lists of strictly
>          positive length, or all of zero length).

So, the defining feature is that the arguments are vectors.  
Since class A is not defined as a vector class, object 'a' is a scalar (vector of length 1 in R) and therefore recycled. 

It is probably not a good idea to redefine length() for class A without making it a subclass of 'vector' (or something equivalent) since doing so redefines a fundamental basic feature behind R's back. 

Best regards,
Georgi

--
Dr Georgi Boshnakov               tel: (+44) (0)161 306 3684
School of Mathematics             fax: (+44) (0)161 306 3669
Alan Turing Building 1.125
The University of Manchester      email: Georgi.Boshnakov at manchester.ac.uk
Oxford Road
Manchester M13 9PL
UK



Message: 7
Date: Wed, 14 Nov 2012 21:42:07 -0800
From: Herv? Pag?s <hpages at fhcrc.org>
To: R-devel at r-project.org
Subject: [Rd] bug with mapply() on an S4 object
Message-ID: <50A480AF.1030901 at fhcrc.org>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

Hi,

Starting with ordinary vectors, so we know what to expect:

   > mapply(function(x, y) {x * y}, 101:106, rep(1:3, 2))
   [1] 101 204 309 104 210 318

   > mapply(function(x, y) {x * y}, 101:106, 1:3)
   [1] 101 204 309 104 210 318

Now with an S4 object:

   setClass("A", representation(aa="integer"))
   a <- new("A", aa=101:106)

   > length(a)
   [1] 1

Implementing length():

   setMethod("length", "A", function(x) length(x at aa))

Testing length():

   > length(a)  # sanity check
   [1] 6

No [[ yet for those objects so the following error is expected:

   > mapply(function(x, y) {x * y}, a, rep(1:3, 2))
   Error in dots[[1L]][[1L]] : this S4 class is not subsettable

Implementing [[:

   setMethod("[[", "A", function(x, i, j, ...) x at aa[[i]])

Testing [[:

   > a[[1]]
   [1] 101
   > a[[5]]
   [1] 105

Trying mapply again:

   > mapply(function(x, y) {x * y}, a, rep(1:3, 2))
   [1] 101 202 303 101 202 303

Wrong. It looks like internally a[[1]] is always used instead of a[[i]].

The real problem it seems is that 'a' is treated as if it was of
length 1:

   > mapply(function(x, y) {x * y}, a, 1:3)
   [1] 101 202 303
   > mapply(function(x, y) {x * y}, a, 5)
   [1] 505

In other words, internal dispatch works for [[ but not for length().

Thanks,
H.

--
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319






From suharto_anggono at yahoo.com  Fri Nov 16 08:48:12 2012
From: suharto_anggono at yahoo.com (Suharto Anggono Suharto Anggono)
Date: Thu, 15 Nov 2012 23:48:12 -0800 (PST)
Subject: [Rd] Help page on '$': 'warnPartialMatchAttr' should be
	'warnPartialMatchDollar'
Message-ID: <1353052092.85219.YahooMailClassic@web125103.mail.ne1.yahoo.com>

http://stackoverflow.com/questions/6065724/assigning-value-to-a-variable-that-has-a-dot-in-the-name made me realize this.


The context is 'a' is assigned to ret$log.id, but then ret$log returns "a" and ret$l also returns "a".
There is a comment from Charles on the question:
"Also see options(warnPartialMatchDollar=T) if you want to track these."


But, in bottom part, there is Chase's answer, quoting help page for $.

... under Character indices:
Thus the default behaviour is to use partial matching only when extracting from recursive objects (except environments) by $. Even in that case, warnings can be switched on by options(warnPartialMatchAttr = TRUE).


This is what I get from R documentation of 'options'.

     ?warnPartialMatchAttr?: logical.  If true, warns if partial
          matching is used in extracting attributes via ?attr?.

     ?warnPartialMatchDollar?: logical.  If true, warns if partial
          matching is used for extraction by ?$?.


So, in the part of help page on '$' quoted in part of Chase's answer above,
options(warnPartialMatchAttr = TRUE)
should be
options(warnPartialMatchDollar = TRUE)


This is in R 2.15.2.


From rasmussen.bryan at gmail.com  Fri Nov 16 15:10:07 2012
From: rasmussen.bryan at gmail.com (bryan rasmussen)
Date: Fri, 16 Nov 2012 15:10:07 +0100
Subject: [Rd] xmlParseDoc parser errors
Message-ID: <CAHKsR69NPN4vVHAS8SvYGyEqjMBc7x9GFisjOe9x9Uwi1bkK0A@mail.gmail.com>

Hi,

I have some XML files that have a processing instruction directly
after the XML declaration

when I do
kgroup.reading <- character(0)
for (file in file_list){kgroup.reading <-
xmlParseDoc(file.path("c:","projects","respositories","dk","004",file))}

I get the error
file name :1: parser error : Start tag expected, '<' not found

When I remove the processing instruction and try to load it again I do
not get the parser error.

This is of course understandable because of

 [Definition: Processing instructions (PIs) allow documents to contain
instructions for applications.]
Processing Instructions
[16]   	PI	   ::=   	'<?' PITarget (S (Char* - (Char* '?>' Char*)))? '?>'
[17]   	PITarget	   ::=   	Name - (('X' | 'x') ('M' | 'm') ('L' | 'l'))

PIs are not part of the document's character data, but MUST be passed
through to the application. The PI begins with a target (PITarget)
used to identify the application to which the instruction is directed.
The target names " XML ", " xml ", and so on are reserved for
standardization in this or future versions of this specification. The
XML Notation mechanism may be used for formal declaration of PI
targets. Parameter entity references MUST NOT be recognized within
processing instructions.

from the specification, on the other hand it does not say that it is
never allowed for any PI given that they (the W3C) are planning to use
it for  'standardization in this or future versions of this
specification'

Unfortunately the people who made the xml-model processing instruction

http://www.w3.org/TR/2012/NOTE-xml-model-20121009/#the-xml-model-processing-instruction

I guess decided they had the right to standardize a processing
instruction name.

Is there any way to get around this problem?

Also When I do the following:

 t <- '<?xml version="1.0" encoding="utf-8"?><?xml-model
href="urn:publicid:-:Thomson+Information+AS:DTD+AFGRDOK:DK"?><t></t>'
> xmlParseDoc(t)
I get the parser warning

<?xml version="1.0" encoding="utf-8"?><?xml-model
href="urn:publicid:-:Thomson+Information+AS:DTD+AFGRDOK:DK"?><t></t>:1:
parser warning : xmlParsePITarget: invalid name prefix 'xml'
<?xml version="1.0" encoding="utf-8"?><?xml-model href="urn:publicid:-:Thomson+I

Why do I get it as a parser error when I load the document, but a
parser warning when I load it as a string?
Anyway just to get it as a warning when I load the document?

Thanks,
Bryan Rasmussen


From dtemplelang at ucdavis.edu  Fri Nov 16 16:29:58 2012
From: dtemplelang at ucdavis.edu (Duncan Temple Lang)
Date: Fri, 16 Nov 2012 07:29:58 -0800
Subject: [Rd] xmlParseDoc parser errors
In-Reply-To: <CAHKsR69NPN4vVHAS8SvYGyEqjMBc7x9GFisjOe9x9Uwi1bkK0A@mail.gmail.com>
References: <CAHKsR69NPN4vVHAS8SvYGyEqjMBc7x9GFisjOe9x9Uwi1bkK0A@mail.gmail.com>
Message-ID: <50A65BF6.5030600@ucdavis.edu>



On 11/16/12 6:10 AM, bryan rasmussen wrote:
> Hi,
> 
> I have some XML files that have a processing instruction directly
> after the XML declaration
> 
> when I do
> kgroup.reading <- character(0)
> for (file in file_list){kgroup.reading <-
> xmlParseDoc(file.path("c:","projects","respositories","dk","004",file))}
> 
> I get the error
> file name :1: parser error : Start tag expected, '<' not found

That particular error message is most commonly associated with trying
to treat the first argument (the file name) as the XML content itself
because the file does not actually exist.
When you are not reading from XML content as an existing character vector,
you can use asText = FALSE in the call to xmlParseDoc() or xmlParse()
to avoid the function attempting to treat the file name as content,
e.g.
     xmlParseDoc("~/pis.xml", asText = FALSE)

Then you would get a message such

    I/O warning : failed to load external entity "/Users/duncan/pis.xml"



> 
> When I remove the processing instruction and try to load it again I do
> not get the parser error.
> 
> This is of course understandable because of
> 
>  [Definition: Processing instructions (PIs) allow documents to contain
> instructions for applications.]
> Processing Instructions
> [16]   	PI	   ::=   	'<?' PITarget (S (Char* - (Char* '?>' Char*)))? '?>'
> [17]   	PITarget	   ::=   	Name - (('X' | 'x') ('M' | 'm') ('L' | 'l'))
> 
> PIs are not part of the document's character data, but MUST be passed
> through to the application. The PI begins with a target (PITarget)
> used to identify the application to which the instruction is directed.
> The target names " XML ", " xml ", and so on are reserved for
> standardization in this or future versions of this specification. The
> XML Notation mechanism may be used for formal declaration of PI
> targets. Parameter entity references MUST NOT be recognized within
> processing instructions.
> 
> from the specification, on the other hand it does not say that it is
> never allowed for any PI given that they (the W3C) are planning to use
> it for  'standardization in this or future versions of this
> specification'
> 
> Unfortunately the people who made the xml-model processing instruction
> 
> http://www.w3.org/TR/2012/NOTE-xml-model-20121009/#the-xml-model-processing-instruction
> 
> I guess decided they had the right to standardize a processing
> instruction name.
> 
> Is there any way to get around this problem?

Firstly, xmlParseDoc() _will_ parse a processing instruction. The error is
not due to its presence.

You will get a warning because the target of the processing instruction contains the
string xml. Since you are using xmlParseDoc(), you can specify that parser should not
emit warnings via

  xmlParse("filename", NOWARNING)


> 
> Also When I do the following:
> 
>  t <- '<?xml version="1.0" encoding="utf-8"?><?xml-model
> href="urn:publicid:-:Thomson+Information+AS:DTD+AFGRDOK:DK"?><t></t>'
>> xmlParseDoc(t)
> I get the parser warning
> 
> <?xml version="1.0" encoding="utf-8"?><?xml-model
> href="urn:publicid:-:Thomson+Information+AS:DTD+AFGRDOK:DK"?><t></t>:1:
> parser warning : xmlParsePITarget: invalid name prefix 'xml'
> <?xml version="1.0" encoding="utf-8"?><?xml-model href="urn:publicid:-:Thomson+I
> 
> Why do I get it as a parser error when I load the document, but a
> parser warning when I load it as a string?
> Anyway just to get it as a warning when I load the document?

Yes, it just works.  I believe that somehow you didn't have the file initially
and by editing it you caused it to be available.

> 
> Thanks,
> Bryan Rasmussen
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From bernd_bischl at gmx.net  Fri Nov 16 23:48:13 2012
From: bernd_bischl at gmx.net (Bernd Bischl)
Date: Fri, 16 Nov 2012 23:48:13 +0100
Subject: [Rd] Bug in parallel / mclapply
Message-ID: <50A6C2AD.5060601@gmx.net>

Hi,

there seem to be some (small) bugs in the mclapply function in parallel.
I discovered this in the current R release version, and I checked that it is 
still present in R-devel.

I think it only occurs in the part of the code corresponding to argument option
mc.preschedule = FALSE.

Here are two examples:

a)
library(parallel)
mclapply(list(), identity, mc.preschedule=FALSE)
Error in sum(sapply(res, inherits, "try-error")) :
   invalid 'type' (list) of argument

Possible reason / fixes:

The relevant portion of the code is this:

if (!mc.preschedule) {
   FUN <- match.fun(FUN)
   if (length(X) <= cores) {
       jobs <- lapply(seq_along(X), function(i) mcparallel(FUN(X[[i]],
           ...), name = names(X)[i], mc.set.seed = mc.set.seed,
           silent = mc.silent))
       res <- mccollect(jobs)
       if (length(res) == length(X))
           names(res) <- names(X)
       has.errors <- sum(sapply(res, inherits, "try-error"))
   }

If there are 0 jobs, mccollect returns NULL, sapply on this returns the empty 
list, leads to an error in sum.
Possible fix might be to use vapply with FUN.VALUE instead.


b)

library(parallel)
foo <- function(i) NULL
mclapply(1, foo, mc.preschedule=FALSE)

Error in sum(sapply(res, inherits, "try-error")) :
   invalid 'type' (list) of argument

mclapply(1:2, foo, mc.preschedule=FALSE)
$`17222`
NULL

# should be list(NULL, NULL)


Possible reason / fixes:

The bug here is more complicated I think, and occurs in mccollect.

By using debug, I ended up in this line in mccollect:

res[[which(pid == pids)]] <- unserialize(r)

Here, the result of foo (=NULL) is not entered in the result list "res", because 
"<- NULL" is sementically interpreted as "delete list element".
(which has btw trapped me quite often, too...)
Therefore mccollect does not return a list of NULLs as it should, but only 
list(), which leads to the same error as in a).
In the case mclapply(1:2, foo, mc.preschedule=FALSE) something even more 
complicated happens, as on.exit we jump into a "cleanup" function which again 
calls mccollect. Anyway, the final result is wrong, too.

Possible fix:
Actually I am not sure what the best way here is, except for an extra if-case to 
avoid this when the assigment happens?

Best,

Bernd


From ustaudinger at activequant.com  Sat Nov 17 16:56:04 2012
From: ustaudinger at activequant.com (Ulrich Staudinger)
Date: Sat, 17 Nov 2012 16:56:04 +0100
Subject: [Rd] Sighandlers
Message-ID: <CAMrz3D0MNwuiYRiqGWOh8AAT6rcdAbppi9BDZ9EvqqDiSdQ8_Q@mail.gmail.com>

Hello everyone,

I am searching and searching and can't find an answer.

I try to register a sighandler in my extension's C code. But my
sighandler is never called. Is there anything preventing extensions to
receive signals?

I register like this:

[.. some code that works ..]
      // register the sigint listeners.
      if (signal(SIGTERM, killReceiver) == SIG_ERR) {
        printf("2 An error occurred while setting a signal
handler.%s\n", stderr);
      }
      if (signal(SIGHUP, killReceiver) == SIG_ERR) {
        printf("3 An error occurred while setting a signal
handler.%s\n", stderr);
      }
      if (signal(SIGINT, killReceiver) == SIG_ERR) {
        printf("4 An error occurred while setting a signal
handler.%s\n", stderr);
      }
[.. even more code that works ..]


handler code:

static void killReceiver(int signum){
  printf("Cleaning up\n");
}


When I exit R, my signal handler is not being called. Am I listening
to the right signals? Do I have some misunderstanding on my side?

Funny side story, if I manually raise(SIGINT), my handlers gets called.


Thanks for some light on this,

Ulrich





--
Ulrich Staudinger

P: +41 79 702 05 95
E: ustaudinger at activequant.com

http://www.activequant.com
Connect online: https://www.xing.com/profile/Ulrich_Staudinger


From ripley at stats.ox.ac.uk  Sun Nov 18 15:17:10 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 18 Nov 2012 14:17:10 +0000
Subject: [Rd] Sighandlers
In-Reply-To: <CAMrz3D0MNwuiYRiqGWOh8AAT6rcdAbppi9BDZ9EvqqDiSdQ8_Q@mail.gmail.com>
References: <CAMrz3D0MNwuiYRiqGWOh8AAT6rcdAbppi9BDZ9EvqqDiSdQ8_Q@mail.gmail.com>
Message-ID: <50A8EDE6.7080005@stats.ox.ac.uk>

R has its own signal handlers, including for SIGINT.

What is your 'extension'?   If it is a program embedding R, the order of 
setting signal handlers will matter, and in any case R's handler if ever 
called it will reset the handler to itself.

If it is a package, it should not be messing with the process into which 
it is loaded.

On 17/11/2012 15:56, Ulrich Staudinger wrote:
> Hello everyone,
>
> I am searching and searching and can't find an answer.

Did you search the source code?

>
> I try to register a sighandler in my extension's C code. But my
> sighandler is never called. Is there anything preventing extensions to
> receive signals?
>
> I register like this:
>
> [.. some code that works ..]
>        // register the sigint listeners.
>        if (signal(SIGTERM, killReceiver) == SIG_ERR) {
>          printf("2 An error occurred while setting a signal
> handler.%s\n", stderr);
>        }
>        if (signal(SIGHUP, killReceiver) == SIG_ERR) {
>          printf("3 An error occurred while setting a signal
> handler.%s\n", stderr);
>        }
>        if (signal(SIGINT, killReceiver) == SIG_ERR) {
>          printf("4 An error occurred while setting a signal
> handler.%s\n", stderr);
>        }
> [.. even more code that works ..]
>
>
> handler code:
>
> static void killReceiver(int signum){
>    printf("Cleaning up\n");
> }
>
>
> When I exit R, my signal handler is not being called. Am I listening
> to the right signals? Do I have some misunderstanding on my side?
>
> Funny side story, if I manually raise(SIGINT), my handlers gets called.
>
>
> Thanks for some light on this,
>
> Ulrich
>
>
>
>
>
> --
> Ulrich Staudinger
>
> P: +41 79 702 05 95
> E: ustaudinger at activequant.com
>
> http://www.activequant.com
> Connect online: https://www.xing.com/profile/Ulrich_Staudinger
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From keith at wehi.EDU.AU  Mon Nov 19 06:05:43 2012
From: keith at wehi.EDU.AU (Keith)
Date: Mon, 19 Nov 2012 16:05:43 +1100
Subject: [Rd] tcltk freezing using MS Windows for R-2.14+
Message-ID: <50A9BE27.7090404@wehi.edu.au>

I am the maintainer of a Bioconductor package (affylmGUI) which uses 
tcltk. It freezes inconsistently on MS Windows, but not Mac or Unix. see 
details below.

After considerable testing I have reduced the problem from a few 
thousand lines of code to 30 lines!

If you paste the following lines of code into an R window:


testGUI <- function(){
     require(tcltk)
     MainWindow <- tktoplevel()
     topMenu <- tkmenu(MainWindow)
     tkconfigure(MainWindow,menu=topMenu)
     normalizeMenu <- tkmenu(topMenu, tearoff=FALSE)
     tkadd(normalizeMenu,"command",label="Normalize",command = 
function() NormalizeNow(MainWindow))
     tkadd(topMenu, "cascade", label="MainWindow", menu = normalizeMenu)
     tkfocus(MainWindow)
     #
}#end of testGUI <- function()
#
NormalizeNow <- function(MainWindow){
     NMethod <- GetNMethod(MainWindow)
     if (NMethod=="") return()
     tkconfigure(MainWindow,cursor="watch")
     tkfocus(MainWindow)
}#end of NormalizeNow <- function(){
#
GetNMethod <- function(MainWindow){
     ReturnVal <- "RMA"
     GNMethod <- tktoplevel(MainWindow)
     tkwm.deiconify(GNMethod)
     tkgrab.set(GNMethod)
     tkfocus(GNMethod)
     tkwm.title(GNMethod,"Get Method")
     tkbind(GNMethod,"<Destroy>",function() {ReturnVal <- 
"";tkgrab.release(GNMethod);tkfocus(MainWindow);})
     tkwait.window(GNMethod)
     return (ReturnVal)
}#end of GetNMethod <- function()


and then run the function testGUI()

A Main Window pops up with "Main Window" in the Menu bar. Click on "Main 
Window" and the first (and only) item on the menu drops down and it is 
called "Normalize". Clicking this opens another windows entitled "Get 
Method". If there is a problem (it is intermittent), it is evidenced by 
the fact that the "Get Method" window will not close.

It cannot be closed by clicking. The window is frozen open. It can be 
moved but not closed. On MS Windows, the "Get Method" window can be 
closed using the right button close window option on the task bar icon  
Typically the problem occurs infrequently in the first 10 presses on the 
"Normalize" item, but more frequently there after.

I have NOT had the problem on Mac OSX or Linux.

On MS Windows (I have tested on Win XP-32bit and Win7-64bit) the problem 
occurs in R-2.16.0, R-2.15.2, R-2.15.1,R-2.14.0.

THERE IS NO PROBLEM WITH R-2.13.1 and R-2.13.0

I have run it using debug("GetNMethod"). Stepping through the GetNMethod 
function results in freezing when asked to do the "tkgrab.set(GNMethod)" 
instruction.

I would appreciate if others can confirm similar behaviour.

Can anyone suggest why it worked under R-2.13.x but not in later 
versions of R.

Was there a change in R that impacts with this aspect of tcltk?

Is there a work around for this problem?

Any suggestions appreciated,

thanks

Keith Satterley
affylmGUI, limmaGUI maintainer.
Bioinformatics Division
The Walter and Eliza Hall Institute
Melbourne, Australia.

Some sessionInfo() outputs:



Win7-64bit-R-2.15.2  testGUI() fails intermittently.
 > sessionInfo()
R version 2.15.2 (2012-10-26)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_Australia.1252 LC_CTYPE=C
[3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
[5] LC_TIME=English_Australia.1252

attached base packages:
[1] tcltk     stats     graphics  grDevices utils     datasets methods   
base



Linux x64-R-2.15.2. testGUI() works always
R version 2.15.2 (2012-10-26)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
  [7] LC_PAPER=C                 LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] tcltk     stats     graphics  grDevices utils     datasets methods
[8] base



Mac OS X R-2.15.2.  testGUI() works always
 > sessionInfo()
R version 2.15.2 (2012-10-26)
Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)

locale:
[1] en_AU.UTF-8/en_AU.UTF-8/en_AU.UTF-8/C/en_AU.UTF-8/en_AU.UTF-8

attached base packages:
[1] tcltk     stats     graphics  grDevices utils     datasets methods   
base



WinXP-32bit--R-2.15.2.  testGUI() fails intermittently
  > sessionInfo()
  R version 2.15.2 (2012-10-26)
  Platform: i386-w64-mingw32/i386 (32-bit)

  locale:
  [1] LC_COLLATE=English_Australia.1252 LC_CTYPE=English_Australia.1252 
LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
  [5] LC_TIME=English_Australia.1252

  attached base packages:
  [1] tcltk     stats     graphics  grDevices utils     datasets 
methods   base



Win7-R-2.13.1.  testGUI() works always
 > sessionInfo()
R version 2.13.1 (2011-07-08)
Platform: x86_64-pc-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_Australia.1252 LC_CTYPE=C
[3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
[5] LC_TIME=English_Australia.1252

attached base packages:
[1] tcltk     stats     graphics  grDevices utils     datasets methods   
base




______________________________________________________________________
The information in this email is confidential and intend...{{dropped:4}}


From raffaele.calogero at gmail.com  Mon Nov 19 07:44:40 2012
From: raffaele.calogero at gmail.com (rcaloger)
Date: Mon, 19 Nov 2012 07:44:40 +0100
Subject: [Rd] tcltk freezing using MS Windows for R-2.14+
In-Reply-To: <50A9BE27.7090404@wehi.edu.au>
References: <50A9BE27.7090404@wehi.edu.au>
Message-ID: <50A9D558.5090107@unito.it>

Hi Keith,
I confirm that the problem of tcltk freezing window was reported by 
windows oneChannelGUI users.
I also submitted the problem to R-bugs, but I could not manage to 
convince them that the problem is not due to the package.
Cheers
Raffaele
On 11/19/12 6:05 AM, Keith wrote:
> I am the maintainer of a Bioconductor package (affylmGUI) which uses 
> tcltk. It freezes inconsistently on MS Windows, but not Mac or Unix. 
> see details below.
>
> After considerable testing I have reduced the problem from a few 
> thousand lines of code to 30 lines!
>
> If you paste the following lines of code into an R window:
>
>
> testGUI <- function(){
>     require(tcltk)
>     MainWindow <- tktoplevel()
>     topMenu <- tkmenu(MainWindow)
>     tkconfigure(MainWindow,menu=topMenu)
>     normalizeMenu <- tkmenu(topMenu, tearoff=FALSE)
>     tkadd(normalizeMenu,"command",label="Normalize",command = 
> function() NormalizeNow(MainWindow))
>     tkadd(topMenu, "cascade", label="MainWindow", menu = normalizeMenu)
>     tkfocus(MainWindow)
>     #
> }#end of testGUI <- function()
> #
> NormalizeNow <- function(MainWindow){
>     NMethod <- GetNMethod(MainWindow)
>     if (NMethod=="") return()
>     tkconfigure(MainWindow,cursor="watch")
>     tkfocus(MainWindow)
> }#end of NormalizeNow <- function(){
> #
> GetNMethod <- function(MainWindow){
>     ReturnVal <- "RMA"
>     GNMethod <- tktoplevel(MainWindow)
>     tkwm.deiconify(GNMethod)
>     tkgrab.set(GNMethod)
>     tkfocus(GNMethod)
>     tkwm.title(GNMethod,"Get Method")
>     tkbind(GNMethod,"<Destroy>",function() {ReturnVal <- 
> "";tkgrab.release(GNMethod);tkfocus(MainWindow);})
>     tkwait.window(GNMethod)
>     return (ReturnVal)
> }#end of GetNMethod <- function()
>
>
> and then run the function testGUI()
>
> A Main Window pops up with "Main Window" in the Menu bar. Click on 
> "Main Window" and the first (and only) item on the menu drops down and 
> it is called "Normalize". Clicking this opens another windows entitled 
> "Get Method". If there is a problem (it is intermittent), it is 
> evidenced by the fact that the "Get Method" window will not close.
>
> It cannot be closed by clicking. The window is frozen open. It can be 
> moved but not closed. On MS Windows, the "Get Method" window can be 
> closed using the right button close window option on the task bar 
> icon  Typically the problem occurs infrequently in the first 10 
> presses on the "Normalize" item, but more frequently there after.
>
> I have NOT had the problem on Mac OSX or Linux.
>
> On MS Windows (I have tested on Win XP-32bit and Win7-64bit) the 
> problem occurs in R-2.16.0, R-2.15.2, R-2.15.1,R-2.14.0.
>
> THERE IS NO PROBLEM WITH R-2.13.1 and R-2.13.0
>
> I have run it using debug("GetNMethod"). Stepping through the 
> GetNMethod function results in freezing when asked to do the 
> "tkgrab.set(GNMethod)" instruction.
>
> I would appreciate if others can confirm similar behaviour.
>
> Can anyone suggest why it worked under R-2.13.x but not in later 
> versions of R.
>
> Was there a change in R that impacts with this aspect of tcltk?
>
> Is there a work around for this problem?
>
> Any suggestions appreciated,
>
> thanks
>
> Keith Satterley
> affylmGUI, limmaGUI maintainer.
> Bioinformatics Division
> The Walter and Eliza Hall Institute
> Melbourne, Australia.
>
> Some sessionInfo() outputs:
>
>
>
> Win7-64bit-R-2.15.2  testGUI() fails intermittently.
> > sessionInfo()
> R version 2.15.2 (2012-10-26)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=English_Australia.1252 LC_CTYPE=C
> [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
> [5] LC_TIME=English_Australia.1252
>
> attached base packages:
> [1] tcltk     stats     graphics  grDevices utils     datasets 
> methods   base
>
>
>
> Linux x64-R-2.15.2. testGUI() works always
> R version 2.15.2 (2012-10-26)
> Platform: x86_64-unknown-linux-gnu (64-bit)
>
> locale:
>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>  [7] LC_PAPER=C                 LC_NAME=C
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] tcltk     stats     graphics  grDevices utils     datasets methods
> [8] base
>
>
>
> Mac OS X R-2.15.2.  testGUI() works always
> > sessionInfo()
> R version 2.15.2 (2012-10-26)
> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
>
> locale:
> [1] en_AU.UTF-8/en_AU.UTF-8/en_AU.UTF-8/C/en_AU.UTF-8/en_AU.UTF-8
>
> attached base packages:
> [1] tcltk     stats     graphics  grDevices utils     datasets 
> methods   base
>
>
>
> WinXP-32bit--R-2.15.2.  testGUI() fails intermittently
>  > sessionInfo()
>  R version 2.15.2 (2012-10-26)
>  Platform: i386-w64-mingw32/i386 (32-bit)
>
>  locale:
>  [1] LC_COLLATE=English_Australia.1252 LC_CTYPE=English_Australia.1252 
> LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
>  [5] LC_TIME=English_Australia.1252
>
>  attached base packages:
>  [1] tcltk     stats     graphics  grDevices utils     datasets 
> methods   base
>
>
>
> Win7-R-2.13.1.  testGUI() works always
> > sessionInfo()
> R version 2.13.1 (2011-07-08)
> Platform: x86_64-pc-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=English_Australia.1252 LC_CTYPE=C
> [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
> [5] LC_TIME=English_Australia.1252
>
> attached base packages:
> [1] tcltk     stats     graphics  grDevices utils     datasets 
> methods   base
>
>
>
>
> ______________________________________________________________________
> The information in this email is confidential and inte...{{dropped:22}}


From murdoch.duncan at gmail.com  Mon Nov 19 12:51:29 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 19 Nov 2012 06:51:29 -0500
Subject: [Rd] tcltk freezing using MS Windows for R-2.14+
In-Reply-To: <50A9BE27.7090404@wehi.edu.au>
References: <50A9BE27.7090404@wehi.edu.au>
Message-ID: <50AA1D41.5030506@gmail.com>

I see the freeze that you mentioned.  I'm not likely to be able to track 
this down in the next while, so I'd suggest posting it to the R bug 
list.  (If you can determine what makes it 100% reproducible, or shorten 
the script even more, that will make it easier to find and fix.)

Duncan Murdoch

On 12-11-19 12:05 AM, Keith wrote:
> I am the maintainer of a Bioconductor package (affylmGUI) which uses
> tcltk. It freezes inconsistently on MS Windows, but not Mac or Unix. see
> details below.
>
> After considerable testing I have reduced the problem from a few
> thousand lines of code to 30 lines!
>
> If you paste the following lines of code into an R window:
>
>
> testGUI <- function(){
>       require(tcltk)
>       MainWindow <- tktoplevel()
>       topMenu <- tkmenu(MainWindow)
>       tkconfigure(MainWindow,menu=topMenu)
>       normalizeMenu <- tkmenu(topMenu, tearoff=FALSE)
>       tkadd(normalizeMenu,"command",label="Normalize",command =
> function() NormalizeNow(MainWindow))
>       tkadd(topMenu, "cascade", label="MainWindow", menu = normalizeMenu)
>       tkfocus(MainWindow)
>       #
> }#end of testGUI <- function()
> #
> NormalizeNow <- function(MainWindow){
>       NMethod <- GetNMethod(MainWindow)
>       if (NMethod=="") return()
>       tkconfigure(MainWindow,cursor="watch")
>       tkfocus(MainWindow)
> }#end of NormalizeNow <- function(){
> #
> GetNMethod <- function(MainWindow){
>       ReturnVal <- "RMA"
>       GNMethod <- tktoplevel(MainWindow)
>       tkwm.deiconify(GNMethod)
>       tkgrab.set(GNMethod)
>       tkfocus(GNMethod)
>       tkwm.title(GNMethod,"Get Method")
>       tkbind(GNMethod,"<Destroy>",function() {ReturnVal <-
> "";tkgrab.release(GNMethod);tkfocus(MainWindow);})
>       tkwait.window(GNMethod)
>       return (ReturnVal)
> }#end of GetNMethod <- function()
>
>
> and then run the function testGUI()
>
> A Main Window pops up with "Main Window" in the Menu bar. Click on "Main
> Window" and the first (and only) item on the menu drops down and it is
> called "Normalize". Clicking this opens another windows entitled "Get
> Method". If there is a problem (it is intermittent), it is evidenced by
> the fact that the "Get Method" window will not close.
>
> It cannot be closed by clicking. The window is frozen open. It can be
> moved but not closed. On MS Windows, the "Get Method" window can be
> closed using the right button close window option on the task bar icon
> Typically the problem occurs infrequently in the first 10 presses on the
> "Normalize" item, but more frequently there after.
>
> I have NOT had the problem on Mac OSX or Linux.
>
> On MS Windows (I have tested on Win XP-32bit and Win7-64bit) the problem
> occurs in R-2.16.0, R-2.15.2, R-2.15.1,R-2.14.0.
>
> THERE IS NO PROBLEM WITH R-2.13.1 and R-2.13.0
>
> I have run it using debug("GetNMethod"). Stepping through the GetNMethod
> function results in freezing when asked to do the "tkgrab.set(GNMethod)"
> instruction.
>
> I would appreciate if others can confirm similar behaviour.
>
> Can anyone suggest why it worked under R-2.13.x but not in later
> versions of R.
>
> Was there a change in R that impacts with this aspect of tcltk?
>
> Is there a work around for this problem?
>
> Any suggestions appreciated,
>
> thanks
>
> Keith Satterley
> affylmGUI, limmaGUI maintainer.
> Bioinformatics Division
> The Walter and Eliza Hall Institute
> Melbourne, Australia.
>
> Some sessionInfo() outputs:
>
>
>
> Win7-64bit-R-2.15.2  testGUI() fails intermittently.
>   > sessionInfo()
> R version 2.15.2 (2012-10-26)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=English_Australia.1252 LC_CTYPE=C
> [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
> [5] LC_TIME=English_Australia.1252
>
> attached base packages:
> [1] tcltk     stats     graphics  grDevices utils     datasets methods
> base
>
>
>
> Linux x64-R-2.15.2. testGUI() works always
> R version 2.15.2 (2012-10-26)
> Platform: x86_64-unknown-linux-gnu (64-bit)
>
> locale:
>    [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>    [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>    [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>    [7] LC_PAPER=C                 LC_NAME=C
>    [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] tcltk     stats     graphics  grDevices utils     datasets methods
> [8] base
>
>
>
> Mac OS X R-2.15.2.  testGUI() works always
>   > sessionInfo()
> R version 2.15.2 (2012-10-26)
> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
>
> locale:
> [1] en_AU.UTF-8/en_AU.UTF-8/en_AU.UTF-8/C/en_AU.UTF-8/en_AU.UTF-8
>
> attached base packages:
> [1] tcltk     stats     graphics  grDevices utils     datasets methods
> base
>
>
>
> WinXP-32bit--R-2.15.2.  testGUI() fails intermittently
>    > sessionInfo()
>    R version 2.15.2 (2012-10-26)
>    Platform: i386-w64-mingw32/i386 (32-bit)
>
>    locale:
>    [1] LC_COLLATE=English_Australia.1252 LC_CTYPE=English_Australia.1252
> LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
>    [5] LC_TIME=English_Australia.1252
>
>    attached base packages:
>    [1] tcltk     stats     graphics  grDevices utils     datasets
> methods   base
>
>
>
> Win7-R-2.13.1.  testGUI() works always
>   > sessionInfo()
> R version 2.13.1 (2011-07-08)
> Platform: x86_64-pc-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=English_Australia.1252 LC_CTYPE=C
> [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
> [5] LC_TIME=English_Australia.1252
>
> attached base packages:
> [1] tcltk     stats     graphics  grDevices utils     datasets methods
> base
>
>
>
>
> ______________________________________________________________________
> The information in this email is confidential and intend...{{dropped:4}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From maechler at stat.math.ethz.ch  Mon Nov 19 18:52:13 2012
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 19 Nov 2012 18:52:13 +0100
Subject: [Rd] Help page on '$': 'warnPartialMatchAttr' should
	be	'warnPartialMatchDollar'
In-Reply-To: <1353052092.85219.YahooMailClassic@web125103.mail.ne1.yahoo.com>
References: <1353052092.85219.YahooMailClassic@web125103.mail.ne1.yahoo.com>
Message-ID: <20650.29133.9731.484652@stat.math.ethz.ch>

Thank you, Suharto,

you are right, there (on  ?Extract  ) has been a typo.

I've fixed it and also added an example at the very end of that
help page.

Martin Maechler, ETH Zurich


>>>>> Suharto Anggono <suharto_anggono at yahoo.com>
>>>>>     on Thu, 15 Nov 2012 23:48:12 -0800 writes:

    > http://stackoverflow.com/questions/6065724/assigning-value-to-a-variable-that-has-a-dot-in-the-name
    > made me realize this.  The context is 'a' is assigned to
    > ret$log.id, but then ret$log returns "a" and ret$l also
    > returns "a".  There is a comment from Charles on the
    > question: "Also see options(warnPartialMatchDollar=T) if
    > you want to track these."


    > But, in bottom part, there is Chase's answer, quoting help
    > page for $.

    > ... under Character indices: Thus the default behaviour is
    > to use partial matching only when extracting from
    > recursive objects (except environments) by $. Even in that
    > case, warnings can be switched on by
    > options(warnPartialMatchAttr = TRUE).


    > This is what I get from R documentation of 'options'.

    >      ?warnPartialMatchAttr?: logical.  If true, warns if
    > partial matching is used in extracting attributes via
    > ?attr?.

    >      ?warnPartialMatchDollar?: logical.  If true, warns if
    > partial matching is used for extraction by ?$?.


    > So, in the part of help page on '$' quoted in part of
    > Chase's answer above, options(warnPartialMatchAttr = TRUE)
    > should be options(warnPartialMatchDollar = TRUE)


    > This is in R 2.15.2.

    > ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Mon Nov 19 22:03:28 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 19 Nov 2012 16:03:28 -0500
Subject: [Rd] tcltk freezing using MS Windows for R-2.14+
In-Reply-To: <50A9BE27.7090404@wehi.edu.au>
References: <50A9BE27.7090404@wehi.edu.au>
Message-ID: <50AA9EA0.7030803@gmail.com>

On 19/11/2012 12:05 AM, Keith wrote:
> ...

> A Main Window pops up with "Main Window" in the Menu bar. Click on "Main
> Window" and the first (and only) item on the menu drops down and it is
> called "Normalize". Clicking this opens another windows entitled "Get
> Method". If there is a problem (it is intermittent), it is evidenced by
> the fact that the "Get Method" window will not close.
>
> It cannot be closed by clicking. The window is frozen open. It can be
> moved but not closed. On MS Windows, the "Get Method" window can be
> closed using the right button close window option on the task bar icon
> Typically the problem occurs infrequently in the first 10 presses on the
> "Normalize" item, but more frequently there after.
>
> I have NOT had the problem on Mac OSX or Linux.
>
> On MS Windows (I have tested on Win XP-32bit and Win7-64bit) the problem
> occurs in R-2.16.0, R-2.15.2, R-2.15.1,R-2.14.0.
>
> THERE IS NO PROBLEM WITH R-2.13.1 and R-2.13.0
>
> I have run it using debug("GetNMethod"). Stepping through the GetNMethod
> function results in freezing when asked to do the "tkgrab.set(GNMethod)"
> instruction.
>
> I would appreciate if others can confirm similar behaviour.b
>
> Can anyone suggest why it worked under R-2.13.x but not in later
> versions of R.
>
> Was there a change in R that impacts with this aspect of tcltk?
>
> Is there a work around for this problem?


If all you are interested in is closing the Window, it seems on my 
Windows 7 system that right clicking the corresponding button in the 
task bar at the bottom of the screen to bring up the local menu, and 
choosing "close", will successfully close it.

Of course, this doesn't address the real problem.

Duncan Murdoch


From murdoch.duncan at gmail.com  Mon Nov 19 22:20:13 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 19 Nov 2012 16:20:13 -0500
Subject: [Rd] tcltk freezing using MS Windows for R-2.14+
In-Reply-To: <50A9BE27.7090404@wehi.edu.au>
References: <50A9BE27.7090404@wehi.edu.au>
Message-ID: <50AAA28D.2080702@gmail.com>

On 19/11/2012 12:05 AM, Keith wrote:
...
> On MS Windows (I have tested on Win XP-32bit and Win7-64bit) the problem
> occurs in R-2.16.0, R-2.15.2, R-2.15.1,R-2.14.0.
>

Of course, there is no 2.16.0 yet, but one more datapoint:  I can't 
reproduce the problem with a current build of R-devel (i.e. the one that 
reports itself as 2012-11-19 r61131.  What version were you trying?

Duncan Murdoch


From keith at wehi.EDU.AU  Tue Nov 20 00:17:12 2012
From: keith at wehi.EDU.AU (Keith)
Date: Tue, 20 Nov 2012 10:17:12 +1100
Subject: [Rd] tcltk freezing using MS Windows for R-2.14+
In-Reply-To: <50AAA28D.2080702@gmail.com>
References: <50A9BE27.7090404@wehi.edu.au> <50AAA28D.2080702@gmail.com>
Message-ID: <50AABDF8.1040706@wehi.edu.au>

Thanks Duncan for testing. I have installed the latest binary I could 
find which is:

R Under development (unstable) (2012-11-16 r61126)
Platform: x86_64-w64-mingw32/x64 (64-bit)

I still have a problem.

I have shortened the code as you suggested - now it's only 6 lines! 
could you try this please:

test2GUI <- function(){
     require(tcltk)
     MainWindow <- tktoplevel()
     topMenu <- tkmenu(MainWindow)
     tkconfigure(MainWindow,menu=topMenu)
     tkgrab.set(MainWindow)
     tkfocus(MainWindow)
}

When I run this function 40 times my record of success was as follows
01011111101011111010110111110001111100001
where 1 means I could close the window, 0 means it froze.
I could actually run the function 20 times, displaying  20 windows and 
then tried to close them one by one. I then repeated this after using 
the mouse right click on the task bar to close those windows that were 
frozen.

I haven't submitted it to R bug list yet. Should I now go ahead and do that?

cheers,

Keith Satterley


On 20/11/2012 8:20 AM, Duncan Murdoch wrote:
> On 19/11/2012 12:05 AM, Keith wrote:
> ...
>> On MS Windows (I have tested on Win XP-32bit and Win7-64bit) the problem
>> occurs in R-2.16.0, R-2.15.2, R-2.15.1,R-2.14.0.
>>
>
> Of course, there is no 2.16.0 yet, but one more datapoint:  I can't 
> reproduce the problem with a current build of R-devel (i.e. the one 
> that reports itself as 2012-11-19 r61131.  What version were you trying?
>
> Duncan Murdoch


______________________________________________________________________
The information in this email is confidential and intend...{{dropped:4}}


From edoffagne at gmail.com  Tue Nov 20 07:49:08 2012
From: edoffagne at gmail.com (Erik Doffagne)
Date: Tue, 20 Nov 2012 07:49:08 +0100
Subject: [Rd] Buffer overflow in date package
Message-ID: <CAG=pywr8g5XzVhG6DqXPaO2+eSFre_P9iDU88rBAcFTACcLipQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121120/25be7ce4/attachment.pl>

From ripley at stats.ox.ac.uk  Tue Nov 20 14:45:09 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 20 Nov 2012 13:45:09 +0000
Subject: [Rd] Buffer overflow in date package
In-Reply-To: <CAG=pywr8g5XzVhG6DqXPaO2+eSFre_P9iDU88rBAcFTACcLipQ@mail.gmail.com>
References: <CAG=pywr8g5XzVhG6DqXPaO2+eSFre_P9iDU88rBAcFTACcLipQ@mail.gmail.com>
Message-ID: <50AB8965.90907@stats.ox.ac.uk>

On 20/11/2012 06:49, Erik Doffagne wrote:
> Dear list-members,
>
> I have observed quite a strange problem with the date package.
>
> You will find below what I get on my machine (Ubuntu). I have been able to
> reproduce the error on Red Hat too. But it seems not to happen on Windows
> (and on some other Linux distros?).

You need to report this to the package maintainer (see the posting 
guide).  But running under valgrind shows why this is not reproducible:

==1487== Conditional jump or move depends on uninitialised value(s)
==1487==    at 0x4B9215: Rf_mkChar (envir.c:3380)
==1487==    by 0x49C471: do_dotCode (dotcode.c:2497)
==1487==    by 0x4C0ABD: Rf_eval (eval.c:494)
==1487==    by 0x4C4258: do_set (eval.c:1717)
==1487==    by 0x4C08DA: Rf_eval (eval.c:468)
==1487==    by 0x4C345F: do_begin (eval.c:1415)
==1487==    by 0x4C08DA: Rf_eval (eval.c:468)
==1487==    by 0x4C26D3: do_if (eval.c:1194)
==1487==    by 0x4C08DA: Rf_eval (eval.c:468)
==1487==    by 0x4C26D3: do_if (eval.c:1194)
==1487==    by 0x4C08DA: Rf_eval (eval.c:468)
==1487==    by 0x4C345F: do_begin (eval.c:1415)
==1487==  Uninitialised value was created by a heap allocation
==1487==    at 0x4A0762F: malloc (vg_replace_malloc.c:270)
==1487==    by 0x4F71CE: GetNewPage (memory.c:787)
==1487==    by 0x504851: Rf_allocVector (memory.c:2371)
==1487==    by 0x552FC3: ReadItem (serialize.c:1633)
==1487==    by 0x5536FD: ReadBC1 (serialize.c:1782)
==1487==    by 0x55361D: ReadBCConsts (serialize.c:1758)
==1487==    by 0x55374C: ReadBC1 (serialize.c:1784)
==1487==    by 0x5537D6: ReadBC (serialize.c:1794)
==1487==    by 0x5531B3: ReadItem (serialize.c:1660)
==1487==    by 0x552AD2: ReadItem (serialize.c:1571)
==1487==    by 0x5539A0: R_Unserialize (serialize.c:1837)
==1487==    by 0x5552E0: R_unserialize (serialize.c:2456)
==1487==
[1] <NA>


>
>> require(date)
> Loading required package: date
>> sessionInfo()
> R version 2.15.2 (2012-10-26)
> Platform: x86_64-pc-linux-gnu (64-bit)
>
> locale:
>   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>   [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>   [7] LC_PAPER=C                 LC_NAME=C
>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] date_1.2-32
>> as.date("1921994")
> *** buffer overflow detected ***: /usr/lib/R/bin/exec/R terminated
> ======= Backtrace: =========
> /lib/x86_64-linux-gnu/libc.so.6(__fortify_fail+0x37)[0x7f46659ca007]
> /lib/x86_64-linux-gnu/libc.so.6(+0x107f00)[0x7f46659c8f00]
> /lib/x86_64-linux-gnu/libc.so.6(+0x107369)[0x7f46659c8369]
>
> I have tried to isolate the problem by calling the C code from the date
> package without R.
>
> #include "char_date.c"
>
>   int main()
>   { int nv = 1;
>     int order[] = {2,3,1};
>     char cdatev[] = "1921994";
>     int month[] = {0};
>     int day[] = {0};
>     int year[] = {0};
>     int *n = &nv;
>     int i;
>     int size = strlen(cdatev);
>     char *cdate[size];
>     for (i=0;i<size;i++) cdate[i] = &cdatev[i];

This fails to terminate cdate, and the C code does do strlen() on it.

>     char_date(n, order, cdate, month, day, year);
>     printf("%d-%d-%d\n",day[0],month[0],year[0]);
>     return(0);
>   }
>
> Depending on the compilation flags, I get different behavior:
>
> $ gcc rundate.c -o rundate.o
> $ ./rundate.o
> 92-1-1994
>
> $ gcc rundate.c -O3 -o rundate.o
> $ ./rundate.o
> *** buffer overflow detected ***: ./rundate.o terminated
> ======= Backtrace: =========
> /lib/x86_64-linux-gnu/libc.so.6(__fortify_fail+0x37)[0x7f17fdfb9007]
> /lib/x86_64-linux-gnu/libc.so.6(+0x107f00)[0x7f17fdfb7f00]
> /lib/x86_64-linux-gnu/libc.so.6(+0x107369)[0x7f17fdfb7369]
>
> $ gcc -v
> Using built-in specs.
> COLLECT_GCC=gcc
> COLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/4.6/lto-wrapper
> Target: x86_64-linux-gnu
> Configured with: ../src/configure -v --with-pkgversion='Ubuntu/Linaro
> 4.6.3-1ubuntu5' --with-bugurl=file:///usr/share/doc/gcc-4.6/README.Bugs
> --enable-languages=c,c++,fortran,objc,obj-c++ --prefix=/usr
> --program-suffix=-4.6 --enable-shared --enable-linker-build-id
> --with-system-zlib --libexecdir=/usr/lib --without-included-gettext
> --enable-threads=posix --with-gxx-include-dir=/usr/include/c++/4.6
> --libdir=/usr/lib --enable-nls --with-sysroot=/ --enable-clocale=gnu
> --enable-libstdcxx-debug --enable-libstdcxx-time=yes
> --enable-gnu-unique-object --enable-plugin --enable-objc-gc
> --disable-werror --with-arch-32=i686 --with-tune=generic
> --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu
> --target=x86_64-linux-gnu
> Thread model: posix
> gcc version 4.6.3 (Ubuntu/Linaro 4.6.3-1ubuntu5)
>
> Does anyone is able to reproduce this error ? Any thoughts what could be
> wrong ?
>
> Thanks in advance.
>
> Erik
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From suharto_anggono at yahoo.com  Wed Nov 21 07:54:45 2012
From: suharto_anggono at yahoo.com (Suharto Anggono Suharto Anggono)
Date: Tue, 20 Nov 2012 22:54:45 -0800 (PST)
Subject: [Rd] Zero-length 'by' in 'aggregate.data.frame'
Message-ID: <1353480885.57159.YahooMailClassic@web125103.mail.ne1.yahoo.com>

Use of tapply() with a 0-length INDEX list is made deprecated in R 2.15.2. How about the similar case for 'aggregate.data.frame', i.e. 0-length 'by' list? Is it going to be supported or not?


In R 2.15.2, it doesn't work if 'by' does not have names, but works if 'by' has names. If 0-length 'by' does not have names, the code

names(by) <- paste("Group", seq_along(by), sep = ".")

fails to give names, because the result of

paste("Group", seq_along(by), sep = ".")

is "Group.", which has length 1 instead of 0.


> aggregate(data.frame(x=1:10), list(), length)
Error in aggregate.data.frame(data.frame(x = 1:10), list(), length) :
  'names' attribute [1] must be the same length as the vector [0]
> aggregate(data.frame(x=1:10),
+ structure(list(), names=character(0)), length)
   x
1 10
> sessionInfo()
R version 2.15.2 (2012-10-26)
Platform: i386-w64-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


From schmidt at math.utk.edu  Wed Nov 21 17:19:39 2012
From: schmidt at math.utk.edu (Drew Schmidt)
Date: Wed, 21 Nov 2012 11:19:39 -0500 (EST)
Subject: [Rd] S3 generic/method consistency issue with R CMD check
Message-ID: <44191.216.96.219.191.1353514779.squirrel@math.utk.edu>

Hi,

I'm having some trouble setting methods for the qr family of functions.  I
believe I have distilled my misunderstanding in the code snippet below:


foo <- function(x, ...) UseMethod("foo")

foo.default <- function(x) { }

# foo

setGeneric(name = "foo", useAsDefault = foo)

setMethod("foo", signature(x="bar"),
  function(x, ...) { }
)

setGeneric(name="foo.Q",
  function(y, ...)
    standardGeneric("foo.Q")
)

setMethod("foo.Q", signature(y="bar"),
  function(y, ...) { }
)

# QR

setGeneric(name = "qr", useAsDefault = qr)

setMethod("qr", signature(x="bar"),
  function(x, ...) { }
)

setGeneric(name="qr.Q",
  function(y, ...)
    standardGeneric("qr.Q")
)

setMethod("qr.Q", signature(y="bar"),
  function(y, ...) { }
)


If you send this to R CMD check, then it gives exactly one WARNING about
S3 consistency:


* checking S3 generic/method consistency ... WARNING
qr:
  function(x, ...)
qr.Q:
  function(y, ...)


This seems to be complaining about the fact that qr.Q dispatches on 'y'
instead of 'x'.  But there is no complaint about foo/foo.Q even though, I
believe, the only difference is a mechanical substitution of
generic/method names.

Ultimately I would like to be able to set methods for the qr family in a
way that maximally mimics R in both syntax and return.  I'm clearly doing
something wrong, but I'm not really sure how else to proceed.  Any help in
clearing up my misunderstanding here would be greatly appreciated.

Thanks.

-- 
Drew Schmidt
National Institute for Computational Sciences
University of Tennessee


From r.d.morey at rug.nl  Wed Nov 21 21:57:17 2012
From: r.d.morey at rug.nl (Richard D. Morey)
Date: Wed, 21 Nov 2012 21:57:17 +0100
Subject: [Rd] paths and Rook problems only in OSX CRAN binary package?
Message-ID: <50AD402D.7090102@rug.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121121/7c213107/attachment.pl>

From atp at piskorski.com  Thu Nov 22 03:05:46 2012
From: atp at piskorski.com (Andrew Piskorski)
Date: Wed, 21 Nov 2012 21:05:46 -0500
Subject: [Rd] why does do_stop call R_GetTraceback ?
Message-ID: <20121122020546.GA93069@piskorski.com>

I'm using:
  R 2.15.1 (beta), 2012-06-11, svn.rev 59557, x86_64-unknown-linux-gnu
And I normally use:
  options("error"=recover)

I recently ran into a problem where when my code called stop(),
recover() was incredibly slow (hours) because it was trying to deparse
an extremely large call.  I worked around that by instead using my own
recover function which avoids deparsing anything large.  (Perhaps it
would be better to instead make the deparsing much faster, but I don't
know how to do that.)

However, now I find that when I'm DONE debugging and exit my recover
function, R still sits there using 100% cpu for another 41 seconds
before finishing and returning me to the top-level interactive prompt.
I wondered why...  Rprof() seems to say that all the time is being
taken in stop().

AFAICT, in this case stop() is basically just doing this:

  .Internal(stop(as.logical(TRUE), .makeMessage(..., domain=NULL)))

where the "..." is just the single string I passed to stop(), e.g.,
stop("This code is broken.").

So next, after exiting (my hacked version of) recover(), and while
stop() was still trying to finish up, I attached gdb to my R process.
I've appended the relevant part of the (long) backtrace below.

As you can see, R seems to have been busy calling R_GetTraceback() and
a bunch of subsidiary deparse functions.  But, at that point I'm done
with recover(), and when stop() finally finishes NOTHING else has been
printed out - no additional traceback, nothing.  So why are we calling
jump_to_top_ex() with traceback=TRUE, what good does the call to
R_GetTraceback() do?

That jump_to_top_ex() code only calls R_GetTraceback() when
R_Interactive or haveHandler are true.  I am certainly running
interactively here, and I did define a handler with options("error"=).
But AFAICT, my handler makes no use whatsoever of any of the work done
by R_GetTraceback().  In fact, I don't see any way it could even if I
wanted it to.  And if I remove my handler with options("error"=NULL),
I STILL get no additional "trace back" output at all.

So it looks to me as if calling jump_to_top_ex() with traceback=TRUE
and spending the extra 41 seconds in R_GetTraceback() NEVER does
anything useful!  Is this actually true, or does R_GetTraceback() have
some important side effect that I'm unaware of?

Thanks for your help!


(gdb) bt
#0  vector2buff (s=0xba73ed0, d=0x7fffa18d4a00)
    at ../../../src/main/deparse.c:1298
#1  deparse2buff (s=0xba73ed0, d=0x7fffa18d4a00)
    at ../../../src/main/deparse.c:1123
#2  0x00007ff28807034f in vec2buff (v=<value optimized out>, d=0x7fffa18d4a00)
    at ../../../src/main/deparse.c:1402
#3  0x00007ff28806ea20 in deparse2buff (s=0xba734d0, d=0x7fffa18d4a00)
    at ../../../src/main/deparse.c:753
#4  0x00007ff28807034f in vec2buff (v=<value optimized out>, d=0x7fffa18d4a00)
    at ../../../src/main/deparse.c:1402
#5  0x00007ff28806ea20 in deparse2buff (s=0xed9e350, d=0x7fffa18d4a00)
    at ../../../src/main/deparse.c:753
#6  0x00007ff28807034f in vec2buff (v=<value optimized out>, d=0x7fffa18d4a00)
    at ../../../src/main/deparse.c:1402
#7  0x00007ff28806ea20 in deparse2buff (s=0xed9c818, d=0x7fffa18d4a00)
    at ../../../src/main/deparse.c:753
#8  0x00007ff28806e40c in args2buff (arglist=0xd90b930, 
    lineb=<value optimized out>, formals=0, d=0x7fffa18d4a00)
    at ../../../src/main/deparse.c:1438
#9  0x00007ff28806e822 in deparse2buff (s=0xd90b8c0, d=0x7fffa18d4a00)
    at ../../../src/main/deparse.c:1108
#10 0x00007ff2880706f9 in deparse2 (call=<value optimized out>, abbrev=FALSE, 
    cutoff=<value optimized out>, backtick=<value optimized out>, opts=65, 
    nlines=-1) at ../../../src/main/deparse.c:484
#11 deparse1WithCutoff (call=<value optimized out>, abbrev=FALSE, 
    cutoff=<value optimized out>, backtick=<value optimized out>, opts=65, 
    nlines=-1) at ../../../src/main/deparse.c:221
#12 0x00007ff2880a07b5 in R_GetTraceback (skip=0)
    at ../../../src/main/errors.c:1312
#13 0x00007ff2880a347a in jump_to_top_ex (traceback=TRUE, 
    tryUserHandler=<value optimized out>, processWarnings=FALSE, 
    resetConsole=TRUE, ignoreRestartContexts=13368712)
    at ../../../src/main/errors.c:837
#14 0x00007ff2880a1ba9 in verrorcall_dflt (call=0x28ea1c0, 
    format=<value optimized out>, ap=<value optimized out>)
    at ../../../src/main/errors.c:663
#15 0x00007ff2880a239e in Rf_errorcall (call=<value optimized out>, 
    format=<value optimized out>) at ../../../src/main/errors.c:698
#16 0x00007ff2880a25c2 in do_stop (call=<value optimized out>, 
    op=<value optimized out>, args=0x10ecae78, rho=<value optimized out>)
    at ../../../src/main/errors.c:1095
[...]
#79 0x0000000000400819 in _start ()

-- 
Andrew Piskorski <atp at piskorski.com>


From mauricio.zambrano at jrc.ec.europa.eu  Thu Nov 22 17:28:18 2012
From: mauricio.zambrano at jrc.ec.europa.eu (Mauricio Zambrano-Bigiarini)
Date: Thu, 22 Nov 2012 17:28:18 +0100
Subject: [Rd] BibTeX entries in CITATION file
Message-ID: <50AE52A2.2030605@jrc.ec.europa.eu>

Dear List,

While trying to define a customised CITATION file for a package, 
following R-exts, I realised that if I use only one 'citEntry' I got 
both a text description and a BibTex entry for the package, as for the 
'nlme' package:

--------------------------
citation('nlme')

To cite package 'nlme' in publications use:

   Jose Pinheiro, Douglas Bates, Saikat DebRoy, Deepayan Sarkar and the
   R Development Core Team (2012). nlme: Linear and Nonlinear Mixed
   Effects Models. R package version 3.1-105.

A BibTeX entry for LaTeX users is

   @Manual{,
     title = {nlme: Linear and Nonlinear Mixed Effects Models},
     author = {Jose Pinheiro and Douglas Bates and Saikat DebRoy and 
Deepayan Sarkar and {R Core Team}},
     year = {2012},
     note = {R package version 3.1-105},
   }

-----------------------------------


BUT, if I use two or more 'citEntry' in the CITATION file (e.g., for the 
manual and a book), the bibTeX entries are NOT shown any more, and only 
the text description for the two or more entries are shown, as for the 
'boot' package:

-----------------------------------
citation('boot')

To cite the 'boot' package in publications use:

   Angelo Canty and Brian Ripley (2012). boot: Bootstrap R (S-Plus)
   Functions. R package version 1.3-7.

   Davison, A. C. & Hinkley, D. V. (1997) Bootstrap Methods and Their
   Applications. Cambridge University Press, Cambridge. ISBN
   0-521-57391-2
-----------------------------------

Is there any way to show the two bib entries for cases similar to the 
'boot' package ?


sessionInfo()
R version 2.15.2 (2012-10-26)
Platform: x86_64-redhat-linux-gnu (64-bit)

locale:
  [1] LC_CTYPE=en_GB.utf8       LC_NUMERIC=C
  [3] LC_TIME=en_GB.utf8        LC_COLLATE=en_GB.utf8
  [5] LC_MONETARY=en_GB.utf8    LC_MESSAGES=en_GB.utf8
  [7] LC_PAPER=C                LC_NAME=C
  [9] LC_ADDRESS=C              LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_GB.utf8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base



Thanks in advance,

Mauricio Zambrano-Bigiarini

-- 
=================================================
Water Resources Unit
Institute for Environment and Sustainability (IES)
Joint Research Centre (JRC), European Commission
TP 261, Via Enrico Fermi 2749, 21027 Ispra (VA), IT
webinfo    : http://floods.jrc.ec.europa.eu/
=================================================
DISCLAIMER:\ "The views expressed are purely those of th...{{dropped:11}}


From murdoch.duncan at gmail.com  Thu Nov 22 17:36:42 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 22 Nov 2012 11:36:42 -0500
Subject: [Rd] BibTeX entries in CITATION file
In-Reply-To: <50AE52A2.2030605@jrc.ec.europa.eu>
References: <50AE52A2.2030605@jrc.ec.europa.eu>
Message-ID: <50AE549A.8080004@gmail.com>

On 22/11/2012 11:28 AM, Mauricio Zambrano-Bigiarini wrote:
> Dear List,
>
> While trying to define a customised CITATION file for a package,
> following R-exts, I realised that if I use only one 'citEntry' I got
> both a text description and a BibTex entry for the package, as for the
> 'nlme' package:
>
> --------------------------
> citation('nlme')
>
> To cite package 'nlme' in publications use:
>
>     Jose Pinheiro, Douglas Bates, Saikat DebRoy, Deepayan Sarkar and the
>     R Development Core Team (2012). nlme: Linear and Nonlinear Mixed
>     Effects Models. R package version 3.1-105.
>
> A BibTeX entry for LaTeX users is
>
>     @Manual{,
>       title = {nlme: Linear and Nonlinear Mixed Effects Models},
>       author = {Jose Pinheiro and Douglas Bates and Saikat DebRoy and
> Deepayan Sarkar and {R Core Team}},
>       year = {2012},
>       note = {R package version 3.1-105},
>     }
>
> -----------------------------------
>
>
> BUT, if I use two or more 'citEntry' in the CITATION file (e.g., for the
> manual and a book), the bibTeX entries are NOT shown any more, and only
> the text description for the two or more entries are shown, as for the
> 'boot' package:
>
> -----------------------------------
> citation('boot')
>
> To cite the 'boot' package in publications use:
>
>     Angelo Canty and Brian Ripley (2012). boot: Bootstrap R (S-Plus)
>     Functions. R package version 1.3-7.
>
>     Davison, A. C. & Hinkley, D. V. (1997) Bootstrap Methods and Their
>     Applications. Cambridge University Press, Cambridge. ISBN
>     0-521-57391-2
> -----------------------------------
>
> Is there any way to show the two bib entries for cases similar to the
> 'boot' package ?

toBibtex(citation("boot"))

should do it.


From Achim.Zeileis at uibk.ac.at  Thu Nov 22 17:35:36 2012
From: Achim.Zeileis at uibk.ac.at (Achim Zeileis)
Date: Thu, 22 Nov 2012 17:35:36 +0100 (CET)
Subject: [Rd] BibTeX entries in CITATION file
In-Reply-To: <50AE52A2.2030605@jrc.ec.europa.eu>
References: <50AE52A2.2030605@jrc.ec.europa.eu>
Message-ID: <alpine.DEB.2.02.1211221734070.17003@paninaro.uibk.ac.at>

On Thu, 22 Nov 2012, Mauricio Zambrano-Bigiarini wrote:

> Dear List,
>
> While trying to define a customised CITATION file for a package, following 
> R-exts, I realised that if I use only one 'citEntry' I got both a text 
> description and a BibTex entry for the package, as for the 'nlme' package:
>
> --------------------------
> citation('nlme')
>
> To cite package 'nlme' in publications use:
>
>  Jose Pinheiro, Douglas Bates, Saikat DebRoy, Deepayan Sarkar and the
>  R Development Core Team (2012). nlme: Linear and Nonlinear Mixed
>  Effects Models. R package version 3.1-105.
>
> A BibTeX entry for LaTeX users is
>
>  @Manual{,
>    title = {nlme: Linear and Nonlinear Mixed Effects Models},
>    author = {Jose Pinheiro and Douglas Bates and Saikat DebRoy and Deepayan 
> Sarkar and {R Core Team}},
>    year = {2012},
>    note = {R package version 3.1-105},
>  }
>
> -----------------------------------
>
>
> BUT, if I use two or more 'citEntry' in the CITATION file (e.g., for the 
> manual and a book), the bibTeX entries are NOT shown any more, and only the 
> text description for the two or more entries are shown, as for the 'boot' 
> package:
>
> -----------------------------------
> citation('boot')
>
> To cite the 'boot' package in publications use:
>
>  Angelo Canty and Brian Ripley (2012). boot: Bootstrap R (S-Plus)
>  Functions. R package version 1.3-7.
>
>  Davison, A. C. & Hinkley, D. V. (1997) Bootstrap Methods and Their
>  Applications. Cambridge University Press, Cambridge. ISBN
>  0-521-57391-2
> -----------------------------------
>
> Is there any way to show the two bib entries for cases similar to the 'boot' 
> package ?

toBibtex(citation("boot"))

extracts the two BibTeX entries.

See also

Kurt Hornik, Duncan Murdoch, Achim Zeileis (2012).
Who Did What? The Roles of R Package Authors and How to Refer to Them.
The R Journal, 4(1), 64-69.
http://journal.r-project.org/archive/2012-1/RJournal_2012-1_Hornik~et~al.pdf

for more details and discussion about the underlying ideas.

Best,
Z

>
> sessionInfo()
> R version 2.15.2 (2012-10-26)
> Platform: x86_64-redhat-linux-gnu (64-bit)
>
> locale:
> [1] LC_CTYPE=en_GB.utf8       LC_NUMERIC=C
> [3] LC_TIME=en_GB.utf8        LC_COLLATE=en_GB.utf8
> [5] LC_MONETARY=en_GB.utf8    LC_MESSAGES=en_GB.utf8
> [7] LC_PAPER=C                LC_NAME=C
> [9] LC_ADDRESS=C              LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_GB.utf8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
>
>
> Thanks in advance,
>
> Mauricio Zambrano-Bigiarini
>
> -- 
> =================================================
> Water Resources Unit
> Institute for Environment and Sustainability (IES)
> Joint Research Centre (JRC), European Commission
> TP 261, Via Enrico Fermi 2749, 21027 Ispra (VA), IT
> webinfo    : http://floods.jrc.ec.europa.eu/
> =================================================
> DISCLAIMER:\ "The views expressed are purely those of th...{{dropped:11}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From mauricio.zambrano at jrc.ec.europa.eu  Thu Nov 22 18:13:21 2012
From: mauricio.zambrano at jrc.ec.europa.eu (Mauricio Zambrano-Bigiarini)
Date: Thu, 22 Nov 2012 18:13:21 +0100
Subject: [Rd] BibTeX entries in CITATION file
In-Reply-To: <50AE549A.8080004@gmail.com>
References: <50AE52A2.2030605@jrc.ec.europa.eu> <50AE549A.8080004@gmail.com>
Message-ID: <50AE5D31.6060700@jrc.ec.europa.eu>

On 22/11/12 17:36, Duncan Murdoch wrote:
> On 22/11/2012 11:28 AM, Mauricio Zambrano-Bigiarini wrote:
>> Dear List,
>>
>> While trying to define a customised CITATION file for a package,
>> following R-exts, I realised that if I use only one 'citEntry' I got
>> both a text description and a BibTex entry for the package, as for the
>> 'nlme' package:
>>
>> --------------------------
>> citation('nlme')
>>
>> To cite package 'nlme' in publications use:
>>
>> Jose Pinheiro, Douglas Bates, Saikat DebRoy, Deepayan Sarkar and the
>> R Development Core Team (2012). nlme: Linear and Nonlinear Mixed
>> Effects Models. R package version 3.1-105.
>>
>> A BibTeX entry for LaTeX users is
>>
>> @Manual{,
>> title = {nlme: Linear and Nonlinear Mixed Effects Models},
>> author = {Jose Pinheiro and Douglas Bates and Saikat DebRoy and
>> Deepayan Sarkar and {R Core Team}},
>> year = {2012},
>> note = {R package version 3.1-105},
>> }
>>
>> -----------------------------------
>>
>>
>> BUT, if I use two or more 'citEntry' in the CITATION file (e.g., for the
>> manual and a book), the bibTeX entries are NOT shown any more, and only
>> the text description for the two or more entries are shown, as for the
>> 'boot' package:
>>
>> -----------------------------------
>> citation('boot')
>>
>> To cite the 'boot' package in publications use:
>>
>> Angelo Canty and Brian Ripley (2012). boot: Bootstrap R (S-Plus)
>> Functions. R package version 1.3-7.
>>
>> Davison, A. C. & Hinkley, D. V. (1997) Bootstrap Methods and Their
>> Applications. Cambridge University Press, Cambridge. ISBN
>> 0-521-57391-2
>> -----------------------------------
>>
>> Is there any way to show the two bib entries for cases similar to the
>> 'boot' package ?
>
> toBibtex(citation("boot"))
>
> should do it.
>


Thank you very much Achim and Duncan.

However, I was not clear enough. My question is if there is any way in 
which I should modify the CITATION file of my package in order to show 
the two or more bib entries automatically. For example, when you type:

citation("boot")

my expected output is something like:

------------
To cite the 'boot' package in publications use:

  Angelo Canty and Brian Ripley (2012). boot: Bootstrap R (S-Plus)
  Functions. R package version 1.3-7.

  Davison, A. C. & Hinkley, D. V. (1997) Bootstrap Methods and Their
  Applications. Cambridge University Press, Cambridge. ISBN
  0-521-57391-2

  BibTeX entries for for LaTeX users are:

....
....

----------------

Is there any way in which I can achieve this ?


Mauricio
-- 
=================================================
Linux user #454569 -- Ubuntu user #17469
=================================================
"It is a mistake to look too far ahead. Only one
link in the chain of destiny can be handled at a time"
(Sir Winston Churchill)


From Achim.Zeileis at uibk.ac.at  Thu Nov 22 18:23:38 2012
From: Achim.Zeileis at uibk.ac.at (Achim Zeileis)
Date: Thu, 22 Nov 2012 18:23:38 +0100 (CET)
Subject: [Rd] BibTeX entries in CITATION file
In-Reply-To: <50AE5D31.6060700@jrc.ec.europa.eu>
References: <50AE52A2.2030605@jrc.ec.europa.eu> <50AE549A.8080004@gmail.com>
	<50AE5D31.6060700@jrc.ec.europa.eu>
Message-ID: <alpine.DEB.2.02.1211221821430.17003@paninaro.uibk.ac.at>

On Thu, 22 Nov 2012, Mauricio Zambrano-Bigiarini wrote:

> On 22/11/12 17:36, Duncan Murdoch wrote:
>> On 22/11/2012 11:28 AM, Mauricio Zambrano-Bigiarini wrote:
>>> Dear List,
>>> 
>>> While trying to define a customised CITATION file for a package,
>>> following R-exts, I realised that if I use only one 'citEntry' I got
>>> both a text description and a BibTex entry for the package, as for the
>>> 'nlme' package:
>>> 
>>> --------------------------
>>> citation('nlme')
>>> 
>>> To cite package 'nlme' in publications use:
>>> 
>>> Jose Pinheiro, Douglas Bates, Saikat DebRoy, Deepayan Sarkar and the
>>> R Development Core Team (2012). nlme: Linear and Nonlinear Mixed
>>> Effects Models. R package version 3.1-105.
>>> 
>>> A BibTeX entry for LaTeX users is
>>> 
>>> @Manual{,
>>> title = {nlme: Linear and Nonlinear Mixed Effects Models},
>>> author = {Jose Pinheiro and Douglas Bates and Saikat DebRoy and
>>> Deepayan Sarkar and {R Core Team}},
>>> year = {2012},
>>> note = {R package version 3.1-105},
>>> }
>>> 
>>> -----------------------------------
>>> 
>>> 
>>> BUT, if I use two or more 'citEntry' in the CITATION file (e.g., for the
>>> manual and a book), the bibTeX entries are NOT shown any more, and only
>>> the text description for the two or more entries are shown, as for the
>>> 'boot' package:
>>> 
>>> -----------------------------------
>>> citation('boot')
>>> 
>>> To cite the 'boot' package in publications use:
>>> 
>>> Angelo Canty and Brian Ripley (2012). boot: Bootstrap R (S-Plus)
>>> Functions. R package version 1.3-7.
>>> 
>>> Davison, A. C. & Hinkley, D. V. (1997) Bootstrap Methods and Their
>>> Applications. Cambridge University Press, Cambridge. ISBN
>>> 0-521-57391-2
>>> -----------------------------------
>>> 
>>> Is there any way to show the two bib entries for cases similar to the
>>> 'boot' package ?
>> 
>> toBibtex(citation("boot"))
>> 
>> should do it.
>> 
>
>
> Thank you very much Achim and Duncan.
>
> However, I was not clear enough. My question is if there is any way in which 
> I should modify the CITATION file of my package in order to show the two or 
> more bib entries automatically. For example, when you type:
>
> citation("boot")
>
> my expected output is something like:
>
> ------------
> To cite the 'boot' package in publications use:
>
> Angelo Canty and Brian Ripley (2012). boot: Bootstrap R (S-Plus)
> Functions. R package version 1.3-7.
>
> Davison, A. C. & Hinkley, D. V. (1997) Bootstrap Methods and Their
> Applications. Cambridge University Press, Cambridge. ISBN
> 0-521-57391-2
>
> BibTeX entries for for LaTeX users are:
>
> ....
> ....
>
> ----------------
>
> Is there any way in which I can achieve this ?

No, this is currently not possible. format.bibentry() always omits the 
BibTeX if there are 2 or more entries (in style = "citation").

The CRAN web page for the package always displays all BibTeX entries 
though: http://CRAN.R-project.org/web/packages/boot/citation.html

>
> Mauricio
> -- 
> =================================================
> Linux user #454569 -- Ubuntu user #17469
> =================================================
> "It is a mistake to look too far ahead. Only one
> link in the chain of destiny can be handled at a time"
> (Sir Winston Churchill)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From mauricio.zambrano at jrc.ec.europa.eu  Fri Nov 23 09:01:14 2012
From: mauricio.zambrano at jrc.ec.europa.eu (Mauricio Zambrano-Bigiarini)
Date: Fri, 23 Nov 2012 09:01:14 +0100
Subject: [Rd] BibTeX entries in CITATION file
In-Reply-To: <alpine.DEB.2.02.1211221821430.17003@paninaro.uibk.ac.at>
References: <50AE52A2.2030605@jrc.ec.europa.eu> <50AE549A.8080004@gmail.com>
	<50AE5D31.6060700@jrc.ec.europa.eu>
	<alpine.DEB.2.02.1211221821430.17003@paninaro.uibk.ac.at>
Message-ID: <50AF2D4A.5030405@jrc.ec.europa.eu>

On 22/11/12 18:23, Achim Zeileis wrote:
> On Thu, 22 Nov 2012, Mauricio Zambrano-Bigiarini wrote:
>
>> On 22/11/12 17:36, Duncan Murdoch wrote:
>>> On 22/11/2012 11:28 AM, Mauricio Zambrano-Bigiarini wrote:
>>>> Dear List,
>>>>
>>>> While trying to define a customised CITATION file for a package,
>>>> following R-exts, I realised that if I use only one 'citEntry' I got
>>>> both a text description and a BibTex entry for the package, as for the
>>>> 'nlme' package:
>>>>
>>>> --------------------------
>>>> citation('nlme')
>>>>
>>>> To cite package 'nlme' in publications use:
>>>>
>>>> Jose Pinheiro, Douglas Bates, Saikat DebRoy, Deepayan Sarkar and the
>>>> R Development Core Team (2012). nlme: Linear and Nonlinear Mixed
>>>> Effects Models. R package version 3.1-105.
>>>>
>>>> A BibTeX entry for LaTeX users is
>>>>
>>>> @Manual{,
>>>> title = {nlme: Linear and Nonlinear Mixed Effects Models},
>>>> author = {Jose Pinheiro and Douglas Bates and Saikat DebRoy and
>>>> Deepayan Sarkar and {R Core Team}},
>>>> year = {2012},
>>>> note = {R package version 3.1-105},
>>>> }
>>>>
>>>> -----------------------------------
>>>>
>>>>
>>>> BUT, if I use two or more 'citEntry' in the CITATION file (e.g., for
>>>> the
>>>> manual and a book), the bibTeX entries are NOT shown any more, and only
>>>> the text description for the two or more entries are shown, as for the
>>>> 'boot' package:
>>>>
>>>> -----------------------------------
>>>> citation('boot')
>>>>
>>>> To cite the 'boot' package in publications use:
>>>>
>>>> Angelo Canty and Brian Ripley (2012). boot: Bootstrap R (S-Plus)
>>>> Functions. R package version 1.3-7.
>>>>
>>>> Davison, A. C. & Hinkley, D. V. (1997) Bootstrap Methods and Their
>>>> Applications. Cambridge University Press, Cambridge. ISBN
>>>> 0-521-57391-2
>>>> -----------------------------------
>>>>
>>>> Is there any way to show the two bib entries for cases similar to the
>>>> 'boot' package ?
>>>
>>> toBibtex(citation("boot"))
>>>
>>> should do it.
>>>
>>
>>
>> Thank you very much Achim and Duncan.
>>
>> However, I was not clear enough. My question is if there is any way in
>> which I should modify the CITATION file of my package in order to show
>> the two or more bib entries automatically. For example, when you type:
>>
>> citation("boot")
>>
>> my expected output is something like:
>>
>> ------------
>> To cite the 'boot' package in publications use:
>>
>> Angelo Canty and Brian Ripley (2012). boot: Bootstrap R (S-Plus)
>> Functions. R package version 1.3-7.
>>
>> Davison, A. C. & Hinkley, D. V. (1997) Bootstrap Methods and Their
>> Applications. Cambridge University Press, Cambridge. ISBN
>> 0-521-57391-2
>>
>> BibTeX entries for for LaTeX users are:
>>
>> ....
>> ....
>>
>> ----------------
>>
>> Is there any way in which I can achieve this ?
>
> No, this is currently not possible. format.bibentry() always omits the
> BibTeX if there are 2 or more entries (in style = "citation").
>
> The CRAN web page for the package always displays all BibTeX entries
> though: http://CRAN.R-project.org/web/packages/boot/citation.html
>

Thanks !

All the best,

Mauricio
>>
>> Mauricio
>> --
>> =================================================
>> Linux user #454569 -- Ubuntu user #17469
>> =================================================
>> "It is a mistake to look too far ahead. Only one
>> link in the chain of destiny can be handled at a time"
>> (Sir Winston Churchill)
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From edd at debian.org  Sun Nov 25 22:57:44 2012
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sun, 25 Nov 2012 15:57:44 -0600
Subject: [Rd] Option to set permissions on directories and files after
	package installation
Message-ID: <20658.37976.821700.411018@max.nulle.part>


The R package on Debian (and hence Ubuntu) has had a default for close to a
decade to install into /usr/local/R/site-library/. This came from a
suggestion by Kurt and Fritz, and I still think of it as rather useful.

To me, this suggests multiuser mode, preferably without sudo.  One can get
close via group membership on the directory, but ultimate this always fails
because tools:::.install_packages() insists on putting 0644 / 0755 modes on
everything as seen from the following selection from that function:


                ## not clear if this is still necessary, but sh version did so
                if (!WINDOWS) Sys.chmod(file.path(dest, files), "755")


                if (file.exists(f)) {
                    file.copy(f, instdir, TRUE)
                    Sys.chmod(file.path(instdir, f), "644")
                }


		Sys.chmod(Sys.glob(file.path(instdir, "data", "*")), "644")


	    Sys.chmod(Sys.glob(file.path(instdir, "demo", "*")), "644")


                    Sys.chmod(Sys.glob(file.path(instdir, "exec", "*")), "755")


                Sys.chmod(i2_files[execs], "755")


I would like to have the option of haveing the effect of setting umask 0002
so that people in my group can replace packages.   The simplest may be to
replace "644"/"755" with "664"/"775" is a suitable option is set. More
involved schemes are of course possible too.

Naturally, I would be happy to work on patch if there was any indication that
the patch would be reviewed and possibly included.  

With that: comments, please. Is this seen as sensible or deemed nutty and
off-limits?

Thanks, Dirk

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From gregory.warnes at novartis.com  Mon Nov 26 00:13:32 2012
From: gregory.warnes at novartis.com (Warnes, Gregory)
Date: Sun, 25 Nov 2012 23:13:32 +0000
Subject: [Rd] Option to set permissions on directories and files after
 package installation
In-Reply-To: <20658.37976.821700.411018@max.nulle.part>
Message-ID: <0CAEE2B1235DF643B0F5E1EAE1487B5309545D7B@023-CH1MPN1-042.023d.mgd.msft.net>

I second the request to allow specification of the permissions to use when
installing packages, preferably controllable via a site-wide configuration
file.



On 11/25/12 4:57 PM, "Dirk Eddelbuettel" <edd at debian.org> wrote:

>
>The R package on Debian (and hence Ubuntu) has had a default for close to
>a
>decade to install into /usr/local/R/site-library/. This came from a
>suggestion by Kurt and Fritz, and I still think of it as rather useful.
>
>To me, this suggests multiuser mode, preferably without sudo.  One can get
>close via group membership on the directory, but ultimate this always
>fails
>because tools:::.install_packages() insists on putting 0644 / 0755 modes
>on
>everything as seen from the following selection from that function:
>
>
>                ## not clear if this is still necessary, but sh version
>did so
>                if (!WINDOWS) Sys.chmod(file.path(dest, files), "755")
>
>
>                if (file.exists(f)) {
>                    file.copy(f, instdir, TRUE)
>                    Sys.chmod(file.path(instdir, f), "644")
>                }
>
>
>		Sys.chmod(Sys.glob(file.path(instdir, "data", "*")), "644")
>
>
>	    Sys.chmod(Sys.glob(file.path(instdir, "demo", "*")), "644")
>
>
>                    Sys.chmod(Sys.glob(file.path(instdir, "exec", "*")),
>"755")
>
>
>                Sys.chmod(i2_files[execs], "755")
>
>
>I would like to have the option of haveing the effect of setting umask
>0002
>so that people in my group can replace packages.   The simplest may be to
>replace "644"/"755" with "664"/"775" is a suitable option is set. More
>involved schemes are of course possible too.
>
>Naturally, I would be happy to work on patch if there was any indication
>that
>the patch would be reviewed and possibly included.
>
>With that: comments, please. Is this seen as sensible or deemed nutty and
>off-limits?
>
>Thanks, Dirk
>
>-- 
>Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel


From kasperdanielhansen at gmail.com  Mon Nov 26 00:14:50 2012
From: kasperdanielhansen at gmail.com (Kasper Daniel Hansen)
Date: Sun, 25 Nov 2012 18:14:50 -0500
Subject: [Rd] Option to set permissions on directories and files after
 package installation
In-Reply-To: <20658.37976.821700.411018@max.nulle.part>
References: <20658.37976.821700.411018@max.nulle.part>
Message-ID: <CAC2h7uu3_rYi0_qdxEPqkOYT-D-txHKJTybQ5GxD5iVDXYGgpA@mail.gmail.com>

I use this all the time for similar reasons (but not on debian).  I
currently post-process with chmod and chown.  I support this request,
and I would be happy if the owner could be set as well.

Best,
Kasper

On Sun, Nov 25, 2012 at 4:57 PM, Dirk Eddelbuettel <edd at debian.org> wrote:
>
> The R package on Debian (and hence Ubuntu) has had a default for close to a
> decade to install into /usr/local/R/site-library/. This came from a
> suggestion by Kurt and Fritz, and I still think of it as rather useful.
>
> To me, this suggests multiuser mode, preferably without sudo.  One can get
> close via group membership on the directory, but ultimate this always fails
> because tools:::.install_packages() insists on putting 0644 / 0755 modes on
> everything as seen from the following selection from that function:
>
>
>                 ## not clear if this is still necessary, but sh version did so
>                 if (!WINDOWS) Sys.chmod(file.path(dest, files), "755")
>
>
>                 if (file.exists(f)) {
>                     file.copy(f, instdir, TRUE)
>                     Sys.chmod(file.path(instdir, f), "644")
>                 }
>
>
>                 Sys.chmod(Sys.glob(file.path(instdir, "data", "*")), "644")
>
>
>             Sys.chmod(Sys.glob(file.path(instdir, "demo", "*")), "644")
>
>
>                     Sys.chmod(Sys.glob(file.path(instdir, "exec", "*")), "755")
>
>
>                 Sys.chmod(i2_files[execs], "755")
>
>
> I would like to have the option of haveing the effect of setting umask 0002
> so that people in my group can replace packages.   The simplest may be to
> replace "644"/"755" with "664"/"775" is a suitable option is set. More
> involved schemes are of course possible too.
>
> Naturally, I would be happy to work on patch if there was any indication that
> the patch would be reviewed and possibly included.
>
> With that: comments, please. Is this seen as sensible or deemed nutty and
> off-limits?
>
> Thanks, Dirk
>
> --
> Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ustaudinger at activequant.com  Mon Nov 26 09:21:46 2012
From: ustaudinger at activequant.com (Ulrich Staudinger)
Date: Mon, 26 Nov 2012 09:21:46 +0100
Subject: [Rd] Sighandlers
In-Reply-To: <50A8EDE6.7080005@stats.ox.ac.uk>
References: <CAMrz3D0MNwuiYRiqGWOh8AAT6rcdAbppi9BDZ9EvqqDiSdQ8_Q@mail.gmail.com>
	<50A8EDE6.7080005@stats.ox.ac.uk>
Message-ID: <CAMrz3D210akMXL--4osYXQsSz59F9EzZBMLrwGafT-7gw00HSA@mail.gmail.com>

Hello there,

On Sun, Nov 18, 2012 at 3:17 PM, Prof Brian Ripley
<ripley at stats.ox.ac.uk> wrote:
> R has its own signal handlers, including for SIGINT.
>
> What is your 'extension'?   If it is a program embedding R, the order of
> setting signal handlers will matter, and in any case R's handler if ever
> called it will reset the handler to itself.

The extension does open a socket connection to some distant server. It
serves as a data buffer, from where the R-main thread may poll data.

> If it is a package, it should not be messing with the process into which it
> is loaded.

This is entirely clear.

In this particular case, I used fork() to fork off a new process. For
obvious reasons, this process stayed alive beyond the R-session.  In
other words, I terminated R and my forked off process continued
running. The natural approach would be to register a sighandler and
get notified about R's termination, so that the afore mentioned
buffering process may terminate gracefuly, too.

I solved it by using pthreads rather than fork(), as the pthread is
attached to a parent process and will terminate with it.

>
> On 17/11/2012 15:56, Ulrich Staudinger wrote:
>>
>> Hello everyone,
>>
>> I am searching and searching and can't find an answer.
>
>
> Did you search the source code?

That's a bit beyond me at the moment.


Thanks,
Ulrich






-- 
Ulrich Staudinger

P: +41 79 702 05 95
E: ustaudinger at activequant.com

http://www.activequant.com
Connect online: https://www.xing.com/profile/Ulrich_Staudinger


From simon.urbanek at r-project.org  Mon Nov 26 15:37:41 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 26 Nov 2012 09:37:41 -0500
Subject: [Rd] paths and Rook problems only in OSX CRAN binary package?
In-Reply-To: <50AD402D.7090102@rug.nl>
References: <50AD402D.7090102@rug.nl>
Message-ID: <725AC3E4-3A00-4428-A66B-F1F59BA94CFF@r-project.org>

Richard,

I was away hence a late response.

The problem is that you are creating aovApp directly at compile time, so it will hard-code the root path as the initialized object is lazy-loaded. This means that the package will only work in the library that it was complied into, it won't work anywhere else and thus it cannot be distributed as a binary package.

There are many possible fixes, probably the easiest is to simply make aovApp a function so the actual objects won't be lazy-loaded:

diff -ru BayesFactor/R/aovRook.R BayesFactor-fix/R/aovRook.R
--- BayesFactor/R/aovRook.R	2012-11-23 16:54:06.000000000 -0500
+++ BayesFactor-fix/R/aovRook.R	2012-11-26 09:32:48.000000000 -0500
@@ -119,7 +119,7 @@
     rookEnv$aov$s <- Rhttpd$new()
     rookEnv$aov$s$start(quiet=TRUE)
     rookEnv$aov$s$add(name="aov",
-          app=aovApp)
+          app=aovApp())
   }
   rookEnv$aov$s$browse("aov")
 }
@@ -262,7 +262,7 @@
   }
 }
 
-aovApp <- Builder$new(
+aovApp <- function() Builder$new(
   Static$new(
     urls = '/www',
     root = system.file('.', package='BayesFactor')


Cheers,
Simon


On Nov 21, 2012, at 3:57 PM, Richard D. Morey wrote:

> Hi everyone,
> 
> I'm trying to diagnose a problem in my R package, but it is a little tricky since it seems to occur only with the Mac OSX CRAN binary build.
> 
> My package starts a Rook server and opens a browser. On my own system (details below), when I build the package, I have no trouble. The Rook server starts and the page loads in the browser. 
> 
> However, if I've installed it from CRAN, I get the following error when trying to open my Rook interface:
> 
> ######
> Warning message:
> In normalizePath(file.path(root, path_info)) :
> 
> path[1]="/Volumes/XT3/Rdev-web/QA/Simon/packages/leopard-universal/Rlib/2.15/BayesFactor/.//www/warning.html":
> No such file or directory
> ######
> 
> I assume "Simon" refers to Simon Urbanek.
>  
> www/warning.html is the file Rook is attempting to open. This looks like a path from the CRAN build machine. How did this make it into my package? I'm sort of baffled, and I don't know how to diagnose it. 
> 
> To replicate:
> #########
> install.packages('BayesFactor')
> library(BayesFactor)
> data(puzzles)
> aovGUI(y = puzzles$RT, dataFixed = puzzles[,3:4], dataRandom = puzzles$ID)
> #########
> 
> When I set 
> options(warning.expression = quote(recover()))
> 
> I see where the problem lies. In the frame "15: file_server$call(env)", the variable "root" is defined as:
> 
> Browse[1]> root
> [1] "/Volumes/XT3/Rdev-web/QA/Simon/packages/leopard-universal/Rlib/2.15/BayesFactor/."
> 
> But "find" returns nothing for "root":
> Browse[1]> find("root")
> character(0)
> 
> In the Rook source here (https://github.com/jeffreyhorner/Rook/blob/master/Rook/R/File.R) is the reference to "root", but I'm not sure where the specific path value comes from.
> 
> Further information:
> > sessionInfo()
> R version 2.15.2 (2012-10-26)
> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
> 
> locale:
> [1] en_AU.UTF-8/en_AU.UTF-8/en_AU.UTF-8/C/en_AU.UTF-8/en_AU.UTF-8
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base     
> 
> loaded via a namespace (and not attached):
> [1] tools_2.15.2
> 
> 
> My Rook version is 1.0-8 and I'm running Mountain Lion (10.8.2). Any hints would be appreciated.
> 
> Best,
> Richard
> 
> 


From florian.burkart at gmail.com  Tue Nov 27 13:53:47 2012
From: florian.burkart at gmail.com (Florian Burkart)
Date: Tue, 27 Nov 2012 12:53:47 +0000
Subject: [Rd] Problems with MinGW and boost on Windows
Message-ID: <CAPSN_LWkjENv1Y4dSxG-73yGhTfYuewScwgKKEeUjbWp97jDfw@mail.gmail.com>

Hi,

I am not sure how widespread this problem is, but definitely occurs for me
on 64 bit Win 7 with a 64 bit R.

I think I have isolated the issue (to a certain extent) in the attached
Test.cpp file. Basically, I think linking with boost serialization is
causing the plugin to fail.

If I compile Test.cpp with line 43 (Dummy* Read() ...) commented out, I get
the expected output in R:

>
dyn.load("../MinGW/Debug64/Tester.dll",DLLpath="C:/Sys/boost/MinGW64/boost_1_50_0/lib")
Hello World.
> .Call("add",c(1,3))
[1] 4
> is.loaded("add")
[1] TRUE

However, if line 43 is uncommented, the output changes to

>
dyn.load("../MinGW/Debug64/Tester.dll",DLLpath="C:/Sys/boost/MinGW64/boost_1_50_0/lib")
Hello World.
> .Call("add",c(1,3))
Error in .Call("add", c(1, 3)) : C symbol name "add" not in load table
> is.loaded("add")
[1] FALSE

I am not sure what exactly is going wrong. This happens both if I link to
boost serialization statically or dynamically.

This is on R version R-2.15.1, and both boost serialization libraries and
the plugin are built with the gcc (4.6.3 20111208 prerelease) and make.exe
provided by RTools (Collection 2.16.0.1923) using the -m64 flag.

Build command was
g++  -c  "Test.cpp" -g -std=gnu++0x -m64 -O1 -DDEBUG  -o
obj/Debug64/Tester/Trunk_Test.o -I. -I/R/R-2.15.1/include
-I/R/R-2.15.1/library/Rcpp/include -I/Sys/boost/boost_1_50_0
g++ -shared -fPIC -o Debug64/Tester.dll @"MinGW\Tester.txt" -L.
-L/R/R-2.15.1/library/Rcpp/lib/x64 -L/R/R-2.15.1/bin/x64
-L/Sys/boost/MinGW64/boost_1_50_0/lib -LDebug64  -lRcpp -lR
 -lboost_serialization-mgw46-mt-d-1_50 -lboost_system-mgw46-mt-d-1_50
-Wl,--out-implib="Debug64/libTester.a" -m64

And for boost:
b2.exe --prefix=c:\Sys\boost\MinGW64\boost_1_50_0 toolset=gcc
address-model=64 link=static,shared -s BZIP2_SOURCE=C:\Sys\bzip2-1.0.6 -s
ZLIB_SOURCE=C:\Sys\zlib-1.2.7 install

Also note that this works fine on linux (Ubuntu).

I have been struggling to get past this for several weeks now... any help
would be greatly appreciated.

Thanks,
Florian

From florian.burkart at gmail.com  Tue Nov 27 19:01:33 2012
From: florian.burkart at gmail.com (Florian Burkart)
Date: Tue, 27 Nov 2012 18:01:33 +0000
Subject: [Rd] Problems with MinGW and boost on Windows
In-Reply-To: <CAPSN_LWkjENv1Y4dSxG-73yGhTfYuewScwgKKEeUjbWp97jDfw@mail.gmail.com>
References: <CAPSN_LWkjENv1Y4dSxG-73yGhTfYuewScwgKKEeUjbWp97jDfw@mail.gmail.com>
Message-ID: <CAPSN_LVtBXwWFC4xpttJ93x=J9n2WXftC-8Bi2SdAnbA7B-uQw@mail.gmail.com>

Sorry, didn't realize text attachments get stripped as well... here is
a link: http://pastebin.com/T3XhsjDY, and for the archives the actual
text

#define WIN32_LEAN_AND_MEAN
#define NOMINMAX 1
#define _WIN32_WINNT 0x0601
#define NTDDI_VERSION 0x06010000
#define _MSC_VER_WINNT _MSC_VER_WINNT_WIN7

#include <Rcpp.h>
#include <boost/archive/binary_iarchive.hpp>
#include <boost/filesystem.hpp>

struct World {
World() { Rprintf("Hello World.\n"); }
~World() { Rprintf("Goodbye World.\n"); }
};
World myWorld;

extern "C" {
SEXP add(SEXP symName);
}

SEXP add( SEXP x )
{
Rcpp::NumericVector xx(x);
return Rcpp::wrap( std::accumulate( xx.begin(), xx.end(), 0.0));
}

#define NVP(x) boost::serialization::make_nvp(#x,x)

class Dummy {
public:
int a;
Dummy() { }
template<class Archive>
    void serialize(Archive& ar, const unsigned int) { ar & NVP(a); }
};

class DummyReader
{
std::ifstream myifstream;
boost::archive::binary_iarchive ar;
public:
DummyReader(std::string const& filename) :
myifstream(filename,std::ios_base::in | std::ios_base::binary),
ar(myifstream) { }
Dummy* Read() { Dummy* item; try {ar & NVP(item); } catch
(boost::archive::archive_exception const&) { item=0; } return item; }
};


From therneau at mayo.edu  Tue Nov 27 22:50:36 2012
From: therneau at mayo.edu (Terry Therneau)
Date: Tue, 27 Nov 2012 15:50:36 -0600
Subject: [Rd] Puzzling behavior while testing
Message-ID: <50B535AC.3040004@mayo.edu>

I'm testing a new release of survival, executing the following piece of code:

....
for (testpkg in survdep) {
     z <- testInstalledPackage(testpkg, outDir="tests")
     cat(testpkg, c("Ok", "Failed")[z+1], "\n", file="progress", append=T)
}

The vector survdep contains the names of all 156 packages listed as reverse depends on the 
CRAN page for survival.

All works well except for the packages coin and compareGroups.  If we make the survdep 
list contain only those 2 then the last line above "cat..." fails with "testpkg not 
found".  Running ls() at that point shows a set of variables I didn't define, and no 
evidence of any of "testpkg", "survdep", or anything else I'd defined.  My prompt has been 
changed to "R>" as well.

Any idea what is happening?

Terry Therneau

Here is the text just before starting the loop
 > sessionInfo()
R version 2.15.2 (2012-10-26)
Platform: i686-pc-linux-gnu (32-bit)

locale:
  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=C
  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
  [7] LC_PAPER=C                 LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] tools     stats     graphics  grDevices utils     datasets  methods
[8] base


From bbolker at gmail.com  Tue Nov 27 23:03:26 2012
From: bbolker at gmail.com (Ben Bolker)
Date: Tue, 27 Nov 2012 17:03:26 -0500
Subject: [Rd] R CMD check fails when run in a directory with parentheses in
 the pathname
Message-ID: <50B538AE.5020400@mcmaster.ca>


  For what it's worth: running R CMD check on a package when the outdir
has parentheses in the pathname fails with the following error:

* checking PDF version of manual ...sh: Syntax error: "(" unexpected
 WARNING
LaTeX errors when creating PDF version.
This typically indicates Rd problems.
* checking PDF version of manual without hyperrefs or index ...sh:
Syntax error: "(" unexpected
 ERROR
Re-running with no redirection of stdout/stderr.

  The workaround is as simple as using -o to redirect the output to a
sane path.

  This could be just a case of "don't do this", but I wanted to save
some future problem-Googler 10 minutes of digging around in the guts of
.tools:::check_packages() to find out what was going on ...

  I don't know whether this is technically a bug or not.  Presumably
something could be tweaked in check_pkg_manual() within
src/library/tools/R/check.R to protect parentheses in the shell argument
string ...

  Ben Bolker


From friendly at yorku.ca  Tue Nov 27 23:17:16 2012
From: friendly at yorku.ca (Michael Friendly)
Date: Tue, 27 Nov 2012 17:17:16 -0500
Subject: [Rd] R CMD check: better diagnosis for non-ASCII characters
Message-ID: <50B53BEC.9080400@yorku.ca>

[Env: R 2.15.1, Win Xp]

Suggestion:
Could the R script that checks for non-ASCII characters in R CMD check 
not give either:
(a) a pointer to tools:::showNonASCIIfile, as in,
try running tools:::showNonASCIIfile("Battig.Rd")
or,
(b) perhaps more useful, the result of tools:::showNonASCIIfile(file.Rd) 
on the offending file(s).

I'm frequently bitten by this in preparing .Rd files when I copy/paste 
references to the
.Rd from a .pdf or web link.  But it is nearly impossible to see these 
variant characters
in my .Rd files with any editor.

This recent example was solved by
 > tools:::showNonASCIIfile("Battig.Rd")
47:     \emph{Journal of Experimental Psychology}, 80 (1969), pp. 1<96>46

but I had to find this function again via ??ascii because it is not 
exported.

-- 
Michael Friendly     Email: friendly AT yorku DOT ca
Professor, Psychology Dept. & Chair, Quantitative Methods
York University      Voice: 416 736-2100 x66249 Fax: 416 736-5814
4700 Keele Street    Web:   http://www.datavis.ca
Toronto, ONT  M3J 1P3 CANADA


From hpages at fhcrc.org  Wed Nov 28 01:56:59 2012
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 27 Nov 2012 16:56:59 -0800
Subject: [Rd] bug with mapply() on an S4 object
In-Reply-To: <50A480AF.1030901@fhcrc.org>
References: <50A480AF.1030901@fhcrc.org>
Message-ID: <50B5615B.90303@fhcrc.org>

Hi,

Here is a patch for this (against current R-devel). The "caching" of
the .Primitive for 'length' is taken from seq_along() C code (in
R-devel/src/main/seq.c).

hpages at thinkpad:~/svn/R$ svn diff R-devel
Index: R-devel/src/main/mapply.c
===================================================================
--- R-devel/src/main/mapply.c	(revision 61172)
+++ R-devel/src/main/mapply.c	(working copy)
@@ -32,14 +32,39 @@
      int i, j, m, named, zero = 0;
      R_xlen_t *lengths, *counters, longest = 0;
      SEXP vnames, fcall = R_NilValue,  mindex, nindex, tmp1, tmp2, ans;
+    static SEXP length_op = NULL;

+    /* Store the .Primitive for 'length' for DispatchOrEval to use. */
+    if (length_op == NULL) {
+	SEXP R_lengthSymbol = install("length");
+	length_op = eval(R_lengthSymbol, R_BaseEnv);
+	if (TYPEOF(length_op) != BUILTINSXP) {
+	    length_op = NULL;
+	    error("'length' is not a BUILTIN");
+	}
+	R_PreserveObject(length_op);
+    }
+
      m = length(varyingArgs);
      vnames = PROTECT(getAttrib(varyingArgs, R_NamesSymbol));
      named = vnames != R_NilValue;

      lengths = (R_xlen_t *)  R_alloc(m, sizeof(R_xlen_t));
      for(i = 0; i < m; i++){
-	lengths[i] = xlength(VECTOR_ELT(varyingArgs, i));
+	int dispatch_ok = 0;
+	tmp1 = VECTOR_ELT(varyingArgs, i);
+	if (isObject(tmp1)) {
+	    /* Looks like DispatchOrEval() needs a pairlist. We reproduce what
+	       pairlist(tmp1) would do i.e. tmp2 <- as.pairlist(list(tmp1)).
+	       Is there a more direct way to go from tmp1 to tmp2? */
+	    PROTECT(tmp2 = allocVector(VECSXP, 1));
+	    SET_VECTOR_ELT(tmp2, 0, tmp1);
+	    PROTECT(tmp2 = coerceVector(tmp2, LISTSXP));
+	    dispatch_ok = DispatchOrEval(call, length_op, "length",
+					 tmp2, rho, &ans, 0, 1);
+	    UNPROTECT(2);
+	}
+	lengths[i] = dispatch_ok ? asInteger(ans) : xlength(tmp1);
  	if(lengths[i] == 0) zero++;
  	if (lengths[i] > longest) longest = lengths[i];
      }

Hopefully the bug can be fixed. Thanks!
H.


On 11/14/2012 09:42 PM, Herv? Pag?s wrote:
> Hi,
>
> Starting with ordinary vectors, so we know what to expect:
>
>    > mapply(function(x, y) {x * y}, 101:106, rep(1:3, 2))
>    [1] 101 204 309 104 210 318
>
>    > mapply(function(x, y) {x * y}, 101:106, 1:3)
>    [1] 101 204 309 104 210 318
>
> Now with an S4 object:
>
>    setClass("A", representation(aa="integer"))
>    a <- new("A", aa=101:106)
>
>    > length(a)
>    [1] 1
>
> Implementing length():
>
>    setMethod("length", "A", function(x) length(x at aa))
>
> Testing length():
>
>    > length(a)  # sanity check
>    [1] 6
>
> No [[ yet for those objects so the following error is expected:
>
>    > mapply(function(x, y) {x * y}, a, rep(1:3, 2))
>    Error in dots[[1L]][[1L]] : this S4 class is not subsettable
>
> Implementing [[:
>
>    setMethod("[[", "A", function(x, i, j, ...) x at aa[[i]])
>
> Testing [[:
>
>    > a[[1]]
>    [1] 101
>    > a[[5]]
>    [1] 105
>
> Trying mapply again:
>
>    > mapply(function(x, y) {x * y}, a, rep(1:3, 2))
>    [1] 101 202 303 101 202 303
>
> Wrong. It looks like internally a[[1]] is always used instead of a[[i]].
>
> The real problem it seems is that 'a' is treated as if it was of
> length 1:
>
>    > mapply(function(x, y) {x * y}, a, 1:3)
>    [1] 101 202 303
>    > mapply(function(x, y) {x * y}, a, 5)
>    [1] 505
>
> In other words, internal dispatch works for [[ but not for length().
>
> Thanks,
> H.
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From hpages at fhcrc.org  Wed Nov 28 02:03:05 2012
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 27 Nov 2012 17:03:05 -0800
Subject: [Rd] bug with mapply() on an S4 object
In-Reply-To: <50B5615B.90303@fhcrc.org>
References: <50A480AF.1030901@fhcrc.org> <50B5615B.90303@fhcrc.org>
Message-ID: <50B562C9.3090108@fhcrc.org>

Some formatting issues when copy/pasting the patch in the body of the
email so I've attached the diff file.

Cheers,
H.

On 11/27/2012 04:56 PM, Herv? Pag?s wrote:
> Hi,
>
> Here is a patch for this (against current R-devel). The "caching" of
> the .Primitive for 'length' is taken from seq_along() C code (in
> R-devel/src/main/seq.c).
>
> hpages at thinkpad:~/svn/R$ svn diff R-devel
> Index: R-devel/src/main/mapply.c
> ===================================================================
> --- R-devel/src/main/mapply.c    (revision 61172)
> +++ R-devel/src/main/mapply.c    (working copy)
> @@ -32,14 +32,39 @@
>       int i, j, m, named, zero = 0;
>       R_xlen_t *lengths, *counters, longest = 0;
>       SEXP vnames, fcall = R_NilValue,  mindex, nindex, tmp1, tmp2, ans;
> +    static SEXP length_op = NULL;
>
> +    /* Store the .Primitive for 'length' for DispatchOrEval to use. */
> +    if (length_op == NULL) {
> +    SEXP R_lengthSymbol = install("length");
> +    length_op = eval(R_lengthSymbol, R_BaseEnv);
> +    if (TYPEOF(length_op) != BUILTINSXP) {
> +        length_op = NULL;
> +        error("'length' is not a BUILTIN");
> +    }
> +    R_PreserveObject(length_op);
> +    }
> +
>       m = length(varyingArgs);
>       vnames = PROTECT(getAttrib(varyingArgs, R_NamesSymbol));
>       named = vnames != R_NilValue;
>
>       lengths = (R_xlen_t *)  R_alloc(m, sizeof(R_xlen_t));
>       for(i = 0; i < m; i++){
> -    lengths[i] = xlength(VECTOR_ELT(varyingArgs, i));
> +    int dispatch_ok = 0;
> +    tmp1 = VECTOR_ELT(varyingArgs, i);
> +    if (isObject(tmp1)) {
> +        /* Looks like DispatchOrEval() needs a pairlist. We reproduce what
> +           pairlist(tmp1) would do i.e. tmp2 <- as.pairlist(list(tmp1)).
> +           Is there a more direct way to go from tmp1 to tmp2? */
> +        PROTECT(tmp2 = allocVector(VECSXP, 1));
> +        SET_VECTOR_ELT(tmp2, 0, tmp1);
> +        PROTECT(tmp2 = coerceVector(tmp2, LISTSXP));
> +        dispatch_ok = DispatchOrEval(call, length_op, "length",
> +                     tmp2, rho, &ans, 0, 1);
> +        UNPROTECT(2);
> +    }
> +    lengths[i] = dispatch_ok ? asInteger(ans) : xlength(tmp1);
>       if(lengths[i] == 0) zero++;
>       if (lengths[i] > longest) longest = lengths[i];
>       }
>
> Hopefully the bug can be fixed. Thanks!
> H.
>
>
> On 11/14/2012 09:42 PM, Herv? Pag?s wrote:
>> Hi,
>>
>> Starting with ordinary vectors, so we know what to expect:
>>
>>    > mapply(function(x, y) {x * y}, 101:106, rep(1:3, 2))
>>    [1] 101 204 309 104 210 318
>>
>>    > mapply(function(x, y) {x * y}, 101:106, 1:3)
>>    [1] 101 204 309 104 210 318
>>
>> Now with an S4 object:
>>
>>    setClass("A", representation(aa="integer"))
>>    a <- new("A", aa=101:106)
>>
>>    > length(a)
>>    [1] 1
>>
>> Implementing length():
>>
>>    setMethod("length", "A", function(x) length(x at aa))
>>
>> Testing length():
>>
>>    > length(a)  # sanity check
>>    [1] 6
>>
>> No [[ yet for those objects so the following error is expected:
>>
>>    > mapply(function(x, y) {x * y}, a, rep(1:3, 2))
>>    Error in dots[[1L]][[1L]] : this S4 class is not subsettable
>>
>> Implementing [[:
>>
>>    setMethod("[[", "A", function(x, i, j, ...) x at aa[[i]])
>>
>> Testing [[:
>>
>>    > a[[1]]
>>    [1] 101
>>    > a[[5]]
>>    [1] 105
>>
>> Trying mapply again:
>>
>>    > mapply(function(x, y) {x * y}, a, rep(1:3, 2))
>>    [1] 101 202 303 101 202 303
>>
>> Wrong. It looks like internally a[[1]] is always used instead of a[[i]].
>>
>> The real problem it seems is that 'a' is treated as if it was of
>> length 1:
>>
>>    > mapply(function(x, y) {x * y}, a, 1:3)
>>    [1] 101 202 303
>>    > mapply(function(x, y) {x * y}, a, 5)
>>    [1] 505
>>
>> In other words, internal dispatch works for [[ but not for length().
>>
>> Thanks,
>> H.
>>
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mapply.diff
Type: text/x-patch
Size: 1657 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121127/0c37502e/attachment.bin>

From maechler at stat.math.ethz.ch  Wed Nov 28 11:45:25 2012
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 28 Nov 2012 11:45:25 +0100
Subject: [Rd] bug with mapply() on an S4 object
In-Reply-To: <50B562C9.3090108@fhcrc.org>
References: <50A480AF.1030901@fhcrc.org> <50B5615B.90303@fhcrc.org>
	<50B562C9.3090108@fhcrc.org>
Message-ID: <20661.60229.635742.917114@stat.math.ethz.ch>

>>>>> Herv? Pag?s <hpages at fhcrc.org>
>>>>>     on Tue, 27 Nov 2012 17:03:05 -0800 writes:

    > Some formatting issues when copy/pasting the patch in the
    > body of the email so I've attached the diff file.

Thank you, Herv?.

I have committed (a slightly simplified version of) your patch
to R-devel (to become 2.16.0).
Backporting to '2.15.2 patched' would be a bit of work
-- mapply's C interface is not .Internal() there --
so I've kept it in R-devel.

    > On 11/27/2012 04:56 PM, Herv? Pag?s wrote:
    >> Hi,
    >> 
    >> Here is a patch for this (against current R-devel). The "caching" of
    >> the .Primitive for 'length' is taken from seq_along() C code (in
    >> R-devel/src/main/seq.c).
    >> 
    >> hpages at thinkpad:~/svn/R$ svn diff R-devel
    >> Index: R-devel/src/main/mapply.c
    >> ===================================================================
    >> --- R-devel/src/main/mapply.c    (revision 61172)
    >> +++ R-devel/src/main/mapply.c    (working copy)

[.............]

    >> lengths = (R_xlen_t *)  R_alloc(m, sizeof(R_xlen_t));
    >> for(i = 0; i < m; i++){
    >> -    lengths[i] = xlength(VECTOR_ELT(varyingArgs, i));
    >> +    int dispatch_ok = 0;
    >> +    tmp1 = VECTOR_ELT(varyingArgs, i);
    >> +    if (isObject(tmp1)) {
    >> +        /* Looks like DispatchOrEval() needs a pairlist. We reproduce what
    >> +           pairlist(tmp1) would do i.e. tmp2 <- as.pairlist(list(tmp1)).
    >> +           Is there a more direct way to go from tmp1 to tmp2? */

indeed, there is a more direct way:

        tmp2 = lang1(tmp1)

and that's what I've used in the commit.

    >> +        PROTECT(tmp2 = allocVector(VECSXP, 1));
    >> +        SET_VECTOR_ELT(tmp2, 0, tmp1);
    >> +        PROTECT(tmp2 = coerceVector(tmp2, LISTSXP));
    >> +        dispatch_ok = DispatchOrEval(call, length_op, "length",
    >> +                     tmp2, rho, &ans, 0, 1);
    >> +        UNPROTECT(2);
    >> +    }
    >> +    lengths[i] = dispatch_ok ? asInteger(ans) : xlength(tmp1);
    >> if(lengths[i] == 0) zero++;
    >> if (lengths[i] > longest) longest = lengths[i];
    >> }
    >> 
    >> Hopefully the bug can be fixed. Thanks!

Many thanks to you, Herv?!
Martin


    >> On 11/14/2012 09:42 PM, Herv? Pag?s wrote:
    >>> Hi,
    >>> 
    >>> Starting with ordinary vectors, so we know what to expect:
    >>> 
    >>> > mapply(function(x, y) {x * y}, 101:106, rep(1:3, 2))
    >>> [1] 101 204 309 104 210 318
    >>> 
    >>> > mapply(function(x, y) {x * y}, 101:106, 1:3)
    >>> [1] 101 204 309 104 210 318
    >>> 
    >>> Now with an S4 object:
    >>> 
    >>> setClass("A", representation(aa="integer"))
    >>> a <- new("A", aa=101:106)
    >>> 
    >>> > length(a)
    >>> [1] 1
    >>> 
    >>> Implementing length():
    >>> 
    >>> setMethod("length", "A", function(x) length(x at aa))
    >>> 
    >>> Testing length():
    >>> 
    >>> > length(a)  # sanity check
    >>> [1] 6
    >>> 
    >>> No [[ yet for those objects so the following error is expected:
    >>> 
    >>> > mapply(function(x, y) {x * y}, a, rep(1:3, 2))
    >>> Error in dots[[1L]][[1L]] : this S4 class is not subsettable
    >>> 
    >>> Implementing [[:
    >>> 
    >>> setMethod("[[", "A", function(x, i, j, ...) x at aa[[i]])
    >>> 
    >>> Testing [[:
    >>> 
    >>> > a[[1]]
    >>> [1] 101
    >>> > a[[5]]
    >>> [1] 105
    >>> 
    >>> Trying mapply again:
    >>> 
    >>> > mapply(function(x, y) {x * y}, a, rep(1:3, 2))
    >>> [1] 101 202 303 101 202 303
    >>> 
    >>> Wrong. It looks like internally a[[1]] is always used instead of a[[i]].
    >>> 
    >>> The real problem it seems is that 'a' is treated as if it was of
    >>> length 1:
    >>> 
    >>> > mapply(function(x, y) {x * y}, a, 1:3)
    >>> [1] 101 202 303
    >>> > mapply(function(x, y) {x * y}, a, 5)
    >>> [1] 505
    >>> 
    >>> In other words, internal dispatch works for [[ but not for length().
    >>> 
    >>> Thanks,
    >>> H.
    >>> 
    >> 

    > -- 
    > Herv? Pag?s

    > Program in Computational Biology
    > Division of Public Health Sciences
    > Fred Hutchinson Cancer Research Center
    > 1100 Fairview Ave. N, M1-B514
    > P.O. Box 19024
    > Seattle, WA 98109-1024

    > E-mail: hpages at fhcrc.org
    > Phone:  (206) 667-5791
    > Fax:    (206) 667-1319

    > [DELETED ATTACHMENT external: mapply.diff, text/x-patch]


From maechler at stat.math.ethz.ch  Wed Nov 28 12:02:38 2012
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 28 Nov 2012 12:02:38 +0100
Subject: [Rd] R CMD check: better diagnosis for non-ASCII characters
In-Reply-To: <50B53BEC.9080400@yorku.ca>
References: <50B53BEC.9080400@yorku.ca>
Message-ID: <20661.61262.938696.495376@stat.math.ethz.ch>

>>>>> Michael Friendly <friendly at yorku.ca>
>>>>>     on Tue, 27 Nov 2012 17:17:16 -0500 writes:

    > [Env: R 2.15.1, Win Xp]
    > Suggestion:
    > Could the R script that checks for non-ASCII characters in R CMD check 
    > not give either:
    > (a) a pointer to tools:::showNonASCIIfile, as in,
    > try running tools:::showNonASCIIfile("Battig.Rd")
    > or,
    > (b) perhaps more useful, the result of tools:::showNonASCIIfile(file.Rd) 
    > on the offending file(s).

    > I'm frequently bitten by this in preparing .Rd files when I copy/paste 
    > references to the
    > .Rd from a .pdf or web link.  But it is nearly impossible to see these 
    > variant characters
    > in my .Rd files with any editor.

I understand.. {though it is easier with my favorite, Emacs}

(Many people outside {North America + UK + ex-"Common Wealth"}
 encounter such problems even more frequently than you..)

    > This recent example was solved by
    >> tools:::showNonASCIIfile("Battig.Rd")
    > 47:     \emph{Journal of Experimental Psychology}, 80 (1969), pp. 1<96>46

    > but I had to find this function again via ??ascii because it is not 
    > exported.

Hmm..... at first, I started replying saying :

  As your suggestion '(b)' is probably more work, I personally
  would aim for '(a)' ... but then really the issue is that *nobody*
  should suggest functions to anyone if they are not exported and hence
  can be removed from R (or the relevant package), or get
  different semantics  "any time". 

HOWEVER, both showNonASCII() and showNonASCIIfile() 
*are* exported (from tools).
So, maybe the reason you did not find them quickly was because
"tools" is not among the default (loaded + attached) packages?

In any case, I support your suggestion (replacing ":::" by "::" !)
and would definitely volunteer to accept patches and then put such an
improvement into R.

Martin


From maechler at stat.math.ethz.ch  Wed Nov 28 12:06:12 2012
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 28 Nov 2012 12:06:12 +0100
Subject: [Rd] Not stripping attachments in R-devel e-mails
In-Reply-To: <CAPSN_LVtBXwWFC4xpttJ93x=J9n2WXftC-8Bi2SdAnbA7B-uQw@mail.gmail.com>
References: <CAPSN_LWkjENv1Y4dSxG-73yGhTfYuewScwgKKEeUjbWp97jDfw@mail.gmail.com>
	<CAPSN_LVtBXwWFC4xpttJ93x=J9n2WXftC-8Bi2SdAnbA7B-uQw@mail.gmail.com>
Message-ID: <20661.61476.832569.246143@stat.math.ethz.ch>

>>>>> "FB" == Florian Burkart <florian.burkart at gmail.com>
>>>>>     on Tue, 27 Nov 2012 18:01:33 +0000 writes:

    FB> Sorry, didn't realize text attachments get stripped as well...

they are *NOT* stripped  *if* they get the correct MIME type,
e.g.  'text/plain'

Unfortunately many e-mail clients nowadays no longer try put
correct MIME types for the attachments,
so it seems, your did neither.


Martin Maechler, ETH Zurich (site maintainer of the
R-*@R-project.org mailing lists).


From florian.burkart at gmail.com  Wed Nov 28 12:57:40 2012
From: florian.burkart at gmail.com (Florian Burkart)
Date: Wed, 28 Nov 2012 11:57:40 +0000
Subject: [Rd] Not stripping attachments in R-devel e-mails
In-Reply-To: <20661.61476.832569.246143@stat.math.ethz.ch>
References: <CAPSN_LWkjENv1Y4dSxG-73yGhTfYuewScwgKKEeUjbWp97jDfw@mail.gmail.com>
	<CAPSN_LVtBXwWFC4xpttJ93x=J9n2WXftC-8Bi2SdAnbA7B-uQw@mail.gmail.com>
	<20661.61476.832569.246143@stat.math.ethz.ch>
Message-ID: <CAPSN_LXjT9=ZPmL3YbSFQ=g-JNmBf_VhO241D-wRqsQvcKhE4A@mail.gmail.com>

If it is of interest, I am using the gmail web interface, and the
problems seems to be that it sets the content type too correctly
rather than incorrectly.

In my original email, it had set the content type to "text/x-c++src".
I just did a test with a .csv file, and it set the content type to
"text/csv". The file ending apparently needs to be a .txt for it to
register as "text/plain".


From michael.weylandt at gmail.com  Wed Nov 28 14:43:14 2012
From: michael.weylandt at gmail.com (R. Michael Weylandt)
Date: Wed, 28 Nov 2012 13:43:14 +0000
Subject: [Rd] [R] choose folder interactively
In-Reply-To: <50B607FE.40909@gmail.com>
References: <50B60601.9040906@u-bourgogne.fr> <50B607FE.40909@gmail.com>
Message-ID: <CAAmySGOhHaDKnvs0KDt7PYm3eodWu49a6zKpJhM7Ti-p32wYFg@mail.gmail.com>

On Wed, Nov 28, 2012 at 12:47 PM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 12-11-28 7:39 AM, Ivan Calandra wrote:
>>
>> Dear users,
>>
>> I am looking for a function to choose a folder interactively, just like
>> file.choose() but for a folder.
>>
> "choose.dir()" does exist on Windows, so you could switch to that OS, or
> write your own equivalent for MacOS.

Is this the sort of thing for which a patch to the Mac-specific code
would be welcomed/of some interest by R-Core or are their good reasons
this doesn't already exist?

Michael


From MEC at stowers.org  Wed Nov 28 14:47:37 2012
From: MEC at stowers.org (Cook, Malcolm)
Date: Wed, 28 Nov 2012 07:47:37 -0600
Subject: [Rd] bug with mapply() on an S4 object
In-Reply-To: <20661.60229.635742.917114@stat.math.ethz.ch>
References: <50A480AF.1030901@fhcrc.org> <50B5615B.90303@fhcrc.org>
	<50B562C9.3090108@fhcrc.org>,
	<20661.60229.635742.917114@stat.math.ethz.ch>
Message-ID: <2C40E43D1F7A56408C4463FD245DDDF9079088BFCE@EXCHMB-02.stowers-institute.org>

Yes, yes, excellent and great , I am tracking this development with great interest.

Am I correct that the implications for BioConductor is the tearing out of the Xapply from generics and the expecations that List and descendents would now "just work" with {t,mc,mcl,...}apply?  That would be a grand outcome.  

~malcolm_cook at stowers.org


>>>>> Herv? Pag?s <hpages at fhcrc.org>
>>>>>     on Tue, 27 Nov 2012 17:03:05 -0800 writes:

    > Some formatting issues when copy/pasting the patch in the
    > body of the email so I've attached the diff file.

Thank you, Herv?.

I have committed (a slightly simplified version of) your patch
to R-devel (to become 2.16.0).
Backporting to '2.15.2 patched' would be a bit of work
-- mapply's C interface is not .Internal() there --
so I've kept it in R-devel.

    > On 11/27/2012 04:56 PM, Herv? Pag?s wrote:
    >> Hi,
    >>
    >> Here is a patch for this (against current R-devel). The "caching" of
    >> the .Primitive for 'length' is taken from seq_along() C code (in
    >> R-devel/src/main/seq.c).
    >>
    >> hpages at thinkpad:~/svn/R$ svn diff R-devel
    >> Index: R-devel/src/main/mapply.c
    >> ===================================================================
    >> --- R-devel/src/main/mapply.c    (revision 61172)
    >> +++ R-devel/src/main/mapply.c    (working copy)

[.............]

    >> lengths = (R_xlen_t *)  R_alloc(m, sizeof(R_xlen_t));
    >> for(i = 0; i < m; i++){
    >> -    lengths[i] = xlength(VECTOR_ELT(varyingArgs, i));
    >> +    int dispatch_ok = 0;
    >> +    tmp1 = VECTOR_ELT(varyingArgs, i);
    >> +    if (isObject(tmp1)) {
    >> +        /* Looks like DispatchOrEval() needs a pairlist. We reproduce what
    >> +           pairlist(tmp1) would do i.e. tmp2 <- as.pairlist(list(tmp1)).
    >> +           Is there a more direct way to go from tmp1 to tmp2? */

indeed, there is a more direct way:

        tmp2 = lang1(tmp1)

and that's what I've used in the commit.

    >> +        PROTECT(tmp2 = allocVector(VECSXP, 1));
    >> +        SET_VECTOR_ELT(tmp2, 0, tmp1);
    >> +        PROTECT(tmp2 = coerceVector(tmp2, LISTSXP));
    >> +        dispatch_ok = DispatchOrEval(call, length_op, "length",
    >> +                     tmp2, rho, &ans, 0, 1);
    >> +        UNPROTECT(2);
    >> +    }
    >> +    lengths[i] = dispatch_ok ? asInteger(ans) : xlength(tmp1);
    >> if(lengths[i] == 0) zero++;
    >> if (lengths[i] > longest) longest = lengths[i];
    >> }
    >>
    >> Hopefully the bug can be fixed. Thanks!

Many thanks to you, Herv?!
Martin


    >> On 11/14/2012 09:42 PM, Herv? Pag?s wrote:
    >>> Hi,
    >>>
    >>> Starting with ordinary vectors, so we know what to expect:
    >>>
    >>> > mapply(function(x, y) {x * y}, 101:106, rep(1:3, 2))
    >>> [1] 101 204 309 104 210 318
    >>>
    >>> > mapply(function(x, y) {x * y}, 101:106, 1:3)
    >>> [1] 101 204 309 104 210 318
    >>>
    >>> Now with an S4 object:
    >>>
    >>> setClass("A", representation(aa="integer"))
    >>> a <- new("A", aa=101:106)
    >>>
    >>> > length(a)
    >>> [1] 1
    >>>
    >>> Implementing length():
    >>>
    >>> setMethod("length", "A", function(x) length(x at aa))
    >>>
    >>> Testing length():
    >>>
    >>> > length(a)  # sanity check
    >>> [1] 6
    >>>
    >>> No [[ yet for those objects so the following error is expected:
    >>>
    >>> > mapply(function(x, y) {x * y}, a, rep(1:3, 2))
    >>> Error in dots[[1L]][[1L]] : this S4 class is not subsettable
    >>>
    >>> Implementing [[:
    >>>
    >>> setMethod("[[", "A", function(x, i, j, ...) x at aa[[i]])
    >>>
    >>> Testing [[:
    >>>
    >>> > a[[1]]
    >>> [1] 101
    >>> > a[[5]]
    >>> [1] 105
    >>>
    >>> Trying mapply again:
    >>>
    >>> > mapply(function(x, y) {x * y}, a, rep(1:3, 2))
    >>> [1] 101 202 303 101 202 303
    >>>
    >>> Wrong. It looks like internally a[[1]] is always used instead of a[[i]].
    >>>
    >>> The real problem it seems is that 'a' is treated as if it was of
    >>> length 1:
    >>>
    >>> > mapply(function(x, y) {x * y}, a, 1:3)
    >>> [1] 101 202 303
    >>> > mapply(function(x, y) {x * y}, a, 5)
    >>> [1] 505
    >>>
    >>> In other words, internal dispatch works for [[ but not for length().
    >>>
    >>> Thanks,
    >>> H.
    >>>
    >>

    > --
    > Herv? Pag?s

    > Program in Computational Biology
    > Division of Public Health Sciences
    > Fred Hutchinson Cancer Research Center
    > 1100 Fairview Ave. N, M1-B514
    > P.O. Box 19024
    > Seattle, WA 98109-1024

    > E-mail: hpages at fhcrc.org
    > Phone:  (206) 667-5791
    > Fax:    (206) 667-1319

    > [DELETED ATTACHMENT external: mapply.diff, text/x-patch]

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Wed Nov 28 14:56:44 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 28 Nov 2012 13:56:44 +0000
Subject: [Rd] [R] choose folder interactively
In-Reply-To: <CAAmySGOhHaDKnvs0KDt7PYm3eodWu49a6zKpJhM7Ti-p32wYFg@mail.gmail.com>
References: <50B60601.9040906@u-bourgogne.fr> <50B607FE.40909@gmail.com>
	<CAAmySGOhHaDKnvs0KDt7PYm3eodWu49a6zKpJhM7Ti-p32wYFg@mail.gmail.com>
Message-ID: <50B6181C.2060407@stats.ox.ac.uk>

On 28/11/2012 13:43, R. Michael Weylandt wrote:
> On Wed, Nov 28, 2012 at 12:47 PM, Duncan Murdoch
> <murdoch.duncan at gmail.com> wrote:
>> On 12-11-28 7:39 AM, Ivan Calandra wrote:
>>>
>>> Dear users,
>>>
>>> I am looking for a function to choose a folder interactively, just like
>>> file.choose() but for a folder.
>>>
>> "choose.dir()" does exist on Windows, so you could switch to that OS, or
>> write your own equivalent for MacOS.
>
> Is this the sort of thing for which a patch to the Mac-specific code
> would be welcomed/of some interest by R-Core or are their good reasons
> this doesn't already exist?

Yes, it would be of interest.   It would need to rely on Aqua/Quartz and 
be written in Objective-C: unless something is done for the Quartz event 
loop in command-line R (which is not impossible as the quartz() device 
does so), it would be confined to R.app.

The main constraint is that we have very few people who know enough 
about Mac GUI programming (and Objective-C) and R internals.

It was simple enough on Windows as we already had choose.files (and a 
GUI for file.choose): that would also be worthwhile on a Mac.  We also 
has someone keen enough on Windows GUI programming (although he did not 
last long).


> Michael
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From friendly at yorku.ca  Wed Nov 28 15:16:12 2012
From: friendly at yorku.ca (Michael Friendly)
Date: Wed, 28 Nov 2012 09:16:12 -0500
Subject: [Rd] R CMD check: better diagnosis for non-ASCII characters
In-Reply-To: <20661.61262.938696.495376@stat.math.ethz.ch>
References: <50B53BEC.9080400@yorku.ca>
	<20661.61262.938696.495376@stat.math.ethz.ch>
Message-ID: <50B61CAC.2030309@yorku.ca>

On 11/28/2012 6:02 AM, Martin Maechler wrote:
> In any case, I support your suggestion (replacing ":::" by "::" !)
> and would definitely volunteer to accept patches and then put such an
> improvement into R.
Thanks, Martin.
If you can point me to the source where this is carried out, I can 
attempt a patch.

-- 
Michael Friendly     Email: friendly AT yorku DOT ca
Professor, Psychology Dept. & Chair, Quantitative Methods
York University      Voice: 416 736-2100 x66249 Fax: 416 736-5814
4700 Keele Street    Web:   http://www.datavis.ca
Toronto, ONT  M3J 1P3 CANADA


From michael.weylandt at gmail.com  Wed Nov 28 15:22:19 2012
From: michael.weylandt at gmail.com (R. Michael Weylandt)
Date: Wed, 28 Nov 2012 14:22:19 +0000
Subject: [Rd] [R] error in plot(table(c('a','a')))
In-Reply-To: <50B3FC84.3080400@sapo.pt>
References: <3cb3bdb5b91966573be20763f50c4f71.squirrel@webmail.xs4all.nl>
	<CAAmySGNQPL-vq5fFpS1YHc7YF2xar_18XhThO_8DQPxPxcS6Aw@mail.gmail.com>
	<50B3FC84.3080400@sapo.pt>
Message-ID: <CAAmySGO8Wx05spC+95QAAPjndphmHnAOusKirQ8DQweDKf+9UA@mail.gmail.com>

Should I file an issue for this in the bug tracker?

Slighly rearranged discussion with reproducible example follows on below.

> Em 26-11-2012 21:39, R. Michael Weylandt escreveu:
>>
>> On Mon, Nov 26, 2012 at 2:41 PM, Ludo Pagie <l.pagie at nki.nl> wrote:
>>> tbl.char1 <- table(c('a','a'))
>>> tbl.char2 <- table(c('a','a','b'))
>>> tbl.int1 <- table(c(1,1))
>>>
>>> # error:
>>> plot(tbl.char1)
>>>
>>> # no errors:
>>> plot(tbl.char2)
>>> plot(tbl.int1)
>>>
>> Confirmed in current R-devel. It seems to arise from plot.table's use
>> of seq.int(x) when the dimnames of the table are not integers. I'm not
>> sure if this shouldn't be seq_along(x) instead, but I'm not sure I
>> totally follow the internal logic, so perhaps someone can offer second
>> opinion?

On Mon, Nov 26, 2012 at 11:34 PM, Rui Barradas <ruipbarradas at sapo.pt> wrote:
>  I'd change "when the dimnames of the table are not integers "
> to not numeric as that's what the code for plot.table tests. And it
> seems to come from seq.int, since with table value
> of 2, seq.int produces a vector of length 2 but the table length is 1:
>
> seq_along seems to solve the matter.


From ripley at stats.ox.ac.uk  Wed Nov 28 15:29:48 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 28 Nov 2012 14:29:48 +0000
Subject: [Rd] [R] error in plot(table(c('a','a')))
In-Reply-To: <CAAmySGO8Wx05spC+95QAAPjndphmHnAOusKirQ8DQweDKf+9UA@mail.gmail.com>
References: <3cb3bdb5b91966573be20763f50c4f71.squirrel@webmail.xs4all.nl>
	<CAAmySGNQPL-vq5fFpS1YHc7YF2xar_18XhThO_8DQPxPxcS6Aw@mail.gmail.com>
	<50B3FC84.3080400@sapo.pt>
	<CAAmySGO8Wx05spC+95QAAPjndphmHnAOusKirQ8DQweDKf+9UA@mail.gmail.com>
Message-ID: <50B61FDC.2060006@stats.ox.ac.uk>

On 28/11/2012 14:22, R. Michael Weylandt wrote:
> Should I file an issue for this in the bug tracker?

Someone already has. (15118, against R 2.14.0!)

>
> Slighly rearranged discussion with reproducible example follows on below.
>
>> Em 26-11-2012 21:39, R. Michael Weylandt escreveu:
>>>
>>> On Mon, Nov 26, 2012 at 2:41 PM, Ludo Pagie <l.pagie at nki.nl> wrote:
>>>> tbl.char1 <- table(c('a','a'))
>>>> tbl.char2 <- table(c('a','a','b'))
>>>> tbl.int1 <- table(c(1,1))
>>>>
>>>> # error:
>>>> plot(tbl.char1)
>>>>
>>>> # no errors:
>>>> plot(tbl.char2)
>>>> plot(tbl.int1)
>>>>
>>> Confirmed in current R-devel. It seems to arise from plot.table's use
>>> of seq.int(x) when the dimnames of the table are not integers. I'm not
>>> sure if this shouldn't be seq_along(x) instead, but I'm not sure I
>>> totally follow the internal logic, so perhaps someone can offer second
>>> opinion?
>
> On Mon, Nov 26, 2012 at 11:34 PM, Rui Barradas <ruipbarradas at sapo.pt> wrote:
>>   I'd change "when the dimnames of the table are not integers "
>> to not numeric as that's what the code for plot.table tests. And it
>> seems to come from seq.int, since with table value
>> of 2, seq.int produces a vector of length 2 but the table length is 1:
>>
>> seq_along seems to solve the matter.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sgerber at cs.utah.edu  Wed Nov 28 15:36:22 2012
From: sgerber at cs.utah.edu (sgerber)
Date: Wed, 28 Nov 2012 09:36:22 -0500
Subject: [Rd]  Makevars that distinguish between OSX and *NIX
In-Reply-To: <50B61FDC.2060006@stats.ox.ac.uk>
References: <3cb3bdb5b91966573be20763f50c4f71.squirrel@webmail.xs4all.nl>
	<CAAmySGNQPL-vq5fFpS1YHc7YF2xar_18XhThO_8DQPxPxcS6Aw@mail.gmail.com>
	<50B3FC84.3080400@sapo.pt>
	<CAAmySGO8Wx05spC+95QAAPjndphmHnAOusKirQ8DQweDKf+9UA@mail.gmail.com>
	<50B61FDC.2060006@stats.ox.ac.uk>
Message-ID: <22879e9d08d5fc52be14f6f76816de70@cs.utah.edu>

Hi

Is there a similar way to create a specific Makevars for OSX versus 
*NIX systems as for Windows, e.g. a Makervars.osx ?
If not what is there another lean solution to create system specific 
Makevars? I need to link differently depending on whether I am on *NIX 
or OSX (specifically link to OpenGL).


Thanks
Sam


From ripley at stats.ox.ac.uk  Wed Nov 28 15:47:10 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 28 Nov 2012 14:47:10 +0000
Subject: [Rd] Makevars that distinguish between OSX and *NIX
In-Reply-To: <22879e9d08d5fc52be14f6f76816de70@cs.utah.edu>
References: <3cb3bdb5b91966573be20763f50c4f71.squirrel@webmail.xs4all.nl>
	<CAAmySGNQPL-vq5fFpS1YHc7YF2xar_18XhThO_8DQPxPxcS6Aw@mail.gmail.com>
	<50B3FC84.3080400@sapo.pt>
	<CAAmySGO8Wx05spC+95QAAPjndphmHnAOusKirQ8DQweDKf+9UA@mail.gmail.com>
	<50B61FDC.2060006@stats.ox.ac.uk>
	<22879e9d08d5fc52be14f6f76816de70@cs.utah.edu>
Message-ID: <50B623EE.3060407@stats.ox.ac.uk>

On 28/11/2012 14:36, sgerber wrote:
> Hi
>
> Is there a similar way to create a specific Makevars for OSX versus *NIX
> systems as for Windows, e.g. a Makervars.osx ?
> If not what is there another lean solution to create system specific
> Makevars? I need to link differently depending on whether I am on *NIX
> or OSX (specifically link to OpenGL).
>

Well, OS X (sic) is a certified UNIX!

This is what a 'configure' script is used for (e.g. by package rgl). 
But you can write conditional code in commands in the Makevars, e.g. by

if test `uname` = "Darwin" ; then
else
fi

Please do not use GNU make misfeatures to do this if you want it to be 
portable (see 'Writing R Extensions').

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From simon.urbanek at r-project.org  Wed Nov 28 15:50:07 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 28 Nov 2012 09:50:07 -0500
Subject: [Rd] [R] choose folder interactively
In-Reply-To: <50B6181C.2060407@stats.ox.ac.uk>
References: <50B60601.9040906@u-bourgogne.fr> <50B607FE.40909@gmail.com>
	<CAAmySGOhHaDKnvs0KDt7PYm3eodWu49a6zKpJhM7Ti-p32wYFg@mail.gmail.com>
	<50B6181C.2060407@stats.ox.ac.uk>
Message-ID: <676336D1-757C-4C76-8932-C16412D355AA@r-project.org>


On Nov 28, 2012, at 8:56 AM, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:

> On 28/11/2012 13:43, R. Michael Weylandt wrote:
>> On Wed, Nov 28, 2012 at 12:47 PM, Duncan Murdoch
>> <murdoch.duncan at gmail.com> wrote:
>>> On 12-11-28 7:39 AM, Ivan Calandra wrote:
>>>> 
>>>> Dear users,
>>>> 
>>>> I am looking for a function to choose a folder interactively, just like
>>>> file.choose() but for a folder.
>>>> 
>>> "choose.dir()" does exist on Windows, so you could switch to that OS, or
>>> write your own equivalent for MacOS.
>> 

Unfortunately choose.dir() is one of those hacks that were added without any plan. Ideally, it should be deprecated and replaced by a proper solution (we have those bad platform-specific hack both in the Mac and Windows camps - equally bad). In this particular case it should not be hard, because the name is counter-intulitive, so adding an argument to file.choose() along the lines file-only/file-or-folder/folder-only (which I would ague for) or adding a dir.choose() function that can be relied upon is possible. The implementation is not the problem since we already have cross-platform implementation for file.choose(). While at it, we may also consider adding a flag for allowing multiple items selection...

Cheers,
Simon


>> Is this the sort of thing for which a patch to the Mac-specific code
>> would be welcomed/of some interest by R-Core or are their good reasons
>> this doesn't already exist?
> 



> Yes, it would be of interest.   It would need to rely on Aqua/Quartz and be written in Objective-C: unless something is done for the Quartz event loop in command-line R (which is not impossible as the quartz() device does so), it would be confined to R.app.
> 
> The main constraint is that we have very few people who know enough about Mac GUI programming (and Objective-C) and R internals.
> 
> It was simple enough on Windows as we already had choose.files (and a GUI for file.choose): that would also be worthwhile on a Mac.  We also has someone keen enough on Windows GUI programming (although he did not last long).
> 
> 
>> Michael
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
> 
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 
> 


From hpages at fhcrc.org  Wed Nov 28 19:00:02 2012
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Wed, 28 Nov 2012 10:00:02 -0800
Subject: [Rd] bug with mapply() on an S4 object
In-Reply-To: <2C40E43D1F7A56408C4463FD245DDDF9079088BFCE@EXCHMB-02.stowers-institute.org>
References: <50A480AF.1030901@fhcrc.org> <50B5615B.90303@fhcrc.org>
	<50B562C9.3090108@fhcrc.org>,
	<20661.60229.635742.917114@stat.math.ethz.ch>
	<2C40E43D1F7A56408C4463FD245DDDF9079088BFCE@EXCHMB-02.stowers-institute.org>
Message-ID: <50B65122.3050507@fhcrc.org>

Hi Martin, Malcolm,

Thanks Martin for applying the fix.

On 11/28/2012 05:47 AM, Cook, Malcolm wrote:
> Yes, yes, excellent and great , I am tracking this development with great interest.
>
> Am I correct that the implications for BioConductor is the tearing out of the Xapply from generics and the expecations that List and descendents would now "just work" with {t,mc,mcl,...}apply?  That would be a grand outcome.

Yes it's nice to have more things work out-of-the-box on
list-like or vector-like S4 objects. It makes implementation of
new List or Vector concrete subclasses easier and the overall code
for the 100+ subclasses currently defined in Bioconductor simpler,
cleaner, and easier to maintain (less code duplication).

In the particular case of base::mapply(), it's true that, with this
fix, we don't need to explicitly turn mapply() into a generic anymore
(in BiocGenerics), at least in theory, because now it works on objects
with length and [[ methods. However, we might want to keep the generic
in BiocGenerics anyway, because a BioC developer might still want to
override the default method (i.e. the mapply,ANY method, pointing to
base::mapply) with a method for particular objects that is semantically
equivalent but more efficient on those objects.

Cheers,
H.

>
> ~malcolm_cook at stowers.org
>
>
>>>>>> Herv? Pag?s <hpages at fhcrc.org>
>>>>>>      on Tue, 27 Nov 2012 17:03:05 -0800 writes:
>
>      > Some formatting issues when copy/pasting the patch in the
>      > body of the email so I've attached the diff file.
>
> Thank you, Herv?.
>
> I have committed (a slightly simplified version of) your patch
> to R-devel (to become 2.16.0).
> Backporting to '2.15.2 patched' would be a bit of work
> -- mapply's C interface is not .Internal() there --
> so I've kept it in R-devel.
>
>      > On 11/27/2012 04:56 PM, Herv? Pag?s wrote:
>      >> Hi,
>      >>
>      >> Here is a patch for this (against current R-devel). The "caching" of
>      >> the .Primitive for 'length' is taken from seq_along() C code (in
>      >> R-devel/src/main/seq.c).
>      >>
>      >> hpages at thinkpad:~/svn/R$ svn diff R-devel
>      >> Index: R-devel/src/main/mapply.c
>      >> ===================================================================
>      >> --- R-devel/src/main/mapply.c    (revision 61172)
>      >> +++ R-devel/src/main/mapply.c    (working copy)
>
> [.............]
>
>      >> lengths = (R_xlen_t *)  R_alloc(m, sizeof(R_xlen_t));
>      >> for(i = 0; i < m; i++){
>      >> -    lengths[i] = xlength(VECTOR_ELT(varyingArgs, i));
>      >> +    int dispatch_ok = 0;
>      >> +    tmp1 = VECTOR_ELT(varyingArgs, i);
>      >> +    if (isObject(tmp1)) {
>      >> +        /* Looks like DispatchOrEval() needs a pairlist. We reproduce what
>      >> +           pairlist(tmp1) would do i.e. tmp2 <- as.pairlist(list(tmp1)).
>      >> +           Is there a more direct way to go from tmp1 to tmp2? */
>
> indeed, there is a more direct way:
>
>          tmp2 = lang1(tmp1)
>
> and that's what I've used in the commit.
>
>      >> +        PROTECT(tmp2 = allocVector(VECSXP, 1));
>      >> +        SET_VECTOR_ELT(tmp2, 0, tmp1);
>      >> +        PROTECT(tmp2 = coerceVector(tmp2, LISTSXP));
>      >> +        dispatch_ok = DispatchOrEval(call, length_op, "length",
>      >> +                     tmp2, rho, &ans, 0, 1);
>      >> +        UNPROTECT(2);
>      >> +    }
>      >> +    lengths[i] = dispatch_ok ? asInteger(ans) : xlength(tmp1);
>      >> if(lengths[i] == 0) zero++;
>      >> if (lengths[i] > longest) longest = lengths[i];
>      >> }
>      >>
>      >> Hopefully the bug can be fixed. Thanks!
>
> Many thanks to you, Herv?!
> Martin
>
>
>      >> On 11/14/2012 09:42 PM, Herv? Pag?s wrote:
>      >>> Hi,
>      >>>
>      >>> Starting with ordinary vectors, so we know what to expect:
>      >>>
>      >>> > mapply(function(x, y) {x * y}, 101:106, rep(1:3, 2))
>      >>> [1] 101 204 309 104 210 318
>      >>>
>      >>> > mapply(function(x, y) {x * y}, 101:106, 1:3)
>      >>> [1] 101 204 309 104 210 318
>      >>>
>      >>> Now with an S4 object:
>      >>>
>      >>> setClass("A", representation(aa="integer"))
>      >>> a <- new("A", aa=101:106)
>      >>>
>      >>> > length(a)
>      >>> [1] 1
>      >>>
>      >>> Implementing length():
>      >>>
>      >>> setMethod("length", "A", function(x) length(x at aa))
>      >>>
>      >>> Testing length():
>      >>>
>      >>> > length(a)  # sanity check
>      >>> [1] 6
>      >>>
>      >>> No [[ yet for those objects so the following error is expected:
>      >>>
>      >>> > mapply(function(x, y) {x * y}, a, rep(1:3, 2))
>      >>> Error in dots[[1L]][[1L]] : this S4 class is not subsettable
>      >>>
>      >>> Implementing [[:
>      >>>
>      >>> setMethod("[[", "A", function(x, i, j, ...) x at aa[[i]])
>      >>>
>      >>> Testing [[:
>      >>>
>      >>> > a[[1]]
>      >>> [1] 101
>      >>> > a[[5]]
>      >>> [1] 105
>      >>>
>      >>> Trying mapply again:
>      >>>
>      >>> > mapply(function(x, y) {x * y}, a, rep(1:3, 2))
>      >>> [1] 101 202 303 101 202 303
>      >>>
>      >>> Wrong. It looks like internally a[[1]] is always used instead of a[[i]].
>      >>>
>      >>> The real problem it seems is that 'a' is treated as if it was of
>      >>> length 1:
>      >>>
>      >>> > mapply(function(x, y) {x * y}, a, 1:3)
>      >>> [1] 101 202 303
>      >>> > mapply(function(x, y) {x * y}, a, 5)
>      >>> [1] 505
>      >>>
>      >>> In other words, internal dispatch works for [[ but not for length().
>      >>>
>      >>> Thanks,
>      >>> H.
>      >>>
>      >>
>
>      > --
>      > Herv? Pag?s
>
>      > Program in Computational Biology
>      > Division of Public Health Sciences
>      > Fred Hutchinson Cancer Research Center
>      > 1100 Fairview Ave. N, M1-B514
>      > P.O. Box 19024
>      > Seattle, WA 98109-1024
>
>      > E-mail: hpages at fhcrc.org
>      > Phone:  (206) 667-5791
>      > Fax:    (206) 667-1319
>
>      > [DELETED ATTACHMENT external: mapply.diff, text/x-patch]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From gsee000 at gmail.com  Wed Nov 28 19:49:43 2012
From: gsee000 at gmail.com (G See)
Date: Wed, 28 Nov 2012 12:49:43 -0600
Subject: [Rd] str(..., strict.width="wrap") changes alignment of colons
Message-ID: <CA+xi=qZEf+wq3xTTCZzUbChXDH9vdkYqyNkLCz9PM8gPpinKdg@mail.gmail.com>

Hi,

This was surprising to me and does not appear to be documented in
?str.  After reading ?strwrap, I see that the problem is that
"Whitespace ... in the input is destroyed".  However, I thought I'd
mention it because I'm not sure it is intended behavior for str().

I have a list, and the names of the list have a variable number of characters.

> x <- list(A=1:10, ABCDEF=LETTERS[1:10])
> str(x)
List of 2
 $ A     : int [1:10] 1 2 3 4 5 6 7 8 9 10
 $ ABCDEF: chr [1:10] "A" "B" "C" "D" ...

The above looks as expected in my R session (although it looks a
little different when I paste it into this e-mail).  There are 5
spaces between the A and the colon.  i.e. there are the same number of
characters before the colon for both components of the list.

However, if I use strict.width="wrap", the colons (:) are no longer aligned

> str(x, width=20, strict.width='wrap')
List of 2
$ A : int [1:10] 1
   2 3 4 5 6 7 8 9
   10
$ ABCDEF: chr
   [1:10] "A" "B"
   "C" "D" ...

Notice that now there is only 1 space between the A and the colon instead of 5.

It looks like the call to strwrap() is causing the issue (i.e.
destroying whitespace as it is documented to do).

This is fine:

> cat(capture.output(utils:::str.default(x)), sep="\n")
List of 2
 $ A     : int [1:10] 1 2 3 4 5 6 7 8 9 10
 $ ABCDEF: chr [1:10] "A" "B" "C" "D" ...

This isn't:

> cat(strwrap(capture.output(utils:::str.default(x)), 20), sep="\n")
List of 2
$ A : int [1:10] 1
2 3 4 5 6 7 8 9 10
$ ABCDEF: chr
[1:10] "A" "B" "C"
"D" ...

I'm wondering if it would be possible for the call to strwrap() to not
include `indent.str`, `comp.str`, or the component names; then those
things could be added afterwards.   Although, I guess that probably
requires adding an argument to str.default to control whether names
are printed or not.

Regards,
Garrett


From diggsb at ohsu.edu  Wed Nov 28 22:39:57 2012
From: diggsb at ohsu.edu (Brian Diggs)
Date: Wed, 28 Nov 2012 13:39:57 -0800
Subject: [Rd] No R 2.15.2 or R 2.15.2 patched version option in bug tracker
Message-ID: <50B684AD.9010808@ohsu.edu>

When I went to report a (very minor) bug today, I noticed that under the 
choices for Version, there was no entry for "R 2.15.2" nor "R 2.15.2 
patched". I could not find a contact email for the bug tracker itself, 
so I figured the next best place to send this was r-devel. Perhaps 
adding new versions to the version choices should also be added to 
http://developer.r-project.org/release-checklist.html

-- 
Brian S. Diggs, PhD
Senior Research Associate, Department of Surgery
Oregon Health & Science University


From schmidt at math.utk.edu  Wed Nov 28 23:12:24 2012
From: schmidt at math.utk.edu (Drew Schmidt)
Date: Wed, 28 Nov 2012 17:12:24 -0500 (EST)
Subject: [Rd] S3 generic/method consistency issue with R CMD check
In-Reply-To: <mailman.17.1353582006.31768.r-devel@r-project.org>
References: <mailman.17.1353582006.31768.r-devel@r-project.org>
Message-ID: <54733.192.188.177.13.1354140744.squirrel@math.utk.edu>

More on this.  It looks to me like there is some kind of issue
specifically with the qr and qr.* functions in R CMD check, as my last
email suggests.  Additionally, by changing the dispatch of the qr.*
functions from y to x (in this example), such as:


setGeneric(name="qr.Q",
  function(x, ...)
    standardGeneric("qr.Q"),
)

setMethod("qr.Q", signature(x="bar"),
  function(x, ...) { }
)


we avoid the WARNING.  So too does:


setGeneric(name="qr_Q",
  function(y, ...)
    standardGeneric("qr_Q")
)

setMethod("qr_Q", signature(y="bar"),
  function(y, ...) { }
)


avoid the WARNING.

This suggests to me that R CMD check is incorrectly using "qr"'s dispatch
for "qr.Q", even when we specify "qr.Q" as S4 generic with dispatch y. 
More to the point, it looks to me like R CMD check is applying S3 rules to
S4 methods for this specific set of base:: functions.

Not sure how else to interpret what I'm seeing here, but I still have
doubts as to my understanding of this issue.  Would very much appreciate
some insight.

Apologies in advance if I botch the reply threading; I am using a very
limited webmail client and I'm not sure if this will work properly.

--
Drew Schmidt
National Institute for Computational Sciences
University of Tennessee


From h.wickham at gmail.com  Thu Nov 29 00:21:38 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Wed, 28 Nov 2012 17:21:38 -0600
Subject: [Rd] Opening and closing quartz graphic device crashes R
Message-ID: <CABdHhvEBSM1yyfPEcnfGChqo6h__NpDGGgVuEU5BiENkDsU5RQ@mail.gmail.com>

> replicate(1000, {dev.new(); dev.off()})
R(83204,0xacdc1a28) malloc: *** mmap(size=16777216) failed (error code=12)
*** error: can't allocate region
*** set a breakpoint in malloc_error_break to debug
R(83204,0xacdc1a28) malloc: *** mmap(size=16777216) failed (error code=12)
*** error: can't allocate region
*** set a breakpoint in malloc_error_break to debug
...
 *** caught bus error ***
address 0x0, cause 'non-existent physical address'

> sessionInfo()
R version 2.15.2 (2012-10-26)
Platform: i386-apple-darwin9.8.0/i386 (32-bit)

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


-- 
RStudio / Rice University
http://had.co.nz/


From vitaliy.feoktistov at gmail.com  Wed Nov 28 17:11:39 2012
From: vitaliy.feoktistov at gmail.com (Vitaliy FEOKTISTOV)
Date: Wed, 28 Nov 2012 17:11:39 +0100
Subject: [Rd] compiling R for Windows with Intel compiliers and MKL
Message-ID: <CAGHrqz_kh-uZAkDrHNVfHqbQtKPB6rytobmUN+zHiCaGeVhzOQ@mail.gmail.com>

Hello,

I want to compile R-2.15.2 for Windows with Intel compilers and MKL(
BLAS, LAPACK).
I installed 'Rtools  2.16.0.1923' and follow the instructions of "R
installation and administration" guide (3.1; A.3.1.4; C.2.2).
I configured "/src/gnuwin32/MkRules.local" and "config.site" according
to needed environmental variables (icc, ifort, icpc, mkl..)

When compiling from "/src/gnuwin32/Makefile" the instructions of
"config.site" have not been taking in consideration.

I would like to ask you if you could give me more detailed
instructions on how to compile R for Windows by Intel compilers,
please ?

Thank you in advance !


From ludo.pagie at gmail.com  Wed Nov 28 15:40:20 2012
From: ludo.pagie at gmail.com (Ludo Pagie)
Date: Wed, 28 Nov 2012 15:40:20 +0100
Subject: [Rd] [R] error in plot(table(c('a','a')))
In-Reply-To: <CAAmySGO8Wx05spC+95QAAPjndphmHnAOusKirQ8DQweDKf+9UA@mail.gmail.com>
References: <3cb3bdb5b91966573be20763f50c4f71.squirrel@webmail.xs4all.nl>
	<CAAmySGNQPL-vq5fFpS1YHc7YF2xar_18XhThO_8DQPxPxcS6Aw@mail.gmail.com>
	<50B3FC84.3080400@sapo.pt>
	<CAAmySGO8Wx05spC+95QAAPjndphmHnAOusKirQ8DQweDKf+9UA@mail.gmail.com>
Message-ID: <CACpoUFUzioWyh-H_JvbYx1Qbtt0PNvONw-ZSkjXutZuC-6AvoQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121128/a43857fe/attachment.pl>

From ralmond at macosx.com  Wed Nov 28 18:19:37 2012
From: ralmond at macosx.com (Russell Almond)
Date: Wed, 28 Nov 2012 12:19:37 -0500
Subject: [Rd] R CMD check --force-biarch
Message-ID: <005201cdcd8c$93e24ed0$bba6ec70$@macosx.com>

I'm having problems getting R CMD check to work correctly on Windows 7 (64
bit) in a package that uses C code.  What I want to do is to be able to pass
the equivalent of the "--force-biarch" option to check, but this is only
supported for INSTALL.

Background:
I'm writing a package (RNetica) which forms a link between R and a
third-party library (Netica.dll).  The vendor supplies this library in both
a 32 bit and a 64 bit version.
Under Linux, I use configure to link against the 32 or 64 bit version of
libnetica.a as appropriate.
Under Windows, I use configure.win to copy the 32 and 64 bit versions to
"$R_PACKAGE_DIR/libs/i386"  and "$R_PACKAGE_DIR/libs/x64" respectively.

Installation:
This mostly works.  If I run R CMD INSTALL RNetica, R detects the
configure.win and only builds the 64 bit version of RNetica.  [I'm not
entirely clear on why R doesn't at least try to build both architectures.
Wouldn't the default assumption be that the author wrote the configure.win
file to handle both cases?]  But if I use R CMD INSTALL RNetica
--force-biarch, it correctly builds and installs both the 32 and 64 bit
versions.  I can verify that I can load my library and call a few functions
that exercise the DLL.

Checking:
 When I run R CMD check RNetica, I get the following problem in my
00install.out log:
> Warning: this package has a non-empty 'configure.win' file,
> so building only the main architecture
It then fails with the message:
> Error:  .onLoad failed in loadNamespace() for 'RNetica', details:
>   Call:  library.dynam("RNetica",pkgname, libname)
>   Error:  DLL 'RNetica' not found:  maybe not installed for this
architecture?
Sure enough, if I check the directory RNetica.Rcheck/RNetica/libs/x64
It has Netica.dll, RNetica.dll, and symbols.rds
If I check the directory RNetica.Rcheck/RNetica/libs/i386
It only has Netica.dll (copied there by the configure.win).

If I run R CMD check RNetica --no-multiarch, this test runs correctly (only
a few warnings about missing Rd files).
If I run R CMD check RNetica --extra-arch, this fails at the same point.

What I think I need to do is somehow pass --force-biarch to the installation
phase of the check script, but --force-biarch is not a legal argument to R
CMD check, and I'm not sure how to quote it.

Thanks in advance for any help.



Russell Almond
ralmond at fsu.edu
almond at acm.org
http://ralmond.net/


From rbaer at atsu.edu  Thu Nov 29 00:42:24 2012
From: rbaer at atsu.edu (Robert Baer)
Date: Wed, 28 Nov 2012 17:42:24 -0600
Subject: [Rd] Opening and closing quartz graphic device crashes R
In-Reply-To: <CABdHhvEBSM1yyfPEcnfGChqo6h__NpDGGgVuEU5BiENkDsU5RQ@mail.gmail.com>
References: <CABdHhvEBSM1yyfPEcnfGChqo6h__NpDGGgVuEU5BiENkDsU5RQ@mail.gmail.com>
Message-ID: <50B6A160.8000801@atsu.edu>

On 11/28/2012 5:21 PM, Hadley Wickham wrote:
>> replicate(1000, {dev.new(); dev.off()})
> R(83204,0xacdc1a28) malloc: *** mmap(size=16777216) failed (error code=12)
> *** error: can't allocate region
> *** set a breakpoint in malloc_error_break to debug
> R(83204,0xacdc1a28) malloc: *** mmap(size=16777216) failed (error code=12)
> *** error: can't allocate region
> *** set a breakpoint in malloc_error_break to debug
> ...
>   *** caught bus error ***
> address 0x0, cause 'non-existent physical address'
>
>> sessionInfo()
> R version 2.15.2 (2012-10-26)
> Platform: i386-apple-darwin9.8.0/i386 (32-bit)
>
> locale:
> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
>
For what its worth, I couldn't reproduce this on 64-bit or 32-bit R GUI 
consoles.

Rob
----------------------------
64-bit windows:
null device null device null device null device null device null device
-- snip --
           1           1           1           1 1           1
null device null device null device null device
           1           1           1           1
 > sessionInfo()
R version 2.15.2 (2012-10-26)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods base



32-bit windows:

windows windows windows windows windows windows windows windows windows 
windows
       2       2       2       2       2       2       2 2       2       2
-- snip --
windows windows windows windows windows windows windows windows windows 
windows
       2       2       2       2       2       2       2 2       2       2
 > sessionInfo()
R version 2.15.2 (2012-10-26)
Platform: i386-w64-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods base
 >


-- 
__________________
Robert W. Baer, Ph.D.
Professor of Physiology
Kirksille College of Osteopathic Medicine
A. T. Still University of Health Sciences
Kirksville, MO 63501 USA


From simon.urbanek at r-project.org  Thu Nov 29 03:19:06 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 28 Nov 2012 21:19:06 -0500
Subject: [Rd] No R 2.15.2 or R 2.15.2 patched version option in bug
	tracker
In-Reply-To: <50B684AD.9010808@ohsu.edu>
References: <50B684AD.9010808@ohsu.edu>
Message-ID: <61A2C32E-0864-4528-A045-AF142EFE6FCD@r-project.org>

Thanks, added.
Simon

On Nov 28, 2012, at 4:39 PM, Brian Diggs wrote:

> When I went to report a (very minor) bug today, I noticed that under the choices for Version, there was no entry for "R 2.15.2" nor "R 2.15.2 patched". I could not find a contact email for the bug tracker itself, so I figured the next best place to send this was r-devel. Perhaps adding new versions to the version choices should also be added to http://developer.r-project.org/release-checklist.html
> 
> -- 
> Brian S. Diggs, PhD
> Senior Research Associate, Department of Surgery
> Oregon Health & Science University
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From hb at biostat.ucsf.edu  Thu Nov 29 03:25:21 2012
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Wed, 28 Nov 2012 18:25:21 -0800
Subject: [Rd] Non-recursive way to remove empty directory on Windows?
Message-ID: <CAFDcVCRTbVYWK_nGNSwObCmUzQySoqtPgOwLE5RO1wdzEGdcDQ@mail.gmail.com>

Hi,

file.remove(path) will remove an empty directory "on most Unix
platforms", but not on Windows, cf. help("file.remove").  A workaround
for Windows is then unlink(path, recursive=TRUE).  However, unless
you're really careful and make sure 'path' is not empty, you may
delete more than you wish (even worse, path may contain '..' or
likewise from a list.files(all.names=TRUE) call).  Is there another
*non-recursive* way to delete a single empty directory on Windows
(without turning to system() calls)?

Thanks,

Henrik


From wdunlap at tibco.com  Thu Nov 29 03:36:54 2012
From: wdunlap at tibco.com (William Dunlap)
Date: Thu, 29 Nov 2012 02:36:54 +0000
Subject: [Rd] Non-recursive way to remove empty directory on Windows?
In-Reply-To: <CAFDcVCRTbVYWK_nGNSwObCmUzQySoqtPgOwLE5RO1wdzEGdcDQ@mail.gmail.com>
References: <CAFDcVCRTbVYWK_nGNSwObCmUzQySoqtPgOwLE5RO1wdzEGdcDQ@mail.gmail.com>
Message-ID: <E66794E69CFDE04D9A70842786030B931B8BD0CC@PA-MBX01.na.tibco.com>

> (even worse, path may contain '..' or
> likewise from a list.files(all.names=TRUE) call)

Would anyone's code break if "." and ".." were never in the output of
list.files() (or dir())?  I find it tedious to skip them
whenever doing anything recursive in the file system.  They are
not in the output of the unix find command and no one misses them
there.

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com


> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf
> Of Henrik Bengtsson
> Sent: Wednesday, November 28, 2012 6:25 PM
> To: R-devel
> Subject: [Rd] Non-recursive way to remove empty directory on Windows?
> 
> Hi,
> 
> file.remove(path) will remove an empty directory "on most Unix
> platforms", but not on Windows, cf. help("file.remove").  A workaround
> for Windows is then unlink(path, recursive=TRUE).  However, unless
> you're really careful and make sure 'path' is not empty, you may
> delete more than you wish (even worse, path may contain '..' or
> likewise from a list.files(all.names=TRUE) call).  Is there another
> *non-recursive* way to delete a single empty directory on Windows
> (without turning to system() calls)?
> 
> Thanks,
> 
> Henrik
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Thu Nov 29 07:25:02 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 29 Nov 2012 06:25:02 +0000
Subject: [Rd] R CMD check --force-biarch
In-Reply-To: <005201cdcd8c$93e24ed0$bba6ec70$@macosx.com>
References: <005201cdcd8c$93e24ed0$bba6ec70$@macosx.com>
Message-ID: <50B6FFBE.7070002@stats.ox.ac.uk>

 From R CMD check --help

       --install-args=	command-line args to be passed to INSTALL

I am pretty sure you have been pointed at that before, and we checked at 
the time that it worked on Windows.

On 28/11/2012 17:19, Russell Almond wrote:
> I'm having problems getting R CMD check to work correctly on Windows 7 (64
> bit) in a package that uses C code.  What I want to do is to be able to pass
> the equivalent of the "--force-biarch" option to check, but this is only
> supported for INSTALL.
>
> Background:
> I'm writing a package (RNetica) which forms a link between R and a
> third-party library (Netica.dll).  The vendor supplies this library in both
> a 32 bit and a 64 bit version.
> Under Linux, I use configure to link against the 32 or 64 bit version of
> libnetica.a as appropriate.
> Under Windows, I use configure.win to copy the 32 and 64 bit versions to
> "$R_PACKAGE_DIR/libs/i386"  and "$R_PACKAGE_DIR/libs/x64" respectively.
>
> Installation:
> This mostly works.  If I run R CMD INSTALL RNetica, R detects the
> configure.win and only builds the 64 bit version of RNetica.  [I'm not
> entirely clear on why R doesn't at least try to build both architectures.
> Wouldn't the default assumption be that the author wrote the configure.win
> file to handle both cases?]  But if I use R CMD INSTALL RNetica
> --force-biarch, it correctly builds and installs both the 32 and 64 bit
> versions.  I can verify that I can load my library and call a few functions
> that exercise the DLL.
>
> Checking:
>   When I run R CMD check RNetica, I get the following problem in my
> 00install.out log:
>> Warning: this package has a non-empty 'configure.win' file,
>> so building only the main architecture
> It then fails with the message:
>> Error:  .onLoad failed in loadNamespace() for 'RNetica', details:
>>    Call:  library.dynam("RNetica",pkgname, libname)
>>    Error:  DLL 'RNetica' not found:  maybe not installed for this
> architecture?
> Sure enough, if I check the directory RNetica.Rcheck/RNetica/libs/x64
> It has Netica.dll, RNetica.dll, and symbols.rds
> If I check the directory RNetica.Rcheck/RNetica/libs/i386
> It only has Netica.dll (copied there by the configure.win).
>
> If I run R CMD check RNetica --no-multiarch, this test runs correctly (only
> a few warnings about missing Rd files).
> If I run R CMD check RNetica --extra-arch, this fails at the same point.
>
> What I think I need to do is somehow pass --force-biarch to the installation
> phase of the check script, but --force-biarch is not a legal argument to R
> CMD check, and I'm not sure how to quote it.
>
> Thanks in advance for any help.
>
>
>
> Russell Almond
> ralmond at fsu.edu
> almond at acm.org
> http://ralmond.net/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From suharto_anggono at yahoo.com  Thu Nov 29 17:27:48 2012
From: suharto_anggono at yahoo.com (Suharto Anggono Suharto Anggono)
Date: Thu, 29 Nov 2012 08:27:48 -0800 (PST)
Subject: [Rd] Use of 'match' in end part of 'levels<-.factor'
Message-ID: <1354206468.57229.BPMail_low_carrier@web125105.mail.ne1.yahoo.com>


match(xlevs[x], nlevs)
is equivalent to
match(xlevs, nlevs)[x]
The latter has an advantage. In the latter, an element of 'xlevs' is onlz once matched against 'nlevs'. In the former, the same element is repeatedly matched if it is selected multiple times by 'x'.

In end part of the code of function 'levels<-.factor', there is
y <- match(xlevs[x], nlevs)
It is still there in R 2.15.2. I suggest changing it to
y <- match(xlevs, nlevs)[x]

However,
match(xlevs[x], nlevs)
is more efficient than
match(xlevs, nlevs)
if xlevs[x] is short compared to xlevs. In 'levels<-.factor', a compromise may be using something like
y <- if (length(x) <=
length(xlevs))
match(xlevs[x], nlevs) else
match(xlevs, nlevs)[x]


From vitaliy.feoktistov at gmail.com  Fri Nov 30 09:35:19 2012
From: vitaliy.feoktistov at gmail.com (Vitaliy FEOKTISTOV)
Date: Fri, 30 Nov 2012 09:35:19 +0100
Subject: [Rd] compiling R for Windows 64 bit
Message-ID: <CAGHrqz-P=-Q306XtMfnmHC4Z_srr-E4PqGHQHDZduj8yyZZb9w@mail.gmail.com>

Dear All,

I'm trying to compile R for Windows 64 bit.

I'm following the instructions of R installation and administration
guide v2.15.2 (3.1; A.3.1.4; C.2.2)
and at the moment I compiled the default version (single threaded,
gcc, without external BLAS) ?on my notebook (windows xp 32 bit)

Now I'm trying to compile it on Windows servers 64 bit with the next
configuration :

1. Windows Server 2008 R2 Entreprise SP1 x64bits ; Proc: AMD Opteron
6172 2Ghz (x4 processors)
2. Windows Server 2003 R2 Entreprise SP2 x64bits ; Proc: Intel Xeon
5160 3Ghz (x4 processors)

I configured '/src/gnuwin32/MkRules.local' and 'config.site' as
described in R installation guide.

And there are at least 2 problems during the compilation :
1. 'make all recommended' does not see 'config.site' so the
environmental variables are not updated properly,
shell sh.exe ./configure also gives error
2. at the linking step the file 'Rgraphapp.dll' can not be created, as
I suppose according to uncorrect x32 - x64 configuration (it links
32bits external libs to 64bits object files)

I would be very greatful if you could help me to compile R, please.

Thank you very much !!

==============
  MkRules.local
==============
G_FLAG=-gdwarf-2
LEA_MALLOC=YES
USE_ATLAS=NO
BINPREF64 = C:/Rtools/gcc-4.6.3/bin/
WIN = 64
BUILD_HTML = NO
MIKTEX = TRUE
EOPTS=-mtune=native
OPENMP = -fopenmp
PTHREAD = -pthread


From vitaliy.feoktistov at gmail.com  Fri Nov 30 10:29:05 2012
From: vitaliy.feoktistov at gmail.com (Vitaliy FEOKTISTOV)
Date: Fri, 30 Nov 2012 10:29:05 +0100
Subject: [Rd] compiling R for Windows 64 bit
In-Reply-To: <CAGHrqz-P=-Q306XtMfnmHC4Z_srr-E4PqGHQHDZduj8yyZZb9w@mail.gmail.com>
References: <CAGHrqz-P=-Q306XtMfnmHC4Z_srr-E4PqGHQHDZduj8yyZZb9w@mail.gmail.com>
Message-ID: <CAGHrqz_vpT--5WDjFkJBYMe-UKp99GCxUKhWOQ=D6+5MC+g=kA@mail.gmail.com>

(rem:  this message describes compiling errors more precisely)

 Dear All,

 I'm trying to compile R for Windows 64 bit.

 I'm following the instructions of R installation and administration
 guide v2.15.2 (3.1; A.3.1.4; C.2.2)
 and at the moment I compiled the default version (single threaded,
 gcc, without external BLAS)  on my notebook (windows xp 32 bit)

 Now I'm trying to compile it on Windows servers 64 bit with the next
 configuration :

 1. Windows Server 2008 R2 Entreprise SP1 x64bits ; Proc: AMD Opteron
 6172 2Ghz (x4 processors)
 2. Windows Server 2003 R2 Entreprise SP2 x64bits ; Proc: Intel Xeon
 5160 3Ghz (x4 processors)

 I configured '/src/gnuwin32/MkRules.local' and 'config.site' as
 described in R installation guide.

 And there are at least 2 problems during the compilation :
 1. 'make all recommended' does not see 'config.site' so the
 environmental variables are not updated properly,
 shell sh.exe ./configure also gives error
 2. at the linking step the file 'Rgraphapp.dll' can not be created, as
 I suppose according to incorrect x32 - x64 configuration (it links
 32bits external libs to 64bits object files, see below)

 I would be very grateful if you could help me to compile R, please.

 Thank you very much !!

==============
   MkRules.local
==============
LOCAL_SOFT =
G_FLAG=-gdwarf-2
LEA_MALLOC=YES
USE_ATLAS=NO
ATLAS_PATH=/R/ATLAS/lib/WinNT_P4SSE2
# USE_SVNVERSION = YES
MULTI = 64
TOOL_PATH =
BINPREF =
BINPREF64 =
M_ARCH = -m64
AS_ARCH = --64
RC_ARCH = pe-x86-64
DT_ARCH = "-m i386:x86-64 --as-flags --64"
WIN =  64
# USE_IMPLIBS = YES
# USE_ICU=YES
ICU_PATH=/sources/icu
# JPEGDIR = jpeg-8d
# PNGDIR = libpng
# TIFFDIR = libtiff
CAIRO_HOME = D:/R/cairo/src
BUILD_HTML = YES
MIKTEX = TRUE
EOPTS=-mtune=native
OPENMP = -fopenmp
PTHREAD = -pthread
ISDIR=C:/Program Files/Inno Setup 5
QPDF=
HOME32=
DLLs32 =
DLLs64 =
WIX3DIR=C:/Program Files/WiX Toolset v3.7/bin
WIX_PERSONAL=0

===================
  compilation errors
===================
gcc -std=gnu99 -m64 -shared -mwindows -o Rgraphapp.dll Rgraphapp.def arith.o ar
ay.o bitmaps.o buttons.o clipboard.o context.o controls.o cursors.o dialogs.o d
awing.o drawtext.o events.o fonts.o gbuttons.o gdraw.o gif.o gimage.o gmenus.o
mage.o init.o menus.o metafile.o objects.o printer.o rgb.o status.o stdimg.o st
ings.o tooltips.o windows.o dllversion.o -L. -lR -lcomctl32 -limm32 -lmsimg32
c:/rtools/gcc-4.6.3/bin/../lib/gcc/i686-w64-mingw32/4.6.3/../../../../i686-w64-
ingw32/bin/ld.exe: skipping incompatible ./libR.dll.a when searching for -lR
c:/rtools/gcc-4.6.3/bin/../lib/gcc/i686-w64-mingw32/4.6.3/../../../../i686-w64-
ingw32/bin/ld.exe: skipping incompatible ./libR.dll.a when searching for -lR
c:/rtools/gcc-4.6.3/bin/../lib/gcc/i686-w64-mingw32/4.6.3/../../../../i686-w64-
ingw32/bin/ld.exe: cannot find -lR
collect2: ld returned 1 exit status
make[4]: *** [Rgraphapp.dll] Error 1
make[3]: *** [rlibs] Error 1
make[2]: *** [../../bin/x64/R.dll] Error 2
make[1]: *** [rbuild] Error 2
make: *** [all] Error 2


From ripley at stats.ox.ac.uk  Fri Nov 30 11:16:44 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 30 Nov 2012 10:16:44 +0000
Subject: [Rd] compiling R for Windows 64 bit
In-Reply-To: <CAGHrqz_vpT--5WDjFkJBYMe-UKp99GCxUKhWOQ=D6+5MC+g=kA@mail.gmail.com>
References: <CAGHrqz-P=-Q306XtMfnmHC4Z_srr-E4PqGHQHDZduj8yyZZb9w@mail.gmail.com>
	<CAGHrqz_vpT--5WDjFkJBYMe-UKp99GCxUKhWOQ=D6+5MC+g=kA@mail.gmail.com>
Message-ID: <50B8878C.40806@stats.ox.ac.uk>

1) It seems you forgot to clean up before making a 64-bit build:

> skipping incompatible ./libR.dll.a when searching for -lR

I expect that is a 32-bit version you made earlier (but you did not show 
us the line which made it).


2) You did not read the manual carefully enough: config.site is used by 
'configure' on a Unix-alike: it is not mentioned under Windows where you 
do not run 'configure' as only a very limited set of tools is available.


On 30/11/2012 09:29, Vitaliy FEOKTISTOV wrote:
> (rem:  this message describes compiling errors more precisely)
>
>   Dear All,
>
>   I'm trying to compile R for Windows 64 bit.
>
>   I'm following the instructions of R installation and administration
>   guide v2.15.2 (3.1; A.3.1.4; C.2.2)
>   and at the moment I compiled the default version (single threaded,
>   gcc, without external BLAS)  on my notebook (windows xp 32 bit)
>
>   Now I'm trying to compile it on Windows servers 64 bit with the next
>   configuration :
>
>   1. Windows Server 2008 R2 Entreprise SP1 x64bits ; Proc: AMD Opteron
>   6172 2Ghz (x4 processors)
>   2. Windows Server 2003 R2 Entreprise SP2 x64bits ; Proc: Intel Xeon
>   5160 3Ghz (x4 processors)
>
>   I configured '/src/gnuwin32/MkRules.local' and 'config.site' as
>   described in R installation guide.
>
>   And there are at least 2 problems during the compilation :
>   1. 'make all recommended' does not see 'config.site' so the
>   environmental variables are not updated properly,
>   shell sh.exe ./configure also gives error
>   2. at the linking step the file 'Rgraphapp.dll' can not be created, as
>   I suppose according to incorrect x32 - x64 configuration (it links
>   32bits external libs to 64bits object files, see below)
>
>   I would be very grateful if you could help me to compile R, please.
>
>   Thank you very much !!
>
> ==============
>     MkRules.local
> ==============
> LOCAL_SOFT =
> G_FLAG=-gdwarf-2
> LEA_MALLOC=YES
> USE_ATLAS=NO
> ATLAS_PATH=/R/ATLAS/lib/WinNT_P4SSE2
> # USE_SVNVERSION = YES
> MULTI = 64
> TOOL_PATH =
> BINPREF =
> BINPREF64 =
> M_ARCH = -m64
> AS_ARCH = --64
> RC_ARCH = pe-x86-64
> DT_ARCH = "-m i386:x86-64 --as-flags --64"
> WIN =  64
> # USE_IMPLIBS = YES
> # USE_ICU=YES
> ICU_PATH=/sources/icu
> # JPEGDIR = jpeg-8d
> # PNGDIR = libpng
> # TIFFDIR = libtiff
> CAIRO_HOME = D:/R/cairo/src
> BUILD_HTML = YES
> MIKTEX = TRUE
> EOPTS=-mtune=native
> OPENMP = -fopenmp
> PTHREAD = -pthread
> ISDIR=C:/Program Files/Inno Setup 5
> QPDF=
> HOME32=
> DLLs32 =
> DLLs64 =
> WIX3DIR=C:/Program Files/WiX Toolset v3.7/bin
> WIX_PERSONAL=0
>
> ===================
>    compilation errors
> ===================
> gcc -std=gnu99 -m64 -shared -mwindows -o Rgraphapp.dll Rgraphapp.def arith.o ar
> ay.o bitmaps.o buttons.o clipboard.o context.o controls.o cursors.o dialogs.o d
> awing.o drawtext.o events.o fonts.o gbuttons.o gdraw.o gif.o gimage.o gmenus.o
> mage.o init.o menus.o metafile.o objects.o printer.o rgb.o status.o stdimg.o st
> ings.o tooltips.o windows.o dllversion.o -L. -lR -lcomctl32 -limm32 -lmsimg32
> c:/rtools/gcc-4.6.3/bin/../lib/gcc/i686-w64-mingw32/4.6.3/../../../../i686-w64-
> ingw32/bin/ld.exe: skipping incompatible ./libR.dll.a when searching for -lR
> c:/rtools/gcc-4.6.3/bin/../lib/gcc/i686-w64-mingw32/4.6.3/../../../../i686-w64-
> ingw32/bin/ld.exe: skipping incompatible ./libR.dll.a when searching for -lR
> c:/rtools/gcc-4.6.3/bin/../lib/gcc/i686-w64-mingw32/4.6.3/../../../../i686-w64-
> ingw32/bin/ld.exe: cannot find -lR
> collect2: ld returned 1 exit status
> make[4]: *** [Rgraphapp.dll] Error 1
> make[3]: *** [rlibs] Error 1
> make[2]: *** [../../bin/x64/R.dll] Error 2
> make[1]: *** [rbuild] Error 2
> make: *** [all] Error 2
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Fri Nov 30 11:47:07 2012
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 30 Nov 2012 11:47:07 +0100
Subject: [Rd] Non-recursive way to remove empty directory on Windows?
In-Reply-To: <E66794E69CFDE04D9A70842786030B931B8BD0CC@PA-MBX01.na.tibco.com>
References: <CAFDcVCRTbVYWK_nGNSwObCmUzQySoqtPgOwLE5RO1wdzEGdcDQ@mail.gmail.com>
	<E66794E69CFDE04D9A70842786030B931B8BD0CC@PA-MBX01.na.tibco.com>
Message-ID: <20664.36523.558635.276294@stat.math.ethz.ch>

>>>>> William Dunlap <wdunlap at tibco.com>
>>>>>     on Thu, 29 Nov 2012 02:36:54 +0000 writes:

    >> (even worse, path may contain '..' or
    >> likewise from a list.files(all.names=TRUE) call)

    > Would anyone's code break if "." and ".." were never in the output of
    > list.files() (or dir())?  I find it tedious to skip them
    > whenever doing anything recursive in the file system.  They are
    > not in the output of the unix find command and no one misses them
    > there.

At first, I've tended to agree with your implicit proposal.
I wouldn't be suprised if someone's code broke from such a
change, but then I think "Some One" gets what (s)he deserves  ...

But I'm less sure now that I've looked into the issue in more
details:
If you use 

(1)   list.files(*, all.files=TRUE)     # sic!  'all.names' does not exist

you implicitly say  'recursive=FALSE' , where

(2)   list.files(*, recursive=TRUE, ...)

implicitly contains  'include.dirs=FALSE'
on which the help page says

include.dirs: logical.  Should subdirectory names be included in
          recursive listings?  (There always are in non-recursive ones).

  {with a typo   s/There/They/  which I've corrected just now}

Hence, call  (2)   always excludes  "." and ".."

Would you reall see the need for an option to exclude "." and ".." also from
the non-recursive calls?

Martin Maechler,  ETH Zurich

    > Bill Dunlap
    > Spotfire, TIBCO Software
    > wdunlap tibco.com


    >> -----Original Message-----
    >> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf
    >> Of Henrik Bengtsson
    >> Sent: Wednesday, November 28, 2012 6:25 PM
    >> To: R-devel
    >> Subject: [Rd] Non-recursive way to remove empty directory on Windows?
    >> 
    >> Hi,
    >> 
    >> file.remove(path) will remove an empty directory "on most Unix
    >> platforms", but not on Windows, cf. help("file.remove").  A workaround
    >> for Windows is then unlink(path, recursive=TRUE).  However, unless
    >> you're really careful and make sure 'path' is not empty, you may
    >> delete more than you wish (even worse, path may contain '..' or
    >> likewise from a list.files(all.names=TRUE) call).  Is there another
    >> *non-recursive* way to delete a single empty directory on Windows
    >> (without turning to system() calls)?
    >> 
    >> Thanks,
    >> 
    >> Henrik


From maechler at stat.math.ethz.ch  Fri Nov 30 12:51:59 2012
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 30 Nov 2012 12:51:59 +0100
Subject: [Rd] Non-recursive way to remove empty directory on Windows?
In-Reply-To: <20664.36523.558635.276294@stat.math.ethz.ch>
References: <CAFDcVCRTbVYWK_nGNSwObCmUzQySoqtPgOwLE5RO1wdzEGdcDQ@mail.gmail.com>
	<E66794E69CFDE04D9A70842786030B931B8BD0CC@PA-MBX01.na.tibco.com>
	<20664.36523.558635.276294@stat.math.ethz.ch>
Message-ID: <20664.40415.19905.55493@stat.math.ethz.ch>

>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Fri, 30 Nov 2012 11:47:07 +0100 writes:

>>>>> William Dunlap <wdunlap at tibco.com>
>>>>>     on Thu, 29 Nov 2012 02:36:54 +0000 writes:

    >>> (even worse, path may contain '..' or
    >>> likewise from a list.files(all.names=TRUE) call)

    >> Would anyone's code break if "." and ".." were never in the output of
    >> list.files() (or dir())?  I find it tedious to skip them
    >> whenever doing anything recursive in the file system.  They are
    >> not in the output of the unix find command and no one misses them
    >> there.

    > At first, I've tended to agree with your implicit proposal.
    > I wouldn't be suprised if someone's code broke from such a
    > change, but then I think "Some One" gets what (s)he deserves  ...

    > But I'm less sure now that I've looked into the issue in more
    > details:
    > If you use 

    > (1)   list.files(*, all.files=TRUE)     # sic!  'all.names' does not exist

    > you implicitly say  'recursive=FALSE' , where

    > (2)   list.files(*, recursive=TRUE, ...)

    > implicitly contains  'include.dirs=FALSE'
    > on which the help page says

    > include.dirs: logical.  Should subdirectory names be included in
    > recursive listings?  (There always are in non-recursive ones).

    > {with a typo   s/There/They/  which I've corrected just now}

    > Hence, call  (2)   always excludes  "." and ".."

    > Would you reall see the need for an option to exclude "."
    > and ".." also from the non-recursive calls?

well,... and inspite of the above question,
as I know Bill Dunlap's good judgement and as it appeared to be
nicely implementable, I've still provided such an option now (R-devel only) :

------------------------------------------------------------------------
r61184 | maechler | 2012-11-30 12:47:23 +0100 (Fri, 30 Nov 2012) | 1 line
Changed paths:
   M doc/NEWS.Rd
   M src/library/base/R/files.R
   M src/library/base/man/list.files.Rd
   M src/main/names.c
   M src/main/platform.c

list.files() gains a new optional argument "no.."
------------------------------------------------------------------------

One might discuss if we should change the current
back-compatible default 
from  'no.. = FALSE'  to  'no.. = TRUE'

and someone may want to try to do that in R-devel *and* check
all of CRAN (and Bioconductor ?) to see if some package code
breaks because of such a change...

    > Martin Maechler,  ETH Zurich

    >> Bill Dunlap
    >> Spotfire, TIBCO Software
    >> wdunlap tibco.com


    >>> -----Original Message-----
    >>> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf
    >>> Of Henrik Bengtsson
    >>> Sent: Wednesday, November 28, 2012 6:25 PM
    >>> To: R-devel
    >>> Subject: [Rd] Non-recursive way to remove empty directory on Windows?
    >>> 
    >>> Hi,
    >>> 
    >>> file.remove(path) will remove an empty directory "on most Unix
    >>> platforms", but not on Windows, cf. help("file.remove").  A workaround
    >>> for Windows is then unlink(path, recursive=TRUE).  However, unless
    >>> you're really careful and make sure 'path' is not empty, you may
    >>> delete more than you wish (even worse, path may contain '..' or
    >>> likewise from a list.files(all.names=TRUE) call).  Is there another
    >>> *non-recursive* way to delete a single empty directory on Windows
    >>> (without turning to system() calls)?
    >>> 
    >>> Thanks,
    >>> 
    >>> Henrik

    > ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel


From therneau at mayo.edu  Fri Nov 30 13:53:36 2012
From: therneau at mayo.edu (Terry Therneau)
Date: Fri, 30 Nov 2012 06:53:36 -0600
Subject: [Rd] Baffled with as.matrix
Message-ID: <50B8AC50.3010903@mayo.edu>

I'm puzzled by as.matrix.  It appears to work differently for Surv objects.
Here is a session from my computer:

tmt% R --vanilla
 > library(survival)
Loading required package: splines
 > ytest <- Surv(1:3, c(1,0,1))
 > is.matrix(ytest)
 >[1] TRUE

 > attr(ytest, 'type')
[1] "right"
 > attr(as.matrix(ytest), 'type')
[1] "right"
 >
 > y2 <- ytest
 > class(y2) <- "charlie"
 > as.matrix.charlie <- survival:::as.matrix.Surv
 > attr(y2, 'type')
[1] "right"
 > attr(as.matrix(y2), 'type')
NULL

 > survival:::as.matrix.Surv
function (x)
{
     y <- unclass(x)
     attr(y, "type") <- NULL
     y
}
<bytecode: 0x91c1610>
<environment: namespace:survival>

--------
It appears that Surv objects are being processed by as.matrix.default, but "charlie" 
objects by the
actual method.  One more verification:

 > attr(survival:::as.matrix.Surv(ytest), 'type')
NULL
 > attr(as.matrix.default(y2), 'type')
[1] "right"

Context: In testing the next survival release (2.37), it has lost this "special" 
behavior.  One package that depends on survival expects this behavior and thus fails.  I'm 
at a loss to figure out how my package got this attribute in the first place, or how it 
lost it.  Can anyone shed light?

Terry Therneau

PS I'm on vacation for the next few days so will be intermittent with email.  (Off to see 
my first grandchild!)

---------------------

 > sessionInfo()
R version 2.15.2 (2012-10-26)
Platform: i686-pc-linux-gnu (32-bit)

locale:
  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=C
  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
  [7] LC_PAPER=C                 LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] splines   stats     graphics  grDevices utils     datasets  methods
[8] base

other attached packages:
[1] survival_2.36-14


From diggsb at ohsu.edu  Fri Nov 30 19:08:38 2012
From: diggsb at ohsu.edu (Brian Diggs)
Date: Fri, 30 Nov 2012 10:08:38 -0800
Subject: [Rd] Baffled with as.matrix
In-Reply-To: <50B8AC50.3010903@mayo.edu>
References: <50B8AC50.3010903@mayo.edu>
Message-ID: <50B8F626.7030803@ohsu.edu>

On 11/30/2012 4:53 AM, Terry Therneau wrote:
> I'm puzzled by as.matrix.  It appears to work differently for Surv objects.
> Here is a session from my computer:
>
> tmt% R --vanilla
>  > library(survival)
> Loading required package: splines
>  > ytest <- Surv(1:3, c(1,0,1))
>  > is.matrix(ytest)
>  >[1] TRUE

It seems that survival:::as.matrix.Surv is not recognized as a 
dispatch-able method for as.matrix:

 > methods("as.matrix")
[1] as.matrix.data.frame as.matrix.default    as.matrix.dist*
[4] as.matrix.noquote    as.matrix.POSIXlt    as.matrix.raster*
[7] as.matrix.ratetable*

I'm guessing it is not declared as such in the NAMESPACE file.

>  > attr(ytest, 'type')
> [1] "right"
>  > attr(as.matrix(ytest), 'type')
> [1] "right"
>  >
>  > y2 <- ytest
>  > class(y2) <- "charlie"
>  > as.matrix.charlie <- survival:::as.matrix.Surv

This new function does show up:

 > methods("as.matrix")
[1] as.matrix.charlie    as.matrix.data.frame as.matrix.default
[4] as.matrix.dist*      as.matrix.noquote    as.matrix.POSIXlt
[7] as.matrix.raster*    as.matrix.ratetable*

and is being called as expected.

>  > attr(y2, 'type')
> [1] "right"
>  > attr(as.matrix(y2), 'type')
> NULL
>
>  > survival:::as.matrix.Surv
> function (x)
> {
>      y <- unclass(x)
>      attr(y, "type") <- NULL
>      y
> }
> <bytecode: 0x91c1610>
> <environment: namespace:survival>

What is being called by as.matrix(ytest) is as.matrix.default

 > as.matrix.default
function (x, ...)
{
     if (is.matrix(x))
         x
     else array(x, c(length(x), 1L), if (!is.null(names(x)))
         list(names(x), NULL)
     else NULL)
}
<bytecode: 0x000000000631a0b8>
<environment: namespace:base>

which will just return ytest is is.matrix(ytest) is TRUE (as you show).

> --------
> It appears that Surv objects are being processed by as.matrix.default,
> but "charlie" objects by the
> actual method.  One more verification:
>
>  > attr(survival:::as.matrix.Surv(ytest), 'type')
> NULL
>  > attr(as.matrix.default(y2), 'type')
> [1] "right"

Correct.

> Context: In testing the next survival release (2.37), it has lost this
> "special" behavior.  One package that depends on survival expects this
> behavior and thus fails.  I'm at a loss to figure out how my package got
> this attribute in the first place, or how it lost it.  Can anyone shed
> light?

The behavior I showed above was with 2.36-14, even.

In your NAMESPACE file, there are two lines that say

S3method(as.matrix, ratetable)

I bet one of them was meant to be

S3method(as.matrix, Surv)


> Terry Therneau
>
> PS I'm on vacation for the next few days so will be intermittent with
> email.  (Off to see my first grandchild!)
>
> ---------------------
>
>  > sessionInfo()
> R version 2.15.2 (2012-10-26)
> Platform: i686-pc-linux-gnu (32-bit)
>
> locale:
>   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=C
>   [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>   [7] LC_PAPER=C                 LC_NAME=C
>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] splines   stats     graphics  grDevices utils     datasets  methods
> [8] base
>
> other attached packages:
> [1] survival_2.36-14
>


-- 
Brian S. Diggs, PhD
Senior Research Associate, Department of Surgery
Oregon Health & Science University


