From murdoch at stats.uwo.ca  Sat Sep  1 01:28:05 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 31 Aug 2007 19:28:05 -0400
Subject: [Rd] compiling R-devel
In-Reply-To: <OFA047BAD6.FC254B4C-ON86257348.006D5302-86257348.0070BEB8@mmm.com>
References: <OFA047BAD6.FC254B4C-ON86257348.006D5302-86257348.0070BEB8@mmm.com>
Message-ID: <46D8A405.7080609@stats.uwo.ca>

apjaworski at mmm.com wrote:
> Hello.
>
> I am in a habit of compiling daily snapshots of R-devel and R-patched on my
> Windows XP workstation.  I have cygwin environment with up-to-date RTools
> and MiKTeX.  I run cygwin and MiKTeX upadaters pretty often (every couple
> of days) so both of them are reasonably current.
>
> Recently I noticed a small annoyance when compiling R-dvel.  It started
> happening right after I updated to the new version of RTools (containing
> MinGW 4.2.1-sjlj compilers).  Everything else stayed the same with possible
> exception of MiKTeX update.
>
> I usually just type "make distribution" to compile everything.  The
> compilation itself goes smoothly.  Then the PDF version of the reference
> manual is created.  Then I see this:
>
> ...
> Output written on refman.pdf (1563 pages, 7869936 bytes).
> Transcript written on refman.log.
> creating doc/manual/version.texi
> texi2dvi --pdf --texinfo="@set UseExternalXrefs " R-FAQ.texi
> This is pdfTeX, Version 3.141592-1.40.4 (MiKTeX 2.6)
> entering extended mode
> ! I can't find file `\tmp\t2d6036\xtr\R-FAQ.texi'.
> <*> /tmp/t2d6036/xtr/R-FAQ.texi
>
> Please type another input file name:
>
> Now the file  /tmp/t2d6036/xtr/R-FAQ.texi exists at this point is not empty
> and has usual protection codes.  I tried different versions of back and
> front slashes, double backslashes, etc., but to no avail.  I was getting
> the same message - the file cannot be found.  The only thing that works is
> the plain file name.  That is, if I just type (or copy and paste) the
> string R-FAQ.texi everything works fine.  This happens three times for
> every manual (except the refman).  After that the compilation ends
> normally, the windows installer is created and, when I run the installer, I
> get everything working correctly including PDFs of the manuals.
>
> It looks to me like the /tmp/t2d6036/xtr/ part of the name gets already
> pre-pended to whatever name the make process provides so it expects just
> the file name.  Alternatively, something changed in my MiKTeX setup due to
> updates.  However, the refman compiles properly and I can also compile
> other LaTeX with no apparent problems.
>
> Thanks in advance,

How do you have your temp directory set?  I'm not sure if it's R or one 
of the build tools that's important here, so it's worth looking at all 
environment variables TMPDIR, TEMP, TMP, etc.

Are you running the build in Cygwin, or in a Windows CMD window?  I use 
Cygwin (not quite so current as yours) and don't see this error.

Duncan Murdoch


From murdoch at stats.uwo.ca  Sat Sep  1 02:39:02 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 31 Aug 2007 20:39:02 -0400
Subject: [Rd] Friday question: negative zero
Message-ID: <46D8B4A6.4040800@stats.uwo.ca>

The IEEE floating point standard allows for negative zero, but it's hard 
to know that you have one in R.  One reliable test is to take the 
reciprocal.  For example,

 > y <- 0
 > 1/y
[1] Inf
 > y <- -y
 > 1/y
[1] -Inf

The other day I came across one in complex numbers, and it took me a 
while to figure out that negative zero was what was happening:

  > x <- complex(real = -1)
  > x
[1] -1+0i
  > 1/x
[1] -1+0i
  > x^(1/3)
[1] 0.5+0.8660254i
  > (1/x)^(1/3)
[1] 0.5-0.8660254i

(The imaginary part of 1/x is negative zero.)

As a Friday question:  are there other ways to create and detect 
negative zero in R?

And another somewhat more serious question:  is the behaviour of 
negative zero consistent across platforms?  (The calculations above were 
done in Windows in R-devel.)

Duncan Murdoch


From ggrothendieck at gmail.com  Sat Sep  1 03:25:10 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 31 Aug 2007 21:25:10 -0400
Subject: [Rd] Friday question: negative zero
In-Reply-To: <46D8B4A6.4040800@stats.uwo.ca>
References: <46D8B4A6.4040800@stats.uwo.ca>
Message-ID: <971536df0708311825w1cda0aa3l8946ad48aaa8f0fb@mail.gmail.com>

On 8/31/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> The IEEE floating point standard allows for negative zero, but it's hard
> to know that you have one in R.  One reliable test is to take the
> reciprocal.  For example,
>
>  > y <- 0
>  > 1/y
> [1] Inf
>  > y <- -y
>  > 1/y
> [1] -Inf
>
> The other day I came across one in complex numbers, and it took me a
> while to figure out that negative zero was what was happening:
>
>  > x <- complex(real = -1)
>  > x
> [1] -1+0i
>  > 1/x
> [1] -1+0i
>  > x^(1/3)
> [1] 0.5+0.8660254i
>  > (1/x)^(1/3)
> [1] 0.5-0.8660254i
>
> (The imaginary part of 1/x is negative zero.)
>
> As a Friday question:  are there other ways to create and detect
> negative zero in R?

I think the only other way is the IEEE CopySign function but I don't think
R has implemented it -- R probably should.  Google CopySign .


From smckinney at bccrc.ca  Sat Sep  1 04:00:15 2007
From: smckinney at bccrc.ca (Steven McKinney)
Date: Fri, 31 Aug 2007 19:00:15 -0700
Subject: [Rd] Friday question: negative zero
References: <46D8B4A6.4040800@stats.uwo.ca>
Message-ID: <0BE438149FF2254DB4199E2682C8DFEB03289FED@crcmail1.BCCRC.CA>

Seems the same on this Apple Mac OSX platform:

> y <- 0
> 1/y
[1] Inf
> y <- -y
> 1/y
[1] -Inf
> x <- complex(real = -1)
> x
[1] -1+0i
> 1/x
[1] -1+0i
> x^(1/3)
[1] 0.5+0.8660254i
> (1/x)^(1/3)
[1] 0.5-0.8660254i

> sessionInfo()
R version 2.5.1 (2007-06-27) 
powerpc-apple-darwin8.9.1 

locale:
en_CA.UTF-8/en_CA.UTF-8/en_CA.UTF-8/C/en_CA.UTF-8/en_CA.UTF-8

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
> system("uname -a")
Darwin Dapple.local 8.10.0 Darwin Kernel Version 8.10.0: Wed May 23 16:50:59 PDT 2007; root:xnu-792.21.3~1/RELEASE_PPC Power Macintosh powerpc
> version
               _                           
platform       powerpc-apple-darwin8.9.1   
arch           powerpc                     
os             darwin8.9.1                 
system         powerpc, darwin8.9.1        
status                                     
major          2                           
minor          5.1                         
year           2007                        
month          06                          
day            27                          
svn rev        42083                       
language       R                           
version.string R version 2.5.1 (2007-06-27)


Steven McKinney





-----Original Message-----
From: r-devel-bounces at r-project.org on behalf of Duncan Murdoch
Sent: Fri 8/31/2007 5:39 PM
To: R Devel
Subject: [Rd] Friday question: negative zero
 
The IEEE floating point standard allows for negative zero, but it's hard 
to know that you have one in R.  One reliable test is to take the 
reciprocal.  For example,

 > y <- 0
 > 1/y
[1] Inf
 > y <- -y
 > 1/y
[1] -Inf

The other day I came across one in complex numbers, and it took me a 
while to figure out that negative zero was what was happening:

  > x <- complex(real = -1)
  > x
[1] -1+0i
  > 1/x
[1] -1+0i
  > x^(1/3)
[1] 0.5+0.8660254i
  > (1/x)^(1/3)
[1] 0.5-0.8660254i

(The imaginary part of 1/x is negative zero.)

As a Friday question:  are there other ways to create and detect 
negative zero in R?

And another somewhat more serious question:  is the behaviour of 
negative zero consistent across platforms?  (The calculations above were 
done in Windows in R-devel.)

Duncan Murdoch

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From deepayan.sarkar at gmail.com  Sat Sep  1 04:39:17 2007
From: deepayan.sarkar at gmail.com (deepayan.sarkar at gmail.com)
Date: Fri, 31 Aug 2007 19:39:17 -0700
Subject: [Rd] Friday question: negative zero
In-Reply-To: <46D8B4A6.4040800@stats.uwo.ca>
References: <46D8B4A6.4040800@stats.uwo.ca>
Message-ID: <eb555e660708311939i6258529ej127673d688acc089@mail.gmail.com>



On 8/31/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> The IEEE floating point standard allows for negative zero, but it's hard
> to know that you have one in R.  One reliable test is to take the
> reciprocal.  For example,
> 
>  > y <- 0
>  > 1/y
> [1] Inf
>  > y <- -y
>  > 1/y
> [1] -Inf
> 
> The other day I came across one in complex numbers, and it took me a
> while to figure out that negative zero was what was happening:
> 
>   > x <- complex(real = -1)
>   > x
> [1] -1+0i
>   > 1/x
> [1] -1+0i
>   > x^(1/3)
> [1] 0.5+0.8660254i
>   > (1/x)^(1/3)
> [1] 0.5-0.8660254i
> 
> (The imaginary part of 1/x is negative zero.)
> 
> As a Friday question:  are there other ways to create and detect
> negative zero in R?
> 
> And another somewhat more serious question:  is the behaviour of
> negative zero consistent across platforms?  (The calculations above were
> done in Windows in R-devel.)

No, I get

> 1/ Im(1/complex(real = -1))
[1] Inf
> sessionInfo()
R version 2.6.0 Under development (unstable) (2007-08-16 r42532) 
x86_64-unknown-linux-gnu 

This is on an AMD 64, and I get -Inf on everything else I've tried so far, which are all Intel. 

-Deepayan


From ripley at stats.ox.ac.uk  Sat Sep  1 05:59:12 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 1 Sep 2007 04:59:12 +0100 (BST)
Subject: [Rd] compiling R-devel *on Windows*
In-Reply-To: <46D8A405.7080609@stats.uwo.ca>
References: <OFA047BAD6.FC254B4C-ON86257348.006D5302-86257348.0070BEB8@mmm.com>
	<46D8A405.7080609@stats.uwo.ca>
Message-ID: <Pine.LNX.4.64.0709010445290.22950@gannet.stats.ox.ac.uk>

This is pretty clearly a problem in texi2dvi (which is part of MiKTeX), 
not in R, since the line passed is

texi2dvi --pdf --texinfo="@set UseExternalXrefs " R-FAQ.texi

I get

This is pdfTeX, Version 3.141592-1.40.4 (MiKTeX 2.6)
entering extended mode
(c:\DOCUME~1\ripley\LOCALS~1\Temp\mik54358\_xtr\R-FAQ.texi
(C:\packages\miktex2.6\tex\texinfo\base\texinfo.tex
...

I think your TMP variable is set to a Cygwin-style path, although when I 
experimented with that MiKTeX dropped back to c:\TEMP.

On Fri, 31 Aug 2007, Duncan Murdoch wrote:

> apjaworski at mmm.com wrote:
>> Hello.
>>
>> I am in a habit of compiling daily snapshots of R-devel and R-patched on my
>> Windows XP workstation.  I have cygwin environment with up-to-date RTools
>> and MiKTeX.  I run cygwin and MiKTeX upadaters pretty often (every couple
>> of days) so both of them are reasonably current.
>>
>> Recently I noticed a small annoyance when compiling R-dvel.  It started
>> happening right after I updated to the new version of RTools (containing
>> MinGW 4.2.1-sjlj compilers).  Everything else stayed the same with possible
>> exception of MiKTeX update.

But there was a change to use texi2dvi if present a couple of weeks ago.

>> I usually just type "make distribution" to compile everything.  The
>> compilation itself goes smoothly.  Then the PDF version of the reference
>> manual is created.  Then I see this:
>>
>> ...
>> Output written on refman.pdf (1563 pages, 7869936 bytes).
>> Transcript written on refman.log.
>> creating doc/manual/version.texi
>> texi2dvi --pdf --texinfo="@set UseExternalXrefs " R-FAQ.texi
>> This is pdfTeX, Version 3.141592-1.40.4 (MiKTeX 2.6)
>> entering extended mode
>> ! I can't find file `\tmp\t2d6036\xtr\R-FAQ.texi'.
>> <*> /tmp/t2d6036/xtr/R-FAQ.texi
>>
>> Please type another input file name:
>>
>> Now the file  /tmp/t2d6036/xtr/R-FAQ.texi exists at this point is not empty
>> and has usual protection codes.  I tried different versions of back and
>> front slashes, double backslashes, etc., but to no avail.  I was getting
>> the same message - the file cannot be found.  The only thing that works is
>> the plain file name.  That is, if I just type (or copy and paste) the
>> string R-FAQ.texi everything works fine.  This happens three times for
>> every manual (except the refman).  After that the compilation ends
>> normally, the windows installer is created and, when I run the installer, I
>> get everything working correctly including PDFs of the manuals.
>>
>> It looks to me like the /tmp/t2d6036/xtr/ part of the name gets already
>> pre-pended to whatever name the make process provides so it expects just
>> the file name.  Alternatively, something changed in my MiKTeX setup due to
>> updates.  However, the refman compiles properly and I can also compile
>> other LaTeX with no apparent problems.
>>
>> Thanks in advance,
>
> How do you have your temp directory set?  I'm not sure if it's R or one
> of the build tools that's important here, so it's worth looking at all
> environment variables TMPDIR, TEMP, TMP, etc.
>
> Are you running the build in Cygwin, or in a Windows CMD window?  I use
> Cygwin (not quite so current as yours) and don't see this error.
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From tobias.verbeke at gmail.com  Sat Sep  1 17:34:42 2007
From: tobias.verbeke at gmail.com (Tobias Verbeke)
Date: Sat, 01 Sep 2007 17:34:42 +0200
Subject: [Rd] serialized plot object (for a certain device)
Message-ID: <46D98692.7010807@telenet.be>

Dear list,

Using serialize it is possible to save
the binary string representing an R
object to a raw R vector.

## adapted from ?serialize
x <- serialize(list(1,2,3), NULL)
x

I am looking for a way to capture
the binary string that in normal
use of graphics devices will be
written to (most commonly) a file
connection.

jpeg(file = "test.jpg")
   plot(1:10)
dev.off()

In other words, is there a way of
capturing the binary `jpeg string'
representing the plot(1:10) graph,
e.g. into a raw vector ?

Many thanks in advance,
Tobias

-- 

Tobias Verbeke - Consultant
Business & Decision Benelux
Rue de la r?volution 8
1000 Brussels - BELGIUM

+32 499 36 33 15
tobias.verbeke at businessdecision.com


From ggrothendieck at gmail.com  Sat Sep  1 17:41:01 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 1 Sep 2007 11:41:01 -0400
Subject: [Rd] within in R 2.6.0dev is not found
Message-ID: <971536df0709010841v76e5764cle9fb3fc93dd0526e@mail.gmail.com>

The NEWS file refers to a new function within but it does not appear
to be found:

> within()
Error: could not find function "within"

> R.version.string # Windows Vista
[1] "R version 2.6.0 Under development (unstable) (2007-08-31 r42709)"


From ripley at stats.ox.ac.uk  Sat Sep  1 17:59:47 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 1 Sep 2007 16:59:47 +0100 (BST)
Subject: [Rd] serialized plot object (for a certain device)
In-Reply-To: <46D98692.7010807@telenet.be>
References: <46D98692.7010807@telenet.be>
Message-ID: <Pine.LNX.4.64.0709011655420.12894@auk.stats>

On Sat, 1 Sep 2007, Tobias Verbeke wrote:

> Dear list,
>
> Using serialize it is possible to save
> the binary string representing an R
> object to a raw R vector.
>
> ## adapted from ?serialize
> x <- serialize(list(1,2,3), NULL)
> x
>
> I am looking for a way to capture
> the binary string that in normal
> use of graphics devices will be
> written to (most commonly) a file
> connection.

Nope, unfortunately, they write to files not connections and no R object 
is involved.

> jpeg(file = "test.jpg")
>   plot(1:10)
> dev.off()
>
> In other words, is there a way of
> capturing the binary `jpeg string'
> representing the plot(1:10) graph,
> e.g. into a raw vector ?

Only by rewriting the jpeg library used to write the file.  In the case of 
jpeg it is done here:

   /* Step 2: specify data destination (eg, a file) */
   jpeg_stdio_dest(&cinfo, outfile);


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jeff.horner at vanderbilt.edu  Sat Sep  1 18:49:03 2007
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Sat, 01 Sep 2007 11:49:03 -0500
Subject: [Rd] Friday question: negative zero
In-Reply-To: <eb555e660708311939i6258529ej127673d688acc089@mail.gmail.com>
References: <46D8B4A6.4040800@stats.uwo.ca>
	<eb555e660708311939i6258529ej127673d688acc089@mail.gmail.com>
Message-ID: <46D997FF.5040000@vanderbilt.edu>

deepayan.sarkar at gmail.com wrote:
> 
> On 8/31/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>> The IEEE floating point standard allows for negative zero, but it's hard
>> to know that you have one in R.  One reliable test is to take the
>> reciprocal.  For example,
>>
>>  > y <- 0
>>  > 1/y
>> [1] Inf
>>  > y <- -y
>>  > 1/y
>> [1] -Inf
>>
>> The other day I came across one in complex numbers, and it took me a
>> while to figure out that negative zero was what was happening:
>>
>>   > x <- complex(real = -1)
>>   > x
>> [1] -1+0i
>>   > 1/x
>> [1] -1+0i
>>   > x^(1/3)
>> [1] 0.5+0.8660254i
>>   > (1/x)^(1/3)
>> [1] 0.5-0.8660254i
>>
>> (The imaginary part of 1/x is negative zero.)
>>
>> As a Friday question:  are there other ways to create and detect
>> negative zero in R?
>>
>> And another somewhat more serious question:  is the behaviour of
>> negative zero consistent across platforms?  (The calculations above were
>> done in Windows in R-devel.)
> 
> No, I get
> 
>> 1/ Im(1/complex(real = -1))
> [1] Inf
>> sessionInfo()
> R version 2.6.0 Under development (unstable) (2007-08-16 r42532) 
> x86_64-unknown-linux-gnu 
> 
> This is on an AMD 64, and I get -Inf on everything else I've tried so far, which are all Intel. 

Okay, I hope this isn't line noise, but our AMD 64 with R version 2.5.1 
gets:

 > 1/ Im(1/complex(real = -1))
[1] -Inf

 > sessionInfo()
R version 2.5.1 (2007-06-27)
x86_64-pc-linux-gnu

locale:
LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=en_US;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
[7] "base"

Should I compile R-devel and post the results of the above?

Jeff
-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner


From p.dalgaard at biostat.ku.dk  Sat Sep  1 19:12:16 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sat, 01 Sep 2007 19:12:16 +0200
Subject: [Rd] within in R 2.6.0dev is not found
In-Reply-To: <971536df0709010841v76e5764cle9fb3fc93dd0526e@mail.gmail.com>
References: <971536df0709010841v76e5764cle9fb3fc93dd0526e@mail.gmail.com>
Message-ID: <46D99D70.4060300@biostat.ku.dk>

Gabor Grothendieck wrote:
> The NEWS file refers to a new function within but it does not appear
> to be found:
>
>   
>> within()
>>     
> Error: could not find function "within"
>
>   
>> R.version.string # Windows Vista
>>     
> [1] "R version 2.6.0 Under development (unstable) (2007-08-31 r42709)"
>
>   
Which NEWS file??

$ svn commit -m 'new function within()'
Sending        NEWS
Sending        src/library/base/R/eval.R
Sending        src/library/base/man/with.Rd
Sending        tests/no-segfault.Rin
Sending        tests/reg-tests-2.Rout.save
Transmitting file data .....
Committed revision 42714.

So it is hardly surprising that it is not in 42709....


> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ggrothendieck at gmail.com  Sat Sep  1 19:19:27 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 1 Sep 2007 13:19:27 -0400
Subject: [Rd] within in R 2.6.0dev is not found
In-Reply-To: <46D99D70.4060300@biostat.ku.dk>
References: <971536df0709010841v76e5764cle9fb3fc93dd0526e@mail.gmail.com>
	<46D99D70.4060300@biostat.ku.dk>
Message-ID: <971536df0709011019x7eba9eceqf30ee9089f3c3b8a@mail.gmail.com>

On 9/1/07, Peter Dalgaard <p.dalgaard at biostat.ku.dk> wrote:
> Gabor Grothendieck wrote:
> > The NEWS file refers to a new function within but it does not appear
> > to be found:
> >
> >
> >> within()
> >>
> > Error: could not find function "within"
> >
> >
> >> R.version.string # Windows Vista
> >>
> > [1] "R version 2.6.0 Under development (unstable) (2007-08-31 r42709)"
> >
> >
> Which NEWS file??
>
> $ svn commit -m 'new function within()'
> Sending        NEWS
> Sending        src/library/base/R/eval.R
> Sending        src/library/base/man/with.Rd
> Sending        tests/no-segfault.Rin
> Sending        tests/reg-tests-2.Rout.save
> Transmitting file data .....
> Committed revision 42714.
>
> So it is hardly surprising that it is not in 42709....

This one:

https://svn.r-project.org/R/trunk/NEWS


From savicky at cs.cas.cz  Sat Sep  1 20:57:45 2007
From: savicky at cs.cas.cz (Petr Savicky)
Date: Sat, 1 Sep 2007 20:57:45 +0200
Subject: [Rd] Friday question: negative zero
In-Reply-To: <46D997FF.5040000@vanderbilt.edu>
References: <46D8B4A6.4040800@stats.uwo.ca>
	<eb555e660708311939i6258529ej127673d688acc089@mail.gmail.com>
	<46D997FF.5040000@vanderbilt.edu>
Message-ID: <20070901185745.GA11153@cs.cas.cz>

On Fri, Aug 31, 2007 at 08:39:02PM -0400, Duncan Murdoch wrote:
[snip]
> The other day I came across one in complex numbers, and it took me a 
> while to figure out that negative zero was what was happening:
> 
>   > x <- complex(real = -1)
>   > x
> [1] -1+0i
>   > 1/x
> [1] -1+0i
>   > x^(1/3)
> [1] 0.5+0.8660254i
>   > (1/x)^(1/3)
> [1] 0.5-0.8660254i
> 
> (The imaginary part of 1/x is negative zero.)
> 
> As a Friday question:  are there other ways to create and detect 
> negative zero in R?
> 
> And another somewhat more serious question:  is the behaviour of 
> negative zero consistent across platforms?  (The calculations above were 
> done in Windows in R-devel.)

Let me contribute to the statistics over platforms, which already contains
powerpc-apple-darwin8.9.1 (Steven McKinney) and two different results
on AMD 64 (deepayan.sarkar, Jeffrey Horner).

I tried  1/Im(1/complex(real = -1)) on three different platforms, all
of which are Linux, but with different CPU and different gcc version.
In all cases, R-devel_2007-08-31 is used.

The results differ. 

1. [...]$ grep name /proc/cpuinfo
   model name      : Pentium III (Coppermine)
   gcc version 4.0.2 20050901 (prerelease) (SUSE Linux)

   1/Im(1/complex(real = -1)) # Inf

2. [...]$ grep name /proc/cpuinfo
   model name      : Celeron (Coppermine)
   gcc version 4.1.0 (SUSE Linux)

   1/Im(1/complex(real = -1)) # -Inf

3. [...]$ grep name /proc/cpuinfo # two processor machine
   model name      : Intel(R) Xeon(TM) CPU 2.80GHz
   model name      : Intel(R) Xeon(TM) CPU 2.80GHz
   gcc version 3.3.3 20040412 (Red Hat Linux 3.3.3-7)

   1/Im(1/complex(real = -1)) # -Inf

The result does not depend on option -ffloat-store. On Xeon CPU,
it does not depend on, whether SSE (IEEE 754) arithmetic is
used (-march=pentium4 -mfpmath=sse) or not.

Let us try something more.

  z <- complex(real = -1)
  1/Im(z)        # [1] Inf
  1/Im(Conj(z))  # [1] -Inf

  z <- complex(real = -1, imaginary = -0)
  1/Im(z)        # [1] -Inf
  1/Im(Conj(z))  # [1] Inf

These results are consistent across platforms.
Let us look at 1/Im(1/z).

Platform 1 (Pentium III):

  z <- complex(real = -1)
  1/Im(1/z)      # [1] Inf

  z <- complex(real = -1, imaginary = -0)
  1/Im(1/z)      # [1] Inf

Platform 2 (Celeron):

  z <- complex(real = -1)
  1/Im(1/z)      # [1] -Inf

  z <- complex(real = -1, imaginary = -0)
  1/Im(1/z)      # [1] -Inf   (*)

Platform 3 (Xeon):

  z <- complex(real = -1)
  1/Im(1/z)      # [1] -Inf

  z <- complex(real = -1, imaginary = -0)
  1/Im(1/z)      # [1] Inf   (*)

So, besides the first difference between 1 and 2+3,
there is also a difference between 2 and 3 (marked (*)).

Petr Savicky.
===


From tplate at acm.org  Sun Sep  2 01:22:26 2007
From: tplate at acm.org (Tony Plate)
Date: Sat, 01 Sep 2007 17:22:26 -0600
Subject: [Rd] Friday question: negative zero
In-Reply-To: <46D8B4A6.4040800@stats.uwo.ca>
References: <46D8B4A6.4040800@stats.uwo.ca>
Message-ID: <46D9F432.6070704@acm.org>

One place where I've been caught by -ve zeros is with unit tests.  If 
identical(-0, 0) returns FALSE, and the object storage doesn't preserve 
-ve zeros, that can lead to test failures that are tricky to debug.

However, it doesn't look like that is too much a problem in the current 
incarnation of R, at least running under Linux:

* identical(-0, 0) returns TRUE
* save/load preserves -ve zero
* however dump() does NOT preserve -ve zero

The fact that identical(-0,0) is TRUE means that we have the situation 
where it is possible that identical(x, y) != identical(f(x), f(y)).  I 
don't know if this is a real problem anywhere.

 > x <- 0
 > y <- -0
 > 1/x
[1] Inf
 > 1/y
[1] -Inf
 > identical(x, y)
[1] TRUE
 > ### there exists f,x,y such that identical(x, y) != identical(f(x), f(y))
 > identical(1/x, 1/y)
[1] FALSE
 > ### save/load preserves -ve zero
 > save("y", file="y.rda")
 > remove("y")
 > load("y.rda")
 > 1/y
[1] -Inf
 > identical(x, y)
[1] TRUE
 > ### dump does not preserve -ve zero
 > dump("y", file="y.R")
 > remove("y")
 > source("y.R")
 > y
[1] 0
 > 1/y
[1] Inf
 > version
               _
platform       x86_64-unknown-linux-gnu
arch           x86_64
os             linux-gnu
system         x86_64, linux-gnu
status
major          2
minor          5.1
year           2007
month          06
day            27
svn rev        42083
language       R
version.string R version 2.5.1 (2007-06-27)
 >

-- Tony Plate


From savicky at cs.cas.cz  Sun Sep  2 07:29:13 2007
From: savicky at cs.cas.cz (Petr Savicky)
Date: Sun, 2 Sep 2007 07:29:13 +0200
Subject: [Rd] Friday question: negative zero
In-Reply-To: <46D9F432.6070704@acm.org>
References: <46D8B4A6.4040800@stats.uwo.ca> <46D9F432.6070704@acm.org>
Message-ID: <20070902052913.GA29862@cs.cas.cz>

On Sat, Sep 01, 2007 at 05:22:26PM -0600, Tony Plate wrote:
> One place where I've been caught by -ve zeros is with unit tests.  If 
> identical(-0, 0) returns FALSE, and the object storage doesn't preserve 
> -ve zeros, that can lead to test failures that are tricky to debug.
> 
> However, it doesn't look like that is too much a problem in the current 
> incarnation of R, at least running under Linux:
> 
> * identical(-0, 0) returns TRUE
> * save/load preserves -ve zero
> * however dump() does NOT preserve -ve zero
> 
> The fact that identical(-0,0) is TRUE means that we have the situation 
> where it is possible that identical(x, y) != identical(f(x), f(y)).  I 
> don't know if this is a real problem anywhere.

I think, it can be a problem, but the formulation should be modified,
since identical(x, y) != identical(f(x), f(y)) may occur even if
everything is OK. For example,
  identical(1, -1) != identical(abs(1), abs(-1)).

The problem is that it is possible to have
  identical(x, y) & ! identical(f(x), f(y))

However, this it is not a problem of R. This is a problem of IEEE 754
specification, which implies that
    x == y & f(x) != f(y)
is possible.

>  > x <- 0
>  > y <- -0
>  > 1/x
> [1] Inf
>  > 1/y
> [1] -Inf
>  > identical(x, y)
> [1] TRUE
>  > ### there exists f,x,y such that identical(x, y) != identical(f(x), f(y))
>  > identical(1/x, 1/y)
> [1] FALSE
>  > ### save/load preserves -ve zero
>  > save("y", file="y.rda")
>  > remove("y")
>  > load("y.rda")
>  > 1/y
> [1] -Inf
>  > identical(x, y)
> [1] TRUE
>  > ### dump does not preserve -ve zero
>  > dump("y", file="y.R")
>  > remove("y")
>  > source("y.R")
>  > y
> [1] 0
>  > 1/y
> [1] Inf

It works the same in my installations. Moreover, "save" preserves
-ve zeros even with ascii=TRUE, which is more similar to dump.
This may be seen in the output, where indeed "-0" may occur as a
text. So, this is another way to detect negative zero. A simpler
version is sprintf:
  sprintf("%f",0) # [1] "0.000000"
  sprintf("%f",-0) # [1] "-0.000000"

Petr Savicky.
===


From bolker at zoo.ufl.edu  Sun Sep  2 20:01:26 2007
From: bolker at zoo.ufl.edu (Ben Bolker)
Date: Sun, 02 Sep 2007 14:01:26 -0400
Subject: [Rd] buglet in dist()  ?
Message-ID: <46DAFA76.3070609@zoo.ufl.edu>


  the first line of dist() says

 if (!is.na(pmatch(method, "euclidian")))

  shouldn't that be "euclidean" ?

---------------------
R version 2.5.1 (2007-06-27)
i486-pc-linux-gnu

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods" 
[7] "base"    

other attached packages:
   bbmle     nlme
 "0.7.7" "3.1-84"


From bolker at zoo.ufl.edu  Sun Sep  2 20:23:35 2007
From: bolker at zoo.ufl.edu (Ben Bolker)
Date: Sun, 02 Sep 2007 14:23:35 -0400
Subject: [Rd] contact with GeneR developers?
Message-ID: <46DAFFA7.50203@zoo.ufl.edu>


  Is anyone in contact with the GeneR package developers?
The maintainer's e-mail (below) bounced ...
I wanted to let them know that we found some problems
with (probably) their C allocation code -- everything works
nicely under Linux, but almost nothing worked under Windows --
and there were (fixable) problems compiling under R-devel.

  cheers
    Ben Bolker

Package:       GeneR
Title:         R for genes and sequences analysis
Description:   Package manipulating nucleotidic sequences (Embl, Fasta,
               GenBank)
Version:       2.6.0
Date:          2006-03-17
biocViews:     Annotation, Genetics
Author:        L. Cottret, A. Lucas, E. Marrakchi, O. Rogier, V.
               Lefort, P. Durosay, A. Viari, C. Thermes & Y.
               d'Aubenton-Carafa.
Maintainer:    Y. d'Aubenton-Carafa <daubenton at cgm.cnrs-gif.fr>
License:       Free Software Licence CeCILL
URL:           http://www.cgm.cnrs-gif.fr
Packaged:      Wed Apr 25 01:53:57 2007; biocbuild


From p.dalgaard at biostat.ku.dk  Sun Sep  2 20:52:33 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sun, 02 Sep 2007 20:52:33 +0200
Subject: [Rd] buglet in dist()  ?
In-Reply-To: <46DAFA76.3070609@zoo.ufl.edu>
References: <46DAFA76.3070609@zoo.ufl.edu>
Message-ID: <46DB0671.9000406@biostat.ku.dk>

Ben Bolker wrote:
>   the first line of dist() says
>
>  if (!is.na(pmatch(method, "euclidian")))
>
>   shouldn't that be "euclidean" ?
>
>   
I think not.  The first *five* lines are

    if (!is.na(pmatch(method, "euclidian")))
        method <- "euclidean"
    METHODS <- c("euclidean", "maximum", "manhattan", "canberra",
        "binary", "minkowski")
    method <- pmatch(method, METHODS)

so what happens is that if you enter "euclidian" (which I gather is an 
uncommon but valid spelling) you get the same result as with "euclidean".

> ---------------------
> R version 2.5.1 (2007-06-27)
> i486-pc-linux-gnu
>
> locale:
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods" 
> [7] "base"    
>
> other attached packages:
>    bbmle     nlme
>  "0.7.7" "3.1-84"
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From bolker at zoo.ufl.edu  Sun Sep  2 21:07:29 2007
From: bolker at zoo.ufl.edu (Ben Bolker)
Date: Sun, 02 Sep 2007 15:07:29 -0400
Subject: [Rd] buglet in dist()  ?
In-Reply-To: <46DB0671.9000406@biostat.ku.dk>
References: <46DAFA76.3070609@zoo.ufl.edu> <46DB0671.9000406@biostat.ku.dk>
Message-ID: <46DB09F1.8040804@zoo.ufl.edu>

  oops.  sorry.  should have figured something
this obvious would have been on purpose.

  Ben


Peter Dalgaard wrote:
> Ben Bolker wrote:
>>   the first line of dist() says
>>
>>  if (!is.na(pmatch(method, "euclidian")))
>>
>>   shouldn't that be "euclidean" ?
>>
>>   
> I think not.  The first *five* lines are
>
>    if (!is.na(pmatch(method, "euclidian")))
>        method <- "euclidean"
>    METHODS <- c("euclidean", "maximum", "manhattan", "canberra",
>        "binary", "minkowski")
>    method <- pmatch(method, METHODS)
>
> so what happens is that if you enter "euclidian" (which I gather is an 
> uncommon but valid spelling) you get the same result as with "euclidean".
>
>> ---------------------
>> R version 2.5.1 (2007-06-27)
>> i486-pc-linux-gnu
>>
>> locale:
>> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C 
>>
>>
>> attached base packages:
>> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  
>> "methods" [7] "base"   
>> other attached packages:
>>    bbmle     nlme
>>  "0.7.7" "3.1-84"
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>   
>
>


From jeff.horner at vanderbilt.edu  Mon Sep  3 00:16:43 2007
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Sun, 02 Sep 2007 17:16:43 -0500
Subject: [Rd] Memory leak possible when redirecting R console
Message-ID: <46DB364B.9070204@vanderbilt.edu>

Hello,

To trigger the memory leak, an application embedding R will have printed 
  a vector element of size R_BUFSIZE or more to stdout, so long as the 
R_Outputfile pointer is NULL and R was compiled with vasprintf support. 
The leak is in Rcons_vprintf from printutils.c. It looks as though 
someone set up a fix for this but forgot a critical flag assignment when 
vasprintf() is called (vasprintf mallocs a buffer to print to, so it 
needs to be freed after use). Here's the fix:


Index: printutils.c
===================================================================
--- printutils.c        (revision 42743)
+++ printutils.c        (working copy)
@@ -658,8 +658,10 @@
      res = vsnprintf(buf, R_BUFSIZE, format, aq);
      va_end(aq);
  #ifdef HAVE_VASPRINTF
-    if(res >= R_BUFSIZE || res < 0)
+    if(res >= R_BUFSIZE || res < 0){
+       usedVasprintf = TRUE;
         vasprintf(&p, format, arg);
+    }
  #else
      if(res >= R_BUFSIZE) { /* res is the desired output length */
         usedRalloc = TRUE;

Best,

Jeff
-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner


From maechler at stat.math.ethz.ch  Mon Sep  3 08:44:40 2007
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 3 Sep 2007 08:44:40 +0200
Subject: [Rd] sweep sanity checking?
In-Reply-To: <1072002710EB6047A212400EEB65F00676D9DC@ELDER.ads.warwick.ac.uk>
References: <468579C0.7090809@zoo.ufl.edu>
	<loom.20070709T175233-590@post.gmane.org>
	<469557AC.2010607@acm.org> <20070712081616.GA7100@cs.cas.cz>
	<316C7A29-DB9F-4645-A4DF-275BA30E1855@noc.soton.ac.uk>
	<20070713203735.GA18016@cs.cas.cz>
	<20070725070320.GA20948@cs.cas.cz>
	<20070727071006.GA31738@cs.cas.cz>
	<20070808065400.GA5991@cs.cas.cz>
	<1072002710EB6047A212400EEB65F00676D9DC@ELDER.ads.warwick.ac.uk>
Message-ID: <18139.44376.710720.70281@stat.math.ethz.ch>

I've been asked to close this thread "in public"

>>>>> "TH" == Turner, Heather <Heather.Turner at warwick.ac.uk>
>>>>>     on Wed, 22 Aug 2007 10:20:21 +0100 writes:

    TH> Petr Savicky kindly brought this thread to my attention
    TH> as I'm afraid it had passed me by. As one of the
    TH> contributors to the earlier discussion on adding
    TH> warnings to sweep I would like to give my support to
    TH> Petr's proposed patch.

Petr's proposed patch has been added to R-devel (to become
R-2.6.0 alpha in two days) last week.
Actually it was found subsequently that there was a small
problem in the patch [basically because   n %% n is zero only
for n != 0 and the case n==0 is valid].

If you are interested in using the new sweep() version, and because
we are entering alpha testing of R 2.6.0, 
I'd recommend you to start using "R-devel".

Martin Maechler


    TH> For the record I should say that Petr was right to point
    TH> out that the use of MARGIN in my examples did not make
    TH> sense
    TH> https://stat.ethz.ch/pipermail/r-devel/2007-July/046487.html
    TH> so I have no quibble with that.

    TH> I think it is sensible too, to use the dim attribute of
    TH> STATS as the basis of the test, when the dim attribute
    TH> is present. This provides a way to control the strength
    TH> of the test in the case of sweeping out a vector, as
    TH> Petr describes in his message below. I think that the
    TH> proposed patch successfully brings together the
    TH> different views on what should be tested, which was the
    TH> stumbling block last time around
    TH> https://stat.ethz.ch/pipermail/r-help/2005-June/074037.html

    TH> Even if people set check.margin = FALSE for reasons of
    TH> speed, this in itself should be a useful check, since
    TH> they will need to be confident that the test is
    TH> unnecessary.

    TH> Heather

    TH> -----Original Message----- From:
    TH> r-devel-bounces at r-project.org
    TH> [mailto:r-devel-bounces at r-project.org] On Behalf Of Petr
    TH> Savicky Sent: 08 August 2007 07:54 To:
    TH> r-devel at r-project.org Subject: Re: [Rd] sweep sanity
    TH> checking?

    TH> Thanks to Martin Maechler for his comments, advice and
    TH> for pointing out the speed problem. Thanks also to Ben
    TH> Bolker for tests of speed, which confirm that for small
    TH> arrays, a slow down by a factor of about 1.2 - 1.5 may
    TH> occur. Now, I would like to present a new version of
    TH> sweep, which is simpler and has an option to avoid the
    TH> test. This is expected to be used in scripts, where the
    TH> programmer is quite sure that the usage is correct and
    TH> speed is required. The new version differs from the
    TH> previous one in the following:

    TH> 1. The option check.margin has a different meaning. It
    TH> defaults to TRUE and it determines whether the test is
    TH> performed or not.

    TH> 2. Since check.margin has the meaning above, it cannot
    TH> be used to select, which test should be performed. This
    TH> depends on the type of STATS. The suggested sweep
    TH> function contains two tests: - a vector test by Heather
    TH> Turner, which is used, if STATS has no dim attribute
    TH> and, hence, is a vector (STATS should not be anything
    TH> else than a vector or an array) - an array test used if
    TH> STATS has dim attribute.  The vector test allows some
    TH> kinds of recycling, while the array test does
    TH> not. Hence, in the most common case, where x is a matrix
    TH> and STATS is a vector, if the user likes to be warned if
    TH> the length of the vector is not exactly the right one,
    TH> the following call is suggested:
    TH> sweep(x,MARGIN,as.array(STATS)). Otherwise, a warning
    TH> will be generated only if length(STATS) does not divide
    TH> the specified dimension of x, which is nrow(x)
    TH> (MARGIN=1) or ncol(x) (MARGIN=2).

    TH> 3. If STATS is an array, then the test is more
    TH> restrictive than in the previous version. It is now
    TH> required that after deleting dimensions with one level,
    TH> the remaining dimensions coincide.  The previous version
    TH> allowed additionally the cases, when dim(STATS) is a
    TH> prefix of dim(x)[MARGIN], for example, if dim(STATS) =
    TH> k1 and dim(x)[MARGIN] = c(k1,k2).

    TH> The code of the tests in the suggested sweep is based on
    TH> the previous suggestions
    TH> https://stat.ethz.ch/pipermail/r-help/2005-June/073989.html
    TH> by Robin Hankin
    TH> https://stat.ethz.ch/pipermail/r-help/2005-June/074001.html
    TH> by Heather Turner
    TH> https://stat.ethz.ch/pipermail/r-devel/2007-June/046217.html
    TH> by Ben Bolker with some further modifications.

    TH> The modification of sweep.Rd was prepared by Ben Bolker
    TH> and me.

    TH> I would like to encourage everybody who likes to express
    TH> his opinion on the patch to do it now. In my opinion,
    TH> the suggestion of the new code stabilized in the sense
    TH> that I will not modify it unless there is a negative
    TH> feedback.

    TH> A patch against R-devel_2007-08-06 is attached. It
    TH> contains tabs. If they are corrupted by email transfer,
    TH> use the link
    TH> http://www.cs.cas.cz/~savicky/R-devel/patch-sweep which
    TH> is an identical copy.

    TH> Petr Savicky.

    TH> ========================================================================
    TH> ======================== ---
    TH> R-devel_2007-08-06/src/library/base/R/sweep.R 2007-07-27
    TH> 17:51:13.000000000 +0200 +++
    TH> R-devel_2007-08-06-sweep/src/library/base/R/sweep.R
    TH> 2007-08-07 10:30:12.383672960 +0200 @@ -14,10 +14,29 @@
    TH> # A copy of the GNU General Public License is available
    TH> at # http://www.r-project.org/Licenses/
 
    TH> -sweep <- function(x, MARGIN, STATS, FUN = "-", ...)
    TH> +sweep <- function(x, MARGIN, STATS, FUN = "-",
    TH> check.margin=TRUE, ...)  { FUN <- match.fun(FUN) dims <-
    TH> dim(x) + if (check.margin) { + dimmargin <- dims[MARGIN]
    TH> + dimstats <- dim(STATS) + lstats <- length(STATS) + if
    TH> (lstats > prod(dimmargin)) { + warning("length of STATS
    TH> greater than the extent of dim(x)[MARGIN]") + } else if
    TH> (is.null(dimstats)) { # STATS is a vector + cumDim <-
    TH> c(1, cumprod(dimmargin)) + upper <- min(cumDim[cumDim >=
    TH> lstats]) + lower <- max(cumDim[cumDim <= lstats]) + if
    TH> (upper %% lstats != 0 || lstats %% lower != 0) +
    TH> warning("STATS does not recycle exactly across MARGIN")
    TH> + } else { + dimmargin <- dimmargin[dimmargin > 1] +
    TH> dimstats <- dimstats[dimstats > 1] + if
    TH> (length(dimstats) != length(dimmargin) || any(dimstats
    TH> != dimmargin)) + warning("length(STATS) or dim(STATS) do
    TH> not match dim(x)[MARGIN]") + } + } perm <- c(MARGIN,
    TH> (1:length(dims))[ - MARGIN]) FUN(x, aperm(array(STATS,
    TH> dims[perm]), order(perm)), ...)  } ---
    TH> R-devel_2007-08-06/src/library/base/man/sweep.Rd
    TH> 2007-07-27 17:51:35.000000000 +0200 +++
    TH> R-devel_2007-08-06-sweep/src/library/base/man/sweep.Rd
    TH> 2007-08-07 10:29:45.517757200 +0200 @@ -11,7 +11,7 @@
    TH> statistic.  } \usage{ -sweep(x, MARGIN, STATS, FUN="-",
    TH> \dots) +sweep(x, MARGIN, STATS, FUN="-",
    TH> check.margin=TRUE, \dots) } \arguments{ \item{x}{an
    TH> array.}  @@ -22,8 +22,18 @@ case of binary operators
    TH> such as \code{"/"} etc., the function name must
    TH> backquoted or quoted. (\code{FUN} is found by a call to
    TH> \code{\link{match.fun}}.)}  +
    TH> \item{check.margin}{logical. If \code{TRUE} (the
    TH> default), warn if the + length or dimensions of
    TH> \code{STATS} do + not match the specified dimensions of
    TH> \code{x}.}  \item{\dots}{optional arguments to
    TH> \code{FUN}.}  } +\details{ + The consistency check among
    TH> \code{STATS}, \code{MARGIN} and \code{x} + is stricter
    TH> if \code{STATS} is an array than if it is a vector.  +
    TH> In the vector case, some kinds of recycling are allowed
    TH> without a + warning. Use
    TH> \code{sweep(x,MARGIN,as.array(STATS))} if \code{STATS} +
    TH> is a vector and you want to be warned if any recycling
    TH> occurs.  +} \value{ An array with the same shape as
    TH> \code{x}, but with the summary statistics swept out.

    TH> ______________________________________________
    TH> R-devel at r-project.org mailing list
    TH> https://stat.ethz.ch/mailman/listinfo/r-devel

    TH> ______________________________________________
    TH> R-devel at r-project.org mailing list
    TH> https://stat.ethz.ch/mailman/listinfo/r-devel


From schmidb at ibe.med.uni-muenchen.de  Mon Sep  3 08:45:45 2007
From: schmidb at ibe.med.uni-muenchen.de (Markus Schmidberger)
Date: Mon, 03 Sep 2007 08:45:45 +0200
Subject: [Rd] Snow on Windows Cluster
Message-ID: <46DBAD99.3010800@ibe.med.uni-muenchen.de>

Hello,

the package snow is not working on a windows cluster with MPICH2 and 
Rmpi. There is an error in makeCluster:

launch failed: CreateProcess(/usr/bin/env 
"RPROG="C:\Programme\R\R-2.5.1\bin\R" "OUT=/dev/null" "R_LIBS=" 
C:/Programme/R/R-2.5.1/library/snow/RMPInode.sh) on 'cl1' failed, error 
3 - Das System kann den angegbenen Pfad nicht finden.

I looked into makeMPIcluster. It could not work, mpi.comm.spawn gets the 
shell command for unix to start the slaves. A simple solution is to use 
the windows-code from mpi.spawn.rslaves, then it looks like this. And is 
working on our windows-cluster. (small failures on stopping cluster)

# Fro windows
if (.Platform$OS=="windows"){
    workdrive <- unlist(strsplit(getwd(),":"))[1]
    tmpdrive <- unlist(strsplit(tempdir(),":"))[1]
    worktmp <- as.logical(toupper(workdrive)==toupper(tmpdrive))
    tmpdir <- unlist(strsplit(tempdir(),"/Rtmp"))[1]
    localhost <- Sys.getenv("COMPUTERNAME")
    networkdrive <-.Call("RegQuery", 
as.integer(2),paste("NETWORK\\",workdrive,sep=""),
                       PACKAGE="Rmpi")
    remotepath <-networkdrive[which(networkdrive=="RemotePath")+1]
    mapdrive=TRUE
    mapdrive <- as.logical(mapdrive && !is.null(remotepath))
    Rscript=system.file("slaveload.R", package="snow")
    arg <- c(Rscript, R.home(), workdrive, getwd(),worktmp, tmpdir,
                   localhost, mapdrive, remotepath)
            
#Rscript,R_HOME,WDrive,WDir,WorkTmp,TmpDir,Master,MapDrive,RemotePath
    print("super")
    count<-mpi.comm.spawn(
        slave=system.file("Rslaves.bat", package="Rmpi"),
        slavearg=arg,
        nslaves=count)
} else{   # for unix
    count <- mpi.comm.spawn(slave = "/usr/bin/env",
                                slavearg = args,
                                nslaves = count,
                                intercomm = intercomm)
}

Doing some work, there should be a better and nicer solution with 
directly using mpi.spawn.Rslaves.

Best
Markus

-- 
Dipl.-Tech. Math. Markus Schmidberger

Ludwig-Maximilians-Universit?t M?nchen
IBE - Institut f?r medizinische Informationsverarbeitung,
Biometrie und Epidemiologie
Marchioninistr. 15, D-81377 Muenchen
URL: http://ibe.web.med.uni-muenchen.de 
Mail: Markus.Schmidberger [at] ibe.med.uni-muenchen.de


From ripley at stats.ox.ac.uk  Mon Sep  3 11:40:39 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 3 Sep 2007 10:40:39 +0100 (BST)
Subject: [Rd] locales and readLines
In-Reply-To: <6phfy1zll8s.fsf@gopher4.fhcrc.org>
References: <6phfy1zll8s.fsf@gopher4.fhcrc.org>
Message-ID: <Pine.LNX.4.64.0709030942480.5307@gannet.stats.ox.ac.uk>

I think you need to delimit a bit more what you want to do.  It is 
difficult in general to tell what encoding a text file is in, and very 
much harder if this is a data file containing only a small proportion of 
non-ASCII text, which might not even be words in a human language (but 
abbreviations or acronyms).

If you have experience with systems that do try to guess (e.g. Unix 
'file') you will know that they are pretty fallible.  There are Perl 
modules available, for example: I checked Encode::Guess which says

    ?   Because of the algorithm used, ISO-8859 series and other single-
        byte encodings do not work well unless either one of ISO-8859 is
        the only one suspect (besides ascii and utf8).

    ?   Do not mix national standard encodings and the corresponding vendor
        encodings.

    It is, after all, just a guess.  You should alway be explicit when it
    comes to encodings.  But there are some, especially Japanese, environ-
    ment that guess-coding is a must.  Use this module with care.


I think you may have missed that the main way to specify an encoding for a 
file is

readLines(file("fn", encoding="latin2"))

and not the encoding arg to readLines (although the help page is quite 
clear that the latter does not re-encode).  The latter only allows UTF-8 
and latin1.

The author of a package that offers facilities to read non-ASCII text does 
need to offer the user a way to specify the encoding.  I think suggesting 
that is 'an extra burden' is exceedingly negative: you could rather be 
thankful that R provides the facilities these days to do so.  And if the 
package or its examples contains non-ASCII character strings, it is de 
rigeur for the author to consider how it might work on other people's 
systems.

Notice that source() already has some of the 'smarts' you are asking about 
if 'file' is a file and not a connection, and you could provide a similar 
wrapper for readLines.  That is useful either when the user can specify a 
small set of possible encodings or when such a set can be deduced from the 
locale.  If the concern is that file might be UTF-8 or latin1, this is 
often a good guess (latin1 files can be valid UTF-8 but rarely are). 
However, if you have Russian text which might be in one of the several 
8-bit encodings, the only way I know to decide which is to see if they 
make sense (and if they are acronyms, they may in all the possible 
encodings).

BTW, to guess an encoding you really need to process all the input, so 
this is not appropriate for general connections, and for large files it 
might be better to do it external to R, e.g. via Perl etc.

I would say minimal good practice would be to

- allow the user to specify the encoding of text files.
- ensure you have specified the encoding of all non-ASCII data in your
   package (which includes documentation, for example).

I'd leave guessing to others: as
http://www.cs.tut.fi/~jkorpela/chars.html says,

   It is hopefully obvious from the preceding discussion that a sequence of
   octets can be interpreted in a multitude of ways when processed as
   character data. By looking at the octet sequence only, you cannot even
   know whether each octet presents one character or just part of a
   two-octet presentation of a character, or something more complicated.
   Sometimes one can guess the encoding, but data processing and transfer
   shouldn't be guesswork.



On Fri, 31 Aug 2007, Martin Morgan wrote:

> R-developers,
>
> I'm looking for some 'best practices', or perhaps an upstream solution
> (I have a deja vu about this, so sorry if it's already been asked).
> Problems occur when a file is encoded as latin1, but the user has a
> UTF-8 locale (or I guess more generally when the input locale does not
> match R's).  Here are two examples from the Bioconductor help list:
>
> https://stat.ethz.ch/pipermail/bioconductor/2007-August/018947.html
>
> (the relevant command is library(GEOquery); gse <- getGEO('GSE94'))
>
> https://stat.ethz.ch/pipermail/bioconductor/2007-July/018204.html
>
> I think solutions are:
>
> * Specify the encoding in readLines.
>
> * Convert the input using iconv.
>
> * Tell the user to set their locale to match the input file (!)
>
> Unfortunately, these (1 & 2, anyway) place extra burden on the package
> author, to become educated about locales, the encoding conventions of
> the files they read, and to know how R deals with encodings.
>
> Are there other / better solutions? Any chance for some (additional)
> 'smarts' when reading files?
>
> Martin
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From gregor.gorjanc at bfro.uni-lj.si  Mon Sep  3 16:03:07 2007
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Mon, 3 Sep 2007 16:03:07 +0200
Subject: [Rd] Typo in regex help page
Message-ID: <46DC141B.70907@bfro.uni-lj.si>

Hi!

I believe there is a typo in

R/src/library/base/man/regex.Rd

The 52nd line looks like:

The metacharacters are in EREs are ...
                     ^^^^^^^^^^^

Gregor


From honza at ifolk.cz  Mon Sep  3 12:46:56 2007
From: honza at ifolk.cz (honza at ifolk.cz)
Date: Mon,  3 Sep 2007 12:46:56 +0200 (CEST)
Subject: [Rd] read.spss converts string variables with value labels to <NA>
	(PR#9896)
Message-ID: <20070903104656.1D1566691D@slim.kubism.ku.dk>

Full_Name: Jan Hucin
Version: 2.5.1 (foreign 0.8-20)
OS: WinXP
Submission from: (NULL) (195.113.83.7)


When reading an SPSS file:

- containing some variable of type String
- with value labels at that variable
- and with determination which values of that variable are considered to be
missing,

I have always get <NA> where digits were in the original SPSS file.

Example:
Let's have in an SPSS file "some.sav" the variable A. The type of the variable
is String of length 1.
Let's have a value labeling: 1 = Yes, 2 = No, 8 = Invalid, 9 = Missing.
Let's determine that value 9 is considered to be missing.
When this file is read by abc=read.spss("some.sav",use.value.labels=TRUE), we
get <NA> in abc$A on places where "1", "2" etc. were. Surprisingly, we get "N/A"
(not <NA>!) on the place where the string "N/A" is.

If we specify use.value.labels=FALSE, then we get string values (such as "1",
"2") but we lose value labels (Yes, No etc.).

Let me add that if the variable in the original SPSS file was of type Numeric
(not String), there would be no problem.


From marco.vicentini at gmail.com  Mon Sep  3 08:59:22 2007
From: marco.vicentini at gmail.com (marco.vicentini at gmail.com)
Date: Mon,  3 Sep 2007 08:59:22 +0200 (CEST)
Subject: [Rd] When 1+2 != 3 (PR#9895)
Message-ID: <20070903065922.DA71966911@slim.kubism.ku.dk>

Full_Name: Marco Vicentini, University of Verona
Version: 2.4.1 & 2.5.1
OS: OsX & WinXP
Submission from: (NULL) (157.27.253.46)


When I proceed to test the following equation 1 + 2 == 3, I obviously obtain the
value TRUE. But when I tryed to do the same using real number (i.e. 0.1 + 0.2 ==
0.3)  I obtained an unusual FALSE.
In the online help there are some tricks for this problem. It suggests to use
identical(...) which again answer FALSE. Only using isTRUE(all.equal(0.3, 0.1 +
0.2)) I can obtain the true value TRUE.

But the problem does not concern only the operator ==. Many other functions,
among over:  sort, order, unique, duplicate, identical are not able to deal with
this problem. This is very dangerous because no advice are provide by the online
help, and anybody can use these functions no think to unusual results.

I think that the problem is due to how double number are store by the C
compiler.

If it may be usefull, I have written to small function (Unique and isEqual)
which can deal with this problem of the double numbers.

I also add some other conditions for the same problem.

	0.3 == 0.15 + 0.15
    0.3 == 0.1 + 0.2
1 - 0.7 == 0.3
    0.1 == 1 - 0.9

    0.2 == 1 - 0.2 - 0.2 - 0.2 - 0.2
   -0.2 == 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2

identical (0.3, 0.1 + 0.2)
all.equal (0.3, 0.1 + 0.2)

identical (-0.2 , 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2)
all.equal (-0.2 , 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2)

isTRUE( all.equal (-0.2 , 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2) )


   -0.2 == 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2

a= -0.2 
b=         1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2

x<-c(a,b)
sprintf("%.15f",x)
sprintf("%.50f",x)



Unique <- function(x, digits = 8, fast = TRUE) {

	if (fast) {
		unique (round(x * 10^digits)) / 10^digits	
	} else {
		x = sort(x)
		for (i in 1:(length(x)-1))
			if (isTRUE(all.equal(x[i],x[i+1]))) x[i] = NaN
		x [ which (!is.nan(x)) ]
	}}

isEqual <- function (object, x, tol = 1e-9) {
	if (!is.vector(object)) stop("Object must be a vector")
	if (is.character(object)) stop("Object can not be a character")
	if (!is.real(x)) stop("x must be a real number")
	if (any(is.na(c(object,x)))) stop("NA is not supported")
	if (length(x) != 1) stop("length x must equal to 1")

	ifelse (abs(object - x) < tol, TRUE,FALSE) 
#	.Call("isEqual",as.real(object),as.real(x),as.real(tol), PACKAGE="mvUtils")
}


From savicky at cs.cas.cz  Mon Sep  3 16:39:57 2007
From: savicky at cs.cas.cz (Petr Savicky)
Date: Mon, 3 Sep 2007 16:39:57 +0200
Subject: [Rd] When 1+2 != 3 (PR#9895)
In-Reply-To: <20070903065922.DA71966911@slim.kubism.ku.dk>
References: <20070903065922.DA71966911@slim.kubism.ku.dk>
Message-ID: <20070903143957.GA19039@cs.cas.cz>

On Mon, Sep 03, 2007 at 08:59:22AM +0200, marco.vicentini at gmail.com wrote:
> Full_Name: Marco Vicentini, University of Verona
> Version: 2.4.1 & 2.5.1
> OS: OsX & WinXP
> Submission from: (NULL) (157.27.253.46)
> 
> 
> When I proceed to test the following equation 1 + 2 == 3, I obviously obtain the
> value TRUE. But when I tryed to do the same using real number (i.e. 0.1 + 0.2 ==
> 0.3)  I obtained an unusual FALSE.
> In the online help there are some tricks for this problem. It suggests to use
> identical(...) which again answer FALSE. Only using isTRUE(all.equal(0.3, 0.1 +
> 0.2)) I can obtain the true value TRUE.

A rational number has a finite binary expansion iff its denominator is a power
of 2. Numbers 0.1 and 0.2 are 1/10 and 1/5, so they have 5 in their denominator.
Their binary expansion is
 0.1  = .0001100110011001100110011001100110...
 0.2  = .0011001100110011001100110011001100...
A double variable stores the numbers rounded to 53 significant binary digits.
Hence, they are not exactly 0.1 and 0.2, as may be seen in
  formatC(0.1,digits=30) # [1] "0.100000000000000005551115123126"
  formatC(0.2,digits=30) # [1] "0.200000000000000011102230246252"

In order to compare numbers with some tolerance, the function all.equal
may be used, which you also mention below. See its help page, which
specifies the tolerance to be  .Machine$double.eps ^ 0.5.

> But the problem does not concern only the operator ==. Many other functions,
> among over:  sort, order, unique, duplicate, identical are not able to deal with
> this problem. This is very dangerous because no advice are provide by the online
> help, and anybody can use these functions no think to unusual results.
> 
> I think that the problem is due to how double number are store by the C
> compiler.

Not C compiler, but the hardware.

Petr Savicky.

> If it may be usefull, I have written to small function (Unique and isEqual)
> which can deal with this problem of the double numbers.
> 
> I also add some other conditions for the same problem.
> 
> 	0.3 == 0.15 + 0.15
>     0.3 == 0.1 + 0.2
> 1 - 0.7 == 0.3
>     0.1 == 1 - 0.9
> 
>     0.2 == 1 - 0.2 - 0.2 - 0.2 - 0.2
>    -0.2 == 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2
> 
> identical (0.3, 0.1 + 0.2)
> all.equal (0.3, 0.1 + 0.2)
> 
> identical (-0.2 , 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2)
> all.equal (-0.2 , 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2)
> 
> isTRUE( all.equal (-0.2 , 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2) )
> 
> 
>    -0.2 == 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2
> 
> a= -0.2 
> b=         1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2
> 
> x<-c(a,b)
> sprintf("%.15f",x)
> sprintf("%.50f",x)
> 
> 
> 
> Unique <- function(x, digits = 8, fast = TRUE) {
> 
> 	if (fast) {
> 		unique (round(x * 10^digits)) / 10^digits	
> 	} else {
> 		x = sort(x)
> 		for (i in 1:(length(x)-1))
> 			if (isTRUE(all.equal(x[i],x[i+1]))) x[i] = NaN
> 		x [ which (!is.nan(x)) ]
> 	}}
> 
> isEqual <- function (object, x, tol = 1e-9) {
> 	if (!is.vector(object)) stop("Object must be a vector")
> 	if (is.character(object)) stop("Object can not be a character")
> 	if (!is.real(x)) stop("x must be a real number")
> 	if (any(is.na(c(object,x)))) stop("NA is not supported")
> 	if (length(x) != 1) stop("length x must equal to 1")
> 
> 	ifelse (abs(object - x) < tol, TRUE,FALSE) 
> #	.Call("isEqual",as.real(object),as.real(x),as.real(tol), PACKAGE="mvUtils")
> }
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From murdoch at stats.uwo.ca  Mon Sep  3 16:54:23 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 03 Sep 2007 10:54:23 -0400
Subject: [Rd] When 1+2 != 3 (PR#9895)
In-Reply-To: <20070903065922.DA71966911@slim.kubism.ku.dk>
References: <20070903065922.DA71966911@slim.kubism.ku.dk>
Message-ID: <46DC201F.8040100@stats.uwo.ca>

On 03/09/2007 2:59 AM, marco.vicentini at gmail.com wrote:
> Full_Name: Marco Vicentini, University of Verona
> Version: 2.4.1 & 2.5.1
> OS: OsX & WinXP
> Submission from: (NULL) (157.27.253.46)
> 
> 
> When I proceed to test the following equation 1 + 2 == 3, I obviously obtain the
> value TRUE. But when I tryed to do the same using real number (i.e. 0.1 + 0.2 ==
> 0.3)  I obtained an unusual FALSE.
> In the online help there are some tricks for this problem. It suggests to use
> identical(...) which again answer FALSE. Only using isTRUE(all.equal(0.3, 0.1 +
> 0.2)) I can obtain the true value TRUE.
> 
> But the problem does not concern only the operator ==. Many other functions,
> among over:  sort, order, unique, duplicate, identical are not able to deal with
> this problem. This is very dangerous because no advice are provide by the online
> help, and anybody can use these functions no think to unusual results.

The FAQ 7.31 gives general help on this.  Repeating it in every instance 
where it affects computations wouldn't make sense.

Please don't report unavoidable problems as bugs.

Duncan Murdoch

> 
> I think that the problem is due to how double number are store by the C
> compiler.
> 
> If it may be usefull, I have written to small function (Unique and isEqual)
> which can deal with this problem of the double numbers.
> 
> I also add some other conditions for the same problem.
> 
> 	0.3 == 0.15 + 0.15
>     0.3 == 0.1 + 0.2
> 1 - 0.7 == 0.3
>     0.1 == 1 - 0.9
> 
>     0.2 == 1 - 0.2 - 0.2 - 0.2 - 0.2
>    -0.2 == 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2
> 
> identical (0.3, 0.1 + 0.2)
> all.equal (0.3, 0.1 + 0.2)
> 
> identical (-0.2 , 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2)
> all.equal (-0.2 , 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2)
> 
> isTRUE( all.equal (-0.2 , 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2) )
> 
> 
>    -0.2 == 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2
> 
> a= -0.2 
> b=         1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2
> 
> x<-c(a,b)
> sprintf("%.15f",x)
> sprintf("%.50f",x)
> 
> 
> 
> Unique <- function(x, digits = 8, fast = TRUE) {
> 
> 	if (fast) {
> 		unique (round(x * 10^digits)) / 10^digits	
> 	} else {
> 		x = sort(x)
> 		for (i in 1:(length(x)-1))
> 			if (isTRUE(all.equal(x[i],x[i+1]))) x[i] = NaN
> 		x [ which (!is.nan(x)) ]
> 	}}
> 
> isEqual <- function (object, x, tol = 1e-9) {
> 	if (!is.vector(object)) stop("Object must be a vector")
> 	if (is.character(object)) stop("Object can not be a character")
> 	if (!is.real(x)) stop("x must be a real number")
> 	if (any(is.na(c(object,x)))) stop("NA is not supported")
> 	if (length(x) != 1) stop("length x must equal to 1")
> 
> 	ifelse (abs(object - x) < tol, TRUE,FALSE) 
> #	.Call("isEqual",as.real(object),as.real(x),as.real(tol), PACKAGE="mvUtils")
> }
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From hb at stat.berkeley.edu  Mon Sep  3 17:12:06 2007
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Mon, 3 Sep 2007 08:12:06 -0700
Subject: [Rd] When 1+2 != 3 (PR#9895)
In-Reply-To: <20070903065922.DA71966911@slim.kubism.ku.dk>
References: <20070903065922.DA71966911@slim.kubism.ku.dk>
Message-ID: <59d7961d0709030812p6b490c63j1b13f4246c1e7639@mail.gmail.com>

On 9/2/07, marco.vicentini at gmail.com <marco.vicentini at gmail.com> wrote:
> Full_Name: Marco Vicentini, University of Verona
> Version: 2.4.1 & 2.5.1
> OS: OsX & WinXP
> Submission from: (NULL) (157.27.253.46)
>
>
> When I proceed to test the following equation 1 + 2 == 3, I obviously obtain the
> value TRUE. But when I tryed to do the same using real number (i.e. 0.1 + 0.2 ==
> 0.3)  I obtained an unusual FALSE.
> In the online help there are some tricks for this problem. It suggests to use
> identical(...) which again answer FALSE. Only using isTRUE(all.equal(0.3, 0.1 +
> 0.2)) I can obtain the true value TRUE.
>
> But the problem does not concern only the operator ==. Many other functions,
> among over:  sort, order, unique, duplicate, identical are not able to deal with
> this problem. This is very dangerous because no advice are provide by the online
> help, and anybody can use these functions no think to unusual results.
>
> I think that the problem is due to how double number are store by the C
> compiler.
>
> If it may be usefull, I have written to small function (Unique and isEqual)
> which can deal with this problem of the double numbers.

Quiz: What about utility functions equalsE() and equalsPi()?
...together with examples illustrating when they return TRUE and when
they return FALSE.

Cheers

/Henrik

>
> I also add some other conditions for the same problem.
>
>         0.3 == 0.15 + 0.15
>     0.3 == 0.1 + 0.2
> 1 - 0.7 == 0.3
>     0.1 == 1 - 0.9
>
>     0.2 == 1 - 0.2 - 0.2 - 0.2 - 0.2
>    -0.2 == 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2
>
> identical (0.3, 0.1 + 0.2)
> all.equal (0.3, 0.1 + 0.2)
>
> identical (-0.2 , 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2)
> all.equal (-0.2 , 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2)
>
> isTRUE( all.equal (-0.2 , 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2) )
>
>
>    -0.2 == 1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2
>
> a= -0.2
> b=         1 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2 - 0.2
>
> x<-c(a,b)
> sprintf("%.15f",x)
> sprintf("%.50f",x)
>
>
>
> Unique <- function(x, digits = 8, fast = TRUE) {
>
>         if (fast) {
>                 unique (round(x * 10^digits)) / 10^digits
>         } else {
>                 x = sort(x)
>                 for (i in 1:(length(x)-1))
>                         if (isTRUE(all.equal(x[i],x[i+1]))) x[i] = NaN
>                 x [ which (!is.nan(x)) ]
>         }}
>
> isEqual <- function (object, x, tol = 1e-9) {
>         if (!is.vector(object)) stop("Object must be a vector")
>         if (is.character(object)) stop("Object can not be a character")
>         if (!is.real(x)) stop("x must be a real number")
>         if (any(is.na(c(object,x)))) stop("NA is not supported")
>         if (length(x) != 1) stop("length x must equal to 1")
>
>         ifelse (abs(object - x) < tol, TRUE,FALSE)
> #       .Call("isEqual",as.real(object),as.real(x),as.real(tol), PACKAGE="mvUtils")
> }
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From bolker at zoo.ufl.edu  Mon Sep  3 17:15:14 2007
From: bolker at zoo.ufl.edu (Ben Bolker)
Date: Mon, 03 Sep 2007 11:15:14 -0400
Subject: [Rd] buglet?? in nlme:::corRatio documentation
Message-ID: <46DC2502.9040302@zoo.ufl.edu>


  [hoping to redeem myself for my last spurious bug report]

 From ?corRatio:

   Letting d denote the range and n denote the nugget effect, the
     correlation between two observations a distance r apart is
     (r/d)^2/(1+(r/d)^2) when no nugget effect is present and
     (1-n)*(r/d)^2/(1+(r/d)^2) when a nugget effect is  assumed.

  This disagrees with the C code (corStruct.c)

/* Rational class */

static double
ratio_corr(double val)
{
    double val2 = val * val;
    return(1/(1+val2));
}

  and with common sense (correlation structures should start from
1 and reach zero for large distances; the structure listed in the
documentation starts at 0 and goes to 1 [or (1-n)] for large distances) --
if you don't want to think about it, use R instead:
 
curve(x^2/(1+x^2),from=0,to=5)
curve(1/(1+x^2),add=TRUE,col=2,from=0)

  What's odd, and makes me really nervous, is that the expression found
in the documentation is also that found in Pinheiro and Bates 2000
(Table 5.2, p. 232).  It's not listed in the errata for the first printing
http://cm.bell-labs.com/cm/ms/departments/sia/project/nlme/MEMSS/Errata ;
I have the second printing.

  (I haven't dug out my geostats books to check this, but found at least
one paper that cites the "correct" (1/(1+(d/r)^2) formula -- see below

 cheers
    Ben Bolker

@ARTICLE{Ekstrom+2005,
  author = {Ekstr{\o}m, Claus T. and Bak, S{\o}ren and Rudemo, Mats},
  title = {Pixel-level Signal Modelling with Spatial Correlation for 
Two-Colour
    Microarrays},
  journal = {Statistical Applications in Genetics and Molecular Biology},
  year = {2005},
  volume = {4},
  number = {1}
  timestamp = {2007.09.03},
  url = {http://www.bepress.com/sagmb/vol4/iss1/art6}
}


From ted.harding at nessie.mcc.ac.uk  Mon Sep  3 19:50:28 2007
From: ted.harding at nessie.mcc.ac.uk ( (Ted Harding))
Date: Mon, 03 Sep 2007 18:50:28 +0100 (BST)
Subject: [Rd] When 1+2 != 3 (PR#9895)
In-Reply-To: <59d7961d0709030812p6b490c63j1b13f4246c1e7639@mail.gmail.com>
Message-ID: <XFMail.070903173242.Ted.Harding@manchester.ac.uk>

On 03-Sep-07 15:12:06, Henrik Bengtsson wrote:
> On 9/2/07, marco.vicentini at gmail.com <marco.vicentini at gmail.com> wrote:
>> [...]
>> If it may be usefull, I have written to small function
>> (Unique and isEqual)
>> which can deal with this problem of the double numbers.
> 
> Quiz: What about utility functions equalsE() and equalsPi()?
> ...together with examples illustrating when they return TRUE and when
> they return FALSE.
> 
> Cheers
> 
> /Henrik

Well, if you guys want a Quiz: ... My favourite example
of something which will probably never work on R (or any
machine which implements fixed-length binary real arithmetic).

An interated function scheme on [0,1] is defined by

  if 0 <= x <= 0.5 then next x = 2*x

  if 0.5 < x <= 1  then next x = 2*(1 - x)

in R:

  nextX <- function(x){ifelse(x<=0.5, 2*x, 2*(1-x))}

and try, e.g.,

 x<-3/7; for(i in (1:60)){x<-nextX(x); print(c(i,x))}

x = 0 is an absorbing state.
x = 1 -> x = 0
x = 1/2 -> 1 -> 0
...
(these work in R)

If K is an odd integer, and 0 < r < K, then

x = r/K ->  ... leads into a periodic set.

E.g. (see above) 3/7 -> 6/7 -> 2/7 -> 4/7 -> 2/7

All other numbers x outside these sets generate non-periodic
sequences.

Apart from the case where initial x = 1/2^k, none of the
above is true in R (e.g. the example above).

So can you devise an "isEqual" function which will make this
work?

It's only Monday .. plenty of time!
Best wishes,
Ted.

--------------------------------------------------------------------
E-Mail: (Ted Harding) <Ted.Harding at manchester.ac.uk>
Fax-to-email: +44 (0)870 094 0861
Date: 03-Sep-07                                       Time: 17:32:38
------------------------------ XFMail ------------------------------

--------------------------------------------------------------------
E-Mail: (Ted Harding) <ted.harding at nessie.mcc.ac.uk>
Fax-to-email: +44 (0)870 094 0861
Date: 03-Sep-07                                       Time: 18:50:23
------------------------------ XFMail ------------------------------


From mtmorgan at fhcrc.org  Mon Sep  3 21:05:26 2007
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Mon, 03 Sep 2007 12:05:26 -0700
Subject: [Rd] locales and readLines
In-Reply-To: <Pine.LNX.4.64.0709030942480.5307@gannet.stats.ox.ac.uk> (Brian
	Ripley's message of "Mon, 3 Sep 2007 10:40:39 +0100 (BST)")
References: <6phfy1zll8s.fsf@gopher4.fhcrc.org>
	<Pine.LNX.4.64.0709030942480.5307@gannet.stats.ox.ac.uk>
Message-ID: <6phodgjd0y1.fsf@gopher4.fhcrc.org>

Thank you very much for explaining this. I had indeed overlooked the
use of encoding in 'file'. I also appreciate how unsatisfactory
guessing at the encoding can be, and that scanning the entire file is
not appropriate for large files or general connections.

Sorry that 'burden' came across as negative, more along the lines of
'burden of responsibility for handling the inputs the package
developer implies they'll handle'. Much better than the burden of
saying 'sorry, no can do'.

Thanks again,

Martin

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> I think you need to delimit a bit more what you want to do.  It is
> difficult in general to tell what encoding a text file is in, and very
> much harder if this is a data file containing only a small proportion
> of non-ASCII text, which might not even be words in a human language
> (but abbreviations or acronyms).
>
> If you have experience with systems that do try to guess (e.g. Unix
> 'file') you will know that they are pretty fallible.  There are Perl
> modules available, for example: I checked Encode::Guess which says
>
>     ?   Because of the algorithm used, ISO-8859 series and other single-
>         byte encodings do not work well unless either one of ISO-8859 is
>         the only one suspect (besides ascii and utf8).
>
>     ?   Do not mix national standard encodings and the corresponding vendor
>         encodings.
>
>     It is, after all, just a guess.  You should alway be explicit when it
>     comes to encodings.  But there are some, especially Japanese, environ-
>     ment that guess-coding is a must.  Use this module with care.
>
>
> I think you may have missed that the main way to specify an encoding
> for a file is
>
> readLines(file("fn", encoding="latin2"))
>
> and not the encoding arg to readLines (although the help page is quite
> clear that the latter does not re-encode).  The latter only allows
> UTF-8
> and latin1.
>
> The author of a package that offers facilities to read non-ASCII text
> does need to offer the user a way to specify the encoding.  I think
> suggesting that is 'an extra burden' is exceedingly negative: you
> could rather be thankful that R provides the facilities these days to
> do so.  And if the package or its examples contains non-ASCII
> character strings, it is de rigeur for the author to consider how it
> might work on other people's systems.
>
> Notice that source() already has some of the 'smarts' you are asking
> about if 'file' is a file and not a connection, and you could provide
> a similar wrapper for readLines.  That is useful either when the user
> can specify a small set of possible encodings or when such a set can
> be deduced from the locale.  If the concern is that file might be
> UTF-8 or latin1, this is often a good guess (latin1 files can be valid
> UTF-8 but rarely are). However, if you have Russian text which might
> be in one of the several 8-bit encodings, the only way I know to
> decide which is to see if they make sense (and if they are acronyms,
> they may in all the possible encodings).
>
> BTW, to guess an encoding you really need to process all the input, so
> this is not appropriate for general connections, and for large files
> it might be better to do it external to R, e.g. via Perl etc.
>
> I would say minimal good practice would be to
>
> - allow the user to specify the encoding of text files.
> - ensure you have specified the encoding of all non-ASCII data in your
>    package (which includes documentation, for example).
>
> I'd leave guessing to others: as
> http://www.cs.tut.fi/~jkorpela/chars.html says,
>
>    It is hopefully obvious from the preceding discussion that a sequence of
>    octets can be interpreted in a multitude of ways when processed as
>    character data. By looking at the octet sequence only, you cannot even
>    know whether each octet presents one character or just part of a
>    two-octet presentation of a character, or something more complicated.
>    Sometimes one can guess the encoding, but data processing and transfer
>    shouldn't be guesswork.
>
>
>
> On Fri, 31 Aug 2007, Martin Morgan wrote:
>
>> R-developers,
>>
>> I'm looking for some 'best practices', or perhaps an upstream solution
>> (I have a deja vu about this, so sorry if it's already been asked).
>> Problems occur when a file is encoded as latin1, but the user has a
>> UTF-8 locale (or I guess more generally when the input locale does not
>> match R's).  Here are two examples from the Bioconductor help list:
>>
>> https://stat.ethz.ch/pipermail/bioconductor/2007-August/018947.html
>>
>> (the relevant command is library(GEOquery); gse <- getGEO('GSE94'))
>>
>> https://stat.ethz.ch/pipermail/bioconductor/2007-July/018204.html
>>
>> I think solutions are:
>>
>> * Specify the encoding in readLines.
>>
>> * Convert the input using iconv.
>>
>> * Tell the user to set their locale to match the input file (!)
>>
>> Unfortunately, these (1 & 2, anyway) place extra burden on the package
>> author, to become educated about locales, the encoding conventions of
>> the files they read, and to know how R deals with encodings.
>>
>> Are there other / better solutions? Any chance for some (additional)
>> 'smarts' when reading files?
>>
>> Martin
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-- 
Martin Morgan
Bioconductor / Computational Biology
http://bioconductor.org


From ggrothendieck at gmail.com  Mon Sep  3 21:25:58 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 3 Sep 2007 15:25:58 -0400
Subject: [Rd] When 1+2 != 3 (PR#9895)
In-Reply-To: <XFMail.070903173242.Ted.Harding@manchester.ac.uk>
References: <59d7961d0709030812p6b490c63j1b13f4246c1e7639@mail.gmail.com>
	<XFMail.070903173242.Ted.Harding@manchester.ac.uk>
Message-ID: <971536df0709031225g54c6cfj2df54f3400720f61@mail.gmail.com>

Not sure if this counts but using the Ryacas package

> library(Ryacas)
> x <- Sym("x")
> Set(x, Sym(3)/7)
expression(3/7)
> cat(i, "0: "); print(x)
10 0: expression(3/7)
> for(i in 1:10) {
+ yacas("Set(x, If(x <= 1/2, 2*x, 2*(1-x)))")
+ cat(i, "i: "); print(x)
+ }
1 i: expression(6/7)
2 i: expression(2/7)
3 i: expression(4/7)
4 i: expression(6/7)
5 i: expression(2/7)
6 i: expression(4/7)
7 i: expression(6/7)
8 i: expression(2/7)
9 i: expression(4/7)
10 i: expression(6/7)

On 9/3/07, Ted Harding <ted.harding at nessie.mcc.ac.uk> wrote:
> On 03-Sep-07 15:12:06, Henrik Bengtsson wrote:
> > On 9/2/07, marco.vicentini at gmail.com <marco.vicentini at gmail.com> wrote:
> >> [...]
> >> If it may be usefull, I have written to small function
> >> (Unique and isEqual)
> >> which can deal with this problem of the double numbers.
> >
> > Quiz: What about utility functions equalsE() and equalsPi()?
> > ...together with examples illustrating when they return TRUE and when
> > they return FALSE.
> >
> > Cheers
> >
> > /Henrik
>
> Well, if you guys want a Quiz: ... My favourite example
> of something which will probably never work on R (or any
> machine which implements fixed-length binary real arithmetic).
>
> An interated function scheme on [0,1] is defined by
>
>  if 0 <= x <= 0.5 then next x = 2*x
>
>  if 0.5 < x <= 1  then next x = 2*(1 - x)
>
> in R:
>
>  nextX <- function(x){ifelse(x<=0.5, 2*x, 2*(1-x))}
>
> and try, e.g.,
>
>  x<-3/7; for(i in (1:60)){x<-nextX(x); print(c(i,x))}
>
> x = 0 is an absorbing state.
> x = 1 -> x = 0
> x = 1/2 -> 1 -> 0
> ...
> (these work in R)
>
> If K is an odd integer, and 0 < r < K, then
>
> x = r/K ->  ... leads into a periodic set.
>
> E.g. (see above) 3/7 -> 6/7 -> 2/7 -> 4/7 -> 2/7
>
> All other numbers x outside these sets generate non-periodic
> sequences.
>
> Apart from the case where initial x = 1/2^k, none of the
> above is true in R (e.g. the example above).
>
> So can you devise an "isEqual" function which will make this
> work?
>
> It's only Monday .. plenty of time!
> Best wishes,
> Ted.
>
> --------------------------------------------------------------------
> E-Mail: (Ted Harding) <Ted.Harding at manchester.ac.uk>
> Fax-to-email: +44 (0)870 094 0861
> Date: 03-Sep-07                                       Time: 17:32:38
> ------------------------------ XFMail ------------------------------
>
> --------------------------------------------------------------------
> E-Mail: (Ted Harding) <ted.harding at nessie.mcc.ac.uk>
> Fax-to-email: +44 (0)870 094 0861
> Date: 03-Sep-07                                       Time: 18:50:23
> ------------------------------ XFMail ------------------------------
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From Ted.Harding at manchester.ac.uk  Mon Sep  3 22:02:31 2007
From: Ted.Harding at manchester.ac.uk ( (Ted Harding))
Date: Mon, 03 Sep 2007 21:02:31 +0100 (BST)
Subject: [Rd] When 1+2 != 3 (PR#9895)
In-Reply-To: <971536df0709031225g54c6cfj2df54f3400720f61@mail.gmail.com>
Message-ID: <XFMail.070903210231.Ted.Harding@manchester.ac.uk>

On 03-Sep-07 19:25:58, Gabor Grothendieck wrote:
> Not sure if this counts but using the Ryacas package

Gabor, I'm afraid it doesn't count! (Though I didn't
exclude it explicitly). I'm not interested in the behaviour
of the sequence with denominator = 7 particularly.
The system is in fact an example of simulating chaotic
systems on a computer.

For instance, one of the classic illustrations is

  next x = 2*x*(1-x)

for any real x. The question is, how does a finite-length
binary representation behave?

Petr Savicky [privately] sent me a similar example:
Starting with r/K:

nextr <- function(r){ifelse(r<=K/2, 2*r, 2*(K-r))}

  "For K = 7 and r = 3, this yields r = 3,  6,  2,  4,  6, ...
   Dividing this by K=7, one gets the correct period with
   approximately correct numbers."

Best wishes,
Ted.

--------------------------------------------------------------------
E-Mail: (Ted Harding) <Ted.Harding at manchester.ac.uk>
Fax-to-email: +44 (0)870 094 0861
Date: 03-Sep-07                                       Time: 21:02:27
------------------------------ XFMail ------------------------------


From hin-tak.leung at cimr.cam.ac.uk  Tue Sep  4 01:18:04 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Tue, 04 Sep 2007 00:18:04 +0100
Subject: [Rd] Consistency of serialize(): please enlighten me
In-Reply-To: <59d7961d0708311249p798300e3i97c12620c93b82d2@mail.gmail.com>
References: <59d7961d0708311245v5f03dd4djca143eb4d5c29180@mail.gmail.com>
	<59d7961d0708311249p798300e3i97c12620c93b82d2@mail.gmail.com>
Message-ID: <46DC962C.7030900@cimr.cam.ac.uk>

I have a couple of ideas - serialize() can store references (and some 
simple assignment are just stored as references until one tries to 
modify part of the copy, i.e. in a copy-on-write manner); ocassionally,
it will also store the package name as an attribute to the class name in
which the class was defined. Maybe neither of this is the case, but what
does a hexdump tell you? (just printing the result of rawToChar() to the
console).

Henrik Bengtsson wrote:
> Forgot...
> 
> On 8/31/07, Henrik Bengtsson <hb at stat.berkeley.edu> wrote:
>> Hi,
>>
>> I am puzzled with serialize().  It comes down generating identical
>> hash codes for (apparently) identical objects using digest::digest(),
>> which in turn relies on serialize().  Here is an example illustration
>> the issue:
>>
>> ser <- function(object, ...) {
>>   list(
>>     names = names(object),
>>     namesRaw = charToRaw(names(object)),
>>     ser = serialize(names(object), connection=NULL, ascii=FALSE)
>>   )
>> } # ser()
>>
>> # Object to be serialized
>> key <- key0 <- list(abc="Hello");
>>
>> # Store results
>> d <- list();
>>
>> # 1. As is
>> d[[1]] <- ser(key);
>>
>> # 2. Set names and redo (hardwired: identical to what's already there)
>> names(key) <- "abc";
>> d[[2]] <- ser(key);
>>
>> # 3. Set names and redo (generic: char->raw->char)
>> key <- key0;
>> names(key) <- sapply(names(key), FUN=function(name) rawToChar(charToRaw(name)));
>> d[[3]] <- ser(key);
>>
>> # All names are identical
>> for (kk in 2:length(d))
>>   stopifnot(identical(d[[1]]$names, d[[kk]]$names));
>>
>> # All raw names are identical
>> for (kk in 2:length(d))
>>   stopifnot(identical(d[[1]]$namesRaw, d[[kk]]$namesRaw));
>>
>> # But, the serialized names differ.
>> print(identical(d[[1]]$ser, d[[2]]$ser));
>> print(identical(d[[1]]$ser, d[[3]]$ser));
>> print(identical(d[[2]]$ser, d[[3]]$ser));
> 
> With R version 2.6.0 Under development (unstable) (2007-08-23 r42614) I get:
> [1] TRUE
> [1] FALSE
> [1] FALSE
> 
> and with R version 2.5.1 Patched (2007-07-19 r42284):
> [1] FALSE
> [1] FALSE
> [1] TRUE
> 
>> So, it seems like there is some extra information in the names
>> attribute that is part of the serialization.  Is it possible to show
>> they differ at the R level?  What is that extra information?
>> Promises...?
>>
>> Please enlighten me.
>>
>> Henrik
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From djsamperi at earthlink.net  Mon Sep  3 23:42:47 2007
From: djsamperi at earthlink.net (Dominick Samperi)
Date: Mon, 03 Sep 2007 17:42:47 -0400
Subject: [Rd] Windows Vista Issues
Message-ID: <46DC7FD7.7070304@earthlink.net>

This is a repost of a simple question about Windows Vista and R (with
answer), along with a heads-up on other Windows Vista issues that people may
not be aware of and that may impact R development.

1. The standard package install process fails because the user does not
have permission to write to Program Files/R/R-version/library. Apparently
the install process has already been modified to give the user the option
of maintaining the library directory under his/her personal space, so this
issue has a work-around.

2. Windows Vista issues a very misleading error messages when the
file Explorer encounters a zipped file that was created with an older
version of winzip (say version 10, 2006), and perhaps with some
unix versions of zip as well (haven't tested). The error message is:

Windows cannot open the folder
Access to the Compressed (zipped) Folder '\\machine\whatever\foo.zip' is 
denied.

Now, if you try to look at the file permissions for this file it says 
you don't
have permission to look at the permissions!

If you rename the file to foo.dat (on the source machine) then the 
permission
problems disappear on the target system, so the problem definitely is
related to the '.zip' suffix. (In my testing the source system is running
Windows XP professional, but the problem is not related to the network
configuration: even local zip files created with older versions of Winzip
will have permission problems.)

After several hours of trial and error work it became clear that the correct
message should have been:

Windows detected a zip file in a format that it doesn't accept. Probably it
was created by an older (more than a few months) version of Winzip.

Upgrading to Winzip 11.1 and using it to compress the file on the source
system fixed the problem on the target system.

3. If you use the increasingly popular (and free) program Zip Genius instead
of Winzip beware that the latest released version will cause the file 
Explorer
to crash under Windows Vista. There is a fix: upgrade to the latest patched
release of Zip Genius: 6.0.3.1140 (download the standard version, then run
the update program).

4. In a number of situations Windows Vista issues an error message like
"This task requires permissions" and whatever you were trying to do fails.
Unfortunately, this happens even when the user has Administrator privs,
and Vista gives no indication what permissions are needed and where to
change them. (Though I suspect that you may have to upgrade to
"Vista Ultimate Edition" to do so.)

I don't have a solution for this problem. Perhaps another Vista user can
provide one. Of course, one possible solution is to downgrade to Windows
XP and wait for the kinks to be worked out in Vista...

Thanks,
Dominick


From Chris at rudypark.net  Tue Sep  4 14:28:34 2007
From: Chris at rudypark.net (Chris at rudypark.net)
Date: Tue, 04 Sep 2007 08:28:34 -0400
Subject: [Rd] Hyball in R? (Factor analysis & exploratory SEM)
Message-ID: <1188908914.19191.1208789401@webmail.messagingengine.com>

Dear all,

Hyball is a free, DOS program for factor analysis and exploratory
structural equation modeling (SEM), with some distinct capabilities. For
a brief introduction and overview see
 http://www.psych.ualberta.ca/~rozeboom/READHYBL.TXT
(A list of more formal references is at the end of this e-mail.)
The program itself is available from
 http://www.psych.ualberta.ca/~rozeboom/

The program was developed by Bill Rozeboom, and I recently inquired if
he had ever considered translating it into an application package for R.
He informed me that he is retired, and can no longer manage new
adaptations of Hyball. So I am writing the list to see if anyone else is
interested in such a project? (Perhaps some of the individuals who
developed the existing factor analysis and/ or SEM packages in R?) All
of the source code, written in Lahey LF90 Fortran, can be obtained by
downloading and unpacking the HYPAK.EXE file --a self-extracting
ZIP-file-- from the above url. (The source code will be in the files
with extension FOR.)

For those of you wondering why I am not undertaking this project, the
answer is quite simple: Because it is far beyond my capabilities. To
paraphrase an old Dilbert cartoon, I wasted my college years drinking
beer and studying psychology, instead of something useful like computer
science ;-)
Bill however, says that he could be of some limited assistance.

If any one is interest, please let either me <Chris at Rudypark.net> or
Bill know. Again, the program files can be obtained from Bill's website.
If you encounter problems downloading the HYPAK.EXE file, let me know
and I can try to e-mail you a copy. I can also provide copies of the
articles listed below, in the form of .pdf files.

Thank you.

Chris

----------------------------
References
	Rozeboom, W. W. (1991a). Hyball: A method for subspace-constrained factor rotation. Multivariate Behavioral Research, 26 (1), 163-177.
	Rozeboom, W. W. (1991b). Theory and practice of analytic hyperplane optimization. Multivariate Behavioral Research, 26 (1), 177-197.
	Rozeboom, W. W. (1992). The glory of suboptimal factor rotation: Why local minima in analytic optimization of simple structure are more blessing than curse. Multivariate Behavioral Research, 27 (4), 585-599.
	Rozeboom, W. W. (2000, October). Rotation to recover factors lacking pure indicators. Paper presented at the annual meeting of the Society of Multivariate Experimental Psychology (SMEP).
	Rozeboom, W. W. HYBLOCK: A routine for exploratory factoring of block-structured data. Unpublished Manuscript. [Included in the Hyball package in as .PDF file.]


From ripley at stats.ox.ac.uk  Tue Sep  4 15:50:36 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Tue,  4 Sep 2007 15:50:36 +0200 (CEST)
Subject: [Rd] (PR#9896) read.spss converts string variables with value
Message-ID: <20070904135036.ECE3C66925@slim.kubism.ku.dk>

There is nothing we can do to reproduce this without an example 'some.sav' 
file exhibiting the problem.  Can you please supply one?

On Mon, 3 Sep 2007, honza at ifolk.cz wrote:

> Full_Name: Jan Hucin
> Version: 2.5.1 (foreign 0.8-20)
> OS: WinXP
> Submission from: (NULL) (195.113.83.7)
>
>
> When reading an SPSS file:
>
> - containing some variable of type String
> - with value labels at that variable
> - and with determination which values of that variable are considered to be
> missing,
>
> I have always get <NA> where digits were in the original SPSS file.
>
> Example:
> Let's have in an SPSS file "some.sav" the variable A. The type of the variable
> is String of length 1.
> Let's have a value labeling: 1 = Yes, 2 = No, 8 = Invalid, 9 = Missing.
> Let's determine that value 9 is considered to be missing.
> When this file is read by abc=read.spss("some.sav",use.value.labels=TRUE), we
> get <NA> in abc$A on places where "1", "2" etc. were. Surprisingly, we get "N/A"
> (not <NA>!) on the place where the string "N/A" is.
>
> If we specify use.value.labels=FALSE, then we get string values (such as "1",
> "2") but we lose value labels (Yes, No etc.).
>
> Let me add that if the variable in the original SPSS file was of type Numeric
> (not String), there would be no problem.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at stat.berkeley.edu  Tue Sep  4 19:40:31 2007
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Tue, 4 Sep 2007 10:40:31 -0700
Subject: [Rd] User interrupts while plotting
Message-ID: <59d7961d0709041040k73949b24g29ec72a3b9f02a1c@mail.gmail.com>

Hi,

not often, but still once in a while, I call plot functions (by
mistake) with ridiculous large number of data points.  In such cases,
the only option you've got is to wait for it to finish, or kill R.  At
least on WinXP, it is not possible to interrupt the plotting. Dummy
example:

s <- 100e3;
x <- matrix(rnorm(s*s), nrow=s, ncol=s)
image(x)

Would it be possible to add checks for user interrupts within the
plotting functions, or is this part of code "outside" R, e.g.

  # For every 10,000th iteration/data points, check for user interrupts?
  if(ii % 10000 == 0)
    R_CheckUserInterrupt();

Best

Henrik


From apjaworski at mmm.com  Tue Sep  4 21:02:19 2007
From: apjaworski at mmm.com (apjaworski at mmm.com)
Date: Tue, 4 Sep 2007 14:02:19 -0500
Subject: [Rd] compiling R-devel *on Windows*
In-Reply-To: <Pine.LNX.4.64.0709010445290.22950@gannet.stats.ox.ac.uk>
Message-ID: <OF8B37AC72.2CC19DA4-ON8625734C.0067D65A-8625734C.0068950B@mmm.com>

Thanks for quick responses from Prof Ripley and Duncan Murdoch.

I tried to play around with TMP and TEMP paths but again with no success.
It looks like the problem was this:
1.  I have texinfo cygwin package installed.
2.  This package has a shell script named texi2dvi
3.  This script is installed in /bin which was before the .../miktex/bin
directory in my PATH variable.

For some reason the texi2dvi script does not process the paths correctly,
or at least not the way that R make process expects it.  After I moved the
miktex/bin in front of /bin in my PATH variable everything works as before.

Thanks again for your time,

Andy

__________________________________
Andy Jaworski
518-1-01
Process Laboratory
3M Corporate Research Laboratory
-----
E-mail: apjaworski at mmm.com
Tel:  (651) 733-6092
Fax:  (651) 736-3122


                                                                           
             Prof Brian Ripley                                             
             <ripley at stats.ox.                                             
             ac.uk>                                                     To 
                                       Duncan Murdoch                      
             08/31/2007 10:59          <murdoch at stats.uwo.ca>              
             PM                                                         cc 
                                       apjaworski at mmm.com                  
                                       r-devel at stat.math.ethz.ch           
                                                                   Subject 
                                       Re: [Rd] compiling R-devel *on      
                                       Windows*                            
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           




This is pretty clearly a problem in texi2dvi (which is part of MiKTeX),
not in R, since the line passed is

texi2dvi --pdf --texinfo="@set UseExternalXrefs " R-FAQ.texi

I get

This is pdfTeX, Version 3.141592-1.40.4 (MiKTeX 2.6)
entering extended mode
(c:\DOCUME~1\ripley\LOCALS~1\Temp\mik54358\_xtr\R-FAQ.texi
(C:\packages\miktex2.6\tex\texinfo\base\texinfo.tex
...

I think your TMP variable is set to a Cygwin-style path, although when I
experimented with that MiKTeX dropped back to c:\TEMP.

On Fri, 31 Aug 2007, Duncan Murdoch wrote:

> apjaworski at mmm.com wrote:
>> Hello.
>>
>> I am in a habit of compiling daily snapshots of R-devel and R-patched on
my
>> Windows XP workstation.  I have cygwin environment with up-to-date
RTools
>> and MiKTeX.  I run cygwin and MiKTeX upadaters pretty often (every
couple
>> of days) so both of them are reasonably current.
>>
>> Recently I noticed a small annoyance when compiling R-dvel.  It started
>> happening right after I updated to the new version of RTools (containing
>> MinGW 4.2.1-sjlj compilers).  Everything else stayed the same with
possible
>> exception of MiKTeX update.

But there was a change to use texi2dvi if present a couple of weeks ago.

>> I usually just type "make distribution" to compile everything.  The
>> compilation itself goes smoothly.  Then the PDF version of the reference
>> manual is created.  Then I see this:
>>
>> ...
>> Output written on refman.pdf (1563 pages, 7869936 bytes).
>> Transcript written on refman.log.
>> creating doc/manual/version.texi
>> texi2dvi --pdf --texinfo="@set UseExternalXrefs " R-FAQ.texi
>> This is pdfTeX, Version 3.141592-1.40.4 (MiKTeX 2.6)
>> entering extended mode
>> ! I can't find file `\tmp\t2d6036\xtr\R-FAQ.texi'.
>> <*> /tmp/t2d6036/xtr/R-FAQ.texi
>>
>> Please type another input file name:
>>
>> Now the file  /tmp/t2d6036/xtr/R-FAQ.texi exists at this point is not
empty
>> and has usual protection codes.  I tried different versions of back and
>> front slashes, double backslashes, etc., but to no avail.  I was getting
>> the same message - the file cannot be found.  The only thing that works
is
>> the plain file name.  That is, if I just type (or copy and paste) the
>> string R-FAQ.texi everything works fine.  This happens three times for
>> every manual (except the refman).  After that the compilation ends
>> normally, the windows installer is created and, when I run the
installer, I
>> get everything working correctly including PDFs of the manuals.
>>
>> It looks to me like the /tmp/t2d6036/xtr/ part of the name gets already
>> pre-pended to whatever name the make process provides so it expects just
>> the file name.  Alternatively, something changed in my MiKTeX setup due
to
>> updates.  However, the refman compiles properly and I can also compile
>> other LaTeX with no apparent problems.
>>
>> Thanks in advance,
>
> How do you have your temp directory set?  I'm not sure if it's R or one
> of the build tools that's important here, so it's worth looking at all
> environment variables TMPDIR, TEMP, TMP, etc.
>
> Are you running the build in Cygwin, or in a Windows CMD window?  I use
> Cygwin (not quite so current as yours) and don't see this error.
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

--
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Gregor.Gorjanc at bfro.uni-lj.si  Wed Sep  5 16:57:14 2007
From: Gregor.Gorjanc at bfro.uni-lj.si (Gorjanc Gregor)
Date: Wed, 5 Sep 2007 16:57:14 +0200
Subject: [Rd] Demo folder and 00Index file format
Message-ID: <F189E18BBAA8B6479F618B9044CF4E9C01885177C9@owa.bfro.uni-lj.si>

Hi!

Columns in demo/00Index must be separated with at least 3 spaces otherwise
the following WARNING is issued during R CMD check

...
* checking index information ... WARNING
Demos with missing or empty index information:
[1] "foo"
...

After a search I found out that this is noted in file

src/library/tools/R/read.00Index.R

I suggest to update the manual in the following way.

Regards, Gregor

Index: doc/manual/R-exts.texi
===================================================================
--- doc/manual/R-exts.texi      (revision 42745)
+++ doc/manual/R-exts.texi      (working copy)
@@ -560,8 +560,8 @@
 of the extensions @file{.R} or @file{.r}.  If present, the @file{demo}
 subdirectory should also have a @file{00Index} file with one line for
 each demo, giving its name and a description separated by white
-space. (Note that it is not possible to generate this index file
-automatically.)
+space - at least 3 spaces or 1 tab. (Note that it is not possible to
+generate this index file automatically.)


From honza at ifolk.cz  Wed Sep  5 11:25:57 2007
From: honza at ifolk.cz (honza at ifolk.cz)
Date: Wed,  5 Sep 2007 11:25:57 +0200 (CEST)
Subject: [Rd] (PR#9896) read.spss converts string variables with
Message-ID: <20070905092557.3022366931@slim.kubism.ku.dk>

------=_20070905112441_38848
Content-Type: text/plain; charset="iso-8859-2"
Content-Transfer-Encoding: 8bit

I am sending two files attached. The file problem_file.sav was saved in
SPSS 10.0. It contains variables of various types, with and without
labeling etc., so that you can make experiments.

The file problem_file_read.RData was saved in R 2.5.1 (foreign library
version 0.8-20). It contains two data frames Schools and Schools2. The
former is result of
read.spss("problem_file.sav",to.data.frame=TRUE,use.value.labels=TRUE),
the latter differs in use.value.lables=FALSE only. As you can see, in the
first case read.spss has not read values of string labeled variables at
all.

I use WinXP.

Thank you for your work!

Jan Hucin

-------------------------------------------------------------------
Reference: <20070903104656.1D1566691D at slim.kubism.ku.dk>

There is nothing we can do to reproduce this without an example 'some.sav'
file exhibiting the problem.  Can you please supply one?

On Mon, 3 Sep 2007, honza at ifolk.cz wrote:

> Full_Name: Jan Hucin
> Version: 2.5.1 (foreign 0.8-20)
> OS: WinXP
> Submission from: (NULL) (195.113.83.7)
>
>
> When reading an SPSS file:
>
> - containing some variable of type String
> - with value labels at that variable
> - and with determination which values of that variable are considered to be
> missing,
>
> I have always get <NA> where digits were in the original SPSS file.
>
> Example:
> Let's have in an SPSS file "some.sav" the variable A. The type of the
variable
> is String of length 1.
> Let's have a value labeling: 1 = Yes, 2 = No, 8 = Invalid, 9 = Missing.
> Let's determine that value 9 is considered to be missing.
> When this file is read by
abc=read.spss("some.sav",use.value.labels=TRUE), we
> get <NA> in abc$A on places where "1", "2" etc. were. Surprisingly, we
get "N/A"
> (not <NA>!) on the place where the string "N/A" is.
>
> If we specify use.value.labels=FALSE, then we get string values (such as
"1",
> "2") but we lose value labels (Yes, No etc.).
>
> Let me add that if the variable in the original SPSS file was of type
Numeric
> (not String), there would be no problem.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



__________ Informace od NOD32 2505 (20070904) __________

Tato zprava byla proverena antivirovym systemem NOD32.
http://www.nod32.cz


------=_20070905112441_38848
Content-Type: application/octet-stream; name="problem_file.sav"
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="problem_file.sav"

JEZMMkAoIykgU1BTUyBEQVRBIEZJTEUgTVMgV2luZG93cyBSZWxlYXNlIDEwLjAuNSBzcHNzaW8z
Mi5kbGwgIAIAAAAYAAAAAQAAAAAAAAAKAAAAAAAAAAAAWUAwNSBTZXAgMDcxMTowOTo0NyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAAAAACAAAAAwAAAAEAAAAAAAAAAAMBAAADAQBDTlQgICAgIBgAAABDb3VudHJ5IGNvZGUgMy1j
aGFyYWN0ZXICAAAAAwAAAAEAAAAAAAAAAAMBAAADAQBDT1VOVFJZIBQAAABDb3VudHJ5IGNvZGUg
My1kaWdpdAIAAAAFAAAAAQAAAAAAAAAABQEAAAUBAFNDSE9PTElEEQAAAFNjaG9vbCBJRCA1LWRp
Z2l0ICAgAgAAAAAAAAABAAAAAwAAAAAFBQAABQUAU0MwMVEwMSASAAAATnVtYmVyIG9mIGJveXMg
UTFhICAAAAAAgIbDQAAAAAAAh8NAAAAAAICHw0ACAAAAAQAAAAEAAAADAAAAAAEBAAABAQBTQzAy
UTAxIBQAAABQdWJsaWMgb3IgcHJpdmF0ZSBRMjcgICAgICAgOCAgICAgICA5ICAgICAgIAIAAAAB
AAAAAQAAAAMAAAAAAQEAAAEBAFNDMDRRMDEgCwAAAEdyYWRlIDEgUTRhIDcgICAgICAgOCAgICAg
ICA5ICAgICAgIAIAAAABAAAAAQAAAAMAAAAAAQEAAAEBAFNDMDRRMDIgCwAAAEdyYWRlIDIgUTRi
IDcgICAgICAgOCAgICAgICA5ICAgICAgIAIAAAABAAAAAQAAAAMAAAAAAQEAAAEBAFNDMDRRMDMg
CwAAAEdyYWRlIDMgUTRjIDcgICAgICAgOCAgICAgICA5ICAgICAgIAIAAAABAAAAAQAAAAMAAAAA
AQEAAAEBAFNDMDRRMDQgCwAAAEdyYWRlIDQgUTRkIDcgICAgICAgOCAgICAgICA5ICAgICAgIAIA
AAABAAAAAQAAAAMAAAAAAQEAAAEBAFNDMDRRMDUgCwAAAEdyYWRlIDUgUTRlIDcgICAgICAgOCAg
ICAgICA5ICAgICAgIAIAAAABAAAAAQAAAAMAAAAAAQEAAAEBAFNDMDRRMDYgCwAAAEdyYWRlIDYg
UTRmIDcgICAgICAgOCAgICAgICA5ICAgICAgIAIAAAABAAAAAQAAAAMAAAAAAQEAAAEBAFNDMDRR
MDcgCwAAAEdyYWRlIDcgUTRnIDcgICAgICAgOCAgICAgICA5ICAgICAgIAIAAAABAAAAAQAAAAMA
AAAAAQEAAAEBAFNDMDRRMDggCwAAAEdyYWRlIDggUTRoIDcgICAgICAgOCAgICAgICA5ICAgICAg
IAIAAAABAAAAAQAAAAMAAAAAAQEAAAEBAFNDMDRRMDkgCwAAAEdyYWRlIDkgUTRpIDcgICAgICAg
OCAgICAgICA5ICAgICAgIAIAAAABAAAAAQAAAAMAAAAAAQEAAAEBAFNDMDRRMTAgDAAAAEdyYWRl
IDEwIFE0ajcgICAgICAgOCAgICAgICA5ICAgICAgIAIAAAABAAAAAQAAAAMAAAAAAQEAAAEBAFND
MDRRMTEgDAAAAEdyYWRlIDExIFE0azcgICAgICAgOCAgICAgICA5ICAgICAgIAIAAAABAAAAAQAA
AAMAAAAAAQEAAAEBAFNDMDRRMTIgDAAAAEdyYWRlIDEyIFE0bDcgICAgICAgOCAgICAgICA5ICAg
ICAgIAIAAAABAAAAAQAAAAMAAAAAAQEAAAEBAFNDMDRRMTMgDAAAAEdyYWRlIDEzIFE0bTcgICAg
ICAgOCAgICAgICA5ICAgICAgIAIAAAAAAAAAAQAAAP3///8CCAUAAggFAFNDMDVRMDEgHgAAAFJl
cGVhdCA8Z3JhZGU+IGF0IDxJU0NFRDI+IFE1YSAgAAAAAICGw0AAAAAAgIfDQAAAAAAAII9AAgAA
AAAAAAABAAAA/f///wIIBQACCAUAU0MwNVEwMiAeAAAAUmVwZWF0IDxncmFkZT4gYXQgPElTQ0VE
Mz4gUTViICAAAAAAgIbDQAAAAACAh8NAAAAAAAAgj0ACAAAAAAAAAAEAAAACAAAAAAEFAAABBQBB
QkdST1VQIEcAAABBYmlsaXR5IGdyb3VwaW5nIHdpdGhpbiBzY2hvb2xzIHJlY29kZWQgZnJvbSBT
QzA4UTAxIGFuZCBTQzA4UTAyICgyMDA2KSAAAAAAAAAcQAAAAAAAACJAAgAAAAAAAAABAAAAAgAA
AAACBQAAAgUAQ0xTSVpFICAyAAAAU2l6ZSBvZiA8dGVzdCBsYW5ndWFnZT4gY2xhc3MgcmVjb2Rl
ZCBmcm9tIFNDMDZRMDEgIAAAAAAAQFhAAAAAAADAWEACAAAAAAAAAAEAAAADAAAAAwgFAAMIBQBD
T01QV0VCICgAAABQcm9wb3J0aW9uIG9mIGNvbXB1dGVycyBjb25uZWN0ZWQgdG8gd2ViAAAAAICG
w0AAAAAAAIfDQAAAAACAh8NAAgAAAAAAAAABAAAAAgAAAAABBQAAAQUAU0NITFRZUEUQAAAAU2No
b29sIG93bmVyc2hpcAAAAAAAABxAAAAAAAAAIkADAAAAOQAAAEFSRyAgICAgCUFyZ2VudGluYSAg
ICAgIEFVUyAgICAgCUF1c3RyYWxpYSAgICAgIEFVVCAgICAgB0F1c3RyaWFBWkUgICAgIApBemVy
YmFpamFuICAgICBCRUwgICAgIAdCZWxnaXVtQkdSICAgICAIQnVsZ2FyaWEgICAgICAgQlJBICAg
ICAGQnJhemlsIENBTiAgICAgBkNhbmFkYSBDSEUgICAgIAtTd2l0emVybGFuZCAgICBDSEwgICAg
IAVDaGlsZSAgQ09MICAgICAIQ29sb21iaWEgICAgICAgQ1pFICAgICAOQ3plY2ggUmVwdWJsaWMg
REVVICAgICAHR2VybWFueUROSyAgICAgB0Rlbm1hcmtFU1AgICAgIAVTcGFpbiAgRVNUICAgICAH
RXN0b25pYUZJTiAgICAgB0ZpbmxhbmRGUkEgICAgIAZGcmFuY2UgR0JSICAgICAOVW5pdGVkIEtp
bmdkb20gR1JDICAgICAGR3JlZWNlIEhLRyAgICAgD0hvbmcgS29uZy1DaGluYUhSViAgICAgB0Ny
b2F0aWFIVU4gICAgIAdIdW5nYXJ5SUROICAgICAJSW5kb25lc2lhICAgICAgSVJMICAgICAHSXJl
bGFuZElTTCAgICAgB0ljZWxhbmRJU1IgICAgIAZJc3JhZWwgSVRBICAgICAFSXRhbHkgIEpPUiAg
ICAgBkpvcmRhbiBKUE4gICAgIAVKYXBhbiAgS0daICAgICAKS3lyZ3l6c3RhbiAgICAgS09SICAg
ICAFS29yZWEgIExJRSAgICAgDUxpZWNodGVuc3RlaW4gIExUVSAgICAgCUxpdGh1YW5pYSAgICAg
IExVWCAgICAgCkx1eGVtYm91cmcgICAgIExWQSAgICAgBkxhdHZpYSBNQUMgICAgIAtNYWNhby1D
aGluYSAgICBNRVggICAgIAZNZXhpY28gTU5FICAgICAKTW9udGVuZWdybyAgICAgTkxEICAgICAL
TmV0aGVybGFuZHMgICAgTk9SICAgICAGTm9yd2F5IE5aTCAgICAgC05ldyBaZWFsYW5kICAgIFBP
TCAgICAgBlBvbGFuZCBQUlQgICAgIAhQb3J0dWdhbCAgICAgICBRQVQgICAgIAVRYXRhciAgUk9V
ICAgICAHUm9tYW5pYVJVUyAgICAgElJ1c3NpYW4gRmVkZXJhdGlvbiAgICAgU1JCICAgICAJU2Vy
YmlhICAgICAgICAgU1ZLICAgICAPU2xvdmFrIFJlcHVibGljU1ZOICAgICAJU2xvdmVuaWEgICAg
ICAgU1dFICAgICAGU3dlZGVuIFRBUCAgICAgDkNoaW5lc2UgVGFpcGVpIFRIQSAgICAgCFRoYWls
YW5kICAgICAgIFRVTiAgICAgB1R1bmlzaWFUVVIgICAgIAZUdXJrZXkgVVJZICAgICAHVXJ1Z3Vh
eVVTQSAgICAgDVVuaXRlZCBTdGF0ZXMgIAQAAAABAAAAAQAAAAMAAAA4AAAAMDMxICAgICAKQXpl
cmJhaWphbiAgICAgMDMyICAgICAJQXJnZW50aW5hICAgICAgMDM2ICAgICAJQXVzdHJhbGlhICAg
ICAgMDQwICAgICAHQXVzdHJpYTA1NiAgICAgB0JlbGdpdW0wNzYgICAgIAZCcmF6aWwgMTAwICAg
ICAIQnVsZ2FyaWEgICAgICAgMTI0ICAgICAGQ2FuYWRhIDE1MiAgICAgBUNoaWxlICAxNTggICAg
IA5DaGluZXNlIFRhaXBlaSAxNzAgICAgIAhDb2xvbWJpYSAgICAgICAxOTEgICAgIAdDcm9hdGlh
MjAzICAgICAOQ3plY2ggUmVwdWJsaWMgMjA4ICAgICAHRGVubWFyazIzMyAgICAgB0VzdG9uaWEy
NDYgICAgIAdGaW5sYW5kMjUwICAgICAGRnJhbmNlIDI3NiAgICAgB0dlcm1hbnkzMDAgICAgIAZH
cmVlY2UgMzQ0ICAgICAPSG9uZyBLb25nLUNoaW5hMzQ4ICAgICAHSHVuZ2FyeTM1MiAgICAgB0lj
ZWxhbmQzNjAgICAgIAlJbmRvbmVzaWEgICAgICAzNzIgICAgIAdJcmVsYW5kMzc2ICAgICAGSXNy
YWVsIDM4MCAgICAgBUl0YWx5ICAzOTIgICAgIAVKYXBhbiAgNDAwICAgICAGSm9yZGFuIDQxMCAg
ICAgBUtvcmVhICA0MTcgICAgIApLeXJneXpzdGFuICAgICA0MjggICAgIAZMYXR2aWEgNDM4ICAg
ICANTGllY2h0ZW5zdGVpbiAgNDQwICAgICAJTGl0aHVhbmlhICAgICAgNDQyICAgICAKTHV4ZW1i
b3VyZyAgICAgNDQ2ICAgICALTWFjYW8tQ2hpbmEgICAgNDg0ICAgICAGTWV4aWNvIDUyOCAgICAg
C05ldGhlcmxhbmRzICAgIDU1NCAgICAgC05ldyBaZWFsYW5kICAgIDU3OCAgICAgBk5vcndheSA2
MTYgICAgIAZQb2xhbmQgNjIwICAgICAIUG9ydHVnYWwgICAgICAgNjM0ICAgICAFUWF0YXIgIDY0
MiAgICAgB1JvbWFuaWE2NDMgICAgIBJSdXNzaWFuIEZlZGVyYXRpb24gICAgIDcwMyAgICAgD1Ns
b3ZhayBSZXB1YmxpYzcwNSAgICAgCFNsb3ZlbmlhICAgICAgIDcyNCAgICAgBVNwYWluICA3NTIg
ICAgIAZTd2VkZW4gNzU2ICAgICALU3dpdHplcmxhbmQgICAgNzY0ICAgICAIVGhhaWxhbmQgICAg
ICAgNzg4ICAgICAHVHVuaXNpYTc5MiAgICAgBlR1cmtleSA4MjYgICAgIA5Vbml0ZWQgS2luZ2Rv
bSA4NDAgICAgIA1Vbml0ZWQgU3RhdGVzICA4NTggICAgIAdVcnVndWF5ODkxICAgICAYU2VyYmlh
IGFuZC9vciBNb250ZW5lZ3JvICAgICAgIAQAAAABAAAAAgAAAAMAAAADAAAAAAAAAICGw0ADTi9B
ICAgIAAAAAAAh8NAB0ludmFsaWQAAAAAgIfDQAdNaXNzaW5nBAAAAAIAAAAEAAAAFwAAAAMAAAAF
AAAAMSAgICAgICAGUHVibGljIDIgICAgICAgB1ByaXZhdGU3ICAgICAgIANOL0EgICAgOCAgICAg
ICAHSW52YWxpZDkgICAgICAgB01pc3NpbmcEAAAAAQAAAAUAAAADAAAABQAAADEgICAgICAgA1ll
cyAgICAyICAgICAgIAJObyAgICAgNyAgICAgICADTi9BICAgIDggICAgICAgB0ludmFsaWQ5ICAg
ICAgIAdNaXNzaW5nBAAAAA0AAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAP
AAAAEAAAABEAAAASAAAAAwAAAAQAAAAAAAAAACCPQANOL0EgICAgAAAAAICGw0ADTi9BICAgIAAA
AAAAh8NAB0ludmFsaWQAAAAAgIfDQAdNaXNzaW5nBAAAAAIAAAATAAAAFAAAAAMAAAAFAAAAAAAA
AAAA8D8UTm90IGZvciBhbnkgc3ViamVjdHMgICAAAAAAAAAAQBFGb3Igc29tZSBzdWJqZWN0cyAg
ICAgIAAAAAAAAAhAEEZvciBhbGwgc3ViamVjdHMgICAgICAgAAAAAAAAHEADTi9BICAgIAAAAAAA
ACJAB01pc3NpbmcEAAAAAQAAABUAAAADAAAAAgAAAAAAAAAAQFhAA04vQSAgICAAAAAAAMBYQARN
aXNzICAgBAAAAAEAAAAWAAAAAwAAAAYAAAAAAAAAAADwPxNQcml2YXRlIGluZGVwZW5kZW50ICAg
IAAAAAAAAABAHFByaXZhdGUgZ292ZXJubWVudC1kZXBlbmRlbnQgICAAAAAAAAAIQAZQdWJsaWMg
AAAAAAAAHEADTi9BICAgIAAAAAAAACBAB0ludmFsaWQAAAAAAAAiQAdNaXNzaW5nBAAAAAEAAAAY
AAAABwAAAAMAAAAEAAAACAAAAAoAAAAAAAAABQAAANACAAABAAAAAQAAAAIAAAACAAAABwAAAAQA
AAAIAAAAAwAAAP///////+//////////73/+///////v/wcAAAALAAAABAAAAEgAAAABAAAABQAA
AAAAAAABAAAABwAAAAAAAAABAAAACAAAAAAAAAADAAAABwAAAAEAAAABAAAABwAAAAAAAAABAAAA
BwAAAAAAAAABAAAABwAAAAAAAAABAAAABwAAAAAAAAABAAAABwAAAAAAAAABAAAABwAAAAAAAAAB
AAAABwAAAAAAAAABAAAABwAAAAAAAAABAAAABwAAAAAAAAABAAAABwAAAAAAAAABAAAABwAAAAAA
AAABAAAABwAAAAAAAAABAAAABwAAAAAAAAABAAAABwAAAAAAAAADAAAACwAAAAEAAAADAAAACwAA
AAEAAAACAAAABwAAAAEAAAADAAAABgAAAAEAAAADAAAACwAAAAEAAAACAAAACAAAAAEAAAAHAAAA
DQAAAAEAAACDCwAAQ05UPUNOVAlDT1VOVFJZPUNPVU5UUlkJU1VCTkFUPVN1Yk5hdAlTQ0hPT0xJ
RD1TQ0hPT0xJRAlTQzAxUTAxPVNDMDFRMDEJU0MwMVEwMj1TQzAxUTAyCVNDMDJRMDE9U0MwMlEw
MQlTQzAzUTAxPVNDMDNRMDEJU0MwM1EwMj1TQzAzUTAyCVNDMDNRMDM9U0MwM1EwMwlTQzAzUTA0
PVNDMDNRMDQJU0MwNFEwMT1TQzA0UTAxCVNDMDRRMDI9U0MwNFEwMglTQzA0UTAzPVNDMDRRMDMJ
U0MwNFEwND1TQzA0UTA0CVNDMDRRMDU9U0MwNFEwNQlTQzA0UTA2PVNDMDRRMDYJU0MwNFEwNz1T
QzA0UTA3CVNDMDRRMDg9U0MwNFEwOAlTQzA0UTA5PVNDMDRRMDkJU0MwNFExMD1TQzA0UTEwCVND
MDRRMTE9U0MwNFExMQlTQzA0UTEyPVNDMDRRMTIJU0MwNFExMz1TQzA0UTEzCVNDMDRRMTQ9U0Mw
NFExNAlTQzA1UTAxPVNDMDVRMDEJU0MwNVEwMj1TQzA1UTAyCVNDMDZRMDE9U0MwNlEwMQlTQzA3
UTAxPVNDMDdRMDEJU0MwOFEwMT1TQzA4UTAxCVNDMDhRMDI9U0MwOFEwMglTQzA5UTExPVNDMDlR
MTEJU0MwOVExMj1TQzA5UTEyCVNDMDlRMjE9U0MwOVEyMQlTQzA5UTIyPVNDMDlRMjIJU0MwOVEz
MT1TQzA5UTMxCVNDMDlRMzI9U0MwOVEzMglTQzEwUTAxPVNDMTBRMDEJU0MxMVFBMT1TQzExUWEx
CVNDMTFRQTI9U0MxMVFhMglTQzExUUEzPVNDMTFRYTMJU0MxMVFBND1TQzExUWE0CVNDMTFRQjE9
U0MxMVFiMQlTQzExUUIyPVNDMTFRYjIJU0MxMVFCMz1TQzExUWIzCVNDMTFRQjQ9U0MxMVFiNAlT
QzExUUMxPVNDMTFRYzEJU0MxMVFDMj1TQzExUWMyCVNDMTFRQzM9U0MxMVFjMwlTQzExUUM0PVND
MTFRYzQJU0MxMVFEMT1TQzExUWQxCVNDMTFRRDI9U0MxMVFkMglTQzExUUQzPVNDMTFRZDMJU0Mx
MVFEND1TQzExUWQ0CVNDMTFRRTE9U0MxMVFlMQlTQzExUUUyPVNDMTFRZTIJU0MxMVFFMz1TQzEx
UWUzCVNDMTFRRTQ9U0MxMVFlNAlTQzExUUYxPVNDMTFRZjEJU0MxMVFGMj1TQzExUWYyCVNDMTFR
RjM9U0MxMVFmMwlTQzExUUY0PVNDMTFRZjQJU0MxMVFHMT1TQzExUWcxCVNDMTFRRzI9U0MxMVFn
MglTQzExUUczPVNDMTFRZzMJU0MxMVFHND1TQzExUWc0CVNDMTFRSDE9U0MxMVFoMQlTQzExUUgy
PVNDMTFRaDIJU0MxMVFIMz1TQzExUWgzCVNDMTFRSDQ9U0MxMVFoNAlTQzExUUkxPVNDMTFRaTEJ
U0MxMVFJMj1TQzExUWkyCVNDMTFRSTM9U0MxMVFpMwlTQzExUUk0PVNDMTFRaTQJU0MxMVFKMT1T
QzExUWoxCVNDMTFRSjI9U0MxMVFqMglTQzExUUozPVNDMTFRajMJU0MxMVFKND1TQzExUWo0CVND
MTFRSzE9U0MxMVFrMQlTQzExUUsyPVNDMTFRazIJU0MxMVFLMz1TQzExUWszCVNDMTFRSzQ9U0Mx
MVFrNAlTQzExUUwxPVNDMTFRbDEJU0MxMVFMMj1TQzExUWwyCVNDMTFRTDM9U0MxMVFsMwlTQzEx
UUw0PVNDMTFRbDQJU0MxMlFBMT1TQzEyUWExCVNDMTJRQTI9U0MxMlFhMglTQzEyUUEzPVNDMTJR
YTMJU0MxMlFBND1TQzEyUWE0CVNDMTJRQjE9U0MxMlFiMQlTQzEyUUIyPVNDMTJRYjIJU0MxMlFC
Mz1TQzEyUWIzCVNDMTJRQjQ9U0MxMlFiNAlTQzEyUUMxPVNDMTJRYzEJU0MxMlFDMj1TQzEyUWMy
CVNDMTJRQzM9U0MxMlFjMwlTQzEyUUM0PVNDMTJRYzQJU0MxMlFEMT1TQzEyUWQxCVNDMTJRRDI9
U0MxMlFkMglTQzEyUUQzPVNDMTJRZDMJU0MxMlFEND1TQzEyUWQ0CVNDMTJRRTE9U0MxMlFlMQlT
QzEyUUUyPVNDMTJRZTIJU0MxMlFFMz1TQzEyUWUzCVNDMTJRRTQ9U0MxMlFlNAlTQzEyUUYxPVND
MTJRZjEJU0MxMlFGMj1TQzEyUWYyCVNDMTJRRjM9U0MxMlFmMwlTQzEyUUY0PVNDMTJRZjQJU0Mx
M1EwMT1TQzEzUTAxCVNDMTNRMDI9U0MxM1EwMglTQzEzUTAzPVNDMTNRMDMJU0MxNFEwMT1TQzE0
UTAxCVNDMTRRMDI9U0MxNFEwMglTQzE0UTAzPVNDMTRRMDMJU0MxNFEwND1TQzE0UTA0CVNDMTRR
MDU9U0MxNFEwNQlTQzE0UTA2PVNDMTRRMDYJU0MxNFEwNz1TQzE0UTA3CVNDMTRRMDg9U0MxNFEw
OAlTQzE0UTA5PVNDMTRRMDkJU0MxNFExMD1TQzE0UTEwCVNDMTRRMTE9U0MxNFExMQlTQzE0UTEy
PVNDMTRRMTIJU0MxNFExMz1TQzE0UTEzCVNDMTVRMDE9U0MxNVEwMQlTQzE1UTAyPVNDMTVRMDIJ
U0MxNVEwMz1TQzE1UTAzCVNDMTZRMDE9U0MxNlEwMQlTQzE3UTAxPVNDMTdRMDEJU0MxN1EwMj1T
QzE3UTAyCVNDMTdRMDM9U0MxN1EwMwlTQzE3UTA0PVNDMTdRMDQJU0MxN1EwNT1TQzE3UTA1CVND
MThRMDE9U0MxOFEwMQlTQzE5UTAxPVNDMTlRMDEJU0MxOVEwMj1TQzE5UTAyCVNDMTlRMDM9U0Mx
OVEwMwlTQzE5UTA0PVNDMTlRMDQJU0MxOVEwNT1TQzE5UTA1CVNDMTlRMDY9U0MxOVEwNglTQzIw
UTAxPVNDMjBRMDEJU0MyMFEwMj1TQzIwUTAyCVNDMjBRMDM9U0MyMFEwMwlTQzIwUTA0PVNDMjBR
MDQJU0MyMFEwNT1TQzIwUTA1CVNDMjFRMDE9U0MyMVEwMQlTQzIxUTAyPVNDMjFRMDIJU0MyMVEw
Mz1TQzIxUTAzCVNDMjFRMDQ9U0MyMVEwNAlTQzIyUTAxPVNDMjJRMDEJU0MyMlEwMj1TQzIyUTAy
CVNDMjJRMDM9U0MyMlEwMwlTQzIyUTA0PVNDMjJRMDQJU0MyMlEwNT1TQzIyUTA1CVNDMjNRMDE9
U0MyM1EwMQlTQzIzUTAyPVNDMjNRMDIJU0MyM1EwMz1TQzIzUTAzCVNDMjRRMDE9U0MyNFEwMQlT
QzI1UTAxPVNDMjVRMDEJU0MyNlEwMT1TQzI2UTAxCVNDMjdRMDE9U0MyN1EwMQlTQzI4UTAxPVND
MjhRMDEJU0MyOVEwMT1TQzI5UTAxCUFCR1JPVVA9QUJHUk9VUAlDTFNJWkU9Q0xTSVpFCUNPTVBX
RUI9Q09NUFdFQglJUkFUQ09NUD1JUkFUQ09NUAlQQ0dJUkxTPVBDR0lSTFMJUFJPUENFUlQ9UFJP
UENFUlQJUFJPUFFVQUw9UFJPUFFVQUwJUkFUQ09NUD1SQVRDT01QCVNDSExUWVBFPVNDSExUWVBF
CVNDSFNJWkU9U0NIU0laRQlTRUxFQ1Q9U0VMRUNUCVNUUkFUSU89U1RSQVRJTwlFTlZMRUFSTj1F
TlZMRUFSTglSRVNQUkVTPVJFU1BSRVMJUkVTUENVUlI9UkVTUENVUlIJU0NJUFJPTT1TQ0lQUk9N
CVNDTUFURURVPVNDTUFURURVCVRDU0hPUlQ9VENTSE9SVAlXX0ZTQ0hXVD1XX0ZTQ0hXVOcDAAAA
AAAA/f39/f39/f1DWkUgICAgIDIwMyAgICAgMDEwMDEgICAAAAAAAMBxQDEgICAgICAgMSAgICAg
ICAxICAgICAgIDEgICAgICAg/f39/f39/f0xICAgICAgIDEgICAgICAgMSAgICAgICAxICAgICAg
IDEgICAgICAgMSAgICAgICAyICAgICAgIDIgICAgICAg/f1k/WeAZWcyICAgICAgIDIgICAgICAg
AAAAAAAgj0D9/f39/f39/UNaRSAgICAgMjAzICAgICAwMTYwMiAgIAAAAAAAwHJAMSAgICAgICAx
ICAgICAgIDEgICAgICAgMSAgICAgICD9/f39/f39/TEgICAgICAgMSAgICAgICAxICAgICAgIDEg
ICAgICAgMSAgICAgICAxICAgICAgIDIgICAgICAgMiAgICAgICD9/WT9ZYBlZzIgICAgICAgMiAg
ICAgICAAAAAAACCPQP39/f39/f39Q1pFICAgICAyMDMgICAgIDAyMDAxICAgAAAAAACQc0AxICAg
ICAgIDEgICAgICAgMSAgICAgICAxICAgICAgIP39/f39/f39MSAgICAgICAxICAgICAgIDEgICAg
ICAgMSAgICAgICAxICAgICAgIDEgICAgICAgMiAgICAgICAyICAgICAgIP39ZP1me2VnMiAgICAg
ICAyICAgICAgIAAAAAAAII9A/f39/f39/f1DWkUgICAgIDIwMyAgICAgMDIwMDQgICAAAAAAAKBt
QDEgICAgICAgMSAgICAgICAxICAgICAgIDEgICAgICAg/f39/f39/f0xICAgICAgIDEgICAgICAg
MSAgICAgICAxICAgICAgIDEgICAgICAgMSAgICAgICAyICAgICAgIDIgICAgICAg/f1l/WZ2ZWcy
ICAgICAgIDIgICAgICAgAAAAAAAgj0D9/f39/f39/UNaRSAgICAgMjAzICAgICAwMjMwMyAgIAAA
AAAAIG5AMSAgICAgICAxICAgICAgIDEgICAgICAgMSAgICAgICD9/f39/f39/TEgICAgICAgMSAg
ICAgICAxICAgICAgIDEgICAgICAgMSAgICAgICAxICAgICAgIDIgICAgICAgMiAgICAgICD9/f39
ZoBlZzIgICAgICAgMiAgICAgICCamZmZmZnpPwAAAAAAII9A/f39/f39/f1DWkUgICAgIDIwMyAg
ICAgMDIzMDUgICAAAAAAgIfDQDkgICAgICAgOSAgICAgICA5ICAgICAgIDkgICAgICAg/f39/f39
/f05ICAgICAgIDkgICAgICAgOSAgICAgICA5ICAgICAgIDkgICAgICAgOSAgICAgICA5ICAgICAg
IDkgICAgICAg/f39/W3H/W05ICAgICAgIDkgICAgICAgAAAAAICHw0AAAAAAgIfDQAAAAACAh8NA
/f39/f39/f1DWkUgICAgIDIwMyAgICAgMDMzMDEgICAAAAAAACBnQDEgICAgICAgMSAgICAgICAx
ICAgICAgIDEgICAgICAg/f39/f39/f0xICAgICAgIDEgICAgICAgMSAgICAgICAxICAgICAgIDEg
ICAgICAgMSAgICAgICAyICAgICAgIDIgICAgICAg/f1k/WaA/WcyICAgICAgIDIgICAgICAgAAAA
AAAgj0Boke18PzXuP/39/dn9/f39Q1pFICAgICAyMDMgICAgIDAzMzAyICAgMSAgICAgICAxICAg
ICAgIDEgICAgICAgMSAgICAgICD9/f39/f39/TEgICAgICAgMSAgICAgICAxICAgICAgIDEgICAg
ICAgMSAgICAgICAxICAgICAgIDIgICAgICAgMiAgICAgICD9/WT9Znv9ZzIgICAgICAgMiAgICAg
ICAAAAAAACCPQPCnxks3ie0//f39/f39/f1DWkUgICAgIDIwMyAgICAgMDQwMDIgICAAAAAAABB1
QDEgICAgICAgMSAgICAgICAxICAgICAgIDEgICAgICAg/f39/f39/f0xICAgICAgIDEgICAgICAg
MSAgICAgICAxICAgICAgIDEgICAgICAgMSAgICAgICAyICAgICAgIDIgICAgICAg/f1k/Wd7/Wcy
ICAgICAgIDIgICAgICAgAAAAAAAgj0DByqFFtvPVP/39/f39/f39Q1pFICAgICAyMDMgICAgIDA0
MzAxICAgAAAAAADgd0AxICAgICAgIDEgICAgICAgMSAgICAgICAxICAgICAgIP39/f39/f39MSAg
ICAgICAxICAgICAgIDEgICAgICAgMSAgICAgICAxICAgICAgIDEgICAgICAgMiAgICAgICAyICAg
ICAgIP39/f1mgGVnMiAgICAgICAyICAgICAgIJqZmZmZmek/AAAAAAAgj0A=
------=_20070905112441_38848
Content-Type: application/octet-stream; name="problem_file_read.RData"
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="problem_file_read.RData"

H4sIAAAAAAAAC+0ZuW4bR3RFitRly/JRqDCCgSunsE1RN2BYB3WY1i1KiGwgxZAcLcdazjCzu6Il
pHAVI1WSMqmSKn+Q2oGBFOnTp03hwECAlFZmxH3LnSVp6vCFYAksZ9+bmXfNe29m3m7O7aR7d3oN
w4gZsUSHEYvL186Y/OswjIEe2XblCiXOLdsw4lclOCjbi7LtfSr/TvKEyCUtsk8UNWNAPpPyUdie
GWES5lCGfYRrOwJbFBBdxwgf7J05JCKP6WPMYMAssUzqlj2we9a1TFyfkJwV+JBaAGUww0Xo68tV
qSPpWZgVPVQiU6IWAVoZbvFy3qfVnzkkhRLaJBU3b9ECCLBIRBmzAwDnCCtjsQcEcxVMfVnnbYez
um4LlAV4JxcEZgVg3r/NqEOKaIkys8hBveSiIMQfc+k+ZyZakn+3pNy+EbsygmOnzua+y6RJQMCe
LCtyRux6f1aQgBhd2UIQTGZtgQkYMJF1sAWUkg+4KPoLkXiAKz7Qu3QgzIND26l3L3FBgOXFZSot
6RBmO8S3Ts8ydUourtund9l9Qsp57goTOC5jZ9/v71vBBcw11ZMr5AktcCCwwplkQkwBmL5V4pRq
K27DlFUuqvigPqCKHhEctMA6D0Dd61w4rol9i2xgBwuw3SYvBxS4suna0s4MLZAiEXJJuK9rTrox
xQghWMqcxffxXti5ehSaSIowLpmrSlpApl/pTmyCtjCtEAoibpUwDa7olstofb2TW67YI76/bgvX
dH39L3pul3OwQ+xQECcKFrYhhjuA3C4uOFxZ4PXZckTsyKM4AcvWEOSnzhOhrKBngYYcoWUFLQW0
MHAoMYQCrkWe0BPDaXJBKMWcLAnoUR+K6nZJ4A1Rr8V5KAUEY7wxBejRe9Yc0Dbqm8R4s6jWwv5d
xHiLkO6GkAbiwR1CD+8mG9SpYrv5HhIO8WZpYNDLT5LRHS5QMI+qkI1DyL4hCXi9Kn8cHy6Uqmqk
YqYUgQUOJYFeMEtqKJUaqgNjqbQPpIM9EhipA8Op4SAw6gPDw4E5EqhTG0kFgeNh7XWM9StZp794
bqjftPBa+9taW/6x1jJUa188e3rcmh78+XStdQdqbfVPo/bT8u2FfWy55LaF88dHp2OecZ/Wi2ce
7a+eNpmbYLhMIFfHYZVXqHRWBqHUlWWSAwVfiq/emalpd+5UngCbrWspcF3Qfel0Or8mktTlPKm3
nVPO+EM/EmKrkEgi+SL5Ivki+SL5Ivki+f5/8ilh2sjX2SjK25TK6w0/nY249yxV3Kif3uFJBN7j
tbbpWl5b5Q7albcGeWNFtpt/TAoOLO7lBYm3eZmEOwZUB7asMD6o1ykU8Y7nd2ur7LfjXpsO4Xee
Nx83ro+rce488ujH/Hk704H+BEgW8yTrVILr+rwOijn1qja5XQsn/6m/R6e+fPldaerl1+NLv/38
auqPf36Z/+n3X2FcSMw2NwZf3LNfErzJ4SfZiNMcJumRvOpdCxBlRVIh8o85Xtd16DLlnVmwsuy5
FR6j3zHeTiBohhkE0pnVLaCVWdte3dp86IHducz9tbXl7Bx05zKpoQ3/wqnAtA6ONIBpHRzWwREd
HNXBMR0c18EJHZzUwKGUDupSDelSDQWlGtVVGA2oMDO7uLm2vQ6WzSznso/m66ZbWf9sfjZguuWt
h+vzoftrj+DV23CHVV4WUz57dHT0b4v16y1iB9/eFXJKiNSlfVXsy1uBm3RwWQcz3GWOOEAFXiRo
+FahhIV0BQIFn2uh/iI1Kfje5dpXEpSdQ6Nax5VVt5wnAvFdlOcHNtoYghLNtZq7IpnvKp5zb4Dh
+hYFljyG0MYI1lFpicrrqGGJKuioEYkq6qhRiSI6akyidnXUuESZOmpCoko6alKiqIe64ImakrjH
IZySfy+EUwpYIZzSAKpSn2zKsMYOumuqvntIvWZzmfm59D20MYrbjRpWo8BAizN5alHnAJmCuxUZ
8qhKnRJlyK5900KCqLUsol3By0j67oR0ZVXr8t7T6GY6lRr71COXztFDolbyrkNsB1mYmS42Jffj
cngDsbF6XNxcF7zChSoKqvkFXq640rFs+caY3OXkLIejKgHBBzx34lUmR5VoJcpEHyQTwfampZFu
74toOvxJ1Gh+imvyaNsfJK545tH8uY+MJ2aWVusZ1XDfdQ33/Z6+mnlArI1HwOm0A0zaMXluL4x4
RjwjnhHPM/FMRzw/Ep61jdFo8fPLEn99r34/wAbXcrw3LrQxdrbaGKe/Qd5MbYOEoteJNsjGvdLb
7D3abVuQrc24j0Knbs/OUCYyWrQ3WuC7dTikU8Kfd735eL3s5OsG5cCQbgFlWtX8WhYJW1UWdXNE
RT/j3R47dbdr29442biQAkl/HvLa07kfFBdPHFp6GfEkhccWdcvA3TG6uH+AEmJSGf1MFcOuo6g0
GJUGo9JglGHalwaN1/8BQ7FK8UQxAAA=
------=_20070905112441_38848--


From Gregor.Gorjanc at bfro.uni-lj.si  Wed Sep  5 18:32:51 2007
From: Gregor.Gorjanc at bfro.uni-lj.si (Gorjanc Gregor)
Date: Wed, 5 Sep 2007 18:32:51 +0200
Subject: [Rd] RUnit testing with R CMD check and more (was: R CMD check
 recursive copy of tests/)
Message-ID: <F189E18BBAA8B6479F618B9044CF4E9C01885177CE@owa.bfro.uni-lj.si>

Hello!

I have looked at Martin's recent work on "merging" unit tests with R CMD check,
fused it with my and Tony's contributions and developed it a bit further. Take
a look into the attached demo package on how it works.

In essence:

PKG/inst/RUnitTests
          |- runRUnitTests.R (script to run RUnit tests)
          \- ...             (any RUnit test file)

PKG/R/runRUnitTests.R        (wrapper function to call PKG/inst/RUnitTests/runRUnitTests.R)
PKG/man/runRUnitTests.Rd     (help with examples! section)

The following can be achieved:

* useRs can run RUnit tests from within R after the package has been installed
  on their machine - this info is also given in PKG-package.Rd file to encourage
  useRs to test the package

* developeRs can run RUnit tests with:

  - R CMD check since examples in PKG/man/runRUnitTests.Rd are tested to work
    (test failures or R errors stop the R CMD check!)

  - launcing the script PKG/inst/RUnitTests/runRUnitTests.R with Rscript or
    R CMD check

I would like to hear any critiques, comments, suggestions, ... on above. Martin
mentioned (privately) that filenames have to much upper case letter, but I wanted
to emphasize that the main work is being done by RUnit package - not developed by
me!

Finnally, I would like to argue that from useRs point of view test and unit test
are the same thing and I believe that R would benefit if *all* tests could be
available in similar manner as above. This of course calls for the modification of
packaging, testing, etc., but could provide more feedback (sure some of it will be
bogous) on testing on various configurations.

With regards, Gregor

From ligges at statistik.uni-dortmund.de  Wed Sep  5 18:40:39 2007
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Wed, 05 Sep 2007 18:40:39 +0200
Subject: [Rd] Windows Vista Issues
In-Reply-To: <46DC7FD7.7070304@earthlink.net>
References: <46DC7FD7.7070304@earthlink.net>
Message-ID: <46DEDC07.1060502@statistik.uni-dortmund.de>

Dominick Samperi wrote:
> This is a repost of a simple question about Windows Vista and R (with
> answer), along with a heads-up on other Windows Vista issues that people may
> not be aware of and that may impact R development.
> 
> 1. The standard package install process fails because the user does not
> have permission to write to Program Files/R/R-version/library. Apparently
> the install process has already been modified to give the user the option
> of maintaining the library directory under his/her personal space, so this
> issue has a work-around.


Well, if you are Administrator and work under corresponding privileges 
(and start R with those privileges explicitly, right click to do that!) 
you can do package installations as on any other Windows. If you have 
not had the privileges before, package installation into that directory 
already failed with old versions of Windows.

Please do read the R for Windows FAQs as the R-help posting guide 
suggests. Those FAQs address these user errors.

We are talking about recent versions of R, I assume?


> 2. Windows Vista issues a very misleading error messages when the
> file Explorer encounters a zipped file that was created with an older
> version of winzip (say version 10, 2006), and perhaps with some
> unix versions of zip as well (haven't tested). The error message is:
> 
> Windows cannot open the folder
> Access to the Compressed (zipped) Folder '\\machine\whatever\foo.zip' is 
> denied.
> 
> Now, if you try to look at the file permissions for this file it says 
> you don't
> have permission to look at the permissions!
> 
> If you rename the file to foo.dat (on the source machine) then the 
> permission
> problems disappear on the target system, so the problem definitely is
> related to the '.zip' suffix. (In my testing the source system is running
> Windows XP professional, but the problem is not related to the network
> configuration: even local zip files created with older versions of Winzip
> will have permission problems.)
> 
> After several hours of trial and error work it became clear that the correct
> message should have been:
> 
> Windows detected a zip file in a format that it doesn't accept. Probably it
> was created by an older (more than a few months) version of Winzip.
> 
> Upgrading to Winzip 11.1 and using it to compress the file on the source
> system fixed the problem on the target system.


Winzip is not related to R development nor package installation and was 
never recommended, AFAIK.


> 3. If you use the increasingly popular (and free) program Zip Genius instead
> of Winzip beware that the latest released version will cause the file 
> Explorer
> to crash under Windows Vista. There is a fix: upgrade to the latest patched
> release of Zip Genius: 6.0.3.1140 (download the standard version, then run
> the update program).

I never heared about "Zip Genius" before, it is not related to R 
development nor package installation and was never recommended, AFAIK.



> 4. In a number of situations Windows Vista issues an error message like
> "This task requires permissions" and whatever you were trying to do fails.
> Unfortunately, this happens even when the user has Administrator privs,
> and Vista gives no indication what permissions are needed and where to
> change them. (Though I suspect that you may have to upgrade to
> "Vista Ultimate Edition" to do so.)

No, you can do it with your version as well, just start with the right 
privileges.


There is not a single R-Vista issue here (and no R issue at all). All 
are problems of the user who has not read Windows Vista documentation.

Uwe Ligges


> I don't have a solution for this problem. Perhaps another Vista user can
> provide one. Of course, one possible solution is to downgrade to Windows
> XP and wait for the kinks to be worked out in Vista...
> 
> Thanks,
> Dominick
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From mtmorgan at fhcrc.org  Wed Sep  5 18:43:37 2007
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Wed, 05 Sep 2007 09:43:37 -0700
Subject: [Rd] RUnit testing with R CMD check and more
In-Reply-To: <F189E18BBAA8B6479F618B9044CF4E9C01885177CE@owa.bfro.uni-lj.si>
	(Gorjanc Gregor's message of "Wed, 5 Sep 2007 18:32:51 +0200")
References: <F189E18BBAA8B6479F618B9044CF4E9C01885177CE@owa.bfro.uni-lj.si>
Message-ID: <6phodghgj0m.fsf@gopher4.fhcrc.org>

Gorjanc,

One important scenario I use during development is to run selected
unit tests, typically found in a single file. Usually this is
preceeded by INSTALL rather than check, as I optimistically think that
my changes will be an improvement and hence installing the package is
a starting point for the next iteration.

(another) Martin

Gorjanc Gregor <Gregor.Gorjanc at bfro.uni-lj.si> writes:

> Hello!
>
> I have looked at Martin's recent work on "merging" unit tests with R
> CMD check, fused it with my and Tony's contributions and developed
> it a bit further. Take a look into the attached demo package on how
> it works.
>
> In essence:
>
> PKG/inst/RUnitTests
>           |- runRUnitTests.R (script to run RUnit tests)
>           \- ...             (any RUnit test file)
>
> PKG/R/runRUnitTests.R        (wrapper function to call PKG/inst/RUnitTests/runRUnitTests.R)
> PKG/man/runRUnitTests.Rd     (help with examples! section)
>
> The following can be achieved:
>
> * useRs can run RUnit tests from within R after the package has been
> installed on their machine - this info is also given in
> PKG-package.Rd file to encourage useRs to test the package
>
> * developeRs can run RUnit tests with:
>
>   - R CMD check since examples in PKG/man/runRUnitTests.Rd are
>   tested to work (test failures or R errors stop the R CMD check!)
>
>   - launcing the script PKG/inst/RUnitTests/runRUnitTests.R with
>   Rscript or R CMD check
>
> I would like to hear any critiques, comments, suggestions, ... on
> above. Martin mentioned (privately) that filenames have to much
> upper case letter, but I wanted to emphasize that the main work is
> being done by RUnit package - not developed by me!
>
> Finnally, I would like to argue that from useRs point of view test
> and unit test are the same thing and I believe that R would benefit
> if *all* tests could be available in similar manner as above. This
> of course calls for the modification of packaging, testing, etc.,
> but could provide more feedback (sure some of it will be bogous) on
> testing on various configurations.
>
> With regards, Gregor
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin Morgan
Bioconductor / Computational Biology
http://bioconductor.org


From Gregor.Gorjanc at bfro.uni-lj.si  Wed Sep  5 18:53:09 2007
From: Gregor.Gorjanc at bfro.uni-lj.si (Gorjanc Gregor)
Date: Wed, 5 Sep 2007 18:53:09 +0200
Subject: [Rd] RUnit testing with R CMD check and more
In-Reply-To: <6phodghgj0m.fsf@gopher4.fhcrc.org>
References: <F189E18BBAA8B6479F618B9044CF4E9C01885177CE@owa.bfro.uni-lj.si>,
	<6phodghgj0m.fsf@gopher4.fhcrc.org>
Message-ID: <F189E18BBAA8B6479F618B9044CF4E9C01885177CF@owa.bfro.uni-lj.si>

Hi!

> (another) Martin wrote:
> One important scenario I use during development is to run selected
> unit tests, typically found in a single file. Usually this is
> preceeded by INSTALL rather than check, as I optimistically think that
> my changes will be an improvement and hence installing the package is
> a starting point for the next iteration.

Yes, I also do that very often, especially if I work only on one function
and I only want to test if it works. With this in mind there is a Makefile
in PKG/inst/RUnitTests (this is based largely on work probably also by
you and other "BioC folk"), which provides handy

make # run unit tests
make all # install and run unit tests

Though, this runs all unit tests.

Gregor


From ripley at stats.ox.ac.uk  Wed Sep  5 19:01:43 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 5 Sep 2007 18:01:43 +0100 (BST)
Subject: [Rd] (PR#9896) read.spss converts string variables with
In-Reply-To: <20070905092557.3022366931@slim.kubism.ku.dk>
References: <20070905092557.3022366931@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0709051757130.10643@gannet.stats.ox.ac.uk>

Thank you.

If anyone wants to work on a patch I've put the unencoded files from my 
direct copy at

http://www.stats.ox.ac.uk/pub/bdr/problem_file.sav
http://www.stats.ox.ac.uk/pub/bdr/problem_file_read.RData

I am afraid I won't have a chance to take a look for at least a couple of 
weeks.


On Wed, 5 Sep 2007, honza at ifolk.cz wrote:

> ------=_20070905112441_38848
> Content-Type: text/plain; charset="iso-8859-2"
> Content-Transfer-Encoding: 8bit
>
> I am sending two files attached. The file problem_file.sav was saved in
> SPSS 10.0. It contains variables of various types, with and without
> labeling etc., so that you can make experiments.
>
> The file problem_file_read.RData was saved in R 2.5.1 (foreign library
> version 0.8-20). It contains two data frames Schools and Schools2. The
> former is result of
> read.spss("problem_file.sav",to.data.frame=TRUE,use.value.labels=TRUE),
> the latter differs in use.value.lables=FALSE only. As you can see, in the
> first case read.spss has not read values of string labeled variables at
> all.
>
> I use WinXP.
>
> Thank you for your work!
>
> Jan Hucin
>
> -------------------------------------------------------------------
> Reference: <20070903104656.1D1566691D at slim.kubism.ku.dk>
>
> There is nothing we can do to reproduce this without an example 'some.sav'
> file exhibiting the problem.  Can you please supply one?
>
> On Mon, 3 Sep 2007, honza at ifolk.cz wrote:
>
>> Full_Name: Jan Hucin
>> Version: 2.5.1 (foreign 0.8-20)
>> OS: WinXP
>> Submission from: (NULL) (195.113.83.7)
>>
>>
>> When reading an SPSS file:
>>
>> - containing some variable of type String
>> - with value labels at that variable
>> - and with determination which values of that variable are considered to be
>> missing,
>>
>> I have always get <NA> where digits were in the original SPSS file.
>>
>> Example:
>> Let's have in an SPSS file "some.sav" the variable A. The type of the
> variable
>> is String of length 1.
>> Let's have a value labeling: 1 = Yes, 2 = No, 8 = Invalid, 9 = Missing.
>> Let's determine that value 9 is considered to be missing.
>> When this file is read by
> abc=read.spss("some.sav",use.value.labels=TRUE), we
>> get <NA> in abc$A on places where "1", "2" etc. were. Surprisingly, we
> get "N/A"
>> (not <NA>!) on the place where the string "N/A" is.
>>
>> If we specify use.value.labels=FALSE, then we get string values (such as
> "1",
>> "2") but we lose value labels (Yes, No etc.).
>>
>> Let me add that if the variable in the original SPSS file was of type
> Numeric
>> (not String), there would be no problem.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From tobias.verbeke at telenet.be  Wed Sep  5 22:07:58 2007
From: tobias.verbeke at telenet.be (Tobias Verbeke)
Date: Wed, 05 Sep 2007 22:07:58 +0200
Subject: [Rd] trivial typo Foreign.Rd (base)
Message-ID: <46DF0C9E.4050805@telenet.be>

Dear list,

Please find below a patch for a trivial
typo in Foreign.Rd (base package)

Kind regards,
Tobias

Index: Foreign.Rd

===================================================================

--- Foreign.Rd	(revision 42784)

+++ Foreign.Rd	(working copy)

@@ -68,7 +68,7 @@

    compiled code that uses \R objects in the same way as internal
    \R functions.

-  \code{.Call} and \code{.Call.graphics} can be used call compiled code
+  \code{.Call} and \code{.Call.graphics} can be used to call compiled code
    which makes use of internal \R objects.  The arguments are passed to
    the C code as a sequence of \R objects.  It is included to provide
    compatibility with S version 4.

-- 

Tobias Verbeke - Consultant
Business & Decision Benelux
Rue de la r?volution 8
1000 Brussels - BELGIUM

+32 499 36 33 15
tobias.verbeke at businessdecision.com


From murdoch at stats.uwo.ca  Thu Sep  6 01:45:00 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 05 Sep 2007 19:45:00 -0400
Subject: [Rd] trivial typo Foreign.Rd (base)
In-Reply-To: <46DF0C9E.4050805@telenet.be>
References: <46DF0C9E.4050805@telenet.be>
Message-ID: <46DF3F7C.1010209@stats.uwo.ca>

On 05/09/2007 4:07 PM, Tobias Verbeke wrote:
> Dear list,
> 
> Please find below a patch for a trivial
> typo in Foreign.Rd (base package)
> 
> Kind regards,
> Tobias
> 
> Index: Foreign.Rd
> 
> ===================================================================
> 
> --- Foreign.Rd	(revision 42784)
> 
> +++ Foreign.Rd	(working copy)
> 
> @@ -68,7 +68,7 @@
> 
>     compiled code that uses \R objects in the same way as internal
>     \R functions.
> 
> -  \code{.Call} and \code{.Call.graphics} can be used call compiled code
> +  \code{.Call} and \code{.Call.graphics} can be used to call compiled code
>     which makes use of internal \R objects.  The arguments are passed to
>     the C code as a sequence of \R objects.  It is included to provide
>     compatibility with S version 4.

Fixed, thanks.

Duncan Murdoch


From djsamperi at earthlink.net  Thu Sep  6 02:14:10 2007
From: djsamperi at earthlink.net (Dominick Samperi)
Date: Wed, 05 Sep 2007 20:14:10 -0400
Subject: [Rd] Windows Vista Issues
In-Reply-To: <46DEDC07.1060502@statistik.uni-dortmund.de>
References: <46DC7FD7.7070304@earthlink.net>
	<46DEDC07.1060502@statistik.uni-dortmund.de>
Message-ID: <46DF4652.2030006@earthlink.net>

Uwe Ligges wrote:
> There is not a single R-Vista issue here (and no R issue at all). All 
> are problems of the user who has not read Windows Vista documentation.
> Uwe Ligges
Oh, and this probably explains why my previous two postings mysteriously 
disappeared.

I took the time to post this message for the benefit of readers of this 
group.

Can you please tell me how I can remove R software packages that I 
previously
contributed from your archives?

Thanks,
Dominick


From DNADave at insightful.com  Thu Sep  6 07:51:22 2007
From: DNADave at insightful.com (David Henderson)
Date: Wed, 05 Sep 2007 22:51:22 -0700
Subject: [Rd] Windows Vista Issues
In-Reply-To: <46DF4652.2030006@earthlink.net>
References: <46DC7FD7.7070304@earthlink.net>
	<46DEDC07.1060502@statistik.uni-dortmund.de>
	<46DF4652.2030006@earthlink.net>
Message-ID: <1189057883.4005.8.camel@minime.insightful.com>

Hello Dominick:

> Oh, and this probably explains why my previous two postings mysteriously 
> disappeared.
> 
> I took the time to post this message for the benefit of readers of this 
> group.

I was able to view your initial comments at:
http://tolstoy.newcastle.edu.au/R/e2/devel/07/09/4307.html

If you sent other comments, perhaps the list moderator (I can't remember
if there is one, or not) felt they were inappropriate for the list.

> Can you please tell me how I can remove R software packages that I 
> previously contributed from your archives?

This is a little silly.  Remember that we are an international community
and you are _reading_ the response in _English_ from someone who
primarily speaks _German_ (although I know his English is excellent).
Sometimes things do not come across well in e-mail and your response
indicates that this was one of those times.

I appreciated the time you took to describe how you got R working on
your Vista system, even if it will not be an issue for other users.

Thanks!!

Dave H
-- 
David A. Henderson, Ph.D. 
Research Scientist 
Insightful Corporation 
1700 Westlake Avenue North, Suite 500 
Seattle, WA 98109-3044 
Tel: 206-802-2307 
Fax: 206-283-8691 
DNADave at Insightful.Com 
http://www.insightful.com


From ligges at statistik.uni-dortmund.de  Thu Sep  6 09:25:30 2007
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Thu, 06 Sep 2007 09:25:30 +0200
Subject: [Rd] Windows Vista Issues
In-Reply-To: <46DF4652.2030006@earthlink.net>
References: <46DC7FD7.7070304@earthlink.net>
	<46DEDC07.1060502@statistik.uni-dortmund.de>
	<46DF4652.2030006@earthlink.net>
Message-ID: <46DFAB6A.40406@statistik.uni-dortmund.de>

Dominick Samperi wrote:
> Uwe Ligges wrote:
>> There is not a single R-Vista issue here (and no R issue at all). All 
>> are problems of the user who has not read Windows Vista documentation.
>> Uwe Ligges

> Oh, and this probably explains why my previous two postings mysteriously 
> disappeared.

I do not know if Windows Vista eats e-mails. At least I do not...


> I took the time to post this message for the benefit of readers of this 
> group.

Thank you for *all* your contributions! Unfortunately this message was 
wrong, because everything works fine with recent versions of R, as far 
as we know. And all reports on Vista issues I received before were 
reproducible - bust just when omitting important settings under Windows 
Vista, such as starting with wrong privileges. Thanks to Brian Ripley 
and Duncan Murdoch all known facts are documented in the R for Windows 
FAQs and the "R Installation and Administration manual". Please note 
that we (this means particularly Brian Ripley and Duncan Murdoch) have 
tested, checked and fixed things in order to make R work smoothly under 
Windows Vista. Hence it is inappropriate to say that R does not work as 
intended on that platform without giving an example.


> Can you please tell me how I can remove R software packages that I 
> previously contributed from your archives?

Sure, please send an e-mail to CRAN at R-Project.org and Kurt will remove 
them. Or if you just want to remove Windows versions, I will do so. In 
that case, I can clean up even more things for which I spend several 
hours to set them up for you and the users of your packages.

But before asking to remove your packages please note that all I wrote 
are personal opinions, not CRAN opinions (hey, I need to write a 
disclaimer below my messages, obviously ;-)) and I did not want to 
insult anybody. If I did so, my apologies.

Uwe Ligges




> 
> Thanks,
> Dominick
>


From tobias.verbeke at telenet.be  Thu Sep  6 20:40:41 2007
From: tobias.verbeke at telenet.be (Tobias Verbeke)
Date: Thu, 06 Sep 2007 20:40:41 +0200
Subject: [Rd] trivial typo R-exts.texi
Message-ID: <46E049A9.7050100@telenet.be>

Dear list,

Please find below a trivial patch to
R-exts.texi

Kind regards,
Tobias


Index: R-exts.texi

===================================================================

--- R-exts.texi	(revision 42789)

+++ R-exts.texi	(working copy)

@@ -8874,7 +8874,7 @@

  reasons it calls @code{predict.lm} directly, but in principle (and in S
  originally and currently) it could use @code{NextMethod}.
  (@code{NextMethod} seems under-used in the @R{} sources.  Do be aware
-that there as S/R differences in this area, and the example above works
+that there are S/R differences in this area, and the example above works
  because there is a @emph{next} method, the default method, not that a
  new method is selected when the class is changed.)


-- 

Tobias Verbeke - Consultant
Business & Decision Benelux
Rue de la r?volution 8
1000 Brussels - BELGIUM

+32 499 36 33 15
tobias.verbeke at businessdecision.com


From murdoch at stats.uwo.ca  Thu Sep  6 21:09:18 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 06 Sep 2007 15:09:18 -0400
Subject: [Rd] trivial typo R-exts.texi
In-Reply-To: <46E049A9.7050100@telenet.be>
References: <46E049A9.7050100@telenet.be>
Message-ID: <46E0505E.3070405@stats.uwo.ca>

On 9/6/2007 2:40 PM, Tobias Verbeke wrote:
> Dear list,
> 
> Please find below a trivial patch to
> R-exts.texi
> 
> Kind regards,
> Tobias
> 
> 
> Index: R-exts.texi
> 
> ===================================================================
> 
> --- R-exts.texi	(revision 42789)
> 
> +++ R-exts.texi	(working copy)
> 
> @@ -8874,7 +8874,7 @@
> 
>   reasons it calls @code{predict.lm} directly, but in principle (and in S
>   originally and currently) it could use @code{NextMethod}.
>   (@code{NextMethod} seems under-used in the @R{} sources.  Do be aware
> -that there as S/R differences in this area, and the example above works
> +that there are S/R differences in this area, and the example above works
>   because there is a @emph{next} method, the default method, not that a
>   new method is selected when the class is changed.)


Fixed, thanks.

Duncan Murdoch


From mark_difford at yahoo.co.uk  Thu Sep  6 19:37:19 2007
From: mark_difford at yahoo.co.uk (Mark Difford)
Date: Thu, 6 Sep 2007 10:37:19 -0700 (PDT)
Subject: [Rd] Windows Vista Issues
In-Reply-To: <46DF4652.2030006@earthlink.net>
References: <46DC7FD7.7070304@earthlink.net>
	<46DEDC07.1060502@statistik.uni-dortmund.de>
	<46DF4652.2030006@earthlink.net>
Message-ID: <12527646.post@talk.nabble.com>


Hi Dominick,

No offence intended, but I have been running R (presently 2.5.1.patched) on
a Vista (Home Basic) machine without a hitch since March 2007.  Initially I
had to turn off "User Account Control" to install new packages, but that was
a known issue.  I still run it that way, though it's not necessary anymore
(to have a truly smooth R).  You really don't need it switched on if you
have decent anti-virus stuff &c.

Regards,
Mark Difford.


Dominick Samperi-2 wrote:
> 
> Uwe Ligges wrote:
>> There is not a single R-Vista issue here (and no R issue at all). All 
>> are problems of the user who has not read Windows Vista documentation.
>> Uwe Ligges
> Oh, and this probably explains why my previous two postings mysteriously 
> disappeared.
> 
> I took the time to post this message for the benefit of readers of this 
> group.
> 
> Can you please tell me how I can remove R software packages that I 
> previously
> contributed from your archives?
> 
> Thanks,
> Dominick
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
View this message in context: http://www.nabble.com/Windows-Vista-Issues-tf4377458.html#a12527646
Sent from the R devel mailing list archive at Nabble.com.


From lbraglia at gmail.com  Fri Sep  7 09:31:36 2007
From: lbraglia at gmail.com (lbraglia at gmail.com)
Date: Fri,  7 Sep 2007 09:31:36 +0200 (CEST)
Subject: [Rd] orthographic mistake in ?citation (PR#9901)
Message-ID: <20070907073136.081FF6693C@slim.kubism.ku.dk>


from ?citation


Details:

     The R core development team and the very active community of
     package authors have invested a lot of time and effort in creating
     R as it is today. Please give credit where credit is due and cite
     R and R packages when you use them for data anlysis.
                                                 ^^^^^^^


--> change "anlysis" to "analysis".


Bye  
   
                                             

<<insert bug report here>>



--please do not edit the information below--

Version:
 platform = i486-pc-linux-gnu
 arch = i486
 os = linux-gnu
 system = i486, linux-gnu
 status = 
 major = 2
 minor = 5.1
 year = 2007
 month = 06
 day = 27
 svn rev = 42083
 language = R
 version.string = R version 2.5.1 (2007-06-27)

Locale:
LC_CTYPE=it_IT.UTF-8;LC_NUMERIC=C;LC_TIME=it_IT.UTF-8;LC_COLLATE=it_IT.UTF-8;LC_MONETARY=it_IT.UTF-8;LC_MESSAGES=it_IT.UTF-8;LC_PAPER=it_IT.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=it_IT.UTF-8;LC_IDENTIFICATION=C 

Search Path:
 .GlobalEnv, package:datasets, package:rcompgen, package:grDevices,
package:graphics, package:utils, package:stats, package:methods, Autoloads,
package:base


From murdoch at stats.uwo.ca  Fri Sep  7 12:37:35 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 07 Sep 2007 06:37:35 -0400
Subject: [Rd] orthographic mistake in ?citation (PR#9901)
In-Reply-To: <20070907073136.081FF6693C@slim.kubism.ku.dk>
References: <20070907073136.081FF6693C@slim.kubism.ku.dk>
Message-ID: <46E129EF.9070204@stats.uwo.ca>

On 07/09/2007 3:31 AM, lbraglia at gmail.com wrote:
> from ?citation
> 
> 
> Details:
> 
>      The R core development team and the very active community of
>      package authors have invested a lot of time and effort in creating
>      R as it is today. Please give credit where credit is due and cite
>      R and R packages when you use them for data anlysis.

Fixed, thanks.  BTW, no need to report spelling errors to the bug list: 
  reporting them on R-devel is simpler.

Duncan Murdoch
>                                                  ^^^^^^^
> 
> 
> --> change "anlysis" to "analysis".
> 
> 
> Bye  
>    
>                                              
> 
> <<insert bug report here>>
> 
> 
> 
> --please do not edit the information below--
> 
> Version:
>  platform = i486-pc-linux-gnu
>  arch = i486
>  os = linux-gnu
>  system = i486, linux-gnu
>  status = 
>  major = 2
>  minor = 5.1
>  year = 2007
>  month = 06
>  day = 27
>  svn rev = 42083
>  language = R
>  version.string = R version 2.5.1 (2007-06-27)
> 
> Locale:
> LC_CTYPE=it_IT.UTF-8;LC_NUMERIC=C;LC_TIME=it_IT.UTF-8;LC_COLLATE=it_IT.UTF-8;LC_MONETARY=it_IT.UTF-8;LC_MESSAGES=it_IT.UTF-8;LC_PAPER=it_IT.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=it_IT.UTF-8;LC_IDENTIFICATION=C 
> 
> Search Path:
>  .GlobalEnv, package:datasets, package:rcompgen, package:grDevices,
> package:graphics, package:utils, package:stats, package:methods, Autoloads,
> package:base
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jbrzusto at fastmail.fm  Fri Sep  7 15:47:26 2007
From: jbrzusto at fastmail.fm (jbrzusto at fastmail.fm)
Date: Fri,  7 Sep 2007 15:47:26 +0200 (CEST)
Subject: [Rd] "bug" and patch: quadratic running time for strsplit(...,
	fixed=TRUE) (PR#9902)
Message-ID: <20070907134726.0CBCB66948@slim.kubism.ku.dk>

Full_Name: John Brzustowski
Version: R-devel-trunk, R-2.4.0
OS: linux, gcc 4.0.3
Submission from: (NULL) (206.248.157.184)


This isn't a bug, but an easily-remedied performance issue.

SYMPTOM

> for (i in 1000 * (1:20)) {
   y <- paste(rep("asdf", times=i), collapse=" ")
   t <- system.time(strsplit(y, " ", fixed=TRUE))
   cat(sprintf("i=%5d time=%5d msec\n",i, round(1000*t[1])))
}

i= 1000 time=    2 msec
i= 2000 time=    9 msec
i= 3000 time=   20 msec
i= 4000 time=   34 msec
i= 5000 time=   57 msec
i= 6000 time=   77 msec
i= 7000 time=  107 msec
i= 8000 time=  136 msec
i= 9000 time=  177 msec
i=10000 time=  230 msec
i=11000 time=  275 msec
i=12000 time=  308 msec
i=13000 time=  371 msec
i=14000 time=  446 msec
i=15000 time=  544 msec
i=16000 time=  639 msec
i=17000 time=  726 msec
i=18000 time=  864 msec
i=19000 time=  944 msec
i=20000 time= 1106 msec

DIAGNOSIS

strsplit() uses strlen() in the bounds check clause of a for(;;)
statement, which forces a full scan of the source string for each
character in the source string.  Unlike R's LENGTH() macro, strlen for
C strings is an expensive operation, and in this case (at least),
gcc 4.0.3's -O2 level optimizer is not able to recognize the call as a loop
invariant, despite the declaration "const char *buf".

REMEDIED BEHAVIOUR

i= 1000 time=    0 msec
i= 2000 time=    1 msec
i= 3000 time=    1 msec
i= 4000 time=    0 msec
i= 5000 time=    1 msec
i= 6000 time=    1 msec
i= 7000 time=    1 msec
i= 8000 time=    2 msec
i= 9000 time=    2 msec
i=10000 time=    2 msec
i=11000 time=    2 msec
i=12000 time=    2 msec
i=13000 time=    2 msec
i=14000 time=    2 msec
i=15000 time=    4 msec
i=16000 time=    3 msec
i=17000 time=    3 msec
i=18000 time=    4 msec
i=19000 time=    3 msec
i=20000 time=    4 msec

RELATED ISSUES

A simple search turns up other instances of this usage in R's source.
For completeness, I'm submitting patches for all of them, but have not
tested whether they in fact cause a detectable performance problem.
In the case of modules/X11/dataentry.c, the patch also fixes a presumably
ineffectual "bug".

$ grep -nR "for *([^;]*;[^;]*strlen *(" *

main/rlocale.c:137:		for (i = 0; i < strlen(lc_str) && i < sizeof(lc_str); i++)
main/printutils.c:486:		for(j = 0; j < strlen(buf); j++) *q++ = buf[j];
main/sysutils.c:493:		for(j = 0; j < strlen(sub); j++) *outbuf++ = sub[j];
modules/X11/rotated.c:608:	for(i=0; i<strlen(text)-1; i++)
modules/X11/rotated.c:856:	for(i=0; i<strlen(text)-1; i++)
modules/X11/rotated.c:1399:	for(i=0; i<strlen(text)-1; i++)
modules/X11/rotated.c:1797:	for(i=0; i<strlen(text)-1; i++)
modules/X11/rotated.c:2045:	for(i=0; i<strlen(text)-1; i++)
modules/X11/rotated.c:2339:	for(i=0; i<strlen(text)-1; i++)
modules/X11/dataentry.c:1358:   for(i = 0; i < strlen(text); i++) *bufp++ =
text[i];


PATCHES (against trunk)
Only the first is required to fix strsplit().

Index: src/main/character.c
===================================================================
--- src/main/character.c	(revision 42792)
+++ src/main/character.c	(working copy)
@@ -357,7 +357,7 @@
     int i, j, len, tlen, ntok, slen;
     int extended_opt, cflags, fixed_opt, perl_opt;
     char *pt = NULL;
-    const char *buf, *split = "", *bufp, *laststart;
+    const char *buf, *split = "", *bufp, *laststart, *ebuf = NULL;
     regex_t reg;
     regmatch_t regmatch[1];
     pcre *re_pcre = NULL;
@@ -419,7 +419,8 @@
 	    if(fixed_opt) {
 		/* This is UTF-8 safe since it compares whole strings */
 		laststart = buf;
-		for(bufp = buf; bufp - buf < strlen(buf); bufp++) {
+		ebuf = buf + strlen(buf);
+		for(bufp = buf; bufp < ebuf; bufp++) {
 		    if((slen == 1 && *bufp != *split) ||
 		       (slen > 1 && strncmp(bufp, split, slen))) continue;
 		    ntok++;
@@ -480,7 +481,7 @@
 		    /* This is UTF-8 safe since it compares whole strings,
 		       but it would be more efficient to skip along by chars.
 		     */
-		    for(; bufp - buf < strlen(buf); bufp++) {
+		    for(; bufp < ebuf; bufp++) {
 			if((slen == 1 && *bufp != *split) ||
 			   (slen > 1 && strncmp(bufp, split, slen))) continue;
 			if(slen) {
Index: src/main/rlocale.c
===================================================================
--- src/main/rlocale.c	(revision 42792)
+++ src/main/rlocale.c	(working copy)
@@ -127,14 +127,14 @@
 int Ri18n_wcwidth(wchar_t c)
 {
     char lc_str[128];
-    unsigned int i;
+    unsigned int i, j;
 
     static char *lc_cache = "";
     static int lc = 0;
 
     if (0 != strcmp(setlocale(LC_CTYPE, NULL), lc_cache)) {
 	strncpy(lc_str, setlocale(LC_CTYPE, NULL), sizeof(lc_str));
-	for (i = 0; i < strlen(lc_str) && i < sizeof(lc_str); i++)
+	for (i = 0, j = strlen(lc_str); i < j && i < sizeof(lc_str); i++)
 	    lc_str[i] = toupper(lc_str[i]);
 	for (i = 0; i < (sizeof(cjk_locale_name)/sizeof(cjk_locale_name_t)); 
 	     i++) {
Index: src/main/printutils.c
===================================================================
--- src/main/printutils.c	(revision 42792)
+++ src/main/printutils.c	(working copy)
@@ -483,7 +483,8 @@
 			else
 #endif
 			    snprintf(buf, 11, "\\u%04x", k);
-			for(j = 0; j < strlen(buf); j++) *q++ = buf[j];
+			memcpy(q, buf, j = strlen(buf));
+			q += j;
 			p += res;
 		    }
 		    i += (res - 1);
Index: src/main/sysutils.c
===================================================================
--- src/main/sysutils.c	(revision 42792)
+++ src/main/sysutils.c	(working copy)
@@ -490,8 +490,9 @@
 			R_AllocStringBuffer(2*cbuff.bufsize, &cbuff);
 			goto top_of_loop;
 		    }
-		    for(j = 0; j < strlen(sub); j++) *outbuf++ = sub[j];
-		    outb -= strlen(sub);
+		    memcpy(outbuf, sub, j = strlen(sub)); 
+		    outbuf += j;
+		    outb -= j;
 		}
 		inbuf++; inb--;
 		goto next_char;
Index: src/modules/X11/rotated.c
===================================================================
--- src/modules/X11/rotated.c	(revision 42792)
+++ src/modules/X11/rotated.c	(working copy)
@@ -605,7 +605,7 @@
 
     /* count number of sections in string */
     if(align!=NONE)
-	for(i=0; i<strlen(text)-1; i++)
+	for(i=strlen(text)-2; i >= 0; i--)
 	    if(text[i]=='\n')
 		nl++;
 
@@ -853,7 +853,7 @@
     /* count number of sections in string */
     item->nl=1;
     if(align!=NONE)
-	for(i=0; i<strlen(text)-1; i++)
+	for(i=strlen(text)-2; i >= 0; i--)
 	    if(text[i]=='\n')
 		item->nl++;
 
@@ -1396,7 +1396,7 @@
     /* count number of sections in string */
     nl=1;
     if(align!=NONE)
-	for(i=0; i<strlen(text)-1; i++)
+	for(i=strlen(text)-2; i >= 0; i--)
 	    if(text[i]=='\n')
 		nl++;
 
@@ -1794,7 +1794,7 @@
 
     /* count number of sections in string */
     if(align!=NONE)
-	for(i=0; i<strlen(text)-1; i++)
+	for(i=strlen(text)-2; i >= 0; i--)
 	    if(text[i]=='\n')
 		nl++;
 
@@ -2042,7 +2042,7 @@
     /* count number of sections in string */
     item->nl=1;
     if(align!=NONE)
-	for(i=0; i<strlen(text)-1; i++)
+	for(i=strlen(text)-2; i >= 0; i--)
 	    if(text[i]=='\n')
 		item->nl++;
 
@@ -2336,7 +2336,7 @@
     /* count number of sections in string */
     nl=1;
     if(align!=NONE)
-	for(i=0; i<strlen(text)-1; i++)
+	for(i=strlen(text)-2; i >= 0; i--)
 	    if(text[i]=='\n')
 		nl++;
 
Index: src/modules/X11/dataentry.c
===================================================================
--- src/modules/X11/dataentry.c	(revision 42792)
+++ src/modules/X11/dataentry.c	(working copy)
@@ -1232,7 +1232,7 @@
    do as we get a char at a time */
 static void handlechar(DEstruct DE, char *text)
 {
-    int i, c = text[0];
+    int i, c = text[0], j;
 #ifdef USE_FONTSET
     wchar_t wcs[BOOSTED_BUF_SIZE];
 
@@ -1355,9 +1355,13 @@
 	goto donehc;
     }
 
-    for(i = 0; i < strlen(text); i++) *bufp++ = text[i];
-    *(bufp+1) = '\0';
-    clength += strlen(text);
+    /* as originally written, this left an undefined byte at
+       the end of bufp, followed by a zero byte; luckily, the storage
+       pointed to by bufp had already been zeroed, so the undefined
+       byte was in fact zero.  */
+    strcpy(bufp, text);
+    bufp += (j = strlen(text));
+    clength += j;
     printstring(DE, buf, clength, DE->crow, DE->ccol, 1);
     return;


From ggrothendieck at gmail.com  Fri Sep  7 22:03:52 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 7 Sep 2007 16:03:52 -0400
Subject: [Rd] Rcmd install on Vista
Message-ID: <971536df0709071303x5e9c53eex18f8d4608e5e501a@mail.gmail.com>

Has anyone successfully used Rcmd install or Rcmd check on
Windows Vista?  I have been successfully been running R itself,
just not Rcmd install and Rcmd check.

Rcmd check fails, the Ryacas.Rcheck it creates is
read-only, I don't have permission to delete it and I have
to reset the permissions on it just to delete it.

With Rcmd install I am getting the following which looks like I
am running into permissions problems and, of course, these also
show up in Rcmd check.

I had installed R into C:\Program Files\R\R-2.6.0 and my library
location is in C:/Users/... as seen below.

I found I had to set tmpdir and R_LIBS appropriately to run Rcmd
check and install to even get this far.

----------- Making package Ryacas ------------
   adding build stamp to DESCRIPTION
   installing R files
   installing demos
   installing inst files
find: C:/Users/ggroth/Documents/R/win-library/2.6/Ryacas/doc: Permission denied
find: C:/Users/ggroth/Documents/R/win-library/2.6/Ryacas/yacdir:
Permission denied
...
make[2]: *** [C:/Users/ggroth/Documents/R/win-library/2.6/Ryacas/inst] Error 1
make[1]: *** [all] Error 2
make: *** [pkg-Ryacas] Error 2
*** installation of Ryacas failed ***

Removing 'C:/Users/ggroth/Documents/R/win-library/2.6/Ryacas'
Can't read C:/Users/ggroth/Documents/R/win-library/2.6/Ryacas/doc:
Invalid argument at C:\PROGRA~1\R\R-26~1.0/bin/install line 434
Can't remove directory
C:/Users/ggroth/Documents/R/win-library/2.6/Ryacas/doc: Directory not
empty at C:\PROGRA~1\R\R-26~1.0/bin/install line 434
... and additionl similar lines ...


From ggrothendieck at gmail.com  Sat Sep  8 09:12:20 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 8 Sep 2007 03:12:20 -0400
Subject: [Rd] Rcmd install on Vista
In-Reply-To: <971536df0709071303x5e9c53eex18f8d4608e5e501a@mail.gmail.com>
References: <971536df0709071303x5e9c53eex18f8d4608e5e501a@mail.gmail.com>
Message-ID: <971536df0709080012x2dd579d6i2087ab3c1a870180@mail.gmail.com>

I finally got R CMD install and R CMD check working on Vista:

1. put both R and the package source in the %userprofile% tree, i.e.
in C:\Users\yourName or below.  During installation setup of R the
Select Destination Location screen lets you specify this.

2. The environment variable tmpdir should be set as follows:
set tempdir=%temp%
in the Windows console prior to the R session.  If you forget this
there will be a latex error.

3. hhc.exe must be there on XP but it must NOT be there on Vista.
If it is you get very annoying popups although it finally does run.
  where hhc.exe
from the Windows console will search for it.  It should NOT be
present.  However, MiKTeX and Rtools should be installed.


On 9/7/07, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> Has anyone successfully used Rcmd install or Rcmd check on
> Windows Vista?  I have been successfully been running R itself,
> just not Rcmd install and Rcmd check.
>
> Rcmd check fails, the Ryacas.Rcheck it creates is
> read-only, I don't have permission to delete it and I have
> to reset the permissions on it just to delete it.
>
> With Rcmd install I am getting the following which looks like I
> am running into permissions problems and, of course, these also
> show up in Rcmd check.
>
> I had installed R into C:\Program Files\R\R-2.6.0 and my library
> location is in C:/Users/... as seen below.
>
> I found I had to set tmpdir and R_LIBS appropriately to run Rcmd
> check and install to even get this far.
>
> ----------- Making package Ryacas ------------
>   adding build stamp to DESCRIPTION
>   installing R files
>   installing demos
>   installing inst files
> find: C:/Users/ggroth/Documents/R/win-library/2.6/Ryacas/doc: Permission denied
> find: C:/Users/ggroth/Documents/R/win-library/2.6/Ryacas/yacdir:
> Permission denied
> ...
> make[2]: *** [C:/Users/ggroth/Documents/R/win-library/2.6/Ryacas/inst] Error 1
> make[1]: *** [all] Error 2
> make: *** [pkg-Ryacas] Error 2
> *** installation of Ryacas failed ***
>
> Removing 'C:/Users/ggroth/Documents/R/win-library/2.6/Ryacas'
> Can't read C:/Users/ggroth/Documents/R/win-library/2.6/Ryacas/doc:
> Invalid argument at C:\PROGRA~1\R\R-26~1.0/bin/install line 434
> Can't remove directory
> C:/Users/ggroth/Documents/R/win-library/2.6/Ryacas/doc: Directory not
> empty at C:\PROGRA~1\R\R-26~1.0/bin/install line 434
> ... and additionl similar lines ...
>


From idm24 at medschl.cam.ac.uk  Fri Sep  7 20:31:23 2007
From: idm24 at medschl.cam.ac.uk (Iain Morrison)
Date: Fri, 7 Sep 2007 19:31:23 +0100
Subject: [Rd] Modules which require gcc4 to build
Message-ID: <6E9326598B435940A0090E6B20E051BF019A91A8@me-mail1.medlan.cam.ac.uk>

Dear R-Devel,
  we use R on 32 and 64 bit versions of RHEL AS 4 (U5) where the default
compiler is gcc 3. However recently we have had problems updating
MCMCpack which appears to require gcc4. 

I have a few questions.

a) Is it OK to mix and match gcc3 and gcc4?
b) Should we recompile the whole of R under gcc4?
c) On posting to the RHEL 4 list one respondent said not to touch gcc4
with a barge pole. Is this valid?
d) What is the safest way to change compiler options for compiling
particular R modules.

I have been really impressed with CRAN and the automatic
compiling/updating of modules - the only glitch being the occasional
failure of compilations that require Tcl/Tk - interactive updating
solves this though it is a little annoying. However are more modules
going to require gcc4?

thanks

iain

ps I'm a sysadmin rather than a programmer so apologies in advance :->

----------------------------------------

Iain Morrison
IT Manager
MRC Epidemiology Unit
Institute of Metabolic Science
Box 285
Addenbrooke's Hospital
Hills Road
Cambridge
CB2 0QQ

Tel 01223 769200


From maechler at stat.math.ethz.ch  Sat Sep  8 11:50:54 2007
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Sat,  8 Sep 2007 11:50:54 +0200 (CEST)
Subject: [Rd] "bug" and patch: quadratic running time for strsplit(...,
	fixed=TRUE) (PR#9902)
Message-ID: <20070908095054.7112D66924@slim.kubism.ku.dk>

>>>>> "JB" == John Brzustowski <jbrzusto at fastmail.fm>
>>>>>     on Fri,  7 Sep 2007 15:47:26 +0200 (CEST) writes:
>>>>> "JB" == John Brzustowski <jbrzusto at fastmail.fm>
>>>>>     on Fri,  7 Sep 2007 15:47:26 +0200 (CEST) writes:

    JB> Full_Name: John Brzustowski
    JB> Version: R-devel-trunk, R-2.4.0
    JB> OS: linux, gcc 4.0.3
    JB> Submission from: (NULL) (206.248.157.184)


    JB> This isn't a bug, but an easily-remedied performance issue.

    JB> SYMPTOM

    >> for (i in 1000 * (1:20)) {
    JB> y <- paste(rep("asdf", times=i), collapse=" ")
    JB> t <- system.time(strsplit(y, " ", fixed=TRUE))
    JB> cat(sprintf("i=%5d time=%5d msec\n",i, round(1000*t[1])))
    JB> }

    JB> i= 1000 time=    2 msec
    JB> i= 2000 time=    9 msec
    JB> i= 3000 time=   20 msec
    JB> i= 4000 time=   34 msec

etc

    JB> i=17000 time=  726 msec
    JB> i=18000 time=  864 msec
    JB> i=19000 time=  944 msec
    JB> i=20000 time= 1106 msec

    JB> DIAGNOSIS

    JB> strsplit() uses strlen() in the bounds check clause of a for(;;)
    JB> statement, which forces a full scan of the source string for each
    JB> character in the source string.  Unlike R's LENGTH() macro, strlen for
    JB> C strings is an expensive operation, and in this case (at least),
    JB> gcc 4.0.3's -O2 level optimizer is not able to recognize the call as a loop
    JB> invariant, despite the declaration "const char *buf".

    JB> REMEDIED BEHAVIOUR

    JB> i= 1000 time=    0 msec
    JB> i= 2000 time=    1 msec
    JB> i= 3000 time=    1 msec
    JB> i= 4000 time=    0 msec
    JB> i= 5000 time=    1 msec
    JB> i= 6000 time=    1 msec
    JB> i= 7000 time=    1 msec

...

I can confirm this behavior before and after your patch, even
for the quite recent gcc 4.2.1  and -O3 (which I have changed
the default to, at least on some platforms).

Thank you for this excellent spotting.  I haven been more naive
about today's compiler optimizations and assumed they "surely"
would optimize such a case.   

Thanks a lot for your nice demonstration and patches!
I'm about to commit them to the development trunk,
but most probably they will even be back-ported to R 2.6.0
alpha.

Best regards,
Martin


    JB> RELATED ISSUES

    JB> A simple search turns up other instances of this usage in R's source.
    JB> For completeness, I'm submitting patches for all of them, but have not
    JB> tested whether they in fact cause a detectable performance problem.
    JB> In the case of modules/X11/dataentry.c, the patch also fixes a presumably
    JB> ineffectual "bug".

    JB> $ grep -nR "for *([^;]*;[^;]*strlen *(" *

    JB> main/rlocale.c:137:		for (i = 0; i < strlen(lc_str) && i < sizeof(lc_str); i++)
    JB> main/printutils.c:486:		for(j = 0; j < strlen(buf); j++) *q++ = buf[j];
    JB> main/sysutils.c:493:		for(j = 0; j < strlen(sub); j++) *outbuf++ = sub[j];
    JB> modules/X11/rotated.c:608:	for(i=0; i<strlen(text)-1; i++)
    JB> modules/X11/rotated.c:856:	for(i=0; i<strlen(text)-1; i++)
    JB> modules/X11/rotated.c:1399:	for(i=0; i<strlen(text)-1; i++)
    JB> modules/X11/rotated.c:1797:	for(i=0; i<strlen(text)-1; i++)
    JB> modules/X11/rotated.c:2045:	for(i=0; i<strlen(text)-1; i++)
    JB> modules/X11/rotated.c:2339:	for(i=0; i<strlen(text)-1; i++)
    JB> modules/X11/dataentry.c:1358:   for(i = 0; i < strlen(text); i++) *bufp++ =
    JB> text[i];


    JB> PATCHES (against trunk)
    JB> Only the first is required to fix strsplit().



    JB> Index: src/main/character.c

[.....]


From djsamperi at earthlink.net  Fri Sep  7 14:45:37 2007
From: djsamperi at earthlink.net (Dominick Samperi)
Date: Fri, 07 Sep 2007 08:45:37 -0400
Subject: [Rd] Windows Vista Issues
In-Reply-To: <12527646.post@talk.nabble.com>
References: <46DC7FD7.7070304@earthlink.net>	<46DEDC07.1060502@statistik.uni-dortmund.de>	<46DF4652.2030006@earthlink.net>
	<12527646.post@talk.nabble.com>
Message-ID: <46E147F1.60000@earthlink.net>

Mark Difford wrote:
> Hi Dominick,
>
> No offence intended, but I have been running R (presently 2.5.1.patched) on
> a Vista (Home Basic) machine without a hitch since March 2007.  Initially I
> had to turn off "User Account Control" to install new packages, but that was
> a known issue.  I still run it that way, though it's not necessary anymore
> (to have a truly smooth R).  You really don't need it switched on if you
> have decent anti-virus stuff &c.
>
> Regards,
> Mark Difford.
>   
Yes, I found the UAC trick, and the fact that most people turn it off 
suggests to me that the
security policy was not executed very well. I agree with Uwe that my 
posting was a bit off topic, having
more to do with Windows Vista hacks than with R, but I thought this 
mailing list is read by
technical/developer types who might appreciate my comments.

I don't think you will find any info about WinZip/ZipGenius 
compatibility issues in the
Windows Vista docs, and the main purpose of my posting was to share what 
I learned
with this mailing list. But by all means for R packaging purposes 
everyone should use
the approved/tested zip that is part of Brian Ripley's Rtools collection.

I'll have to remember to stay on topic in the future.

Dominick


From ggrothendieck at gmail.com  Sat Sep  8 18:58:06 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 8 Sep 2007 12:58:06 -0400
Subject: [Rd] Windows Vista Issues
In-Reply-To: <46E147F1.60000@earthlink.net>
References: <46DC7FD7.7070304@earthlink.net>
	<46DEDC07.1060502@statistik.uni-dortmund.de>
	<46DF4652.2030006@earthlink.net> <12527646.post@talk.nabble.com>
	<46E147F1.60000@earthlink.net>
Message-ID: <971536df0709080958k9f75f64sb17048466b955fa@mail.gmail.com>

If you find you need to turn UAC off try, instead, installing R into
   %userprofile%\Documents\R\R-2.6.0
(assuming R 2.6.0).  I run with UAC *on* although actually I was able
to run R with UAC on even with R in c:\Program Files\R\R-2.6.0.
It was only R CMD CHECK/INSTALL that was a problem and
even that I am not so sure really needed the step of relocating R to
%userprofile%\... since I tried so many things and it might have been
something else.

Also see my post here:
https://www.stat.math.ethz.ch/pipermail/r-devel/2007-September/046830.html


On 9/7/07, Dominick Samperi <djsamperi at earthlink.net> wrote:
> Mark Difford wrote:
> > Hi Dominick,
> >
> > No offence intended, but I have been running R (presently 2.5.1.patched) on
> > a Vista (Home Basic) machine without a hitch since March 2007.  Initially I
> > had to turn off "User Account Control" to install new packages, but that was
> > a known issue.  I still run it that way, though it's not necessary anymore
> > (to have a truly smooth R).  You really don't need it switched on if you
> > have decent anti-virus stuff &c.
> >
> > Regards,
> > Mark Difford.
> >
> Yes, I found the UAC trick, and the fact that most people turn it off
> suggests to me that the
> security policy was not executed very well. I agree with Uwe that my
> posting was a bit off topic, having
> more to do with Windows Vista hacks than with R, but I thought this
> mailing list is read by
> technical/developer types who might appreciate my comments.
>
> I don't think you will find any info about WinZip/ZipGenius
> compatibility issues in the
> Windows Vista docs, and the main purpose of my posting was to share what
> I learned
> with this mailing list. But by all means for R packaging purposes
> everyone should use
> the approved/tested zip that is part of Brian Ripley's Rtools collection.
>
> I'll have to remember to stay on topic in the future.
>
> Dominick
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From tobias.verbeke at gmail.com  Sun Sep  9 17:53:19 2007
From: tobias.verbeke at gmail.com (Tobias Verbeke)
Date: Sun, 09 Sep 2007 17:53:19 +0200
Subject: [Rd] format text help pages Windows
Message-ID: <46E416EF.6030600@telenet.be>

Dear list,

Could someone enlighten me a bit on the
exact format used for text help pages
as I see them on Windows in the help/
folders of (compiled) package roots.

When opening an example of these files
in a text editor (?Bessel in GNU emacs),
the file is displayed as follows:


_^HB_^He_^Hs_^Hs_^He_^Hl_^H _^HF_^Hu_^Hn_^Hc_^Ht_^Hi_^Ho_^Hn_^Hs

Bessel                 package:base                 R Documentation

_^HB_^He_^Hs_^Hs_^He_^Hl_^H _^HF_^Hu_^Hn_^Hc_^Ht_^Hi_^Ho_^Hn_^Hs


_^HD_^He_^Hs_^Hc_^Hr_^Hi_^Hp_^Ht_^Hi_^Ho_^Hn:


      Bessel Functions of integer and fractional order, of first and
      second kind, J(nu) and Y(nu), and Modified Bessel functions (of
      first and third kind), I(nu) and K(nu).

[....]

How should other applications handle these files ? Running Rterm as
a console within eclipse, e.g., now displays ^H as small rectangles
and leaves the underscores while R itself (Rgui to be precise) and
ESS nicely display help pages with some formatting (color code for
Rgui and underlining in an ESS help buffer).

Many thanks in advance,
Tobias

-- 

Tobias Verbeke - Consultant
Business & Decision Benelux
Rue de la r?volution 8
1000 Brussels - BELGIUM

+32 499 36 33 15
tobias.verbeke at businessdecision.com


From murdoch at stats.uwo.ca  Sun Sep  9 18:26:42 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sun, 09 Sep 2007 12:26:42 -0400
Subject: [Rd] format text help pages Windows
In-Reply-To: <46E416EF.6030600@telenet.be>
References: <46E416EF.6030600@telenet.be>
Message-ID: <46E41EC2.8030802@stats.uwo.ca>

On 09/09/2007 11:53 AM, Tobias Verbeke wrote:
> Dear list,
> 
> Could someone enlighten me a bit on the
> exact format used for text help pages
> as I see them on Windows in the help/
> folders of (compiled) package roots.
> 
> When opening an example of these files
> in a text editor (?Bessel in GNU emacs),
> the file is displayed as follows:
> 
> 
> _^HB_^He_^Hs_^Hs_^He_^Hl_^H _^HF_^Hu_^Hn_^Hc_^Ht_^Hi_^Ho_^Hn_^Hs
> 
> Bessel                 package:base                 R Documentation
> 
> _^HB_^He_^Hs_^Hs_^He_^Hl_^H _^HF_^Hu_^Hn_^Hc_^Ht_^Hi_^Ho_^Hn_^Hs
> 
> 
> _^HD_^He_^Hs_^Hc_^Hr_^Hi_^Hp_^Ht_^Hi_^Ho_^Hn:
> 
> 
>       Bessel Functions of integer and fractional order, of first and
>       second kind, J(nu) and Y(nu), and Modified Bessel functions (of
>       first and third kind), I(nu) and K(nu).
> 
> [....]
> 
> How should other applications handle these files ? Running Rterm as
> a console within eclipse, e.g., now displays ^H as small rectangles
> and leaves the underscores while R itself (Rgui to be precise) and
> ESS nicely display help pages with some formatting (color code for
> Rgui and underlining in an ESS help buffer).

^H is the backspace character, so what you're seeing would be displayed 
as underlined text on a teletype.

I'd suggest that other applications should try not to work with these 
files at all.  You're better off working with the .html files in the 
html folder, because they have cross references, etc.  Only work with 
the contents of the help folder if you are limited in what you can display.

Duncan Murdoch


From bolker at zoo.ufl.edu  Mon Sep 10 14:47:18 2007
From: bolker at zoo.ufl.edu (Ben Bolker)
Date: Mon, 10 Sep 2007 08:47:18 -0400
Subject: [Rd] [Fwd: buglet (?) in de.restore()]
Message-ID: <46E53CD6.8020808@zoo.ufl.edu>


  I'm resending this after a decent interval of 20 days -- any
opinions?  Should I file it as a bug report?  Is it my mistake?

  cheers
    Ben Bolker


-------- Original Message --------
Subject: 	buglet (?) in de.restore()
Date: 	Tue, 21 Aug 2007 13:29:33 -0400
From: 	Ben Bolker <bolker at zoo.ufl.edu>
To: 	r-devel at r-project.org



  If one calls data.entry() with a matrix:

A = matrix(0,2,2)
data.entry(A)

everything works fine except that it triggers a warning:

Warning message:
the condition has length > 1 and only the first element will be used in:
  if (dim(x) == dim(args[[i]])) rn <- dimnames(args[[i]])[[1]] else rn 
<- NULL

This is triggered by the following lines in de.restore() [in 
src/library/utils/R/de.R]:
>   if( dim(x) == dim(args[[i]]) )
>                 rn <- dimnames(args[[i]])[[1]]
>             else rn <- NULL
  It would seem to make sense to replace the condition with

if (nrow(x) == nrow(args[[i]]))

  (de.restore() is only called if an element of the list passed to 
data.entry
has more than one column)

 On a side note, I'm curious why

> > A = matrix(0,2,2)
> > is.vector(A)
> [1] FALSE
> > is(A,"vector")
> [1] TRUE
 ...

------------------
sessionInfo()
R version 2.5.1 (2007-06-27)
i486-pc-linux-gnu

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods" 
[7] "base"


From murdoch at stats.uwo.ca  Mon Sep 10 16:27:39 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 10 Sep 2007 10:27:39 -0400
Subject: [Rd] [Fwd: buglet (?) in de.restore()]
In-Reply-To: <46E53CD6.8020808@zoo.ufl.edu>
References: <46E53CD6.8020808@zoo.ufl.edu>
Message-ID: <46E5545B.8020204@stats.uwo.ca>

On 9/10/2007 8:47 AM, Ben Bolker wrote:
>   I'm resending this after a decent interval of 20 days -- any
> opinions?  Should I file it as a bug report?  Is it my mistake?

I think a bug report is in order.

> 
>   cheers
>     Ben Bolker
> 
> 
> -------- Original Message --------
> Subject: 	buglet (?) in de.restore()
> Date: 	Tue, 21 Aug 2007 13:29:33 -0400
> From: 	Ben Bolker <bolker at zoo.ufl.edu>
> To: 	r-devel at r-project.org
> 
> 
> 
>   If one calls data.entry() with a matrix:
> 
> A = matrix(0,2,2)
> data.entry(A)
> 
> everything works fine except that it triggers a warning:
> 
> Warning message:
> the condition has length > 1 and only the first element will be used in:
>   if (dim(x) == dim(args[[i]])) rn <- dimnames(args[[i]])[[1]] else rn 
> <- NULL
> 
> This is triggered by the following lines in de.restore() [in 
> src/library/utils/R/de.R]:
>>   if( dim(x) == dim(args[[i]]) )
>>                 rn <- dimnames(args[[i]])[[1]]
>>             else rn <- NULL
>   It would seem to make sense to replace the condition with
> 
> if (nrow(x) == nrow(args[[i]]))
> 
>   (de.restore() is only called if an element of the list passed to 
> data.entry
> has more than one column)
> 
>  On a side note, I'm curious why
> 
>> > A = matrix(0,2,2)
>> > is.vector(A)
>> [1] FALSE
>> > is(A,"vector")
>> [1] TRUE

The glib answer for the first result is that it's because it's 
documented that way.  I guess it's so that you can distinguish simple 
vectors from matrices or other more complex objects.

As to the second, you're testing whether A inherits from the class 
"vector", i.e. indexing works on it.  Most things in R inherit from 
class vector, so that comes out TRUE.  (Things that don't:  NULL, 
environments, some other special stuff.)

Duncan Murdoch


From P.Dalgaard at biostat.ku.dk  Mon Sep 10 16:25:31 2007
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Mon, 10 Sep 2007 16:25:31 +0200
Subject: [Rd] [Fwd: buglet (?) in de.restore()]
In-Reply-To: <46E53CD6.8020808@zoo.ufl.edu>
References: <46E53CD6.8020808@zoo.ufl.edu>
Message-ID: <46E553DB.3000207@biostat.ku.dk>

Ben Bolker wrote:
>   I'm resending this after a decent interval of 20 days -- any
> opinions?  Should I file it as a bug report?  Is it my mistake?
>   
It just slipped through the cracks, I suppose. I think it looks like a
buglet -- the [[1]] in dimnames(args[[i]])[[1]] doesn't make sense
unless dim(args[[i]]) is nonscalar. The suggested fix should be neutral
since nrow(x)==dim(x)[1] by definition.

I've fixed it now, but in principle it is the kind of material that bug
reports are made of.

    -p
>   cheers
>     Ben Bolker
>
>
> -------- Original Message --------
> Subject: 	buglet (?) in de.restore()
> Date: 	Tue, 21 Aug 2007 13:29:33 -0400
> From: 	Ben Bolker <bolker at zoo.ufl.edu>
> To: 	r-devel at r-project.org
>
>
>
>   If one calls data.entry() with a matrix:
>
> A = matrix(0,2,2)
> data.entry(A)
>
> everything works fine except that it triggers a warning:
>
> Warning message:
> the condition has length > 1 and only the first element will be used in:
>   if (dim(x) == dim(args[[i]])) rn <- dimnames(args[[i]])[[1]] else rn 
> <- NULL
>
> This is triggered by the following lines in de.restore() [in 
> src/library/utils/R/de.R]:
>   
>>   if( dim(x) == dim(args[[i]]) )
>>                 rn <- dimnames(args[[i]])[[1]]
>>             else rn <- NULL
>>     
>   It would seem to make sense to replace the condition with
>
> if (nrow(x) == nrow(args[[i]]))
>
>   (de.restore() is only called if an element of the list passed to 
> data.entry
> has more than one column)
>
>  On a side note, I'm curious why
>
>   
>>> A = matrix(0,2,2)
>>> is.vector(A)
>>>       
>> [1] FALSE
>>     
>>> is(A,"vector")
>>>       
>> [1] TRUE
>>     
>  ...
>
> ------------------
> sessionInfo()
> R version 2.5.1 (2007-06-27)
> i486-pc-linux-gnu
>
> locale:
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods" 
> [7] "base"
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From sgiannerini at gmail.com  Mon Sep 10 17:05:37 2007
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Mon, 10 Sep 2007 17:05:37 +0200
Subject: [Rd] partial correlation function for multivariate time series
Message-ID: <3c12769c0709100805r4ca5785bq3a932665c82084fd@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070910/90de0056/attachment.pl 

From luke at stat.uiowa.edu  Mon Sep 10 18:01:37 2007
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Mon, 10 Sep 2007 11:01:37 -0500 (CDT)
Subject: [Rd] Snow on Windows Cluster
In-Reply-To: <46DBAD99.3010800@ibe.med.uni-muenchen.de>
References: <46DBAD99.3010800@ibe.med.uni-muenchen.de>
Message-ID: <Pine.LNX.4.64.0709101052520.5248@nokomis.stat.uiowa.edu>

Thanks for the note.

Could you give me more info on the "small failures on stopping cluster"?

I don't currently have a windows system I can test this on so I can't
fold it into the snow release yet. But hopefully I can in the next
month or so. I may get back in touch at that point.

Meanwhile I have been working with a modified shell script that can be
used with mpirun under lam on unix.  I've attached the current
version.  It may turn out that this approach is a little more
maitainable on the Windows side as well.  The way this gets used is

     mpirun -np 5 RMPISNOW

to run a master and 4 workers, and then in the master

     cl <- getMPIcluster()

instead of using makeCluster or makeMPIcluster.  I have not yet found
the MICH2 analog of the LAMRANK environment variable but suspect
something similar does exist.

Best,

luke


On Mon, 3 Sep 2007, Markus Schmidberger wrote:

> Hello,
>
> the package snow is not working on a windows cluster with MPICH2 and Rmpi. 
> There is an error in makeCluster:
>
> launch failed: CreateProcess(/usr/bin/env 
> "RPROG="C:\Programme\R\R-2.5.1\bin\R" "OUT=/dev/null" "R_LIBS=" 
> C:/Programme/R/R-2.5.1/library/snow/RMPInode.sh) on 'cl1' failed, error 3 - 
> Das System kann den angegbenen Pfad nicht finden.
>
> I looked into makeMPIcluster. It could not work, mpi.comm.spawn gets the 
> shell command for unix to start the slaves. A simple solution is to use the 
> windows-code from mpi.spawn.rslaves, then it looks like this. And is working 
> on our windows-cluster. (small failures on stopping cluster)
>
> # Fro windows
> if (.Platform$OS=="windows"){
>   workdrive <- unlist(strsplit(getwd(),":"))[1]
>   tmpdrive <- unlist(strsplit(tempdir(),":"))[1]
>   worktmp <- as.logical(toupper(workdrive)==toupper(tmpdrive))
>   tmpdir <- unlist(strsplit(tempdir(),"/Rtmp"))[1]
>   localhost <- Sys.getenv("COMPUTERNAME")
>   networkdrive <-.Call("RegQuery", 
> as.integer(2),paste("NETWORK\\",workdrive,sep=""),
>                      PACKAGE="Rmpi")
>   remotepath <-networkdrive[which(networkdrive=="RemotePath")+1]
>   mapdrive=TRUE
>   mapdrive <- as.logical(mapdrive && !is.null(remotepath))
>   Rscript=system.file("slaveload.R", package="snow")
>   arg <- c(Rscript, R.home(), workdrive, getwd(),worktmp, tmpdir,
>                  localhost, mapdrive, remotepath)
>           #Rscript,R_HOME,WDrive,WDir,WorkTmp,TmpDir,Master,MapDrive,RemotePath
>   print("super")
>   count<-mpi.comm.spawn(
>       slave=system.file("Rslaves.bat", package="Rmpi"),
>       slavearg=arg,
>       nslaves=count)
> } else{   # for unix
>   count <- mpi.comm.spawn(slave = "/usr/bin/env",
>                               slavearg = args,
>                               nslaves = count,
>                               intercomm = intercomm)
> }
>
> Doing some work, there should be a better and nicer solution with directly 
> using mpi.spawn.Rslaves.
>
> Best
> Markus
>
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
-------------- next part --------------
#! /bin/sh

# if definded, prepend R_SNOW_LIB to $_LIBS
if test ! -z "${R_SNOW_LIB}" ; then
    R_LIBS=${R_SNOW_LIB}:${R_LIBS}; export R_LIBS
fi

# find the library containing the snow package; should eventually use Rscript
snowdir=`echo 'invisible(cat(tryCatch(dirname(.find.package("snow")), error = function(e) ""),"\n",sep=""))' | R --slave`

# for now this hijack the R_PROFILE mechanism to start up the R
# sessions and load snow and Rmpi into them
R_PROFILE=${snowdir}/snow/RMPISNOWprofile; export R_PROFILE

if test -z "${LAMRANK}" ; then
    echo "not using LAM-MPI; currently only LAM-MPI is supported"
    exit 1
else 
    # use the LAMRANK environment variable set by LAM-MPI's mpirun to
    # run R with appropriate arguments for master and workers.
    if test "${LAMRANK}" == "0" ; then
	exec R $*
    else
	exec R --slave > /dev/null 2>&1
    fi
fi

From djsamperi at earthlink.net  Tue Sep 11 05:47:53 2007
From: djsamperi at earthlink.net (Dominick Samperi)
Date: Mon, 10 Sep 2007 23:47:53 -0400
Subject: [Rd] Test posting
Message-ID: <46E60FE9.5050404@earthlink.net>

This is a test posting to R-devel used to
determine why some postings are dropped.
This one avoids mentioning the name of
an operating system that may trigger a junk
reaction.

Please ignore.

DS


From bolker at zoo.ufl.edu  Tue Sep 11 13:58:19 2007
From: bolker at zoo.ufl.edu (Ben Bolker)
Date: Tue, 11 Sep 2007 07:58:19 -0400
Subject: [Rd] trivial typo in ?AIC
Message-ID: <46E682DB.1020309@zoo.ufl.edu>

 "if more than one object are provided, "

 could be

"if more than one object is provided"

    or

"if multiple objects are provided"

  cheers
    Ben Bolker

 > sessionInfo()
R version 2.5.1 (2007-06-27)
i486-pc-linux-gnu

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods" 
[7] "base"


From murdoch at stats.uwo.ca  Tue Sep 11 14:20:34 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 11 Sep 2007 08:20:34 -0400
Subject: [Rd] trivial typo in ?AIC
In-Reply-To: <46E682DB.1020309@zoo.ufl.edu>
References: <46E682DB.1020309@zoo.ufl.edu>
Message-ID: <46E68812.9050400@stats.uwo.ca>

On 9/11/2007 7:58 AM, Ben Bolker wrote:
>  "if more than one object are provided, "
> 
>  could be
> 
> "if more than one object is provided"
> 
>     or
> 
> "if multiple objects are provided"

Fixed, thanks.

Duncan Murdoch

> 
>   cheers
>     Ben Bolker
> 
>  > sessionInfo()
> R version 2.5.1 (2007-06-27)
> i486-pc-linux-gnu
> 
> locale:
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
> 
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods" 
> [7] "base"
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From sgiannerini at gmail.com  Tue Sep 11 14:35:51 2007
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Tue, 11 Sep 2007 14:35:51 +0200
Subject: [Rd] typo in ?kernel
Message-ID: <3c12769c0709110535j3a38c57fiac13bf0f1e39c841@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070911/2bc490cf/attachment.pl 

From murdoch at stats.uwo.ca  Tue Sep 11 15:09:46 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 11 Sep 2007 09:09:46 -0400
Subject: [Rd] typo in ?kernel
In-Reply-To: <3c12769c0709110535j3a38c57fiac13bf0f1e39c841@mail.gmail.com>
References: <3c12769c0709110535j3a38c57fiac13bf0f1e39c841@mail.gmail.com>
Message-ID: <46E6939A.3010303@stats.uwo.ca>

On 9/11/2007 8:35 AM, Simone Giannerini wrote:
 > in the example section (line -2 from the bottom)
 >
 > Brockwell and Davies
 >
 > should be
 >
 > Brockwell and Davis

Fixed, thanks.  (It also shows up in the Details section.)

Duncan Murdoch


From pgilbert at bank-banque-canada.ca  Tue Sep 11 18:01:16 2007
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Tue, 11 Sep 2007 12:01:16 -0400
Subject: [Rd] partial correlation function for multivariate time series
In-Reply-To: <3c12769c0709100805r4ca5785bq3a932665c82084fd@mail.gmail.com>
References: <3c12769c0709100805r4ca5785bq3a932665c82084fd@mail.gmail.com>
Message-ID: <46E6BBCC.5040907@bank-banque-canada.ca>

I think the reference for pacf is

@BOOK{GraNew77,
   author =    {Granger, C. W. J. and Newbold, Paul},
   title =     {Forecasting Economic Time Series},
   publisher = {Academic Press},
   year =      1977
   }

It certainly would not be Reisel's book, as parts of the code predate 
that by many years.

Paul Gilbert

Simone Giannerini wrote:
> Dear all,
> 
> I found the following behaviour with pacf() in the multivariate case,
> 
> set.seed(10)
> x <- rnorm(1000,sd=10000)
> y <- rnorm(1000,sd=1)
> pacf(ts(cbind(x,y)),plot=FALSE,lag.max=10)
> 
> Partial autocorrelations of series 'cbind(x, y)', by lag
> 
> , , x
> 
>  x              y
>     0.047 (  1)    0.000 ( -1)
>     0.011 (  2)    0.000 ( -2)
>     0.005 (  3)    0.000 ( -3)
>     0.013 (  4)    0.000 ( -4)
>     0.050 (  5)    0.000 ( -5)
>     0.034 (  6)    0.000 ( -6)
>     0.026 (  7)    0.000 ( -7)
>    -0.029 (  8)    0.000 ( -8)
>    -0.010 (  9)    0.000 ( -9)
>    -0.013 ( 10)    0.000 (-10)
> 
> , , y
> 
>  x              y
>   374.052 (  1)   -0.045 (  1)
>    66.717 (  2)   -0.024 (  2)
>  -535.810 (  3)   -0.031 (  3)
>   120.802 (  4)   -0.020 (  4)
>   142.824 (  5)    0.004 (  5)
>  -211.711 (  6)   -0.010 (  6)
>   201.856 (  7)    0.058 (  7)
>   286.079 (  8)   -0.035 (  8)
>  -134.057 (  9)    0.032 (  9)
>   -18.200 ( 10)    0.019 ( 10)
> 
> Since there are multiple ways of defining the pacf for multivariate time
> series
> (see e.g. G.C. Reinsel, Elements of multivariate time series analysis, II
> edition, Springer, section 3.3) and given that
> in ?pacf there is no reference to articles or books regarding its
> computation
> I do not know whether this behaviour is expected or it is a bug instead.
> In the first case could you provide a reference for it? In the second case I
> might file a bug report.
> Thank you for the great work you are doing for the scientific community.
> 
> kind regards,
> 
> Simone Giannerini
> 
> WINDOWS
> 
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status
> major          2
> minor          5.1
> year           2007
> month          06
> day            27
> svn rev        42083
> language       R
> version.string R version 2.5.1 (2007-06-27)
> 
> LINUX
> 
> 
>>R.Version()
> 
> $platform
> [1] "x86_64-unknown-linux-gnu"
> 
> $arch
> [1] "x86_64"
> 
> $os
> [1] "linux-gnu"
> 
> $system
> [1] "x86_64, linux-gnu"
> 
> $status
> [1] ""
> 
> $major
> [1] "2"
> 
> $minor
> [1] "5.1"
> 
> $year
> [1] "2007"
> 
> $month
> [1] "06"
> 
> $day
> [1] "27"
> 
> $`svn rev`
> [1] "42083"
> 
> $language
> [1] "R"
> 
> $version.string
> [1] "R version 2.5.1 (2007-06-27)"
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From Max.Kuhn at pfizer.com  Tue Sep 11 19:24:23 2007
From: Max.Kuhn at pfizer.com (Kuhn, Max)
Date: Tue, 11 Sep 2007 13:24:23 -0400
Subject: [Rd] gcc-sjlj
Message-ID: <71257D09F114DA4A8E134DEAC70F25D3097BE64D@groamrexm03.amer.pfizer.com>

Everyone,

I'm running R CMD check on a package using the 2.6.0 alpha version:

> sessionInfo()
R version 2.6.0 alpha (2007-09-09 r42809) 
i386-pc-mingw32 

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
States.1252;LC_MONETARY=English_United
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base   

The check is failing with this error:

* checking whether package 'caret' can be installed ... ERROR
Installation failed.

Specifically:

  making DLL ...
making caret.d from caret.c
make[3]: gcc-sjlj: Command not found
make[3]: [caret.d] Error 127 (ignored)
cat: caret.d: No such file or directory
make[3]: [makeMakedeps] Error 1 (ignored)
gcc-sjlj  -std=gnu99  -Ic:/PROGRA~1/R/R260AL~1/include    -Wall -O3  -c
caret.c -o caret.o
make[3]: gcc-sjlj: Command not found
make[3]: *** [caret.o] Error 127
make[2]: *** [srcDynlib] Error 2
make[1]: *** [all] Error 2
make: *** [pkg-caret] Error 2

Is there a new gcc version that I need to get or was a space omitted in
the gcc command? (This uses gcc version 3.4.5 (mingw special)). I
checked the release notes and the "Building R for Windows" site and I
didn't see any mention of version changes. I've been able to run RCMD
check with previous versions on the same package without error.

Thanks,

Max

----------------------------------------------------------------------
LEGAL NOTICE\ Unless expressly stated otherwise, this messag...{{dropped}}


From ligges at statistik.uni-dortmund.de  Tue Sep 11 19:35:52 2007
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Tue, 11 Sep 2007 19:35:52 +0200
Subject: [Rd] gcc-sjlj
In-Reply-To: <71257D09F114DA4A8E134DEAC70F25D3097BE64D@groamrexm03.amer.pfizer.com>
References: <71257D09F114DA4A8E134DEAC70F25D3097BE64D@groamrexm03.amer.pfizer.com>
Message-ID: <46E6D1F8.8000901@statistik.uni-dortmund.de>

gcc-4.2.1 is the default now.

Uwe Ligges



Kuhn, Max wrote:
> Everyone,
> 
> I'm running R CMD check on a package using the 2.6.0 alpha version:
> 
>> sessionInfo()
> R version 2.6.0 alpha (2007-09-09 r42809) 
> i386-pc-mingw32 
> 
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> States.1252;LC_MONETARY=English_United
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base   
> 
> The check is failing with this error:
> 
> * checking whether package 'caret' can be installed ... ERROR
> Installation failed.
> 
> Specifically:
> 
>   making DLL ...
> making caret.d from caret.c
> make[3]: gcc-sjlj: Command not found
> make[3]: [caret.d] Error 127 (ignored)
> cat: caret.d: No such file or directory
> make[3]: [makeMakedeps] Error 1 (ignored)
> gcc-sjlj  -std=gnu99  -Ic:/PROGRA~1/R/R260AL~1/include    -Wall -O3  -c
> caret.c -o caret.o
> make[3]: gcc-sjlj: Command not found
> make[3]: *** [caret.o] Error 127
> make[2]: *** [srcDynlib] Error 2
> make[1]: *** [all] Error 2
> make: *** [pkg-caret] Error 2
> 
> Is there a new gcc version that I need to get or was a space omitted in
> the gcc command? (This uses gcc version 3.4.5 (mingw special)). I
> checked the release notes and the "Building R for Windows" site and I
> didn't see any mention of version changes. I've been able to run RCMD
> check with previous versions on the same package without error.
> 
> Thanks,
> 
> Max
> 
> ----------------------------------------------------------------------
> LEGAL NOTICE\ Unless expressly stated otherwise, this messag...{{dropped}}
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Tue Sep 11 20:20:25 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 11 Sep 2007 14:20:25 -0400
Subject: [Rd] gcc-sjlj
In-Reply-To: <71257D09F114DA4A8E134DEAC70F25D3097BE64D@groamrexm03.amer.pfizer.com>
References: <71257D09F114DA4A8E134DEAC70F25D3097BE64D@groamrexm03.amer.pfizer.com>
Message-ID: <46E6DC69.7000309@stats.uwo.ca>

On 11/09/2007 1:24 PM, Kuhn, Max wrote:
> Everyone,
> 
> I'm running R CMD check on a package using the 2.6.0 alpha version:
> 
>> sessionInfo()
> R version 2.6.0 alpha (2007-09-09 r42809) 
> i386-pc-mingw32 
> 
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> States.1252;LC_MONETARY=English_United
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base   
> 
> The check is failing with this error:
> 
> * checking whether package 'caret' can be installed ... ERROR
> Installation failed.
> 
> Specifically:
> 
>   making DLL ...
> making caret.d from caret.c
> make[3]: gcc-sjlj: Command not found
> make[3]: [caret.d] Error 127 (ignored)
> cat: caret.d: No such file or directory
> make[3]: [makeMakedeps] Error 1 (ignored)
> gcc-sjlj  -std=gnu99  -Ic:/PROGRA~1/R/R260AL~1/include    -Wall -O3  -c
> caret.c -o caret.o
> make[3]: gcc-sjlj: Command not found
> make[3]: *** [caret.o] Error 127
> make[2]: *** [srcDynlib] Error 2
> make[1]: *** [all] Error 2
> make: *** [pkg-caret] Error 2
> 
> Is there a new gcc version that I need to get or was a space omitted in
> the gcc command? (This uses gcc version 3.4.5 (mingw special)). I
> checked the release notes and the "Building R for Windows" site and I
> didn't see any mention of version changes. I've been able to run RCMD
> check with previous versions on the same package without error.

gcc 4 is the new default, specifically the MinGW "setjmp/longjmp" build, 
gcc-sjlj.  If you want to use the old 3.4.5, you need to edit MkRules, 
setting BUILD=GCC3.

For now, the Windows toolset I put together 
(www.murdoch-sutherland.com/Rtools) includes both versions, so you might 
want to download a new copy rather than continuing to use the old one; 
sometime after the release of 2.6.0 I'll drop 3.4.5 from the tools.

Duncan Murdoch


From Max.Kuhn at pfizer.com  Tue Sep 11 20:41:36 2007
From: Max.Kuhn at pfizer.com (Kuhn, Max)
Date: Tue, 11 Sep 2007 14:41:36 -0400
Subject: [Rd] gcc-sjlj
In-Reply-To: <46E6DC69.7000309@stats.uwo.ca>
Message-ID: <71257D09F114DA4A8E134DEAC70F25D3097BE7BE@groamrexm03.amer.pfizer.com>

Duncan,

> gcc 4 is the new default, specifically the MinGW "setjmp/longjmp"
build, 
> gcc-sjlj.  If you want to use the old 3.4.5, you need to edit MkRules,

> setting BUILD=GCC3.

Thanks for the suggestion. With my C skills, that would be like giving a
monkey a gun. Nothing good could come of it.

> For now, the Windows toolset I put together 
> (www.murdoch-sutherland.com/Rtools) includes both versions, so you
might 
> want to download a new copy rather than continuing to use the old one;

> sometime after the release of 2.6.0 I'll drop 3.4.5 from the tools.

Sorry, I originally looked there and missed the link. I used it and
everything worked fine. It is a great improvement compared to hunting
down the various files. I'm up and running now with no issues.

Max

----------------------------------------------------------------------
LEGAL NOTICE\ Unless expressly stated otherwise, this messag...{{dropped}}


From ross at biostat.ucsf.edu  Wed Sep 12 02:02:53 2007
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Tue, 11 Sep 2007 17:02:53 -0700
Subject: [Rd] "could not find function" in R CMD check
Message-ID: <1189555373.21055.111.camel@iron.psg.net>

During R CMD check I get this:
** building package indices ...
Error in eval(expr, envir, enclos) : could not find function
"readingError"
Execution halted
ERROR: installing package indices failed

The check aborts there.  readingError is a function I just added; for
reference
setClass("readingError", contains="matrix")
readingError <- function(...) new("readingError", matrix(...))
which is in readingError.R in the project's R subdirectory.

Some code in the data directory invokes readingError, and the .Rd file
includes \alias{readingError}, \alias{readingError-class},
\name{readingError-class} and an example invoking readingError.

I'm using R 2.5.1 as packaged for Debian GNU/Linux.

Does anyone have an idea what's going wrong here, or how to fix or debug
it?

The code seems to work OK when I use it from ESS.
-- 
Ross Boylan                                      wk:  (415) 514-8146
185 Berry St #5700                               ross at biostat.ucsf.edu
Dept of Epidemiology and Biostatistics           fax: (415) 514-8150
University of California, San Francisco
San Francisco, CA 94107-1739                     hm:  (415) 550-1062


From ligges at statistik.uni-dortmund.de  Wed Sep 12 11:31:55 2007
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Wed, 12 Sep 2007 11:31:55 +0200
Subject: [Rd] "could not find function" in R CMD check
In-Reply-To: <1189555373.21055.111.camel@iron.psg.net>
References: <1189555373.21055.111.camel@iron.psg.net>
Message-ID: <46E7B20B.1020609@statistik.uni-dortmund.de>

Perhaps Namespace issues? But no further ideas. You might want to make 
your package available at some URL so that people can look at it and help...

Uwe Ligges


Ross Boylan wrote:
> During R CMD check I get this:
> ** building package indices ...
> Error in eval(expr, envir, enclos) : could not find function
> "readingError"
> Execution halted
> ERROR: installing package indices failed
> 
> The check aborts there.  readingError is a function I just added; for
> reference
> setClass("readingError", contains="matrix")
> readingError <- function(...) new("readingError", matrix(...))
> which is in readingError.R in the project's R subdirectory.
> 
> Some code in the data directory invokes readingError, and the .Rd file
> includes \alias{readingError}, \alias{readingError-class},
> \name{readingError-class} and an example invoking readingError.
> 
> I'm using R 2.5.1 as packaged for Debian GNU/Linux.
> 
> Does anyone have an idea what's going wrong here, or how to fix or debug
> it?
> 
> The code seems to work OK when I use it from ESS.


From ggrothendieck at gmail.com  Wed Sep 12 14:21:06 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 12 Sep 2007 08:21:06 -0400
Subject: [Rd] warning upon automatic close of connection
Message-ID: <971536df0709120521t6f7406fcic41a5e3874c488ec@mail.gmail.com>

I noticed that under R 2.6.0 there is a warning about closing the connection
in the code from this post:
https://stat.ethz.ch/pipermail/r-help/2007-September/140601.html

which is evidently related to the following from the NEWS file:

    o	Connections will be closed if there is no R object referring to
	them.  A warning is issued if this is done, either at garbage
	collection or if all the connection slots are in use.

If we use read.table directly it still happens:

# use Lines and Lines2 from cited post
library(zoo)
DF1 <- read.table(textConnection(Lines), header = TRUE)
DF2 <- read.table(textConnection(Lines2), header = TRUE)
z1 <- zoo(as.matrix(DF1[-1]), as.Date(DF1[,1], "%d/%m/%Y"))
z2 <- zoo(as.matrix(DF2[-1]), as.Date(DF2[,1], "%d/%m/%Y"))
both <- merge(z1, z2)
plot(na.approx(both))

> R.version.string # Vista
[1] "R version 2.6.0 alpha (2007-09-06 r42791)"

Is this annoying warning really necessary?  I assume we can get rid of
it by explicitly naming and closing the connections but surely there should
be a way to avoid the warning without going to those lengths.

I would have thought that read.table opens the connection then it would
close it itself so no warning would need to be generated.

> # use Lines and Lines2 from cited post
> library(zoo)
> DF1 <- read.table(textConnection(Lines), header = TRUE)
> DF2 <- read.table(textConnection(Lines2), header = TRUE)
> z1 <- zoo(as.matrix(DF1[-1]), as.Date(DF1[,1], "%d/%m/%Y"))
> z2 <- zoo(as.matrix(DF2[-1]), as.Date(DF2[,1], "%d/%m/%Y"))
> both <- merge(z1, z2)
> plot(na.approx(both))
Warning messages:
1: closing unused connection 4 (Lines2)
2: closing unused connection 3 (Lines)


From sfalcon at fhcrc.org  Wed Sep 12 16:05:28 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Wed, 12 Sep 2007 07:05:28 -0700
Subject: [Rd] warning upon automatic close of connection
In-Reply-To: <971536df0709120521t6f7406fcic41a5e3874c488ec@mail.gmail.com>
	(Gabor Grothendieck's message of "Wed\,
	12 Sep 2007 08\:21\:06 -0400")
References: <971536df0709120521t6f7406fcic41a5e3874c488ec@mail.gmail.com>
Message-ID: <m2odg8m11z.fsf@fhcrc.org>

"Gabor Grothendieck" <ggrothendieck at gmail.com> writes:
> I noticed that under R 2.6.0 there is a warning about closing the connection
> in the code from this post:
> https://stat.ethz.ch/pipermail/r-help/2007-September/140601.html
>
> which is evidently related to the following from the NEWS file:
>
>     o	Connections will be closed if there is no R object referring to
> 	them.  A warning is issued if this is done, either at garbage
> 	collection or if all the connection slots are in use.
>
> If we use read.table directly it still happens:
>
> # use Lines and Lines2 from cited post
> library(zoo)
> DF1 <- read.table(textConnection(Lines), header = TRUE)
> DF2 <- read.table(textConnection(Lines2), header = TRUE)
> z1 <- zoo(as.matrix(DF1[-1]), as.Date(DF1[,1], "%d/%m/%Y"))
> z2 <- zoo(as.matrix(DF2[-1]), as.Date(DF2[,1], "%d/%m/%Y"))
> both <- merge(z1, z2)
> plot(na.approx(both))
>
>> R.version.string # Vista
> [1] "R version 2.6.0 alpha (2007-09-06 r42791)"
>
> Is this annoying warning really necessary?  I assume we can get rid of
> it by explicitly naming and closing the connections but surely there should
> be a way to avoid the warning without going to those lengths.

Up until the change you mention above it really was necessary to name
and close all connections.  Short scripts run in fresh R sessions may
not have had problems with code like you have written above, but
longer programs or shorter ones run in a long running R session would
run out of connections.

Now that connections have weak reference semantics, one can ask
whether this behavior should be "standard" and no warning issued.

> I would have thought that read.table opens the connection then it would
> close it itself so no warning would need to be generated.

In your example, read.table is _not_ opening the connection.  You are
passing an open connection which has no symbol bound to it:

   foo = ""
   c = textConnection(foo)
   c
     description            class             mode             text 
           "foo" "textConnection"              "r"           "text" 
          opened         can read        can write 
        "opened"            "yes"             "no" 

But I think passing a closed connection would cause the same sort of
issue.  It seems that there are two notions of "closing a connection":
(i) close as the opposite of open, and (ii) clean up the entire
connection object.  I haven't looked closely at the code here, so I
could be wrong, but I'm basing this guess on the following:

> file("foo")
description       class        mode        text      opened    can read 
      "foo"      "file"         "r"      "text"    "closed"       "yes" 
  can write 
      "yes" 
## start new R session
for (i in 1:75) file("foo")
gc()
warnings()[1:3]
> gc()
         used (Mb) gc trigger (Mb) max used (Mb)
Ncells 149603  4.0     350000  9.4   350000  9.4
Vcells 101924  0.8     786432  6.0   486908  3.8
There were 50 or more warnings (use warnings() to see the first 50)
> warnings()[1:3]
$`closing unused connection 76 (foo)`
NULL

$`closing unused connection 75 (foo)`
NULL

$`closing unused connection 74 (foo)`
NULL


-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
BioC: http://bioconductor.org/
Blog: http://userprimary.net/user/


From manuel.munoz at uca.es  Wed Sep 12 16:52:19 2007
From: manuel.munoz at uca.es (manuel.munoz at uca.es)
Date: Wed, 12 Sep 2007 16:52:19 +0200 (CEST)
Subject: [Rd] Font problem (PR#9906)
Message-ID: <20070912145219.1D7A16694F@slim.kubism.ku.dk>

Full_Name: M. Mu?oz M?rquez
Version: 2.3.1
OS: Ubuntu
Submission from: (NULL) (150.214.231.66)


Here is the reply to the edit command using gnome
> edit(data.frame())
Erro en dataentry(datalist, modes) : invalid device
Adem?s: Warning message:
unable to create fontset -*-fixed-medium-r-normal--13-*-*-*-*-*-*-* 
> Sys.getlocale()
[1] "LC_CTYPE=es_ES.UTF-8;LC_NUMERIC=C;LC_TIME=es_ES.UTF-8;LC_COLLATE=es_ES.UTF-8;LC_MONETARY=es_ES.UTF-8;LC_MESSAGES=es_ES.UTF-8;LC_PAPER=C;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=C;LC_IDENTIFICATION=C"

Under kde it works fine.


From osklyar at ebi.ac.uk  Wed Sep 12 18:47:32 2007
From: osklyar at ebi.ac.uk (Oleg Sklyar)
Date: Wed, 12 Sep 2007 17:47:32 +0100
Subject: [Rd] Font problem (PR#9906)
In-Reply-To: <20070912145219.1D7A16694F@slim.kubism.ku.dk>
References: <20070912145219.1D7A16694F@slim.kubism.ku.dk>
Message-ID: <1189615652.8288.33.camel@maitai.windows.ebi.ac.uk>

OS: Ubuntu 7.10 Gutsy Gibbon
GNOME: 2.19.92 (build: 04/09/07)
Linux 2.6.22-10-generic #1 SMP x86_64 GNU/Linux

It works perfectly fine here with 2 recent versions of R (errors because
dialogues closed without any data):

* ~: Rd
R version 2.7.0 Under development (unstable) (2007-09-06 r42789) 
> edit(data.frame())
Error in max(lengths) : invalid 'type' (list) of argument
> 
* ~: R
R version 2.5.1 (2007-06-27) 
> edit(data.frame())
Error in max(..., na.rm = na.rm) : invalid 'type' (list) of argument
> 



On Wed, 2007-09-12 at 16:52 +0200, manuel.munoz at uca.es wrote:
> Full_Name: M. Mu?oz M?rquez
> Version: 2.3.1
> OS: Ubuntu
> Submission from: (NULL) (150.214.231.66)
> 
> 
> Here is the reply to the edit command using gnome
> > edit(data.frame())
> Erro en dataentry(datalist, modes) : invalid device
> Adem?s: Warning message:
> unable to create fontset -*-fixed-medium-r-normal--13-*-*-*-*-*-*-* 
> > Sys.getlocale()
> [1] "LC_CTYPE=es_ES.UTF-8;LC_NUMERIC=C;LC_TIME=es_ES.UTF-8;LC_COLLATE=es_ES.UTF-8;LC_MONETARY=es_ES.UTF-8;LC_MESSAGES=es_ES.UTF-8;LC_PAPER=C;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=C;LC_IDENTIFICATION=C"
> 
> Under kde it works fine.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
-- 
Dr Oleg Sklyar * EBI-EMBL, Cambridge CB10 1SD, UK * +44-1223-494466


From edd at debian.org  Wed Sep 12 19:40:02 2007
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 12 Sep 2007 12:40:02 -0500
Subject: [Rd] Font problem (PR#9906)
In-Reply-To: <20070912145219.1D7A16694F@slim.kubism.ku.dk>
References: <20070912145219.1D7A16694F@slim.kubism.ku.dk>
Message-ID: <20070912174002.GA2205@eddelbuettel.com>

On Wed, Sep 12, 2007 at 04:52:19PM +0200, manuel.munoz at uca.es wrote:
> Full_Name: M. Mu?oz M?rquez
> Version: 2.3.1

Note that this is over a year out of date ...

> OS: Ubuntu

... even though the R FAQ tells you that you can get current R
versions for Ubuntu from all CRAN mirror with a simple apt-get.

> Submission from: (NULL) (150.214.231.66)
> 
> 
> Here is the reply to the edit command using gnome
> > edit(data.frame())
> Erro en dataentry(datalist, modes) : invalid device
> Adem?s: Warning message:
> unable to create fontset -*-fixed-medium-r-normal--13-*-*-*-*-*-*-* 
> > Sys.getlocale()
> [1] "LC_CTYPE=es_ES.UTF-8;LC_NUMERIC=C;LC_TIME=es_ES.UTF-8;LC_COLLATE=es_ES.UTF-8;LC_MONETARY=es_ES.UTF-8;LC_MESSAGES=es_ES.UTF-8;LC_PAPER=C;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=C;LC_IDENTIFICATION=C"
> 
> Under kde it works fine.

Demonstrating that it is a local admin problem that your fonts aren't
right.  IIRC there was an Ubuntu issue that /etc/X11/xorg.conf ended
up with a misspecified font path.  FWIW, I use 

Section "Files"
        FontPath        "/usr/share/fonts/X11/misc"
        FontPath        "/usr/share/fonts/X11/cyrillic"
        FontPath        "/usr/share/fonts/X11/100dpi/:unscaled"
        FontPath        "/usr/share/fonts/X11/75dpi/:unscaled"
        FontPath        "/usr/share/fonts/X11/Type1"
        FontPath        "/usr/share/fonts/X11/100dpi"
        FontPath        "/usr/share/fonts/X11/75dpi"
        #
        FontPath        "/usr/share/X11/fonts/misc"
	FontPath        "/usr/share/X11/fonts/cyrillic"
	FontPath        "/usr/share/X11/fonts/100dpi/:unscaled"
	FontPath        "/usr/share/X11/fonts/75dpi/:unscaled"
	FontPath        "/usr/share/X11/fonts/Type1"
	FontPath        "/usr/share/X11/fonts/100dpi"
	FontPath        "/usr/share/X11/fonts/75dpi"
	FontPath        "/usr/share/X11/fonts/misc"
	# path to defoma fonts
        FontPath	"/var/lib/defoma/x-ttcidfont-conf.d/dirs/TrueType"
EndSection


Hoep this helps,  Dirk

> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Three out of two people have difficulties with fractions.


From alexander.jerneck at gmail.com  Wed Sep 12 18:52:43 2007
From: alexander.jerneck at gmail.com (alexander.jerneck at gmail.com)
Date: Wed, 12 Sep 2007 18:52:43 +0200 (CEST)
Subject: [Rd] installing packages (PR#9907)
Message-ID: <20070912165243.337A366952@slim.kubism.ku.dk>

Full_Name: Alexander Jerneck
Version: 2.4.0 (2006-10-03)
OS: Gentoo (2.6.17-custom kernel)
Submission from: (NULL) (130.91.92.78)


I had trouble installing R packages, either from inside R or from the
commandline, with R complaining about not finding /usr/bin/pwd
I have pwd in /bin/ so I created a symlink from /usr/bin/pwd to /bin/pwd and now
I can install packages. I do not know where the original problem is however.


From ross at biostat.ucsf.edu  Wed Sep 12 21:54:48 2007
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Wed, 12 Sep 2007 12:54:48 -0700
Subject: [Rd] "could not find function" in R CMD check [solved,
	but is	this an R bug?]
In-Reply-To: <46E7B20B.1020609@statistik.uni-dortmund.de>
References: <1189555373.21055.111.camel@iron.psg.net>
	<46E7B20B.1020609@statistik.uni-dortmund.de>
Message-ID: <1189626888.8989.95.camel@corn.betterworld.us>

On Wed, 2007-09-12 at 11:31 +0200, Uwe Ligges wrote:
> Perhaps Namespace issues? But no further ideas. You might want to make 
> your package available at some URL so that people can look at it and help...
> 
> Uwe Ligges
> 
Thanks.  The problem lay elsewhere.  I was able to fix it by adding 
library(mspath)
to the top of the .R file in data/ that defined some data using the
package's functions  In other words
-----------------------------------------------
library(mspath)
### from various papers on errors in reading fibrosis scores
rousselet.jr <- readingError(c(.91, .09, 0, 0, 0,
                               .11, .78, .11, 0, 0,
                               0, .17, .75, .08, 0,
                               0, .06, .44, .50, 0,
                               0, 0, 0, .07, .93),
                             byrow=TRUE, nrow=5, ncol=5)
-----------------------------------------------------
works as data/readingErrorData.R, but without the library() call I  get
the error shown in my original message (see below).  readingError() is a
function defined in my package.

Does any of this inndicate a bug or undesirable feature in R?

First, it seems a little odd that I need to include loading the library
in data that is defined in the same library.  I think I've noticed
similar behavior in other places, maybe the code snippets that accompany
the documentation pages (that is, one needs library(mypackage) in order
for the snippets to check out).

Second, should R CMD check fail so completely and opaquely in this
situation?


> 
> Ross Boylan wrote:
> > During R CMD check I get this:
> > ** building package indices ...
> > Error in eval(expr, envir, enclos) : could not find function
> > "readingError"
> > Execution halted
> > ERROR: installing package indices failed
> > 
> > The check aborts there.  readingError is a function I just added; for
> > reference
> > setClass("readingError", contains="matrix")
> > readingError <- function(...) new("readingError", matrix(...))
> > which is in readingError.R in the project's R subdirectory.
> > 
> > Some code in the data directory invokes readingError, and the .Rd file
> > includes \alias{readingError}, \alias{readingError-class},
> > \name{readingError-class} and an example invoking readingError.
> > 
> > I'm using R 2.5.1 as packaged for Debian GNU/Linux.
> > 
> > Does anyone have an idea what's going wrong here, or how to fix or debug
> > it?
> > 
> > The code seems to work OK when I use it from ESS.


From bolker at zoo.ufl.edu  Wed Sep 12 22:02:53 2007
From: bolker at zoo.ufl.edu (Ben Bolker)
Date: Wed, 12 Sep 2007 16:02:53 -0400
Subject: [Rd] trivial typo in ?strip.default
Message-ID: <46E845ED.7010508@zoo.ufl.edu>

under factor.levels:  specicifying


From cberry at tajo.ucsd.edu  Wed Sep 12 22:21:37 2007
From: cberry at tajo.ucsd.edu (Charles C. Berry)
Date: Wed, 12 Sep 2007 13:21:37 -0700
Subject: [Rd] installing packages (PR#9907)
In-Reply-To: <20070912165243.337A366952@slim.kubism.ku.dk>
References: <20070912165243.337A366952@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0709121312370.25309@tajo.ucsd.edu>

On Wed, 12 Sep 2007, alexander.jerneck at gmail.com wrote:

> Full_Name: Alexander Jerneck
> Version: 2.4.0 (2006-10-03)
> OS: Gentoo (2.6.17-custom kernel)
> Submission from: (NULL) (130.91.92.78)
>
>
> I had trouble installing R packages, either from inside R or from the
> commandline, with R complaining about not finding /usr/bin/pwd
> I have pwd in /bin/ so I created a symlink from /usr/bin/pwd to /bin/pwd and now
> I can install packages. I do not know where the original problem is however.

This is NOT A BUG.

Likely, you do not have /bin on your path. Check

 	Sys.getenv("PATH")


install.packages() works fine on all my Gentoo boxes with R installed as 
per the instructions in

 	$R_HOME/doc/manual/R-admin.html

>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Charles C. Berry                            (858) 534-2098
                                             Dept of Family/Preventive Medicine
E mailto:cberry at tajo.ucsd.edu	            UC San Diego
http://famprevmed.ucsd.edu/faculty/cberry/  La Jolla, San Diego 92093-0901


From pgilbert at bank-banque-canada.ca  Wed Sep 12 22:31:14 2007
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Wed, 12 Sep 2007 16:31:14 -0400
Subject: [Rd] installing packages (PR#9907)
In-Reply-To: <20070912165243.337A366952@slim.kubism.ku.dk>
References: <20070912165243.337A366952@slim.kubism.ku.dk>
Message-ID: <46E84C92.5090404@bank-banque-canada.ca>

I don't think this is a bug in R.

I believe a (not too) recent change in Gentoo removed /usr/bin/pwd so 
that the only one left is /bin/pwd. R seems to remember from install 
time where to find these utilities, and probably found /usr/bin/pwd when 
you installed the not recent version of R. You found one workaround, and 
another would be a fresh install of R.

Paul

alexander.jerneck at gmail.com wrote:
> Full_Name: Alexander Jerneck
> Version: 2.4.0 (2006-10-03)
> OS: Gentoo (2.6.17-custom kernel)
> Submission from: (NULL) (130.91.92.78)
> 
> 
> I had trouble installing R packages, either from inside R or from the
> commandline, with R complaining about not finding /usr/bin/pwd
> I have pwd in /bin/ so I created a symlink from /usr/bin/pwd to /bin/pwd and now
> I can install packages. I do not know where the original problem is however.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From p.dalgaard at biostat.ku.dk  Wed Sep 12 22:50:16 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 12 Sep 2007 22:50:16 +0200
Subject: [Rd] installing packages (PR#9907)
In-Reply-To: <20070912165243.337A366952@slim.kubism.ku.dk>
References: <20070912165243.337A366952@slim.kubism.ku.dk>
Message-ID: <46E85108.3050308@biostat.ku.dk>

alexander.jerneck at gmail.com wrote:
> Full_Name: Alexander Jerneck
> Version: 2.4.0 (2006-10-03)
> OS: Gentoo (2.6.17-custom kernel)
> Submission from: (NULL) (130.91.92.78)
>
>
> I had trouble installing R packages, either from inside R or from the
> commandline, with R complaining about not finding /usr/bin/pwd
> I have pwd in /bin/ so I created a symlink from /usr/bin/pwd to /bin/pwd and now
> I can install packages. I do not know where the original problem is however.
>   
Please don't report it as a bug then! Or at least do more of your 
homework first.

As far as I can see, this is handled by the configure script which goes 
looking for pwd and records the result in $GETWD (in Makeconf and the 
INSTALL and REMOVE scripts). If you compile on one system and run on 
another, strange things can and will happen if they do not have things 
in the same places.  There are a few other places where pwd is called 
directly (texi2dvi and libtool) but I don't think that can give the 
error message you describe.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From nakama at ki.rim.or.jp  Thu Sep 13 09:29:30 2007
From: nakama at ki.rim.or.jp (Ei-ji Nakama)
Date: Thu, 13 Sep 2007 16:29:30 +0900
Subject: [Rd] chartr better
Message-ID: <dc41e1260709130029r514fcb71ke10f41441e5603b3@mail.gmail.com>

For example, the following changes are necessary when i convert a
Japanese hiragana into katakana in chattr.

R code:
> chartr("\u3041-\u3093","\u30a1-\u30f3","\u3084\u3063\u305f\u30fc")

--- R-alpha.orig/src/main/character.c   2007-09-05 07:13:27.000000000 +0900
+++ R-alpha/src/main/character.c        2007-09-13 16:10:21.000000000 +0900
@@ -2041,6 +2041,16 @@
     return(c);
 }

+typedef struct { wchar_t c_old, c_new; } xtable_t;
+static inline int xtable_comp(const xtable_t *a, const xtable_t *b)
+{
+    return a->c_old - b->c_old;
+}
+static inline int xtable_key_comp(const wchar_t *a, const xtable_t *b)
+{
+    return *a - b->c_old;
+}
+
 SEXP attribute_hidden do_chartr(SEXP call, SEXP op, SEXP args, SEXP env)
 {
     SEXP old, _new, x, y;
@@ -2064,14 +2074,18 @@
 #ifdef SUPPORT_MBCS
     if(mbcslocale) {
         int j, nb, nc;
-        wchar_t xtable[65536 + 1], c_old, c_new, *wc;
+        xtable_t *xtable;
+        int       xtable_cnt;
+        wchar_t c_old, c_new, *wc;
         const char *xi, *s;
         struct wtr_spec *trs_old, **trs_old_ptr;
         struct wtr_spec *trs_new, **trs_new_ptr;
-
-        for(i = 0; i <= UCHAR_MAX; i++) xtable[i] = i;
+        struct wtr_spec *trs_cnt, **trs_cnt_ptr;

         /* Initialize the old and new wtr_spec lists. */
+        trs_cnt = Calloc(1, struct wtr_spec);
+        trs_cnt->type = WTR_INIT;
+        trs_cnt->next = NULL;
         trs_old = Calloc(1, struct wtr_spec);
         trs_old->type = WTR_INIT;
         trs_old->next = NULL;
@@ -2084,6 +2098,7 @@
         if(nc < 0) error(_("invalid multibyte string 'old'"));
         wc = (wchar_t *) R_AllocStringBuffer((nc+1)*sizeof(wchar_t), &cbuff);
         mbstowcs(wc, s, nc + 1);
+        wtr_build_spec(wc, trs_cnt); /* use count only */
         wtr_build_spec(wc, trs_old);

        s = translateChar(STRING_ELT(_new, 0));
@@ -2096,38 +2111,54 @@
         /* Initialize the pointers for walking through the old and new
            wtr_spec lists and retrieving the next chars from the lists.
         */
+        trs_cnt_ptr = Calloc(1, struct wtr_spec *);
+        *trs_cnt_ptr = trs_cnt->next;
+       for( xtable_cnt = 0 ; wtr_get_next_char_from_spec(trs_cnt_ptr)
;xtable_cnt++ );
+       Free(trs_cnt_ptr);
+       xtable = (xtable_t *)R_alloc(xtable_cnt+1,sizeof(xtable_t));
+
         trs_old_ptr = Calloc(1, struct wtr_spec *);
         *trs_old_ptr = trs_old->next;
         trs_new_ptr = Calloc(1, struct wtr_spec *);
         *trs_new_ptr = trs_new->next;
-        for(;;) {
+        for(i=0;;i++) {
             c_old = wtr_get_next_char_from_spec(trs_old_ptr);
             c_new = wtr_get_next_char_from_spec(trs_new_ptr);
             if(c_old == '\0')
                 break;
             else if(c_new == '\0')
                 error(_("'old' is longer than 'new'"));
-            else
-                xtable[c_old] = c_new;
+            else{
+                xtable[i].c_old=c_old;
+                xtable[i].c_new=c_new;
+           }
         }
+
         /* Free the memory occupied by the wtr_spec lists. */
         wtr_free_spec(trs_old);
         wtr_free_spec(trs_new);
         Free(trs_old_ptr); Free(trs_new_ptr);

+        qsort(xtable, xtable_cnt, sizeof(xtable_t),
+              (int(*)(const void *, const void *))xtable_comp);
+
         n = LENGTH(x);
         PROTECT(y = allocVector(STRSXP, n));
         for(i = 0; i < n; i++) {
             if (STRING_ELT(x,i) == NA_STRING)
                 SET_STRING_ELT(y, i, NA_STRING);
             else {
+                xtable_t *tbl;
                 xi = translateChar(STRING_ELT(x, i));
                 nc = mbstowcs(NULL, xi, 0);
                 if(nc < 0)
                     error(_("invalid input multibyte string %d"), i+1);
                 wc = (wchar_t *)
R_AllocStringBuffer((nc+1)*sizeof(wchar_t), &cbuff);
                 mbstowcs(wc, xi, nc + 1);
-                for(j = 0; j < nc; j++) wc[j] = xtable[wc[j]];
+                for(j = 0; j < nc; j++)
+                    if (tbl = bsearch(&wc[j], xtable, xtable_cnt,
sizeof(xtable_t),
+                                      (int(*)(const void *, const
void *))xtable_key_comp))
+                        wc[j]=tbl->c_new;
                 nb = wcstombs(NULL, wc, 0);
                 cbuf = CallocCharBuf(nb);
                 wcstombs(cbuf, wc, nb + 1);

-- 
EI-JI Nakama  <nakama at ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb"  <nakama at ki.rim.or.jp>


From lore at zhaw.ch  Thu Sep 13 13:34:56 2007
From: lore at zhaw.ch (lore at zhaw.ch)
Date: Thu, 13 Sep 2007 13:34:56 +0200 (CEST)
Subject: [Rd] julian: origin argument does not accept POSIXlt objects
	(PR#9908)
Message-ID: <20070913113456.8C7B35AB39@slim.kubism.ku.dk>

Full_Name: Rene Locher
Version: 2.5.1 (2007-06-27) 
OS: i386-pc-mingw32
Submission from: (NULL) (160.85.231.54)


julian(as.POSIXlt("1999-2-1"),origin=as.POSIXlt("1999-1-1"))
                                             ^
gives error:
Error in julian.POSIXt(as.POSIXlt("1999-2-1"), origin = as.POSIXlt("1999-1-1"))
: 
	'origin' must be of length one

julian(as.POSIXlt("1999-2-1"),origin=as.POSIXct("1999-1-1"))
works perfect!


From marc_schwartz at comcast.net  Thu Sep 13 15:28:00 2007
From: marc_schwartz at comcast.net (Marc Schwartz)
Date: Thu, 13 Sep 2007 08:28:00 -0500
Subject: [Rd] RFE: Add "..." args to barplot()'s xyrect() function calls
Message-ID: <1189690080.6149.14.camel@Bellerophon.localdomain>

Hi all,

In referencing this thread:

  https://stat.ethz.ch/pipermail/r-help/2007-September/140702.html

the current barplot.default() function includes an internal function
called xyrect() to draw the bars.  

The xyrect() function definition provides for "..." args, however the
actual function calls do not include "..." args. Thus any inline graphic
pars specified in the barplot() call are not passed.

A patch file against the current SVN barplot.r is attached to modify the
three locations in which called xyrect() is called to add "..." args to
each.

Thanks,

Marc Schwartz

-------------- next part --------------
A non-text attachment was scrubbed...
Name: barplot.patch
Type: text/x-patch
Size: 1022 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20070913/da5c607d/attachment.bin 

From ernest.turro at ic.ac.uk  Thu Sep 13 17:09:37 2007
From: ernest.turro at ic.ac.uk (Ernest Turro)
Date: Thu, 13 Sep 2007 16:09:37 +0100
Subject: [Rd] Overriding optimisation flags
Message-ID: <A26A3799-7484-42B3-A603-BF53308E8C0D@ic.ac.uk>

Dear all,

If one specifies, say, "PKG_CXXFLAGS= -O3" in a Makevars file, it  
will not make a difference to how the code is compiled if -O2 is  
specified in $R_HOME/etc/Makeconf. This is because PKG_CXXFLAGS is  
prepended to the corresponding flags in $R_HOME/etc/Makeconf instead  
of being appended and gcc only uses the last optimisation flag  
specified. As a result, one has to use targets in Makevars, which  
adds unnecessary complication to the whole process. Would it be  
possible to ensure PKG_CXXFLAGS & co.  are appended instead of  
prepended to the default flags and, if not, is there an easier  
workaround than specifying targets? (targets are easy enough under  
unix, but seems a bit more complicated under windows...)

Thanks!

E


From rgentlem at fhcrc.org  Thu Sep 13 23:44:43 2007
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Thu, 13 Sep 2007 14:44:43 -0700
Subject: [Rd] Jobs in Seattle
Message-ID: <46E9AF4B.9090007@fhcrc.org>

Hi,
   As many of you will realize, Seth is going to be leaving us (pretty 
much immediately).  So we will be looking to replace him. In addition,
Martin Morgan is going to be moving into another role as well, one that 
will require an assistant.  In addition, I am looking for at least one 
post-doc (preferably with an interest in sequence related work).

   If any of these interest you, please check out the job descriptions
at:
    http://www.fhcrc.org/about/jobs/

  and you can get some idea of salary level as well

  You can feel free to ask me about either the lead programmer job, or 
the post doc and should probably direct questions about the 
bioinformatics position to Martin.

   All applications must go through the FHCRC web site.

  thanks
    Robert



-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From sgiannerini at gmail.com  Fri Sep 14 16:48:57 2007
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Fri, 14 Sep 2007 16:48:57 +0200
Subject: [Rd] partial correlation function for multivariate time series
In-Reply-To: <46E6BBCC.5040907@bank-banque-canada.ca>
References: <3c12769c0709100805r4ca5785bq3a932665c82084fd@mail.gmail.com>
	<46E6BBCC.5040907@bank-banque-canada.ca>
Message-ID: <3c12769c0709140748o137cb1ebg66f33d9790014c4d@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070914/577ce955/attachment.pl 

From maj at stats.waikato.ac.nz  Thu Sep 13 23:54:09 2007
From: maj at stats.waikato.ac.nz (maj at stats.waikato.ac.nz)
Date: Fri, 14 Sep 2007 09:54:09 +1200 (NZST)
Subject: [Rd] Reciprocal Mill's Ratio
Message-ID: <1188.203.109.214.126.1189720449.squirrel@webmail.scms.waikato.ac.nz>

I believe that this may be more appropriate here in r-devel than in r-help.

The normal hazard function, or reciprocal Mill's Ratio, may be obtained
in R as dnorm(z)/(1 - pnorm(z)) or, better, as dnorm(z)/pnorm(-z) for
small values of z. The latter formula breaks dowm numerically for me
(running R 2.4.1 under Windows XP 5.1 SP 2) for values of z near 37.4
or greater.

Looking at the pnorm documentation I see that it is based on Cody (1993)
and thence, going one step further back, on Cody (1969). Consulting
Cody (1969) I see that the algorithm for pnorm(z) [or actually erf(z)]
is actually based on rational function approximations for the
reciprocal Mill's ratio itself, as I rather expected.

I wonder if anyone has dug out a function for the reciprocal Mill's
ratio out of the pnorm() code? Anticipating the obvious response I don't
believe that this would be one of the things I might be good at!

Murray Jorgensen

References

Cody, W. D. (1993)
Algorithm 715: SPECFUN ? A portable FORTRAN package of special function
routines and test drivers.
ACM Transactions on Mathematical Software 19, 22?32.

Cody, W. D. (1969)
Rational Chebyshev Approximations for the Error Function
Mathematics of Computation, Vol. 23, No. 107. (Jul., 1969), pp. 631-637.


From dray at biomserv.univ-lyon1.fr  Fri Sep 14 16:27:49 2007
From: dray at biomserv.univ-lyon1.fr (=?ISO-8859-1?Q?St=E9phane_Dray?=)
Date: Fri, 14 Sep 2007 16:27:49 +0200
Subject: [Rd] problems for ./configure on Ralpha: gcc related
Message-ID: <46EA9A65.4050105@biomserv.univ-lyon1.fr>

Dear all,
I am trying to compile Ralpha on my computer (OS = Debian). SVN Revision is:

Revision: 42843
Last Changed Date: 2007-09-14

./configure returns :
----------------------------------------------------
stephane at pcdray:~/Rdev/R-alpha$ ./configure
checking build system type... i686-pc-linux-gnulibc1
checking host system type... i686-pc-linux-gnulibc1
loading site script './config.site'
loading build specific script './config.site'
checking for pwd... /bin/pwd
checking whether builddir is srcdir... yes
checking for working aclocal... found
checking for working autoconf... found
checking for working automake... found
checking for working autoheader... found
checking for gawk... gawk
checking for grep that handles long lines and -e... /bin/grep
checking for egrep... /bin/grep -E
checking whether ln -s works... yes
checking for ranlib... ranlib
checking for bison... bison -y
checking for ar... ar
checking for a BSD-compatible install... /usr/bin/install -c
checking for sed... /bin/sed
checking for less... /usr/bin/less
checking for perl... /usr/bin/perl
checking whether perl version is at least 5.8.0... yes
checking for dvips... /usr/bin/dvips
checking for tex... /usr/bin/tex
checking for latex... /usr/bin/latex
checking for makeindex... /usr/bin/makeindex
checking for pdftex... /usr/bin/pdftex
checking for pdflatex... /usr/bin/pdflatex
checking for makeinfo... /usr/bin/makeinfo
checking whether makeinfo version is at least 4.7... yes
checking for texi2dvi... /usr/bin/texi2dvi
checking for unzip... /usr/bin/unzip
checking for zip... /usr/bin/zip
checking for gzip... /bin/gzip
checking for firefox... /usr/bin/firefox
using default browser ... /usr/bin/firefox
checking for acroread... /usr/bin/acroread
checking for gcc... gcc
checking for C compiler default output file name... configure: error: C 
compiler cannot create executables
See `config.log' for more details.
--------------------------------------------------------------------
gcc  -v returns
Using built-in specs.
Target: i486-linux-gnu
Configured with: ../src/configure -v 
--enable-languages=c,c++,fortran,objc,obj-c++,treelang --prefix=/usr 
--enable-shared --with-system-zlib --libexecdir=/usr/lib 
--without-included-gettext --enable-threads=posix --enable-nls 
--with-gxx-include-dir=/usr/include/c++/4.2 --program-suffix=-4.2 
--enable-clocale=gnu --enable-libstdcxx-debug --enable-mpfr 
--enable-targets=all --disable-werror --enable-checking=release 
--build=i486-linux-gnu --host=i486-linux-gnu --target=i486-linux-gnu
Thread model: posix
gcc version 4.2.1 (Debian 4.2.1-3)

and in the config.log, I have:
.....
configure:4596: checking for gcc
configure:4612: found /usr/bin/gcc
configure:4623: result: gcc
configure:4861: checking for C compiler version
configure:4868: gcc --version >&5
gcc (GCC) 4.2.1 (Debian 4.2.1-3)
Copyright (C) 2007 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

configure:4871: $? = 0
configure:4878: gcc -v >&5
Using built-in specs.
Target: i486-linux-gnu
Configured with: ../src/configure -v 
--enable-languages=c,c++,fortran,objc,obj-c++,treelang --prefix=/usr 
--enable-shared --with-system-zlib --libexecdir=/usr/lib 
--without-included-gettext --enable-threads=posix --enable-nls 
--with-gxx-include-dir=/usr/include/c++/4.2 --program-suffix=-4.2 
--enable-clocale=gnu --enable-libstdcxx-debug --enable-mpfr 
--enable-targets=all --disable-werror --enable-checking=release 
--build=i486-linux-gnu --host=i486-linux-gnu --target=i486-linux-gnu
Thread model: posix
gcc version 4.2.1 (Debian 4.2.1-3)
configure:4881: $? = 0
configure:4888: gcc -V >&5
gcc: '-V' option must have argument
configure:4891: $? = 1
configure:4914: checking for C compiler default output file name
configure:4941: gcc  -I/usr/local/include -L/usr/local/lib conftest.c  >&5
/usr/bin/ld: crt1.o: No such file: No such file or directory
collect2: ld returned 1 exit status
configure:4944: $? = 1
configure: failed program was:
| /* confdefs.h.  */
| #define PACKAGE_NAME "R"
| #define PACKAGE_TARNAME "R"
| #define PACKAGE_VERSION "2.6.0"
| #define PACKAGE_STRING "R 2.6.0"
| #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
| #define PACKAGE "R"
| #define VERSION "2.6.0"
| #define R_PLATFORM "i686-pc-linux-gnulibc1"
| #define R_CPU "i686"
| #define R_VENDOR "pc"
| #define R_OS "linux-gnulibc1"
| #define Unix 1
| #define R_ARCH ""
| /* end confdefs.h.  */
|
| int
| main ()
| {
|
|   ;
|   return 0;
| }
configure:4983: error: C compiler cannot create executables
See `config.log' for more details.
...............

I did not understand what is the problem. Any idea ?

Thanks in advances,

Sincerely.


-- 

St?phane DRAY (dray at biomserv.univ-lyon1.fr )
Laboratoire BBE-CNRS-UMR-5558, Univ. C. Bernard - Lyon I
43, Bd du 11 Novembre 1918, 69622 Villeurbanne Cedex, France
Tel: 33 4 72 43 27 57       Fax: 33 4 72 43 13 88
http://biomserv.univ-lyon1.fr/~dray/


From sgiannerini at gmail.com  Fri Sep 14 17:20:56 2007
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Fri, 14 Sep 2007 17:20:56 +0200
Subject: [Rd] Reciprocal Mill's Ratio
In-Reply-To: <1188.203.109.214.126.1189720449.squirrel@webmail.scms.waikato.ac.nz>
References: <1188.203.109.214.126.1189720449.squirrel@webmail.scms.waikato.ac.nz>
Message-ID: <3c12769c0709140820u5248e3aby970c0e6e049537a7@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070914/a0191fe9/attachment.pl 

From simon.urbanek at r-project.org  Fri Sep 14 17:33:57 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 14 Sep 2007 11:33:57 -0400
Subject: [Rd] problems for ./configure on Ralpha: gcc related
In-Reply-To: <46EA9A65.4050105@biomserv.univ-lyon1.fr>
References: <46EA9A65.4050105@biomserv.univ-lyon1.fr>
Message-ID: <FE24A6F1-A4AF-41D6-91E9-704DF360D824@r-project.org>

St?phane,

the problem is that your compiler doesn't work (as the message  
clearly tells you). You must have working compiler (and other  
development tools) before you try compiling R.

I have no clue how you managed to get such a broken compiler, because  
Debian comes with a complete, working compiler suite ... you should  
fix your OS in the first place ...

BTW according to Google Ralpha is a "Russian American Space  
Cooperation", so I wonder how you got it on your computer in the  
first place ;)

Cheers,
Simon


On Sep 14, 2007, at 10:27 AM, St?phane Dray wrote:

> Dear all,
> I am trying to compile Ralpha on my computer (OS = Debian). SVN  
> Revision is:
>
> Revision: 42843
> Last Changed Date: 2007-09-14
>
> ./configure returns :
> ----------------------------------------------------
> stephane at pcdray:~/Rdev/R-alpha$ ./configure
> checking build system type... i686-pc-linux-gnulibc1
> checking host system type... i686-pc-linux-gnulibc1
> loading site script './config.site'
> loading build specific script './config.site'
> checking for pwd... /bin/pwd
> checking whether builddir is srcdir... yes
> checking for working aclocal... found
> checking for working autoconf... found
> checking for working automake... found
> checking for working autoheader... found
> checking for gawk... gawk
> checking for grep that handles long lines and -e... /bin/grep
> checking for egrep... /bin/grep -E
> checking whether ln -s works... yes
> checking for ranlib... ranlib
> checking for bison... bison -y
> checking for ar... ar
> checking for a BSD-compatible install... /usr/bin/install -c
> checking for sed... /bin/sed
> checking for less... /usr/bin/less
> checking for perl... /usr/bin/perl
> checking whether perl version is at least 5.8.0... yes
> checking for dvips... /usr/bin/dvips
> checking for tex... /usr/bin/tex
> checking for latex... /usr/bin/latex
> checking for makeindex... /usr/bin/makeindex
> checking for pdftex... /usr/bin/pdftex
> checking for pdflatex... /usr/bin/pdflatex
> checking for makeinfo... /usr/bin/makeinfo
> checking whether makeinfo version is at least 4.7... yes
> checking for texi2dvi... /usr/bin/texi2dvi
> checking for unzip... /usr/bin/unzip
> checking for zip... /usr/bin/zip
> checking for gzip... /bin/gzip
> checking for firefox... /usr/bin/firefox
> using default browser ... /usr/bin/firefox
> checking for acroread... /usr/bin/acroread
> checking for gcc... gcc
> checking for C compiler default output file name... configure:  
> error: C
> compiler cannot create executables
> See `config.log' for more details.
> --------------------------------------------------------------------
> gcc  -v returns
> Using built-in specs.
> Target: i486-linux-gnu
> Configured with: ../src/configure -v
> --enable-languages=c,c++,fortran,objc,obj-c++,treelang --prefix=/usr
> --enable-shared --with-system-zlib --libexecdir=/usr/lib
> --without-included-gettext --enable-threads=posix --enable-nls
> --with-gxx-include-dir=/usr/include/c++/4.2 --program-suffix=-4.2
> --enable-clocale=gnu --enable-libstdcxx-debug --enable-mpfr
> --enable-targets=all --disable-werror --enable-checking=release
> --build=i486-linux-gnu --host=i486-linux-gnu --target=i486-linux-gnu
> Thread model: posix
> gcc version 4.2.1 (Debian 4.2.1-3)
>
> and in the config.log, I have:
> .....
> configure:4596: checking for gcc
> configure:4612: found /usr/bin/gcc
> configure:4623: result: gcc
> configure:4861: checking for C compiler version
> configure:4868: gcc --version >&5
> gcc (GCC) 4.2.1 (Debian 4.2.1-3)
> Copyright (C) 2007 Free Software Foundation, Inc.
> This is free software; see the source for copying conditions.   
> There is NO
> warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR  
> PURPOSE.
>
> configure:4871: $? = 0
> configure:4878: gcc -v >&5
> Using built-in specs.
> Target: i486-linux-gnu
> Configured with: ../src/configure -v
> --enable-languages=c,c++,fortran,objc,obj-c++,treelang --prefix=/usr
> --enable-shared --with-system-zlib --libexecdir=/usr/lib
> --without-included-gettext --enable-threads=posix --enable-nls
> --with-gxx-include-dir=/usr/include/c++/4.2 --program-suffix=-4.2
> --enable-clocale=gnu --enable-libstdcxx-debug --enable-mpfr
> --enable-targets=all --disable-werror --enable-checking=release
> --build=i486-linux-gnu --host=i486-linux-gnu --target=i486-linux-gnu
> Thread model: posix
> gcc version 4.2.1 (Debian 4.2.1-3)
> configure:4881: $? = 0
> configure:4888: gcc -V >&5
> gcc: '-V' option must have argument
> configure:4891: $? = 1
> configure:4914: checking for C compiler default output file name
> configure:4941: gcc  -I/usr/local/include -L/usr/local/lib  
> conftest.c  >&5
> /usr/bin/ld: crt1.o: No such file: No such file or directory
> collect2: ld returned 1 exit status
> configure:4944: $? = 1
> configure: failed program was:
> | /* confdefs.h.  */
> | #define PACKAGE_NAME "R"
> | #define PACKAGE_TARNAME "R"
> | #define PACKAGE_VERSION "2.6.0"
> | #define PACKAGE_STRING "R 2.6.0"
> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
> | #define PACKAGE "R"
> | #define VERSION "2.6.0"
> | #define R_PLATFORM "i686-pc-linux-gnulibc1"
> | #define R_CPU "i686"
> | #define R_VENDOR "pc"
> | #define R_OS "linux-gnulibc1"
> | #define Unix 1
> | #define R_ARCH ""
> | /* end confdefs.h.  */
> |
> | int
> | main ()
> | {
> |
> |   ;
> |   return 0;
> | }
> configure:4983: error: C compiler cannot create executables
> See `config.log' for more details.
> ...............
>
> I did not understand what is the problem. Any idea ?
>
> Thanks in advances,
>
> Sincerely.
>
>
> -- 
>
> St?phane DRAY (dray at biomserv.univ-lyon1.fr )
> Laboratoire BBE-CNRS-UMR-5558, Univ. C. Bernard - Lyon I
> 43, Bd du 11 Novembre 1918, 69622 Villeurbanne Cedex, France
> Tel: 33 4 72 43 27 57       Fax: 33 4 72 43 13 88
> http://biomserv.univ-lyon1.fr/~dray/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From pgilbert at bank-banque-canada.ca  Fri Sep 14 17:50:35 2007
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 14 Sep 2007 11:50:35 -0400
Subject: [Rd] partial correlation function for multivariate time series
In-Reply-To: <3c12769c0709140748o137cb1ebg66f33d9790014c4d@mail.gmail.com>
References: <3c12769c0709100805r4ca5785bq3a932665c82084fd@mail.gmail.com>	
	<46E6BBCC.5040907@bank-banque-canada.ca>
	<3c12769c0709140748o137cb1ebg66f33d9790014c4d@mail.gmail.com>
Message-ID: <46EAADCB.20305@bank-banque-canada.ca>

Simone Giannerini wrote:
> Dear Paul,
> 
> there is no mention to the pacf in the multivariate setting in the book 
> you suggested.

My apologies, I should have looked more carefully and realized the pacf 
discussion in Granger and Newbold is all univariate.

> As I mentioned in private I suspect that pacf() in the multivariate case 
> computes the
> partial autoregression matrix (in the terminology of Reinsel) rather 
> than the partial autocorrelation matrix

It looks like pacf() uses the calculation in stats:::ar.yw.default , so 
roughly sounds consistent with what you say. I do think parts of this 
code pre-date Reisel's book, so inconsistency with his book would 
probably be imperfect foresight.

BTW, I think bug reports with suggested fixes are usually more useful. 
And, at the very least, it seems the references in the documentation 
could be improved.

Paul Gilbert

> as the two coincide in the univariate case but are different in the 
> multivariate case as stated explicitly
> in Reisel (Sec. 3.3).
> This would explain the coefficients well above 1 (in modulus) in the 
> example I have given.
> To support my statement you can fit A VAR model to the data and compare 
> the coefficients with the results
> from pacf():
> 
> set.seed(10)
> x <- rnorm(1000,sd=10000)
> y <- rnorm(1000,sd=1)
> 
> library(vars);
> mod1 <- VAR(ts(cbind(x,y)),p=4,type="none"); # fit a VAR (OLS)
> 
> ## Have a look at estimated coefficients
> 
>>  noquote(formatC(mod1$varresult$x$coefficients,format="f"))
> ## Edited by me, compare with the first column of the results below from 
> the pacf (pacf(....)$acf[,1,])
>      x.l1     x.l2    x.l3    x.l4   
>      0.047    0.013   0.004   0.014
>      y.l1     y.l2    y.l3    y.l4  
>      374.117  72.758 -526.452 126.610
>>  noquote(formatC(mod1$varresult$y$coefficients,format="f"))
> ## Edited by me, compare with the second column of the results below 
> from the pacf (pacf(....)$acf[,2,])
>      x.l1    x.l2     x.l3    x.l4 
>      0.000   -0.000   0.000   0.000 
>      y.l1    y.l2     y.l3    y.l4
>     -0.046   -0.025  -0.033  -0.020
> 
> pacf(ts(cbind(x,y)),plot=FALSE,lag.max=4)
> 
> Partial autocorrelations of series 'ts(cbind(x, y))', by lag
> 
> , , x
> 
>  x             y           
>     0.047 ( 1)    0.000 (-1)
>     0.011 ( 2)    0.000 (-2)
>     0.005 ( 3)    0.000 (-3)
>     0.013 ( 4)    0.000 (-4)
> 
> , , y
> 
>  x             y           
>   374.052 ( 1)   -0.045 ( 1)
>    66.717 ( 2)   -0.024 ( 2)
>  -535.810 ( 3)   -0.031 ( 3)
>   120.802 ( 4)   -0.020 ( 4)
>  
> As you can see the coefficients fairly agree.
> I might file a bug report in some days unless someone will prove me 
> wrong before.
> 
> Regards,
> 
> Simone
> 
> 
> 
> On 11/09/2007, *Paul Gilbert* <pgilbert at bank-banque-canada.ca 
> <mailto:pgilbert at bank-banque-canada.ca>> wrote:
> 
>     I think the reference for pacf is
> 
>     @BOOK{GraNew77,
>        author =    {Granger, C. W. J. and Newbold, Paul},
>        title =     {Forecasting Economic Time Series},
>        publisher = {Academic Press},
>        year =      1977
>        }
> 
>     It certainly would not be Reisel's book, as parts of the code predate
>     that by many years.
> 
>     Paul Gilbert
> 
>     Simone Giannerini wrote:
>      > Dear all,
>      >
>      > I found the following behaviour with pacf() in the multivariate
>     case,
>      >
>      > set.seed(10)
>      > x <- rnorm(1000,sd=10000)
>      > y <- rnorm(1000,sd=1)
>      > pacf(ts(cbind(x,y)),plot=FALSE,lag.max=10)
>      >
>      > Partial autocorrelations of series 'cbind(x, y)', by lag
>      >
>      > , , x
>      >
>      >  x              y
>      >     0.047 (  1)    0.000 ( -1)
>      >     0.011 (  2)    0.000 ( -2)
>      >     0.005 (  3)    0.000 ( -3)
>      >     0.013 (  4)    0.000 ( -4)
>      >     0.050 (  5)    0.000 ( -5)
>      >     0.034 (  6)    0.000 ( -6)
>      >     0.026 (  7)    0.000 ( -7)
>      >    -0.029 (  8)    0.000 ( -8)
>      >    -0.010 (  9)    0.000 ( -9)
>      >    -0.013 ( 10)    0.000 (-10)
>      >
>      > , , y
>      >
>      >  x              y
>      >   374.052 (  1)   -0.045 (  1)
>      >    66.717 (  2)   -0.024 (  2)
>      >  -535.810 (  3)   -0.031 (  3)
>      >   120.802 (  4)   -0.020 (  4)
>      >   142.824 (  5)    0.004 (  5)
>      >  -211.711 (  6)   -0.010 (  6)
>      >   201.856 (  7)    0.058 (  7)
>      >   286.079 (  8)   -0.035 (  8)
>      >  -134.057 (  9)    0.032 (  9)
>      >   -18.200 ( 10)    0.019 ( 10)
>      >
>      > Since there are multiple ways of defining the pacf for
>     multivariate time
>      > series
>      > (see e.g. G.C. Reinsel, Elements of multivariate time series
>     analysis, II
>      > edition, Springer, section 3.3) and given that
>      > in ?pacf there is no reference to articles or books regarding its
>      > computation
>      > I do not know whether this behaviour is expected or it is a bug
>     instead.
>      > In the first case could you provide a reference for it? In the
>     second case I
>      > might file a bug report.
>      > Thank you for the great work you are doing for the scientific
>     community.
>      >
>      > kind regards,
>      >
>      > Simone Giannerini
>      >
>      > WINDOWS
>      >
>      > platform       i386-pc-mingw32
>      > arch           i386
>      > os             mingw32
>      > system         i386, mingw32
>      > status
>      > major          2
>      > minor          5.1
>      > year           2007
>      > month          06
>      > day            27
>      > svn rev        42083
>      > language       R
>      > version.string R version 2.5.1 (2007-06-27)
>      >
>      > LINUX
>      >
>      >
>      >>R.Version()
>      >
>      > $platform
>      > [1] "x86_64-unknown-linux-gnu"
>      >
>      > $arch
>      > [1] "x86_64"
>      >
>      > $os
>      > [1] "linux-gnu"
>      >
>      > $system
>      > [1] "x86_64, linux-gnu"
>      >
>      > $status
>      > [1] ""
>      >
>      > $major
>      > [1] "2"
>      >
>      > $minor
>      > [1] "5.1"
>      >
>      > $year
>      > [1] "2007"
>      >
>      > $month
>      > [1] "06"
>      >
>      > $day
>      > [1] "27"
>      >
>      > $`svn rev`
>      > [1] "42083"
>      >
>      > $language
>      > [1] "R"
>      >
>      > $version.string
>      > [1] "R version 2.5.1 (2007-06-27)"
>     ====================================================================================
> 
>     La version fran?aise suit le texte anglais.
> 
>     ------------------------------------------------------------------------------------
> 
> 
>     This email may contain privileged and/or confidential information,
>     and the Bank of
>     Canada does not waive any related rights. Any distribution, use, or
>     copying of this
>     email or the information it contains by other than the intended
>     recipient is
>     unauthorized. If you received this email in error please delete it
>     immediately from
>     your system and notify the sender promptly by email that you have
>     done so.
> 
>     ------------------------------------------------------------------------------------
> 
> 
>     Le pr?sent courriel peut contenir de l'information privil?gi?e ou
>     confidentielle.
>     La Banque du Canada ne renonce pas aux droits qui s'y rapportent.
>     Toute diffusion,
>     utilisation ou copie de ce courriel ou des renseignements qu'il
>     contient par une
>     personne autre que le ou les destinataires d?sign?s est interdite.
>     Si vous recevez
>     ce courriel par erreur, veuillez le supprimer imm?diatement et
>     envoyer sans d?lai ?
>     l'exp?diteur un message ?lectronique pour l'aviser que vous avez
>     ?limin? de votre
>     ordinateur toute copie du courriel re?u.
> 
> 
> 
> 
> -- 
> ______________________________________________________
> 
> Simone Giannerini
> Dipartimento di Scienze Statistiche "Paolo Fortunati"
> Universita' di Bologna
> Via delle belle arti 41 - 40126  Bologna,  ITALY
> Tel: +39 051 2098262  Fax: +39 051 232153
> http://www2.stat.unibo.it/giannerini/
> ______________________________________________________
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From edd at debian.org  Fri Sep 14 17:57:05 2007
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 14 Sep 2007 10:57:05 -0500
Subject: [Rd] problems for ./configure on Ralpha: gcc related
In-Reply-To: <46EA9A65.4050105@biomserv.univ-lyon1.fr>
References: <46EA9A65.4050105@biomserv.univ-lyon1.fr>
Message-ID: <18154.44881.152261.98585@ron.nulle.part>


Salut St?phane, 

On 14 September 2007 at 16:27, St?phane Dray wrote:
| Dear all,
| I am trying to compile Ralpha on my computer (OS = Debian). SVN Revision is:
| 
| Revision: 42843
| Last Changed Date: 2007-09-14

Revision 2007-09-10 without a hitch and is in Debian unstable, see

	http://buildd.debian.org/build.php?pkg=r-base

for the build logs (and my embarassing three revisions to get r-cran.mk [ for
r-cran-* packages ] right).

So if I were you I'd start with (assuming you point to Debian 'sid' aka
unstable)

	# apt-get update     
	# apt-get build-dep r-base

to make sure you you have all required packages.  You could also rebuild from
my sources via

	# apt-get source r-base

or simple install the three-day old binary.

FWIW I also just rebuilt from these sources on Ubuntu Feisty at work (where
you need to adjust debian/rules and debian/control as they do not have
gcc/g++ 4.2 yet).

Hope this helps, feel free to ask Debian questions on r-sig-debian.

Cheers, Dirk

-- 
Three out of two people have difficulties with fractions.


From sgiannerini at gmail.com  Fri Sep 14 18:00:38 2007
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Fri, 14 Sep 2007 18:00:38 +0200
Subject: [Rd] partial correlation function for multivariate time series
In-Reply-To: <46EAADCB.20305@bank-banque-canada.ca>
References: <3c12769c0709100805r4ca5785bq3a932665c82084fd@mail.gmail.com>
	<46E6BBCC.5040907@bank-banque-canada.ca>
	<3c12769c0709140748o137cb1ebg66f33d9790014c4d@mail.gmail.com>
	<46EAADCB.20305@bank-banque-canada.ca>
Message-ID: <3c12769c0709140900v413094a3r54eb76f7a7883d13@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070914/7bacc946/attachment.pl 

From cberry at tajo.ucsd.edu  Fri Sep 14 19:18:06 2007
From: cberry at tajo.ucsd.edu (Charles C. Berry)
Date: Fri, 14 Sep 2007 10:18:06 -0700
Subject: [Rd] Reciprocal Mill's Ratio
In-Reply-To: <1188.203.109.214.126.1189720449.squirrel@webmail.scms.waikato.ac.nz>
References: <1188.203.109.214.126.1189720449.squirrel@webmail.scms.waikato.ac.nz>
Message-ID: <Pine.LNX.4.64.0709141014500.3451@tajo.ucsd.edu>

On Fri, 14 Sep 2007, maj at stats.waikato.ac.nz wrote:

> I believe that this may be more appropriate here in r-devel than in r-help.
>
> The normal hazard function, or reciprocal Mill's Ratio, may be obtained
> in R as dnorm(z)/(1 - pnorm(z)) or, better, as dnorm(z)/pnorm(-z) for
> small values of z. The latter formula breaks dowm numerically for me
> (running R 2.4.1 under Windows XP 5.1 SP 2) for values of z near 37.4
> or greater.


OK,

> mr <- function(z )dnorm( z )/ ( pnorm(z,lower=FALSE) )
> mr.2 <- function(z) exp(dnorm( z, log=TRUE ) - (pnorm(z, lower=FALSE, log=TRUE )))
>
> mr(seq(10,100,by=10)) # breaks before 40
  [1] 10.09809 20.04975 30.03326      NaN      NaN      NaN      NaN      NaN      NaN      NaN
>
> mr.2(seq(10,100,by=10)) #seems robust
  [1]  10.09809  20.04975  30.03326  40.02497  50.01998  60.01666  70.01428  80.01250  90.01111 100.01000
> 
>
> mr.2(1e4)
[1] 10000
> mr.2(1e5)
[1] 99999.97
> mr.2(1e6)
[1] 999980.2
> mr.2(1e7)
[1] 9990923
> mr.2(1e8) # Oh well!
[1] 65659969
>

I guess you get large than 1e4, you should just use the asymptotic result.

HTH,

Chuck


>
> Looking at the pnorm documentation I see that it is based on Cody (1993)
> and thence, going one step further back, on Cody (1969). Consulting
> Cody (1969) I see that the algorithm for pnorm(z) [or actually erf(z)]
> is actually based on rational function approximations for the
> reciprocal Mill's ratio itself, as I rather expected.
>
> I wonder if anyone has dug out a function for the reciprocal Mill's
> ratio out of the pnorm() code? Anticipating the obvious response I don't
> believe that this would be one of the things I might be good at!
>
> Murray Jorgensen
>
> References
>
> Cody, W. D. (1993)
> Algorithm 715: SPECFUN ? A portable FORTRAN package of special function
> routines and test drivers.
> ACM Transactions on Mathematical Software 19, 22?32.
>
> Cody, W. D. (1969)
> Rational Chebyshev Approximations for the Error Function
> Mathematics of Computation, Vol. 23, No. 107. (Jul., 1969), pp. 631-637.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Charles C. Berry                            (858) 534-2098
                                             Dept of Family/Preventive Medicine
E mailto:cberry at tajo.ucsd.edu	            UC San Diego
http://famprevmed.ucsd.edu/faculty/cberry/  La Jolla, San Diego 92093-0901


From hin-tak.leung at cimr.cam.ac.uk  Fri Sep 14 21:28:14 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Fri, 14 Sep 2007 20:28:14 +0100
Subject: [Rd] problems for ./configure on Ralpha: gcc related
In-Reply-To: <46EA9A65.4050105@biomserv.univ-lyon1.fr>
References: <46EA9A65.4050105@biomserv.univ-lyon1.fr>
Message-ID: <46EAE0CE.2030105@cimr.cam.ac.uk>

St?phane Dray wrote:
> Dear all,
> I am trying to compile Ralpha on my computer (OS = Debian). SVN Revision is:
> 
> Revision: 42843
> Last Changed Date: 2007-09-14
> 
> ./configure returns :
<snipped>

> checking for C compiler default output file name... configure: error: C 
> compiler cannot create executables
> See `config.log' for more details.
<snipped>

> configure:4941: gcc  -I/usr/local/include -L/usr/local/lib conftest.c  >&5
> /usr/bin/ld: crt1.o: No such file: No such file or directory
> collect2: ld returned 1 exit status
<snipped>

The error message is as it says - crt1.o not found. It is located in 
/usr/lib/ or /usr/lib64 usually, and is part of the glibc-devel package
on redhat or rpm based systems, and probably has a similiar name on
Debian (although they have a funny way of mincing and separating 
packages into sub-packages unnecessarily, but I digress...).

My suggestion would be to apt-get any debian packages which says 
glibc-*, particularly glibc-*-dev-* .

HTL


From dray at biomserv.univ-lyon1.fr  Fri Sep 14 17:49:46 2007
From: dray at biomserv.univ-lyon1.fr (=?ISO-8859-1?Q?St=E9phane_Dray?=)
Date: Fri, 14 Sep 2007 17:49:46 +0200
Subject: [Rd] problems for ./configure on Ralpha: gcc related
In-Reply-To: <FE24A6F1-A4AF-41D6-91E9-704DF360D824@r-project.org>
References: <46EA9A65.4050105@biomserv.univ-lyon1.fr>
	<FE24A6F1-A4AF-41D6-91E9-704DF360D824@r-project.org>
Message-ID: <46EAAD9A.90507@biomserv.univ-lyon1.fr>

Thanks Simon,

My gcc seemed to work... but I found the problem: I have to install 
libc6-dev and after I have to install g++
Now it works, I have make R without problems.

Cheers,


Simon Urbanek wrote:
> St?phane,
>
> the problem is that your compiler doesn't work (as the message clearly 
> tells you). You must have working compiler (and other development 
> tools) before you try compiling R.
>
> I have no clue how you managed to get such a broken compiler, because 
> Debian comes with a complete, working compiler suite ... you should 
> fix your OS in the first place ...
>
> BTW according to Google Ralpha is a "Russian American Space 
> Cooperation", so I wonder how you got it on your computer in the first 
> place ;)
>
> Cheers,
> Simon
>
>
> On Sep 14, 2007, at 10:27 AM, St?phane Dray wrote:
>
>> Dear all,
>> I am trying to compile Ralpha on my computer (OS = Debian). SVN 
>> Revision is:
>>
>> Revision: 42843
>> Last Changed Date: 2007-09-14
>>
>> ./configure returns :
>> ----------------------------------------------------
>> stephane at pcdray:~/Rdev/R-alpha$ ./configure
>> checking build system type... i686-pc-linux-gnulibc1
>> checking host system type... i686-pc-linux-gnulibc1
>> loading site script './config.site'
>> loading build specific script './config.site'
>> checking for pwd... /bin/pwd
>> checking whether builddir is srcdir... yes
>> checking for working aclocal... found
>> checking for working autoconf... found
>> checking for working automake... found
>> checking for working autoheader... found
>> checking for gawk... gawk
>> checking for grep that handles long lines and -e... /bin/grep
>> checking for egrep... /bin/grep -E
>> checking whether ln -s works... yes
>> checking for ranlib... ranlib
>> checking for bison... bison -y
>> checking for ar... ar
>> checking for a BSD-compatible install... /usr/bin/install -c
>> checking for sed... /bin/sed
>> checking for less... /usr/bin/less
>> checking for perl... /usr/bin/perl
>> checking whether perl version is at least 5.8.0... yes
>> checking for dvips... /usr/bin/dvips
>> checking for tex... /usr/bin/tex
>> checking for latex... /usr/bin/latex
>> checking for makeindex... /usr/bin/makeindex
>> checking for pdftex... /usr/bin/pdftex
>> checking for pdflatex... /usr/bin/pdflatex
>> checking for makeinfo... /usr/bin/makeinfo
>> checking whether makeinfo version is at least 4.7... yes
>> checking for texi2dvi... /usr/bin/texi2dvi
>> checking for unzip... /usr/bin/unzip
>> checking for zip... /usr/bin/zip
>> checking for gzip... /bin/gzip
>> checking for firefox... /usr/bin/firefox
>> using default browser ... /usr/bin/firefox
>> checking for acroread... /usr/bin/acroread
>> checking for gcc... gcc
>> checking for C compiler default output file name... configure: error: C
>> compiler cannot create executables
>> See `config.log' for more details.
>> --------------------------------------------------------------------
>> gcc  -v returns
>> Using built-in specs.
>> Target: i486-linux-gnu
>> Configured with: ../src/configure -v
>> --enable-languages=c,c++,fortran,objc,obj-c++,treelang --prefix=/usr
>> --enable-shared --with-system-zlib --libexecdir=/usr/lib
>> --without-included-gettext --enable-threads=posix --enable-nls
>> --with-gxx-include-dir=/usr/include/c++/4.2 --program-suffix=-4.2
>> --enable-clocale=gnu --enable-libstdcxx-debug --enable-mpfr
>> --enable-targets=all --disable-werror --enable-checking=release
>> --build=i486-linux-gnu --host=i486-linux-gnu --target=i486-linux-gnu
>> Thread model: posix
>> gcc version 4.2.1 (Debian 4.2.1-3)
>>
>> and in the config.log, I have:
>> .....
>> configure:4596: checking for gcc
>> configure:4612: found /usr/bin/gcc
>> configure:4623: result: gcc
>> configure:4861: checking for C compiler version
>> configure:4868: gcc --version >&5
>> gcc (GCC) 4.2.1 (Debian 4.2.1-3)
>> Copyright (C) 2007 Free Software Foundation, Inc.
>> This is free software; see the source for copying conditions.  There 
>> is NO
>> warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR 
>> PURPOSE.
>>
>> configure:4871: $? = 0
>> configure:4878: gcc -v >&5
>> Using built-in specs.
>> Target: i486-linux-gnu
>> Configured with: ../src/configure -v
>> --enable-languages=c,c++,fortran,objc,obj-c++,treelang --prefix=/usr
>> --enable-shared --with-system-zlib --libexecdir=/usr/lib
>> --without-included-gettext --enable-threads=posix --enable-nls
>> --with-gxx-include-dir=/usr/include/c++/4.2 --program-suffix=-4.2
>> --enable-clocale=gnu --enable-libstdcxx-debug --enable-mpfr
>> --enable-targets=all --disable-werror --enable-checking=release
>> --build=i486-linux-gnu --host=i486-linux-gnu --target=i486-linux-gnu
>> Thread model: posix
>> gcc version 4.2.1 (Debian 4.2.1-3)
>> configure:4881: $? = 0
>> configure:4888: gcc -V >&5
>> gcc: '-V' option must have argument
>> configure:4891: $? = 1
>> configure:4914: checking for C compiler default output file name
>> configure:4941: gcc  -I/usr/local/include -L/usr/local/lib 
>> conftest.c  >&5
>> /usr/bin/ld: crt1.o: No such file: No such file or directory
>> collect2: ld returned 1 exit status
>> configure:4944: $? = 1
>> configure: failed program was:
>> | /* confdefs.h.  */
>> | #define PACKAGE_NAME "R"
>> | #define PACKAGE_TARNAME "R"
>> | #define PACKAGE_VERSION "2.6.0"
>> | #define PACKAGE_STRING "R 2.6.0"
>> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
>> | #define PACKAGE "R"
>> | #define VERSION "2.6.0"
>> | #define R_PLATFORM "i686-pc-linux-gnulibc1"
>> | #define R_CPU "i686"
>> | #define R_VENDOR "pc"
>> | #define R_OS "linux-gnulibc1"
>> | #define Unix 1
>> | #define R_ARCH ""
>> | /* end confdefs.h.  */
>> |
>> | int
>> | main ()
>> | {
>> |
>> |   ;
>> |   return 0;
>> | }
>> configure:4983: error: C compiler cannot create executables
>> See `config.log' for more details.
>> ...............
>>
>> I did not understand what is the problem. Any idea ?
>>
>> Thanks in advances,
>>
>> Sincerely.
>>
>>
>> -- 
>> St?phane DRAY (dray at biomserv.univ-lyon1.fr )
>> Laboratoire BBE-CNRS-UMR-5558, Univ. C. Bernard - Lyon I
>> 43, Bd du 11 Novembre 1918, 69622 Villeurbanne Cedex, France
>> Tel: 33 4 72 43 27 57       Fax: 33 4 72 43 13 88
>> http://biomserv.univ-lyon1.fr/~dray/
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
>
>
>


-- 
St?phane DRAY (dray at biomserv.univ-lyon1.fr )
Laboratoire BBE-CNRS-UMR-5558, Univ. C. Bernard - Lyon I
43, Bd du 11 Novembre 1918, 69622 Villeurbanne Cedex, France
Tel: 33 4 72 43 27 57       Fax: 33 4 72 43 13 88
http://biomserv.univ-lyon1.fr/~dray/


From therneau at mayo.edu  Fri Sep 14 19:22:17 2007
From: therneau at mayo.edu (Terry Therneau)
Date: Fri, 14 Sep 2007 12:22:17 -0500 (CDT)
Subject: [Rd] Date vs date
Message-ID: <200709141722.l8EHMHF02634@hsrnfs-101.mayo.edu>

 I wrote the date package long ago, and it has been useful.  In my current task 
of reunifying the R (Tom Lumley) and Splus (me) code trees for survival, I'm 
removing the explicit dependence on 'date' objects from the expected survival 
routines so that they better integrate.   Comparison of 'date' to 'Date' has 
raised a couple of questions.
 
  Clearly Date is more mature -- more options for conversion, better plotting, 
etc (a long list of etc).  I see three things where date is better.  Only the 
last of these really matters, and is the point on which I would like comment.  
(Well, actually I'd like to talk you all into a change, of course).
  
  1. Since date uses 1/1/1960 as the base, and so does SAS, those of us who 
contantly pass files back and forth between those two packages have a slightly 
easier time.

  2. as.date(10) works, as.Date(10) does not.  Sometimes I have done a 
manipluation that the date package does not understand, and I know that the 
result is still of the right type, but the package does not.  However, this is 
fairly rare and I can work around it. (It mostly occurs in processing the rate 
tables for expected survival).
  
  3. temp <- as.Date('1990/1/1') - as.date('1953/2/5')
     sqrt(temp)
     Error in Math.difftime(temp3) : sqrtnot defined for "difftime" objects

  Minor bug: no space before the word 'not'
  Major: this shouldn't fail.  

People will do things with time intervals that you have not thought of.  Fitting 
a growth curve that uses a square root, for instance.  I firmly believe that the 
superior behavior in the face of something unexpected is to assume that the user 
knows what they are doing, and return a numeric.  
   I recognize that "assume the user knows what they are doing" is an anathema 
to the more zealous OO types, but in designing a class I have found that they 
often know more than me!
   
   4. Variation on #3 above
   
> (as.Date('2007-9-14') - as.Date('1953-3-10')) / 365.25
  Time difference of 54.51335 days
   
    No, I am not 54.5 days old.  Both hair color and knee creaking most 
definitely proclaim otherwise, I am sorry to say. Time difference / number 
should be a number.  
    
   5. This is only amusing.  Im not saying that as.Date should necessarily work, 
but the format is certainly not ambiguous.  (Not standard, but not ambiguous).
Not important to fix, not something that date does any better.

> as.Date('09Sep2007')
Error in fromchar(x) : character string is not in a standard unambiguous format
 


   	Terry Therneau


From Daniel.Gerlanc at geodecapital.com  Fri Sep 14 22:52:14 2007
From: Daniel.Gerlanc at geodecapital.com (Gerlanc, Daniel)
Date: Fri, 14 Sep 2007 16:52:14 -0400
Subject: [Rd] Building an R GUI using gWidgets and RGtk2
Message-ID: <3FA056EFB6415D41A622AF40227D29D00131E43F@MSGMROCLN2WIN.DMN1.FMR.COM>

Hello,

I'm developing a GUI in R that will be used to monitor financial
portfolio performance.  The GUI will be distributed as an R package.  So
far, I've decided to use the "cairoDevice", "RGtk2", "gWidgets", and
"gWidgetsRGtk2" packages to develop the GUI.  I am trying to decide what
would be the best way to structure the GUI would be.

I've considered 3 approaches to building the GUI.  The first would be to
use S4 classes.  I would create parent "gui" object that would store
widgets or containers in slots.  Other more specialized guis for
different purposes would extend this parent "gui" object.  The
difficulty in this approach is R's use of pass-by-value.  Once the gui
object has been created, changing any of the slots of the gui requires
returning a new GUI object or saving one off in a higher level
environment and editing the slots directly.  Editing the slots directly
would completely bypass the S4 method dispatch.

Another approach would be more functional.  I would create variables
that are global within the package or in their own environment and
define the package function closures within this environment.  This
could work, but the code could get noisy when calls to have be made to
distinguish between local variable assignment within the environment of
the functions and assignment within the namespace of the package.

The third approach I've been considering is using the R.oo package.  I
have never used this package before but it appears to provide similar OO
features to Java.  Because it allows references, it would seem to
provide the features I'm looking for from both the S4 and functional
approaches.

Any comments or suggestions on these different approaches would be
appreciated.

Thank you.

Sincerely,

Daniel Gerlanc


From p.dalgaard at biostat.ku.dk  Fri Sep 14 23:01:13 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Fri, 14 Sep 2007 23:01:13 +0200
Subject: [Rd] Date vs date
In-Reply-To: <200709141722.l8EHMHF02634@hsrnfs-101.mayo.edu>
References: <200709141722.l8EHMHF02634@hsrnfs-101.mayo.edu>
Message-ID: <46EAF699.1010000@biostat.ku.dk>

Terry Therneau wrote:
>  I wrote the date package long ago, and it has been useful.  In my current task 
> of reunifying the R (Tom Lumley) and Splus (me) code trees for survival, I'm 
> removing the explicit dependence on 'date' objects from the expected survival 
> routines so that they better integrate.   Comparison of 'date' to 'Date' has 
> raised a couple of questions.
>  
>   Clearly Date is more mature -- more options for conversion, better plotting, 
> etc (a long list of etc).  I see three things where date is better.  Only the 
> last of these really matters, and is the point on which I would like comment.  
> (Well, actually I'd like to talk you all into a change, of course).
>   
>   1. Since date uses 1/1/1960 as the base, and so does SAS, those of us who 
> contantly pass files back and forth between those two packages have a slightly 
> easier time.
>
>   2. as.date(10) works, as.Date(10) does not.  Sometimes I have done a 
> manipluation that the date package does not understand, and I know that the 
> result is still of the right type, but the package does not.  However, this is 
> fairly rare and I can work around it. (It mostly occurs in processing the rate 
> tables for expected survival).
>   
The ideology here is that the origin is an implementation detail which 
users are not really expected to know. as.Date("1960-1-1")+10  works, 
and if you insist, so does structure(10, class="Date") (albeit not with 
the same result).

>   
>   3. temp <- as.Date('1990/1/1') - as.date('1953/2/5')
>      sqrt(temp)
>      Error in Math.difftime(temp3) : sqrtnot defined for "difftime" objects
>
>   Minor bug: no space before the word 'not'
>   Major: this shouldn't fail.  
>
>   
Arguably, it should (Is this a difftime object? Which units?).
I'd advise against numeric operation on difftime objects in general, 
because of the unspecified units. These are always "days" when working 
with Date objects, but with general time objects it is not predictable. 
So I'd recommend sqrt(as.numeric(temp, units="days")).

> People will do things with time intervals that you have not thought of.  Fitting 
> a growth curve that uses a square root, for instance.  I firmly believe that the 
> superior behavior in the face of something unexpected is to assume that the user 
> knows what they are doing, and return a numeric.  
>    I recognize that "assume the user knows what they are doing" is an anathema 
> to the more zealous OO types, but in designing a class I have found that they 
> often know more than me!
>    
>    4. Variation on #3 above
>    
>   
>> (as.Date('2007-9-14') - as.Date('1953-3-10')) / 365.25
>>     
>   Time difference of 54.51335 days
>    
>     No, I am not 54.5 days old.  Both hair color and knee creaking most 
> definitely proclaim otherwise, I am sorry to say. Time difference / number 
> should be a number.  
>   
Same story as above. It is assumed that the divisor is unit-less. 
Convert to numeric first to avoid this. (The idea has been raised to 
introduce new units: epiyears and epimonths, in which case you might do

x <- as.Date('2007-9-14') - as.Date('1953-3-10')
units(x) <- "epiyears"

which would give you the age in years for those purposes where you don't 
care missing the exact birthday by a day or so.)
>     
>    5. This is only amusing.  Im not saying that as.Date should necessarily work, 
> but the format is certainly not ambiguous.  (Not standard, but not ambiguous).
> Not important to fix, not something that date does any better.
>
>   
>> as.Date('09Sep2007')
>>     
> Error in fromchar(x) : character string is not in a standard unambiguous format
>  
>
>   
Yes. Also: this _is_ ambiguous, but does not cause an error

 > as.Date("05-06-07")
[1] "5-06-07"

Not that it should or even could, but it demonstrates that the error 
message above is beside the point.  Can you suggest a better wording?
 


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From h.wickham at gmail.com  Fri Sep 14 23:19:44 2007
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 14 Sep 2007 16:19:44 -0500
Subject: [Rd] Date vs date
In-Reply-To: <46EAF699.1010000@biostat.ku.dk>
References: <200709141722.l8EHMHF02634@hsrnfs-101.mayo.edu>
	<46EAF699.1010000@biostat.ku.dk>
Message-ID: <f8e6ff050709141419g5637437bkc52dd809120e7760@mail.gmail.com>

> >   3. temp <- as.Date('1990/1/1') - as.date('1953/2/5')
> >      sqrt(temp)
> >      Error in Math.difftime(temp3) : sqrtnot defined for "difftime" objects
> >
> >   Minor bug: no space before the word 'not'
> >   Major: this shouldn't fail.
> >
> >
> Arguably, it should (Is this a difftime object? Which units?).
> I'd advise against numeric operation on difftime objects in general,
> because of the unspecified units. These are always "days" when working
> with Date objects, but with general time objects it is not predictable.
> So I'd recommend sqrt(as.numeric(temp, units="days")).

Why not just always use seconds for difftime objects?  An attribute
could control how it was formatted, but would be independent of the
underlying representation.

Hadley


From gordonp at ucalgary.ca  Fri Sep 14 22:35:58 2007
From: gordonp at ucalgary.ca (gordonp at ucalgary.ca)
Date: Fri, 14 Sep 2007 22:35:58 +0200 (CEST)
Subject: [Rd] Incomplete library linking for grDevices.so on Solaris
	(PR#9910)
Message-ID: <20070914203558.88FC32A3BC@slim.kubism.ku.dk>

Full_Name: Paul Gordon
Version: 2.6.1 (alpha)
OS: Solaris 10
Submission from: (NULL) (136.159.169.6)


When compiling R 2.6.1 (alpha 2007-09-13), grDevices.so fails to link properly
because of a missing symbol __vlog_.  This symbol is defined in libmvec.so, but
no -lmvec is add by the configure script.  Manually adding -lmvec to the linking
command allows grDevices to compile.  The error output of the make command (for
a 64-bit version of R) is given below:

cc -G -m64 -L/lib/64 -L/usr/lib/64 -L/usr/local/lib/64 -L/usr/ucblib/sparcv9
-L/usr/ccs/lib/sparcv9 -L/opt/SUNWspro/prod/lib/sparcv9 -o grDevices.so chull.o
devNull.o devPicTeX.o devPS.o devQuartz.o init.o
Warning in solve.default(rgb) :
  unable to load shared library
'/export/home/gordonp/Desktop/R-alpha/modules//lapack.so':
  ld.so.1: R: fatal: relocation error: file
/export/home/gordonp/Desktop/R-alpha/lib/libRlapack.so: symbol __vlog_:
referenced symbol not found
Error in solve.default(rgb) : lapack routines cannot be loaded
Error: unable to load R code in package 'grDevices'


From ggrothendieck at gmail.com  Sat Sep 15 01:11:54 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 14 Sep 2007 19:11:54 -0400
Subject: [Rd] Building an R GUI using gWidgets and RGtk2
In-Reply-To: <3FA056EFB6415D41A622AF40227D29D00131E43F@MSGMROCLN2WIN.DMN1.FMR.COM>
References: <3FA056EFB6415D41A622AF40227D29D00131E43F@MSGMROCLN2WIN.DMN1.FMR.COM>
Message-ID: <971536df0709141611x7cf7bf6nf9e3ac5e0dddf89@mail.gmail.com>

A fourth approach would be the proto package.  It provides a thin
layer over environments making use of the prototype (aka object-based)
style of programming which is fundamental different relative to
class-based programming (although it is powerful enough to encompass
class based programming).  The gsubfn package uses proto objects
as generalizations of replacement strings that hold state from one replacement
to the next.  An application that may be closer to yours that uses proto
is ggplot2 which is a recent grid-based plotting package.  The home page is at
   http://r-proto.googlecode.com .
See the paper on prototype programming linked on the home page as well
as the package vignette.

On 9/14/07, Gerlanc, Daniel <Daniel.Gerlanc at geodecapital.com> wrote:
> Hello,
>
> I'm developing a GUI in R that will be used to monitor financial
> portfolio performance.  The GUI will be distributed as an R package.  So
> far, I've decided to use the "cairoDevice", "RGtk2", "gWidgets", and
> "gWidgetsRGtk2" packages to develop the GUI.  I am trying to decide what
> would be the best way to structure the GUI would be.
>
> I've considered 3 approaches to building the GUI.  The first would be to
> use S4 classes.  I would create parent "gui" object that would store
> widgets or containers in slots.  Other more specialized guis for
> different purposes would extend this parent "gui" object.  The
> difficulty in this approach is R's use of pass-by-value.  Once the gui
> object has been created, changing any of the slots of the gui requires
> returning a new GUI object or saving one off in a higher level
> environment and editing the slots directly.  Editing the slots directly
> would completely bypass the S4 method dispatch.
>
> Another approach would be more functional.  I would create variables
> that are global within the package or in their own environment and
> define the package function closures within this environment.  This
> could work, but the code could get noisy when calls to have be made to
> distinguish between local variable assignment within the environment of
> the functions and assignment within the namespace of the package.
>
> The third approach I've been considering is using the R.oo package.  I
> have never used this package before but it appears to provide similar OO
> features to Java.  Because it allows references, it would seem to
> provide the features I'm looking for from both the S4 and functional
> approaches.
>
> Any comments or suggestions on these different approaches would be
> appreciated.
>
> Thank you.
>
> Sincerely,
>
> Daniel Gerlanc
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ggrothendieck at gmail.com  Sat Sep 15 01:39:13 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 14 Sep 2007 19:39:13 -0400
Subject: [Rd] Date vs date
In-Reply-To: <200709141722.l8EHMHF02634@hsrnfs-101.mayo.edu>
References: <200709141722.l8EHMHF02634@hsrnfs-101.mayo.edu>
Message-ID: <971536df0709141639y304adbd3h65765cf9c362be28@mail.gmail.com>

On 9/14/07, Terry Therneau <therneau at mayo.edu> wrote:
>  I wrote the date package long ago, and it has been useful.  In my current task
> of reunifying the R (Tom Lumley) and Splus (me) code trees for survival, I'm
> removing the explicit dependence on 'date' objects from the expected survival
> routines so that they better integrate.   Comparison of 'date' to 'Date' has
> raised a couple of questions.
>
>  Clearly Date is more mature -- more options for conversion, better plotting,
> etc (a long list of etc).  I see three things where date is better.  Only the
> last of these really matters, and is the point on which I would like comment.
> (Well, actually I'd like to talk you all into a change, of course).
>
>  1. Since date uses 1/1/1960 as the base, and so does SAS, those of us who
> contantly pass files back and forth between those two packages have a slightly
> easier time.

There are some other programs that use 1/1/70.  See the R Help Desk article
in R News 4/1 that discusses a few origins.

>
>  2. as.date(10) works, as.Date(10) does not.  Sometimes I have done a
> manipluation that the date package does not understand, and I know that the
> result is still of the right type, but the package does not.  However, this is
> fairly rare and I can work around it. (It mostly occurs in processing the rate
> tables for expected survival).

You can define as.Date.numeric in your package and then it will work.  zoo
has done that.

library(zoo)
as.Date(10)

Some other things you can do:

today <- Sys.Date()
Epoch <- today - as.numeric(today)

Epoch + 10  # similar to as.Date(10)

>
>  3. temp <- as.Date('1990/1/1') - as.date('1953/2/5')
>     sqrt(temp)
>     Error in Math.difftime(temp3) : sqrtnot defined for "difftime" objects
>
>  Minor bug: no space before the word 'not'
>  Major: this shouldn't fail.
>
> People will do things with time intervals that you have not thought of.  Fitting
> a growth curve that uses a square root, for instance.  I firmly believe that the
> superior behavior in the face of something unexpected is to assume that the user
> knows what they are doing, and return a numeric.
>   I recognize that "assume the user knows what they are doing" is an anathema
> to the more zealous OO types, but in designing a class I have found that they
> often know more than me!
>
>   4. Variation on #3 above
>
> > (as.Date('2007-9-14') - as.Date('1953-3-10')) / 365.25
>  Time difference of 54.51335 days
>
>    No, I am not 54.5 days old.  Both hair color and knee creaking most
> definitely proclaim otherwise, I am sorry to say. Time difference / number
> should be a number.

Note that you can write:

x <- Sys.Date()
y <- x + 1
as.numeric(x-y)
as.numeric(x) - as.numeric(y)

>
>   5. This is only amusing.  Im not saying that as.Date should necessarily work,
> but the format is certainly not ambiguous.  (Not standard, but not ambiguous).
> Not important to fix, not something that date does any better.
>
> > as.Date('09Sep2007')
> Error in fromchar(x) : character string is not in a standard unambiguous format

as.Date("09Sep2007", "%d%b%Y")

>
>
>
>        Terry Therneau


From ggrothendieck at gmail.com  Sat Sep 15 05:06:35 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 14 Sep 2007 23:06:35 -0400
Subject: [Rd] Building an R GUI using gWidgets and RGtk2
In-Reply-To: <971536df0709141611x7cf7bf6nf9e3ac5e0dddf89@mail.gmail.com>
References: <3FA056EFB6415D41A622AF40227D29D00131E43F@MSGMROCLN2WIN.DMN1.FMR.COM>
	<971536df0709141611x7cf7bf6nf9e3ac5e0dddf89@mail.gmail.com>
Message-ID: <971536df0709142006i2a3b6148r87b55b68470a521a@mail.gmail.com>

On 9/14/07, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> On 9/14/07, Gerlanc, Daniel <Daniel.Gerlanc at geodecapital.com> wrote:
> > Hello,
> >
> > I'm developing a GUI in R that will be used to monitor financial
> > portfolio performance.  The GUI will be distributed as an R package.  So
> > far, I've decided to use the "cairoDevice", "RGtk2", "gWidgets", and
> > "gWidgetsRGtk2" packages to develop the GUI.  I am trying to decide what
> > would be the best way to structure the GUI would be.
> >
> > I've considered 3 approaches to building the GUI.  The first would be to
> > use S4 classes.  I would create parent "gui" object that would store
> > widgets or containers in slots.  Other more specialized guis for
> > different purposes would extend this parent "gui" object.  The
> > difficulty in this approach is R's use of pass-by-value.  Once the gui
> > object has been created, changing any of the slots of the gui requires
> > returning a new GUI object or saving one off in a higher level
> > environment and editing the slots directly.  Editing the slots directly
> > would completely bypass the S4 method dispatch.
> >
> > Another approach would be more functional.  I would create variables
> > that are global within the package or in their own environment and
> > define the package function closures within this environment.  This
> > could work, but the code could get noisy when calls to have be made to
> > distinguish between local variable assignment within the environment of
> > the functions and assignment within the namespace of the package.
> >
> > The third approach I've been considering is using the R.oo package.  I
> > have never used this package before but it appears to provide similar OO
> > features to Java.  Because it allows references, it would seem to
> > provide the features I'm looking for from both the S4 and functional
> > approaches.
> >
> > Any comments or suggestions on these different approaches would be
> > appreciated.
> >
> > Thank you.
> >
> > Sincerely,
> >
> > Daniel Gerlanc
> A fourth approach would be the proto package.  It provides a thin
> layer over environments making use of the prototype (aka object-based)
> style of programming which is fundamental different relative to
> class-based programming (although it is powerful enough to encompass
> class based programming).  The gsubfn package uses proto objects
> as generalizations of replacement strings that hold state from one replacement
> to the next.  An application that may be closer to yours that uses proto
> is ggplot2 which is a recent grid-based plotting package.  The home page is at
>   http://r-proto.googlecode.com .
> See the paper on prototype programming linked on the home page as well
> as the package vignette.

Just to illustrate this further here is a simple example of gWidgets and
proto.  In this example we create a proto object, p, that corresponds to
an ok/cancel dialogue labelled Hello and that prints Hello when OK is
pressed.  The components of p are go, msg and handler.  msg is
a character string, go is a method and handler is a function (to be
a method it would have to pass the proto object as its first arg).

q is created as a child of p so q gets components via
delegation from p.  q overrides msg which was "Hello" in p but is "Bye"
in q.  q acts the same as p except the label is Bye and q prints Bye when
OK is pressed.  Note that we pass the proto object to the handler via
the action= argument.  Here we used a dot (.) to denote the current
object but you could use this or self or any variable name you prefer.

library(proto)
library(gWidgets)
p <- proto(go = function(.) {
	w = gwindow()
	g = ggroup(container = w)
	g.i = ggroup(horizontal=FALSE, container = g)
	glabel(.$msg, container = g.i, expand = TRUE)
	g.i.b = ggroup(container = g.i)
	addSpring(g.i.b)
	gbutton("ok", handler = with(., handler), action = ., container = g.i.b)
	gbutton("cancel", handler = function(h, ...) dispose(w),
		container = g.i.b)
	},
	msg = "Hello",
	handler = function(h, ...) {
		cat("\n", h$action$msg, "\n")
		dispose(h$obj)
	}
)
p$go()  # press ok and Hello is printed

q <- p$proto(msg = "Bye") # q is child of p overriding msg
q$go()  # press ok and Bye is printed


From ripley at stats.ox.ac.uk  Sat Sep 15 09:01:12 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 15 Sep 2007 08:01:12 +0100 (BST)
Subject: [Rd] Date vs date
In-Reply-To: <f8e6ff050709141419g5637437bkc52dd809120e7760@mail.gmail.com>
References: <200709141722.l8EHMHF02634@hsrnfs-101.mayo.edu>
	<46EAF699.1010000@biostat.ku.dk>
	<f8e6ff050709141419g5637437bkc52dd809120e7760@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0709150756500.8538@gannet.stats.ox.ac.uk>

On Fri, 14 Sep 2007, hadley wickham wrote:

>>>   3. temp <- as.Date('1990/1/1') - as.date('1953/2/5')
>>>      sqrt(temp)
>>>      Error in Math.difftime(temp3) : sqrtnot defined for "difftime" objects
>>>
>>>   Minor bug: no space before the word 'not'
>>>   Major: this shouldn't fail.
>>>
>>>
>> Arguably, it should (Is this a difftime object? Which units?).
>> I'd advise against numeric operation on difftime objects in general,
>> because of the unspecified units. These are always "days" when working
>> with Date objects, but with general time objects it is not predictable.
>> So I'd recommend sqrt(as.numeric(temp, units="days")).

It fails by design.  Using sqrt() on a measurement that has an arbitrary 
origin would not have been good design.

> Why not just always use seconds for difftime objects?  An attribute
> could control how it was formatted, but would be independent of the
> underlying representation.

Because of leapseconds and changes to/from DST (which require knowing the 
timezone and its transition times).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Sat Sep 15 09:18:33 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Sat, 15 Sep 2007 09:18:33 +0200 (CEST)
Subject: [Rd] (PR#9910) Incomplete library linking for grDevices.so on
Message-ID: <20070915071833.D0B1E4C9EE@slim.kubism.ku.dk>

What compiler system is this?  And what settings were used?

We are not seeing such a problem on Solaris 10 (neither Sparc nor x86_64) 
with the Sun Studio 11 compilers they shipped with (a month or two ago).

Note that the error message is not to do with subject line: it is 
launching R and /export/home/gordonp/Desktop/R-alpha/lib/libRlapack.so 
that has the problem.

I don't think that configure can be expected to know about all possible 
systems on which R might be built, which is why we allow users to set 
variables such as FLIBS and MAIN_LD.  We do try to document the settings 
needed for known systems in the R-admin manual, and that includes all the 
Solaris systems we have encountered or seen reports from.

On Fri, 14 Sep 2007, gordonp at ucalgary.ca wrote:

> Full_Name: Paul Gordon
> Version: 2.6.1 (alpha)
> OS: Solaris 10
> Submission from: (NULL) (136.159.169.6)
>
>
> When compiling R 2.6.1 (alpha 2007-09-13), grDevices.so fails to link 
> properly because of a missing symbol __vlog_.

That is not what the error message reproduced below says, which comes from 
the runtime loader.

>  This symbol is defined in 
> libmvec.so, but no -lmvec is add by the configure script.  Manually 
> adding -lmvec to the linking command allows grDevices to compile.  The 
> error output of the make command (for a 64-bit version of R) is given 
> below:
>
> cc -G -m64 -L/lib/64 -L/usr/lib/64 -L/usr/local/lib/64 -L/usr/ucblib/sparcv9
> -L/usr/ccs/lib/sparcv9 -L/opt/SUNWspro/prod/lib/sparcv9 -o grDevices.so chull.o
> devNull.o devPicTeX.o devPS.o devQuartz.o init.o

> Warning in solve.default(rgb) :
>  unable to load shared library
> '/export/home/gordonp/Desktop/R-alpha/modules//lapack.so':
>  ld.so.1: R: fatal: relocation error: file
> /export/home/gordonp/Desktop/R-alpha/lib/libRlapack.so: symbol __vlog_:
> referenced symbol not found
> Error in solve.default(rgb) : lapack routines cannot be loaded
> Error: unable to load R code in package 'grDevices'
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From gchappi at gmail.com  Sat Sep 15 13:20:32 2007
From: gchappi at gmail.com (Hans-Peter)
Date: Sat, 15 Sep 2007 13:20:32 +0200
Subject: [Rd] Building an R GUI using gWidgets and RGtk2
In-Reply-To: <3FA056EFB6415D41A622AF40227D29D00131E43F@MSGMROCLN2WIN.DMN1.FMR.COM>
References: <3FA056EFB6415D41A622AF40227D29D00131E43F@MSGMROCLN2WIN.DMN1.FMR.COM>
Message-ID: <47fce0650709150420w3ce0a2bakbc6980c0cd56ef4b@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070915/adb75fe3/attachment.pl 

From nilsson.henric at gmail.com  Sat Sep 15 15:33:14 2007
From: nilsson.henric at gmail.com (Henric Nilsson (Public))
Date: Sat, 15 Sep 2007 15:33:14 +0200
Subject: [Rd] R-2.6.0 for Windows, semi-transparent colours and layout()
Message-ID: <46EBDF1A.5030501@gmail.com>

Hi,

The added support for semi-transparent colours in `windows' under 
R-2.6.0 for Windows is much appreciated.

However, I've discovered that issuing a `layout' (or `par' with 
arguments `mfcol'/`mfrow') call and then trying to plot several figures 
with semi-transparent colour on the same page results in only the first 
one being fully drawn. E.g.

 > x <- rnorm(10000)
 > y <- rnorm(10000)
 >
 > layout(matrix(1:2, ncol = 2))
 > plot(y ~ x, pch = 16, col = rgb(1, 0, 0, 0.15))
 > plot(y ~ x, pch = 16, col = rgb(1, 0, 0, 0.15))

results in the second one having only the axes and box, but no data 
points. This is under

 > sessionInfo()
R version 2.6.0 alpha (2007-09-14 r42843)
i386-pc-mingw32

locale:
LC_COLLATE=Swedish_Sweden.1252;LC_CTYPE=Swedish_Sweden.1252;LC_MONETARY=Swedish_Sweden.1252;LC_NUMERIC=C;LC_TIME=Swedish_Sweden.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


Henric


From p.dalgaard at biostat.ku.dk  Sat Sep 15 17:56:32 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sat, 15 Sep 2007 17:56:32 +0200
Subject: [Rd] Date vs date
In-Reply-To: <Pine.LNX.4.64.0709150756500.8538@gannet.stats.ox.ac.uk>
References: <200709141722.l8EHMHF02634@hsrnfs-101.mayo.edu>	<46EAF699.1010000@biostat.ku.dk>	<f8e6ff050709141419g5637437bkc52dd809120e7760@mail.gmail.com>
	<Pine.LNX.4.64.0709150756500.8538@gannet.stats.ox.ac.uk>
Message-ID: <46EC00B0.2060105@biostat.ku.dk>

Prof Brian Ripley wrote:
>>> Arguably, it should (Is this a difftime object? Which units?).
>>> I'd advise against numeric operation on difftime objects in general,
>>> because of the unspecified units. These are always "days" when working
>>> with Date objects, but with general time objects it is not predictable.
>>> So I'd recommend sqrt(as.numeric(temp, units="days")).
>>>       
>
> It fails by design.  Using sqrt() on a measurement that has an arbitrary 
> origin would not have been good design.
Er, _diff_time objects do have a well-defined origin at zero. Taking 
square roots (or exp, or...) of a number which  could be weeks as well 
as days is the real issue, I think.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ggrothendieck at gmail.com  Sun Sep 16 04:27:27 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 15 Sep 2007 22:27:27 -0400
Subject: [Rd] r cmd build
Message-ID: <971536df0709151927n494600bdx4c36b12c11cfc315@mail.gmail.com>

On Windows Vista hhc.exe is not available.  One can do this on an
install:

rcmd install --docs=normal myPackage

to avoid the message about hhc.exe; however,
"rcmd build" does not appear to support --docs=normal so one cannot
do a build without getting a message about hhc.exe (although the build
still proceeds).


From murdoch at stats.uwo.ca  Sun Sep 16 14:55:19 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sun, 16 Sep 2007 08:55:19 -0400
Subject: [Rd] r cmd build
In-Reply-To: <971536df0709151927n494600bdx4c36b12c11cfc315@mail.gmail.com>
References: <971536df0709151927n494600bdx4c36b12c11cfc315@mail.gmail.com>
Message-ID: <46ED27B7.2090804@stats.uwo.ca>

On 15/09/2007 10:27 PM, Gabor Grothendieck wrote:
> On Windows Vista hhc.exe is not available.  One can do this on an
> install:
> 
> rcmd install --docs=normal myPackage
> 
> to avoid the message about hhc.exe; however,
> "rcmd build" does not appear to support --docs=normal so one cannot
> do a build without getting a message about hhc.exe (although the build
> still proceeds).

Are you talking about "build --binary"?  I recommend using "install 
--build" instead.  AFAIK a non-binary build doesn't make any use of hhc.

Another way to do an install or build without getting that message is to 
indicate in src/gnuwin32/MkRules that you don't want to build CHM help.

Duncan Murdoch


From ggrothendieck at gmail.com  Sun Sep 16 15:33:15 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 16 Sep 2007 09:33:15 -0400
Subject: [Rd] r cmd build
In-Reply-To: <46ED27B7.2090804@stats.uwo.ca>
References: <971536df0709151927n494600bdx4c36b12c11cfc315@mail.gmail.com>
	<46ED27B7.2090804@stats.uwo.ca>
Message-ID: <971536df0709160633ybf2064y3c7b9e736c9561c5@mail.gmail.com>

The Writing Extensions manual says to do an R CMD build for releases
to CRAN.  That's what I have been doing and that does produce a .tar.gz
file even though I get a message about hhc.exe.  Is that what I should continue
to do and ignore the message or should I be using one of the alternatives
you mention to create a .tar.gz release file on Vista?

On 9/16/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 15/09/2007 10:27 PM, Gabor Grothendieck wrote:
> > On Windows Vista hhc.exe is not available.  One can do this on an
> > install:
> >
> > rcmd install --docs=normal myPackage
> >
> > to avoid the message about hhc.exe; however,
> > "rcmd build" does not appear to support --docs=normal so one cannot
> > do a build without getting a message about hhc.exe (although the build
> > still proceeds).
>
> Are you talking about "build --binary"?  I recommend using "install
> --build" instead.  AFAIK a non-binary build doesn't make any use of hhc.
>
> Another way to do an install or build without getting that message is to
> indicate in src/gnuwin32/MkRules that you don't want to build CHM help.
>
> Duncan Murdoch
>


From ligges at statistik.uni-dortmund.de  Sun Sep 16 16:44:05 2007
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Sun, 16 Sep 2007 16:44:05 +0200
Subject: [Rd] r cmd build
In-Reply-To: <971536df0709160633ybf2064y3c7b9e736c9561c5@mail.gmail.com>
References: <971536df0709151927n494600bdx4c36b12c11cfc315@mail.gmail.com>	<46ED27B7.2090804@stats.uwo.ca>
	<971536df0709160633ybf2064y3c7b9e736c9561c5@mail.gmail.com>
Message-ID: <46ED4135.3060606@statistik.uni-dortmund.de>



Gabor Grothendieck wrote:
> The Writing Extensions manual says to do an R CMD build for releases
> to CRAN.  That's what I have been doing and that does produce a .tar.gz
> file even though I get a message about hhc.exe.  Is that what I should continue
> to do and ignore the message or should I be using one of the alternatives
> you mention to create a .tar.gz release file on Vista?

Well, to produce a tar.gz, it is not required to have hhc.exe. It might 
happen that vignettes are created and therefore the package is installed 
for this purpose (and hhc is used to produce some help pages - 
temporarily). When hhc is not found at that place, just ignore it, the 
resulting .tar.gz should really be fine.

Uwe Ligges

> On 9/16/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>> On 15/09/2007 10:27 PM, Gabor Grothendieck wrote:
>>> On Windows Vista hhc.exe is not available.  One can do this on an
>>> install:
>>>
>>> rcmd install --docs=normal myPackage
>>>
>>> to avoid the message about hhc.exe; however,
>>> "rcmd build" does not appear to support --docs=normal so one cannot
>>> do a build without getting a message about hhc.exe (although the build
>>> still proceeds).
>> Are you talking about "build --binary"?  I recommend using "install
>> --build" instead.  AFAIK a non-binary build doesn't make any use of hhc.
>>
>> Another way to do an install or build without getting that message is to
>> indicate in src/gnuwin32/MkRules that you don't want to build CHM help.
>>
>> Duncan Murdoch
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ggrothendieck at gmail.com  Sun Sep 16 16:58:10 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 16 Sep 2007 10:58:10 -0400
Subject: [Rd] r cmd build
In-Reply-To: <46ED4135.3060606@statistik.uni-dortmund.de>
References: <971536df0709151927n494600bdx4c36b12c11cfc315@mail.gmail.com>
	<46ED27B7.2090804@stats.uwo.ca>
	<971536df0709160633ybf2064y3c7b9e736c9561c5@mail.gmail.com>
	<46ED4135.3060606@statistik.uni-dortmund.de>
Message-ID: <971536df0709160758n5bc871cof7a02b57da060461@mail.gmail.com>

Something should be added to the Writing Extensions manual
since one gets this message during the R CMD build on Vista:

hhc: not found
CHM compile failed: HTML Help Workshop not installed?

and one is not really sure if the result is ok or not -- it does say it FAILED.
Even better would be to get rid of the message or improve the message.
Again, this all refers to doing a build on Vista.

On 9/16/07, Uwe Ligges <ligges at statistik.uni-dortmund.de> wrote:
>
>
> Gabor Grothendieck wrote:
> > The Writing Extensions manual says to do an R CMD build for releases
> > to CRAN.  That's what I have been doing and that does produce a .tar.gz
> > file even though I get a message about hhc.exe.  Is that what I should continue
> > to do and ignore the message or should I be using one of the alternatives
> > you mention to create a .tar.gz release file on Vista?
>
> Well, to produce a tar.gz, it is not required to have hhc.exe. It might
> happen that vignettes are created and therefore the package is installed
> for this purpose (and hhc is used to produce some help pages -
> temporarily). When hhc is not found at that place, just ignore it, the
> resulting .tar.gz should really be fine.
>
> Uwe Ligges
>
> > On 9/16/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> >> On 15/09/2007 10:27 PM, Gabor Grothendieck wrote:
> >>> On Windows Vista hhc.exe is not available.  One can do this on an
> >>> install:
> >>>
> >>> rcmd install --docs=normal myPackage
> >>>
> >>> to avoid the message about hhc.exe; however,
> >>> "rcmd build" does not appear to support --docs=normal so one cannot
> >>> do a build without getting a message about hhc.exe (although the build
> >>> still proceeds).
> >> Are you talking about "build --binary"?  I recommend using "install
> >> --build" instead.  AFAIK a non-binary build doesn't make any use of hhc.
> >>
> >> Another way to do an install or build without getting that message is to
> >> indicate in src/gnuwin32/MkRules that you don't want to build CHM help.
> >>
> >> Duncan Murdoch
> >>
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
>


From braunm at MIT.EDU  Sun Sep 16 17:00:53 2007
From: braunm at MIT.EDU (Michael Braun)
Date: Sun, 16 Sep 2007 11:00:53 -0400
Subject: [Rd] Using gsl libraries in R packages
Message-ID: <000701c7f872$633b0140$0302a8c0@michael>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070916/a63ef553/attachment.pl 

From ripley at stats.ox.ac.uk  Sun Sep 16 21:17:03 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 16 Sep 2007 20:17:03 +0100 (BST)
Subject: [Rd] Using gsl libraries in R packages
In-Reply-To: <000701c7f872$633b0140$0302a8c0@michael>
References: <000701c7f872$633b0140$0302a8c0@michael>
Message-ID: <Pine.LNX.4.64.0709162007330.25039@gannet.stats.ox.ac.uk>

On Sun, 16 Sep 2007, Michael Braun wrote:

> I have some compiled C code that I call from R, and I would like to
> distribute this code as an R package through CRAN.  In the C code, I use the
> gsl numerical libraries, mainly for the BLAS interface, some linear algebra
> functions, and some optimization routines.  As I prepare this code to
> conform to the specs for R packagtes, I am wondering if there is a
> restriction on the use of external libraries in R packages, or am I limited
> to those functions in the R API (or, in other words, do I need to convert my
> gsl function calls to R API function calls)?  I have sifted through the R
> documentation on this matter, but I could not find a clear answer.

You can have whatever dependencies you like, but

1) Please note them in SystemRequirements in your DESCRIPTION file.

2) Just be aware that this reduce the potential user base dramatically. If 
you only need a few gsl functions it would be better to copy them into 
your package.  I have to say that I think for most of what you quote R has 
better functionality than gsl does: e.g. why would you want to use a 
third-party BLAS interface?

3) We already have a CRAN package 'gsl' that makes wrappers to some gsl 
routines.  I supply a Windows binary for it, and that is not too much of a 
pain these days (it was once), provided you make clear which version of 
gsl is required.

> And, on a related note, is there any documentation on the use of R API
> functions, especially those listed in the Rinternals.h header?  Many of
> these functions look like they might be useful, but I cannot find a
> description of what they do, what the arguments are, and so forth.  Is
> examining the source code directly the only way?

If they are API, they are documented in 'Writing R Extensions'. 
Otherwise, note the comments in `Writing R Extensions' that many are 
subject to change without notice.  We do try to run checks over CRAN and 
not make gratuitous changes, but the effort of doing so is getting large.

>
> Thanks,
>
> Michael
>
>
>
> Michael Braun
> Assistant Professor of Marketing
> MIT Sloan School of Management
> One Amherst St., E40-169
> Cambridge, MA 02142
> (617) 253-3436
> braunm at mit.edu
>
>
> 	[[alternative HTML version deleted]]

PLEASE do follow the posting guide.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From kamushkina at gorodok.net  Mon Sep 17 04:14:49 2007
From: kamushkina at gorodok.net (=?KOI8-R?Q?=EF=CC=D8=C7=C1_=EB._=EB=C1=CD=CE=C5=D7=C1?=
	=?KOI8-R?Q?_?=)
Date: Mon, 17 Sep 2007 09:14:49 +0700
Subject: [Rd] Call C code from R
Message-ID: <web-11654315@hermes.nsu.ru>

Hello, All!
  
I'm new for R-devel list. And I'd like to ask some questions, 
maybe they will be stuped for the most part of members of the 
list.
I need to call function which is written in C++ from R.
My questions are:
1. How should I include libraries (for example, iomanip, 
sstream, iostream)?
2. Can I use namespace?
  
Thanks All :)
Olga


From ripley at stats.ox.ac.uk  Mon Sep 17 09:08:25 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 17 Sep 2007 08:08:25 +0100 (BST)
Subject: [Rd] Call C code from R
In-Reply-To: <web-11654315@hermes.nsu.ru>
References: <web-11654315@hermes.nsu.ru>
Message-ID: <Pine.LNX.4.64.0709170801250.21407@gannet.stats.ox.ac.uk>

On Mon, 17 Sep 2007, ????? ?. ???????  wrote:

> Hello, All!
>
> I'm new for R-devel list. And I'd like to ask some questions,
> maybe they will be stuped for the most part of members of the
> list.
> I need to call function which is written in C++ from R.

Your subject line says C ....

> My questions are:
> 1. How should I include libraries (for example, iomanip,
> sstream, iostream)?
> 2. Can I use namespace?

What you link into R is a shared object aka DLL.  If you use the 
documented ways (e.g. R CMD CHLIB) to make this, it will be linked against 
the platform's standard C++ libraries.  There are lots of examples of C++ 
code in CRAN packages doing this.

The use of iostream is discussed in 'Writing R Extensions'.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From osklyar at ebi.ac.uk  Mon Sep 17 10:35:31 2007
From: osklyar at ebi.ac.uk (Oleg Sklyar)
Date: Mon, 17 Sep 2007 09:35:31 +0100
Subject: [Rd] Call C code from R
In-Reply-To: <web-11654315@hermes.nsu.ru>
References: <web-11654315@hermes.nsu.ru>
Message-ID: <1190018131.25747.5.camel@maitai.windows.ebi.ac.uk>

1) You include libraries just like you would always do. Here is the
example from my package that uses external libraries of ImageMagick and
GTK, standard libraries (stdio, pthread) and R libraries:

#include <R.h>
#include <Rdefines.h>
#include <R_ext/Rdynload.h>
#include <R_ext/Error.h>
#include <R_ext/Memory.h>

#include <magick/ImageMagick.h>

#include <stdio.h>

#ifndef WIN32
#   include <pthread.h>
#endif

/* These are to use GTK */
#ifdef USE_GTK
#   include <gtk/gtk.h>
#   ifdef WIN32
        typedef unsigned long ulong;
#       include <sys/types.h>
#   else
#       include <gdk/gdkx.h>
#   endif
#endif

2) The above is C code and no namespaces are used, however the piece
below is C++ code using namespaces and STL. With C++ you only need to
make sure that you export your function as C: extern "C" {}:

#include <R.h>
#include <Rdefines.h>
#include <R_ext/Rdynload.h>
#include <R_ext/Error.h>
#include <R_ext/Memory.h>

#include <magick/ImageMagick.h>

/* list of STL, C++ */
#include <list>

#define BG 0.0

struct TheSeed {
    int index, seed;
};

typedef std::list<int>     IntList;
typedef std::list<TheSeed> SeedList;


Oleg

On Mon, 2007-09-17 at 09:14 +0700, ????? ?. ??????? wrote:
> Hello, All!
>   
> I'm new for R-devel list. And I'd like to ask some questions, 
> maybe they will be stuped for the most part of members of the 
> list.
> I need to call function which is written in C++ from R.
> My questions are:
> 1. How should I include libraries (for example, iomanip, 
> sstream, iostream)?
> 2. Can I use namespace?
>   
> Thanks All :)
> Olga
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
-- 
Dr Oleg Sklyar * EBI-EMBL, Cambridge CB10 1SD, UK * +44-1223-494466


From ripley at stats.ox.ac.uk  Mon Sep 17 13:06:01 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 17 Sep 2007 12:06:01 +0100 (BST)
Subject: [Rd] (PR#9896) read.spss converts string variables with
In-Reply-To: <Pine.LNX.4.64.0709051757130.10643@gannet.stats.ox.ac.uk>
References: <20070905092557.3022366931@slim.kubism.ku.dk>
	<Pine.LNX.4.64.0709051757130.10643@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0709171132450.26142@gannet.stats.ox.ac.uk>

The problem here is that the values in the data do not have trailing
blanks, and the corresponding values in the label table do.  That's an
issue about the specific SPSS file, not mentioned in this report.

Take a look at the data read with use.value.labels=FALSE:

> read.spss("problem_file.sav", use.value.labels=FALSE)$CNT
  [1] "CZE" "CZE" "CZE" "CZE" "CZE" "CZE" "CZE" "CZE" "CZE" "CZE"
attr(,"value.labels")
      United States            Uruguay             Turkey
         "USA     "         "URY     "         "TUR     "
            Tunisia           Thailand     Chinese Taipei
         "TUN     "         "THA     "         "TAP     "
             Sweden          Slovenia     Slovak Republic
         "SWE     "         "SVN     "         "SVK     "
...

There is another example of this in the test suite:

> electric<-read.spss("electric.sav",TRUE,TRUE)
> summary(electric)
...
       WT58           DAYOFWK     VITAL10    FAMHXCVR        CHD
  Min.   :123.0   MISSING :130   ALIVE:179   NO  :  0   Min.   :0.0
  1st Qu.:156.0   SUNDAY  : 19   DEAD : 61   YES :  0   1st Qu.:0.0
  Median :171.0   TUESDAY : 19               NA's:240   Median :0.5
  Mean   :173.4   WEDNSDAY: 17                          Mean   :0.5
  3rd Qu.:187.0   SATURDAY: 16                          3rd Qu.:1.0
  Max.   :278.0   THURSDAY: 15                          Max.   :1.0
                  (Other) : 24

where the label.table attribute has

Browse[1]> vl[[12]]
        YES         NO
"Y       " "N       "

but the values are "Y" or "N".  And it has been that way since at least R 
1.6.2.

I think this has to be a case unanticipated by the original author of 
read.spss, and needs to be covered by a new argument to read.spss, since 
presumably trimming when matching might not always be required.



On Wed, 5 Sep 2007, Prof Brian Ripley wrote:

> Thank you.
>
> If anyone wants to work on a patch I've put the unencoded files from my 
> direct copy at
>
> http://www.stats.ox.ac.uk/pub/bdr/problem_file.sav
> http://www.stats.ox.ac.uk/pub/bdr/problem_file_read.RData
>
> I am afraid I won't have a chance to take a look for at least a couple of 
> weeks.
>
>
> On Wed, 5 Sep 2007, honza at ifolk.cz wrote:
>
>> ------=_20070905112441_38848
>> Content-Type: text/plain; charset="iso-8859-2"
>> Content-Transfer-Encoding: 8bit
>> 
>> I am sending two files attached. The file problem_file.sav was saved in
>> SPSS 10.0. It contains variables of various types, with and without
>> labeling etc., so that you can make experiments.
>> 
>> The file problem_file_read.RData was saved in R 2.5.1 (foreign library
>> version 0.8-20). It contains two data frames Schools and Schools2. The
>> former is result of
>> read.spss("problem_file.sav",to.data.frame=TRUE,use.value.labels=TRUE),
>> the latter differs in use.value.lables=FALSE only. As you can see, in the
>> first case read.spss has not read values of string labeled variables at
>> all.
>> 
>> I use WinXP.
>> 
>> Thank you for your work!
>> 
>> Jan Hucin
>> 
>> -------------------------------------------------------------------
>> Reference: <20070903104656.1D1566691D at slim.kubism.ku.dk>
>> 
>> There is nothing we can do to reproduce this without an example 'some.sav'
>> file exhibiting the problem.  Can you please supply one?
>> 
>> On Mon, 3 Sep 2007, honza at ifolk.cz wrote:
>> 
>>> Full_Name: Jan Hucin
>>> Version: 2.5.1 (foreign 0.8-20)
>>> OS: WinXP
>>> Submission from: (NULL) (195.113.83.7)
>>> 
>>> 
>>> When reading an SPSS file:
>>> 
>>> - containing some variable of type String
>>> - with value labels at that variable
>>> - and with determination which values of that variable are considered to 
>>> be
>>> missing,
>>> 
>>> I have always get <NA> where digits were in the original SPSS file.
>>> 
>>> Example:
>>> Let's have in an SPSS file "some.sav" the variable A. The type of the
>> variable
>>> is String of length 1.
>>> Let's have a value labeling: 1 = Yes, 2 = No, 8 = Invalid, 9 = Missing.
>>> Let's determine that value 9 is considered to be missing.
>>> When this file is read by
>> abc=read.spss("some.sav",use.value.labels=TRUE), we
>>> get <NA> in abc$A on places where "1", "2" etc. were. Surprisingly, we
>> get "N/A"
>>> (not <NA>!) on the place where the string "N/A" is.
>>> 
>>> If we specify use.value.labels=FALSE, then we get string values (such as
>> "1",
>>> "2") but we lose value labels (Yes, No etc.).
>>> 
>>> Let me add that if the variable in the original SPSS file was of type
>> Numeric
>>> (not String), there would be no problem.
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>> 
>> 
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Mon Sep 17 16:43:18 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 17 Sep 2007 15:43:18 +0100 (BST)
Subject: [Rd] R-2.6.0 for Windows, semi-transparent colours and layout()
In-Reply-To: <46EBDF1A.5030501@gmail.com>
References: <46EBDF1A.5030501@gmail.com>
Message-ID: <Pine.LNX.4.64.0709171534270.27414@gannet.stats.ox.ac.uk>

On Sat, 15 Sep 2007, Henric Nilsson (Public) wrote:

> Hi,
>
> The added support for semi-transparent colours in `windows' under
> R-2.6.0 for Windows is much appreciated.
>
> However, I've discovered that issuing a `layout' (or `par' with
> arguments `mfcol'/`mfrow') call and then trying to plot several figures
> with semi-transparent colour on the same page results in only the first
> one being fully drawn. E.g.

That's not the whole story, as my test examples using multiple subplots 
did work.

The problem I found is that clipping rectangles were being used in some 
places where I cannot find documentation that they should be.
So explicitly setting the clipping rectangle before each alpha-blending 
call seems to fix the problematic examples, including yours.


>
> > x <- rnorm(10000)
> > y <- rnorm(10000)
> >
> > layout(matrix(1:2, ncol = 2))
> > plot(y ~ x, pch = 16, col = rgb(1, 0, 0, 0.15))
> > plot(y ~ x, pch = 16, col = rgb(1, 0, 0, 0.15))
>
> results in the second one having only the axes and box, but no data
> points. This is under
>
> > sessionInfo()
> R version 2.6.0 alpha (2007-09-14 r42843)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=Swedish_Sweden.1252;LC_CTYPE=Swedish_Sweden.1252;LC_MONETARY=Swedish_Sweden.1252;LC_NUMERIC=C;LC_TIME=Swedish_Sweden.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
>
> Henric
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bill at insightful.com  Mon Sep 17 19:45:17 2007
From: bill at insightful.com (bill at insightful.com)
Date: Mon, 17 Sep 2007 19:45:17 +0200 (CEST)
Subject: [Rd] *.Rd file: space after topic in "\alias{topic }" should be
	ignored (PR#9914)
Message-ID: <20070917174517.1941D4C99E@slim.kubism.ku.dk>

Full_Name: Bill Dunlap
Version: R version 2.6.0 Under development (unstable) (2007-07-26 r42329)
OS: Linux
Submission from: (NULL) (24.16.101.199)


If a *.Rd file has an \alias{topic } with a space
between 'topic' and the closing '}' then the space
is copied to the help/AnIndex file and help(topic)
fails to find the help file.

E.g., if the help file starts with
   \name{test1}
   \alias{test1 }
   \alias{test2}
   \alias{test3 }
   \alias{test4}
then help(test1) and help(test4) work, but not
help(test1) or help(test3).

A possible fix is
--- share/perl/R/Rdlists.pm     (revision 42846)
+++ share/perl/R/Rdlists.pm     (working copy)
@@ -329,7 +329,7 @@
                $main::title2file{$rdtitle} = $manfilebase;
            }

-           while($text =~ s/\\alias\{\s*(.*)\s*\}//){
+           while($text =~ s/\\alias\{\s*([^\s]*)\s*\}//){
                $alias = $1;
                $alias =~ s/\\%/%/g;
                if ($internal){


From bill at insightful.com  Mon Sep 17 19:56:05 2007
From: bill at insightful.com (bill at insightful.com)
Date: Mon, 17 Sep 2007 19:56:05 +0200 (CEST)
Subject: [Rd] *.Rd file: space after topic in "\alias{topic }" should be
	(PR#9915)
Message-ID: <20070917175605.12D204C99E@slim.kubism.ku.dk>

On Mon, 17 Sep 2007 bill at insightful.com wrote:

> Full_Name: Bill Dunlap
> Version: R version 2.6.0 Under development (unstable) (2007-07-26 r42329)
> OS: Linux
> Submission from: (NULL) (24.16.101.199)
>
> If a *.Rd file has an \alias{topic } with a space
> between 'topic' and the closing '}' then the space
> is copied to the help/AnIndex file and help(topic)
> fails to find the help file.
>
> E.g., if the help file starts with
>    \name{test1}
>    \alias{test1 }
>    \alias{test2}
>    \alias{test3 }
>    \alias{test4}
> then help(test1) and help(test4) work, but not
> help(test1) or help(test3).
>
> A possible fix is
> --- share/perl/R/Rdlists.pm     (revision 42846)
> +++ share/perl/R/Rdlists.pm     (working copy)
> @@ -329,7 +329,7 @@
>                 $main::title2file{$rdtitle} = $manfilebase;
>             }
>
> -           while($text =~ s/\\alias\{\s*(.*)\s*\}//){
> +           while($text =~ s/\\alias\{\s*([^\s]*)\s*\}//){
>                 $alias = $1;
>                 $alias =~ s/\\%/%/g;
>                 if ($internal){

It looks like internal spaces are used in \alias entries,
e.g.,
  ./R.utils/man/Non-documented_objects.Rd:\alias{Non-documented objects}
  ./SparseM/man/character-null-class.Rd:\alias{character or NULL-class}
I think the trailing spaces are intended to be ignored,
so a better fix would be

--- Rdlists.pm  (revision 42846)
+++ Rdlists.pm  (working copy)
@@ -332,6 +332,7 @@
            while($text =~ s/\\alias\{\s*(.*)\s*\}//){
                $alias = $1;
                $alias =~ s/\\%/%/g;
+               $alias =~ s/\s*$//;
                if ($internal){
                    $internal{$alias} = 1;
                }



----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From p.dalgaard at biostat.ku.dk  Tue Sep 18 00:29:58 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 18 Sep 2007 00:29:58 +0200
Subject: [Rd] Date vs date (long)
In-Reply-To: <200709172111.l8HLBsF24362@hsrnfs-101.mayo.edu>
References: <200709172111.l8HLBsF24362@hsrnfs-101.mayo.edu>
Message-ID: <46EEFFE6.7080000@biostat.ku.dk>

Terry Therneau wrote:
>   b. "I'd advise against numeric operation on difftime objects in general, 
> because of the unspecified units."
>   If I carry this idea forward, the R should insist that I specify units for
> any variable that corresponds to a physical quantity, e.g. "height" or 
> "weight", so that it can slap my hands with an error message when I type
>
> 	bodyMassIndex = weight/ height^2
>
> or cause plot(height^2, weight) to fail.  This would go a long way towards
> making R the most frustrating program available.  (An Microsoft gives some
> stiff competition in that area!)
>   
That's not the point. The point is that 2 weeks is 14 days, so do you 
want sqrt(2) or sqrt(14)? It is not my design to have this 
variable-units encoding of difftimes, but as it is there, it  is better 
to play along than to pretend that it is something else. (Once you go to 
faster time scales than in epidemiology, this becomes quite crucial 
because the units chosen can depend on the actual differences computed!)

>  c. 
> "It is assumed that the divisor is unit-less. 
> Convert to numeric first to avoid this. (The idea has been raised to 
> introduce new units: epiyears and epimonths, in which case you might do
>
> x <- as.Date('2007-9-14') - as.Date('1953-3-10')
> units(x) <- "epiyears"
>
> which would give you the age in years for those purposes where you don't 
> care missing the exact birthday by a day or so.)"
>
>    As I said, division is a hard case with no clear answer.  The creation of
> other unit schemes is silly --- why in the world would I voluntarily put on
> a straightjacket?
>   
We'll put it on for you...

It makes sense to calculate half a difftime or a 12th or a 100th of a 
difftime. You were asking the system to magically conclude that a 
365.25th of a difftime has a different meaning, a units conversion. This 
is the sort of thing that humans can discern, but not machines. The 
design is that you change units by using units(x)<-. Unfortunately the 
largest regular unit is "weeks", hence the suggestion of "epiyears".

> d. 
>   
>>> as.Date('09Sep2007')
>>>     
>>>       
>> Error in fromchar(x) : character string is not in a standard unambiguous 
>>     
> format
>
>   My off-the-cuff suggestion is to make the message honest
> 	Error in fromchar(x): program is not able to divine the correct format
>   
Heh. Pretty close.  Now what is a suitable eufemism for "divine"?
> The problem is not that the format is necessarily wrong or ambiguous, but that
> the program can't guess.  (Which is no real fault of the program - such 
> a recognition is a hard problem.  It's ok to ask me for a format string).
>
> --
> Hadley Wickham
> "Why not just always use seconds for difftime objects?  An attribute
> could control how it was formatted, but would be independent of the
> underlying representation."
>
>   This misses the point.
>   
No. It _is_ the point.  The design is that the numeric value of a 
difftime is nonsensical without knowing the units. This might be 
different, although as Brian indicated, the choice is deliberate, and 
some deep thinking was involved.
> -------
>
> Gabor Grothendieck 
>
> as.Date(10)
> You can define as.Date.numeric in your package and then it will work.  zoo
> has done that.
>
> library(zoo)
> as.Date(10)
>
>   This is also a nice idea.  Although adding to a package is possible, it is
> now very hard to take away, given namespaces.  That is, I can't define my
> own Math.Date to do away with the creation of timespan objects.  Am I
> correct?  Is it also true that adding methods is hard if one uses version 4
> classes?
>
>   The rest of Gabor's comments are workarounds for the problem I raised.
> But I don't want to have to wrap "as.numeric" around all of my date 
> calculations.
>
>   
Just get used to it, I'd say.

> -----------
> Brian Ripley
>
> "It fails by design.  Using sqrt() on a measurement that has an arbitrary 
> origin would not have been good design."
>
>   Ah, the classic Unix response of "that's not a bug, it's a feature".
>
>   What is interesting is that this is almost precisely the response I
> got when I first argued for a global na.action default.  John C (I think)
> replied that, essentially, S SHOULD slap you alonside the head when
> there were missing values.  They require careful thought wrt good analysis,
> and allowing a global option was bad design because it would encourage bad
> statistics.  The Insightful side of the debate said they didn't dare because
> is might break something.  After getting nowhere with talking I finally
> gave up and wrote my own version into the survival code.  This leverage 
> eventually forced adoption of the idea.
>    Not many (any?) people currently set na.action=na.fail because it is
> a "better design". 
> ------------------
>
> Historically, languages designed for other people to use have been bad: Cobol,
> PL/I, Pascal, Ada, C++. The good languages have been those that were designed 
> for their own creators: C, Perl, Smalltalk, Lisp. (Paul Graham)
>   
Each of those that I know had its share of trouble with users who relied 
on implementation details and protested loudly when their programs 
stopped working. (In the C case, relying on function arguments being 
stored consecutively on a stack was a common source of grief when 
porting programs to SPARC machines, for instance. Or assuming that 
doubles could be stored starting at arbitrary bytes. Or that pointers 
could be stored in long integers.)

>    
>
>
>    Terry Therneau
>   


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ggrothendieck at gmail.com  Tue Sep 18 03:13:08 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 17 Sep 2007 21:13:08 -0400
Subject: [Rd] Date vs date (long)
In-Reply-To: <200709172111.l8HLBsF24362@hsrnfs-101.mayo.edu>
References: <200709172111.l8HLBsF24362@hsrnfs-101.mayo.edu>
Message-ID: <971536df0709171813g3d39e4efif10b8b771a3b1f3d@mail.gmail.com>

On 9/17/07, Terry Therneau <therneau at mayo.edu> wrote:
> Gabor Grothendieck
>
> as.Date(10)
> You can define as.Date.numeric in your package and then it will work.  zoo
> has done that.
>
> library(zoo)
> as.Date(10)
>
>  This is also a nice idea.  Although adding to a package is possible, it is
> now very hard to take away, given namespaces.  That is, I can't define my
> own Math.Date to do away with the creation of timespan objects.  Am I
> correct?  Is it also true that adding methods is hard if one uses version 4
> classes?
>
>  The rest of Gabor's comments are workarounds for the problem I raised.
> But I don't want to have to wrap "as.numeric" around all of my date
> calculations.

You can define as.Date.numeric and Ops.Date, say, using S3 and these
will be added to the whatever is there but won't override the existing
+.Date and -.Date nor would you want them to or else the behavior would
be different depending on whether your package was there or not.  Also
namespaces should not be a problem since zoo uses namespaces and
it defined its own as.Date.numeric.

Try this:

Ops.Date <- function (e1, e2) {
    e <- if (missing(e2)) {
        NextMethod(.Generic)
    }
    else if (any(nchar(.Method) == 0)) {
        NextMethod(.Generic)
    }
    else {
        e1 <- as.numeric(e1)
	e2 <- as.numeric(e2)
        NextMethod(.Generic)
    }
    e
}

Sys.Date() / Sys.Date()
Sys.Date() + as.numeric(Sys.Date())
as.numeric(Sys.Date()) + as.numeric(Sys.Date())

Sys.Date() + Sys.Date() # error since its intercepted by +.Date

Thus you will have to issue some as.numeric calls but perhaps not too
many.

However, I think its better not to implement Ops.Date as above but
just leave the Date operations the way they are, extend it with
as.Date.numeric like zoo has done and force the user to use as.numeric
in other cases to make it clear from the code that  there is conversion
going on.  I have done a fair amount of Date manipulation and have not
found the as.numeric to be onerous.


From hb at stat.berkeley.edu  Tue Sep 18 06:32:31 2007
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Mon, 17 Sep 2007 21:32:31 -0700
Subject: [Rd] Re-attaching a package environment drops the attributes
Message-ID: <59d7961d0709172132t24cb9a87q36c7a9319c19a1f0@mail.gmail.com>

Hi.

contrary to other environments, the attributes of a *package*
environment are dropped (from the new environment) when attach():ing
it to the search() path.  This might or might not be surprising, but
have some side effects if rearranging/attaching package environments.

# Example - Regular environments
env <- new.env()
attr(env, "foo") <- "bar"
print(env)
## <environment: 0x023f3128>
## attr(,"foo")
## [1] "bar"
attach(env, pos=2, name="foo", warn.conflicts=FALSE)
env2 <- as.environment("foo")
print(env2)
## <environment: 0x023f44c4>
## attr(,"name")
## [1] "foo"

# Example - Package environments
env <- as.environment("package:utils")
attr(env, "foo") <- "bar"
print(env)
## <environment: package:utils>
## attr(,"name")
## [1] "package:utils"
## attr(,"path")
## [1] "C:/PROGRA~1/R/R-2.6.0alpha/library/utils"
## attr(,"foo")
## [1] "bar"
attach(env, pos=2, name="package:utils2", warn.conflicts=FALSE)
env2 <- as.environment("package:utils2")
print(env2)
## <environment: package:utils2>
## attr(,"name")
## [1] "package:utils2"

This becomes a problem, because the 'path' attribute is dropped causing:

packageDescription("utils2")
## Error in if (pkgpath == "") { : argument is of length zero
sessionInfo()
## Error in if (pkgpath == "") { : argument is of length zero

Again, this might or might not expected.

Finally:

> sessionInfo()
R version 2.6.0 alpha (2007-09-14 r42843)
i386-pc-mingw32

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
States.1252;LC_MONETARY=English_United
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

Cheers

Henrik


From ripley at stats.ox.ac.uk  Tue Sep 18 10:38:24 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 18 Sep 2007 09:38:24 +0100 (BST)
Subject: [Rd] Re-attaching a package environment drops the attributes
In-Reply-To: <59d7961d0709172132t24cb9a87q36c7a9319c19a1f0@mail.gmail.com>
References: <59d7961d0709172132t24cb9a87q36c7a9319c19a1f0@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0709180844560.6646@gannet.stats.ox.ac.uk>

Note that attach() has a return value, so you don't need to use 
as.environment() on the name.

Do note more carefully that the attribute you added to env _has_ 'been 
dropped', so there is nothing special about package environments here.

You seem to believe that you can (re-)attach an actual environment. 
However (as the help page says), attach() makes a new environment and 
copies the bindings into that environment so the result of attach() is a 
different environment which does not inherit any attributes from the 
argument to attach().  Nor would it be desirable to do so, for the 
attached environment can be altered independently of the argument to 
attach().

If you name enviroments to look like packages when they are not you are 
likely to break quite a lot of things, and yes, that would be expected.

On Mon, 17 Sep 2007, Henrik Bengtsson wrote:

> Hi.
>
> contrary to other environments, the attributes of a *package*
> environment are dropped (from the new environment) when attach():ing
> it to the search() path.  This might or might not be surprising, but
> have some side effects if rearranging/attaching package environments.
>
> # Example - Regular environments
> env <- new.env()
> attr(env, "foo") <- "bar"
> print(env)
> ## <environment: 0x023f3128>
> ## attr(,"foo")
> ## [1] "bar"
> attach(env, pos=2, name="foo", warn.conflicts=FALSE)
> env2 <- as.environment("foo")
> print(env2)
> ## <environment: 0x023f44c4>
> ## attr(,"name")
> ## [1] "foo"

And no "foo" attribute.

>
> # Example - Package environments
> env <- as.environment("package:utils")
> attr(env, "foo") <- "bar"
> print(env)
> ## <environment: package:utils>
> ## attr(,"name")
> ## [1] "package:utils"
> ## attr(,"path")
> ## [1] "C:/PROGRA~1/R/R-2.6.0alpha/library/utils"
> ## attr(,"foo")
> ## [1] "bar"
> attach(env, pos=2, name="package:utils2", warn.conflicts=FALSE)
> env2 <- as.environment("package:utils2")
> print(env2)
> ## <environment: package:utils2>
> ## attr(,"name")
> ## [1] "package:utils2"
>
> This becomes a problem, because the 'path' attribute is dropped causing:
>
> packageDescription("utils2")
> ## Error in if (pkgpath == "") { : argument is of length zero
> sessionInfo()
> ## Error in if (pkgpath == "") { : argument is of length zero
>
> Again, this might or might not expected.
>
> Finally:
>
>> sessionInfo()
> R version 2.6.0 alpha (2007-09-14 r42843)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> States.1252;LC_MONETARY=English_United
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> Cheers
>
> Henrik
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Tue Sep 18 10:42:37 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Tue, 18 Sep 2007 10:42:37 +0200 (CEST)
Subject: [Rd] (PR#9915) *.Rd file: space after topic in "\alias{topic }"
Message-ID: <20070918084237.4E8BF6682F@slim.kubism.ku.dk>

Spaces are indeed significant in \alias, and the treatment of leading and 
trailing spaces seems undocumented.  (Four CRAN package authors have made 
assumptions here.)

As far as I can see this comes up in 3 places:

1) Writing AnIndex strips leading but not trailing spaces.
2) get_multi used to create @aliases strips both.
3) Looking up aliases in \link happens at both compile and (for [C]HTML) 
run times, and it seems never strips spaces.

I think it would have been better to leave spaces alone, but I propose to 
consistently strip leading and trailing spaces in aliases and not links, 
and to document that.

On Mon, 17 Sep 2007, bill at insightful.com wrote:

> On Mon, 17 Sep 2007 bill at insightful.com wrote:
>
>> Full_Name: Bill Dunlap
>> Version: R version 2.6.0 Under development (unstable) (2007-07-26 r42329)
>> OS: Linux
>> Submission from: (NULL) (24.16.101.199)
>>
>> If a *.Rd file has an \alias{topic } with a space
>> between 'topic' and the closing '}' then the space
>> is copied to the help/AnIndex file and help(topic)
>> fails to find the help file.
>>
>> E.g., if the help file starts with
>>    \name{test1}
>>    \alias{test1 }
>>    \alias{test2}
>>    \alias{test3 }
>>    \alias{test4}
>> then help(test1) and help(test4) work, but not
>> help(test1) or help(test3).
>>
>> A possible fix is
>> --- share/perl/R/Rdlists.pm     (revision 42846)
>> +++ share/perl/R/Rdlists.pm     (working copy)
>> @@ -329,7 +329,7 @@
>>                 $main::title2file{$rdtitle} = $manfilebase;
>>             }
>>
>> -           while($text =~ s/\\alias\{\s*(.*)\s*\}//){
>> +           while($text =~ s/\\alias\{\s*([^\s]*)\s*\}//){
>>                 $alias = $1;
>>                 $alias =~ s/\\%/%/g;
>>                 if ($internal){
>
> It looks like internal spaces are used in \alias entries,
> e.g.,
>  ./R.utils/man/Non-documented_objects.Rd:\alias{Non-documented objects}
>  ./SparseM/man/character-null-class.Rd:\alias{character or NULL-class}
> I think the trailing spaces are intended to be ignored,
> so a better fix would be
>
> --- Rdlists.pm  (revision 42846)
> +++ Rdlists.pm  (working copy)
> @@ -332,6 +332,7 @@
>            while($text =~ s/\\alias\{\s*(.*)\s*\}//){
>                $alias = $1;
>                $alias =~ s/\\%/%/g;
> +               $alias =~ s/\s*$//;
>                if ($internal){
>                    $internal{$alias} = 1;
>                }
>
>
>
> ----------------------------------------------------------------------------
> Bill Dunlap
> Insightful Corporation
> bill at insightful dot com
> 360-428-8146
>
> "All statements in this message represent the opinions of the author and do
> not necessarily reflect Insightful Corporation policy or position."
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at stat.berkeley.edu  Tue Sep 18 17:59:44 2007
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Tue, 18 Sep 2007 08:59:44 -0700
Subject: [Rd] Re-attaching a package environment drops the attributes
In-Reply-To: <Pine.LNX.4.64.0709180844560.6646@gannet.stats.ox.ac.uk>
References: <59d7961d0709172132t24cb9a87q36c7a9319c19a1f0@mail.gmail.com>
	<Pine.LNX.4.64.0709180844560.6646@gannet.stats.ox.ac.uk>
Message-ID: <59d7961d0709180859i170d8fai13f1fc69143d32fc@mail.gmail.com>

On 9/18/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> Note that attach() has a return value, so you don't need to use
> as.environment() on the name.
>
> Do note more carefully that the attribute you added to env _has_ 'been
> dropped', so there is nothing special about package environments here.

I am sorry about that - mixing up the "foo" outputs.  Yes, it applies
to all environments.
(I have to stop working in the middle of the night or at least send
emails at that time).

/Henrik

>
> You seem to believe that you can (re-)attach an actual environment.
> However (as the help page says), attach() makes a new environment and
> copies the bindings into that environment so the result of attach() is a
> different environment which does not inherit any attributes from the
> argument to attach().  Nor would it be desirable to do so, for the
> attached environment can be altered independently of the argument to
> attach().
>
> If you name enviroments to look like packages when they are not you are
> likely to break quite a lot of things, and yes, that would be expected.
>
> On Mon, 17 Sep 2007, Henrik Bengtsson wrote:
>
> > Hi.
> >
> > contrary to other environments, the attributes of a *package*
> > environment are dropped (from the new environment) when attach():ing
> > it to the search() path.  This might or might not be surprising, but
> > have some side effects if rearranging/attaching package environments.
> >
> > # Example - Regular environments
> > env <- new.env()
> > attr(env, "foo") <- "bar"
> > print(env)
> > ## <environment: 0x023f3128>
> > ## attr(,"foo")
> > ## [1] "bar"
> > attach(env, pos=2, name="foo", warn.conflicts=FALSE)
> > env2 <- as.environment("foo")
> > print(env2)
> > ## <environment: 0x023f44c4>
> > ## attr(,"name")
> > ## [1] "foo"
>
> And no "foo" attribute.
>
> >
> > # Example - Package environments
> > env <- as.environment("package:utils")
> > attr(env, "foo") <- "bar"
> > print(env)
> > ## <environment: package:utils>
> > ## attr(,"name")
> > ## [1] "package:utils"
> > ## attr(,"path")
> > ## [1] "C:/PROGRA~1/R/R-2.6.0alpha/library/utils"
> > ## attr(,"foo")
> > ## [1] "bar"
> > attach(env, pos=2, name="package:utils2", warn.conflicts=FALSE)
> > env2 <- as.environment("package:utils2")
> > print(env2)
> > ## <environment: package:utils2>
> > ## attr(,"name")
> > ## [1] "package:utils2"
> >
> > This becomes a problem, because the 'path' attribute is dropped causing:
> >
> > packageDescription("utils2")
> > ## Error in if (pkgpath == "") { : argument is of length zero
> > sessionInfo()
> > ## Error in if (pkgpath == "") { : argument is of length zero
> >
> > Again, this might or might not expected.
> >
> > Finally:
> >
> >> sessionInfo()
> > R version 2.6.0 alpha (2007-09-14 r42843)
> > i386-pc-mingw32
> >
> > locale:
> > LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> > States.1252;LC_MONETARY=English_United
> > States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> >
> > attached base packages:
> > [1] stats     graphics  grDevices utils     datasets  methods   base
> >
> > Cheers
> >
> > Henrik
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


From chxmahappy at gmail.com  Wed Sep 19 07:08:25 2007
From: chxmahappy at gmail.com (=?GB2312?B?wu20q8/j?=)
Date: Wed, 19 Sep 2007 13:08:25 +0800
Subject: [Rd] Welcome to the "R-devel" mailing list
In-Reply-To: <mailman.353.1190178002.4094.r-devel@r-project.org>
References: <mailman.353.1190178002.4094.r-devel@r-project.org>
Message-ID: <fc4f206a0709182208q203046e9k88ed6f98d171ce77@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070919/ca7c03e0/attachment.pl 

From ripley at stats.ox.ac.uk  Wed Sep 19 11:11:12 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 19 Sep 2007 10:11:12 +0100 (BST)
Subject: [Rd] chartr better
In-Reply-To: <dc41e1260709130029r514fcb71ke10f41441e5603b3@mail.gmail.com>
References: <dc41e1260709130029r514fcb71ke10f41441e5603b3@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0709191003080.10376@auk.stats>

Thank you for this.

Unfortunately qsort and bsearch are C99 functions, and I don't think we 
can safely assume that they are present.  So I am going to put this into 
R-devel but not 2.6.0.  When we have a bit more experience we can consider 
backporting it to 2.6.1 (I don't want to change the autoconf stuff at this 
stage).

Brian Ripley

On Thu, 13 Sep 2007, Ei-ji Nakama wrote:

> For example, the following changes are necessary when i convert a
> Japanese hiragana into katakana in chattr.
>
> R code:
>> chartr("\u3041-\u3093","\u30a1-\u30f3","\u3084\u3063\u305f\u30fc")
>
> --- R-alpha.orig/src/main/character.c   2007-09-05 07:13:27.000000000 +0900
> +++ R-alpha/src/main/character.c        2007-09-13 16:10:21.000000000 +0900
> @@ -2041,6 +2041,16 @@
>     return(c);
> }
>
> +typedef struct { wchar_t c_old, c_new; } xtable_t;
> +static inline int xtable_comp(const xtable_t *a, const xtable_t *b)
> +{
> +    return a->c_old - b->c_old;
> +}
> +static inline int xtable_key_comp(const wchar_t *a, const xtable_t *b)
> +{
> +    return *a - b->c_old;
> +}
> +
> SEXP attribute_hidden do_chartr(SEXP call, SEXP op, SEXP args, SEXP env)
> {
>     SEXP old, _new, x, y;
> @@ -2064,14 +2074,18 @@
> #ifdef SUPPORT_MBCS
>     if(mbcslocale) {
>         int j, nb, nc;
> -        wchar_t xtable[65536 + 1], c_old, c_new, *wc;
> +        xtable_t *xtable;
> +        int       xtable_cnt;
> +        wchar_t c_old, c_new, *wc;
>         const char *xi, *s;
>         struct wtr_spec *trs_old, **trs_old_ptr;
>         struct wtr_spec *trs_new, **trs_new_ptr;
> -
> -        for(i = 0; i <= UCHAR_MAX; i++) xtable[i] = i;
> +        struct wtr_spec *trs_cnt, **trs_cnt_ptr;
>
>         /* Initialize the old and new wtr_spec lists. */
> +        trs_cnt = Calloc(1, struct wtr_spec);
> +        trs_cnt->type = WTR_INIT;
> +        trs_cnt->next = NULL;
>         trs_old = Calloc(1, struct wtr_spec);
>         trs_old->type = WTR_INIT;
>         trs_old->next = NULL;
> @@ -2084,6 +2098,7 @@
>         if(nc < 0) error(_("invalid multibyte string 'old'"));
>         wc = (wchar_t *) R_AllocStringBuffer((nc+1)*sizeof(wchar_t), &cbuff);
>         mbstowcs(wc, s, nc + 1);
> +        wtr_build_spec(wc, trs_cnt); /* use count only */
>         wtr_build_spec(wc, trs_old);
>
>        s = translateChar(STRING_ELT(_new, 0));
> @@ -2096,38 +2111,54 @@
>         /* Initialize the pointers for walking through the old and new
>            wtr_spec lists and retrieving the next chars from the lists.
>         */
> +        trs_cnt_ptr = Calloc(1, struct wtr_spec *);
> +        *trs_cnt_ptr = trs_cnt->next;
> +       for( xtable_cnt = 0 ; wtr_get_next_char_from_spec(trs_cnt_ptr)
> ;xtable_cnt++ );
> +       Free(trs_cnt_ptr);
> +       xtable = (xtable_t *)R_alloc(xtable_cnt+1,sizeof(xtable_t));
> +
>         trs_old_ptr = Calloc(1, struct wtr_spec *);
>         *trs_old_ptr = trs_old->next;
>         trs_new_ptr = Calloc(1, struct wtr_spec *);
>         *trs_new_ptr = trs_new->next;
> -        for(;;) {
> +        for(i=0;;i++) {
>             c_old = wtr_get_next_char_from_spec(trs_old_ptr);
>             c_new = wtr_get_next_char_from_spec(trs_new_ptr);
>             if(c_old == '\0')
>                 break;
>             else if(c_new == '\0')
>                 error(_("'old' is longer than 'new'"));
> -            else
> -                xtable[c_old] = c_new;
> +            else{
> +                xtable[i].c_old=c_old;
> +                xtable[i].c_new=c_new;
> +           }
>         }
> +
>         /* Free the memory occupied by the wtr_spec lists. */
>         wtr_free_spec(trs_old);
>         wtr_free_spec(trs_new);
>         Free(trs_old_ptr); Free(trs_new_ptr);
>
> +        qsort(xtable, xtable_cnt, sizeof(xtable_t),
> +              (int(*)(const void *, const void *))xtable_comp);
> +
>         n = LENGTH(x);
>         PROTECT(y = allocVector(STRSXP, n));
>         for(i = 0; i < n; i++) {
>             if (STRING_ELT(x,i) == NA_STRING)
>                 SET_STRING_ELT(y, i, NA_STRING);
>             else {
> +                xtable_t *tbl;
>                 xi = translateChar(STRING_ELT(x, i));
>                 nc = mbstowcs(NULL, xi, 0);
>                 if(nc < 0)
>                     error(_("invalid input multibyte string %d"), i+1);
>                 wc = (wchar_t *)
> R_AllocStringBuffer((nc+1)*sizeof(wchar_t), &cbuff);
>                 mbstowcs(wc, xi, nc + 1);
> -                for(j = 0; j < nc; j++) wc[j] = xtable[wc[j]];
> +                for(j = 0; j < nc; j++)
> +                    if (tbl = bsearch(&wc[j], xtable, xtable_cnt,
> sizeof(xtable_t),
> +                                      (int(*)(const void *, const
> void *))xtable_key_comp))
> +                        wc[j]=tbl->c_new;
>                 nb = wcstombs(NULL, wc, 0);
>                 cbuf = CallocCharBuf(nb);
>                 wcstombs(cbuf, wc, nb + 1);
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Gregor.Gorjanc at bfro.uni-lj.si  Wed Sep 19 15:41:22 2007
From: Gregor.Gorjanc at bfro.uni-lj.si (Gorjanc Gregor)
Date: Wed, 19 Sep 2007 15:41:22 +0200
Subject: [Rd] How to test if R is running on a Mac
Message-ID: <F189E18BBAA8B6479F618B9044CF4E9C0188517825@owa.bfro.uni-lj.si>

Hi!

Is there any way to test if R is running on a Mac? I usually use
value of .Platform$OS.type for windows or unix, but Mac falls in the
latter group.

Thanks, Gregor


From osklyar at ebi.ac.uk  Wed Sep 19 16:11:16 2007
From: osklyar at ebi.ac.uk (Oleg Sklyar)
Date: Wed, 19 Sep 2007 15:11:16 +0100
Subject: [Rd] How to test if R is running on a Mac
In-Reply-To: <F189E18BBAA8B6479F618B9044CF4E9C0188517825@owa.bfro.uni-lj.si>
References: <F189E18BBAA8B6479F618B9044CF4E9C0188517825@owa.bfro.uni-lj.si>
Message-ID: <1190211076.7391.2.camel@maitai.windows.ebi.ac.uk>

I had the same problem. The following line using either 'apple' or
'darwin' does the job for me (tested on many different Macs):

length(grep("apple", tolower(Sys.getenv("R_PLATFORM")))) != 0



On Wed, 2007-09-19 at 15:41 +0200, Gorjanc Gregor wrote:
> Hi!
> 
> Is there any way to test if R is running on a Mac? I usually use
> value of .Platform$OS.type for windows or unix, but Mac falls in the
> latter group.
> 
> Thanks, Gregor
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
-- 
Dr Oleg Sklyar * EBI-EMBL, Cambridge CB10 1SD, UK * +44-1223-494466


From wl2776 at gmail.com  Wed Sep 19 16:28:23 2007
From: wl2776 at gmail.com (Vladimir Eremeev)
Date: Wed, 19 Sep 2007 07:28:23 -0700 (PDT)
Subject: [Rd] How to test if R is running on a Mac
In-Reply-To: <F189E18BBAA8B6479F618B9044CF4E9C0188517825@owa.bfro.uni-lj.si>
References: <F189E18BBAA8B6479F618B9044CF4E9C0188517825@owa.bfro.uni-lj.si>
Message-ID: <12778663.post@talk.nabble.com>



Gregor Gorjanc-2 wrote:
> 
> Hi!
> 
> Is there any way to test if R is running on a Mac? I usually use
> value of .Platform$OS.type for windows or unix, but Mac falls in the
> latter group.
> 
> Thanks, Gregor
> 

What is in .Platform$path.sep?
Windows has ";", unix has ":".
Mac?
-- 
View this message in context: http://www.nabble.com/How-to-test-if-R-is-running-on-a-Mac-tf4481121.html#a12778663
Sent from the R devel mailing list archive at Nabble.com.


From wl2776 at gmail.com  Wed Sep 19 16:29:23 2007
From: wl2776 at gmail.com (Vladimir Eremeev)
Date: Wed, 19 Sep 2007 07:29:23 -0700 (PDT)
Subject: [Rd] How to test if R is running on a Mac
In-Reply-To: <12778663.post@talk.nabble.com>
References: <F189E18BBAA8B6479F618B9044CF4E9C0188517825@owa.bfro.uni-lj.si>
	<12778663.post@talk.nabble.com>
Message-ID: <12778683.post@talk.nabble.com>




Vladimir Eremeev wrote:
> 
> 
> Gregor Gorjanc-2 wrote:
>> 
>> Hi!
>> 
>> Is there any way to test if R is running on a Mac? I usually use
>> value of .Platform$OS.type for windows or unix, but Mac falls in the
>> latter group.
>> 
>> Thanks, Gregor
>> 
> 
> What is in .Platform$path.sep?
> Windows has ";", unix has ":".
> Mac?
> 
And what is in .Platform$file.sep?
-- 
View this message in context: http://www.nabble.com/How-to-test-if-R-is-running-on-a-Mac-tf4481121.html#a12778683
Sent from the R devel mailing list archive at Nabble.com.


From murdoch at stats.uwo.ca  Wed Sep 19 16:34:04 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 19 Sep 2007 10:34:04 -0400
Subject: [Rd] How to test if R is running on a Mac
In-Reply-To: <F189E18BBAA8B6479F618B9044CF4E9C0188517825@owa.bfro.uni-lj.si>
References: <F189E18BBAA8B6479F618B9044CF4E9C0188517825@owa.bfro.uni-lj.si>
Message-ID: <46F1335C.6050107@stats.uwo.ca>

On 9/19/2007 9:41 AM, Gorjanc Gregor wrote:
> Hi!
> 
> Is there any way to test if R is running on a Mac? I usually use
> value of .Platform$OS.type for windows or unix, but Mac falls in the
> latter group.

Remember to also look at .Platform$GUI:  the GUI version behaves quite 
differently from command line R from a user's point of view (both on the 
Mac and on Windows), and occasionally from a programmer's point of view 
(e.g. the graphics device on the Mac).

Duncan


From konrad.smolinski at eui.eu  Wed Sep 19 19:25:41 2007
From: konrad.smolinski at eui.eu (Konrad Smolinski)
Date: Wed, 19 Sep 2007 19:25:41 +0200
Subject: [Rd] building a package - shared library loading problem
Message-ID: <op.tywv03zs5hzuc0@quantile.local>

Dear All,
I am trying to write my first R package and I bump into loading shared  
library problem( working on Mac OS X 10.4.10 as well as Linux Ubuntu).
I want to makes use of (incorporate) a shared library matchinglib.so in  
the package. Library was created via R CMD -SHLIB.
Following 'Writing R Extensions' I place matchinglib.so in the 'libs'  
directory and use NAMESPACE file with an entry:
useDynLib(matchinglib)

Now, executing 'R CMD check mypackage' I face the following error on OS X:
-----------------------------------------------------
* checking whether the package can be loaded ... ERROR
Error in library.dynam(lib, package, package.lib) :
         shared library 'matchinglib' not found
Error: package/namespace load failed for 'cheetah'
Execution halted

It looks like this package has a loading problem: see the messages for
details.
----------------------------------------------------
The same problem occurs under Linux.

Shall I specify a direct path to libs or modify NAMESPACE?

konrad
---
Konrad Smolinski
Economics Department
European University Institute
Badia Fiesolana
Via dei Roccettini 9
I-50014 San Domenico di Fiesole (FI)
ITALY

konrad.smolinski at eui.eu
konrad.smolinski at gmail.com


From jmacdon at med.umich.edu  Tue Sep 18 05:07:01 2007
From: jmacdon at med.umich.edu (James MacDonald)
Date: Mon, 17 Sep 2007 23:07:01 -0400
Subject: [Rd] Best practices - R CMD check and vignettes
Message-ID: <46EF40D5.7050807@med.umich.edu>

Hi,

I have a package that contains two vignettes that both use saved objects 
in the examples directory of the package. With previous versions of R I 
could have a code chunk in the vignette like this:

<<echo=false>>=
load("../examples/somedata.Rdata")
@

followed by a code chunk like

<<eval=false>>=
foo <- bar("data")
@

that simulated the actual reading in of the data (I use a saved object 
to limit package size).

This passed check with previous versions of R, but under R-2.6.0alpha, 
the vignettes are dumped into an inst directory in the <package>.Rcheck 
directory, where Sweave() and texi2dvi() are run. Unfortunately, the 
above code chunks no longer work.

I can certainly hard code the first chunk to find the .Rdata file, but I 
have to imagine there is a much more elegant way to do this.

Any suggestions?

Best,

Jim


-- 
James W. MacDonald, MS
Biostatistician
UMCCC cDNA and Affymetrix Core
University of Michigan
1500 E Medical Center Drive
7410 CCGC
Ann Arbor MI 48109
734-647-5623


From Max.Kuhn at pfizer.com  Wed Sep 19 21:02:58 2007
From: Max.Kuhn at pfizer.com (Kuhn, Max)
Date: Wed, 19 Sep 2007 15:02:58 -0400
Subject: [Rd] Best practices - R CMD check and vignettes
In-Reply-To: <46EF40D5.7050807@med.umich.edu>
Message-ID: <71257D09F114DA4A8E134DEAC70F25D3098FC226@groamrexm03.amer.pfizer.com>

Jim,

But I'm not sure if this works if the package has not been installed (or
it might find a version already installed in your library path), but
give it a try:

   load(system.file("examples", "somedata.Rdata", package = "PkgName"))

Max 

-----Original Message-----
From: r-devel-bounces at r-project.org
[mailto:r-devel-bounces at r-project.org] On Behalf Of James MacDonald
Sent: Monday, September 17, 2007 11:07 PM
To: r-devel at stat.math.ethz.ch
Subject: [Rd] Best practices - R CMD check and vignettes

Hi,

I have a package that contains two vignettes that both use saved objects

in the examples directory of the package. With previous versions of R I 
could have a code chunk in the vignette like this:

<<echo=false>>=
load("../examples/somedata.Rdata")
@

followed by a code chunk like

<<eval=false>>=
foo <- bar("data")
@

that simulated the actual reading in of the data (I use a saved object 
to limit package size).

This passed check with previous versions of R, but under R-2.6.0alpha, 
the vignettes are dumped into an inst directory in the <package>.Rcheck 
directory, where Sweave() and texi2dvi() are run. Unfortunately, the 
above code chunks no longer work.

I can certainly hard code the first chunk to find the .Rdata file, but I

have to imagine there is a much more elegant way to do this.

Any suggestions?

Best,

Jim


-- 
James W. MacDonald, MS
Biostatistician
UMCCC cDNA and Affymetrix Core
University of Michigan
1500 E Medical Center Drive
7410 CCGC
Ann Arbor MI 48109
734-647-5623

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From ggrothendieck at gmail.com  Wed Sep 19 21:30:30 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 19 Sep 2007 15:30:30 -0400
Subject: [Rd] delayedAssign
Message-ID: <971536df0709191230p3a62d94g1dcf8f978dad6305@mail.gmail.com>

The last two lines of example(delayedAssign) give this:

> e <- (function(x, y = 1, z) environment())(1+2, "y", {cat(" HO! "); pi+2})
> (le <- as.list(e)) # evaluates the promises
$x
<promise: 0x032b31f8>
$y
<promise: 0x032b3230>
$z
<promise: 0x032b3268>

which contrary to the comment appears unevaluated.  Is the comment
wrong or is it supposed to return an evaluated result but doesn't?

> R.version.string # Vista
[1] "R version 2.6.0 alpha (2007-09-06 r42791)"


From simon.urbanek at r-project.org  Wed Sep 19 21:41:26 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 19 Sep 2007 15:41:26 -0400
Subject: [Rd] building a package - shared library loading problem
In-Reply-To: <op.tywv03zs5hzuc0@quantile.local>
References: <op.tywv03zs5hzuc0@quantile.local>
Message-ID: <90779A3F-639C-4BB6-BEF2-8FAA752A1C8A@r-project.org>

Konrad,

for a package you should not be using R CMD SHLIB at all. It is used  
internally and for non-package compilation.

If you have a proper source package, you just install it using R CMD  
INSTALL.

To be precise, assuming you have your package and source code in the  
"foo" directory you can create the source package like this:

tar fcz foo_1.0.tar.gz foo

That package doesn't contain any .so objects and thus can be  
installed anywhere using

R CMD INSTALL foo_1.0.tar.gz

That step will create the .so in the appropriate place which differs  
by system and R version. If you want to create a binary package for a  
given platform, use the --build flag.

Please read 'Writing R Extensions' - you just want to use the src  
directory and not mess with libs.

Cheers,
Simon


On Sep 19, 2007, at 1:25 PM, Konrad Smolinski wrote:

> Dear All,
> I am trying to write my first R package and I bump into loading shared
> library problem( working on Mac OS X 10.4.10 as well as Linux Ubuntu).
> I want to makes use of (incorporate) a shared library  
> matchinglib.so in
> the package. Library was created via R CMD -SHLIB.
> Following 'Writing R Extensions' I place matchinglib.so in the 'libs'
> directory and use NAMESPACE file with an entry:
> useDynLib(matchinglib)
>
> Now, executing 'R CMD check mypackage' I face the following error  
> on OS X:
> -----------------------------------------------------
> * checking whether the package can be loaded ... ERROR
> Error in library.dynam(lib, package, package.lib) :
>          shared library 'matchinglib' not found
> Error: package/namespace load failed for 'cheetah'
> Execution halted
>
> It looks like this package has a loading problem: see the messages for
> details.
> ----------------------------------------------------
> The same problem occurs under Linux.
>
> Shall I specify a direct path to libs or modify NAMESPACE?
>
> konrad
> ---
> Konrad Smolinski
> Economics Department
> European University Institute
> Badia Fiesolana
> Via dei Roccettini 9
> I-50014 San Domenico di Fiesole (FI)
> ITALY
>
> konrad.smolinski at eui.eu
> konrad.smolinski at gmail.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From jmacdon at med.umich.edu  Wed Sep 19 22:17:16 2007
From: jmacdon at med.umich.edu (James W. MacDonald)
Date: Wed, 19 Sep 2007 16:17:16 -0400
Subject: [Rd] Best practices - R CMD check and vignettes
In-Reply-To: <71257D09F114DA4A8E134DEAC70F25D3098FC226@groamrexm03.amer.pfizer.com>
References: <71257D09F114DA4A8E134DEAC70F25D3098FC226@groamrexm03.amer.pfizer.com>
Message-ID: <46F183CC.7070703@med.umich.edu>

Thanks, Max. Right after sending that email I was frantically searching 
for the 'Retract' button on my mailer, but evidently there isn't one ;-D.

Anyway, I'm not sure the entire package is installed during either R CMD 
build or R CMD check, so I am not sure that will work. My ill-advised 
idea of hard-coding the path won't work either, since the path will be 
different for these two steps.

However, the obvious fix that occurred to me 1 nanosecond after hitting 
'send' was that the saved objects should just be in the /inst/doc 
directory with the .Rnw files instead of being in some other directory. 
Originally I had the raw data in the /examples directory so users of my 
package could practice using those data, but really I think the only use 
is for building the vignettes, so moving to /inst/doc appears the most 
reasonable course of action.

Best,

Jim



Kuhn, Max wrote:
> Jim,
> 
> But I'm not sure if this works if the package has not been installed (or
> it might find a version already installed in your library path), but
> give it a try:
> 
>    load(system.file("examples", "somedata.Rdata", package = "PkgName"))
> 
> Max 
> 
> -----Original Message-----
> From: r-devel-bounces at r-project.org
> [mailto:r-devel-bounces at r-project.org] On Behalf Of James MacDonald
> Sent: Monday, September 17, 2007 11:07 PM
> To: r-devel at stat.math.ethz.ch
> Subject: [Rd] Best practices - R CMD check and vignettes
> 
> Hi,
> 
> I have a package that contains two vignettes that both use saved objects
> 
> in the examples directory of the package. With previous versions of R I 
> could have a code chunk in the vignette like this:
> 
> <<echo=false>>=
> load("../examples/somedata.Rdata")
> @
> 
> followed by a code chunk like
> 
> <<eval=false>>=
> foo <- bar("data")
> @
> 
> that simulated the actual reading in of the data (I use a saved object 
> to limit package size).
> 
> This passed check with previous versions of R, but under R-2.6.0alpha, 
> the vignettes are dumped into an inst directory in the <package>.Rcheck 
> directory, where Sweave() and texi2dvi() are run. Unfortunately, the 
> above code chunks no longer work.
> 
> I can certainly hard code the first chunk to find the .Rdata file, but I
> 
> have to imagine there is a much more elegant way to do this.
> 
> Any suggestions?
> 
> Best,
> 
> Jim
> 
> 

-- 
James W. MacDonald, M.S.
Biostatistician
Affymetrix and cDNA Microarray Core
University of Michigan Cancer Center
1500 E. Medical Center Drive
7410 CCGC
Ann Arbor MI 48109
734-647-5623


From nilsson.henric at gmail.com  Tue Sep 18 09:52:04 2007
From: nilsson.henric at gmail.com (Henric Nilsson (Private))
Date: Tue, 18 Sep 2007 09:52:04 +0200
Subject: [Rd] R-2.6.0 for Windows, semi-transparent colours and	layout()
In-Reply-To: <Pine.LNX.4.64.0709171534270.27414@gannet.stats.ox.ac.uk>
References: <46EBDF1A.5030501@gmail.com>
	<Pine.LNX.4.64.0709171534270.27414@gannet.stats.ox.ac.uk>
Message-ID: <20070918095204.53lxrk24cgscs008@www.sorch.se>

Prof Ripley,

Quoting Prof Brian Ripley <ripley at stats.ox.ac.uk>:

> On Sat, 15 Sep 2007, Henric Nilsson (Public) wrote:
>
>> Hi,
>>
>> The added support for semi-transparent colours in `windows' under
>> R-2.6.0 for Windows is much appreciated.
>>
>> However, I've discovered that issuing a `layout' (or `par' with
>> arguments `mfcol'/`mfrow') call and then trying to plot several figures
>> with semi-transparent colour on the same page results in only the first
>> one being fully drawn. E.g.
>
> That's not the whole story, as my test examples using multiple subplots
> did work.
>
> The problem I found is that clipping rectangles were being used in some
> places where I cannot find documentation that they should be.
> So explicitly setting the clipping rectangle before each alpha-blending
> call seems to fix the problematic examples, including yours.

Many thanks for looking into and fixing this -- I really appreciate it!


Henric



>>
>>> x <- rnorm(10000)
>>> y <- rnorm(10000)
>>>
>>> layout(matrix(1:2, ncol = 2))
>>> plot(y ~ x, pch = 16, col = rgb(1, 0, 0, 0.15))
>>> plot(y ~ x, pch = 16, col = rgb(1, 0, 0, 0.15))
>>
>> results in the second one having only the axes and box, but no data
>> points. This is under
>>
>>> sessionInfo()
>> R version 2.6.0 alpha (2007-09-14 r42843)
>> i386-pc-mingw32
>>
>> locale:
>> LC_COLLATE=Swedish_Sweden.1252;LC_CTYPE=Swedish_Sweden.1252;LC_MONETARY=Swedish_Sweden.1252;LC_NUMERIC=C;LC_TIME=Swedish_Sweden.1252
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>>
>> Henric
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at stat.berkeley.edu  Wed Sep 19 22:51:11 2007
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Wed, 19 Sep 2007 13:51:11 -0700
Subject: [Rd] How to test if R is running on a Mac
In-Reply-To: <46F1335C.6050107@stats.uwo.ca>
References: <F189E18BBAA8B6479F618B9044CF4E9C0188517825@owa.bfro.uni-lj.si>
	<46F1335C.6050107@stats.uwo.ca>
Message-ID: <59d7961d0709191351l1c4f1b22t84a1db9b246ba26c@mail.gmail.com>

isApple <- function(...) {
  isApple <- FALSE;
  tryCatch({
    ans <- readline("Do you see an Apple key on the keyboard you are
typing on? yes/no");
    isApple <- (ans == "yes");
  }, mouseClick = function(ex) {
    isApple <<- TRUE;
  })
}

/H


On 9/19/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 9/19/2007 9:41 AM, Gorjanc Gregor wrote:
> > Hi!
> >
> > Is there any way to test if R is running on a Mac? I usually use
> > value of .Platform$OS.type for windows or unix, but Mac falls in the
> > latter group.
>
> Remember to also look at .Platform$GUI:  the GUI version behaves quite
> differently from command line R from a user's point of view (both on the
> Mac and on Windows), and occasionally from a programmer's point of view
> (e.g. the graphics device on the Mac).
>
> Duncan
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From hin-tak.leung at cimr.cam.ac.uk  Thu Sep 20 00:37:52 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Wed, 19 Sep 2007 23:37:52 +0100
Subject: [Rd] How to test if R is running on a Mac
In-Reply-To: <59d7961d0709191351l1c4f1b22t84a1db9b246ba26c@mail.gmail.com>
References: <F189E18BBAA8B6479F618B9044CF4E9C0188517825@owa.bfro.uni-lj.si>	<46F1335C.6050107@stats.uwo.ca>
	<59d7961d0709191351l1c4f1b22t84a1db9b246ba26c@mail.gmail.com>
Message-ID: <46F1A4C0.9030702@cimr.cam.ac.uk>

On linux boxes,
   version$os and R.version$os
is 'linux-gnu'. I assume that it would be 'darwin-apple' on
Mac's?

Henrik Bengtsson wrote:
> isApple <- function(...) {
>   isApple <- FALSE;
>   tryCatch({
>     ans <- readline("Do you see an Apple key on the keyboard you are
> typing on? yes/no");
>     isApple <- (ans == "yes");
>   }, mouseClick = function(ex) {
>     isApple <<- TRUE;
>   })
> }
> 
> /H
> 
> 
> On 9/19/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>> On 9/19/2007 9:41 AM, Gorjanc Gregor wrote:
>>> Hi!
>>>
>>> Is there any way to test if R is running on a Mac? I usually use
>>> value of .Platform$OS.type for windows or unix, but Mac falls in the
>>> latter group.
>> Remember to also look at .Platform$GUI:  the GUI version behaves quite
>> differently from command line R from a user's point of view (both on the
>> Mac and on Windows), and occasionally from a programmer's point of view
>> (e.g. the graphics device on the Mac).
>>
>> Duncan
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From p.dalgaard at biostat.ku.dk  Thu Sep 20 00:49:02 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu, 20 Sep 2007 00:49:02 +0200
Subject: [Rd] delayedAssign
In-Reply-To: <971536df0709191230p3a62d94g1dcf8f978dad6305@mail.gmail.com>
References: <971536df0709191230p3a62d94g1dcf8f978dad6305@mail.gmail.com>
Message-ID: <46F1A75E.3030709@biostat.ku.dk>

Gabor Grothendieck wrote:
> The last two lines of example(delayedAssign) give this:
>
>   
>> e <- (function(x, y = 1, z) environment())(1+2, "y", {cat(" HO! "); pi+2})
>> (le <- as.list(e)) # evaluates the promises
>>     
> $x
> <promise: 0x032b31f8>
> $y
> <promise: 0x032b3230>
> $z
> <promise: 0x032b3268>
>
> which contrary to the comment appears unevaluated.  Is the comment
> wrong or is it supposed to return an evaluated result but doesn't?
>
>   
My guess would be that the behaviour is unintended. It should be harder 
than that to get promises visible at the user level. Luke?

>> R.version.string # Vista
>>     
> [1] "R version 2.6.0 alpha (2007-09-06 r42791)"
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ggrothendieck at gmail.com  Thu Sep 20 01:29:49 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 19 Sep 2007 19:29:49 -0400
Subject: [Rd] delayedAssign
In-Reply-To: <971536df0709191230p3a62d94g1dcf8f978dad6305@mail.gmail.com>
References: <971536df0709191230p3a62d94g1dcf8f978dad6305@mail.gmail.com>
Message-ID: <971536df0709191629ld369552p13b5973ee8d29c6b@mail.gmail.com>

Also note that earlier in the same example we have:

> msg <- "old"
> delayedAssign("x", msg)
> msg <- "new!"
> x #- new!
[1] "new!"
> substitute(x) #- msg
x
> R.version.string # Vista
[1] "R version 2.6.0 alpha (2007-09-06 r42791)"

That is substitute(x) gives x, not msg.

On 9/19/07, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> The last two lines of example(delayedAssign) give this:
>
> > e <- (function(x, y = 1, z) environment())(1+2, "y", {cat(" HO! "); pi+2})
> > (le <- as.list(e)) # evaluates the promises
> $x
> <promise: 0x032b31f8>
> $y
> <promise: 0x032b3230>
> $z
> <promise: 0x032b3268>
>
> which contrary to the comment appears unevaluated.  Is the comment
> wrong or is it supposed to return an evaluated result but doesn't?
>
> > R.version.string # Vista
> [1] "R version 2.6.0 alpha (2007-09-06 r42791)"
>


From ggrothendieck at gmail.com  Thu Sep 20 02:05:26 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 19 Sep 2007 20:05:26 -0400
Subject: [Rd] copying promise
Message-ID: <971536df0709191705q25128290sb67da39b0f54077a@mail.gmail.com>

1. Is there some way to copy a promise so that the copy has the same
expression in its promise as the original.  In the following we
y is a promise that we want to copy to z.  We
want z to be a promise based on the expression x since y is a
promise based on the expression x.  Thus the answer to the code
below is desired to be z=2 but its 1, 1 and y in the next three
examples so they are not the answer. See examples at end.

2. Is there some way to determine if a variable holds a promise
without evaluating it?

This code relates to question 1.

# example 1
x <- 0
delayedAssign("y", x)
x <- 1
# this forces y which is not what we want
z <- y
x <- 2
z # 1

# example 2
# this connects to z to x via y which is not what we want
#  since if y is forced then z takes its value from that, not x
x <- 0
delayedAssign("y", x)
delayedAssign("z", y)
x <- 1
y
x <- 2
z # 1

# example 3
# this attempts to assign the expression underlying promise y to z
# which seems closest in spirit to what we want
# but it does not work as intended
x <- 0
delayedAssign("y", x)
delayedAssign("z", substitute(y))
x <- 1
y
x <- 2
z # y

> R.version.string # Vista
[1] "R version 2.6.0 alpha (2007-09-06 r42791)"


From mtmorgan at fhcrc.org  Thu Sep 20 02:25:58 2007
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Wed, 19 Sep 2007 17:25:58 -0700
Subject: [Rd] Sweave vignettes and bitmap on windows
Message-ID: <6phbqbyp4h5.fsf@gopher4.fhcrc.org>

During vignette generation on Windows, Sweave seems to clean up before
all graphics files are completely processed. For instance, if tmp.Rnw
is:

\documentclass[12pt]{article}
\begin{document}
<<>>=
bitmap("afile.png")
plot(1:100)
dev.off()
@ 
\end{document}

Then:

C:\R\tmp>R CMD Sweave tmp.Rnw
Writing to file tmp.tex
Processing code chunks ...
 1 : echo term verbatim

You can now run LaTeX on 'tmp.tex'

C:\R\tmp>Error: /undefinedfilename in (C:\\DOCUME~1\\mtmorgan\\LOCALS~1\\Temp\\R
Operand stack:

Execution stack:
   %interp_exit   .runexec2   --nostringval--   --nostringval--   --nostringval-
  --nostringval--   --nostringval--   false   1   %stopped_push
Dictionary stack:
   --dict:1126/1686(ro)(G)--   --dict:0/20(G)--   --dict:70/200(L)--
Current allocation mode is local
Last OS error: No such file or directory
AFPL Ghostscript 8.54: Unrecoverable error, exit code 1

Note Sweave finishes before the error message appears.  Adding
Sys.sleep(10) appears to give ghostscript a chance to finish, and no
error message is generated.

Are there solutions to this?

C:\R\tmp>R --version
R version 2.6.0 alpha (2007-09-05 r42789)
Copyright (C) 2007 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under the terms of the
GNU General Public License version 2.
For more information about these matters see
http://www.gnu.org/licenses/.

Thanks,
-- 
Martin Morgan
Bioconductor / Computational Biology
http://bioconductor.org


From tshort at eprisolutions.com  Thu Sep 20 03:25:34 2007
From: tshort at eprisolutions.com (tshort)
Date: Wed, 19 Sep 2007 18:25:34 -0700 (PDT)
Subject: [Rd] Sweave vignettes and bitmap on windows
In-Reply-To: <6phbqbyp4h5.fsf@gopher4.fhcrc.org>
References: <6phbqbyp4h5.fsf@gopher4.fhcrc.org>
Message-ID: <12789148.post@talk.nabble.com>


While I don't agree with it, this "feature" of bitmap is deliberate according
to Prof. Ripley:

http://tolstoy.newcastle.edu.au/R/devel/04/09/0682.html

- Tom

Tom Short
EPRI


Martin Morgan wrote:
> 
> During vignette generation on Windows, Sweave seems to clean up before
> all graphics files are completely processed. For instance, if tmp.Rnw
> is:
> 
> \documentclass[12pt]{article}
> \begin{document}
> <<>>=
> bitmap("afile.png")
> plot(1:100)
> dev.off()
> @ 
> \end{document}
> 
> Then:
> 
> C:\R\tmp>R CMD Sweave tmp.Rnw
> Writing to file tmp.tex
> Processing code chunks ...
>  1 : echo term verbatim
> 
> You can now run LaTeX on 'tmp.tex'
> 
> C:\R\tmp>Error: /undefinedfilename in
> (C:\\DOCUME~1\\mtmorgan\\LOCALS~1\\Temp\\R
> Operand stack:
> 
> Execution stack:
>    %interp_exit   .runexec2   --nostringval--   --nostringval--  
> --nostringval-
>   --nostringval--   --nostringval--   false   1   %stopped_push
> Dictionary stack:
>    --dict:1126/1686(ro)(G)--   --dict:0/20(G)--   --dict:70/200(L)--
> Current allocation mode is local
> Last OS error: No such file or directory
> AFPL Ghostscript 8.54: Unrecoverable error, exit code 1
> 
> Note Sweave finishes before the error message appears.  Adding
> Sys.sleep(10) appears to give ghostscript a chance to finish, and no
> error message is generated.
> 
> Are there solutions to this?
> 
> C:\R\tmp>R --version
> R version 2.6.0 alpha (2007-09-05 r42789)
> Copyright (C) 2007 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
> 
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under the terms of the
> GNU General Public License version 2.
> For more information about these matters see
> http://www.gnu.org/licenses/.
> 
> Thanks,
> -- 
> Martin Morgan
> Bioconductor / Computational Biology
> http://bioconductor.org
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
View this message in context: http://www.nabble.com/Sweave-vignettes-and-bitmap-on-windows-tf4484568.html#a12789148
Sent from the R devel mailing list archive at Nabble.com.


From mkimpel at iupui.edu  Thu Sep 20 04:25:03 2007
From: mkimpel at iupui.edu (Mark W Kimpel)
Date: Wed, 19 Sep 2007 22:25:03 -0400
Subject: [Rd] packages MANOR, qvalue,
 and tkWidgets fail install on Fedora 7 with latest R-beta build
Message-ID: <46F1D9FF.2040807@iupui.edu>

Had some packages fail install so I updated to today's R-beta release. 
On updating packages the following packages still fail. sessionInfo 
follows. Mark

Warning messages:
1: In install.packages(update[instlib == l, "Package"], l, contriburl = 
contriburl,  :
   installation of package 'MANOR' had non-zero exit status
2: In install.packages(update[instlib == l, "Package"], l, contriburl = 
contriburl,  :
   installation of package 'qvalue' had non-zero exit status
3: In install.packages(update[instlib == l, "Package"], l, contriburl = 
contriburl,  :
   installation of package 'tkWidgets' had non-zero exit status
 > sessionInfo()
R version 2.6.0 beta (2007-09-18 r42895)
i686-pc-linux-gnu

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] tools     stats     graphics  grDevices utils     datasets  methods
[8] base

other attached packages:
[1] limma_2.11.13          affy_1.15.9            preprocessCore_0.99.18
[4] affyio_1.5.11          Biobase_1.15.33        graph_1.15.20

loaded via a namespace (and not attached):
[1] cluster_1.11.8  rcompgen_0.1-15
-- 

---

Mark W. Kimpel MD  ** Neuroinformatics ** Dept. of Psychiatry
Indiana University School of Medicine

15032 Hunter Court, Westfield, IN  46074

(317) 490-5129 Work, & Mobile & VoiceMail
(317) 663-0513 Home (no voice mail please)


From mtmorgan at fhcrc.org  Thu Sep 20 05:21:15 2007
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Wed, 19 Sep 2007 20:21:15 -0700
Subject: [Rd] packages MANOR, qvalue,
 and tkWidgets fail install on Fedora 7 with latest R-beta build
In-Reply-To: <46F1D9FF.2040807@iupui.edu> (Mark W. Kimpel's message of "Wed,
	19 Sep 2007 22:25:03 -0400")
References: <46F1D9FF.2040807@iupui.edu>
Message-ID: <6ph3axaauok.fsf@gopher4.fhcrc.org>

Hi Mark --

sessionInfo and the warning messages are not enough here. Try to
install one of the failing packages and provide the complete
transcript of the process.

Consider sending this to the Bioconductor mailing lists (bioc-devel,
in particular, since these packages are in the development branch).

Martin

Mark W Kimpel <mkimpel at iupui.edu> writes:

> Had some packages fail install so I updated to today's R-beta release. 
> On updating packages the following packages still fail. sessionInfo 
> follows. Mark
>
> Warning messages:
> 1: In install.packages(update[instlib == l, "Package"], l, contriburl = 
> contriburl,  :
>    installation of package 'MANOR' had non-zero exit status
> 2: In install.packages(update[instlib == l, "Package"], l, contriburl = 
> contriburl,  :
>    installation of package 'qvalue' had non-zero exit status
> 3: In install.packages(update[instlib == l, "Package"], l, contriburl = 
> contriburl,  :
>    installation of package 'tkWidgets' had non-zero exit status
>  > sessionInfo()
> R version 2.6.0 beta (2007-09-18 r42895)
> i686-pc-linux-gnu
>
> locale:
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] tools     stats     graphics  grDevices utils     datasets  methods
> [8] base
>
> other attached packages:
> [1] limma_2.11.13          affy_1.15.9            preprocessCore_0.99.18
> [4] affyio_1.5.11          Biobase_1.15.33        graph_1.15.20
>
> loaded via a namespace (and not attached):
> [1] cluster_1.11.8  rcompgen_0.1-15
> -- 
>
> ---
>
> Mark W. Kimpel MD  ** Neuroinformatics ** Dept. of Psychiatry
> Indiana University School of Medicine
>
> 15032 Hunter Court, Westfield, IN  46074
>
> (317) 490-5129 Work, & Mobile & VoiceMail
> (317) 663-0513 Home (no voice mail please)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin Morgan
Bioconductor / Computational Biology
http://bioconductor.org


From byron.ellis at gmail.com  Thu Sep 20 06:59:46 2007
From: byron.ellis at gmail.com (Byron Ellis)
Date: Wed, 19 Sep 2007 21:59:46 -0700
Subject: [Rd] S4 objects in data frames?
Message-ID: <7098abec0709192159s4282265cre4cd07847b6b5da8@mail.gmail.com>

Is there any way to get S4 objects into a data frame and have the
resulting data frame actually be printable?

After a good deal of work I managed to convert an S4 objects that
holds several other objects into a data.frame object using a custom
as.data.frame method, but I have been unable to discover how to make
the result data.frame printable.

I've tried making format() generic, no dice. It eventually just
wanders down the path to filter.default, which then tries to
(incorrectly) unlist the contained S4 object. Obviously this doesn't
work.

I can make a matrix of these objects without much trouble (there isn't
a reasonable print function there either, but at least it doesn't
error out).

Any clues? Someone who's managed to pull it off? I'm ready to do
something horrible like create a wrapper class that extends character
just to get it to work right, but this will be annoying for other
reasons.

-- 
Byron Ellis (byron.ellis at gmail.com)
"Oook" -- The Librarian


From jago at mclink.it  Thu Sep 20 13:11:16 2007
From: jago at mclink.it (stefano iacus)
Date: Thu, 20 Sep 2007 13:11:16 +0200
Subject: [Rd] How to test if R is running on a Mac
In-Reply-To: <46F1A4C0.9030702@cimr.cam.ac.uk>
References: <F189E18BBAA8B6479F618B9044CF4E9C0188517825@owa.bfro.uni-lj.si>
	<46F1335C.6050107@stats.uwo.ca>
	<59d7961d0709191351l1c4f1b22t84a1db9b246ba26c@mail.gmail.com>
	<46F1A4C0.9030702@cimr.cam.ac.uk>
Message-ID: <0A639C18-F8ED-4514-88CE-96258C68BBC8@mclink.it>

what about

 > system("uname")
Darwin

stefano
p.s. if one day R will run on the iPhone, you have to change the  
question below into "Do you see an apple logo somewhere on your  
device?")

On 20/set/07, at 00:37, Hin-Tak Leung wrote:

> On linux boxes,
>    version$os and R.version$os
> is 'linux-gnu'. I assume that it would be 'darwin-apple' on
> Mac's?
>
> Henrik Bengtsson wrote:
>> isApple <- function(...) {
>>   isApple <- FALSE;
>>   tryCatch({
>>     ans <- readline("Do you see an Apple key on the keyboard you are
>> typing on? yes/no");
>>     isApple <- (ans == "yes");
>>   }, mouseClick = function(ex) {
>>     isApple <<- TRUE;
>>   })
>> }
>>
>> /H
>>
>>
>> On 9/19/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>>> On 9/19/2007 9:41 AM, Gorjanc Gregor wrote:
>>>> Hi!
>>>>
>>>> Is there any way to test if R is running on a Mac? I usually use
>>>> value of .Platform$OS.type for windows or unix, but Mac falls in  
>>>> the
>>>> latter group.
>>> Remember to also look at .Platform$GUI:  the GUI version behaves  
>>> quite
>>> differently from command line R from a user's point of view (both  
>>> on the
>>> Mac and on Windows), and occasionally from a programmer's point  
>>> of view
>>> (e.g. the graphics device on the Mac).
>>>
>>> Duncan
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Thu Sep 20 13:41:55 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 20 Sep 2007 12:41:55 +0100 (BST)
Subject: [Rd] How to test if R is running on a Mac
In-Reply-To: <0A639C18-F8ED-4514-88CE-96258C68BBC8@mclink.it>
References: <F189E18BBAA8B6479F618B9044CF4E9C0188517825@owa.bfro.uni-lj.si>
	<46F1335C.6050107@stats.uwo.ca>
	<59d7961d0709191351l1c4f1b22t84a1db9b246ba26c@mail.gmail.com>
	<46F1A4C0.9030702@cimr.cam.ac.uk>
	<0A639C18-F8ED-4514-88CE-96258C68BBC8@mclink.it>
Message-ID: <Pine.LNX.4.64.0709201224370.16338@gannet.stats.ox.ac.uk>

On Thu, 20 Sep 2007, stefano iacus wrote:

> what about
>
> > system("uname")
> Darwin

Why not use Sys.info() or R.version to find that?

> stefano
> p.s. if one day R will run on the iPhone, you have to change the
> question below into "Do you see an apple logo somewhere on your
> device?")

And in any case other OSes run on Apple hardware: I believe several R 
developers use a MacBook to run Windows or Linux.  Beyond that, R could be 
running remotely, not on the computer to which the keyboard is attached.
Then there is virtualization which allows one OS to run under another.

So I don't if the question was really

- is R running on Mac hardware
- is R running under MacOS X GUI
- is R running under Darwin
...

which all seem reasonable questions, but different ones.  (MacOS X vs 
Darwin is similar to Solaris vs SunOS: the first of the pair includes a 
user interface and not just an OS.)


>
> On 20/set/07, at 00:37, Hin-Tak Leung wrote:
>
>> On linux boxes,
>>    version$os and R.version$os
>> is 'linux-gnu'. I assume that it would be 'darwin-apple' on
>> Mac's?
>>
>> Henrik Bengtsson wrote:
>>> isApple <- function(...) {
>>>   isApple <- FALSE;
>>>   tryCatch({
>>>     ans <- readline("Do you see an Apple key on the keyboard you are
>>> typing on? yes/no");
>>>     isApple <- (ans == "yes");
>>>   }, mouseClick = function(ex) {
>>>     isApple <<- TRUE;
>>>   })
>>> }
>>>
>>> /H
>>>
>>>
>>> On 9/19/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>>>> On 9/19/2007 9:41 AM, Gorjanc Gregor wrote:
>>>>> Hi!
>>>>>
>>>>> Is there any way to test if R is running on a Mac? I usually use
>>>>> value of .Platform$OS.type for windows or unix, but Mac falls in
>>>>> the
>>>>> latter group.
>>>> Remember to also look at .Platform$GUI:  the GUI version behaves
>>>> quite
>>>> differently from command line R from a user's point of view (both
>>>> on the
>>>> Mac and on Windows), and occasionally from a programmer's point
>>>> of view
>>>> (e.g. the graphics device on the Mac).
>>>>
>>>> Duncan

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From keith at wehi.EDU.AU  Thu Sep 20 14:11:11 2007
From: keith at wehi.EDU.AU (Keith Satterley)
Date: Thu, 20 Sep 2007 22:11:11 +1000
Subject: [Rd] How to test if R is running on a Mac
In-Reply-To: <mailman.23.1190282403.12356.r-devel@r-project.org>
References: <mailman.23.1190282403.12356.r-devel@r-project.org>
Message-ID: <46F2635F.2090801@wehi.edu.au>

I use Sys.info()["sysname"].

It returns "Darwin" on a Mac, "Windows" on MS Windows and "Linux" on my Linux 
box. Is this sufficient for your needs,
I'm using R-2.6.0alpha on MS Windows and 2.5.0 on Mac and Linux at the moment.

cheers,

Keith Satterley
Bioinformatics Division
The Walter and Eliza Hall Institute of Medical Research

r-devel-request at r-project.org wrote:
> Send R-devel mailing list submissions to
> 	r-devel at r-project.org
> Message: 1
> Date: Wed, 19 Sep 2007 15:41:22 +0200
> From: Gorjanc Gregor <Gregor.Gorjanc at bfro.uni-lj.si>
> Subject: [Rd] How to test if R is running on a Mac
> To: "r-devel at r-project.org" <r-devel at r-project.org>
> Message-ID:
> 	<F189E18BBAA8B6479F618B9044CF4E9C0188517825 at owa.bfro.uni-lj.si>
> Content-Type: text/plain; charset="us-ascii"
> 
> Hi!
> 
> Is there any way to test if R is running on a Mac? I usually use
> value of .Platform$OS.type for windows or unix, but Mac falls in the
> latter group.
> 
> Thanks, Gregor


From andy_liaw at merck.com  Thu Sep 20 14:55:08 2007
From: andy_liaw at merck.com (Liaw, Andy)
Date: Thu, 20 Sep 2007 08:55:08 -0400
Subject: [Rd] aperm doesn't copy attributes
Message-ID: <39B6DDB9048D0F4DAD42CB26AAFF0AFA04B2986B@usctmx1106.merck.com>

In the "Value" section of ?aperm, I see:

`... In each case other attributes are copied from a.'

However:

R> f <- factor(sample(letters[1:2], 10, replace=TRUE))
R> dim(f) <- c(5, 2)
R> t(f)
     [,1] [,2] [,3] [,4] [,5]
[1,] a    a    b    b    b   
[2,] a    a    b    a    a   
Levels: a b
R> aperm(f, c(2, 1))
     [,1] [,2] [,3] [,4] [,5]
[1,]    1    1    2    2    2
[2,]    1    1    2    1    1

Examining attributes() of the above shows that the result from aperm
only retained the dim attribute.

Does this qualify as a bug?

R> sessionInfo()
R version 2.6.0 beta (2007-09-18 r42895) 
i386-pc-mingw32 

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
States.1252;LC_MONETARY=English_United
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


--
Andy Liaw, PhD
Biometrics Research    PO Box 2000 RY33-300
Merck Research Labs        Rahway, NJ 07065
andy_liaw(a)merck.com          732-594-0820



------------------------------------------------------------------------------
Notice:  This e-mail message, together with any attachments,...{{dropped}}


From mtmorgan at fhcrc.org  Thu Sep 20 20:01:25 2007
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Thu, 20 Sep 2007 11:01:25 -0700
Subject: [Rd] Locale problems with too-fancy quotes in Windows CMD.exe
Message-ID: <6ph1wctmd1m.fsf@gopher4.fhcrc.org>

'Fancy' quotes are displayed incorrectly when running R from Windows'
CMD shell (Start -> Run -> CMD; latin small letter ae and capital
letter AE; as a script or interactively)). Is this a system
configuration issue, and if so how can I correct it?

C:\R>Rscript -e sQuote('x')
[1] "?x?"

C:\R>R --version
R version 2.6.0 beta (2007-09-20 r42920)
Copyright (C) 2007 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

Windows is XP 2002 SP2
-- 
Martin Morgan
Bioconductor / Computational Biology
http://bioconductor.org


From thomas.friedrichsmeier at ruhr-uni-bochum.de  Thu Sep 20 20:54:17 2007
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: Thu, 20 Sep 2007 20:54:17 +0200
Subject: [Rd] copying promise
In-Reply-To: <971536df0709191705q25128290sb67da39b0f54077a@mail.gmail.com>
References: <971536df0709191705q25128290sb67da39b0f54077a@mail.gmail.com>
Message-ID: <200709202054.20978.thomas.friedrichsmeier@ruhr-uni-bochum.de>

Hi,

On Thursday 20 September 2007, Gabor Grothendieck wrote:
> 1. Is there some way to copy a promise so that the copy has the same
> expression in its promise as the original.

As far as I am aware (which is not very far at all), there is no way to do 
this in R code. However, it's fairly simple to achieve this in C. For 
example, the following C function is basically the same as

# assign (name, get (name, envir=fromenv), envir=toenv)

except that it does not force any promises:

SEXP doCopyNoEval (SEXP name, SEXP fromenv, SEXP toenv) {
	if(!isString (name) || length (name) != 1) error ("name is not a single 
string");
	if(!isEnvironment (fromenv)) error ("fromenv is not an environment");
	if(!isEnvironment (toenv)) error ("toenv is not an environment");
	defineVar (Rf_install (CHAR (STRING_ELT (name, 0))), findVar (Rf_install 
(CHAR (STRING_ELT (name, 0))), fromenv), toenv);
	return (R_NilValue);
}

> 2. Is there some way to determine if a variable holds a promise
> without evaluating it?

Similarly, in C, determining whether an object is a promise is as easy as
# if (TYPEOF (object) == PROMSXP) {}

We use both in RKWard to peek at objects while making sure not to force any 
promises.

Regards
Thomas
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20070920/bd415005/attachment.bin 

From ripley at stats.ox.ac.uk  Thu Sep 20 21:02:31 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 20 Sep 2007 20:02:31 +0100 (BST)
Subject: [Rd] Locale problems with too-fancy quotes in Windows CMD.exe
In-Reply-To: <6ph1wctmd1m.fsf@gopher4.fhcrc.org>
References: <6ph1wctmd1m.fsf@gopher4.fhcrc.org>
Message-ID: <Pine.LNX.4.64.0709201956010.10006@gannet.stats.ox.ac.uk>

On Thu, 20 Sep 2007, Martin Morgan wrote:

> 'Fancy' quotes are displayed incorrectly when running R from Windows'
> CMD shell (Start -> Run -> CMD; latin small letter ae and capital
> letter AE; as a script or interactively)). Is this a system
> configuration issue, and if so how can I correct it?

Yes, use chcp in the terminal or use options(fancyQuotes=FALSE) in R.

Since you are I suppose (I am for some reason supposed to be able to 
divine, as you don't say and nor does your email address) in the USA, chcp 
1252 is probably what you need.  Ask Microsoft why it sets up terminals in 
a different codepage from the Windows' session running: it baffles many 
people.

>
> C:\R>Rscript -e sQuote('x')
> [1] "?x?"
>
> C:\R>R --version
> R version 2.6.0 beta (2007-09-20 r42920)
> Copyright (C) 2007 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
>
> Windows is XP 2002 SP2
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From mtmorgan at fhcrc.org  Thu Sep 20 21:28:53 2007
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Thu, 20 Sep 2007 12:28:53 -0700
Subject: [Rd] Locale problems with too-fancy quotes in Windows CMD.exe
In-Reply-To: <Pine.LNX.4.64.0709201956010.10006@gannet.stats.ox.ac.uk> (Brian
	Ripley's message of "Thu, 20 Sep 2007 20:02:31 +0100 (BST)")
References: <6ph1wctmd1m.fsf@gopher4.fhcrc.org>
	<Pine.LNX.4.64.0709201956010.10006@gannet.stats.ox.ac.uk>
Message-ID: <6phejgtkufe.fsf@gopher4.fhcrc.org>

Yes, sorry about the divination. FWIW I've seen another report of this
(in passing, while addressing another issue) on the Bioconductor
mailing list, and suspect that US users (and others?) will frequently
be perplexed, perhaps spending significant time trying to track down
how the 'wrong' data got into R.

Doing

c:\> chcp 1252
Active code page: 1252

Allows smart quotes to display correctly.

Thanks,

Martin

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> On Thu, 20 Sep 2007, Martin Morgan wrote:
>
>> 'Fancy' quotes are displayed incorrectly when running R from Windows'
>> CMD shell (Start -> Run -> CMD; latin small letter ae and capital
>> letter AE; as a script or interactively)). Is this a system
>> configuration issue, and if so how can I correct it?
>
> Yes, use chcp in the terminal or use options(fancyQuotes=FALSE) in R.
>
> Since you are I suppose (I am for some reason supposed to be able to
> divine, as you don't say and nor does your email address) in the USA,
> chcp 1252 is probably what you need.  Ask Microsoft why it sets up
> terminals in a different codepage from the Windows' session running:
> it baffles many people.
>
>>
>> C:\R>Rscript -e sQuote('x')
>> [1] "?x?"
>>
>> C:\R>R --version
>> R version 2.6.0 beta (2007-09-20 r42920)
>> Copyright (C) 2007 The R Foundation for Statistical Computing
>> ISBN 3-900051-07-0
>>
>> Windows is XP 2002 SP2
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-- 
Martin Morgan
Bioconductor / Computational Biology
http://bioconductor.org


From btyner at gmail.com  Thu Sep 20 23:04:53 2007
From: btyner at gmail.com (Benjamin Tyner)
Date: Thu, 20 Sep 2007 17:04:53 -0400
Subject: [Rd] suggestion for read.table
Message-ID: <5f88b2c50709201404w5c50dc33pfc49f6a55ad69a48@mail.gmail.com>

R-devel,

IMHO, in readtable.R, the scan command


if (nlines > 1)
            for (i in seq_along(col))
                col[i] <- length(scan(file, what = "", sep = sep,
                                      quote = quote,
                                      nlines = 1, quiet = TRUE, skip = 0,
                                      strip.white = strip.white,
                                      blank.lines.skip = blank.lines.skip,
                                      comment.char = comment.char,
                                      allowEscapes = allowEscapes))
        cols <- max(col1, col)


should have fill = fill added. Otherwise, when fill = TRUE, it is
possible for the warning

warning("header and 'col.names' are of different lengths")

to be inadvertantly triggered further down.

Ben


From btyner at gmail.com  Thu Sep 20 23:07:18 2007
From: btyner at gmail.com (Benjamin Tyner)
Date: Thu, 20 Sep 2007 17:07:18 -0400
Subject: [Rd] suggestion for read.table
In-Reply-To: <5f88b2c50709201404w5c50dc33pfc49f6a55ad69a48@mail.gmail.com>
References: <5f88b2c50709201404w5c50dc33pfc49f6a55ad69a48@mail.gmail.com>
Message-ID: <5f88b2c50709201407u64a90e2ay6defcfabb1af5397@mail.gmail.com>

Correction: the warning would be triggered by

warning("cols = ", cols, " != length(data) = ", length(data), domain = NA)

Ben

On 9/20/07, Benjamin Tyner <btyner at gmail.com> wrote:
> R-devel,
>
> IMHO, in readtable.R, the scan command
>
>
> if (nlines > 1)
>             for (i in seq_along(col))
>                 col[i] <- length(scan(file, what = "", sep = sep,
>                                       quote = quote,
>                                       nlines = 1, quiet = TRUE, skip = 0,
>                                       strip.white = strip.white,
>                                       blank.lines.skip = blank.lines.skip,
>                                       comment.char = comment.char,
>                                       allowEscapes = allowEscapes))
>         cols <- max(col1, col)
>
>
> should have fill = fill added. Otherwise, when fill = TRUE, it is
> possible for the warning
>
> warning("header and 'col.names' are of different lengths")
>
> to be inadvertantly triggered further down.
>
> Ben
>


From hin-tak.leung at cimr.cam.ac.uk  Fri Sep 21 04:13:56 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Fri, 21 Sep 2007 03:13:56 +0100
Subject: [Rd] How to test if R is running on a Mac
In-Reply-To: <0A639C18-F8ED-4514-88CE-96258C68BBC8@mclink.it>
References: <F189E18BBAA8B6479F618B9044CF4E9C0188517825@owa.bfro.uni-lj.si>
	<46F1335C.6050107@stats.uwo.ca>
	<59d7961d0709191351l1c4f1b22t84a1db9b246ba26c@mail.gmail.com>
	<46F1A4C0.9030702@cimr.cam.ac.uk>
	<0A639C18-F8ED-4514-88CE-96258C68BBC8@mclink.it>
Message-ID: <46F328E4.7020606@cimr.cam.ac.uk>

Prof Ripley had already spoken with a better solution (Sys.info())...

The problem with system("uname") is that it depends on shell behavior
and also the availability of an external utility - 'uname' - i.e. 
although it would work as intended on mac OS X, it would die on windows 
due to not having 'uname' or 'uname' not working the same way... plus 
the usual stdout vs console complications on windows, etc.

stefano iacus wrote:
> what about
> 
>  > system("uname")
> Darwin
> 
> stefano
> p.s. if one day R will run on the iPhone, you have to change the 
> question below into "Do you see an apple logo somewhere on your device?")
> 
> On 20/set/07, at 00:37, Hin-Tak Leung wrote:
> 
>> On linux boxes,
>>    version$os and R.version$os
>> is 'linux-gnu'. I assume that it would be 'darwin-apple' on
>> Mac's?
>>
>> Henrik Bengtsson wrote:
>>> isApple <- function(...) {
>>>   isApple <- FALSE;
>>>   tryCatch({
>>>     ans <- readline("Do you see an Apple key on the keyboard you are
>>> typing on? yes/no");
>>>     isApple <- (ans == "yes");
>>>   }, mouseClick = function(ex) {
>>>     isApple <<- TRUE;
>>>   })
>>> }
>>>
>>> /H
>>>
>>>
>>> On 9/19/07, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>>>> On 9/19/2007 9:41 AM, Gorjanc Gregor wrote:
>>>>> Hi!
>>>>>
>>>>> Is there any way to test if R is running on a Mac? I usually use
>>>>> value of .Platform$OS.type for windows or unix, but Mac falls in the
>>>>> latter group.
>>>> Remember to also look at .Platform$GUI:  the GUI version behaves quite
>>>> differently from command line R from a user's point of view (both on 
>>>> the
>>>> Mac and on Windows), and occasionally from a programmer's point of view
>>>> (e.g. the graphics device on the Mac).
>>>>
>>>> Duncan
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From ggrothendieck at gmail.com  Fri Sep 21 14:22:55 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 21 Sep 2007 08:22:55 -0400
Subject: [Rd] warning upon automatic close of connection
In-Reply-To: <m2odg8m11z.fsf@fhcrc.org>
References: <971536df0709120521t6f7406fcic41a5e3874c488ec@mail.gmail.com>
	<m2odg8m11z.fsf@fhcrc.org>
Message-ID: <971536df0709210522w1ff3c636nca2db70d0c8c48cc@mail.gmail.com>

I would like to follow up on the annoying warnings which are generated
when connections are automatically closed.  This is affecting several of
my packages and is quite a nuisance.

R does not give you a message every time it garbage collects, at least
by default.  Perhaps there could be a higher level of warnings that issue
information on garbage collection, closed connections, etc. or perhaps the
user could have control over it but having it as the default is really
a nuisance
and I hope this warning can be removed.

On 9/12/07, Seth Falcon <sfalcon at fhcrc.org> wrote:
> "Gabor Grothendieck" <ggrothendieck at gmail.com> writes:
> > I noticed that under R 2.6.0 there is a warning about closing the connection
> > in the code from this post:
> > https://stat.ethz.ch/pipermail/r-help/2007-September/140601.html
> >
> > which is evidently related to the following from the NEWS file:
> >
> >     o Connections will be closed if there is no R object referring to
> >       them.  A warning is issued if this is done, either at garbage
> >       collection or if all the connection slots are in use.
> >
> > If we use read.table directly it still happens:
> >
> > # use Lines and Lines2 from cited post
> > library(zoo)
> > DF1 <- read.table(textConnection(Lines), header = TRUE)
> > DF2 <- read.table(textConnection(Lines2), header = TRUE)
> > z1 <- zoo(as.matrix(DF1[-1]), as.Date(DF1[,1], "%d/%m/%Y"))
> > z2 <- zoo(as.matrix(DF2[-1]), as.Date(DF2[,1], "%d/%m/%Y"))
> > both <- merge(z1, z2)
> > plot(na.approx(both))
> >
> >> R.version.string # Vista
> > [1] "R version 2.6.0 alpha (2007-09-06 r42791)"
> >
> > Is this annoying warning really necessary?  I assume we can get rid of
> > it by explicitly naming and closing the connections but surely there should
> > be a way to avoid the warning without going to those lengths.
>
> Up until the change you mention above it really was necessary to name
> and close all connections.  Short scripts run in fresh R sessions may
> not have had problems with code like you have written above, but
> longer programs or shorter ones run in a long running R session would
> run out of connections.
>
> Now that connections have weak reference semantics, one can ask
> whether this behavior should be "standard" and no warning issued.
>
> > I would have thought that read.table opens the connection then it would
> > close it itself so no warning would need to be generated.
>
> In your example, read.table is _not_ opening the connection.  You are
> passing an open connection which has no symbol bound to it:
>
>   foo = ""
>   c = textConnection(foo)
>   c
>     description            class             mode             text
>           "foo" "textConnection"              "r"           "text"
>          opened         can read        can write
>        "opened"            "yes"             "no"
>
> But I think passing a closed connection would cause the same sort of
> issue.  It seems that there are two notions of "closing a connection":
> (i) close as the opposite of open, and (ii) clean up the entire
> connection object.  I haven't looked closely at the code here, so I
> could be wrong, but I'm basing this guess on the following:
>
> > file("foo")
> description       class        mode        text      opened    can read
>      "foo"      "file"         "r"      "text"    "closed"       "yes"
>  can write
>      "yes"
> ## start new R session
> for (i in 1:75) file("foo")
> gc()
> warnings()[1:3]
> > gc()
>         used (Mb) gc trigger (Mb) max used (Mb)
> Ncells 149603  4.0     350000  9.4   350000  9.4
> Vcells 101924  0.8     786432  6.0   486908  3.8
> There were 50 or more warnings (use warnings() to see the first 50)
> > warnings()[1:3]
> $`closing unused connection 76 (foo)`
> NULL
>
> $`closing unused connection 75 (foo)`
> NULL
>
> $`closing unused connection 74 (foo)`
> NULL
>
>
> --
> Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
> BioC: http://bioconductor.org/
> Blog: http://userprimary.net/user/
>


From christophe.vuadens at unil.ch  Mon Sep 17 07:30:14 2007
From: christophe.vuadens at unil.ch (christophe vuadens)
Date: Sun, 16 Sep 2007 22:30:14 -0700 (PDT)
Subject: [Rd] Call C code from R
In-Reply-To: <web-11654315@hermes.nsu.ru>
References: <web-11654315@hermes.nsu.ru>
Message-ID: <12729578.post@talk.nabble.com>


maybe try this page,

http://www.math.ncu.edu.tw/~chenwc/R_note/index.php?item=R_call

i'm not alrigth with this but i try

Christophe
-- 
View this message in context: http://www.nabble.com/Call-C-code-from-R-tf4463938.html#a12729578
Sent from the R devel mailing list archive at Nabble.com.


From therneau at mayo.edu  Mon Sep 17 23:11:54 2007
From: therneau at mayo.edu (Terry Therneau)
Date: Mon, 17 Sep 2007 16:11:54 -0500 (CDT)
Subject: [Rd] Date vs date (long)
Message-ID: <200709172111.l8HLBsF24362@hsrnfs-101.mayo.edu>

Peter et al

  Thanks for the comments on dates.  Some of the respondents missed the point,
by showing ways that I could work around the problems, when my main argument
is that one shouldn't have to work around problems.  So I hereto present
round 2 of the debate.

 1 Postulates

   a. In my 35 year computing experience, I think that nothing frustrates me
more than a computer program that tries to keep me from doing something
"for my own protection", when I know quite well what I am doing.  So postulate
1 is a Bayesian sort of thing: the loss function is so large (hopping mad
user) that one should be very cautious about creating a taboo.

   b. The S language's primary success is as a tool.  Tools get used in ways
that the originator never thought of.  Alternate use is not wrong --- in
fact you want to foster it.  (My farm backround plays a role here.  You wouldn't
believe the number of things I've fixed with a hammer and/or wrench, when the
goal was not to get it done "right", but just to get whatever done and get the 
crop in.)

  
 2 Key question

  Both a data and a time-span object consist of a numeric value along with
ancillary information about how to interpret that value.  For simplicity call
the latter "attributes" (ignoring whether they are implemented using the attr
function or slots or whatever).
  For some operations is is fairly clear what do to with both the attr and the
numeric part, e.g., date + 1 is the next day.  No problem here.

  For other operations, e.g., timespan^2 it is only clear that the result is no
longer a timespan, but not what class it should be.  I firmly believe that the
right result is to toss the attribute and return the number.  This makes
the tool optimally useful.  Returning an error message is an unneccesary
and controlling  response: what good did the "not legal" message do me?
There are of course many cases where an error message is the only choice,
because I can't see what to do with either the number or the attribute, 
e.g.  date + string.

  The key question is then "what is the right philosphy", flexible tool or
rigorous control?  Rigorous control languages have not fared well historically.

3 Hard cases

  The hardest are cases where the right return value is unclear.  An example
is (date + 1.73) : should one return a true date, which is integer, allow
an invalid internal value that is "fixed" at print time, return a numeric,
or an error message?

   I put (timespan/constant) in this category.  The author has no hint as to
whether the constant is unitless or not.  In the medical research environment
converstions back and forth from days to months and years are very common,
greatly outmassing division of an iterval into pieces, so if I had to guess
I would assume that I had to drop the units; another environment might be
just the opposite.

4 Response to particular points:

Peter D, 9/14
  a. as.Date(x)
Peter suggests (as.Date('1960-1-1') + x).  This is a really good idea, as it
makes the code both origin independent and clearer.

  b. "I'd advise against numeric operation on difftime objects in general, 
because of the unspecified units."
  If I carry this idea forward, the R should insist that I specify units for
any variable that corresponds to a physical quantity, e.g. "height" or 
"weight", so that it can slap my hands with an error message when I type

	bodyMassIndex = weight/ height^2

or cause plot(height^2, weight) to fail.  This would go a long way towards
making R the most frustrating program available.  (An Microsoft gives some
stiff competition in that area!)

 c. 
"It is assumed that the divisor is unit-less. 
Convert to numeric first to avoid this. (The idea has been raised to 
introduce new units: epiyears and epimonths, in which case you might do

x <- as.Date('2007-9-14') - as.Date('1953-3-10')
units(x) <- "epiyears"

which would give you the age in years for those purposes where you don't 
care missing the exact birthday by a day or so.)"

   As I said, division is a hard case with no clear answer.  The creation of
other unit schemes is silly --- why in the world would I voluntarily put on
a straightjacket?

d. 
>> as.Date('09Sep2007')
>>     
> Error in fromchar(x) : character string is not in a standard unambiguous 
format

  My off-the-cuff suggestion is to make the message honest
	Error in fromchar(x): program is not able to divine the correct format

The problem is not that the format is necessarily wrong or ambiguous, but that
the program can't guess.  (Which is no real fault of the program - such 
a recognition is a hard problem.  It's ok to ask me for a format string).

--
Hadley Wickham
"Why not just always use seconds for difftime objects?  An attribute
could control how it was formatted, but would be independent of the
underlying representation."

  This misses the point.

-------

Gabor Grothendieck 

as.Date(10)
You can define as.Date.numeric in your package and then it will work.  zoo
has done that.

library(zoo)
as.Date(10)

  This is also a nice idea.  Although adding to a package is possible, it is
now very hard to take away, given namespaces.  That is, I can't define my
own Math.Date to do away with the creation of timespan objects.  Am I
correct?  Is it also true that adding methods is hard if one uses version 4
classes?

  The rest of Gabor's comments are workarounds for the problem I raised.
But I don't want to have to wrap "as.numeric" around all of my date 
calculations.

-----------
Brian Ripley

"It fails by design.  Using sqrt() on a measurement that has an arbitrary 
origin would not have been good design."

  Ah, the classic Unix response of "that's not a bug, it's a feature".

  What is interesting is that this is almost precisely the response I
got when I first argued for a global na.action default.  John C (I think)
replied that, essentially, S SHOULD slap you alonside the head when
there were missing values.  They require careful thought wrt good analysis,
and allowing a global option was bad design because it would encourage bad
statistics.  The Insightful side of the debate said they didn't dare because
is might break something.  After getting nowhere with talking I finally
gave up and wrote my own version into the survival code.  This leverage 
eventually forced adoption of the idea.
   Not many (any?) people currently set na.action=na.fail because it is
a "better design". 
------------------

Historically, languages designed for other people to use have been bad: Cobol,
PL/I, Pascal, Ada, C++. The good languages have been those that were designed 
for their own creators: C, Perl, Smalltalk, Lisp. (Paul Graham)

   


   Terry Therneau


From sebastien.villemot at ens.fr  Tue Sep 18 18:37:44 2007
From: sebastien.villemot at ens.fr (sebastien.villemot at ens.fr)
Date: Tue, 18 Sep 2007 18:37:44 +0200 (CEST)
Subject: [Rd] rbind.data.frame converts character column to factor (PR#9917)
Message-ID: <20070918163744.CED7F66835@slim.kubism.ku.dk>

Full_Name: S?bastien Villemot
Version: 2.5.1
OS: Debian GNU/Linux (Testing aka "Lenny")
Submission from: (NULL) (193.51.127.120)


Here is the transcript of a R session under version 2.5.1:

> x <- data.frame(a = I(character(0)))
> typeof(x$a)
[1] "character"
> x <- rbind(x, list(a = "foo"))
> typeof(x$a)
[1] "integer"

The column "a" has been converted from character to factor.

This was not happening under version 2.4.0 Patched (2006-11-25 r39997):
> x <- data.frame(a = I(character(0)))
> typeof(x$a)
[1] "character"
> x <- rbind(x, list(a = "foo"))
> typeof(x$a)
[1] "character"

Furthermore, the bug doesn't show up (in 2.5.1) if the data frame is initially
non-empty:
> x <- data.frame(a = I("bar"))
> typeof(x$a)
[1] "character"
> x <- rbind(x, list(a = "foo"))
> typeof(x$a)
[1] "character"

Best,

S?bastien Villemot


From stefano.iacus at unimi.it  Wed Sep 19 17:15:55 2007
From: stefano.iacus at unimi.it (stefano iacus)
Date: Wed, 19 Sep 2007 17:15:55 +0200
Subject: [Rd] How to test if R is running on a Mac
In-Reply-To: <46F1335C.6050107@stats.uwo.ca>
References: <F189E18BBAA8B6479F618B9044CF4E9C0188517825@owa.bfro.uni-lj.si>
	<46F1335C.6050107@stats.uwo.ca>
Message-ID: <015D961A-260A-4822-8E52-AD8E092CBD9E@unimi.it>

what about

 > system("uname")
 >
Darwin


stefano

On 19/set/07, at 16:34, Duncan Murdoch wrote:

> On 9/19/2007 9:41 AM, Gorjanc Gregor wrote:
>> Hi!
>>
>> Is there any way to test if R is running on a Mac? I usually use
>> value of .Platform$OS.type for windows or unix, but Mac falls in the
>> latter group.
>
> Remember to also look at .Platform$GUI:  the GUI version behaves quite
> differently from command line R from a user's point of view (both  
> on the
> Mac and on Windows), and occasionally from a programmer's point of  
> view
> (e.g. the graphics device on the Mac).
>
> Duncan
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From HDoran at air.org  Thu Sep 20 23:22:18 2007
From: HDoran at air.org (HDoran at air.org)
Date: Thu, 20 Sep 2007 23:22:18 +0200 (CEST)
Subject: [Rd] Bug with Cor(..., method='spearman") and by() (PR#9921)
Message-ID: <20070920212218.C2F27668EE@slim.kubism.ku.dk>

I posted this on R help, and a few others responded indicating they too
were able to replicate the error as a function of missing data. I
believe this should not be the case and hence and reporting it here.

### Code provided on R-Help by Ivar Herfindal
# Simulate data
testdata <- cbind.data.frame(gr=3Drep(letters[1:4], each=3D5), =
aa=3Drnorm(20),
bb=3Drnorm(20))
# Introduce some missingness
testdata[1:5, 2] <- NA

# This works fine
by(testdata[,c("aa", "bb")], testdata$gr, cor, use=3D"complete",
method=3D"pearson")

# This induces error
by(testdata[,c("aa", "bb")], testdata$gr, cor, use=3D"complete",
method=3D"spearman")

Error in FUN(data[x, ], ...) : 'x' is empty

## Alternatively, we can try this

# This works fine
by(testdata[,c('aa', 'bb')], testdata$gr, cor, use=3D'complete',
method=3D'pearson')

## This induces the same error
by(testdata[,c('aa', 'bb')], testdata$gr, cor, use=3D'complete',
method=3D'spearman')

Error in FUN(data[x, ], ...) : 'x' is empty

I am using Windows XP with session info below

Harold Doran


> sessionInfo()
R version 2.5.0 (2007-04-23)=20
i386-pc-mingw32=20

locale:
LC_COLLATE=3DEnglish_United States.1252;LC_CTYPE=3DEnglish_United
States.1252;LC_MONETARY=3DEnglish_United
States.1252;LC_NUMERIC=3DC;LC_TIME=3DEnglish_United States.1252

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"
"methods"   "base"    =20

other attached packages:
     mlmRev        lme4      Matrix     lattice=20
  "0.995-1" "0.99875-2" "0.99875-3"    "0.15-4"=20


From ripley at stats.ox.ac.uk  Fri Sep 21 15:11:29 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Fri, 21 Sep 2007 15:11:29 +0200 (CEST)
Subject: [Rd] (PR#9917) rbind.data.frame converts character column to
Message-ID: <20070921131129.3BD1A66905@slim.kubism.ku.dk>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--27464147-159404577-1190380210=:1425
Content-Type: TEXT/PLAIN; charset=iso-8859-1; format=flowed
Content-Transfer-Encoding: 8BIT

Please do read the documentation, which says

      The 'rbind' data frame method first drops all zero-column and
      zero-row arguments.

So your first data frame has been dropped, and the result is the same as
rbind.data.frame(list(a = "foo")) which should give a factor column via 
promotion of a list to a data frame.


On Tue, 18 Sep 2007, sebastien.villemot at ens.fr wrote:

> Full_Name: S?bastien Villemot
> Version: 2.5.1
> OS: Debian GNU/Linux (Testing aka "Lenny")
> Submission from: (NULL) (193.51.127.120)
>
>
> Here is the transcript of a R session under version 2.5.1:
>
>> x <- data.frame(a = I(character(0)))
>> typeof(x$a)
> [1] "character"
>> x <- rbind(x, list(a = "foo"))
>> typeof(x$a)
> [1] "integer"
>
> The column "a" has been converted from character to factor.
>
> This was not happening under version 2.4.0 Patched (2006-11-25 r39997):
>> x <- data.frame(a = I(character(0)))
>> typeof(x$a)
> [1] "character"
>> x <- rbind(x, list(a = "foo"))
>> typeof(x$a)
> [1] "character"
>
> Furthermore, the bug doesn't show up (in 2.5.1) if the data frame is initially
> non-empty:
>> x <- data.frame(a = I("bar"))
>> typeof(x$a)
> [1] "character"
>> x <- rbind(x, list(a = "foo"))
>> typeof(x$a)
> [1] "character"
>
> Best,
>
> S?bastien Villemot
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595
--27464147-159404577-1190380210=:1425--


From murdoch at stats.uwo.ca  Fri Sep 21 16:01:15 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 21 Sep 2007 10:01:15 -0400
Subject: [Rd] RSS feed of NEWS items
Message-ID: <46F3CEAB.2030801@stats.uwo.ca>

Last weekend I set up a script to look for daily changes to the NEWS 
file (for all platforms) or the CHANGES file (for Windows), and post 
those online.  The format used may change, but I think I will keep the 
current URLs:

http://developer.r-project.org/blosxom.cgi/R-devel/NEWS

for just the NEWS changes,

http://developer.r-project.org/blosxom.cgi/R-devel/CHANGES

for just the CHANGES changes,

http://developer.r-project.org/blosxom.cgi/R-devel

for both.

I'm using Blosxom (pronounced blossom) to make things available, so you 
can append various things to those URLs:

.../index.rss : Gives an RSS feed, suitable for Google Reader or other 
NEWS aggregators.

.../2007/08/23 : Just see the changes on August 23.  (Leave off 23 for 
all of August, etc.)

I will probably eventually set up a separate R-2-6-branch feed in 
addition to the R-devel feed, but at the moment R-devel is the only 
series being tracked.

Duncan Murdoch


From shawj at spu.edu  Sat Sep 22 03:14:36 2007
From: shawj at spu.edu (Shaw, Jason)
Date: Fri, 21 Sep 2007 18:14:36 -0700
Subject: [Rd] How can I list unregistered routines from loaded DLLs?
Message-ID: <83ECE0ECE6C48E4EAD40647CF370A840021D0D07@SPUMAIL.spu.local>

Hi,

I want to load DLLs that have been compiled in C or C++ (using
dyn.load), and then get a list of all routines contained in that DLL.
getRegisteredRoutines doesn't work, because the routines have not been
registered.  It's a catch-22 because I can't (so far as I can see)
register the routines without knowing their names, and I can't (so far
as I can see) get a list of their names unless they are registered.  Is
there a way around this, besides making guesses about the names and
testing them with is.loaded()?

Thanks in advance,
Jason


From murdoch at stats.uwo.ca  Sat Sep 22 17:24:54 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 22 Sep 2007 11:24:54 -0400
Subject: [Rd] How can I list unregistered routines from loaded DLLs?
In-Reply-To: <83ECE0ECE6C48E4EAD40647CF370A840021D0D07@SPUMAIL.spu.local>
References: <83ECE0ECE6C48E4EAD40647CF370A840021D0D07@SPUMAIL.spu.local>
Message-ID: <46F533C6.3040408@stats.uwo.ca>

Shaw, Jason wrote:
> Hi,
>
> I want to load DLLs that have been compiled in C or C++ (using
> dyn.load), and then get a list of all routines contained in that DLL.
> getRegisteredRoutines doesn't work, because the routines have not been
> registered.  It's a catch-22 because I can't (so far as I can see)
> register the routines without knowing their names, and I can't (so far
> as I can see) get a list of their names unless they are registered.  Is
> there a way around this, besides making guesses about the names and
> testing them with is.loaded()?
You need tools external to R.  pedump (in the Rtools collection) can do 
it on Windows; objdump is a similar utility on Unix platforms.

Duncan Murdoch


From John.Maindonald at anu.edu.au  Sun Sep 23 02:23:36 2007
From: John.Maindonald at anu.edu.au (John.Maindonald at anu.edu.au)
Date: Sun, 23 Sep 2007 02:23:36 +0200 (CEST)
Subject: [Rd] html help fails for named vector objects (PR#9927)
Message-ID: <20070923002336.3332B66893@slim.kubism.ku.dk>

   help(letters, htmlhelp=TRUE) fails.

Under the Mac OSX gui, the message is 'Help for the topic "a" was not  
found.' Under the version documented below, and under Windows, the  
message is

   "No documentation for 'a' in specified packages and libraries:"
repeated for all the elements of letters, then followed by
   "you could try 'help.search("a")'",
again repeated for all elements of letters.

The outcome seems similar for any character vector (including matrix)  
object, e.g. the matrix 'primateDNA' in the DAAGbio package.

The following have the expected result
   help("letters", htmlhelp=TRUE)
   help(letters, htmlhelp=FALSE)

The same result is obtained with R-2.5.1.


--please do not edit the information below--

Version:
platform = i386-apple-darwin8.10.1
arch = i386
os = darwin8.10.1
system = i386, darwin8.10.1
status = beta
major = 2
minor = 6.0
year = 2007
month = 09
day = 22
svn rev = 42941
language = R
version.string = R version 2.6.0 beta (2007-09-22 r42941)

Locale:
C

Search Path:
.GlobalEnv, package:testpkg, package:stats, package:graphics,  
package:grDevices, package:utils, package:datasets, package:methods,  
Autoloads, package:base

John Maindonald             email: john.maindonald at anu.edu.au
phone : +61 2 (6125)3473    fax  : +61 2(6125)5549
Centre for Mathematics & Its Applications, Room 1194,
John Dedman Mathematical Sciences Building (Building 27)
Australian National University, Canberra ACT 0200.


From p.dalgaard at biostat.ku.dk  Sun Sep 23 10:29:44 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sun, 23 Sep 2007 10:29:44 +0200
Subject: [Rd] html help fails for named vector objects (PR#9927)
In-Reply-To: <20070923002336.3332B66893@slim.kubism.ku.dk>
References: <20070923002336.3332B66893@slim.kubism.ku.dk>
Message-ID: <46F623F8.1050608@biostat.ku.dk>

John.Maindonald at anu.edu.au wrote:
>    help(letters, htmlhelp=TRUE) fails.
>
> Under the Mac OSX gui, the message is 'Help for the topic "a" was not  
> found.' Under the version documented below, and under Windows, the  
> message is
>
>    "No documentation for 'a' in specified packages and libraries:"
> repeated for all the elements of letters, then followed by
>    "you could try 'help.search("a")'",
> again repeated for all elements of letters.
>
> The outcome seems similar for any character vector (including matrix)  
> object, e.g. the matrix 'primateDNA' in the DAAGbio package.
>
> The following have the expected result
>    help("letters", htmlhelp=TRUE)
>    help(letters, htmlhelp=FALSE)
>
>   
Not for me. I get the same thing with or without htmlhelp. (That IS what 
I expected, though....)

The logic in help is

    ischar <- try(is.character(topic), silent = TRUE)
    if (inherits(ischar, "try-error"))
        ischar <- FALSE
    if (!ischar)
        topic <- deparse(substitute(topic))

So a character argument implies that it contains the names of help 
topics. That isn't quite what the documentation says, though:

   topic: usually, the name on which documentation is sought. The name
          may be quoted or unquoted (but note that if 'topic' is the
          name of a variable containing a character string
          documentation is provided for the name, not for the character
          string).

It is the documentation that is wrong. We could implement what it says, 
but then it would be a require considerable contortions to get help on a 
topic stored in a variable (e.g., coming from a help field in a GUI).

It isn't clear to me that  it should try all elements of a character 
vector of length > 1. That looks like a bit of a booby trap to me -- 
what if it accidentally caught a variable with a few million elements? A 
length check should be rather easy.


> The same result is obtained with R-2.5.1.
>
>
> --please do not edit the information below--
>
> Version:
> platform = i386-apple-darwin8.10.1
> arch = i386
> os = darwin8.10.1
> system = i386, darwin8.10.1
> status = beta
> major = 2
> minor = 6.0
> year = 2007
> month = 09
> day = 22
> svn rev = 42941
> language = R
> version.string = R version 2.6.0 beta (2007-09-22 r42941)
>
> Locale:
> C
>
> Search Path:
> .GlobalEnv, package:testpkg, package:stats, package:graphics,  
> package:grDevices, package:utils, package:datasets, package:methods,  
> Autoloads, package:base
>
> John Maindonald             email: john.maindonald at anu.edu.au
> phone : +61 2 (6125)3473    fax  : +61 2(6125)5549
> Centre for Mathematics & Its Applications, Room 1194,
> John Dedman Mathematical Sciences Building (Building 27)
> Australian National University, Canberra ACT 0200.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Sun Sep 23 10:50:02 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 23 Sep 2007 09:50:02 +0100 (BST)
Subject: [Rd] html help fails for named vector objects (PR#9927)
In-Reply-To: <20070923002336.3332B66893@slim.kubism.ku.dk>
References: <20070923002336.3332B66893@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0709230912380.15749@gannet.stats.ox.ac.uk>

On a normal R help system any version of help(letters) tries to give you 
help on a, b, etc.  This is intentional (although the documentation is 
unclearly worded), and has been the case since at least R 2.0.0.
Some versions of help will display only the first topic.

If help(letters, htmlhelp=FALSE) does something else on your system, that 
is a MacOS-specific bug since the topic selected should not depend on the 
optional arguments.

What is unclear from the documentation is what should happen with

help(c("help", "help.search"))

It seems that for text help you get the first, for htmlhelp both.

There are two things we could do to help (apart from clarifying the 
documentation):

1) If 'topic' is neither a name nor a character vector (e.g. an expression 
like the last example) give an explicit error.

2) if topic is a character vector of length > 1, use the name.


On Sun, 23 Sep 2007, John.Maindonald at anu.edu.au wrote:

>   help(letters, htmlhelp=TRUE) fails.
>
> Under the Mac OSX gui, the message is 'Help for the topic "a" was not
> found.' Under the version documented below, and under Windows, the
> message is
>
>   "No documentation for 'a' in specified packages and libraries:"
> repeated for all the elements of letters, then followed by
>   "you could try 'help.search("a")'",
> again repeated for all elements of letters.
>
> The outcome seems similar for any character vector (including matrix)
> object, e.g. the matrix 'primateDNA' in the DAAGbio package.
>
> The following have the expected result
>   help("letters", htmlhelp=TRUE)
>   help(letters, htmlhelp=FALSE)

But the documented and actual results are the same, and different in the 
two cases.

> The same result is obtained with R-2.5.1.
>
>
> --please do not edit the information below--
>
> Version:
> platform = i386-apple-darwin8.10.1
> arch = i386
> os = darwin8.10.1
> system = i386, darwin8.10.1
> status = beta
> major = 2
> minor = 6.0
> year = 2007
> month = 09
> day = 22
> svn rev = 42941
> language = R
> version.string = R version 2.6.0 beta (2007-09-22 r42941)
>
> Locale:
> C
>
> Search Path:
> .GlobalEnv, package:testpkg, package:stats, package:graphics,
> package:grDevices, package:utils, package:datasets, package:methods,
> Autoloads, package:base
>
> John Maindonald             email: john.maindonald at anu.edu.au
> phone : +61 2 (6125)3473    fax  : +61 2(6125)5549
> Centre for Mathematics & Its Applications, Room 1194,
> John Dedman Mathematical Sciences Building (Building 27)
> Australian National University, Canberra ACT 0200.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Sun Sep 23 10:50:40 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Sun, 23 Sep 2007 10:50:40 +0200 (CEST)
Subject: [Rd] html help fails for named vector objects (PR#9927)
Message-ID: <20070923085040.E84335AD21@slim.kubism.ku.dk>

On a normal R help system any version of help(letters) tries to give you 
help on a, b, etc.  This is intentional (although the documentation is 
unclearly worded), and has been the case since at least R 2.0.0.
Some versions of help will display only the first topic.

If help(letters, htmlhelp=FALSE) does something else on your system, that 
is a MacOS-specific bug since the topic selected should not depend on the 
optional arguments.

What is unclear from the documentation is what should happen with

help(c("help", "help.search"))

It seems that for text help you get the first, for htmlhelp both.

There are two things we could do to help (apart from clarifying the 
documentation):

1) If 'topic' is neither a name nor a character vector (e.g. an expression 
like the last example) give an explicit error.

2) if topic is a character vector of length > 1, use the name.


On Sun, 23 Sep 2007, John.Maindonald at anu.edu.au wrote:

>   help(letters, htmlhelp=TRUE) fails.
>
> Under the Mac OSX gui, the message is 'Help for the topic "a" was not
> found.' Under the version documented below, and under Windows, the
> message is
>
>   "No documentation for 'a' in specified packages and libraries:"
> repeated for all the elements of letters, then followed by
>   "you could try 'help.search("a")'",
> again repeated for all elements of letters.
>
> The outcome seems similar for any character vector (including matrix)
> object, e.g. the matrix 'primateDNA' in the DAAGbio package.
>
> The following have the expected result
>   help("letters", htmlhelp=TRUE)
>   help(letters, htmlhelp=FALSE)

But the documented and actual results are the same, and different in the 
two cases.

> The same result is obtained with R-2.5.1.
>
>
> --please do not edit the information below--
>
> Version:
> platform = i386-apple-darwin8.10.1
> arch = i386
> os = darwin8.10.1
> system = i386, darwin8.10.1
> status = beta
> major = 2
> minor = 6.0
> year = 2007
> month = 09
> day = 22
> svn rev = 42941
> language = R
> version.string = R version 2.6.0 beta (2007-09-22 r42941)
>
> Locale:
> C
>
> Search Path:
> .GlobalEnv, package:testpkg, package:stats, package:graphics,
> package:grDevices, package:utils, package:datasets, package:methods,
> Autoloads, package:base
>
> John Maindonald             email: john.maindonald at anu.edu.au
> phone : +61 2 (6125)3473    fax  : +61 2(6125)5549
> Centre for Mathematics & Its Applications, Room 1194,
> John Dedman Mathematical Sciences Building (Building 27)
> Australian National University, Canberra ACT 0200.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ehlers at math.ucalgary.ca  Sun Sep 23 11:52:35 2007
From: ehlers at math.ucalgary.ca (P Ehlers)
Date: Sun, 23 Sep 2007 03:52:35 -0600
Subject: [Rd] html help fails for named vector objects (PR#9927)
In-Reply-To: <Pine.LNX.4.64.0709230912380.15749@gannet.stats.ox.ac.uk>
References: <20070923002336.3332B66893@slim.kubism.ku.dk>
	<Pine.LNX.4.64.0709230912380.15749@gannet.stats.ox.ac.uk>
Message-ID: <46F63763.4000004@math.ucalgary.ca>

There seems also to be a difference between the way 'help()' and '?'
handle 'topic' in some cases.

Consider:
lm <- "aov"

The following all bring up help for 'lm':
?lm
?"lm"
help("lm")

This opens help for 'aov':
help(lm)

It seems that "?" doesn't care about quoting, but "help" does.
Did I miss something in the docs?
(If it matters, I'm using options(chmhelp=TRUE).)

 > sessionInfo()
R version 2.6.0 beta (2007-09-18 r42895)
i386-pc-mingw32

locale:
LC_COLLATE=English_Canada.1252; [snip]

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

  - Peter Ehlers

Prof Brian Ripley wrote:
> On a normal R help system any version of help(letters) tries to give you 
> help on a, b, etc.  This is intentional (although the documentation is 
> unclearly worded), and has been the case since at least R 2.0.0.
> Some versions of help will display only the first topic.
> 
> If help(letters, htmlhelp=FALSE) does something else on your system, that 
> is a MacOS-specific bug since the topic selected should not depend on the 
> optional arguments.
> 
> What is unclear from the documentation is what should happen with
> 
> help(c("help", "help.search"))
> 
> It seems that for text help you get the first, for htmlhelp both.
> 
> There are two things we could do to help (apart from clarifying the 
> documentation):
> 
> 1) If 'topic' is neither a name nor a character vector (e.g. an expression 
> like the last example) give an explicit error.
> 
> 2) if topic is a character vector of length > 1, use the name.
> 
> 
> On Sun, 23 Sep 2007, John.Maindonald at anu.edu.au wrote:
> 
>>   help(letters, htmlhelp=TRUE) fails.
>>
>> Under the Mac OSX gui, the message is 'Help for the topic "a" was not
>> found.' Under the version documented below, and under Windows, the
>> message is
>>
>>   "No documentation for 'a' in specified packages and libraries:"
>> repeated for all the elements of letters, then followed by
>>   "you could try 'help.search("a")'",
>> again repeated for all elements of letters.
>>
>> The outcome seems similar for any character vector (including matrix)
>> object, e.g. the matrix 'primateDNA' in the DAAGbio package.
>>
>> The following have the expected result
>>   help("letters", htmlhelp=TRUE)
>>   help(letters, htmlhelp=FALSE)
> 
> But the documented and actual results are the same, and different in the 
> two cases.
> 
>> The same result is obtained with R-2.5.1.
>>
>>
>> --please do not edit the information below--
>>
>> Version:
>> platform = i386-apple-darwin8.10.1
>> arch = i386
>> os = darwin8.10.1
>> system = i386, darwin8.10.1
>> status = beta
>> major = 2
>> minor = 6.0
>> year = 2007
>> month = 09
>> day = 22
>> svn rev = 42941
>> language = R
>> version.string = R version 2.6.0 beta (2007-09-22 r42941)
>>
>> Locale:
>> C
>>
>> Search Path:
>> .GlobalEnv, package:testpkg, package:stats, package:graphics,
>> package:grDevices, package:utils, package:datasets, package:methods,
>> Autoloads, package:base
>>
>> John Maindonald             email: john.maindonald at anu.edu.au
>> phone : +61 2 (6125)3473    fax  : +61 2(6125)5549
>> Centre for Mathematics & Its Applications, Room 1194,
>> John Dedman Mathematical Sciences Building (Building 27)
>> Australian National University, Canberra ACT 0200.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From savicky at cs.cas.cz  Sun Sep 23 12:43:48 2007
From: savicky at cs.cas.cz (Petr Savicky)
Date: Sun, 23 Sep 2007 12:43:48 +0200
Subject: [Rd] initial scrambling of seed in do_setseed / RNG_Init
Message-ID: <20070923104348.GA2032@cs.cas.cz>

I would like to suggest a modification of initial scrambling of the
seed in RNG_Init (called from do_setseed). The modified code is
equivalent, but faster. Patch against R-devel_2007-09-22 follows

--- R-devel-orig/src/main/RNG.c	2007-09-02 07:49:35.000000000 +0200
+++ R-devel-modif/src/main/RNG.c	2007-09-23 10:51:59.234566440 +0200
@@ -216,8 +216,8 @@
     BM_norm_keep = 0.0; /* zap Box-Muller history */
 
     /* Initial scrambling */
-    for(j = 0; j < 50; j++)
-	seed = (69069 * seed + 1);
+    /* Equivalent to 50 iterations of seed = (69069 * seed + 1) */
+    seed = (1100682473U * seed + 2358491998U);
     switch(kind) {
     case WICHMANN_HILL:
     case MARSAGLIA_MULTICARRY:

Let me add also the following remark. The help(Random.user) page says

     Optionally, the user can supply the entry point 'user_unif_init',
     which is called with an 'unsigned int' argument when 'RNGkind' (or
     'set.seed') is called, and is intended to be used to initialize
     the user's RNG code. The argument is intended to be used to set
     the "seeds"; it is the 'seed' argument to 'set.seed' or an
     essentially random seed if 'RNGkind' is called.

I want to comment on the sentence
   The argument is intended to be used to set
   the "seeds"; it is the 'seed' argument to 'set.seed' or ....
This is not correct. If user_unif_init is called from set.seed, then
it receives the argument of set.seed after the initial scrambling.
If someone writes a user defined generator and wishes to get the original
seed specified in set.seed (which is my situation), then it may be useful
for him to know that the transformation 
  seed = 3602842457U * (seed - 2358491998U);
is the inverse to the initial scrambling. Hence, if it is applied to the
value received by user_unif_init, it provides the original value specified
by the user in set.seed.

Let me point out that the initial scrambling does not eliminate seed 0.
It only decreases the probability that this seed is sent to the generator.
Due to scrambling, the entry point user_unif_init receives 0 not as a
consequence of set.seed(0), but as a consequence of set.seed(105890386).
This is less likely, but still possible.

I suggest to clarify the page help(Random.user) concerning the transformation
of the seed. For example, the sentence
  it is the 'seed' argument to 'set.seed'
may be extended to
  it is the 'seed' argument to 'set.seed' after a transformation described
  in function RNG_Init in src/main/RNG.c

Also, a remark concerning the inverse transformation may be add. In my opinion,
the best way to do this could be to add a comment to RNG_Init in src/main/RNG.c,
saying, for example:
  If you need to undo the initial scrambling in user_unif_init, use
  seed = 3602842457U * (seed - 2358491998U);

Petr Savicky.


From ripley at stats.ox.ac.uk  Sun Sep 23 13:15:31 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 23 Sep 2007 12:15:31 +0100 (BST)
Subject: [Rd] html help fails for named vector objects (PR#9927)
In-Reply-To: <46F63763.4000004@math.ucalgary.ca>
References: <20070923002336.3332B66893@slim.kubism.ku.dk>
	<Pine.LNX.4.64.0709230912380.15749@gannet.stats.ox.ac.uk>
	<46F63763.4000004@math.ucalgary.ca>
Message-ID: <Pine.LNX.4.64.0709231147310.17535@gannet.stats.ox.ac.uk>

On Sun, 23 Sep 2007, P Ehlers wrote:

> There seems also to be a difference between the way 'help()' and '?'
> handle 'topic' in some cases.

Yes, that is intentional.  I didn't mention it (after deliberation) as the 
bug report was about help(htmlhelp=TRUE) and not ?.  I did mention 
clarifying the documentation, which in my draft says

    topic: usually, a name or character string specifying the topic for
           which help is sought.

           For 'help', if 'topic' is a length-one character vector, the
           topic is taken to be the value of the only element.

           For '?' the 'topic' argument may also be a function call, to
           ask for documentation on a corresponding method.  See the
           section on S4 method documentation.

but I am still tweaking.

> Consider:
> lm <- "aov"
>
> The following all bring up help for 'lm':
> ?lm
> ?"lm"
> help("lm")
>
> This opens help for 'aov':
> help(lm)
>
> It seems that "?" doesn't care about quoting, but "help" does.
> Did I miss something in the docs?

No, as it is not in the docs as yet.  The help page described what happens 
for ?, not for help, e.g.

           The 'topic' argument may also be a function call, to ask for
           documentation on a corresponding method.  See the section on
           method documentation.

applies only to ? .

> (If it matters, I'm using options(chmhelp=TRUE).)

It will not if utils::help is being called.

>
>> sessionInfo()
> R version 2.6.0 beta (2007-09-18 r42895)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=English_Canada.1252; [snip]
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> - Peter Ehlers
>
> Prof Brian Ripley wrote:
>> On a normal R help system any version of help(letters) tries to give you 
>> help on a, b, etc.  This is intentional (although the documentation is 
>> unclearly worded), and has been the case since at least R 2.0.0.
>> Some versions of help will display only the first topic.
>> 
>> If help(letters, htmlhelp=FALSE) does something else on your system, that 
>> is a MacOS-specific bug since the topic selected should not depend on the 
>> optional arguments.
>> 
>> What is unclear from the documentation is what should happen with
>> 
>> help(c("help", "help.search"))
>> 
>> It seems that for text help you get the first, for htmlhelp both.
>> 
>> There are two things we could do to help (apart from clarifying the 
>> documentation):
>> 
>> 1) If 'topic' is neither a name nor a character vector (e.g. an expression 
>> like the last example) give an explicit error.
>> 
>> 2) if topic is a character vector of length > 1, use the name.
>> 
>> 
>> On Sun, 23 Sep 2007, John.Maindonald at anu.edu.au wrote:
>>
>>>   help(letters, htmlhelp=TRUE) fails.
>>> 
>>> Under the Mac OSX gui, the message is 'Help for the topic "a" was not
>>> found.' Under the version documented below, and under Windows, the
>>> message is
>>>
>>>   "No documentation for 'a' in specified packages and libraries:"
>>> repeated for all the elements of letters, then followed by
>>>   "you could try 'help.search("a")'",
>>> again repeated for all elements of letters.
>>> 
>>> The outcome seems similar for any character vector (including matrix)
>>> object, e.g. the matrix 'primateDNA' in the DAAGbio package.
>>> 
>>> The following have the expected result
>>>   help("letters", htmlhelp=TRUE)
>>>   help(letters, htmlhelp=FALSE)
>> 
>> But the documented and actual results are the same, and different in the 
>> two cases.
>> 
>>> The same result is obtained with R-2.5.1.
>>> 
>>> 
>>> --please do not edit the information below--
>>> 
>>> Version:
>>> platform = i386-apple-darwin8.10.1
>>> arch = i386
>>> os = darwin8.10.1
>>> system = i386, darwin8.10.1
>>> status = beta
>>> major = 2
>>> minor = 6.0
>>> year = 2007
>>> month = 09
>>> day = 22
>>> svn rev = 42941
>>> language = R
>>> version.string = R version 2.6.0 beta (2007-09-22 r42941)
>>> 
>>> Locale:
>>> C
>>> 
>>> Search Path:
>>> .GlobalEnv, package:testpkg, package:stats, package:graphics,
>>> package:grDevices, package:utils, package:datasets, package:methods,
>>> Autoloads, package:base
>>> 
>>> John Maindonald             email: john.maindonald at anu.edu.au
>>> phone : +61 2 (6125)3473    fax  : +61 2(6125)5549
>>> Centre for Mathematics & Its Applications, Room 1194,
>>> John Dedman Mathematical Sciences Building (Building 27)
>>> Australian National University, Canberra ACT 0200.
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>> 
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ggrothendieck at gmail.com  Mon Sep 24 03:31:01 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 23 Sep 2007 21:31:01 -0400
Subject: [Rd] Inspecting promises
Message-ID: <971536df0709231831p52ef05cax5e5e66390b3bacee@mail.gmail.com>

Is there some way of displaying the expression and evaluation environment
associated with a promise?   I have found the following:

> # first run these two commands to set up example
> e <- new.env()
> delayedAssign("y", x*x, assign.env = e)

> # method 1.  shows expression but not evaluation environment
> str(as.list(e))
List of 1
 $ y: promise to  language x * x

> # method 2. shows expression but not evaluation environment
> substitute(y, e)
x * x

which shows two different ways of displaying the expression
associated with a promise but neither shows the evaluation
environment.  The first technique may actually be a bug in
R based on previous discussion on r-devel.

Is there a way to display both the expression and the evaluation
environment associated with a promise.  Its a bit difficult to debug
code involving promises if you can't inspect the objects you are
working with.

> R.version.string # Vista
[1] "R version 2.6.0 beta (2007-09-19 r42914)"


From luke at stat.uiowa.edu  Mon Sep 24 15:00:02 2007
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Mon, 24 Sep 2007 08:00:02 -0500 (CDT)
Subject: [Rd] Inspecting promises
In-Reply-To: <971536df0709231831p52ef05cax5e5e66390b3bacee@mail.gmail.com>
References: <971536df0709231831p52ef05cax5e5e66390b3bacee@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0709240752570.26429@nokomis.stat.uiowa.edu>

Please keep in mind that while lazy evaluation and delayedAssign are
documented parts of the language, promises are an internal
implementation mechanism that is subject to change.  In particular the
fact that substitute behaves the way it does is a coincidence of the
current implementation that may very well change.  Currently, for
example, the use of promises to make substitute work means promises
need to be kept around once thei are forced.  This is inefficient in
several ways and may need to be fixed at some point.

It may well be useful to provide some reflection mechanisms for
examining environments, but there are more issues to consider than
pending evaluations (active bindings for example). I'm not sure when
this will rise to the top of anyone's priority list for
implementation.

luke

On Sun, 23 Sep 2007, Gabor Grothendieck wrote:

> Is there some way of displaying the expression and evaluation environment
> associated with a promise?   I have found the following:
>
>> # first run these two commands to set up example
>> e <- new.env()
>> delayedAssign("y", x*x, assign.env = e)
>
>> # method 1.  shows expression but not evaluation environment
>> str(as.list(e))
> List of 1
> $ y: promise to  language x * x
>
>> # method 2. shows expression but not evaluation environment
>> substitute(y, e)
> x * x
>
> which shows two different ways of displaying the expression
> associated with a promise but neither shows the evaluation
> environment.  The first technique may actually be a bug in
> R based on previous discussion on r-devel.
>
> Is there a way to display both the expression and the evaluation
> environment associated with a promise.  Its a bit difficult to debug
> code involving promises if you can't inspect the objects you are
> working with.
>
>> R.version.string # Vista
> [1] "R version 2.6.0 beta (2007-09-19 r42914)"
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From mtmorgan at fhcrc.org  Tue Sep 25 02:20:44 2007
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Mon, 24 Sep 2007 17:20:44 -0700
Subject: [Rd] 'load' does not properly add 'show' methods for classes
 extending 'list'
Message-ID: <6phbqbrzjc3.fsf@gopher4.fhcrc.org>

The GeneSetCollection class in the Bioconductor package GSEABase
extends 'list'

> library(GSEABase)
> showClass("GeneSetCollection")

Slots:
            
Name:  .Data
Class:  list

Extends: 
Class "list", from data part
Class "vector", by class "list", distance 2
Class "AssayData", by class "list", distance 2

If I create an instance of this class and serialize it

> x <- GeneSetCollection(GeneSet("X"))
> x
GeneSetCollection
  names: NA (1 total)
> save(x, file="/tmp/x.rda")

and then start a new R session and load the data object (without first
library(GSEABase)), the 'show' method is not added to the appropriate
method table.

> load("/tmp/x.Rda")
> x
Loading required package: GSEABase
Loading required package: Biobase
Loading required package: tools

Welcome to Bioconductor

  Vignettes contain introductory material. To view, type
  'openVignette()'. To cite Bioconductor, see
  'citation("Biobase")' and for packages 'citation(pkgname)'.

Loading required package: AnnotationDbi
Loading required package: DBI
Loading required package: RSQLite
An object of class "GeneSetCollection"
[[1]]
setName: NA 
geneIds: X (total: 1)
geneIdType: Null 
collectionType: Null 
details: use 'details(object)'

Actually, the behavior is more complicate than appears; in a new R
session after loading /tmp/x.Rda, if I immediately do x[[1]] I get the
show,GeneSetCollection-method but not show,GeneSet-method.

Sorry for the somewhat obscure example.

Martin
-- 
Martin Morgan
Bioconductor / Computational Biology
http://bioconductor.org


From ripley at stats.ox.ac.uk  Tue Sep 25 10:18:09 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 25 Sep 2007 09:18:09 +0100 (BST)
Subject: [Rd] 'load' does not properly add 'show' methods for classes
 extending 'list'
In-Reply-To: <6phbqbrzjc3.fsf@gopher4.fhcrc.org>
References: <6phbqbrzjc3.fsf@gopher4.fhcrc.org>
Message-ID: <Pine.LNX.4.64.0709250751330.19522@gannet.stats.ox.ac.uk>

I am not sure why you expected this to work: I did not expect it to and 
could not find relevant documentation to suggest it should.

Loading an object created from a non-attached package does not in general 
attach that package and make the methods for the class of 'x' available. 
We have talked about attaching the package defining the class when an S4 
object is loaded, and that is probably possible now S4 objects can be 
unambiguously distinguished (although I still worry about multiple 
packages with the same generic and their order on the search path).

In your example there is no specific 'show' method on the search path when 
'show' is called via autoprinting in the second session, so 'showDefault' 
is called.  Package GSEABase gets attached as an (undocumented) side 
effect of calling 'getClassDef' from 'showDefault'.  I can see no 
documentation (and in particular not in ?showDefault) that 'showDefault' 
is supposed to attach the package defining the class and re-dispatch to a 
'show' method that package contains.  Since attaching packages behind the 
user's back can have nasty side effects (the order of the search path does 
mattter), I think the pros and cons need careful consideration: a warning 
along the lines of

   'object 'x' is of class "GeneSetCollection" from package 'GSEABase'
   which is not on the search path

might be more appropriate.  Things would potentially be a lot smoother if 
namespaces could be assumed, as loading a namespace has few side effects 
(and if loading a namespace registered methods for visible S4 generics 
smoothly).

Until I see documentation otherwise, I will continue to assume that I do 
need to attach the class-defining package(s) for things to work correctly.


On Mon, 24 Sep 2007, Martin Morgan wrote:

> The GeneSetCollection class in the Bioconductor package GSEABase
> extends 'list'
>
>> library(GSEABase)
>> showClass("GeneSetCollection")
>
> Slots:
>
> Name:  .Data
> Class:  list
>
> Extends:
> Class "list", from data part
> Class "vector", by class "list", distance 2
> Class "AssayData", by class "list", distance 2
>
> If I create an instance of this class and serialize it
>
>> x <- GeneSetCollection(GeneSet("X"))
>> x
> GeneSetCollection
>  names: NA (1 total)
>> save(x, file="/tmp/x.rda")
>
> and then start a new R session and load the data object (without first
> library(GSEABase)), the 'show' method is not added to the appropriate
> method table.
>
>> load("/tmp/x.Rda")
>> x
> Loading required package: GSEABase
> Loading required package: Biobase
> Loading required package: tools
>
> Welcome to Bioconductor
>
>  Vignettes contain introductory material. To view, type
>  'openVignette()'. To cite Bioconductor, see
>  'citation("Biobase")' and for packages 'citation(pkgname)'.
>
> Loading required package: AnnotationDbi
> Loading required package: DBI
> Loading required package: RSQLite
> An object of class "GeneSetCollection"
> [[1]]
> setName: NA
> geneIds: X (total: 1)
> geneIdType: Null
> collectionType: Null
> details: use 'details(object)'
>
> Actually, the behavior is more complicate than appears; in a new R
> session after loading /tmp/x.Rda, if I immediately do x[[1]] I get the
> show,GeneSetCollection-method but not show,GeneSet-method.
>
> Sorry for the somewhat obscure example.
>
> Martin
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ligges at statistik.uni-dortmund.de  Tue Sep 25 13:50:49 2007
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Tue, 25 Sep 2007 13:50:49 +0200
Subject: [Rd] contributed CRAN packages / Windows binaries for R-2.6.0
Message-ID: <46F8F619.5020500@statistik.uni-dortmund.de>

To all CRAN package maintainers:

package maintainers might want to inspect the check summary provided on 
CRAN (CRAN/src/contrib/checkSummary.html) in order to clean up and fix 
packages that result in WARNINGs or ERRORs under some operating systems.

I will trigger to send out messages to those maintainers whose packages 
fail under today's R-2.6.0 beta for Windows. So don't be surprised.

Best wishes,
Uwe Ligges


From j.van_den_hoff at fzd.de  Tue Sep 25 15:56:14 2007
From: j.van_den_hoff at fzd.de (Joerg van den Hoff)
Date: Tue, 25 Sep 2007 15:56:14 +0200
Subject: [Rd] non-linear fitting (nls) and confidence limits
Message-ID: <20070925135614.GD23685@marco.fz-rossendorf.de>

dear list members,

my question concerns computation of confidence intervals in nonlinear
fits with `nls' when weigthing the fit. the seemingly correct procedure
does not work as (I) expected. I'm posting this here since: (A) the
problem might suggest a modification to the `m' component in the return
argument of `nls' (making this post formally OK for this list) and (B) I
got no response on r-help (my "secret" motivation for posting here,
hoping for some clarifications...):

for _unweighted_ fits using `nls' one can compute confidence intervals for the
fitted model function via

#-------------------
se.fit <- sqrt(apply(res$m$gradient(), 1, function(x) sum(vcov(res)*outer(x,x))))
luconf <- yfit + outer(se.fit, qnorm(c(probex, 1 - probex)))
#-------------------

where `res' contains an `nls' object, `x' is the independent variable vector,
`yfit' the corresponding model prediction (`fitted(res)'), `se.fit' the
corresponding standard error and `luconf' the lower and upper confidence
limits at some level specified by `probex'.

when using the same approach with _weighted_ fits (even if all weights are equal
(but not equal to one)), I noted that the confidence limits depend on the
weights in an counter-intuitive, probably erroneous way.

I have tracked my problem down to the fact that `res$m$gradient()' does
_not_ contain the actual gradients w.r.t. the parameters but rather the
gradients multiplied by the sqrt of the weights.

question 1:
is the fact that `m$gradient' in an `nls' object does compute the "scaled"
gradients documented somewhere (I did'nt find any remark)? if no,
can someone please give me a hint what the rationale behind this approach is?

question 2:
am I right to understand, that the above approach to compute `se.fit'
(in this compact form proposed by p. daalgaard on r-help some time ago)
is erroneous (for weighted nls) that I have to undo the multiplication
by sqrt(weights) which is included in `m$gradient' (or compute the
true gradients of my model function otherwise, e.g. with `deriv')?

here is a simple example demonstrating the problem (yes, I know that
this actually is a linar model :-)):
#-----------------------------------------------------------------------------------
probex <- 0.05
x <- 1:10
y <- rnorm(x, x, .8)
w1 <- rep(1, 10)
w2 <- w1; w2[7:10] <- 0.01 * w2[7:10]

res1 <- nls(y ~ a*x + b, data = list(x = x, y = y), start = list(a = 1, b = 0), weights = w1)
res2 <- nls(y ~ a*x + b, data = list(x = x, y = y), start = list(a = 1, b = 0), weights = w2)
yfit1 <- fitted(res1)
yfit2 <- fitted(res2)
se.fit1 <- sqrt(apply(res1$m$gradient(), 1, function(x) sum(vcov(res1)*outer(x,x))))
luconf1 <- yfit1 + outer(se.fit1, qnorm(c(probex, 1 - probex)))

se.fit2 <- sqrt(apply(res2$m$gradient(), 1, function(x) sum(vcov(res2)*outer(x,x))))
luconf2 <- yfit2 + outer(se.fit2, qnorm(c(probex, 1 - probex)))

op <- par(mfrow = c(2,1))
matplot(x, cbind(y, yfit1,luconf1), type = 'blll', pch = 1, col = c(1,2,4,4), lty = 1)
matplot(x, cbind(y, yfit2,luconf2), type = 'blll', pch = 1, col = c(1,2,4,4), lty = 1)
par(op, no.readonly = T)
#-----------------------------------------------------------------------------------
the first fit uses unit weights for all data points (i.e. effectively is
unweighted) and yields reasonable confidence limits. 
the second fit uses unequal weights (where the last 4
points have very small weights and are next to irrelevant for the fit result).
the computed confidence intervals in this case are only fine up to point no. 6, but
nonsense afterwards.

question 3:
computing confidence limits for the fitted model is a rather frequent
requirement (and it occures by and then on r-help). would it not be a
reasonable (and small) modification to `nls' to add a further argument
"conf = NA" so that if `nls' is called, e.g. with "conflim = 0.95",
the confidence limits are computed and are returned in a new
component `res$m$conf' of the `m' component of an nls object?
(alternatively, computation of `se.fit' (in the notation used above)
would suffice. this could also be achieved by making the `se.fit' flag in
`predict.nls' operational. either way would seem a valuable improvement
to the nls functionality, I believe.)

any feedback appreciated.

thanks,

joerg


From rgentlem at fhcrc.org  Tue Sep 25 18:18:55 2007
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Tue, 25 Sep 2007 09:18:55 -0700
Subject: [Rd] 'load' does not properly add 'show' methods for classes
 extending 'list'
In-Reply-To: <Pine.LNX.4.64.0709250751330.19522@gannet.stats.ox.ac.uk>
References: <6phbqbrzjc3.fsf@gopher4.fhcrc.org>
	<Pine.LNX.4.64.0709250751330.19522@gannet.stats.ox.ac.uk>
Message-ID: <46F934EF.5080603@fhcrc.org>

I think that it would be best then, not to load the package, as loading 
it in this way, means that it is almost impossible to get the methods 
registered correctly. That does seem to be a bug, or at least a major 
inconvenience.  And one might wonder at the purpose of attaching if not 
to make methods available.

That said the documentation, indeed does not state that anything good 
will happen. It also does not state that something bad will happen either.

best wishes
   Robert


Prof Brian Ripley wrote:
> I am not sure why you expected this to work: I did not expect it to and 
> could not find relevant documentation to suggest it should.
> 
> Loading an object created from a non-attached package does not in general 
> attach that package and make the methods for the class of 'x' available. 
> We have talked about attaching the package defining the class when an S4 
> object is loaded, and that is probably possible now S4 objects can be 
> unambiguously distinguished (although I still worry about multiple 
> packages with the same generic and their order on the search path).
> 
> In your example there is no specific 'show' method on the search path when 
> 'show' is called via autoprinting in the second session, so 'showDefault' 
> is called.  Package GSEABase gets attached as an (undocumented) side 
> effect of calling 'getClassDef' from 'showDefault'.  I can see no 
> documentation (and in particular not in ?showDefault) that 'showDefault' 
> is supposed to attach the package defining the class and re-dispatch to a 
> 'show' method that package contains.  Since attaching packages behind the 
> user's back can have nasty side effects (the order of the search path does 
> mattter), I think the pros and cons need careful consideration: a warning 
> along the lines of
> 
>    'object 'x' is of class "GeneSetCollection" from package 'GSEABase'
>    which is not on the search path
> 
> might be more appropriate.  Things would potentially be a lot smoother if 
> namespaces could be assumed, as loading a namespace has few side effects 
> (and if loading a namespace registered methods for visible S4 generics 
> smoothly).
> 
> Until I see documentation otherwise, I will continue to assume that I do 
> need to attach the class-defining package(s) for things to work correctly.
> 
> 
> On Mon, 24 Sep 2007, Martin Morgan wrote:
> 
>> The GeneSetCollection class in the Bioconductor package GSEABase
>> extends 'list'
>>
>>> library(GSEABase)
>>> showClass("GeneSetCollection")
>> Slots:
>>
>> Name:  .Data
>> Class:  list
>>
>> Extends:
>> Class "list", from data part
>> Class "vector", by class "list", distance 2
>> Class "AssayData", by class "list", distance 2
>>
>> If I create an instance of this class and serialize it
>>
>>> x <- GeneSetCollection(GeneSet("X"))
>>> x
>> GeneSetCollection
>>  names: NA (1 total)
>>> save(x, file="/tmp/x.rda")
>> and then start a new R session and load the data object (without first
>> library(GSEABase)), the 'show' method is not added to the appropriate
>> method table.
>>
>>> load("/tmp/x.Rda")
>>> x
>> Loading required package: GSEABase
>> Loading required package: Biobase
>> Loading required package: tools
>>
>> Welcome to Bioconductor
>>
>>  Vignettes contain introductory material. To view, type
>>  'openVignette()'. To cite Bioconductor, see
>>  'citation("Biobase")' and for packages 'citation(pkgname)'.
>>
>> Loading required package: AnnotationDbi
>> Loading required package: DBI
>> Loading required package: RSQLite
>> An object of class "GeneSetCollection"
>> [[1]]
>> setName: NA
>> geneIds: X (total: 1)
>> geneIdType: Null
>> collectionType: Null
>> details: use 'details(object)'
>>
>> Actually, the behavior is more complicate than appears; in a new R
>> session after loading /tmp/x.Rda, if I immediately do x[[1]] I get the
>> show,GeneSetCollection-method but not show,GeneSet-method.
>>
>> Sorry for the somewhat obscure example.
>>
>> Martin
>>
> 

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From hpages at fhcrc.org  Tue Sep 25 18:58:43 2007
From: hpages at fhcrc.org (Herve Pages)
Date: Tue, 25 Sep 2007 09:58:43 -0700
Subject: [Rd] rggobi not in bin/macosx/universal/contrib/2.6/PACKAGES on CRAN
Message-ID: <46F93E43.1000008@fhcrc.org>

Hi,

R-2.6 + install.packages() doesn't find rggobi on Mac OS X.
The .tgz file is here:

  http://cran.fhcrc.org/bin/macosx/universal/contrib/2.6/

but it is not listed in the PACKAGES file:

  http://cran.fhcrc.org/bin/macosx/universal/contrib/2.6/PACKAGES

Any idea why?

Thanks!
H.


From simon.urbanek at r-project.org  Tue Sep 25 22:28:43 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 25 Sep 2007 16:28:43 -0400
Subject: [Rd] rggobi not in bin/macosx/universal/contrib/2.6/PACKAGES on
	CRAN
In-Reply-To: <46F93E43.1000008@fhcrc.org>
References: <46F93E43.1000008@fhcrc.org>
Message-ID: <158AB899-8134-47E3-B506-604F011B2D43@r-project.org>


On Sep 25, 2007, at 12:58 PM, Herve Pages wrote:

> Hi,
>
> R-2.6 + install.packages() doesn't find rggobi on Mac OS X.
> The .tgz file is here:
>
>   http://cran.fhcrc.org/bin/macosx/universal/contrib/2.6/
>
> but it is not listed in the PACKAGES file:
>
>   http://cran.fhcrc.org/bin/macosx/universal/contrib/2.6/PACKAGES
>
> Any idea why?
>

Yes, because it doesn't work - please see the check results:
http://cran.r-project.org/src/contrib/checkSummary.html

I have verified it today and the ggobi binary from the ggobi pages is  
still not fixed.

Cheers,
Simon


From h.wickham at gmail.com  Tue Sep 25 22:33:59 2007
From: h.wickham at gmail.com (hadley wickham)
Date: Tue, 25 Sep 2007 15:33:59 -0500
Subject: [Rd] rggobi not in bin/macosx/universal/contrib/2.6/PACKAGES on
	CRAN
In-Reply-To: <158AB899-8134-47E3-B506-604F011B2D43@r-project.org>
References: <46F93E43.1000008@fhcrc.org>
	<158AB899-8134-47E3-B506-604F011B2D43@r-project.org>
Message-ID: <f8e6ff050709251333j1ad2639xdadfaa2bf32a7199@mail.gmail.com>

On 9/25/07, Simon Urbanek <simon.urbanek at r-project.org> wrote:
>
> On Sep 25, 2007, at 12:58 PM, Herve Pages wrote:
>
> > Hi,
> >
> > R-2.6 + install.packages() doesn't find rggobi on Mac OS X.
> > The .tgz file is here:
> >
> >   http://cran.fhcrc.org/bin/macosx/universal/contrib/2.6/
> >
> > but it is not listed in the PACKAGES file:
> >
> >   http://cran.fhcrc.org/bin/macosx/universal/contrib/2.6/PACKAGES
> >
> > Any idea why?
> >
>
> Yes, because it doesn't work - please see the check results:
> http://cran.r-project.org/src/contrib/checkSummary.html
>
> I have verified it today and the ggobi binary from the ggobi pages is
> still not fixed.

What's wrong with it?  We haven't any problems reported.

Hadley


-- 
http://had.co.nz/


From simon.urbanek at r-project.org  Tue Sep 25 22:34:11 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 25 Sep 2007 16:34:11 -0400
Subject: [Rd] rggobi not in bin/macosx/universal/contrib/2.6/PACKAGES on
	CRAN
In-Reply-To: <158AB899-8134-47E3-B506-604F011B2D43@r-project.org>
References: <46F93E43.1000008@fhcrc.org>
	<158AB899-8134-47E3-B506-604F011B2D43@r-project.org>
Message-ID: <4471B8F2-51F3-4F63-8BEF-D725D23DC5D5@r-project.org>

Actually, the fact that the tar ball is there must be a mirroring  
problem, because it's not on the master CRAN server. You should fix  
your mirror - objects may appear closer ... ;)

Cheers,
Simon

On Sep 25, 2007, at 4:28 PM, Simon Urbanek wrote:

>
> On Sep 25, 2007, at 12:58 PM, Herve Pages wrote:
>
>> Hi,
>>
>> R-2.6 + install.packages() doesn't find rggobi on Mac OS X.
>> The .tgz file is here:
>>
>>   http://cran.fhcrc.org/bin/macosx/universal/contrib/2.6/
>>
>> but it is not listed in the PACKAGES file:
>>
>>   http://cran.fhcrc.org/bin/macosx/universal/contrib/2.6/PACKAGES
>>
>> Any idea why?
>>
>
> Yes, because it doesn't work - please see the check results:
> http://cran.r-project.org/src/contrib/checkSummary.html
>
> I have verified it today and the ggobi binary from the ggobi pages  
> is still not fixed.
>
> Cheers,
> Simon
>


From simon.urbanek at r-project.org  Tue Sep 25 22:53:59 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 25 Sep 2007 16:53:59 -0400
Subject: [Rd] rggobi not in bin/macosx/universal/contrib/2.6/PACKAGES on
	CRAN
In-Reply-To: <f8e6ff050709251333j1ad2639xdadfaa2bf32a7199@mail.gmail.com>
References: <46F93E43.1000008@fhcrc.org>
	<158AB899-8134-47E3-B506-604F011B2D43@r-project.org>
	<f8e6ff050709251333j1ad2639xdadfaa2bf32a7199@mail.gmail.com>
Message-ID: <47F71C99-9D1C-4BB5-84DB-F4DE4BC1B04F@r-project.org>


On Sep 25, 2007, at 4:33 PM, hadley wickham wrote:

> On 9/25/07, Simon Urbanek <simon.urbanek at r-project.org> wrote:
>>
>> On Sep 25, 2007, at 12:58 PM, Herve Pages wrote:
>>
>>> Hi,
>>>
>>> R-2.6 + install.packages() doesn't find rggobi on Mac OS X.
>>> The .tgz file is here:
>>>
>>>   http://cran.fhcrc.org/bin/macosx/universal/contrib/2.6/
>>>
>>> but it is not listed in the PACKAGES file:
>>>
>>>   http://cran.fhcrc.org/bin/macosx/universal/contrib/2.6/PACKAGES
>>>
>>> Any idea why?
>>>
>>
>> Yes, because it doesn't work - please see the check results:
>> http://cran.r-project.org/src/contrib/checkSummary.html
>>
>> I have verified it today and the ggobi binary from the ggobi pages is
>> still not fixed.
>
> What's wrong with it?  We haven't any problems reported.
>

It's linking to a non-existent libfreetype (see the output of the  
make check) and it got reported to me a month ago by Heike. At that  
time we also discussed the fix and I was assuming that you were in  
the loop (I guess you have a dynamic freetype masking the static one  
in /usr/local/lib).

Cheers,
Simon


From h.wickham at gmail.com  Wed Sep 26 04:08:30 2007
From: h.wickham at gmail.com (hadley wickham)
Date: Tue, 25 Sep 2007 21:08:30 -0500
Subject: [Rd] rggobi not in bin/macosx/universal/contrib/2.6/PACKAGES on
	CRAN
In-Reply-To: <47F71C99-9D1C-4BB5-84DB-F4DE4BC1B04F@r-project.org>
References: <46F93E43.1000008@fhcrc.org>
	<158AB899-8134-47E3-B506-604F011B2D43@r-project.org>
	<f8e6ff050709251333j1ad2639xdadfaa2bf32a7199@mail.gmail.com>
	<47F71C99-9D1C-4BB5-84DB-F4DE4BC1B04F@r-project.org>
Message-ID: <f8e6ff050709251908r1ea89c22o9e8aa44c577a15e5@mail.gmail.com>

On 9/25/07, Simon Urbanek <simon.urbanek at r-project.org> wrote:
>
> On Sep 25, 2007, at 4:33 PM, hadley wickham wrote:
>
> > On 9/25/07, Simon Urbanek <simon.urbanek at r-project.org> wrote:
> >>
> >> On Sep 25, 2007, at 12:58 PM, Herve Pages wrote:
> >>
> >>> Hi,
> >>>
> >>> R-2.6 + install.packages() doesn't find rggobi on Mac OS X.
> >>> The .tgz file is here:
> >>>
> >>>   http://cran.fhcrc.org/bin/macosx/universal/contrib/2.6/
> >>>
> >>> but it is not listed in the PACKAGES file:
> >>>
> >>>   http://cran.fhcrc.org/bin/macosx/universal/contrib/2.6/PACKAGES
> >>>
> >>> Any idea why?
> >>>
> >>
> >> Yes, because it doesn't work - please see the check results:
> >> http://cran.r-project.org/src/contrib/checkSummary.html
> >>
> >> I have verified it today and the ggobi binary from the ggobi pages is
> >> still not fixed.
> >
> > What's wrong with it?  We haven't any problems reported.
> >
>
> It's linking to a non-existent libfreetype (see the output of the
> make check) and it got reported to me a month ago by Heike. At that
> time we also discussed the fix and I was assuming that you were in
> the loop (I guess you have a dynamic freetype masking the static one
> in /usr/local/lib).

I thought I had fixed that - are you sure you have downloaded
recently?  Another guy reported the problem and the updated version
worked for him.

Hadley

-- 
http://had.co.nz/


From S.P.Bird at damtp.cam.ac.uk  Mon Sep 24 13:50:35 2007
From: S.P.Bird at damtp.cam.ac.uk (S.P.Bird at damtp.cam.ac.uk)
Date: Mon, 24 Sep 2007 13:50:35 +0200 (CEST)
Subject: [Rd] Documentation bug: Section 3.3.2 of R-Lang. (PR#9928)
Message-ID: <20070924115035.694101DF30@slim.kubism.ku.dk>

Full_Name: Simeon Bird
Version: 2.5.1
OS: Linux
Submission from: (NULL) (131.111.200.200)


In the manual "The R Language Definition", section 3.3.2 reads:

"3.3.2 Propagation of names

propagation of names (first one wins, I think - also if it has no names?? ??
first one *with names* wins, recycling causes shortest to lose names)"

I'm not really sure what this is talking about.


From P.Dalgaard at biostat.ku.dk  Wed Sep 26 11:25:53 2007
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 26 Sep 2007 11:25:53 +0200
Subject: [Rd] Documentation bug: Section 3.3.2 of R-Lang. (PR#9928)
In-Reply-To: <20070924115035.694101DF30@slim.kubism.ku.dk>
References: <20070924115035.694101DF30@slim.kubism.ku.dk>
Message-ID: <46FA25A1.8000406@biostat.ku.dk>

S.P.Bird at damtp.cam.ac.uk wrote:
> Full_Name: Simeon Bird
> Version: 2.5.1
> OS: Linux
> Submission from: (NULL) (131.111.200.200)
>
>
> In the manual "The R Language Definition", section 3.3.2 reads:
>
> "3.3.2 Propagation of names
>
> propagation of names (first one wins, I think - also if it has no names?? ??
> first one *with names* wins, recycling causes shortest to lose names)"
>
> I'm not really sure what this is talking about.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   
Several bits of the document have that kind of "proto-text" style and
need to be rephrased in ordinary English.

What that particular paragraph was meant to describe is this:

> c(A=1)+c(b=2)
A
3
> c(A=1)+c(b=2,c=3)
b c
3 4
> c(1)+c(b=2)
b
3


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From savicky at cs.cas.cz  Wed Sep 26 11:29:24 2007
From: savicky at cs.cas.cz (Petr Savicky)
Date: Wed, 26 Sep 2007 11:29:24 +0200
Subject: [Rd] modifying large R objects in place
Message-ID: <20070926092924.GA9879@cs.cas.cz>

I have a C function, which performs a transformation
of a large integer matrix. The matrix may be of size 1.6GB,
so I can have only one copy in RAM and have to modify it
in place. This is possible using .Call and works fine. For
debugging, I need two copies of a smaller matrix and modify only
one of them. This may also be done, for example, by
  A <- some integer matrix
  B <- A + as.integer(0)
  .Call("transform", A)
Then, B is still the original and A is the transformed one.
Up to now, I do not have any real problem with this, but there
are things, which could help me. Namely the following ones:

1. Is there a general way to duplicate an R object on the
   level of R language? I would use it instead of
      B <- A + as.integer(0)
   Looking for the keywords "duplicate" and "copy" in help pages
   and R-exts did not find what I need.

2. Is there a way how a C function can verify that its
   argument does not share data with other objects?
   I included a test of NAMED(A) in my C function, but I do
   not know, whether it may be used for the purpose which I need.
   I did not find a way how to generate an R object with
   NAMED equal 0. Is this possible on the level of R language?
   If yes, I will require that the argument passed to my
   function is generated in this way and the function
   will refuse to modify it if it is not so.
   The documentation suggests to call "duplicate", if the
   data are shared, but I cannot afford this due to memory.
   So, I can only stop if NAMED is not 0.

I appreciate, if anybody could give me advice on the above things.

Petr Savicky.


From byron.ellis at gmail.com  Wed Sep 26 19:52:28 2007
From: byron.ellis at gmail.com (Byron Ellis)
Date: Wed, 26 Sep 2007 10:52:28 -0700
Subject: [Rd] modifying large R objects in place
In-Reply-To: <20070926092924.GA9879@cs.cas.cz>
References: <20070926092924.GA9879@cs.cas.cz>
Message-ID: <7098abec0709261052q3a6b01e2v562f9a88ed81c513@mail.gmail.com>

For the most part, doing anything to an R object result in it's
duplication. You generally have to do a lot of work to NOT copy an R
object.

On 9/26/07, Petr Savicky <savicky at cs.cas.cz> wrote:
> I have a C function, which performs a transformation
> of a large integer matrix. The matrix may be of size 1.6GB,
> so I can have only one copy in RAM and have to modify it
> in place. This is possible using .Call and works fine. For
> debugging, I need two copies of a smaller matrix and modify only
> one of them. This may also be done, for example, by
>   A <- some integer matrix
>   B <- A + as.integer(0)
>   .Call("transform", A)
> Then, B is still the original and A is the transformed one.
> Up to now, I do not have any real problem with this, but there
> are things, which could help me. Namely the following ones:
>
> 1. Is there a general way to duplicate an R object on the
>    level of R language? I would use it instead of
>       B <- A + as.integer(0)
>    Looking for the keywords "duplicate" and "copy" in help pages
>    and R-exts did not find what I need.
>
> 2. Is there a way how a C function can verify that its
>    argument does not share data with other objects?
>    I included a test of NAMED(A) in my C function, but I do
>    not know, whether it may be used for the purpose which I need.
>    I did not find a way how to generate an R object with
>    NAMED equal 0. Is this possible on the level of R language?
>    If yes, I will require that the argument passed to my
>    function is generated in this way and the function
>    will refuse to modify it if it is not so.
>    The documentation suggests to call "duplicate", if the
>    data are shared, but I cannot afford this due to memory.
>    So, I can only stop if NAMED is not 0.
>
> I appreciate, if anybody could give me advice on the above things.
>
> Petr Savicky.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Byron Ellis (byron.ellis at gmail.com)
"Oook" -- The Librarian


From rdpeng at gmail.com  Wed Sep 26 19:54:49 2007
From: rdpeng at gmail.com (Roger Peng)
Date: Wed, 26 Sep 2007 13:54:49 -0400
Subject: [Rd] Lack of final newline in write.dcf changes append usage
Message-ID: <66f3bd910709261054r7532fac3rd454380facdcca40@mail.gmail.com>

The change in r42731 eliminating the final blank line when writing DCF
files changes the way 'append' can be used in 'write.dcf' and I was
wondering if this is intentional.  Basically, I want to write a data
frame to DCF format one row at a time, so I make use of repeated calls
to 'write.dcf(append = TRUE)'. However, in R 2.6.0RC the resulting DCF
file is not formatted properly because there are no blank lines
between the entries.

It seems the only way to use 'write.dcf(append = TRUE)' is to
explicitly write a blank line to the file before writing the entry.
Perhaps 'write.dcf' could be changed to write a blank line in the
beginning if append = TRUE?  I've attached a patch for this
possibility.

-roger
-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/

From ripley at stats.ox.ac.uk  Wed Sep 26 20:50:05 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 26 Sep 2007 19:50:05 +0100 (BST)
Subject: [Rd] Lack of final newline in write.dcf changes append usage
In-Reply-To: <66f3bd910709261054r7532fac3rd454380facdcca40@mail.gmail.com>
References: <66f3bd910709261054r7532fac3rd454380facdcca40@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0709261944001.6951@gannet.stats.ox.ac.uk>

On Wed, 26 Sep 2007, Roger Peng wrote:

> The change in r42731 eliminating the final blank line when writing DCF
> files changes the way 'append' can be used in 'write.dcf' and I was
> wondering if this is intentional.  Basically, I want to write a data

Yes, it is intentional.  That a blank line got written after a single 
record (only) was regarded as unintentional: blank lines are (I was told) 
record separators and not terminators.

> frame to DCF format one row at a time, so I make use of repeated calls
> to 'write.dcf(append = TRUE)'. However, in R 2.6.0RC the resulting DCF
> file is not formatted properly because there are no blank lines
> between the entries.

tools::write_PACKAGES had that problem.  But surely it is better to keep a 
connection open and make repeated calls to write.dcf on it (as 
write_PACKAGES does).  I don't think writing record separators explicitly 
is much of a hardship.

> It seems the only way to use 'write.dcf(append = TRUE)' is to
> explicitly write a blank line to the file before writing the entry.

or after an entry.

> Perhaps 'write.dcf' could be changed to write a blank line in the
> beginning if append = TRUE?  I've attached a patch for this
> possibility.

Not in code freeze, and in any case it does not address what for me is the 
natural usage.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hpages at fhcrc.org  Wed Sep 26 22:35:08 2007
From: hpages at fhcrc.org (Herve Pages)
Date: Wed, 26 Sep 2007 13:35:08 -0700
Subject: [Rd] rggobi not in bin/macosx/universal/contrib/2.6/PACKAGES on
 CRAN
In-Reply-To: <4471B8F2-51F3-4F63-8BEF-D725D23DC5D5@r-project.org>
References: <46F93E43.1000008@fhcrc.org>
	<158AB899-8134-47E3-B506-604F011B2D43@r-project.org>
	<4471B8F2-51F3-4F63-8BEF-D725D23DC5D5@r-project.org>
Message-ID: <46FAC27C.7070906@fhcrc.org>

Hi Simon,

Simon Urbanek wrote:
> Actually, the fact that the tar ball is there must be a mirroring
> problem, because it's not on the master CRAN server. You should fix your
> mirror - objects may appear closer ... ;)

Yesterday, before I reported the problem, I checked and found the same problem on
other mirrors too (i.e. the package was here but it was not listed in PACKAGES).
Today the problem seems to be gone (again, I've checked a few mirrors) so it's
hard to know what happened exactly.

When I say that the problem is gone, I mean that PACKAGES now seems to be in sync with
the real content of the bin/macosx/universal/contrib/2.6/ folder. But the problem
with ggobi itself is still here (now, as expected, the ggobi tarball is not in
the CRAN folder for Mac OS X packages anymore).

Thanks!

H.


> 
> Cheers,
> Simon
> 
> On Sep 25, 2007, at 4:28 PM, Simon Urbanek wrote:
> 
>>
>> On Sep 25, 2007, at 12:58 PM, Herve Pages wrote:
>>
>>> Hi,
>>>
>>> R-2.6 + install.packages() doesn't find rggobi on Mac OS X.
>>> The .tgz file is here:
>>>
>>>   http://cran.fhcrc.org/bin/macosx/universal/contrib/2.6/
>>>
>>> but it is not listed in the PACKAGES file:
>>>
>>>   http://cran.fhcrc.org/bin/macosx/universal/contrib/2.6/PACKAGES
>>>
>>> Any idea why?
>>>
>>
>> Yes, because it doesn't work - please see the check results:
>> http://cran.r-project.org/src/contrib/checkSummary.html
>>
>> I have verified it today and the ggobi binary from the ggobi pages is
>> still not fixed.
>>
>> Cheers,
>> Simon
>>
> 
>


From h.wickham at gmail.com  Thu Sep 27 00:16:38 2007
From: h.wickham at gmail.com (hadley wickham)
Date: Wed, 26 Sep 2007 17:16:38 -0500
Subject: [Rd] rggobi not in bin/macosx/universal/contrib/2.6/PACKAGES on
	CRAN
In-Reply-To: <46FAC27C.7070906@fhcrc.org>
References: <46F93E43.1000008@fhcrc.org>
	<158AB899-8134-47E3-B506-604F011B2D43@r-project.org>
	<4471B8F2-51F3-4F63-8BEF-D725D23DC5D5@r-project.org>
	<46FAC27C.7070906@fhcrc.org>
Message-ID: <f8e6ff050709261516k175dfd2em8dfa9f03b966c403@mail.gmail.com>

On 9/26/07, Herve Pages <hpages at fhcrc.org> wrote:
> Hi Simon,
>
> Simon Urbanek wrote:
> > Actually, the fact that the tar ball is there must be a mirroring
> > problem, because it's not on the master CRAN server. You should fix your
> > mirror - objects may appear closer ... ;)
>
> Yesterday, before I reported the problem, I checked and found the same problem on
> other mirrors too (i.e. the package was here but it was not listed in PACKAGES).
> Today the problem seems to be gone (again, I've checked a few mirrors) so it's
> hard to know what happened exactly.
>
> When I say that the problem is gone, I mean that PACKAGES now seems to be in sync with
> the real content of the bin/macosx/universal/contrib/2.6/ folder. But the problem
> with ggobi itself is still here (now, as expected, the ggobi tarball is not in
> the CRAN folder for Mac OS X packages anymore).

I've fixed the problem with GGobi, and Simon has updated the version
on CRAN, so you should be able to get a binary version again v. soon.

Hadley


From hpages at fhcrc.org  Thu Sep 27 01:34:09 2007
From: hpages at fhcrc.org (Herve Pages)
Date: Wed, 26 Sep 2007 16:34:09 -0700
Subject: [Rd] rggobi not in bin/macosx/universal/contrib/2.6/PACKAGES on
 CRAN
In-Reply-To: <f8e6ff050709261516k175dfd2em8dfa9f03b966c403@mail.gmail.com>
References: <46F93E43.1000008@fhcrc.org>	
	<158AB899-8134-47E3-B506-604F011B2D43@r-project.org>	
	<4471B8F2-51F3-4F63-8BEF-D725D23DC5D5@r-project.org>	
	<46FAC27C.7070906@fhcrc.org>
	<f8e6ff050709261516k175dfd2em8dfa9f03b966c403@mail.gmail.com>
Message-ID: <46FAEC71.5080802@fhcrc.org>

hadley wickham wrote:
[...]
> I've fixed the problem with GGobi, and Simon has updated the version
> on CRAN, so you should be able to get a binary version again v. soon.

Thanks!

H.


From hpages at fhcrc.org  Thu Sep 27 02:34:33 2007
From: hpages at fhcrc.org (Herve Pages)
Date: Wed, 26 Sep 2007 17:34:33 -0700
Subject: [Rd] Virtual class with no slots
Message-ID: <46FAFA99.7040201@fhcrc.org>

Hi,

It seems there are 2 slightly different ways to create a virtual
class with no slots (a kind of Java "interface"): with or without
specifying 'representation("VIRTUAL")'.

  > setClass("A", representation("VIRTUAL"))
  [1] "A"

  > showClass("A")
  Virtual Class

  No Slots, prototype of class "S4"

  > setClass("B")
  [1] "B"

  > showClass("B")
  Virtual Class

  No Slots, prototype of class "NULL"

Note that:

  - R automatically decided to make B virtual, a strange design decision
    (IMO) that could have been motivated (I'm trying to guess here) by the
    fact that it is probably not very useful to create objects with no slots.
    But I would argue that it could also be left to the user to decide whether
    or not it is a good idea to create such objects (maybe s/he has a use case).

  - Surprisingly, A and B descriptions are slightly different: A's prototype
    is of class "S4" and B's prototype is of class "NULL".

So my question is (just curiosity): why do we have 2 different forms
(leading to different results) to create a virtual class with no slots.
And which one is better?

Also note that, if I try to extend "A" without adding any new slot:

  > setClass("AA", contains="A")
  [1] "AA"

  > showClass("AA")

  No Slots, prototype of class "S4"

  Extends: "A"

now it seems that, yes, it is possible to create a non-virtual class with
no slots! ( it's not easy though :-b ) So I'm wondering why this was not
possible with 'setClass("B")' or 'setClass("B", representation())' in the
first place.

Finally, if I try to instance "AA":

  > new("AA")
  An object of class "AA"
  Error in getClass(class(object)) : "S4" is not a defined class

Oops! Seems that non-virtual classes with no slots are broken anyway :-/

Cheers,
H.


> sessionInfo()
R version 2.6.0 beta (2007-09-19 r42914)
x86_64-unknown-linux-gnu

locale:
LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=en_US;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] rcompgen_0.1-15


From hpages at fhcrc.org  Thu Sep 27 03:01:19 2007
From: hpages at fhcrc.org (Herve Pages)
Date: Wed, 26 Sep 2007 18:01:19 -0700
Subject: [Rd] breaking my "length" method also breaks str()
Message-ID: <46FB00DF.9000903@fhcrc.org>

Hi,

This works fine and gives 26:

  setClass("A", representation(bidule="character"))
  setMethod("length", "A", function(x) length(x at bidule))
  a <- new("A", bidule=letters)
  str(a)
  length(a)

But if my "length" method is broken, then str() stops working:

  > setMethod("length", "A", function(x) length(x at bidulle))
  > str(a)
  Error in length(object) :
    no slot of name "bidulle" for this object of class "A"

Doesn't seem like a big deal on such a simple example but this can be
really problematic. I already had the situation where the "length" method
is in fact very complicated, with a lot of nested calls and one access to
a database and an error occurring at a deep level. I noticed that my program
had a problem but I was not yet aware that "length" was broken. So I started
the debug session and tried to use str() to look inside my objects... but
str() was not working! Which makes a debugging session with a lot of S4 stuff
all around the place quite painful :-/

Cheers,
H.


From ggrothendieck at gmail.com  Thu Sep 27 03:49:58 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 26 Sep 2007 21:49:58 -0400
Subject: [Rd] delayedAssign
In-Reply-To: <971536df0709191230p3a62d94g1dcf8f978dad6305@mail.gmail.com>
References: <971536df0709191230p3a62d94g1dcf8f978dad6305@mail.gmail.com>
Message-ID: <971536df0709261849s519cb30uf72871bf0f7a8b0d@mail.gmail.com>

I thought that perhaps the behavior in the previous post,
while inconsistent with the documentation, was not all that
harmful but I think its related to the following which is a potentially
serious bug.  z is a list with a single numeric component,
as the dput output verifies, yet we cannot compare its first element
to 7 without getting an error message.

Later on we see that its because it thinks that z[[1]] is of type "promise"
and even force(z[[1]]) is of type "promise".

> f <- function(x) environment()
> z <- as.list(f(7))
> dput(z)
structure(list(x = 7), .Names = "x")
> z[[1]] == 7
Error in z[[1]] == 7 :
  comparison (1) is possible only for atomic and list types
> force(z[[1]]) == 7
Error in force(z[[1]]) == 7 :
  comparison (1) is possible only for atomic and list types
>
> typeof(z)
[1] "list"
> typeof(z[[1]])
[1] "promise"
> typeof(force(z[[1]]))
[1] "promise"
> R.version.string # Vista
[1] "R version 2.6.0 beta (2007-09-23 r42958)"


On 9/19/07, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> The last two lines of example(delayedAssign) give this:
>
> > e <- (function(x, y = 1, z) environment())(1+2, "y", {cat(" HO! "); pi+2})
> > (le <- as.list(e)) # evaluates the promises
> $x
> <promise: 0x032b31f8>
> $y
> <promise: 0x032b3230>
> $z
> <promise: 0x032b3268>
>
> which contrary to the comment appears unevaluated.  Is the comment
> wrong or is it supposed to return an evaluated result but doesn't?
>
> > R.version.string # Vista
> [1] "R version 2.6.0 alpha (2007-09-06 r42791)"
>


From ecjbosu at aol.com  Thu Sep 27 04:03:57 2007
From: ecjbosu at aol.com (Joe W. Byers)
Date: Wed, 26 Sep 2007 21:03:57 -0500
Subject: [Rd] rJava and RJDBC
Message-ID: <fdf330$e7b$1@sea.gmane.org>

I am desperate for help.

I am trying to get the RJDBC and rJava .5to work on both my windows xp 
and linux Redhat EL5 Server.  On both I get a 
ava.lang.ClassNotFoundException when calling JDBC().

My example is
require(RJDBC)
classPath='C:\\libraries\\mysql-connector-java-5.1.3-rc\\mysql-connector-java-5.1.3-rc-bin.jar'
driverClass=c("com.mysql.jdbc.Driver")
drv <- JDBC(c("com.mysql.jdbc.Driver"),classPath,"`")


This returns a NULL value and a java exception.
 > .jgetEx()
[1] "Java-Object{java.lang.ClassNotFoundException: com.mysql.jdbc.Driver}"
my java version is
 > .jcall('java.lang.System','S','getProperty','java.version')
[1] "1.6.0_02"
jre


When I use java 1.5.0_11 jre I have the same problem but the .jgetEx()
is
 > .jgetEx()
[1] "Java-Object{}

my class path is
 > .jclassPath()
  [1] "C:\\PROGRA~1\\R\\library\\rJava\\java" 

  [2] "." 

  [3] 
"C:\\libraries\\mysql-connector-java-5.1.3-rc\\mysql-connector-java-5.1.3-rc-bin.jar"
  [4] "C:\\libraries\\xmlbeans-2.0.0-beta1\\lib\\xbean.jar" 

  [5] "C:\\libraries\\POI\\poi-2.5.1-final-20040804.jar" 

  [6] "C:\\libraries\\POI\\poi-contrib-2.5.1-final-20040804.jar" 

  [7] "C:\\libraries\\POI\\poi-scratchpad-2.5.1-final-20040804.jar" 

  [8] "C:\\Libraries\\PJM\\eDataFeed.jar" 

  [9] "C:\\Libraries\\PJM\\webserviceclient.jar" 

[10] "C:\\Java\\Libraries\\QTJava.zip"

My java_Home is
 > .jcall('java.lang.System','S','getProperty','java.home')
[1] "C:\\Java\\jre1.6.0_02"


I have tried breaking down the JDBC as
.jinit() or .jinit(classPath)
v<-.jcall("java/lang/ClassLoader","Ljava/lang/ClassLoader;", 
"getSystemClassLoader")
.jcall("java/lang/Class", "Ljava/lang/Class;",
             "forName", as.character(driverClass)[1], TRUE, v)
  to no avail.

I have tried different versions of the mysql jar.

I do not know if my java version not compatible, my java settings are 
wrong, or I am just blind to the problem.  This is the same for both my 
Windows XP and Redhat EL5 Server.

I really appreciate any and all assistance.

Thank you
Joe


From luke at stat.uiowa.edu  Thu Sep 27 13:14:22 2007
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Thu, 27 Sep 2007 06:14:22 -0500 (CDT)
Subject: [Rd] delayedAssign
In-Reply-To: <971536df0709261849s519cb30uf72871bf0f7a8b0d@mail.gmail.com>
References: <971536df0709191230p3a62d94g1dcf8f978dad6305@mail.gmail.com>
	<971536df0709261849s519cb30uf72871bf0f7a8b0d@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0709270531100.2593@itasca2.wildberry.org>

On Wed, 26 Sep 2007, Gabor Grothendieck wrote:

> I thought that perhaps the behavior in the previous post,
> while inconsistent with the documentation, was not all that
> harmful but I think its related to the following which is a potentially
> serious bug.

The previous discussion already established that as.list of an
environment should not return a list with promises in as promises
should not be visible at the R level.  (Another loophole that needs
closing is $ for environments). So behavior of results that should not
exist is undefined and I cannot see how any such behavior is a further
bug, serious or otherwise.

> z is a list with a single numeric component,
> as the dput output verifies,

Except it isn't, as print or str verify, which might be a problem if z
was an input these functions should expect, but it isn't.

> yet we cannot compare its first element
> to 7 without getting an error message.
>
> Later on we see that its because it thinks that z[[1]] is of type "promise"

As z[[1]] is in fact of type promise that would seem a fairly
reasonable thing to think at this point ...

> and even force(z[[1]]) is of type "promise".

which is consistent with what force is documented to do. The
documentation is quite explicit that force does not do what you seem
to be expecting.  That documentation is from a time when delay()
existed to produce promises at the R level, which was a nightmare
because of all the peculiarities it introduced, which is why it was
removed.

force is intended for one thing only -- replacing code like this:

       # I know the following line look really stupid and you will be
       # tempted to remove it for efficiency but DO NOT: it is needed
       # to make sure that the formal argument y is evaluated at this
       # point.
       y <- y

with this:

      force(y)

which seems much clearer -- at least it suggest you look at the help
page for force to see what it does.

At this point promises should only ever exist in bindings in
environments. If we wanted lazy evaluation constructs more widely
there are really only two sensible options:

     The Scheme option where a special function delay creates a deferred
     evaluation and another, called force in Scheme, forces the evaluation
     but there is no implicit forcing

or

     The Haskell option where data structurs are created lazily so

         z <- list(f(x))

     would create a list with a deferred evaluation, but any attempt to
     access the value of z would force the evaluation. So printing z,
     for example, would force the evaluation but

     	y <- z[[1]]

     would not.

It is easy enough to create a Delay/Force pair that behaves like
Scheme's with the tools available in R if that is what you want.
Haskell, and other fully lazy functional languages, are very
interesting but very different animals from R. For some reason you
seem to be expecting some combination of Scheme and Haskell behavior.

Best,

luke

>
>> f <- function(x) environment()
>> z <- as.list(f(7))
>> dput(z)
> structure(list(x = 7), .Names = "x")
>> z[[1]] == 7
> Error in z[[1]] == 7 :
>  comparison (1) is possible only for atomic and list types
>> force(z[[1]]) == 7
> Error in force(z[[1]]) == 7 :
>  comparison (1) is possible only for atomic and list types
>>
>> typeof(z)
> [1] "list"
>> typeof(z[[1]])
> [1] "promise"
>> typeof(force(z[[1]]))
> [1] "promise"
>> R.version.string # Vista
> [1] "R version 2.6.0 beta (2007-09-23 r42958)"
>
>
> On 9/19/07, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
>> The last two lines of example(delayedAssign) give this:
>>
>>> e <- (function(x, y = 1, z) environment())(1+2, "y", {cat(" HO! "); pi+2})
>>> (le <- as.list(e)) # evaluates the promises
>> $x
>> <promise: 0x032b31f8>
>> $y
>> <promise: 0x032b3230>
>> $z
>> <promise: 0x032b3268>
>>
>> which contrary to the comment appears unevaluated.  Is the comment
>> wrong or is it supposed to return an evaluated result but doesn't?
>>
>>> R.version.string # Vista
>> [1] "R version 2.6.0 alpha (2007-09-06 r42791)"
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From ggrothendieck at gmail.com  Thu Sep 27 14:30:41 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 27 Sep 2007 08:30:41 -0400
Subject: [Rd] delayedAssign
In-Reply-To: <Pine.LNX.4.64.0709270531100.2593@itasca2.wildberry.org>
References: <971536df0709191230p3a62d94g1dcf8f978dad6305@mail.gmail.com>
	<971536df0709261849s519cb30uf72871bf0f7a8b0d@mail.gmail.com>
	<Pine.LNX.4.64.0709270531100.2593@itasca2.wildberry.org>
Message-ID: <971536df0709270530s648b5759j3ccff2a62ef33abf@mail.gmail.com>

Thanks for the explanation.

For lists either: (a) promises should be evaluated as they
enter the list or (b) promises evaluated as they exit the
list (i.e. as they are compared, inspected, etc.).  I gather
the intent was (a) but it does not happen that way due to
a bug in R.   Originally I thought (b) would then occur but
my surprise was that it does not occur either which is why
I feel its more serious than I had originally thought.

I think its ok if promises only exist in environments and not
lists.  Items that would be on my wishlist would be to be able
to do at R level the two mentioned previously

https://stat.ethz.ch/pipermail/r-devel/2007-September/046943.html

and thirdly an ability to get the evaluation environment, not just the
expression,
associated with a promise -- substitute only gets the expression.
Originally I thought I would need some or all of these wish items
and then thought not but am back to the original situation again as I use
them more and realize that they are at least important
for debugging (its very difficult to debug situations involving promises as
there is no way to inspect the evaluation environment so you are never sure
which environment a given promise is evaluating in) and possibly
for writing programs as well.

On 9/27/07, Luke Tierney <luke at stat.uiowa.edu> wrote:
> On Wed, 26 Sep 2007, Gabor Grothendieck wrote:
>
> > I thought that perhaps the behavior in the previous post,
> > while inconsistent with the documentation, was not all that
> > harmful but I think its related to the following which is a potentially
> > serious bug.
>
> The previous discussion already established that as.list of an
> environment should not return a list with promises in as promises
> should not be visible at the R level.  (Another loophole that needs
> closing is $ for environments). So behavior of results that should not
> exist is undefined and I cannot see how any such behavior is a further
> bug, serious or otherwise.
>
> > z is a list with a single numeric component,
> > as the dput output verifies,
>
> Except it isn't, as print or str verify, which might be a problem if z
> was an input these functions should expect, but it isn't.
>
> > yet we cannot compare its first element
> > to 7 without getting an error message.
> >
> > Later on we see that its because it thinks that z[[1]] is of type "promise"
>
> As z[[1]] is in fact of type promise that would seem a fairly
> reasonable thing to think at this point ...
>
> > and even force(z[[1]]) is of type "promise".
>
> which is consistent with what force is documented to do. The
> documentation is quite explicit that force does not do what you seem
> to be expecting.  That documentation is from a time when delay()
> existed to produce promises at the R level, which was a nightmare
> because of all the peculiarities it introduced, which is why it was
> removed.
>
> force is intended for one thing only -- replacing code like this:
>
>       # I know the following line look really stupid and you will be
>       # tempted to remove it for efficiency but DO NOT: it is needed
>       # to make sure that the formal argument y is evaluated at this
>       # point.
>       y <- y
>
> with this:
>
>      force(y)
>
> which seems much clearer -- at least it suggest you look at the help
> page for force to see what it does.
>
> At this point promises should only ever exist in bindings in
> environments. If we wanted lazy evaluation constructs more widely
> there are really only two sensible options:
>
>     The Scheme option where a special function delay creates a deferred
>     evaluation and another, called force in Scheme, forces the evaluation
>     but there is no implicit forcing
>
> or
>
>     The Haskell option where data structurs are created lazily so
>
>         z <- list(f(x))
>
>     would create a list with a deferred evaluation, but any attempt to
>     access the value of z would force the evaluation. So printing z,
>     for example, would force the evaluation but
>
>        y <- z[[1]]
>
>     would not.
>
> It is easy enough to create a Delay/Force pair that behaves like
> Scheme's with the tools available in R if that is what you want.
> Haskell, and other fully lazy functional languages, are very
> interesting but very different animals from R. For some reason you
> seem to be expecting some combination of Scheme and Haskell behavior.
>
> Best,
>
> luke
>
> >
> >> f <- function(x) environment()
> >> z <- as.list(f(7))
> >> dput(z)
> > structure(list(x = 7), .Names = "x")
> >> z[[1]] == 7
> > Error in z[[1]] == 7 :
> >  comparison (1) is possible only for atomic and list types
> >> force(z[[1]]) == 7
> > Error in force(z[[1]]) == 7 :
> >  comparison (1) is possible only for atomic and list types
> >>
> >> typeof(z)
> > [1] "list"
> >> typeof(z[[1]])
> > [1] "promise"
> >> typeof(force(z[[1]]))
> > [1] "promise"
> >> R.version.string # Vista
> > [1] "R version 2.6.0 beta (2007-09-23 r42958)"
> >
> >
> > On 9/19/07, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> >> The last two lines of example(delayedAssign) give this:
> >>
> >>> e <- (function(x, y = 1, z) environment())(1+2, "y", {cat(" HO! "); pi+2})
> >>> (le <- as.list(e)) # evaluates the promises
> >> $x
> >> <promise: 0x032b31f8>
> >> $y
> >> <promise: 0x032b3230>
> >> $z
> >> <promise: 0x032b3268>
> >>
> >> which contrary to the comment appears unevaluated.  Is the comment
> >> wrong or is it supposed to return an evaluated result but doesn't?
> >>
> >>> R.version.string # Vista
> >> [1] "R version 2.6.0 alpha (2007-09-06 r42791)"
> >>
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>
> --
> Luke Tierney
> Chair, Statistics and Actuarial Science
> Ralph E. Wareham Professor of Mathematical Sciences
> University of Iowa                  Phone:             319-335-3386
> Department of Statistics and        Fax:               319-335-3017
>    Actuarial Science
> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>


From simon.urbanek at r-project.org  Thu Sep 27 14:31:54 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 27 Sep 2007 08:31:54 -0400
Subject: [Rd] rJava and RJDBC
In-Reply-To: <fdf330$e7b$1@sea.gmane.org>
References: <fdf330$e7b$1@sea.gmane.org>
Message-ID: <2D6F08DC-1015-4210-8764-95B59BB2B3EF@r-project.org>

Joe,

which version of R and RJDBC are you using? The behavior you describe  
should have been fixed in RJDBC 0.1-4. Please try the latest version  
from rforge
install.packages("RJDBC",,"http://rforge.net/")
and please let me know if that solves your problem.

Cheers,
Simon


On Sep 26, 2007, at 10:03 PM, Joe W. Byers wrote:

> I am desperate for help.
>
> I am trying to get the RJDBC and rJava .5to work on both my windows xp
> and linux Redhat EL5 Server.  On both I get a
> ava.lang.ClassNotFoundException when calling JDBC().
>
> My example is
> require(RJDBC)
> classPath='C:\\libraries\\mysql-connector-java-5.1.3-rc\\mysql- 
> connector-java-5.1.3-rc-bin.jar'
> driverClass=c("com.mysql.jdbc.Driver")
> drv <- JDBC(c("com.mysql.jdbc.Driver"),classPath,"`")
>
>
> This returns a NULL value and a java exception.
>> .jgetEx()
> [1] "Java-Object{java.lang.ClassNotFoundException:  
> com.mysql.jdbc.Driver}"
> my java version is
>> .jcall('java.lang.System','S','getProperty','java.version')
> [1] "1.6.0_02"
> jre
>
>
> When I use java 1.5.0_11 jre I have the same problem but the .jgetEx()
> is
>> .jgetEx()
> [1] "Java-Object{}
>
> my class path is
>> .jclassPath()
>   [1] "C:\\PROGRA~1\\R\\library\\rJava\\java"
>
>   [2] "."
>
>   [3]
> "C:\\libraries\\mysql-connector-java-5.1.3-rc\\mysql-connector- 
> java-5.1.3-rc-bin.jar"
>   [4] "C:\\libraries\\xmlbeans-2.0.0-beta1\\lib\\xbean.jar"
>
>   [5] "C:\\libraries\\POI\\poi-2.5.1-final-20040804.jar"
>
>   [6] "C:\\libraries\\POI\\poi-contrib-2.5.1-final-20040804.jar"
>
>   [7] "C:\\libraries\\POI\\poi-scratchpad-2.5.1-final-20040804.jar"
>
>   [8] "C:\\Libraries\\PJM\\eDataFeed.jar"
>
>   [9] "C:\\Libraries\\PJM\\webserviceclient.jar"
>
> [10] "C:\\Java\\Libraries\\QTJava.zip"
>
> My java_Home is
>> .jcall('java.lang.System','S','getProperty','java.home')
> [1] "C:\\Java\\jre1.6.0_02"
>
>
> I have tried breaking down the JDBC as
> .jinit() or .jinit(classPath)
> v<-.jcall("java/lang/ClassLoader","Ljava/lang/ClassLoader;",
> "getSystemClassLoader")
> .jcall("java/lang/Class", "Ljava/lang/Class;",
>              "forName", as.character(driverClass)[1], TRUE, v)
>   to no avail.
>
> I have tried different versions of the mysql jar.
>
> I do not know if my java version not compatible, my java settings are
> wrong, or I am just blind to the problem.  This is the same for  
> both my
> Windows XP and Redhat EL5 Server.
>
> I really appreciate any and all assistance.
>
> Thank you
> Joe
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From savicky at cs.cas.cz  Thu Sep 27 15:13:17 2007
From: savicky at cs.cas.cz (Petr Savicky)
Date: Thu, 27 Sep 2007 15:13:17 +0200
Subject: [Rd] modifying large R objects in place
In-Reply-To: <7098abec0709261052q3a6b01e2v562f9a88ed81c513@mail.gmail.com>
References: <20070926092924.GA9879@cs.cas.cz>
	<7098abec0709261052q3a6b01e2v562f9a88ed81c513@mail.gmail.com>
Message-ID: <20070927131317.GB7605@cs.cas.cz>

On Wed, Sep 26, 2007 at 10:52:28AM -0700, Byron Ellis wrote:
> For the most part, doing anything to an R object result in it's
> duplication. You generally have to do a lot of work to NOT copy an R
> object.

Thank you for your response. Unfortunately, you are right. For example,
the allocated memory determined by top command on Linux may change during
a session as follows:
  a <- matrix(as.integer(1),nrow=14100,ncol=14100) # 774m
  a[1,1] <- 0 # 3.0g
  gc() # 1.5g

In the current applicatin, I modify the matrix only using my own C code
and only read it on R level. So, the above is not a big problem for me
(at least not now).

However, there is a related thing, which could be a bug. The following
code determines the value of NAMED field in SEXP header of an object:

  SEXP getnamed(SEXP a)
  {
      SEXP out;
      PROTECT(out = allocVector(INTSXP, 1));
      INTEGER(out)[0] = NAMED(a);
      UNPROTECT(1);
      return(out);
  }

Now, consider the following session

  u <- matrix(as.integer(1),nrow=5,ncol=3) + as.integer(0)
  .Call("getnamed",u) # 1 (OK)

  length(u)
  .Call("getnamed",u) # 1 (OK)

  dim(u)
  .Call("getnamed",u) # 1 (OK)

  nrow(u)
  .Call("getnamed",u) # 2 (why?)

  u <- matrix(as.integer(1),nrow=5,ncol=3) + as.integer(0)
  .Call("getnamed",u) # 1 (OK)
  ncol(u)
  .Call("getnamed",u) # 2 (so, ncol does the same)

Is this a bug?

Petr Savicky.


From savicky at cs.cas.cz  Thu Sep 27 15:51:51 2007
From: savicky at cs.cas.cz (Petr Savicky)
Date: Thu, 27 Sep 2007 15:51:51 +0200
Subject: [Rd] modifying large R objects in place
In-Reply-To: <20070927131317.GB7605@cs.cas.cz>
References: <20070926092924.GA9879@cs.cas.cz>
	<7098abec0709261052q3a6b01e2v562f9a88ed81c513@mail.gmail.com>
	<20070927131317.GB7605@cs.cas.cz>
Message-ID: <20070927135151.GC7605@cs.cas.cz>

In my previous email, I sent the example:
>   a <- matrix(as.integer(1),nrow=14100,ncol=14100) # 774m
>   a[1,1] <- 0 # 3.0g
>   gc() # 1.5g

This is misleading. The correct version is
   a <- matrix(as.integer(1),nrow=14100,ncol=14100) # 774m
   a[1,1] <- as.integer(0) # 1.5g
   gc() # 774m

So, the object duplicates, but nothing more.

The main part of my previous email (question concerning
a possible bug in the behavior of nrow(a) and ncol(a))
remains open.

Petr Savicky.


From luke at stat.uiowa.edu  Thu Sep 27 15:54:51 2007
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Thu, 27 Sep 2007 08:54:51 -0500 (CDT)
Subject: [Rd] delayedAssign
In-Reply-To: <971536df0709270530s648b5759j3ccff2a62ef33abf@mail.gmail.com>
References: <971536df0709191230p3a62d94g1dcf8f978dad6305@mail.gmail.com> 
	<971536df0709261849s519cb30uf72871bf0f7a8b0d@mail.gmail.com> 
	<Pine.LNX.4.64.0709270531100.2593@itasca2.wildberry.org>
	<971536df0709270530s648b5759j3ccff2a62ef33abf@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0709270846160.10257@nokomis.stat.uiowa.edu>

On Thu, 27 Sep 2007, Gabor Grothendieck wrote:

> Thanks for the explanation.
>
> For lists either: (a) promises should be evaluated as they
> enter the list or (b) promises evaluated as they exit the
> list (i.e. as they are compared, inspected, etc.).

What makes you conclude that this is what "should" happen?

Again, promises are internal.  We could, and maybe will, eliminate
promises in favor of a mark on bindings in environments that indicates
that they need to be evaluated.  At the R level this woud produce the
same behavior as we currently (intend to) have.

If we allowed lazy structures outside of bindings then I still don't
see how (b) "should" happen.  With Scheme-like semantics we would
definitely NOT want this to happen; with Haskell-like semantics any
attempt to look at the value (including priting) would result in
evaluation (and replacing the promise/thunk/whatever by its value).

> I gather
> the intent was (a) but it does not happen that way due to
> a bug in R.   Originally I thought (b) would then occur but
> my surprise was that it does not occur either which is why
> I feel its more serious than I had originally thought.
>
> I think its ok if promises only exist in environments and not
> lists.  Items that would be on my wishlist would be to be able
> to do at R level the two mentioned previously
>
> https://stat.ethz.ch/pipermail/r-devel/2007-September/046943.html

I am still not persuaded that tools for inspecting environments are
worth the time and effort required but I am prepared to be.

Best,

luke

>
> and thirdly an ability to get the evaluation environment, not just the
> expression,
> associated with a promise -- substitute only gets the expression.
> Originally I thought I would need some or all of these wish items
> and then thought not but am back to the original situation again as I use
> them more and realize that they are at least important
> for debugging (its very difficult to debug situations involving promises as
> there is no way to inspect the evaluation environment so you are never sure
> which environment a given promise is evaluating in) and possibly
> for writing programs as well.
>
> On 9/27/07, Luke Tierney <luke at stat.uiowa.edu> wrote:
>> On Wed, 26 Sep 2007, Gabor Grothendieck wrote:
>>
>>> I thought that perhaps the behavior in the previous post,
>>> while inconsistent with the documentation, was not all that
>>> harmful but I think its related to the following which is a potentially
>>> serious bug.
>>
>> The previous discussion already established that as.list of an
>> environment should not return a list with promises in as promises
>> should not be visible at the R level.  (Another loophole that needs
>> closing is $ for environments). So behavior of results that should not
>> exist is undefined and I cannot see how any such behavior is a further
>> bug, serious or otherwise.
>>
>>> z is a list with a single numeric component,
>>> as the dput output verifies,
>>
>> Except it isn't, as print or str verify, which might be a problem if z
>> was an input these functions should expect, but it isn't.
>>
>>> yet we cannot compare its first element
>>> to 7 without getting an error message.
>>>
>>> Later on we see that its because it thinks that z[[1]] is of type "promise"
>>
>> As z[[1]] is in fact of type promise that would seem a fairly
>> reasonable thing to think at this point ...
>>
>>> and even force(z[[1]]) is of type "promise".
>>
>> which is consistent with what force is documented to do. The
>> documentation is quite explicit that force does not do what you seem
>> to be expecting.  That documentation is from a time when delay()
>> existed to produce promises at the R level, which was a nightmare
>> because of all the peculiarities it introduced, which is why it was
>> removed.
>>
>> force is intended for one thing only -- replacing code like this:
>>
>>       # I know the following line look really stupid and you will be
>>       # tempted to remove it for efficiency but DO NOT: it is needed
>>       # to make sure that the formal argument y is evaluated at this
>>       # point.
>>       y <- y
>>
>> with this:
>>
>>      force(y)
>>
>> which seems much clearer -- at least it suggest you look at the help
>> page for force to see what it does.
>>
>> At this point promises should only ever exist in bindings in
>> environments. If we wanted lazy evaluation constructs more widely
>> there are really only two sensible options:
>>
>>     The Scheme option where a special function delay creates a deferred
>>     evaluation and another, called force in Scheme, forces the evaluation
>>     but there is no implicit forcing
>>
>> or
>>
>>     The Haskell option where data structurs are created lazily so
>>
>>         z <- list(f(x))
>>
>>     would create a list with a deferred evaluation, but any attempt to
>>     access the value of z would force the evaluation. So printing z,
>>     for example, would force the evaluation but
>>
>>        y <- z[[1]]
>>
>>     would not.
>>
>> It is easy enough to create a Delay/Force pair that behaves like
>> Scheme's with the tools available in R if that is what you want.
>> Haskell, and other fully lazy functional languages, are very
>> interesting but very different animals from R. For some reason you
>> seem to be expecting some combination of Scheme and Haskell behavior.
>>
>> Best,
>>
>> luke
>>
>>>
>>>> f <- function(x) environment()
>>>> z <- as.list(f(7))
>>>> dput(z)
>>> structure(list(x = 7), .Names = "x")
>>>> z[[1]] == 7
>>> Error in z[[1]] == 7 :
>>>  comparison (1) is possible only for atomic and list types
>>>> force(z[[1]]) == 7
>>> Error in force(z[[1]]) == 7 :
>>>  comparison (1) is possible only for atomic and list types
>>>>
>>>> typeof(z)
>>> [1] "list"
>>>> typeof(z[[1]])
>>> [1] "promise"
>>>> typeof(force(z[[1]]))
>>> [1] "promise"
>>>> R.version.string # Vista
>>> [1] "R version 2.6.0 beta (2007-09-23 r42958)"
>>>
>>>
>>> On 9/19/07, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
>>>> The last two lines of example(delayedAssign) give this:
>>>>
>>>>> e <- (function(x, y = 1, z) environment())(1+2, "y", {cat(" HO! "); pi+2})
>>>>> (le <- as.list(e)) # evaluates the promises
>>>> $x
>>>> <promise: 0x032b31f8>
>>>> $y
>>>> <promise: 0x032b3230>
>>>> $z
>>>> <promise: 0x032b3268>
>>>>
>>>> which contrary to the comment appears unevaluated.  Is the comment
>>>> wrong or is it supposed to return an evaluated result but doesn't?
>>>>
>>>>> R.version.string # Vista
>>>> [1] "R version 2.6.0 alpha (2007-09-06 r42791)"
>>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> --
>> Luke Tierney
>> Chair, Statistics and Actuarial Science
>> Ralph E. Wareham Professor of Mathematical Sciences
>> University of Iowa                  Phone:             319-335-3386
>> Department of Statistics and        Fax:               319-335-3017
>>    Actuarial Science
>> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
>> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>>
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From ggrothendieck at gmail.com  Thu Sep 27 16:24:14 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 27 Sep 2007 10:24:14 -0400
Subject: [Rd] delayedAssign
In-Reply-To: <Pine.LNX.4.64.0709270846160.10257@nokomis.stat.uiowa.edu>
References: <971536df0709191230p3a62d94g1dcf8f978dad6305@mail.gmail.com>
	<971536df0709261849s519cb30uf72871bf0f7a8b0d@mail.gmail.com>
	<Pine.LNX.4.64.0709270531100.2593@itasca2.wildberry.org>
	<971536df0709270530s648b5759j3ccff2a62ef33abf@mail.gmail.com>
	<Pine.LNX.4.64.0709270846160.10257@nokomis.stat.uiowa.edu>
Message-ID: <971536df0709270724s64148757o9ca8c23a6abffc9c@mail.gmail.com>

You or Peter stated that promises are internal so clearly they
should be evaluated going in or out of lists.  Otherwise you get
the current situation.

If you had just wasted as much time as I have trying to debug
a program with promises you would immediately understand why
it was necessary
to be able to query a promise for its evaluation environment.  I think
this is an obvious requirement for anyone dealing with promises since
you are never quite sure what environment the promises are being
evaluated with respect to.  If you knew this then you would immediately
understand if its doing what you think.  Its like trying to debug a program
without any way of finding out what the variables are at any point in the
program.

For the other features see #1 in these release notes (for the
next version of proto) which features lazy evaluation:

http://r-proto.googlecode.com/svn/trunk/inst/ReleaseNotes.txt

The examples there already seem to work with the devel version of proto
(available on the Source tab of r-proto.googlecode.com) but
not necessarily in a desirable way.  In the current implementation cloned
objects have their promises forced in the specified environment
defaulting to current environment rather than the original environment.
We don't know what the
original environment is since its not available at the R level, i.e.
substitute will tell us the expression but not the evaluation environment.
We could redundantly pass the evaluation environment around but then
it would not
be garbage collected causing large amount of inefficiency and
anyways, it seems pointless when the information is there and
just needs to be made accessible.  I think the default is that cloned
promises should be evaluated in the original
environment since that one is known to hold the variables that are
being evaluated whereas the current environment may or may not have
variables of those names.  In order to try this and variations on this
we need the three wish list items.

On 9/27/07, Luke Tierney <luke at stat.uiowa.edu> wrote:
> On Thu, 27 Sep 2007, Gabor Grothendieck wrote:
>
> > Thanks for the explanation.
> >
> > For lists either: (a) promises should be evaluated as they
> > enter the list or (b) promises evaluated as they exit the
> > list (i.e. as they are compared, inspected, etc.).
>
> What makes you conclude that this is what "should" happen?
>
> Again, promises are internal.  We could, and maybe will, eliminate
> promises in favor of a mark on bindings in environments that indicates
> that they need to be evaluated.  At the R level this woud produce the
> same behavior as we currently (intend to) have.
>
> If we allowed lazy structures outside of bindings then I still don't
> see how (b) "should" happen.  With Scheme-like semantics we would
> definitely NOT want this to happen; with Haskell-like semantics any
> attempt to look at the value (including priting) would result in
> evaluation (and replacing the promise/thunk/whatever by its value).
>
> > I gather
> > the intent was (a) but it does not happen that way due to
> > a bug in R.   Originally I thought (b) would then occur but
> > my surprise was that it does not occur either which is why
> > I feel its more serious than I had originally thought.
> >
> > I think its ok if promises only exist in environments and not
> > lists.  Items that would be on my wishlist would be to be able
> > to do at R level the two mentioned previously
> >
> > https://stat.ethz.ch/pipermail/r-devel/2007-September/046943.html
>
> I am still not persuaded that tools for inspecting environments are
> worth the time and effort required but I am prepared to be.
>
> Best,
>
> luke
>
> >
> > and thirdly an ability to get the evaluation environment, not just the
> > expression,
> > associated with a promise -- substitute only gets the expression.
> > Originally I thought I would need some or all of these wish items
> > and then thought not but am back to the original situation again as I use
> > them more and realize that they are at least important
> > for debugging (its very difficult to debug situations involving promises as
> > there is no way to inspect the evaluation environment so you are never sure
> > which environment a given promise is evaluating in) and possibly
> > for writing programs as well.
> >
> > On 9/27/07, Luke Tierney <luke at stat.uiowa.edu> wrote:
> >> On Wed, 26 Sep 2007, Gabor Grothendieck wrote:
> >>
> >>> I thought that perhaps the behavior in the previous post,
> >>> while inconsistent with the documentation, was not all that
> >>> harmful but I think its related to the following which is a potentially
> >>> serious bug.
> >>
> >> The previous discussion already established that as.list of an
> >> environment should not return a list with promises in as promises
> >> should not be visible at the R level.  (Another loophole that needs
> >> closing is $ for environments). So behavior of results that should not
> >> exist is undefined and I cannot see how any such behavior is a further
> >> bug, serious or otherwise.
> >>
> >>> z is a list with a single numeric component,
> >>> as the dput output verifies,
> >>
> >> Except it isn't, as print or str verify, which might be a problem if z
> >> was an input these functions should expect, but it isn't.
> >>
> >>> yet we cannot compare its first element
> >>> to 7 without getting an error message.
> >>>
> >>> Later on we see that its because it thinks that z[[1]] is of type "promise"
> >>
> >> As z[[1]] is in fact of type promise that would seem a fairly
> >> reasonable thing to think at this point ...
> >>
> >>> and even force(z[[1]]) is of type "promise".
> >>
> >> which is consistent with what force is documented to do. The
> >> documentation is quite explicit that force does not do what you seem
> >> to be expecting.  That documentation is from a time when delay()
> >> existed to produce promises at the R level, which was a nightmare
> >> because of all the peculiarities it introduced, which is why it was
> >> removed.
> >>
> >> force is intended for one thing only -- replacing code like this:
> >>
> >>       # I know the following line look really stupid and you will be
> >>       # tempted to remove it for efficiency but DO NOT: it is needed
> >>       # to make sure that the formal argument y is evaluated at this
> >>       # point.
> >>       y <- y
> >>
> >> with this:
> >>
> >>      force(y)
> >>
> >> which seems much clearer -- at least it suggest you look at the help
> >> page for force to see what it does.
> >>
> >> At this point promises should only ever exist in bindings in
> >> environments. If we wanted lazy evaluation constructs more widely
> >> there are really only two sensible options:
> >>
> >>     The Scheme option where a special function delay creates a deferred
> >>     evaluation and another, called force in Scheme, forces the evaluation
> >>     but there is no implicit forcing
> >>
> >> or
> >>
> >>     The Haskell option where data structurs are created lazily so
> >>
> >>         z <- list(f(x))
> >>
> >>     would create a list with a deferred evaluation, but any attempt to
> >>     access the value of z would force the evaluation. So printing z,
> >>     for example, would force the evaluation but
> >>
> >>        y <- z[[1]]
> >>
> >>     would not.
> >>
> >> It is easy enough to create a Delay/Force pair that behaves like
> >> Scheme's with the tools available in R if that is what you want.
> >> Haskell, and other fully lazy functional languages, are very
> >> interesting but very different animals from R. For some reason you
> >> seem to be expecting some combination of Scheme and Haskell behavior.
> >>
> >> Best,
> >>
> >> luke
> >>
> >>>
> >>>> f <- function(x) environment()
> >>>> z <- as.list(f(7))
> >>>> dput(z)
> >>> structure(list(x = 7), .Names = "x")
> >>>> z[[1]] == 7
> >>> Error in z[[1]] == 7 :
> >>>  comparison (1) is possible only for atomic and list types
> >>>> force(z[[1]]) == 7
> >>> Error in force(z[[1]]) == 7 :
> >>>  comparison (1) is possible only for atomic and list types
> >>>>
> >>>> typeof(z)
> >>> [1] "list"
> >>>> typeof(z[[1]])
> >>> [1] "promise"
> >>>> typeof(force(z[[1]]))
> >>> [1] "promise"
> >>>> R.version.string # Vista
> >>> [1] "R version 2.6.0 beta (2007-09-23 r42958)"
> >>>
> >>>
> >>> On 9/19/07, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> >>>> The last two lines of example(delayedAssign) give this:
> >>>>
> >>>>> e <- (function(x, y = 1, z) environment())(1+2, "y", {cat(" HO! "); pi+2})
> >>>>> (le <- as.list(e)) # evaluates the promises
> >>>> $x
> >>>> <promise: 0x032b31f8>
> >>>> $y
> >>>> <promise: 0x032b3230>
> >>>> $z
> >>>> <promise: 0x032b3268>
> >>>>
> >>>> which contrary to the comment appears unevaluated.  Is the comment
> >>>> wrong or is it supposed to return an evaluated result but doesn't?
> >>>>
> >>>>> R.version.string # Vista
> >>>> [1] "R version 2.6.0 alpha (2007-09-06 r42791)"
> >>>>
> >>>
> >>> ______________________________________________
> >>> R-devel at r-project.org mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>>
> >>
> >> --
> >> Luke Tierney
> >> Chair, Statistics and Actuarial Science
> >> Ralph E. Wareham Professor of Mathematical Sciences
> >> University of Iowa                  Phone:             319-335-3386
> >> Department of Statistics and        Fax:               319-335-3017
> >>    Actuarial Science
> >> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
> >> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
> >>
> >
>
> --
> Luke Tierney
> Chair, Statistics and Actuarial Science
> Ralph E. Wareham Professor of Mathematical Sciences
> University of Iowa                  Phone:             319-335-3386
> Department of Statistics and        Fax:               319-335-3017
>    Actuarial Science
> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>


From ecjbosu at aol.com  Thu Sep 27 15:53:38 2007
From: ecjbosu at aol.com (Joe W Byers)
Date: Thu, 27 Sep 2007 13:53:38 +0000 (UTC)
Subject: [Rd] rJava and RJDBC
References: <fdf330$e7b$1@sea.gmane.org>
	<2D6F08DC-1015-4210-8764-95B59BB2B3EF@r-project.org>
Message-ID: <loom.20070927T135136-157@post.gmane.org>

Simon Urbanek <simon.urbanek <at> r-project.org> writes:

> 
> Joe,
> 
> which version of R and RJDBC are you using? The behavior you describe  
> should have been fixed in RJDBC 0.1-4. Please try the latest version  
> from rforge
> install.packages("RJDBC",,"http://rforge.net/")
> and please let me know if that solves your problem.
> 
> Cheers,
> Simon

Simon,

Thank you so much.  I have been working on this for a week.

I also have not been using rforge.net as a repository only the defaults to get
my package update.  Usually the IL mirror.

This really rocks!.

Agains,  Thank you and have a wonderful day.

Joe


From P.Dalgaard at biostat.ku.dk  Thu Sep 27 16:43:31 2007
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu, 27 Sep 2007 16:43:31 +0200
Subject: [Rd] modifying large R objects in place
In-Reply-To: <20070927131317.GB7605@cs.cas.cz>
References: <20070926092924.GA9879@cs.cas.cz>	<7098abec0709261052q3a6b01e2v562f9a88ed81c513@mail.gmail.com>
	<20070927131317.GB7605@cs.cas.cz>
Message-ID: <46FBC193.7070405@biostat.ku.dk>

Petr Savicky wrote:
> On Wed, Sep 26, 2007 at 10:52:28AM -0700, Byron Ellis wrote:
>   
>> For the most part, doing anything to an R object result in it's
>> duplication. You generally have to do a lot of work to NOT copy an R
>> object.
>>     
>
> Thank you for your response. Unfortunately, you are right. For example,
> the allocated memory determined by top command on Linux may change during
> a session as follows:
>   a <- matrix(as.integer(1),nrow=14100,ncol=14100) # 774m
>   a[1,1] <- 0 # 3.0g
>   gc() # 1.5g
>
> In the current applicatin, I modify the matrix only using my own C code
> and only read it on R level. So, the above is not a big problem for me
> (at least not now).
>
> However, there is a related thing, which could be a bug. The following
> code determines the value of NAMED field in SEXP header of an object:
>
>   SEXP getnamed(SEXP a)
>   {
>       SEXP out;
>       PROTECT(out = allocVector(INTSXP, 1));
>       INTEGER(out)[0] = NAMED(a);
>       UNPROTECT(1);
>       return(out);
>   }
>
> Now, consider the following session
>
>   u <- matrix(as.integer(1),nrow=5,ncol=3) + as.integer(0)
>   .Call("getnamed",u) # 1 (OK)
>
>   length(u)
>   .Call("getnamed",u) # 1 (OK)
>
>   dim(u)
>   .Call("getnamed",u) # 1 (OK)
>
>   nrow(u)
>   .Call("getnamed",u) # 2 (why?)
>
>   u <- matrix(as.integer(1),nrow=5,ncol=3) + as.integer(0)
>   .Call("getnamed",u) # 1 (OK)
>   ncol(u)
>   .Call("getnamed",u) # 2 (so, ncol does the same)
>
> Is this a bug?
>   
No. It is an infelicity.

The issues are that
1. length() and dim() call .Primitive directly, whereas nrow() and 
ncol() are "real" R functions
2. NAMED records whether an object has _ever_  had  0, 1, or 2+ names

During the evaluation of ncol(u). the argument x is evaluated, and at
that point the object "u" is also named "x" in the evaluation frame of
ncol(). A full(er) reference counting system might drop NAMED back to 1
when exiting ncol(), but currently, R  can only count up (and trying to
find the conditions under which it is safe to reduce NAMED will make
your head spin, believe me! )
> Petr Savicky.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Thu Sep 27 16:45:03 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 27 Sep 2007 15:45:03 +0100 (BST)
Subject: [Rd] modifying large R objects in place
In-Reply-To: <20070927131317.GB7605@cs.cas.cz>
References: <20070926092924.GA9879@cs.cas.cz>
	<7098abec0709261052q3a6b01e2v562f9a88ed81c513@mail.gmail.com>
	<20070927131317.GB7605@cs.cas.cz>
Message-ID: <Pine.LNX.4.64.0709271502300.6922@gannet.stats.ox.ac.uk>

1) You implicitly coerced 'a' to be numeric and thereby (almost) doubled 
its size: did you intend to?  Does that explain your confusion?


2) I expected NAMED on 'a' to be incremented by nrow(a): here is my 
understanding.

When you called nrow(a) you created another reference to 'a' in the 
evaluation frame of nrow.  (At a finer level you first created a promise 
to 'a' and then dim(x) evaluated that promise, which did SET_NAMED(<SEXP>) 
= 2.)  So NAMED(a) was correctly bumped to 2, and it is never reduced.

More generally, any argument to a closure that actually gets used will 
get NAMED set to 2.

Having too high a value of NAMED could never be a 'bug'.  See the 
explanation in the R Internals manual:

   When an object is about to be altered, the named field is consulted. A
   value of 2 means that the object must be duplicated before being
   changed.  (Note that this does not say that it is necessary to
   duplicate, only that it should be duplicated whether necessary or not.)


3) Memory profiling can be helpful in telling you exactly what copies get 
made.



On Thu, 27 Sep 2007, Petr Savicky wrote:

> On Wed, Sep 26, 2007 at 10:52:28AM -0700, Byron Ellis wrote:
>> For the most part, doing anything to an R object result in it's
>> duplication. You generally have to do a lot of work to NOT copy an R
>> object.
>
> Thank you for your response. Unfortunately, you are right. For example,
> the allocated memory determined by top command on Linux may change during
> a session as follows:
>  a <- matrix(as.integer(1),nrow=14100,ncol=14100) # 774m
>  a[1,1] <- 0 # 3.0g
>  gc() # 1.5g
>
> In the current applicatin, I modify the matrix only using my own C code
> and only read it on R level. So, the above is not a big problem for me
> (at least not now).
>
> However, there is a related thing, which could be a bug. The following
> code determines the value of NAMED field in SEXP header of an object:
>
>  SEXP getnamed(SEXP a)
>  {
>      SEXP out;
>      PROTECT(out = allocVector(INTSXP, 1));
>      INTEGER(out)[0] = NAMED(a);
>      UNPROTECT(1);
>      return(out);
>  }
>
> Now, consider the following session
>
>  u <- matrix(as.integer(1),nrow=5,ncol=3) + as.integer(0)
>  .Call("getnamed",u) # 1 (OK)
>
>  length(u)
>  .Call("getnamed",u) # 1 (OK)
>
>  dim(u)
>  .Call("getnamed",u) # 1 (OK)
>
>  nrow(u)
>  .Call("getnamed",u) # 2 (why?)
>
>  u <- matrix(as.integer(1),nrow=5,ncol=3) + as.integer(0)
>  .Call("getnamed",u) # 1 (OK)
>  ncol(u)
>  .Call("getnamed",u) # 2 (so, ncol does the same)
>
> Is this a bug?
>
> Petr Savicky.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Mike.Lawrence at DAL.CA  Thu Sep 27 17:57:55 2007
From: Mike.Lawrence at DAL.CA (Mike Lawrence)
Date: Thu, 27 Sep 2007 12:57:55 -0300
Subject: [Rd] Aggregate factor names
Message-ID: <375E8B77-0436-472C-9F85-C56B46DFFEE9@DAL.CA>

Hi all,

A suggestion derived from discussions amongst a number of R users in  
my research group: set the default column names produced by aggregate 
() equal to the names of the objects in the list passed to the 'by'  
object.

ex. it is annoying to type

with(
	my.data
	,aggregate(
		my.dv
		,list(
			one.iv = one.iv
			,another.iv = another.iv
			,yet.another.iv = yet.another.iv
		)
		,some.function
	)
)

to yield a data frame with names = c 
('one.iv','another.iv','yet.another.iv','x') when this seems more  
economical:

with(
	my.data
	,aggregate(
		my.dv
		,list(
			one.iv
			,another.iv
			,yet.another.iv
		)
		,some.function
	)
)

--
Mike Lawrence
Graduate Student, Department of Psychology, Dalhousie University

Website: http://memetic.ca

Public calendar: http://icalx.com/public/informavore/Public

"The road to wisdom? Well, it's plain and simple to express:
Err and err and err again, but less and less and less."
	- Piet Hein


From ggrothendieck at gmail.com  Thu Sep 27 18:06:09 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 27 Sep 2007 12:06:09 -0400
Subject: [Rd] Aggregate factor names
In-Reply-To: <375E8B77-0436-472C-9F85-C56B46DFFEE9@DAL.CA>
References: <375E8B77-0436-472C-9F85-C56B46DFFEE9@DAL.CA>
Message-ID: <971536df0709270906g2227637ev7faabf8daf05be4@mail.gmail.com>

You can do this:

aggregate(iris[-5], iris[5], mean)


On 9/27/07, Mike Lawrence <Mike.Lawrence at dal.ca> wrote:
> Hi all,
>
> A suggestion derived from discussions amongst a number of R users in
> my research group: set the default column names produced by aggregate
> () equal to the names of the objects in the list passed to the 'by'
> object.
>
> ex. it is annoying to type
>
> with(
>        my.data
>        ,aggregate(
>                my.dv
>                ,list(
>                        one.iv = one.iv
>                        ,another.iv = another.iv
>                        ,yet.another.iv = yet.another.iv
>                )
>                ,some.function
>        )
> )
>
> to yield a data frame with names = c
> ('one.iv','another.iv','yet.another.iv','x') when this seems more
> economical:
>
> with(
>        my.data
>        ,aggregate(
>                my.dv
>                ,list(
>                        one.iv
>                        ,another.iv
>                        ,yet.another.iv
>                )
>                ,some.function
>        )
> )
>
> --
> Mike Lawrence
> Graduate Student, Department of Psychology, Dalhousie University
>
> Website: http://memetic.ca
>
> Public calendar: http://icalx.com/public/informavore/Public
>
> "The road to wisdom? Well, it's plain and simple to express:
> Err and err and err again, but less and less and less."
>        - Piet Hein
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From Mike.Lawrence at dal.ca  Thu Sep 27 18:11:24 2007
From: Mike.Lawrence at dal.ca (Mike Lawrence)
Date: Thu, 27 Sep 2007 13:11:24 -0300
Subject: [Rd] Aggregate factor names
In-Reply-To: <971536df0709270906g2227637ev7faabf8daf05be4@mail.gmail.com>
References: <375E8B77-0436-472C-9F85-C56B46DFFEE9@DAL.CA>
	<971536df0709270906g2227637ev7faabf8daf05be4@mail.gmail.com>
Message-ID: <7C6C5FCB-6050-4E1D-9406-137989F834B9@dal.ca>

Understood, but my point is that the naming I suggest should be the  
default. One should not be 'punished' for being explicit in calling  
aggregate.


On 27-Sep-07, at 1:06 PM, Gabor Grothendieck wrote:

> You can do this:
>
> aggregate(iris[-5], iris[5], mean)
>
>
> On 9/27/07, Mike Lawrence <Mike.Lawrence at dal.ca> wrote:
>> Hi all,
>>
>> A suggestion derived from discussions amongst a number of R users in
>> my research group: set the default column names produced by aggregate
>> () equal to the names of the objects in the list passed to the 'by'
>> object.
>>
>> ex. it is annoying to type
>>
>> with(
>>        my.data
>>        ,aggregate(
>>                my.dv
>>                ,list(
>>                        one.iv = one.iv
>>                        ,another.iv = another.iv
>>                        ,yet.another.iv = yet.another.iv
>>                )
>>                ,some.function
>>        )
>> )
>>
>> to yield a data frame with names = c
>> ('one.iv','another.iv','yet.another.iv','x') when this seems more
>> economical:
>>
>> with(
>>        my.data
>>        ,aggregate(
>>                my.dv
>>                ,list(
>>                        one.iv
>>                        ,another.iv
>>                        ,yet.another.iv
>>                )
>>                ,some.function
>>        )
>> )
>>
>> --
>> Mike Lawrence
>> Graduate Student, Department of Psychology, Dalhousie University
>>
>> Website: http://memetic.ca
>>
>> Public calendar: http://icalx.com/public/informavore/Public
>>
>> "The road to wisdom? Well, it's plain and simple to express:
>> Err and err and err again, but less and less and less."
>>        - Piet Hein
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>

--
Mike Lawrence
Graduate Student, Department of Psychology, Dalhousie University

Website: http://memetic.ca

Public calendar: http://icalx.com/public/informavore/Public

"The road to wisdom? Well, it's plain and simple to express:
Err and err and err again, but less and less and less."
	- Piet Hein


From ggrothendieck at gmail.com  Thu Sep 27 18:51:45 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 27 Sep 2007 12:51:45 -0400
Subject: [Rd] Aggregate factor names
In-Reply-To: <7C6C5FCB-6050-4E1D-9406-137989F834B9@dal.ca>
References: <375E8B77-0436-472C-9F85-C56B46DFFEE9@DAL.CA>
	<971536df0709270906g2227637ev7faabf8daf05be4@mail.gmail.com>
	<7C6C5FCB-6050-4E1D-9406-137989F834B9@dal.ca>
Message-ID: <971536df0709270951n636f1d4fr1f3485409e353375@mail.gmail.com>

You can do this too:

aggregate(iris[-5], iris["Species"], mean)

or this:

with(iris, aggregate(iris[-5], data.frame(Species), mean))

or this:

attach(iris)
aggregate(iris[-5], data.frame(Species), mean)

The point is that you already don't have to write x = x.  The only
reason you are writing it that way is that you are using list instead
of data.frame.  Just use data.frame or appropriate indexing as shown.

On 9/27/07, Mike Lawrence <Mike.Lawrence at dal.ca> wrote:
> Understood, but my point is that the naming I suggest should be the
> default. One should not be 'punished' for being explicit in calling
> aggregate.
>
>
> On 27-Sep-07, at 1:06 PM, Gabor Grothendieck wrote:
>
> > You can do this:
> >
> > aggregate(iris[-5], iris[5], mean)
> >
> >
> > On 9/27/07, Mike Lawrence <Mike.Lawrence at dal.ca> wrote:
> >> Hi all,
> >>
> >> A suggestion derived from discussions amongst a number of R users in
> >> my research group: set the default column names produced by aggregate
> >> () equal to the names of the objects in the list passed to the 'by'
> >> object.
> >>
> >> ex. it is annoying to type
> >>
> >> with(
> >>        my.data
> >>        ,aggregate(
> >>                my.dv
> >>                ,list(
> >>                        one.iv = one.iv
> >>                        ,another.iv = another.iv
> >>                        ,yet.another.iv = yet.another.iv
> >>                )
> >>                ,some.function
> >>        )
> >> )
> >>
> >> to yield a data frame with names = c
> >> ('one.iv','another.iv','yet.another.iv','x') when this seems more
> >> economical:
> >>
> >> with(
> >>        my.data
> >>        ,aggregate(
> >>                my.dv
> >>                ,list(
> >>                        one.iv
> >>                        ,another.iv
> >>                        ,yet.another.iv
> >>                )
> >>                ,some.function
> >>        )
> >> )
> >>
> >> --
> >> Mike Lawrence
> >> Graduate Student, Department of Psychology, Dalhousie University
> >>
> >> Website: http://memetic.ca
> >>
> >> Public calendar: http://icalx.com/public/informavore/Public
> >>
> >> "The road to wisdom? Well, it's plain and simple to express:
> >> Err and err and err again, but less and less and less."
> >>        - Piet Hein
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
>
> --
> Mike Lawrence
> Graduate Student, Department of Psychology, Dalhousie University
>
> Website: http://memetic.ca
>
> Public calendar: http://icalx.com/public/informavore/Public
>
> "The road to wisdom? Well, it's plain and simple to express:
> Err and err and err again, but less and less and less."
>        - Piet Hein
>
>
>


From ripley at stats.ox.ac.uk  Thu Sep 27 18:59:05 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 27 Sep 2007 17:59:05 +0100 (BST)
Subject: [Rd] Aggregate factor names
In-Reply-To: <375E8B77-0436-472C-9F85-C56B46DFFEE9@DAL.CA>
References: <375E8B77-0436-472C-9F85-C56B46DFFEE9@DAL.CA>
Message-ID: <Pine.LNX.4.64.0709271724220.30773@gannet.stats.ox.ac.uk>

You seem to be assuming that the argument 'by' to the "data frame" method 
of aggregate() is a call to list() with arguments which are names (and 
evaluate to factors).

When aggregate.data.frame comes to be called, the 'by' argument is a 
promise to the actual argument.  In your example the actual argument is 
the call (in a readable layout)

list(one.iv, another.iv, yet.another.iv)

but that is one of a very large number of possibilities for 'by'.  Trying 
to produce reasonable names for unnamed arguments is hard enough (see 
?cbind), but trying to deduce reasonable names for the elements of a list 
argument is one step further up the chain.  Further, if we did that, 
people who wanted the documented behaviour would not longer be able to get 
it.

I think what you want is a function that takes unnamed arguments and 
returns a named list, to replace your usage of list().  That's not so very 
hard to do, not least as in this context data.frame() will do the job.
So to extend the example on the help page

> aggregate(x = testDF, by = data.frame(by1, by2), FUN = "mean")
    by1  by2 v1 v2
1    1   95  5 55
2    2   95  7 77
3    1   99  5 55
4    2   99 NA NA
5  big damp  3 33
6 blue  dry  3 33
7  red  red  4 44
8  red  wet  1 11

However, note that the grouping variables need NOT be factors, and this 
has made them so.  So you may want to look at data.frame() and
write list_with_names() to do just that.



On Thu, 27 Sep 2007, Mike Lawrence wrote:

> Hi all,
>
> A suggestion derived from discussions amongst a number of R users in
> my research group: set the default column names produced by aggregate
> () equal to the names of the objects in the list passed to the 'by'
> object.
>
> ex. it is annoying to type
>
> with(
> 	my.data
> 	,aggregate(
> 		my.dv
> 		,list(
> 			one.iv = one.iv
> 			,another.iv = another.iv
> 			,yet.another.iv = yet.another.iv
> 		)
> 		,some.function
> 	)
> )
>
> to yield a data frame with names = c
> ('one.iv','another.iv','yet.another.iv','x') when this seems more
> economical:
>
> with(
> 	my.data
> 	,aggregate(
> 		my.dv
> 		,list(
> 			one.iv
> 			,another.iv
> 			,yet.another.iv
> 		)
> 		,some.function
> 	)
> )
>
> --
> Mike Lawrence
> Graduate Student, Department of Psychology, Dalhousie University
>
> Website: http://memetic.ca
>
> Public calendar: http://icalx.com/public/informavore/Public
>
> "The road to wisdom? Well, it's plain and simple to express:
> Err and err and err again, but less and less and less."
> 	- Piet Hein
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at stat.berkeley.edu  Thu Sep 27 20:30:34 2007
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Thu, 27 Sep 2007 11:30:34 -0700
Subject: [Rd] Unnecessary extra copy with matrix(...,
	dimnames=NULL) (Was: Re:  modifying large R objects in place)
Message-ID: <59d7961d0709271130l227cd4e3n6394a883b248dcb7@mail.gmail.com>

As others already mentioned, in your example you are first creating an
integer matrix and the coercing it to a double matrix by assigning
(double) 1 to element [1,1].  However, even when correcting for this
mistake, there is an extra copy created when using matrix().

Try this in a fresh vanilla R session:

> print(gc())
         used (Mb) gc trigger (Mb) max used (Mb)
Ncells 136684  3.7     350000  9.4   350000  9.4
Vcells  81026  0.7     786432  6.0   473127  3.7
> x <- matrix(1, nrow=5000, ncol=5000)
> print(gc())
           used  (Mb) gc trigger  (Mb) max used  (Mb)
Ncells   136793   3.7     350000   9.4   350000   9.4
Vcells 25081043 191.4   27989266 213.6 25081056 191.4
> x[1,1] <- 2
> print(gc())
           used  (Mb) gc trigger  (Mb) max used  (Mb)
Ncells   136797   3.7     350000   9.4   350000   9.4
Vcells 25081044 191.4   52830254 403.1 50081058 382.1

So, yes, in that x[1,1] <- 2 assignment an extra copy is created.  It
is related to to the fact that there is NAMED matrix object being
created inside matrix(), cf. the last rows in matrix():

    x <- .Internal(matrix(data, nrow, ncol, byrow))
    dimnames(x) <- dimnames
    x

Here is a patch for matrix() that avoids this problem *when dimnames
is NULL* (which is many time the case):

matrix <- function(data=NA, nrow=1, ncol=1, byrow=FALSE, dimnames=NULL) {
  data <- as.vector(data);

  if(missing(nrow)) {
    nrow <- ceiling(length(data)/ncol);
  } else if(missing(ncol)) {
    ncol <- ceiling(length(data)/nrow);
  }

  # Trick to avoid extra copy in the case when 'dimnames' is NULL.
  if (is.null(dimnames)) {
    .Internal(matrix(data, nrow, ncol, byrow));
  } else {
    x <- .Internal(matrix(data, nrow, ncol, byrow));
    dimnames(x) <- dimnames;
    x;
  }
} # matrix()


Try the above again in a fresh R session with this patch applied and you'll get:

> print(gc())
         used (Mb) gc trigger (Mb) max used (Mb)
Ncells 136805  3.7     350000  9.4   350000  9.4
Vcells  81122  0.7     786432  6.0   473127  3.7
> x <- matrix(1, nrow=5000, ncol=5000)
> print(gc())
           used  (Mb) gc trigger  (Mb) max used  (Mb)
Ncells   136919   3.7     350000   9.4   350000   9.4
Vcells 25081139 191.4   27989372 213.6 25081152 191.4
> x[1,1] <- 2
> print(gc())
           used  (Mb) gc trigger  (Mb) max used  (Mb)
Ncells   136923   3.7     350000   9.4   350000   9.4
Vcells 25081140 191.4   29468840 224.9 25081276 191.4

Voila!

I talked to Luke Tierney about this and he though the internal method
should be updated to take the dimnames argument, i.e.
.Internal(matrix(data, nrow, ncol, byrow, dimnames)).  However, until
that is happening, may I suggest this simple patch/workaround to go in
R v2.6.0?

Cheers

Henrik


On 9/27/07, Petr Savicky <savicky at cs.cas.cz> wrote:
> On Wed, Sep 26, 2007 at 10:52:28AM -0700, Byron Ellis wrote:
> > For the most part, doing anything to an R object result in it's
> > duplication. You generally have to do a lot of work to NOT copy an R
> > object.
>
> Thank you for your response. Unfortunately, you are right. For example,
> the allocated memory determined by top command on Linux may change during
> a session as follows:
>   a <- matrix(as.integer(1),nrow=14100,ncol=14100) # 774m
>   a[1,1] <- 0 # 3.0g
>   gc() # 1.5g
>
> In the current applicatin, I modify the matrix only using my own C code
> and only read it on R level. So, the above is not a big problem for me
> (at least not now).
>
> However, there is a related thing, which could be a bug. The following
> code determines the value of NAMED field in SEXP header of an object:
>
>   SEXP getnamed(SEXP a)
>   {
>       SEXP out;
>       PROTECT(out = allocVector(INTSXP, 1));
>       INTEGER(out)[0] = NAMED(a);
>       UNPROTECT(1);
>       return(out);
>   }
>
> Now, consider the following session
>
>   u <- matrix(as.integer(1),nrow=5,ncol=3) + as.integer(0)
>   .Call("getnamed",u) # 1 (OK)
>
>   length(u)
>   .Call("getnamed",u) # 1 (OK)
>
>   dim(u)
>   .Call("getnamed",u) # 1 (OK)
>
>   nrow(u)
>   .Call("getnamed",u) # 2 (why?)
>
>   u <- matrix(as.integer(1),nrow=5,ncol=3) + as.integer(0)
>   .Call("getnamed",u) # 1 (OK)
>   ncol(u)
>   .Call("getnamed",u) # 2 (so, ncol does the same)
>
> Is this a bug?
>
> Petr Savicky.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From hb at stat.berkeley.edu  Thu Sep 27 20:30:34 2007
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Thu, 27 Sep 2007 11:30:34 -0700
Subject: [Rd] Unnecessary extra copy with matrix(...,
	dimnames=NULL) (Was: Re:  modifying large R objects in place)
Message-ID: <59d7961d0709271130l227cd4e3n6394a883b248dcb7@mail.gmail.com>

As others already mentioned, in your example you are first creating an
integer matrix and the coercing it to a double matrix by assigning
(double) 1 to element [1,1].  However, even when correcting for this
mistake, there is an extra copy created when using matrix().

Try this in a fresh vanilla R session:

> print(gc())
         used (Mb) gc trigger (Mb) max used (Mb)
Ncells 136684  3.7     350000  9.4   350000  9.4
Vcells  81026  0.7     786432  6.0   473127  3.7
> x <- matrix(1, nrow=5000, ncol=5000)
> print(gc())
           used  (Mb) gc trigger  (Mb) max used  (Mb)
Ncells   136793   3.7     350000   9.4   350000   9.4
Vcells 25081043 191.4   27989266 213.6 25081056 191.4
> x[1,1] <- 2
> print(gc())
           used  (Mb) gc trigger  (Mb) max used  (Mb)
Ncells   136797   3.7     350000   9.4   350000   9.4
Vcells 25081044 191.4   52830254 403.1 50081058 382.1

So, yes, in that x[1,1] <- 2 assignment an extra copy is created.  It
is related to to the fact that there is NAMED matrix object being
created inside matrix(), cf. the last rows in matrix():

    x <- .Internal(matrix(data, nrow, ncol, byrow))
    dimnames(x) <- dimnames
    x

Here is a patch for matrix() that avoids this problem *when dimnames
is NULL* (which is many time the case):

matrix <- function(data=NA, nrow=1, ncol=1, byrow=FALSE, dimnames=NULL) {
  data <- as.vector(data);

  if(missing(nrow)) {
    nrow <- ceiling(length(data)/ncol);
  } else if(missing(ncol)) {
    ncol <- ceiling(length(data)/nrow);
  }

  # Trick to avoid extra copy in the case when 'dimnames' is NULL.
  if (is.null(dimnames)) {
    .Internal(matrix(data, nrow, ncol, byrow));
  } else {
    x <- .Internal(matrix(data, nrow, ncol, byrow));
    dimnames(x) <- dimnames;
    x;
  }
} # matrix()


Try the above again in a fresh R session with this patch applied and you'll get:

> print(gc())
         used (Mb) gc trigger (Mb) max used (Mb)
Ncells 136805  3.7     350000  9.4   350000  9.4
Vcells  81122  0.7     786432  6.0   473127  3.7
> x <- matrix(1, nrow=5000, ncol=5000)
> print(gc())
           used  (Mb) gc trigger  (Mb) max used  (Mb)
Ncells   136919   3.7     350000   9.4   350000   9.4
Vcells 25081139 191.4   27989372 213.6 25081152 191.4
> x[1,1] <- 2
> print(gc())
           used  (Mb) gc trigger  (Mb) max used  (Mb)
Ncells   136923   3.7     350000   9.4   350000   9.4
Vcells 25081140 191.4   29468840 224.9 25081276 191.4

Voila!

I talked to Luke Tierney about this and he though the internal method
should be updated to take the dimnames argument, i.e.
.Internal(matrix(data, nrow, ncol, byrow, dimnames)).  However, until
that is happening, may I suggest this simple patch/workaround to go in
R v2.6.0?

Cheers

Henrik


On 9/27/07, Petr Savicky <savicky at cs.cas.cz> wrote:
> On Wed, Sep 26, 2007 at 10:52:28AM -0700, Byron Ellis wrote:
> > For the most part, doing anything to an R object result in it's
> > duplication. You generally have to do a lot of work to NOT copy an R
> > object.
>
> Thank you for your response. Unfortunately, you are right. For example,
> the allocated memory determined by top command on Linux may change during
> a session as follows:
>   a <- matrix(as.integer(1),nrow=14100,ncol=14100) # 774m
>   a[1,1] <- 0 # 3.0g
>   gc() # 1.5g
>
> In the current applicatin, I modify the matrix only using my own C code
> and only read it on R level. So, the above is not a big problem for me
> (at least not now).
>
> However, there is a related thing, which could be a bug. The following
> code determines the value of NAMED field in SEXP header of an object:
>
>   SEXP getnamed(SEXP a)
>   {
>       SEXP out;
>       PROTECT(out = allocVector(INTSXP, 1));
>       INTEGER(out)[0] = NAMED(a);
>       UNPROTECT(1);
>       return(out);
>   }
>
> Now, consider the following session
>
>   u <- matrix(as.integer(1),nrow=5,ncol=3) + as.integer(0)
>   .Call("getnamed",u) # 1 (OK)
>
>   length(u)
>   .Call("getnamed",u) # 1 (OK)
>
>   dim(u)
>   .Call("getnamed",u) # 1 (OK)
>
>   nrow(u)
>   .Call("getnamed",u) # 2 (why?)
>
>   u <- matrix(as.integer(1),nrow=5,ncol=3) + as.integer(0)
>   .Call("getnamed",u) # 1 (OK)
>   ncol(u)
>   .Call("getnamed",u) # 2 (so, ncol does the same)
>
> Is this a bug?
>
> Petr Savicky.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From efg at stowers-institute.org  Thu Sep 27 21:53:47 2007
From: efg at stowers-institute.org (Earl F. Glynn)
Date: Thu, 27 Sep 2007 14:53:47 -0500
Subject: [Rd] R "capabilities" on a cluster node
Message-ID: <fdh1od$sor$1@sea.gmane.org>

R version 2.5.1 (2007-06-27)

I' running some simple R jobs via the  Sun Grid Engine on our Linux cluster 
in preparation for some bigger ones.

I checked R's capabilities on the cluster nodes (after failing to create a 
png file) and am getting the following warning message:
[Run on a cluster node using qrsh:]



> capabilities()

    jpeg      png    tcltk      X11 http/ftp  sockets   libxml     fifo

   FALSE    FALSE    FALSE    FALSE     TRUE     TRUE     TRUE     TRUE

  cledit    iconv      NLS  profmem

    TRUE     TRUE     TRUE    FALSE

Warning message:

unable to load shared library 
'/n/site/inst/Linux-i686/bioinfo/R/2.5.1/lib/R/modules//R_X11.so':

  libSM.so.6: cannot open shared object file: No such file or directory in: 
capabilities()





Is the double slash (//) in the path above a bug in how we've configured R 
here (the /n/site/inst/ directory is shared but is platform specific), or a 
bug in how the capabilities command works?  The file does exist if the 
double slash in the path had not caused the warning above.






How can one programmatically get the info from ?Devices, which appears to be 
dynamic based on one's system?  Is it safe to assume that pdf's or 
postscript files are always available in R since they're not listed in 
capabilities and seem to be shown everywhere under ?Devices ?





Part of the ?Devices output on a cluster node says this:



   The following devices will be available if R was compiled to use

     them:



        *  'X11' The graphics driver for the X11 Window system



        *  'png' PNG bitmap device



        *  'jpeg' JPEG bitmap device



We can just recompile to get png or jpeg support?  Are X11 libraries used on 
cluster nodes while running "headless"?  Can I create pngs or jpegs without 
X11?



Thanks for any advice about this.



efg



Earl F. Glynn

Scientific Programmer
Stowers Institute for Medical Research


From savicky at cs.cas.cz  Thu Sep 27 22:38:00 2007
From: savicky at cs.cas.cz (Petr Savicky)
Date: Thu, 27 Sep 2007 22:38:00 +0200
Subject: [Rd] modifying large R objects in place
In-Reply-To: <Pine.LNX.4.64.0709271502300.6922@gannet.stats.ox.ac.uk>
References: <20070926092924.GA9879@cs.cas.cz>
	<7098abec0709261052q3a6b01e2v562f9a88ed81c513@mail.gmail.com>
	<20070927131317.GB7605@cs.cas.cz>
	<Pine.LNX.4.64.0709271502300.6922@gannet.stats.ox.ac.uk>
Message-ID: <20070927203800.GA27247@cs.cas.cz>

Thank you very much for all the explanations. In particular for pointing
out that nrow is not a .Primitive unlike dim, which is the
reason for the difference in their behavior. (I rised the question
of possible bug due to this difference, not just being unsatisfied
with nrow). Also, thanks for:

On Thu, Sep 27, 2007 at 05:59:05PM +0100, Prof Brian Ripley wrote:
[...]
> 2) I expected NAMED on 'a' to be incremented by nrow(a): here is my 
> understanding.
> 
> When you called nrow(a) you created another reference to 'a' in the 
> evaluation frame of nrow.  (At a finer level you first created a promise 
> to 'a' and then dim(x) evaluated that promise, which did SET_NAMED(<SEXP>) 
> = 2.)  So NAMED(a) was correctly bumped to 2, and it is never reduced.
> 
> More generally, any argument to a closure that actually gets used will 
> get NAMED set to 2.
[...]

This explains a lot.

I appreciate also the patch to matrix by Henrik Bengtsson, which saved
me time formulating a further question just about this.

I do not know, whether there is a reason to keep nrow, ncol not .Primitive,
but if there is such, the problem may be solved by rewriting
them as follows:

nrow <- function(...) dim(...)[1]
ncol <- function(...) dim(...)[2]

At least in my environment, the new versions preserved NAMED == 1.

It has a side effect that this unifies the error messages generated
by too many arguments to nrow(x) and dim(x). Currently
  a <- matrix(1:6,nrow=2)
  nrow(a,a) # Error in nrow(a, a) : unused argument(s) (1:6)
  dim(a,a) # Error: 2 arguments passed to 'dim' which requires 1

May be, also other solutions exist.

Petr Savicky.


From p.dalgaard at biostat.ku.dk  Fri Sep 28 00:39:30 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Fri, 28 Sep 2007 00:39:30 +0200
Subject: [Rd] modifying large R objects in place
In-Reply-To: <20070927203800.GA27247@cs.cas.cz>
References: <20070926092924.GA9879@cs.cas.cz>	<7098abec0709261052q3a6b01e2v562f9a88ed81c513@mail.gmail.com>	<20070927131317.GB7605@cs.cas.cz>	<Pine.LNX.4.64.0709271502300.6922@gannet.stats.ox.ac.uk>
	<20070927203800.GA27247@cs.cas.cz>
Message-ID: <46FC3122.2010803@biostat.ku.dk>

Petr Savicky wrote:
> Thank you very much for all the explanations. In particular for pointing
> out that nrow is not a .Primitive unlike dim, which is the
> reason for the difference in their behavior. (I rised the question
> of possible bug due to this difference, not just being unsatisfied
> with nrow). Also, thanks for:
>
> On Thu, Sep 27, 2007 at 05:59:05PM +0100, Prof Brian Ripley wrote:
> [...]
>   
>> 2) I expected NAMED on 'a' to be incremented by nrow(a): here is my 
>> understanding.
>>
>> When you called nrow(a) you created another reference to 'a' in the 
>> evaluation frame of nrow.  (At a finer level you first created a promise 
>> to 'a' and then dim(x) evaluated that promise, which did SET_NAMED(<SEXP>) 
>> = 2.)  So NAMED(a) was correctly bumped to 2, and it is never reduced.
>>
>> More generally, any argument to a closure that actually gets used will 
>> get NAMED set to 2.
>>     
> [...]
>
> This explains a lot.
>
> I appreciate also the patch to matrix by Henrik Bengtsson, which saved
> me time formulating a further question just about this.
>
> I do not know, whether there is a reason to keep nrow, ncol not .Primitive,
> but if there is such, the problem may be solved by rewriting
> them as follows:
>
> nrow <- function(...) dim(...)[1]
> ncol <- function(...) dim(...)[2]
>
> At least in my environment, the new versions preserved NAMED == 1.
>   
Yes, but changing the formal arguments is a bit messy, is it not?

Presumably, nrow <- function(x) eval.parent(substitute(dim(x)[1])) works 
too, but if the gain is important enough to warrant that sort of 
programming, you might as well make nrow a .Primitive.

Longer-term, I still have some hope for better reference counting, but 
the semantics of environments make it really ugly -- an environment can 
contain an object that contains the environment, a simple example being 

f <- function()
    g <- function() 0
f()

At the end of f(), we should decide whether to destroy f's evaluation 
environment. In the present example, what we need to be able to see is 
that this would remove all refences to g and that the reference from g 
to f can therefore be ignored.  Complete logic for sorting this out is 
basically equivalent to a new garbage collector, and one can suspect 
that applying the logic upon every function return is going to be 
terribly inefficient. However, partial heuristics might apply.

> It has a side effect that this unifies the error messages generated
> by too many arguments to nrow(x) and dim(x). Currently
>   a <- matrix(1:6,nrow=2)
>   nrow(a,a) # Error in nrow(a, a) : unused argument(s) (1:6)
>   dim(a,a) # Error: 2 arguments passed to 'dim' which requires 1
>
> May be, also other solutions exist.
>
> Petr Savicky.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From maustin at amgen.com  Fri Sep 28 01:46:00 2007
From: maustin at amgen.com (Austin, Matt)
Date: Thu, 27 Sep 2007 16:46:00 -0700
Subject: [Rd] windows device transparency issue
Message-ID: <E7D5AB4811D20B489622AABA9C53859116AEC385@teal-exch.amgen.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070927/71f5d9b9/attachment.pl 

From anjalishitole at yahoo.co.in  Thu Sep 27 13:22:41 2007
From: anjalishitole at yahoo.co.in (anjalishitole at yahoo.co.in)
Date: Thu, 27 Sep 2007 13:22:41 +0200 (CEST)
Subject: [Rd] to overcome error while computing sd for each subset of data
	(PR#9931)
Message-ID: <20070927112241.7F054667F6@slim.kubism.ku.dk>

Full_Name: Anjali Shitole
Version: R 2.5.1
OS: 
Submission from: (NULL) (202.141.157.91)


I want to compute coefficient of variation for each subset of data.
Each subset is heterogeneous means number of rows in each subset are
different.These all subsets are in one dataset situated one by one.
i have used aggregate command to calculate mean for each subset.
But same command for calculating sd gives error 
see the following program,
> a<-read.table("c:/mri/data/ratioinput.txt",header=T, na.strings =
"NA",fill=TRUE)
> dim(a)
[1] 32515    27
> BusinessRisk<-a[,16]/(a[,26]/a[,27]) 
> a1<-a[,1:3]
> a2<-cbind(a1,BusinessRisk)
> c1<-aggregate(BusinessRisk,list(a2[,1]),mean)
> names(a)
 [1] "Co_Code"        "Co_Name"        "Year"           "TotSholderFund"
 [5] "TotLiab"        "NetBlock"       "Investments"    "Inventories"   
 [9] "SundryDebts"    "CashandBank"    "TotCurrAssets"  "CurrLiab"      
[13] "TotCurrLiab"    "TotAssets"      "NetSales"       "OpPft"         
[17] "Interest"       "GrossPft"       "AdjNetPft"      "Dividend"      
[21] "PrefDivi"       "EquityPaidUp"   "CurrentAssets"  "PBIT"          
[25] "TotExpen"       "Equity"         "FaceValue"     
> c2<-aggregate(BusinessRisk,list(a2[,1]),sd(BusinessRisk,na.rm=TRUE))
Error in FUN(X[[1L]], ...) : argument "INDEX" is missing, with no default
> 
Please help me to overcome this error.


From ripley at stats.ox.ac.uk  Fri Sep 28 08:56:20 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 28 Sep 2007 07:56:20 +0100 (BST)
Subject: [Rd] windows device transparency issue
In-Reply-To: <E7D5AB4811D20B489622AABA9C53859116AEC385@teal-exch.amgen.com>
References: <E7D5AB4811D20B489622AABA9C53859116AEC385@teal-exch.amgen.com>
Message-ID: <Pine.LNX.4.64.0709280741180.31817@gannet.stats.ox.ac.uk>

Thank you for trying 2.6.0 RC.

The example is far from minimal: most semi-transparent polygon fills were 
failing due to a typo prior to r43003.  Your example now works (several 
times faster than under Cairo).

As you will see from the below, sending HTML makes your postings 
unnecessarily hard to read for users of text email clients: please do 
follow the posting guide.


On Thu, 27 Sep 2007, Austin, Matt wrote:

>
>
> I read in a thread in r-help today that the windows device in 2.6 supports
> transparency, so I tried an example and had some issues.  The density plots
> should be filled with transparent color in the following example (similar to
> the points), however the color is "fully" transparent.  This works in the
> Cairo device, but not in the windows device.
>
>
>
> Thanks,
>
>
>
> --Matt
>
>
>
> Matt Austin
>
> Statistician, Amgen Inc.
>
>
>
>
>
> Example of problem derived from example(layout) code.
>
>
>
> ##Start
>
> windows()
>
>
>
> x <- pmin(3, pmax(-3, rbeta(5000,1,5)))
>
> y <- pmin(3, pmax(-3, c(rnorm(2500, .25, 1), rnorm(2500))) )
>
> trtp.f <-  factor(rep(c("Placebo", "Not Placebo"), each=2500),
> levels=c("Placebo", "Not Placebo"))
>
>
>
> xdens <-  tapply(x, trtp.f,  density, na.rm=TRUE)
>
> ydens <-  tapply(y, trtp.f,  density, na.rm=TRUE)
>
>
>
> topx <- max(unlist(lapply(xdens, function(x) max(x$y))))
>
> topy <- max(unlist(lapply(ydens, function(x) max(x$y))))
>
>
>
> xrange <- range(x, na.rm=TRUE)
>
> yrange <- range(y, na.rm=TRUE)
>
>
>
> nf <- layout(matrix(c(2,0,1,3),2,2,byrow=TRUE), c(3,1), c(1,3), TRUE)
>
>
>
> par(mar=c(4,4,0,0), oma=c(0,0,0,0))
>
>
>
> getcolors <- rainbow(length(levels(trtp.f)), alpha=.5)
>
> plot(x, y, xlim=xrange, ylim=yrange,xlab="X value", ylab="Y value", pch=21,
> bg=getcolors[as.numeric(trtp.f)])
>
>
>
> par(mar=c(0,4,1,1))
>
> plot(x=xrange, axes=FALSE, xlim=xrange, ylim=c(0, topx), xlab="", ylab="")
>
> #lapply(xdens, lines)
>
>
>
> for(i in 1:length(xdens)){
>
>  dat <- xdens[[i]]
>
>  polygon(x=c(min(dat$x), dat$x, max(dat$x)) , y=c(0, dat$y, 0),   col=
> rainbow(length(xdens), alpha=.5)[i])
>
> }
>
>
>
> par(mar=c(4,0,1,1))
>
> plot(x=yrange, axes=FALSE, ylim=yrange, xlim=c(0, topy), xlab="", ylab="")
>
>
>
> for(i in 1:length(ydens)){
>
>  dat <- ydens[[i]]
>
>  polygon(y=c(min(dat$x), dat$x, max(dat$x)) , x=c(0, dat$y, 0),
> col=rainbow(length(ydens), alpha=.5)[i])
>
>
>
> }
>
> ##End
>
>
>
> Other Info:
>
>
>
> platform       i386-pc-mingw32
>
> arch           i386
>
> os             mingw32
>
> system         i386, mingw32
>
> status         RC
>
> major          2
>
> minor          6.0
>
> year           2007
>
> month          09
>
> day            26
>
> svn rev        42991
>
> language       R
>
> version.string R version 2.6.0 RC (2007-09-26 r42991)
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From savicky at cs.cas.cz  Fri Sep 28 13:45:16 2007
From: savicky at cs.cas.cz (Petr Savicky)
Date: Fri, 28 Sep 2007 13:45:16 +0200
Subject: [Rd] modifying large R objects in place
In-Reply-To: <46FC3122.2010803@biostat.ku.dk>
References: <20070926092924.GA9879@cs.cas.cz>
	<7098abec0709261052q3a6b01e2v562f9a88ed81c513@mail.gmail.com>
	<20070927131317.GB7605@cs.cas.cz>
	<Pine.LNX.4.64.0709271502300.6922@gannet.stats.ox.ac.uk>
	<20070927203800.GA27247@cs.cas.cz> <46FC3122.2010803@biostat.ku.dk>
Message-ID: <20070928114516.GA22736@cs.cas.cz>

On Fri, Sep 28, 2007 at 12:39:30AM +0200, Peter Dalgaard wrote:
[...]
> >nrow <- function(...) dim(...)[1]
> >ncol <- function(...) dim(...)[2]
> >
> >At least in my environment, the new versions preserved NAMED == 1.
> >  
> Yes, but changing the formal arguments is a bit messy, is it not?

Specifically for nrow, ncol, I think not much, since almost nobody needs
to know (or even knows) that the name of the formal argument is "x".

However, there is another argument against the ... solution: it solves
the problem only in the simplest cases like nrow, ncol, but is not
usable in other, like colSums, rowSums. These functions also increase
NAMED of its argument, although their output does not contain any
reference to the original content of their arguments.

I think that a systematic solution of this problem may be helpful.
However, making these functions Internal or Primitive would
not be good in my opinion. It is advantageous that these functions
contain an R level part, which
makes the basic decisions before a call to .Internal.
If nothing else, this serves as a sort of documentation.

For my purposes, I replaced calls to "colSums" and "matrix" by the
corresponding calls to .Internal in my script. The result is that
now I can complete several runs of my calculation in a cycle instead
of restarting R after each of the runs.

This leads me to a question. Some of the tests, which I did, suggest
that gc() may not free all the memory, even if I remove all data
objects by rm() before calling gc(). Is this possible or I must have
missed something?

A possible solution to the unwanted increase of NAMED due to temporary
calculations could be to give the user the possibility
to store NAMED attribute of an object before a call to a function
and restore it after the call. To use this, the user should be
confident that no new reference to the object persists after the
function is completed.

> Presumably, nrow <- function(x) eval.parent(substitute(dim(x)[1])) works 
> too, but if the gain is important enough to warrant that sort of 
> programming, you might as well make nrow a .Primitive.

You are right. This indeed works.

> Longer-term, I still have some hope for better reference counting, but 
> the semantics of environments make it really ugly -- an environment can 
> contain an object that contains the environment, a simple example being 
> 
> f <- function()
>    g <- function() 0
> f()
> 
> At the end of f(), we should decide whether to destroy f's evaluation 
> environment. In the present example, what we need to be able to see is 
> that this would remove all refences to g and that the reference from g 
> to f can therefore be ignored.  Complete logic for sorting this out is 
> basically equivalent to a new garbage collector, and one can suspect 
> that applying the logic upon every function return is going to be 
> terribly inefficient. However, partial heuristics might apply.

I have to say that I do not understand the example very much.
What is the input and output of f? Is g inside only defined or
also used?

Let me ask the following question. I assume that gc() scans the whole
memory and determines for each part of data, whether a reference
to it still exists or not. In my understanding, this is equivalent to
determine, whether NAMED of it may be dropped to zero or not.
Structures, for which this succeeds are then removed. Am I right?
If yes, is it possible during gc() to determine also cases,
when NAMED may be dropped from 2 to 1? How much would this increase
the complexity of gc()?

Thank you in advance for your kind reply.

Petr Savicky.


From luke at stat.uiowa.edu  Fri Sep 28 15:14:45 2007
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Fri, 28 Sep 2007 08:14:45 -0500 (CDT)
Subject: [Rd] modifying large R objects in place
In-Reply-To: <20070928114516.GA22736@cs.cas.cz>
References: <20070926092924.GA9879@cs.cas.cz>
	<7098abec0709261052q3a6b01e2v562f9a88ed81c513@mail.gmail.com>
	<20070927131317.GB7605@cs.cas.cz>
	<Pine.LNX.4.64.0709271502300.6922@gannet.stats.ox.ac.uk>
	<20070927203800.GA27247@cs.cas.cz> <46FC3122.2010803@biostat.ku.dk>
	<20070928114516.GA22736@cs.cas.cz>
Message-ID: <Pine.LNX.4.64.0709280753500.10257@nokomis.stat.uiowa.edu>

On Fri, 28 Sep 2007, Petr Savicky wrote:

> On Fri, Sep 28, 2007 at 12:39:30AM +0200, Peter Dalgaard wrote:
> [...]
>>> nrow <- function(...) dim(...)[1]
>>> ncol <- function(...) dim(...)[2]
>>>
>>> At least in my environment, the new versions preserved NAMED == 1.

I believe this is a bug in the evaluation of ... arguments.  THe
intent in the code is I believe that all promise evaluations result in
NAMED==2 for safety.  That may be overly conservative but I would not
want to change it without some very careful thought -- I prefer to
wait a little longer for the right answer than to get a wrong one
quickly.

>>>
>> Yes, but changing the formal arguments is a bit messy, is it not?
>
> Specifically for nrow, ncol, I think not much, since almost nobody needs
> to know (or even knows) that the name of the formal argument is "x".
>
> However, there is another argument against the ... solution: it solves
> the problem only in the simplest cases like nrow, ncol, but is not
> usable in other, like colSums, rowSums. These functions also increase
> NAMED of its argument, although their output does not contain any
> reference to the original content of their arguments.
>
> I think that a systematic solution of this problem may be helpful.
> However, making these functions Internal or Primitive would
> not be good in my opinion. It is advantageous that these functions
> contain an R level part, which
> makes the basic decisions before a call to .Internal.
> If nothing else, this serves as a sort of documentation.
>
> For my purposes, I replaced calls to "colSums" and "matrix" by the
> corresponding calls to .Internal in my script. The result is that
> now I can complete several runs of my calculation in a cycle instead
> of restarting R after each of the runs.
>
> This leads me to a question. Some of the tests, which I did, suggest
> that gc() may not free all the memory, even if I remove all data
> objects by rm() before calling gc(). Is this possible or I must have
> missed something?

Not impossible but very unlikely givent he use gc gets. There are a
few internal tables that are grown but not shrunk at the moment but
that should not usually cause much total growth.  If you are ooking at
system memopry use then that is a malloc issue -- there was a thread
about this a month or so ago.

> A possible solution to the unwanted increase of NAMED due to temporary
> calculations could be to give the user the possibility
> to store NAMED attribute of an object before a call to a function
> and restore it after the call. To use this, the user should be
> confident that no new reference to the object persists after the
> function is completed.

This would be too dangerous for general use. Some more structured
approach may be possible. A related issue is that user-defined
assignment functions always see a NAMED of 2 and hence cannot modify
in place. We've been trying to come up with a reasonable solution to
this, so far without success but I'm moderately hopeful.

>> Presumably, nrow <- function(x) eval.parent(substitute(dim(x)[1])) works
>> too, but if the gain is important enough to warrant that sort of
>> programming, you might as well make nrow a .Primitive.
>
> You are right. This indeed works.
>
>> Longer-term, I still have some hope for better reference counting, but
>> the semantics of environments make it really ugly -- an environment can
>> contain an object that contains the environment, a simple example being
>>
>> f <- function()
>>    g <- function() 0
>> f()
>>
>> At the end of f(), we should decide whether to destroy f's evaluation
>> environment. In the present example, what we need to be able to see is
>> that this would remove all refences to g and that the reference from g
>> to f can therefore be ignored.  Complete logic for sorting this out is
>> basically equivalent to a new garbage collector, and one can suspect
>> that applying the logic upon every function return is going to be
>> terribly inefficient. However, partial heuristics might apply.
>
> I have to say that I do not understand the example very much.
> What is the input and output of f? Is g inside only defined or
> also used?
>
> Let me ask the following question. I assume that gc() scans the whole
> memory and determines for each part of data, whether a reference
> to it still exists or not. In my understanding, this is equivalent to
> determine, whether NAMED of it may be dropped to zero or not.
> Structures, for which this succeeds are then removed. Am I right?
> If yes, is it possible during gc() to determine also cases,
> when NAMED may be dropped from 2 to 1? How much would this increase
> the complexity of gc()?

Probably not impossible but would be a fair bit of work with probably
not much gain as the NAMED values would still be high until the next
gc of the appropriate level, which will probably be a fair time as an
object being modified is likely to be older, but the interval in which
there would be a benefit is short.

The basic functional model that underlies having the illuison of
non-modifyable vector data does not fit all that well with an
imperative style of modifying things in loops. It might be useful to
bring in some constructs from functional programming that are designed
to allow in-place modification to coexist with functional semantics.
Probably a longer term issue.

For now there are limits to what we can reasonable, and maintainably,
do in an interpreted R.  Having full reference counts might help but
might not because of other costs involved (significant increases in
cache misses in particular) but in any case it would probably be
easier to rewrite R from scratch than to retro-fit full reference
cunting to what we have so I an't see it happening real soon. Also it
doesn't help with many things, like user-level assignment: there
really are two references at the key point in that case.  With
compilation it may be possible to do some memory use analysis and work
out when it is safe to do destructive modification, but that is a fair
way off as well.

Best,

luke


>
> Thank you in advance for your kind reply.
>
> Petr Savicky.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From murdoch at stats.uwo.ca  Fri Sep 28 15:46:39 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 28 Sep 2007 09:46:39 -0400
Subject: [Rd] modifying large R objects in place
In-Reply-To: <20070928114516.GA22736@cs.cas.cz>
References: <20070926092924.GA9879@cs.cas.cz>	<7098abec0709261052q3a6b01e2v562f9a88ed81c513@mail.gmail.com>	<20070927131317.GB7605@cs.cas.cz>	<Pine.LNX.4.64.0709271502300.6922@gannet.stats.ox.ac.uk>	<20070927203800.GA27247@cs.cas.cz>
	<46FC3122.2010803@biostat.ku.dk> <20070928114516.GA22736@cs.cas.cz>
Message-ID: <46FD05BF.6060005@stats.uwo.ca>

On 9/28/2007 7:45 AM, Petr Savicky wrote:
> On Fri, Sep 28, 2007 at 12:39:30AM +0200, Peter Dalgaard wrote:
  ...
>> Longer-term, I still have some hope for better reference counting, but 
>> the semantics of environments make it really ugly -- an environment can 
>> contain an object that contains the environment, a simple example being 
>> 
>> f <- function()
>>    g <- function() 0
>> f()
>> 
>> At the end of f(), we should decide whether to destroy f's evaluation 
>> environment. In the present example, what we need to be able to see is 
>> that this would remove all refences to g and that the reference from g 
>> to f can therefore be ignored.  Complete logic for sorting this out is 
>> basically equivalent to a new garbage collector, and one can suspect 
>> that applying the logic upon every function return is going to be 
>> terribly inefficient. However, partial heuristics might apply.
> 
> I have to say that I do not understand the example very much.
> What is the input and output of f? Is g inside only defined or
> also used?

f has no input; it's output is the function g, whose environment is the 
evaluation environment of f.  g is never used, but it is returned as the 
value of f.  Thus we have the loop:

g refers to the environment.
the environment contains g.

Even though the result of f() was never saved, two things (the 
environment and g) got created and each would have non-zero reference 
count.

In a more complicated situation you might want to save the result of the 
function and then modify it.  But because of the loop above, you would 
always think there's another reference to the object, so every in-place 
modification would require a copy first.

Duncan Murdoch


From googel.vs.privacy at googlemail.com  Fri Sep 28 16:24:18 2007
From: googel.vs.privacy at googlemail.com (idontwant googeltospyafterme)
Date: Fri, 28 Sep 2007 16:24:18 +0200
Subject: [Rd] this is just a test...
Message-ID: <e0a4be450709280724o2e1c6f3di7eea134cb9f92bb9@mail.gmail.com>

...because my messages get rejected due to filter rule match everytime...
sorry for any unconviniece.
josuah r.


From googel.vs.privacy at googlemail.com  Fri Sep 28 16:33:21 2007
From: googel.vs.privacy at googlemail.com (idontwant googeltospyafterme)
Date: Fri, 28 Sep 2007 16:33:21 +0200
Subject: [Rd] R-Server remotecontrolled via browser-GUI
Message-ID: <e0a4be450709280733j740c230naf7519ce47c19e9e@mail.gmail.com>

dear r-community,

currently i have a workflow as following:
data in online-MYSQL-database via .csv into R for analysis, results
back to mysql.
generating graphics for reports also.

that's ok, but i need some process-optimization.

i'd like to run r directly on the webserver. analysis should work
automatically, after the appropriate r-script was selected in a
browser-gui for R.

until know after collecting some information, i think the best
approach to reach that goal is:
* using mod_R / RApache to run multiple instances of r on the server,
* build a website that will serve as frontend/gui for r either with
html/php or some ajax-framework,
* connect R to the database with one of the available db-packages to
fetch the survey-data
* put the r-scripts for analysis somewhere on the server
* use cairo for generation of the images
* and see what happens...

i would like to know, if my construction seems good to you, if you
have other recommendations or constructive critics and what you think
about the effort for configuring mod_R/RAPACHE, cairo and the
db-package for r.

thanks a lot in advance for your help!

cheers,

josuah r.


From Greg.Snow at intermountainmail.org  Fri Sep 28 17:24:59 2007
From: Greg.Snow at intermountainmail.org (Greg Snow)
Date: Fri, 28 Sep 2007 09:24:59 -0600
Subject: [Rd] R-Server remotecontrolled via browser-GUI
In-Reply-To: <e0a4be450709280733j740c230naf7519ce47c19e9e@mail.gmail.com>
References: <e0a4be450709280733j740c230naf7519ce47c19e9e@mail.gmail.com>
Message-ID: <07E228A5BE53C24CAD490193A7381BBBC38EB1@LP-EXCHVS07.CO.IHC.COM>

Have you read section 4 of the FAQ?  If not, that would be a good place
to start.

-- 
Gregory (Greg) L. Snow Ph.D.
Statistical Data Center
Intermountain Healthcare
greg.snow at intermountainmail.org
(801) 408-8111
 
 

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of idontwant 
> googeltospyafterme
> Sent: Friday, September 28, 2007 8:33 AM
> To: r-devel at r-project.org
> Subject: [Rd] R-Server remotecontrolled via browser-GUI
> 
> dear r-community,
> 
> currently i have a workflow as following:
> data in online-MYSQL-database via .csv into R for analysis, 
> results back to mysql.
> generating graphics for reports also.
> 
> that's ok, but i need some process-optimization.
> 
> i'd like to run r directly on the webserver. analysis should 
> work automatically, after the appropriate r-script was 
> selected in a browser-gui for R.
> 
> until know after collecting some information, i think the 
> best approach to reach that goal is:
> * using mod_R / RApache to run multiple instances of r on the server,
> * build a website that will serve as frontend/gui for r 
> either with html/php or some ajax-framework,
> * connect R to the database with one of the available 
> db-packages to fetch the survey-data
> * put the r-scripts for analysis somewhere on the server
> * use cairo for generation of the images
> * and see what happens...
> 
> i would like to know, if my construction seems good to you, 
> if you have other recommendations or constructive critics and 
> what you think about the effort for configuring 
> mod_R/RAPACHE, cairo and the db-package for r.
> 
> thanks a lot in advance for your help!
> 
> cheers,
> 
> josuah r.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From mtmorgan at fhcrc.org  Fri Sep 28 17:27:40 2007
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Fri, 28 Sep 2007 08:27:40 -0700
Subject: [Rd] R-Server remotecontrolled via browser-GUI
In-Reply-To: <e0a4be450709280733j740c230naf7519ce47c19e9e@mail.gmail.com>
	(idontwant
	googeltospyafterme's message of "Fri, 28 Sep 2007 16:33:21 +0200")
References: <e0a4be450709280733j740c230naf7519ce47c19e9e@mail.gmail.com>
Message-ID: <6phbqbmvmhf.fsf@gopher4.fhcrc.org>

Hi Josuah

RWebServices might be a different approach. It allows R functions and
methods to be deployed as SOAP-based web services, and relies on an
underlying Java architecture that uses JMS to separate the web services
front end from a collection of R workers (on different machines). This
seems more scalable than putting the R workers on the same machine as
the Apache server.

Entry point here:

http://bioconductor.org/packages/2.0/bioc/html/RWebServices.html

There is quite a learning curve and technology commitment associated
with this, so not the best solution for providing light-weight
web access to R.

Martin

"idontwant googeltospyafterme" <googel.vs.privacy at googlemail.com> writes:

> dear r-community,
>
> currently i have a workflow as following:
> data in online-MYSQL-database via .csv into R for analysis, results
> back to mysql.
> generating graphics for reports also.
>
> that's ok, but i need some process-optimization.
>
> i'd like to run r directly on the webserver. analysis should work
> automatically, after the appropriate r-script was selected in a
> browser-gui for R.
>
> until know after collecting some information, i think the best
> approach to reach that goal is:
> * using mod_R / RApache to run multiple instances of r on the server,
> * build a website that will serve as frontend/gui for r either with
> html/php or some ajax-framework,
> * connect R to the database with one of the available db-packages to
> fetch the survey-data
> * put the r-scripts for analysis somewhere on the server
> * use cairo for generation of the images
> * and see what happens...
>
> i would like to know, if my construction seems good to you, if you
> have other recommendations or constructive critics and what you think
> about the effort for configuring mod_R/RAPACHE, cairo and the
> db-package for r.
>
> thanks a lot in advance for your help!
>
> cheers,
>
> josuah r.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin Morgan
Bioconductor / Computational Biology
http://bioconductor.org


From ripley at stats.ox.ac.uk  Fri Sep 28 17:36:40 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 28 Sep 2007 16:36:40 +0100 (BST)
Subject: [Rd] modifying large R objects in place
In-Reply-To: <Pine.LNX.4.64.0709280753500.10257@nokomis.stat.uiowa.edu>
References: <20070926092924.GA9879@cs.cas.cz>
	<7098abec0709261052q3a6b01e2v562f9a88ed81c513@mail.gmail.com>
	<20070927131317.GB7605@cs.cas.cz>
	<Pine.LNX.4.64.0709271502300.6922@gannet.stats.ox.ac.uk>
	<20070927203800.GA27247@cs.cas.cz> <46FC3122.2010803@biostat.ku.dk>
	<20070928114516.GA22736@cs.cas.cz>
	<Pine.LNX.4.64.0709280753500.10257@nokomis.stat.uiowa.edu>
Message-ID: <Pine.LNX.4.64.0709281504190.20261@gannet.stats.ox.ac.uk>

On Fri, 28 Sep 2007, Luke Tierney wrote:

> On Fri, 28 Sep 2007, Petr Savicky wrote:

[...]

>> This leads me to a question. Some of the tests, which I did, suggest
>> that gc() may not free all the memory, even if I remove all data
>> objects by rm() before calling gc(). Is this possible or I must have
>> missed something?

> Not impossible but very unlikely givent he use gc gets. There are a
> few internal tables that are grown but not shrunk at the moment but
> that should not usually cause much total growth.  If you are ooking at
> system memopry use then that is a malloc issue -- there was a thread
> about this a month or so ago.

A likely explanation is lazy-loading.  Almost all the package code is 
stored externally until used: 2.6.0 is better at not bringing in unused 
code.  E.g. (2.6.0, 64-bit system)

> gc()
          used (Mb) gc trigger (Mb) max used (Mb)
Ncells 141320  7.6     350000 18.7   350000 18.7
Vcells 130043  1.0     786432  6.0   561893  4.3
> for(s in search()) lsf.str(s)
> gc()
          used (Mb) gc trigger (Mb) max used (Mb)
Ncells 424383 22.7     531268 28.4   437511 23.4
Vcells 228005  1.8     786432  6.0   700955  5.4

'if I remove all data objects by rm()' presumably means clearing the 
user workspace: there are lots of other environments containing objects 
('data' or otherwise), many of which are needed to run R.

Otherwise the footer to every R-help message applies ....

>> A possible solution to the unwanted increase of NAMED due to temporary
>> calculations could be to give the user the possibility
>> to store NAMED attribute of an object before a call to a function
>> and restore it after the call. To use this, the user should be
>> confident that no new reference to the object persists after the
>> function is completed.
>
> This would be too dangerous for general use. Some more structured
> approach may be possible. A related issue is that user-defined
> assignment functions always see a NAMED of 2 and hence cannot modify
> in place. We've been trying to come up with a reasonable solution to
> this, so far without success but I'm moderately hopeful.

I am not persuaded that the difference between NAMED=1/2 makes much 
difference in general use of R, and I recall Ross saying that he no longer 
believed that this was a worthwhile optimization.  It's not just 
'user-defined' replacement functions, but also all the system-defined 
closures (including all methods for the generic replacement functions 
which are primitive) that are unable to benefit from it.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From p.dalgaard at biostat.ku.dk  Fri Sep 28 17:46:25 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Fri, 28 Sep 2007 17:46:25 +0200
Subject: [Rd] modifying large R objects in place
In-Reply-To: <46FD05BF.6060005@stats.uwo.ca>
References: <20070926092924.GA9879@cs.cas.cz>	<7098abec0709261052q3a6b01e2v562f9a88ed81c513@mail.gmail.com>	<20070927131317.GB7605@cs.cas.cz>	<Pine.LNX.4.64.0709271502300.6922@gannet.stats.ox.ac.uk>	<20070927203800.GA27247@cs.cas.cz>	<46FC3122.2010803@biostat.ku.dk>
	<20070928114516.GA22736@cs.cas.cz> <46FD05BF.6060005@stats.uwo.ca>
Message-ID: <46FD21D1.50801@biostat.ku.dk>

Duncan Murdoch wrote:
> On 9/28/2007 7:45 AM, Petr Savicky wrote:
>   
>> On Fri, Sep 28, 2007 at 12:39:30AM +0200, Peter Dalgaard wrote:
>>     
>   ...
>   
>>> Longer-term, I still have some hope for better reference counting, but 
>>> the semantics of environments make it really ugly -- an environment can 
>>> contain an object that contains the environment, a simple example being 
>>>
>>> f <- function()
>>>    g <- function() 0
>>> f()
>>>
>>> At the end of f(), we should decide whether to destroy f's evaluation 
>>> environment. In the present example, what we need to be able to see is 
>>> that this would remove all refences to g and that the reference from g 
>>> to f can therefore be ignored.  Complete logic for sorting this out is 
>>> basically equivalent to a new garbage collector, and one can suspect 
>>> that applying the logic upon every function return is going to be 
>>> terribly inefficient. However, partial heuristics might apply.
>>>       
>> I have to say that I do not understand the example very much.
>> What is the input and output of f? Is g inside only defined or
>> also used?
>>     
>
> f has no input; it's output is the function g, whose environment is the 
> evaluation environment of f.  g is never used, but it is returned as the 
> value of f.  Thus we have the loop:
>
> g refers to the environment.
> the environment contains g.
>
> Even though the result of f() was never saved, two things (the 
> environment and g) got created and each would have non-zero reference 
> count.
>
> In a more complicated situation you might want to save the result of the 
> function and then modify it.  But because of the loop above, you would 
> always think there's another reference to the object, so every in-place 
> modification would require a copy first.
>
>   
Thanks Duncan. It was way past my bedtime when I wrote that...

I had actually missed the point about the return value,  but the point 
remains even if you let f return something other than g: You get a 
situation where the two objects both have a refcount of 1, so by 
standard refcounting semantics neither can be removed even though 
neither object is reachable.

Put differently, standard refcounting assumes that references between 
objects of the language form a directed acyclic graph, but when 
environments are involved, there can be cycles in R-like languages.

    -p

> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From roger.bos at us.rothschild.com  Fri Sep 28 18:42:31 2007
From: roger.bos at us.rothschild.com (Bos, Roger)
Date: Fri, 28 Sep 2007 12:42:31 -0400
Subject: [Rd] R-Server remotecontrolled via browser-GUI
In-Reply-To: <6phbqbmvmhf.fsf@gopher4.fhcrc.org>
References: <e0a4be450709280733j740c230naf7519ce47c19e9e@mail.gmail.com>
	<6phbqbmvmhf.fsf@gopher4.fhcrc.org>
Message-ID: <D8C95B444AD6EE4AAD638D818A9CFD34BFFC63@RINNYCSE000.rth.ad.rothschild.com>

In response to Martin's suggestion, if you DID want a fairly simple way
to provide light-weight web access to R, Rpad would be a good choice.  I
actually run SQL Server 2005, Apache, and R/Rpad on the same server, but
the usage is very light in terms of number of users.  It was pretty
quick to set up and making a new Rpad page is really easy.

HTH,

Roger
 

-----Original Message-----
From: r-devel-bounces at r-project.org
[mailto:r-devel-bounces at r-project.org] On Behalf Of Martin Morgan
Sent: Friday, September 28, 2007 11:28 AM
To: idontwant googeltospyafterme
Cc: r-devel at r-project.org
Subject: Re: [Rd] R-Server remotecontrolled via browser-GUI

Hi Josuah

RWebServices might be a different approach. It allows R functions and
methods to be deployed as SOAP-based web services, and relies on an
underlying Java architecture that uses JMS to separate the web services
front end from a collection of R workers (on different machines). This
seems more scalable than putting the R workers on the same machine as
the Apache server.

Entry point here:

http://bioconductor.org/packages/2.0/bioc/html/RWebServices.html

There is quite a learning curve and technology commitment associated
with this, so not the best solution for providing light-weight web
access to R.

Martin

"idontwant googeltospyafterme" <googel.vs.privacy at googlemail.com>
writes:

> dear r-community,
>
> currently i have a workflow as following:
> data in online-MYSQL-database via .csv into R for analysis, results 
> back to mysql.
> generating graphics for reports also.
>
> that's ok, but i need some process-optimization.
>
> i'd like to run r directly on the webserver. analysis should work 
> automatically, after the appropriate r-script was selected in a 
> browser-gui for R.
>
> until know after collecting some information, i think the best 
> approach to reach that goal is:
> * using mod_R / RApache to run multiple instances of r on the server,
> * build a website that will serve as frontend/gui for r either with 
> html/php or some ajax-framework,
> * connect R to the database with one of the available db-packages to 
> fetch the survey-data
> * put the r-scripts for analysis somewhere on the server
> * use cairo for generation of the images
> * and see what happens...
>
> i would like to know, if my construction seems good to you, if you 
> have other recommendations or constructive critics and what you think 
> about the effort for configuring mod_R/RAPACHE, cairo and the 
> db-package for r.
>
> thanks a lot in advance for your help!
>
> cheers,
>
> josuah r.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

--
Martin Morgan
Bioconductor / Computational Biology
http://bioconductor.org

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

********************************************************************** *
This message is for the named person's use only. It may 
contain confidential, proprietary or legally privileged 
information. No right to confidential or privileged treatment 
of this message is waived or lost by any error in 
transmission. If you have received this message in error, 
please immediately notify the sender by e-mail, 
delete the message and all copies from your system and destroy 
any hard copies. You must not, directly or indirectly, use, 
disclose, distribute, print or copy any part of this message 
if you are not the intended recipient. 


From jeff.horner at vanderbilt.edu  Fri Sep 28 21:04:19 2007
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Fri, 28 Sep 2007 14:04:19 -0500
Subject: [Rd] R-Server remotecontrolled via browser-GUI
In-Reply-To: <e0a4be450709280733j740c230naf7519ce47c19e9e@mail.gmail.com>
References: <e0a4be450709280733j740c230naf7519ce47c19e9e@mail.gmail.com>
Message-ID: <46FD5033.2000904@vanderbilt.edu>

idontwant googeltospyafterme wrote on 09/28/2007 09:33 AM:
> dear r-community,
> 
> currently i have a workflow as following:
> data in online-MYSQL-database via .csv into R for analysis, results
> back to mysql.
> generating graphics for reports also.
> 
> that's ok, but i need some process-optimization.
> 
> i'd like to run r directly on the webserver. analysis should work
> automatically, after the appropriate r-script was selected in a
> browser-gui for R.
> 
> until know after collecting some information, i think the best
> approach to reach that goal is:
> * using mod_R / RApache to run multiple instances of r on the server,
> * build a website that will serve as frontend/gui for r either with
> html/php or some ajax-framework,
> * connect R to the database with one of the available db-packages to
> fetch the survey-data
> * put the r-scripts for analysis somewhere on the server
> * use cairo for generation of the images
> * and see what happens...
> 
> i would like to know, if my construction seems good to you, if you
> have other recommendations or constructive critics and what you think
> about the effort for configuring mod_R/RAPACHE, cairo and the
> db-package for r.

Hi Josuah,

I'm planning on releasing the 1.0 version of rapache sometime after the 
relase of R 2.6.0. Work's been really busy around here, so I haven't had 
time to finish up the last of the documentation and packaging.

After that, I hope to have time to provide recommendations on how to use 
rapache in various situations. Expect to see progress here:

http://biostat.mc.vanderbilt.edu/rapache

near the middle of October.

Jeff
-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner


From hyu at stats.uwo.ca  Fri Sep 28 20:54:28 2007
From: hyu at stats.uwo.ca (Hao Yu)
Date: Fri, 28 Sep 2007 14:54:28 -0400 (EDT)
Subject: [Rd] CHAR () and Rmpi
Message-ID: <65368.65.95.138.11.1191005668.squirrel@www.stats.uwo.ca>

Hi. I am the maintainer of Rmpi package. Now I have a problem regarding
the change of CHAR () in R 2.6.0. According to R 2.6.0 NEWS:
*******
CHAR() now returns (const char *) since CHARSXPs should no
        longer be modified in place.  This change allows compilers to
        warn or error about improper modification.  Thanks to Herve
        Pages for the suggestion.
*******
Unfortunately this causes Rmpi to fail since MPI requires char pointers
rather than const char pointers. Normally I use
    CHAR(STRING_ELT((sexp_rdata),0))
to get the pointer to MPI where a R character vector (C sense) is stored.
Because of the change, all character messengers fail. Is there an easy way
to get a char pointer to STRING_ELT((sexp_rdata),0) and is also backward
compatible to old R versions. BTW Rmpi does not do any modification of
characters at C level.

Thanks
Hao Yu

-- 
Department of Statistics & Actuarial Sciences
Fax Phone#:(519)-661-3813
The University of Western Ontario
Office Phone#:(519)-661-3622
London, Ontario N6A 5B7
http://www.stats.uwo.ca/faculty/yu


From ripley at stats.ox.ac.uk  Sat Sep 29 08:12:49 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 29 Sep 2007 07:12:49 +0100 (BST)
Subject: [Rd] CHAR () and Rmpi
In-Reply-To: <65368.65.95.138.11.1191005668.squirrel@www.stats.uwo.ca>
References: <65368.65.95.138.11.1191005668.squirrel@www.stats.uwo.ca>
Message-ID: <Pine.LNX.4.64.0709290655440.19554@gannet.stats.ox.ac.uk>

I'm not sure what your sticking point here is.  If mpi does not modify 
data in a (char *) pointer, then that really is a (const char *) pointer 
and the headers are being unhelpful in not telling the compiler that 
the data are constant.

If that is the case you need to use casts to (char *) and the following 
private define may be useful to you:

#define CHAR_RW(x) ((char *) CHAR(x))


However, you ask

> Is there an easy way to get a char pointer to STRING_ELT((sexp_rdata),0) 
> and is also backward compatible to old R versions.

and the answer is that there is no such way, since (const char *) and 
(char *) are not the same thing and any package that wants to alter the 
contents of a string element needs to create a new CHARSXP to be that 
element.


BTW, you still have not changed Rmpi to remove the configure problems on 
64-bit systems (including assuming libs are in /usr/lib not /usr/lib64) I 
pointed out a long time ago.


On Fri, 28 Sep 2007, Hao Yu wrote:

> Hi. I am the maintainer of Rmpi package. Now I have a problem regarding
> the change of CHAR () in R 2.6.0. According to R 2.6.0 NEWS:
> *******
> CHAR() now returns (const char *) since CHARSXPs should no
>        longer be modified in place.  This change allows compilers to
>        warn or error about improper modification.  Thanks to Herve
>        Pages for the suggestion.
> *******
> Unfortunately this causes Rmpi to fail since MPI requires char pointers
> rather than const char pointers. Normally I use
>    CHAR(STRING_ELT((sexp_rdata),0))
> to get the pointer to MPI where a R character vector (C sense) is stored.
> Because of the change, all character messengers fail. Is there an easy way
> to get a char pointer to STRING_ELT((sexp_rdata),0) and is also backward
> compatible to old R versions. BTW Rmpi does not do any modification of
> characters at C level.
>
> Thanks
> Hao Yu
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From savicky at cs.cas.cz  Sat Sep 29 10:28:34 2007
From: savicky at cs.cas.cz (Petr Savicky)
Date: Sat, 29 Sep 2007 10:28:34 +0200
Subject: [Rd] modifying large R objects in place
In-Reply-To: <Pine.LNX.4.64.0709281504190.20261@gannet.stats.ox.ac.uk>
References: <20070926092924.GA9879@cs.cas.cz>
	<7098abec0709261052q3a6b01e2v562f9a88ed81c513@mail.gmail.com>
	<20070927131317.GB7605@cs.cas.cz>
	<Pine.LNX.4.64.0709271502300.6922@gannet.stats.ox.ac.uk>
	<20070927203800.GA27247@cs.cas.cz> <46FC3122.2010803@biostat.ku.dk>
	<20070928114516.GA22736@cs.cas.cz>
	<Pine.LNX.4.64.0709280753500.10257@nokomis.stat.uiowa.edu>
	<Pine.LNX.4.64.0709281504190.20261@gannet.stats.ox.ac.uk>
Message-ID: <20070929082834.GA8658@cs.cas.cz>

On Fri, Sep 28, 2007 at 08:14:45AM -0500, Luke Tierney wrote:
[...]
> [...] A related issue is that user-defined
> assignment functions always see a NAMED of 2 and hence cannot modify
> in place. We've been trying to come up with a reasonable solution to
> this, so far without success but I'm moderately hopeful.

If a user-defined function evaluates its body in its parent environment
using the suggestion of Peter Dalgaard eval.parent(substitute( .... )),
then NAMED attribute is not increased and the function may do in place
modifications.

On Fri, Sep 28, 2007 at 12:39:30AM +0200, Peter Dalgaard wrote:
> Longer-term, I still have some hope for better reference counting, but 
> the semantics of environments make it really ugly -- an environment can 
> contain an object that contains the environment, a simple example being 
> 
> f <- function()
>    g <- function() 0
> f()
> 

On Fri, Sep 28, 2007 at 09:46:39AM -0400, Duncan Murdoch wrote:
> f has no input; it's output is the function g, whose environment is the 
> evaluation environment of f.  g is never used, but it is returned as the 
> value of f.  Thus we have the loop:
> 
> g refers to the environment.
> the environment contains g.
> 
> Even though the result of f() was never saved, two things (the 
> environment and g) got created and each would have non-zero reference 
> count.

Thank you very much for the example and explanation. I would
not guess, something like this is possible, but now I see that
it may, in fact, be quite common. For example
  something <- function()
  {
      a <- 1:5
      b <- 6:10
      c <- c("a","a","b","b","b")
      mf <- model.frame(c ~ a + b)
      mf
  }
  mf1 <- something()
  e1 <- attr(attr(mf1,"terms"),".Environment")
  mf2 <- eval(expression(mf),envir=e1)
  e2 <- attr(attr(mf2,"terms"),".Environment")
  print(identical(e1,e2)) # TRUE
seems to be a similar situation. Here, the references go in the
sequence mf1 -> e1 -> mf2 -> e1. I think that already mf2 is
the same as mf1, but I do not know how to demonstrate this.
However, both mf1 and mf2 refer to the same environment, so
e1 -> mf2 -> e1 is a cycle for sure.

On Fri, Sep 28, 2007 at 08:14:45AM -0500, Luke Tierney wrote:
> >If yes, is it possible during gc() to determine also cases,
> >when NAMED may be dropped from 2 to 1? How much would this increase
> >the complexity of gc()?
> 
> Probably not impossible but would be a fair bit of work with probably
> not much gain as the NAMED values would still be high until the next
> gc of the appropriate level, which will probably be a fair time as an
> object being modified is likely to be older, but the interval in which
> there would be a benefit is short.

On Fri, Sep 28, 2007 at 04:36:40PM +0100, Prof Brian Ripley wrote:
[...]
> On Fri, 28 Sep 2007, Luke Tierney wrote:
[...]
> >approach may be possible. A related issue is that user-defined
> >assignment functions always see a NAMED of 2 and hence cannot modify
> >in place. We've been trying to come up with a reasonable solution to
> >this, so far without success but I'm moderately hopeful.
> 
> I am not persuaded that the difference between NAMED=1/2 makes much 
> difference in general use of R, and I recall Ross saying that he no longer 
> believed that this was a worthwhile optimization.  It's not just 
> 'user-defined' replacement functions, but also all the system-defined 
> closures (including all methods for the generic replacement functions 
> which are primitive) that are unable to benefit from it.

I am thinking about the following situation. The user creates a large
matrix A and then performs a sequence of operations on it. Some of
the operations scan the matrix in a read-only manner (calculating e.g.
some summaries), some operations are top level commands, which modify the
matrix itself. I do not argue that such a sequence of operations should
be done in place by default. However, I think that R should provide
tools, which allow to do this in place, if the user does some extra
work. If the matrix is really large, then in place operations are not
only more space efficient, but also more time efficient.

Using the information from the current thread, there are two
possible approaches to reach this.

1. The initial matrix should not be generated by "matrix" function
   due to the observation by Henrik Bengtsson (this is the issue
   with dimnames). The matrix may be initiated using e.g.
     .Internal(matrix(data, nrow, ncol, byrow))

   The matrix should not be scanned using an R function, which evaluates
   its body in its own enviroment. This includes functions nrow, ncol,
   colSums, rowSums and probaly more. The matrix may be scanned by
   functions, which use eval.parent(substitute( .... )) and avoid giving
   the matrix a new name. The user may prepare versions of nrow, ncol,
   colSums, rowSums, etc. with this property.

2. If NAMED attribute of A may be decreased from 2 to 1 during an operation
   similar to garbage collection (if A is not in a reference cycle), then the
   above approach may be combined also with operations, which work themselves
   in place and read only, but increase NAMED(A) as a side effect. In this
   case, the user should explicitly invoke the "NAMED reduction" after such
   operations. If the user has only a small number of large objects, then
   gc() is faster then duplication of some of the large things. So, I expect
   that the "NAMED reduction" could be also more time efficient than some
   of the unwanted duplications.

During the previous discussion, the exact counting of references was
sometimes mentioned. So, I want to explicitly state that I do not
think, it is a good idea. In my opinion, it is definitely not reasonable
now. I am very satisfied with the stability of R sessions and this
would be in danger during the transition to full counting. Moreover,
I can imagine (I am not an expert on this) that the efficiency and
simplicity benefit of the guaranteed approximate counting outweigh the
disadvantages (a bit more duplications than necessary) in a typical R
session.

However, there are situations, where the cost of duplication is
too high and the user knows about it in advance. In such situations,
having more tools for explicit control of duplication could help.
The tools may be, for example, some function, which allows a simple
query to the NAMED status of a given object on R level and
modifying some of the built-in functions to be more careful with
NAMED attribute. A possible strengthening of gc() would, of course, be
very useful here. I think about an explicit use of it, not about
the automatical runs. So, for safety reasons, the "NAMED reduction"
could be done by a different function, not the default gc() itself.

Petr Savicky.


From googel.vs.privacy at googlemail.com  Sat Sep 29 10:40:21 2007
From: googel.vs.privacy at googlemail.com (idontwant googeltospyafterme)
Date: Sat, 29 Sep 2007 10:40:21 +0200
Subject: [Rd] R-Server remotecontrolled via browser-GUI
Message-ID: <e0a4be450709290140td420327v73194bcc10422567@mail.gmail.com>

hi jeff,
i have read your paper from 2005 and your rapache solution sounds
good. i was wondering if u did sth about the state problem... you
should put a changelog on your website. what changes will come with
1.0?
and what is brew exactly for? it is like a tuned "cat", mixing
r-output and text, right?
so if i build a gui, brew could generate the html. but i dont'have to
use brew, do i? what are the advantages of using brew with rapache?

what do you think of openstatserver btw?

i think there are lots of interesting and promising approaches around
in R-community.
but as with all OSS, same here. many people working on slightly
different solutions for the same problem. and none of the solutions is
feature complete, some are not even actively developed and only a few
are to be seen as stable or beyond beta stadium.
well, i work almost only with OSS, so i got used to it :-)
it's just difficult to navigate thru the possibilities without
spending too much time on recherche.

have a nice day,

Josuah


From mtmorgan at fhcrc.org  Sat Sep 29 16:21:12 2007
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Sat, 29 Sep 2007 07:21:12 -0700
Subject: [Rd] CHAR () and Rmpi
In-Reply-To: <Pine.LNX.4.64.0709290655440.19554@gannet.stats.ox.ac.uk> (Brian
	Ripley's message of "Sat, 29 Sep 2007 07:12:49 +0100 (BST)")
References: <65368.65.95.138.11.1191005668.squirrel@www.stats.uwo.ca>
	<Pine.LNX.4.64.0709290655440.19554@gannet.stats.ox.ac.uk>
Message-ID: <6phtzpdv9gn.fsf@gopher4.fhcrc.org>

Hao Yu,

I spot two types of problematic code. Certainly the memcpy in
conversions.c:54 and 56 will cause problems, but I'm not sure whether
those functions are actually used?

The second paradigm is, e.g., Rmpi.c:561

    MPI_Recv(CHAR(STRING_ELT(sexp_data,i)),
             slen,MPI_CHAR,source,tag, comm[commn],&status[statusn]);

where the first argument to MPI_Recv is a buffer that MPI_Recv will
fill. sexp_data is a user-supplied character vector. A not-clever
solution creates a temporary buffer via R_alloc (for garbage-collected
memory) or R_Calloc (for user-managed memory, probably appropriate in
a loop where you'd like to reuse the buffer), passes the buffer to
MPI_Recv, and then SET_STRING_ELT with the now filled temporary buffer
converted to a CHARSXP with mkChar. I think this is backward
compatible. The user-supplied character vector has gone to waste, used
only to pass in the length of the expected string. mkChar will copy
the temporary buffer (unless an identical CHARSXP already exists), so
that there are potentially three memory allocations per string!  I
suspect most users rely on higher-level access (mpi.par*Apply,
mpi.*.Robj, etc) where this inefficiency is not important or can be
addressed without modifying the public interface.

Martin

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> I'm not sure what your sticking point here is.  If mpi does not modify 
> data in a (char *) pointer, then that really is a (const char *) pointer 
> and the headers are being unhelpful in not telling the compiler that 
> the data are constant.
>
> If that is the case you need to use casts to (char *) and the following 
> private define may be useful to you:
>
> #define CHAR_RW(x) ((char *) CHAR(x))
>
>
> However, you ask
>
>> Is there an easy way to get a char pointer to STRING_ELT((sexp_rdata),0) 
>> and is also backward compatible to old R versions.
>
> and the answer is that there is no such way, since (const char *) and 
> (char *) are not the same thing and any package that wants to alter the 
> contents of a string element needs to create a new CHARSXP to be that 
> element.
>
>
> BTW, you still have not changed Rmpi to remove the configure problems on 
> 64-bit systems (including assuming libs are in /usr/lib not /usr/lib64) I 
> pointed out a long time ago.
>
>
> On Fri, 28 Sep 2007, Hao Yu wrote:
>
>> Hi. I am the maintainer of Rmpi package. Now I have a problem regarding
>> the change of CHAR () in R 2.6.0. According to R 2.6.0 NEWS:
>> *******
>> CHAR() now returns (const char *) since CHARSXPs should no
>>        longer be modified in place.  This change allows compilers to
>>        warn or error about improper modification.  Thanks to Herve
>>        Pages for the suggestion.
>> *******
>> Unfortunately this causes Rmpi to fail since MPI requires char pointers
>> rather than const char pointers. Normally I use
>>    CHAR(STRING_ELT((sexp_rdata),0))
>> to get the pointer to MPI where a R character vector (C sense) is stored.
>> Because of the change, all character messengers fail. Is there an easy way
>> to get a char pointer to STRING_ELT((sexp_rdata),0) and is also backward
>> compatible to old R versions. BTW Rmpi does not do any modification of
>> characters at C level.
>>
>> Thanks
>> Hao Yu
>>
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin Morgan
Bioconductor / Computational Biology
http://bioconductor.org


From bradford.n.cross at gmail.com  Sun Sep 30 04:11:50 2007
From: bradford.n.cross at gmail.com (Bradford Cross)
Date: Sat, 29 Sep 2007 19:11:50 -0700
Subject: [Rd] Fwd: smart updates and rolling windows
In-Reply-To: <ea7d6a710709291008y60013d7bv7f7ce7abb8fb0c19@mail.gmail.com>
References: <ea7d6a710709291008y60013d7bv7f7ce7abb8fb0c19@mail.gmail.com>
Message-ID: <ea7d6a710709291911j257425f0ra1e898d4103db28e@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070929/1620c10b/attachment.pl 

From ggrothendieck at gmail.com  Sun Sep 30 06:27:16 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 30 Sep 2007 00:27:16 -0400
Subject: [Rd] as.Date.numeric
Message-ID: <971536df0709292127m670d2bffs4d07b37d47118a8a@mail.gmail.com>

I noticed that R 2.7.0 will have as.Date.numeric with a second
non-optional origin argument.  Frankly I would prefer that it default
to the Epoch since its a nuisance to specify but at the very least
I think that .Epoch should be provided as a builtin variable.


From ggrothendieck at gmail.com  Sun Sep 30 19:01:30 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 30 Sep 2007 13:01:30 -0400
Subject: [Rd] Ryacas check
Message-ID: <971536df0709301001i1c47c927l1f8311bb1d2dd0b1@mail.gmail.com>

When I do

   Rcmd check Ryacas

on my Windows Vista system under

   R version 2.6.0 beta (2007-09-23 r42958)

it checks out fine but here:

  http://cran.r-project.org/bin/windows/contrib/checkSummaryWin.html
  http://cran.r-project.org/bin/windows/contrib/2.5/check/Ryacas-check.log

it complains about the XML package even though the XML package
*is* declared in the DESCRIPTION file.

What is wrong?


From Kurt.Hornik at wu-wien.ac.at  Sun Sep 30 20:50:15 2007
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Sun, 30 Sep 2007 20:50:15 +0200
Subject: [Rd] CRAN packages with invalid maintainer email addresses
Message-ID: <18175.61415.586362.569301@mithrandir.hornik.net>

As part of the process for the upcoming release of 2.6.0, we recently
contacted all maintainers of CRAN packages which give R CMD check
warnings or errors for a current prerelease of R 2.6.0.

Emails to the following addresses bounced:

  ernst.glatzer at wu-wien.ac.at
  samuel_mwalili at yahoo.com  
  schlath at hsu-hh.de
  j.hadfield at sheffield.ac.uk
  rstrobl at ibe.med.uni-muenchen.de
  garlipp at mathematik.uni-oldenburg.de
  kaspar.rufibach at stanford.edu
  D.T.JACHO-CHAVEZ at lse.ac.uk
  dmyers at umiacs.umd.edu  
  juerg.schmidli at env.ethz.ch
  beat.kaufmann at epfl.ch
  hzou at stanford.edu
  bask at unitus.it
  J.C.Rougier at durham.ac.uk
  ivisser at uva.nl
  ebarrios at wisc.edu
  Jens_Oehschlaegel at truecluster.com

meaning that the packages

  BHH2 JLLprod MarkedPointProcess RandomFields SoPhy MasterBayes Oarray
  depmix edci epsi elasticnet hybridHclust km.ci modehunt ncvar ref
  regtest rindex riv rpart.permutation treeglia vardiag zicounts

are to be considered unmaintained.  

If you maintain one of these package, pls do provide an update fixing
the problems indicated on
http://cran.r-project.org/src/contrib/checkSummary.html, and provide a
valid email address.

If you know how to contact the respective maintainers, pls let me know.

If we receive no new information regarding these packages/maintainers,
we need to start orphaning these packages when 2.6.0 is released.

Best
-k


From duncan at wald.ucdavis.edu  Sun Sep 30 20:53:39 2007
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Mon, 01 Oct 2007 07:53:39 +1300
Subject: [Rd] Ryacas check
In-Reply-To: <971536df0709301001i1c47c927l1f8311bb1d2dd0b1@mail.gmail.com>
References: <971536df0709301001i1c47c927l1f8311bb1d2dd0b1@mail.gmail.com>
Message-ID: <46FFF0B3.2040003@wald.ucdavis.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



Gabor Grothendieck wrote:
> When I do
> 
>    Rcmd check Ryacas
> 
> on my Windows Vista system under
> 
>    R version 2.6.0 beta (2007-09-23 r42958)
> 
> it checks out fine but here:
> 
>   http://cran.r-project.org/bin/windows/contrib/checkSummaryWin.html
>   http://cran.r-project.org/bin/windows/contrib/2.5/check/Ryacas-check.log
> 
> it complains about the XML package even though the XML package
> *is* declared in the DESCRIPTION file.

The log says that the XML package refers to a function that cannot be
found and so the XML package wasn't loaded.


Grab the latest version of the XML package from
www.omegahat.org/RSXML/XML_0.93-1.tar.gz.
It is usually automatically fetched via CRAN, but
we have to figure out why that is not happening
currently.


> 
> What is wrong?
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.7 (Darwin)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFG//Cw9p/Jzwa2QP4RAvjdAJ0aAnMNyjGxO5WdONA7GUUTcIIXBQCfc5eR
gWNaJh5gMu5ZmLLDa1Pb1vc=
=ZU1N
-----END PGP SIGNATURE-----


From ggrothendieck at gmail.com  Sun Sep 30 21:07:40 2007
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 30 Sep 2007 15:07:40 -0400
Subject: [Rd] Ryacas check
In-Reply-To: <46FFF0B3.2040003@wald.ucdavis.edu>
References: <971536df0709301001i1c47c927l1f8311bb1d2dd0b1@mail.gmail.com>
	<46FFF0B3.2040003@wald.ucdavis.edu>
Message-ID: <971536df0709301207g5abc8e50wccbe5bbcec945dff@mail.gmail.com>

I don't understand what you are suggesting.  I already
have Depends: XML in my description file and as indicated
in my original post don't get any errors or warnings when I run
CHECK on my own system.  Its only CRAN that has them.

On 9/30/07, Duncan Temple Lang <duncan at wald.ucdavis.edu> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
>
>
> Gabor Grothendieck wrote:
> > When I do
> >
> >    Rcmd check Ryacas
> >
> > on my Windows Vista system under
> >
> >    R version 2.6.0 beta (2007-09-23 r42958)
> >
> > it checks out fine but here:
> >
> >   http://cran.r-project.org/bin/windows/contrib/checkSummaryWin.html
> >   http://cran.r-project.org/bin/windows/contrib/2.5/check/Ryacas-check.log
> >
> > it complains about the XML package even though the XML package
> > *is* declared in the DESCRIPTION file.
>
> The log says that the XML package refers to a function that cannot be
> found and so the XML package wasn't loaded.
>
>
> Grab the latest version of the XML package from
> www.omegahat.org/RSXML/XML_0.93-1.tar.gz.
> It is usually automatically fetched via CRAN, but
> we have to figure out why that is not happening
> currently.
>
>
> >
> > What is wrong?
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.7 (Darwin)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org
>
> iD8DBQFG//Cw9p/Jzwa2QP4RAvjdAJ0aAnMNyjGxO5WdONA7GUUTcIIXBQCfc5eR
> gWNaJh5gMu5ZmLLDa1Pb1vc=
> =ZU1N
> -----END PGP SIGNATURE-----
>


From duncan at wald.ucdavis.edu  Sun Sep 30 21:56:22 2007
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Mon, 01 Oct 2007 08:56:22 +1300
Subject: [Rd] Ryacas check
In-Reply-To: <46FFF0B3.2040003@wald.ucdavis.edu>
References: <971536df0709301001i1c47c927l1f8311bb1d2dd0b1@mail.gmail.com>
	<46FFF0B3.2040003@wald.ucdavis.edu>
Message-ID: <46FFFF66.9000203@wald.ucdavis.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



Duncan Temple Lang wrote:
> 
> 
> Gabor Grothendieck wrote:
>> When I do
> 
>>    Rcmd check Ryacas
> 
>> on my Windows Vista system under
> 
>>    R version 2.6.0 beta (2007-09-23 r42958)
> 
>> it checks out fine but here:
> 
>>   http://cran.r-project.org/bin/windows/contrib/checkSummaryWin.html
>>   http://cran.r-project.org/bin/windows/contrib/2.5/check/Ryacas-check.log
> 
>> it complains about the XML package even though the XML package
>> *is* declared in the DESCRIPTION file.
> 
> The log says that the XML package refers to a function that cannot be
> found and so the XML package wasn't loaded.
> 
> 
> Grab the latest version of the XML package from
> www.omegahat.org/RSXML/XML_0.93-1.tar.gz.

That should read XML_1.93-1.tar.gz



> It is usually automatically fetched via CRAN, but
> we have to figure out why that is not happening
> currently.
> 
> 
>> What is wrong?
> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.7 (Darwin)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFG//9k9p/Jzwa2QP4RArCLAJ4mEXs8zlF52Vb6foUF9L3NHj68+gCfZcZZ
DC/BEu8CnjjdwqUK5Sm+iwk=
=r6QI
-----END PGP SIGNATURE-----


From hyu at stats.uwo.ca  Sat Sep 29 17:26:49 2007
From: hyu at stats.uwo.ca (Hao Yu)
Date: Sat, 29 Sep 2007 11:26:49 -0400 (EDT)
Subject: [Rd] CHAR () and Rmpi
In-Reply-To: <6phtzpdv9gn.fsf@gopher4.fhcrc.org>
References: <65368.65.95.138.11.1191005668.squirrel@www.stats.uwo.ca>
	<Pine.LNX.4.64.0709290655440.19554@gannet.stats.ox.ac.uk>
	<6phtzpdv9gn.fsf@gopher4.fhcrc.org>
Message-ID: <49192.65.95.163.121.1191079609.squirrel@www.stats.uwo.ca>

Thank all for your quick reply. I am wrong to say Rmpi does not modify
CHARSXP at C level. In fact as Martin points out, the receive buff must be
modified. Last night I started the modification of c codes.

For send buffer (no modification), I used
//copy from R 2.6.0 (not in previous versions)
char *acopy_string2(const char *in)
{
    char *out;
    int len = strlen(in);
    if (len > 0) {
        out = (char *) R_alloc(strlen(in), sizeof(char));
        strcpy(out, in);
    } else
        out = "";
    return out;
}

char *charsxp2char(SEXP x)
{
    return acopy_string2(CHAR(x));
}

// I may combine above two functions together

SEXP mpi_info_set(SEXP sexp_info, SEXP sexp_key, SEXP sexp_value){
        char *key, *value;
        key =  charsxp2char( STRING_ELT (sexp_key,0));
        value = charsxp2char (STRING_ELT (sexp_value,0));

        return
AsInt(erreturn(mpi_errhandler(MPI_Info_set(info[INTEGER(sexp_info)[0]],
key, value))));
}

//For modified buffer. Need to use R_alloc for better memory managment
SEXP mpi_info_get(SEXP sexp_info, SEXP sexp_key, SEXP sexp_valuelen){
        int flag;
        char *key, *value;
        SEXP sexp_value;

        key=charsxp2char( STRING_ELT (sexp_key,0));
        PROTECT (sexp_value  = allocVector (STRSXP, 1));
        value = (char *)Calloc(INTEGER(sexp_valuelen)[0], char);
        mpi_errhandler(MPI_Info_get(info[INTEGER(sexp_info)[0]], key,
INTEGER(sexp_valuelen)[0], value, &flag));
        SET_STRING_ELT(sexp_value, 0, mkChar(value));
        UNPROTECT(1);
        Free(value);

        return sexp_value;
}

This works well. However, for nonblock calls, there is no way to receive a
char vector.

I am going to tidy up the codes and remove some redundant codes.

To Prof. Ripley. I am rewriting configure.ac (from configure.in) and put
lib64 in the search path. I am working on Debian 4.0 64bit and the
original configure.ac works well. The new configure.ac can be used for
OpenMPI so Rmpi can be used under OpenMPI (many request it). In addition,
Rmpi can be compiled and run under Mac OS X. I do not know if r-project
will put lam into OS X and make Rmpi officially available to Mac. I need
to fully test Rmpi before submitting next version.

Thanks all and have nice weekend days.
Hao

Martin Morgan wrote:
> Hao Yu,
>
> I spot two types of problematic code. Certainly the memcpy in
> conversions.c:54 and 56 will cause problems, but I'm not sure whether
> those functions are actually used?
>
> The second paradigm is, e.g., Rmpi.c:561
>
>     MPI_Recv(CHAR(STRING_ELT(sexp_data,i)),
>              slen,MPI_CHAR,source,tag, comm[commn],&status[statusn]);
>
> where the first argument to MPI_Recv is a buffer that MPI_Recv will
> fill. sexp_data is a user-supplied character vector. A not-clever
> solution creates a temporary buffer via R_alloc (for garbage-collected
> memory) or R_Calloc (for user-managed memory, probably appropriate in
> a loop where you'd like to reuse the buffer), passes the buffer to
> MPI_Recv, and then SET_STRING_ELT with the now filled temporary buffer
> converted to a CHARSXP with mkChar. I think this is backward
> compatible. The user-supplied character vector has gone to waste, used
> only to pass in the length of the expected string. mkChar will copy
> the temporary buffer (unless an identical CHARSXP already exists), so
> that there are potentially three memory allocations per string!  I
> suspect most users rely on higher-level access (mpi.par*Apply,
> mpi.*.Robj, etc) where this inefficiency is not important or can be
> addressed without modifying the public interface.
>
> Martin
>
> Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
>
>> I'm not sure what your sticking point here is.  If mpi does not modify
>> data in a (char *) pointer, then that really is a (const char *) pointer
>> and the headers are being unhelpful in not telling the compiler that
>> the data are constant.
>>
>> If that is the case you need to use casts to (char *) and the following
>> private define may be useful to you:
>>
>> #define CHAR_RW(x) ((char *) CHAR(x))
>>
>>
>> However, you ask
>>
>>> Is there an easy way to get a char pointer to
>>> STRING_ELT((sexp_rdata),0)
>>> and is also backward compatible to old R versions.
>>
>> and the answer is that there is no such way, since (const char *) and
>> (char *) are not the same thing and any package that wants to alter the
>> contents of a string element needs to create a new CHARSXP to be that
>> element.
>>
>>
>> BTW, you still have not changed Rmpi to remove the configure problems on
>> 64-bit systems (including assuming libs are in /usr/lib not /usr/lib64)
>> I
>> pointed out a long time ago.
>>
>>
>> On Fri, 28 Sep 2007, Hao Yu wrote:
>>
>>> Hi. I am the maintainer of Rmpi package. Now I have a problem regarding
>>> the change of CHAR () in R 2.6.0. According to R 2.6.0 NEWS:
>>> *******
>>> CHAR() now returns (const char *) since CHARSXPs should no
>>>        longer be modified in place.  This change allows compilers to
>>>        warn or error about improper modification.  Thanks to Herve
>>>        Pages for the suggestion.
>>> *******
>>> Unfortunately this causes Rmpi to fail since MPI requires char pointers
>>> rather than const char pointers. Normally I use
>>>    CHAR(STRING_ELT((sexp_rdata),0))
>>> to get the pointer to MPI where a R character vector (C sense) is
>>> stored.
>>> Because of the change, all character messengers fail. Is there an easy
>>> way
>>> to get a char pointer to STRING_ELT((sexp_rdata),0) and is also
>>> backward
>>> compatible to old R versions. BTW Rmpi does not do any modification of
>>> characters at C level.
>>>
>>> Thanks
>>> Hao Yu
>>>
>>>
>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> --
> Martin Morgan
> Bioconductor / Computational Biology
> http://bioconductor.org
>


-- 
Department of Statistics & Actuarial Sciences
Fax Phone#:(519)-661-3813
The University of Western Ontario
Office Phone#:(519)-661-3622
London, Ontario N6A 5B7
http://www.stats.uwo.ca/faculty/yu


