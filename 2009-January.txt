From Waclaw.Marcin.Kusnierczyk at idi.ntnu.no  Fri Jan  2 20:54:59 2009
From: Waclaw.Marcin.Kusnierczyk at idi.ntnu.no (Wacek Kusnierczyk)
Date: Fri, 02 Jan 2009 20:54:59 +0100
Subject: [Rd] [Fwd: Re: [R] Randomly remove condition-selected rows from a
	matrix]
Message-ID: <495E7113.6050901@idi.ntnu.no>

Following Duncan's suggestion, I forward the below to R-devel.

vQ

-------- Original Message --------
Subject: 	Re: [R] Randomly remove condition-selected rows from a matrix
Date: 	Fri, 02 Jan 2009 10:34:52 -0500
From: 	Duncan Murdoch <murdoch at stats.uwo.ca>
To: 	Wacek Kusnierczyk <Waclaw.Marcin.Kusnierczyk at idi.ntnu.no>
CC: 	R help <R-help at stat.math.ethz.ch>
References: 	<79CAFBDD-4BB8-4C9D-A0E9-54E280458510 at gmail.com>
<8b356f880812300920o19d18aeo47dc31f087c3f36 at mail.gmail.com>
<DA6ECC19-C786-4C02-B246-4B613726BC7F at gmail.com>
<8b356f880812311042la28aef3t81ad09a3b14ce65 at mail.gmail.com>
<495E2D95.9040502 at idi.ntnu.no>



On 02/01/2009 10:07 AM, Wacek Kusnierczyk wrote:
> Stavros Macrakis wrote:
>> On Wed, Dec 31, 2008 at 12:44 PM, Guillaume Chapron
>> <carnivorescience at gmail.com> wrote:
>>   
>>>> m[-sample(which(m[,1]<8 & m[,2]>12),2),]
>>>>       
>>> Supposing I sample only one row among the ones matching my criteria. Then
>>> consider the case where there is just one row matching this criteria. Sure,
>>> there is no need to sample, but the instruction would still be executed.
>>> Then if this row index is 15, my instruction becomes which(15,1), and this
>>> can gives me any row from 1 to 15, which is not correct. I have to make a
>>> condition in case there is only one row matching the criteria.
>>>     
>> Yes, this is a (documented!) design flaw in 'sample' -- see the man page.
>>
>> For some reason, the designers of R have chosen to document the flaw
>> and leave it up to individual users to work around it rather than fix
>> it definitively.  A related case is sample(c(),0), which gives an
>> error rather than giving an empty vector, though in general R deals
>> with empty vectors correctly (e.g. sum(c()) => 0).
>>
>>   
> 
> interestingly, ?sample says:
> 
> "
>      'sample' takes a sample of the specified size from the elements of
>      'x' using either with or without replacement.
> 
>        x: Either a (numeric, complex, character or logical) vector of
>           more than one element from which to choose, or a positive
>           integer.
> 
>     If 'x' has length 1, is numeric (in the sense of 'is.numeric') and
>      'x >= 1', sampling takes place from '1:x'.  _Note_ that this
>      convenience feature may lead to undesired behaviour when 'x' is of
>      varying length 'sample(x)'.  See the 'resample()' example below.
> 
> "
> 
> yet the following works, even though x has length 1 and is *not* numeric:
> 
> x = "foolme"
> is.numeric(x)
> sample(x, 1)
> sample(x)
> 
> x = NA
> is.numeric(NA)
> sample(x, 1)
> sample(x)
> 
> is this a bug in the code, or a bug in the documentation?
> 
> 
> 
>> To my mind, it is bizarre to have an important basic function which
>> works for some argument lengths but not others.  The convenience of
>> being able to write sample(5,2) for sample(1:5,2) hardly seems worth
>> inflicting inconsistency on all users -- but perhaps one of the
>> designers of R/S can enlighten us on the design rationale here.
>>
>>   
> 
> hopefully.

This is more of an R-devel sort of question.  My guess is that this is 
in the S blue book, but I don't have a copy here to check.

Duncan Murdoch


From Mark.Bravington at csiro.au  Fri Jan  2 21:55:52 2009
From: Mark.Bravington at csiro.au (Mark.Bravington at csiro.au)
Date: Sat, 3 Jan 2009 07:55:52 +1100
Subject: [Rd] [Fwd: Re: [R] Randomly remove condition-selected rows from
 a	matrix]
In-Reply-To: <495E7113.6050901@idi.ntnu.no>
References: <495E7113.6050901@idi.ntnu.no>
Message-ID: <62C82B39B8A85E4B95A18F7F7B852F870FD8600D@exvic-mbx03.nexus.csiro.au>

This is a recurring problem and from previous correspondence it seems unlikely that "sample" itself will ever be changed (and having myself been on the wrong end of a number of non-back-compatible changes in R, that's fine with me!).

To forestall future confusion, my suggestion is to add a function "rsample" defined as below, which has first argument "n" (number of values to return) consistent with the other "r..." random-generating functions. 

rsample <- function( n=length(pop), pop, replace=FALSE, prob=NULL) 
  pop[ sample( seq_along( pop)-1, size=n, replace=replace, prob=prob)+1]

The default for n is not necessary, but handy in case one is just trying to reorder a "pop" argument that is defined on-the-fly (as in Wacek's example). The -1 & +1 in the body prevent 'sample' from getting confused.

Perhaps this should be patched up to cope with the case n==length(pop)==0 that Duncan mentions

rsample <- function( n=length(pop), pop, replace=FALSE, prob=NULL) 
  if( n>0) pop[ sample( seq_along( pop)-1, size=n, replace=replace, prob=prob)+1] else if(n==0) pop[0] else stop( "invalid 'n' argument")

Mark Bravington
________________________________________
From: r-devel-bounces at r-project.org [r-devel-bounces at r-project.org] On Behalf Of Wacek Kusnierczyk [Waclaw.Marcin.Kusnierczyk at idi.ntnu.no]
Sent: 03 January 2009 06:54
To: r-devel at r-project.org
Subject: [Rd] [Fwd: Re: [R] Randomly remove condition-selected rows from a      matrix]

Following Duncan's suggestion, I forward the below to R-devel.

vQ

-------- Original Message --------
Subject:        Re: [R] Randomly remove condition-selected rows from a matrix
Date:   Fri, 02 Jan 2009 10:34:52 -0500
From:   Duncan Murdoch <murdoch at stats.uwo.ca>
To:     Wacek Kusnierczyk <Waclaw.Marcin.Kusnierczyk at idi.ntnu.no>
CC:     R help <R-help at stat.math.ethz.ch>
References:     <79CAFBDD-4BB8-4C9D-A0E9-54E280458510 at gmail.com>
<8b356f880812300920o19d18aeo47dc31f087c3f36 at mail.gmail.com>
<DA6ECC19-C786-4C02-B246-4B613726BC7F at gmail.com>
<8b356f880812311042la28aef3t81ad09a3b14ce65 at mail.gmail.com>
<495E2D95.9040502 at idi.ntnu.no>



On 02/01/2009 10:07 AM, Wacek Kusnierczyk wrote:
> Stavros Macrakis wrote:
>> On Wed, Dec 31, 2008 at 12:44 PM, Guillaume Chapron
>> <carnivorescience at gmail.com> wrote:
>>
>>>> m[-sample(which(m[,1]<8 & m[,2]>12),2),]
>>>>
>>> Supposing I sample only one row among the ones matching my criteria. Then
>>> consider the case where there is just one row matching this criteria. Sure,
>>> there is no need to sample, but the instruction would still be executed.
>>> Then if this row index is 15, my instruction becomes which(15,1), and this
>>> can gives me any row from 1 to 15, which is not correct. I have to make a
>>> condition in case there is only one row matching the criteria.
>>>
>> Yes, this is a (documented!) design flaw in 'sample' -- see the man page.
>>
>> For some reason, the designers of R have chosen to document the flaw
>> and leave it up to individual users to work around it rather than fix
>> it definitively.  A related case is sample(c(),0), which gives an
>> error rather than giving an empty vector, though in general R deals
>> with empty vectors correctly (e.g. sum(c()) => 0).
>>
>>
>
> interestingly, ?sample says:
>
> "
>      'sample' takes a sample of the specified size from the elements of
>      'x' using either with or without replacement.
>
>        x: Either a (numeric, complex, character or logical) vector of
>           more than one element from which to choose, or a positive
>           integer.
>
>     If 'x' has length 1, is numeric (in the sense of 'is.numeric') and
>      'x >= 1', sampling takes place from '1:x'.  _Note_ that this
>      convenience feature may lead to undesired behaviour when 'x' is of
>      varying length 'sample(x)'.  See the 'resample()' example below.
>
> "
>
> yet the following works, even though x has length 1 and is *not* numeric:
>
> x = "foolme"
> is.numeric(x)
> sample(x, 1)
> sample(x)
>
> x = NA
> is.numeric(NA)
> sample(x, 1)
> sample(x)
>
> is this a bug in the code, or a bug in the documentation?
>
>
>
>> To my mind, it is bizarre to have an important basic function which
>> works for some argument lengths but not others.  The convenience of
>> being able to write sample(5,2) for sample(1:5,2) hardly seems worth
>> inflicting inconsistency on all users -- but perhaps one of the
>> designers of R/S can enlighten us on the design rationale here.
>>
>>
>
> hopefully.

This is more of an R-devel sort of question.  My guess is that this is
in the S blue book, but I don't have a copy here to check.

Duncan Murdoch

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From milbo at sonic.net  Sat Jan  3 10:25:08 2009
From: milbo at sonic.net (milbo at sonic.net)
Date: Sat,  3 Jan 2009 10:25:08 +0100 (CET)
Subject: [Rd] Missing PROTECT in intern_getwd (in util.c) (PR#13424)
Message-ID: <20090103092508.643B5282EFF6@mail.pubhealth.ku.dk>

Full_Name: Stephen Milborrow
Version: 2.8.1
OS: WinXP
Submission from: (NULL) (198.54.202.150)


There is a missing PROTECT in intern_getwd in util.c. The current code is

  rval = allocVector(STRSXP, 1);
  SET_STRING_ELT(rval, 0, mkCharCE(buf, CE_UTF8));

and should be (because mkCharCE can allocate memory)

  PROTECT(rval = allocVector(STRSXP, 1));
  SET_STRING_ELT(rval, 0, mkCharCE(buf, CE_UTF8));
  UNPROTECT(1);

This was seen in R version 2.8.1 mingw32


From ripley at stats.ox.ac.uk  Sat Jan  3 10:58:49 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 3 Jan 2009 09:58:49 +0000 (GMT)
Subject: [Rd] (PR#13424) Missing PROTECT in intern_getwd (in util.c)
In-Reply-To: <20090103092508.643B5282EFF6@mail.pubhealth.ku.dk>
References: <20090103092508.643B5282EFF6@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0901030957120.21928@auk.stats.ox.ac.uk>

On Sat, 3 Jan 2009, milbo at sonic.net wrote:

> Full_Name: Stephen Milborrow
> Version: 2.8.1
> OS: WinXP
> Submission from: (NULL) (198.54.202.150)
>
>
> There is a missing PROTECT in intern_getwd in util.c. The current code is
>
>  rval = allocVector(STRSXP, 1);
>  SET_STRING_ELT(rval, 0, mkCharCE(buf, CE_UTF8));
>
> and should be (because mkCharCE can allocate memory)
>
>  PROTECT(rval = allocVector(STRSXP, 1));
>  SET_STRING_ELT(rval, 0, mkCharCE(buf, CE_UTF8));
>  UNPROTECT(1);
>
> This was seen in R version 2.8.1 mingw32

And it is code specific to that platform (although you did not say so).

Fixed now in R-patched, thank you.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ken_kleinman at hms.harvard.edu  Fri Jan  2 15:15:09 2009
From: ken_kleinman at hms.harvard.edu (ken_kleinman at hms.harvard.edu)
Date: Fri,  2 Jan 2009 15:15:09 +0100 (CET)
Subject: [Rd] bug report: writeForeignSAS in package "foreign" (PR#13423)
Message-ID: <20090102141509.90D9C282EFC1@mail.pubhealth.ku.dk>

function (df, datafile, codefile, dataname = "rdata", validvarname = c("V7",
    "V6"))
{
    factors <- sapply(df, is.factor)
    strings <- sapply(df, is.character)
    dates <- sapply(df, FUN = function(x) inherits(x, "Date") ||
        inherits(x, "dates") || inherits(x, "date"))
    xdates <- sapply(df, FUN = function(x) inherits(x, "dates") ||
        inherits(x, "date"))
    datetimes <- sapply(df, FUN = function(x) inherits(x, "POSIXt"))
    varlabels <- names(df)
    varnames <- make.SAS.names(names(df), validvarname = validvarname)
    if (any(varnames != varlabels))
        message("Some variable names were abbreviated or otherwise altered.")
    dfn <- df
    if (any(factors))
        dfn[factors] <- lapply(dfn[factors], as.numeric)write
    if (any(datetimes))
        dfn[datetimes] <- lapply(dfn[datetimes], function(x) format(x,
            "%d%b%Y %H:%M:%S"))
    if (any(xdates))
        dfn[xdates] <- lapply(dfn[xdates], function(x) as.Date(as.POSIXct(x)))
    write.table(dfn, file = datafile, row = FALSE, col = FALSE,
        sep = ",", quote = TRUE, na = "")
    lrecl <- max(sapply(readLines(datafile), nchar)) + 4L
    cat("* Written by R;\n", file = codefile)
    cat("* ", deparse(sys.call(-2L))[1L], ";\n\n", file = codefile,
        append = TRUE)
    if (any(factors)) {
        cat("PROC FORMAT;\n", file = codefile, append = TRUE)
        fmtnames <- make.SAS.formats(varnames[factors])
        fmt.values <- lapply(df[, factors, drop = FALSE], levels)
        names(fmt.values) <- fmtnames
        for (f in fmtnames) {
            cat("value", f, "\n", file = codefile, append = TRUE)
            values <- fmt.values[[f]]
            for (i in 1L:length(values)) {
                cat("    ", i, "=", adQuote(values[i]), "\n",
                  file = codefile, append = TRUE)
            }
            cat(";\n\n", file = codefile, append = TRUE)
        }
    }
    cat("DATA ", dataname, ";\n", file = codefile, append = TRUE)
    if (any(strings)) {
        cat("LENGTH", file = codefile, append = TRUE)
        lengths <- sapply(df[, strings, drop = FALSE], FUN =
function(x) max(nchar(x)))
        names(lengths) <- varnames[strings]
        for (v in varnames[strings]) cat("\n", v, "$", lengths[v],
            file = codefile, append = TRUE)
        cat("\n;\n\n", file = codefile, append = TRUE)
    }
    if (any(dates)) {
        cat("INFORMAT", file = codefile, append = TRUE)
        for (v in varnames[dates]) cat("\n", v, file = codefile,
            append = TRUE)
        cat("\n YYMMDD10.\n;\n\n", file = codefile, append = TRUE)
    }
    if (any(datetimes)) {
        cat("INFORMAT", file = codefile, append = TRUE)
        for (v in varnames[datetimes]) cat("\n", v, file = codefile,
            append = TRUE)
        cat("\n DATETIME18.\n;\n\n", file = codefile, append = TRUE)
    }
    cat("INFILE ", adQuote(datafile), "\n     DSD", "\n     LRECL=",
        lrecl, ";\n", file = codefile, append = TRUE)
    cat("INPUT", file = codefile, append = TRUE)
    for (v in 1L:ncol(df)) cat("\n", varnames[v], file = codefile,
        append = TRUE)
    if (strings[v])
        cat(" $ ", file = codefile, append = TRUE)
    cat("\n;\n", file = codefile, append = TRUE)
    for (v in 1L:ncol(df)) if (varnames[v] != names(varnames)[v])
        cat("LABEL ", varnames[v], "=", adQuote(varlabels[v]),
            ";\n", file = codefile, append = TRUE)
    if (any(factors))
        for (f in 1L:length(fmtnames)) cat("FORMAT", names(fmtnames)[f],
            paste(fmtnames[f], ".", sep = ""), ";\n", file = codefile,
            append = TRUE)
    if (any(dates))
        for (v in varnames[dates]) cat("FORMAT", v, "yymmdd10.;\n",
            file = codefile, append = TRUE)
    if (any(datetimes))
        for (v in varnames[datetimes]) cat("FORMAT", v, "datetime18.;\n",
            file = codefile, append = TRUE)
    cat("RUN;\n", file = codefile, append = TRUE)
}

-- 
___________________________
Ken Kleinman, ScD
Associate Professor, Department of Ambulatory Care and Prevention
Harvard Medical School and Harvard Pilgrim Health Care
133 Brookline Ave., 6th Floor
Boston, MA 02215
p: 617 509 9935
f: 617 859 8112
https://dacppages.pbwiki.com/Ken%20Kleinman


"The only useful function of a statistician is to make predictions,
and thus to provide a basis for action." - W.E. Deming

"Cleesh Inbox"  - Me

This email is only for the intended recipient and may contain
information that is privileged, confidential or exempt from disclosure
under applicable Federal or State law. Any review, retransmission,
dissemination or other use of  protected health information by other
than the intended recipient is prohibited. If you received this email
in error, please contact the sender and delete the material.


From ripley at stats.ox.ac.uk  Sat Jan  3 18:33:37 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 3 Jan 2009 17:33:37 +0000 (GMT)
Subject: [Rd] (PR#13423) bug report: writeForeignSAS in package "foreign"
In-Reply-To: <20090102141509.90D9C282EFC1@mail.pubhealth.ku.dk>
References: <20090102141509.90D9C282EFC1@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0901031732040.28137@auk.stats.ox.ac.uk>

And did you want to report a bug?

On Fri, 2 Jan 2009, ken_kleinman at hms.harvard.edu wrote:

> function (df, datafile, codefile, dataname = "rdata", validvarname = c("V7",
>    "V6"))
> {
>    factors <- sapply(df, is.factor)
>    strings <- sapply(df, is.character)
>    dates <- sapply(df, FUN = function(x) inherits(x, "Date") ||
>        inherits(x, "dates") || inherits(x, "date"))
>    xdates <- sapply(df, FUN = function(x) inherits(x, "dates") ||
>        inherits(x, "date"))
>    datetimes <- sapply(df, FUN = function(x) inherits(x, "POSIXt"))
>    varlabels <- names(df)
>    varnames <- make.SAS.names(names(df), validvarname = validvarname)
>    if (any(varnames != varlabels))
>        message("Some variable names were abbreviated or otherwise altered.")
>    dfn <- df
>    if (any(factors))
>        dfn[factors] <- lapply(dfn[factors], as.numeric)write
>    if (any(datetimes))
>        dfn[datetimes] <- lapply(dfn[datetimes], function(x) format(x,
>            "%d%b%Y %H:%M:%S"))
>    if (any(xdates))
>        dfn[xdates] <- lapply(dfn[xdates], function(x) as.Date(as.POSIXct(x)))
>    write.table(dfn, file = datafile, row = FALSE, col = FALSE,
>        sep = ",", quote = TRUE, na = "")
>    lrecl <- max(sapply(readLines(datafile), nchar)) + 4L
>    cat("* Written by R;\n", file = codefile)
>    cat("* ", deparse(sys.call(-2L))[1L], ";\n\n", file = codefile,
>        append = TRUE)
>    if (any(factors)) {
>        cat("PROC FORMAT;\n", file = codefile, append = TRUE)
>        fmtnames <- make.SAS.formats(varnames[factors])
>        fmt.values <- lapply(df[, factors, drop = FALSE], levels)
>        names(fmt.values) <- fmtnames
>        for (f in fmtnames) {
>            cat("value", f, "\n", file = codefile, append = TRUE)
>            values <- fmt.values[[f]]
>            for (i in 1L:length(values)) {
>                cat("    ", i, "=", adQuote(values[i]), "\n",
>                  file = codefile, append = TRUE)
>            }
>            cat(";\n\n", file = codefile, append = TRUE)
>        }
>    }
>    cat("DATA ", dataname, ";\n", file = codefile, append = TRUE)
>    if (any(strings)) {
>        cat("LENGTH", file = codefile, append = TRUE)
>        lengths <- sapply(df[, strings, drop = FALSE], FUN =
> function(x) max(nchar(x)))
>        names(lengths) <- varnames[strings]
>        for (v in varnames[strings]) cat("\n", v, "$", lengths[v],
>            file = codefile, append = TRUE)
>        cat("\n;\n\n", file = codefile, append = TRUE)
>    }
>    if (any(dates)) {
>        cat("INFORMAT", file = codefile, append = TRUE)
>        for (v in varnames[dates]) cat("\n", v, file = codefile,
>            append = TRUE)
>        cat("\n YYMMDD10.\n;\n\n", file = codefile, append = TRUE)
>    }
>    if (any(datetimes)) {
>        cat("INFORMAT", file = codefile, append = TRUE)
>        for (v in varnames[datetimes]) cat("\n", v, file = codefile,
>            append = TRUE)
>        cat("\n DATETIME18.\n;\n\n", file = codefile, append = TRUE)
>    }
>    cat("INFILE ", adQuote(datafile), "\n     DSD", "\n     LRECL=",
>        lrecl, ";\n", file = codefile, append = TRUE)
>    cat("INPUT", file = codefile, append = TRUE)
>    for (v in 1L:ncol(df)) cat("\n", varnames[v], file = codefile,
>        append = TRUE)
>    if (strings[v])
>        cat(" $ ", file = codefile, append = TRUE)
>    cat("\n;\n", file = codefile, append = TRUE)
>    for (v in 1L:ncol(df)) if (varnames[v] != names(varnames)[v])
>        cat("LABEL ", varnames[v], "=", adQuote(varlabels[v]),
>            ";\n", file = codefile, append = TRUE)
>    if (any(factors))
>        for (f in 1L:length(fmtnames)) cat("FORMAT", names(fmtnames)[f],
>            paste(fmtnames[f], ".", sep = ""), ";\n", file = codefile,
>            append = TRUE)
>    if (any(dates))
>        for (v in varnames[dates]) cat("FORMAT", v, "yymmdd10.;\n",
>            file = codefile, append = TRUE)
>    if (any(datetimes))
>        for (v in varnames[datetimes]) cat("FORMAT", v, "datetime18.;\n",
>            file = codefile, append = TRUE)
>    cat("RUN;\n", file = codefile, append = TRUE)
> }
>
> -- 
> ___________________________
> Ken Kleinman, ScD
> Associate Professor, Department of Ambulatory Care and Prevention
> Harvard Medical School and Harvard Pilgrim Health Care
> 133 Brookline Ave., 6th Floor
> Boston, MA 02215
> p: 617 509 9935
> f: 617 859 8112
> https://dacppages.pbwiki.com/Ken%20Kleinman
>
>
> "The only useful function of a statistician is to make predictions,
> and thus to provide a basis for action." - W.E. Deming
>
> "Cleesh Inbox"  - Me
>
> This email is only for the intended recipient and may contain
> information that is privileged, confidential or exempt from disclosure
> under applicable Federal or State law. Any review, retransmission,
> dissemination or other use of  protected health information by other
> than the intended recipient is prohibited. If you received this email
> in error, please contact the sender and delete the material.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From nhorton at email.smith.edu  Sat Jan  3 21:15:14 2009
From: nhorton at email.smith.edu (nhorton at email.smith.edu)
Date: Sat,  3 Jan 2009 21:15:14 +0100 (CET)
Subject: [Rd] Bug report in foreign library (PR#13425)
Message-ID: <20090103201514.46A20282EFC1@mail.pubhealth.ku.dk>

here appears to be a bug in the foreign library.  The following code used to
work, but now generates an error when 'package="SAS"' is specified:

ds <- read.csv("http://www.math.smith.edu/sasr/datasets/help.csv")
# running foreign package version 0.8-30
library(foreign)
# this works fine
write.foreign(ds, "foo", "bar", package="Stata")
# this yields an error
write.foreign(ds, "foo", "bar", package="SAS")
# Error in writeForeignSAS(df = list(id = c(1L, 2L, 3L, 4L, 5L, 6L, 7L,  :
#  object "dfn" not found



There appears to be a space between < and - in foreign:::writeForeignSAS on
or around line 15:

dfn < - df

        should be

dfn <- df

<<insert bug report here>>



--please do not edit the information below--

Version:
 platform = i386-apple-darwin8.11.1
 arch = i386
 os = darwin8.11.1
 system = i386, darwin8.11.1
 status = 
 major = 2
 minor = 8.1
 year = 2008
 month = 12
 day = 22
 svn rev = 47281
 language = R
 version.string = R version 2.8.1 (2008-12-22)

Locale:
en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

Search Path:
 .GlobalEnv, package:foreign, package:stats, package:graphics,
package:grDevices, package:utils, package:datasets, package:methods,
Autoloads, package:base

Nicholas Horton 
Department of Mathematics and Statistics, Smith College
Clark Science Center, Northampton, MA 01063-0001
http://www.math.smith.edu/~nhorton


From p.dalgaard at biostat.ku.dk  Sun Jan  4 00:46:43 2009
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sun, 04 Jan 2009 00:46:43 +0100
Subject: [Rd] Bug report in foreign library (PR#13425)
In-Reply-To: <20090103201514.46A20282EFC1@mail.pubhealth.ku.dk>
References: <20090103201514.46A20282EFC1@mail.pubhealth.ku.dk>
Message-ID: <495FF8E3.3030000@biostat.ku.dk>

nhorton at email.smith.edu wrote:
> here appears to be a bug in the foreign library.  The following code used to
> work, but now generates an error when 'package="SAS"' is specified:
> 
> ds <- read.csv("http://www.math.smith.edu/sasr/datasets/help.csv")
> # running foreign package version 0.8-30

That's one version ahead of the package in the 2.8.1 source tarball. Did 
you upgrade or is the darwin binary out of sync?

> library(foreign)
> # this works fine
> write.foreign(ds, "foo", "bar", package="Stata")
> # this yields an error
> write.foreign(ds, "foo", "bar", package="SAS")
> # Error in writeForeignSAS(df = list(id = c(1L, 2L, 3L, 4L, 5L, 6L, 7L,  :
> #  object "dfn" not found
> 
> 
> 
> There appears to be a space between < and - in foreign:::writeForeignSAS on
> or around line 15:
> 
> dfn < - df
> 
>         should be
> 
> dfn <- df

Yep. That is in 0.8-30 but not in -29...


> 
> <<insert bug report here>>
> 
> 
> 
> --please do not edit the information below--
> 
> Version:
>  platform = i386-apple-darwin8.11.1
>  arch = i386
>  os = darwin8.11.1
>  system = i386, darwin8.11.1
>  status = 
>  major = 2
>  minor = 8.1
>  year = 2008
>  month = 12
>  day = 22
>  svn rev = 47281
>  language = R
>  version.string = R version 2.8.1 (2008-12-22)
> 
> Locale:
> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
> 
> Search Path:
>  .GlobalEnv, package:foreign, package:stats, package:graphics,
> package:grDevices, package:utils, package:datasets, package:methods,
> Autoloads, package:base
> 
> Nicholas Horton 
> Department of Mathematics and Statistics, Smith College
> Clark Science Center, Northampton, MA 01063-0001
> http://www.math.smith.edu/~nhorton
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From markrosenrosen at gmail.com  Sun Jan  4 05:32:44 2009
From: markrosenrosen at gmail.com (Mark Rosen)
Date: Sat, 3 Jan 2009 23:32:44 -0500
Subject: [Rd] implementation of NULL in vectors
Message-ID: <c96a5b9e0901032032y648caf23u77a697ffe8fa927f@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090103/77bf8466/attachment.pl>

From ripley at stats.ox.ac.uk  Sun Jan  4 07:19:15 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 4 Jan 2009 06:19:15 +0000 (GMT)
Subject: [Rd] implementation of NULL in vectors
In-Reply-To: <c96a5b9e0901032032y648caf23u77a697ffe8fa927f@mail.gmail.com>
References: <c96a5b9e0901032032y648caf23u77a697ffe8fa927f@mail.gmail.com>
Message-ID: <alpine.LFD.2.00.0901040615500.4921@auk.stats.ox.ac.uk>

On Sat, 3 Jan 2009, Mark Rosen wrote:

> All,
>
> I was wondering if someone could point me to the location of the code in R
> that supports NULL values in vectors. I'm curious as to how you implemented
> them.

We don't allow NULL in atomic vectors. The 'R Internals' manual discusses 
such implementation issues.

>
> The only possible solution to me seems that for a double [], you need to
> keep a parallel bool [] that tells you whether the value is null or not. The
> bool [] doesn't have to be a literal bool [] -- you can keep a bit array.
> Things like summing up a vector become complicated -- you need to check if
> something is null before you perform an operation on it.
>
> For the purposes of vectors of numeric data types, why not represent NULL as
> NaN (as long as you're happy with the standard semantics of NaN)
>
> Thanks.
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From nhorton at email.smith.edu  Sun Jan  4 01:44:59 2009
From: nhorton at email.smith.edu (Nicholas Horton)
Date: Sat, 03 Jan 2009 19:44:59 -0500
Subject: [Rd] Bug report in foreign library (PR#13425)
In-Reply-To: <495FF8E3.3030000@biostat.ku.dk>
Message-ID: <C58570BB.29C46%nhorton@email.smith.edu>

Peter,

I run "update.packages()" regularly and may well have gotten this as a
result. Alas, I don't log the results very carefully.

All the best,

Nick


On 1/3/09 6:46 PM, "Peter Dalgaard" <p.dalgaard at biostat.ku.dk> wrote:

> nhorton at email.smith.edu wrote:
>> here appears to be a bug in the foreign library.  The following code used to
>> work, but now generates an error when 'package="SAS"' is specified:
>> 
>> ds <- read.csv("http://www.math.smith.edu/sasr/datasets/help.csv")
>> # running foreign package version 0.8-30
> 
> That's one version ahead of the package in the 2.8.1 source tarball. Did
> you upgrade or is the darwin binary out of sync?
> 
>> library(foreign)
>> # this works fine
>> write.foreign(ds, "foo", "bar", package="Stata")
>> # this yields an error
>> write.foreign(ds, "foo", "bar", package="SAS")
>> # Error in writeForeignSAS(df = list(id = c(1L, 2L, 3L, 4L, 5L, 6L, 7L,  :
>> #  object "dfn" not found
>> 
>> 
>> 
>> There appears to be a space between < and - in foreign:::writeForeignSAS on
>> or around line 15:
>> 
>> dfn < - df
>> 
>>         should be
>> 
>> dfn <- df
> 
> Yep. That is in 0.8-30 but not in -29...
> 
> 
>> 
>> <<insert bug report here>>
>> 
>> 
>> 
>> --please do not edit the information below--
>> 
>> Version:
>>  platform = i386-apple-darwin8.11.1
>>  arch = i386
>>  os = darwin8.11.1
>>  system = i386, darwin8.11.1
>>  status = 
>>  major = 2
>>  minor = 8.1
>>  year = 2008
>>  month = 12
>>  day = 22
>>  svn rev = 47281
>>  language = R
>>  version.string = R version 2.8.1 (2008-12-22)
>> 
>> Locale:
>> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>> 
>> Search Path:
>>  .GlobalEnv, package:foreign, package:stats, package:graphics,
>> package:grDevices, package:utils, package:datasets, package:methods,
>> Autoloads, package:base
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

Nicholas Horton 
Department of Mathematics and Statistics, Smith College
Clark Science Center, Northampton, MA 01063-0001
http://www.math.smith.edu/~nhorton


From ripley at stats.ox.ac.uk  Sun Jan  4 15:21:13 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 4 Jan 2009 14:21:13 +0000 (GMT)
Subject: [Rd] Bug report in foreign library (PR#13425)
In-Reply-To: <C58570BB.29C46%nhorton@email.smith.edu>
References: <C58570BB.29C46%nhorton@email.smith.edu>
Message-ID: <alpine.LFD.2.00.0901041412400.28082@auk.stats.ox.ac.uk>

On Sat, 3 Jan 2009, Nicholas Horton wrote:

> Peter,
>
> I run "update.packages()" regularly and may well have gotten this as a
> result. Alas, I don't log the results very carefully.

Yes 0.8-30 is an update on the Mac OS X distribution.  It was deliberately 
put out after 2.8.1 as we knew that some of the options were little tested 
(we neither have access to some of the 'foreign' programs nor test 
examples for many of the features).

In this case you could downgrade by re-installing the binary, or fix the 
sources and re-install.  The SVN archive has been updated, but I do not 
intend to put out a new release until I get some responses from those who 
reported bugs in 0-8-29 and have been asked to test if the bug is fixed.

>
> All the best,
>
> Nick
>
>
> On 1/3/09 6:46 PM, "Peter Dalgaard" <p.dalgaard at biostat.ku.dk> wrote:
>
>> nhorton at email.smith.edu wrote:
>>> here appears to be a bug in the foreign library.  The following code used to
>>> work, but now generates an error when 'package="SAS"' is specified:
>>>
>>> ds <- read.csv("http://www.math.smith.edu/sasr/datasets/help.csv")
>>> # running foreign package version 0.8-30
>>
>> That's one version ahead of the package in the 2.8.1 source tarball. Did
>> you upgrade or is the darwin binary out of sync?
>>
>>> library(foreign)
>>> # this works fine
>>> write.foreign(ds, "foo", "bar", package="Stata")
>>> # this yields an error
>>> write.foreign(ds, "foo", "bar", package="SAS")
>>> # Error in writeForeignSAS(df = list(id = c(1L, 2L, 3L, 4L, 5L, 6L, 7L,  :
>>> #  object "dfn" not found
>>>
>>>
>>>
>>> There appears to be a space between < and - in foreign:::writeForeignSAS on
>>> or around line 15:
>>>
>>> dfn < - df
>>>
>>>         should be
>>>
>>> dfn <- df
>>
>> Yep. That is in 0.8-30 but not in -29...
>>
>>
>>>
>>> <<insert bug report here>>
>>>
>>>
>>>
>>> --please do not edit the information below--
>>>
>>> Version:
>>>  platform = i386-apple-darwin8.11.1
>>>  arch = i386
>>>  os = darwin8.11.1
>>>  system = i386, darwin8.11.1
>>>  status =
>>>  major = 2
>>>  minor = 8.1
>>>  year = 2008
>>>  month = 12
>>>  day = 22
>>>  svn rev = 47281
>>>  language = R
>>>  version.string = R version 2.8.1 (2008-12-22)
>>>
>>> Locale:
>>> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>>>
>>> Search Path:
>>>  .GlobalEnv, package:foreign, package:stats, package:graphics,
>>> package:grDevices, package:utils, package:datasets, package:methods,
>>> Autoloads, package:base
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> Nicholas Horton
> Department of Mathematics and Statistics, Smith College
> Clark Science Center, Northampton, MA 01063-0001
> http://www.math.smith.edu/~nhorton
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bolker at ufl.edu  Sun Jan  4 20:16:23 2009
From: bolker at ufl.edu (Ben Bolker)
Date: Sun, 04 Jan 2009 14:16:23 -0500
Subject: [Rd] proposed patch to Uniform.Rd
Message-ID: <49610B07.50506@ufl.edu>


  In the wake of discussions about documentation of R's
random number generation (and whether there should be links
to .Random.seed in other places), here is a proposed patch
to Uniform.Rd from 2.8.1.  (Watch out for line breaks.)
[R-core may choose not to accept this, but at least it's
easy if they want it.]

  cheers
    Ben Bolker


*** Uniform.Rd.orig	2009-01-04 14:10:47.000000000 -0500
--- Uniform.Rd	2009-01-04 14:12:26.000000000 -0500
***************
*** 49,54 ****
--- 49,58 ----
    \code{max = min} or \code{max-min} is small compared to \code{min},
    and in particular not for the default arguments.
  }
+ \note{The characteristics of output from pseudo-random
+ number generators (such as precision and periodicity) vary widely.  See
+ \code{\link{.Random.seed}} for more information on R's random number
+ generation algorithms.}
  \references{
    Becker, R. A., Chambers, J. M. and Wilks, A. R. (1988)
    \emph{The New S Language}.

-- 
Ben Bolker
Associate professor, Biology Dep't, Univ. of Florida
bolker at ufl.edu / www.zoology.ufl.edu/bolker
GPG key: www.zoology.ufl.edu/bolker/benbolker-publickey.asc

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 260 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090104/2ab836a3/attachment.bin>

From deleeuw at stat.ucla.edu  Sun Jan  4 20:20:39 2009
From: deleeuw at stat.ucla.edu (Jan de Leeuw)
Date: Sun, 4 Jan 2009 11:20:39 -0800
Subject: [Rd] R-intro
Message-ID: <54D8D9AC-3076-473C-B2A2-3A27AD97EB4A@stat.ucla.edu>

Currently the pdf/dvi versions of R-intro do not build, the
tex compilation hangs on page 21 (standard TeXLive, OS X).

===============================================================
      Jan de Leeuw, 11667 Steinhoff Rd, Frazier Park, CA 93225
      home 661-245-1725 mobile 661-231-5416 work 310-825-9550
      .mac: jdeleeuw +++  aim: deleeuwjan +++ skype: j_deleeuw
===============================================================
              I am I because my little dog knows me.
	 		                 Gertrude Stein


From ripley at stats.ox.ac.uk  Sun Jan  4 23:11:26 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 4 Jan 2009 22:11:26 +0000 (GMT)
Subject: [Rd] R-intro
In-Reply-To: <54D8D9AC-3076-473C-B2A2-3A27AD97EB4A@stat.ucla.edu>
References: <54D8D9AC-3076-473C-B2A2-3A27AD97EB4A@stat.ucla.edu>
Message-ID: <alpine.LFD.2.00.0901042205020.5925@auk.stats.ox.ac.uk>

Jan,

I am not seeing this (on OS X or anywhere else).  Can you plese give more 
detais?

On Mac OS I am using MacTeX, on Windows MiKTeX and on Linux TeXLixe 2007.

On Sun, 4 Jan 2009, Jan de Leeuw wrote:

> Currently the pdf/dvi versions of R-intro do not build, the
> tex compilation hangs on page 21 (standard TeXLive, OS X).
>
> ===============================================================
>     Jan de Leeuw, 11667 Steinhoff Rd, Frazier Park, CA 93225
>     home 661-245-1725 mobile 661-231-5416 work 310-825-9550
>     .mac: jdeleeuw +++  aim: deleeuwjan +++ skype: j_deleeuw
> ===============================================================
>             I am I because my little dog knows me.
> 	 		                 Gertrude Stein
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From deleeuw at stat.ucla.edu  Sun Jan  4 23:32:09 2009
From: deleeuw at stat.ucla.edu (Jan de Leeuw)
Date: Sun, 4 Jan 2009 14:32:09 -0800
Subject: [Rd] R-intro
In-Reply-To: <alpine.LFD.2.00.0901042205020.5925@auk.stats.ox.ac.uk>
References: <54D8D9AC-3076-473C-B2A2-3A27AD97EB4A@stat.ucla.edu>
	<alpine.LFD.2.00.0901042205020.5925@auk.stats.ox.ac.uk>
Message-ID: <982F5DC5-5155-41EE-A2C8-0F4771E2A676@stat.ucla.edu>

Brian,

See below. It hangs after typesetting p 21, so I gave a ^C. It's the
current R-devel from svn, OS X 10.5.6, and the current TeXLive-2008
from svn (i.e. from tlmgr).

-------------- next part --------------



-- Jan



On Jan 4, 2009, at 14:11 , Prof Brian Ripley wrote:

> Jan,
>
> I am not seeing this (on OS X or anywhere else).  Can you plese give  
> more detais?
>
> On Mac OS I am using MacTeX, on Windows MiKTeX and on Linux TeXLixe  
> 2007.
>
> On Sun, 4 Jan 2009, Jan de Leeuw wrote:
>
>> Currently the pdf/dvi versions of R-intro do not build, the
>> tex compilation hangs on page 21 (standard TeXLive, OS X).
>>
>> ===============================================================
>>    Jan de Leeuw, 11667 Steinhoff Rd, Frazier Park, CA 93225
>>    home 661-245-1725 mobile 661-231-5416 work 310-825-9550
>>    .mac: jdeleeuw +++  aim: deleeuwjan +++ skype: j_deleeuw
>> ===============================================================
>>            I am I because my little dog knows me.
>> 	 		                 Gertrude Stein
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>

===
Jan de Leeuw; Distinguished Professor and Chair, UCLA Department of  
Statistics;
Director: UCLA Center for Environmental Statistics (CES);
Editor: Journal of Multivariate Analysis, Journal of Statistical  
Software;
US mail: 8125 Math Sciences Bldg, Box 951554, Los Angeles, CA 90095-1554
phone (310)-825-9550;  fax (310)-206-5658;  email: deleeuw at stat.ucla.edu
.mac: jdeleeuw ++++++  aim: deleeuwjan ++++++ skype: j_deleeuw
homepages: http://gifi.stat.ucla.edu ++++++ http://www.cuddyvalley.org
   
-------------------------------------------------------------------------------------------------
           No matter where you go, there you are. --- Buckaroo Banzai
                    http://gifi.stat.ucla.edu/sounds/nomatter.au
   
-------------------------------------------------------------------------------------------------






From ripley at stats.ox.ac.uk  Mon Jan  5 00:02:32 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 4 Jan 2009 23:02:32 +0000 (GMT)
Subject: [Rd] R-intro
In-Reply-To: <982F5DC5-5155-41EE-A2C8-0F4771E2A676@stat.ucla.edu>
References: <54D8D9AC-3076-473C-B2A2-3A27AD97EB4A@stat.ucla.edu>
	<alpine.LFD.2.00.0901042205020.5925@auk.stats.ox.ac.uk>
	<982F5DC5-5155-41EE-A2C8-0F4771E2A676@stat.ucla.edu>
Message-ID: <alpine.LFD.2.00.0901042255410.19053@auk.stats.ox.ac.uk>

On Sun, 4 Jan 2009, Jan de Leeuw wrote:

> Brian,
>
> See below. It hangs after typesetting p 21, so I gave a ^C. It's the
> current R-devel from svn, OS X 10.5.6, and the current TeXLive-2008
> from svn (i.e. from tlmgr).

The problem seems to be the version of texinfo.tex, which does not seem to 
be the one from TexLive 2008.  My MacTeX has

tystie% kpsewhich texinfo.tex
/usr/local/texlive/2008/texmf-dist/tex/texinfo/texinfo.tex
\def\texinfoversion{2008-04-18.10}

and your log has

(./R-intro.texi 
(/usr/local/texlive/2008/texmf-dist/tex/texinfo/texinfo.tex
Loading texinfo [version 2009-01-01.14]:

Note the date ... not in 2008.  This would not be the first time that a 
broken texinfo.tex has been released, but I don't see a texinfo release 
since 4.13a on 2008-09-22.  Please revert to a released version.

Brian

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From deleeuw at stat.ucla.edu  Mon Jan  5 00:24:55 2009
From: deleeuw at stat.ucla.edu (Jan de Leeuw)
Date: Sun, 4 Jan 2009 15:24:55 -0800
Subject: [Rd] R-intro
In-Reply-To: <alpine.LFD.2.00.0901042255410.19053@auk.stats.ox.ac.uk>
References: <54D8D9AC-3076-473C-B2A2-3A27AD97EB4A@stat.ucla.edu>
	<alpine.LFD.2.00.0901042205020.5925@auk.stats.ox.ac.uk>
	<982F5DC5-5155-41EE-A2C8-0F4771E2A676@stat.ucla.edu>
	<alpine.LFD.2.00.0901042255410.19053@auk.stats.ox.ac.uk>
Message-ID: <3612DAB4-78EA-4516-877D-590D9973E23B@stat.ucla.edu>

Thanks. Works with a previous version of texinfo.tex from Time Machine.

If you run tlmgr you'll see that CTAN now has the (broken) 2009-01-01
version, released by the FSF in 2009.

-- J.

On Jan 4, 2009, at 15:02 , Prof Brian Ripley wrote:

> On Sun, 4 Jan 2009, Jan de Leeuw wrote:
>
>> Brian,
>>
>> See below. It hangs after typesetting p 21, so I gave a ^C. It's the
>> current R-devel from svn, OS X 10.5.6, and the current TeXLive-2008
>> from svn (i.e. from tlmgr).
>
> The problem seems to be the version of texinfo.tex, which does not  
> seem to be the one from TexLive 2008.  My MacTeX has
>
> tystie% kpsewhich texinfo.tex
> /usr/local/texlive/2008/texmf-dist/tex/texinfo/texinfo.tex
> \def\texinfoversion{2008-04-18.10}
>
> and your log has
>
> (./R-intro.texi (/usr/local/texlive/2008/texmf-dist/tex/texinfo/ 
> texinfo.tex
> Loading texinfo [version 2009-01-01.14]:
>
> Note the date ... not in 2008.  This would not be the first time  
> that a broken texinfo.tex has been released, but I don't see a  
> texinfo release since 4.13a on 2008-09-22.  Please revert to a  
> released version.
>
> Brian
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>

===
Jan de Leeuw; Distinguished Professor and Chair, UCLA Department of  
Statistics;
Director: UCLA Center for Environmental Statistics (CES);
Editor: Journal of Multivariate Analysis, Journal of Statistical  
Software;
US mail: 8125 Math Sciences Bldg, Box 951554, Los Angeles, CA 90095-1554
phone (310)-825-9550;  fax (310)-206-5658;  email: deleeuw at stat.ucla.edu
.mac: jdeleeuw ++++++  aim: deleeuwjan ++++++ skype: j_deleeuw
homepages: http://gifi.stat.ucla.edu ++++++ http://www.cuddyvalley.org
   
-------------------------------------------------------------------------------------------------
           No matter where you go, there you are. --- Buckaroo Banzai
                    http://gifi.stat.ucla.edu/sounds/nomatter.au


From ripley at stats.ox.ac.uk  Mon Jan  5 09:02:47 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 5 Jan 2009 08:02:47 +0000 (GMT)
Subject: [Rd] R-intro
In-Reply-To: <3612DAB4-78EA-4516-877D-590D9973E23B@stat.ucla.edu>
References: <54D8D9AC-3076-473C-B2A2-3A27AD97EB4A@stat.ucla.edu>
	<alpine.LFD.2.00.0901042205020.5925@auk.stats.ox.ac.uk>
	<982F5DC5-5155-41EE-A2C8-0F4771E2A676@stat.ucla.edu>
	<alpine.LFD.2.00.0901042255410.19053@auk.stats.ox.ac.uk>
	<3612DAB4-78EA-4516-877D-590D9973E23B@stat.ucla.edu>
Message-ID: <alpine.LFD.2.00.0901050749240.6783@auk.stats.ox.ac.uk>

On Sun, 4 Jan 2009, Jan de Leeuw wrote:

> Thanks. Works with a previous version of texinfo.tex from Time Machine.
>
> If you run tlmgr you'll see that CTAN now has the (broken) 2009-01-01
> version, released by the FSF in 2009.

That is not how I read it: if I search on CTAN for texinfo.tex I get to

http://www.tex.ac.uk/cgi-bin/CTANcataloguesearch.pl?PreferredCTANSite=ftp.tex.ac.uk/tex-archive&CATSTRING=macros/texinfo

and that has the 2009-01-01.14 version as the 'Latest developers' working 
copy of Texinfo'.  The main texinfo area has the 2008-04-18.10 version.

We'll need to keep an eye on this.

>
> -- J.
>
> On Jan 4, 2009, at 15:02 , Prof Brian Ripley wrote:
>
>> On Sun, 4 Jan 2009, Jan de Leeuw wrote:
>> 
>>> Brian,
>>> 
>>> See below. It hangs after typesetting p 21, so I gave a ^C. It's the
>>> current R-devel from svn, OS X 10.5.6, and the current TeXLive-2008
>>> from svn (i.e. from tlmgr).
>> 
>> The problem seems to be the version of texinfo.tex, which does not seem to 
>> be the one from TexLive 2008.  My MacTeX has
>> 
>> tystie% kpsewhich texinfo.tex
>> /usr/local/texlive/2008/texmf-dist/tex/texinfo/texinfo.tex
>> \def\texinfoversion{2008-04-18.10}
>> 
>> and your log has
>> 
>> (./R-intro.texi (/usr/local/texlive/2008/texmf-dist/tex/texinfo/texinfo.tex
>> Loading texinfo [version 2009-01-01.14]:
>> 
>> Note the date ... not in 2008.  This would not be the first time that a 
>> broken texinfo.tex has been released, but I don't see a texinfo release 
>> since 4.13a on 2008-09-22.  Please revert to a released version.
>> 
>> Brian
>> 
>> -- 
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>> 
>
> ===
> Jan de Leeuw; Distinguished Professor and Chair, UCLA Department of 
> Statistics;
> Director: UCLA Center for Environmental Statistics (CES);
> Editor: Journal of Multivariate Analysis, Journal of Statistical Software;
> US mail: 8125 Math Sciences Bldg, Box 951554, Los Angeles, CA 90095-1554
> phone (310)-825-9550;  fax (310)-206-5658;  email: deleeuw at stat.ucla.edu
> .mac: jdeleeuw ++++++  aim: deleeuwjan ++++++ skype: j_deleeuw
> homepages: http://gifi.stat.ucla.edu ++++++ http://www.cuddyvalley.org
> 
> -------------------------------------------------------------------------------------------------
>         No matter where you go, there you are. --- Buckaroo Banzai
>                  http://gifi.stat.ucla.edu/sounds/nomatter.au
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From daniel.sabanesbove at campus.lmu.de  Sun Jan  4 18:54:48 2009
From: daniel.sabanesbove at campus.lmu.de (=?ISO-8859-15?Q?Daniel_Saban=E9s_Bov=E9?=)
Date: Sun, 04 Jan 2009 18:54:48 +0100
Subject: [Rd] cat cannot write more than 10000 characters? [R 2.8.1]
Message-ID: <4960F7E8.2000705@campus.lmu.de>

Hi,

during the examination of a Sweave hang-up inside an odfWeave call (OOo
XMLs have looong lines) I have discovered that my cat function cannot
write more than 10000 characters to a text file. Otherwise, the internal
C code causes a hang-up, which can only be stopped with a quit signal
that terminates the R session. Is this behavior normal?

Code to reproduce this:

testChunk <- paste(rep("a", 10000 + 1), ## delete "+ 1" to be successful
                   collapse="")
output <- tempfile()
cat(testChunk, sep = "\n", file = output, append = TRUE)

My sessionInfo:

R version 2.8.1 (2008-12-22)
i686-pc-linux-gnu (actually the latest openSuse 11.1)
locale:
LC_CTYPE=de_DE.UTF-8;LC_NUMERIC=C;LC_TIME=de_DE.UTF-8;LC_COLLATE=de_DE.UTF-8;LC_MONETARY=C;LC_MESSAGES=de_DE.UTF-8;LC_PAPER=de_DE.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=de_DE.UTF-8;LC_IDENTIFICATION=C

Thanks in advance,
Daniel


From ripley at stats.ox.ac.uk  Mon Jan  5 10:31:16 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 5 Jan 2009 09:31:16 +0000 (GMT)
Subject: [Rd] cat cannot write more than 10000 characters? [R 2.8.1]
In-Reply-To: <4960F7E8.2000705@campus.lmu.de>
References: <4960F7E8.2000705@campus.lmu.de>
Message-ID: <alpine.LFD.2.00.0901050926040.32650@auk.stats.ox.ac.uk>

On Sun, 4 Jan 2009, Daniel Saban?s Bov? wrote:

> Hi,
>
> during the examination of a Sweave hang-up inside an odfWeave call (OOo
> XMLs have looong lines) I have discovered that my cat function cannot
> write more than 10000 characters to a text file. Otherwise, the internal

You mean on a single line?

> C code causes a hang-up, which can only be stopped with a quit signal
> that terminates the R session. Is this behavior normal?

No, works for me on Mac OS X and x86_64 Fedora 8 (as does 10x larger).
Can you run this under a debugger and find where it is going wrong for 
you?

> Code to reproduce this:
>
> testChunk <- paste(rep("a", 10000 + 1), ## delete "+ 1" to be successful
>                   collapse="")
> output <- tempfile()
> cat(testChunk, sep = "\n", file = output, append = TRUE)

We have writeLines() for that and it is more efficient, especially if you 
keep a connection open.

> My sessionInfo:
>
> R version 2.8.1 (2008-12-22)
> i686-pc-linux-gnu (actually the latest openSuse 11.1)
> locale:
> LC_CTYPE=de_DE.UTF-8;LC_NUMERIC=C;LC_TIME=de_DE.UTF-8;LC_COLLATE=de_DE.UTF-8;LC_MONETARY=C;LC_MESSAGES=de_DE.UTF-8;LC_PAPER=de_DE.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=de_DE.UTF-8;LC_IDENTIFICATION=C
>
> Thanks in advance,
> Daniel

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From felix at nfrac.org  Mon Jan  5 11:04:40 2009
From: felix at nfrac.org (Felix Andrews)
Date: Mon, 5 Jan 2009 21:04:40 +1100
Subject: [Rd] bug involving quote(); ghost in the machine
Message-ID: <94730b8a0901050204r6a8b97fcuac064ca1e339a91f@mail.gmail.com>

Hi list(...),

I've narrowed down a weird bug. It's like a ghost in the machine, in
that functions seem to remember things that they should not be able
to. In the example below, the result of the second (and subseqent)
calls depend on what was given in the first call.

foo <- function(given = NULL) {
    callObj <- quote(callFunc())
    if (!is.null(given))
        callObj$given <- given
    if (is.null(given))
        callObj$default <- TRUE
    callObj
}

foo()
# callFunc(default = TRUE)
foo(given = TRUE)
# callFunc(default = TRUE, given = TRUE)

Note, if the first call was something different, the result is different:

foo("blah blah")
# callFunc(given = "blah blah")
foo(given = TRUE)
# callFunc(given = TRUE)
foo()
# callFunc(given = "blah blah", default = TRUE)

So on subsequent calls, callObj is being initialised to its final
value from the first call. You can actually see this here:
body(foo)[[2]]
# callObj <- quote(callFunc(given = "blah blah"))

The problem seems to be related to quote(callFunc()), because if you
replace it with call("callFunc"), everything works as expected:

foo.ok <- function(given = NULL) {
    callObj <- call("callFunc")
    if (!is.null(given))
        callObj$given <- given
    if (is.null(given))
        callObj$default <- TRUE
    callObj
}

foo.ok()
# callFunc(default = TRUE)
foo.ok(given = TRUE)
# callFunc(given = TRUE)



> sessionInfo()
R version 2.9.0 Under development (unstable) (2009-01-04 r47462)
i386-pc-mingw32

locale:
LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MONETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


-- 
Felix Andrews / ???
http://www.neurofractal.org/felix/
3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8


From torpedofisken at gmail.com  Mon Jan  5 11:14:15 2009
From: torpedofisken at gmail.com (torpedo fisken)
Date: Mon, 5 Jan 2009 11:14:15 +0100
Subject: [Rd] can't get names of R_env
Message-ID: <6b50a24c0901050214w2ac73bb8t635a65b261e47696@mail.gmail.com>

Hi,
I'm quite knew in R, so I might not have the R specific jargon.

But here is my problem,
I'm trying to access and use variabels given by a function environment,
more specifically the rho in do_optim in src/main/optim.c

According to the documentation
http://cran.r-project.org/doc/manuals/R-ints.html#The-_0027data_0027
the envsxp is defined as a tagged pairlist.

"ENVSXP: Pointers to the frame, enclosing environment and hash table
(NULL or a VECSXP). A frame is a tagged pairlist with tag the symbol
and CAR the bound value."

But I'm having troubles accessing the data.
I've written a small function called printNames that looks like
-----------------------
void printNames(SEXP list){
    SEXP names = getAttrib(list, R_NamesSymbol);
    int i;
    Rprintf("List is of length:%d\n",length(list));
    for (i = 0; i < length(list); i++)
      Rprintf("name of id:%d\t%s\n",i,CHAR(STRING_ELT(names, i)));
}
-----------------------
This is basicly just a copy of
-----------------------
static SEXP getListElement(SEXP list, char *str)
{
    SEXP elmt = R_NilValue, names = getAttrib(list, R_NamesSymbol);
    int i;

    for (i = 0; i < length(list); i++)
	if (strcmp(CHAR(STRING_ELT(names, i)), str) == 0) {
	    elmt = VECTOR_ELT(list, i);
	    break;
	}
    return elmt;
}
-----------------------
But this crashes and looks like
-----------------------
List is of length:16
name of id:0	Xd?
name of id:1	Xd?
name of id:2	
 *** caught segfault ***
address 0x28, cause 'memory not mapped'
------------------------
I've just added printNames(rho) in the very first line of do_optim().
Futhermore I've checked that the typeof(rho) corresponds to the

#define ENVSXP	     4 in Rinternals.h at line 84

Can anyone clarify how to access these enviroment variables.
I believe my problem lies in the sentence "A frame is a tagged
pairlist with tag the symbol and CAR the bound value."
Or more precisely, I don't quite understand the struct for env exp
--------------------------
struct envsxp_struct {
    struct SEXPREC *frame;
    struct SEXPREC *enclos;
    struct SEXPREC *hashtab;
};
--------------------------

thanks in advance.

From ripley at stats.ox.ac.uk  Mon Jan  5 11:25:29 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 5 Jan 2009 10:25:29 +0000 (GMT)
Subject: [Rd] bug involving quote(); ghost in the machine
In-Reply-To: <94730b8a0901050204r6a8b97fcuac064ca1e339a91f@mail.gmail.com>
References: <94730b8a0901050204r6a8b97fcuac064ca1e339a91f@mail.gmail.com>
Message-ID: <alpine.LFD.2.00.0901051011100.25721@auk.stats.ox.ac.uk>

Turn off "keep.source": you will see that is foo that is changed by the 
call.

Something is either not setting or handling the NAMED field  and so not 
duplicating: it looks like the pairlist code for $<- is the culprit.

On Mon, 5 Jan 2009, Felix Andrews wrote:

> Hi list(...),
>
> I've narrowed down a weird bug. It's like a ghost in the machine, in
> that functions seem to remember things that they should not be able
> to. In the example below, the result of the second (and subseqent)
> calls depend on what was given in the first call.
>
> foo <- function(given = NULL) {
>    callObj <- quote(callFunc())
>    if (!is.null(given))
>        callObj$given <- given
>    if (is.null(given))
>        callObj$default <- TRUE
>    callObj
> }
>
> foo()
> # callFunc(default = TRUE)
> foo(given = TRUE)
> # callFunc(default = TRUE, given = TRUE)
>
> Note, if the first call was something different, the result is different:
>
> foo("blah blah")
> # callFunc(given = "blah blah")
> foo(given = TRUE)
> # callFunc(given = TRUE)
> foo()
> # callFunc(given = "blah blah", default = TRUE)
>
> So on subsequent calls, callObj is being initialised to its final
> value from the first call. You can actually see this here:
> body(foo)[[2]]
> # callObj <- quote(callFunc(given = "blah blah"))
>
> The problem seems to be related to quote(callFunc()), because if you
> replace it with call("callFunc"), everything works as expected:
>
> foo.ok <- function(given = NULL) {
>    callObj <- call("callFunc")
>    if (!is.null(given))
>        callObj$given <- given
>    if (is.null(given))
>        callObj$default <- TRUE
>    callObj
> }
>
> foo.ok()
> # callFunc(default = TRUE)
> foo.ok(given = TRUE)
> # callFunc(given = TRUE)
>
>
>
>> sessionInfo()
> R version 2.9.0 Under development (unstable) (2009-01-04 r47462)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MONETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
>
> -- 
> Felix Andrews / ???
> http://www.neurofractal.org/felix/
> 3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/?ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Mon Jan  5 11:35:11 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 5 Jan 2009 10:35:11 +0000 (GMT)
Subject: [Rd] can't get names of R_env
In-Reply-To: <6b50a24c0901050214w2ac73bb8t635a65b261e47696@mail.gmail.com>
References: <6b50a24c0901050214w2ac73bb8t635a65b261e47696@mail.gmail.com>
Message-ID: <alpine.LFD.2.00.0901051026540.25721@auk.stats.ox.ac.uk>

You will have to read more carefully: an ENVSXP is nothing like a VECSXP, 
and does not have the names of its entries in a names attribute.

You access variables in an environment via findVar() and friends, 
including findVarInFrame: see 'Writing R Extensions'.

On Mon, 5 Jan 2009, torpedo fisken wrote:

> Hi,
> I'm quite knew in R, so I might not have the R specific jargon.
>
> But here is my problem,
> I'm trying to access and use variabels given by a function environment,
> more specifically the rho in do_optim in src/main/optim.c

Very likely this is not the way to do whatever it is that you really want 
to do.

> According to the documentation
> http://cran.r-project.org/doc/manuals/R-ints.html#The-_0027data_0027
> the envsxp is defined as a tagged pairlist.
>
> "ENVSXP: Pointers to the frame, enclosing environment and hash table
> (NULL or a VECSXP). A frame is a tagged pairlist with tag the symbol
> and CAR the bound value."
>
> But I'm having troubles accessing the data.
> I've written a small function called printNames that looks like
> -----------------------
> void printNames(SEXP list){
>    SEXP names = getAttrib(list, R_NamesSymbol);
>    int i;
>    Rprintf("List is of length:%d\n",length(list));
>    for (i = 0; i < length(list); i++)
>      Rprintf("name of id:%d\t%s\n",i,CHAR(STRING_ELT(names, i)));
> }
> -----------------------
> This is basicly just a copy of
> -----------------------
> static SEXP getListElement(SEXP list, char *str)
> {
>    SEXP elmt = R_NilValue, names = getAttrib(list, R_NamesSymbol);
>    int i;
>
>    for (i = 0; i < length(list); i++)
> 	if (strcmp(CHAR(STRING_ELT(names, i)), str) == 0) {
> 	    elmt = VECTOR_ELT(list, i);
> 	    break;
> 	}
>    return elmt;
> }
> -----------------------
> But this crashes and looks like
> -----------------------
> List is of length:16
> name of id:0	Xd???
> name of id:1	Xd???
> name of id:2
> *** caught segfault ***
> address 0x28, cause 'memory not mapped'
> ------------------------
> I've just added printNames(rho) in the very first line of do_optim().
> Futhermore I've checked that the typeof(rho) corresponds to the
>
> #define ENVSXP	     4 in Rinternals.h at line 84
>
> Can anyone clarify how to access these enviroment variables.
> I believe my problem lies in the sentence "A frame is a tagged
> pairlist with tag the symbol and CAR the bound value."
> Or more precisely, I don't quite understand the struct for env exp
> --------------------------
> struct envsxp_struct {
>    struct SEXPREC *frame;
>    struct SEXPREC *enclos;
>    struct SEXPREC *hashtab;
> };
> --------------------------
>
> thanks in advance.
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From rksh1 at cam.ac.uk  Mon Jan  5 12:01:09 2009
From: rksh1 at cam.ac.uk (Robin Hankin)
Date: Mon, 05 Jan 2009 11:01:09 +0000
Subject: [Rd] \description in Rd files
Message-ID: <4961E875.40105@cam.ac.uk>

Hi

I make a point of going through my packages every so often and perusing
the check results on CRAN.

The aylmer package generates a warning (under R-2.9.0) for an Rd file 
which I think is OK.
The package is clean under R-2.8.1.

Specifically, the warning is:

    * checking Rd files ... OK
    * checking Rd files against version 2 parser ... *WARNING*
      *** error on file ./man/icons.Rd
      Error in parse_Rd("./man/icons.Rd", encoding = "unknown") :
      ./man/icons.Rd: 16:3: unexpected section header at
      15: :
      16: \description

      problem found in ?icons.Rd?
      The Rdversion 2 parser is experimental, but almost all reports are
      correct.



And the relevant file lines in icons.Rd are:

14 The six icons were used in this study were:
15 \description{
16 \item[PB] polar bears, which face extinction through loss of ice
17 floe hunting grounds
18 \item[NB] the Norfolk Broads, which flood due to intense rainfall
19 events
20 \item[LF] London flooding, as a result of sea level rise
21 \item[THC] the Thermo-haline circulation, which may slow or stop as
22 a result of anthropogenic modification of the hydrological cycle
23 \item[OA] oceanic acidification as a result of anthropogenic emissions
24 of carbon dioxide
25 \item[WAIS] the West Antarctic Ice Sheet, which is calving into the sea
26 as a result of climate change
27 }



[this using nl]






-- 
Robin K. S. Hankin
Uncertainty Analyst
University of Cambridge
19 Silver Street
Cambridge CB3 9EP
01223-764877


From ripley at stats.ox.ac.uk  Mon Jan  5 12:05:21 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 5 Jan 2009 11:05:21 +0000 (GMT)
Subject: [Rd] bug involving quote(); ghost in the machine
In-Reply-To: <alpine.LFD.2.00.0901051011100.25721@auk.stats.ox.ac.uk>
References: <94730b8a0901050204r6a8b97fcuac064ca1e339a91f@mail.gmail.com>
	<alpine.LFD.2.00.0901051011100.25721@auk.stats.ox.ac.uk>
Message-ID: <alpine.LFD.2.00.0901051101540.19474@auk.stats.ox.ac.uk>

On Mon, 5 Jan 2009, Prof Brian Ripley wrote:

> Turn off "keep.source": you will see that is foo that is changed by the call.
>
> Something is either not setting or handling the NAMED field  and so not 
> duplicating: it looks like the pairlist code for $<- is the culprit.

Yes, so try a current R-devel or R-patched.  Also, the [[<- version of 
your example works correctly (for me).

>
> On Mon, 5 Jan 2009, Felix Andrews wrote:
>
>> Hi list(...),
>> 
>> I've narrowed down a weird bug. It's like a ghost in the machine, in
>> that functions seem to remember things that they should not be able
>> to. In the example below, the result of the second (and subseqent)
>> calls depend on what was given in the first call.
>> 
>> foo <- function(given = NULL) {
>>    callObj <- quote(callFunc())
>>    if (!is.null(given))
>>        callObj$given <- given
>>    if (is.null(given))
>>        callObj$default <- TRUE
>>    callObj
>> }
>> 
>> foo()
>> # callFunc(default = TRUE)
>> foo(given = TRUE)
>> # callFunc(default = TRUE, given = TRUE)
>> 
>> Note, if the first call was something different, the result is different:
>> 
>> foo("blah blah")
>> # callFunc(given = "blah blah")
>> foo(given = TRUE)
>> # callFunc(given = TRUE)
>> foo()
>> # callFunc(given = "blah blah", default = TRUE)
>> 
>> So on subsequent calls, callObj is being initialised to its final
>> value from the first call. You can actually see this here:
>> body(foo)[[2]]
>> # callObj <- quote(callFunc(given = "blah blah"))
>> 
>> The problem seems to be related to quote(callFunc()), because if you
>> replace it with call("callFunc"), everything works as expected:
>> 
>> foo.ok <- function(given = NULL) {
>>    callObj <- call("callFunc")
>>    if (!is.null(given))
>>        callObj$given <- given
>>    if (is.null(given))
>>        callObj$default <- TRUE
>>    callObj
>> }
>> 
>> foo.ok()
>> # callFunc(default = TRUE)
>> foo.ok(given = TRUE)
>> # callFunc(given = TRUE)
>> 
>> 
>> 
>>> sessionInfo()
>> R version 2.9.0 Under development (unstable) (2009-01-04 r47462)
>> i386-pc-mingw32
>> 
>> locale:
>> LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MONETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252
>> 
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>> 
>> 
>> -- 
>> Felix Andrews / ???
>> http://www.neurofractal.org/felix/
>> 3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/?ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/?ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Mon Jan  5 12:26:44 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 5 Jan 2009 11:26:44 +0000 (GMT)
Subject: [Rd] \description in Rd files
In-Reply-To: <4961E875.40105@cam.ac.uk>
References: <4961E875.40105@cam.ac.uk>
Message-ID: <alpine.LFD.2.00.0901051123150.17492@auk.stats.ox.ac.uk>

I think you meant \describe ....

On Mon, 5 Jan 2009, Robin Hankin wrote:

> Hi
>
> I make a point of going through my packages every so often and perusing
> the check results on CRAN.
>
> The aylmer package generates a warning (under R-2.9.0) for an Rd file which I 
> think is OK.
> The package is clean under R-2.8.1.

Did you actually look at the help under 2.8.1: it is I am sure not what 
you intended?  Oops ....

> Specifically, the warning is:
>
>   * checking Rd files ... OK
>   * checking Rd files against version 2 parser ... *WARNING*
>     *** error on file ./man/icons.Rd
>     Error in parse_Rd("./man/icons.Rd", encoding = "unknown") :
>     ./man/icons.Rd: 16:3: unexpected section header at
>     15: :
>     16: \description
>
>     problem found in ?icons.Rd?
>     The Rdversion 2 parser is experimental, but almost all reports are
>     correct.
>
>
>
> And the relevant file lines in icons.Rd are:
>
> 14 The six icons were used in this study were:
> 15 \description{
> 16 \item[PB] polar bears, which face extinction through loss of ice
> 17 floe hunting grounds
> 18 \item[NB] the Norfolk Broads, which flood due to intense rainfall
> 19 events
> 20 \item[LF] London flooding, as a result of sea level rise
> 21 \item[THC] the Thermo-haline circulation, which may slow or stop as
> 22 a result of anthropogenic modification of the hydrological cycle
> 23 \item[OA] oceanic acidification as a result of anthropogenic emissions
> 24 of carbon dioxide
> 25 \item[WAIS] the West Antarctic Ice Sheet, which is calving into the sea
> 26 as a result of climate change
> 27 }
>
>
>
> [this using nl]
>
>
>
>
>
>
> -- 
> Robin K. S. Hankin
> Uncertainty Analyst
> University of Cambridge
> 19 Silver Street
> Cambridge CB3 9EP
> 01223-764877
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From rksh1 at cam.ac.uk  Mon Jan  5 12:59:18 2009
From: rksh1 at cam.ac.uk (Robin Hankin)
Date: Mon, 05 Jan 2009 11:59:18 +0000
Subject: [Rd] \description in Rd files
In-Reply-To: <alpine.LFD.2.00.0901051123150.17492@auk.stats.ox.ac.uk>
References: <4961E875.40105@cam.ac.uk>
	<alpine.LFD.2.00.0901051123150.17492@auk.stats.ox.ac.uk>
Message-ID: <4961F616.1050107@cam.ac.uk>

Prof Brian Ripley wrote:
> I think you meant \describe ....
>
> On Mon, 5 Jan 2009, Robin Hankin wrote:
>
>> Hi
>>
>> The aylmer package generates a warning (under R-2.9.0) for an Rd file 
>> which I think is OK.
>> The package is clean under R-2.8.1.
>
> Did you actually look at the help under 2.8.1: it is I am sure not 
> what you intended?  Oops ....
>
>

Ouch.   aylmer.dvi  looks fine under  R-2.8.1 but indeed the text 
versions are not as intended.

I guess that the machinery for text documentation is less tolerant of  
inappropriate LaTeX-isms.

All works fine with \describe in place of \description.

thanks again

rksh




-- 
Robin K. S. Hankin
Uncertainty Analyst
University of Cambridge
19 Silver Street
Cambridge CB3 9EP
01223-764877


From daniel.sabanesbove at campus.lmu.de  Mon Jan  5 12:03:43 2009
From: daniel.sabanesbove at campus.lmu.de (=?UTF-8?B?RGFuaWVsIFNhYmFuw6lzIEJvdsOp?=)
Date: Mon, 05 Jan 2009 12:03:43 +0100
Subject: [Rd] cat cannot write more than 10000 characters? [R 2.8.1]
In-Reply-To: <alpine.LFD.2.00.0901050926040.32650@auk.stats.ox.ac.uk>
References: <4960F7E8.2000705@campus.lmu.de>
	<alpine.LFD.2.00.0901050926040.32650@auk.stats.ox.ac.uk>
Message-ID: <4961E90F.3040508@campus.lmu.de>

Dear Prof. Ripley,
>> I have discovered that my cat function cannot write more than 10000
>> characters to a text file.
> You mean on a single line?
Yes. OOo tries to save space...
> No, works for me on Mac OS X and x86_64 Fedora 8 (as does 10x larger).
> Can you run this under a debugger and find where it is going wrong for
> you?
Oh, then this might be distribution- or gcc-version-specific:
gcc --version
gcc (SUSE Linux) 4.3.2 [gcc-4_3-branch revision 141291]

glibc is version 2.9-2.3.

Using ddd I found the (relevant part of the) backtrace when interrupting
the infinite loop:

(gdb) backtrace
#0  __gconv (cd=0x846cde0, inbuf=0xbfff7738, inbufend=0x84ca589 "",
outbuf=0xbfff773c, outbufend=0xbfff9e57 "", irreversible=0xbfff76a8) at
gconv.c:80

The program comes here more than 100 000 times... with outbuf and inbuf
always being "\0".

#1  0xb7b581e7 in iconv (cd=0x846cde0, inbuf=0xbfff7738,
inbytesleft=0xbfff7734, outbuf=0xbfff773c, outbytesleft=0xbfff7730) at
iconv.c:53
[this is   result = __gconv (gcd, (const unsigned char **) inbuf,
                        (const unsigned char *)  (*inbuf + *inbytesleft),
                          (unsigned char **) outbuf,
                           (unsigned char *) (*outbuf + *outbytesleft),
                       &irreversible);]

#2  0xb7e44d29 in Riconv (cd=0x846cde0, inbuf=0xbfff7738,
inbytesleft=0xbfff7734, outbuf=0xbfff773c, outbytesleft=0xbfff7730) at
sysutils.c:692
[ this is the only line of Riconv,  return iconv((iconv_t) cd,
(ICONV_CONST char **) inbuf, inbytesleft, outbuf, outbytesleft);]

#3  0xb7d2c337 in dummy_vfprintf (con=0x8400bb0, format=0xb7ee0c48 "%s",
ap=0xbfffc604 "\230?L\b??\005\b?h\a\b?h\a\b??\005\b??\005\b\001") at
connections.c:316
[this is      ires = Riconv(con->outconv, &ib, &inb, &ob, &onb);]

The infinite loop seems to be inside dummy_vfprintf, as this position is
the "highest" inside the backtrace which is reached again and again. And
at line 249 appears the magic number 10000 as BUFSIZE, which is indeed
selected by the preprocessor in my environment!

#4  0xb7d2c4fa in file_vfprintf (con=0x8400bb0, format=0xb7ee0c48 "%s",
ap=0xbfffc604 "\230?L\b??\005\b?h\a\b?h\a\b??\005\b??\005\b\001") at
connections.c:579
[this is  if(con->outconv) return dummy_vfprintf(con, format, ap);]

This and everything above is only reached once, so this might be OK.

#5  0xb7dfe069 in Rvprintf (format=0xb7ee0c48 "%s", arg=0xbfffc604
"\230?L\b??\005\b?h\a\b?h\a\b??\005\b??\005\b\001") at printutils.c:785   
[this is   (con->vfprintf)(con, format, argcopy);]

#6  0xb7dfe244 in Rprintf (format=0xb7ee0c48 "%s") at printutils.c:679    
[this is   Rvprintf(format, ap);]

#7  0xb7d0446c in do_cat (call=0x83032a8, op=0x806b7d4, args=<value
optimized out>, rho=0x830359c) at builtin.c:597   
[this is   Rprintf("%s", p);]

Unfortunately, I'm not experienced in R/C code internals, but if you
have detailed instructions for me (like "show me the value of this
variable after 10000 stops") I can provide more debugging info.
>> cat(testChunk, sep = "\n", file = output, append = TRUE)
> We have writeLines() for that and it is more efficient, especially if
> you keep a connection open.
OK, maybe Prof. Leisch wants to improve the Sweave code...?

Thank you very much for your help,
best regards,
Daniel Sabanes


From bachmannherwig at hotmail.com  Mon Jan  5 23:44:17 2009
From: bachmannherwig at hotmail.com (herwig)
Date: Mon, 5 Jan 2009 14:44:17 -0800 (PST)
Subject: [Rd] MacOS X - R crashes & import problem (PR#9005)
In-Reply-To: <20060619094316.E6EA14D2DC@slim.kubism.ku.dk>
References: <20060619094316.E6EA14D2DC@slim.kubism.ku.dk>
Message-ID: <21301048.post@talk.nabble.com>


Hi there,

I have got more or less the same problem. I actually can not do anything in
the R editor - as soon as I try to change something it crashes.
Has anyone been able to solve this problem?
I can send the full crash report if someone is interested.

gr.

Herwig

Below my systems details:

Date/Time:      2009-01-05 23:38:29 +0100
OS Version:     10.5.6 (Build 9G55)
Architecture:   i386
Report Version: 4

Command:        R
Path:           /Applications/R.app/Contents/MacOS/R
Version:        R 2.8.1 GUI 1.27 Tiger build 32-bit (5301)
Parent:         launchd [87]

PID:            519
Event:          hang
Time:           43.33s
Steps:          365


Process:        R [519]
Path:           /Applications/R.app/Contents/MacOS/R




--------------------------

oliver.balmer wrote:
> 
> Full_Name: Oliver Balmer
> Version: 2.3.1
> OS: Mac OS 10.4.6
> Submission from: (NULL) (157.161.74.75)
> 
> 
> when working in the editor R crashes regularly. no other program ever
> crashes.
> one quite reliable way to crash it is by marking some code and then
> pressing the
> "find" command. I have had this problem with other R versions before. I
> have the
> feeling the editor is the problem. Another problem with the editor is that
> I
> always need to hit the carriage return twice after inserting the cursor at
> a
> certain point, after the first time, nothing happens. Not a big problem
> but
> probably not as it should be, and maybe a hint for a deeper problem.
> 
> Another bug: if the imported data frame contains a ? (greek mu, as in
> microliter), R can't read the file.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
View this message in context: http://www.nabble.com/MacOS-X---R-crashes---import-problem-%28PR-9005%29-tp4933442p21301048.html
Sent from the R devel mailing list archive at Nabble.com.


From soren.faurby at biology.au.dk  Tue Jan  6 12:25:04 2009
From: soren.faurby at biology.au.dk (soren.faurby at biology.au.dk)
Date: Tue,  6 Jan 2009 12:25:04 +0100 (CET)
Subject: [Rd] Apparant bug in binomial model in GLM (PR#13434)
Message-ID: <20090106112504.50983282EFF6@mail.pubhealth.ku.dk>

Full_Name: S?ren Faurby
Version: 2.4.1 and 2.7.2
OS: 
Submission from: (NULL) (192.38.46.92)


There appear to be a bug in the estimation of significance in the binomial model
in GLM. This bug apparently appears when the correlation between two variables
is to strong.

Such as this dummy example
c(0,0,0,0,0,1,1,1,1,1)->a
a->b
m1<-glm(a~b, binomial)
summary(m1)

It is sufficient that all 1's correspond to 1's such as this example

c(0,0,0,0,0,1,1,1,1,1)->a
c(0,0,0,0,1,1,1,1,1,1)->c
m1<-glm(a~c, binomial)
summary(m1)

I hope that this message is understandable. 

Kind regards, S?ren


From simon.urbanek at r-project.org  Tue Jan  6 15:52:07 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 6 Jan 2009 09:52:07 -0500
Subject: [Rd] MacOS X - R crashes & import problem (PR#9005)
In-Reply-To: <21301048.post@talk.nabble.com>
References: <20060619094316.E6EA14D2DC@slim.kubism.ku.dk>
	<21301048.post@talk.nabble.com>
Message-ID: <CAAEA7A5-A337-4A34-92C2-E1BE54672808@r-project.org>


On Jan 5, 2009, at 17:44 , herwig wrote:

>
> Hi there,
>
> I have got more or less the same problem. I actually can not do  
> anything in
> the R editor - as soon as I try to change something it crashes.
> Has anyone been able to solve this problem?

No, since as you can see it is filed under "not-reproducible".


> I can send the full crash report if someone is interested.
>

Please do, send it to me and include your sessionInfo().

Thanks,
Simon



> gr.
>
> Herwig
>
> Below my systems details:
>
> Date/Time:      2009-01-05 23:38:29 +0100
> OS Version:     10.5.6 (Build 9G55)
> Architecture:   i386
> Report Version: 4
>
> Command:        R
> Path:           /Applications/R.app/Contents/MacOS/R
> Version:        R 2.8.1 GUI 1.27 Tiger build 32-bit (5301)
> Parent:         launchd [87]
>
> PID:            519
> Event:          hang
> Time:           43.33s
> Steps:          365
>
>
> Process:        R [519]
> Path:           /Applications/R.app/Contents/MacOS/R
>
>
>
>
> --------------------------
>
> oliver.balmer wrote:
>>
>> Full_Name: Oliver Balmer
>> Version: 2.3.1
>> OS: Mac OS 10.4.6
>> Submission from: (NULL) (157.161.74.75)
>>
>>
>> when working in the editor R crashes regularly. no other program ever
>> crashes.
>> one quite reliable way to crash it is by marking some code and then
>> pressing the
>> "find" command. I have had this problem with other R versions  
>> before. I
>> have the
>> feeling the editor is the problem. Another problem with the editor  
>> is that
>> I
>> always need to hit the carriage return twice after inserting the  
>> cursor at
>> a
>> certain point, after the first time, nothing happens. Not a big  
>> problem
>> but
>> probably not as it should be, and maybe a hint for a deeper problem.
>>
>> Another bug: if the imported data frame contains a ? (greek mu, as in
>> microliter), R can't read the file.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> -- 
> View this message in context: http://www.nabble.com/MacOS-X---R-crashes---import-problem-%28PR-9005%29-tp4933442p21301048.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From therneau at mayo.edu  Tue Jan  6 15:58:42 2009
From: therneau at mayo.edu (Terry Therneau)
Date: Tue, 6 Jan 2009 08:58:42 -0600 (CST)
Subject: [Rd] Strange error message
Message-ID: <200901061458.n06Ewg02005957@rocky.mayo.edu>

 I'm testing out some changes to survreg and got the following output, the
likes of which I've never seen before:

----------------------------------------------------------------------
R version 2.7.1 (2008-06-23)
Copyright (C) 2008 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> source('setup.s')
> source('mktest1.s')
> fit1w <- survreg(Surv(time, status) ~x, test1, dist='weibull')
Warning: stack imbalance in '.Call', 26 then 27
Warning: stack imbalance in '<-', 24 then 25
Warning: stack imbalance in '{', 22 then 23
Warning: stack imbalance in 'if', 20 then 21
Warning: stack imbalance in '.Call', 23 then 24
Warning: stack imbalance in '<-', 21 then 22
Warning: stack imbalance in '{', 18 then 20
Warning: stack imbalance in '<-', 12 then 14
Warning: stack imbalance in 'if', 10 then 12
Warning: stack imbalance in '{', 8 then 10
Warning: stack imbalance in '<-', 2 then 4
> traceback()
No traceback available 
----------------------------------------------------------

  The "setup" file simply attaches the directory containing my test version of
the survival code, and mktest1.s is
   test1 <- data.frame(time=  c(4, 3,1,1,2,2,3),
                    status=c(1,NA,1,0,1,1,0),
                    x=     c(0, 2,1,1,1,0,0))

the simple test data set from the appendix of my book, for which I know ALL the
answers.

  There has been a change to the C code.  Is this possibly due to a messed up
calling chain?  I've converted from "Chambers" style callback to Rinternals
style (much cleaner and less mysterious), and the result works well in Splus.
I thought I'd made it through the hard part....

  Hints appreciated, after which I can give more details.

	Terry Therneau


From ripley at stats.ox.ac.uk  Tue Jan  6 16:00:19 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 6 Jan 2009 15:00:19 +0000 (GMT)
Subject: [Rd] Apparant bug in binomial model in GLM (PR#13434)
In-Reply-To: <20090106112504.50983282EFF6@mail.pubhealth.ku.dk>
References: <20090106112504.50983282EFF6@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0901061444380.9877@auk.stats.ox.ac.uk>

This is a (too-little) known phenomenon: the problem is the low power of 
the Wald test in certain circumstances, and not the R implementation.

You can look it up in MASS (the book)  pp.197-9.

Can I ask how you 'knew for certain' what this should do? From the FAQ:

   But be sure you know for certain what it ought to have done. If you
   aren't familiar with the command, or don't know for certain how the
   command is supposed to work, then it might actually be working right.
   For example, people sometimes think there is a bug in R's mathematics
   because they don't understand how finite-precision arithmetic works.
   Rather than jumping to conclusions, show the problem to someone who
   knows for certain.

Who was your authority here?


On Tue, 6 Jan 2009, soren.faurby at biology.au.dk wrote:

> Full_Name: S?ren Faurby
> Version: 2.4.1 and 2.7.2

Neither of which is current.

> OS:
> Submission from: (NULL) (192.38.46.92)
>
>
> There appear to be a bug in the estimation of significance in the 
> binomial model in GLM. This bug apparently appears when the correlation 
> between two variables is to strong.
>
> Such as this dummy example
> c(0,0,0,0,0,1,1,1,1,1)->a
> a->b
> m1<-glm(a~b, binomial)
> summary(m1)
>
> It is sufficient that all 1's correspond to 1's such as this example
>
> c(0,0,0,0,0,1,1,1,1,1)->a
> c(0,0,0,0,1,1,1,1,1,1)->c
> m1<-glm(a~c, binomial)
> summary(m1)
>
> I hope that this message is understandable.
>
> Kind regards, S?ren
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From P.Dalgaard at biostat.ku.dk  Tue Jan  6 16:08:21 2009
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 06 Jan 2009 16:08:21 +0100
Subject: [Rd] Apparant bug in binomial model in GLM (PR#13434)
In-Reply-To: <20090106112504.50983282EFF6@mail.pubhealth.ku.dk>
References: <20090106112504.50983282EFF6@mail.pubhealth.ku.dk>
Message-ID: <496373E5.9000901@biostat.ku.dk>

soren.faurby at biology.au.dk wrote:
> Full_Name: S?ren Faurby
> Version: 2.4.1 and 2.7.2
> OS: 
> Submission from: (NULL) (192.38.46.92)
> 
> 
> There appear to be a bug in the estimation of significance in the binomial model
> in GLM. This bug apparently appears when the correlation between two variables
> is to strong.
> 
> Such as this dummy example
> c(0,0,0,0,0,1,1,1,1,1)->a
> a->b
> m1<-glm(a~b, binomial)
> summary(m1)
> 
> It is sufficient that all 1's correspond to 1's such as this example
> 
> c(0,0,0,0,0,1,1,1,1,1)->a
> c(0,0,0,0,1,1,1,1,1,1)->c
> m1<-glm(a~c, binomial)
> summary(m1)

That's not a bug, just the way things work. When the algorithm diverges,
 as seen by the huge Std.Error, Wald tests (z) are unreliable. (Notice
that the log OR in an a vs. c table is infinite whichever way you turn
it.) The likelihood ratio test (as in drop1(m1, test="Chisq")) is
somewhat less unreliable, but in these small examples, still quite some
distance from the table based approaches of fisher.test(a,c) and
chisq.test(a,c).


> 
> I hope that this message is understandable. 
> 
> Kind regards, S?ren
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Tue Jan  6 16:18:03 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 6 Jan 2009 15:18:03 +0000 (GMT)
Subject: [Rd] Strange error message
In-Reply-To: <200901061458.n06Ewg02005957@rocky.mayo.edu>
References: <200901061458.n06Ewg02005957@rocky.mayo.edu>
Message-ID: <alpine.LFD.2.00.0901061515530.15962@auk.stats.ox.ac.uk>

This indicates that your PROTECTs and UNPROTECTs are out of balance (by 
one, looking at the numbers) in the .Call (which I assume is to your own 
code?).

On Tue, 6 Jan 2009, Terry Therneau wrote:

> I'm testing out some changes to survreg and got the following output, the
> likes of which I've never seen before:
>
> ----------------------------------------------------------------------
> R version 2.7.1 (2008-06-23)
> Copyright (C) 2008 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
>
>  Natural language support but running in an English locale
>
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
>
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
>
>> source('setup.s')
>> source('mktest1.s')
>> fit1w <- survreg(Surv(time, status) ~x, test1, dist='weibull')
> Warning: stack imbalance in '.Call', 26 then 27
> Warning: stack imbalance in '<-', 24 then 25
> Warning: stack imbalance in '{', 22 then 23
> Warning: stack imbalance in 'if', 20 then 21
> Warning: stack imbalance in '.Call', 23 then 24
> Warning: stack imbalance in '<-', 21 then 22
> Warning: stack imbalance in '{', 18 then 20
> Warning: stack imbalance in '<-', 12 then 14
> Warning: stack imbalance in 'if', 10 then 12
> Warning: stack imbalance in '{', 8 then 10
> Warning: stack imbalance in '<-', 2 then 4
>> traceback()
> No traceback available
> ----------------------------------------------------------
>
>  The "setup" file simply attaches the directory containing my test version of
> the survival code, and mktest1.s is
>   test1 <- data.frame(time=  c(4, 3,1,1,2,2,3),
>                    status=c(1,NA,1,0,1,1,0),
>                    x=     c(0, 2,1,1,1,0,0))
>
> the simple test data set from the appendix of my book, for which I know ALL the
> answers.
>
>  There has been a change to the C code.  Is this possibly due to a messed up
> calling chain?  I've converted from "Chambers" style callback to Rinternals
> style (much cleaner and less mysterious), and the result works well in Splus.
> I thought I'd made it through the hard part....
>
>  Hints appreciated, after which I can give more details.
>
> 	Terry Therneau
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From therneau at mayo.edu  Tue Jan  6 16:47:06 2009
From: therneau at mayo.edu (Terry Therneau)
Date: Tue, 6 Jan 2009 09:47:06 -0600 (CST)
Subject: [Rd] Strange error message
Message-ID: <200901061547.n06Fl6g12560@hsrnfs-101.mayo.edu>

Brian,
  Thank you.  This explains why it works in Splus: PROTECT is a null macro 
there, so I wouldn't have caught the miscount.
  
  	Terry


From cbeleites at units.it  Wed Jan  7 12:36:09 2009
From: cbeleites at units.it (Claudia Beleites)
Date: Wed, 7 Jan 2009 12:36:09 +0100
Subject: [Rd] methods vs. functions
Message-ID: <200901071236.10178.cbeleites@units.it>

Dear Duncan and Oleg,

thanks for your answers. 

For the moment, I'll use functions. 

Happy new year, 

Claudia

-- 
Claudia Beleites
Dipartimento dei Materiali e delle Risorse Naturali
Universit? degli Studi di Trieste
Via Alfonso Valerio 6/a
I-34127 Trieste

phone: +39 (0 40) 5 58-34 47
email: cbeleites at units.it


From cbeleites at units.it  Wed Jan  7 12:39:01 2009
From: cbeleites at units.it (Claudia Beleites)
Date: Wed, 7 Jan 2009 12:39:01 +0100
Subject: [Rd] ... (dotMethods) and cbind/rbind: how to give the
	signature?
Message-ID: <200901071239.01826.cbeleites@units.it>

Dear Oleg,

thanks a lot! 
I'll have S3 methods until the problems settle somehow.

I wasn't aware that S3 despatch works for S4 classes as well.

Claudia

-- 
Claudia Beleites
Dipartimento dei Materiali e delle Risorse Naturali
Universit? degli Studi di Trieste
Via Alfonso Valerio 6/a
I-34127 Trieste

phone: +39 (0 40) 5 58-34 47
email: cbeleites at units.it


From daniel.sabanesbove at gmx.net  Wed Jan  7 13:41:54 2009
From: daniel.sabanesbove at gmx.net (=?ISO-8859-1?Q?Daniel_Saban=E9s_Bov=E9?=)
Date: Wed, 07 Jan 2009 13:41:54 +0100
Subject: [Rd] Apparant bug in binomial model in GLM (PR#13434)
In-Reply-To: <mailman.25.1231326005.26300.r-devel@r-project.org>
References: <mailman.25.1231326005.26300.r-devel@r-project.org>
Message-ID: <4964A312.4070103@gmx.net>

> There appear to be a bug in the estimation of significance in the binomial model
> in GLM. This bug apparently appears when the correlation between two variables
> is to strong.
>
> Such as this dummy example
> c(0,0,0,0,0,1,1,1,1,1)->a
> a->b
> m1<-glm(a~b, binomial)
> summary(m1)
>
> It is sufficient that all 1's correspond to 1's such as this example
Isn't this just the well-known failure of logistic regression (non-existence of maximum likelihood estimator) for linearly separable data? (b > 0.5 => a == 1)
> c(0,0,0,0,0,1,1,1,1,1)->a
> c(0,0,0,0,1,1,1,1,1,1)->c
> m1<-glm(a~c, binomial)
> summary(m1)
This is not linearly separable, but almost, so the standard errors will be very large.


From charlie at stat.umn.edu  Wed Jan  7 16:12:18 2009
From: charlie at stat.umn.edu (Charles Geyer)
Date: Wed, 7 Jan 2009 09:12:18 -0600
Subject: [Rd] Apparant bug in binomial model in GLM (PR#13434)
In-Reply-To: <mailman.25.1231326005.26300.r-devel@r-project.org>
References: <mailman.25.1231326005.26300.r-devel@r-project.org>
Message-ID: <20090107151218.GA17759@stat.umn.edu>

> Date: Tue, 6 Jan 2009 15:00:19 +0000 (GMT)
> From: Prof Brian Ripley <ripley at stats.ox.ac.uk>
> Subject: Re: [Rd] Apparant bug in binomial model in GLM (PR#13434)
> To: soren.faurby at biology.au.dk
> Cc: R-bugs at r-project.org, r-devel at stat.math.ethz.ch
> Message-ID: <alpine.LFD.2.00.0901061444380.9877 at auk.stats.ox.ac.uk>
> Content-Type: text/plain; charset="iso-8859-1"; Format="flowed"
> 
> This is a (too-little) known phenomenon: the problem is the low power of 
> the Wald test in certain circumstances, and not the R implementation.
> 
> You can look it up in MASS (the book)  pp.197-9.

Good reference, but a much better reference tells what WORKS in this
situation not what doesn't work.

    http://www.stat.umn.edu/geyer/gdor/

has a paper and technical report that give methods detecting when the MLE
for a GLM does not exist in the conventional sense and for constructing
valid hypothesis tests and confidence intervals.  The methods are implemented
using the R contributed package rcdd and detailed examples are shown in
the technical report, which is made with Sweave, hence fully reproducible
by anyone who has R.

BTW the particular example given doesn't make clear WHAT question cannot
be answered correctly.  Some questions can be without fuss, for example

> y <- c(0,0,0,0,0,1,1,1,1,1)
> x <- seq(along = y)
> out1 <- glm(y ~ x, family = binomial)
Warning messages:
1: In glm.fit(x = X, y = Y, weights = weights, start = start, etastart = etastart,  :
  algorithm did not converge
2: In glm.fit(x = X, y = Y, weights = weights, start = start, etastart = etastart,  :
  fitted probabilities numerically 0 or 1 occurred
> out0 <- glm(y ~ 1, family = binomial)
> anova(out0, out1, test = "Chisq")
Analysis of Deviance Table

Model 1: y ~ 1
Model 2: y ~ x
  Resid. Df Resid. Dev Df Deviance P(>|Chi|)
1         9    13.8629
2         8  7.865e-10  1  13.8629    0.0002

This P-value (P = 0.0002) is valid, because the MLE does exist for the null
hypothesis.  Hence we see that we have to use the model y ~ x for which
the MLE does not exist in the conventional sense.

To obtain valid one-sided confidence intervals for the linear predictor or
mean value parameters, follow the methods in the technical report.

> Can I ask how you 'knew for certain' what this should do? From the FAQ:
> 
>    But be sure you know for certain what it ought to have done. If you
>    aren't familiar with the command, or don't know for certain how the
>    command is supposed to work, then it might actually be working right.
>    For example, people sometimes think there is a bug in R's mathematics
>    because they don't understand how finite-precision arithmetic works.
>    Rather than jumping to conclusions, show the problem to someone who
>    knows for certain.
> 
> Who was your authority here?
> 
> 
> On Tue, 6 Jan 2009, soren.faurby at biology.au.dk wrote:
> 
> > Full_Name: S?ren Faurby
> > Version: 2.4.1 and 2.7.2
> 
> Neither of which is current.
> 
> > OS:
> > Submission from: (NULL) (192.38.46.92)
> >
> >
> > There appear to be a bug in the estimation of significance in the 
> > binomial model in GLM. This bug apparently appears when the correlation 
> > between two variables is to strong.
> >
> > Such as this dummy example
> > c(0,0,0,0,0,1,1,1,1,1)->a
> > a->b
> > m1<-glm(a~b, binomial)
> > summary(m1)
> >
> > It is sufficient that all 1's correspond to 1's such as this example
> >
> > c(0,0,0,0,0,1,1,1,1,1)->a
> > c(0,0,0,0,1,1,1,1,1,1)->c
> > m1<-glm(a~c, binomial)
> > summary(m1)
> >
> > I hope that this message is understandable.
> >
> > Kind regards, S?ren
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 
> ------------------------------
> 
> Message: 6
> Date: Tue, 06 Jan 2009 16:08:21 +0100
> From: Peter Dalgaard <P.Dalgaard at biostat.ku.dk>
> Subject: Re: [Rd] Apparant bug in binomial model in GLM (PR#13434)
> To: soren.faurby at biology.au.dk
> Cc: R-bugs at r-project.org, r-devel at stat.math.ethz.ch
> Message-ID: <496373E5.9000901 at biostat.ku.dk>
> Content-Type: text/plain; charset=UTF-8
> 
> soren.faurby at biology.au.dk wrote:
> > Full_Name: S?ren Faurby
> > Version: 2.4.1 and 2.7.2
> > OS: 
> > Submission from: (NULL) (192.38.46.92)
> > 
> > 
> > There appear to be a bug in the estimation of significance in the binomial model
> > in GLM. This bug apparently appears when the correlation between two variables
> > is to strong.
> > 
> > Such as this dummy example
> > c(0,0,0,0,0,1,1,1,1,1)->a
> > a->b
> > m1<-glm(a~b, binomial)
> > summary(m1)
> > 
> > It is sufficient that all 1's correspond to 1's such as this example
> > 
> > c(0,0,0,0,0,1,1,1,1,1)->a
> > c(0,0,0,0,1,1,1,1,1,1)->c
> > m1<-glm(a~c, binomial)
> > summary(m1)
> 
> That's not a bug, just the way things work. When the algorithm diverges,
>  as seen by the huge Std.Error, Wald tests (z) are unreliable. (Notice
> that the log OR in an a vs. c table is infinite whichever way you turn
> it.) The likelihood ratio test (as in drop1(m1, test="Chisq")) is
> somewhat less unreliable, but in these small examples, still quite some
> distance from the table based approaches of fisher.test(a,c) and
> chisq.test(a,c).
> 
> 
> > 
> > I hope that this message is understandable. 
> > 
> > Kind regards, S?ren
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 
> -- 
>    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
>  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907

-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From P.Dalgaard at biostat.ku.dk  Wed Jan  7 16:48:03 2009
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 07 Jan 2009 16:48:03 +0100
Subject: [Rd] Apparant bug in binomial model in GLM (PR#13434)
In-Reply-To: <20090107151218.GA17759@stat.umn.edu>
References: <mailman.25.1231326005.26300.r-devel@r-project.org>
	<20090107151218.GA17759@stat.umn.edu>
Message-ID: <4964CEB3.5070808@biostat.ku.dk>

Charles Geyer wrote:
...
> BTW the particular example given doesn't make clear WHAT question cannot
> be answered correctly.  Some questions can be without fuss, for example
> 
>> y <- c(0,0,0,0,0,1,1,1,1,1)
>> x <- seq(along = y)
>> out1 <- glm(y ~ x, family = binomial)
> Warning messages:
> 1: In glm.fit(x = X, y = Y, weights = weights, start = start, etastart = etastart,  :
>   algorithm did not converge
> 2: In glm.fit(x = X, y = Y, weights = weights, start = start, etastart = etastart,  :
>   fitted probabilities numerically 0 or 1 occurred
>> out0 <- glm(y ~ 1, family = binomial)
>> anova(out0, out1, test = "Chisq")
> Analysis of Deviance Table
> 
> Model 1: y ~ 1
> Model 2: y ~ x
>   Resid. Df Resid. Dev Df Deviance P(>|Chi|)
> 1         9    13.8629
> 2         8  7.865e-10  1  13.8629    0.0002
> 
> This P-value (P = 0.0002) is valid, because the MLE does exist for the null
> hypothesis.  Hence we see that we have to use the model y ~ x for which
> the MLE does not exist in the conventional sense.


It may be  valid in some senses, but I can't help notice that it is off
by a factor of at least 10, since the experiment has only 1024 outcomes,
two of which are as extreme as the one observed, and where all outcomes
are equally likely under the corresponding y~1 model.

-p


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From amy.mikhail at googlemail.com  Wed Jan  7 16:23:58 2009
From: amy.mikhail at googlemail.com (Amy Mikhail)
Date: Wed, 7 Jan 2009 15:23:58 +0000
Subject: [Rd] Function to recognise convert dates between gregorian and
	other calendars (e.g. Persian)?
Message-ID: <84d389790901070723g2de99cc9ub6cb17aae3b4c58e@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090107/8469598c/attachment.pl>

From charlie at stat.umn.edu  Wed Jan  7 17:40:45 2009
From: charlie at stat.umn.edu (Charles Geyer)
Date: Wed, 7 Jan 2009 10:40:45 -0600
Subject: [Rd] Apparant bug in binomial model in GLM (PR#13434)
In-Reply-To: <4964CEB3.5070808@biostat.ku.dk>
References: <mailman.25.1231326005.26300.r-devel@r-project.org>
	<20090107151218.GA17759@stat.umn.edu>
	<4964CEB3.5070808@biostat.ku.dk>
Message-ID: <20090107164045.GA18790@stat.umn.edu>

On Wed, Jan 07, 2009 at 04:48:03PM +0100, Peter Dalgaard wrote:
> Charles Geyer wrote:
> ...
> > BTW the particular example given doesn't make clear WHAT question cannot
> > be answered correctly.  Some questions can be without fuss, for example
> > 
> >> y <- c(0,0,0,0,0,1,1,1,1,1)
> >> x <- seq(along = y)
> >> out1 <- glm(y ~ x, family = binomial)
> > Warning messages:
> > 1: In glm.fit(x = X, y = Y, weights = weights, start = start, etastart = etastart,  :
> >   algorithm did not converge
> > 2: In glm.fit(x = X, y = Y, weights = weights, start = start, etastart = etastart,  :
> >   fitted probabilities numerically 0 or 1 occurred
> >> out0 <- glm(y ~ 1, family = binomial)
> >> anova(out0, out1, test = "Chisq")
> > Analysis of Deviance Table
> > 
> > Model 1: y ~ 1
> > Model 2: y ~ x
> >   Resid. Df Resid. Dev Df Deviance P(>|Chi|)
> > 1         9    13.8629
> > 2         8  7.865e-10  1  13.8629    0.0002
> > 
> > This P-value (P = 0.0002) is valid, because the MLE does exist for the null
> > hypothesis.  Hence we see that we have to use the model y ~ x for which
> > the MLE does not exist in the conventional sense.
> 
> 
> It may be  valid in some senses, but I can't help notice that it is off
> by a factor of at least 10, since the experiment has only 1024 outcomes,
> two of which are as extreme as the one observed, and where all outcomes
> are equally likely under the corresponding y~1 model.

It's valid in the sense that all of the P-values R produces for GLM are valid.
It's an asymptotic approximation.  As with all asymptotic approximations,
at best only the absolute error is small, not the relative error.  This
is no worse than any other P-value produced by anova.glm.  And the conclusion
that P < 0.05 or P < 0.01 is correct.

You already know all this, so why the e-mail?

Worst case, a P-value produced by anova.glm can be very questionable when
"n" is too small.  With n = 10 here, it's amazing that it does as well as it
does.  That's because the MLE in the null hypothesis says all of the
response variables have the symmetric binomial distribution, and the CLT does
work, more or less, down to n = 10 for the symmetric binomial distribution.

If you don't trust the asymptotics, then do a parametric bootstrap.  That's
trivial in R.

My point wasn't about the validity of asymptotics.  My point was that either
the asymptotic test done by anova.glm or the parametric bootstrap makes sense
only when the MLE exists for the null hypothesis.  Otherwise one has to follow
the procedures in my tech report.

-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From r.ted.byers at gmail.com  Wed Jan  7 18:20:43 2009
From: r.ted.byers at gmail.com (Ted Byers)
Date: Wed, 7 Jan 2009 12:20:43 -0500
Subject: [Rd] Function to recognise convert dates between gregorian and
	other calendars (e.g. Persian)?
In-Reply-To: <84d389790901070723g2de99cc9ub6cb17aae3b4c58e@mail.gmail.com>
References: <84d389790901070723g2de99cc9ub6cb17aae3b4c58e@mail.gmail.com>
Message-ID: <4f1819890901070920g55928f54q7287452372ecbd17@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090107/bfcf3411/attachment.pl>

From armstrong.whit at gmail.com  Wed Jan  7 18:47:59 2009
From: armstrong.whit at gmail.com (Whit Armstrong)
Date: Wed, 7 Jan 2009 12:47:59 -0500
Subject: [Rd] Function to recognise convert dates between gregorian and
	other calendars (e.g. Persian)?
In-Reply-To: <4f1819890901070920g55928f54q7287452372ecbd17@mail.gmail.com>
References: <84d389790901070723g2de99cc9ub6cb17aae3b4c58e@mail.gmail.com>
	<4f1819890901070920g55928f54q7287452372ecbd17@mail.gmail.com>
Message-ID: <8ec76080901070947vccbc773l41c4ce1d0ae9ea6f@mail.gmail.com>

probably easy to do w/ Boost DateTime

http://www.boost.org/doc/libs/1_37_0/doc/html/date_time.html

for which there is already an R package in development:
http://repo.or.cz/w/RBoostDateTime.git

I'm happy to write a small wrapper to do what you want if you can
offer a pseudocode example of the conversion function.

-Whit


On Wed, Jan 7, 2009 at 12:20 PM, Ted Byers <r.ted.byers at gmail.com> wrote:
> On Wed, Jan 7, 2009 at 10:23 AM, Amy Mikhail <amy.mikhail at googlemail.com>wrote:
>
>> Dear list,
>>
>> I will shortly have some data that contains numeric dates in the Persian /
>> Jalali calendar format, which I would like to convert to gregorian.  At the
>> moment there doesn't seem to be a function for this in R, but it would be
>> great if someone could come up with same - I would attempt it but the
>> algorithm is very complex and this is also way beyond my fairly rudimentary
>> knowledge of R.
>>
>> How do you feel about mixed language programming?
>
> I don't know anything about Jalali dates, but I took the time to check and
> found that Perl has modules that handle this (use CPAN or, on windows, PPM
> to find them).  However, like the C code you found, it will convert values a
> date at a time.  I don't know why this would be an issue.
>
> I have never tried to use either C or perl from within R, but if you can
> handle that, it would be trivial to apply these function calls to each value
> in a vector (or array if you prefer) in functions written in either C/C++ or
> perl.  In both C++ using STL and Perl, that would require only one line of
> code, and perhaps a couple more in C to manage the required loop if you
> restrict yourself to C, ignoring the benefits of C++.
>
> If I were doing this, I'd do it even before storing the data in my database,
> or at least before importing it into a dataframe in R, but that is primarily
> because I am still learning R, having used it for only a few months, rather
> than a few years using perl and 15+ years using C++.  I am so early on my R
> learning curve that I haven't yet looked at writing code in C++ or Perl that
> is to be called by R.  While I haven't read through it in enough detail to
> play seriously with it, the method for using such code from with R described
> in "Writing R Extensions<file:///C:/Program%20Files/R/R-2.8.0/doc/manual/R-exts.html>"
> seems simple enough.  Instead of writing the code to implement your
> 'complex' algorithm, why not just use the code you've found, or that
> available in CPAN (I don't know about you, but I hate reinventing the
> wheel), and create the trivial extension needed following the instructions
> in "Writing R Extensions<file:///C:/Program%20Files/R/R-2.8.0/doc/manual/R-exts.html>",
> or do it to the raw data before you import it into R?
>
> HTH
>
> Ted
>
>        [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From oliver at first.in-berlin.de  Wed Jan  7 20:50:13 2009
From: oliver at first.in-berlin.de (oliver at first.in-berlin.de)
Date: Wed,  7 Jan 2009 20:50:13 +0100 (CET)
Subject: [Rd] Parse-Error creates strange function calls (completely
	different printouts) (PR#13436)
Message-ID: <20090107195013.70AFE282EFC1@mail.pubhealth.ku.dk>

Full_Name: Oliver Bandel
Version: R version 2.7.1 (2008-06-23)
OS: Linux (Debian Lenny)
Submission from: (NULL) (88.73.82.147)


Hello,

I have written a small R-script.
When I inserted one line of code, the behaviour was completely different!

Instead of just printing one line more to the output,
the complete call of the function in which this line was added,
is different, and instead of one such call, the function seems to be
called more than once!

I just added a line, which prints some data,
but then the printouts were completely different than
expected; and when commenting the new stuff out,
the OK-behaviour came back.


Here a diff of the code:

=====================================
oliver at siouxsie:~/R-BUG$ diff ok.R buggy.R 
64c64
<   res.txt <- paste(# "\n\n Anzahl der Messungen:", sample_times, "\n",
---
>   res.txt <- paste("\n\n Anzahl der Messungen:", sample_times, "\n",
oliver at siouxsie:~/R-BUG$ 
======================================

You see, I only wanted to print out a variable.


But the output is much bigger now:

**************************************
oliver at siouxsie:~/R-BUG$ wc -l LOG.*
 125 LOG.buggy
  50 LOG.ok
 175 insgesamt
oliver at siouxsie:~/R-BUG$ 
**************************************


The variable sample_times is just an array with some numbers:
######################################
> ls()
 [1] "anemo.freq"          "anemo.impulse_times" "anemo.T"            
 [4] "impulse_num"         "impuls.messreihe"    "make_one_sample_set"
 [7] "sample.dauer"        "sample.freq"         "sample_num"         
[10] "sample.T"            "sample_times"       
> sample_times
 [1] 0 1 2 3 4 5 6 7 8 9
> mode(sample_times)
[1] "numeric"
> class(sample_times)
[1] "numeric"
> 
######################################


So, the change in the code could not bring such a strange result!

I could provide the original code for you,
if you need it for testing.
Please send me email, if you need it.

Best,
   Oliver Bandel


From amy.mikhail at googlemail.com  Wed Jan  7 19:22:56 2009
From: amy.mikhail at googlemail.com (Amy Mikhail)
Date: Wed, 7 Jan 2009 18:22:56 +0000
Subject: [Rd] Function to recognise convert dates between gregorian and
	other calendars (e.g. Persian)?
In-Reply-To: <84d389790901071021r4e4bd3fcw5f8827fd1b1375d7@mail.gmail.com>
References: <84d389790901070723g2de99cc9ub6cb17aae3b4c58e@mail.gmail.com>
	<4f1819890901070920g55928f54q7287452372ecbd17@mail.gmail.com>
	<84d389790901071021r4e4bd3fcw5f8827fd1b1375d7@mail.gmail.com>
Message-ID: <84d389790901071022s434ad348q6e5be96b44799d5a@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090107/02599faa/attachment.pl>

From amy.mikhail at googlemail.com  Wed Jan  7 20:05:32 2009
From: amy.mikhail at googlemail.com (Amy Mikhail)
Date: Wed, 7 Jan 2009 19:05:32 +0000
Subject: [Rd] Function to recognise convert dates between gregorian and
	other calendars (e.g. Persian)?
In-Reply-To: <8ec76080901070947vccbc773l41c4ce1d0ae9ea6f@mail.gmail.com>
References: <84d389790901070723g2de99cc9ub6cb17aae3b4c58e@mail.gmail.com>
	<4f1819890901070920g55928f54q7287452372ecbd17@mail.gmail.com>
	<8ec76080901070947vccbc773l41c4ce1d0ae9ea6f@mail.gmail.com>
Message-ID: <84d389790901071105t432ec112l8dcc32d16a1b63a9@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090107/059df7ff/attachment.pl>

From thomas.baier at logicals.com  Thu Jan  8 10:16:49 2009
From: thomas.baier at logicals.com (Thomas Baier)
Date: Thu, 8 Jan 2009 10:16:49 +0100 
Subject: [Rd] rscproxy version conflict
Message-ID: <405593F1A35DDD11B2B4000C29F5CF53034658@exchange-server.ow.ks>

Simon,

first, I'd like to apologize, that my previous message has been sent to you
directly. I have not checked the receivers list when clicking reply in my
E-mail program.

Simon Urbanek wrote:
> On Jan 7, 2009, at 2:05 , Thomas Baier wrote:
> 
>> Simon,
>> 
>> Simon Urbanek wrote:
>>>> And if 2.8.0 and 2.8.1 are fully compatible, why is a warning
>>>> issued, if a package built with R 2.8.1 is loaded in R 2.8.0?
>>>> 
>>> 
>>> It's ok to use a package built for 2.8.0 in 2.8.1 but not vice
>>> versa. It is rare, but it has happened before that a bugfix or
>>> visibility change adds a symbol in x.y.1 that was not there in
>>> x.y.0. Then if your package checks for that particular feature and
>>> uses it you cannot use that binary with x.y.0. Again, this is
>>> rather rare and you as the 
>> 
>> so this was exactly what has occured. Users having installed R 2.8.0
>> (as 
>> 2.8.1 has not been released then) and installing a package from CRAN
>> which has been built for 2.8.1.
>> 
>> 
>>> package author know about it, but to be on the safe side I was
>>> recommending against that. However, as Brian pointed out this
>>> happens far more often on the R function level than on the C API
>>> level. 
>>> 
>>> (I know about this DLL version check because it was the first
>>> change I
>>> made to JRI since I wasn't willing to release Windows binary some
>>> five times a year ;)).
>> 
>> As far as I have understood Brian's message, one should just parse
>> for the second '.' in the version string and omit everything
>> afterwards for comparison. 
>> 
>> What I would really like to have is some new API function to check
>> compatibility. If this was there both on R user level (for R language
>> constructs and functions) and on C level (for packages/applications
>> relying on the C API), then this would be a fine solution for
>> compatiblity without issuing any warnings about wrong versions.
>> 
> 
> Semantically that's not really possible since the result would always
> be FALSE. The point is that if you use something that has been fixed
> or added, you may run into issues since the behavior changed. R cannot
> know whether that affects you package or not. Therefore it's safer to
> declare patch-level releases compatible (they don't "break" existing
> binaries) and everything else incompatible (as Brian was suggesting).
> However, my point was that *you* can decide to exploit changes in
> patch-level updates if you desire so (a practical example here is
> R_SignalHandlers which was introduced (exposed) in 2.3.1 and thus a
> patch-level), but in that case it is your decision not some R
> incompatibility. I hope this makes clear what I was describing
> earlier. In general forward binary compatibility between patch-level
> versions is guaranteed and backward if you don't use features added
> later on.

That's true for fixes, which will break compatibity (but are required as
well).

If I had used R_SignalHandlers in a package, then I would have had to
restrict the package to be compatible with R >= 2.3.1, not with versions
before. This should be something in the DESCRIPTION file. The only thing
(but code-breaking fixes) I can imagine is a compile-time check in the
package, so it behaves differently for < 2.3.1 and >= 2.3.1.

Best,
Thomas


From sgiannerini at gmail.com  Thu Jan  8 11:31:07 2009
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Thu, 8 Jan 2009 11:31:07 +0100
Subject: [Rd] legend() in a multiple figure environment
Message-ID: <3c12769c0901080231l28c5442fu2c1a23d0228c71ce@mail.gmail.com>

Dear all,

there seems to be a problem with displayed legends when a multiple
figure environment is used, see the following example:

par(mfrow=c(1,2))
curve(dnorm,col=4,from=-4,to=4);
legend(-4,0.3,legend="curve",lty=1,col=4)
legend(-4,0.2,legend="curve",lty=1,col=4)


On my machines the first time the command legend() is issued the
legend box stretches over the curve. Subsequent calls to legend seems
to produce a correct box instead.

openSuse 11.0

platform       x86_64-unknown-linux-gnu
arch           x86_64
os             linux-gnu
system         x86_64, linux-gnu
status         Patched
major          2
minor          8.1
year           2009
month          01
day            07
svn rev        47501
language       R
version.string R version 2.8.1 Patched (2009-01-07 r47501)

I see this on the same version of R on Windows VISTA 32 bit as well; I
do not see this behaviour on a machine with R 2.8.0.

Thank you,

Simone
--
______________________________________________________

Simone Giannerini
Dipartimento di Scienze Statistiche "Paolo Fortunati"
Universita' di Bologna
Via delle belle arti 41 - 40126  Bologna,  ITALY
Tel: +39 051 2098262  Fax: +39 051 232153
http://www2.stat.unibo.it/giannerini/


From mathieu.ribatet at epfl.ch  Thu Jan  8 12:14:53 2009
From: mathieu.ribatet at epfl.ch (Mathieu Ribatet)
Date: Thu, 08 Jan 2009 12:14:53 +0100
Subject: [Rd] legend() in a multiple figure environment
In-Reply-To: <3c12769c0901080231l28c5442fu2c1a23d0228c71ce@mail.gmail.com>
References: <3c12769c0901080231l28c5442fu2c1a23d0228c71ce@mail.gmail.com>
Message-ID: <4965E02D.7030000@epfl.ch>

Dear Simone,

Did mean that the legend (text and/or box) overlap with the Normal 
density? If so then I think there's no problem as the legend is placed 
where you told R to do. And R won't check (for you) if it will overlap 
or not with pre-existing graphical elements.

On my computer, I got the expected results - if I understood correctly 
your issue though. For information:

    R version 2.8.1 (2008-12-22)
    Linux mathieu-laptop 2.6.27-11-generic #1 SMP Fri Dec 19 16:29:52
    UTC 2008 i686 GNU/Linux (Ubuntu Intrepid)

Cheers,
Mathieu

Simone Giannerini a ?crit :
> Dear all,
>
> there seems to be a problem with displayed legends when a multiple
> figure environment is used, see the following example:
>
> par(mfrow=c(1,2))
> curve(dnorm,col=4,from=-4,to=4);
> legend(-4,0.3,legend="curve",lty=1,col=4)
> legend(-4,0.2,legend="curve",lty=1,col=4)
>
>
> On my machines the first time the command legend() is issued the
> legend box stretches over the curve. Subsequent calls to legend seems
> to produce a correct box instead.
>
> openSuse 11.0
>
> platform       x86_64-unknown-linux-gnu
> arch           x86_64
> os             linux-gnu
> system         x86_64, linux-gnu
> status         Patched
> major          2
> minor          8.1
> year           2009
> month          01
> day            07
> svn rev        47501
> language       R
> version.string R version 2.8.1 Patched (2009-01-07 r47501)
>
> I see this on the same version of R on Windows VISTA 32 bit as well; I
> do not see this behaviour on a machine with R 2.8.0.
>
> Thank you,
>
> Simone
> --
> ______________________________________________________
>
> Simone Giannerini
> Dipartimento di Scienze Statistiche "Paolo Fortunati"
> Universita' di Bologna
> Via delle belle arti 41 - 40126  Bologna,  ITALY
> Tel: +39 051 2098262  Fax: +39 051 232153
> http://www2.stat.unibo.it/giannerini/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   

-- 
Institute of Mathematics
Ecole Polytechnique F?d?rale de Lausanne
STAT-IMA-FSB-EPFL, Station 8
CH-1015 Lausanne   Switzerland
http://stat.epfl.ch/
Tel: + 41 (0)21 693 7907


From murdoch at stats.uwo.ca  Thu Jan  8 12:22:19 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 08 Jan 2009 06:22:19 -0500
Subject: [Rd] Parse-Error creates strange function calls
 (completely	different printouts) (PR#13436)
In-Reply-To: <20090107195013.70AFE282EFC1@mail.pubhealth.ku.dk>
References: <20090107195013.70AFE282EFC1@mail.pubhealth.ku.dk>
Message-ID: <4965E1EB.2040600@stats.uwo.ca>

This is not a bug.  Read ?paste:  if you give it a vector, it will give 
you a vector result.  That's what you're seeing.

Duncan Murdoch

oliver at first.in-berlin.de wrote:
> Full_Name: Oliver Bandel
> Version: R version 2.7.1 (2008-06-23)
> OS: Linux (Debian Lenny)
> Submission from: (NULL) (88.73.82.147)
>
>
> Hello,
>
> I have written a small R-script.
> When I inserted one line of code, the behaviour was completely different!
>
> Instead of just printing one line more to the output,
> the complete call of the function in which this line was added,
> is different, and instead of one such call, the function seems to be
> called more than once!
>
> I just added a line, which prints some data,
> but then the printouts were completely different than
> expected; and when commenting the new stuff out,
> the OK-behaviour came back.
>
>
> Here a diff of the code:
>
> =====================================
> oliver at siouxsie:~/R-BUG$ diff ok.R buggy.R 
> 64c64
> <   res.txt <- paste(# "\n\n Anzahl der Messungen:", sample_times, "\n",
> ---
>   
>>   res.txt <- paste("\n\n Anzahl der Messungen:", sample_times, "\n",
>>     
> oliver at siouxsie:~/R-BUG$ 
> ======================================
>
> You see, I only wanted to print out a variable.
>
>
> But the output is much bigger now:
>
> **************************************
> oliver at siouxsie:~/R-BUG$ wc -l LOG.*
>  125 LOG.buggy
>   50 LOG.ok
>  175 insgesamt
> oliver at siouxsie:~/R-BUG$ 
> **************************************
>
>
> The variable sample_times is just an array with some numbers:
> ######################################
>   
>> ls()
>>     
>  [1] "anemo.freq"          "anemo.impulse_times" "anemo.T"            
>  [4] "impulse_num"         "impuls.messreihe"    "make_one_sample_set"
>  [7] "sample.dauer"        "sample.freq"         "sample_num"         
> [10] "sample.T"            "sample_times"       
>   
>> sample_times
>>     
>  [1] 0 1 2 3 4 5 6 7 8 9
>   
>> mode(sample_times)
>>     
> [1] "numeric"
>   
>> class(sample_times)
>>     
> [1] "numeric"
>   
> ######################################
>
>
> So, the change in the code could not bring such a strange result!
>
> I could provide the original code for you,
> if you need it for testing.
> Please send me email, if you need it.
>
> Best,
>    Oliver Bandel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From murdoch at stats.uwo.ca  Thu Jan  8 12:25:24 2009
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Thu,  8 Jan 2009 12:25:24 +0100 (CET)
Subject: [Rd] Parse-Error creates strange function calls
	(completely	different (PR#13438)
Message-ID: <20090108112525.468212834337@mail.pubhealth.ku.dk>

This is not a bug.  Read ?paste:  if you give it a vector, it will give 
you a vector result.  That's what you're seeing.

Duncan Murdoch

oliver at first.in-berlin.de wrote:
> Full_Name: Oliver Bandel
> Version: R version 2.7.1 (2008-06-23)
> OS: Linux (Debian Lenny)
> Submission from: (NULL) (88.73.82.147)
>
>
> Hello,
>
> I have written a small R-script.
> When I inserted one line of code, the behaviour was completely different!
>
> Instead of just printing one line more to the output,
> the complete call of the function in which this line was added,
> is different, and instead of one such call, the function seems to be
> called more than once!
>
> I just added a line, which prints some data,
> but then the printouts were completely different than
> expected; and when commenting the new stuff out,
> the OK-behaviour came back.
>
>
> Here a diff of the code:
>
> =====================================
> oliver at siouxsie:~/R-BUG$ diff ok.R buggy.R 
> 64c64
> <   res.txt <- paste(# "\n\n Anzahl der Messungen:", sample_times, "\n",
> ---
>   
>>   res.txt <- paste("\n\n Anzahl der Messungen:", sample_times, "\n",
>>     
> oliver at siouxsie:~/R-BUG$ 
> ======================================
>
> You see, I only wanted to print out a variable.
>
>
> But the output is much bigger now:
>
> **************************************
> oliver at siouxsie:~/R-BUG$ wc -l LOG.*
>  125 LOG.buggy
>   50 LOG.ok
>  175 insgesamt
> oliver at siouxsie:~/R-BUG$ 
> **************************************
>
>
> The variable sample_times is just an array with some numbers:
> ######################################
>   
>> ls()
>>     
>  [1] "anemo.freq"          "anemo.impulse_times" "anemo.T"            
>  [4] "impulse_num"         "impuls.messreihe"    "make_one_sample_set"
>  [7] "sample.dauer"        "sample.freq"         "sample_num"         
> [10] "sample.T"            "sample_times"       
>   
>> sample_times
>>     
>  [1] 0 1 2 3 4 5 6 7 8 9
>   
>> mode(sample_times)
>>     
> [1] "numeric"
>   
>> class(sample_times)
>>     
> [1] "numeric"
>   
> ######################################
>
>
> So, the change in the code could not bring such a strange result!
>
> I could provide the original code for you,
> if you need it for testing.
> Please send me email, if you need it.
>
> Best,
>    Oliver Bandel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From anand.prabhakar.patil at gmail.com  Thu Jan  8 13:53:03 2009
From: anand.prabhakar.patil at gmail.com (Anand Patil)
Date: Thu, 8 Jan 2009 12:53:03 +0000
Subject: [Rd] NY Times article
Message-ID: <2bc7a5a50901080453i3c0784b2h80beee37a394c4c@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090108/3929f8a2/attachment.pl>

From ripley at stats.ox.ac.uk  Thu Jan  8 14:02:55 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 8 Jan 2009 13:02:55 +0000 (GMT)
Subject: [Rd] NY Times article
In-Reply-To: <2bc7a5a50901080453i3c0784b2h80beee37a394c4c@mail.gmail.com>
References: <2bc7a5a50901080453i3c0784b2h80beee37a394c4c@mail.gmail.com>
Message-ID: <alpine.LFD.2.00.0901081258470.5529@auk.stats.ox.ac.uk>

It has been all over R-help, in several threads.

https://stat.ethz.ch/pipermail/r-help/2009-January/184119.html
https://stat.ethz.ch/pipermail/r-help/2009-January/184170.html
https://stat.ethz.ch/pipermail/r-help/2009-January/184209.html
https://stat.ethz.ch/pipermail/r-help/2009-January/184232.html
https://stat.ethz.ch/pipermail/r-help/2009-January/184237.html

and more

On Thu, 8 Jan 2009, Anand Patil wrote:

> Sorry if this is spam, but I couldn't see it having popped up on the list
> yet.
> http://www.nytimes.com/2009/01/07/technology/business-computing/07program.html?emc=eta1
>
> Anand
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sgiannerini at gmail.com  Thu Jan  8 14:08:17 2009
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Thu, 8 Jan 2009 14:08:17 +0100
Subject: [Rd] legend() in a multiple figure environment
In-Reply-To: <4965E02D.7030000@epfl.ch>
References: <3c12769c0901080231l28c5442fu2c1a23d0228c71ce@mail.gmail.com>
	<4965E02D.7030000@epfl.ch>
Message-ID: <3c12769c0901080508h7afea9cawbd787cb8722b6ef6@mail.gmail.com>

Dear Mathieu,

On Thu, Jan 8, 2009 at 12:14 PM, Mathieu Ribatet
<mathieu.ribatet at epfl.ch> wrote:
> Dear Simone,
>
> Did mean that the legend (text and/or box) overlap with the Normal density?

no, I mean that the two legend() commands, which are identical in all
but the y-coordinates, produce different results, namely boxes with
different widths.

Ciao

Simone

> If so then I think there's no problem as the legend is placed where you told
> R to do. And R won't check (for you) if it will overlap or not with
> pre-existing graphical elements.
>
> On my computer, I got the expected results - if I understood correctly your
> issue though. For information:
>
>   R version 2.8.1 (2008-12-22)
>   Linux mathieu-laptop 2.6.27-11-generic #1 SMP Fri Dec 19 16:29:52
>   UTC 2008 i686 GNU/Linux (Ubuntu Intrepid)
>
> Cheers,
> Mathieu
>
> Simone Giannerini a ?crit :
>>
>> Dear all,
>>
>> there seems to be a problem with displayed legends when a multiple
>> figure environment is used, see the following example:
>>
>> par(mfrow=c(1,2))
>> curve(dnorm,col=4,from=-4,to=4);
>> legend(-4,0.3,legend="curve",lty=1,col=4)
>> legend(-4,0.2,legend="curve",lty=1,col=4)
>>
>>
>> On my machines the first time the command legend() is issued the
>> legend box stretches over the curve. Subsequent calls to legend seems
>> to produce a correct box instead.
>>
>> openSuse 11.0
>>
>> platform       x86_64-unknown-linux-gnu
>> arch           x86_64
>> os             linux-gnu
>> system         x86_64, linux-gnu
>> status         Patched
>> major          2
>> minor          8.1
>> year           2009
>> month          01
>> day            07
>> svn rev        47501
>> language       R
>> version.string R version 2.8.1 Patched (2009-01-07 r47501)
>>
>> I see this on the same version of R on Windows VISTA 32 bit as well; I
>> do not see this behaviour on a machine with R 2.8.0.
>>
>> Thank you,
>>
>> Simone
>> --
>> ______________________________________________________
>>
>> Simone Giannerini
>> Dipartimento di Scienze Statistiche "Paolo Fortunati"
>> Universita' di Bologna
>> Via delle belle arti 41 - 40126  Bologna,  ITALY
>> Tel: +39 051 2098262  Fax: +39 051 232153
>> http://www2.stat.unibo.it/giannerini/
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> --
> Institute of Mathematics
> Ecole Polytechnique F?d?rale de Lausanne
> STAT-IMA-FSB-EPFL, Station 8
> CH-1015 Lausanne   Switzerland
> http://stat.epfl.ch/
> Tel: + 41 (0)21 693 7907
>
>
>



-- 
______________________________________________________

Simone Giannerini
Dipartimento di Scienze Statistiche "Paolo Fortunati"
Universita' di Bologna
Via delle belle arti 41 - 40126  Bologna,  ITALY
Tel: +39 051 2098262  Fax: +39 051 232153
http://www2.stat.unibo.it/giannerini/


From maechler at stat.math.ethz.ch  Thu Jan  8 14:39:54 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 8 Jan 2009 14:39:54 +0100
Subject: [Rd] legend() in a multiple figure environment
In-Reply-To: <3c12769c0901080508h7afea9cawbd787cb8722b6ef6@mail.gmail.com>
References: <3c12769c0901080231l28c5442fu2c1a23d0228c71ce@mail.gmail.com>
	<4965E02D.7030000@epfl.ch>
	<3c12769c0901080508h7afea9cawbd787cb8722b6ef6@mail.gmail.com>
Message-ID: <18790.554.354696.731117@stat.math.ethz.ch>

>>>>> "SG" == Simone Giannerini <sgiannerini at gmail.com>
>>>>>     on Thu, 8 Jan 2009 14:08:17 +0100 writes:

    SG> Dear Mathieu, On Thu, Jan 8, 2009 at 12:14 PM, Mathieu
    SG> Ribatet <mathieu.ribatet at epfl.ch> wrote:
    >> Dear Simone,
    >> 
    >> Did mean that the legend (text and/or box) overlap with
    >> the Normal density?

    SG> no, I mean that the two legend() commands, which are
    SG> identical in all but the y-coordinates, produce
    SG> different results, namely boxes with different widths.

I don't see that behavior at all, rather the two boxes have
identical dimensions for me.

What does  dev.cur() say?  if anything with "X11..." (as you are
on Linux),  what does

 str(X11.options())

give?


    SG> Ciao

    SG> Simone

    >> If so then I think there's no problem as the legend is
    >> placed where you told R to do. And R won't check (for
    >> you) if it will overlap or not with pre-existing
    >> graphical elements.
    >> 
    >> On my computer, I got the expected results - if I
    >> understood correctly your issue though. For information:
    >> 
    >> R version 2.8.1 (2008-12-22) Linux mathieu-laptop
    >> 2.6.27-11-generic #1 SMP Fri Dec 19 16:29:52 UTC 2008
    >> i686 GNU/Linux (Ubuntu Intrepid)
    >> 
    >> Cheers, Mathieu
    >> 
    >> Simone Giannerini a ?crit :
    >>> 
    >>> Dear all,
    >>> 
    >>> there seems to be a problem with displayed legends when
    >>> a multiple figure environment is used, see the following
    >>> example:
    >>> 
    >>> par(mfrow=c(1,2)) curve(dnorm,col=4,from=-4,to=4);
    >>> legend(-4,0.3,legend="curve",lty=1,col=4)
    >>> legend(-4,0.2,legend="curve",lty=1,col=4)
    >>> 
    >>> 
    >>> On my machines the first time the command legend() is
    >>> issued the legend box stretches over the
    >>> curve. Subsequent calls to legend seems to produce a
    >>> correct box instead.
    >>> 
    >>> openSuse 11.0
    >>> 
    >>> platform x86_64-unknown-linux-gnu arch x86_64 os
    >>> linux-gnu system x86_64, linux-gnu status Patched major
    >>> 2 minor 8.1 year 2009 month 01 day 07 svn rev 47501
    >>> language R version.string R version 2.8.1 Patched
    >>> (2009-01-07 r47501)
    >>> 
    >>> I see this on the same version of R on Windows VISTA 32
    >>> bit as well; I do not see this behaviour on a machine
    >>> with R 2.8.0.
    >>> 
    >>> Thank you,
    >>> 
    >>> Simone
    >>> --
    >>> ______________________________________________________
    >>> 
    >>> Simone Giannerini Dipartimento di Scienze Statistiche
    >>> "Paolo Fortunati" Universita' di Bologna Via delle belle
    >>> arti 41 - 40126 Bologna, ITALY Tel: +39 051 2098262 Fax:
    >>> +39 051 232153 http://www2.stat.unibo.it/giannerini/
    >>> 
    >>> ______________________________________________
    >>> R-devel at r-project.org mailing list
    >>> https://stat.ethz.ch/mailman/listinfo/r-devel
    >>> 
    >> 
> --
> Institute of Mathematics Ecole Polytechnique F?d?rale de
    >> Lausanne STAT-IMA-FSB-EPFL, Station 8 CH-1015 Lausanne
    >> Switzerland http://stat.epfl.ch/ Tel: + 41 (0)21 693 7907
    >> 
    >> 
    >> 



-- 
______________________________________________________

    SG> Simone Giannerini Dipartimento di Scienze Statistiche
    SG> "Paolo Fortunati" Universita' di Bologna Via delle belle
    SG> arti 41 - 40126 Bologna, ITALY Tel: +39 051 2098262 Fax:
    SG> +39 051 232153 http://www2.stat.unibo.it/giannerini/

    SG> ______________________________________________
    SG> R-devel at r-project.org mailing list
    SG> https://stat.ethz.ch/mailman/listinfo/r-devel


From sgiannerini at gmail.com  Thu Jan  8 15:06:28 2009
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Thu, 8 Jan 2009 15:06:28 +0100
Subject: [Rd] legend() in a multiple figure environment
In-Reply-To: <18790.554.354696.731117@stat.math.ethz.ch>
References: <3c12769c0901080231l28c5442fu2c1a23d0228c71ce@mail.gmail.com>
	<4965E02D.7030000@epfl.ch>
	<3c12769c0901080508h7afea9cawbd787cb8722b6ef6@mail.gmail.com>
	<18790.554.354696.731117@stat.math.ethz.ch>
Message-ID: <3c12769c0901080606w782416f1s8d6f162d8c0329fc@mail.gmail.com>

On linux, I get

> dev.cur()
null device
          1
>  str(X11.options())
List of 15
 $ display    : chr ""
 $ width      : num NA
 $ height     : num NA
 $ pointsize  : num 12
 $ bg         : chr "transparent"
 $ canvas     : chr "white"
 $ gamma      : num 1
 $ colortype  : chr "true"
 $ maxcubesize: num 256
 $ fonts      : chr [1:2]
"-adobe-helvetica-%s-%s-*-*-%d-*-*-*-*-*-*-*"
"-adobe-symbol-medium-r-*-*-%d-*-*-*-*-*-*-*"
 $ xpos       : int NA
 $ ypos       : int NA
 $ title      : chr ""
 $ type       : chr "cairo"
 $ antialias  : num 1

thanks,

Simone

On Thu, Jan 8, 2009 at 2:39 PM, Martin Maechler
<maechler at stat.math.ethz.ch> wrote:
>>>>>> "SG" == Simone Giannerini <sgiannerini at gmail.com>
>>>>>>     on Thu, 8 Jan 2009 14:08:17 +0100 writes:
>
>    SG> Dear Mathieu, On Thu, Jan 8, 2009 at 12:14 PM, Mathieu
>    SG> Ribatet <mathieu.ribatet at epfl.ch> wrote:
>    >> Dear Simone,
>    >>
>    >> Did mean that the legend (text and/or box) overlap with
>    >> the Normal density?
>
>    SG> no, I mean that the two legend() commands, which are
>    SG> identical in all but the y-coordinates, produce
>    SG> different results, namely boxes with different widths.
>
> I don't see that behavior at all, rather the two boxes have
> identical dimensions for me.
>
> What does  dev.cur() say?  if anything with "X11..." (as you are
> on Linux),  what does
>
>  str(X11.options())
>
> give?
>
>
>    SG> Ciao
>
>    SG> Simone
>
>    >> If so then I think there's no problem as the legend is
>    >> placed where you told R to do. And R won't check (for
>    >> you) if it will overlap or not with pre-existing
>    >> graphical elements.
>    >>
>    >> On my computer, I got the expected results - if I
>    >> understood correctly your issue though. For information:
>    >>
>    >> R version 2.8.1 (2008-12-22) Linux mathieu-laptop
>    >> 2.6.27-11-generic #1 SMP Fri Dec 19 16:29:52 UTC 2008
>    >> i686 GNU/Linux (Ubuntu Intrepid)
>    >>
>    >> Cheers, Mathieu
>    >>
>    >> Simone Giannerini a ?crit :
>    >>>
>    >>> Dear all,
>    >>>
>    >>> there seems to be a problem with displayed legends when
>    >>> a multiple figure environment is used, see the following
>    >>> example:
>    >>>
>    >>> par(mfrow=c(1,2)) curve(dnorm,col=4,from=-4,to=4);
>    >>> legend(-4,0.3,legend="curve",lty=1,col=4)
>    >>> legend(-4,0.2,legend="curve",lty=1,col=4)
>    >>>
>    >>>
>    >>> On my machines the first time the command legend() is
>    >>> issued the legend box stretches over the
>    >>> curve. Subsequent calls to legend seems to produce a
>    >>> correct box instead.
>    >>>
>    >>> openSuse 11.0
>    >>>
>    >>> platform x86_64-unknown-linux-gnu arch x86_64 os
>    >>> linux-gnu system x86_64, linux-gnu status Patched major
>    >>> 2 minor 8.1 year 2009 month 01 day 07 svn rev 47501
>    >>> language R version.string R version 2.8.1 Patched
>    >>> (2009-01-07 r47501)
>    >>>
>    >>> I see this on the same version of R on Windows VISTA 32
>    >>> bit as well; I do not see this behaviour on a machine
>    >>> with R 2.8.0.
>    >>>
>    >>> Thank you,
>    >>>
>    >>> Simone
>    >>> --
>    >>> ______________________________________________________
>    >>>
>    >>> Simone Giannerini Dipartimento di Scienze Statistiche
>    >>> "Paolo Fortunati" Universita' di Bologna Via delle belle
>    >>> arti 41 - 40126 Bologna, ITALY Tel: +39 051 2098262 Fax:
>    >>> +39 051 232153 http://www2.stat.unibo.it/giannerini/
>    >>>
>    >>> ______________________________________________
>    >>> R-devel at r-project.org mailing list
>    >>> https://stat.ethz.ch/mailman/listinfo/r-devel
>    >>>
>    >>
>> --
>> Institute of Mathematics Ecole Polytechnique F?d?rale de
>    >> Lausanne STAT-IMA-FSB-EPFL, Station 8 CH-1015 Lausanne
>    >> Switzerland http://stat.epfl.ch/ Tel: + 41 (0)21 693 7907
>    >>
>    >>
>    >>
>
>
>
> --
> ______________________________________________________
>
>    SG> Simone Giannerini Dipartimento di Scienze Statistiche
>    SG> "Paolo Fortunati" Universita' di Bologna Via delle belle
>    SG> arti 41 - 40126 Bologna, ITALY Tel: +39 051 2098262 Fax:
>    SG> +39 051 232153 http://www2.stat.unibo.it/giannerini/
>
>    SG> ______________________________________________
>    SG> R-devel at r-project.org mailing list
>    SG> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
______________________________________________________

Simone Giannerini
Dipartimento di Scienze Statistiche "Paolo Fortunati"
Universita' di Bologna
Via delle belle arti 41 - 40126  Bologna,  ITALY
Tel: +39 051 2098262  Fax: +39 051 232153
http://www2.stat.unibo.it/giannerini/


From sgiannerini at gmail.com  Thu Jan  8 15:29:52 2009
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Thu, 8 Jan 2009 15:29:52 +0100
Subject: [Rd] legend() in a multiple figure environment
In-Reply-To: <18790.554.354696.731117@stat.math.ethz.ch>
References: <3c12769c0901080231l28c5442fu2c1a23d0228c71ce@mail.gmail.com>
	<4965E02D.7030000@epfl.ch>
	<3c12769c0901080508h7afea9cawbd787cb8722b6ef6@mail.gmail.com>
	<18790.554.354696.731117@stat.math.ethz.ch>
Message-ID: <3c12769c0901080629u21c44325ke2771c0b37495f@mail.gmail.com>

Now I got how to reproduce it, it has nothing to do with multiple
figure environment but rather with figure resizing. Here it is:

 curve(dnorm,col=4,from=-4,to=4);
 legend(-4,0.3,legend="curve",lty=1,col=4)

# Now expand the figure to full screen

legend(-4,0.2,legend="curve",lty=1,col=4)

Simone

On Thu, Jan 8, 2009 at 2:39 PM, Martin Maechler
<maechler at stat.math.ethz.ch> wrote:
>
> >>>>> "SG" == Simone Giannerini <sgiannerini at gmail.com>
> >>>>>     on Thu, 8 Jan 2009 14:08:17 +0100 writes:
>
>    SG> Dear Mathieu, On Thu, Jan 8, 2009 at 12:14 PM, Mathieu
>    SG> Ribatet <mathieu.ribatet at epfl.ch> wrote:
>    >> Dear Simone,
>    >>
>    >> Did mean that the legend (text and/or box) overlap with
>    >> the Normal density?
>
>    SG> no, I mean that the two legend() commands, which are
>    SG> identical in all but the y-coordinates, produce
>    SG> different results, namely boxes with different widths.
>
> I don't see that behavior at all, rather the two boxes have
> identical dimensions for me.
>
> What does  dev.cur() say?  if anything with "X11..." (as you are
> on Linux),  what does
>
>  str(X11.options())
>
> give?
>
>
>    SG> Ciao
>
>    SG> Simone
>
>    >> If so then I think there's no problem as the legend is
>    >> placed where you told R to do. And R won't check (for
>    >> you) if it will overlap or not with pre-existing
>    >> graphical elements.
>    >>
>    >> On my computer, I got the expected results - if I
>    >> understood correctly your issue though. For information:
>    >>
>    >> R version 2.8.1 (2008-12-22) Linux mathieu-laptop
>    >> 2.6.27-11-generic #1 SMP Fri Dec 19 16:29:52 UTC 2008
>    >> i686 GNU/Linux (Ubuntu Intrepid)
>    >>
>    >> Cheers, Mathieu
>    >>
>    >> Simone Giannerini a ?crit :
>    >>>
>    >>> Dear all,
>    >>>
>    >>> there seems to be a problem with displayed legends when
>    >>> a multiple figure environment is used, see the following
>    >>> example:
>    >>>
>    >>> par(mfrow=c(1,2)) curve(dnorm,col=4,from=-4,to=4);
>    >>> legend(-4,0.3,legend="curve",lty=1,col=4)
>    >>> legend(-4,0.2,legend="curve",lty=1,col=4)
>    >>>
>    >>>
>    >>> On my machines the first time the command legend() is
>    >>> issued the legend box stretches over the
>    >>> curve. Subsequent calls to legend seems to produce a
>    >>> correct box instead.
>    >>>
>    >>> openSuse 11.0
>    >>>
>    >>> platform x86_64-unknown-linux-gnu arch x86_64 os
>    >>> linux-gnu system x86_64, linux-gnu status Patched major
>    >>> 2 minor 8.1 year 2009 month 01 day 07 svn rev 47501
>    >>> language R version.string R version 2.8.1 Patched
>    >>> (2009-01-07 r47501)
>    >>>
>    >>> I see this on the same version of R on Windows VISTA 32
>    >>> bit as well; I do not see this behaviour on a machine
>    >>> with R 2.8.0.
>    >>>
>    >>> Thank you,
>    >>>
>    >>> Simone
>    >>> --
>    >>> ______________________________________________________
>    >>>
>    >>> Simone Giannerini Dipartimento di Scienze Statistiche
>    >>> "Paolo Fortunati" Universita' di Bologna Via delle belle
>    >>> arti 41 - 40126 Bologna, ITALY Tel: +39 051 2098262 Fax:
>    >>> +39 051 232153 http://www2.stat.unibo.it/giannerini/
>    >>>
>    >>> ______________________________________________
>    >>> R-devel at r-project.org mailing list
>    >>> https://stat.ethz.ch/mailman/listinfo/r-devel
>    >>>
>    >>
> > --
> > Institute of Mathematics Ecole Polytechnique F?d?rale de
>    >> Lausanne STAT-IMA-FSB-EPFL, Station 8 CH-1015 Lausanne
>    >> Switzerland http://stat.epfl.ch/ Tel: + 41 (0)21 693 7907
>    >>
>    >>
>    >>
>
>
>
> --
> ______________________________________________________
>
>    SG> Simone Giannerini Dipartimento di Scienze Statistiche
>    SG> "Paolo Fortunati" Universita' di Bologna Via delle belle
>    SG> arti 41 - 40126 Bologna, ITALY Tel: +39 051 2098262 Fax:
>    SG> +39 051 232153 http://www2.stat.unibo.it/giannerini/
>
>    SG> ______________________________________________
>    SG> R-devel at r-project.org mailing list
>    SG> https://stat.ethz.ch/mailman/listinfo/r-devel



--
______________________________________________________

Simone Giannerini
Dipartimento di Scienze Statistiche "Paolo Fortunati"
Universita' di Bologna
Via delle belle arti 41 - 40126  Bologna,  ITALY
Tel: +39 051 2098262  Fax: +39 051 232153
http://www2.stat.unibo.it/giannerini/


From bernd.schoeller at comerge.net  Thu Jan  8 15:30:47 2009
From: bernd.schoeller at comerge.net (Bernd Schoeller)
Date: Thu, 08 Jan 2009 15:30:47 +0100
Subject: [Rd] Callbacks seems to get GCed.
Message-ID: <op.unfzxlt6olvcyz@lcp>

Dear list,

I am trying to implement a publish-subscribe mechanism in for an embedded  
R interpreter. But somehow my registered closures seem to get collected by  
the GC, even though I have protected them. I have reducted my code to the  
following sample. Sorry if it is a little verbose.

The first couple of call of calls still work, but at some point one of the  
callbacks (callback1 in my case) changes its type.

Regards and thanks for any help,
   Bernd

#include <stdio.h>
#include <stdlib.h>

#define R_INTERFACE_PTRS 1

#include <Rversion.h>
#include <Rembedded.h>
#include <Rinternals.h>
#include <Rdefines.h>
#include <R_ext/Parse.h>
#include <R_ext/Rdynload.h>
#include <R_ext/RStartup.h>
#include <Rinterface.h>

SEXP callback1;
SEXP callback2;

void set_callback1(SEXP func) {
   PROTECT(callback1 = func);
}

void set_callback2(SEXP func) {
   PROTECT(callback2 = func);
}

R_CMethodDef cMethods[] = {
   {NULL}
};

R_CallMethodDef callMethods[] = {
   {"set_callback1", (DL_FUNC) &set_callback1, 1},
   {"set_callback2", (DL_FUNC) &set_callback2, 1},
   {NULL}
};

void r_trigger_callback1()
{
   int errorOccurred;
   SEXP f = NULL;

   f = allocVector(LANGSXP, 1);
   SETCAR(f, callback1);
   PROTECT(f);
   R_tryEval(f, R_GlobalEnv, &errorOccurred);
   UNPROTECT(1);
}

void r_trigger_callback2()
{
   int errorOccurred;
   SEXP f = NULL;

   f = allocVector(LANGSXP, 1);
   SETCAR(f, callback2);
   PROTECT(f);
   R_tryEval(f, R_GlobalEnv, &errorOccurred);
   UNPROTECT(1);
}


void r_exec(char *code)
{
   SEXP cmdSexp, cmdExpr = R_NilValue;
   ParseStatus status;
   int i,errorOccurred;
   SEXP e;
	
   PROTECT (cmdSexp = allocVector (STRSXP, 1));
   SET_STRING_ELT (cmdSexp, 0, mkChar (code));
   PROTECT (cmdExpr = R_ParseVector (cmdSexp,-1,&status,R_NilValue));
   UNPROTECT_PTR (cmdSexp);

   if (status == PARSE_OK) {		
     for (i = 0; i < length (cmdExpr); i++) {
       PROTECT(e = VECTOR_ELT (cmdExpr,i));
       R_tryEval(e, R_GlobalEnv, &errorOccurred);
       UNPROTECT_PTR(e);
       if (errorOccurred) {
	return;		
       }
     }
   }
}

void initR()
{
   char *argv[] = {"REmbeddedPascal", "--gui=none", "--silent",  
"--no-save"};
   int argc = 4;
   DllInfo *info;

   setenv("R_HOME","/usr/lib/R",0);

   structRstart rp;
   Rstart Rp = &rp;

   R_setStartTime();
   R_DefParams(Rp);

   Rp->R_Quiet = TRUE;
   Rp->RestoreAction = SA_RESTORE;
   Rp->SaveAction = SA_NOSAVE;
   R_SetParams(Rp);

   R_Interactive = TRUE;

   Rf_initialize_R(argc, argv);
   setup_Rmainloop();
   R_ReplDLLinit();
   info = R_getEmbeddingDllInfo();
   R_registerRoutines(info, cMethods, callMethods, NULL, NULL);
}

int main (int argc, char** argv)
{
   int i;
   initR();

   r_exec("x <- function (f) { .Call(\"set_callback1\",f); }");
   r_exec("y <- function (f) { .Call(\"set_callback2\",f); }");
   r_exec("x(function() { print(\"A\"); })");
   r_exec("y(function() { print(\"B\"); })");

   for (i = 0; i < 100000; i++) {
     r_trigger_callback1();
     r_trigger_callback2();
   }

   Rf_endEmbeddedR(0);
}


-- 
Bernd Schoeller, PhD, CTO
Comerge AG, Technoparkstrasse 1, CH-8055 Zurich, www.comerge.net


From sgiannerini at gmail.com  Thu Jan  8 15:39:04 2009
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Thu, 8 Jan 2009 15:39:04 +0100
Subject: [Rd] legend() in a multiple figure environment
In-Reply-To: <3c12769c0901080629u21c44325ke2771c0b37495f@mail.gmail.com>
References: <3c12769c0901080231l28c5442fu2c1a23d0228c71ce@mail.gmail.com>
	<4965E02D.7030000@epfl.ch>
	<3c12769c0901080508h7afea9cawbd787cb8722b6ef6@mail.gmail.com>
	<18790.554.354696.731117@stat.math.ethz.ch>
	<3c12769c0901080629u21c44325ke2771c0b37495f@mail.gmail.com>
Message-ID: <3c12769c0901080639g2866f4a9rd5be741801beaa05@mail.gmail.com>

You can find the resulting graph here (produced under win Vista)

http://www2.stat.unibo.it/giannerini/R/try.eps

(produced under win Vista)

platform       i386-pc-mingw32
arch           i386
os             mingw32
system         i386, mingw32
status
major          2
minor          8.1
year           2008
month          12
day            22
svn rev        47281
language       R
version.string R version 2.8.1 (2008-12-22)

On Thu, Jan 8, 2009 at 3:29 PM, Simone Giannerini <sgiannerini at gmail.com> wrote:
> Now I got how to reproduce it, it has nothing to do with multiple
> figure environment but rather with figure resizing. Here it is:
>
>  curve(dnorm,col=4,from=-4,to=4);
>  legend(-4,0.3,legend="curve",lty=1,col=4)
>
> # Now expand the figure to full screen
>
> legend(-4,0.2,legend="curve",lty=1,col=4)
>
> Simone
>
> On Thu, Jan 8, 2009 at 2:39 PM, Martin Maechler
> <maechler at stat.math.ethz.ch> wrote:
>>
>> >>>>> "SG" == Simone Giannerini <sgiannerini at gmail.com>
>> >>>>>     on Thu, 8 Jan 2009 14:08:17 +0100 writes:
>>
>>    SG> Dear Mathieu, On Thu, Jan 8, 2009 at 12:14 PM, Mathieu
>>    SG> Ribatet <mathieu.ribatet at epfl.ch> wrote:
>>    >> Dear Simone,
>>    >>
>>    >> Did mean that the legend (text and/or box) overlap with
>>    >> the Normal density?
>>
>>    SG> no, I mean that the two legend() commands, which are
>>    SG> identical in all but the y-coordinates, produce
>>    SG> different results, namely boxes with different widths.
>>
>> I don't see that behavior at all, rather the two boxes have
>> identical dimensions for me.
>>
>> What does  dev.cur() say?  if anything with "X11..." (as you are
>> on Linux),  what does
>>
>>  str(X11.options())
>>
>> give?
>>
>>
>>    SG> Ciao
>>
>>    SG> Simone
>>
>>    >> If so then I think there's no problem as the legend is
>>    >> placed where you told R to do. And R won't check (for
>>    >> you) if it will overlap or not with pre-existing
>>    >> graphical elements.
>>    >>
>>    >> On my computer, I got the expected results - if I
>>    >> understood correctly your issue though. For information:
>>    >>
>>    >> R version 2.8.1 (2008-12-22) Linux mathieu-laptop
>>    >> 2.6.27-11-generic #1 SMP Fri Dec 19 16:29:52 UTC 2008
>>    >> i686 GNU/Linux (Ubuntu Intrepid)
>>    >>
>>    >> Cheers, Mathieu
>>    >>
>>    >> Simone Giannerini a ?crit :
>>    >>>
>>    >>> Dear all,
>>    >>>
>>    >>> there seems to be a problem with displayed legends when
>>    >>> a multiple figure environment is used, see the following
>>    >>> example:
>>    >>>
>>    >>> par(mfrow=c(1,2)) curve(dnorm,col=4,from=-4,to=4);
>>    >>> legend(-4,0.3,legend="curve",lty=1,col=4)
>>    >>> legend(-4,0.2,legend="curve",lty=1,col=4)
>>    >>>
>>    >>>
>>    >>> On my machines the first time the command legend() is
>>    >>> issued the legend box stretches over the
>>    >>> curve. Subsequent calls to legend seems to produce a
>>    >>> correct box instead.
>>    >>>
>>    >>> openSuse 11.0
>>    >>>
>>    >>> platform x86_64-unknown-linux-gnu arch x86_64 os
>>    >>> linux-gnu system x86_64, linux-gnu status Patched major
>>    >>> 2 minor 8.1 year 2009 month 01 day 07 svn rev 47501
>>    >>> language R version.string R version 2.8.1 Patched
>>    >>> (2009-01-07 r47501)
>>    >>>
>>    >>> I see this on the same version of R on Windows VISTA 32
>>    >>> bit as well; I do not see this behaviour on a machine
>>    >>> with R 2.8.0.
>>    >>>
>>    >>> Thank you,
>>    >>>
>>    >>> Simone
>>    >>> --
>>    >>> ______________________________________________________
>>    >>>
>>    >>> Simone Giannerini Dipartimento di Scienze Statistiche
>>    >>> "Paolo Fortunati" Universita' di Bologna Via delle belle
>>    >>> arti 41 - 40126 Bologna, ITALY Tel: +39 051 2098262 Fax:
>>    >>> +39 051 232153 http://www2.stat.unibo.it/giannerini/
>>    >>>
>>    >>> ______________________________________________
>>    >>> R-devel at r-project.org mailing list
>>    >>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>    >>>
>>    >>
>> > --
>> > Institute of Mathematics Ecole Polytechnique F?d?rale de
>>    >> Lausanne STAT-IMA-FSB-EPFL, Station 8 CH-1015 Lausanne
>>    >> Switzerland http://stat.epfl.ch/ Tel: + 41 (0)21 693 7907
>>    >>
>>    >>
>>    >>
>>
>>
>>
>> --
>> ______________________________________________________
>>
>>    SG> Simone Giannerini Dipartimento di Scienze Statistiche
>>    SG> "Paolo Fortunati" Universita' di Bologna Via delle belle
>>    SG> arti 41 - 40126 Bologna, ITALY Tel: +39 051 2098262 Fax:
>>    SG> +39 051 232153 http://www2.stat.unibo.it/giannerini/
>>
>>    SG> ______________________________________________
>>    SG> R-devel at r-project.org mailing list
>>    SG> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>
> --
> ______________________________________________________
>
> Simone Giannerini
> Dipartimento di Scienze Statistiche "Paolo Fortunati"
> Universita' di Bologna
> Via delle belle arti 41 - 40126  Bologna,  ITALY
> Tel: +39 051 2098262  Fax: +39 051 232153
> http://www2.stat.unibo.it/giannerini/
> ______________________________________________________
>



-- 
______________________________________________________

Simone Giannerini
Dipartimento di Scienze Statistiche "Paolo Fortunati"
Universita' di Bologna
Via delle belle arti 41 - 40126  Bologna,  ITALY
Tel: +39 051 2098262  Fax: +39 051 232153
http://www2.stat.unibo.it/giannerini/


From duncan at wald.ucdavis.edu  Thu Jan  8 15:59:25 2009
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Thu, 8 Jan 2009 06:59:25 -0800
Subject: [Rd] Callbacks seems to get GCed.
In-Reply-To: <op.unfzxlt6olvcyz@lcp>
References: <op.unfzxlt6olvcyz@lcp>
Message-ID: <20090108145925.GA31368@wald.ucdavis.edu>


Hi Bernd

There are two problems here.
Firstly, routines that are invoked  via the .Call() interface
must return a SEXP, not a void.  (void is for .C()-callable
routines.) 

The more serious problem is that yes, you are PROTECT'ing
the callbacks when you set them, but PROTECT'ing is
for the duration of the .Call() invocation, not throughout
a session. I imagine you are seeing stack imbalance messages
as you do not UNPROTECT() within the .Call() to set the
callbacks.

Because the setting of the callbacks and using them 
is asynchronous, or not part of the same .Call(),
you can use R_PreserveObject() rather than PROTECT().
That prohibits the object from  being garbage collected.


 D.

Bernd Schoeller wrote:
> Dear list,
> 
> I am trying to implement a publish-subscribe mechanism in for an embedded  
> R interpreter. But somehow my registered closures seem to get collected by  
> the GC, even though I have protected them. I have reducted my code to the  
> following sample. Sorry if it is a little verbose.
> 
> The first couple of call of calls still work, but at some point one of the  
> callbacks (callback1 in my case) changes its type.
> 
> Regards and thanks for any help,
>   Bernd
> 
> #include <stdio.h>
> #include <stdlib.h>
> 
> #define R_INTERFACE_PTRS 1
> 
> #include <Rversion.h>
> #include <Rembedded.h>
> #include <Rinternals.h>
> #include <Rdefines.h>
> #include <R_ext/Parse.h>
> #include <R_ext/Rdynload.h>
> #include <R_ext/RStartup.h>
> #include <Rinterface.h>
> 
> SEXP callback1;
> SEXP callback2;
> 
> void set_callback1(SEXP func) {
>   PROTECT(callback1 = func);
> }
> 
> void set_callback2(SEXP func) {
>   PROTECT(callback2 = func);
> }
> 
> R_CMethodDef cMethods[] = {
>   {NULL}
> };
> 
> R_CallMethodDef callMethods[] = {
>   {"set_callback1", (DL_FUNC) &set_callback1, 1},
>   {"set_callback2", (DL_FUNC) &set_callback2, 1},
>   {NULL}
> };
> 
> void r_trigger_callback1()
> {
>   int errorOccurred;
>   SEXP f = NULL;
> 
>   f = allocVector(LANGSXP, 1);
>   SETCAR(f, callback1);
>   PROTECT(f);
>   R_tryEval(f, R_GlobalEnv, &errorOccurred);
>   UNPROTECT(1);
> }
> 
> void r_trigger_callback2()
> {
>   int errorOccurred;
>   SEXP f = NULL;
> 
>   f = allocVector(LANGSXP, 1);
>   SETCAR(f, callback2);
>   PROTECT(f);
>   R_tryEval(f, R_GlobalEnv, &errorOccurred);
>   UNPROTECT(1);
> }
> 
> 
> void r_exec(char *code)
> {
>   SEXP cmdSexp, cmdExpr = R_NilValue;
>   ParseStatus status;
>   int i,errorOccurred;
>   SEXP e;
> 	
>   PROTECT (cmdSexp = allocVector (STRSXP, 1));
>   SET_STRING_ELT (cmdSexp, 0, mkChar (code));
>   PROTECT (cmdExpr = R_ParseVector (cmdSexp,-1,&status,R_NilValue));
>   UNPROTECT_PTR (cmdSexp);
> 
>   if (status == PARSE_OK) {		
>     for (i = 0; i < length (cmdExpr); i++) {
>       PROTECT(e = VECTOR_ELT (cmdExpr,i));
>       R_tryEval(e, R_GlobalEnv, &errorOccurred);
>       UNPROTECT_PTR(e);
>       if (errorOccurred) {
> 	return;		
>       }
>     }
>   }
> }
> 
> void initR()
> {
>   char *argv[] = {"REmbeddedPascal", "--gui=none", "--silent",  
> "--no-save"};
>   int argc = 4;
>   DllInfo *info;
> 
>   setenv("R_HOME","/usr/lib/R",0);
> 
>   structRstart rp;
>   Rstart Rp = &rp;
> 
>   R_setStartTime();
>   R_DefParams(Rp);
> 
>   Rp->R_Quiet = TRUE;
>   Rp->RestoreAction = SA_RESTORE;
>   Rp->SaveAction = SA_NOSAVE;
>   R_SetParams(Rp);
> 
>   R_Interactive = TRUE;
> 
>   Rf_initialize_R(argc, argv);
>   setup_Rmainloop();
>   R_ReplDLLinit();
>   info = R_getEmbeddingDllInfo();
>   R_registerRoutines(info, cMethods, callMethods, NULL, NULL);
> }
> 
> int main (int argc, char** argv)
> {
>   int i;
>   initR();
> 
>   r_exec("x <- function (f) { .Call(\"set_callback1\",f); }");
>   r_exec("y <- function (f) { .Call(\"set_callback2\",f); }");
>   r_exec("x(function() { print(\"A\"); })");
>   r_exec("y(function() { print(\"B\"); })");
> 
>   for (i = 0; i < 100000; i++) {
>     r_trigger_callback1();
>     r_trigger_callback2();
>   }
> 
>   Rf_endEmbeddedR(0);
> }
> 
> 
> -- 
> Bernd Schoeller, PhD, CTO
> Comerge AG, Technoparkstrasse 1, CH-8055 Zurich, www.comerge.net
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
"There are men who can think no deeper than a fact" - Voltaire


Duncan Temple Lang                duncan at wald.ucdavis.edu
Department of Statistics          work:  (530) 752-4782
4210 Mathematical Sciences Bldg.  fax:   (530) 752-7099
One Shields Ave.
University of California at Davis
Davis, CA 95616, USA



-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090108/c6f51898/attachment.bin>

From murdoch at stats.uwo.ca  Thu Jan  8 16:00:10 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 08 Jan 2009 10:00:10 -0500
Subject: [Rd] legend() in a multiple figure environment
In-Reply-To: <3c12769c0901080629u21c44325ke2771c0b37495f@mail.gmail.com>
References: <3c12769c0901080231l28c5442fu2c1a23d0228c71ce@mail.gmail.com>	<4965E02D.7030000@epfl.ch>	<3c12769c0901080508h7afea9cawbd787cb8722b6ef6@mail.gmail.com>	<18790.554.354696.731117@stat.math.ethz.ch>
	<3c12769c0901080629u21c44325ke2771c0b37495f@mail.gmail.com>
Message-ID: <496614FA.9090604@stats.uwo.ca>

On 1/8/2009 9:29 AM, Simone Giannerini wrote:
> Now I got how to reproduce it, it has nothing to do with multiple
> figure environment but rather with figure resizing. Here it is:
> 
>  curve(dnorm,col=4,from=-4,to=4);
>  legend(-4,0.3,legend="curve",lty=1,col=4)
> 
> # Now expand the figure to full screen
> 
> legend(-4,0.2,legend="curve",lty=1,col=4)

I think the only advice here is "don't do that".  The problem is that 
the box is sized appropriately to surround the text when it is first 
drawn, then you scale everything up except the text, so the box becomes 
too big.  The new box is appropriate to the text at the new size.

Then you scale everything again when you save to a file, and the boxes 
end up different again.

So the advice is:   draw legends with the plot at its final size if you 
want the sizing to work properly.  R doesn't save the fact that the size 
is supposed to be relative to the text, rather than relative to the plot 
region.

Duncan Murdoch

> Simone
> 
> On Thu, Jan 8, 2009 at 2:39 PM, Martin Maechler
> <maechler at stat.math.ethz.ch> wrote:
>>
>> >>>>> "SG" == Simone Giannerini <sgiannerini at gmail.com>
>> >>>>>     on Thu, 8 Jan 2009 14:08:17 +0100 writes:
>>
>>    SG> Dear Mathieu, On Thu, Jan 8, 2009 at 12:14 PM, Mathieu
>>    SG> Ribatet <mathieu.ribatet at epfl.ch> wrote:
>>    >> Dear Simone,
>>    >>
>>    >> Did mean that the legend (text and/or box) overlap with
>>    >> the Normal density?
>>
>>    SG> no, I mean that the two legend() commands, which are
>>    SG> identical in all but the y-coordinates, produce
>>    SG> different results, namely boxes with different widths.
>>
>> I don't see that behavior at all, rather the two boxes have
>> identical dimensions for me.
>>
>> What does  dev.cur() say?  if anything with "X11..." (as you are
>> on Linux),  what does
>>
>>  str(X11.options())
>>
>> give?
>>
>>
>>    SG> Ciao
>>
>>    SG> Simone
>>
>>    >> If so then I think there's no problem as the legend is
>>    >> placed where you told R to do. And R won't check (for
>>    >> you) if it will overlap or not with pre-existing
>>    >> graphical elements.
>>    >>
>>    >> On my computer, I got the expected results - if I
>>    >> understood correctly your issue though. For information:
>>    >>
>>    >> R version 2.8.1 (2008-12-22) Linux mathieu-laptop
>>    >> 2.6.27-11-generic #1 SMP Fri Dec 19 16:29:52 UTC 2008
>>    >> i686 GNU/Linux (Ubuntu Intrepid)
>>    >>
>>    >> Cheers, Mathieu
>>    >>
>>    >> Simone Giannerini a ?crit :
>>    >>>
>>    >>> Dear all,
>>    >>>
>>    >>> there seems to be a problem with displayed legends when
>>    >>> a multiple figure environment is used, see the following
>>    >>> example:
>>    >>>
>>    >>> par(mfrow=c(1,2)) curve(dnorm,col=4,from=-4,to=4);
>>    >>> legend(-4,0.3,legend="curve",lty=1,col=4)
>>    >>> legend(-4,0.2,legend="curve",lty=1,col=4)
>>    >>>
>>    >>>
>>    >>> On my machines the first time the command legend() is
>>    >>> issued the legend box stretches over the
>>    >>> curve. Subsequent calls to legend seems to produce a
>>    >>> correct box instead.
>>    >>>
>>    >>> openSuse 11.0
>>    >>>
>>    >>> platform x86_64-unknown-linux-gnu arch x86_64 os
>>    >>> linux-gnu system x86_64, linux-gnu status Patched major
>>    >>> 2 minor 8.1 year 2009 month 01 day 07 svn rev 47501
>>    >>> language R version.string R version 2.8.1 Patched
>>    >>> (2009-01-07 r47501)
>>    >>>
>>    >>> I see this on the same version of R on Windows VISTA 32
>>    >>> bit as well; I do not see this behaviour on a machine
>>    >>> with R 2.8.0.
>>    >>>
>>    >>> Thank you,
>>    >>>
>>    >>> Simone
>>    >>> --
>>    >>> ______________________________________________________
>>    >>>
>>    >>> Simone Giannerini Dipartimento di Scienze Statistiche
>>    >>> "Paolo Fortunati" Universita' di Bologna Via delle belle
>>    >>> arti 41 - 40126 Bologna, ITALY Tel: +39 051 2098262 Fax:
>>    >>> +39 051 232153 http://www2.stat.unibo.it/giannerini/
>>    >>>
>>    >>> ______________________________________________
>>    >>> R-devel at r-project.org mailing list
>>    >>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>    >>>
>>    >>
>> > --
>> > Institute of Mathematics Ecole Polytechnique F?d?rale de
>>    >> Lausanne STAT-IMA-FSB-EPFL, Station 8 CH-1015 Lausanne
>>    >> Switzerland http://stat.epfl.ch/ Tel: + 41 (0)21 693 7907
>>    >>
>>    >>
>>    >>
>>
>>
>>
>> --
>> ______________________________________________________
>>
>>    SG> Simone Giannerini Dipartimento di Scienze Statistiche
>>    SG> "Paolo Fortunati" Universita' di Bologna Via delle belle
>>    SG> arti 41 - 40126 Bologna, ITALY Tel: +39 051 2098262 Fax:
>>    SG> +39 051 232153 http://www2.stat.unibo.it/giannerini/
>>
>>    SG> ______________________________________________
>>    SG> R-devel at r-project.org mailing list
>>    SG> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 
> 
> --
> ______________________________________________________
> 
> Simone Giannerini
> Dipartimento di Scienze Statistiche "Paolo Fortunati"
> Universita' di Bologna
> Via delle belle arti 41 - 40126  Bologna,  ITALY
> Tel: +39 051 2098262  Fax: +39 051 232153
> http://www2.stat.unibo.it/giannerini/
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Thu Jan  8 16:02:56 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 8 Jan 2009 15:02:56 +0000 (GMT)
Subject: [Rd] legend() in a multiple figure environment
In-Reply-To: <3c12769c0901080629u21c44325ke2771c0b37495f@mail.gmail.com>
References: <3c12769c0901080231l28c5442fu2c1a23d0228c71ce@mail.gmail.com>
	<4965E02D.7030000@epfl.ch>
	<3c12769c0901080508h7afea9cawbd787cb8722b6ef6@mail.gmail.com>
	<18790.554.354696.731117@stat.math.ethz.ch>
	<3c12769c0901080629u21c44325ke2771c0b37495f@mail.gmail.com>
Message-ID: <alpine.LFD.2.00.0901081456400.24830@auk.stats.ox.ac.uk>

On Thu, 8 Jan 2009, Simone Giannerini wrote:

> Now I got how to reproduce it, it has nothing to do with multiple
> figure environment but rather with figure resizing. Here it is:
>
> curve(dnorm,col=4,from=-4,to=4);
> legend(-4,0.3,legend="curve",lty=1,col=4)
>
> # Now expand the figure to full screen
>
> legend(-4,0.2,legend="curve",lty=1,col=4)

When you resize graphics, text stays the same size (on most devices) and 
vector graphics does not. You can't expect the figure to be recomputed 
when you resize (and if you expect so, your expectations will be 
unfufilled).  All that happens is that a low-level description is 
replayed.

The windows() device does give you more options on resize.

>
> Simone
>
> On Thu, Jan 8, 2009 at 2:39 PM, Martin Maechler
> <maechler at stat.math.ethz.ch> wrote:
>>
>>>>>>> "SG" == Simone Giannerini <sgiannerini at gmail.com>
>>>>>>>     on Thu, 8 Jan 2009 14:08:17 +0100 writes:
>>
>>    SG> Dear Mathieu, On Thu, Jan 8, 2009 at 12:14 PM, Mathieu
>>    SG> Ribatet <mathieu.ribatet at epfl.ch> wrote:
>>   >> Dear Simone,
>>   >>
>>   >> Did mean that the legend (text and/or box) overlap with
>>   >> the Normal density?
>>
>>    SG> no, I mean that the two legend() commands, which are
>>    SG> identical in all but the y-coordinates, produce
>>    SG> different results, namely boxes with different widths.
>>
>> I don't see that behavior at all, rather the two boxes have
>> identical dimensions for me.
>>
>> What does  dev.cur() say?  if anything with "X11..." (as you are
>> on Linux),  what does
>>
>>  str(X11.options())
>>
>> give?
>>
>>
>>    SG> Ciao
>>
>>    SG> Simone
>>
>>   >> If so then I think there's no problem as the legend is
>>   >> placed where you told R to do. And R won't check (for
>>   >> you) if it will overlap or not with pre-existing
>>   >> graphical elements.
>>   >>
>>   >> On my computer, I got the expected results - if I
>>   >> understood correctly your issue though. For information:
>>   >>
>>   >> R version 2.8.1 (2008-12-22) Linux mathieu-laptop
>>   >> 2.6.27-11-generic #1 SMP Fri Dec 19 16:29:52 UTC 2008
>>   >> i686 GNU/Linux (Ubuntu Intrepid)
>>   >>
>>   >> Cheers, Mathieu
>>   >>
>>   >> Simone Giannerini a ?crit :
>>   >>>
>>   >>> Dear all,
>>   >>>
>>   >>> there seems to be a problem with displayed legends when
>>   >>> a multiple figure environment is used, see the following
>>   >>> example:
>>   >>>
>>   >>> par(mfrow=c(1,2)) curve(dnorm,col=4,from=-4,to=4);
>>   >>> legend(-4,0.3,legend="curve",lty=1,col=4)
>>   >>> legend(-4,0.2,legend="curve",lty=1,col=4)
>>   >>>
>>   >>>
>>   >>> On my machines the first time the command legend() is
>>   >>> issued the legend box stretches over the
>>   >>> curve. Subsequent calls to legend seems to produce a
>>   >>> correct box instead.
>>   >>>
>>   >>> openSuse 11.0
>>   >>>
>>   >>> platform x86_64-unknown-linux-gnu arch x86_64 os
>>   >>> linux-gnu system x86_64, linux-gnu status Patched major
>>   >>> 2 minor 8.1 year 2009 month 01 day 07 svn rev 47501
>>   >>> language R version.string R version 2.8.1 Patched
>>   >>> (2009-01-07 r47501)
>>   >>>
>>   >>> I see this on the same version of R on Windows VISTA 32
>>   >>> bit as well; I do not see this behaviour on a machine
>>   >>> with R 2.8.0.
>>   >>>
>>   >>> Thank you,
>>   >>>
>>   >>> Simone
>>   >>> --
>>   >>> ______________________________________________________
>>   >>>
>>   >>> Simone Giannerini Dipartimento di Scienze Statistiche
>>   >>> "Paolo Fortunati" Universita' di Bologna Via delle belle
>>   >>> arti 41 - 40126 Bologna, ITALY Tel: +39 051 2098262 Fax:
>>   >>> +39 051 232153 http://www2.stat.unibo.it/giannerini/
>>   >>>
>>   >>> ______________________________________________
>>   >>> R-devel at r-project.org mailing list
>>   >>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>   >>>
>>   >>
>>> --
>>> Institute of Mathematics Ecole Polytechnique F?d?rale de
>>   >> Lausanne STAT-IMA-FSB-EPFL, Station 8 CH-1015 Lausanne
>>   >> Switzerland http://stat.epfl.ch/ Tel: + 41 (0)21 693 7907
>>   >>
>>   >>
>>   >>
>>
>>
>>
>> --
>> ______________________________________________________
>>
>>    SG> Simone Giannerini Dipartimento di Scienze Statistiche
>>    SG> "Paolo Fortunati" Universita' di Bologna Via delle belle
>>    SG> arti 41 - 40126 Bologna, ITALY Tel: +39 051 2098262 Fax:
>>    SG> +39 051 232153 http://www2.stat.unibo.it/giannerini/
>>
>>    SG> ______________________________________________
>>    SG> R-devel at r-project.org mailing list
>>    SG> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>
> --
> ______________________________________________________
>
> Simone Giannerini
> Dipartimento di Scienze Statistiche "Paolo Fortunati"
> Universita' di Bologna
> Via delle belle arti 41 - 40126  Bologna,  ITALY
> Tel: +39 051 2098262  Fax: +39 051 232153
> http://www2.stat.unibo.it/giannerini/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From bernd.schoeller at comerge.net  Thu Jan  8 16:22:52 2009
From: bernd.schoeller at comerge.net (Bernd Schoeller)
Date: Thu, 08 Jan 2009 16:22:52 +0100
Subject: [Rd] Callbacks seems to get GCed.
In-Reply-To: <20090108145925.GA31368@wald.ucdavis.edu>
References: <op.unfzxlt6olvcyz@lcp> <20090108145925.GA31368@wald.ucdavis.edu>
Message-ID: <op.unf2cel0olvcyz@lcp>

Dear Duncan,

Thank you for your suggestion. I did not know about R_PreserveObject, this is exactly what we needed. You have been very helpful.

Regards,
  Bernd

On Thu, 08 Jan 2009 15:59:25 +0100, Duncan Temple Lang <duncan at wald.ucdavis.edu> wrote:

>
> Hi Bernd
>
> There are two problems here.
> Firstly, routines that are invoked  via the .Call() interface
> must return a SEXP, not a void.  (void is for .C()-callable
> routines.)
>
> The more serious problem is that yes, you are PROTECT'ing
> the callbacks when you set them, but PROTECT'ing is
> for the duration of the .Call() invocation, not throughout
> a session. I imagine you are seeing stack imbalance messages
> as you do not UNPROTECT() within the .Call() to set the
> callbacks.
>
> Because the setting of the callbacks and using them
> is asynchronous, or not part of the same .Call(),
> you can use R_PreserveObject() rather than PROTECT().
> That prohibits the object from  being garbage collected.
>
>
>  D.
>
> Bernd Schoeller wrote:
>> Dear list,
>>
>> I am trying to implement a publish-subscribe mechanism in for an  
>> embedded
>> R interpreter. But somehow my registered closures seem to get collected  
>> by
>> the GC, even though I have protected them. I have reducted my code to  
>> the
>> following sample. Sorry if it is a little verbose.
>>
>> The first couple of call of calls still work, but at some point one of  
>> the
>> callbacks (callback1 in my case) changes its type.
>>
>> Regards and thanks for any help,
>>   Bernd
>>
>> #include <stdio.h>
>> #include <stdlib.h>
>>
>> #define R_INTERFACE_PTRS 1
>>
>> #include <Rversion.h>
>> #include <Rembedded.h>
>> #include <Rinternals.h>
>> #include <Rdefines.h>
>> #include <R_ext/Parse.h>
>> #include <R_ext/Rdynload.h>
>> #include <R_ext/RStartup.h>
>> #include <Rinterface.h>
>>
>> SEXP callback1;
>> SEXP callback2;
>>
>> void set_callback1(SEXP func) {
>>   PROTECT(callback1 = func);
>> }
>>
>> void set_callback2(SEXP func) {
>>   PROTECT(callback2 = func);
>> }
>>
>> R_CMethodDef cMethods[] = {
>>   {NULL}
>> };
>>
>> R_CallMethodDef callMethods[] = {
>>   {"set_callback1", (DL_FUNC) &set_callback1, 1},
>>   {"set_callback2", (DL_FUNC) &set_callback2, 1},
>>   {NULL}
>> };
>>
>> void r_trigger_callback1()
>> {
>>   int errorOccurred;
>>   SEXP f = NULL;
>>
>>   f = allocVector(LANGSXP, 1);
>>   SETCAR(f, callback1);
>>   PROTECT(f);
>>   R_tryEval(f, R_GlobalEnv, &errorOccurred);
>>   UNPROTECT(1);
>> }
>>
>> void r_trigger_callback2()
>> {
>>   int errorOccurred;
>>   SEXP f = NULL;
>>
>>   f = allocVector(LANGSXP, 1);
>>   SETCAR(f, callback2);
>>   PROTECT(f);
>>   R_tryEval(f, R_GlobalEnv, &errorOccurred);
>>   UNPROTECT(1);
>> }
>>
>>
>> void r_exec(char *code)
>> {
>>   SEXP cmdSexp, cmdExpr = R_NilValue;
>>   ParseStatus status;
>>   int i,errorOccurred;
>>   SEXP e;
>> 	
>>   PROTECT (cmdSexp = allocVector (STRSXP, 1));
>>   SET_STRING_ELT (cmdSexp, 0, mkChar (code));
>>   PROTECT (cmdExpr = R_ParseVector (cmdSexp,-1,&status,R_NilValue));
>>   UNPROTECT_PTR (cmdSexp);
>>
>>   if (status == PARSE_OK) {		
>>     for (i = 0; i < length (cmdExpr); i++) {
>>       PROTECT(e = VECTOR_ELT (cmdExpr,i));
>>       R_tryEval(e, R_GlobalEnv, &errorOccurred);
>>       UNPROTECT_PTR(e);
>>       if (errorOccurred) {
>> 	return;		
>>       }
>>     }
>>   }
>> }
>>
>> void initR()
>> {
>>   char *argv[] = {"REmbeddedPascal", "--gui=none", "--silent",
>> "--no-save"};
>>   int argc = 4;
>>   DllInfo *info;
>>
>>   setenv("R_HOME","/usr/lib/R",0);
>>
>>   structRstart rp;
>>   Rstart Rp = &rp;
>>
>>   R_setStartTime();
>>   R_DefParams(Rp);
>>
>>   Rp->R_Quiet = TRUE;
>>   Rp->RestoreAction = SA_RESTORE;
>>   Rp->SaveAction = SA_NOSAVE;
>>   R_SetParams(Rp);
>>
>>   R_Interactive = TRUE;
>>
>>   Rf_initialize_R(argc, argv);
>>   setup_Rmainloop();
>>   R_ReplDLLinit();
>>   info = R_getEmbeddingDllInfo();
>>   R_registerRoutines(info, cMethods, callMethods, NULL, NULL);
>> }
>>
>> int main (int argc, char** argv)
>> {
>>   int i;
>>   initR();
>>
>>   r_exec("x <- function (f) { .Call(\"set_callback1\",f); }");
>>   r_exec("y <- function (f) { .Call(\"set_callback2\",f); }");
>>   r_exec("x(function() { print(\"A\"); })");
>>   r_exec("y(function() { print(\"B\"); })");
>>
>>   for (i = 0; i < 100000; i++) {
>>     r_trigger_callback1();
>>     r_trigger_callback2();
>>   }
>>
>>   Rf_endEmbeddedR(0);
>> }
>>
>>
>> --
>> Bernd Schoeller, PhD, CTO
>> Comerge AG, Technoparkstrasse 1, CH-8055 Zurich, www.comerge.net
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Bernd Schoeller, PhD, CTO
Comerge AG, Technoparkstrasse 1, CH-8055 Zurich, www.comerge.net


From sgiannerini at gmail.com  Thu Jan  8 16:59:50 2009
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Thu, 8 Jan 2009 16:59:50 +0100
Subject: [Rd] legend() in a multiple figure environment
In-Reply-To: <alpine.LFD.2.00.0901081456400.24830@auk.stats.ox.ac.uk>
References: <3c12769c0901080231l28c5442fu2c1a23d0228c71ce@mail.gmail.com>
	<4965E02D.7030000@epfl.ch>
	<3c12769c0901080508h7afea9cawbd787cb8722b6ef6@mail.gmail.com>
	<18790.554.354696.731117@stat.math.ethz.ch>
	<3c12769c0901080629u21c44325ke2771c0b37495f@mail.gmail.com>
	<alpine.LFD.2.00.0901081456400.24830@auk.stats.ox.ac.uk>
Message-ID: <3c12769c0901080759k113b62fakce43fbd61b31091c@mail.gmail.com>

Thanks for your clarifications,
I use legends only when the plot is at its final size and also had a
look at windows() before posting but at first I could not relate the
legends' behaviour to the resizing effect.

Kind regards,

Simone


On Thu, Jan 8, 2009 at 4:02 PM, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On Thu, 8 Jan 2009, Simone Giannerini wrote:
>
>> Now I got how to reproduce it, it has nothing to do with multiple
>> figure environment but rather with figure resizing. Here it is:
>>
>> curve(dnorm,col=4,from=-4,to=4);
>> legend(-4,0.3,legend="curve",lty=1,col=4)
>>
>> # Now expand the figure to full screen
>>
>> legend(-4,0.2,legend="curve",lty=1,col=4)
>
> When you resize graphics, text stays the same size (on most devices) and
> vector graphics does not. You can't expect the figure to be recomputed when
> you resize (and if you expect so, your expectations will be unfufilled).
>  All that happens is that a low-level description is replayed.
>
> The windows() device does give you more options on resize.
>
>>
>> Simone
>>
>> On Thu, Jan 8, 2009 at 2:39 PM, Martin Maechler
>> <maechler at stat.math.ethz.ch> wrote:
>>>
>>>>>>>> "SG" == Simone Giannerini <sgiannerini at gmail.com>
>>>>>>>>    on Thu, 8 Jan 2009 14:08:17 +0100 writes:
>>>
>>>   SG> Dear Mathieu, On Thu, Jan 8, 2009 at 12:14 PM, Mathieu
>>>   SG> Ribatet <mathieu.ribatet at epfl.ch> wrote:
>>>  >> Dear Simone,
>>>  >>
>>>  >> Did mean that the legend (text and/or box) overlap with
>>>  >> the Normal density?
>>>
>>>   SG> no, I mean that the two legend() commands, which are
>>>   SG> identical in all but the y-coordinates, produce
>>>   SG> different results, namely boxes with different widths.
>>>
>>> I don't see that behavior at all, rather the two boxes have
>>> identical dimensions for me.
>>>
>>> What does  dev.cur() say?  if anything with "X11..." (as you are
>>> on Linux),  what does
>>>
>>>  str(X11.options())
>>>
>>> give?
>>>
>>>
>>>   SG> Ciao
>>>
>>>   SG> Simone
>>>
>>>  >> If so then I think there's no problem as the legend is
>>>  >> placed where you told R to do. And R won't check (for
>>>  >> you) if it will overlap or not with pre-existing
>>>  >> graphical elements.
>>>  >>
>>>  >> On my computer, I got the expected results - if I
>>>  >> understood correctly your issue though. For information:
>>>  >>
>>>  >> R version 2.8.1 (2008-12-22) Linux mathieu-laptop
>>>  >> 2.6.27-11-generic #1 SMP Fri Dec 19 16:29:52 UTC 2008
>>>  >> i686 GNU/Linux (Ubuntu Intrepid)
>>>  >>
>>>  >> Cheers, Mathieu
>>>  >>
>>>  >> Simone Giannerini a ?crit :
>>>  >>>
>>>  >>> Dear all,
>>>  >>>
>>>  >>> there seems to be a problem with displayed legends when
>>>  >>> a multiple figure environment is used, see the following
>>>  >>> example:
>>>  >>>
>>>  >>> par(mfrow=c(1,2)) curve(dnorm,col=4,from=-4,to=4);
>>>  >>> legend(-4,0.3,legend="curve",lty=1,col=4)
>>>  >>> legend(-4,0.2,legend="curve",lty=1,col=4)
>>>  >>>
>>>  >>>
>>>  >>> On my machines the first time the command legend() is
>>>  >>> issued the legend box stretches over the
>>>  >>> curve. Subsequent calls to legend seems to produce a
>>>  >>> correct box instead.
>>>  >>>
>>>  >>> openSuse 11.0
>>>  >>>
>>>  >>> platform x86_64-unknown-linux-gnu arch x86_64 os
>>>  >>> linux-gnu system x86_64, linux-gnu status Patched major
>>>  >>> 2 minor 8.1 year 2009 month 01 day 07 svn rev 47501
>>>  >>> language R version.string R version 2.8.1 Patched
>>>  >>> (2009-01-07 r47501)
>>>  >>>
>>>  >>> I see this on the same version of R on Windows VISTA 32
>>>  >>> bit as well; I do not see this behaviour on a machine
>>>  >>> with R 2.8.0.
>>>  >>>
>>>  >>> Thank you,
>>>  >>>
>>>  >>> Simone
>>>  >>> --
>>>  >>> ______________________________________________________
>>>  >>>
>>>  >>> Simone Giannerini Dipartimento di Scienze Statistiche
>>>  >>> "Paolo Fortunati" Universita' di Bologna Via delle belle
>>>  >>> arti 41 - 40126 Bologna, ITALY Tel: +39 051 2098262 Fax:
>>>  >>> +39 051 232153 http://www2.stat.unibo.it/giannerini/
>>>  >>>
>>>  >>> ______________________________________________
>>>  >>> R-devel at r-project.org mailing list
>>>  >>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>  >>>
>>>  >>
>>>>
>>>> --
>>>> Institute of Mathematics Ecole Polytechnique F?d?rale de
>>>
>>>  >> Lausanne STAT-IMA-FSB-EPFL, Station 8 CH-1015 Lausanne
>>>  >> Switzerland http://stat.epfl.ch/ Tel: + 41 (0)21 693 7907
>>>  >>
>>>  >>
>>>  >>
>>>
>>>
>>>
>>> --
>>> ______________________________________________________
>>>
>>>   SG> Simone Giannerini Dipartimento di Scienze Statistiche
>>>   SG> "Paolo Fortunati" Universita' di Bologna Via delle belle
>>>   SG> arti 41 - 40126 Bologna, ITALY Tel: +39 051 2098262 Fax:
>>>   SG> +39 051 232153 http://www2.stat.unibo.it/giannerini/
>>>
>>>   SG> ______________________________________________
>>>   SG> R-devel at r-project.org mailing list
>>>   SG> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>>
>> --
>> ______________________________________________________
>>
>> Simone Giannerini
>> Dipartimento di Scienze Statistiche "Paolo Fortunati"
>> Universita' di Bologna
>> Via delle belle arti 41 - 40126  Bologna,  ITALY
>> Tel: +39 051 2098262  Fax: +39 051 232153
>> http://www2.stat.unibo.it/giannerini/
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595



-- 
______________________________________________________

Simone Giannerini
Dipartimento di Scienze Statistiche "Paolo Fortunati"
Universita' di Bologna
Via delle belle arti 41 - 40126  Bologna,  ITALY
Tel: +39 051 2098262  Fax: +39 051 232153
http://www2.stat.unibo.it/giannerini/


From behlingr at gmail.com  Thu Jan  8 17:01:22 2009
From: behlingr at gmail.com (behlingr at gmail.com)
Date: Thu, 08 Jan 2009 16:01:22 +0000
Subject: [Rd] File name determines success or failure of package
	installation -- please help
Message-ID: <0016361e7d948139b0045ffac095@google.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090108/dc7928fb/attachment.pl>

From ripley at stats.ox.ac.uk  Thu Jan  8 17:12:13 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 8 Jan 2009 16:12:13 +0000 (GMT)
Subject: [Rd] File name determines success or failure of package
 installation -- please help
In-Reply-To: <0016361e7d948139b0045ffac095@google.com>
References: <0016361e7d948139b0045ffac095@google.com>
Message-ID: <alpine.LFD.2.00.0901081607190.23195@auk.stats.ox.ac.uk>

The order of files does matter when your code has side effects (as here), 
and I guess you did not specify a Collation: field in the DESCRIPTION 
file.

The default order is alphabetic (in the C locale), which is not what you 
want here.

On Thu, 8 Jan 2009, behlingr at gmail.com wrote:

> Synopsis:
> I am trying to build and install a package in R, but I have run into a
> problem where the file names determine success or failure of the package
> installation. I started with a single file containing two class
> definitions. This package installs properly. If I split the classes into
> two files, the build fails. If I simply change the file name of one file
> with no other changes, the build and install then works properly.
>
> This does not seem to be proper behavior.

Why should the results not depend on the order of execution of R 
commands?

> I assume I am doing something wrong, but I have no idea how to debug or 
> fix this problem. Details are

How about looking in the manual ('Writing R Extensions')?

> shown below. I welcome all help and advice!!
> Ron
>
> General Information:
> R version: 2.8.1
> this is an installation of a precomplied version of R
> OS: Windows XP PRO SP2
>> Sys.getlocale()
> [1] "LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> States.1252;LC_MONETARY=English_United
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252"
>
> Details:
> In this example, I start with a file named "classSiteResourceCapacity.R"
> that contains the defintition of two classes shown below.
>
> file=classSiteResourceCapacity.R
> setClass("SiteResourceCapacity",
> representation(
> site = "character",
> siteResource = "character",
> studyResource = "character",
> capacity = "numeric",
> allocation = "matrix",
> priority = "matrix"
> )
> )
>
> setClass("RoleCapacity", representation(loadFactor="numeric"),
> contains="SiteResourceCapacity")
>
>
> The package (containing only this file) works when I run R CMD CHECK or R
> CMD INSTALL.
>
> However, when I seperate the classes into two files with the contents shown
> below (simply split the file contents, no additional changes), CHECK and
> INSTALL now fail as can be seen in the following output.
>
> file=classSiteResourceCapacity.R
> setClass("SiteResourceCapacity",
> representation(
> site = "character",
> siteResource = "character",
> studyResource = "character",
> capacity = "numeric",
> allocation = "matrix",
> priority = "matrix"
> )
> )
>
> file=classRoleCapacity.R
> setClass("RoleCapacity", representation(loadFactor="numeric"),
> contains="SiteResourceCapacity")
>
>
> C:\TEMP>dir Test\R
> Volume in drive C is WINXP
> Volume Serial Number is F893-77D5
>
> Directory of C:\TEMP\Test\R
>
> 01/08/2009 10:11 AM <DIR> .
> 01/08/2009 10:11 AM <DIR> ..
> 01/08/2009 09:54 AM 97 classRoleCapacity.R
> 01/08/2009 09:55 AM 749 classSiteResourceCapacity.R
> 2 File(s) 846 bytes
> 2 Dir(s) 58,195,402,752 bytes free
>
> C:\TEMP>R CMD CHECK Test
> * checking for working pdflatex ...pdflatex: not found
> NO
> * checking for working latex ...latex: not found
> NO
> * using log directory 'C:/TEMP/Test.Rcheck'
> * using R version 2.8.1 (2008-12-22)
> * using session charset: ISO8859-1
> * checking for file 'Test/DESCRIPTION' ... OK
> * this is package 'Test' version '0.1'
> * checking package dependencies ... OK
> * checking if this is a source package ... OK
> * checking for .dll and .exe files ... OK
> * checking whether package 'Test' can be installed ... ERROR
> Installation failed.
> See 'C:/TEMP/Test.Rcheck/00install.out' for details.
>
> C:\TEMP>cat 'C:/TEMP/Test.Rcheck/00install.out'
> installing R.css in C:/TEMP/Test.Rcheck
>
>
> ---------- Making package Test ------------
> adding build stamp to DESCRIPTION
> installing R files
> preparing package Test for lazy loading
> Error in reconcilePropertiesAndPrototype(name, slots, prototype,
> superClasses, :
> No definition was found for superclass "SiteResourceCapacity" in the
> specification of class "RoleCapacity"
> Calls: <Anonymous> ... makeClassRepresentation ->
> reconcilePropertiesAndPrototype
> Execution halted
> make[2]: *** [lazyload] Error 1
> make[1]: *** [all] Error 2
> make: *** [pkg-Test] Error 2
> *** Installation of Test failed ***
>
> Removing 'C:/TEMP/Test.Rcheck/Test'
>
> C:\TEMP>R CMD INSTALL Test
> installing to 'c:/PROGRA~1/R/R-2.8.1/library'
>
>
> ---------- Making package Test ------------
> adding build stamp to DESCRIPTION
> installing R files
> preparing package Test for lazy loading
> Error in reconcilePropertiesAndPrototype(name, slots, prototype,
> superClasses, :
> No definition was found for superclass "SiteResourceCapacity" in the
> specification of class "RoleCapacity"
> Calls: <Anonymous> ... makeClassRepresentation ->
> reconcilePropertiesAndPrototype
> Execution halted
> make[2]: *** [lazyload] Error 1
> make[1]: *** [all] Error 2
> make: *** [pkg-Test] Error 2
> *** Installation of Test failed ***
>
> Removing 'c:/PROGRA~1/R/R-2.8.1/library/Test'
> Restoring previous 'c:/PROGRA~1/R/R-2.8.1/library/Test'
>
> Then, if I simply change the name of the file "classSiteResourceCapacity.R"
> to "aR" , keeping the file "classRoleCapacity" and with no change to the
> contents of either file, the package will then pass the CHECK and INSTALL
> properly.
>
> C:\TEMP>dir Test\R
> Volume in drive C is WINXP
> Volume Serial Number is F893-77D5
>
> Directory of C:\TEMP\Test\R
>
> 01/08/2009 10:00 AM <DIR> .
> 01/08/2009 10:00 AM <DIR> ..
> 01/08/2009 09:55 AM 749 aR
> 01/08/2009 09:54 AM 97 classRoleCapacity.R
> 2 File(s) 846 bytes
> 2 Dir(s) 58,195,918,848 bytes free
>
> C:\TEMP>R CMD CHECK Test
> * checking for working pdflatex ...pdflatex: not found
> NO
> * checking for working latex ...latex: not found
> NO
> * using log directory 'C:/TEMP/Test.Rcheck'
> * using R version 2.8.1 (2008-12-22)
> * using session charset: ISO8859-1
> * checking for file 'Test/DESCRIPTION' ... OK
> * this is package 'Test' version '0.1'
> * checking package dependencies ... OK
> * checking if this is a source package ... OK
> * checking for .dll and .exe files ... OK
> * checking whether package 'Test' can be installed ... OK
> * checking package directory ... OK
> * checking for portable file names ... OK
> * checking DESCRIPTION meta-information ... OK
> * checking top-level files ... OK
> * checking index information ... OK
> * checking package subdirectories ... OK
> * checking R files for non-ASCII characters ... OK
> * checking R files for syntax errors ... OK
> * checking whether the package can be loaded ... OK
> * checking whether the package can be loaded with stated dependencies ... OK
> * checking for unstated dependencies in R code ... OK
> * checking S3 generic/method consistency ... OK
> * checking replacement functions ... OK
> * checking foreign function calls ... OK
> * checking R code for possible problems ... OK
> * checking for missing documentation entries ... WARNING
> Undocumented S4 classes:
> RoleCapacity SiteResourceCapacity
> All user-level objects in a package (including S4 classes and methods)
> should have documentation entries.
> See the chapter 'Writing R documentation files' in manual 'Writing R
> Extensions'.
>
> WARNING: There was 1 warning, see
> C:/TEMP/Test.Rcheck/00check.log
> for details
>
>
> C:\TEMP>R CMD INSTALL Test
> installing to 'c:/PROGRA~1/R/R-2.8.1/library'
>
>
> ---------- Making package Test ------------
> adding build stamp to DESCRIPTION
> installing R files
> preparing package Test for lazy loading
> no man files in this package
> installing indices
> installing help
> adding MD5 sums
>
> * DONE (Test)
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From torpedofisken at gmail.com  Fri Jan  9 09:12:23 2009
From: torpedofisken at gmail.com (torpedo fisken)
Date: Fri, 9 Jan 2009 09:12:23 +0100
Subject: [Rd] can't get names of R_env
In-Reply-To: <alpine.LFD.2.00.0901051026540.25721@auk.stats.ox.ac.uk>
References: <6b50a24c0901050214w2ac73bb8t635a65b261e47696@mail.gmail.com>
	<alpine.LFD.2.00.0901051026540.25721@auk.stats.ox.ac.uk>
Message-ID: <6b50a24c0901090012q4e4ac614ifd7d4110167fc35a@mail.gmail.com>

Thanks for your reply.

2009/1/5 Prof Brian Ripley <ripley at stats.ox.ac.uk>:
> You will have to read more carefully: an ENVSXP is nothing like a VECSXP,
> and does not have the names of its entries in a names attribute.
>
> You access variables in an environment via findVar() and friends, including
> findVarInFrame: see 'Writing R Extensions'.

Yes, I can see their implementation in src/main/envir.c.
But I'm still somewhat lost concerning the innerworkings of the .R <->
.c interface.
Especially the passing of the R_env parameter from R.

I'll try to explain what puzzles me as concisely as possible
-----------------------------------------------------
i.e
the optim() prototype is
optim <- function(par, fn, gr = NULL, ...,
                  method = c("Nelder-Mead", "BFGS", "CG", "L-BFGS-B", "SANN"),
                  lower = -Inf, upper = Inf,
                  control = list(), hessian = FALSE)

This makes an .Internal method call with
.Internal(optim(par, fn1, gr1, method, con, lower, upper))
This has seven args.

An by "src/names.c" this will use the do_optim() from src/main/optim.c
which has the following protype
SEXP attribute_hidden do_optim(SEXP call, SEXP op, SEXP args, SEXP rho);
This has 4 args.

According to the R-ints all .Internal that calls c-code will call
dispatchOrEval() in src/eval.c
http://cran.r-project.org/doc/manuals/R-ints.html#Argument-evaluation
But the arguments (there are 8), remains quite obscure for me.
And I'm having some problems tracking down the .Internal function
definition in the sourcetree.

Can someone clarify what happens in between .
.Internal(optim(...))  to do_optim(...)

Thanks again.

> On Mon, 5 Jan 2009, torpedo fisken wrote:
>
>> Hi,
>> I'm quite knew in R, so I might not have the R specific jargon.
>>
>> But here is my problem,
>> I'm trying to access and use variabels given by a function environment,
>> more specifically the rho in do_optim in src/main/optim.c
>
> Very likely this is not the way to do whatever it is that you really want to
> do.
>
>> According to the documentation
>> http://cran.r-project.org/doc/manuals/R-ints.html#The-_0027data_0027
>> the envsxp is defined as a tagged pairlist.
>>
>> "ENVSXP: Pointers to the frame, enclosing environment and hash table
>> (NULL or a VECSXP). A frame is a tagged pairlist with tag the symbol
>> and CAR the bound value."
>>
>> But I'm having troubles accessing the data.
>> I've written a small function called printNames that looks like
>> -----------------------
>> void printNames(SEXP list){
>>   SEXP names = getAttrib(list, R_NamesSymbol);
>>   int i;
>>   Rprintf("List is of length:%d\n",length(list));
>>   for (i = 0; i < length(list); i++)
>>     Rprintf("name of id:%d\t%s\n",i,CHAR(STRING_ELT(names, i)));
>> }
>> -----------------------
>> This is basicly just a copy of
>> -----------------------
>> static SEXP getListElement(SEXP list, char *str)
>> {
>>   SEXP elmt = R_NilValue, names = getAttrib(list, R_NamesSymbol);
>>   int i;
>>
>>   for (i = 0; i < length(list); i++)
>>        if (strcmp(CHAR(STRING_ELT(names, i)), str) == 0) {
>>            elmt = VECTOR_ELT(list, i);
>>            break;
>>        }
>>   return elmt;
>> }
>> -----------------------
>> But this crashes and looks like
>> -----------------------
>> List is of length:16
>> name of id:0    Xd???
>> name of id:1    Xd???
>> name of id:2
>> *** caught segfault ***
>> address 0x28, cause 'memory not mapped'
>> ------------------------
>> I've just added printNames(rho) in the very first line of do_optim().
>> Futhermore I've checked that the typeof(rho) corresponds to the
>>
>> #define ENVSXP       4 in Rinternals.h at line 84
>>
>> Can anyone clarify how to access these enviroment variables.
>> I believe my problem lies in the sentence "A frame is a tagged
>> pairlist with tag the symbol and CAR the bound value."
>> Or more precisely, I don't quite understand the struct for env exp
>> --------------------------
>> struct envsxp_struct {
>>   struct SEXPREC *frame;
>>   struct SEXPREC *enclos;
>>   struct SEXPREC *hashtab;
>> };
>> --------------------------
>>
>> thanks in advance.
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


From ripley at stats.ox.ac.uk  Fri Jan  9 10:25:15 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 9 Jan 2009 09:25:15 +0000 (GMT)
Subject: [Rd] More intensive checking of R help files
Message-ID: <alpine.OSX.1.00.0901090906520.74847@tystie.local>


We have been working on handling Rd (R help) files with R rather than 
Perl scripts.  As part of that work, Duncan has written a parser which 
has revealed many problems in package help files, and we have added 
its checks to 'R CMD check' in the R-devel version of R.

You can see the results for CRAN packages as part of the daily check 
at http://cran.r-project.org/web/checks/check_summary.html: they will 
show up as 'WARN' in the first two columns: click on the link to see 
the details for the package you are interested in.

The dialect of Rd markup for which the parser checks differs in some 
ways from that described previously: see 
http://developer.r-project.org/parseRd.pdf for a current description: 
however almost all the errors found are errors under the existing 
description in 'Writing R Extensions'.

The main difference is that \code is in the new version intended for 
valid R code and not fragments of R code or other languages (such as 
SQL).  This means that quotes (' " `) must balance inside \code, and 
that can lead to run-on errors (so if a parse error is found, quoted 
strings extending over more than one line are reported). \samp and 
where appropriate \kbd, \command, \options ... provide possible 
alternatives.

Another issue is that it was never intended to allow fragments of 
LaTeX in Rd files, and these only worked in latex (rather than text or 
HTML) conversion. Not all of these are parse errors, but they often 
lead to warnings about 'unknown macros'.  Using \eqn{} would resolve 
almost all of these and lead to more readable help.

The CRAN master will from now on be mentioning these warnings when 
handling submissions.

It would be helpful if package maintainers could look at and fix the 
errors as soon as possible.


Brian Ripley and Duncan Murdoch

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Fri Jan  9 10:51:01 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 9 Jan 2009 09:51:01 +0000 (GMT)
Subject: [Rd] can't get names of R_env
In-Reply-To: <6b50a24c0901090012q4e4ac614ifd7d4110167fc35a@mail.gmail.com>
References: <6b50a24c0901050214w2ac73bb8t635a65b261e47696@mail.gmail.com>
	<alpine.LFD.2.00.0901051026540.25721@auk.stats.ox.ac.uk>
	<6b50a24c0901090012q4e4ac614ifd7d4110167fc35a@mail.gmail.com>
Message-ID: <alpine.OSX.1.00.0901090933100.74890@tystie.local>

You are still misrepresenting the manual, which is discourteous to the 
altruistic people who wrote it.

You have still not explained why you 'need' help with internal parts 
of R that only R-core can exploit.  .Internal is a private interface: 
.External is the documented public version.

In the light of those, I suspect you will find the 'someone' who 'can 
clarify' unwilling to give free consultancy to someone who does not 
use a real name (real names are capitalized) nor a signature block.

On Fri, 9 Jan 2009, torpedo fisken wrote:

> Thanks for your reply.
>
> 2009/1/5 Prof Brian Ripley <ripley at stats.ox.ac.uk>:
>> You will have to read more carefully: an ENVSXP is nothing like a VECSXP,
>> and does not have the names of its entries in a names attribute.
>>
>> You access variables in an environment via findVar() and friends, including
>> findVarInFrame: see 'Writing R Extensions'.
>
> Yes, I can see their implementation in src/main/envir.c.
> But I'm still somewhat lost concerning the innerworkings of the .R <->
> .c interface.
> Especially the passing of the R_env parameter from R.
>
> I'll try to explain what puzzles me as concisely as possible
> -----------------------------------------------------
> i.e
> the optim() prototype is
> optim <- function(par, fn, gr = NULL, ...,
>                  method = c("Nelder-Mead", "BFGS", "CG", "L-BFGS-B", "SANN"),
>                  lower = -Inf, upper = Inf,
>                  control = list(), hessian = FALSE)
>
> This makes an .Internal method call with
> .Internal(optim(par, fn1, gr1, method, con, lower, upper))
> This has seven args.

Not so: it has one arguent, a call.

> An by "src/names.c" this will use the do_optim() from src/main/optim.c
> which has the following protype
> SEXP attribute_hidden do_optim(SEXP call, SEXP op, SEXP args, SEXP rho);
> This has 4 args.
>
> According to the R-ints all .Internal that calls c-code will call
> dispatchOrEval() in src/eval.c
> http://cran.r-project.org/doc/manuals/R-ints.html#Argument-evaluation

According to you, but not according to the manual.

> But the arguments (there are 8), remains quite obscure for me.
> And I'm having some problems tracking down the .Internal function
> definition in the sourcetree.
>
> Can someone clarify what happens in between .
> .Internal(optim(...))  to do_optim(...)
>
> Thanks again.
>
>> On Mon, 5 Jan 2009, torpedo fisken wrote:
>>
>>> Hi,
>>> I'm quite knew in R, so I might not have the R specific jargon.
>>>
>>> But here is my problem,
>>> I'm trying to access and use variabels given by a function environment,
>>> more specifically the rho in do_optim in src/main/optim.c
>>
>> Very likely this is not the way to do whatever it is that you really want to
>> do.
>>
>>> According to the documentation
>>> http://cran.r-project.org/doc/manuals/R-ints.html#The-_0027data_0027
>>> the envsxp is defined as a tagged pairlist.
>>>
>>> "ENVSXP: Pointers to the frame, enclosing environment and hash table
>>> (NULL or a VECSXP). A frame is a tagged pairlist with tag the symbol
>>> and CAR the bound value."
>>>
>>> But I'm having troubles accessing the data.
>>> I've written a small function called printNames that looks like
>>> -----------------------
>>> void printNames(SEXP list){
>>>   SEXP names = getAttrib(list, R_NamesSymbol);
>>>   int i;
>>>   Rprintf("List is of length:%d\n",length(list));
>>>   for (i = 0; i < length(list); i++)
>>>     Rprintf("name of id:%d\t%s\n",i,CHAR(STRING_ELT(names, i)));
>>> }
>>> -----------------------
>>> This is basicly just a copy of
>>> -----------------------
>>> static SEXP getListElement(SEXP list, char *str)
>>> {
>>>   SEXP elmt = R_NilValue, names = getAttrib(list, R_NamesSymbol);
>>>   int i;
>>>
>>>   for (i = 0; i < length(list); i++)
>>>        if (strcmp(CHAR(STRING_ELT(names, i)), str) == 0) {
>>>            elmt = VECTOR_ELT(list, i);
>>>            break;
>>>        }
>>>   return elmt;
>>> }
>>> -----------------------
>>> But this crashes and looks like
>>> -----------------------
>>> List is of length:16
>>> name of id:0    Xd???
>>> name of id:1    Xd???
>>> name of id:2
>>> *** caught segfault ***
>>> address 0x28, cause 'memory not mapped'
>>> ------------------------
>>> I've just added printNames(rho) in the very first line of do_optim().
>>> Futhermore I've checked that the typeof(rho) corresponds to the
>>>
>>> #define ENVSXP       4 in Rinternals.h at line 84
>>>
>>> Can anyone clarify how to access these enviroment variables.
>>> I believe my problem lies in the sentence "A frame is a tagged
>>> pairlist with tag the symbol and CAR the bound value."
>>> Or more precisely, I don't quite understand the struct for env exp
>>> --------------------------
>>> struct envsxp_struct {
>>>   struct SEXPREC *frame;
>>>   struct SEXPREC *enclos;
>>>   struct SEXPREC *hashtab;
>>> };
>>> --------------------------
>>>
>>> thanks in advance.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From lgautier at gmail.com  Fri Jan  9 14:01:14 2009
From: lgautier at gmail.com (Laurent Gautier)
Date: Fri, 09 Jan 2009 14:01:14 +0100
Subject: [Rd] Sending an interrupt signal to an embedded R
Message-ID: <49674A9A.6000109@gmail.com>

Dear List,

I am working on a Python-R interface in which an embedded R is used (rpy 
project on sourceforge).

I would like to allow the interruption of R computation through signals,
that is handle signals sent to the embedded R process while computing,
but I am unsure regarding what is currently the most appropriate 
approach. I have found threads on this list from up to two years ago, 
but there appeared to be some debating... making it difficult to choose 
on which end to start (platform-specific variability in the examples is 
also making it for a steep start).

Is there a documentation on the topic I would have missed ?

Thanks,


Laurent


From murdoch at stats.uwo.ca  Fri Jan  9 17:59:56 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 09 Jan 2009 11:59:56 -0500
Subject: [Rd] Firefox 3 and HTML Search
Message-ID: <4967828C.3030408@stats.uwo.ca>

I finally upgraded to Firefox 3.05 from 2.x, and now I can reproduce a 
bug a colleague has been complaining about but which I hadn't been able 
to reproduce before.  In Windows, set Firefox as the default browser. 
Then in Rgui (seems to affect all versions up to R-devel), use the menu 
to open HTML Help, and choose "Search Engine and Keywords".

Enter a keyword (e.g. plot), and click on "Search".

Things are a lot slower than they used to be with Firefox 2, but 
eventually I get a result, starting out

Search Results
The search string was "plot"

base-defunct
     Defunct Functions in Base Package
expression
     Unevaluated Expressions


However, the current URL is not the same as it was before:  it is now 
listed as

file:///<RHOME>/doc/html/index.html

so the links don't work:  they are entered as 
"../../../library/base/html/base-defunct.html", etc. in the source, and 
the expect the current directory to be

file:///<RHOME>/doc/html/search/

If I set Internet Explorer as my default browser (yuck), things are 
fine, so this is a Firefox 3 bug, or a new Java bug, or an R bug that 
was masked before.

Any suggestions of workarounds?

Duncan Murdoch


From ripley at stats.ox.ac.uk  Fri Jan  9 18:53:47 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 9 Jan 2009 17:53:47 +0000 (GMT)
Subject: [Rd] Firefox 3 and HTML Search
In-Reply-To: <4967828C.3030408@stats.uwo.ca>
References: <4967828C.3030408@stats.uwo.ca>
Message-ID: <alpine.OSX.1.00.0901091748560.5272@tystie.local>

Hmm, from NEWS

     o   help.search() has new argument 'searchEngine' to go
         directly to the search form: this is needed by users of
         Firefox 3 to workaround a bug in interpreting the search
         results pages.

and CHANGES (2.7.2)

     o   Rgui has a new menu item 'Html search page' on the Help menu,
         which goes directly to the HTML search form.  This is needed
         by users of Firefox 3, which generates incorrect links in
         search results when the page is accessed via the 'Html help'
         menu item (or via help.start()).

It is a Firefox bug, documented in the R-admin manual.


On Fri, 9 Jan 2009, Duncan Murdoch wrote:

> I finally upgraded to Firefox 3.05 from 2.x, and now I can reproduce a bug a 
> colleague has been complaining about but which I hadn't been able to 
> reproduce before.  In Windows, set Firefox as the default browser. Then in 
> Rgui (seems to affect all versions up to R-devel), use the menu to open HTML 
> Help, and choose "Search Engine and Keywords".
>
> Enter a keyword (e.g. plot), and click on "Search".
>
> Things are a lot slower than they used to be with Firefox 2, but eventually I 
> get a result, starting out
>
> Search Results
> The search string was "plot"
>
> base-defunct
>    Defunct Functions in Base Package
> expression
>    Unevaluated Expressions
>
>
> However, the current URL is not the same as it was before:  it is now listed 
> as
>
> file:///<RHOME>/doc/html/index.html
>
> so the links don't work:  they are entered as 
> "../../../library/base/html/base-defunct.html", etc. in the source, and the 
> expect the current directory to be
>
> file:///<RHOME>/doc/html/search/
>
> If I set Internet Explorer as my default browser (yuck), things are fine, so 
> this is a Firefox 3 bug, or a new Java bug, or an R bug that was masked 
> before.
>
> Any suggestions of workarounds?
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From marc_schwartz at comcast.net  Fri Jan  9 19:00:21 2009
From: marc_schwartz at comcast.net (Marc Schwartz)
Date: Fri, 09 Jan 2009 12:00:21 -0600
Subject: [Rd] Firefox 3 and HTML Search
In-Reply-To: <4967828C.3030408@stats.uwo.ca>
References: <4967828C.3030408@stats.uwo.ca>
Message-ID: <496790B5.4040707@comcast.net>

on 01/09/2009 10:59 AM Duncan Murdoch wrote:
> I finally upgraded to Firefox 3.05 from 2.x, and now I can reproduce a
> bug a colleague has been complaining about but which I hadn't been able
> to reproduce before.  In Windows, set Firefox as the default browser.
> Then in Rgui (seems to affect all versions up to R-devel), use the menu
> to open HTML Help, and choose "Search Engine and Keywords".
> 
> Enter a keyword (e.g. plot), and click on "Search".
> 
> Things are a lot slower than they used to be with Firefox 2, but
> eventually I get a result, starting out
> 
> Search Results
> The search string was "plot"
> 
> base-defunct
>     Defunct Functions in Base Package
> expression
>     Unevaluated Expressions
> 
> 
> However, the current URL is not the same as it was before:  it is now
> listed as
> 
> file:///<RHOME>/doc/html/index.html
> 
> so the links don't work:  they are entered as
> "../../../library/base/html/base-defunct.html", etc. in the source, and
> the expect the current directory to be
> 
> file:///<RHOME>/doc/html/search/
> 
> If I set Internet Explorer as my default browser (yuck), things are
> fine, so this is a Firefox 3 bug, or a new Java bug, or an R bug that
> was masked before.
> 
> Any suggestions of workarounds?
> 
> Duncan Murdoch

Duncan,

It is covered in R-Admin:

http://cran.r-project.org/doc/manuals/R-admin.html#Enabling-search-in-HTML-help


"There is a known issue with Firefox 3 (and 3.0.1). The links in the
results page may point to the wrong directory level. This is a bug in
the way Firefox is interpreting relative URLs, and can be circumvented
by opening the HTML search page (.../doc/html/SearchEngine.html)
directly rather than from .../doc/html/index.html as shown by help.start()."


and in ?help.start in the Note:

Note to users of Firefox 3: the search results have links that are
resolved incorrectly by that browser if starting from the normal HTML
index page. The workaround is to start with help.start(searchEngine = TRUE)


HTH,

Marc Schwartz


From guerrero.steve at gene.com  Fri Jan  9 22:04:54 2009
From: guerrero.steve at gene.com (Steve Guerrero)
Date: Fri, 09 Jan 2009 13:04:54 -0800
Subject: [Rd] forcing the use of the c++ linker with c++ and fortran sources
Message-ID: <4967BBF6.7010709@gene.com>


I'm trying to build a package which has both gfortran and c++ code.

In my installation of R, the R CMD INSTALL process compiles each c++ and 
gfortran code with the correct compiler, but performs the link step with 
"gfortran" and this creates undefined symbols at load time.

How does one override/force the use of a different command in the link 
step?  Is there an appropriate entry in Makevars that will do the trick?

Thanks,
-sg


From loris.bennett at fu-berlin.de  Fri Jan  9 14:10:06 2009
From: loris.bennett at fu-berlin.de (loris.bennett at fu-berlin.de)
Date: Fri,  9 Jan 2009 14:10:06 +0100 (CET)
Subject: [Rd] [R 2.8.1 on AIX 5.3] WARNING: tiffio.h: present but cannot be
	(PR#13440)
Message-ID: <20090109131007.11DFB282C769@mail.pubhealth.ku.dk>

Dear r-bugs,

With 

        AIX 5.3

and

     OBJECT_MODE=64
     CC="xlc -q64"
     CXX="g++ -maix64"

and

        ./configure --without-iconv --enable-R-shlib
        
the following warning occurs:

        configure: WARNING: tiffio.h: present but cannot be compiled
        configure: WARNING: tiffio.h:     check for missing prerequisite
        headers?
        configure: WARNING: tiffio.h: see the Autoconf documentation
        configure: WARNING: tiffio.h:     section "Present But Cannot Be
        Compiled"
        configure: WARNING: tiffio.h: proceeding with the preprocessor's
        result
        configure: WARNING: tiffio.h: in the future, the compiler will
        take precedence
        configure: WARNING:     ## -----------------------------------
        ##
        configure: WARNING:     ## Report this to r-bugs at R-project.org
        ##
        configure: WARNING:     ## -----------------------------------
        ##
        
Regards

Loris Bennett
        
-- 
Dr. Loris Bennett (Mr.)
Freie Universit??t Berlin
ZEDAT - Zentraleinrichtung f??r Datenverarbeitung / Computer Center
Compute & Media Service
Fabeckstr. 32, Room 221
D-14195 Berlin
Tel ++49 30 838 51024
Fax ++49 30 838 56721
Email loris.bennett at fu-berlin.de
Web www.zedat.fu-berlin.de


From ripley at stats.ox.ac.uk  Fri Jan  9 23:23:53 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 9 Jan 2009 22:23:53 +0000 (GMT)
Subject: [Rd] (PR#13440) [R 2.8.1 on AIX 5.3] WARNING: tiffio.h: present
 but cannot be
In-Reply-To: <20090109131007.11DFB282C769@mail.pubhealth.ku.dk>
References: <20090109131007.11DFB282C769@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0901092222260.14263@auk.stats.ox.ac.uk>

Why is this a bug in R?

I am afraid autoconf is pointing int the wrong place: you need to 
report this to your OS support, as it is an OS problem.

On Fri, 9 Jan 2009, loris.bennett at fu-berlin.de wrote:

> Dear r-bugs,
>
> With
>
>        AIX 5.3
>
> and
>
>     OBJECT_MODE=64
>     CC="xlc -q64"
>     CXX="g++ -maix64"
>
> and
>
>        ./configure --without-iconv --enable-R-shlib
>
> the following warning occurs:
>
>        configure: WARNING: tiffio.h: present but cannot be compiled
>        configure: WARNING: tiffio.h:     check for missing prerequisite
>        headers?
>        configure: WARNING: tiffio.h: see the Autoconf documentation
>        configure: WARNING: tiffio.h:     section "Present But Cannot Be
>        Compiled"
>        configure: WARNING: tiffio.h: proceeding with the preprocessor's
>        result
>        configure: WARNING: tiffio.h: in the future, the compiler will
>        take precedence
>        configure: WARNING:     ## -----------------------------------
>        ##
>        configure: WARNING:     ## Report this to r-bugs at R-project.org
>        ##
>        configure: WARNING:     ## -----------------------------------
>        ##
>
> Regards
>
> Loris Bennett
>
> -- 
> Dr. Loris Bennett (Mr.)
> Freie Universit??t Berlin
> ZEDAT - Zentraleinrichtung f??r Datenverarbeitung / Computer Center
> Compute & Media Service
> Fabeckstr. 32, Room 221
> D-14195 Berlin
> Tel ++49 30 838 51024
> Fax ++49 30 838 56721
> Email loris.bennett at fu-berlin.de
> Web www.zedat.fu-berlin.de
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From nikko at hailmail.net  Fri Jan  9 23:41:00 2009
From: nikko at hailmail.net (Nicholas Lewin-Koh)
Date: Fri, 09 Jan 2009 14:41:00 -0800
Subject: [Rd] NY Times article
In-Reply-To: <mailman.23.1231498804.5365.r-devel@r-project.org>
References: <mailman.23.1231498804.5365.r-devel@r-project.org>
Message-ID: <1231540860.15278.1293959281@webmail.messagingengine.com>

Hi,
Kudos, nice exposure, but to make this more appropriate to R-devel I
would just
like to make a small comment about the point made by the SAS executive
about getting
on an airplane yada yada ...

1) It would seem to me that R has certification documents
2) anyone designing airplanes, analyzing clinical trials, etc. had 
   better be worried about a lot more than whether their software is
   proprietary.

So from that point of view it would seem that R has made great strides
over 
the last 5 years especially in establishing a role for open source
software solutions in regulated/ commercial
environments. The question now is how to meld the archiac notions of
validation and 
and verification seen in industry with the very different model of open
source
development? Rather than the correctness of the software, in which I
think R is competitive,
it is how to deal with the rapid release cycles of R, and the
contributed packages.
We pull our hair out in pharma trying to figure out how we would ever
reconcile CRAN and validation requirements. I have no brilliant
soulution,
just food for thought

Nicholas
 ------------------------------
> 
> Message: 5
> Date: Thu, 8 Jan 2009 13:02:55 +0000 (GMT)
> From: Prof Brian Ripley <ripley at stats.ox.ac.uk>
> Subject:Re: [Rd]  NY Times article
> To: Anand Patil <anand.prabhakar.patil at gmail.com>
> Cc: r-devel at r-project.org
> Message-ID: <alpine.LFD.2.00.0901081258470.5529 at auk.stats.ox.ac.uk>
> Content-Type: TEXT/PLAIN; charset=US-ASCII; format=flowed
> 
> It has been all over R-help, in several threads.
> 
> https://stat.ethz.ch/pipermail/r-help/2009-January/184119.html
> https://stat.ethz.ch/pipermail/r-help/2009-January/184170.html
> https://stat.ethz.ch/pipermail/r-help/2009-January/184209.html
> https://stat.ethz.ch/pipermail/r-help/2009-January/184232.html
> https://stat.ethz.ch/pipermail/r-help/2009-January/184237.html
> 
> and more
> 
> On Thu, 8 Jan 2009, Anand Patil wrote:
> 
> > Sorry if this is spam, but I couldn't see it having popped up on the list
> > yet.
> > http://www.nytimes.com/2009/01/07/technology/business-computing/07program.html?emc=eta1
> >
> > Anand
> >
> > 	[[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


From krcoombes at mdacc.tmc.edu  Sat Jan 10 00:07:31 2009
From: krcoombes at mdacc.tmc.edu (Kevin R. Coombes)
Date: Fri, 09 Jan 2009 17:07:31 -0600
Subject: [Rd] NY Times article
In-Reply-To: <1231540860.15278.1293959281@webmail.messagingengine.com>
References: <mailman.23.1231498804.5365.r-devel@r-project.org>
	<1231540860.15278.1293959281@webmail.messagingengine.com>
Message-ID: <4967D8B3.7070304@mdacc.tmc.edu>

Hi Nicholas,

You raise a very good point. As an R user (who develops a couple of 
packages for our own local use), I sometimes find myself cringing in 
anticipation of a new R (or BioConductor) release. In my perception 
(which is almost certainly exaggerated, but that's why I emphasize that 
it is only an opinion), clever theoretical arguments in favor of 
structural changes have a tendency to outweigh practical considerations 
of backwards compatibility.

One of my own interests is in "reproducible research", and I've been 
pushing hard here at M.D. Anderson to get people to use Sweave to 
enhance the reproducibility of their own analyses. But, more often than 
I would like, I find that reports written in Sweave do not survive the 
transition from one version of R to the next, because either the core 
implementation or one of the packages they depend on has changed in some 
small but meaningful way.

For our own packages, we have been adding extensive regression testing 
to ensure that the same numbers come out of various computations, in 
order to see the effects of either the changes that we make or the 
changes in the packages we depend on.  But doing this in a nontrivial 
way with real data leads to test suites that take a long time to run, 
and so cannot be incorporated in the nightly builds used by CRAN.

We also encourage our analysts to include a "sessionInfo()" command in 
an appendix to each report so we are certain to document what versions 
of packages were used.

I suspect that the sort of validation you want will have to rely on an 
extensive regression suite test to make certain that the things you need 
remain stable from one release to another. That, and you'll have to be 
slow about upgrading (which may mean foregoing support from the mailing 
lists, where a common refrain in response to bug reports is that "you 
aren't using the latest and greatest version", without an appreciation 
of the fact that there can be good reasons for not changing something 
that you know works....).

Best,
	Kevin

Nicholas Lewin-Koh wrote:
> Hi,
> Kudos, nice exposure, but to make this more appropriate to R-devel I
> would just
> like to make a small comment about the point made by the SAS executive
> about getting
> on an airplane yada yada ...
> 
> 1) It would seem to me that R has certification documents
> 2) anyone designing airplanes, analyzing clinical trials, etc. had 
>    better be worried about a lot more than whether their software is
>    proprietary.
> 
> So from that point of view it would seem that R has made great strides
> over 
> the last 5 years especially in establishing a role for open source
> software solutions in regulated/ commercial
> environments. The question now is how to meld the archiac notions of
> validation and 
> and verification seen in industry with the very different model of open
> source
> development? Rather than the correctness of the software, in which I
> think R is competitive,
> it is how to deal with the rapid release cycles of R, and the
> contributed packages.
> We pull our hair out in pharma trying to figure out how we would ever
> reconcile CRAN and validation requirements. I have no brilliant
> soulution,
> just food for thought
> 
> Nicholas
>  ------------------------------
>> Message: 5
>> Date: Thu, 8 Jan 2009 13:02:55 +0000 (GMT)
>> From: Prof Brian Ripley <ripley at stats.ox.ac.uk>
>> Subject:Re: [Rd]  NY Times article
>> To: Anand Patil <anand.prabhakar.patil at gmail.com>
>> Cc: r-devel at r-project.org
>> Message-ID: <alpine.LFD.2.00.0901081258470.5529 at auk.stats.ox.ac.uk>
>> Content-Type: TEXT/PLAIN; charset=US-ASCII; format=flowed
>>
>> It has been all over R-help, in several threads.
>>
>> https://stat.ethz.ch/pipermail/r-help/2009-January/184119.html
>> https://stat.ethz.ch/pipermail/r-help/2009-January/184170.html
>> https://stat.ethz.ch/pipermail/r-help/2009-January/184209.html
>> https://stat.ethz.ch/pipermail/r-help/2009-January/184232.html
>> https://stat.ethz.ch/pipermail/r-help/2009-January/184237.html
>>
>> and more
>>
>> On Thu, 8 Jan 2009, Anand Patil wrote:
>>
>>> Sorry if this is spam, but I couldn't see it having popped up on the list
>>> yet.
>>> http://www.nytimes.com/2009/01/07/technology/business-computing/07program.html?emc=eta1
>>>
>>> Anand
>>>
>>> 	[[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>> -- 
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Sat Jan 10 01:33:42 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 09 Jan 2009 19:33:42 -0500
Subject: [Rd] forcing the use of the c++ linker with c++ and fortran
	sources
In-Reply-To: <4967BBF6.7010709@gene.com>
References: <4967BBF6.7010709@gene.com>
Message-ID: <4967ECE6.4090803@stats.uwo.ca>

On 09/01/2009 4:04 PM, Steve Guerrero wrote:
> I'm trying to build a package which has both gfortran and c++ code.
> 
> In my installation of R, the R CMD INSTALL process compiles each c++ and 
> gfortran code with the correct compiler, but performs the link step with 
> "gfortran" and this creates undefined symbols at load time.

You should offer more details:  what platform are you working on? What 
version of R? Do you have a simple example that people could try, and 
see the errors?

Duncan Murdoch

> 
> How does one override/force the use of a different command in the link 
> step?  Is there an appropriate entry in Makevars that will do the trick?
> 
> Thanks,
> -sg
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From guerrero.steve at gene.com  Sat Jan 10 02:31:18 2009
From: guerrero.steve at gene.com (Steve Guerrero)
Date: Fri, 09 Jan 2009 17:31:18 -0800
Subject: [Rd] forcing the use of the c++ linker with c++ and fortran
	sources
In-Reply-To: <4967ECE6.4090803@stats.uwo.ca>
References: <4967BBF6.7010709@gene.com> <4967ECE6.4090803@stats.uwo.ca>
Message-ID: <4967FA66.4060709@gene.com>


Sorry I was a little stingy with details.

I'm building a very simple package on linux with R 2.7.1
no configure script or homemade makefiles.
my src directory has two files:
src/foo.cpp
src/bar.f90

I run "R CMD install myproject " which runs fine, no errors, and 
produces a shared library

i.e.:
gfortran -fdefault-real-8 -ffixed-form -fpic -g -O2 -c  GLMnet.f90 -o 
bar.f90
g++ (all the right flags) -fpic  -g -O2 -c foo.cpp -o foo.o

and the link step:

gfortran -shared -L/usr/local/lib64 -o myproject.so baro foo.o 
-L/apps/R/R-2.7.1/x86_64-linux-2.6/lib64/R/lib -lR


The build goes fine, the problem is when I load the library I get this 
error:
library(myproject)
Error in dyn.load(file, DLLpath = DLLpath, ...) :
   unable to load shared library myproject.so
   undefined symbol: __gxx_personality_v0
Error: package/namespace load failed for 'myproject'

If I manually run the link step with g++ instead of gfortran, the 
library loads fine, everything works.

I need to tell the R build process to not link with gfortran but to link 
with g++ in my mixed c++ and fortran scenario.  A little digging into 
the R SHLIB build script suggests that I probably can't override it 
without cooking up my Makefiles

Here's an excerpt from the R SHLIB script:

makeargs="SHLIB=\"${shlib}\""
if ${with_f9x}; then
     makeargs="SHLIB_LDFLAGS='\$(SHLIB_FCLDFLAGS)' ${makeargs}"
     makeargs="SHLIB_LD='\$(SHLIB_FCLD)' ${makeargs}"
else
   if ${with_cxx}; then
     makeargs="SHLIB_LDFLAGS='\$(SHLIB_CXXLDFLAGS)' ${makeargs}"
     makeargs="SHLIB_LD='\$(SHLIB_CXXLD)' ${makeargs}"
   fi
   if ${with_f77}; then
     if ${with_objc}; then
       shlib_libadd="\$(OBJC_LIBS) ${shlib_libadd}"
     fi
     if test -z "${shlib_libadd}"; then
       makeargs="${makeargs} SHLIB_LIBADD='\$(FLIBS)'"
     else
       makeargs="${makeargs} SHLIB_LIBADD='\$(FLIBS) ${shlib_libadd}'"
     fi
   else
     if ${with_objc}; then
       makeargs="${makeargs} SHLIB_LIBADD='\$(OBJC_LIBS)'"
     fi
   fi
fi

This logic seems to suggest that if there are fortran95 sources, the LD 
command will be SHLIB_FCLD...with no apparent way to override it.

Am I mistaken?

Thanks,
-sg

Duncan Murdoch wrote:
> On 09/01/2009 4:04 PM, Steve Guerrero wrote:
>> I'm trying to build a package which has both gfortran and c++ code.
>>
>> In my installation of R, the R CMD INSTALL process compiles each c++ 
>> and gfortran code with the correct compiler, but performs the link 
>> step with "gfortran" and this creates undefined symbols at load time.
> 
> You should offer more details:  what platform are you working on? What 
> version of R? Do you have a simple example that people could try, and 
> see the errors?
> 
> Duncan Murdoch
> 
>>
>> How does one override/force the use of a different command in the link 
>> step?  Is there an appropriate entry in Makevars that will do the trick?
>>
>> Thanks,
>> -sg
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From ripley at stats.ox.ac.uk  Sat Jan 10 08:49:48 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 10 Jan 2009 07:49:48 +0000 (GMT)
Subject: [Rd] forcing the use of the c++ linker with c++ and fortran
 sources
In-Reply-To: <4967FA66.4060709@gene.com>
References: <4967BBF6.7010709@gene.com> <4967ECE6.4090803@stats.uwo.ca>
	<4967FA66.4060709@gene.com>
Message-ID: <alpine.OSX.1.00.0901100734530.30461@tystie.local>

You are correct: there is no reason to assume that the F90 compiler 
can link C++ nor that the C++ compiler can link F90, and in general 
they cannot.  Quite a few systems have a different vendor's F9x 
compiler (including say g95 vs gcc3 and SunPro F9x vs gcc4).

Even in a pure gcc4 scenario, each of F9x and C++ needs additional 
libaries and R does not know what they are (it only does for F77). 
So if linking by g++ works for you, it is fortuitous and not portable.

I suspect adding -lstdc++ will work for you, which you can do via 
PKG_LIBS in a Makevars file.

Bottom line: you are asking to do something known not to be portable. 
You can use a Makefile to have complete freedom, but please don't 
distribute such a package without a configure script to check out all 
the assumptions.

On Fri, 9 Jan 2009, Steve Guerrero wrote:

>
> Sorry I was a little stingy with details.
>
> I'm building a very simple package on linux with R 2.7.1

Still no details of compilers etc.

> no configure script or homemade makefiles.
> my src directory has two files:
> src/foo.cpp
> src/bar.f90
>
> I run "R CMD install myproject " which runs fine, no errors, and produces a 
> shared library
>
> i.e.:
> gfortran -fdefault-real-8 -ffixed-form -fpic -g -O2 -c  GLMnet.f90 -o bar.f90
> g++ (all the right flags) -fpic  -g -O2 -c foo.cpp -o foo.o
>
> and the link step:
>
> gfortran -shared -L/usr/local/lib64 -o myproject.so baro foo.o 
> -L/apps/R/R-2.7.1/x86_64-linux-2.6/lib64/R/lib -lR
>
>
> The build goes fine, the problem is when I load the library I get this error:
> library(myproject)
> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>  unable to load shared library myproject.so
>  undefined symbol: __gxx_personality_v0
> Error: package/namespace load failed for 'myproject'
>
> If I manually run the link step with g++ instead of gfortran, the library 
> loads fine, everything works.
>
> I need to tell the R build process to not link with gfortran but to link with 
> g++ in my mixed c++ and fortran scenario.  A little digging into the R SHLIB 
> build script suggests that I probably can't override it without cooking up my 
> Makefiles
>
> Here's an excerpt from the R SHLIB script:
>
> makeargs="SHLIB=\"${shlib}\""
> if ${with_f9x}; then
>    makeargs="SHLIB_LDFLAGS='\$(SHLIB_FCLDFLAGS)' ${makeargs}"
>    makeargs="SHLIB_LD='\$(SHLIB_FCLD)' ${makeargs}"
> else
>  if ${with_cxx}; then
>    makeargs="SHLIB_LDFLAGS='\$(SHLIB_CXXLDFLAGS)' ${makeargs}"
>    makeargs="SHLIB_LD='\$(SHLIB_CXXLD)' ${makeargs}"
>  fi
>  if ${with_f77}; then
>    if ${with_objc}; then
>      shlib_libadd="\$(OBJC_LIBS) ${shlib_libadd}"
>    fi
>    if test -z "${shlib_libadd}"; then
>      makeargs="${makeargs} SHLIB_LIBADD='\$(FLIBS)'"
>    else
>      makeargs="${makeargs} SHLIB_LIBADD='\$(FLIBS) ${shlib_libadd}'"
>    fi
>  else
>    if ${with_objc}; then
>      makeargs="${makeargs} SHLIB_LIBADD='\$(OBJC_LIBS)'"
>    fi
>  fi
> fi
>
> This logic seems to suggest that if there are fortran95 sources, the LD 
> command will be SHLIB_FCLD...with no apparent way to override it.
>
> Am I mistaken?
>
> Thanks,
> -sg
>
> Duncan Murdoch wrote:
>> On 09/01/2009 4:04 PM, Steve Guerrero wrote:
>>> I'm trying to build a package which has both gfortran and c++ code.
>>> 
>>> In my installation of R, the R CMD INSTALL process compiles each c++ and 
>>> gfortran code with the correct compiler, but performs the link step with 
>>> "gfortran" and this creates undefined symbols at load time.
>> 
>> You should offer more details:  what platform are you working on? What 
>> version of R? Do you have a simple example that people could try, and see 
>> the errors?
>> 
>> Duncan Murdoch
>> 
>>> 
>>> How does one override/force the use of a different command in the link 
>>> step?  Is there an appropriate entry in Makevars that will do the trick?
>>> 
>>> Thanks,
>>> -sg
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From nikko at hailmail.net  Sat Jan 10 20:19:39 2009
From: nikko at hailmail.net (Nicholas Lewin-Koh)
Date: Sat, 10 Jan 2009 11:19:39 -0800
Subject: [Rd] NY Times article
In-Reply-To: <4967D8B3.7070304@mdacc.tmc.edu>
References: <mailman.23.1231498804.5365.r-devel@r-project.org>
	<1231540860.15278.1293959281@webmail.messagingengine.com>
	<4967D8B3.7070304@mdacc.tmc.edu>
Message-ID: <1231615179.27529.1294051939@webmail.messagingengine.com>

Hi,
Unfortunately one of the the cornerstones of the validation paradigm
in the clinical world (as I understand it) is that
consistency/repeatability,
documentation (of the programs consistency and maintenance) and
adherence to regulatory
requirements take supremacy even ironically over correctness. So you
still
get ridiculous requirements from regulatory bodies like type III sums of
squares, Last observation carried forward, etc. These edifices are
very hard to change, I know of people who have worked their whole
careers just to get the FDA to allow other treatment of missing data.

So what does this have to do with R? This comes down to the point
you made below about the R development cycle incorporating bug fixes
into new releases, and not supporting old versions. I think this has 
been rehashed many times, and is not likely to change. So how to
move R into the clinic? From a practical perspective all the
development and interoperability features of R are very nice,
but how to maintain things in a way that if the underlying
R platform changes the tool or method does not, and furthermore 
how to manage this in a cost effective way so that it can't
be argued that it is cheaper to pay for SAS???

These are not necessarily questions that R core has to answer,
as the burden of proof of validation is really in the hands of the 
company/organization doing the submission. We just like to pretend that
the large price we pay for our SAS support means we can shift liability
:)

Rambling again,
Nicholas


On Fri, 09 Jan 2009 17:07:31 -0600, "Kevin R. Coombes"
<krcoombes at mdacc.tmc.edu> said:
> Hi Nicholas,
> 
> You raise a very good point. As an R user (who develops a couple of 
> packages for our own local use), I sometimes find myself cringing in 
> anticipation of a new R (or BioConductor) release. In my perception 
> (which is almost certainly exaggerated, but that's why I emphasize that 
> it is only an opinion), clever theoretical arguments in favor of 
> structural changes have a tendency to outweigh practical considerations 
> of backwards compatibility.
> 
> One of my own interests is in "reproducible research", and I've been 
> pushing hard here at M.D. Anderson to get people to use Sweave to 
> enhance the reproducibility of their own analyses. But, more often than 
> I would like, I find that reports written in Sweave do not survive the 
> transition from one version of R to the next, because either the core 
> implementation or one of the packages they depend on has changed in some 
> small but meaningful way.
> 
> For our own packages, we have been adding extensive regression testing 
> to ensure that the same numbers come out of various computations, in 
> order to see the effects of either the changes that we make or the 
> changes in the packages we depend on.  But doing this in a nontrivial 
> way with real data leads to test suites that take a long time to run, 
> and so cannot be incorporated in the nightly builds used by CRAN.
> 
> We also encourage our analysts to include a "sessionInfo()" command in 
> an appendix to each report so we are certain to document what versions 
> of packages were used.
> 
> I suspect that the sort of validation you want will have to rely on an 
> extensive regression suite test to make certain that the things you need 
> remain stable from one release to another. That, and you'll have to be 
> slow about upgrading (which may mean foregoing support from the mailing 
> lists, where a common refrain in response to bug reports is that "you 
> aren't using the latest and greatest version", without an appreciation 
> of the fact that there can be good reasons for not changing something 
> that you know works....).
> 
> Best,
> 	Kevin
> 
> Nicholas Lewin-Koh wrote:
> > Hi,
> > Kudos, nice exposure, but to make this more appropriate to R-devel I
> > would just
> > like to make a small comment about the point made by the SAS executive
> > about getting
> > on an airplane yada yada ...
> > 
> > 1) It would seem to me that R has certification documents
> > 2) anyone designing airplanes, analyzing clinical trials, etc. had 
> >    better be worried about a lot more than whether their software is
> >    proprietary.
> > 
> > So from that point of view it would seem that R has made great strides
> > over 
> > the last 5 years especially in establishing a role for open source
> > software solutions in regulated/ commercial
> > environments. The question now is how to meld the archiac notions of
> > validation and 
> > and verification seen in industry with the very different model of open
> > source
> > development? Rather than the correctness of the software, in which I
> > think R is competitive,
> > it is how to deal with the rapid release cycles of R, and the
> > contributed packages.
> > We pull our hair out in pharma trying to figure out how we would ever
> > reconcile CRAN and validation requirements. I have no brilliant
> > soulution,
> > just food for thought
> > 
> > Nicholas
> >  ------------------------------
> >> Message: 5
> >> Date: Thu, 8 Jan 2009 13:02:55 +0000 (GMT)
> >> From: Prof Brian Ripley <ripley at stats.ox.ac.uk>
> >> Subject:Re: [Rd]  NY Times article
> >> To: Anand Patil <anand.prabhakar.patil at gmail.com>
> >> Cc: r-devel at r-project.org
> >> Message-ID: <alpine.LFD.2.00.0901081258470.5529 at auk.stats.ox.ac.uk>
> >> Content-Type: TEXT/PLAIN; charset=US-ASCII; format=flowed
> >>
> >> It has been all over R-help, in several threads.
> >>
> >> https://stat.ethz.ch/pipermail/r-help/2009-January/184119.html
> >> https://stat.ethz.ch/pipermail/r-help/2009-January/184170.html
> >> https://stat.ethz.ch/pipermail/r-help/2009-January/184209.html
> >> https://stat.ethz.ch/pipermail/r-help/2009-January/184232.html
> >> https://stat.ethz.ch/pipermail/r-help/2009-January/184237.html
> >>
> >> and more
> >>
> >> On Thu, 8 Jan 2009, Anand Patil wrote:
> >>
> >>> Sorry if this is spam, but I couldn't see it having popped up on the list
> >>> yet.
> >>> http://www.nytimes.com/2009/01/07/technology/business-computing/07program.html?emc=eta1
> >>>
> >>> Anand
> >>>
> >>> 	[[alternative HTML version deleted]]
> >>>
> >>> ______________________________________________
> >>> R-devel at r-project.org mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>>
> >> -- 
> >> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> >> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> >> University of Oxford,             Tel:  +44 1865 272861 (self)
> >> 1 South Parks Road,                     +44 1865 272866 (PA)
> >> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> >>
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel


From jwb1970 at gmail.com  Sat Jan 10 20:52:47 2009
From: jwb1970 at gmail.com (Jb)
Date: Sat, 10 Jan 2009 13:52:47 -0600
Subject: [Rd] NY Times article
In-Reply-To: <1231615179.27529.1294051939@webmail.messagingengine.com>
References: <mailman.23.1231498804.5365.r-devel@r-project.org>
	<1231540860.15278.1293959281@webmail.messagingengine.com>
	<4967D8B3.7070304@mdacc.tmc.edu>
	<1231615179.27529.1294051939@webmail.messagingengine.com>
Message-ID: <9CD0FD71-D3C6-4499-B4E9-FE81EA581FBD@gmail.com>

Hi all,
One relatively easy solution is to include R and all relevant versions  
of packages used in (a) a reproduction archive and/or (b) packaged  
inside a virtual machine. With storage space cheap and sources of both  
R and packages available (and easy free crossplatform virtual machine  
solutions and Linux) one can distribute not only ones own code and  
data but also all that was required to do the analyses down to the OS.

So far in our own work we've just included relevant package versions  
but we will probably start include R as well for next projects.

Hope this brainstorm helps (and credit to Ben Hansen and Mark  
Fredrickson for these ideas).

Jake

Jake Bowers
http://jakebowers.org

On Jan 10, 2009, at 1:19 PM, "Nicholas Lewin-Koh" <nikko at hailmail.net>  
wrote:

> Hi,
> Unfortunately one of the the cornerstones of the validation paradigm
> in the clinical world (as I understand it) is that
> consistency/repeatability,
> documentation (of the programs consistency and maintenance) and
> adherence to regulatory
> requirements take supremacy even ironically over correctness. So you
> still
> get ridiculous requirements from regulatory bodies like type III  
> sums of
> squares, Last observation carried forward, etc. These edifices are
> very hard to change, I know of people who have worked their whole
> careers just to get the FDA to allow other treatment of missing data.
>
> So what does this have to do with R? This comes down to the point
> you made below about the R development cycle incorporating bug fixes
> into new releases, and not supporting old versions. I think this has
> been rehashed many times, and is not likely to change. So how to
> move R into the clinic? From a practical perspective all the
> development and interoperability features of R are very nice,
> but how to maintain things in a way that if the underlying
> R platform changes the tool or method does not, and furthermore
> how to manage this in a cost effective way so that it can't
> be argued that it is cheaper to pay for SAS???
>
> These are not necessarily questions that R core has to answer,
> as the burden of proof of validation is really in the hands of the
> company/organization doing the submission. We just like to pretend  
> that
> the large price we pay for our SAS support means we can shift  
> liability
> :)
>
> Rambling again,
> Nicholas
>
>
> On Fri, 09 Jan 2009 17:07:31 -0600, "Kevin R. Coombes"
> <krcoombes at mdacc.tmc.edu> said:
>> Hi Nicholas,
>>
>> You raise a very good point. As an R user (who develops a couple of
>> packages for our own local use), I sometimes find myself cringing in
>> anticipation of a new R (or BioConductor) release. In my perception
>> (which is almost certainly exaggerated, but that's why I emphasize  
>> that
>> it is only an opinion), clever theoretical arguments in favor of
>> structural changes have a tendency to outweigh practical  
>> considerations
>> of backwards compatibility.
>>
>> One of my own interests is in "reproducible research", and I've been
>> pushing hard here at M.D. Anderson to get people to use Sweave to
>> enhance the reproducibility of their own analyses. But, more often  
>> than
>> I would like, I find that reports written in Sweave do not survive  
>> the
>> transition from one version of R to the next, because either the core
>> implementation or one of the packages they depend on has changed in  
>> some
>> small but meaningful way.
>>
>> For our own packages, we have been adding extensive regression  
>> testing
>> to ensure that the same numbers come out of various computations, in
>> order to see the effects of either the changes that we make or the
>> changes in the packages we depend on.  But doing this in a nontrivial
>> way with real data leads to test suites that take a long time to run,
>> and so cannot be incorporated in the nightly builds used by CRAN.
>>
>> We also encourage our analysts to include a "sessionInfo()" command  
>> in
>> an appendix to each report so we are certain to document what  
>> versions
>> of packages were used.
>>
>> I suspect that the sort of validation you want will have to rely on  
>> an
>> extensive regression suite test to make certain that the things you  
>> need
>> remain stable from one release to another. That, and you'll have to  
>> be
>> slow about upgrading (which may mean foregoing support from the  
>> mailing
>> lists, where a common refrain in response to bug reports is that "you
>> aren't using the latest and greatest version", without an  
>> appreciation
>> of the fact that there can be good reasons for not changing something
>> that you know works....).
>>
>> Best,
>>    Kevin
>>
>> Nicholas Lewin-Koh wrote:
>>> Hi,
>>> Kudos, nice exposure, but to make this more appropriate to R-devel I
>>> would just
>>> like to make a small comment about the point made by the SAS  
>>> executive
>>> about getting
>>> on an airplane yada yada ...
>>>
>>> 1) It would seem to me that R has certification documents
>>> 2) anyone designing airplanes, analyzing clinical trials, etc. had
>>>   better be worried about a lot more than whether their software is
>>>   proprietary.
>>>
>>> So from that point of view it would seem that R has made great  
>>> strides
>>> over
>>> the last 5 years especially in establishing a role for open source
>>> software solutions in regulated/ commercial
>>> environments. The question now is how to meld the archiac notions of
>>> validation and
>>> and verification seen in industry with the very different model of  
>>> open
>>> source
>>> development? Rather than the correctness of the software, in which I
>>> think R is competitive,
>>> it is how to deal with the rapid release cycles of R, and the
>>> contributed packages.
>>> We pull our hair out in pharma trying to figure out how we would  
>>> ever
>>> reconcile CRAN and validation requirements. I have no brilliant
>>> soulution,
>>> just food for thought
>>>
>>> Nicholas
>>> ------------------------------
>>>> Message: 5
>>>> Date: Thu, 8 Jan 2009 13:02:55 +0000 (GMT)
>>>> From: Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>> Subject:Re: [Rd]  NY Times article
>>>> To: Anand Patil <anand.prabhakar.patil at gmail.com>
>>>> Cc: r-devel at r-project.org
>>>> Message-ID: <alpine.LFD.2.00.0901081258470.5529 at auk.stats.ox.ac.uk>
>>>> Content-Type: TEXT/PLAIN; charset=US-ASCII; format=flowed
>>>>
>>>> It has been all over R-help, in several threads.
>>>>
>>>> https://stat.ethz.ch/pipermail/r-help/2009-January/184119.html
>>>> https://stat.ethz.ch/pipermail/r-help/2009-January/184170.html
>>>> https://stat.ethz.ch/pipermail/r-help/2009-January/184209.html
>>>> https://stat.ethz.ch/pipermail/r-help/2009-January/184232.html
>>>> https://stat.ethz.ch/pipermail/r-help/2009-January/184237.html
>>>>
>>>> and more
>>>>
>>>> On Thu, 8 Jan 2009, Anand Patil wrote:
>>>>
>>>>> Sorry if this is spam, but I couldn't see it having popped up on  
>>>>> the list
>>>>> yet.
>>>>> http://www.nytimes.com/2009/01/07/technology/business-computing/07program.html?emc=eta1
>>>>>
>>>>> Anand
>>>>>
>>>>>    [[alternative HTML version deleted]]
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>> -- 
>>>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>>>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/ 
>>>> ~ripley/
>>>> University of Oxford,             Tel:  +44 1865 272861 (self)
>>>> 1 South Parks Road,                     +44 1865 272866 (PA)
>>>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From spencer.graves at pdf.com  Sat Jan 10 22:06:31 2009
From: spencer.graves at pdf.com (Spencer Graves)
Date: Sat, 10 Jan 2009 13:06:31 -0800
Subject: [Rd] code validation (was Re:  NY Times article)
In-Reply-To: <9CD0FD71-D3C6-4499-B4E9-FE81EA581FBD@gmail.com>
References: <mailman.23.1231498804.5365.r-devel@r-project.org>	<1231540860.15278.1293959281@webmail.messagingengine.com>	<4967D8B3.7070304@mdacc.tmc.edu>	<1231615179.27529.1294051939@webmail.messagingengine.com>
	<9CD0FD71-D3C6-4499-B4E9-FE81EA581FBD@gmail.com>
Message-ID: <49690DD7.1080808@pdf.com>

Hi, All: 

      What support exists for 'regression testing' 
(http://en.wikipedia.org/wiki/Regression_testing) of R code, e.g., as 
part of the "R CMD check" process? 

      The"RUnit" package supports "unit testing" 
(http://en.wikipedia.org/wiki/Unit_testing). 

      Those concerned about software quality of code they use regularly 
could easily develop their own "softwareChecks" package that runs unit 
tests in the "\examples".  Then each time a new version of the package 
and / or R is downloaded, you can do "R CMD check" of your 
"softwareChecks":  If it passes, you know that it passed all your checks. 


      I have not used "RUnit", but I've done similar things computing 
the same object two ways then doing "stopifnot(all.equal(obj1, obj2))".  
I think the value of the help page is enhanced by showing the 
"all.equal" but not the "stopifnot".  I achieve this using "\dontshow" 
as follows: 


           obj1 <- ...
           obj2 <- ...
           \dontshow{stopifnot(}
           all.equal(obj1, obj2)
           \dontshow{)}. 


      Examples of this are contained, for example, in "fRegress.Rd" in 
the current "fda" package available from CRAN or R-Forge. 


      Best Wishes,
      Spencer

Jb wrote:
> Hi all,
> One relatively easy solution is to include R and all relevant versions 
> of packages used in (a) a reproduction archive and/or (b) packaged 
> inside a virtual machine. With storage space cheap and sources of both 
> R and packages available (and easy free crossplatform virtual machine 
> solutions and Linux) one can distribute not only ones own code and 
> data but also all that was required to do the analyses down to the OS.
>
> So far in our own work we've just included relevant package versions 
> but we will probably start include R as well for next projects.
>
> Hope this brainstorm helps (and credit to Ben Hansen and Mark 
> Fredrickson for these ideas).
>
> Jake
>
> Jake Bowers
> http://jakebowers.org
>
> On Jan 10, 2009, at 1:19 PM, "Nicholas Lewin-Koh" <nikko at hailmail.net> 
> wrote:
>
>> Hi,
>> Unfortunately one of the the cornerstones of the validation paradigm
>> in the clinical world (as I understand it) is that
>> consistency/repeatability,
>> documentation (of the programs consistency and maintenance) and
>> adherence to regulatory
>> requirements take supremacy even ironically over correctness. So you
>> still
>> get ridiculous requirements from regulatory bodies like type III sums of
>> squares, Last observation carried forward, etc. These edifices are
>> very hard to change, I know of people who have worked their whole
>> careers just to get the FDA to allow other treatment of missing data.
>>
>> So what does this have to do with R? This comes down to the point
>> you made below about the R development cycle incorporating bug fixes
>> into new releases, and not supporting old versions. I think this has
>> been rehashed many times, and is not likely to change. So how to
>> move R into the clinic? From a practical perspective all the
>> development and interoperability features of R are very nice,
>> but how to maintain things in a way that if the underlying
>> R platform changes the tool or method does not, and furthermore
>> how to manage this in a cost effective way so that it can't
>> be argued that it is cheaper to pay for SAS???
>>
>> These are not necessarily questions that R core has to answer,
>> as the burden of proof of validation is really in the hands of the
>> company/organization doing the submission. We just like to pretend that
>> the large price we pay for our SAS support means we can shift liability
>> :)
>>
>> Rambling again,
>> Nicholas
>>
>>
>> On Fri, 09 Jan 2009 17:07:31 -0600, "Kevin R. Coombes"
>> <krcoombes at mdacc.tmc.edu> said:
>>> Hi Nicholas,
>>>
>>> You raise a very good point. As an R user (who develops a couple of
>>> packages for our own local use), I sometimes find myself cringing in
>>> anticipation of a new R (or BioConductor) release. In my perception
>>> (which is almost certainly exaggerated, but that's why I emphasize that
>>> it is only an opinion), clever theoretical arguments in favor of
>>> structural changes have a tendency to outweigh practical considerations
>>> of backwards compatibility.
>>>
>>> One of my own interests is in "reproducible research", and I've been
>>> pushing hard here at M.D. Anderson to get people to use Sweave to
>>> enhance the reproducibility of their own analyses. But, more often than
>>> I would like, I find that reports written in Sweave do not survive the
>>> transition from one version of R to the next, because either the core
>>> implementation or one of the packages they depend on has changed in 
>>> some
>>> small but meaningful way.
>>>
>>> For our own packages, we have been adding extensive regression testing
>>> to ensure that the same numbers come out of various computations, in
>>> order to see the effects of either the changes that we make or the
>>> changes in the packages we depend on.  But doing this in a nontrivial
>>> way with real data leads to test suites that take a long time to run,
>>> and so cannot be incorporated in the nightly builds used by CRAN.
>>>
>>> We also encourage our analysts to include a "sessionInfo()" command in
>>> an appendix to each report so we are certain to document what versions
>>> of packages were used.
>>>
>>> I suspect that the sort of validation you want will have to rely on an
>>> extensive regression suite test to make certain that the things you 
>>> need
>>> remain stable from one release to another. That, and you'll have to be
>>> slow about upgrading (which may mean foregoing support from the mailing
>>> lists, where a common refrain in response to bug reports is that "you
>>> aren't using the latest and greatest version", without an appreciation
>>> of the fact that there can be good reasons for not changing something
>>> that you know works....).
>>>
>>> Best,
>>>    Kevin
>>>
>>> Nicholas Lewin-Koh wrote:
>>>> Hi,
>>>> Kudos, nice exposure, but to make this more appropriate to R-devel I
>>>> would just
>>>> like to make a small comment about the point made by the SAS executive
>>>> about getting
>>>> on an airplane yada yada ...
>>>>
>>>> 1) It would seem to me that R has certification documents
>>>> 2) anyone designing airplanes, analyzing clinical trials, etc. had
>>>>   better be worried about a lot more than whether their software is
>>>>   proprietary.
>>>>
>>>> So from that point of view it would seem that R has made great strides
>>>> over
>>>> the last 5 years especially in establishing a role for open source
>>>> software solutions in regulated/ commercial
>>>> environments. The question now is how to meld the archiac notions of
>>>> validation and
>>>> and verification seen in industry with the very different model of 
>>>> open
>>>> source
>>>> development? Rather than the correctness of the software, in which I
>>>> think R is competitive,
>>>> it is how to deal with the rapid release cycles of R, and the
>>>> contributed packages.
>>>> We pull our hair out in pharma trying to figure out how we would ever
>>>> reconcile CRAN and validation requirements. I have no brilliant
>>>> soulution,
>>>> just food for thought
>>>>
>>>> Nicholas
>>>> ------------------------------
>>>>> Message: 5
>>>>> Date: Thu, 8 Jan 2009 13:02:55 +0000 (GMT)
>>>>> From: Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>>> Subject:Re: [Rd]  NY Times article
>>>>> To: Anand Patil <anand.prabhakar.patil at gmail.com>
>>>>> Cc: r-devel at r-project.org
>>>>> Message-ID: <alpine.LFD.2.00.0901081258470.5529 at auk.stats.ox.ac.uk>
>>>>> Content-Type: TEXT/PLAIN; charset=US-ASCII; format=flowed
>>>>>
>>>>> It has been all over R-help, in several threads.
>>>>>
>>>>> https://stat.ethz.ch/pipermail/r-help/2009-January/184119.html
>>>>> https://stat.ethz.ch/pipermail/r-help/2009-January/184170.html
>>>>> https://stat.ethz.ch/pipermail/r-help/2009-January/184209.html
>>>>> https://stat.ethz.ch/pipermail/r-help/2009-January/184232.html
>>>>> https://stat.ethz.ch/pipermail/r-help/2009-January/184237.html
>>>>>
>>>>> and more
>>>>>
>>>>> On Thu, 8 Jan 2009, Anand Patil wrote:
>>>>>
>>>>>> Sorry if this is spam, but I couldn't see it having popped up on 
>>>>>> the list
>>>>>> yet.
>>>>>> http://www.nytimes.com/2009/01/07/technology/business-computing/07program.html?emc=eta1 
>>>>>>
>>>>>>
>>>>>> Anand
>>>>>>
>>>>>>    [[alternative HTML version deleted]]
>>>>>>
>>>>>> ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>
>>>>> -- 
>>>>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>>>>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>>>>> University of Oxford,             Tel:  +44 1865 272861 (self)
>>>>> 1 South Parks Road,                     +44 1865 272866 (PA)
>>>>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>>>>
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From samsiddhi.bhattacharjee at gmail.com  Sun Jan 11 00:54:52 2009
From: samsiddhi.bhattacharjee at gmail.com (Samsiddhi Bhattacharjee)
Date: Sat, 10 Jan 2009 18:54:52 -0500
Subject: [Rd] Problem with compiling shared C/C++ library for loading into R
	(Linux)
In-Reply-To: <2c0ef9870901101540l1adfcba8x31058f5643c69882@mail.gmail.com>
References: <2c0ef9870901101540l1adfcba8x31058f5643c69882@mail.gmail.com>
Message-ID: <2c0ef9870901101554q11b48419s95730dfa5dc10e5c@mail.gmail.com>

Dear all,

I am using the .Call interface to call c++ code from R. For that, I am
trying to create a dynamic library (mylib.so)
using "R CMD SHLIB" by linking my own c++ code and an external c++
library (blitz++).

The makefile works fine on my Mac, produces mylib.so and I am able to
call .Call() from R,  but on a linux
server (I think Debian),  I got the following error:

----------
/usr/bin/ld: /somepath/blitz/lib/libblitz.a(globals.o):
relocation R_X86_64_32 against `a local symbol' can not be used when
making a shared object; recompile with -fPIC
/somepath/blitz/lib/libblitz.a: could not read symbols: Bad value
collect2: ld returned 1 exit status
----------

I tried recompiling the blitz++ library with the -fPIC flag, and then
linking using -fPIC, it went thorugh without error
producing a "mylib.so" file.  But when I tried "dyn.load(mylib.so)"
from R, I got the error:

----------
Error in dyn.load("mylib.so") :
 unable to load shared library '/somepath/mylib.so':
 /somepath/mylib.so: undefined symbol: _ZSt4cerr
---------

I will really appreciate any help or advice on this problem.

--Samsiddhi Bhattacharjee


From phgrosjean at sciviews.org  Sun Jan 11 10:06:59 2009
From: phgrosjean at sciviews.org (Philippe Grosjean)
Date: Sun, 11 Jan 2009 10:06:59 +0100
Subject: [Rd] code validation (was Re:  NY Times article)
In-Reply-To: <49690DD7.1080808@pdf.com>
References: <mailman.23.1231498804.5365.r-devel@r-project.org>	<1231540860.15278.1293959281@webmail.messagingengine.com>	<4967D8B3.7070304@mdacc.tmc.edu>	<1231615179.27529.1294051939@webmail.messagingengine.com>	<9CD0FD71-D3C6-4499-B4E9-FE81EA581FBD@gmail.com>
	<49690DD7.1080808@pdf.com>
Message-ID: <4969B6B3.2050807@sciviews.org>

Hello,

To answer Spencer Graves questions, I would like to mention that there 
an alternative to RUnit that could easy writing of test units, 
regression tests and integration tests for R. It is svUnit. See 
http://www.sciviews.org/SciViews-K/index.html. It is not on CRAN yet, 
but on R-Forge because it is still in development. You can install it by:

install.packages("svUnit",repos="http://R-Forge.R-project.org")

It is fully compatible with RUnit test units, that is, the checkXXX() 
functions, and .setUp()/.tearDown() are fully supported. Indeed, my 
first goal was to use RUnit and build a GUI on top of it... but for 
several reasons, it was not possible and I had to write my custom 
checkXXX() functions (same interface, but totally different internal code).

svUnit offers original ways (for R microcosm) to define, run and view 
your test suites. Here are some of them:

1) You do not need to write a test suite file on disk to test an R 
object. Suppose you have your own function like this:

 > Square <- function(x) return(x^2)

You can simply attach a test unit to this object by:

 > test(Square) <- function() {
+     checkEquals(9, Square(3))
+     checkEquals(10, Square(3))  # This intentionally fails
+     checkEquals(9, SSSquare(3)) # This intentionally raises error
+     checkEquals(c(1, 4, 9), Square(1:3))
+     checkException(Square("xx"))
+ }

And you run it as easily. You must first know that test unit failures, 
errors and other data concerning your tests are logged globally. You 
clean the log by clearLog() and you look at it by Log(), or perhaps 
summary(Log()) if you accumulated a lot of tests in the logger. So, to 
test your Square() function only, you do:

 > clearLog()
 > runTest(Square)
 > Log()
= A svUnit test suite run in less than 0.1 sec with:

* test(Square) ... **ERROR**


== test(Square) run in less than 0.1 sec: **ERROR**

//Pass: 3 Fail: 1 Errors: 1//

* : checkEquals(10, Square(3)) run in 0.002 sec ... **FAILS**
Mean relative difference: 0.1
  num 9

* : checkEquals(9, SSSquare(3)) run in less than 0.001 sec ... **ERROR**
Error in mode(current) : could not find function "SSSquare"

2) You can attach test units to any kind of objects, and even, you can 
define stand-alone tests (like integration or regression tests, for 
instance):

 > test_Integrate <- svTest(function() {
+         checkTrue(1 < 2, "check1")
+         v <- 1:3        # The reference
+         w <- 1:3        # The value to compare to the reference
+         checkEquals(v, w)
+ })

then:

 > runTest(test_Integrate)
 > Log() # Note how test results accumulate in the logger
(output not shown)

3) On the contrary to RUnit, you can even run the checkXXX() functions 
everywhere, and their test results will also accumulate in the logger 
(but then, there is no context associated to the test and the title is 
just "eval run in ... ":

 > checkTrue(1 < 2)
 > Log()
(output not shown)

4) You have convenient functions to catalog all available test 
units/test suites (in R packages, in objects in memory, integration 
tests, ...). You even can manage exclusion lists (by default, test 
suites defined in svXXX packages and RUnit are excluded). So:

 > (oex <- getOption("svUnit.excludeList")) # Excluded items (regexp)
[1] "package:sv"    "package:RUnit"
 > # clear the exclusion list and list all available test units
 > options(svUnit.excludeList = NULL)
 > svSuiteList() # Note that our test functions are also listed
A svUnit test suite definition with:

- Test suites:
[1] "package:svUnit"                "package:svUnit (VirtualClass)"

- Test functions:
[1] "test(Square)"   "test_Integrate"

 > # Restore previous exclusion list
 > options(svUnit.excludeList = oex)

Lokk at ?svSuite for more explanations.

5) You can easily transform a test associated with an object into a 
RUnit-compatible test file on disk:

 > unit <- makeUnit(Square)
 > file.show(unit, delete.file = TRUE)

6) You can easily integrate the svUnit test in R packages and in R CMD 
check mechanism with silent full test of your units in case of no errors 
or failures, but break of R CMD check with extensive report in case of 
problems. Just define a .Rd page (named 'unitTests.mypkg', by default) 
and write an example section to run the test units you want. Here is an 
example:

-----------------------------
\name{unitTests}
\alias{unitTests.svUnit}

\title{ Unit tests for the package svUnit }
\description{
   Performs unit tests defined in this package by running
   \code{example(unitTests.svUnit)}. Tests are in \code{runit*.R} files
   located in the '/unitTests' subdirectory or one of its subdirectories
   ('/inst/unitTests' and subdirectories in package sources).
}

\author{Me (\email{me at mysite.org})}

\examples{
library(svUnit)
# Make sure to clear log of errors and failures first
clearLog()

# Run all test units defined in the 'svUnit' package
(runTest(svSuite("package:svUnit"), "svUnit"))

\donttest{
# Tests to run with example() but not with R CMD check
# Run all test units defined in the /unitTests/VirtualClass subdir
(runTest(svSuite("package:svUnit (VirtualClass)"), "VirtualClass"))
}

\dontrun{
# Tests to present in ?unitTests.svUnit but to never run automatically
# Run all currently loaded test cases and test suites of all loaded packages
(runTest(svSuiteList(), "AllTests"))
}

\dontshow{
# Put here test units you want to run during R CMD check but don't want 
to show
# or run with example(unitTests.svUnit)
}

# Check errors (needed to interrupt R CMD check in case of problems)
errorLog()
}

\keyword{utilities}
---------------------------

Note also that this mechanism allows to run a selection of your 
package's test units through example(unitTests.mypkg), which is 
convenient for further interactive analysis of the problem(s), for 
instance. Look at the source code of the svUnit package for an example 
of such test units integration into R package build/check mechanism.

7) svUnit fully integrates within the SciViews/Komodo Edit GUI/IDE. You 
then have a completely graphical presentation of your tests and 
automated execution of your tests while you type your R code. See the 
screenshot at http://www.sciViews.org, 'RUnit' tab at right of the 
Komodo Edit window. There is a simple interface available to implement 
similar panels in other GUI/IDE.

8) svUnit reports also nicely integrate in DokuWiki engines, or any 
creole-compatible wiki engine (like the R Wiki, 
http://wiki.r-project.org) for web-based test units.

The code is complete, but considered in beta stage, currently. A 
vignette is in preparation for this package. We are looking for comments 
and testers before we release this package on CRAN. Note that this 
package should be considered as complimentary to RUnit. Depending on the 
way you want to run your test units, you can use either svUnit, or 
RUnit, or both with the same test code.

Best,

Philippe Grosjean

..............................................<?}))><........
  ) ) ) ) )
( ( ( ( (    Prof. Philippe Grosjean
  ) ) ) ) )
( ( ( ( (    Numerical Ecology of Aquatic Systems
  ) ) ) ) )   Mons-Hainaut University, Belgium
( ( ( ( (
..............................................................

Spencer Graves wrote:
> Hi, All:
>      What support exists for 'regression testing' 
> (http://en.wikipedia.org/wiki/Regression_testing) of R code, e.g., as 
> part of the "R CMD check" process?
>      The"RUnit" package supports "unit testing" 
> (http://en.wikipedia.org/wiki/Unit_testing).
>      Those concerned about software quality of code they use regularly 
> could easily develop their own "softwareChecks" package that runs unit 
> tests in the "\examples".  Then each time a new version of the package 
> and / or R is downloaded, you can do "R CMD check" of your 
> "softwareChecks":  If it passes, you know that it passed all your checks.
> 
>      I have not used "RUnit", but I've done similar things computing the 
> same object two ways then doing "stopifnot(all.equal(obj1, obj2))".  I 
> think the value of the help page is enhanced by showing the "all.equal" 
> but not the "stopifnot".  I achieve this using "\dontshow" as follows:
> 
>           obj1 <- ...
>           obj2 <- ...
>           \dontshow{stopifnot(}
>           all.equal(obj1, obj2)
>           \dontshow{)}.
> 
>      Examples of this are contained, for example, in "fRegress.Rd" in 
> the current "fda" package available from CRAN or R-Forge.
> 
>      Best Wishes,
>      Spencer
> 
> Jb wrote:
>> Hi all,
>> One relatively easy solution is to include R and all relevant versions 
>> of packages used in (a) a reproduction archive and/or (b) packaged 
>> inside a virtual machine. With storage space cheap and sources of both 
>> R and packages available (and easy free crossplatform virtual machine 
>> solutions and Linux) one can distribute not only ones own code and 
>> data but also all that was required to do the analyses down to the OS.
>>
>> So far in our own work we've just included relevant package versions 
>> but we will probably start include R as well for next projects.
>>
>> Hope this brainstorm helps (and credit to Ben Hansen and Mark 
>> Fredrickson for these ideas).
>>
>> Jake
>>
>> Jake Bowers
>> http://jakebowers.org
>>
>> On Jan 10, 2009, at 1:19 PM, "Nicholas Lewin-Koh" <nikko at hailmail.net> 
>> wrote:
>>
>>> Hi,
>>> Unfortunately one of the the cornerstones of the validation paradigm
>>> in the clinical world (as I understand it) is that
>>> consistency/repeatability,
>>> documentation (of the programs consistency and maintenance) and
>>> adherence to regulatory
>>> requirements take supremacy even ironically over correctness. So you
>>> still
>>> get ridiculous requirements from regulatory bodies like type III sums of
>>> squares, Last observation carried forward, etc. These edifices are
>>> very hard to change, I know of people who have worked their whole
>>> careers just to get the FDA to allow other treatment of missing data.
>>>
>>> So what does this have to do with R? This comes down to the point
>>> you made below about the R development cycle incorporating bug fixes
>>> into new releases, and not supporting old versions. I think this has
>>> been rehashed many times, and is not likely to change. So how to
>>> move R into the clinic? From a practical perspective all the
>>> development and interoperability features of R are very nice,
>>> but how to maintain things in a way that if the underlying
>>> R platform changes the tool or method does not, and furthermore
>>> how to manage this in a cost effective way so that it can't
>>> be argued that it is cheaper to pay for SAS???
>>>
>>> These are not necessarily questions that R core has to answer,
>>> as the burden of proof of validation is really in the hands of the
>>> company/organization doing the submission. We just like to pretend that
>>> the large price we pay for our SAS support means we can shift liability
>>> :)
>>>
>>> Rambling again,
>>> Nicholas
>>>
>>>
>>> On Fri, 09 Jan 2009 17:07:31 -0600, "Kevin R. Coombes"
>>> <krcoombes at mdacc.tmc.edu> said:
>>>> Hi Nicholas,
>>>>
>>>> You raise a very good point. As an R user (who develops a couple of
>>>> packages for our own local use), I sometimes find myself cringing in
>>>> anticipation of a new R (or BioConductor) release. In my perception
>>>> (which is almost certainly exaggerated, but that's why I emphasize that
>>>> it is only an opinion), clever theoretical arguments in favor of
>>>> structural changes have a tendency to outweigh practical considerations
>>>> of backwards compatibility.
>>>>
>>>> One of my own interests is in "reproducible research", and I've been
>>>> pushing hard here at M.D. Anderson to get people to use Sweave to
>>>> enhance the reproducibility of their own analyses. But, more often than
>>>> I would like, I find that reports written in Sweave do not survive the
>>>> transition from one version of R to the next, because either the core
>>>> implementation or one of the packages they depend on has changed in 
>>>> some
>>>> small but meaningful way.
>>>>
>>>> For our own packages, we have been adding extensive regression testing
>>>> to ensure that the same numbers come out of various computations, in
>>>> order to see the effects of either the changes that we make or the
>>>> changes in the packages we depend on.  But doing this in a nontrivial
>>>> way with real data leads to test suites that take a long time to run,
>>>> and so cannot be incorporated in the nightly builds used by CRAN.
>>>>
>>>> We also encourage our analysts to include a "sessionInfo()" command in
>>>> an appendix to each report so we are certain to document what versions
>>>> of packages were used.
>>>>
>>>> I suspect that the sort of validation you want will have to rely on an
>>>> extensive regression suite test to make certain that the things you 
>>>> need
>>>> remain stable from one release to another. That, and you'll have to be
>>>> slow about upgrading (which may mean foregoing support from the mailing
>>>> lists, where a common refrain in response to bug reports is that "you
>>>> aren't using the latest and greatest version", without an appreciation
>>>> of the fact that there can be good reasons for not changing something
>>>> that you know works....).
>>>>
>>>> Best,
>>>>    Kevin
>>>>
>>>> Nicholas Lewin-Koh wrote:
>>>>> Hi,
>>>>> Kudos, nice exposure, but to make this more appropriate to R-devel I
>>>>> would just
>>>>> like to make a small comment about the point made by the SAS executive
>>>>> about getting
>>>>> on an airplane yada yada ...
>>>>>
>>>>> 1) It would seem to me that R has certification documents
>>>>> 2) anyone designing airplanes, analyzing clinical trials, etc. had
>>>>>   better be worried about a lot more than whether their software is
>>>>>   proprietary.
>>>>>
>>>>> So from that point of view it would seem that R has made great strides
>>>>> over
>>>>> the last 5 years especially in establishing a role for open source
>>>>> software solutions in regulated/ commercial
>>>>> environments. The question now is how to meld the archiac notions of
>>>>> validation and
>>>>> and verification seen in industry with the very different model of 
>>>>> open
>>>>> source
>>>>> development? Rather than the correctness of the software, in which I
>>>>> think R is competitive,
>>>>> it is how to deal with the rapid release cycles of R, and the
>>>>> contributed packages.
>>>>> We pull our hair out in pharma trying to figure out how we would ever
>>>>> reconcile CRAN and validation requirements. I have no brilliant
>>>>> soulution,
>>>>> just food for thought
>>>>>
>>>>> Nicholas
>>>>> ------------------------------
>>>>>> Message: 5
>>>>>> Date: Thu, 8 Jan 2009 13:02:55 +0000 (GMT)
>>>>>> From: Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>>>> Subject:Re: [Rd]  NY Times article
>>>>>> To: Anand Patil <anand.prabhakar.patil at gmail.com>
>>>>>> Cc: r-devel at r-project.org
>>>>>> Message-ID: <alpine.LFD.2.00.0901081258470.5529 at auk.stats.ox.ac.uk>
>>>>>> Content-Type: TEXT/PLAIN; charset=US-ASCII; format=flowed
>>>>>>
>>>>>> It has been all over R-help, in several threads.
>>>>>>
>>>>>> https://stat.ethz.ch/pipermail/r-help/2009-January/184119.html
>>>>>> https://stat.ethz.ch/pipermail/r-help/2009-January/184170.html
>>>>>> https://stat.ethz.ch/pipermail/r-help/2009-January/184209.html
>>>>>> https://stat.ethz.ch/pipermail/r-help/2009-January/184232.html
>>>>>> https://stat.ethz.ch/pipermail/r-help/2009-January/184237.html
>>>>>>
>>>>>> and more
>>>>>>
>>>>>> On Thu, 8 Jan 2009, Anand Patil wrote:
>>>>>>
>>>>>>> Sorry if this is spam, but I couldn't see it having popped up on 
>>>>>>> the list
>>>>>>> yet.
>>>>>>> http://www.nytimes.com/2009/01/07/technology/business-computing/07program.html?emc=eta1 
>>>>>>>
>>>>>>>
>>>>>>> Anand
>>>>>>>
>>>>>>>    [[alternative HTML version deleted]]
>>>>>>>
>>>>>>> ______________________________________________
>>>>>>> R-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>>
>>>>>> -- 
>>>>>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>>>>>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>>>>>> University of Oxford,             Tel:  +44 1865 272861 (self)
>>>>>> 1 South Parks Road,                     +44 1865 272866 (PA)
>>>>>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>>>>>
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From torpedofisken at gmail.com  Sun Jan 11 13:58:58 2009
From: torpedofisken at gmail.com (torpedo fisken)
Date: Sun, 11 Jan 2009 13:58:58 +0100
Subject: [Rd] Problem with compiling shared C/C++ library for loading
	into R (Linux)
In-Reply-To: <2c0ef9870901101554q11b48419s95730dfa5dc10e5c@mail.gmail.com>
References: <2c0ef9870901101540l1adfcba8x31058f5643c69882@mail.gmail.com>
	<2c0ef9870901101554q11b48419s95730dfa5dc10e5c@mail.gmail.com>
Message-ID: <6b50a24c0901110458i3cc8e5eaxf8253bc303f1bb70@mail.gmail.com>

I think you're not linking it together when you call R CMD SHLIB, use
something like

R CMD SHLIB mylib.c yourlib1.o yourlib2.o

Otherwise mail again with your Makefile, or all the commands you are using

good luck

2009/1/11 Samsiddhi Bhattacharjee <samsiddhi.bhattacharjee at gmail.com>:
> Dear all,
>
> I am using the .Call interface to call c++ code from R. For that, I am
> trying to create a dynamic library (mylib.so)
> using "R CMD SHLIB" by linking my own c++ code and an external c++
> library (blitz++).
>
> The makefile works fine on my Mac, produces mylib.so and I am able to
> call .Call() from R,  but on a linux
> server (I think Debian),  I got the following error:
>
> ----------
> /usr/bin/ld: /somepath/blitz/lib/libblitz.a(globals.o):
> relocation R_X86_64_32 against `a local symbol' can not be used when
> making a shared object; recompile with -fPIC
> /somepath/blitz/lib/libblitz.a: could not read symbols: Bad value
> collect2: ld returned 1 exit status
> ----------
>
> I tried recompiling the blitz++ library with the -fPIC flag, and then
> linking using -fPIC, it went thorugh without error
> producing a "mylib.so" file.  But when I tried "dyn.load(mylib.so)"
> from R, I got the error:
>
> ----------
> Error in dyn.load("mylib.so") :
>  unable to load shared library '/somepath/mylib.so':
>  /somepath/mylib.so: undefined symbol: _ZSt4cerr
> ---------
>
> I will really appreciate any help or advice on this problem.
>
> --Samsiddhi Bhattacharjee
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Sun Jan 11 15:34:10 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 11 Jan 2009 14:34:10 +0000 (GMT)
Subject: [Rd] cat cannot write more than 10000 characters? [R 2.8.1]
In-Reply-To: <4961E90F.3040508@campus.lmu.de>
References: <4960F7E8.2000705@campus.lmu.de>
	<alpine.LFD.2.00.0901050926040.32650@auk.stats.ox.ac.uk>
	<4961E90F.3040508@campus.lmu.de>
Message-ID: <alpine.OSX.1.00.0901111413260.17084@tystie.local>

Looks like a bug in your iconv.  However, that section of code is 
conditionalized by

     if(con->outconv) { /* translate the buffer */

and I don't see that as non-NULL on my systems.  It should only be 
called when you specify an encoding on the output connection, so have 
you set an option (e.g. "encoding")  without telling us?

I was able to reproduce a similar problem by

cat(testChunk, sep = "\n", file = file("output", encoding="latin1"),
     append = TRUE)

in a UTF-8 locale, and I'll add a workaround to the R sources.

Please do run your tests with R --vanilla and make sure they are 
complete -- see the posting guide.


On Mon, 5 Jan 2009, Daniel Saban?s Bov? wrote:

> Dear Prof. Ripley,
>>> I have discovered that my cat function cannot write more than 10000
>>> characters to a text file.

I think you meant *bytes*, BTW.

>> You mean on a single line?
> Yes. OOo tries to save space...
>> No, works for me on Mac OS X and x86_64 Fedora 8 (as does 10x larger).
>> Can you run this under a debugger and find where it is going wrong for
>> you?
> Oh, then this might be distribution- or gcc-version-specific:
> gcc --version
> gcc (SUSE Linux) 4.3.2 [gcc-4_3-branch revision 141291]
>
> glibc is version 2.9-2.3.
>
> Using ddd I found the (relevant part of the) backtrace when interrupting
> the infinite loop:
>
> (gdb) backtrace
> #0  __gconv (cd=0x846cde0, inbuf=0xbfff7738, inbufend=0x84ca589 "",
> outbuf=0xbfff773c, outbufend=0xbfff9e57 "", irreversible=0xbfff76a8) at
> gconv.c:80
>
> The program comes here more than 100 000 times... with outbuf and inbuf
> always being "\0".
>
> #1  0xb7b581e7 in iconv (cd=0x846cde0, inbuf=0xbfff7738,
> inbytesleft=0xbfff7734, outbuf=0xbfff773c, outbytesleft=0xbfff7730) at
> iconv.c:53
> [this is   result = __gconv (gcd, (const unsigned char **) inbuf,
>                        (const unsigned char *)  (*inbuf + *inbytesleft),
>                          (unsigned char **) outbuf,
>                           (unsigned char *) (*outbuf + *outbytesleft),
>                       &irreversible);]
>
> #2  0xb7e44d29 in Riconv (cd=0x846cde0, inbuf=0xbfff7738,
> inbytesleft=0xbfff7734, outbuf=0xbfff773c, outbytesleft=0xbfff7730) at
> sysutils.c:692
> [ this is the only line of Riconv,  return iconv((iconv_t) cd,
> (ICONV_CONST char **) inbuf, inbytesleft, outbuf, outbytesleft);]
>
> #3  0xb7d2c337 in dummy_vfprintf (con=0x8400bb0, format=0xb7ee0c48 "%s",
> ap=0xbfffc604 "\230?L\b??\005\b?h\a\b?h\a\b??\005\b??\005\b\001") at
> connections.c:316
> [this is      ires = Riconv(con->outconv, &ib, &inb, &ob, &onb);]
>
> The infinite loop seems to be inside dummy_vfprintf, as this position is
> the "highest" inside the backtrace which is reached again and again. And
> at line 249 appears the magic number 10000 as BUFSIZE, which is indeed
> selected by the preprocessor in my environment!
>
> #4  0xb7d2c4fa in file_vfprintf (con=0x8400bb0, format=0xb7ee0c48 "%s",
> ap=0xbfffc604 "\230?L\b??\005\b?h\a\b?h\a\b??\005\b??\005\b\001") at
> connections.c:579
> [this is  if(con->outconv) return dummy_vfprintf(con, format, ap);]
>
> This and everything above is only reached once, so this might be OK.
>
> #5  0xb7dfe069 in Rvprintf (format=0xb7ee0c48 "%s", arg=0xbfffc604
> "\230?L\b??\005\b?h\a\b?h\a\b??\005\b??\005\b\001") at printutils.c:785
> [this is   (con->vfprintf)(con, format, argcopy);]
>
> #6  0xb7dfe244 in Rprintf (format=0xb7ee0c48 "%s") at printutils.c:679
> [this is   Rvprintf(format, ap);]
>
> #7  0xb7d0446c in do_cat (call=0x83032a8, op=0x806b7d4, args=<value
> optimized out>, rho=0x830359c) at builtin.c:597
> [this is   Rprintf("%s", p);]
>
> Unfortunately, I'm not experienced in R/C code internals, but if you
> have detailed instructions for me (like "show me the value of this
> variable after 10000 stops") I can provide more debugging info.
>>> cat(testChunk, sep = "\n", file = output, append = TRUE)
>> We have writeLines() for that and it is more efficient, especially if
>> you keep a connection open.
> OK, maybe Prof. Leisch wants to improve the Sweave code...?
>
> Thank you very much for your help,
> best regards,
> Daniel Sabanes
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From f.harrell at vanderbilt.edu  Sun Jan 11 16:21:23 2009
From: f.harrell at vanderbilt.edu (Frank E Harrell Jr)
Date: Sun, 11 Jan 2009 09:21:23 -0600
Subject: [Rd] NY Times article
Message-ID: <496A0E73.2020805@vanderbilt.edu>

Nicholas please note that FDA does not require type III sums of squares, 
LOCF, and the use of any particular software.  It is just the fact that 
FDA does not disallow type III tests and LOCF that prevents pharma from 
abandoning these terrible methods.

Frank
-- 
Frank E Harrell Jr   Professor and Chair           School of Medicine
                      Department of Biostatistics   Vanderbilt University


From marc_schwartz at comcast.net  Sun Jan 11 17:23:18 2009
From: marc_schwartz at comcast.net (Marc Schwartz)
Date: Sun, 11 Jan 2009 10:23:18 -0600
Subject: [Rd] code validation (was Re:  NY Times article)
In-Reply-To: <49690DD7.1080808@pdf.com>
References: <mailman.23.1231498804.5365.r-devel@r-project.org>	<1231540860.15278.1293959281@webmail.messagingengine.com>	<4967D8B3.7070304@mdacc.tmc.edu>	<1231615179.27529.1294051939@webmail.messagingengine.com>	<9CD0FD71-D3C6-4499-B4E9-FE81EA581FBD@gmail.com>
	<49690DD7.1080808@pdf.com>
Message-ID: <496A1CF6.5010801@comcast.net>

on 01/10/2009 03:06 PM Spencer Graves wrote:
> Hi, All:
>      What support exists for 'regression testing'
> (http://en.wikipedia.org/wiki/Regression_testing) of R code, e.g., as
> part of the "R CMD check" process?
>      The"RUnit" package supports "unit testing"
> (http://en.wikipedia.org/wiki/Unit_testing).
>      Those concerned about software quality of code they use regularly
> could easily develop their own "softwareChecks" package that runs unit
> tests in the "\examples".  Then each time a new version of the package
> and / or R is downloaded, you can do "R CMD check" of your
> "softwareChecks":  If it passes, you know that it passed all your checks.
> 
>      I have not used "RUnit", but I've done similar things computing the
> same object two ways then doing "stopifnot(all.equal(obj1, obj2))".  I
> think the value of the help page is enhanced by showing the "all.equal"
> but not the "stopifnot".  I achieve this using "\dontshow" as follows:
> 
>           obj1 <- ...
>           obj2 <- ...
>           \dontshow{stopifnot(}
>           all.equal(obj1, obj2)
>           \dontshow{)}.
> 
>      Examples of this are contained, for example, in "fRegress.Rd" in
> the current "fda" package available from CRAN or R-Forge.
> 
>      Best Wishes,
>      Spencer

Spencer,

I think that there are two separate issues being raised here.

One is, how does R Core implement and document an appropriate software
development life cycle (SDLC), which covers the development, testing and
maintenance of R itself. This would include "Base" R and the
"Recommended Packages".

The second is how does an end user do the same with respect to their own
use of R and their own R code development.

I'll answer this one first, which is essentially that it is up to the
end user and their organization. There is an intrinsic mis-understanding
if an end user believes that the majority of the burden for this is on R
Core or that it is up to R Core to facilitate the end user's internal QA
processes.

If the end user is in an environment that requires formalized IQ/OQ/PQ
types of processes (building jet engines for example...), then there
will be SOPs in place that define how these are to be accomplished. The
SOPs may need to be adjusted to R's characteristics, but they should be
in place. The end user needs to be familiar with these, implement
appropriate mechanisms that are compliant with them and operate within
those parameters to reasonably ensure the quality, consistency and
repeatability of their work.

This is no different with R than any other mission critical application.
If somebody is using SAS to build jet engines and they have not
implemented internal processes that establish and document SAS'
performance, beyond that which the SAS Institute documents, the end user
and their organization are out on a limb in terms of risk.

With respect to the first issue and R itself, as you may be aware, there
is a document available here:

  http://www.r-project.org/doc/R-FDA.pdf

which while geared towards the regulated clinical trials realm,
documents the R SDLC and related issues. The key is to document what R
Core does so that end users can be cognizant of the internal quality
processes in place and that an appropriate understanding of these can be
achieved. Given the focus of the document, it also covers other
regulatory issues applicable to clinical trials (eg. 21 CFR 11).

In that document, I would specifically point you to Section 6 which
covers R's SDLC.

Note that this document DOES NOT cover CRAN add-on packages in any
fashion, as the SDLC for those packages is up to the individual authors
and maintainers to define and document. If a user is installing and
using CRAN add-on packages, then they should communicate with those
package authors to identify their SDLC and have then implement their own
internal processes to test them.

The typical "R CMD check" process essentially only tests that the
package is a valid CRAN package, unless the CRAN package author has
implemented their own testing process (eg. 'tests' sub-dir) with
additional code such as R Core has done when using procedures such as
'make check-all' subsequent to compiling R from source code.

HTH,

Marc Schwartz


From ripley at stats.ox.ac.uk  Sun Jan 11 18:41:20 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 11 Jan 2009 17:41:20 +0000 (GMT)
Subject: [Rd] cat cannot write more than 10000 characters? [R 2.8.1]
In-Reply-To: <496A13ED.1090208@campus.lmu.de>
References: <4960F7E8.2000705@campus.lmu.de>
	<alpine.LFD.2.00.0901050926040.32650@auk.stats.ox.ac.uk>
	<4961E90F.3040508@campus.lmu.de>
	<alpine.OSX.1.00.0901111413260.17084@tystie.local>
	<496A13ED.1090208@campus.lmu.de>
Message-ID: <alpine.OSX.1.00.0901111739110.33178@tystie.local>

On Sun, 11 Jan 2009, Daniel Saban?s Bov? wrote:

> Yes, I set the encoding to UTF-8 in my .Rprofile. Sorry that I didn't

You really don't want to do that: it adds a considerable overhead and 
relies on a bug-free iconv ....

The latest R-patched should work around this.

> mention it already. So the complete stand-alone test code which fails in
> R --vanilla is the following:
>
> ### code begin
> options (encoding = "utf-8")
> testChunk <- paste(rep("a", 10000 + 1), ## delete "+ 1" to be successful
>                   collapse="")
> output <- tempfile()
> cat(testChunk, sep = "\n", file = output, append = TRUE)
> ### code end
>
> And the version and locale of my system are
>
> R version 2.8.1 (2008-12-22)
> i686-pc-linux-gnu
> locale:
> LC_CTYPE=de_DE.UTF-8;LC_NUMERIC=C;LC_TIME=de_DE.UTF-8;LC_COLLATE=de_DE.UTF-8;LC_MONETARY=C;LC_MESSAGES=de_DE.UTF-8;LC_PAPER=de_DE.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=de_DE.UTF-8;LC_IDENTIFICATION=C
>
>
> Prof Brian Ripley schrieb:
>> Looks like a bug in your iconv.  However, that section of code is
>> conditionalized by
>>
>>     if(con->outconv) { /* translate the buffer */
>>
>> and I don't see that as non-NULL on my systems.  It should only be
>> called when you specify an encoding on the output connection, so have
>> you set an option (e.g. "encoding")  without telling us?
>>
>> I was able to reproduce a similar problem by
>>
>> cat(testChunk, sep = "\n", file = file("output", encoding="latin1"),
>>     append = TRUE)
>>
>> in a UTF-8 locale, and I'll add a workaround to the R sources.
>>
>> Please do run your tests with R --vanilla and make sure they are
>> complete -- see the posting guide.
>>
>>
>> On Mon, 5 Jan 2009, Daniel Saban?s Bov? wrote:
>>
>>> Dear Prof. Ripley,
>>>>> I have discovered that my cat function cannot write more than 10000
>>>>> characters to a text file.
>>
>> I think you meant *bytes*, BTW.
>>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From nikko at hailmail.net  Sun Jan 11 20:26:13 2009
From: nikko at hailmail.net (Nicholas Lewin-Koh)
Date: Sun, 11 Jan 2009 11:26:13 -0800
Subject: [Rd] NY Times article
In-Reply-To: <496A0E73.2020805@vanderbilt.edu>
References: <496A0E73.2020805@vanderbilt.edu>
Message-ID: <1231701973.25565.1294170219@webmail.messagingengine.com>

Hi Frank,
Thank you for the correction, I don't work in clinical, so good you keep
me honest.
Nicholas
On Sun, 11 Jan 2009 09:21:23 -0600, "Frank E Harrell Jr"
<f.harrell at vanderbilt.edu> said:
> Nicholas please note that FDA does not require type III sums of squares, 
> LOCF, and the use of any particular software.  It is just the fact that 
> FDA does not disallow type III tests and LOCF that prevents pharma from 
> abandoning these terrible methods.
> 
> Frank
> -- 
> Frank E Harrell Jr   Professor and Chair           School of Medicine
>                       Department of Biostatistics   Vanderbilt University


From ripley at stats.ox.ac.uk  Sun Jan 11 21:18:33 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 11 Jan 2009 20:18:33 +0000 (GMT)
Subject: [Rd] R as a scripting engine
Message-ID: <alpine.OSX.1.00.0901111151050.16921@tystie.local>

Those of you tracking R development will have noticed that we are 
moving towards using R as a scripting engine.  (It is often overlooked 
as such.)  Thus far INSTALL, REMOVE, SHLIB and massage-examples have 
been moved to R.

Reasons:

- it is platform-independent and needs no other tools installed.
   No need to worry about strange 'sh' variants (as on AIX and in the
   past on Mac OS X) or to track Perl version changes and miniumun
   requirements.

- it is fast.  Shell scripts are notoriously slow[*] on Windows as
   launching a new process there is relatively much slower than on a
   Unix-alike, to the extent that we have had to use Perl scripts on
   Windows. The actual script of INSTALL in R runs twice as fast as the
   shell script on Unix or the Perl script on Windows.  (In part this
   comes about because R scripts can be pre-parsed if put in a package:
   the 1150 lines of INSTALL was taking a couple of seconds to parse.)

- it is much easier to maintain.  We only need one version, and any R
   user should be able to folllow it (and any member of R-core to
   maintain it).  And one version means only one set of the
   documentation and automatically keeping things in step.

- R has lots of useful features, including automatic support of
   (for files) different line endings and encodings.

Of course there is the one-time cost of doing the conversion, which 
has been triggered here by the need for new functionality.  It also 
means that there are minor changes to merge the Unix and Windows 
versions.  (Some of you will be hearing from Uwe Ligges about use of 
undocumented variables in Windows configure/Makevars.win, for 
example.)

In due course we see phasing out the use of Perl, at least at run time 
(and that might even be for 2.9.0).

[*] Running configure under Cygwin took over an hour on a fairly 
laoded Windows box earlier in the week.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ggrothendieck at gmail.com  Sun Jan 11 21:26:03 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 11 Jan 2009 15:26:03 -0500
Subject: [Rd] R as a scripting engine
In-Reply-To: <alpine.OSX.1.00.0901111151050.16921@tystie.local>
References: <alpine.OSX.1.00.0901111151050.16921@tystie.local>
Message-ID: <971536df0901111226w7e3ab784p754ab353118590bf@mail.gmail.com>

On Sun, Jan 11, 2009 at 3:18 PM, Prof Brian Ripley
<ripley at stats.ox.ac.uk> wrote:
> Those of you tracking R development will have noticed that we are moving
> towards using R as a scripting engine.  (It is often overlooked as such.)
...
> In due course we see phasing out the use of Perl, at least at run time (and
> that might even be for 2.9.0).

That's great news.  I for one will not be sorry to see it and the
shell scripts go.


From edd at debian.org  Sun Jan 11 21:50:25 2009
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sun, 11 Jan 2009 14:50:25 -0600
Subject: [Rd] R as a scripting engine
In-Reply-To: <alpine.OSX.1.00.0901111151050.16921@tystie.local>
References: <alpine.OSX.1.00.0901111151050.16921@tystie.local>
Message-ID: <18794.23441.997750.621046@ron.nulle.part>


On 11 January 2009 at 20:18, Prof Brian Ripley wrote:
| Those of you tracking R development will have noticed that we are 
| moving towards using R as a scripting engine.
[...]
| Reasons:
| 
| - it is platform-independent and needs no other tools installed.
[...]
| - it is fast.
[...]

Indeed.  I really like working with r scripts. 

And littler by Horner and Eddelbuettel is faster than Rscript -- see eg the
scripts tests/timing.sh and tests/timing2.sh in the SVN archive / littler
tarballs (and the results below for illustration).   

We should still appreciate it you could finally acknowledge existence of
littler it in the R / Rscript documentation.   You are not doing users any
service by pretending it doesn't exist.  

That said, we are not (yet ?) building r for Windows, and I appreciate that
Rscript is available there.  Maintenance and use of R will be easier with a
consistent set of tools.  This is a good move.

Dirk


edd at ron:~/svn/littler/tests> ./timing.sh

 --- GNU bc doing the addition 10 times
real    0m0.028s
user    0m0.004s
sys     0m0.012s

 --- our r doing the addition 10 times
real    0m0.400s
user    0m0.308s
sys     0m0.052s

 --- GNU R's Rscript doing the addition 10 times
real    0m2.077s
user    0m1.832s
sys     0m0.204s

 --- GNU R doing the addition 10 times
real    0m3.974s
user    0m3.728s
sys     0m0.228s
edd at ron:~/svn/littler/tests> ./timing2.sh

 --- our r calling summary() 20 times
real    0m3.261s
user    0m2.976s
sys     0m0.240s

 --- GNU R's Rscript calling summary() 20 times
real    0m4.164s
user    0m3.624s
sys     0m0.548s

 --- GNU R calling summary() 20 times
real    0m8.087s
user    0m7.552s
sys     0m0.492s
edd at ron:~/svn/littler/tests>


-- 
Three out of two people have difficulties with fractions.


From rhurlin at gwdg.de  Sun Jan 11 23:13:56 2009
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Sun, 11 Jan 2009 23:13:56 +0100
Subject: [Rd] Package Matrix does not compile in R-devel_2009-01-10
Message-ID: <496A6F24.7050403@gwdg.de>

Dear developers,

today I tried to build and install R-devel_2009-01-10 on FreeBSD 
8.0-CURRENT (i386) for testing purposes.

All went well until compiling the now recommended (integrated) Matrix 
package. At this point the following break occured:

------------------------------------------------
begin installing recommended package Matrix
* Installing *source* package 'Matrix' ...
** libs
gcc -std=gnu99 -I/usr/local/R-devel/include -I./UFconfig 
-I/usr/local/include    -fpic  -g -O2 -c CHMfactor.c -o CHMfactor.o
[..snip..]
gcc -std=gnu99 -I/usr/local/R-devel/include -I../Include 
-I../../UFconfig -I/usr/local/include    -fpic  -g -O2 -c 
colamd_global.c -o colamd_global.o
gcc -std=gnu99 -I/usr/local/R-devel/include -I../Include 
-I../../UFconfig -I/usr/local/include    -fpic  -g -O2 -I../Include 
-DDLONG -c colamd.c -o colamd_l.o
ar -rucs ../../COLAMD.a colamd_global.o colamd_l.o # colamd.o
( cd Source ; make lib )
gcc -std=gnu99 -I/usr/local/R-devel/include -I../Include 
-I../../UFconfig -I/usr/local/include    -fpic  -g -O2 -c amd_global.c 
-o amd_global.o
make: don't know how to make amd_l_1.o. Stop
*** Error code 2
Stop in /tmp/Rtmpx5nUS8/R.INSTALL10d63af1/Matrix/src/AMD.
*** Error code 1
Stop in /tmp/Rtmpx5nUS8/R.INSTALL10d63af1/Matrix/src.
ERROR: compilation failed for package 'Matrix'
* Removing '/usr/local/R-devel/library/Matrix'
*** Error code 1
Stop in /usr/local/R-devel/src/library/Recommended.
*** Error code 1
Stop in /usr/local/R-devel/src/library/Recommended.
*** Error code 1
Stop in /usr/local/R-devel.
------------------------------------------------


Please note, that on FreeBSD there is a BSD 'make' as default. If I want 
to use gmake instead, I explicitly have to set it. Unfortunately this 
does not work within building the whole R-devel system.

With R-2.8.1 I have no problems installing and using R. When I want to 
build the (external) Matrix package I have to set an environment 
variable to gmake, found at /usr/local/bin/gmake and all works well.


Now my question: Is it possible to change the configure/build of the 
integrated Matrix package on R-devel? For all other packages there is no 
need to do so (at least for FreeBSD ;-)

Please let me know if I can help.

Thanks in advance,
Rainer Hurling


From jvierine at gmail.com  Sun Jan 11 23:19:39 2009
From: jvierine at gmail.com (Juha Vierinen)
Date: Sun, 11 Jan 2009 22:19:39 +0000
Subject: [Rd] complex-valued sparse matrices
Message-ID: <b96098070901111419if32ea41kad777eae1c582795@mail.gmail.com>

Hi,

I was looking at the sparse matrix packages and I noticed that complex
valued sparse matrices are not supported. Is there anybody working on
adding complex-support for the SparseM or the Matrix package?

juha


From ripley at stats.ox.ac.uk  Sun Jan 11 23:42:31 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 11 Jan 2009 22:42:31 +0000 (GMT)
Subject: [Rd] Package Matrix does not compile in R-devel_2009-01-10
In-Reply-To: <496A6F24.7050403@gwdg.de>
References: <496A6F24.7050403@gwdg.de>
Message-ID: <alpine.OSX.1.00.0901112220400.42149@tystie.local>

You need to take this up with the package maintainers: although 
recommended packages are distributed with R,  they are still 
contributed packages with separate maintainers.

At one point Matrix did work with a non-GNU make (the Solaris one) 
after suggestions from R-core members on how to remove the obvious 
GNUisms.  It would cetainly be helpful to let the package maintainers 
know what changes do work.  (I presume the issue is

amd_i_%.o: amd_%.c $(INC)
         $(CC) $(ALL_CPPFLAGS) $(ALL_CFLAGS) -I../Include -DDINT -c $< 
-o $@
amd_l_%.o: amd_%.c $(INC)
         $(CC) $(ALL_CPPFLAGS) $(ALL_CFLAGS) -I../Include -DDLONG -c $< 
-o $@

which are new rules since I was able to test.)

Unfortunately I can no longer build Matrix (and hence R-devel) on 
Solaris, as the Sun Studio compilers say some of the C++ code is 
invalid (and it looks so to me, and I reported it a while back): the 
file is spqr_front.cpp, so it has not got as far as the point that is 
giving you trouble.


On Sun, 11 Jan 2009, Rainer Hurling wrote:

> Dear developers,
>
> today I tried to build and install R-devel_2009-01-10 on FreeBSD 8.0-CURRENT 
> (i386) for testing purposes.
>
> All went well until compiling the now recommended (integrated) Matrix 
> package. At this point the following break occured:
>
> ------------------------------------------------
> begin installing recommended package Matrix
> * Installing *source* package 'Matrix' ...
> ** libs
> gcc -std=gnu99 -I/usr/local/R-devel/include -I./UFconfig -I/usr/local/include 
> -fpic  -g -O2 -c CHMfactor.c -o CHMfactor.o
> [..snip..]
> gcc -std=gnu99 -I/usr/local/R-devel/include -I../Include -I../../UFconfig 
> -I/usr/local/include    -fpic  -g -O2 -c colamd_global.c -o colamd_global.o
> gcc -std=gnu99 -I/usr/local/R-devel/include -I../Include -I../../UFconfig 
> -I/usr/local/include    -fpic  -g -O2 -I../Include -DDLONG -c colamd.c -o 
> colamd_l.o
> ar -rucs ../../COLAMD.a colamd_global.o colamd_l.o # colamd.o
> ( cd Source ; make lib )
> gcc -std=gnu99 -I/usr/local/R-devel/include -I../Include -I../../UFconfig 
> -I/usr/local/include    -fpic  -g -O2 -c amd_global.c -o amd_global.o
> make: don't know how to make amd_l_1.o. Stop
> *** Error code 2
> Stop in /tmp/Rtmpx5nUS8/R.INSTALL10d63af1/Matrix/src/AMD.
> *** Error code 1
> Stop in /tmp/Rtmpx5nUS8/R.INSTALL10d63af1/Matrix/src.
> ERROR: compilation failed for package 'Matrix'
> * Removing '/usr/local/R-devel/library/Matrix'
> *** Error code 1
> Stop in /usr/local/R-devel/src/library/Recommended.
> *** Error code 1
> Stop in /usr/local/R-devel/src/library/Recommended.
> *** Error code 1
> Stop in /usr/local/R-devel.
> ------------------------------------------------
>
>
> Please note, that on FreeBSD there is a BSD 'make' as default. If I want to 
> use gmake instead, I explicitly have to set it. Unfortunately this does not 
> work within building the whole R-devel system.

It would be helpful to know why not.  AFAIK GNU make works on other 
platforms with their own make.

> With R-2.8.1 I have no problems installing and using R. When I want to build 
> the (external) Matrix package I have to set an environment variable to gmake, 
> found at /usr/local/bin/gmake and all works well.
>
>
> Now my question: Is it possible to change the configure/build of the 
> integrated Matrix package on R-devel? For all other packages there is no need 
> to do so (at least for FreeBSD ;-)
>
> Please let me know if I can help.
>
> Thanks in advance,
> Rainer Hurling
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From daniel.sabanesbove at campus.lmu.de  Sun Jan 11 16:44:45 2009
From: daniel.sabanesbove at campus.lmu.de (=?UTF-8?B?RGFuaWVsIFNhYmFuw6lzIEJvdsOp?=)
Date: Sun, 11 Jan 2009 16:44:45 +0100
Subject: [Rd] cat cannot write more than 10000 characters? [R 2.8.1]
In-Reply-To: <alpine.OSX.1.00.0901111413260.17084@tystie.local>
References: <4960F7E8.2000705@campus.lmu.de>
	<alpine.LFD.2.00.0901050926040.32650@auk.stats.ox.ac.uk>
	<4961E90F.3040508@campus.lmu.de>
	<alpine.OSX.1.00.0901111413260.17084@tystie.local>
Message-ID: <496A13ED.1090208@campus.lmu.de>

Yes, I set the encoding to UTF-8 in my .Rprofile. Sorry that I didn't
mention it already. So the complete stand-alone test code which fails in
R --vanilla is the following:

### code begin
options (encoding = "utf-8")
testChunk <- paste(rep("a", 10000 + 1), ## delete "+ 1" to be successful
                   collapse="")
output <- tempfile()
cat(testChunk, sep = "\n", file = output, append = TRUE)
### code end

And the version and locale of my system are

R version 2.8.1 (2008-12-22)
i686-pc-linux-gnu
locale:
LC_CTYPE=de_DE.UTF-8;LC_NUMERIC=C;LC_TIME=de_DE.UTF-8;LC_COLLATE=de_DE.UTF-8;LC_MONETARY=C;LC_MESSAGES=de_DE.UTF-8;LC_PAPER=de_DE.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=de_DE.UTF-8;LC_IDENTIFICATION=C


Prof Brian Ripley schrieb:
> Looks like a bug in your iconv.  However, that section of code is
> conditionalized by
>
>     if(con->outconv) { /* translate the buffer */
>
> and I don't see that as non-NULL on my systems.  It should only be
> called when you specify an encoding on the output connection, so have
> you set an option (e.g. "encoding")  without telling us?
>
> I was able to reproduce a similar problem by
>
> cat(testChunk, sep = "\n", file = file("output", encoding="latin1"),
>     append = TRUE)
>
> in a UTF-8 locale, and I'll add a workaround to the R sources.
>
> Please do run your tests with R --vanilla and make sure they are
> complete -- see the posting guide.
>
>
> On Mon, 5 Jan 2009, Daniel Saban?s Bov? wrote:
>
>> Dear Prof. Ripley,
>>>> I have discovered that my cat function cannot write more than 10000
>>>> characters to a text file.
>
> I think you meant *bytes*, BTW.
>


From daniel.sabanesbove at campus.lmu.de  Sun Jan 11 18:49:40 2009
From: daniel.sabanesbove at campus.lmu.de (=?UTF-8?B?RGFuaWVsIFNhYmFuw6lzIEJvdsOp?=)
Date: Sun, 11 Jan 2009 18:49:40 +0100
Subject: [Rd] cat cannot write more than 10000 characters? [R 2.8.1]
In-Reply-To: <alpine.OSX.1.00.0901111739110.33178@tystie.local>
References: <4960F7E8.2000705@campus.lmu.de>
	<alpine.LFD.2.00.0901050926040.32650@auk.stats.ox.ac.uk>
	<4961E90F.3040508@campus.lmu.de>
	<alpine.OSX.1.00.0901111413260.17084@tystie.local>
	<496A13ED.1090208@campus.lmu.de>
	<alpine.OSX.1.00.0901111739110.33178@tystie.local>
Message-ID: <496A3134.2090205@campus.lmu.de>

Thank you very much for your help and advice!

Prof Brian Ripley schrieb:
> On Sun, 11 Jan 2009, Daniel Saban?s Bov? wrote:
>
>> Yes, I set the encoding to UTF-8 in my .Rprofile. Sorry that I didn't
>
> You really don't want to do that: it adds a considerable overhead and
> relies on a bug-free iconv ....
>
> The latest R-patched should work around this.
>


From murdoch at stats.uwo.ca  Mon Jan 12 14:22:52 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 12 Jan 2009 08:22:52 -0500
Subject: [Rd] Firefox 3 and HTML Search
In-Reply-To: <4967828C.3030408@stats.uwo.ca>
References: <4967828C.3030408@stats.uwo.ca>
Message-ID: <496B442C.2030508@stats.uwo.ca>

On 1/9/2009 11:59 AM, Duncan Murdoch wrote:
> I finally upgraded to Firefox 3.05 from 2.x, and now I can reproduce a 
> bug a colleague has been complaining about but which I hadn't been able 
> to reproduce before.  In Windows, set Firefox as the default browser. 
> Then in Rgui (seems to affect all versions up to R-devel), use the menu 
> to open HTML Help, and choose "Search Engine and Keywords".
> 
> Enter a keyword (e.g. plot), and click on "Search".
> 
> Things are a lot slower than they used to be with Firefox 2, but 
> eventually I get a result, starting out
> 
> Search Results
> The search string was "plot"
> 
> base-defunct
>      Defunct Functions in Base Package
> expression
>      Unevaluated Expressions
> 
> 
> However, the current URL is not the same as it was before:  it is now 
> listed as
> 
> file:///<RHOME>/doc/html/index.html
> 
> so the links don't work:  they are entered as 
> "../../../library/base/html/base-defunct.html", etc. in the source, and 
> the expect the current directory to be
> 
> file:///<RHOME>/doc/html/search/
> 
> If I set Internet Explorer as my default browser (yuck), things are 
> fine, so this is a Firefox 3 bug, or a new Java bug, or an R bug that 
> was masked before.
> 
> Any suggestions of workarounds?

As Brian and Marc pointed out, this is a Firefox 3.0 bug.  As it turns 
out, it was repaired in November, but not approved for release in 3.0.5 
or 3.0.6 (due this month??).  I've been told it will make it into 3.0.7.

For more on this, see

https://bugzilla.mozilla.org/show_bug.cgi?id=445004

Duncan Murdoch


From hb at stat.berkeley.edu  Mon Jan 12 21:43:16 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Mon, 12 Jan 2009 12:43:16 -0800
Subject: [Rd] x <- 1:2; dim(x) <- 2? A vector or not?
Message-ID: <59d7961d0901121243j6c5c0fcn5836d94a90666623@mail.gmail.com>

Ran into the follow intermediate case in an external package (w/
recent R v2.8.1 patched and R v2.9.0 devel):

> x <- 1:2
> dim(x) <- 2
> dim(x)
[1] 2
> x
[1] 1 2
> str(x)
 int [, 1:2] 1 2
> nrow(x)
[1] 2
> ncol(x)
[1] NA
> is.vector(x)
[1] FALSE
> is.matrix(x)
[1] FALSE
> is.array(x)
[1] TRUE
> x[1]
[1] 1
> x[,1]
Error in x[, 1] : incorrect number of dimensions
> x[1,]
Error in x[1, ] : incorrect number of dimensions

Is str() treating single-dimension arrays incorrectly?

What does it mean to have a single dimension this way?  Should it
equal a vector?  I am aware of "is.vector returns FALSE if x has any
attributes except names".

/Henrik


From rhurlin at gwdg.de  Mon Jan 12 22:23:58 2009
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Mon, 12 Jan 2009 22:23:58 +0100
Subject: [Rd] Package Matrix does not compile in R-devel_2009-01-10
In-Reply-To: <alpine.OSX.1.00.0901112220400.42149@tystie.local>
References: <496A6F24.7050403@gwdg.de>
	<alpine.OSX.1.00.0901112220400.42149@tystie.local>
Message-ID: <496BB4EE.5040001@gwdg.de>

Thank you Brian,

for this detailed answer. I think you are right with the new rules.

Before contacting the maintainers I will try to collect some more 
information about the observed failure. Without setting the environment 
variable MAKE to gmake, I get excatly the same break when installing 
Matrix under R-2.8.1. So I can test it under 2.8.1.

Rainer


On 11.01.2009 23:42 (UTC+1), Prof Brian Ripley wrote:
> You need to take this up with the package maintainers: although 
> recommended packages are distributed with R,  they are still contributed 
> packages with separate maintainers.
> 
> At one point Matrix did work with a non-GNU make (the Solaris one) after 
> suggestions from R-core members on how to remove the obvious GNUisms.  
> It would cetainly be helpful to let the package maintainers know what 
> changes do work.  (I presume the issue is
> 
> amd_i_%.o: amd_%.c $(INC)
>         $(CC) $(ALL_CPPFLAGS) $(ALL_CFLAGS) -I../Include -DDINT -c $< -o $@
> amd_l_%.o: amd_%.c $(INC)
>         $(CC) $(ALL_CPPFLAGS) $(ALL_CFLAGS) -I../Include -DDLONG -c $< 
> -o $@
> 
> which are new rules since I was able to test.)
> 
> Unfortunately I can no longer build Matrix (and hence R-devel) on 
> Solaris, as the Sun Studio compilers say some of the C++ code is invalid 
> (and it looks so to me, and I reported it a while back): the file is 
> spqr_front.cpp, so it has not got as far as the point that is giving you 
> trouble.
> 
> 
> On Sun, 11 Jan 2009, Rainer Hurling wrote:
> 
>> Dear developers,
>>
>> today I tried to build and install R-devel_2009-01-10 on FreeBSD 
>> 8.0-CURRENT (i386) for testing purposes.
>>
>> All went well until compiling the now recommended (integrated) Matrix 
>> package. At this point the following break occured:
>>
>> ------------------------------------------------
>> begin installing recommended package Matrix
>> * Installing *source* package 'Matrix' ...
>> ** libs
>> gcc -std=gnu99 -I/usr/local/R-devel/include -I./UFconfig 
>> -I/usr/local/include -fpic  -g -O2 -c CHMfactor.c -o CHMfactor.o
>> [..snip..]
>> gcc -std=gnu99 -I/usr/local/R-devel/include -I../Include 
>> -I../../UFconfig -I/usr/local/include    -fpic  -g -O2 -c 
>> colamd_global.c -o colamd_global.o
>> gcc -std=gnu99 -I/usr/local/R-devel/include -I../Include 
>> -I../../UFconfig -I/usr/local/include    -fpic  -g -O2 -I../Include 
>> -DDLONG -c colamd.c -o colamd_l.o
>> ar -rucs ../../COLAMD.a colamd_global.o colamd_l.o # colamd.o
>> ( cd Source ; make lib )
>> gcc -std=gnu99 -I/usr/local/R-devel/include -I../Include 
>> -I../../UFconfig -I/usr/local/include    -fpic  -g -O2 -c amd_global.c 
>> -o amd_global.o
>> make: don't know how to make amd_l_1.o. Stop
>> *** Error code 2
>> Stop in /tmp/Rtmpx5nUS8/R.INSTALL10d63af1/Matrix/src/AMD.
>> *** Error code 1
>> Stop in /tmp/Rtmpx5nUS8/R.INSTALL10d63af1/Matrix/src.
>> ERROR: compilation failed for package 'Matrix'
>> * Removing '/usr/local/R-devel/library/Matrix'
>> *** Error code 1
>> Stop in /usr/local/R-devel/src/library/Recommended.
>> *** Error code 1
>> Stop in /usr/local/R-devel/src/library/Recommended.
>> *** Error code 1
>> Stop in /usr/local/R-devel.
>> ------------------------------------------------
>>
>>
>> Please note, that on FreeBSD there is a BSD 'make' as default. If I 
>> want to use gmake instead, I explicitly have to set it. Unfortunately 
>> this does not work within building the whole R-devel system.
> 
> It would be helpful to know why not.  AFAIK GNU make works on other 
> platforms with their own make.
> 
>> With R-2.8.1 I have no problems installing and using R. When I want to 
>> build the (external) Matrix package I have to set an environment 
>> variable to gmake, found at /usr/local/bin/gmake and all works well.
>>
>>
>> Now my question: Is it possible to change the configure/build of the 
>> integrated Matrix package on R-devel? For all other packages there is 
>> no need to do so (at least for FreeBSD ;-)
>>
>> Please let me know if I can help.
>>
>> Thanks in advance,
>> Rainer Hurling


From therneau at mayo.edu  Tue Jan 13 00:12:31 2009
From: therneau at mayo.edu (Terry Therneau)
Date: Mon, 12 Jan 2009 17:12:31 -0600 (CST)
Subject: [Rd] irrelevant warning message
Message-ID: <200901122312.n0CNCVg10854@hsrnfs-101.mayo.edu>

Context: 
  R version 2.7.1 (2008-06-23)
  I don't know when this was upgraded in the department, I just ran into the 
aberrent behavior today.
  
Problem:
  
  Our group BY CHOICE does not change character variables into factors by 
default.  I can get into a long arguement as to why later, and will give one 
example of why below.
  
  The default behavior of S, Splus and R has been to create dummy variables for 
factor, character, and logical variables.  This is good.  
  
  Why has R suddenly gotton a compulsion to put out a warning message for any 
model where we do this?  I contend that it is
  - confusing
  - unnecessary
  - and wrong.
  
  It is certainly confusing, as it implies a behavior change when there has been 
no change.  
  The fact that the "factor" command was used behind the scenes is irrelevant to 
anyone - who cares that HOW the rules are implemented.  Is there going to soon 
be a message of WARNING: logical variable turned into numeric?  It is the 
sensible next step.
  Wrong because the data element in question is not converted - not at the user 
level at least.  It would be much more proper to say "was treated as a factor by 
model.matrix"; but that is a semantic issue.
  
  
  In any case- to the real question.
  
  1.What is the easiest way to eliminate this?  I would prefer not to have to 
change the source code and recompile the local versions.  Because of namespaces 
it is not as easy as adding a repaired copy to our local library and loading it 
first.  I remember some discussion about forcing a change into another name 
space but I've lost the link to it. 
  I'll do this if we must, but it is such a hassle to keep updating the change 
with new releases of the package.  It might still be less than dealing with the 
training/answer questions burden for our group, which is quite large.
  
  2. Is there any hope of undoing this?   Its only real impact is to annoy, and 
I've always disliked systems that preach at me.  (Detested is more like it, I 
still remember how hard it was to delete certain files in Digital's TOPS os, 
which was sure you ``didn't actually want to do that''.)  Allowing some global 
"stop preaching" option would be a fix, or in the same vein to have it look at 
the existing stringsAsFactors option for a "this person knows so don't bother 
him hint".
    If this addition followed on some discussion, please point me to it.

  The reaction of other experienced users in our group has been the same, when I 
pointed this out.  So I am not alone in the "why?"
  
  	Terry Therneau
  	

PS. Here are two interrelated reasons we don't autoconvert:

  1. Subject id.  Factors give no advantage for a unique id, and some clear 
problems.  In particular when one creates as subset - everyone over 60 say - 
there is no good reason to remember all the ids you didn't select.
  2. Subject id.  I work on a lot of studies of fractures and fracture risk.  A 
time-trend model might be
  	gam(fracture ~ subject + x1 + x2 + ..., subset=(sex='F'))
  
  Fracture risk for males and females is so different that separate models are 
the sensible thing.  If subject is a factor before the call, then my model has a 
zillion unneeded levels.  There are other ways out of this issue, but avoiding 
factors is the easiest.


From h.wickham at gmail.com  Tue Jan 13 01:21:47 2009
From: h.wickham at gmail.com (hadley wickham)
Date: Mon, 12 Jan 2009 18:21:47 -0600
Subject: [Rd] irrelevant warning message
In-Reply-To: <200901122312.n0CNCVg10854@hsrnfs-101.mayo.edu>
References: <200901122312.n0CNCVg10854@hsrnfs-101.mayo.edu>
Message-ID: <f8e6ff050901121621n238a401dic263c880b77e8f13@mail.gmail.com>

> PS. Here are two interrelated reasons we don't autoconvert:
>
>  1. Subject id.  Factors give no advantage for a unique id, and some clear
> problems.  In particular when one creates as subset - everyone over 60 say -
> there is no good reason to remember all the ids you didn't select.
>  2. Subject id.  I work on a lot of studies of fractures and fracture risk.  A
> time-trend model might be
>        gam(fracture ~ subject + x1 + x2 + ..., subset=(sex='F'))
>
>  Fracture risk for males and females is so different that separate models are
> the sensible thing.  If subject is a factor before the call, then my model has a
> zillion unneeded levels.  There are other ways out of this issue, but avoiding
> factors is the easiest.

3.  Factors take up more memory than character vectors.

(This is tongue-in-cheek, but in recent versions of R, factor
variables take up (very very slightly) more memory than character
variables. It's a common myth that the opposite is true)

I think R's handling of character vectors has progressed to the point
where they should be the norm, not the exception.  Maybe others will
have different views.

Hadley

-- 
http://had.co.nz/


From murdoch at stats.uwo.ca  Tue Jan 13 01:33:10 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 12 Jan 2009 19:33:10 -0500
Subject: [Rd] irrelevant warning message
In-Reply-To: <200901122312.n0CNCVg10854@hsrnfs-101.mayo.edu>
References: <200901122312.n0CNCVg10854@hsrnfs-101.mayo.edu>
Message-ID: <496BE146.3030201@stats.uwo.ca>

On 12/01/2009 6:12 PM, Terry Therneau wrote:
> Context: 
>   R version 2.7.1 (2008-06-23)
>   I don't know when this was upgraded in the department, I just ran into the 
> aberrent behavior today.
>   
> Problem:
>   
>   Our group BY CHOICE does not change character variables into factors by 
> default.  I can get into a long arguement as to why later, and will give one 
> example of why below.
>   
>   The default behavior of S, Splus and R has been to create dummy variables for 
> factor, character, and logical variables.  This is good.  
>   
>   Why has R suddenly gotton a compulsion to put out a warning message for any 
> model where we do this?  I contend that it is

I think you need to be more specific.  I just tried

x <- sample(letters[1:4], 100, rep=T)
y <- rnorm(x)
lm(y ~ x)

and got a warning in all R versions I tried back to 2.4.1.  In 2.3.1 
this was an error.

So I suspect the change you saw was to some other modelling function 
besides lm(), and I would guess that it came from making it consistent 
with lm().

But it would help if you told use which function, and which version 
you're comparing 2.7.1 with.

Now, it probably does make sense to suppress that warning.  I guess it 
was probably introduced because we used to give an error, and someone 
was being conservative and didn't think error-ful behaviour should go to 
accepted behaviour in one step.  But maybe it's time for the second step.

Duncan Murdoch

>   - confusing
>   - unnecessary
>   - and wrong.
>   
>   It is certainly confusing, as it implies a behavior change when there has been 
> no change.  
>   The fact that the "factor" command was used behind the scenes is irrelevant to 
> anyone - who cares that HOW the rules are implemented.  Is there going to soon 
> be a message of WARNING: logical variable turned into numeric?  It is the 
> sensible next step.
>   Wrong because the data element in question is not converted - not at the user 
> level at least.  It would be much more proper to say "was treated as a factor by 
> model.matrix"; but that is a semantic issue.
>   
>   
>   In any case- to the real question.
>   
>   1.What is the easiest way to eliminate this?  I would prefer not to have to 
> change the source code and recompile the local versions.  Because of namespaces 
> it is not as easy as adding a repaired copy to our local library and loading it 
> first.  I remember some discussion about forcing a change into another name 
> space but I've lost the link to it. 
>   I'll do this if we must, but it is such a hassle to keep updating the change 
> with new releases of the package.  It might still be less than dealing with the 
> training/answer questions burden for our group, which is quite large.
>   
>   2. Is there any hope of undoing this?   Its only real impact is to annoy, and 
> I've always disliked systems that preach at me.  (Detested is more like it, I 
> still remember how hard it was to delete certain files in Digital's TOPS os, 
> which was sure you ``didn't actually want to do that''.)  Allowing some global 
> "stop preaching" option would be a fix, or in the same vein to have it look at 
> the existing stringsAsFactors option for a "this person knows so don't bother 
> him hint".
>     If this addition followed on some discussion, please point me to it.
> 
>   The reaction of other experienced users in our group has been the same, when I 
> pointed this out.  So I am not alone in the "why?"
>   
>   	Terry Therneau
>   	
> 
> PS. Here are two interrelated reasons we don't autoconvert:
> 
>   1. Subject id.  Factors give no advantage for a unique id, and some clear 
> problems.  In particular when one creates as subset - everyone over 60 say - 
> there is no good reason to remember all the ids you didn't select.
>   2. Subject id.  I work on a lot of studies of fractures and fracture risk.  A 
> time-trend model might be
>   	gam(fracture ~ subject + x1 + x2 + ..., subset=(sex='F'))
>   
>   Fracture risk for males and females is so different that separate models are 
> the sensible thing.  If subject is a factor before the call, then my model has a 
> zillion unneeded levels.  There are other ways out of this issue, but avoiding 
> factors is the easiest.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Tue Jan 13 08:58:01 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 13 Jan 2009 07:58:01 +0000 (GMT)
Subject: [Rd] x <- 1:2; dim(x) <- 2? A vector or not?
In-Reply-To: <59d7961d0901121243j6c5c0fcn5836d94a90666623@mail.gmail.com>
References: <59d7961d0901121243j6c5c0fcn5836d94a90666623@mail.gmail.com>
Message-ID: <alpine.OSX.1.00.0901130744310.32363@tystie.local>

What you have is a one-dimensional array: they crop up in R most often 
from table() in my experience.

> f <- table(rpois(100, 4))
> str(f)
  'table' int [, 1:10] 2 6 18 21 13 16 13 4 3 4
  - attr(*, "dimnames")=List of 1
   ..$ : chr [1:10] "0" "1" "2" "3" ...

and yes, f is an atmoic vector and yes, str()'s notation is confusing 
here but if it did [1:10] you would not know it was an array.  I 
recall discussing this with Martin Maechler (str's author) last 
century, and I've just checked that R 2.0.0 did the same.

The place in which one-dimensional arrays differ from normal vectors 
is how names are handled: notice that my example has dimnames not 
names, and ?names says

      For a one-dimensional array the 'names' attribute really is
      'dimnames[[1]]'.

I think these days we have enough internal glue in place that an end 
user would not notice the difference (but those working at C level 
with R objects may need to know).

On Mon, 12 Jan 2009, Henrik Bengtsson wrote:

> Ran into the follow intermediate case in an external package (w/
> recent R v2.8.1 patched and R v2.9.0 devel):
>
>> x <- 1:2
>> dim(x) <- 2
>> dim(x)
> [1] 2
>> x
> [1] 1 2
>> str(x)
> int [, 1:2] 1 2
>> nrow(x)
> [1] 2
>> ncol(x)
> [1] NA
>> is.vector(x)
> [1] FALSE
>> is.matrix(x)
> [1] FALSE
>> is.array(x)
> [1] TRUE
>> x[1]
> [1] 1
>> x[,1]
> Error in x[, 1] : incorrect number of dimensions
>> x[1,]
> Error in x[1, ] : incorrect number of dimensions
>
> Is str() treating single-dimension arrays incorrectly?
>
> What does it mean to have a single dimension this way?  Should it
> equal a vector?  I am aware of "is.vector returns FALSE if x has any
> attributes except names".
>
> /Henrik
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Waclaw.Marcin.Kusnierczyk at idi.ntnu.no  Tue Jan 13 10:33:33 2009
From: Waclaw.Marcin.Kusnierczyk at idi.ntnu.no (Wacek Kusnierczyk)
Date: Tue, 13 Jan 2009 10:33:33 +0100
Subject: [Rd] R as a scripting engine
In-Reply-To: <18794.23441.997750.621046@ron.nulle.part>
References: <alpine.OSX.1.00.0901111151050.16921@tystie.local>
	<18794.23441.997750.621046@ron.nulle.part>
Message-ID: <496C5FED.8090007@idi.ntnu.no>

Dirk Eddelbuettel wrote:
> On 11 January 2009 at 20:18, Prof Brian Ripley wrote:
> | Those of you tracking R development will have noticed that we are 
> | moving towards using R as a scripting engine.
> [...]
> | Reasons:
> | 
> | - it is platform-independent and needs no other tools installed.
> [...]
> | - it is fast.
> [...]
>
> Indeed.  I really like working with r scripts. 
>
> And littler by Horner and Eddelbuettel is faster than Rscript -- see eg the
> scripts tests/timing.sh and tests/timing2.sh in the SVN archive / littler
> tarballs (and the results below for illustration).   
>
> We should still appreciate it you could finally acknowledge existence of
> littler it in the R / Rscript documentation.   You are not doing users any
> service by pretending it doesn't exist.  
>
>   

will anyone ever bother to answer?  is silence to be taken as
acknowledgement, or rather a7e?

vQ


From gavin.simpson at ucl.ac.uk  Tue Jan 13 10:35:35 2009
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Tue, 13 Jan 2009 09:35:35 +0000
Subject: [Rd] Missing links on Windows and \link[bar]{foo}; clarification
Message-ID: <1231839335.2864.20.camel@desktop.localhost>

Dear List,

In one of my packages on R-Forge I have a custom panel function for
Lattice graphics. In the Rd file for this panel function I want to
provide links to some lattice functions (in package lattice). My first
instinct was to use:

\code{\link[lattice]{panel.xyplot}}

for example. However, I missed a few references to lattice functions and
just marked them up as \code{\link{panel.xyplot}}.

For the latter, I am getting warnings about missing links during package
check and installation *only* on Windows and *only* on R patched
(R-Forge version: R version 2.8.1 Patched (2009-01-12 r47554)).

With R Devel (R-Forge version: 2.9.0 Under development (unstable)
(2009-01-10 r47538)) under Windows no warnings are issued.

The R-exts manual mentions that the first style is rarely needed, yet
the warnings on R-patched suggest that [currently] it is, for CHM help
only, which is where I presume the warnings are being generated.

Is the change in R Devel intentional or a side-effect of other changes
that is yet to be fixed? (I appreciate that this version of R is still
under development and unstable.) Is this difference between versions
related to (from NEWS)?:

o	HTML links will be resolved first to the standard packages: this
	avoids other installed packages diverting help on e.g. qr()
	and plot() to themselves.

So can I proceed under the assumption that \code{\link{panel.xyplot}} is
the correct methodology for linking to a functions in
another /recommended/ package?

Is this different when referring to a function in another,
non-recommended package (i.e. that \code{\link{panel.xyplot}} is
preferred in most situations)?

Thanks in advance,

Gavin
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: This is a digitally signed message part
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090113/c56ad350/attachment.bin>

From ripley at stats.ox.ac.uk  Tue Jan 13 12:04:44 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 13 Jan 2009 11:04:44 +0000 (GMT)
Subject: [Rd] Package Matrix does not compile in R-devel_2009-01-10
In-Reply-To: <496BB4EE.5040001@gwdg.de>
References: <496A6F24.7050403@gwdg.de>
	<alpine.OSX.1.00.0901112220400.42149@tystie.local>
	<496BB4EE.5040001@gwdg.de>
Message-ID: <alpine.OSX.1.00.0901131100280.49114@tystie.local>

I've discovered that Mac OS still has a FreeBSD make with which I can 
reproduce this.  So I am working with Martin on a patch for the next 
Matrix update.

Meanwhile, if there is an issue with building R-devel with GNU make 
under FreeBSD (e.g.

env MAKE=gmake ./configure
env MAKE=gmake make
)

we would like to know what it is (see the inline comment in my first 
reply).

On Mon, 12 Jan 2009, Rainer Hurling wrote:

> Thank you Brian,
>
> for this detailed answer. I think you are right with the new rules.
>
> Before contacting the maintainers I will try to collect some more information 
> about the observed failure. Without setting the environment variable MAKE to 
> gmake, I get excatly the same break when installing Matrix under R-2.8.1. So 
> I can test it under 2.8.1.
>
> Rainer
>
>
> On 11.01.2009 23:42 (UTC+1), Prof Brian Ripley wrote:
>> You need to take this up with the package maintainers: although recommended 
>> packages are distributed with R,  they are still contributed packages with 
>> separate maintainers.
>> 
>> At one point Matrix did work with a non-GNU make (the Solaris one) after 
>> suggestions from R-core members on how to remove the obvious GNUisms.  It 
>> would cetainly be helpful to let the package maintainers know what changes 
>> do work.  (I presume the issue is
>> 
>> amd_i_%.o: amd_%.c $(INC)
>>         $(CC) $(ALL_CPPFLAGS) $(ALL_CFLAGS) -I../Include -DDINT -c $< -o $@
>> amd_l_%.o: amd_%.c $(INC)
>>         $(CC) $(ALL_CPPFLAGS) $(ALL_CFLAGS) -I../Include -DDLONG -c $< -o 
>> $@
>> 
>> which are new rules since I was able to test.)
>> 
>> Unfortunately I can no longer build Matrix (and hence R-devel) on Solaris, 
>> as the Sun Studio compilers say some of the C++ code is invalid (and it 
>> looks so to me, and I reported it a while back): the file is 
>> spqr_front.cpp, so it has not got as far as the point that is giving you 
>> trouble.
>> 
>> 
>> On Sun, 11 Jan 2009, Rainer Hurling wrote:
>> 
>>> Dear developers,
>>> 
>>> today I tried to build and install R-devel_2009-01-10 on FreeBSD 
>>> 8.0-CURRENT (i386) for testing purposes.
>>> 
>>> All went well until compiling the now recommended (integrated) Matrix 
>>> package. At this point the following break occured:
>>> 
>>> ------------------------------------------------
>>> begin installing recommended package Matrix
>>> * Installing *source* package 'Matrix' ...
>>> ** libs
>>> gcc -std=gnu99 -I/usr/local/R-devel/include -I./UFconfig 
>>> -I/usr/local/include -fpic  -g -O2 -c CHMfactor.c -o CHMfactor.o
>>> [..snip..]
>>> gcc -std=gnu99 -I/usr/local/R-devel/include -I../Include -I../../UFconfig 
>>> -I/usr/local/include    -fpic  -g -O2 -c colamd_global.c -o 
>>> colamd_global.o
>>> gcc -std=gnu99 -I/usr/local/R-devel/include -I../Include -I../../UFconfig 
>>> -I/usr/local/include    -fpic  -g -O2 -I../Include -DDLONG -c colamd.c -o 
>>> colamd_l.o
>>> ar -rucs ../../COLAMD.a colamd_global.o colamd_l.o # colamd.o
>>> ( cd Source ; make lib )
>>> gcc -std=gnu99 -I/usr/local/R-devel/include -I../Include -I../../UFconfig 
>>> -I/usr/local/include    -fpic  -g -O2 -c amd_global.c -o amd_global.o
>>> make: don't know how to make amd_l_1.o. Stop
>>> *** Error code 2
>>> Stop in /tmp/Rtmpx5nUS8/R.INSTALL10d63af1/Matrix/src/AMD.
>>> *** Error code 1
>>> Stop in /tmp/Rtmpx5nUS8/R.INSTALL10d63af1/Matrix/src.
>>> ERROR: compilation failed for package 'Matrix'
>>> * Removing '/usr/local/R-devel/library/Matrix'
>>> *** Error code 1
>>> Stop in /usr/local/R-devel/src/library/Recommended.
>>> *** Error code 1
>>> Stop in /usr/local/R-devel/src/library/Recommended.
>>> *** Error code 1
>>> Stop in /usr/local/R-devel.
>>> ------------------------------------------------
>>> 
>>> 
>>> Please note, that on FreeBSD there is a BSD 'make' as default. If I want 
>>> to use gmake instead, I explicitly have to set it. Unfortunately this does 
>>> not work within building the whole R-devel system.
>> 
>> It would be helpful to know why not.  AFAIK GNU make works on other 
>> platforms with their own make.
>> 
>>> With R-2.8.1 I have no problems installing and using R. When I want to 
>>> build the (external) Matrix package I have to set an environment variable 
>>> to gmake, found at /usr/local/bin/gmake and all works well.
>>> 
>>> 
>>> Now my question: Is it possible to change the configure/build of the 
>>> integrated Matrix package on R-devel? For all other packages there is no 
>>> need to do so (at least for FreeBSD ;-)
>>> 
>>> Please let me know if I can help.
>>> 
>>> Thanks in advance,
>>> Rainer Hurling
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Tue Jan 13 12:12:55 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 13 Jan 2009 11:12:55 +0000 (GMT)
Subject: [Rd] Missing links on Windows and \link[bar]{foo}; clarification
In-Reply-To: <1231839335.2864.20.camel@desktop.localhost>
References: <1231839335.2864.20.camel@desktop.localhost>
Message-ID: <alpine.OSX.1.00.0901130948140.49114@tystie.local>

You would expect to see issues on Windows whilst checking, as 
cross-library links do not work on Windows (unless fixed up, which 
install.packages() does for some standard packages, not including 
lattice which is 'recommended' not 'standard').  And, depending where 
you install, perhaps during installation.

Note that specifying \code{\link[lattice]{panel.xyplot}} just avoids 
the warnings: it still does not make a cross-library link work.

As for R-devel: very likely processing of help will have changed 
completely before release, so that is one area where we do not want 
to know about problems as yet, and anything in the NEWS file is 
provisional (some of the changes mentioned there may be reverted).

On Tue, 13 Jan 2009, Gavin Simpson wrote:

> Dear List,
>
> In one of my packages on R-Forge I have a custom panel function for
> Lattice graphics. In the Rd file for this panel function I want to
> provide links to some lattice functions (in package lattice). My first
> instinct was to use:
>
> \code{\link[lattice]{panel.xyplot}}
>
> for example. However, I missed a few references to lattice functions and
> just marked them up as \code{\link{panel.xyplot}}.
>
> For the latter, I am getting warnings about missing links during package
> check and installation *only* on Windows and *only* on R patched
> (R-Forge version: R version 2.8.1 Patched (2009-01-12 r47554)).
>
> With R Devel (R-Forge version: 2.9.0 Under development (unstable)
> (2009-01-10 r47538)) under Windows no warnings are issued.
>
> The R-exts manual mentions that the first style is rarely needed, yet
> the warnings on R-patched suggest that [currently] it is, for CHM help
> only, which is where I presume the warnings are being generated.
>
> Is the change in R Devel intentional or a side-effect of other changes
> that is yet to be fixed? (I appreciate that this version of R is still
> under development and unstable.) Is this difference between versions
> related to (from NEWS)?:
>
> o	HTML links will be resolved first to the standard packages: this
> 	avoids other installed packages diverting help on e.g. qr()
> 	and plot() to themselves.

No, as lattice is not a 'standard' package.

> So can I proceed under the assumption that \code{\link{panel.xyplot}} is
> the correct methodology for linking to a functions in
> another /recommended/ package?
>
> Is this different when referring to a function in another,
> non-recommended package (i.e. that \code{\link{panel.xyplot}} is
> preferred in most situations)?
>
> Thanks in advance,
>
> Gavin
> --
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
> ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
> Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
> Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
> UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From gavin.simpson at ucl.ac.uk  Tue Jan 13 13:30:57 2009
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Tue, 13 Jan 2009 12:30:57 +0000
Subject: [Rd] Missing links on Windows and \link[bar]{foo}; clarification
In-Reply-To: <alpine.OSX.1.00.0901130948140.49114@tystie.local>
References: <1231839335.2864.20.camel@desktop.localhost>
	<alpine.OSX.1.00.0901130948140.49114@tystie.local>
Message-ID: <1231849857.1182.7.camel@prometheus.geog.ucl.ac.uk>

On Tue, 2009-01-13 at 11:12 +0000, Prof Brian Ripley wrote:
> You would expect to see issues on Windows whilst checking, as 
> cross-library links do not work on Windows (unless fixed up, which 
> install.packages() does for some standard packages, not including 
> lattice which is 'recommended' not 'standard').  And, depending where 
> you install, perhaps during installation.

Thank you for your reply Prof. Ripley.

> 
> Note that specifying \code{\link[lattice]{panel.xyplot}} just avoids 
> the warnings: it still does not make a cross-library link work.

That covers Windows and I'm happy to leave those warnings in place. Is
the simpler form sufficient to make the required links on Linux (and
MacOSX...?); that seems the intention of R-exts.pdf, to me at least.

> 
> As for R-devel: very likely processing of help will have changed 
> completely before release, so that is one area where we do not want 
> to know about problems as yet, and anything in the NEWS file is 
> provisional (some of the changes mentioned there may be reverted).

Yes, I realised that R-devel was changing considerably in this regard;
one of the reasons I was going through my Rd files was to fix-up some
problems with the mark-up that the new parser identified. Some changes I
made (not related to the parser version 2 warnings) triggered these
warnings on R-Forge.

All the best,

Gavin

> 
> On Tue, 13 Jan 2009, Gavin Simpson wrote:
> 
> > Dear List,
> >
> > In one of my packages on R-Forge I have a custom panel function for
> > Lattice graphics. In the Rd file for this panel function I want to
> > provide links to some lattice functions (in package lattice). My first
> > instinct was to use:
> >
> > \code{\link[lattice]{panel.xyplot}}
> >
> > for example. However, I missed a few references to lattice functions and
> > just marked them up as \code{\link{panel.xyplot}}.
> >
> > For the latter, I am getting warnings about missing links during package
> > check and installation *only* on Windows and *only* on R patched
> > (R-Forge version: R version 2.8.1 Patched (2009-01-12 r47554)).
> >
> > With R Devel (R-Forge version: 2.9.0 Under development (unstable)
> > (2009-01-10 r47538)) under Windows no warnings are issued.
> >
> > The R-exts manual mentions that the first style is rarely needed, yet
> > the warnings on R-patched suggest that [currently] it is, for CHM help
> > only, which is where I presume the warnings are being generated.
> >
> > Is the change in R Devel intentional or a side-effect of other changes
> > that is yet to be fixed? (I appreciate that this version of R is still
> > under development and unstable.) Is this difference between versions
> > related to (from NEWS)?:
> >
> > o	HTML links will be resolved first to the standard packages: this
> > 	avoids other installed packages diverting help on e.g. qr()
> > 	and plot() to themselves.
> 
> No, as lattice is not a 'standard' package.
> 
> > So can I proceed under the assumption that \code{\link{panel.xyplot}} is
> > the correct methodology for linking to a functions in
> > another /recommended/ package?
> >
> > Is this different when referring to a function in another,
> > non-recommended package (i.e. that \code{\link{panel.xyplot}} is
> > preferred in most situations)?
> >
> > Thanks in advance,
> >
> > Gavin
> > --
> > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
> > ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
> > Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
> > Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
> > UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
> > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> >
> >
> 
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From ripley at stats.ox.ac.uk  Tue Jan 13 13:40:20 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 13 Jan 2009 12:40:20 +0000 (GMT)
Subject: [Rd] Missing links on Windows and \link[bar]{foo}; clarification
In-Reply-To: <1231849857.1182.7.camel@prometheus.geog.ucl.ac.uk>
References: <1231839335.2864.20.camel@desktop.localhost>
	<alpine.OSX.1.00.0901130948140.49114@tystie.local>
	<1231849857.1182.7.camel@prometheus.geog.ucl.ac.uk>
Message-ID: <alpine.LFD.2.00.0901131237480.5590@auk.stats.ox.ac.uk>

On Tue, 13 Jan 2009, Gavin Simpson wrote:

> On Tue, 2009-01-13 at 11:12 +0000, Prof Brian Ripley wrote:
>> You would expect to see issues on Windows whilst checking, as
>> cross-library links do not work on Windows (unless fixed up, which
>> install.packages() does for some standard packages, not including
>> lattice which is 'recommended' not 'standard').  And, depending where
>> you install, perhaps during installation.
>
> Thank you for your reply Prof. Ripley.
>
>>
>> Note that specifying \code{\link[lattice]{panel.xyplot}} just avoids
>> the warnings: it still does not make a cross-library link work.
>
> That covers Windows and I'm happy to leave those warnings in place. Is
> the simpler form sufficient to make the required links on Linux (and
> MacOSX...?); that seems the intention of R-exts.pdf, to me at least.

Yes, the simpler form works on OSes where we can assume symbolic 
links (and before someone tells me Windows has them -- not in Windows 
2000, our minimum requirement still).

>> As for R-devel: very likely processing of help will have changed
>> completely before release, so that is one area where we do not want
>> to know about problems as yet, and anything in the NEWS file is
>> provisional (some of the changes mentioned there may be reverted).
>
> Yes, I realised that R-devel was changing considerably in this regard;
> one of the reasons I was going through my Rd files was to fix-up some
> problems with the mark-up that the new parser identified. Some changes I
> made (not related to the parser version 2 warnings) triggered these
> warnings on R-Forge.
>
> All the best,
>
> Gavin
>
>>
>> On Tue, 13 Jan 2009, Gavin Simpson wrote:
>>
>>> Dear List,
>>>
>>> In one of my packages on R-Forge I have a custom panel function for
>>> Lattice graphics. In the Rd file for this panel function I want to
>>> provide links to some lattice functions (in package lattice). My first
>>> instinct was to use:
>>>
>>> \code{\link[lattice]{panel.xyplot}}
>>>
>>> for example. However, I missed a few references to lattice functions and
>>> just marked them up as \code{\link{panel.xyplot}}.
>>>
>>> For the latter, I am getting warnings about missing links during package
>>> check and installation *only* on Windows and *only* on R patched
>>> (R-Forge version: R version 2.8.1 Patched (2009-01-12 r47554)).
>>>
>>> With R Devel (R-Forge version: 2.9.0 Under development (unstable)
>>> (2009-01-10 r47538)) under Windows no warnings are issued.
>>>
>>> The R-exts manual mentions that the first style is rarely needed, yet
>>> the warnings on R-patched suggest that [currently] it is, for CHM help
>>> only, which is where I presume the warnings are being generated.
>>>
>>> Is the change in R Devel intentional or a side-effect of other changes
>>> that is yet to be fixed? (I appreciate that this version of R is still
>>> under development and unstable.) Is this difference between versions
>>> related to (from NEWS)?:
>>>
>>> o	HTML links will be resolved first to the standard packages: this
>>> 	avoids other installed packages diverting help on e.g. qr()
>>> 	and plot() to themselves.
>>
>> No, as lattice is not a 'standard' package.
>>
>>> So can I proceed under the assumption that \code{\link{panel.xyplot}} is
>>> the correct methodology for linking to a functions in
>>> another /recommended/ package?
>>>
>>> Is this different when referring to a function in another,
>>> non-recommended package (i.e. that \code{\link{panel.xyplot}} is
>>> preferred in most situations)?
>>>
>>> Thanks in advance,
>>>
>>> Gavin
>>> --
>>> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>>> Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
>>> ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
>>> Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
>>> Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
>>> UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
>>> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>>>
>>>
>>
> -- 
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
> ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
> Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
> Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
> UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From therneau at mayo.edu  Tue Jan 13 14:28:33 2009
From: therneau at mayo.edu (Terry Therneau)
Date: Tue, 13 Jan 2009 07:28:33 -0600 (CST)
Subject: [Rd] irrelevant warning message
Message-ID: <200901131328.n0DDSXg03461@hsrnfs-101.mayo.edu>

Thanks for the replies:

Duncan: 
> and got a warning in all R versions I tried back to 2.4.1.  In 2.3.1 
> this was an error.

  It seems I have egg on my face wrt this point.  A more true synopsis of what I 
saw should have been that 1. I've never noticed this in R before and 2. Until 
recently I did all my modeling in Splus or Bell S, and character vectors always 
worked there.  (My survival routines were always more up to date in Splus 
because that's what I use for the source code.  But conversion from a local cvs 
archive to Rforge is nearly done -- just a survexp.us ratetable issue remains -- 
so R will become my most current version in another day or two.)  Possibly I 
don't have any character variables as covariates in the survival test suite.
  
 
Hadley:
> I think R's handling of character vectors has progressed to the point
> where they should be the norm, not the exception.  Maybe others will
> have different views.

  Factors are very useful when there is a small discrete number of levels, and I 
use them moderately often.  For that case, most of the default behavior of 
factors makes perfect sense, e.g., retention of levels.  I'm very sure that 
adding stringsAsFactors to the system options was a good thing, not as sure that 
defaulting it to FALSE is the best thing for all users.  
   In my world most of the data comes from formal processes: clinical trials, 
data bases, large studies that use dedicated keyed entry, etc.  The most common 
character variables are things like id, name, and address for which the factor 
paradym doesn't work, and most of the variables I get that are actually 
'factors' come to me as small integers; I turn them into factors using both the 
levels and labels arguments.  Thus autoconversion is just a PITA. But my world 
is not everyone's. 
   My main complaint with factors has always been the assumption that everything 
should be turned into one.  I fought that battle with Splus.  Defaults behavior 
is often a reflection of the data sets being analysed at the time the code was 
written, and factors reflect the data sets in Chambers & Hastie book.  But then, 
my survival code has some defaults with exactly the same origin...


From ggrothendieck at gmail.com  Tue Jan 13 14:34:23 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 13 Jan 2009 08:34:23 -0500
Subject: [Rd] irrelevant warning message
In-Reply-To: <200901131328.n0DDSXg03461@hsrnfs-101.mayo.edu>
References: <200901131328.n0DDSXg03461@hsrnfs-101.mayo.edu>
Message-ID: <971536df0901130534j5e3e504fk87f3013a8f7cd8a3@mail.gmail.com>

On Tue, Jan 13, 2009 at 8:28 AM, Terry Therneau <therneau at mayo.edu> wrote:
> Thanks for the replies:
>
> Duncan:
>> and got a warning in all R versions I tried back to 2.4.1.  In 2.3.1
>> this was an error.
>
>  It seems I have egg on my face wrt this point.  A more true synopsis of what I
> saw should have been that 1. I've never noticed this in R before and 2. Until
> recently I did all my modeling in Splus or Bell S, and character vectors always
> worked there.  (My survival routines were always more up to date in Splus
> because that's what I use for the source code.  But conversion from a local cvs
> archive to Rforge is nearly done -- just a survexp.us ratetable issue remains --
> so R will become my most current version in another day or two.)  Possibly I
> don't have any character variables as covariates in the survival test suite.
>
>
> Hadley:
>> I think R's handling of character vectors has progressed to the point
>> where they should be the norm, not the exception.  Maybe others will
>> have different views.
>
>  Factors are very useful when there is a small discrete number of levels, and I
> use them moderately often.  For that case, most of the default behavior of
> factors makes perfect sense, e.g., retention of levels.  I'm very sure that
> adding stringsAsFactors to the system options was a good thing, not as sure that
> defaulting it to FALSE is the best thing for all users.
>   In my world most of the data comes from formal processes: clinical trials,
> data bases, large studies that use dedicated keyed entry, etc.  The most common
> character variables are things like id, name, and address for which the factor
> paradym doesn't work, and most of the variables I get that are actually
> 'factors' come to me as small integers; I turn them into factors using both the
> levels and labels arguments.  Thus autoconversion is just a PITA. But my world
> is not everyone's.
>   My main complaint with factors has always been the assumption that everything
> should be turned into one.  I fought that battle with Splus.  Defaults behavior

See the stringsAsFactors option in ?options to change the global default.


From murdoch at stats.uwo.ca  Tue Jan 13 15:46:31 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 13 Jan 2009 09:46:31 -0500
Subject: [Rd] R as a scripting engine
In-Reply-To: <496C5FED.8090007@idi.ntnu.no>
References: <alpine.OSX.1.00.0901111151050.16921@tystie.local>	<18794.23441.997750.621046@ron.nulle.part>
	<496C5FED.8090007@idi.ntnu.no>
Message-ID: <496CA947.9060601@stats.uwo.ca>

On 1/13/2009 4:33 AM, Wacek Kusnierczyk wrote:
> Dirk Eddelbuettel wrote:
>> On 11 January 2009 at 20:18, Prof Brian Ripley wrote:
>> | Those of you tracking R development will have noticed that we are 
>> | moving towards using R as a scripting engine.
>> [...]
>> | Reasons:
>> | 
>> | - it is platform-independent and needs no other tools installed.
>> [...]
>> | - it is fast.
>> [...]
>>
>> Indeed.  I really like working with r scripts. 
>>
>> And littler by Horner and Eddelbuettel is faster than Rscript -- see eg the
>> scripts tests/timing.sh and tests/timing2.sh in the SVN archive / littler
>> tarballs (and the results below for illustration).   
>>
>> We should still appreciate it you could finally acknowledge existence of
>> littler it in the R / Rscript documentation.   You are not doing users any
>> service by pretending it doesn't exist.  
>>
>>   
> 
> will anyone ever bother to answer?  is silence to be taken as
> acknowledgement, or rather a7e?

You answered, so the naive answer to your first question is yes.

Another naive response is that there probably won't be another answer.

But I don't think your question is really a question, I think it's a 
demand, implying you think you are entitled to an answer.  There isn't 
really a polite response to that.   You're entitled to demand answers 
from companies that you are paying for services (and you often won't get 
any useful ones), but you aren't entitled to demand anything from anyone 
on this list.  So live with it.

Your second question doesn't make any sense to me: obviously silence is a7s.

Duncan Murdoch


From hb at stat.berkeley.edu  Tue Jan 13 16:54:09 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Tue, 13 Jan 2009 07:54:09 -0800
Subject: [Rd] x <- 1:2; dim(x) <- 2? A vector or not?
In-Reply-To: <alpine.OSX.1.00.0901130744310.32363@tystie.local>
References: <59d7961d0901121243j6c5c0fcn5836d94a90666623@mail.gmail.com>
	<alpine.OSX.1.00.0901130744310.32363@tystie.local>
Message-ID: <59d7961d0901130754j335c480fi673346cd20e031e@mail.gmail.com>

Hi.

On Mon, Jan 12, 2009 at 11:58 PM, Prof Brian Ripley
<ripley at stats.ox.ac.uk> wrote:
> What you have is a one-dimensional array: they crop up in R most often from
> table() in my experience.
>
>> f <- table(rpois(100, 4))
>> str(f)
>
>  'table' int [, 1:10] 2 6 18 21 13 16 13 4 3 4
>  - attr(*, "dimnames")=List of 1
>  ..$ : chr [1:10] "0" "1" "2" "3" ...
>
> and yes, f is an atmoic vector and yes, str()'s notation is confusing here
> but if it did [1:10] you would not know it was an array.  I recall
> discussing this with Martin Maechler (str's author) last century, and I've
> just checked that R 2.0.0 did the same.
>
> The place in which one-dimensional arrays differ from normal vectors is how
> names are handled: notice that my example has dimnames not names, and ?names
> says
>
>     For a one-dimensional array the 'names' attribute really is
>     'dimnames[[1]]'.

Thanks for this explanation.  One could then argue that [1:10,] is
somewhat better than [,1:10], but that is just polish.

/Henrik

>
> I think these days we have enough internal glue in place that an end user
> would not notice the difference (but those working at C level with R objects
> may need to know).
>
> On Mon, 12 Jan 2009, Henrik Bengtsson wrote:
>
>> Ran into the follow intermediate case in an external package (w/
>> recent R v2.8.1 patched and R v2.9.0 devel):
>>
>>> x <- 1:2
>>> dim(x) <- 2
>>> dim(x)
>>
>> [1] 2
>>>
>>> x
>>
>> [1] 1 2
>>>
>>> str(x)
>>
>> int [, 1:2] 1 2
>>>
>>> nrow(x)
>>
>> [1] 2
>>>
>>> ncol(x)
>>
>> [1] NA
>>>
>>> is.vector(x)
>>
>> [1] FALSE
>>>
>>> is.matrix(x)
>>
>> [1] FALSE
>>>
>>> is.array(x)
>>
>> [1] TRUE
>>>
>>> x[1]
>>
>> [1] 1
>>>
>>> x[,1]
>>
>> Error in x[, 1] : incorrect number of dimensions
>>>
>>> x[1,]
>>
>> Error in x[1, ] : incorrect number of dimensions
>>
>> Is str() treating single-dimension arrays incorrectly?
>>
>> What does it mean to have a single dimension this way?  Should it
>> equal a vector?  I am aware of "is.vector returns FALSE if x has any
>> attributes except names".
>>
>> /Henrik
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From osklyar at maninvestments.com  Tue Jan 13 17:00:53 2009
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Tue, 13 Jan 2009 16:00:53 -0000
Subject: [Rd] particulars of importing/loading libraries
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE43047DF583@mildnpexmb01.maninvestments.ad.man.com>

Dear List:

Sorry for posting maybe a trivial question, but I have a basic
understanding problem. If I have say pack1 and pack2, two R packages,
and pack2 depends on and imports pack1 fully (as in the code below), is
there a way to make all the functionality of pack1 available for the
global and other environments (not only for the functions called from
withing pack2) by loading pack2 only? I thought if pack2 depends on and
imports pack1 and essentially reexports everything, one should get the
full functionality simply by loading pack2. This does not seem to be the
case or I am missing something trivial in my NAMESPACE/DESCRIPTION
files?

If this is documented in Writing R Extensions, I would be thankful for a
page number and maybe a quick fix in my example below as so far I have
not been able to find a clear explanation.

The problem can be illustrated by the following simple example (this is
a simple code for 2 packages, pack1 and pack2; plus an example).

Thank you for your replies.

Dr Oleg Sklyar
Research Technologist
AHL / Man Investments Ltd
+44 (0)20 7144 3107
osklyar at maninvestments.com

--- pack1: DESCRIPTION ------
Package: pack1
Version: 0.0.1
Date: 12 Jan 2009
Title: pack1 to test S3/S4 methods compatibility
Author:  Oleg Sklyar
Depends: R (>= 2.7.1), methods
Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
Description: pack1
LazyLoad: yes
License: Proprietary
URL: http://www.maninvestments.com
LazyLoad: no

--- pack1: NAMESPACE ------
import(methods)
exportPattern("^[^\\.]")
exportClasses(posixTime)
exportMethods(as.POSIXct)

--- pack1: posix.R ------
setClass("posixTime", "numeric")

setGeneric("as.POSIXct")
setMethod("as.POSIXct", signature(x="posixTime"),
    function(x, tz) {
        z = x at .Data
        attr(z,"class") = c("POSIXt", "POSIXct")
        attr(z,"tzone") = "UTC"
        z
    }
)

testPosixVal = new("posixTime", as.numeric(Sys.time()))

--- pack2: DESCRIPTION 
Package: pack2
Version: 0.0.1
Date: 12 Jan 2009
Title: pack2 to test S3/S4 methods compatibility
Author:  Oleg Sklyar
Depends: R (>= 2.7.1), methods
Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
Description: pack2
LazyLoad: yes
License: Proprietary
URL: http://www.maninvestments.com
LazyLoad: no

--- pack2: NAMESPACE ------
import(pack1)
exportPattern("^[^\\.]")

--- pack2: posix.R ------
testPosix = function() {
    z = as.POSIXct(testPosixVal)
    print(z)
    print(class(z))
    z
}

------ test code to run from global env, showing problems -------
require(pack2)

## use as.POSIXct imported into pack2 from pack1 to do the conversion in
the fun
testPosix()
#~ [1] "2009-01-13 15:29:50 UTC"
#~ [1] "POSIXt"  "POSIXct"
#~ [1] "2009-01-13 15:29:50 UTC"

## now try using it directly from the global env (pack1 was not
explicitly loaded)
as.POSIXct(pack1::testPosixVal)
#~ Error in as.POSIXct.default(pack1::testPosixVal) : 
#~  do not know how to convert 'pack1::testPosixVal' to class "POSIXlt"

## now require pack1 explicitly and try again
require(pack1)
as.POSIXct(pack1::testPosixVal)
#~ [1] "2009-01-13 15:29:50 UTC"


**********************************************************************
Please consider the environment before printing this email or its attachments.
The contents of this email are for the named addressees ...{{dropped:19}}


From mtmorgan at fhcrc.org  Tue Jan 13 17:30:34 2009
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Tue, 13 Jan 2009 08:30:34 -0800
Subject: [Rd] particulars of importing/loading libraries
In-Reply-To: <1A68FCB28DE72F4BA3B967E6506CCE43047DF583@mildnpexmb01.maninvestments.ad.man.com>
	(Oleg Sklyar's message of "Tue, 13 Jan 2009 16:00:53 -0000")
References: <1A68FCB28DE72F4BA3B967E6506CCE43047DF583@mildnpexmb01.maninvestments.ad.man.com>
Message-ID: <6phvdsjrwwl.fsf@gopher4.fhcrc.org>

Hi Oleg --

"Sklyar, Oleg (London)" <osklyar at maninvestments.com> writes:

> Dear List:
>
> Sorry for posting maybe a trivial question, but I have a basic
> understanding problem. If I have say pack1 and pack2, two R packages,
> and pack2 depends on and imports pack1 fully (as in the code below), is
> there a way to make all the functionality of pack1 available for the
> global and other environments (not only for the functions called from
> withing pack2) by loading pack2 only? I thought if pack2 depends on and
> imports pack1 and essentially reexports everything, one should get the
> full functionality simply by loading pack2. This does not seem to be the
> case or I am missing something trivial in my NAMESPACE/DESCRIPTION
> files?

I think that exportPattern does a simple ls() on the environment of
the package name space. The imported symbols are not defined in that
environment, but (I think) in a variable .__NAMESPACE__. and so are
not discovered.  Arguably, exportPattern (and friends) should be
smarter. Pragmatically, you need to re-export imported symbols
explicitly. I haven't worked this through entirely, and could be
wrong...

Martin

> If this is documented in Writing R Extensions, I would be thankful for a
> page number and maybe a quick fix in my example below as so far I have
> not been able to find a clear explanation.
>
> The problem can be illustrated by the following simple example (this is
> a simple code for 2 packages, pack1 and pack2; plus an example).
>
> Thank you for your replies.
>
> Dr Oleg Sklyar
> Research Technologist
> AHL / Man Investments Ltd
> +44 (0)20 7144 3107
> osklyar at maninvestments.com
>
> --- pack1: DESCRIPTION ------
> Package: pack1
> Version: 0.0.1
> Date: 12 Jan 2009
> Title: pack1 to test S3/S4 methods compatibility
> Author:  Oleg Sklyar
> Depends: R (>= 2.7.1), methods
> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
> Description: pack1
> LazyLoad: yes
> License: Proprietary
> URL: http://www.maninvestments.com
> LazyLoad: no
>
> --- pack1: NAMESPACE ------
> import(methods)
> exportPattern("^[^\\.]")
> exportClasses(posixTime)
> exportMethods(as.POSIXct)
>
> --- pack1: posix.R ------
> setClass("posixTime", "numeric")
>
> setGeneric("as.POSIXct")
> setMethod("as.POSIXct", signature(x="posixTime"),
>     function(x, tz) {
>         z = x at .Data
>         attr(z,"class") = c("POSIXt", "POSIXct")
>         attr(z,"tzone") = "UTC"
>         z
>     }
> )
>
> testPosixVal = new("posixTime", as.numeric(Sys.time()))
>
> --- pack2: DESCRIPTION 
> Package: pack2
> Version: 0.0.1
> Date: 12 Jan 2009
> Title: pack2 to test S3/S4 methods compatibility
> Author:  Oleg Sklyar
> Depends: R (>= 2.7.1), methods
> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
> Description: pack2
> LazyLoad: yes
> License: Proprietary
> URL: http://www.maninvestments.com
> LazyLoad: no
>
> --- pack2: NAMESPACE ------
> import(pack1)
> exportPattern("^[^\\.]")
>
> --- pack2: posix.R ------
> testPosix = function() {
>     z = as.POSIXct(testPosixVal)
>     print(z)
>     print(class(z))
>     z
> }
>
> ------ test code to run from global env, showing problems -------
> require(pack2)
>
> ## use as.POSIXct imported into pack2 from pack1 to do the conversion in
> the fun
> testPosix()
> #~ [1] "2009-01-13 15:29:50 UTC"
> #~ [1] "POSIXt"  "POSIXct"
> #~ [1] "2009-01-13 15:29:50 UTC"
>
> ## now try using it directly from the global env (pack1 was not
> explicitly loaded)
> as.POSIXct(pack1::testPosixVal)
> #~ Error in as.POSIXct.default(pack1::testPosixVal) : 
> #~  do not know how to convert 'pack1::testPosixVal' to class "POSIXlt"
>
> ## now require pack1 explicitly and try again
> require(pack1)
> as.POSIXct(pack1::testPosixVal)
> #~ [1] "2009-01-13 15:29:50 UTC"
>
>
> **********************************************************************
> Please consider the environment before printing this email or its attachments.
> The contents of this email are for the named addressees ...{{dropped:19}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin Morgan
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M2 B169
Phone: (206) 667-2793


From osklyar at maninvestments.com  Tue Jan 13 17:33:18 2009
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Tue, 13 Jan 2009 16:33:18 -0000
Subject: [Rd] particulars of importing/loading libraries
In-Reply-To: <6phvdsjrwwl.fsf@gopher4.fhcrc.org>
References: <1A68FCB28DE72F4BA3B967E6506CCE43047DF583@mildnpexmb01.maninvestments.ad.man.com>
	<6phvdsjrwwl.fsf@gopher4.fhcrc.org>
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE43047DF585@mildnpexmb01.maninvestments.ad.man.com>

I was thinking of this, but this is going to be a pain if a package
imports 5 packs, is being imported by another one, which itself is
imported by yet another one and the only one one would like to load
explicitly is the last down the line. If I do not find a better solution
this is what I probably will have to do, reexport everything. 

Dr Oleg Sklyar
Research Technologist
AHL / Man Investments Ltd
+44 (0)20 7144 3107
osklyar at maninvestments.com 

> -----Original Message-----
> From: Martin Morgan [mailto:mtmorgan at fhcrc.org] 
> Sent: 13 January 2009 16:31
> To: Sklyar, Oleg (London)
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] particulars of importing/loading libraries
> 
> Hi Oleg --
> 
> "Sklyar, Oleg (London)" <osklyar at maninvestments.com> writes:
> 
> > Dear List:
> >
> > Sorry for posting maybe a trivial question, but I have a basic
> > understanding problem. If I have say pack1 and pack2, two R 
> packages,
> > and pack2 depends on and imports pack1 fully (as in the 
> code below), is
> > there a way to make all the functionality of pack1 available for the
> > global and other environments (not only for the functions 
> called from
> > withing pack2) by loading pack2 only? I thought if pack2 
> depends on and
> > imports pack1 and essentially reexports everything, one 
> should get the
> > full functionality simply by loading pack2. This does not 
> seem to be the
> > case or I am missing something trivial in my NAMESPACE/DESCRIPTION
> > files?
> 
> I think that exportPattern does a simple ls() on the environment of
> the package name space. The imported symbols are not defined in that
> environment, but (I think) in a variable .__NAMESPACE__. and so are
> not discovered.  Arguably, exportPattern (and friends) should be
> smarter. Pragmatically, you need to re-export imported symbols
> explicitly. I haven't worked this through entirely, and could be
> wrong...
> 
> Martin
> 
> > If this is documented in Writing R Extensions, I would be 
> thankful for a
> > page number and maybe a quick fix in my example below as so 
> far I have
> > not been able to find a clear explanation.
> >
> > The problem can be illustrated by the following simple 
> example (this is
> > a simple code for 2 packages, pack1 and pack2; plus an example).
> >
> > Thank you for your replies.
> >
> > Dr Oleg Sklyar
> > Research Technologist
> > AHL / Man Investments Ltd
> > +44 (0)20 7144 3107
> > osklyar at maninvestments.com
> >
> > --- pack1: DESCRIPTION ------
> > Package: pack1
> > Version: 0.0.1
> > Date: 12 Jan 2009
> > Title: pack1 to test S3/S4 methods compatibility
> > Author:  Oleg Sklyar
> > Depends: R (>= 2.7.1), methods
> > Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
> > Description: pack1
> > LazyLoad: yes
> > License: Proprietary
> > URL: http://www.maninvestments.com
> > LazyLoad: no
> >
> > --- pack1: NAMESPACE ------
> > import(methods)
> > exportPattern("^[^\\.]")
> > exportClasses(posixTime)
> > exportMethods(as.POSIXct)
> >
> > --- pack1: posix.R ------
> > setClass("posixTime", "numeric")
> >
> > setGeneric("as.POSIXct")
> > setMethod("as.POSIXct", signature(x="posixTime"),
> >     function(x, tz) {
> >         z = x at .Data
> >         attr(z,"class") = c("POSIXt", "POSIXct")
> >         attr(z,"tzone") = "UTC"
> >         z
> >     }
> > )
> >
> > testPosixVal = new("posixTime", as.numeric(Sys.time()))
> >
> > --- pack2: DESCRIPTION 
> > Package: pack2
> > Version: 0.0.1
> > Date: 12 Jan 2009
> > Title: pack2 to test S3/S4 methods compatibility
> > Author:  Oleg Sklyar
> > Depends: R (>= 2.7.1), methods
> > Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
> > Description: pack2
> > LazyLoad: yes
> > License: Proprietary
> > URL: http://www.maninvestments.com
> > LazyLoad: no
> >
> > --- pack2: NAMESPACE ------
> > import(pack1)
> > exportPattern("^[^\\.]")
> >
> > --- pack2: posix.R ------
> > testPosix = function() {
> >     z = as.POSIXct(testPosixVal)
> >     print(z)
> >     print(class(z))
> >     z
> > }
> >
> > ------ test code to run from global env, showing problems -------
> > require(pack2)
> >
> > ## use as.POSIXct imported into pack2 from pack1 to do the 
> conversion in
> > the fun
> > testPosix()
> > #~ [1] "2009-01-13 15:29:50 UTC"
> > #~ [1] "POSIXt"  "POSIXct"
> > #~ [1] "2009-01-13 15:29:50 UTC"
> >
> > ## now try using it directly from the global env (pack1 was not
> > explicitly loaded)
> > as.POSIXct(pack1::testPosixVal)
> > #~ Error in as.POSIXct.default(pack1::testPosixVal) : 
> > #~  do not know how to convert 'pack1::testPosixVal' to 
> class "POSIXlt"
> >
> > ## now require pack1 explicitly and try again
> > require(pack1)
> > as.POSIXct(pack1::testPosixVal)
> > #~ [1] "2009-01-13 15:29:50 UTC"
> >
> >
> > 
> **********************************************************************
> > Please consider the environment before printing this email 
> or its attachments.
> > The contents of this email are for the named addressees 
> ...{{dropped:19}}
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> -- 
> Martin Morgan
> Computational Biology / Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N.
> PO Box 19024 Seattle, WA 98109
> 
> Location: Arnold Building M2 B169
> Phone: (206) 667-2793
> 

**********************************************************************
Please consider the environment before printing this email or its attachments.
The contents of this email are for the named addressees ...{{dropped:19}}


From osklyar at maninvestments.com  Tue Jan 13 17:46:53 2009
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Tue, 13 Jan 2009 16:46:53 -0000
Subject: [Rd] particulars of importing/loading libraries
In-Reply-To: <6phvdsjrwwl.fsf@gopher4.fhcrc.org>
References: <1A68FCB28DE72F4BA3B967E6506CCE43047DF583@mildnpexmb01.maninvestments.ad.man.com>
	<6phvdsjrwwl.fsf@gopher4.fhcrc.org>
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE43047DF587@mildnpexmb01.maninvestments.ad.man.com>

So essentially I guess it would be nice to have a way of reexporting
everything in

get("imports",env=pack2:::.__NAMESPACE__.)



Dr Oleg Sklyar
Research Technologist
AHL / Man Investments Ltd
+44 (0)20 7144 3107
osklyar at maninvestments.com 

> -----Original Message-----
> From: Martin Morgan [mailto:mtmorgan at fhcrc.org] 
> Sent: 13 January 2009 16:31
> To: Sklyar, Oleg (London)
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] particulars of importing/loading libraries
> 
> Hi Oleg --
> 
> "Sklyar, Oleg (London)" <osklyar at maninvestments.com> writes:
> 
> > Dear List:
> >
> > Sorry for posting maybe a trivial question, but I have a basic
> > understanding problem. If I have say pack1 and pack2, two R 
> packages,
> > and pack2 depends on and imports pack1 fully (as in the 
> code below), is
> > there a way to make all the functionality of pack1 available for the
> > global and other environments (not only for the functions 
> called from
> > withing pack2) by loading pack2 only? I thought if pack2 
> depends on and
> > imports pack1 and essentially reexports everything, one 
> should get the
> > full functionality simply by loading pack2. This does not 
> seem to be the
> > case or I am missing something trivial in my NAMESPACE/DESCRIPTION
> > files?
> 
> I think that exportPattern does a simple ls() on the environment of
> the package name space. The imported symbols are not defined in that
> environment, but (I think) in a variable .__NAMESPACE__. and so are
> not discovered.  Arguably, exportPattern (and friends) should be
> smarter. Pragmatically, you need to re-export imported symbols
> explicitly. I haven't worked this through entirely, and could be
> wrong...
> 
> Martin
> 
> > If this is documented in Writing R Extensions, I would be 
> thankful for a
> > page number and maybe a quick fix in my example below as so 
> far I have
> > not been able to find a clear explanation.
> >
> > The problem can be illustrated by the following simple 
> example (this is
> > a simple code for 2 packages, pack1 and pack2; plus an example).
> >
> > Thank you for your replies.
> >
> > Dr Oleg Sklyar
> > Research Technologist
> > AHL / Man Investments Ltd
> > +44 (0)20 7144 3107
> > osklyar at maninvestments.com
> >
> > --- pack1: DESCRIPTION ------
> > Package: pack1
> > Version: 0.0.1
> > Date: 12 Jan 2009
> > Title: pack1 to test S3/S4 methods compatibility
> > Author:  Oleg Sklyar
> > Depends: R (>= 2.7.1), methods
> > Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
> > Description: pack1
> > LazyLoad: yes
> > License: Proprietary
> > URL: http://www.maninvestments.com
> > LazyLoad: no
> >
> > --- pack1: NAMESPACE ------
> > import(methods)
> > exportPattern("^[^\\.]")
> > exportClasses(posixTime)
> > exportMethods(as.POSIXct)
> >
> > --- pack1: posix.R ------
> > setClass("posixTime", "numeric")
> >
> > setGeneric("as.POSIXct")
> > setMethod("as.POSIXct", signature(x="posixTime"),
> >     function(x, tz) {
> >         z = x at .Data
> >         attr(z,"class") = c("POSIXt", "POSIXct")
> >         attr(z,"tzone") = "UTC"
> >         z
> >     }
> > )
> >
> > testPosixVal = new("posixTime", as.numeric(Sys.time()))
> >
> > --- pack2: DESCRIPTION 
> > Package: pack2
> > Version: 0.0.1
> > Date: 12 Jan 2009
> > Title: pack2 to test S3/S4 methods compatibility
> > Author:  Oleg Sklyar
> > Depends: R (>= 2.7.1), methods
> > Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
> > Description: pack2
> > LazyLoad: yes
> > License: Proprietary
> > URL: http://www.maninvestments.com
> > LazyLoad: no
> >
> > --- pack2: NAMESPACE ------
> > import(pack1)
> > exportPattern("^[^\\.]")
> >
> > --- pack2: posix.R ------
> > testPosix = function() {
> >     z = as.POSIXct(testPosixVal)
> >     print(z)
> >     print(class(z))
> >     z
> > }
> >
> > ------ test code to run from global env, showing problems -------
> > require(pack2)
> >
> > ## use as.POSIXct imported into pack2 from pack1 to do the 
> conversion in
> > the fun
> > testPosix()
> > #~ [1] "2009-01-13 15:29:50 UTC"
> > #~ [1] "POSIXt"  "POSIXct"
> > #~ [1] "2009-01-13 15:29:50 UTC"
> >
> > ## now try using it directly from the global env (pack1 was not
> > explicitly loaded)
> > as.POSIXct(pack1::testPosixVal)
> > #~ Error in as.POSIXct.default(pack1::testPosixVal) : 
> > #~  do not know how to convert 'pack1::testPosixVal' to 
> class "POSIXlt"
> >
> > ## now require pack1 explicitly and try again
> > require(pack1)
> > as.POSIXct(pack1::testPosixVal)
> > #~ [1] "2009-01-13 15:29:50 UTC"
> >
> >
> > 
> **********************************************************************
> > Please consider the environment before printing this email 
> or its attachments.
> > The contents of this email are for the named addressees 
> ...{{dropped:19}}
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> -- 
> Martin Morgan
> Computational Biology / Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N.
> PO Box 19024 Seattle, WA 98109
> 
> Location: Arnold Building M2 B169
> Phone: (206) 667-2793
> 

**********************************************************************
Please consider the environment before printing this email or its attachments.
The contents of this email are for the named addressees ...{{dropped:19}}


From pburns at pburns.seanet.com  Tue Jan 13 18:00:40 2009
From: pburns at pburns.seanet.com (Patrick Burns)
Date: Tue, 13 Jan 2009 17:00:40 +0000
Subject: [Rd] x <- 1:2; dim(x) <- 2? A vector or not?
In-Reply-To: <59d7961d0901130754j335c480fi673346cd20e031e@mail.gmail.com>
References: <59d7961d0901121243j6c5c0fcn5836d94a90666623@mail.gmail.com>	<alpine.OSX.1.00.0901130744310.32363@tystie.local>
	<59d7961d0901130754j335c480fi673346cd20e031e@mail.gmail.com>
Message-ID: <496CC8B8.6060606@pburns.seanet.com>

Henrik Bengtsson wrote:
> Hi.
>
> On Mon, Jan 12, 2009 at 11:58 PM, Prof Brian Ripley
> <ripley at stats.ox.ac.uk> wrote:
>   
>> What you have is a one-dimensional array: they crop up in R most often from
>> table() in my experience.
>>
>>     
>>> f <- table(rpois(100, 4))
>>> str(f)
>>>       
>>  'table' int [, 1:10] 2 6 18 21 13 16 13 4 3 4
>>  - attr(*, "dimnames")=List of 1
>>  ..$ : chr [1:10] "0" "1" "2" "3" ...
>>
>> and yes, f is an atmoic vector and yes, str()'s notation is confusing here
>> but if it did [1:10] you would not know it was an array.  I recall
>> discussing this with Martin Maechler (str's author) last century, and I've
>> just checked that R 2.0.0 did the same.
>>
>> The place in which one-dimensional arrays differ from normal vectors is how
>> names are handled: notice that my example has dimnames not names, and ?names
>> says
>>
>>     For a one-dimensional array the 'names' attribute really is
>>     'dimnames[[1]]'.
>>     
>
> Thanks for this explanation.  One could then argue that [1:10,] is
> somewhat better than [,1:10], but that is just polish.
>   

Perhaps it could be:

[1:10(,)]

That is weird enough that it should not lead people to
believe that it is a matrix.  But might prompt them a bit
in that direction.


Patrick Burns
patrick at burns-stat.com
+44 (0)20 8525 0696
http://www.burns-stat.com
(home of "The R Inferno" and "A Guide for the Unwilling S User")
> /Henrik
>
>   
>> I think these days we have enough internal glue in place that an end user
>> would not notice the difference (but those working at C level with R objects
>> may need to know).
>>
>> On Mon, 12 Jan 2009, Henrik Bengtsson wrote:
>>
>>     
>>> Ran into the follow intermediate case in an external package (w/
>>> recent R v2.8.1 patched and R v2.9.0 devel):
>>>
>>>       
>>>> x <- 1:2
>>>> dim(x) <- 2
>>>> dim(x)
>>>>         
>>> [1] 2
>>>       
>>>> x
>>>>         
>>> [1] 1 2
>>>       
>>>> str(x)
>>>>         
>>> int [, 1:2] 1 2
>>>       
>>>> nrow(x)
>>>>         
>>> [1] 2
>>>       
>>>> ncol(x)
>>>>         
>>> [1] NA
>>>       
>>>> is.vector(x)
>>>>         
>>> [1] FALSE
>>>       
>>>> is.matrix(x)
>>>>         
>>> [1] FALSE
>>>       
>>>> is.array(x)
>>>>         
>>> [1] TRUE
>>>       
>>>> x[1]
>>>>         
>>> [1] 1
>>>       
>>>> x[,1]
>>>>         
>>> Error in x[, 1] : incorrect number of dimensions
>>>       
>>>> x[1,]
>>>>         
>>> Error in x[1, ] : incorrect number of dimensions
>>>
>>> Is str() treating single-dimension arrays incorrectly?
>>>
>>> What does it mean to have a single dimension this way?  Should it
>>> equal a vector?  I am aware of "is.vector returns FALSE if x has any
>>> attributes except names".
>>>
>>> /Henrik
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>       
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>     
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>


From simon.urbanek at r-project.org  Tue Jan 13 18:36:00 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 13 Jan 2009 12:36:00 -0500
Subject: [Rd] R as a scripting engine
In-Reply-To: <18794.23441.997750.621046@ron.nulle.part>
References: <alpine.OSX.1.00.0901111151050.16921@tystie.local>
	<18794.23441.997750.621046@ron.nulle.part>
Message-ID: <C99649F2-B6DC-40BB-B1B0-F677B57508B4@r-project.org>

Oh, well, now that the post count is growing I guess I have to  
respond ;).

On Jan 11, 2009, at 15:50 , Dirk Eddelbuettel wrote:

>
> On 11 January 2009 at 20:18, Prof Brian Ripley wrote:
> | Those of you tracking R development will have noticed that we are
> | moving towards using R as a scripting engine.
> [...]
> | Reasons:
> |
> | - it is platform-independent and needs no other tools installed.
> [...]
> | - it is fast.
> [...]
>
> Indeed.  I really like working with r scripts.
>
> And littler by Horner and Eddelbuettel is faster than Rscript -- see  
> eg the
> scripts tests/timing.sh and tests/timing2.sh in the SVN archive /  
> littler
> tarballs (and the results below for illustration).
>

Well, if we enter that territory then rcmd from Rserve is much faster  
than littler:

  --- GNU bc doing the addition 10 times
real	0m0.029s
user	0m0.009s
sys	0m0.028s

  --- rcmd doing the addition 10 times
real	0m0.090s
user	0m0.010s
sys	0m0.022s

  --- our r doing the addition 10 times
real	0m0.294s
user	0m0.199s
sys	0m0.091s

  --- GNU R's Rscript doing the addition 10 times
real	0m1.626s
user	0m1.241s
sys	0m0.357s

  --- GNU R doing the addition 10 times
real	0m2.883s
user	0m2.424s
sys	0m0.426s

(littler and timig.sh script from http://littler.googlecode.com/svn/trunk 
  with loopRcmd added)


Yes, the comparison is unfair, but that applies to littler and Rscript  
as well. Once you start making direct comparisons the story is a bit  
different:

  --- our r doing the addition 10 times
real	0m0.297s
user	0m0.200s
sys	0m0.091s

  --- GNU R's Rscript doing the addition 10 times
real	0m0.390s
user	0m0.219s
sys	0m0.163s

(Rscript is now run with R_DEFAULT_PACKAGES=NULL since that is what  
littler really does).

.. and for timing2.sh (again, comparing Rcmd is technically a bit  
unfair, but the net effect for the user is good):

  --- rcmd calling summary() 20 times
real	0m0.439s
user	0m0.019s
sys	0m0.045s

  --- our r calling summary() 20 times
real	0m2.619s
user	0m2.089s
sys	0m0.476s

  --- GNU R's Rscript calling summary() 20 times
real	0m2.435s
user	0m1.793s
sys	0m0.590s

  --- GNU R calling summary() 20 times
real	0m5.789s
user	0m4.892s
sys	0m0.829s

so in fact Rscript is here faster than littleR!

(R 2.8.1 32-bit, Mac OS X 10.5.6, bash shell (due to echo bug), Quad  
2.66GHz Xeon, littler from SVN, rcmd from SVN, Rserve 0.5-2)


> We should still appreciate it you could finally acknowledge  
> existence of littler it in the R / Rscript documentation.   You are  
> not doing users any service by pretending it doesn't exist.
>

I don't think anyone is pretending anything. If users want littler  
specifically, they will find it, but I don't see why it should have  
anything to do with the R documentation - it's not part of R ...

Cheers,
S

PS: No, I'm not advertising Rserve here - it has its own place, but I  
wouldn't really use it for running random scripts. I have added it to  
the mix just to show that there is always a tradeoff, so it's  
important to know what is compared in benchmarks...


> That said, we are not (yet ?) building r for Windows, and I  
> appreciate that Rscript is available there.  Maintenance and use of  
> R will be easier with a consistent set of tools.  This is a good move.
>
> Dirk
>
>
> edd at ron:~/svn/littler/tests> ./timing.sh
>
> --- GNU bc doing the addition 10 times
> real    0m0.028s
> user    0m0.004s
> sys     0m0.012s
>
> --- our r doing the addition 10 times
> real    0m0.400s
> user    0m0.308s
> sys     0m0.052s
>
> --- GNU R's Rscript doing the addition 10 times
> real    0m2.077s
> user    0m1.832s
> sys     0m0.204s
>
> --- GNU R doing the addition 10 times
> real    0m3.974s
> user    0m3.728s
> sys     0m0.228s
> edd at ron:~/svn/littler/tests> ./timing2.sh
>
> --- our r calling summary() 20 times
> real    0m3.261s
> user    0m2.976s
> sys     0m0.240s
>
> --- GNU R's Rscript calling summary() 20 times
> real    0m4.164s
> user    0m3.624s
> sys     0m0.548s
>
> --- GNU R calling summary() 20 times
> real    0m8.087s
> user    0m7.552s
> sys     0m0.492s
> edd at ron:~/svn/littler/tests>
>
>
> -- 
> Three out of two people have difficulties with fractions.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From pgilbert at bank-banque-canada.ca  Tue Jan 13 19:23:26 2009
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Tue, 13 Jan 2009 13:23:26 -0500
Subject: [Rd] particulars of importing/loading libraries
In-Reply-To: <1A68FCB28DE72F4BA3B967E6506CCE43047DF585@mildnpexmb01.maninvestments.ad.man.com>
References: <1A68FCB28DE72F4BA3B967E6506CCE43047DF583@mildnpexmb01.maninvestments.ad.man.com>	<6phvdsjrwwl.fsf@gopher4.fhcrc.org>
	<1A68FCB28DE72F4BA3B967E6506CCE43047DF585@mildnpexmb01.maninvestments.ad.man.com>
Message-ID: <496CDC1E.9090003@bank-banque-canada.ca>

Maybe I'm missing something (it wouldn't be the first time), but I think 
your problem is that pack2 needs a function

   .onLoad <- function(library, section) {require("pack1")}

since you actually want the functions from pack1 available, and not just 
its namespace.

( And you will need the "pack1::" in  pack1::testPosixVal only if 
testPosixVal is not exported from pack1. )

Paul

Sklyar, Oleg (London) wrote:
> I was thinking of this, but this is going to be a pain if a package
> imports 5 packs, is being imported by another one, which itself is
> imported by yet another one and the only one one would like to load
> explicitly is the last down the line. If I do not find a better solution
> this is what I probably will have to do, reexport everything. 
> 
> Dr Oleg Sklyar
> Research Technologist
> AHL / Man Investments Ltd
> +44 (0)20 7144 3107
> osklyar at maninvestments.com 
> 
>> -----Original Message-----
>> From: Martin Morgan [mailto:mtmorgan at fhcrc.org] 
>> Sent: 13 January 2009 16:31
>> To: Sklyar, Oleg (London)
>> Cc: r-devel at r-project.org
>> Subject: Re: [Rd] particulars of importing/loading libraries
>>
>> Hi Oleg --
>>
>> "Sklyar, Oleg (London)" <osklyar at maninvestments.com> writes:
>>
>>> Dear List:
>>>
>>> Sorry for posting maybe a trivial question, but I have a basic
>>> understanding problem. If I have say pack1 and pack2, two R 
>> packages,
>>> and pack2 depends on and imports pack1 fully (as in the 
>> code below), is
>>> there a way to make all the functionality of pack1 available for the
>>> global and other environments (not only for the functions 
>> called from
>>> withing pack2) by loading pack2 only? I thought if pack2 
>> depends on and
>>> imports pack1 and essentially reexports everything, one 
>> should get the
>>> full functionality simply by loading pack2. This does not 
>> seem to be the
>>> case or I am missing something trivial in my NAMESPACE/DESCRIPTION
>>> files?
>> I think that exportPattern does a simple ls() on the environment of
>> the package name space. The imported symbols are not defined in that
>> environment, but (I think) in a variable .__NAMESPACE__. and so are
>> not discovered.  Arguably, exportPattern (and friends) should be
>> smarter. Pragmatically, you need to re-export imported symbols
>> explicitly. I haven't worked this through entirely, and could be
>> wrong...
>>
>> Martin
>>
>>> If this is documented in Writing R Extensions, I would be 
>> thankful for a
>>> page number and maybe a quick fix in my example below as so 
>> far I have
>>> not been able to find a clear explanation.
>>>
>>> The problem can be illustrated by the following simple 
>> example (this is
>>> a simple code for 2 packages, pack1 and pack2; plus an example).
>>>
>>> Thank you for your replies.
>>>
>>> Dr Oleg Sklyar
>>> Research Technologist
>>> AHL / Man Investments Ltd
>>> +44 (0)20 7144 3107
>>> osklyar at maninvestments.com
>>>
>>> --- pack1: DESCRIPTION ------
>>> Package: pack1
>>> Version: 0.0.1
>>> Date: 12 Jan 2009
>>> Title: pack1 to test S3/S4 methods compatibility
>>> Author:  Oleg Sklyar
>>> Depends: R (>= 2.7.1), methods
>>> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
>>> Description: pack1
>>> LazyLoad: yes
>>> License: Proprietary
>>> URL: http://www.maninvestments.com
>>> LazyLoad: no
>>>
>>> --- pack1: NAMESPACE ------
>>> import(methods)
>>> exportPattern("^[^\\.]")
>>> exportClasses(posixTime)
>>> exportMethods(as.POSIXct)
>>>
>>> --- pack1: posix.R ------
>>> setClass("posixTime", "numeric")
>>>
>>> setGeneric("as.POSIXct")
>>> setMethod("as.POSIXct", signature(x="posixTime"),
>>>     function(x, tz) {
>>>         z = x at .Data
>>>         attr(z,"class") = c("POSIXt", "POSIXct")
>>>         attr(z,"tzone") = "UTC"
>>>         z
>>>     }
>>> )
>>>
>>> testPosixVal = new("posixTime", as.numeric(Sys.time()))
>>>
>>> --- pack2: DESCRIPTION 
>>> Package: pack2
>>> Version: 0.0.1
>>> Date: 12 Jan 2009
>>> Title: pack2 to test S3/S4 methods compatibility
>>> Author:  Oleg Sklyar
>>> Depends: R (>= 2.7.1), methods
>>> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
>>> Description: pack2
>>> LazyLoad: yes
>>> License: Proprietary
>>> URL: http://www.maninvestments.com
>>> LazyLoad: no
>>>
>>> --- pack2: NAMESPACE ------
>>> import(pack1)
>>> exportPattern("^[^\\.]")
>>>
>>> --- pack2: posix.R ------
>>> testPosix = function() {
>>>     z = as.POSIXct(testPosixVal)
>>>     print(z)
>>>     print(class(z))
>>>     z
>>> }
>>>
>>> ------ test code to run from global env, showing problems -------
>>> require(pack2)
>>>
>>> ## use as.POSIXct imported into pack2 from pack1 to do the 
>> conversion in
>>> the fun
>>> testPosix()
>>> #~ [1] "2009-01-13 15:29:50 UTC"
>>> #~ [1] "POSIXt"  "POSIXct"
>>> #~ [1] "2009-01-13 15:29:50 UTC"
>>>
>>> ## now try using it directly from the global env (pack1 was not
>>> explicitly loaded)
>>> as.POSIXct(pack1::testPosixVal)
>>> #~ Error in as.POSIXct.default(pack1::testPosixVal) : 
>>> #~  do not know how to convert 'pack1::testPosixVal' to 
>> class "POSIXlt"
>>> ## now require pack1 explicitly and try again
>>> require(pack1)
>>> as.POSIXct(pack1::testPosixVal)
>>> #~ [1] "2009-01-13 15:29:50 UTC"
>>>
>>>
>>>
>> **********************************************************************
>>> Please consider the environment before printing this email 
>> or its attachments.
>>> The contents of this email are for the named addressees 
>> ...{{dropped:19}}
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> -- 
>> Martin Morgan
>> Computational Biology / Fred Hutchinson Cancer Research Center
>> 1100 Fairview Ave. N.
>> PO Box 19024 Seattle, WA 98109
>>
>> Location: Arnold Building M2 B169
>> Phone: (206) 667-2793
>>
> 
> **********************************************************************
> Please consider the environment before printing this email or its attachments.
> The contents of this email are for the named addressees ...{{dropped:19}}
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential in...{{dropped:26}}


From edd at debian.org  Tue Jan 13 19:25:06 2009
From: edd at debian.org (Dirk Eddelbuettel)
Date: Tue, 13 Jan 2009 12:25:06 -0600
Subject: [Rd] R as a scripting engine
In-Reply-To: <C99649F2-B6DC-40BB-B1B0-F677B57508B4@r-project.org>
References: <alpine.OSX.1.00.0901111151050.16921@tystie.local>
	<18794.23441.997750.621046@ron.nulle.part>
	<C99649F2-B6DC-40BB-B1B0-F677B57508B4@r-project.org>
Message-ID: <18796.56450.589260.354404@ron.nulle.part>


Hi Simon,

On 13 January 2009 at 12:36, Simon Urbanek wrote:
| Oh, well, now that the post count is growing I guess I have to  
| respond ;).
| 
| On Jan 11, 2009, at 15:50 , Dirk Eddelbuettel wrote:
| 
| >
| > On 11 January 2009 at 20:18, Prof Brian Ripley wrote:
| > | Those of you tracking R development will have noticed that we are
| > | moving towards using R as a scripting engine.
| > [...]
| > | Reasons:
| > |
| > | - it is platform-independent and needs no other tools installed.
| > [...]
| > | - it is fast.
| > [...]
| >
| > Indeed.  I really like working with r scripts.
| >
| > And littler by Horner and Eddelbuettel is faster than Rscript -- see  
| > eg the
| > scripts tests/timing.sh and tests/timing2.sh in the SVN archive /  
| > littler
| > tarballs (and the results below for illustration).
| >
| 
| Well, if we enter that territory then rcmd from Rserve is much faster  
| than littler:
| 
|   --- GNU bc doing the addition 10 times
| real	0m0.029s
| user	0m0.009s
| sys	0m0.028s
| 
|   --- rcmd doing the addition 10 times
| real	0m0.090s
| user	0m0.010s
| sys	0m0.022s
| 
|   --- our r doing the addition 10 times
| real	0m0.294s
| user	0m0.199s
| sys	0m0.091s
| 
|   --- GNU R's Rscript doing the addition 10 times
| real	0m1.626s
| user	0m1.241s
| sys	0m0.357s
| 
|   --- GNU R doing the addition 10 times
| real	0m2.883s
| user	0m2.424s
| sys	0m0.426s
| 
| (littler and timig.sh script from http://littler.googlecode.com/svn/trunk 
|   with loopRcmd added)
| 
| 
| Yes, the comparison is unfair, but that applies to littler and Rscript  
| as well. 

It's a fair point. The test in timing.sh skews towards startup and
initialization costs, and Rserve ought to win against others starting
repeatedly times if it only starts once :)

| Once you start making direct comparisons the story is a bit  
| different:
| 
|   --- our r doing the addition 10 times
| real	0m0.297s
| user	0m0.200s
| sys	0m0.091s
| 
|   --- GNU R's Rscript doing the addition 10 times
| real	0m0.390s
| user	0m0.219s
| sys	0m0.163s
| 
| (Rscript is now run with R_DEFAULT_PACKAGES=NULL since that is what  
| littler really does).

I think that is incorrect. For littler, the code is shared between autoloads.R /
autoloads.h and littler.c.  We always load 

   dp <- getOption("defaultPackages")

and hence currently (from autoloads.h in your build directory, data read by
autoloads() in littler.c)

   char *pack[] = {
   "datasets",
   "utils",
   "grDevices",
   "graphics",
   "stats",
   "methods" 
   };

so I believe the following results could be 'improved' on littler's side as
well if I chose to ignore load of default packages.

| .. and for timing2.sh (again, comparing Rcmd is technically a bit  
| unfair, but the net effect for the user is good):
| 
|   --- rcmd calling summary() 20 times
| real	0m0.439s
| user	0m0.019s
| sys	0m0.045s
| 
|   --- our r calling summary() 20 times
| real	0m2.619s
| user	0m2.089s
| sys	0m0.476s
| 
|   --- GNU R's Rscript calling summary() 20 times
| real	0m2.435s
| user	0m1.793s
| sys	0m0.590s
| 
|   --- GNU R calling summary() 20 times
| real	0m5.789s
| user	0m4.892s
| sys	0m0.829s
| 
| so in fact Rscript is here faster than littleR!
| 
| (R 2.8.1 32-bit, Mac OS X 10.5.6, bash shell (due to echo bug), Quad  
| 2.66GHz Xeon, littler from SVN, rcmd from SVN, Rserve 0.5-2)
| 
| 
| > We should still appreciate it you could finally acknowledge  
| > existence of littler it in the R / Rscript documentation.   You are  
| > not doing users any service by pretending it doesn't exist.
| >
| 
| I don't think anyone is pretending anything. If users want littler  
| specifically, they will find it, but I don't see why it should have  
| anything to do with the R documentation - it's not part of R ...

All I suggested in the past was a nod towards littler's existence. Littler
did come first, and (under an 'apples to apples' comparison) still starts
faster (as it does its work differently making it e.g. less easily portable
to Windows). 

It is after all fairly common to credit previous related work.

| Cheers,
| S
| 
| PS: No, I'm not advertising Rserve here - it has its own place, but I  
| wouldn't really use it for running random scripts. I have added it to  
| the mix just to show that there is always a tradeoff, so it's  
| important to know what is compared in benchmarks...

I have gotten really used to always letting emacs run and to start client
session without delay (besides being able to continue working remotely in
existing sessions).  In that sense a hybrid command-line version of something
like little that talks to an Rserve instance is not a bad idea at all -- in
particular if speed was everything.

Dirk

| 
| 
| > That said, we are not (yet ?) building r for Windows, and I  
| > appreciate that Rscript is available there.  Maintenance and use of  
| > R will be easier with a consistent set of tools.  This is a good move.
| >
| > Dirk
| >
| >
| > edd at ron:~/svn/littler/tests> ./timing.sh
| >
| > --- GNU bc doing the addition 10 times
| > real    0m0.028s
| > user    0m0.004s
| > sys     0m0.012s
| >
| > --- our r doing the addition 10 times
| > real    0m0.400s
| > user    0m0.308s
| > sys     0m0.052s
| >
| > --- GNU R's Rscript doing the addition 10 times
| > real    0m2.077s
| > user    0m1.832s
| > sys     0m0.204s
| >
| > --- GNU R doing the addition 10 times
| > real    0m3.974s
| > user    0m3.728s
| > sys     0m0.228s
| > edd at ron:~/svn/littler/tests> ./timing2.sh
| >
| > --- our r calling summary() 20 times
| > real    0m3.261s
| > user    0m2.976s
| > sys     0m0.240s
| >
| > --- GNU R's Rscript calling summary() 20 times
| > real    0m4.164s
| > user    0m3.624s
| > sys     0m0.548s
| >
| > --- GNU R calling summary() 20 times
| > real    0m8.087s
| > user    0m7.552s
| > sys     0m0.492s
| > edd at ron:~/svn/littler/tests>
| >
| >
| > -- 
| > Three out of two people have difficulties with fractions.
| >
| > ______________________________________________
| > R-devel at r-project.org mailing list
| > https://stat.ethz.ch/mailman/listinfo/r-devel
| >
| >
| 

-- 
Three out of two people have difficulties with fractions.


From edd at debian.org  Tue Jan 13 19:47:54 2009
From: edd at debian.org (Dirk Eddelbuettel)
Date: Tue, 13 Jan 2009 12:47:54 -0600
Subject: [Rd] R as a scripting engine
In-Reply-To: <18796.56450.589260.354404@ron.nulle.part>
References: <alpine.OSX.1.00.0901111151050.16921@tystie.local>
	<18794.23441.997750.621046@ron.nulle.part>
	<C99649F2-B6DC-40BB-B1B0-F677B57508B4@r-project.org>
	<18796.56450.589260.354404@ron.nulle.part>
Message-ID: <18796.57818.320933.527497@ron.nulle.part>


Just to bore everyone but Simon and me to tears, here is 'fair' timing2.sh
variant using an r version that does not autoload().

edd at ron:/tmp$ ./timing3.sh 

 --- our r calling summary() 20 times
real	0m3.375s
user	0m3.100s
sys	0m0.268s

 --- GNU R's Rscript calling summary() 20 times
real	0m4.328s
user	0m3.880s
sys	0m0.412s

 --- our (empty) r calling summary() 20 times
real	0m2.517s
user	0m2.284s
sys	0m0.204s

 --- GNU R's (empty) Rscript calling summary() 20 times
real	0m2.756s
user	0m2.340s
sys	0m0.356s

 --- GNU R calling summary() 20 times
real	0m8.401s
user	0m7.812s
sys	0m0.528s
edd at ron:/tmp$ 

It's back to where we were, but Simon's point on library() taking a good
chunk of time is acknowledge.   I'll add a new switch to littler, which is
due for a new release anyway providing the new tempdir option that suggested
by Paul Gilbert a while back.

Cheers, Dirk

-- 
Three out of two people have difficulties with fractions.


From osklyar at ebi.ac.uk  Wed Jan 14 02:18:31 2009
From: osklyar at ebi.ac.uk (Oleg Sklyar)
Date: Wed, 14 Jan 2009 01:18:31 +0000
Subject: [Rd] particulars of importing/loading libraries
In-Reply-To: <496CDC1E.9090003@bank-banque-canada.ca>
References: <1A68FCB28DE72F4BA3B967E6506CCE43047DF583@mildnpexmb01.maninvestments.ad.man.com>	<6phvdsjrwwl.fsf@gopher4.fhcrc.org>	<1A68FCB28DE72F4BA3B967E6506CCE43047DF585@mildnpexmb01.maninvestments.ad.man.com>
	<496CDC1E.9090003@bank-banque-canada.ca>
Message-ID: <496D3D67.90903@ebi.ac.uk>

I will give it a try with .onLoad, but I am not sure why this should be 
required. I do not think this is the solution for the problem as at the 
times when there were no namespaces, adding a library in Depends of the 
Description file was sufficient.

As for the second point I am aware of that, but this just highlights the 
problem: pack1 was not made available to the global namespace and 
therefore that construction was required.

Best,
Oleg

Paul Gilbert wrote:
> Maybe I'm missing something (it wouldn't be the first time), but I think 
> your problem is that pack2 needs a function
> 
>   .onLoad <- function(library, section) {require("pack1")}
> 
> since you actually want the functions from pack1 available, and not just 
> its namespace.
> 
> ( And you will need the "pack1::" in  pack1::testPosixVal only if 
> testPosixVal is not exported from pack1. )
> 
> Paul
> 
> Sklyar, Oleg (London) wrote:
>> I was thinking of this, but this is going to be a pain if a package
>> imports 5 packs, is being imported by another one, which itself is
>> imported by yet another one and the only one one would like to load
>> explicitly is the last down the line. If I do not find a better solution
>> this is what I probably will have to do, reexport everything.
>> Dr Oleg Sklyar
>> Research Technologist
>> AHL / Man Investments Ltd
>> +44 (0)20 7144 3107
>> osklyar at maninvestments.com
>>> -----Original Message-----
>>> From: Martin Morgan [mailto:mtmorgan at fhcrc.org] Sent: 13 January 2009 
>>> 16:31
>>> To: Sklyar, Oleg (London)
>>> Cc: r-devel at r-project.org
>>> Subject: Re: [Rd] particulars of importing/loading libraries
>>>
>>> Hi Oleg --
>>>
>>> "Sklyar, Oleg (London)" <osklyar at maninvestments.com> writes:
>>>
>>>> Dear List:
>>>>
>>>> Sorry for posting maybe a trivial question, but I have a basic
>>>> understanding problem. If I have say pack1 and pack2, two R 
>>> packages,
>>>> and pack2 depends on and imports pack1 fully (as in the 
>>> code below), is
>>>> there a way to make all the functionality of pack1 available for the
>>>> global and other environments (not only for the functions 
>>> called from
>>>> withing pack2) by loading pack2 only? I thought if pack2 
>>> depends on and
>>>> imports pack1 and essentially reexports everything, one 
>>> should get the
>>>> full functionality simply by loading pack2. This does not 
>>> seem to be the
>>>> case or I am missing something trivial in my NAMESPACE/DESCRIPTION
>>>> files?
>>> I think that exportPattern does a simple ls() on the environment of
>>> the package name space. The imported symbols are not defined in that
>>> environment, but (I think) in a variable .__NAMESPACE__. and so are
>>> not discovered.  Arguably, exportPattern (and friends) should be
>>> smarter. Pragmatically, you need to re-export imported symbols
>>> explicitly. I haven't worked this through entirely, and could be
>>> wrong...
>>>
>>> Martin
>>>
>>>> If this is documented in Writing R Extensions, I would be 
>>> thankful for a
>>>> page number and maybe a quick fix in my example below as so 
>>> far I have
>>>> not been able to find a clear explanation.
>>>>
>>>> The problem can be illustrated by the following simple 
>>> example (this is
>>>> a simple code for 2 packages, pack1 and pack2; plus an example).
>>>>
>>>> Thank you for your replies.
>>>>
>>>> Dr Oleg Sklyar
>>>> Research Technologist
>>>> AHL / Man Investments Ltd
>>>> +44 (0)20 7144 3107
>>>> osklyar at maninvestments.com
>>>>
>>>> --- pack1: DESCRIPTION ------
>>>> Package: pack1
>>>> Version: 0.0.1
>>>> Date: 12 Jan 2009
>>>> Title: pack1 to test S3/S4 methods compatibility
>>>> Author:  Oleg Sklyar
>>>> Depends: R (>= 2.7.1), methods
>>>> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
>>>> Description: pack1
>>>> LazyLoad: yes
>>>> License: Proprietary
>>>> URL: http://www.maninvestments.com
>>>> LazyLoad: no
>>>>
>>>> --- pack1: NAMESPACE ------
>>>> import(methods)
>>>> exportPattern("^[^\\.]")
>>>> exportClasses(posixTime)
>>>> exportMethods(as.POSIXct)
>>>>
>>>> --- pack1: posix.R ------
>>>> setClass("posixTime", "numeric")
>>>>
>>>> setGeneric("as.POSIXct")
>>>> setMethod("as.POSIXct", signature(x="posixTime"),
>>>>     function(x, tz) {
>>>>         z = x at .Data
>>>>         attr(z,"class") = c("POSIXt", "POSIXct")
>>>>         attr(z,"tzone") = "UTC"
>>>>         z
>>>>     }
>>>> )
>>>>
>>>> testPosixVal = new("posixTime", as.numeric(Sys.time()))
>>>>
>>>> --- pack2: DESCRIPTION Package: pack2
>>>> Version: 0.0.1
>>>> Date: 12 Jan 2009
>>>> Title: pack2 to test S3/S4 methods compatibility
>>>> Author:  Oleg Sklyar
>>>> Depends: R (>= 2.7.1), methods
>>>> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
>>>> Description: pack2
>>>> LazyLoad: yes
>>>> License: Proprietary
>>>> URL: http://www.maninvestments.com
>>>> LazyLoad: no
>>>>
>>>> --- pack2: NAMESPACE ------
>>>> import(pack1)
>>>> exportPattern("^[^\\.]")
>>>>
>>>> --- pack2: posix.R ------
>>>> testPosix = function() {
>>>>     z = as.POSIXct(testPosixVal)
>>>>     print(z)
>>>>     print(class(z))
>>>>     z
>>>> }
>>>>
>>>> ------ test code to run from global env, showing problems -------
>>>> require(pack2)
>>>>
>>>> ## use as.POSIXct imported into pack2 from pack1 to do the 
>>> conversion in
>>>> the fun
>>>> testPosix()
>>>> #~ [1] "2009-01-13 15:29:50 UTC"
>>>> #~ [1] "POSIXt"  "POSIXct"
>>>> #~ [1] "2009-01-13 15:29:50 UTC"
>>>>
>>>> ## now try using it directly from the global env (pack1 was not
>>>> explicitly loaded)
>>>> as.POSIXct(pack1::testPosixVal)
>>>> #~ Error in as.POSIXct.default(pack1::testPosixVal) : #~  do not 
>>>> know how to convert 'pack1::testPosixVal' to 
>>> class "POSIXlt"
>>>> ## now require pack1 explicitly and try again
>>>> require(pack1)
>>>> as.POSIXct(pack1::testPosixVal)
>>>> #~ [1] "2009-01-13 15:29:50 UTC"
>>>>
>>>>
>>>>
>>> **********************************************************************
>>>> Please consider the environment before printing this email 
>>> or its attachments.
>>>> The contents of this email are for the named addressees 
>>> ...{{dropped:19}}
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> -- 
>>> Martin Morgan
>>> Computational Biology / Fred Hutchinson Cancer Research Center
>>> 1100 Fairview Ave. N.
>>> PO Box 19024 Seattle, WA 98109
>>>
>>> Location: Arnold Building M2 B169
>>> Phone: (206) 667-2793
>>>
>>
>> **********************************************************************
>> Please consider the environment before printing this email or its 
>> attachments.
>> The contents of this email are for the named addressees ...{{dropped:19}}
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> ==================================================================================== 
> 
> 
> La version fran?aise suit le texte anglais.
> 
> ------------------------------------------------------------------------------------ 
> 
> 
> This email may contain privileged and/or confidential in...{{dropped:26}}
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Dr Oleg Sklyar * EBI-EMBL, Cambridge CB10 1SD, UK * +44-1223-494466


From simon.urbanek at r-project.org  Wed Jan 14 02:50:54 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 13 Jan 2009 20:50:54 -0500
Subject: [Rd] particulars of importing/loading libraries
In-Reply-To: <1A68FCB28DE72F4BA3B967E6506CCE43047DF583@mildnpexmb01.maninvestments.ad.man.com>
References: <1A68FCB28DE72F4BA3B967E6506CCE43047DF583@mildnpexmb01.maninvestments.ad.man.com>
Message-ID: <E66844FE-E31E-45F4-8753-72445204E7A6@r-project.org>

Oleg,

On Jan 13, 2009, at 11:00 , Sklyar, Oleg (London) wrote:

> Dear List:
>
> Sorry for posting maybe a trivial question, but I have a basic
> understanding problem. If I have say pack1 and pack2, two R packages,
> and pack2 depends on and imports pack1 fully (as in the code below),  
> is
> there a way to make all the functionality of pack1 available for the
> global and other environments (not only for the functions called from
> withing pack2) by loading pack2 only? I thought if pack2 depends on  
> and
> imports pack1 and essentially reexports everything, one should get the
> full functionality simply by loading pack2. This does not seem to be  
> the
> case or I am missing something trivial in my NAMESPACE/DESCRIPTION
> files?
>
> If this is documented in Writing R Extensions, I would be thankful  
> for a
> page number and maybe a quick fix in my example below as so far I have
> not been able to find a clear explanation.
>
> The problem can be illustrated by the following simple example (this  
> is
> a simple code for 2 packages, pack1 and pack2; plus an example).
>

if you bothered to use R CMD check you would find your bug right away:
* checking package dependencies ... ERROR
Namespace dependencies not required:
   pack1

You simply forgot to add pack1 to the Depends: line - that's all. Once  
you fix that, you'll see what happens:

 > library(pack2)
Loading required package: pack1
 > as.POSIXct(pack1::testPosixVal)
[1] "2009-01-14 01:38:08 UTC"

Cheers,
S


> Thank you for your replies.
>
> Dr Oleg Sklyar
> Research Technologist
> AHL / Man Investments Ltd
> +44 (0)20 7144 3107
> osklyar at maninvestments.com
>
> --- pack1: DESCRIPTION ------
> Package: pack1
> Version: 0.0.1
> Date: 12 Jan 2009
> Title: pack1 to test S3/S4 methods compatibility
> Author:  Oleg Sklyar
> Depends: R (>= 2.7.1), methods
> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
> Description: pack1
> LazyLoad: yes
> License: Proprietary
> URL: http://www.maninvestments.com
> LazyLoad: no
>
> --- pack1: NAMESPACE ------
> import(methods)
> exportPattern("^[^\\.]")
> exportClasses(posixTime)
> exportMethods(as.POSIXct)
>
> --- pack1: posix.R ------
> setClass("posixTime", "numeric")
>
> setGeneric("as.POSIXct")
> setMethod("as.POSIXct", signature(x="posixTime"),
>    function(x, tz) {
>        z = x at .Data
>        attr(z,"class") = c("POSIXt", "POSIXct")
>        attr(z,"tzone") = "UTC"
>        z
>    }
> )
>
> testPosixVal = new("posixTime", as.numeric(Sys.time()))
>
> --- pack2: DESCRIPTION
> Package: pack2
> Version: 0.0.1
> Date: 12 Jan 2009
> Title: pack2 to test S3/S4 methods compatibility
> Author:  Oleg Sklyar
> Depends: R (>= 2.7.1), methods
> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
> Description: pack2
> LazyLoad: yes
> License: Proprietary
> URL: http://www.maninvestments.com
> LazyLoad: no
>
> --- pack2: NAMESPACE ------
> import(pack1)
> exportPattern("^[^\\.]")
>
> --- pack2: posix.R ------
> testPosix = function() {
>    z = as.POSIXct(testPosixVal)
>    print(z)
>    print(class(z))
>    z
> }
>
> ------ test code to run from global env, showing problems -------
> require(pack2)
>
> ## use as.POSIXct imported into pack2 from pack1 to do the  
> conversion in
> the fun
> testPosix()
> #~ [1] "2009-01-13 15:29:50 UTC"
> #~ [1] "POSIXt"  "POSIXct"
> #~ [1] "2009-01-13 15:29:50 UTC"
>
> ## now try using it directly from the global env (pack1 was not
> explicitly loaded)
> as.POSIXct(pack1::testPosixVal)
> #~ Error in as.POSIXct.default(pack1::testPosixVal) :
> #~  do not know how to convert 'pack1::testPosixVal' to class  
> "POSIXlt"
>
> ## now require pack1 explicitly and try again
> require(pack1)
> as.POSIXct(pack1::testPosixVal)
> #~ [1] "2009-01-13 15:29:50 UTC"
>
>
> **********************************************************************
> Please consider the environment before printing this email or its  
> attachments.
> The contents of this email are for the named addressees ...{{dropped: 
> 19}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From mtmorgan at fhcrc.org  Wed Jan 14 05:07:35 2009
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Tue, 13 Jan 2009 20:07:35 -0800
Subject: [Rd] particulars of importing/loading libraries
In-Reply-To: <E66844FE-E31E-45F4-8753-72445204E7A6@r-project.org> (Simon
	Urbanek's message of "Tue, 13 Jan 2009 20:50:54 -0500")
References: <1A68FCB28DE72F4BA3B967E6506CCE43047DF583@mildnpexmb01.maninvestments.ad.man.com>
	<E66844FE-E31E-45F4-8753-72445204E7A6@r-project.org>
Message-ID: <6ph63kibke0.fsf@gopher4.fhcrc.org>

Simon Urbanek <simon.urbanek at r-project.org> writes:

> Oleg,
>
> On Jan 13, 2009, at 11:00 , Sklyar, Oleg (London) wrote:
>
>> Dear List:
>>
>> Sorry for posting maybe a trivial question, but I have a basic
>> understanding problem. If I have say pack1 and pack2, two R packages,
>> and pack2 depends on and imports pack1 fully (as in the code below),
>> is
>> there a way to make all the functionality of pack1 available for the
>> global and other environments (not only for the functions called from
>> withing pack2) by loading pack2 only? I thought if pack2 depends on
>> and
>> imports pack1 and essentially reexports everything, one should get the
>> full functionality simply by loading pack2. This does not seem to be
>> the
>> case or I am missing something trivial in my NAMESPACE/DESCRIPTION
>> files?
>>
>> If this is documented in Writing R Extensions, I would be thankful
>> for a
>> page number and maybe a quick fix in my example below as so far I have
>> not been able to find a clear explanation.
>>
>> The problem can be illustrated by the following simple example (this
>> is
>> a simple code for 2 packages, pack1 and pack2; plus an example).
>>
>
> if you bothered to use R CMD check you would find your bug right away:
> * checking package dependencies ... ERROR
> Namespace dependencies not required:
>    pack1
>
> You simply forgot to add pack1 to the Depends: line - that's all. Once
> you fix that, you'll see what happens:

Imports: rather than Depends: seems like the norm -- the package then
controls its search path, rather than relying on the search path
constructed by the user, and avoids cluttering the user name space and
search path with unnecessary symbols. This would be especially true
for an infrastructure package with many symbols (e.g., RGtk2?) that
might well be irrelevant to an end user.

With Oleg's example, using Imports: allows the package to pass R CMD
check but results in the same error

> packageDescription("pack2")[c("Imports", "Depends")]
$Imports
[1] "pack1"

$Depends
[1] "R (>= 2.7.1), methods"

> as.POSIXct(pack1::testPosixVal)
Error in as.POSIXct.default(pack1::testPosixVal) : 
  do not know how to convert 'pack1::testPosixVal' to class "POSIXlt"

This can be remedied by adding exports(as.POSIXct) to the NAMESPACE
file of pack2.

I said above that the Imports: gives the package control of its search
path. This is true for regular symbols

> testPosixValue = "not a posix value"
> testPosix() # finds pack1's testPosixValue
[1] "2009-01-14 03:55:25 UTC"
[1] "POSIXt"  "POSIXct"
[1] "2009-01-14 03:55:25 UTC"

so one might hope that if pack2 Imports: pack1, pack2 would always get
pack1's as.POSIXct methods. Alas, the user writing a method

setMethod("as.POSIXct", signature(x="posixTime"),
          function(x, tz, ...) stop('oops'))

clobers pack2's efforts

> testPosix()
Error in as.POSIXct(testPosixVal) : oops

This occurs even when pack2 does not export as.POSIXct (niether method
nor generic), and would seem to be an unfortunate interaction between
methods and name spaces.

Martin

>  > library(pack2)
> Loading required package: pack1
>  > as.POSIXct(pack1::testPosixVal)
> [1] "2009-01-14 01:38:08 UTC"
>
> Cheers,
> S
>
>
>> Thank you for your replies.
>>
>> Dr Oleg Sklyar
>> Research Technologist
>> AHL / Man Investments Ltd
>> +44 (0)20 7144 3107
>> osklyar at maninvestments.com
>>
>> --- pack1: DESCRIPTION ------
>> Package: pack1
>> Version: 0.0.1
>> Date: 12 Jan 2009
>> Title: pack1 to test S3/S4 methods compatibility
>> Author:  Oleg Sklyar
>> Depends: R (>= 2.7.1), methods
>> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
>> Description: pack1
>> LazyLoad: yes
>> License: Proprietary
>> URL: http://www.maninvestments.com
>> LazyLoad: no
>>
>> --- pack1: NAMESPACE ------
>> import(methods)
>> exportPattern("^[^\\.]")
>> exportClasses(posixTime)
>> exportMethods(as.POSIXct)
>>
>> --- pack1: posix.R ------
>> setClass("posixTime", "numeric")
>>
>> setGeneric("as.POSIXct")
>> setMethod("as.POSIXct", signature(x="posixTime"),
>>    function(x, tz) {
>>        z = x at .Data
>>        attr(z,"class") = c("POSIXt", "POSIXct")
>>        attr(z,"tzone") = "UTC"
>>        z
>>    }
>> )
>>
>> testPosixVal = new("posixTime", as.numeric(Sys.time()))
>>
>> --- pack2: DESCRIPTION
>> Package: pack2
>> Version: 0.0.1
>> Date: 12 Jan 2009
>> Title: pack2 to test S3/S4 methods compatibility
>> Author:  Oleg Sklyar
>> Depends: R (>= 2.7.1), methods
>> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
>> Description: pack2
>> LazyLoad: yes
>> License: Proprietary
>> URL: http://www.maninvestments.com
>> LazyLoad: no
>>
>> --- pack2: NAMESPACE ------
>> import(pack1)
>> exportPattern("^[^\\.]")
>>
>> --- pack2: posix.R ------
>> testPosix = function() {
>>    z = as.POSIXct(testPosixVal)
>>    print(z)
>>    print(class(z))
>>    z
>> }
>>
>> ------ test code to run from global env, showing problems -------
>> require(pack2)
>>
>> ## use as.POSIXct imported into pack2 from pack1 to do the
>> conversion in
>> the fun
>> testPosix()
>> #~ [1] "2009-01-13 15:29:50 UTC"
>> #~ [1] "POSIXt"  "POSIXct"
>> #~ [1] "2009-01-13 15:29:50 UTC"
>>
>> ## now try using it directly from the global env (pack1 was not
>> explicitly loaded)
>> as.POSIXct(pack1::testPosixVal)
>> #~ Error in as.POSIXct.default(pack1::testPosixVal) :
>> #~  do not know how to convert 'pack1::testPosixVal' to class
>> "POSIXlt"
>>
>> ## now require pack1 explicitly and try again
>> require(pack1)
>> as.POSIXct(pack1::testPosixVal)
>> #~ [1] "2009-01-13 15:29:50 UTC"
>>
>>
>> **********************************************************************
>> Please consider the environment before printing this email or its
>> attachments.
>> The contents of this email are for the named addressees
>> ...{{dropped: 19}}
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin Morgan
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M2 B169
Phone: (206) 667-2793


From robert.e.cranfill at boeing.com  Wed Jan 14 01:30:07 2009
From: robert.e.cranfill at boeing.com (robert.e.cranfill at boeing.com)
Date: Wed, 14 Jan 2009 01:30:07 +0100 (CET)
Subject: [Rd] Windows installer text bug (PR#13445)
Message-ID: <20090114003007.4FA43282EF48@mail.pubhealth.ku.dk>

Full_Name: Rob Cranfill
Version: 2.8.1
OS: Windows XP SP2
Submission from: (NULL) (130.76.32.19)


Using the Windows installer for 2.8.1, partway through the process there is a
dialog that looks something like this:

----------------------------------------------
Display Mode
  Do you prefer the MDI or SDI interface?
  -------
  Please specify MDI or SDI, then click Next.

  (*) MDI (one big window)
  ( ) SDI (separate windows)

----------------------------------------------

Those descriptions are reversed: "MDI" is Multiple Document Interface, with
separate windows; SDI is Single Document Interface, with one big window.

I can send a screen shot if need be.

  - rob


From Bernhard_Pfaff at fra.invesco.com  Wed Jan 14 09:48:08 2009
From: Bernhard_Pfaff at fra.invesco.com (Pfaff, Bernhard Dr.)
Date: Wed, 14 Jan 2009 08:48:08 -0000
Subject: [Rd] FORTRAN compilation error on Tiger but not for Leopard
Message-ID: <B89F0CE41D45644A97CCC93DF548C1C31702C455@GBHENXMB02.corp.amvescap.net>

Dear list member,

the package urca now contains FORTRAN code in ./src. The
compilation/build works on R-Forge (see project AICTSI with Leopard),
but an error is reported in the build on CRAN (Tiger). My question now
is: Is there anything I can do as a package maintainer such that the
package can be build under Tiger? Any hints and pointers are welcome.

The code is available here:
http://r-forge.r-project.org/plugins/scmsvn/viewcvs.php/pkg/src/?root=ur
ca

And the Mac build log file can be accessed here:
http://www.r-project.org/nosvn/R.check/r-release-macosx-ix86/urca-00chec
k.html
with further information:
http://www.r-project.org/nosvn/R.check/r-release-macosx-ix86/urca-00inst
all.html

Fyi: I have posted this email to R-SIG-Mac yesterday, but have not
received a response by now. Because the issue might also be relevant for
R-Devel I decided to post the problem here, too. In addition, the build
and check for the other architectures/version is passed.


Best,
Bernhard

*****************************************************************
Confidentiality Note: The information contained in this ...{{dropped:10}}


From samsiddhi.bhattacharjee at gmail.com  Wed Jan 14 09:49:25 2009
From: samsiddhi.bhattacharjee at gmail.com (Samsiddhi Bhattacharjee)
Date: Wed, 14 Jan 2009 03:49:25 -0500
Subject: [Rd] Problem with compiling shared C/C++ library for loading
	into R (Linux)
In-Reply-To: <6b50a24c0901110458i3cc8e5eaxf8253bc303f1bb70@mail.gmail.com>
References: <2c0ef9870901101540l1adfcba8x31058f5643c69882@mail.gmail.com>
	<2c0ef9870901101554q11b48419s95730dfa5dc10e5c@mail.gmail.com>
	<6b50a24c0901110458i3cc8e5eaxf8253bc303f1bb70@mail.gmail.com>
Message-ID: <2c0ef9870901140049p84829e2od14e06590896df66@mail.gmail.com>

   Thanks. I figured out the problem finally. The first error I
mentioned was solved by compiling
the external library blitz++ using the configure option --with-pic (or
compiler flag -fPIC). It has something to do with position indepent
code and global variables, which I frankly don't understand. Maybe
somebody can explain...

      The second one (undefined symbol: _ZSt4cerr) was because cerr is
a c++ object, and I was doing
"R CMD SHLIB" on the compiled object files, so it was linkiing using
gcc. Changing the linker to g++ (using
cpp source code during linking) works...or as suggested in a previous
post using -lstdc++ with gcc also works.

--Samsiddhi Bhattacharjee


On Sun, Jan 11, 2009 at 7:58 AM, torpedo fisken <torpedofisken at gmail.com> wrote:
> I think you're not linking it together when you call R CMD SHLIB, use
> something like
>
> R CMD SHLIB mylib.c yourlib1.o yourlib2.o
>
> Otherwise mail again with your Makefile, or all the commands you are using
>
> good luck
>
> 2009/1/11 Samsiddhi Bhattacharjee <samsiddhi.bhattacharjee at gmail.com>:
>> Dear all,
>>
>> I am using the .Call interface to call c++ code from R. For that, I am
>> trying to create a dynamic library (mylib.so)
>> using "R CMD SHLIB" by linking my own c++ code and an external c++
>> library (blitz++).
>>
>> The makefile works fine on my Mac, produces mylib.so and I am able to
>> call .Call() from R,  but on a linux
>> server (I think Debian),  I got the following error:
>>
>> ----------
>> /usr/bin/ld: /somepath/blitz/lib/libblitz.a(globals.o):
>> relocation R_X86_64_32 against `a local symbol' can not be used when
>> making a shared object; recompile with -fPIC
>> /somepath/blitz/lib/libblitz.a: could not read symbols: Bad value
>> collect2: ld returned 1 exit status
>> ----------
>>
>> I tried recompiling the blitz++ library with the -fPIC flag, and then
>> linking using -fPIC, it went thorugh without error
>> producing a "mylib.so" file.  But when I tried "dyn.load(mylib.so)"
>> from R, I got the error:
>>
>> ----------
>> Error in dyn.load("mylib.so") :
>>  unable to load shared library '/somepath/mylib.so':
>>  /somepath/mylib.so: undefined symbol: _ZSt4cerr
>> ---------
>>
>> I will really appreciate any help or advice on this problem.
>>
>> --Samsiddhi Bhattacharjee
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From osklyar at maninvestments.com  Wed Jan 14 10:24:23 2009
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Wed, 14 Jan 2009 09:24:23 -0000
Subject: [Rd] particulars of importing/loading libraries
In-Reply-To: <E66844FE-E31E-45F4-8753-72445204E7A6@r-project.org>
References: <1A68FCB28DE72F4BA3B967E6506CCE43047DF583@mildnpexmb01.maninvestments.ad.man.com>
	<E66844FE-E31E-45F4-8753-72445204E7A6@r-project.org>
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE43047DF588@mildnpexmb01.maninvestments.ad.man.com>

Sorry Simon, you are right. I tried to recreate a problem that I had
with other packages where the packages were added to Depends but made a
mistake. However the problem remains if I do the following.

Added: pack1 to Depends of pack2. Now I create pack3 with the following
contents: it does not import pack1 directly, nor depends on it. It
rather imports pack2 and depends on pack2. I then expect the
functionality of pack1 to be available still if I only load pack3. But I
now get errors with pack3 calling the function from pack1. Does this
mean I need to import and depend on pack1 and methods explicitly in
pack3. I.e. do I have to import and depend on ALL the packages that may
be in use, even if they are imported by other that I depend on and
import:

---- pack3: DESCRIPTION -----

Package: pack3
Version: 0.0.1
Date: 12 Jan 2009
Title: pack1 to test S3/S4 methods compatibility
Author:  Oleg Sklyar
Depends: R (>= 2.7.1), pack2
Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
Description: pack3
LazyLoad: yes
License: Proprietary
URL: http://www.maninvestments.com
LazyLoad: no

---- pack3: NAMESPACE ------
import(pack2)
exportPattern("^[^\\.]")

---- pack3: posix.R ------
testPosix2 = function() {
    z = as.POSIXct(testPosixVal)
    print(z)
    print(class(z))
    z
}

Note, that the above function is the same as in pack2, just a different
name.


*** R 2.9.0 (svn -r 46585) [/share/research/R-devel/20081002/lib64/R]
***
> library(pack3)
Loading required package: pack2
Loading required package: pack1
> as.POSIXct(pack1::testPosixVal)
[1] "2009-01-13 15:29:50 UTC"
> testPosxi() ## called from pack2
[1] "2009-01-13 15:29:50 UTC"
[1] "POSIXt"  "POSIXct"
[1] "2009-01-13 15:29:50 UTC"
> testPosix2() ## called from pack3
Error in as.POSIXct.default(testPosixVal) : 
  do not know how to convert 'testPosixVal' to class "POSIXlt"




Dr Oleg Sklyar
Research Technologist
AHL / Man Investments Ltd
+44 (0)20 7144 3107
osklyar at maninvestments.com 

> -----Original Message-----
> From: Simon Urbanek [mailto:simon.urbanek at r-project.org] 
> Sent: 14 January 2009 01:51
> To: Sklyar, Oleg (London)
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] particulars of importing/loading libraries
> 
> Oleg,
> 
> On Jan 13, 2009, at 11:00 , Sklyar, Oleg (London) wrote:
> 
> > Dear List:
> >
> > Sorry for posting maybe a trivial question, but I have a basic
> > understanding problem. If I have say pack1 and pack2, two R 
> packages,
> > and pack2 depends on and imports pack1 fully (as in the 
> code below),  
> > is
> > there a way to make all the functionality of pack1 available for the
> > global and other environments (not only for the functions 
> called from
> > withing pack2) by loading pack2 only? I thought if pack2 
> depends on  
> > and
> > imports pack1 and essentially reexports everything, one 
> should get the
> > full functionality simply by loading pack2. This does not 
> seem to be  
> > the
> > case or I am missing something trivial in my NAMESPACE/DESCRIPTION
> > files?
> >
> > If this is documented in Writing R Extensions, I would be thankful  
> > for a
> > page number and maybe a quick fix in my example below as so 
> far I have
> > not been able to find a clear explanation.
> >
> > The problem can be illustrated by the following simple 
> example (this  
> > is
> > a simple code for 2 packages, pack1 and pack2; plus an example).
> >
> 
> if you bothered to use R CMD check you would find your bug right away:
> * checking package dependencies ... ERROR
> Namespace dependencies not required:
>    pack1
> 
> You simply forgot to add pack1 to the Depends: line - that's 
> all. Once  
> you fix that, you'll see what happens:
> 
>  > library(pack2)
> Loading required package: pack1
>  > as.POSIXct(pack1::testPosixVal)
> [1] "2009-01-14 01:38:08 UTC"
> 
> Cheers,
> S
> 
> 
> > Thank you for your replies.
> >
> > Dr Oleg Sklyar
> > Research Technologist
> > AHL / Man Investments Ltd
> > +44 (0)20 7144 3107
> > osklyar at maninvestments.com
> >
> > --- pack1: DESCRIPTION ------
> > Package: pack1
> > Version: 0.0.1
> > Date: 12 Jan 2009
> > Title: pack1 to test S3/S4 methods compatibility
> > Author:  Oleg Sklyar
> > Depends: R (>= 2.7.1), methods
> > Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
> > Description: pack1
> > LazyLoad: yes
> > License: Proprietary
> > URL: http://www.maninvestments.com
> > LazyLoad: no
> >
> > --- pack1: NAMESPACE ------
> > import(methods)
> > exportPattern("^[^\\.]")
> > exportClasses(posixTime)
> > exportMethods(as.POSIXct)
> >
> > --- pack1: posix.R ------
> > setClass("posixTime", "numeric")
> >
> > setGeneric("as.POSIXct")
> > setMethod("as.POSIXct", signature(x="posixTime"),
> >    function(x, tz) {
> >        z = x at .Data
> >        attr(z,"class") = c("POSIXt", "POSIXct")
> >        attr(z,"tzone") = "UTC"
> >        z
> >    }
> > )
> >
> > testPosixVal = new("posixTime", as.numeric(Sys.time()))
> >
> > --- pack2: DESCRIPTION
> > Package: pack2
> > Version: 0.0.1
> > Date: 12 Jan 2009
> > Title: pack2 to test S3/S4 methods compatibility
> > Author:  Oleg Sklyar
> > Depends: R (>= 2.7.1), methods
> > Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
> > Description: pack2
> > LazyLoad: yes
> > License: Proprietary
> > URL: http://www.maninvestments.com
> > LazyLoad: no
> >
> > --- pack2: NAMESPACE ------
> > import(pack1)
> > exportPattern("^[^\\.]")
> >
> > --- pack2: posix.R ------
> > testPosix = function() {
> >    z = as.POSIXct(testPosixVal)
> >    print(z)
> >    print(class(z))
> >    z
> > }
> >
> > ------ test code to run from global env, showing problems -------
> > require(pack2)
> >
> > ## use as.POSIXct imported into pack2 from pack1 to do the  
> > conversion in
> > the fun
> > testPosix()
> > #~ [1] "2009-01-13 15:29:50 UTC"
> > #~ [1] "POSIXt"  "POSIXct"
> > #~ [1] "2009-01-13 15:29:50 UTC"
> >
> > ## now try using it directly from the global env (pack1 was not
> > explicitly loaded)
> > as.POSIXct(pack1::testPosixVal)
> > #~ Error in as.POSIXct.default(pack1::testPosixVal) :
> > #~  do not know how to convert 'pack1::testPosixVal' to class  
> > "POSIXlt"
> >
> > ## now require pack1 explicitly and try again
> > require(pack1)
> > as.POSIXct(pack1::testPosixVal)
> > #~ [1] "2009-01-13 15:29:50 UTC"
> >
> >
> > 
> **********************************************************************
> > Please consider the environment before printing this email or its  
> > attachments.
> > The contents of this email are for the named addressees 
> ...{{dropped: 
> > 19}}
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >
> 
> 

**********************************************************************
Please consider the environment before printing this email or its attachments.
The contents of this email are for the named addressees ...{{dropped:19}}


From hb at stat.berkeley.edu  Wed Jan 14 11:16:33 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Wed, 14 Jan 2009 02:16:33 -0800
Subject: [Rd] Windows installer text bug (PR#13445)
In-Reply-To: <20090114003007.4FA43282EF48@mail.pubhealth.ku.dk>
References: <20090114003007.4FA43282EF48@mail.pubhealth.ku.dk>
Message-ID: <59d7961d0901140216lee74a4j1de229671ebfea23@mail.gmail.com>

On Tue, Jan 13, 2009 at 4:30 PM,  <robert.e.cranfill at boeing.com> wrote:

Hey, this guy builds engines for aircraft *and* uses freeware!  I was
on such a jet just few days ago and I can confirm that I did not
notice anything strange (except the food).

> Full_Name: Rob Cranfill
> Version: 2.8.1
> OS: Windows XP SP2
> Submission from: (NULL) (130.76.32.19)
>
>
> Using the Windows installer for 2.8.1, partway through the process there is a
> dialog that looks something like this:
>
> ----------------------------------------------
> Display Mode
>  Do you prefer the MDI or SDI interface?
>  -------
>  Please specify MDI or SDI, then click Next.
>
>  (*) MDI (one big window)
>  ( ) SDI (separate windows)
>
> ----------------------------------------------
>
> Those descriptions are reversed: "MDI" is Multiple Document Interface, with
> separate windows; SDI is Single Document Interface, with one big window.

Probably not a bug, because this could be read "multiple document
interface (MDI) are those whose windows reside under **a single parent
window**" and "a single document interface or SDI is [...] organizing
applications into **individual windows**" [Wikipedia].  I haven't
verified the outcome though.

/Henrik

>
> I can send a screen shot if need be.
>
>  - rob
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From murdoch at stats.uwo.ca  Wed Jan 14 12:34:49 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 14 Jan 2009 06:34:49 -0500
Subject: [Rd] Windows installer text bug (PR#13445)
In-Reply-To: <20090114003007.4FA43282EF48@mail.pubhealth.ku.dk>
References: <20090114003007.4FA43282EF48@mail.pubhealth.ku.dk>
Message-ID: <496DCDD9.1000705@stats.uwo.ca>

robert.e.cranfill at boeing.com wrote:
> Full_Name: Rob Cranfill
> Version: 2.8.1
> OS: Windows XP SP2
> Submission from: (NULL) (130.76.32.19)
>
>
> Using the Windows installer for 2.8.1, partway through the process there is a
> dialog that looks something like this:
>
> ----------------------------------------------
> Display Mode
>   Do you prefer the MDI or SDI interface?
>   -------
>   Please specify MDI or SDI, then click Next.
>
>   (*) MDI (one big window)
>   ( ) SDI (separate windows)
>
> ----------------------------------------------
>
> Those descriptions are reversed: "MDI" is Multiple Document Interface, with
> separate windows; SDI is Single Document Interface, with one big window.
>   

MDI is one big parent window containing sub-windows; in SDI they are 
unconnected.  The description is not reversed, but could perhaps be 
improved.

Duncan Murdoch
> I can send a screen shot if need be.
>
>   - rob
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From simon.urbanek at r-project.org  Wed Jan 14 16:37:42 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 14 Jan 2009 10:37:42 -0500
Subject: [Rd] particulars of importing/loading libraries
In-Reply-To: <1A68FCB28DE72F4BA3B967E6506CCE43047DF588@mildnpexmb01.maninvestments.ad.man.com>
References: <1A68FCB28DE72F4BA3B967E6506CCE43047DF583@mildnpexmb01.maninvestments.ad.man.com>
	<E66844FE-E31E-45F4-8753-72445204E7A6@r-project.org>
	<1A68FCB28DE72F4BA3B967E6506CCE43047DF588@mildnpexmb01.maninvestments.ad.man.com>
Message-ID: <17552B71-88D9-456D-84A4-EC9ACC6744A2@r-project.org>


On Jan 14, 2009, at 4:24 , Sklyar, Oleg (London) wrote:

> Sorry Simon, you are right. I tried to recreate a problem that I had  
> with other packages where the packages were added to Depends but  
> made a mistake. However the problem remains if I do the following.
>
> Added: pack1 to Depends of pack2. Now I create pack3 with the  
> following contents: it does not import pack1 directly, nor depends  
> on it. It rather imports pack2 and depends on pack2. I then expect  
> the functionality of pack1 to be available still if I only load pack3.


That is semantically not a reasonable requirement. pack3 cannot (and  
should not) assume anything about the internals of pack2. If it needs  
a function from pack1, it has to import it from pack1. If pack2 re- 
exported as.POSIXct then that would make it part of pack2's interface  
and then you're free to just depend on pack2.

Cheers,
S



> But I
> now get errors with pack3 calling the function from pack1. Does this
> mean I need to import and depend on pack1 and methods explicitly in
> pack3. I.e. do I have to import and depend on ALL the packages that  
> may
> be in use, even if they are imported by other that I depend on and
> import:
>
> ---- pack3: DESCRIPTION -----
>
> Package: pack3
> Version: 0.0.1
> Date: 12 Jan 2009
> Title: pack1 to test S3/S4 methods compatibility
> Author:  Oleg Sklyar
> Depends: R (>= 2.7.1), pack2
> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
> Description: pack3
> LazyLoad: yes
> License: Proprietary
> URL: http://www.maninvestments.com
> LazyLoad: no
>
> ---- pack3: NAMESPACE ------
> import(pack2)
> exportPattern("^[^\\.]")
>
> ---- pack3: posix.R ------
> testPosix2 = function() {
>    z = as.POSIXct(testPosixVal)
>    print(z)
>    print(class(z))
>    z
> }
>
> Note, that the above function is the same as in pack2, just a  
> different
> name.
>
>
> *** R 2.9.0 (svn -r 46585) [/share/research/R-devel/20081002/lib64/R]
> ***
>> library(pack3)
> Loading required package: pack2
> Loading required package: pack1
>> as.POSIXct(pack1::testPosixVal)
> [1] "2009-01-13 15:29:50 UTC"
>> testPosxi() ## called from pack2
> [1] "2009-01-13 15:29:50 UTC"
> [1] "POSIXt"  "POSIXct"
> [1] "2009-01-13 15:29:50 UTC"
>> testPosix2() ## called from pack3
> Error in as.POSIXct.default(testPosixVal) :
>  do not know how to convert 'testPosixVal' to class "POSIXlt"
>
>
>
>
> Dr Oleg Sklyar
> Research Technologist
> AHL / Man Investments Ltd
> +44 (0)20 7144 3107
> osklyar at maninvestments.com
>
>> -----Original Message-----
>> From: Simon Urbanek [mailto:simon.urbanek at r-project.org]
>> Sent: 14 January 2009 01:51
>> To: Sklyar, Oleg (London)
>> Cc: r-devel at r-project.org
>> Subject: Re: [Rd] particulars of importing/loading libraries
>>
>> Oleg,
>>
>> On Jan 13, 2009, at 11:00 , Sklyar, Oleg (London) wrote:
>>
>>> Dear List:
>>>
>>> Sorry for posting maybe a trivial question, but I have a basic
>>> understanding problem. If I have say pack1 and pack2, two R
>> packages,
>>> and pack2 depends on and imports pack1 fully (as in the
>> code below),
>>> is
>>> there a way to make all the functionality of pack1 available for the
>>> global and other environments (not only for the functions
>> called from
>>> withing pack2) by loading pack2 only? I thought if pack2
>> depends on
>>> and
>>> imports pack1 and essentially reexports everything, one
>> should get the
>>> full functionality simply by loading pack2. This does not
>> seem to be
>>> the
>>> case or I am missing something trivial in my NAMESPACE/DESCRIPTION
>>> files?
>>>
>>> If this is documented in Writing R Extensions, I would be thankful
>>> for a
>>> page number and maybe a quick fix in my example below as so
>> far I have
>>> not been able to find a clear explanation.
>>>
>>> The problem can be illustrated by the following simple
>> example (this
>>> is
>>> a simple code for 2 packages, pack1 and pack2; plus an example).
>>>
>>
>> if you bothered to use R CMD check you would find your bug right  
>> away:
>> * checking package dependencies ... ERROR
>> Namespace dependencies not required:
>>   pack1
>>
>> You simply forgot to add pack1 to the Depends: line - that's
>> all. Once
>> you fix that, you'll see what happens:
>>
>>> library(pack2)
>> Loading required package: pack1
>>> as.POSIXct(pack1::testPosixVal)
>> [1] "2009-01-14 01:38:08 UTC"
>>
>> Cheers,
>> S
>>
>>
>>> Thank you for your replies.
>>>
>>> Dr Oleg Sklyar
>>> Research Technologist
>>> AHL / Man Investments Ltd
>>> +44 (0)20 7144 3107
>>> osklyar at maninvestments.com
>>>
>>> --- pack1: DESCRIPTION ------
>>> Package: pack1
>>> Version: 0.0.1
>>> Date: 12 Jan 2009
>>> Title: pack1 to test S3/S4 methods compatibility
>>> Author:  Oleg Sklyar
>>> Depends: R (>= 2.7.1), methods
>>> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
>>> Description: pack1
>>> LazyLoad: yes
>>> License: Proprietary
>>> URL: http://www.maninvestments.com
>>> LazyLoad: no
>>>
>>> --- pack1: NAMESPACE ------
>>> import(methods)
>>> exportPattern("^[^\\.]")
>>> exportClasses(posixTime)
>>> exportMethods(as.POSIXct)
>>>
>>> --- pack1: posix.R ------
>>> setClass("posixTime", "numeric")
>>>
>>> setGeneric("as.POSIXct")
>>> setMethod("as.POSIXct", signature(x="posixTime"),
>>>   function(x, tz) {
>>>       z = x at .Data
>>>       attr(z,"class") = c("POSIXt", "POSIXct")
>>>       attr(z,"tzone") = "UTC"
>>>       z
>>>   }
>>> )
>>>
>>> testPosixVal = new("posixTime", as.numeric(Sys.time()))
>>>
>>> --- pack2: DESCRIPTION
>>> Package: pack2
>>> Version: 0.0.1
>>> Date: 12 Jan 2009
>>> Title: pack2 to test S3/S4 methods compatibility
>>> Author:  Oleg Sklyar
>>> Depends: R (>= 2.7.1), methods
>>> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
>>> Description: pack2
>>> LazyLoad: yes
>>> License: Proprietary
>>> URL: http://www.maninvestments.com
>>> LazyLoad: no
>>>
>>> --- pack2: NAMESPACE ------
>>> import(pack1)
>>> exportPattern("^[^\\.]")
>>>
>>> --- pack2: posix.R ------
>>> testPosix = function() {
>>>   z = as.POSIXct(testPosixVal)
>>>   print(z)
>>>   print(class(z))
>>>   z
>>> }
>>>
>>> ------ test code to run from global env, showing problems -------
>>> require(pack2)
>>>
>>> ## use as.POSIXct imported into pack2 from pack1 to do the
>>> conversion in
>>> the fun
>>> testPosix()
>>> #~ [1] "2009-01-13 15:29:50 UTC"
>>> #~ [1] "POSIXt"  "POSIXct"
>>> #~ [1] "2009-01-13 15:29:50 UTC"
>>>
>>> ## now try using it directly from the global env (pack1 was not
>>> explicitly loaded)
>>> as.POSIXct(pack1::testPosixVal)
>>> #~ Error in as.POSIXct.default(pack1::testPosixVal) :
>>> #~  do not know how to convert 'pack1::testPosixVal' to class
>>> "POSIXlt"
>>>
>>> ## now require pack1 explicitly and try again
>>> require(pack1)
>>> as.POSIXct(pack1::testPosixVal)
>>> #~ [1] "2009-01-13 15:29:50 UTC"
>>>
>>>
>>>
>> **********************************************************************
>>> Please consider the environment before printing this email or its
>>> attachments.
>>> The contents of this email are for the named addressees
>> ...{{dropped:
>>> 19}}
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
>>
>
> **********************************************************************
> Please consider the environment before printing this email or its  
> attachments.
> The contents of this email are for the named addressees only.  It  
> contains information which may be confidential and privileged.  If  
> you are not the intended recipient, please notify the sender  
> immediately, destroy this email and any attachments and do not  
> otherwise disclose or use them. Email transmission is not a secure  
> method of communication and Man Investments cannot accept  
> responsibility for the completeness or accuracy of this email or any  
> attachments. Whilst Man Investments makes every effort to keep its  
> network free from viruses, it does not accept responsibility for any  
> computer virus which might be transferred by way of this email or  
> any attachments. This email does not constitute a request, offer,  
> recommendation or solicitation of any kind to buy, subscribe, sell  
> or redeem any investment instruments or to perform other such  
> transactions of any kind. Man Investments reserves the right to  
> monitor, record and retain all electronic communications through its  
> network to ensure the integrity of its systems, for record keeping  
> and regulatory purposes.
> Visit us at: www.maninvestments.com
> TG0908
> **********************************************************************
>
>


From osklyar at maninvestments.com  Wed Jan 14 16:52:56 2009
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Wed, 14 Jan 2009 15:52:56 -0000
Subject: [Rd] particulars of importing/loading libraries
In-Reply-To: <17552B71-88D9-456D-84A4-EC9ACC6744A2@r-project.org>
References: <1A68FCB28DE72F4BA3B967E6506CCE43047DF583@mildnpexmb01.maninvestments.ad.man.com>
	<E66844FE-E31E-45F4-8753-72445204E7A6@r-project.org>
	<1A68FCB28DE72F4BA3B967E6506CCE43047DF588@mildnpexmb01.maninvestments.ad.man.com>
	<17552B71-88D9-456D-84A4-EC9ACC6744A2@r-project.org>
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE43047DF593@mildnpexmb01.maninvestments.ad.man.com>

Well, this is very reasonable and this is how it should be I would say.
If it was consistent, there would be no problem as they would be easy to
nail down. However, the problem is now that if I load pack3 only (which
imports pack2 only) then as.POSIXct exported from pack1 is NOT available
for functions in pack3, but is available for calls from the global env
(see example below). It is obviously available for calls from functions
in pack2 as there it is imported directly. Although, why also
testPosix() of pack2 is then available for calls from the global env as
it was only loaded as import for pack3?

In my understanding if pack3 does not depend on pack1 directly,
functionality of pack1 should not be available anywhere apart from
functions called from pack2 as well as functions in pack2 should only be
available for calls by functions in pack3 but not in the global env...
The semantics seems to be broken here, is it not?

> library(pack3)
Loading required package: pack2
Loading required package: pack1
> testPosix() ## from pack2
[1] "2009-01-13 15:29:50 UTC"
[1] "POSIXt"  "POSIXct"
[1] "2009-01-13 15:29:50 UTC"
> testPosix2()
Error in as.POSIXct.default(testPosixVal) : 
  do not know how to convert 'testPosixVal' to class "POSIXlt"
> as.POSIXct(pack1::testPosixVal)
[1] "2009-01-13 15:29:50 UTC"



Dr Oleg Sklyar
Research Technologist
AHL / Man Investments Ltd
+44 (0)20 7144 3107
osklyar at maninvestments.com 

> -----Original Message-----
> From: Simon Urbanek [mailto:simon.urbanek at r-project.org] 
> Sent: 14 January 2009 15:38
> To: Sklyar, Oleg (London)
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] particulars of importing/loading libraries
> 
> 
> On Jan 14, 2009, at 4:24 , Sklyar, Oleg (London) wrote:
> 
> > Sorry Simon, you are right. I tried to recreate a problem 
> that I had  
> > with other packages where the packages were added to Depends but  
> > made a mistake. However the problem remains if I do the following.
> >
> > Added: pack1 to Depends of pack2. Now I create pack3 with the  
> > following contents: it does not import pack1 directly, nor depends  
> > on it. It rather imports pack2 and depends on pack2. I then expect  
> > the functionality of pack1 to be available still if I only 
> load pack3.
> 
> 
> That is semantically not a reasonable requirement. pack3 cannot (and  
> should not) assume anything about the internals of pack2. If 
> it needs  
> a function from pack1, it has to import it from pack1. If pack2 re- 
> exported as.POSIXct then that would make it part of pack2's 
> interface  
> and then you're free to just depend on pack2.
> 
> Cheers,
> S
> 
> 
> 
> > But I
> > now get errors with pack3 calling the function from pack1. Does this
> > mean I need to import and depend on pack1 and methods explicitly in
> > pack3. I.e. do I have to import and depend on ALL the 
> packages that  
> > may
> > be in use, even if they are imported by other that I depend on and
> > import:
> >
> > ---- pack3: DESCRIPTION -----
> >
> > Package: pack3
> > Version: 0.0.1
> > Date: 12 Jan 2009
> > Title: pack1 to test S3/S4 methods compatibility
> > Author:  Oleg Sklyar
> > Depends: R (>= 2.7.1), pack2
> > Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
> > Description: pack3
> > LazyLoad: yes
> > License: Proprietary
> > URL: http://www.maninvestments.com
> > LazyLoad: no
> >
> > ---- pack3: NAMESPACE ------
> > import(pack2)
> > exportPattern("^[^\\.]")
> >
> > ---- pack3: posix.R ------
> > testPosix2 = function() {
> >    z = as.POSIXct(testPosixVal)
> >    print(z)
> >    print(class(z))
> >    z
> > }
> >
> > Note, that the above function is the same as in pack2, just a  
> > different
> > name.
> >
> >
> > *** R 2.9.0 (svn -r 46585) 
> [/share/research/R-devel/20081002/lib64/R]
> > ***
> >> library(pack3)
> > Loading required package: pack2
> > Loading required package: pack1
> >> as.POSIXct(pack1::testPosixVal)
> > [1] "2009-01-13 15:29:50 UTC"
> >> testPosxi() ## called from pack2
> > [1] "2009-01-13 15:29:50 UTC"
> > [1] "POSIXt"  "POSIXct"
> > [1] "2009-01-13 15:29:50 UTC"
> >> testPosix2() ## called from pack3
> > Error in as.POSIXct.default(testPosixVal) :
> >  do not know how to convert 'testPosixVal' to class "POSIXlt"
> >
> >
> >
> >
> > Dr Oleg Sklyar
> > Research Technologist
> > AHL / Man Investments Ltd
> > +44 (0)20 7144 3107
> > osklyar at maninvestments.com
> >
> >> -----Original Message-----
> >> From: Simon Urbanek [mailto:simon.urbanek at r-project.org]
> >> Sent: 14 January 2009 01:51
> >> To: Sklyar, Oleg (London)
> >> Cc: r-devel at r-project.org
> >> Subject: Re: [Rd] particulars of importing/loading libraries
> >>
> >> Oleg,
> >>
> >> On Jan 13, 2009, at 11:00 , Sklyar, Oleg (London) wrote:
> >>
> >>> Dear List:
> >>>
> >>> Sorry for posting maybe a trivial question, but I have a basic
> >>> understanding problem. If I have say pack1 and pack2, two R
> >> packages,
> >>> and pack2 depends on and imports pack1 fully (as in the
> >> code below),
> >>> is
> >>> there a way to make all the functionality of pack1 
> available for the
> >>> global and other environments (not only for the functions
> >> called from
> >>> withing pack2) by loading pack2 only? I thought if pack2
> >> depends on
> >>> and
> >>> imports pack1 and essentially reexports everything, one
> >> should get the
> >>> full functionality simply by loading pack2. This does not
> >> seem to be
> >>> the
> >>> case or I am missing something trivial in my NAMESPACE/DESCRIPTION
> >>> files?
> >>>
> >>> If this is documented in Writing R Extensions, I would be thankful
> >>> for a
> >>> page number and maybe a quick fix in my example below as so
> >> far I have
> >>> not been able to find a clear explanation.
> >>>
> >>> The problem can be illustrated by the following simple
> >> example (this
> >>> is
> >>> a simple code for 2 packages, pack1 and pack2; plus an example).
> >>>
> >>
> >> if you bothered to use R CMD check you would find your bug right  
> >> away:
> >> * checking package dependencies ... ERROR
> >> Namespace dependencies not required:
> >>   pack1
> >>
> >> You simply forgot to add pack1 to the Depends: line - that's
> >> all. Once
> >> you fix that, you'll see what happens:
> >>
> >>> library(pack2)
> >> Loading required package: pack1
> >>> as.POSIXct(pack1::testPosixVal)
> >> [1] "2009-01-14 01:38:08 UTC"
> >>
> >> Cheers,
> >> S
> >>
> >>
> >>> Thank you for your replies.
> >>>
> >>> Dr Oleg Sklyar
> >>> Research Technologist
> >>> AHL / Man Investments Ltd
> >>> +44 (0)20 7144 3107
> >>> osklyar at maninvestments.com
> >>>
> >>> --- pack1: DESCRIPTION ------
> >>> Package: pack1
> >>> Version: 0.0.1
> >>> Date: 12 Jan 2009
> >>> Title: pack1 to test S3/S4 methods compatibility
> >>> Author:  Oleg Sklyar
> >>> Depends: R (>= 2.7.1), methods
> >>> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
> >>> Description: pack1
> >>> LazyLoad: yes
> >>> License: Proprietary
> >>> URL: http://www.maninvestments.com
> >>> LazyLoad: no
> >>>
> >>> --- pack1: NAMESPACE ------
> >>> import(methods)
> >>> exportPattern("^[^\\.]")
> >>> exportClasses(posixTime)
> >>> exportMethods(as.POSIXct)
> >>>
> >>> --- pack1: posix.R ------
> >>> setClass("posixTime", "numeric")
> >>>
> >>> setGeneric("as.POSIXct")
> >>> setMethod("as.POSIXct", signature(x="posixTime"),
> >>>   function(x, tz) {
> >>>       z = x at .Data
> >>>       attr(z,"class") = c("POSIXt", "POSIXct")
> >>>       attr(z,"tzone") = "UTC"
> >>>       z
> >>>   }
> >>> )
> >>>
> >>> testPosixVal = new("posixTime", as.numeric(Sys.time()))
> >>>
> >>> --- pack2: DESCRIPTION
> >>> Package: pack2
> >>> Version: 0.0.1
> >>> Date: 12 Jan 2009
> >>> Title: pack2 to test S3/S4 methods compatibility
> >>> Author:  Oleg Sklyar
> >>> Depends: R (>= 2.7.1), methods
> >>> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
> >>> Description: pack2
> >>> LazyLoad: yes
> >>> License: Proprietary
> >>> URL: http://www.maninvestments.com
> >>> LazyLoad: no
> >>>
> >>> --- pack2: NAMESPACE ------
> >>> import(pack1)
> >>> exportPattern("^[^\\.]")
> >>>
> >>> --- pack2: posix.R ------
> >>> testPosix = function() {
> >>>   z = as.POSIXct(testPosixVal)
> >>>   print(z)
> >>>   print(class(z))
> >>>   z
> >>> }
> >>>
> >>> ------ test code to run from global env, showing problems -------
> >>> require(pack2)
> >>>
> >>> ## use as.POSIXct imported into pack2 from pack1 to do the
> >>> conversion in
> >>> the fun
> >>> testPosix()
> >>> #~ [1] "2009-01-13 15:29:50 UTC"
> >>> #~ [1] "POSIXt"  "POSIXct"
> >>> #~ [1] "2009-01-13 15:29:50 UTC"
> >>>
> >>> ## now try using it directly from the global env (pack1 was not
> >>> explicitly loaded)
> >>> as.POSIXct(pack1::testPosixVal)
> >>> #~ Error in as.POSIXct.default(pack1::testPosixVal) :
> >>> #~  do not know how to convert 'pack1::testPosixVal' to class
> >>> "POSIXlt"
> >>>
> >>> ## now require pack1 explicitly and try again
> >>> require(pack1)
> >>> as.POSIXct(pack1::testPosixVal)
> >>> #~ [1] "2009-01-13 15:29:50 UTC"
> >>>
> >>>
> >>>
> >> 
> **********************************************************************
> >>> Please consider the environment before printing this email or its
> >>> attachments.
> >>> The contents of this email are for the named addressees
> >> ...{{dropped:
> >>> 19}}
> >>>
> >>> ______________________________________________
> >>> R-devel at r-project.org mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>>
> >>>
> >>
> >>
> >
> > 
> **********************************************************************
> > Please consider the environment before printing this email or its  
> > attachments.
> > The contents of this email are for the named addressees only.  It  
> > contains information which may be confidential and privileged.  If  
> > you are not the intended recipient, please notify the sender  
> > immediately, destroy this email and any attachments and do not  
> > otherwise disclose or use them. Email transmission is not a secure  
> > method of communication and Man Investments cannot accept  
> > responsibility for the completeness or accuracy of this 
> email or any  
> > attachments. Whilst Man Investments makes every effort to keep its  
> > network free from viruses, it does not accept 
> responsibility for any  
> > computer virus which might be transferred by way of this email or  
> > any attachments. This email does not constitute a request, offer,  
> > recommendation or solicitation of any kind to buy, subscribe, sell  
> > or redeem any investment instruments or to perform other such  
> > transactions of any kind. Man Investments reserves the right to  
> > monitor, record and retain all electronic communications 
> through its  
> > network to ensure the integrity of its systems, for record keeping  
> > and regulatory purposes.
> > Visit us at: www.maninvestments.com
> > TG0908
> > 
> **********************************************************************
> >
> >
> 
> 


From Bernhard_Pfaff at fra.invesco.com  Wed Jan 14 17:01:06 2009
From: Bernhard_Pfaff at fra.invesco.com (Pfaff, Bernhard Dr.)
Date: Wed, 14 Jan 2009 16:01:06 -0000
Subject: [Rd] FORTRAN compilation error on Tiger but not for Leopard
In-Reply-To: <B89F0CE41D45644A97CCC93DF548C1C31702C455@GBHENXMB02.corp.amvescap.net>
References: <B89F0CE41D45644A97CCC93DF548C1C31702C455@GBHENXMB02.corp.amvescap.net>
Message-ID: <B89F0CE41D45644A97CCC93DF548C1C31702C9B6@GBHENXMB02.corp.amvescap.net>

Just to let the list know; the issue has been resolved by Simon Urbanek,
again many thanks Simon. His reply is available at:

https://stat.ethz.ch/pipermail/r-sig-mac/2009-January/005759.html


Best,
Bernhard


>
>Dear list member,
>
>the package urca now contains FORTRAN code in ./src. The
>compilation/build works on R-Forge (see project AICTSI with Leopard),
>but an error is reported in the build on CRAN (Tiger). My question now
>is: Is there anything I can do as a package maintainer such that the
>package can be build under Tiger? Any hints and pointers are welcome.
>
>The code is available here:
>http://r-forge.r-project.org/plugins/scmsvn/viewcvs.php/pkg/src
/?root=ur
>ca
>
>And the Mac build log file can be accessed here:
>http://www.r-project.org/nosvn/R.check/r-release-macosx-ix86/ur
ca-00chec
>k.html
>with further information:
>http://www.r-project.org/nosvn/R.check/r-release-macosx-ix86/ur
ca-00inst
>all.html
>
>Fyi: I have posted this email to R-SIG-Mac yesterday, but have not
>received a response by now. Because the issue might also be 
>relevant for
>R-Devel I decided to post the problem here, too. In addition, the build
>and check for the other architectures/version is passed.
>
>
>Best,
>Bernhard
>
>*****************************************************************
>Confidentiality Note: The information contained in this 
>...{{dropped:10}}
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel
>


From simon.urbanek at r-project.org  Wed Jan 14 17:10:51 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 14 Jan 2009 11:10:51 -0500
Subject: [Rd] particulars of importing/loading libraries
In-Reply-To: <1A68FCB28DE72F4BA3B967E6506CCE43047DF593@mildnpexmb01.maninvestments.ad.man.com>
References: <1A68FCB28DE72F4BA3B967E6506CCE43047DF583@mildnpexmb01.maninvestments.ad.man.com>
	<E66844FE-E31E-45F4-8753-72445204E7A6@r-project.org>
	<1A68FCB28DE72F4BA3B967E6506CCE43047DF588@mildnpexmb01.maninvestments.ad.man.com>
	<17552B71-88D9-456D-84A4-EC9ACC6744A2@r-project.org>
	<1A68FCB28DE72F4BA3B967E6506CCE43047DF593@mildnpexmb01.maninvestments.ad.man.com>
Message-ID: <B4884C38-AB6A-40B3-A156-8698C28CD878@r-project.org>


On Jan 14, 2009, at 10:52 , Sklyar, Oleg (London) wrote:

> Well, this is very reasonable and this is how it should be I would  
> say. If it was consistent, there would be no problem as they would  
> be easy to nail down. However, the problem is now that if I load  
> pack3 only (which imports pack2 only) then as.POSIXct exported from  
> pack1 is NOT available for functions in pack3,

Because pack3 didn't request it.


> but is available for calls from the global env (see example below).  
> It is obviously available for calls from functions in pack2 as there  
> it is imported directly. Although, why also testPosix() of pack2 is  
> then available for calls from the global env as it was only loaded  
> as import for pack3?
>

Global environment is not encapsulated - you have access to anything  
that has been attached - sort of implicitly importing anything that  
has even been [exported and] attached (there is really no concept of  
"importing" for the global environment, but the effect is analogous).  
This is a conceptual difference of the "interactive" use vs package  
code. Unlike package code you don't know in advance what you will be  
doing when you're working interactively, so I think it makes sense to  
assume that everything is implicitly imported.

Cheers,
S


> In my understanding if pack3 does not depend on pack1 directly,
> functionality of pack1 should not be available anywhere apart from
> functions called from pack2 as well as functions in pack2 should  
> only be
> available for calls by functions in pack3 but not in the global env...
> The semantics seems to be broken here, is it not?
>
>> library(pack3)
> Loading required package: pack2
> Loading required package: pack1
>> testPosix() ## from pack2
> [1] "2009-01-13 15:29:50 UTC"
> [1] "POSIXt"  "POSIXct"
> [1] "2009-01-13 15:29:50 UTC"
>> testPosix2()
> Error in as.POSIXct.default(testPosixVal) :
>  do not know how to convert 'testPosixVal' to class "POSIXlt"
>> as.POSIXct(pack1::testPosixVal)
> [1] "2009-01-13 15:29:50 UTC"
>
>
>
> Dr Oleg Sklyar
> Research Technologist
> AHL / Man Investments Ltd
> +44 (0)20 7144 3107
> osklyar at maninvestments.com
>
>> -----Original Message-----
>> From: Simon Urbanek [mailto:simon.urbanek at r-project.org]
>> Sent: 14 January 2009 15:38
>> To: Sklyar, Oleg (London)
>> Cc: r-devel at r-project.org
>> Subject: Re: [Rd] particulars of importing/loading libraries
>>
>>
>> On Jan 14, 2009, at 4:24 , Sklyar, Oleg (London) wrote:
>>
>>> Sorry Simon, you are right. I tried to recreate a problem
>> that I had
>>> with other packages where the packages were added to Depends but
>>> made a mistake. However the problem remains if I do the following.
>>>
>>> Added: pack1 to Depends of pack2. Now I create pack3 with the
>>> following contents: it does not import pack1 directly, nor depends
>>> on it. It rather imports pack2 and depends on pack2. I then expect
>>> the functionality of pack1 to be available still if I only
>> load pack3.
>>
>>
>> That is semantically not a reasonable requirement. pack3 cannot (and
>> should not) assume anything about the internals of pack2. If
>> it needs
>> a function from pack1, it has to import it from pack1. If pack2 re-
>> exported as.POSIXct then that would make it part of pack2's
>> interface
>> and then you're free to just depend on pack2.
>>
>> Cheers,
>> S
>>
>>
>>
>>> But I
>>> now get errors with pack3 calling the function from pack1. Does this
>>> mean I need to import and depend on pack1 and methods explicitly in
>>> pack3. I.e. do I have to import and depend on ALL the
>> packages that
>>> may
>>> be in use, even if they are imported by other that I depend on and
>>> import:
>>>
>>> ---- pack3: DESCRIPTION -----
>>>
>>> Package: pack3
>>> Version: 0.0.1
>>> Date: 12 Jan 2009
>>> Title: pack1 to test S3/S4 methods compatibility
>>> Author:  Oleg Sklyar
>>> Depends: R (>= 2.7.1), pack2
>>> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
>>> Description: pack3
>>> LazyLoad: yes
>>> License: Proprietary
>>> URL: http://www.maninvestments.com
>>> LazyLoad: no
>>>
>>> ---- pack3: NAMESPACE ------
>>> import(pack2)
>>> exportPattern("^[^\\.]")
>>>
>>> ---- pack3: posix.R ------
>>> testPosix2 = function() {
>>>   z = as.POSIXct(testPosixVal)
>>>   print(z)
>>>   print(class(z))
>>>   z
>>> }
>>>
>>> Note, that the above function is the same as in pack2, just a
>>> different
>>> name.
>>>
>>>
>>> *** R 2.9.0 (svn -r 46585)
>> [/share/research/R-devel/20081002/lib64/R]
>>> ***
>>>> library(pack3)
>>> Loading required package: pack2
>>> Loading required package: pack1
>>>> as.POSIXct(pack1::testPosixVal)
>>> [1] "2009-01-13 15:29:50 UTC"
>>>> testPosxi() ## called from pack2
>>> [1] "2009-01-13 15:29:50 UTC"
>>> [1] "POSIXt"  "POSIXct"
>>> [1] "2009-01-13 15:29:50 UTC"
>>>> testPosix2() ## called from pack3
>>> Error in as.POSIXct.default(testPosixVal) :
>>> do not know how to convert 'testPosixVal' to class "POSIXlt"
>>>
>>>
>>>
>>>
>>> Dr Oleg Sklyar
>>> Research Technologist
>>> AHL / Man Investments Ltd
>>> +44 (0)20 7144 3107
>>> osklyar at maninvestments.com
>>>
>>>> -----Original Message-----
>>>> From: Simon Urbanek [mailto:simon.urbanek at r-project.org]
>>>> Sent: 14 January 2009 01:51
>>>> To: Sklyar, Oleg (London)
>>>> Cc: r-devel at r-project.org
>>>> Subject: Re: [Rd] particulars of importing/loading libraries
>>>>
>>>> Oleg,
>>>>
>>>> On Jan 13, 2009, at 11:00 , Sklyar, Oleg (London) wrote:
>>>>
>>>>> Dear List:
>>>>>
>>>>> Sorry for posting maybe a trivial question, but I have a basic
>>>>> understanding problem. If I have say pack1 and pack2, two R
>>>> packages,
>>>>> and pack2 depends on and imports pack1 fully (as in the
>>>> code below),
>>>>> is
>>>>> there a way to make all the functionality of pack1
>> available for the
>>>>> global and other environments (not only for the functions
>>>> called from
>>>>> withing pack2) by loading pack2 only? I thought if pack2
>>>> depends on
>>>>> and
>>>>> imports pack1 and essentially reexports everything, one
>>>> should get the
>>>>> full functionality simply by loading pack2. This does not
>>>> seem to be
>>>>> the
>>>>> case or I am missing something trivial in my NAMESPACE/DESCRIPTION
>>>>> files?
>>>>>
>>>>> If this is documented in Writing R Extensions, I would be thankful
>>>>> for a
>>>>> page number and maybe a quick fix in my example below as so
>>>> far I have
>>>>> not been able to find a clear explanation.
>>>>>
>>>>> The problem can be illustrated by the following simple
>>>> example (this
>>>>> is
>>>>> a simple code for 2 packages, pack1 and pack2; plus an example).
>>>>>
>>>>
>>>> if you bothered to use R CMD check you would find your bug right
>>>> away:
>>>> * checking package dependencies ... ERROR
>>>> Namespace dependencies not required:
>>>>  pack1
>>>>
>>>> You simply forgot to add pack1 to the Depends: line - that's
>>>> all. Once
>>>> you fix that, you'll see what happens:
>>>>
>>>>> library(pack2)
>>>> Loading required package: pack1
>>>>> as.POSIXct(pack1::testPosixVal)
>>>> [1] "2009-01-14 01:38:08 UTC"
>>>>
>>>> Cheers,
>>>> S
>>>>
>>>>
>>>>> Thank you for your replies.
>>>>>
>>>>> Dr Oleg Sklyar
>>>>> Research Technologist
>>>>> AHL / Man Investments Ltd
>>>>> +44 (0)20 7144 3107
>>>>> osklyar at maninvestments.com
>>>>>
>>>>> --- pack1: DESCRIPTION ------
>>>>> Package: pack1
>>>>> Version: 0.0.1
>>>>> Date: 12 Jan 2009
>>>>> Title: pack1 to test S3/S4 methods compatibility
>>>>> Author:  Oleg Sklyar
>>>>> Depends: R (>= 2.7.1), methods
>>>>> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
>>>>> Description: pack1
>>>>> LazyLoad: yes
>>>>> License: Proprietary
>>>>> URL: http://www.maninvestments.com
>>>>> LazyLoad: no
>>>>>
>>>>> --- pack1: NAMESPACE ------
>>>>> import(methods)
>>>>> exportPattern("^[^\\.]")
>>>>> exportClasses(posixTime)
>>>>> exportMethods(as.POSIXct)
>>>>>
>>>>> --- pack1: posix.R ------
>>>>> setClass("posixTime", "numeric")
>>>>>
>>>>> setGeneric("as.POSIXct")
>>>>> setMethod("as.POSIXct", signature(x="posixTime"),
>>>>>  function(x, tz) {
>>>>>      z = x at .Data
>>>>>      attr(z,"class") = c("POSIXt", "POSIXct")
>>>>>      attr(z,"tzone") = "UTC"
>>>>>      z
>>>>>  }
>>>>> )
>>>>>
>>>>> testPosixVal = new("posixTime", as.numeric(Sys.time()))
>>>>>
>>>>> --- pack2: DESCRIPTION
>>>>> Package: pack2
>>>>> Version: 0.0.1
>>>>> Date: 12 Jan 2009
>>>>> Title: pack2 to test S3/S4 methods compatibility
>>>>> Author:  Oleg Sklyar
>>>>> Depends: R (>= 2.7.1), methods
>>>>> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
>>>>> Description: pack2
>>>>> LazyLoad: yes
>>>>> License: Proprietary
>>>>> URL: http://www.maninvestments.com
>>>>> LazyLoad: no
>>>>>
>>>>> --- pack2: NAMESPACE ------
>>>>> import(pack1)
>>>>> exportPattern("^[^\\.]")
>>>>>
>>>>> --- pack2: posix.R ------
>>>>> testPosix = function() {
>>>>>  z = as.POSIXct(testPosixVal)
>>>>>  print(z)
>>>>>  print(class(z))
>>>>>  z
>>>>> }
>>>>>
>>>>> ------ test code to run from global env, showing problems -------
>>>>> require(pack2)
>>>>>
>>>>> ## use as.POSIXct imported into pack2 from pack1 to do the
>>>>> conversion in
>>>>> the fun
>>>>> testPosix()
>>>>> #~ [1] "2009-01-13 15:29:50 UTC"
>>>>> #~ [1] "POSIXt"  "POSIXct"
>>>>> #~ [1] "2009-01-13 15:29:50 UTC"
>>>>>
>>>>> ## now try using it directly from the global env (pack1 was not
>>>>> explicitly loaded)
>>>>> as.POSIXct(pack1::testPosixVal)
>>>>> #~ Error in as.POSIXct.default(pack1::testPosixVal) :
>>>>> #~  do not know how to convert 'pack1::testPosixVal' to class
>>>>> "POSIXlt"
>>>>>
>>>>> ## now require pack1 explicitly and try again
>>>>> require(pack1)
>>>>> as.POSIXct(pack1::testPosixVal)
>>>>> #~ [1] "2009-01-13 15:29:50 UTC"
>>>>>
>>>>>
>>>>>
>>>>
>> **********************************************************************
>>>>> Please consider the environment before printing this email or its
>>>>> attachments.
>>>>> The contents of this email are for the named addressees
>>>> ...{{dropped:
>>>>> 19}}
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>>
>>>>
>>>>
>>>
>>>
>> **********************************************************************
>>> Please consider the environment before printing this email or its
>>> attachments.
>>> The contents of this email are for the named addressees only.  It
>>> contains information which may be confidential and privileged.  If
>>> you are not the intended recipient, please notify the sender
>>> immediately, destroy this email and any attachments and do not
>>> otherwise disclose or use them. Email transmission is not a secure
>>> method of communication and Man Investments cannot accept
>>> responsibility for the completeness or accuracy of this
>> email or any
>>> attachments. Whilst Man Investments makes every effort to keep its
>>> network free from viruses, it does not accept
>> responsibility for any
>>> computer virus which might be transferred by way of this email or
>>> any attachments. This email does not constitute a request, offer,
>>> recommendation or solicitation of any kind to buy, subscribe, sell
>>> or redeem any investment instruments or to perform other such
>>> transactions of any kind. Man Investments reserves the right to
>>> monitor, record and retain all electronic communications
>> through its
>>> network to ensure the integrity of its systems, for record keeping
>>> and regulatory purposes.
>>> Visit us at: www.maninvestments.com
>>> TG0908
>>>
>> **********************************************************************
>>>
>>>
>>
>>
>
>


From osklyar at maninvestments.com  Wed Jan 14 17:49:25 2009
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Wed, 14 Jan 2009 16:49:25 -0000
Subject: [Rd] particulars of importing/loading libraries
In-Reply-To: <B4884C38-AB6A-40B3-A156-8698C28CD878@r-project.org>
References: <1A68FCB28DE72F4BA3B967E6506CCE43047DF583@mildnpexmb01.maninvestments.ad.man.com>
	<E66844FE-E31E-45F4-8753-72445204E7A6@r-project.org>
	<1A68FCB28DE72F4BA3B967E6506CCE43047DF588@mildnpexmb01.maninvestments.ad.man.com>
	<17552B71-88D9-456D-84A4-EC9ACC6744A2@r-project.org>
	<1A68FCB28DE72F4BA3B967E6506CCE43047DF593@mildnpexmb01.maninvestments.ad.man.com>
	<B4884C38-AB6A-40B3-A156-8698C28CD878@r-project.org>
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE43047DF594@mildnpexmb01.maninvestments.ad.man.com>

Thank you Simon.

Dr Oleg Sklyar
Research Technologist
AHL / Man Investments Ltd
+44 (0)20 7144 3107
osklyar at maninvestments.com 

> -----Original Message-----
> From: Simon Urbanek [mailto:simon.urbanek at r-project.org] 
> Sent: 14 January 2009 16:11
> To: Sklyar, Oleg (London)
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] particulars of importing/loading libraries
> 
> 
> On Jan 14, 2009, at 10:52 , Sklyar, Oleg (London) wrote:
> 
> > Well, this is very reasonable and this is how it should be I would  
> > say. If it was consistent, there would be no problem as they would  
> > be easy to nail down. However, the problem is now that if I load  
> > pack3 only (which imports pack2 only) then as.POSIXct 
> exported from  
> > pack1 is NOT available for functions in pack3,
> 
> Because pack3 didn't request it.
> 
> 
> > but is available for calls from the global env (see example 
> below).  
> > It is obviously available for calls from functions in pack2 
> as there  
> > it is imported directly. Although, why also testPosix() of 
> pack2 is  
> > then available for calls from the global env as it was only loaded  
> > as import for pack3?
> >
> 
> Global environment is not encapsulated - you have access to anything  
> that has been attached - sort of implicitly importing anything that  
> has even been [exported and] attached (there is really no concept of  
> "importing" for the global environment, but the effect is 
> analogous).  
> This is a conceptual difference of the "interactive" use vs package  
> code. Unlike package code you don't know in advance what you will be  
> doing when you're working interactively, so I think it makes 
> sense to  
> assume that everything is implicitly imported.
> 
> Cheers,
> S
> 
> 
> > In my understanding if pack3 does not depend on pack1 directly,
> > functionality of pack1 should not be available anywhere apart from
> > functions called from pack2 as well as functions in pack2 should  
> > only be
> > available for calls by functions in pack3 but not in the 
> global env...
> > The semantics seems to be broken here, is it not?
> >
> >> library(pack3)
> > Loading required package: pack2
> > Loading required package: pack1
> >> testPosix() ## from pack2
> > [1] "2009-01-13 15:29:50 UTC"
> > [1] "POSIXt"  "POSIXct"
> > [1] "2009-01-13 15:29:50 UTC"
> >> testPosix2()
> > Error in as.POSIXct.default(testPosixVal) :
> >  do not know how to convert 'testPosixVal' to class "POSIXlt"
> >> as.POSIXct(pack1::testPosixVal)
> > [1] "2009-01-13 15:29:50 UTC"
> >
> >
> >
> > Dr Oleg Sklyar
> > Research Technologist
> > AHL / Man Investments Ltd
> > +44 (0)20 7144 3107
> > osklyar at maninvestments.com
> >
> >> -----Original Message-----
> >> From: Simon Urbanek [mailto:simon.urbanek at r-project.org]
> >> Sent: 14 January 2009 15:38
> >> To: Sklyar, Oleg (London)
> >> Cc: r-devel at r-project.org
> >> Subject: Re: [Rd] particulars of importing/loading libraries
> >>
> >>
> >> On Jan 14, 2009, at 4:24 , Sklyar, Oleg (London) wrote:
> >>
> >>> Sorry Simon, you are right. I tried to recreate a problem
> >> that I had
> >>> with other packages where the packages were added to Depends but
> >>> made a mistake. However the problem remains if I do the following.
> >>>
> >>> Added: pack1 to Depends of pack2. Now I create pack3 with the
> >>> following contents: it does not import pack1 directly, nor depends
> >>> on it. It rather imports pack2 and depends on pack2. I then expect
> >>> the functionality of pack1 to be available still if I only
> >> load pack3.
> >>
> >>
> >> That is semantically not a reasonable requirement. pack3 
> cannot (and
> >> should not) assume anything about the internals of pack2. If
> >> it needs
> >> a function from pack1, it has to import it from pack1. If pack2 re-
> >> exported as.POSIXct then that would make it part of pack2's
> >> interface
> >> and then you're free to just depend on pack2.
> >>
> >> Cheers,
> >> S
> >>
> >>
> >>
> >>> But I
> >>> now get errors with pack3 calling the function from 
> pack1. Does this
> >>> mean I need to import and depend on pack1 and methods 
> explicitly in
> >>> pack3. I.e. do I have to import and depend on ALL the
> >> packages that
> >>> may
> >>> be in use, even if they are imported by other that I depend on and
> >>> import:
> >>>
> >>> ---- pack3: DESCRIPTION -----
> >>>
> >>> Package: pack3
> >>> Version: 0.0.1
> >>> Date: 12 Jan 2009
> >>> Title: pack1 to test S3/S4 methods compatibility
> >>> Author:  Oleg Sklyar
> >>> Depends: R (>= 2.7.1), pack2
> >>> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
> >>> Description: pack3
> >>> LazyLoad: yes
> >>> License: Proprietary
> >>> URL: http://www.maninvestments.com
> >>> LazyLoad: no
> >>>
> >>> ---- pack3: NAMESPACE ------
> >>> import(pack2)
> >>> exportPattern("^[^\\.]")
> >>>
> >>> ---- pack3: posix.R ------
> >>> testPosix2 = function() {
> >>>   z = as.POSIXct(testPosixVal)
> >>>   print(z)
> >>>   print(class(z))
> >>>   z
> >>> }
> >>>
> >>> Note, that the above function is the same as in pack2, just a
> >>> different
> >>> name.
> >>>
> >>>
> >>> *** R 2.9.0 (svn -r 46585)
> >> [/share/research/R-devel/20081002/lib64/R]
> >>> ***
> >>>> library(pack3)
> >>> Loading required package: pack2
> >>> Loading required package: pack1
> >>>> as.POSIXct(pack1::testPosixVal)
> >>> [1] "2009-01-13 15:29:50 UTC"
> >>>> testPosxi() ## called from pack2
> >>> [1] "2009-01-13 15:29:50 UTC"
> >>> [1] "POSIXt"  "POSIXct"
> >>> [1] "2009-01-13 15:29:50 UTC"
> >>>> testPosix2() ## called from pack3
> >>> Error in as.POSIXct.default(testPosixVal) :
> >>> do not know how to convert 'testPosixVal' to class "POSIXlt"
> >>>
> >>>
> >>>
> >>>
> >>> Dr Oleg Sklyar
> >>> Research Technologist
> >>> AHL / Man Investments Ltd
> >>> +44 (0)20 7144 3107
> >>> osklyar at maninvestments.com
> >>>
> >>>> -----Original Message-----
> >>>> From: Simon Urbanek [mailto:simon.urbanek at r-project.org]
> >>>> Sent: 14 January 2009 01:51
> >>>> To: Sklyar, Oleg (London)
> >>>> Cc: r-devel at r-project.org
> >>>> Subject: Re: [Rd] particulars of importing/loading libraries
> >>>>
> >>>> Oleg,
> >>>>
> >>>> On Jan 13, 2009, at 11:00 , Sklyar, Oleg (London) wrote:
> >>>>
> >>>>> Dear List:
> >>>>>
> >>>>> Sorry for posting maybe a trivial question, but I have a basic
> >>>>> understanding problem. If I have say pack1 and pack2, two R
> >>>> packages,
> >>>>> and pack2 depends on and imports pack1 fully (as in the
> >>>> code below),
> >>>>> is
> >>>>> there a way to make all the functionality of pack1
> >> available for the
> >>>>> global and other environments (not only for the functions
> >>>> called from
> >>>>> withing pack2) by loading pack2 only? I thought if pack2
> >>>> depends on
> >>>>> and
> >>>>> imports pack1 and essentially reexports everything, one
> >>>> should get the
> >>>>> full functionality simply by loading pack2. This does not
> >>>> seem to be
> >>>>> the
> >>>>> case or I am missing something trivial in my 
> NAMESPACE/DESCRIPTION
> >>>>> files?
> >>>>>
> >>>>> If this is documented in Writing R Extensions, I would 
> be thankful
> >>>>> for a
> >>>>> page number and maybe a quick fix in my example below as so
> >>>> far I have
> >>>>> not been able to find a clear explanation.
> >>>>>
> >>>>> The problem can be illustrated by the following simple
> >>>> example (this
> >>>>> is
> >>>>> a simple code for 2 packages, pack1 and pack2; plus an example).
> >>>>>
> >>>>
> >>>> if you bothered to use R CMD check you would find your bug right
> >>>> away:
> >>>> * checking package dependencies ... ERROR
> >>>> Namespace dependencies not required:
> >>>>  pack1
> >>>>
> >>>> You simply forgot to add pack1 to the Depends: line - that's
> >>>> all. Once
> >>>> you fix that, you'll see what happens:
> >>>>
> >>>>> library(pack2)
> >>>> Loading required package: pack1
> >>>>> as.POSIXct(pack1::testPosixVal)
> >>>> [1] "2009-01-14 01:38:08 UTC"
> >>>>
> >>>> Cheers,
> >>>> S
> >>>>
> >>>>
> >>>>> Thank you for your replies.
> >>>>>
> >>>>> Dr Oleg Sklyar
> >>>>> Research Technologist
> >>>>> AHL / Man Investments Ltd
> >>>>> +44 (0)20 7144 3107
> >>>>> osklyar at maninvestments.com
> >>>>>
> >>>>> --- pack1: DESCRIPTION ------
> >>>>> Package: pack1
> >>>>> Version: 0.0.1
> >>>>> Date: 12 Jan 2009
> >>>>> Title: pack1 to test S3/S4 methods compatibility
> >>>>> Author:  Oleg Sklyar
> >>>>> Depends: R (>= 2.7.1), methods
> >>>>> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
> >>>>> Description: pack1
> >>>>> LazyLoad: yes
> >>>>> License: Proprietary
> >>>>> URL: http://www.maninvestments.com
> >>>>> LazyLoad: no
> >>>>>
> >>>>> --- pack1: NAMESPACE ------
> >>>>> import(methods)
> >>>>> exportPattern("^[^\\.]")
> >>>>> exportClasses(posixTime)
> >>>>> exportMethods(as.POSIXct)
> >>>>>
> >>>>> --- pack1: posix.R ------
> >>>>> setClass("posixTime", "numeric")
> >>>>>
> >>>>> setGeneric("as.POSIXct")
> >>>>> setMethod("as.POSIXct", signature(x="posixTime"),
> >>>>>  function(x, tz) {
> >>>>>      z = x at .Data
> >>>>>      attr(z,"class") = c("POSIXt", "POSIXct")
> >>>>>      attr(z,"tzone") = "UTC"
> >>>>>      z
> >>>>>  }
> >>>>> )
> >>>>>
> >>>>> testPosixVal = new("posixTime", as.numeric(Sys.time()))
> >>>>>
> >>>>> --- pack2: DESCRIPTION
> >>>>> Package: pack2
> >>>>> Version: 0.0.1
> >>>>> Date: 12 Jan 2009
> >>>>> Title: pack2 to test S3/S4 methods compatibility
> >>>>> Author:  Oleg Sklyar
> >>>>> Depends: R (>= 2.7.1), methods
> >>>>> Maintainer: Oleg Sklyar <osklyar at maninvestments.com>
> >>>>> Description: pack2
> >>>>> LazyLoad: yes
> >>>>> License: Proprietary
> >>>>> URL: http://www.maninvestments.com
> >>>>> LazyLoad: no
> >>>>>
> >>>>> --- pack2: NAMESPACE ------
> >>>>> import(pack1)
> >>>>> exportPattern("^[^\\.]")
> >>>>>
> >>>>> --- pack2: posix.R ------
> >>>>> testPosix = function() {
> >>>>>  z = as.POSIXct(testPosixVal)
> >>>>>  print(z)
> >>>>>  print(class(z))
> >>>>>  z
> >>>>> }
> >>>>>
> >>>>> ------ test code to run from global env, showing 
> problems -------
> >>>>> require(pack2)
> >>>>>
> >>>>> ## use as.POSIXct imported into pack2 from pack1 to do the
> >>>>> conversion in
> >>>>> the fun
> >>>>> testPosix()
> >>>>> #~ [1] "2009-01-13 15:29:50 UTC"
> >>>>> #~ [1] "POSIXt"  "POSIXct"
> >>>>> #~ [1] "2009-01-13 15:29:50 UTC"
> >>>>>
> >>>>> ## now try using it directly from the global env (pack1 was not
> >>>>> explicitly loaded)
> >>>>> as.POSIXct(pack1::testPosixVal)
> >>>>> #~ Error in as.POSIXct.default(pack1::testPosixVal) :
> >>>>> #~  do not know how to convert 'pack1::testPosixVal' to class
> >>>>> "POSIXlt"
> >>>>>
> >>>>> ## now require pack1 explicitly and try again
> >>>>> require(pack1)
> >>>>> as.POSIXct(pack1::testPosixVal)
> >>>>> #~ [1] "2009-01-13 15:29:50 UTC"
> >>>>>
> >>>>>
> >>>>>
> >>>>
> >> 
> **********************************************************************
> >>>>> Please consider the environment before printing this 
> email or its
> >>>>> attachments.
> >>>>> The contents of this email are for the named addressees
> >>>> ...{{dropped:
> >>>>> 19}}
> >>>>>
> >>>>> ______________________________________________
> >>>>> R-devel at r-project.org mailing list
> >>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>>>>
> >>>>>
> >>>>
> >>>>
> >>>
> >>>
> >> 
> **********************************************************************
> >>> Please consider the environment before printing this email or its
> >>> attachments.
> >>> The contents of this email are for the named addressees only.  It
> >>> contains information which may be confidential and privileged.  If
> >>> you are not the intended recipient, please notify the sender
> >>> immediately, destroy this email and any attachments and do not
> >>> otherwise disclose or use them. Email transmission is not a secure
> >>> method of communication and Man Investments cannot accept
> >>> responsibility for the completeness or accuracy of this
> >> email or any
> >>> attachments. Whilst Man Investments makes every effort to keep its
> >>> network free from viruses, it does not accept
> >> responsibility for any
> >>> computer virus which might be transferred by way of this email or
> >>> any attachments. This email does not constitute a request, offer,
> >>> recommendation or solicitation of any kind to buy, subscribe, sell
> >>> or redeem any investment instruments or to perform other such
> >>> transactions of any kind. Man Investments reserves the right to
> >>> monitor, record and retain all electronic communications
> >> through its
> >>> network to ensure the integrity of its systems, for record keeping
> >>> and regulatory purposes.
> >>> Visit us at: www.maninvestments.com
> >>> TG0908
> >>>
> >> 
> **********************************************************************
> >>>
> >>>
> >>
> >>
> >
> >
> 
> 


From pdevalpine at berkeley.edu  Wed Jan 14 20:53:17 2009
From: pdevalpine at berkeley.edu (Perry de Valpine)
Date: Wed, 14 Jan 2009 11:53:17 -0800
Subject: [Rd] Documentation suggestions for vignettes
Message-ID: <EFB51359-7BF0-456B-AAEE-9AA9E401237E@berkeley.edu>

Dear R-devel,

I am putting together a package vignette for the first time (R 2.8.1,
OS X) and had some bumps from section 1.4 ("Writing package
vignettes") of the "Writing R Extensions" document.  Here are
suggestions to clean up a few small documentation bugs (I think) and
omissions.  This is assuming that R is performing as intended and the
only gaps are in the documentation, not vice-versa.

The statement "Pointers from package help indices to the installed
documents are automatically created" made me think I could put a pdf
in inst/doc and it would automatically be treated as a vignette. When
I did R CMD BUILD and R CMD INSTALL, an index.html was created in
inst/doc (and my pdf was copied there) but it stated there are no
vignettes for this package, and R indeed could not find the vignette.
How about stating that index.html is needed and sticking in an example?
I eventually figured it out by looking at the grid package source.

But before I did that I tried putting my Rnw file in inst/doc to see
if I could get it recognized if R CMD BUILD was generating the pdf
itself.  For this method, section 1.4 states the index information is
generated "from the \VignetteIndexEntry statements" but gives no
example of the syntax for this (it takes one argument in curly braces
giving a description of the vignette) or the associated commands
(e.g. \VignettePackage{} and \VignetteDepends{}, as I find from the
grid source, and perhaps others?).  This made the documentation read
as if it would only make sense to someone who is already a seasoned
package developer. How about giving an example? After again emulating
the grid package source, the build and install worked beautifully and
index.html was generated correctly.

Clearly my bumps were due to climbing the learning curve, but some
cursory Googling and R help searching for further information to see
if I had missed something obvious did not yield much.

In summary, stating that an index.html is necessary if a vignette is
provided as a pdf, giving an example of its format, and giving an
example of %\VignetteIndexEntry{description} etc. might be helpful.
If these points are not mistaken and the appropriate person wants to
contact me directly I would be happy to redraft this brief section.

Thanks.
Perry de Valpine
University of California, Berkeley
Department of Environmental Science, Policy and Management


From hb at stat.berkeley.edu  Thu Jan 15 11:36:24 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Thu, 15 Jan 2009 02:36:24 -0800
Subject: [Rd] More intensive checking of R help files
In-Reply-To: <alpine.OSX.1.00.0901090906520.74847@tystie.local>
References: <alpine.OSX.1.00.0901090906520.74847@tystie.local>
Message-ID: <59d7961d0901150236y2b7cfb56hf85dc897d1a5b1e3@mail.gmail.com>

Hi,

this sounds all good.  One comment below:

On Fri, Jan 9, 2009 at 1:25 AM, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>
> We have been working on handling Rd (R help) files with R rather than Perl
> scripts.  As part of that work, Duncan has written a parser which has
> revealed many problems in package help files, and we have added its checks
> to 'R CMD check' in the R-devel version of R.
>
> You can see the results for CRAN packages as part of the daily check at
> http://cran.r-project.org/web/checks/check_summary.html: they will show up
> as 'WARN' in the first two columns: click on the link to see the details for
> the package you are interested in.
>
> The dialect of Rd markup for which the parser checks differs in some ways
> from that described previously: see
> http://developer.r-project.org/parseRd.pdf for a current description:
> however almost all the errors found are errors under the existing
> description in 'Writing R Extensions'.
>
> The main difference is that \code is in the new version intended for valid R
> code and not fragments of R code or other languages (such as SQL).  This
> means that quotes (' " `) must balance inside \code, and that can lead to
> run-on errors (so if a parse error is found, quoted strings extending over
> more than one line are reported). \samp and where appropriate \kbd,
> \command, \options ... provide possible alternatives.

Then what is the plan for all statements like:

\code{\link[lattice]{panel.xyplot}}

/Henrik

>
> Another issue is that it was never intended to allow fragments of LaTeX in
> Rd files, and these only worked in latex (rather than text or HTML)
> conversion. Not all of these are parse errors, but they often lead to
> warnings about 'unknown macros'.  Using \eqn{} would resolve almost all of
> these and lead to more readable help.
>
> The CRAN master will from now on be mentioning these warnings when handling
> submissions.
>
> It would be helpful if package maintainers could look at and fix the errors
> as soon as possible.
>
>
> Brian Ripley and Duncan Murdoch
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Thu Jan 15 11:45:23 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 15 Jan 2009 10:45:23 +0000 (GMT)
Subject: [Rd] More intensive checking of R help files
In-Reply-To: <59d7961d0901150236y2b7cfb56hf85dc897d1a5b1e3@mail.gmail.com>
References: <alpine.OSX.1.00.0901090906520.74847@tystie.local>
	<59d7961d0901150236y2b7cfb56hf85dc897d1a5b1e3@mail.gmail.com>
Message-ID: <alpine.LFD.2.00.0901151041500.21504@auk.stats.ox.ac.uk>

On Thu, 15 Jan 2009, Henrik Bengtsson wrote:

> Hi,
>
> this sounds all good.  One comment below:
>
> On Fri, Jan 9, 2009 at 1:25 AM, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>>
>> We have been working on handling Rd (R help) files with R rather than Perl
>> scripts.  As part of that work, Duncan has written a parser which has
>> revealed many problems in package help files, and we have added its checks
>> to 'R CMD check' in the R-devel version of R.
>>
>> You can see the results for CRAN packages as part of the daily check at
>> http://cran.r-project.org/web/checks/check_summary.html: they will show up
>> as 'WARN' in the first two columns: click on the link to see the details for
>> the package you are interested in.
>>
>> The dialect of Rd markup for which the parser checks differs in some ways
>> from that described previously: see
>> http://developer.r-project.org/parseRd.pdf for a current description:
>> however almost all the errors found are errors under the existing
>> description in 'Writing R Extensions'.
>>
>> The main difference is that \code is in the new version intended for valid R
>> code and not fragments of R code or other languages (such as SQL).  This
>> means that quotes (' " `) must balance inside \code, and that can lead to
>> run-on errors (so if a parse error is found, quoted strings extending over
>> more than one line are reported). \samp and where appropriate \kbd,
>> \command, \options ... provide possible alternatives.
>
> Then what is the plan for all statements like:
>
> \code{\link[lattice]{panel.xyplot}}

No plan, no change.  That is valid R code with markup.

And please do note that we gave you a reference to answer such 
questions from!



>
> /Henrik
>
>>
>> Another issue is that it was never intended to allow fragments of LaTeX in
>> Rd files, and these only worked in latex (rather than text or HTML)
>> conversion. Not all of these are parse errors, but they often lead to
>> warnings about 'unknown macros'.  Using \eqn{} would resolve almost all of
>> these and lead to more readable help.
>>
>> The CRAN master will from now on be mentioning these warnings when handling
>> submissions.
>>
>> It would be helpful if package maintainers could look at and fix the errors
>> as soon as possible.
>>
>>
>> Brian Ripley and Duncan Murdoch
>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ggrothendieck at gmail.com  Thu Jan 15 16:10:23 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 15 Jan 2009 10:10:23 -0500
Subject: [Rd] Documentation suggestions for vignettes
In-Reply-To: <EFB51359-7BF0-456B-AAEE-9AA9E401237E@berkeley.edu>
References: <EFB51359-7BF0-456B-AAEE-9AA9E401237E@berkeley.edu>
Message-ID: <971536df0901150710o4b6a19dapc8f62b596491ede3@mail.gmail.com>

On Wed, Jan 14, 2009 at 2:53 PM, Perry de Valpine
<pdevalpine at berkeley.edu> wrote:
> Dear R-devel,
>
> I am putting together a package vignette for the first time (R 2.8.1,
> OS X) and had some bumps from section 1.4 ("Writing package
> vignettes") of the "Writing R Extensions" document.  Here are
> suggestions to clean up a few small documentation bugs (I think) and
> omissions.  This is assuming that R is performing as intended and the
> only gaps are in the documentation, not vice-versa.
>
> The statement "Pointers from package help indices to the installed
> documents are automatically created" made me think I could put a pdf
> in inst/doc and it would automatically be treated as a vignette. When
> I did R CMD BUILD and R CMD INSTALL, an index.html was created in
> inst/doc (and my pdf was copied there) but it stated there are no
> vignettes for this package, and R indeed could not find the vignette.
> How about stating that index.html is needed and sticking in an example?
> I eventually figured it out by looking at the grid package source.

Could you please clarify this comment.  I could not find an index.html file
in the grid package source (R revision 47606 synced today):

C:\\R\src\library\grid>dir/s index.html
File Not Found


From plroebuck at mdanderson.org  Thu Jan 15 18:19:26 2009
From: plroebuck at mdanderson.org (Paul Roebuck)
Date: Thu, 15 Jan 2009 11:19:26 -0600 (CST)
Subject: [Rd] doc buglet / relist method
Message-ID: <Pine.OSF.4.58.0901151100450.220401@wotan.mdacc.tmc.edu>

Under Details section for relist:

objects into a vector representation.  \code{relist()}, it's methods and
                                                        ^^^^

* [GRAMMAR] Don't use apostrophes for possessive pronouns.


R version 2.7.2 (2008-08-25)
   -- and --
<https://svn.r-project.org/R/trunk/src/library/utils/man/relist.Rd>

----------------------------------------------------------
SIGSIG -- signature too long (core dumped)


From pdevalpine at berkeley.edu  Thu Jan 15 18:24:14 2009
From: pdevalpine at berkeley.edu (Perry de Valpine)
Date: Thu, 15 Jan 2009 09:24:14 -0800
Subject: [Rd] Documentation suggestions for vignettes
In-Reply-To: <971536df0901150710o4b6a19dapc8f62b596491ede3@mail.gmail.com>
References: <EFB51359-7BF0-456B-AAEE-9AA9E401237E@berkeley.edu>
	<971536df0901150710o4b6a19dapc8f62b596491ede3@mail.gmail.com>
Message-ID: <DBC4EAAA-63BC-4BA3-83B7-99DF1A61595C@berkeley.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090115/e4cab7c8/attachment.pl>

From pdevalpine at berkeley.edu  Thu Jan 15 18:37:18 2009
From: pdevalpine at berkeley.edu (Perry de Valpine)
Date: Thu, 15 Jan 2009 09:37:18 -0800
Subject: [Rd] Documentation suggestions for vignettes
In-Reply-To: <971536df0901150710o4b6a19dapc8f62b596491ede3@mail.gmail.com>
References: <EFB51359-7BF0-456B-AAEE-9AA9E401237E@berkeley.edu>
	<971536df0901150710o4b6a19dapc8f62b596491ede3@mail.gmail.com>
Message-ID: <2ED46E68-39E7-482C-A8D4-FE9063911726@berkeley.edu>

(Apologies for re-posting this from a few minutes ago.  My message  
was scrubbed and I hope I've done it right now...)

I am looking at the 2.8.1 source code in R-2.8.1/src/library/grid/ 
inst/doc, where there is an index.html (I am not at daily syncing  
level and hope that is not an issue in this case).  In this case the  
Snw files contain the %\VignetteIndexEntry and associated commands,  
so the index.html could have been generated by the package build (I  
see the pdfs, so I assume they were generated from the Snws by  
building the package. Should be I able to access a pre-build package  
source? That is not what is in R-2.8.1.tar.gz but may be what you  
have?).

To clarify: if I attempt to include a vignette by putting a pdf  
directly in inst/doc, then R CMD BUILD does copy the pdf to the built  
package but generates an index.html that says there are no vignettes,  
so R is blind to the vignette.  After seeing a correctly built  
index.html, I made a leap to think that if I include/modify the  
index.html to treat the pdf as a vignette, that might make R see it.   
However, I did not test this, and instead moved on to the Rnw method  
with %\VignetteIndexEntry.  For the direct pdf method, I don't know  
if R CMD BUILD is intended to generate an index.html that recognizes  
any pdfs present (i.e. the documentation is fine), or alternatively  
if the documentation should state more completely how to include a  
pdf directly as a vignette.  The latter was the premise of my earlier  
post.  Please let me know if that is confused or still not specific  
enough.  Thanks.

Perry


On Jan 15, 2009, at 7:10 AM, Gabor Grothendieck wrote:

> On Wed, Jan 14, 2009 at 2:53 PM, Perry de Valpine
> <pdevalpine at berkeley.edu> wrote:
>> Dear R-devel,
>>
>> I am putting together a package vignette for the first time (R 2.8.1,
>> OS X) and had some bumps from section 1.4 ("Writing package
>> vignettes") of the "Writing R Extensions" document.  Here are
>> suggestions to clean up a few small documentation bugs (I think) and
>> omissions.  This is assuming that R is performing as intended and the
>> only gaps are in the documentation, not vice-versa.
>>
>> The statement "Pointers from package help indices to the installed
>> documents are automatically created" made me think I could put a pdf
>> in inst/doc and it would automatically be treated as a vignette. When
>> I did R CMD BUILD and R CMD INSTALL, an index.html was created in
>> inst/doc (and my pdf was copied there) but it stated there are no
>> vignettes for this package, and R indeed could not find the vignette.
>> How about stating that index.html is needed and sticking in an  
>> example?
>> I eventually figured it out by looking at the grid package source.
>
> Could you please clarify this comment.  I could not find an  
> index.html file
> in the grid package source (R revision 47606 synced today):
>
> C:\\R\src\library\grid>dir/s index.html
> File Not Found


From ggrothendieck at gmail.com  Thu Jan 15 18:47:48 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 15 Jan 2009 12:47:48 -0500
Subject: [Rd] Documentation suggestions for vignettes
In-Reply-To: <DBC4EAAA-63BC-4BA3-83B7-99DF1A61595C@berkeley.edu>
References: <EFB51359-7BF0-456B-AAEE-9AA9E401237E@berkeley.edu>
	<971536df0901150710o4b6a19dapc8f62b596491ede3@mail.gmail.com>
	<DBC4EAAA-63BC-4BA3-83B7-99DF1A61595C@berkeley.edu>
Message-ID: <971536df0901150947sf26df16tdff0efb995e3b797@mail.gmail.com>

The source tree is at:
    https://svn.r-project.org/R/trunk
and the src/library/grid subdirectory holds grid.
To check out a copy using svn see the "svn checkout ..."
command described here:
    http://developer.r-project.org/

On Thu, Jan 15, 2009 at 12:24 PM, Perry de Valpine
<pdevalpine at berkeley.edu> wrote:
> I am looking at the 2.8.1 source code in R-2.8.1/src/library/grid/inst/doc,
> where there is an index.html (I am not at daily syncing level and hope that
> is not an issue in this case).  In this case the Snw files contain
> the %\VignetteIndexEntry and associated commands, so the index.html could
> have been generated by the package build (I see the pdfs, so I assume they
> were generated from the Snws by building the package. Should be I able to
> access a pre-build package source? That is not what is in R-2.8.1.tar.gz but
> may be what you have?).
> To clarify: if I attempt to include a vignette by putting a pdf directly in
> inst/doc, then R CMD BUILD does copy the pdf to the built package but
> generates an index.html that says there are no vignettes, so R is blind to
> the vignette.  After seeing a correctly built index.html, I made a leap to
> think that if I include/modify the index.html to treat the pdf as a
> vignette, that might make R see it.  However, I did not test this, and
> instead moved on to the Rnw method with %\VignetteIndexEntry.  For the
> direct pdf method, I don't know if R CMD BUILD is intended to generate an
> index.html that recognizes any pdfs present (i.e. the documentation is
> fine), or alternatively if the documentation should state more completely
> how to include a pdf directly as a vignette.  The latter was the premise of
> my earlier post.  Please let me know if that is confused or still not
> specific enough.  Thanks.
> Perry
>
>
> On Jan 15, 2009, at 7:10 AM, Gabor Grothendieck wrote:
>
> On Wed, Jan 14, 2009 at 2:53 PM, Perry de Valpine
> <pdevalpine at berkeley.edu> wrote:
>
> Dear R-devel,
> I am putting together a package vignette for the first time (R 2.8.1,
> OS X) and had some bumps from section 1.4 ("Writing package
> vignettes") of the "Writing R Extensions" document.  Here are
> suggestions to clean up a few small documentation bugs (I think) and
> omissions.  This is assuming that R is performing as intended and the
> only gaps are in the documentation, not vice-versa.
> The statement "Pointers from package help indices to the installed
> documents are automatically created" made me think I could put a pdf
> in inst/doc and it would automatically be treated as a vignette. When
> I did R CMD BUILD and R CMD INSTALL, an index.html was created in
> inst/doc (and my pdf was copied there) but it stated there are no
> vignettes for this package, and R indeed could not find the vignette.
> How about stating that index.html is needed and sticking in an example?
> I eventually figured it out by looking at the grid package source.
>
> Could you please clarify this comment.  I could not find an index.html file
> in the grid package source (R revision 47606 synced today):
> C:\\R\src\library\grid>dir/s index.html
> File Not Found
>


From plroebuck at mdanderson.org  Thu Jan 15 18:50:05 2009
From: plroebuck at mdanderson.org (Paul Roebuck)
Date: Thu, 15 Jan 2009 11:50:05 -0600 (CST)
Subject: [Rd] [Q] R CMD check signals error on code that works from UI
Message-ID: <Pine.OSF.4.58.0901151139290.220401@wotan.mdacc.tmc.edu>

Add the following to example section of a dot-Rd manpage:

## :WHY: The following kills R CMD check but runs fine on console.
foos <- c("aaa", "bbb", "ccc")
cat(sapply(foos,
           function(foo) {
               sprintf("name: %-18s upper: %s\n",
                       foo,
                       toupper(foo))
           }), sep="")


R CMD check <package> stops with error:

...
* checking examples ... ERROR
Running examples in '<package>-Ex.R' failed.
The error most likely occurred in:
   ...
>
> ## :WHY: The following kills R CMD check but runs fine on console.
> foos <- c("aaa", "bbb", "ccc")
> cat(sapply(foos,
+            function(foo) {
+                sprintf("name:
+                        foo,
+                        toupper(foo))
+            }), sep="")
+
+
+
+ cleanEx(); nameEx("sc80-registerNormalizationMethod")
Error: unexpected string constant in:
"
cleanEx(); nameEx(""
Execution halted


Yet on console, it provides the expected:

name: aaa                upper: AAA
name: bbb                upper: BBB
name: ccc                upper: CCC


How do I work around this for manpage?


----------------------------------------------------------
SIGSIG -- signature too long (core dumped)


From osklyar at maninvestments.com  Thu Jan 15 19:05:57 2009
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Thu, 15 Jan 2009 18:05:57 -0000
Subject: [Rd] [Q] R CMD check signals error on code that works from UI
In-Reply-To: <Pine.OSF.4.58.0901151139290.220401@wotan.mdacc.tmc.edu>
References: <Pine.OSF.4.58.0901151139290.220401@wotan.mdacc.tmc.edu>
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE43047DF59E@mildnpexmb01.maninvestments.ad.man.com>

Because there is a % sign, which is stripped out by LaTeX used to build
the help system as a comment. Just look at how your example code is
output -- the string is unterminated because the matching quote is
masked by % latex comment

Dr Oleg Sklyar
Research Technologist
AHL / Man Investments Ltd
+44 (0)20 7144 3107
osklyar at maninvestments.com 

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Paul Roebuck
> Sent: 15 January 2009 17:50
> To: R Development Mailing List
> Subject: [Rd] [Q] R CMD check signals error on code that works from UI
> 
> Add the following to example section of a dot-Rd manpage:
> 
> ## :WHY: The following kills R CMD check but runs fine on console.
> foos <- c("aaa", "bbb", "ccc")
> cat(sapply(foos,
>            function(foo) {
>                sprintf("name: %-18s upper: %s\n",
>                        foo,
>                        toupper(foo))
>            }), sep="")
> 
> 
> R CMD check <package> stops with error:
> 
> ...
> * checking examples ... ERROR
> Running examples in '<package>-Ex.R' failed.
> The error most likely occurred in:
>    ...
> >
> > ## :WHY: The following kills R CMD check but runs fine on console.
> > foos <- c("aaa", "bbb", "ccc")
> > cat(sapply(foos,
> +            function(foo) {
> +                sprintf("name:
> +                        foo,
> +                        toupper(foo))
> +            }), sep="")
> +
> +
> +
> + cleanEx(); nameEx("sc80-registerNormalizationMethod")
> Error: unexpected string constant in:
> "
> cleanEx(); nameEx(""
> Execution halted
> 
> 
> Yet on console, it provides the expected:
> 
> name: aaa                upper: AAA
> name: bbb                upper: BBB
> name: ccc                upper: CCC
> 
> 
> How do I work around this for manpage?
> 
> 
> ----------------------------------------------------------
> SIGSIG -- signature too long (core dumped)
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

**********************************************************************
Please consider the environment before printing this email or its attachments.
The contents of this email are for the named addressees ...{{dropped:19}}


From P.Dalgaard at biostat.ku.dk  Thu Jan 15 19:14:44 2009
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu, 15 Jan 2009 19:14:44 +0100
Subject: [Rd] [Q] R CMD check signals error on code that works from UI
In-Reply-To: <1A68FCB28DE72F4BA3B967E6506CCE43047DF59E@mildnpexmb01.maninvestments.ad.man.com>
References: <Pine.OSF.4.58.0901151139290.220401@wotan.mdacc.tmc.edu>
	<1A68FCB28DE72F4BA3B967E6506CCE43047DF59E@mildnpexmb01.maninvestments.ad.man.com>
Message-ID: <496F7D14.3060603@biostat.ku.dk>

Sklyar, Oleg (London) wrote:
> Because there is a % sign, which is stripped out by LaTeX used to build
> the help system as a comment. Just look at how your example code is
> output -- the string is unterminated because the matching quote is
> masked by % latex comment

Minor quibble: Actually, LaTeX is not used at this stage, but the Rd
format is LaTeX-like, and in particular uses the same "%" comment
character.

In any case, the fix is to excape the "%" as "\%", whenever you need one
in an Rd file, even inside code examples.

	-pd

>>> ## :WHY: The following kills R CMD check but runs fine on console.
>> foos <- c("aaa", "bbb", "ccc")
>> cat(sapply(foos,
>>            function(foo) {
>>                sprintf("name: %-18s upper: %s\n",
>>                        foo,
>>                        toupper(foo))
>>            }), sep="")
>

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From simon.urbanek at r-project.org  Thu Jan 15 19:27:59 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 15 Jan 2009 13:27:59 -0500
Subject: [Rd] Documentation suggestions for vignettes
In-Reply-To: <DBC4EAAA-63BC-4BA3-83B7-99DF1A61595C@berkeley.edu>
References: <EFB51359-7BF0-456B-AAEE-9AA9E401237E@berkeley.edu>
	<971536df0901150710o4b6a19dapc8f62b596491ede3@mail.gmail.com>
	<DBC4EAAA-63BC-4BA3-83B7-99DF1A61595C@berkeley.edu>
Message-ID: <B9D8FCB4-33CD-417F-ABDC-92862F2F58FE@r-project.org>


On Jan 15, 2009, at 12:24 , Perry de Valpine wrote:

> I am looking at the 2.8.1 source code in R-2.8.1/src/library/grid/
> inst/doc, where there is an index.html (I am not at daily syncing
> level and hope that is not an issue in this case).  In this case the
> Snw files contain the %\VignetteIndexEntry and associated commands,
> so the index.html could have been generated by the package build (I
> see the pdfs, so I assume they were generated from the Snws by
> building the package. Should be I able to access a pre-build package
> source? That is not what is in R-2.8.1.tar.gz but may be what you
> have?).
>
> To clarify: if I attempt to include a vignette by putting a pdf
> directly in inst/doc, then R CMD BUILD does copy the pdf to the built
> package but generates an index.html that says there are no vignettes,
> so R is blind to the vignette.

That statement is wrong in the first place. R doesn't care about  
index.html when looking for package vignettes - it's generated for the  
HTML help system only (from vignettes, really). Please read "1.4  
Writing package vignettes" in R-exts manual. Vignettes are only  
documents created with Sweave. Although you can add arbitrary  
documents to your package, those are not considered vignettes. If you  
have custom documents in inst/doc, you have to supply your own  
index.html (unless the default "look in ." makes you happy), because R  
creates an index file only for vignettes.

To address your original post: "Pointers from package help indices to  
the installed documents are automatically created" has nothing to do  
with vignettes (note that it's talking about documents, not  
vignettes). However, AFAICT it's no longer true (at least 00Index.dcf  
seems to be ignored), so that may need some clarification.

Cheers,
Simon


>  After seeing a correctly built
> index.html, I made a leap to think that if I include/modify the
> index.html to treat the pdf as a vignette, that might make R see it.
> However, I did not test this, and instead moved on to the Rnw method
> with %\VignetteIndexEntry.  For the direct pdf method, I don't know
> if R CMD BUILD is intended to generate an index.html that recognizes
> any pdfs present (i.e. the documentation is fine), or alternatively
> if the documentation should state more completely how to include a
> pdf directly as a vignette.  The latter was the premise of my earlier
> post.  Please let me know if that is confused or still not specific
> enough.  Thanks.
>
> Perry
>
>
> On Jan 15, 2009, at 7:10 AM, Gabor Grothendieck wrote:
>
>> On Wed, Jan 14, 2009 at 2:53 PM, Perry de Valpine
>> <pdevalpine at berkeley.edu> wrote:
>>> Dear R-devel,
>>>
>>> I am putting together a package vignette for the first time (R  
>>> 2.8.1,
>>> OS X) and had some bumps from section 1.4 ("Writing package
>>> vignettes") of the "Writing R Extensions" document.  Here are
>>> suggestions to clean up a few small documentation bugs (I think) and
>>> omissions.  This is assuming that R is performing as intended and  
>>> the
>>> only gaps are in the documentation, not vice-versa.
>>>
>>> The statement "Pointers from package help indices to the installed
>>> documents are automatically created" made me think I could put a pdf
>>> in inst/doc and it would automatically be treated as a vignette.  
>>> When
>>> I did R CMD BUILD and R CMD INSTALL, an index.html was created in
>>> inst/doc (and my pdf was copied there) but it stated there are no
>>> vignettes for this package, and R indeed could not find the  
>>> vignette.
>>> How about stating that index.html is needed and sticking in an
>>> example?
>>> I eventually figured it out by looking at the grid package source.
>>
>> Could you please clarify this comment.  I could not find an
>> index.html file
>> in the grid package source (R revision 47606 synced today):
>>
>> C:\\R\src\library\grid>dir/s index.html
>> File Not Found
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From ggrothendieck at gmail.com  Thu Jan 15 19:34:39 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 15 Jan 2009 13:34:39 -0500
Subject: [Rd] Documentation suggestions for vignettes
In-Reply-To: <B9D8FCB4-33CD-417F-ABDC-92862F2F58FE@r-project.org>
References: <EFB51359-7BF0-456B-AAEE-9AA9E401237E@berkeley.edu>
	<971536df0901150710o4b6a19dapc8f62b596491ede3@mail.gmail.com>
	<DBC4EAAA-63BC-4BA3-83B7-99DF1A61595C@berkeley.edu>
	<B9D8FCB4-33CD-417F-ABDC-92862F2F58FE@r-project.org>
Message-ID: <971536df0901151034w5ed37411gd15bf540ecdd188e@mail.gmail.com>

I find this very confusing too.

I would also sometimes like to include pdf's that were not generated from
Sweave and have them included in the package and listed in
library(help = mypackage) output as well as with clickable links
on the package's CRAN web page like vignettes are.


On Thu, Jan 15, 2009 at 1:27 PM, Simon Urbanek
<simon.urbanek at r-project.org> wrote:
>
> On Jan 15, 2009, at 12:24 , Perry de Valpine wrote:
>
>> I am looking at the 2.8.1 source code in R-2.8.1/src/library/grid/
>> inst/doc, where there is an index.html (I am not at daily syncing
>> level and hope that is not an issue in this case).  In this case the
>> Snw files contain the %\VignetteIndexEntry and associated commands,
>> so the index.html could have been generated by the package build (I
>> see the pdfs, so I assume they were generated from the Snws by
>> building the package. Should be I able to access a pre-build package
>> source? That is not what is in R-2.8.1.tar.gz but may be what you
>> have?).
>>
>> To clarify: if I attempt to include a vignette by putting a pdf
>> directly in inst/doc, then R CMD BUILD does copy the pdf to the built
>> package but generates an index.html that says there are no vignettes,
>> so R is blind to the vignette.
>
> That statement is wrong in the first place. R doesn't care about index.html
> when looking for package vignettes - it's generated for the HTML help system
> only (from vignettes, really). Please read "1.4 Writing package vignettes"
> in R-exts manual. Vignettes are only documents created with Sweave. Although
> you can add arbitrary documents to your package, those are not considered
> vignettes. If you have custom documents in inst/doc, you have to supply your
> own index.html (unless the default "look in ." makes you happy), because R
> creates an index file only for vignettes.
>
> To address your original post: "Pointers from package help indices to the
> installed documents are automatically created" has nothing to do with
> vignettes (note that it's talking about documents, not vignettes). However,
> AFAICT it's no longer true (at least 00Index.dcf seems to be ignored), so
> that may need some clarification.
>
> Cheers,
> Simon
>
>
>>  After seeing a correctly built
>> index.html, I made a leap to think that if I include/modify the
>> index.html to treat the pdf as a vignette, that might make R see it.
>> However, I did not test this, and instead moved on to the Rnw method
>> with %\VignetteIndexEntry.  For the direct pdf method, I don't know
>> if R CMD BUILD is intended to generate an index.html that recognizes
>> any pdfs present (i.e. the documentation is fine), or alternatively
>> if the documentation should state more completely how to include a
>> pdf directly as a vignette.  The latter was the premise of my earlier
>> post.  Please let me know if that is confused or still not specific
>> enough.  Thanks.
>>
>> Perry
>>
>>
>> On Jan 15, 2009, at 7:10 AM, Gabor Grothendieck wrote:
>>
>>> On Wed, Jan 14, 2009 at 2:53 PM, Perry de Valpine
>>> <pdevalpine at berkeley.edu> wrote:
>>>>
>>>> Dear R-devel,
>>>>
>>>> I am putting together a package vignette for the first time (R 2.8.1,
>>>> OS X) and had some bumps from section 1.4 ("Writing package
>>>> vignettes") of the "Writing R Extensions" document.  Here are
>>>> suggestions to clean up a few small documentation bugs (I think) and
>>>> omissions.  This is assuming that R is performing as intended and the
>>>> only gaps are in the documentation, not vice-versa.
>>>>
>>>> The statement "Pointers from package help indices to the installed
>>>> documents are automatically created" made me think I could put a pdf
>>>> in inst/doc and it would automatically be treated as a vignette. When
>>>> I did R CMD BUILD and R CMD INSTALL, an index.html was created in
>>>> inst/doc (and my pdf was copied there) but it stated there are no
>>>> vignettes for this package, and R indeed could not find the vignette.
>>>> How about stating that index.html is needed and sticking in an
>>>> example?
>>>> I eventually figured it out by looking at the grid package source.
>>>
>>> Could you please clarify this comment.  I could not find an
>>> index.html file
>>> in the grid package source (R revision 47606 synced today):
>>>
>>> C:\\R\src\library\grid>dir/s index.html
>>> File Not Found
>>
>>
>>        [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
>


From pdevalpine at berkeley.edu  Thu Jan 15 20:12:24 2009
From: pdevalpine at berkeley.edu (Perry de Valpine)
Date: Thu, 15 Jan 2009 11:12:24 -0800
Subject: [Rd] Documentation suggestions for vignettes
In-Reply-To: <971536df0901151034w5ed37411gd15bf540ecdd188e@mail.gmail.com>
References: <EFB51359-7BF0-456B-AAEE-9AA9E401237E@berkeley.edu>
	<971536df0901150710o4b6a19dapc8f62b596491ede3@mail.gmail.com>
	<DBC4EAAA-63BC-4BA3-83B7-99DF1A61595C@berkeley.edu>
	<B9D8FCB4-33CD-417F-ABDC-92862F2F58FE@r-project.org>
	<971536df0901151034w5ed37411gd15bf540ecdd188e@mail.gmail.com>
Message-ID: <599F0C87-73F2-4F50-88B4-4C38A4379676@berkeley.edu>

Thanks for the helpful replies.

Regarding the source: I  see that in ..../grid/inst/doc there are no  
pdfs and no index.html, so that confirms that index.html is generated  
by the \VignetteIndexEntry method using Snw/Rnw when the grid package  
is built.  That is helpful for me but not the main point of my posting.

To zoom out: the goal of my posting was to suggest that the "Writing  
package vignettes" (section 1.4) documentation could be improved with  
a few small changes that might smooth the way for future new package  
developers, and it is clear I misunderstood some aspects of what it  
was trying to say because, well, it is not completely clear to  
someone who is not already familiar with the details.  I received an  
off-list message confirming similar bumps from someone else when they  
tried making a vignette for the first time.

Now I understand that the "pointers from packages" statements did not  
refer to vignettes; I guess my confusion on that was that it appears  
in the first paragraph of the "Writing package vignettes" section,  
but I see the next paragraph should have set me straight.  At the  
least the point that the %\VignetteIndexEntry comment in section 1.4  
is obtuse and does not provide the reader with sufficient information  
of how to do this still seems valid.  The successful creation of  
index.html appeared from my explorations to go hand-in-hand with  
successful recognition by R that the vignette exists, but I see that  
it is for the HTML system only, and, again, I was left with some  
guesswork after reading section 1.4.

The R manuals are amazing and I many others are indebted to those who  
wrote them.  I remember seeing a posting at some point about the  
value of finding documentation bugs as well as code bugs, so when I  
saw that section 1.4 falls short of explaining how to easily and  
successfully set up a vignette (or include a pdf directly, which I  
now see is not a vignette), I thought I would point it out (and  
volunteer to help if I could, with help from one of the experts).   
Undoubtedly the section makes perfect sense to someone who already  
knows all the details, so it may be hard to see it from a newcomer's  
view.  I also recognize that the documentation can only be helpful to  
a point and people need to spend their own time digging into things,  
but I thought the totally unexplained %\VignetteIndexEntry was an  
obvious case where very few additional words would be a huge help,  
and perhaps a few of the other points that have arisen could also be  
easily clarified.

Thanks again.
Perry





On Jan 15, 2009, at 10:34 AM, Gabor Grothendieck wrote:

> I find this very confusing too.
>
> I would also sometimes like to include pdf's that were not  
> generated from
> Sweave and have them included in the package and listed in
> library(help = mypackage) output as well as with clickable links
> on the package's CRAN web page like vignettes are.
>
>
> On Thu, Jan 15, 2009 at 1:27 PM, Simon Urbanek
> <simon.urbanek at r-project.org> wrote:
>>
>> On Jan 15, 2009, at 12:24 , Perry de Valpine wrote:
>>
>>> I am looking at the 2.8.1 source code in R-2.8.1/src/library/grid/
>>> inst/doc, where there is an index.html (I am not at daily syncing
>>> level and hope that is not an issue in this case).  In this case the
>>> Snw files contain the %\VignetteIndexEntry and associated commands,
>>> so the index.html could have been generated by the package build (I
>>> see the pdfs, so I assume they were generated from the Snws by
>>> building the package. Should be I able to access a pre-build package
>>> source? That is not what is in R-2.8.1.tar.gz but may be what you
>>> have?).
>>>
>>> To clarify: if I attempt to include a vignette by putting a pdf
>>> directly in inst/doc, then R CMD BUILD does copy the pdf to the  
>>> built
>>> package but generates an index.html that says there are no  
>>> vignettes,
>>> so R is blind to the vignette.
>>
>> That statement is wrong in the first place. R doesn't care about  
>> index.html
>> when looking for package vignettes - it's generated for the HTML  
>> help system
>> only (from vignettes, really). Please read "1.4 Writing package  
>> vignettes"
>> in R-exts manual. Vignettes are only documents created with  
>> Sweave. Although
>> you can add arbitrary documents to your package, those are not  
>> considered
>> vignettes. If you have custom documents in inst/doc, you have to  
>> supply your
>> own index.html (unless the default "look in ." makes you happy),  
>> because R
>> creates an index file only for vignettes.
>>
>> To address your original post: "Pointers from package help indices  
>> to the
>> installed documents are automatically created" has nothing to do with
>> vignettes (note that it's talking about documents, not vignettes).  
>> However,
>> AFAICT it's no longer true (at least 00Index.dcf seems to be  
>> ignored), so
>> that may need some clarification.
>>
>> Cheers,
>> Simon
>>
>>
>>>  After seeing a correctly built
>>> index.html, I made a leap to think that if I include/modify the
>>> index.html to treat the pdf as a vignette, that might make R see it.
>>> However, I did not test this, and instead moved on to the Rnw method
>>> with %\VignetteIndexEntry.  For the direct pdf method, I don't know
>>> if R CMD BUILD is intended to generate an index.html that recognizes
>>> any pdfs present (i.e. the documentation is fine), or alternatively
>>> if the documentation should state more completely how to include a
>>> pdf directly as a vignette.  The latter was the premise of my  
>>> earlier
>>> post.  Please let me know if that is confused or still not specific
>>> enough.  Thanks.
>>>
>>> Perry
>>>
>>>
>>> On Jan 15, 2009, at 7:10 AM, Gabor Grothendieck wrote:
>>>
>>>> On Wed, Jan 14, 2009 at 2:53 PM, Perry de Valpine
>>>> <pdevalpine at berkeley.edu> wrote:
>>>>>
>>>>> Dear R-devel,
>>>>>
>>>>> I am putting together a package vignette for the first time (R  
>>>>> 2.8.1,
>>>>> OS X) and had some bumps from section 1.4 ("Writing package
>>>>> vignettes") of the "Writing R Extensions" document.  Here are
>>>>> suggestions to clean up a few small documentation bugs (I  
>>>>> think) and
>>>>> omissions.  This is assuming that R is performing as intended  
>>>>> and the
>>>>> only gaps are in the documentation, not vice-versa.
>>>>>
>>>>> The statement "Pointers from package help indices to the installed
>>>>> documents are automatically created" made me think I could put  
>>>>> a pdf
>>>>> in inst/doc and it would automatically be treated as a  
>>>>> vignette. When
>>>>> I did R CMD BUILD and R CMD INSTALL, an index.html was created in
>>>>> inst/doc (and my pdf was copied there) but it stated there are no
>>>>> vignettes for this package, and R indeed could not find the  
>>>>> vignette.
>>>>> How about stating that index.html is needed and sticking in an
>>>>> example?
>>>>> I eventually figured it out by looking at the grid package source.
>>>>
>>>> Could you please clarify this comment.  I could not find an
>>>> index.html file
>>>> in the grid package source (R revision 47606 synced today):
>>>>
>>>> C:\\R\src\library\grid>dir/s index.html
>>>> File Not Found
>>>
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
>>


From felix at nfrac.org  Fri Jan 16 07:07:43 2009
From: felix at nfrac.org (Felix Andrews)
Date: Fri, 16 Jan 2009 17:07:43 +1100
Subject: [Rd] interrupting R from a GUI
Message-ID: <94730b8a0901152207n4499c4e3n4352840334f025eb@mail.gmail.com>

list(...),

I am looking for a way to interrupt R from a callback: specifically,
to interrupt plotting (typically on a cairoDevice, but would be good
if it worked with other devices too). Of course, one can interrupt R
nicely from the console with Ctrl-C (or Esc in Rgui), but I need to do
it from a GUI. Callbacks run in a new thread, so obviously stop() etc
will not work. I tried to look into how Rgui does it...
https://svn.r-project.org/R/trunk/src/gnuwin32/psignal.c
?...but it is beyond me.

Alternatively, might there be a way to tell the cairoDevice widget to
stop drawing, somehow?

Any help would be appreciated.

-Felix

-- 
Felix Andrews / ???
http://www.neurofractal.org/felix/
3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8


From ripley at stats.ox.ac.uk  Fri Jan 16 08:07:25 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 16 Jan 2009 07:07:25 +0000 (GMT)
Subject: [Rd] interrupting R from a GUI
In-Reply-To: <94730b8a0901152207n4499c4e3n4352840334f025eb@mail.gmail.com>
References: <94730b8a0901152207n4499c4e3n4352840334f025eb@mail.gmail.com>
Message-ID: <alpine.OSX.1.00.0901160612480.65436@tystie.local>

On Fri, 16 Jan 2009, Felix Andrews wrote:

> list(...),
>
> I am looking for a way to interrupt R from a callback: specifically,
> to interrupt plotting (typically on a cairoDevice, but would be good
> if it worked with other devices too). Of course, one can interrupt R
> nicely from the console with Ctrl-C (or Esc in Rgui), but I need to do
> it from a GUI. Callbacks run in a new thread, so obviously stop() etc
> will not work. I tried to look into how Rgui does it...
> https://svn.r-project.org/R/trunk/src/gnuwin32/psignal.c

Actually no, Rgui does not use that code (but Rterm does).

> ?...but it is beyond me.

In detail this is OS-specific, but what the front-ends do is to set a 
flag or send a signal to R: look e.g. at rterm.c:

static void my_onintr(int nSig)
{
   UserBreak = 1;
   PostThreadMessage(mainThreadId,0,0,0);
}

or onintr in errors.c (which is called when UserBreak = 1, from the 
ain thread).  In due course R_interrupts_pending gets set and then at 
an appropriate spot R stops and unwinds the currrent evaluations.

The relevant Windows code is even in 'Writing R Extensions'.

So depending on your OS you can raise a signal or set a flag.  You can 
raise a signal on Windows too, so 'raise' is the most portable 
solution -- but beware that threading models differ.

> Alternatively, might there be a way to tell the cairoDevice widget to
> stop drawing, somehow?

Why not ask its author?

> Any help would be appreciated.
>
> -Felix
>
> --
> Felix Andrews / ???
> http://www.neurofractal.org/felix/

[Those seeking technical advice will increase their chances of help by 
giving their affiliation(s) or at least explaining the purpose of the 
request so that potential helpers know it is non-commercial.  You may 
not get the benefit of the doubt next time.]

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/?ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From alexios at 4dscape.com  Wed Jan 14 19:30:16 2009
From: alexios at 4dscape.com (alexios at 4dscape.com)
Date: Wed, 14 Jan 2009 19:30:16 +0100 (CET)
Subject: [Rd] script window background and text color (PR#13446)
Message-ID: <20090114183016.5FDC5282EFF8@mail.pubhealth.ku.dk>

Full_Name: alexios galanos
Version: 2.8.1
OS: windows/vista
Submission from: (NULL) (81.100.160.71)


While the script editor now respects user preferences for the background color
in 2.8.1, it does not do so for the user text color defaulting to black. So my
preference of having for example black background with green text fails (it is
all black) in the script editor (the console is ok).


From henrik.parn at bio.ntnu.no  Thu Jan 15 09:59:31 2009
From: henrik.parn at bio.ntnu.no (Henrik Parn)
Date: Thu, 15 Jan 2009 09:59:31 +0100
Subject: [Rd] help text for ave()
Message-ID: <496EFAF3.1010607@bio.ntnu.no>

Dear R developers,

In the help text for ave() you can read in Arguments section:

"... Grouping variables, typically factors, all of the same length as x"

...and in Value: "If ... is g1,g2,".

I think a description in the Arguments section of how two or more 
grouping variables is specified together with an Example would be very 
helpful.

In absence of a help text I just tried if the equivalent specification 
in tapply would work:

data(warpbreaks)
str(warpbreaks)
'data.frame':   54 obs. of  3 variables:
  $ breaks : num  26 30 54 25 70 52 51 26 67 18 ...
  $ wool   : Factor w/ 2 levels "A","B": 1 1 1 1 1 1 1 1 1 1 ...
  $ tension: Factor w/ 3 levels "L","M","H": 1 1 1 1 1 1 1 1 1 2 ...

ave(x = breaks, list(wool, tension), FUN = median)

Is this THE way to specify two or more grouping variables in ave()? If 
yes, maybe it could be used as an example.


Thank you all for your great work developing R!


-- 
Henrik P?rn
Centre for Conservation Biology
Department of Biology
Norwegian University of Science and Technology
NO-7491 Trondheim
Norway

Office: +47 73596285
Fax: +47 73596100
Mobile: +47 90989255

E-mail: henrik.parn at bio.ntnu.no


From maechler at stat.math.ethz.ch  Fri Jan 16 15:52:04 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 16 Jan 2009 15:52:04 +0100
Subject: [Rd] x <- 1:2; dim(x) <- 2? A vector or not?
In-Reply-To: <496CC8B8.6060606@pburns.seanet.com>
References: <59d7961d0901121243j6c5c0fcn5836d94a90666623@mail.gmail.com>
	<alpine.OSX.1.00.0901130744310.32363@tystie.local>
	<59d7961d0901130754j335c480fi673346cd20e031e@mail.gmail.com>
	<496CC8B8.6060606@pburns.seanet.com>
Message-ID: <18800.40724.985949.449350@stat.math.ethz.ch>

>>>>> "PatB" == Patrick Burns <pburns at pburns.seanet.com>
>>>>>     on Tue, 13 Jan 2009 17:00:40 +0000 writes:

    PatB> Henrik Bengtsson wrote:
    >> Hi.
    >> 
    >> On Mon, Jan 12, 2009 at 11:58 PM, Prof Brian Ripley
    >> <ripley at stats.ox.ac.uk> wrote:
    >> 
    >>> What you have is a one-dimensional array: they crop up
    >>> in R most often from table() in my experience.
    >>> 
    >>> 
    >>>> f <- table(rpois(100, 4)) str(f)
    >>>> 
    >>> 'table' int [, 1:10] 2 6 18 21 13 16 13 4 3 4 - attr(*,
    >>> "dimnames")=List of 1 ..$ : chr [1:10] "0" "1" "2" "3"
    >>> ...
    >>> 
    >>> and yes, f is an atmoic vector and yes, str()'s notation
    >>> is confusing here but if it did [1:10] you would not
    >>> know it was an array.  I recall discussing this with
    >>> Martin Maechler (str's author) last century, and I've
    >>> just checked that R 2.0.0 did the same.
    >>> 
    >>> The place in which one-dimensional arrays differ from
    >>> normal vectors is how names are handled: notice that my
    >>> example has dimnames not names, and ?names says
    >>> 
    >>> For a one-dimensional array the 'names' attribute really
    >>> is 'dimnames[[1]]'.
    >>> 
    >> 
    >> Thanks for this explanation.  One could then argue that
    >> [1:10,] is somewhat better than [,1:10], but that is just polish.

yes.  And honestly I don't remember anymore why I chose the
"[,1:n]" notation.  It definitely was there already before R
came into existence, as  S  also has had one-dimensional arrays,
and I programmed the first version of str() in 1990.

    PatB> Perhaps it could be:

    PatB> [1:10(,)]

    PatB> That is weird enough that it should not lead people to
    PatB> believe that it is a matrix.  But might prompt them a
    PatB> bit in that direction.

Well, str() was always aimed a bit at experienced S (and R)
users, and I had always aimed somewhat to keep it's output
"compact".  I'm quite astonished that the OP didn't know about
1D arrays in spite of the many years he's been using R.
Would a wierd solution like the above have helped?

At the moment, I'd tend to keep it "as is" if only just for
historical reminescence, but I can be convinced to change the
current "tendency" ... 

Martin Maechler, ETH Zurich  



    PatB> Patrick Burns patrick at burns-stat.com +44 (0)20 8525
    PatB> 0696 http://www.burns-stat.com (home of "The R
    PatB> Inferno" and "A Guide for the Unwilling S User")
    >> /Henrik
    >> 
    >> 
    >>> I think these days we have enough internal glue in place
    >>> that an end user would not notice the difference (but
    >>> those working at C level with R objects may need to
    >>> know).
    >>> 
    >>> On Mon, 12 Jan 2009, Henrik Bengtsson wrote:
    >>> 
    >>> 
    >>>> Ran into the follow intermediate case in an external
    >>>> package (w/ recent R v2.8.1 patched and R v2.9.0
    >>>> devel):
    >>>> 
    >>>> 
    >>>>> x <- 1:2 dim(x) <- 2 dim(x)
    >>>>> 
    >>>> [1] 2
    >>>> 
    >>>>> x
    >>>>> 
    >>>> [1] 1 2
    >>>> 
    >>>>> str(x)
    >>>>> 
    >>>> int [, 1:2] 1 2
    >>>> 
    >>>>> nrow(x)
    >>>>> 
    >>>> [1] 2
    >>>> 
    >>>>> ncol(x)
    >>>>> 
    >>>> [1] NA
    >>>> 
    >>>>> is.vector(x)
    >>>>> 
    >>>> [1] FALSE
    >>>> 
    >>>>> is.matrix(x)
    >>>>> 
    >>>> [1] FALSE
    >>>> 
    >>>>> is.array(x)
    >>>>> 
    >>>> [1] TRUE
    >>>> 
    >>>>> x[1]
    >>>>> 
    >>>> [1] 1
    >>>> 
    >>>>> x[,1]
    >>>>> 
    >>>> Error in x[, 1] : incorrect number of dimensions
    >>>> 
    >>>>> x[1,]
    >>>>> 
    >>>> Error in x[1, ] : incorrect number of dimensions
    >>>> 
    >>>> Is str() treating single-dimension arrays incorrectly?
    >>>> 
    >>>> What does it mean to have a single dimension this way?
    >>>> Should it equal a vector?  I am aware of "is.vector
    >>>> returns FALSE if x has any attributes except names".
    >>>> 
    >>>> /Henrik
    >>>> 
    >>>> ______________________________________________
    >>>> R-devel at r-project.org mailing list
    >>>> https://stat.ethz.ch/mailman/listinfo/r-devel
    >>>> 
    >>>> 
    >>> --
>> Brian D. Ripley, ripley at stats.ox.ac.uk Professor of Applied
    >>> Statistics, http://www.stats.ox.ac.uk/~ripley/
    >>> University of Oxford, Tel: +44 1865 272861 (self) 1
    >>> South Parks Road, +44 1865 272866 (PA) Oxford OX1 3TG,
    >>> UK Fax: +44 1865 272595
    >>> 
    >>> ______________________________________________
    >>> R-devel at r-project.org mailing list
    >>> https://stat.ethz.ch/mailman/listinfo/r-devel
    >>> 
    >>> 
    >> 
> ______________________________________________
    >> R-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 
    >> 
    >> 

______________________________________________
    PatB> R-devel at r-project.org mailing list
    PatB> https://stat.ethz.ch/mailman/listinfo/r-devel


From tplate at acm.org  Fri Jan 16 21:10:04 2009
From: tplate at acm.org (Tony Plate)
Date: Fri, 16 Jan 2009 13:10:04 -0700
Subject: [Rd] x <- 1:2; dim(x) <- 2? A vector or not?
In-Reply-To: <18800.40724.985949.449350@stat.math.ethz.ch>
References: <59d7961d0901121243j6c5c0fcn5836d94a90666623@mail.gmail.com>	<alpine.OSX.1.00.0901130744310.32363@tystie.local>	<59d7961d0901130754j335c480fi673346cd20e031e@mail.gmail.com>	<496CC8B8.6060606@pburns.seanet.com>
	<18800.40724.985949.449350@stat.math.ethz.ch>
Message-ID: <4970E99C.9040907@acm.org>

Martin Maechler wrote:
>>>>>> "PatB" == Patrick Burns <pburns at pburns.seanet.com>
>>>>>>     on Tue, 13 Jan 2009 17:00:40 +0000 writes:
>>>>>>             
>
>     PatB> Henrik Bengtsson wrote:
>     >> Hi.
>     >> 
>     >> On Mon, Jan 12, 2009 at 11:58 PM, Prof Brian Ripley
>     >> <ripley at stats.ox.ac.uk> wrote:
>     >> 
>     >>> What you have is a one-dimensional array: they crop up
>     >>> in R most often from table() in my experience.
>     >>> 
>     >>> 
>     >>>> f <- table(rpois(100, 4)) str(f)
>     >>>> 
>     >>> 'table' int [, 1:10] 2 6 18 21 13 16 13 4 3 4 - attr(*,
>     >>> "dimnames")=List of 1 ..$ : chr [1:10] "0" "1" "2" "3"
>     >>> ...
>     >>> 
>     >>> and yes, f is an atmoic vector and yes, str()'s notation
>     >>> is confusing here but if it did [1:10] you would not
>     >>> know it was an array.  I recall discussing this with
>     >>> Martin Maechler (str's author) last century, and I've
>     >>> just checked that R 2.0.0 did the same.
>     >>> 
>     >>> The place in which one-dimensional arrays differ from
>     >>> normal vectors is how names are handled: notice that my
>     >>> example has dimnames not names, and ?names says
>     >>> 
>     >>> For a one-dimensional array the 'names' attribute really
>     >>> is 'dimnames[[1]]'.
>     >>> 
>     >> 
>     >> Thanks for this explanation.  One could then argue that
>     >> [1:10,] is somewhat better than [,1:10], but that is just polish.
>
> yes.  And honestly I don't remember anymore why I chose the
> "[,1:n]" notation.  It definitely was there already before R
> came into existence, as  S  also has had one-dimensional arrays,
> and I programmed the first version of str() in 1990.
>
>     PatB> Perhaps it could be:
>
>     PatB> [1:10(,)]
>
>     PatB> That is weird enough that it should not lead people to
>     PatB> believe that it is a matrix.  But might prompt them a
>     PatB> bit in that direction.
>
> Well, str() was always aimed a bit at experienced S (and R)
> users, and I had always aimed somewhat to keep it's output
> "compact".  I'm quite astonished that the OP didn't know about
> 1D arrays in spite of the many years he's been using R.
> Would a wierd solution like the above have helped?
>
> At the moment, I'd tend to keep it "as is" if only just for
> historical reminescence, but I can be convinced to change the
> current "tendency" ... 
>
> Martin Maechler, ETH Zurich  
>   
What about just including "(1d-array)", something like this
 > str(f)
 'table' int [1:10](1d array) 5 5 9 23 26 16 9 4 2 1
 - attr(*, "dimnames")=List of 1
  ..$ : chr [1:10] "0" "1" "2" "3" ...
 >
only 9 extra characters for a rare case, and much, much less cryptic?

-- Tony Plate
>
>
>     PatB> Patrick Burns patrick at burns-stat.com +44 (0)20 8525
>     PatB> 0696 http://www.burns-stat.com (home of "The R
>     PatB> Inferno" and "A Guide for the Unwilling S User")
>     >> /Henrik
>     >> 
>     >> 
>     >>> I think these days we have enough internal glue in place
>     >>> that an end user would not notice the difference (but
>     >>> those working at C level with R objects may need to
>     >>> know).
>     >>> 
>     >>> On Mon, 12 Jan 2009, Henrik Bengtsson wrote:
>     >>> 
>     >>> 
>     >>>> Ran into the follow intermediate case in an external
>     >>>> package (w/ recent R v2.8.1 patched and R v2.9.0
>     >>>> devel):
>     >>>> 
>     >>>> 
>     >>>>> x <- 1:2 dim(x) <- 2 dim(x)
>     >>>>> 
>     >>>> [1] 2
>     >>>> 
>     >>>>> x
>     >>>>> 
>     >>>> [1] 1 2
>     >>>> 
>     >>>>> str(x)
>     >>>>> 
>     >>>> int [, 1:2] 1 2
>     >>>> 
>     >>>>> nrow(x)
>     >>>>> 
>     >>>> [1] 2
>     >>>> 
>     >>>>> ncol(x)
>     >>>>> 
>     >>>> [1] NA
>     >>>> 
>     >>>>> is.vector(x)
>     >>>>> 
>     >>>> [1] FALSE
>     >>>> 
>     >>>>> is.matrix(x)
>     >>>>> 
>     >>>> [1] FALSE
>     >>>> 
>     >>>>> is.array(x)
>     >>>>> 
>     >>>> [1] TRUE
>     >>>> 
>     >>>>> x[1]
>     >>>>> 
>     >>>> [1] 1
>     >>>> 
>     >>>>> x[,1]
>     >>>>> 
>     >>>> Error in x[, 1] : incorrect number of dimensions
>     >>>> 
>     >>>>> x[1,]
>     >>>>> 
>     >>>> Error in x[1, ] : incorrect number of dimensions
>     >>>> 
>     >>>> Is str() treating single-dimension arrays incorrectly?
>     >>>> 
>     >>>> What does it mean to have a single dimension this way?
>     >>>> Should it equal a vector?  I am aware of "is.vector
>     >>>> returns FALSE if x has any attributes except names".
>     >>>> 
>     >>>> /Henrik
>     >>>> 
>     >>>> ______________________________________________
>     >>>> R-devel at r-project.org mailing list
>     >>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>     >>>> 
>     >>>> 
>     >>> --
>   
>>> Brian D. Ripley, ripley at stats.ox.ac.uk Professor of Applied
>>>       
>     >>> Statistics, http://www.stats.ox.ac.uk/~ripley/
>     >>> University of Oxford, Tel: +44 1865 272861 (self) 1
>     >>> South Parks Road, +44 1865 272866 (PA) Oxford OX1 3TG,
>     >>> UK Fax: +44 1865 272595
>     >>> 
>     >>> ______________________________________________
>     >>> R-devel at r-project.org mailing list
>     >>> https://stat.ethz.ch/mailman/listinfo/r-devel
>     >>> 
>     >>> 
>     >> 
>   
>> ______________________________________________
>>     
>     >> R-devel at r-project.org mailing list
>     >> https://stat.ethz.ch/mailman/listinfo/r-devel
>     >> 
>     >> 
>     >> 
>
> ______________________________________________
>     PatB> R-devel at r-project.org mailing list
>     PatB> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From ggrothendieck at gmail.com  Sat Jan 17 02:57:02 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 16 Jan 2009 20:57:02 -0500
Subject: [Rd] 2009 Wish list for R
Message-ID: <971536df0901161757h5c7d68f3gec096466576d19e8@mail.gmail.com>

2009 Wish list for R (no particular order):

- some way of placing backslashes in literal strings without escaping them.
  Useful for latex, regular expressions and Windows file paths.  This seems
  to come up from time to time on the lists.  Ruby, python, Perl and other
  scripting languages have various ways to handle this which might be used
  as a model.

- in Windows, some way to tell Packages | Install menu to use
  dependencies = TRUE (vs. dependencies = NA now).
  NB. utils:::menuInstallPkgs is the R routine invoked

- self-contained R executables

- default origin in Date.  as.numeric.Date and as.Date.numeric are
  asymmetric in this respect.

- here documents in sourced input

- read.table(textConnection(Lines)) later gives annoying warning message
  about closing connection.  If too hard to fix add an asText= arg,
  e.g. read.table(Lines, asText=TRUE)

- View() buttons to copy to clipboard. (print and save might also be nice.)

- allow library() command to determine what is imported like python's
	  import ... from ...

- Lag < function(x, k, ...) lag(x, -k, ...)
  lag is regarded by many as confusing and this would give a second
  option while keeping lag for compatability.

- generic filter()

- add executable for filefind.cc in docs.miktex.org to R bin directory
  on Windows to give an easy way to locate MiKTeX.  Alternately
  put it in Rtools.

- real subclassing of environments

- ability to conditionally emit portions of a Sweave
document even if they represent both text and code
portions without using crude workarounds.  For
example if all the data for a certain figure is missing
that figure and the associated paragraphs describing
it and the R code shown associated with it could
all be suppressed dynamically.

- pfg TeX driver


From felix at nfrac.org  Sat Jan 17 06:55:33 2009
From: felix at nfrac.org (Felix Andrews)
Date: Sat, 17 Jan 2009 16:55:33 +1100
Subject: [Rd] interrupting R from a GUI
In-Reply-To: <alpine.OSX.1.00.0901160612480.65436@tystie.local>
References: <94730b8a0901152207n4499c4e3n4352840334f025eb@mail.gmail.com>
	<alpine.OSX.1.00.0901160612480.65436@tystie.local>
Message-ID: <94730b8a0901162155j34a539aw4ecbbe656c2bfc80@mail.gmail.com>

2009/1/16 Prof Brian Ripley <ripley at stats.ox.ac.uk>:
> On Fri, 16 Jan 2009, Felix Andrews wrote:
>
>> list(...),
>>
>> I am looking for a way to interrupt R from a callback: specifically,
>> to interrupt plotting (typically on a cairoDevice, but would be good
>> if it worked with other devices too). Of course, one can interrupt R
>> nicely from the console with Ctrl-C (or Esc in Rgui), but I need to do
>> it from a GUI. Callbacks run in a new thread, so obviously stop() etc
>> will not work. I tried to look into how Rgui does it...
>> https://svn.r-project.org/R/trunk/src/gnuwin32/psignal.c
>
> Actually no, Rgui does not use that code (but Rterm does).
>
>> ?...but it is beyond me.
>
> In detail this is OS-specific, but what the front-ends do is to set a flag
> or send a signal to R: look e.g. at rterm.c:
>
> static void my_onintr(int nSig)
> {
>  UserBreak = 1;
>  PostThreadMessage(mainThreadId,0,0,0);
> }
>
> or onintr in errors.c (which is called when UserBreak = 1, from the ain
> thread).  In due course R_interrupts_pending gets set and then at an
> appropriate spot R stops and unwinds the currrent evaluations.
>
> The relevant Windows code is even in 'Writing R Extensions'.
>
> So depending on your OS you can raise a signal or set a flag.  You can raise
> a signal on Windows too, so 'raise' is the most portable solution -- but
> beware that threading models differ.

Dear Professor Ripley,

Many thanks for your information-rich response.

I have not looked at serious C code before, so I find the R source
code quite confusing.

This is what I have come up with (as my package's src/interrupt.c):

#include <signal.h>

#ifdef WIN32
extern int UserBreak;
#endif

void do_interrupt(void)
{
#ifdef WIN32
    UserBreak = 1;
    //raise(SIGBREAK);
#else
    raise(SIGINT);
#endif
}

This seems to work under Rgui and Rterm on windows XP. I have not
tested it on linux or macOS. Does it look reasonable?


>
>> Any help would be appreciated.
>>
>> -Felix
>>
>> --
>> Felix Andrews / ???
>> http://www.neurofractal.org/felix/
>
> [Those seeking technical advice will increase their chances of help by
> giving their affiliation(s) or at least explaining the purpose of the
> request so that potential helpers know it is non-commercial.  You may not
> get the benefit of the doubt next time.]

Fair enough; this is for the playwith package, which is GPL'd, and
(sadly) has no commercial links or prospects. I am affiliated in
various ways with the Australian National University.


-- 
Felix Andrews / ???
http://www.neurofractal.org/felix/
3358 543D AAC6 22C2 D336  80D9 360B 72DD 3E4C F5D8


From sean.oriordain at gmail.com  Sat Jan 17 12:53:42 2009
From: sean.oriordain at gmail.com (Sean O'Riordain)
Date: Sat, 17 Jan 2009 11:53:42 +0000
Subject: [Rd] 2009 Wish list for R
In-Reply-To: <971536df0901161757h5c7d68f3gec096466576d19e8@mail.gmail.com>
References: <971536df0901161757h5c7d68f3gec096466576d19e8@mail.gmail.com>
Message-ID: <8ed68eed0901170353m6893cfc0o6a613d26eb153652@mail.gmail.com>

Can I add a windows specific wish please?  I'd like to be able to
double click on a word in the console and select it, rather than have
to manually select - silly I know but I'm constantly going back and
forth between R and other programs where I can do this and I still
haven't managed to train my hand not to double click words in R... :-)

Thanks R-Core!


On Sat, Jan 17, 2009 at 1:57 AM, Gabor Grothendieck
<ggrothendieck at gmail.com> wrote:
> 2009 Wish list for R (no particular order):
>
> - some way of placing backslashes in literal strings without escaping them.
>  Useful for latex, regular expressions and Windows file paths.  This seems
>  to come up from time to time on the lists.  Ruby, python, Perl and other
>  scripting languages have various ways to handle this which might be used
>  as a model.
>
> - in Windows, some way to tell Packages | Install menu to use
>  dependencies = TRUE (vs. dependencies = NA now).
>  NB. utils:::menuInstallPkgs is the R routine invoked
>
> - self-contained R executables
>
> - default origin in Date.  as.numeric.Date and as.Date.numeric are
>  asymmetric in this respect.
>
> - here documents in sourced input
>
> - read.table(textConnection(Lines)) later gives annoying warning message
>  about closing connection.  If too hard to fix add an asText= arg,
>  e.g. read.table(Lines, asText=TRUE)
>
> - View() buttons to copy to clipboard. (print and save might also be nice.)
>
> - allow library() command to determine what is imported like python's
>          import ... from ...
>
> - Lag < function(x, k, ...) lag(x, -k, ...)
>  lag is regarded by many as confusing and this would give a second
>  option while keeping lag for compatability.
>
> - generic filter()
>
> - add executable for filefind.cc in docs.miktex.org to R bin directory
>  on Windows to give an easy way to locate MiKTeX.  Alternately
>  put it in Rtools.
>
> - real subclassing of environments
>
> - ability to conditionally emit portions of a Sweave
> document even if they represent both text and code
> portions without using crude workarounds.  For
> example if all the data for a certain figure is missing
> that figure and the associated paragraphs describing
> it and the R code shown associated with it could
> all be suppressed dynamically.
>
> - pfg TeX driver
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From murdoch at stats.uwo.ca  Sat Jan 17 13:36:02 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 17 Jan 2009 07:36:02 -0500
Subject: [Rd] 2009 Wish list for R
In-Reply-To: <8ed68eed0901170353m6893cfc0o6a613d26eb153652@mail.gmail.com>
References: <971536df0901161757h5c7d68f3gec096466576d19e8@mail.gmail.com>
	<8ed68eed0901170353m6893cfc0o6a613d26eb153652@mail.gmail.com>
Message-ID: <4971D0B2.6020109@stats.uwo.ca>

On 17/01/2009 6:53 AM, Sean O'Riordain wrote:
> Can I add a windows specific wish please?  I'd like to be able to
> double click on a word in the console and select it, rather than have
> to manually select - silly I know but I'm constantly going back and
> forth between R and other programs where I can do this and I still
> haven't managed to train my hand not to double click words in R... :-)

Seems like a reasonable addition. Send me a patch, and I'll look it over.

Duncan Murdoch

> 
> Thanks R-Core!
> 
> 
> On Sat, Jan 17, 2009 at 1:57 AM, Gabor Grothendieck
> <ggrothendieck at gmail.com> wrote:
>> 2009 Wish list for R (no particular order):
>>
>> - some way of placing backslashes in literal strings without escaping them.
>>  Useful for latex, regular expressions and Windows file paths.  This seems
>>  to come up from time to time on the lists.  Ruby, python, Perl and other
>>  scripting languages have various ways to handle this which might be used
>>  as a model.
>>
>> - in Windows, some way to tell Packages | Install menu to use
>>  dependencies = TRUE (vs. dependencies = NA now).
>>  NB. utils:::menuInstallPkgs is the R routine invoked
>>
>> - self-contained R executables
>>
>> - default origin in Date.  as.numeric.Date and as.Date.numeric are
>>  asymmetric in this respect.
>>
>> - here documents in sourced input
>>
>> - read.table(textConnection(Lines)) later gives annoying warning message
>>  about closing connection.  If too hard to fix add an asText= arg,
>>  e.g. read.table(Lines, asText=TRUE)
>>
>> - View() buttons to copy to clipboard. (print and save might also be nice.)
>>
>> - allow library() command to determine what is imported like python's
>>          import ... from ...
>>
>> - Lag < function(x, k, ...) lag(x, -k, ...)
>>  lag is regarded by many as confusing and this would give a second
>>  option while keeping lag for compatability.
>>
>> - generic filter()
>>
>> - add executable for filefind.cc in docs.miktex.org to R bin directory
>>  on Windows to give an easy way to locate MiKTeX.  Alternately
>>  put it in Rtools.
>>
>> - real subclassing of environments
>>
>> - ability to conditionally emit portions of a Sweave
>> document even if they represent both text and code
>> portions without using crude workarounds.  For
>> example if all the data for a certain figure is missing
>> that figure and the associated paragraphs describing
>> it and the R code shown associated with it could
>> all be suppressed dynamically.
>>
>> - pfg TeX driver
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From savicky at cs.cas.cz  Sat Jan 17 16:19:50 2009
From: savicky at cs.cas.cz (savicky at cs.cas.cz)
Date: Sat, 17 Jan 2009 16:19:50 +0100
Subject: [Rd] bug in cor.test(method = "spearman")
Message-ID: <20090117151950.GA9473@cs.cas.cz>

Dear R developers:

There is a possible bug in calculating the p-value
for Spearman's rank correlation.

Line 155 in file
  R-patched/src/library/stats/R/cor.test.R
is
     as.double(round(q) + lower.tail),
I think, it should be
     as.double(round(q) + 2*lower.tail),

The reason is that round(q) is expected to be an even number
(the S statistic), so the next feasible value is round(q)+2.

For demonstrating the effect, consider the code

  x <- 1:17
  y <- c(8:12,1:7,13:17)
  out1 <- cor.test(x,y,method="spearman")
  out2 <- cor.test(x,rev(y),method="spearman")
  rbind(
    c(out1$statistic, out1$estimate, p.val=out1$p.value),
    c(out2$statistic, out2$estimate, p.val=out2$p.value))

Output in R version 2.8.1 Patched (2009-01-16 r47630) is

          S        rho      p.val
  [1,]  420  0.4852941 0.04968029
  [2,] 1212 -0.4852941 0.05032193

After correction

          S        rho      p.val
  [1,]  420  0.4852941 0.05032193
  [2,] 1212 -0.4852941 0.05032193

Since 420 and 1212 are symmetric around n*(n^2-1)/6 = 816, the
correlation rho has the opposite value (this is correct) and
p-values should be the same (this is wrong before correction).

The exact p-value for n = 17 and S = 420 in 7 digit precision
is 0.05030371. Hence, the corrected value not only satisfies
symmetricity, but is indeed more accurate.

All the best, Petr.


From maechler at stat.math.ethz.ch  Sat Jan 17 22:27:45 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 17 Jan 2009 22:27:45 +0100
Subject: [Rd] x <- 1:2; dim(x) <- 2? A vector or not?
In-Reply-To: <4970E99C.9040907@acm.org>
References: <59d7961d0901121243j6c5c0fcn5836d94a90666623@mail.gmail.com>
	<alpine.OSX.1.00.0901130744310.32363@tystie.local>
	<59d7961d0901130754j335c480fi673346cd20e031e@mail.gmail.com>
	<496CC8B8.6060606@pburns.seanet.com>
	<18800.40724.985949.449350@stat.math.ethz.ch>
	<4970E99C.9040907@acm.org>
Message-ID: <18802.19793.445515.400975@cmath-5.math.ethz.ch>

>>>>> "TP" == Tony Plate <tplate at acm.org>
>>>>>     on Fri, 16 Jan 2009 13:10:04 -0700 writes:

    TP> Martin Maechler wrote:
    >>>>>>> "PatB" == Patrick Burns <pburns at pburns.seanet.com>
    >>>>>>> on Tue, 13 Jan 2009 17:00:40 +0000 writes:
    >>>>>>> 
    >> 
    PatB> Henrik Bengtsson wrote:
    >> >> Hi.
    >> >> 
    >> >> On Mon, Jan 12, 2009 at 11:58 PM, Prof Brian Ripley
    >> >> <ripley at stats.ox.ac.uk> wrote:
    >> >> 
    >> >>> What you have is a one-dimensional array: they crop up
    >> >>> in R most often from table() in my experience.
    >> >>> 
    >> >>> 
    >> >>>> f <- table(rpois(100, 4)) str(f)
    >> >>>> 
    >> >>> 'table' int [, 1:10] 2 6 18 21 13 16 13 4 3 4 - attr(*,
    >> >>> "dimnames")=List of 1 ..$ : chr [1:10] "0" "1" "2" "3"
    >> >>> ...
    >> >>> 
    >> >>> and yes, f is an atmoic vector and yes, str()'s notation
    >> >>> is confusing here but if it did [1:10] you would not
    >> >>> know it was an array.  I recall discussing this with
    >> >>> Martin Maechler (str's author) last century, and I've
    >> >>> just checked that R 2.0.0 did the same.
    >> >>> 
    >> >>> The place in which one-dimensional arrays differ from
    >> >>> normal vectors is how names are handled: notice that my
    >> >>> example has dimnames not names, and ?names says
    >> >>> 
    >> >>> For a one-dimensional array the 'names' attribute really
    >> >>> is 'dimnames[[1]]'.
    >> >>> 
    >> >> 
    >> >> Thanks for this explanation.  One could then argue that
    >> >> [1:10,] is somewhat better than [,1:10], but that is just polish.
    >> 
    >> yes.  And honestly I don't remember anymore why I chose the
    >> "[,1:n]" notation.  It definitely was there already before R
    >> came into existence, as  S  also has had one-dimensional arrays,
    >> and I programmed the first version of str() in 1990.
    >> 
    PatB> Perhaps it could be:
    >> 
    PatB> [1:10(,)]
    >> 
    PatB> That is weird enough that it should not lead people to
    PatB> believe that it is a matrix.  But might prompt them a
    PatB> bit in that direction.
    >> 
    >> Well, str() was always aimed a bit at experienced S (and R)
    >> users, and I had always aimed somewhat to keep it's output
    >> "compact".  I'm quite astonished that the OP didn't know about
    >> 1D arrays in spite of the many years he's been using R.
    >> Would a wierd solution like the above have helped?
    >> 
    >> At the moment, I'd tend to keep it "as is" if only just for
    >> historical reminescence, but I can be convinced to change the
    >> current "tendency" ... 
    >> 
    >> Martin Maechler, ETH Zurich  
    >> 
    TP> What about just including "(1d-array)", something like this
    >> str(f)
    TP> 'table' int [1:10](1d array) 5 5 9 23 26 16 9 4 2 1
    TP> - attr(*, "dimnames")=List of 1
    TP> ..$ : chr [1:10] "0" "1" "2" "3" ...
    >> 
    TP> only 9 extra characters for a rare case, and much, much less cryptic?

well,.. the next text request is to use
 "character" instead of "chr", only 6 extra characters ....

-> no way:  str() has its very concise "style" and should keep
that.

Martin

    TP> -- Tony Plate
    >> 
    >> 
    PatB> Patrick Burns patrick at burns-stat.com +44 (0)20 8525
    PatB> 0696 http://www.burns-stat.com (home of "The R
    PatB> Inferno" and "A Guide for the Unwilling S User")
    >> >> /Henrik
    >> >> 
    >> >> 
    >> >>> I think these days we have enough internal glue in place
    >> >>> that an end user would not notice the difference (but
    >> >>> those working at C level with R objects may need to
    >> >>> know).
    >> >>> 
    >> >>> On Mon, 12 Jan 2009, Henrik Bengtsson wrote:
    >> >>> 
    >> >>> 
    >> >>>> Ran into the follow intermediate case in an external
    >> >>>> package (w/ recent R v2.8.1 patched and R v2.9.0
    >> >>>> devel):
    >> >>>> 
    >> >>>> 
    >> >>>>> x <- 1:2 dim(x) <- 2 dim(x)
    >> >>>>> 
    >> >>>> [1] 2
    >> >>>> 
    >> >>>>> x
    >> >>>>> 
    >> >>>> [1] 1 2
    >> >>>> 
    >> >>>>> str(x)
    >> >>>>> 
    >> >>>> int [, 1:2] 1 2
    >> >>>> 
    >> >>>>> nrow(x)
    >> >>>>> 
    >> >>>> [1] 2
    >> >>>> 
    >> >>>>> ncol(x)
    >> >>>>> 
    >> >>>> [1] NA
    >> >>>> 
    >> >>>>> is.vector(x)
    >> >>>>> 
    >> >>>> [1] FALSE
    >> >>>> 
    >> >>>>> is.matrix(x)
    >> >>>>> 
    >> >>>> [1] FALSE
    >> >>>> 
    >> >>>>> is.array(x)
    >> >>>>> 
    >> >>>> [1] TRUE
    >> >>>> 
    >> >>>>> x[1]
    >> >>>>> 
    >> >>>> [1] 1
    >> >>>> 
    >> >>>>> x[,1]
    >> >>>>> 
    >> >>>> Error in x[, 1] : incorrect number of dimensions
    >> >>>> 
    >> >>>>> x[1,]
    >> >>>>> 
    >> >>>> Error in x[1, ] : incorrect number of dimensions
    >> >>>> 
    >> >>>> Is str() treating single-dimension arrays incorrectly?
    >> >>>> 
    >> >>>> What does it mean to have a single dimension this way?
    >> >>>> Should it equal a vector?  I am aware of "is.vector
    >> >>>> returns FALSE if x has any attributes except names".
    >> >>>> 
    >> >>>> /Henrik
    >> >>>> 
    >> >>>> ______________________________________________
    >> >>>> R-devel at r-project.org mailing list
    >> >>>> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> >>>> 
    >> >>>> 
    >> >>> --
    >> 
    >>>> Brian D. Ripley, ripley at stats.ox.ac.uk Professor of Applied
    >>>> 
    >> >>> Statistics, http://www.stats.ox.ac.uk/~ripley/
    >> >>> University of Oxford, Tel: +44 1865 272861 (self) 1
    >> >>> South Parks Road, +44 1865 272866 (PA) Oxford OX1 3TG,
    >> >>> UK Fax: +44 1865 272595
    >> >>> 
    >> >>> ______________________________________________
    >> >>> R-devel at r-project.org mailing list
    >> >>> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> >>> 
    >> >>> 
    >> >> 
    >> 
    >>> ______________________________________________
    >>> 
    >> >> R-devel at r-project.org mailing list
    >> >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> >> 
    >> >> 
    >> >> 
    >> 
    >> ______________________________________________
    PatB> R-devel at r-project.org mailing list
    PatB> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 
    >> ______________________________________________
    >> R-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 
    >> 

    TP> ______________________________________________
    TP> R-devel at r-project.org mailing list
    TP> https://stat.ethz.ch/mailman/listinfo/r-devel


From cmr.pent at gmail.com  Sat Jan 17 19:59:34 2009
From: cmr.pent at gmail.com (=?UTF-8?B?0JDQvdC00YDQtdC5INCf0LDRgNCw0LzQvtC90L7Qsg==?=)
Date: Sat, 17 Jan 2009 21:59:34 +0300
Subject: [Rd] DierckxSpline segfault
Message-ID: <5f0660120901171059v8032701k4dfa9994afe44a17@mail.gmail.com>

I've just encountered a segfault when using DierckxSpline::percur
function. Below is the minimal example which triggers the error:

---

library(DierckxSpline)
x <- 1:10
y <- rep(0, 10)
pspline <- percur(x, y)

---

 *** caught segfault ***
address (nil), cause 'memory not mapped'

Traceback:
 1: .Fortran("percur", iopt = as.integer(iopt), m = as.integer(m),
x = as.single(x), y = as.single(y), w = as.single(w), k = k,     s =
as.single(s), nest = as.integer(nest), n = as.integer(n),     knots =
Knots, coef = coef, fp = single(1), wrk = wrk, lwrk = lwrk,     iwrk =
iwrk, ier = integer(1))
 2: curfitSS(xyw, s = s, knots = knots, n = n, from = From, to = To,
  k = k, periodic = periodic, ...)
 3: curfit.default(x, periodic = TRUE, ...)
 4: curfit(x, periodic = TRUE, ...)
 5: percur(x, y)

Possible actions:
1: abort (with core dump, if enabled)
2: normal R exit
3: exit R without saving workspace
4: exit R saving workspace
Selection:

---

Package:       DierckxSpline
Type:          Package
Title:         R companion to "Curve and Surface Fitting with Splines"
Version:       1.1-2
Date:          2007-7-31
Author:        Sundar Dorai-Raj
Maintainer:    Sundar Dorai-Raj <sundar.dorai-raj at pdf.com>
Description:   This package provides a wrapper to the FITPACK routines
               written by Paul Dierckx. The original Fortran is
               available from http://www.netlib.org/dierckx
License:       GPL (>= 2)
Depends:       R (>= 2.4.0), stats, lattice, PolynomF
Suggests:      fda, splines
Packaged:      Sun Jan 11 13:08:12 2009; spencerg
Built:         R 2.8.1; i486-pc-linux-gnu; 2009-01-17 10:21:01; unix

---

I'm ready to provide any additional info,
Andrey


From therneau at mayo.edu  Sun Jan 18 14:57:55 2009
From: therneau at mayo.edu (Terry Therneau)
Date: Sun, 18 Jan 2009 07:57:55 -0600 (CST)
Subject: [Rd] A model pass-through function
Message-ID: <200901181357.n0IDvtTd025175@rocky.mayo.edu>

 I've found 'pass-through' functions to be useful in the survival library.
For example
	cluster <- function(x) x

This allows the coxph routine to use the specials attribute of the terms
structure to spot variables that should be treated specially, with
needing to create a special class.

  I'm updating the expected survival routines to be more open minded wrt dates,
i.e., no longer wedded to my old 'date' class, and the following would
work very nicely
	ratetable <- function(...) data.frame(...)

Then later steps in the processing can make sure that variables in a rate
table which are known to be dates, like 'year' in the US death tables, can
take special care when matching them to the user's data.  

 Nice idea, except that it doesn't work: model.frame appears to be unhappy
with any multi-column object except a matrix.  Any suggestions to work around
this?

	Terry Therneau


From spencer.graves at prodsyse.com  Sun Jan 18 19:04:17 2009
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Sun, 18 Jan 2009 10:04:17 -0800
Subject: [Rd] DierckxSpline segfault
In-Reply-To: <5f0660120901171059v8032701k4dfa9994afe44a17@mail.gmail.com>
References: <5f0660120901171059v8032701k4dfa9994afe44a17@mail.gmail.com>
Message-ID: <49736F21.5070100@prodsyse.com>

Hello:

	  The following shows how to fit a simple periodic function to data 
using Fourier bases in the 'fda' package.  Fixing the bug you reported 
in the 'percur' function may not be easy.  (To my knowledge, the primary 
capability in the 'DierckxSpline' package not otherwise available in R 
is the ability to estimate knot locations with the free-knot spline 
function, 'curfit.free.knot'.  For other purposes, users may be wiser to 
use other packages.)

	  Hope this helps.
	  Spencer Graves

# problem
x <- seq(0.2, 0.8, 0.01)
y <- cos(2*pi*x^2) + 0.1*rnorm(length(x))
plot(x, y, xlim=0:1)

# simple solution
library(fda)
Fourier1 <- create.fourier.basis()
FourierFit <- Data2fd(x, y, Fourier1)
plotfit.fd(y, x, FourierFit)

# Allow more flexibility
Fourier9 <- create.fourier.basis(nbasis=2*9+1)
# constant + 9 cosine & sine terms

# Naive initial solution
FourierSmooth0 <- smooth.basisPar(x, y, Fourier9)
plotfit.fd(y, x, FourierSmooth0$fd)
# Oops:  Need some smoothing

# Try again.
FourierSmooth1 <- smooth.basisPar(x, y, Fourier9, lambda=1)
plotfit.fd(y, x, FourierSmooth1$fd)
# Much better.

#########################
      Thanks for this bug report.  I've replicated the problem using
your excellent example.  Unfortunately, this may not be an easy bug to
fix.

      Might it be feasible for you to use either the 'periodicSpline'
function in the 'splines' package or a Fourier basis in the 'fda' package?

      Best Wishes,
      Spencer Graves

?????? ????????? wrote:
> I've just encountered a segfault when using DierckxSpline::percur
> function. Below is the minimal example which triggers the error:
>
> ---
>
> library(DierckxSpline)
> x <- 1:10
> y <- rep(0, 10)
> pspline <- percur(x, y)
>
> ---
>
>  *** caught segfault ***
> address (nil), cause 'memory not mapped'
>
> Traceback:
>  1: .Fortran("percur", iopt = as.integer(iopt), m = as.integer(m),
> x = as.single(x), y = as.single(y), w = as.single(w), k = k,     s =
> as.single(s), nest = as.integer(nest), n = as.integer(n),     knots =
> Knots, coef = coef, fp = single(1), wrk = wrk, lwrk = lwrk,     iwrk =
> iwrk, ier = integer(1))
>  2: curfitSS(xyw, s = s, knots = knots, n = n, from = From, to = To,
>   k = k, periodic = periodic, ...)
>  3: curfit.default(x, periodic = TRUE, ...)
>  4: curfit(x, periodic = TRUE, ...)
>  5: percur(x, y)
>
> Possible actions:
> 1: abort (with core dump, if enabled)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
> Selection:
>
> ---
>
> Package:       DierckxSpline
> Type:          Package
> Title:         R companion to "Curve and Surface Fitting with Splines"
> Version:       1.1-2
> Date:          2007-7-31
> Author:        Sundar Dorai-Raj
> Maintainer:    Sundar Dorai-Raj <sundar.dorai-raj at pdf.com>
> Description:   This package provides a wrapper to the FITPACK routines
>                written by Paul Dierckx. The original Fortran is
>                available from http://www.netlib.org/dierckx
> License:       GPL (>= 2)
> Depends:       R (>= 2.4.0), stats, lattice, PolynomF
> Suggests:      fda, splines
> Packaged:      Sun Jan 11 13:08:12 2009; spencerg
> Built:         R 2.8.1; i486-pc-linux-gnu; 2009-01-17 10:21:01; unix
>
> ---
>
> I'm ready to provide any additional info,
> Andrey
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From sfischme at uwaterloo.ca  Mon Jan 19 06:54:40 2009
From: sfischme at uwaterloo.ca (Sebastian Fischmeister)
Date: Mon, 19 Jan 2009 00:54:40 -0500
Subject: [Rd] patch for textspecial and defaultfont in xfig
Message-ID: <6B180BB8-BB08-45CE-A911-0A67CFDBCBA6@uwaterloo.ca>

Hello,

   The current xfig device lacks the functionality to set the  
textspecial flag and use the defaultfont in xfig. This is necessary  
when you want to export to xfig and use interpreted text (e.g., $ 
\frac{1}{e}$ gets interpreted by latex). The attached patch adds this  
functionality.

Why would you like to do this?

- Use math in labels (e.g., name your variables $r_{xy}$, do a  
barplot, run figtex2pdf.sh [fetch if off the web], and look at the  
nice result]).

- Uses native document font -> uses same font as all the other text in  
your latex document.

- Does not cause troubles with color allocation limit (see pictex  
loading problem).

- Can edit R output figure with a vector drawing program (xfig).

... and of course it now perfectly fits my workflow.

I hope it's useful.

   Sebastian

Index: src/library/grDevices/R/postscript.R
===================================================================
--- src/library/grDevices/R/postscript.R	(revision 47637)
+++ src/library/grDevices/R/postscript.R	(working copy)
@@ -273,7 +273,7 @@
                    paper = "default", horizontal = TRUE,
                    width = 0, height = 0, family = "Helvetica",
                    pointsize = 12, bg = "transparent", fg = "black",
-                  pagecentre = TRUE)
+                  pagecentre = TRUE, defaultfont = FALSE, textspecial  
= FALSE)
  {
      ## do initialization if needed
      initPSandPDFfonts()
@@ -281,7 +281,7 @@
      if(!checkIntFormat(file)) stop("invalid 'file'")
      .External(XFig, file, paper, family, bg, fg,
                width, height, horizontal, pointsize,
-              onefile, pagecentre, encoding)
+              onefile, pagecentre, defaultfont, textspecial, encoding)
      invisible()
  }

Index: src/library/grDevices/src/devPS.c
===================================================================
--- src/library/grDevices/src/devPS.c	(revision 47637)
+++ src/library/grDevices/src/devPS.c	(working copy)
@@ -4354,6 +4354,9 @@
      int ymax;            /* used to invert coord system */
      char encoding[50];   /* for writing text */

+    Rboolean textspecial; /* use textspecial flag in xfig for latex  
integration */
+    Rboolean defaultfont; /* use the default font in xfig */
+
      /*
       * Fonts and encodings used on the device
       *
@@ -4553,6 +4556,7 @@
  		 double width, double height,
  		 Rboolean horizontal, double ps,
  		 Rboolean onefile, Rboolean pagecentre,
+		 Rboolean defaultfont, Rboolean textspecial,
  		 const char *encoding)
  {
      /* If we need to bail out with some sort of "error" */
@@ -4591,6 +4595,8 @@
      pd->width = width;
      pd->height = height;
      pd->landscape = horizontal;
+    pd->textspecial = textspecial;
+    pd->defaultfont = defaultfont;
      pointsize = floor(ps);
      if(R_TRANSPARENT(pd->bg) && R_TRANSPARENT(pd->col)) {
  	free(dd);
@@ -5108,7 +5114,7 @@
  	fprintf(fp, "4 %d ", (int)floor(2*hadj)); /* Text, how justified */
  	fprintf(fp, "%d 100 0 ", XF_SetColor(gc->col, pd));
  	/* color, depth, pen_style */
-	fprintf(fp, "%d %d %.4f 4 ", fontnum, (int)size, rot * DEG2RAD);
+	fprintf(fp, "%d %d %.4f %d ", pd->defaultfont?-1:fontnum, (int)size,  
rot * DEG2RAD,pd->textspecial?6:4);
  	/* font pointsize angle flags (Postscript font) */
  	fprintf(fp, "%d %d ", (int)(size*12),
  		(int)(16.667*XFig_StrWidth(str, gc, dd) +0.5));
@@ -7441,6 +7447,9 @@
   *  ps		= pointsize
   *  onefile     = {TRUE: normal; FALSE: single EPSF page}
   *  pagecentre  = centre plot region on paper?
+ *  defaultfont = {TRUE: use xfig default font; FALSE: use R font}
+ *  textspecial = {TRUE: use textspecial; FALSE: use standard font}
+ *
   *  encoding
   */

@@ -7449,7 +7458,7 @@
      pGEDevDesc gdd;
      char *vmax;
      const char *file, *paper, *family, *bg, *fg, *encoding;
-    int horizontal, onefile, pagecentre;
+    int horizontal, onefile, pagecentre, defaultfont, textspecial;
      double height, width, ps;

      vmax = vmaxget();
@@ -7467,6 +7476,8 @@
      ps = asReal(CAR(args));	      args = CDR(args);
      onefile = asLogical(CAR(args));   args = CDR(args);
      pagecentre = asLogical(CAR(args));args = CDR(args);
+    defaultfont = asLogical(CAR(args)); args = CDR(args);
+    textspecial = asLogical(CAR(args)); args = CDR(args);
      encoding = CHAR(asChar(CAR(args)));

      R_GE_checkVersionOrDie(R_GE_version);
@@ -7476,7 +7487,7 @@
  	if (!(dev = (pDevDesc) calloc(1, sizeof(DevDesc))))
  	    return 0;
  	if(!XFigDeviceDriver(dev, file, paper, family, bg, fg, width, height,
-			     (double) horizontal, ps, onefile, pagecentre,
+			     (double) horizontal, ps, onefile, pagecentre, defaultfont,  
textspecial,
  			     encoding)) {
  	    /* free(dev); No, freed inside XFigDeviceDriver */
  	    error(_("unable to start device xfig"));
Index: src/library/grDevices/man/xfig.Rd
===================================================================
--- src/library/grDevices/man/xfig.Rd	(revision 47637)
+++ src/library/grDevices/man/xfig.Rd	(working copy)
@@ -20,7 +20,7 @@
       paper = "default", horizontal = TRUE,
       width = 0, height = 0, family = "Helvetica",
       pointsize = 12, bg = "transparent", fg = "black",
-     pagecentre = TRUE)
+     pagecentre = TRUE, defaultfont = FALSE, textspecial = FALSE)
  }
  \arguments{
    \item{file}{a character string giving the name of the file.   For  
use
@@ -60,6 +60,10 @@
    \item{fg}{the initial foreground color to be used.}
    \item{pagecentre}{logical: should the device region be centred on  
the
      page?}
+  \item{defaultfont}{logical: should the device use xfig's default
+    font?}
+  \item{textspecial}{logical: should the device set the textspecial  
flag
+  for all text elements. This is useful when generating pstex from  
xfig figures.}
  }
  %%>>> REAL DOC in SOURCE:    ../../../main/devices.c  &   ../../../ 
unix/devPS.c
  \details{


From ripley at stats.ox.ac.uk  Mon Jan 19 08:54:52 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 19 Jan 2009 07:54:52 +0000 (GMT)
Subject: [Rd] patch for textspecial and defaultfont in xfig
In-Reply-To: <6B180BB8-BB08-45CE-A911-0A67CFDBCBA6@uwaterloo.ca>
References: <6B180BB8-BB08-45CE-A911-0A67CFDBCBA6@uwaterloo.ca>
Message-ID: <alpine.OSX.1.00.0901190752090.58931@tystie.local>

Thank you for the suggested patch, but you have not provided any 
tests.

With reasonably comprehensive tests we wil consider it, but not 
otherwise (no one in R-core is likely to use this, so we need to 
automate tests that it keeps on working in future releases).

On Mon, 19 Jan 2009, Sebastian Fischmeister wrote:

> Hello,
>
> The current xfig device lacks the functionality to set the textspecial flag 
> and use the defaultfont in xfig. This is necessary when you want to export to 
> xfig and use interpreted text (e.g., $\frac{1}{e}$ gets interpreted by 
> latex). The attached patch adds this functionality.
>
> Why would you like to do this?
>
> - Use math in labels (e.g., name your variables $r_{xy}$, do a barplot, run 
> figtex2pdf.sh [fetch if off the web], and look at the nice result]).
>
> - Uses native document font -> uses same font as all the other text in your 
> latex document.
>
> - Does not cause troubles with color allocation limit (see pictex loading 
> problem).
>
> - Can edit R output figure with a vector drawing program (xfig).
>
> ... and of course it now perfectly fits my workflow.
>
> I hope it's useful.
>
> Sebastian
>
> Index: src/library/grDevices/R/postscript.R
> ===================================================================
> --- src/library/grDevices/R/postscript.R	(revision 47637)
> +++ src/library/grDevices/R/postscript.R	(working copy)
> @@ -273,7 +273,7 @@
>                  paper = "default", horizontal = TRUE,
>                  width = 0, height = 0, family = "Helvetica",
>                  pointsize = 12, bg = "transparent", fg = "black",
> -                  pagecentre = TRUE)
> +                  pagecentre = TRUE, defaultfont = FALSE, textspecial = 
> FALSE)
> {
>    ## do initialization if needed
>    initPSandPDFfonts()
> @@ -281,7 +281,7 @@
>    if(!checkIntFormat(file)) stop("invalid 'file'")
>    .External(XFig, file, paper, family, bg, fg,
>              width, height, horizontal, pointsize,
> -              onefile, pagecentre, encoding)
> +              onefile, pagecentre, defaultfont, textspecial, encoding)
>    invisible()
> }
>
> Index: src/library/grDevices/src/devPS.c
> ===================================================================
> --- src/library/grDevices/src/devPS.c	(revision 47637)
> +++ src/library/grDevices/src/devPS.c	(working copy)
> @@ -4354,6 +4354,9 @@
>    int ymax;            /* used to invert coord system */
>    char encoding[50];   /* for writing text */
>
> +    Rboolean textspecial; /* use textspecial flag in xfig for latex 
> integration */
> +    Rboolean defaultfont; /* use the default font in xfig */
> +
>    /*
>     * Fonts and encodings used on the device
>     *
> @@ -4553,6 +4556,7 @@
> 		 double width, double height,
> 		 Rboolean horizontal, double ps,
> 		 Rboolean onefile, Rboolean pagecentre,
> +		 Rboolean defaultfont, Rboolean textspecial,
> 		 const char *encoding)
> {
>    /* If we need to bail out with some sort of "error" */
> @@ -4591,6 +4595,8 @@
>    pd->width = width;
>    pd->height = height;
>    pd->landscape = horizontal;
> +    pd->textspecial = textspecial;
> +    pd->defaultfont = defaultfont;
>    pointsize = floor(ps);
>    if(R_TRANSPARENT(pd->bg) && R_TRANSPARENT(pd->col)) {
> 	free(dd);
> @@ -5108,7 +5114,7 @@
> 	fprintf(fp, "4 %d ", (int)floor(2*hadj)); /* Text, how justified */
> 	fprintf(fp, "%d 100 0 ", XF_SetColor(gc->col, pd));
> 	/* color, depth, pen_style */
> -	fprintf(fp, "%d %d %.4f 4 ", fontnum, (int)size, rot * DEG2RAD);
> +	fprintf(fp, "%d %d %.4f %d ", pd->defaultfont?-1:fontnum, (int)size, 
> rot * DEG2RAD,pd->textspecial?6:4);
> 	/* font pointsize angle flags (Postscript font) */
> 	fprintf(fp, "%d %d ", (int)(size*12),
> 		(int)(16.667*XFig_StrWidth(str, gc, dd) +0.5));
> @@ -7441,6 +7447,9 @@
> *  ps		= pointsize
> *  onefile     = {TRUE: normal; FALSE: single EPSF page}
> *  pagecentre  = centre plot region on paper?
> + *  defaultfont = {TRUE: use xfig default font; FALSE: use R font}
> + *  textspecial = {TRUE: use textspecial; FALSE: use standard font}
> + *
> *  encoding
> */
>
> @@ -7449,7 +7458,7 @@
>    pGEDevDesc gdd;
>    char *vmax;
>    const char *file, *paper, *family, *bg, *fg, *encoding;
> -    int horizontal, onefile, pagecentre;
> +    int horizontal, onefile, pagecentre, defaultfont, textspecial;
>    double height, width, ps;
>
>    vmax = vmaxget();
> @@ -7467,6 +7476,8 @@
>    ps = asReal(CAR(args));	      args = CDR(args);
>    onefile = asLogical(CAR(args));   args = CDR(args);
>    pagecentre = asLogical(CAR(args));args = CDR(args);
> +    defaultfont = asLogical(CAR(args)); args = CDR(args);
> +    textspecial = asLogical(CAR(args)); args = CDR(args);
>    encoding = CHAR(asChar(CAR(args)));
>
>    R_GE_checkVersionOrDie(R_GE_version);
> @@ -7476,7 +7487,7 @@
> 	if (!(dev = (pDevDesc) calloc(1, sizeof(DevDesc))))
> 	    return 0;
> 	if(!XFigDeviceDriver(dev, file, paper, family, bg, fg, width, height,
> -			     (double) horizontal, ps, onefile, pagecentre,
> +			     (double) horizontal, ps, onefile, pagecentre, 
> defaultfont, textspecial,
> 			     encoding)) {
> 	    /* free(dev); No, freed inside XFigDeviceDriver */
> 	    error(_("unable to start device xfig"));
> Index: src/library/grDevices/man/xfig.Rd
> ===================================================================
> --- src/library/grDevices/man/xfig.Rd	(revision 47637)
> +++ src/library/grDevices/man/xfig.Rd	(working copy)
> @@ -20,7 +20,7 @@
>     paper = "default", horizontal = TRUE,
>     width = 0, height = 0, family = "Helvetica",
>     pointsize = 12, bg = "transparent", fg = "black",
> -     pagecentre = TRUE)
> +     pagecentre = TRUE, defaultfont = FALSE, textspecial = FALSE)
> }
> \arguments{
>  \item{file}{a character string giving the name of the file.   For use
> @@ -60,6 +60,10 @@
>  \item{fg}{the initial foreground color to be used.}
>  \item{pagecentre}{logical: should the device region be centred on the
>    page?}
> +  \item{defaultfont}{logical: should the device use xfig's default
> +    font?}
> +  \item{textspecial}{logical: should the device set the textspecial flag
> +  for all text elements. This is useful when generating pstex from xfig 
> figures.}
> }
> %%>>> REAL DOC in SOURCE:    ../../../main/devices.c  & 
> ../../../unix/devPS.c
> \details{
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From d.rizopoulos at erasmusmc.nl  Mon Jan 19 14:55:35 2009
From: d.rizopoulos at erasmusmc.nl (Dimitris Rizopoulos)
Date: Mon, 19 Jan 2009 14:55:35 +0100
Subject: [Rd] optim() example in relist() help page
Message-ID: <49748657.2050509@erasmusmc.nl>

I think the optim() example in the Details section of relist()'s help 
page is not totally correct. In particular, in the current form it is 
not taken into account that vcov should be a symmetric matrix and only 
the parameters in the lower (or upper) triangular part should be optimized.

A possible fix is:

ipar <- list(mean = c(0, 1), vcov = c(1, 1, 0))
initial.param <- as.relistable(ipar)

invvech <- function (x) {
     d <- 0.5 * (sqrt(8 * length(x) + 1) - 1)
     out <- matrix(0, d, d)
     out[lower.tri(out, TRUE)] <- x
     ind <- upper.tri(out)
     out[ind] <- t(out)[ind]
     out
}

ll <- function (param.vector) {
     param <- relist(param.vector, skeleton = ipar)
     param$vcov <- invvech(param$vcov)
     -sum(mvdnorm(x, mean = param$mean,
	vcov = param$vcov, log = TRUE))
}

optim(unlist(initial.param), ll)


or another example

Best,
Dimitris

p.s.,

 > R.Version()
$platform
[1] "i386-pc-mingw32"

$arch
[1] "i386"

$os
[1] "mingw32"

$system
[1] "i386, mingw32"

$status
[1] ""

$major
[1] "2"

$minor
[1] "8.1"

$year
[1] "2008"

$month
[1] "12"

$day
[1] "22"

$`svn rev`
[1] "47281"

$language
[1] "R"

$version.string
[1] "R version 2.8.1 (2008-12-22)"

-- 
Dimitris Rizopoulos
Assistant Professor
Department of Biostatistics
Erasmus Medical Center

Address: PO Box 2040, 3000 CA Rotterdam, the Netherlands
Tel: +31/(0)10/7043478
Fax: +31/(0)10/7043014


From h.wickham at gmail.com  Mon Jan 19 16:18:06 2009
From: h.wickham at gmail.com (hadley wickham)
Date: Mon, 19 Jan 2009 09:18:06 -0600
Subject: [Rd] Floating point excepting when cbind()ing a matrix of grobs (or
	environments) with a 0-column matrix
Message-ID: <f8e6ff050901190718j65b829c5q68be435a14d8ae9b@mail.gmail.com>

library(grid)
e <- rectGrob()
# OR:
# e <- environment()

a <- matrix(list(e), ncol = 1, nrow = 2)
b <- matrix(ncol = 0, nrow = 2)

cbind(a, b)

cbind(a, b)

This reliably crashes R for me.

I realise this is a rather esoteric error condition, but it crops up
for me when creating matrices of grobs to be turned into a ggplot2
plot.

Hadley

-- 
http://had.co.nz/


From sfischme at uwaterloo.ca  Mon Jan 19 16:30:19 2009
From: sfischme at uwaterloo.ca (Sebastian Fischmeister)
Date: Mon, 19 Jan 2009 10:30:19 -0500
Subject: [Rd] patch for textspecial and defaultfont in xfig
In-Reply-To: <alpine.OSX.1.00.0901190752090.58931@tystie.local>
References: <6B180BB8-BB08-45CE-A911-0A67CFDBCBA6@uwaterloo.ca>
	<alpine.OSX.1.00.0901190752090.58931@tystie.local>
Message-ID: <3ABB4596-1220-474C-98D2-3891013C6818@uwaterloo.ca>

Thanks for the guidelines. The updated patch also includes an  
exhaustive test in R for the two new options.

  Sebastian

Index: src/library/grDevices/R/postscript.R
===================================================================
--- src/library/grDevices/R/postscript.R	(revision 47637)
+++ src/library/grDevices/R/postscript.R	(working copy)
@@ -273,7 +273,7 @@
                   paper = "default", horizontal = TRUE,
                   width = 0, height = 0, family = "Helvetica",
                   pointsize = 12, bg = "transparent", fg = "black",
-                  pagecentre = TRUE)
+                  pagecentre = TRUE, defaultfont = FALSE, textspecial  
= FALSE)
{
     ## do initialization if needed
     initPSandPDFfonts()
@@ -281,7 +281,7 @@
     if(!checkIntFormat(file)) stop("invalid 'file'")
     .External(XFig, file, paper, family, bg, fg,
               width, height, horizontal, pointsize,
-              onefile, pagecentre, encoding)
+              onefile, pagecentre, defaultfont, textspecial, encoding)
     invisible()
}

Index: src/library/grDevices/tests/xfig-tests.Rout.save
===================================================================
--- src/library/grDevices/tests/xfig-tests.Rout.save	(revision 0)
+++ src/library/grDevices/tests/xfig-tests.Rout.save	(revision 0)
@@ -0,0 +1,34 @@
+
+R version 2.9.0 Under development (unstable) (2009-01-17 r47633)
+Copyright (C) 2009 The R Foundation for Statistical Computing
+ISBN 3-900051-07-0
+
+R is free software and comes with ABSOLUTELY NO WARRANTY.
+You are welcome to redistribute it under certain conditions.
+Type 'license()' or 'licence()' for distribution details.
+
+  Natural language support but running in an English locale
+
+R is a collaborative project with many contributors.
+Type 'contributors()' for more information and
+'citation()' on how to cite R or R packages in publications.
+
+Type 'demo()' for some demos, 'help()' for on-line help, or
+'help.start()' for an HTML browser interface to help.
+Type 'q()' to quit R.
+
+> ## tests for the xfig device
+>
+>
+>
+> xfig("xfig-tests.fig",onefile=TRUE,defaultfont=TRUE,textspecial=TRUE)
+>
+> xfig("xfig- 
tests.fig",onefile=TRUE,defaultfont=TRUE,textspecial=FALSE)
+>
+> xfig("xfig- 
tests.fig",onefile=TRUE,defaultfont=FALSE,textspecial=TRUE)
+>
+> xfig("xfig- 
tests.fig",onefile=TRUE,defaultfont=FALSE,textspecial=FALSE)
+>
+> unlink("xfig-tests.fig")
+>
+>
Index: src/library/grDevices/tests/xfig-tests.R
===================================================================
--- src/library/grDevices/tests/xfig-tests.R	(revision 0)
+++ src/library/grDevices/tests/xfig-tests.R	(revision 0)
@@ -0,0 +1,14 @@
+## tests for the xfig device
+
+
+
+xfig("xfig-tests.fig",onefile=TRUE,defaultfont=TRUE,textspecial=TRUE)
+
+xfig("xfig-tests.fig",onefile=TRUE,defaultfont=TRUE,textspecial=FALSE)
+
+xfig("xfig-tests.fig",onefile=TRUE,defaultfont=FALSE,textspecial=TRUE)
+
+xfig("xfig-tests.fig",onefile=TRUE,defaultfont=FALSE,textspecial=FALSE)
+
+unlink("xfig-tests.fig")
+
Index: src/library/grDevices/src/devPS.c
===================================================================
--- src/library/grDevices/src/devPS.c	(revision 47637)
+++ src/library/grDevices/src/devPS.c	(working copy)
@@ -4354,6 +4354,9 @@
     int ymax;            /* used to invert coord system */
     char encoding[50];   /* for writing text */

+    Rboolean textspecial; /* use textspecial flag in xfig for latex  
integration */
+    Rboolean defaultfont; /* use the default font in xfig */
+
     /*
      * Fonts and encodings used on the device
      *
@@ -4553,6 +4556,7 @@
		 double width, double height,
		 Rboolean horizontal, double ps,
		 Rboolean onefile, Rboolean pagecentre,
+		 Rboolean defaultfont, Rboolean textspecial,
		 const char *encoding)
{
     /* If we need to bail out with some sort of "error" */
@@ -4591,6 +4595,8 @@
     pd->width = width;
     pd->height = height;
     pd->landscape = horizontal;
+    pd->textspecial = textspecial;
+    pd->defaultfont = defaultfont;
     pointsize = floor(ps);
     if(R_TRANSPARENT(pd->bg) && R_TRANSPARENT(pd->col)) {
	free(dd);
@@ -5108,7 +5114,7 @@
	fprintf(fp, "4 %d ", (int)floor(2*hadj)); /* Text, how justified */
	fprintf(fp, "%d 100 0 ", XF_SetColor(gc->col, pd));
	/* color, depth, pen_style */
-	fprintf(fp, "%d %d %.4f 4 ", fontnum, (int)size, rot * DEG2RAD);
+	fprintf(fp, "%d %d %.4f %d ", pd->defaultfont?-1:fontnum, (int)size,  
rot * DEG2RAD,pd->textspecial?6:4);
	/* font pointsize angle flags (Postscript font) */
	fprintf(fp, "%d %d ", (int)(size*12),
		(int)(16.667*XFig_StrWidth(str, gc, dd) +0.5));
@@ -7441,6 +7447,9 @@
  *  ps		= pointsize
  *  onefile     = {TRUE: normal; FALSE: single EPSF page}
  *  pagecentre  = centre plot region on paper?
+ *  defaultfont = {TRUE: use xfig default font; FALSE: use R font}
+ *  textspecial = {TRUE: use textspecial; FALSE: use standard font}
+ *
  *  encoding
  */

@@ -7449,7 +7458,7 @@
     pGEDevDesc gdd;
     char *vmax;
     const char *file, *paper, *family, *bg, *fg, *encoding;
-    int horizontal, onefile, pagecentre;
+    int horizontal, onefile, pagecentre, defaultfont, textspecial;
     double height, width, ps;

     vmax = vmaxget();
@@ -7467,6 +7476,8 @@
     ps = asReal(CAR(args));	      args = CDR(args);
     onefile = asLogical(CAR(args));   args = CDR(args);
     pagecentre = asLogical(CAR(args));args = CDR(args);
+    defaultfont = asLogical(CAR(args)); args = CDR(args);
+    textspecial = asLogical(CAR(args)); args = CDR(args);
     encoding = CHAR(asChar(CAR(args)));

     R_GE_checkVersionOrDie(R_GE_version);
@@ -7476,7 +7487,7 @@
	if (!(dev = (pDevDesc) calloc(1, sizeof(DevDesc))))
	    return 0;
	if(!XFigDeviceDriver(dev, file, paper, family, bg, fg, width, height,
-			     (double) horizontal, ps, onefile, pagecentre,
+			     (double) horizontal, ps, onefile, pagecentre, defaultfont,  
textspecial,
			     encoding)) {
	    /* free(dev); No, freed inside XFigDeviceDriver */
	    error(_("unable to start device xfig"));
Index: src/library/grDevices/man/xfig.Rd
===================================================================
--- src/library/grDevices/man/xfig.Rd	(revision 47637)
+++ src/library/grDevices/man/xfig.Rd	(working copy)
@@ -20,7 +20,7 @@
      paper = "default", horizontal = TRUE,
      width = 0, height = 0, family = "Helvetica",
      pointsize = 12, bg = "transparent", fg = "black",
-     pagecentre = TRUE)
+     pagecentre = TRUE, defaultfont = FALSE, textspecial = FALSE)
}
\arguments{
   \item{file}{a character string giving the name of the file.   For use
@@ -60,6 +60,10 @@
   \item{fg}{the initial foreground color to be used.}
   \item{pagecentre}{logical: should the device region be centred on the
     page?}
+  \item{defaultfont}{logical: should the device use xfig's default
+    font?}
+  \item{textspecial}{logical: should the device set the textspecial  
flag
+  for all text elements. This is useful when generating pstex from  
xfig figures.}
}
%%>>> REAL DOC in SOURCE:    ../../../main/devices.c  &   ../../../ 
unix/devPS.c
\details{


From r.turner at auckland.ac.nz  Sun Jan 18 22:18:46 2009
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Mon, 19 Jan 2009 10:18:46 +1300
Subject: [Rd] Proposed mods to barplot.default() and legend().
In-Reply-To: <18800.20061.706225.593972@stat.math.ethz.ch>
References: <2369678C-3FA3-430F-8D4B-63EDFE8ED131@auckland.ac.nz>
	<18800.20061.706225.593972@stat.math.ethz.ch>
Message-ID: <52BBF4AB-36CF-4058-9BE2-4BF330ABF760@auckland.ac.nz>


On 16/01/2009, at 10:07 PM, Martin Maechler wrote:

> Hi Rolf,
>
>>>>>> "RT" == Rolf Turner <r.turner at auckland.ac.nz>
>>>>>>     on Fri, 16 Jan 2009 15:27:33 +1300 writes:
>
>     RT> Recently I had occasion to make some mods to
>     RT> barplot.default(), the main one being the introduction
>     RT> of a crosshatching facility.  I made some related mods
>     RT> to legend() so that the crosshatching could be
>     RT> accommodated in the legend.  I also made some other
>     RT> adjustments to remedy what seemed to me to be
>     RT> unsatisfactory characteristics of the shading that the
>     RT> fill-boxes in legends sometimes evinced.
>
>     RT> It seemed to me that others might want the crosshatching
>     RT> facility also, so I thought I might send in my modified
>     RT> versions of barplot.default() and legend() to R Core for
>     RT> their consideration.
>
>     RT> Would this be a good idea?
>     RT> How should I go about this?
> could well be ..
>
>     RT> Would it be appropriate just to send my code (and
>     RT> documentation) to you?
>
> I think you should post it to R-devel as a proposal.
> It's fine if you ask for feedback from R-core directly, and in
> the end, it will always need a "champion" within R-core who
> takes up the responsibility to adopt and test and ... your
> proposal.
>
> Really, for me to look at it closely, I'd like (hopefully small)
> patches against R-devel, i.e., against the *source* files (not the  
> print() of
> the function) in
>     https://svn.r-project.org/R/trunk/src/library/graphics/R/...
> If you don't use svn / subversion easily, I'd recommend to use the
> files in one of the snapshots
> at ftp://stat.ethz.ch/R/
>
>
> Regards,
> Martin

I have attached a tar file containing my modified code for barplot  
and legend,
and the correspondingly modified help files --- for your  
consideration and delectation. :-)

The mods were duly done unto the source files.

	cheers,

		Rolf Turner


  
   
######################################################################
Attention: 
This e-mail message is privileged and confidential. If you are not the 
intended recipient please delete the message and notify the sender. 
Any views or opinions presented are solely those of the author.

This e-mail has been scanned and cleared by MailMarshal 
www.marshalsoftware.com
######################################################################
-------------- next part --------------
A non-text attachment was scrubbed...
Name: barleg.tar
Type: application/x-tar
Size: 51200 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090119/0a306058/attachment.tar>

From spencer.graves at prodsyse.com  Sun Jan 18 02:18:43 2009
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Sat, 17 Jan 2009 17:18:43 -0800
Subject: [Rd] DierckxSpline segfault
In-Reply-To: <5f0660120901171059v8032701k4dfa9994afe44a17@mail.gmail.com>
References: <5f0660120901171059v8032701k4dfa9994afe44a17@mail.gmail.com>
Message-ID: <49728373.5070308@prodsyse.com>

      Thanks for this bug report.  I've replicated the problem using 
your excellent example.  Unfortunately, this may not be an easy bug to 
fix. 

      Might it be feasible for you to use either the 'periodicSpline' 
function in the 'splines' package or a Fourier basis in the 'fda' package? 

      Best Wishes,
      Spencer Graves

?????? ????????? wrote:
> I've just encountered a segfault when using DierckxSpline::percur
> function. Below is the minimal example which triggers the error:
>
> ---
>
> library(DierckxSpline)
> x <- 1:10
> y <- rep(0, 10)
> pspline <- percur(x, y)
>
> ---
>
>  *** caught segfault ***
> address (nil), cause 'memory not mapped'
>
> Traceback:
>  1: .Fortran("percur", iopt = as.integer(iopt), m = as.integer(m),
> x = as.single(x), y = as.single(y), w = as.single(w), k = k,     s =
> as.single(s), nest = as.integer(nest), n = as.integer(n),     knots =
> Knots, coef = coef, fp = single(1), wrk = wrk, lwrk = lwrk,     iwrk =
> iwrk, ier = integer(1))
>  2: curfitSS(xyw, s = s, knots = knots, n = n, from = From, to = To,
>   k = k, periodic = periodic, ...)
>  3: curfit.default(x, periodic = TRUE, ...)
>  4: curfit(x, periodic = TRUE, ...)
>  5: percur(x, y)
>
> Possible actions:
> 1: abort (with core dump, if enabled)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
> Selection:
>
> ---
>
> Package:       DierckxSpline
> Type:          Package
> Title:         R companion to "Curve and Surface Fitting with Splines"
> Version:       1.1-2
> Date:          2007-7-31
> Author:        Sundar Dorai-Raj
> Maintainer:    Sundar Dorai-Raj <sundar.dorai-raj at pdf.com>
> Description:   This package provides a wrapper to the FITPACK routines
>                written by Paul Dierckx. The original Fortran is
>                available from http://www.netlib.org/dierckx
> License:       GPL (>= 2)
> Depends:       R (>= 2.4.0), stats, lattice, PolynomF
> Suggests:      fda, splines
> Packaged:      Sun Jan 11 13:08:12 2009; spencerg
> Built:         R 2.8.1; i486-pc-linux-gnu; 2009-01-17 10:21:01; unix
>
> ---
>
> I'm ready to provide any additional info,
> Andrey
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From apfel.schmied at emaildienst.de  Mon Jan 19 12:35:05 2009
From: apfel.schmied at emaildienst.de (apfel.schmied at emaildienst.de)
Date: Mon, 19 Jan 2009 12:35:05 +0100 (CET)
Subject: [Rd] [Win] Hangup RGui with RMySQL (PR#13453)
Message-ID: <20090119113505.47D26282EFC1@mail.pubhealth.ku.dk>

Full_Name: Apfel Schmied
Version:  2.8.1 (2008-12-22)
OS: WinXP SP2
Submission from: (NULL) (134.106.122.139)


RMySQL Version: 0.7-2
DBI Version: 0.2-4
MySQL Version: 5.1.30 (Enviroment Variable MYSQL_HOME is set)

Updated R from 2.60 to 2.8.1. Now Gui.exe hangs up (100% CPU Useage) when
requesting data from a mysql database. 

Example Code:
---------------------------------------------------------------
library(RMySQL) #ok
drv = dbDriver("MySQL") # ok
conn <- mysqlNewConnection(drv,"table","user","pass") #ok
dbListTables(conn) #ok
resu <- dbGetQuery(conn, "Select * From example WHERE id < 13") # HANG UP! 

Errorcode:
---------------------------------------------------------------
RGui: Rgui.exe - Fehler in Anwendung: Die Anweisung in "0x77c178c0" verweist auf
Speicher in "0x00000000". Der Vorgang
"read" konnte nicht auf dem Speicher durchgef?hrt werden.
---------------------------------------------------------------
Command in "0x77c178c0" refers to adress "0x00000000", can't "read" from memory.


From ripley at stats.ox.ac.uk  Mon Jan 19 17:35:38 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 19 Jan 2009 16:35:38 +0000 (GMT)
Subject: [Rd] [Win] Hangup RGui with RMySQL (PR#13453)
In-Reply-To: <20090119113505.47D26282EFC1@mail.pubhealth.ku.dk>
References: <20090119113505.47D26282EFC1@mail.pubhealth.ku.dk>
Message-ID: <alpine.OSX.1.00.0901191633070.89990@tystie.local>

Did you build RMySQL yourself?  You need to for MySQL 5.1.  That has 
been reported on R-sig-db, and even on R-help, and looks like your 
mistake.

In any case, RMySQL is not part of R, so this was a misuse of R-bugs 
(please DO read the FAQ).  Now someone has to clean up after you ....


On Mon, 19 Jan 2009, apfel.schmied at emaildienst.de wrote:

> Full_Name: Apfel Schmied
> Version:  2.8.1 (2008-12-22)
> OS: WinXP SP2
> Submission from: (NULL) (134.106.122.139)
>
>
> RMySQL Version: 0.7-2
> DBI Version: 0.2-4
> MySQL Version: 5.1.30 (Enviroment Variable MYSQL_HOME is set)
>
> Updated R from 2.60 to 2.8.1. Now Gui.exe hangs up (100% CPU Useage) when
> requesting data from a mysql database.
>
> Example Code:
> ---------------------------------------------------------------
> library(RMySQL) #ok
> drv = dbDriver("MySQL") # ok
> conn <- mysqlNewConnection(drv,"table","user","pass") #ok
> dbListTables(conn) #ok
> resu <- dbGetQuery(conn, "Select * From example WHERE id < 13") # HANG UP!
>
> Errorcode:
> ---------------------------------------------------------------
> RGui: Rgui.exe - Fehler in Anwendung: Die Anweisung in "0x77c178c0" verweist auf
> Speicher in "0x00000000". Der Vorgang
> "read" konnte nicht auf dem Speicher durchgef?hrt werden.
> ---------------------------------------------------------------
> Command in "0x77c178c0" refers to adress "0x00000000", can't "read" from memory.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From therneau at mayo.edu  Mon Jan 19 19:29:37 2009
From: therneau at mayo.edu (Terry Therneau)
Date: Mon, 19 Jan 2009 12:29:37 -0600 (CST)
Subject: [Rd] further notes on model.frame issue
Message-ID: <200901191829.n0JITbg26182@hsrnfs-101.mayo.edu>

 This is a follow-up on my note of Saturday.  Let me start with two important 
clarifications
    - I think this would be a nice addition, but I've had exactly one use for it 
in the 15+ years of developing the survival package.  
    - I have a work around for the current case.   
Prioritize accordingly.

The ideal would be to change survexp as follows:
    fit <- survexp( ~ gender, data=mydata, ratetable=survexp.us,
    	ratevar=list(sex=gender, year=enroll.dt, age=age*365.25))
 
The model statement says that I want separate curves by gender, and is similar 
to other model statements.

The ratevar option gives the mapping between my variable names and the dimnames 
of the survexp.us rate table.  It wants age in days, enrollment date to be some 
sort of date object, and sex to be a factor.  Then the heading of the R code 
would be
	m <- match.call()
	m <- m[c(1, match(names(m), c('data','formula','na.action', 'subset',
		                      'weights', 'ratevar'), nomatch=0)
        m[[1]] <- as.name('model.frame')
        m <- eval.parent(m)

That is, the variables enroll.dat and age are searched for in the data= arg. 
This is like the start opion in glm, but a more complex result than a vector.

  The model.frame function can't handle this.  (Splus fails too, same spot, less 
useful error message).  
  
-----

  The current code uses 
  	fit <- survexp(~ gender + ratetable(sex=gender, year=enroll.dt, 
age=age*365.25), 
  	      data=mydata, ratetable=survexp.us)
 
The ratetable function creates a matrix with extra attributes. The matrix 
contains as.numeric of the factors with the levels remembered as an extra 
attribute, and also looks out for dates.  So the result is like ns() in the eyes 
of model.frame, and it works.  But having to write gender twice on the rhs is 
confusing to users.  

    Thanks in advance for any comments.
    
    	Terry Therneau


From wdunlap at tibco.com  Mon Jan 19 19:44:25 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Mon, 19 Jan 2009 10:44:25 -0800
Subject: [Rd] Floating point excepting when cbind()ing a matrix of grobs
	(orenvironments) with a 0-column matrix
In-Reply-To: <f8e6ff050901190718j65b829c5q68be435a14d8ae9b@mail.gmail.com>
References: <f8e6ff050901190718j65b829c5q68be435a14d8ae9b@mail.gmail.com>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D7007BD906@NA-PA-VBE03.na.tibco.com>

I think the following patch to src/main/bind.c fixes it up.
If the length of an argument to [cr]bind is 0 then it wont't
try to add any data from it to the output any more, just as
is done with the other modes of data.  It was getting the FPE
from i%k when k==0.

Index: src/main/bind.c
===================================================================
--- src/main/bind.c     (revision 47617)
+++ src/main/bind.c     (working copy)
@@ -1218,10 +1218,12 @@
                case LISTSXP:
                    PROTECT(u = coerceVector(u, mode));
                    k = LENGTH(u);
-                   idx = (!isMatrix(u)) ? rows : k;
-                   for (i = 0; i < idx; i++)
-                       SET_VECTOR_ELT(result, n++,
-                                      duplicate(VECTOR_ELT(u, i % k)));
+                   if (k>0) {
+                       idx = (!isMatrix(u)) ? rows : k;
+                       for (i = 0; i < idx; i++)
+                           SET_VECTOR_ELT(result, n++,
+                                          duplicate(VECTOR_ELT(u, i %
k)));
+                   }
                    UNPROTECT(1);
                    break;
                default:

Bill Dunlap
TIBCO Software Inc - Spotfire Division
wdunlap tibco.com  

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of hadley wickham
> Sent: Monday, January 19, 2009 7:18 AM
> To: r-devel at r-project.org
> Subject: [Rd] Floating point excepting when cbind()ing a 
> matrix of grobs (orenvironments) with a 0-column matrix
> 
> library(grid)
> e <- rectGrob()
> # OR:
> # e <- environment()
> 
> a <- matrix(list(e), ncol = 1, nrow = 2)
> b <- matrix(ncol = 0, nrow = 2)
> 
> cbind(a, b)
> 
> cbind(a, b)
> 
> This reliably crashes R for me.
> 
> I realise this is a rather esoteric error condition, but it crops up
> for me when creating matrices of grobs to be turned into a ggplot2
> plot.
> 
> Hadley
> 
> -- 
> http://had.co.nz/
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From amiransk at uwo.ca  Mon Jan 19 19:25:12 2009
From: amiransk at uwo.ca (amiransk at uwo.ca)
Date: Mon, 19 Jan 2009 19:25:12 +0100 (CET)
Subject: [Rd] sub and gsub treat \\ incorrectly (PR#13454)
Message-ID: <20090119182513.1B9FC282EFC1@mail.pubhealth.ku.dk>

Sub and gsub treat \\ replacement pattern incorrectly

I expect
  sub("a","\\", "a", perl=T)
to produce
  [1] "\"
instead it generates
  [1] ""

On the other hand, if I run
  sub("a","\\\\", "a", perl=T)
it correctly outputs
  [1] "\\"

The same issue applies to gsub.

--please do not edit the information below--

Version:
 platform = i386-pc-mingw32
 arch = i386
 os = mingw32
 system = i386, mingw32
 status = 
 major = 2
 minor = 8.1
 year = 2008
 month = 12
 day = 22
 svn rev = 47281
 language = R
 version.string = R version 2.8.1 (2008-12-22)

Windows XP (build 2600) Service Pack 2

Locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MONETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

Search Path:
 .GlobalEnv, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, package:methods, Autoloads, package:base

-- 
Sincerely,
 Andriy


From wdunlap at tibco.com  Tue Jan 20 00:24:56 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Mon, 19 Jan 2009 15:24:56 -0800
Subject: [Rd] sub and gsub treat \\ incorrectly (PR#13454)
In-Reply-To: <20090119182513.1B9FC282EFC1@mail.pubhealth.ku.dk>
References: <20090119182513.1B9FC282EFC1@mail.pubhealth.ku.dk>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D70087E0C9@NA-PA-VBE03.na.tibco.com>

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of amiransk at uwo.ca
> Sent: Monday, January 19, 2009 10:25 AM
> To: r-devel at stat.math.ethz.ch
> Cc: R-bugs at r-project.org
> Subject: [Rd] sub and gsub treat \\ incorrectly (PR#13454)
> 
> Sub and gsub treat \\ replacement pattern incorrectly
> 
> I expect
>   sub("a","\\", "a", perl=T)
> to produce
>   [1] "\"
> instead it generates
>   [1] ""
> 
> On the other hand, if I run
>   sub("a","\\\\", "a", perl=T)
> it correctly outputs
>   [1] "\\"

The replacement pattern may include \\digit, which means
to put the digit'th parenthesized subexpression into the
replacement.  E.g.
   > sub("([[:alpha:]]+) +([[:alpha:]]+)", "\\2 \\1", "One two three
four five")
   [1] "two One three four five"
   > gsub("([[:alpha:]]+) +([[:alpha:]]+)", "\\2 \\1", "One two three
four five")
   [1] "two One four three five"
To support this without ambiguity or surprises, \\ is expected
to be followed by a digit (or L or U when perl=TRUE).

When fixed=TRUE then there is no possibility of a parenthesized
subexpression so \\2 is taken literally.

help(gsub) is not explicit about this behavior.

Because I initially made the same mistake, when I wrote the S+
versions of gsub and sub I included a warning when the replacement
included a \\ not followed by a digit:

  > gsub("([[:alpha:]]+) +([[:alpha:]]+)", "\\ \\", "One two three four
five")
  [1] "    five"
  Warning messages:
    backslash in replacement argument of substituteString(fixed=F) is
not
          followed by backslash or digit, hence backslash is omitted in:
substit\
          uteString(pattern = pattern, replacement = replacement, x = x,
extended ....

> The same issue applies to gsub.
> 
> --please do not edit the information below--
> 
> Version:
>  platform = i386-pc-mingw32
>  arch = i386
>  os = mingw32
>  system = i386, mingw32
>  status = 
>  major = 2
>  minor = 8.1
>  year = 2008
>  month = 12
>  day = 22
>  svn rev = 47281
>  language = R
>  version.string = R version 2.8.1 (2008-12-22)
> 
> Windows XP (build 2600) Service Pack 2
> 
> Locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
> States.1252;LC_MONETARY=English_United 
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> 
> Search Path:
>  .GlobalEnv, package:stats, package:graphics, 
> package:grDevices, package:utils, package:datasets, 
> package:methods, Autoloads, package:base
> 
> -- 
> Sincerely,
>  Andriy
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From cberry at tajo.ucsd.edu  Tue Jan 20 04:25:38 2009
From: cberry at tajo.ucsd.edu (Charles C. Berry)
Date: Mon, 19 Jan 2009 19:25:38 -0800
Subject: [Rd] further notes on model.frame issue
In-Reply-To: <200901191829.n0JITbg26182@hsrnfs-101.mayo.edu>
References: <200901191829.n0JITbg26182@hsrnfs-101.mayo.edu>
Message-ID: <Pine.LNX.4.64.0901191916200.16545@tajo.ucsd.edu>

On Mon, 19 Jan 2009, Terry Therneau wrote:

> This is a follow-up on my note of Saturday.  Let me start with two important
> clarifications
>    - I think this would be a nice addition, but I've had exactly one use for it
> in the 15+ years of developing the survival package.
>    - I have a work around for the current case.
> Prioritize accordingly.
>
> The ideal would be to change survexp as follows:
>    fit <- survexp( ~ gender, data=mydata, ratetable=survexp.us,
>    	ratevar=list(sex=gender, year=enroll.dt, age=age*365.25))
>
> The model statement says that I want separate curves by gender, and is similar
> to other model statements.
>
> The ratevar option gives the mapping between my variable names and the dimnames
> of the survexp.us rate table.  It wants age in days, enrollment date to be some
> sort of date object, and sex to be a factor.  Then the heading of the R code
> would be
> 	m <- match.call()
> 	m <- m[c(1, match(names(m), c('data','formula','na.action', 'subset',
> 		                      'weights', 'ratevar'), nomatch=0)
>        m[[1]] <- as.name('model.frame')
>        m <- eval.parent(m)
>

Maybe I am missing something. Why not do something like this?

ratetable <- cbind ## for illustration purposes

foo <- function(formula,ratevars,data,...){
   m <- match.call()
   mfun <- m$ratevars
   mfun[[1]] <- as.name('ratetable')
   m$ratevars <- NULL
   frm <- eval(m$formula)
   frm <- update(frm,as.formula( paste("~.+",deparse(substitute(mfun)))))
   m$formula <- frm
   m[[1]] <- as.name('model.frame')
   m <- eval(m,parent.frame())
   m ## to show that model frame obeys
}

dat <- data.frame(diag(4))
foo(~X1+X2,list(sex=X3,year=X4),dat)

HTH,

Chuck

> That is, the variables enroll.dat and age are searched for in the data= arg.
> This is like the start opion in glm, but a more complex result than a vector.
>
>  The model.frame function can't handle this.  (Splus fails too, same spot, less
> useful error message).
>
> -----
>
>  The current code uses
>  	fit <- survexp(~ gender + ratetable(sex=gender, year=enroll.dt,
> age=age*365.25),
>  	      data=mydata, ratetable=survexp.us)
>
> The ratetable function creates a matrix with extra attributes. The matrix
> contains as.numeric of the factors with the levels remembered as an extra
> attribute, and also looks out for dates.  So the result is like ns() in the eyes
> of model.frame, and it works.  But having to write gender twice on the rhs is
> confusing to users.
>
>    Thanks in advance for any comments.
>
>    	Terry Therneau
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Charles C. Berry                            (858) 534-2098
                                             Dept of Family/Preventive Medicine
E mailto:cberry at tajo.ucsd.edu	            UC San Diego
http://famprevmed.ucsd.edu/faculty/cberry/  La Jolla, San Diego 92093-0901


From ripley at stats.ox.ac.uk  Tue Jan 20 07:30:15 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 20 Jan 2009 06:30:15 +0000 (GMT)
Subject: [Rd] Future support for cross-building for Windows
Message-ID: <alpine.OSX.1.00.0901200623170.34518@tystie.local>

Cross-building is one of those things that complicates the Windows R build 
process considerably and probably benefits a handful of people.

It has been pointed out that now we have build services such as Uwe's 
win-builder and RForge, there are easy ways to get a (checked) Windows 
binary of a finished R package, and it is nowadays more common to have 
things like a Windows Terminal Server to provide remote desktop access 
to a Windows mahine, or virtual machines running Windows as a guest 
OS.

If the need is only to cross-build packages, it would probably be 
easier to do so within the Unix package install system, effectively as 
another sub-architecture.

So this posting is an opportunity for users to make a _case_ 
(including offering resources) for continued support for 
cross-building either of R itself or of packages.  Either on this list 
or to R-Windows at r-project.org (which goes only to the Windows' 
developers).

(Cross-building is currently broken in the development version of R.)

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From amiransk at uwo.ca  Tue Jan 20 07:02:35 2009
From: amiransk at uwo.ca (Andriy Miranskyy)
Date: Tue, 20 Jan 2009 01:02:35 -0500
Subject: [Rd] sub and gsub treat \\ incorrectly (PR#13454)
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D70087E0C9@NA-PA-VBE03.na.tibco.com>
References: <20090119182513.1B9FC282EFC1@mail.pubhealth.ku.dk>
	<77EB52C6DD32BA4D87471DCD70C8D70087E0C9@NA-PA-VBE03.na.tibco.com>
Message-ID: <1457078506.20090120010235@uwo.ca>

Thank you, William! This makes things clearer.

I am trying to create a tiny converter of free text to Tex format. In
order to do that I need to replace all "_" with "\_" and all "&"
with "\&". Could you please tell me, is there a way of doing it using
gsub?

Regards,
Andriy

Monday, January 19, 2009, 6:24:56 PM, you wrote:

>> -----Original Message-----
>> From: r-devel-bounces at r-project.org 
>> [mailto:r-devel-bounces at r-project.org] On Behalf Of amiransk at uwo.ca
>> Sent: Monday, January 19, 2009 10:25 AM
>> To: r-devel at stat.math.ethz.ch
>> Cc: R-bugs at r-project.org
>> Subject: [Rd] sub and gsub treat \\ incorrectly (PR#13454)
>> 
>> Sub and gsub treat \\ replacement pattern incorrectly
>> 
>> I expect
>>   sub("a","\\", "a", perl=T)
>> to produce
>>   [1] "\"
>> instead it generates
>>   [1] ""
>> 
>> On the other hand, if I run
>>   sub("a","\\\\", "a", perl=T)
>> it correctly outputs
>>   [1] "\\"

> The replacement pattern may include \\digit, which means
> to put the digit'th parenthesized subexpression into the
> replacement.  E.g.
>    > sub("([[:alpha:]]+) +([[:alpha:]]+)", "\\2 \\1", "One two three
> four five")
>    [1] "two One three four five"
>    > gsub("([[:alpha:]]+) +([[:alpha:]]+)", "\\2 \\1", "One two three
> four five")
>    [1] "two One four three five"
> To support this without ambiguity or surprises, \\ is expected
> to be followed by a digit (or L or U when perl=TRUE).

> When fixed=TRUE then there is no possibility of a parenthesized
> subexpression so \\2 is taken literally.

> help(gsub) is not explicit about this behavior.

> Because I initially made the same mistake, when I wrote the S+
> versions of gsub and sub I included a warning when the replacement
> included a \\ not followed by a digit:

  >> gsub("([[:alpha:]]+) +([[:alpha:]]+)", "\\ \\", "One two three four
> five")
>   [1] "    five"
>   Warning messages:
>     backslash in replacement argument of substituteString(fixed=F) is
> not
>           followed by backslash or digit, hence backslash is omitted in:
> substit\
>           uteString(pattern = pattern, replacement = replacement, x = x,
> extended ....

>> The same issue applies to gsub.
>> 
>> --please do not edit the information below--
>> 
>> Version:
>>  platform = i386-pc-mingw32
>>  arch = i386
>>  os = mingw32
>>  system = i386, mingw32
>>  status = 
>>  major = 2
>>  minor = 8.1
>>  year = 2008
>>  month = 12
>>  day = 22
>>  svn rev = 47281
>>  language = R
>>  version.string = R version 2.8.1 (2008-12-22)
>> 
>> Windows XP (build 2600) Service Pack 2
>> 
>> Locale:
>> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
>> States.1252;LC_MONETARY=English_United 
>> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>> 
>> Search Path:
>>  .GlobalEnv, package:stats, package:graphics, 
>> package:grDevices, package:utils, package:datasets, 
>> package:methods, Autoloads, package:base
>> 
>> -- 
>> Sincerely,
>>  Andriy
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>


From ivowel at gmail.com  Mon Jan 19 20:52:22 2009
From: ivowel at gmail.com (ivo welch)
Date: Mon, 19 Jan 2009 14:52:22 -0500
Subject: [Rd] R bug or ghostscript bug or my bug?
Message-ID: <50d1c22d0901191152gec40df3tc4c3acb32ef61de9@mail.gmail.com>

Dear R developers:

The following R program produces a pdf file that does not survive
ghostscript distillation correctly.  The undistilled version is at
http://welch.econ.brown.edu/temp/try.PDF while the distilled version
is at http://welch.econ.brown.edu/temp/try.pdf .  When previewed, the
points are wrong in the distilled .pdf version, but only in one of the
two points invokations (huh?) .  The program that generated the pdf
files is

x= 1:10; y1= x; y2= y1/2;

plot.one = function( x, y ) {
  lines( x, y, col="blue");
  points( x, y, col="blue", pch=21, cex=1);
}

pdf(file = "try.PDF")

plot(0, type="n", xlim=c(1,10), ylim=c(1,10))

plot.one( x, y1 )
plot.one( x, y2)

dev.off()

system("ps2pdf14  try.PDF try.pdf")  # distillation.

-----------------------------

Obviously, the error can be in ghostscript, not in R.  Or it can be
that R produces a pdf file that has some slight problems that do not
usually show up, except when distilled.


Before I get too badly flamed, feel free to ignore this.  I am just
trying to help.  It took me some time to whittle down the program to
isolate the problem.


R was invoked under OSX via "R --vanilla" and is version 2.8.1.

ghostscript is 8.62 (2008-02-29) under OSX.

(It should be easy to check whether this also occurs under linux.)

/iaw


From r.biczok at dkfz-heidelberg.de  Mon Jan 19 23:00:52 2009
From: r.biczok at dkfz-heidelberg.de (Biczok Rudolf)
Date: Mon, 19 Jan 2009 23:00:52 +0100
Subject: [Rd] pass by reference for S4
Message-ID: <73B69AE489CA974C817780430D154F0901443833@dkfzex2.ad.dkfz-heidelberg.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090119/6d4e37ac/attachment.pl>

From ripley at stats.ox.ac.uk  Tue Jan 20 12:30:37 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 20 Jan 2009 11:30:37 +0000 (GMT)
Subject: [Rd] sub and gsub treat \\ incorrectly (PR#13454)
In-Reply-To: <1457078506.20090120010235@uwo.ca>
References: <20090119182513.1B9FC282EFC1@mail.pubhealth.ku.dk>
	<77EB52C6DD32BA4D87471DCD70C8D70087E0C9@NA-PA-VBE03.na.tibco.com>
	<1457078506.20090120010235@uwo.ca>
Message-ID: <alpine.OSX.1.00.0901201124420.53804@tystie.local>

On Tue, 20 Jan 2009, Andriy Miranskyy wrote:

> Thank you, William! This makes things clearer.
>
> I am trying to create a tiny converter of free text to Tex format. In
> order to do that I need to replace all "_" with "\_" and all "&"
> with "\&". Could you please tell me, is there a way of doing it using
> gsub?

Yes.  gsub("([_&])", "\\\\\\1", x) -- but you will also need to escape 
$ and %.  There are examples in the experimental Rd2tex function in 
the development version of R.

Please stop misusing the bug repository to ask questions (and to 
report your non-reading of the documentation: this is in ?regex 
referenced from ?sub, 'explicitly', pace Bill).

>
> Regards,
> Andriy
>
> Monday, January 19, 2009, 6:24:56 PM, you wrote:
>
>>> -----Original Message-----
>>> From: r-devel-bounces at r-project.org
>>> [mailto:r-devel-bounces at r-project.org] On Behalf Of amiransk at uwo.ca
>>> Sent: Monday, January 19, 2009 10:25 AM
>>> To: r-devel at stat.math.ethz.ch
>>> Cc: R-bugs at r-project.org
>>> Subject: [Rd] sub and gsub treat \\ incorrectly (PR#13454)
>>>
>>> Sub and gsub treat \\ replacement pattern incorrectly
>>>
>>> I expect
>>>   sub("a","\\", "a", perl=T)
>>> to produce
>>>   [1] "\"
>>> instead it generates
>>>   [1] ""
>>>
>>> On the other hand, if I run
>>>   sub("a","\\\\", "a", perl=T)
>>> it correctly outputs
>>>   [1] "\\"
>
>> The replacement pattern may include \\digit, which means
>> to put the digit'th parenthesized subexpression into the
>> replacement.  E.g.
>>   > sub("([[:alpha:]]+) +([[:alpha:]]+)", "\\2 \\1", "One two three
>> four five")
>>    [1] "two One three four five"
>>   > gsub("([[:alpha:]]+) +([[:alpha:]]+)", "\\2 \\1", "One two three
>> four five")
>>    [1] "two One four three five"
>> To support this without ambiguity or surprises, \\ is expected
>> to be followed by a digit (or L or U when perl=TRUE).
>
>> When fixed=TRUE then there is no possibility of a parenthesized
>> subexpression so \\2 is taken literally.
>
>> help(gsub) is not explicit about this behavior.
>
>> Because I initially made the same mistake, when I wrote the S+
>> versions of gsub and sub I included a warning when the replacement
>> included a \\ not followed by a digit:
>
>  >> gsub("([[:alpha:]]+) +([[:alpha:]]+)", "\\ \\", "One two three four
>> five")
>>   [1] "    five"
>>   Warning messages:
>>     backslash in replacement argument of substituteString(fixed=F) is
>> not
>>           followed by backslash or digit, hence backslash is omitted in:
>> substit\
>>           uteString(pattern = pattern, replacement = replacement, x = x,
>> extended ....
>
>>> The same issue applies to gsub.
>>>
>>> --please do not edit the information below--
>>>
>>> Version:
>>>  platform = i386-pc-mingw32
>>>  arch = i386
>>>  os = mingw32
>>>  system = i386, mingw32
>>>  status =
>>>  major = 2
>>>  minor = 8.1
>>>  year = 2008
>>>  month = 12
>>>  day = 22
>>>  svn rev = 47281
>>>  language = R
>>>  version.string = R version 2.8.1 (2008-12-22)
>>>
>>> Windows XP (build 2600) Service Pack 2
>>>
>>> Locale:
>>> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
>>> States.1252;LC_MONETARY=English_United
>>> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>>>
>>> Search Path:
>>>  .GlobalEnv, package:stats, package:graphics,
>>> package:grDevices, package:utils, package:datasets,
>>> package:methods, Autoloads, package:base
>>>
>>> --
>>> Sincerely,
>>>  Andriy
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Tue Jan 20 12:39:16 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 20 Jan 2009 11:39:16 +0000 (GMT)
Subject: [Rd] R bug or ghostscript bug or my bug?
In-Reply-To: <50d1c22d0901191152gec40df3tc4c3acb32ef61de9@mail.gmail.com>
References: <50d1c22d0901191152gec40df3tc4c3acb32ef61de9@mail.gmail.com>
Message-ID: <alpine.OSX.1.00.0901201121250.53804@tystie.local>

I think you are misusing 'distill' here.  The canonical distiller is 
Adobe Acrobat's. and that converts ps to pdf.

I've tried your example, and Acrobat can optimize it (probably what 
you wanted) and if I convert it to .eps in Acrobat, Distiller can 
distill it.

So, nothing wrong with R's pdf files (yet again).

(For completeness, I used Acrobat 9 Pro.)

On Mon, 19 Jan 2009, ivo welch wrote:

> Dear R developers:
>
> The following R program produces a pdf file that does not survive
> ghostscript distillation correctly.  The undistilled version is at
> http://welch.econ.brown.edu/temp/try.PDF while the distilled version
> is at http://welch.econ.brown.edu/temp/try.pdf .  When previewed, the
> points are wrong in the distilled .pdf version, but only in one of the
> two points invokations (huh?) .  The program that generated the pdf
> files is
>
> x= 1:10; y1= x; y2= y1/2;
>
> plot.one = function( x, y ) {
>  lines( x, y, col="blue");
>  points( x, y, col="blue", pch=21, cex=1);
> }
>
> pdf(file = "try.PDF")
>
> plot(0, type="n", xlim=c(1,10), ylim=c(1,10))
>
> plot.one( x, y1 )
> plot.one( x, y2)
>
> dev.off()
>
> system("ps2pdf14  try.PDF try.pdf")  # distillation.
>
> -----------------------------
>
> Obviously, the error can be in ghostscript, not in R.  Or it can be
> that R produces a pdf file that has some slight problems that do not
> usually show up, except when distilled.
>
>
> Before I get too badly flamed, feel free to ignore this.  I am just
> trying to help.  It took me some time to whittle down the program to
> isolate the problem.
>
>
> R was invoked under OSX via "R --vanilla" and is version 2.8.1.
>
> ghostscript is 8.62 (2008-02-29) under OSX.
>
> (It should be easy to check whether this also occurs under linux.)
>
> /iaw
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hkawakat at gmail.com  Tue Jan 20 16:02:16 2009
From: hkawakat at gmail.com (Hiroyuki Kawakatsu)
Date: Tue, 20 Jan 2009 15:02:16 +0000
Subject: [Rd] Package Matrix does not compile in R-devel_2009-01-10
Message-ID: <307b90470901200702k58259071q85a43c1c78f903f2@mail.gmail.com>

On Tue, 13 Jan 2009, Prof Brian Ripley wrote:

> I've discovered that Mac OS still has a FreeBSD make with which I can
> reproduce this.  So I am working with Martin on a patch for the next
> Matrix update.
>
> Meanwhile, if there is an issue with building R-devel with GNU make
> under FreeBSD (e.g.
>
> env MAKE=gmake ./configure
> env MAKE=gmake make
> )
>
> we would like to know what it is (see the inline comment in my first
> reply).

This may be a bit late (I finally managed to update to the latest
stable FreeBSD release 7.1) but just to report that

> version
               _
platform       x86_64-unknown-freebsd7.1
arch           x86_64
os             freebsd7.1
system         x86_64, freebsd7.1
status         Under development (unstable)
major          2
minor          9.0
year           2009
month          01
day            19
svn rev        47650
language       R
version.string R version 2.9.0 Under development (unstable) (2009-01-19 r47650)

builds fine with

# ./configure MAKE=gmake CC=gcc44 F77=gfortran44 FC=gfortran44
CXX=g++44 OBJC=gcc44 R_BROWSER=/usr/local/bin/firefox3
# gmake

and passes

# gmake check

the development version of gcc44 is
# gcc44 -v
Using built-in specs.
Target: x86_64-portbld-freebsd7.1
Configured with: ./..//gcc-4.4-20090116/configure --disable-nls
--with-system-zlib --with-libiconv-prefix=/usr/local
--with-gmp=/usr/local --program-suffix=44
--libdir=/usr/local/lib/gcc-4.4.0
--with-gxx-include-dir=/usr/local/lib/gcc-4.4.0/include/c++/
--disable-libgcj --prefix=/usr/local --mandir=/usr/local/man
--infodir=/usr/local/info/gcc44 --build=x86_64-portbld-freebsd7.1
Thread model: posix
gcc version 4.4.0 20090116 (experimental) (GCC)

h.
-- 
+---
| Hiroyuki Kawakatsu
| Business School, Dublin City University
| Dublin 9, Ireland. Tel +353 (0)1 700 7496


From ripley at stats.ox.ac.uk  Tue Jan 20 16:05:47 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 20 Jan 2009 15:05:47 +0000 (GMT)
Subject: [Rd] Package Matrix does not compile in R-devel_2009-01-10
In-Reply-To: <307b90470901200702k58259071q85a43c1c78f903f2@mail.gmail.com>
References: <307b90470901200702k58259071q85a43c1c78f903f2@mail.gmail.com>
Message-ID: <alpine.OSX.1.00.0901201503350.61193@tystie.local>

Matrix has already been updated to be complatible with the FreeBSD 
make: you will get the update via tools/rsync-recommended.

On Tue, 20 Jan 2009, Hiroyuki Kawakatsu wrote:

> On Tue, 13 Jan 2009, Prof Brian Ripley wrote:
>
>> I've discovered that Mac OS still has a FreeBSD make with which I can
>> reproduce this.  So I am working with Martin on a patch for the next
>> Matrix update.
>>
>> Meanwhile, if there is an issue with building R-devel with GNU make
>> under FreeBSD (e.g.
>>
>> env MAKE=gmake ./configure
>> env MAKE=gmake make
>> )
>>
>> we would like to know what it is (see the inline comment in my first
>> reply).
>
> This may be a bit late (I finally managed to update to the latest
> stable FreeBSD release 7.1) but just to report that
>
>> version
>               _
> platform       x86_64-unknown-freebsd7.1
> arch           x86_64
> os             freebsd7.1
> system         x86_64, freebsd7.1
> status         Under development (unstable)
> major          2
> minor          9.0
> year           2009
> month          01
> day            19
> svn rev        47650
> language       R
> version.string R version 2.9.0 Under development (unstable) (2009-01-19 r47650)
>
> builds fine with
>
> # ./configure MAKE=gmake CC=gcc44 F77=gfortran44 FC=gfortran44
> CXX=g++44 OBJC=gcc44 R_BROWSER=/usr/local/bin/firefox3
> # gmake
>
> and passes
>
> # gmake check
>
> the development version of gcc44 is
> # gcc44 -v
> Using built-in specs.
> Target: x86_64-portbld-freebsd7.1
> Configured with: ./..//gcc-4.4-20090116/configure --disable-nls
> --with-system-zlib --with-libiconv-prefix=/usr/local
> --with-gmp=/usr/local --program-suffix=44
> --libdir=/usr/local/lib/gcc-4.4.0
> --with-gxx-include-dir=/usr/local/lib/gcc-4.4.0/include/c++/
> --disable-libgcj --prefix=/usr/local --mandir=/usr/local/man
> --infodir=/usr/local/info/gcc44 --build=x86_64-portbld-freebsd7.1
> Thread model: posix
> gcc version 4.4.0 20090116 (experimental) (GCC)
>
> h.
> --
> +---
> | Hiroyuki Kawakatsu
> | Business School, Dublin City University
> | Dublin 9, Ireland. Tel +353 (0)1 700 7496
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sloiseau at ens-lsh.fr  Tue Jan 20 16:37:11 2009
From: sloiseau at ens-lsh.fr (Sylvain Loiseau)
Date: Tue, 20 Jan 2009 16:37:11 +0100
Subject: [Rd] Embeding R
Message-ID: <op.un2az91i67e68g@l017892.intranet.ens-lsh.fr>

Hi,

I'm planning to embed R into an application, with the following context:

- This application is written in Java (and managed with maven). I plan  
accessing R using JRI.
- This application must be installable on several plateform (linux, mac  
os, windows).
- The R engine must embed library, some of them having native code in C or  
Fortran.

Does this sound reasonable? I would be very grateful to everyone providing  
links, references, feedback or advice on this question.

Best regards,
Sylvain

-- 
Sylvain Loiseau
sloiseau at ens-lsh.fr


From simon.urbanek at r-project.org  Tue Jan 20 17:46:16 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 20 Jan 2009 11:46:16 -0500
Subject: [Rd] Embeding R
In-Reply-To: <op.un2az91i67e68g@l017892.intranet.ens-lsh.fr>
References: <op.un2az91i67e68g@l017892.intranet.ens-lsh.fr>
Message-ID: <4E46EB6C-83B2-4821-8B6C-6C9564D68CB8@r-project.org>


On Jan 20, 2009, at 10:37 , Sylvain Loiseau wrote:

> Hi,
>
> I'm planning to embed R into an application, with the following  
> context:
>
> - This application is written in Java (and managed with maven). I  
> plan accessing R using JRI.
> - This application must be installable on several plateform (linux,  
> mac os, windows).
> - The R engine must embed library, some of them having native code  
> in C or Fortran.
>
> Does this sound reasonable?

Yes. Since you mentioned JRI - it gives you all of the above for free  
(there are CRAN binaries for Windows and OS X; it installs on unix  
system with Java; you can link arbitrary libraries from R - that's how  
R works). Good pointers are JavaGD (for graphics so you can embed it  
in your Java look and feel) and JGR since it does all this already.

Cheers,
S


> I would be very grateful to everyone providing links, references,  
> feedback or advice on this question.
>
> Best regards,
> Sylvain
>
> -- 
> Sylvain Loiseau
> sloiseau at ens-lsh.fr
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From sloiseau at ens-lsh.fr  Tue Jan 20 18:28:35 2009
From: sloiseau at ens-lsh.fr (Sylvain Loiseau)
Date: Tue, 20 Jan 2009 18:28:35 +0100
Subject: [Rd] Embeding R
In-Reply-To: <4E46EB6C-83B2-4821-8B6C-6C9564D68CB8@r-project.org>
References: <op.un2az91i67e68g@l017892.intranet.ens-lsh.fr>
	<4E46EB6C-83B2-4821-8B6C-6C9564D68CB8@r-project.org>
Message-ID: <op.un2f5xiq67e68g@l017892.intranet.ens-lsh.fr>

> Yes. Since you mentioned JRI - it gives you all of the above for free  
> (there are CRAN binaries for Windows and OS X; it installs on unix  
> system with Java; you can link arbitrary libraries from R - that's how R  
> works). Good pointers are JavaGD (for graphics so you can embed it in  
> your Java look and feel) and JGR since it does all this already.

Thanks for your answer.

About R packages: how can I build, for each OS, a "distribution"  
containing the R Engine and the R packages I need as binaries compiled for  
the OS?

Best,
Sylvain

-- 
Sylvain Loiseau
sloiseau at ens-lsh.fr


From ripley at stats.ox.ac.uk  Tue Jan 20 19:01:55 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 20 Jan 2009 18:01:55 +0000 (GMT)
Subject: [Rd] Embeding R
In-Reply-To: <op.un2f5xiq67e68g@l017892.intranet.ens-lsh.fr>
References: <op.un2az91i67e68g@l017892.intranet.ens-lsh.fr>
	<4E46EB6C-83B2-4821-8B6C-6C9564D68CB8@r-project.org>
	<op.un2f5xiq67e68g@l017892.intranet.ens-lsh.fr>
Message-ID: <alpine.LFD.2.00.0901201800100.31075@auk.stats.ox.ac.uk>

On Tue, 20 Jan 2009, Sylvain Loiseau wrote:

>> Yes. Since you mentioned JRI - it gives you all of the above for free 
>> (there are CRAN binaries for Windows and OS X; it installs on unix system 
>> with Java; you can link arbitrary libraries from R - that's how R works). 
>> Good pointers are JavaGD (for graphics so you can embed it in your Java 
>> look and feel) and JGR since it does all this already.
>
> Thanks for your answer.
>
> About R packages: how can I build, for each OS, a "distribution" containing 
> the R Engine and the R packages I need as binaries compiled for the OS?

Depends on the OS, but really that is not an R question and you should 
ask your OS support teams.  You can see how R does it -- it is in the 
open sources.

>
> Best,
> Sylvain
>
> -- 
> Sylvain Loiseau
> sloiseau at ens-lsh.fr

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From simon.urbanek at r-project.org  Tue Jan 20 21:20:16 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 20 Jan 2009 15:20:16 -0500
Subject: [Rd] Embeding R
In-Reply-To: <op.un2f5xiq67e68g@l017892.intranet.ens-lsh.fr>
References: <op.un2az91i67e68g@l017892.intranet.ens-lsh.fr>
	<4E46EB6C-83B2-4821-8B6C-6C9564D68CB8@r-project.org>
	<op.un2f5xiq67e68g@l017892.intranet.ens-lsh.fr>
Message-ID: <929852D8-9C2D-46CF-BE1D-991E12536E15@r-project.org>


On Jan 20, 2009, at 12:28 , Sylvain Loiseau wrote:

>> Yes. Since you mentioned JRI - it gives you all of the above for  
>> free (there are CRAN binaries for Windows and OS X; it installs on  
>> unix system with Java; you can link arbitrary libraries from R -  
>> that's how R works). Good pointers are JavaGD (for graphics so you  
>> can embed it in your Java look and feel) and JGR since it does all  
>> this already.
>
> Thanks for your answer.
>
> About R packages: how can I build, for each OS, a "distribution"  
> containing the R Engine and the R packages I need as binaries  
> compiled for the OS?
>

Use the official R installer to install R and then the usual  
install.packages(...) to install the packages. On some systems you can  
"freeze" all this by simply packaging it all into one archive (if you  
know where all relevant files are). I would not recommend that for R  
itself because the installers have important side-effects, but you can  
safely archive packages as long as you unpack them in exactly the same  
location.

Cheers,
S


From Waclaw.Marcin.Kusnierczyk at idi.ntnu.no  Wed Jan 21 10:18:50 2009
From: Waclaw.Marcin.Kusnierczyk at idi.ntnu.no (Wacek Kusnierczyk)
Date: Wed, 21 Jan 2009 10:18:50 +0100
Subject: [Rd] patch for src/main/character.c
Message-ID: <4976E87A.9060500@idi.ntnu.no>

Attached is a suggested patch for src/main/character.c.  It does not fix
a bug, but rather provides an improvement on the recent extension of
do_grep.

In essence, instead of four occurences of 'invert ^ LOGICAL(ind)[i]'
that accommodate for the option 'invert' added to grep, there is one
occurence of 'LOGICAL(ind)[i] ^= invert' that modifies in-place the
logical vector of matched/unmatched flags.  Having the inversion done in
just one place instead of four locations in the code should make it
simpler to understand, maintain, and further extend the code.

The patch was made based on the src/main/character.c file in
R-devel_2009-01-20.  Patched code was successfully compiled and tested
on 32bit Ubuntu 8.04.

Regards,
Wacek


-- 
-------------------------------------------------------------------------------
Wacek Kusnierczyk, MD PhD

Email: waku at idi.ntnu.no
Phone: +47 73591875, +47 72574609

Department of Computer and Information Science (IDI)
Faculty of Information Technology, Mathematics and Electrical Engineering (IME)
Norwegian University of Science and Technology (NTNU)
Sem Saelands vei 7, 7491 Trondheim, Norway
Room itv303

Bioinformatics & Gene Regulation Group
Department of Cancer Research and Molecular Medicine (IKM)
Faculty of Medicine (DMF)
Norwegian University of Science and Technology (NTNU)
Laboratory Center, Erling Skjalgsons gt. 1, 7030 Trondheim, Norway
Room 231.05.060

-------------------------------------------------------------------------------

-------------- next part --------------
A non-text attachment was scrubbed...
Name: character.c.patch
Type: text/x-diff
Size: 1120 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090121/fede2402/attachment.bin>

From ripley at stats.ox.ac.uk  Wed Jan 21 11:29:51 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 21 Jan 2009 10:29:51 +0000 (GMT)
Subject: [Rd] patch for textspecial and defaultfont in xfig
In-Reply-To: <3ABB4596-1220-474C-98D2-3891013C6818@uwaterloo.ca>
References: <6B180BB8-BB08-45CE-A911-0A67CFDBCBA6@uwaterloo.ca>
	<alpine.OSX.1.00.0901190752090.58931@tystie.local>
	<3ABB4596-1220-474C-98D2-3891013C6818@uwaterloo.ca>
Message-ID: <alpine.OSX.1.00.0901211026320.88949@tystie.local>

Thank you: applied now.

Note mainly to the list: mailers are prone to expand tabs and wrap 
lines, so this patch needed to be applied by hand.  This keeps on 
happening, so it is better to send patches as plain text attachments 
(or also put them on a website).

On Mon, 19 Jan 2009, Sebastian Fischmeister wrote:

> Thanks for the guidelines. The updated patch also includes an exhaustive test 
> in R for the two new options.
>
> Sebastian
>
> Index: src/library/grDevices/R/postscript.R
> ===================================================================
> --- src/library/grDevices/R/postscript.R	(revision 47637)
> +++ src/library/grDevices/R/postscript.R	(working copy)
> @@ -273,7 +273,7 @@
>                 paper = "default", horizontal = TRUE,
>                 width = 0, height = 0, family = "Helvetica",
>                 pointsize = 12, bg = "transparent", fg = "black",
> -                  pagecentre = TRUE)
> +                  pagecentre = TRUE, defaultfont = FALSE, textspecial = 
> FALSE)

e.g. wrapped here

[...]

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Jan 21 11:31:06 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 21 Jan 2009 10:31:06 +0000 (GMT)
Subject: [Rd] Floating point excepting when cbind()ing a matrix of grobs
 (orenvironments) with a 0-column matrix
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D7007BD906@NA-PA-VBE03.na.tibco.com>
References: <f8e6ff050901190718j65b829c5q68be435a14d8ae9b@mail.gmail.com>
	<77EB52C6DD32BA4D87471DCD70C8D7007BD906@NA-PA-VBE03.na.tibco.com>
Message-ID: <alpine.OSX.1.00.0901211030100.88949@tystie.local>

Thank you: I've applied something similar (this was another in-line 
patch that did not apply, even when I fixed the line wrap).

On Mon, 19 Jan 2009, William Dunlap wrote:

> I think the following patch to src/main/bind.c fixes it up.
> If the length of an argument to [cr]bind is 0 then it wont't
> try to add any data from it to the output any more, just as
> is done with the other modes of data.  It was getting the FPE
> from i%k when k==0.
>
> Index: src/main/bind.c
> ===================================================================
> --- src/main/bind.c     (revision 47617)
> +++ src/main/bind.c     (working copy)
> @@ -1218,10 +1218,12 @@
>                case LISTSXP:
>                    PROTECT(u = coerceVector(u, mode));
>                    k = LENGTH(u);
> -                   idx = (!isMatrix(u)) ? rows : k;
> -                   for (i = 0; i < idx; i++)
> -                       SET_VECTOR_ELT(result, n++,
> -                                      duplicate(VECTOR_ELT(u, i % k)));
> +                   if (k>0) {
> +                       idx = (!isMatrix(u)) ? rows : k;
> +                       for (i = 0; i < idx; i++)
> +                           SET_VECTOR_ELT(result, n++,
> +                                          duplicate(VECTOR_ELT(u, i %
> k)));
> +                   }
>                    UNPROTECT(1);
>                    break;
>                default:
>
> Bill Dunlap
> TIBCO Software Inc - Spotfire Division
> wdunlap tibco.com
>
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org
>> [mailto:r-devel-bounces at r-project.org] On Behalf Of hadley wickham
>> Sent: Monday, January 19, 2009 7:18 AM
>> To: r-devel at r-project.org
>> Subject: [Rd] Floating point excepting when cbind()ing a
>> matrix of grobs (orenvironments) with a 0-column matrix
>>
>> library(grid)
>> e <- rectGrob()
>> # OR:
>> # e <- environment()
>>
>> a <- matrix(list(e), ncol = 1, nrow = 2)
>> b <- matrix(ncol = 0, nrow = 2)
>>
>> cbind(a, b)
>>
>> cbind(a, b)
>>
>> This reliably crashes R for me.
>>
>> I realise this is a rather esoteric error condition, but it crops up
>> for me when creating matrices of grobs to be turned into a ggplot2
>> plot.
>>
>> Hadley
>>
>> --
>> http://had.co.nz/
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From rhurlin at gwdg.de  Wed Jan 21 11:50:51 2009
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Wed, 21 Jan 2009 11:50:51 +0100
Subject: [Rd] Package Matrix does not compile in R-devel_2009-01-10
In-Reply-To: <496A6F24.7050403@gwdg.de>
References: <496A6F24.7050403@gwdg.de>
Message-ID: <4976FE0B.2070309@gwdg.de>

Just some feedback for the record.

Since version R-devel_2009-01-20.tar.gz with Matrix_0.999375-18.tar.gz 
included I am able again to compile and install R on FreeBSD 8.0-CURRENT 
out of the box.

Many thanks to Martin Maechler and Brian Ripley for the help and work,

Rainer Hurling


Am 11.01.2009 23:13 (UTC+1) schrieb Rainer Hurling:
> Dear developers,
> 
> today I tried to build and install R-devel_2009-01-10 on FreeBSD 
> 8.0-CURRENT (i386) for testing purposes.
> 
> All went well until compiling the now recommended (integrated) Matrix 
> package. At this point the following break occured:
> 
> ------------------------------------------------
> begin installing recommended package Matrix
> * Installing *source* package 'Matrix' ...
> ** libs
> gcc -std=gnu99 -I/usr/local/R-devel/include -I./UFconfig 
> -I/usr/local/include    -fpic  -g -O2 -c CHMfactor.c -o CHMfactor.o
> [..snip..]
> gcc -std=gnu99 -I/usr/local/R-devel/include -I../Include 
> -I../../UFconfig -I/usr/local/include    -fpic  -g -O2 -c 
> colamd_global.c -o colamd_global.o
> gcc -std=gnu99 -I/usr/local/R-devel/include -I../Include 
> -I../../UFconfig -I/usr/local/include    -fpic  -g -O2 -I../Include 
> -DDLONG -c colamd.c -o colamd_l.o
> ar -rucs ../../COLAMD.a colamd_global.o colamd_l.o # colamd.o
> ( cd Source ; make lib )
> gcc -std=gnu99 -I/usr/local/R-devel/include -I../Include 
> -I../../UFconfig -I/usr/local/include    -fpic  -g -O2 -c amd_global.c 
> -o amd_global.o
> make: don't know how to make amd_l_1.o. Stop
> *** Error code 2
> Stop in /tmp/Rtmpx5nUS8/R.INSTALL10d63af1/Matrix/src/AMD.
> *** Error code 1
> Stop in /tmp/Rtmpx5nUS8/R.INSTALL10d63af1/Matrix/src.
> ERROR: compilation failed for package 'Matrix'
> * Removing '/usr/local/R-devel/library/Matrix'
> *** Error code 1
> Stop in /usr/local/R-devel/src/library/Recommended.
> *** Error code 1
> Stop in /usr/local/R-devel/src/library/Recommended.
> *** Error code 1
> Stop in /usr/local/R-devel.
> ------------------------------------------------
> 
> 
> Please note, that on FreeBSD there is a BSD 'make' as default. If I want 
> to use gmake instead, I explicitly have to set it. Unfortunately this 
> does not work within building the whole R-devel system.
> 
> With R-2.8.1 I have no problems installing and using R. When I want to 
> build the (external) Matrix package I have to set an environment 
> variable to gmake, found at /usr/local/bin/gmake and all works well.
> 
> 
> Now my question: Is it possible to change the configure/build of the 
> integrated Matrix package on R-devel? For all other packages there is no 
> need to do so (at least for FreeBSD ;-)
> 
> Please let me know if I can help.
> 
> Thanks in advance,
> Rainer Hurling


From enrique.bengoechea at credit-suisse.com  Wed Jan 21 12:18:13 2009
From: enrique.bengoechea at credit-suisse.com (=?iso-8859-1?Q?Bengoechea_Bartolom=E9_Enrique_=28SIES_73=29?=)
Date: Wed, 21 Jan 2009 12:18:13 +0100
Subject: [Rd] Embeding R
In-Reply-To: <mailman.29.1232535605.26995.r-devel@r-project.org>
Message-ID: <19811401A1D8174CB3EAD7F6072E9B5001E406CB@chsa1025.share.beluni.net>

Hi,

You may find the biocep-R project very useful, it embeds R into Java using JRI. And it goes much further than that, providing an impressive framework from which you can start with a lot of work already done. It's open source, so you can also just have a look at the code for inspiration:

http://biocep-distrib.r-forge.r-project.org/

It hasn't been released yet (no documentation) but it's really worth exploring.

Best,

Enrique

-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of r-devel-request at r-project.org
Sent: mi?rcoles, 21 de enero de 2009 12:00
To: r-devel at r-project.org
Subject: R-devel Digest, Vol 71, Issue 19


Message: 8
Date: Tue, 20 Jan 2009 16:37:11 +0100
From: "Sylvain Loiseau" <sloiseau at ens-lsh.fr>
Subject: [Rd] Embeding R
To: r-devel at r-project.org
Message-ID: <op.un2az91i67e68g at l017892.intranet.ens-lsh.fr>
Content-Type: text/plain; format=flowed; delsp=yes; charset=utf-8

Hi,

I'm planning to embed R into an application, with the following context:

- This application is written in Java (and managed with maven). I plan  
accessing R using JRI.
- This application must be installable on several plateform (linux, mac  
os, windows).
- The R engine must embed library, some of them having native code in C or  
Fortran.

Does this sound reasonable? I would be very grateful to everyone providing  
links, references, feedback or advice on this question.

Best regards,
Sylvain

-- 
Sylvain Loiseau
sloiseau at ens-lsh.fr


From banzaleon at gmail.com  Wed Jan 21 16:10:12 2009
From: banzaleon at gmail.com (banzaleon at gmail.com)
Date: Wed, 21 Jan 2009 16:10:12 +0100 (CET)
Subject: [Rd] Bug in sub and gsub (PR#13460)
Message-ID: <20090121151012.233B5282EFF8@mail.pubhealth.ku.dk>

Full_Name: Leon C. Banza
Version: 2.8.1
OS: Windows Vista
Submission from: (NULL) (195.69.243.253)


I believe there is a serious bug in the code for sub and gsub.  I do as
following:

gsub("\\", "-", "some\\backslashed\\string")

This ought return "some-backslashed-string", but prints warnings instead:

Error in sub("\\", "", "baba\\") : invalid regular expression '\'
In addition: Warning message:
In sub("\\", "", "baba\\") : regcomp error:  'Trailing backslash'

I believe this is a matter of a simple correction in the source code.

Leon


From k.ponting at aurix.com  Tue Jan 20 14:02:47 2009
From: k.ponting at aurix.com (Keith Ponting)
Date: Tue, 20 Jan 2009 08:02:47 -0500
Subject: [Rd] work-around for debugger broken (by changed behaviour of get
	under R 2.8?) when functions have ... arguments
Message-ID: <0368DB7855FE094FBFF313BE6BC5A810C81E2E@BE02.exg3.exghost.com>

Hello all,

Sorry to trouble you, but this is a follow-up with a work-around to the
problem I posted on R-help
(http://article.gmane.org/gmane.comp.lang.r.general/136515). Is it
possible to add the work-around or some equivalent to the utils package,
please? 

I think this may be related to the changed behaviour of get under R 2.8
referred to in:
http://www.nabble.com/changed-behaviour-of-%27get%27-in-2.8.0:-request-f
or-unchange-td20143510.html

I am trying to use the debugger (to resolve a bug when running with
Rscript) and have a secondary problem when functions have unused ... 
Arguments which can be reduced to the following sequence:

  # A script with a bug in it
  options(error=quote({dump.frames("debug.dump",to.file=TRUE)}))
  silly <- function(x,...){
    z <- list(...)
    NONEXISTENT.FUNCTION()
  }
  silly(1)

  # and to debug it:
  load("debug.dump.rda")
  debugger(debug.dump)

However when I execute the debugger as follows, I cannot actually debug
the stack:

  > load("debug.dump.rda")
  > debugger(debug.dump)
  Message:  Error in silly(1) : could not find function
  "NONEXISTENT.FUNCTION"
  Available environments had calls:
  1: silly(1)

  Enter an environment number, or 0 to exit  Selection: 1
  Error in get(.obj, envir = dump[[.selection]]) :
    argument "..." is missing, with no default

get flags this error whether I enter the code to invoke silly directly,
source a .R file or invoke with Rscript, all under SuSe linux 10.3
(sessionInfo below). I also get it if I try the debugger under Windows
Vista with R version 2.8.1. 

It all works perfectly happily under any of the following conditions:
1) I rewrite the function without the "..."
2) I execute the debugger lines under R 2.7.0 (linux)
3) I actually pass a value through "..."

Unfortunately 1 and 3 are not feasible for my real code - would it be
possible to add the try fix below (or some equivalent) to debugger in
the utils package? 

> sessionInfo()
R version 2.8.1 (2008-12-22)
i686-pc-linux-gnu

locale:
LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;LC_COLLATE=en_GB.U
TF-8;LC_MONETARY=C;LC_MESSAGES=en_GB.UTF-8;LC_PAPER=en_GB.UTF-8;LC_NAME=
C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_GB.UTF-8;LC_IDENTIFICATI
ON=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


Thankyou,

Keith Ponting

Keith Ponting
Aurix Ltd, Malvern WR14 3SZ  UK

P.S. Wrapping a try around the offending assign in debugger.look means
that I still get the error message, but am able to browse the function
calls. 

I would prefer not to blank out the error message completely, to avoid
surprises when I try to access ... in the debugger via list(...), which
works when a value was passed to ... but when nothing was passed to ...
gives the message "Error: '...' used in an incorrect context", which may
be true but initially led me to conclude that I could not see ...
contents via the debugger.

debug.kmp<-function (dump = last.dump)
{
    debugger.look <- function(.selection) {
        for (.obj in ls(envir = dump[[.selection]], all.names = TRUE))
try(assign(.obj, 
            get(.obj, envir = dump[[.selection]])))
        cat(gettext("Browsing in the environment with call:\n   "), 
            calls[.selection], "\n", sep = "")
        rm(.obj, .selection)
        browser()
    }
    if (class(dump) != "dump.frames") {
        cat(gettext("'dump' is not an object of class 'dump.frames'\n"))
        return(invisible())
    }
    err.action <- getOption("error")
    on.exit(options(error = err.action))
    if (length(msg <- attr(dump, "error.message"))) 
        cat(gettext("Message: "), msg)
    n <- length(dump)
    calls <- names(dump)
    repeat {
        cat(gettext("Available environments had calls:\n"))
        cat(paste(1:n, ": ", calls, sep = ""), sep = "\n")
        cat(gettext("\nEnter an environment number, or 0 to exit  "))
        repeat {
            ind <- .Internal(menu(as.character(calls)))
            if (ind <= n) 
                break
        }
        if (ind == 0) 
            return(invisible())
        debugger.look(ind)
    }
}


From ligges at statistik.tu-dortmund.de  Wed Jan 21 17:55:18 2009
From: ligges at statistik.tu-dortmund.de (ligges at statistik.tu-dortmund.de)
Date: Wed, 21 Jan 2009 17:55:18 +0100 (CET)
Subject: [Rd] Bug in sub and gsub (PR#13460)
Message-ID: <20090121165519.088A1282EFF8@mail.pubhealth.ku.dk>



banzaleon at gmail.com wrote:
> Full_Name: Leon C. Banza
> Version: 2.8.1
> OS: Windows Vista
> Submission from: (NULL) (195.69.243.253)
> 
> 
> I believe there is a serious bug in the code for sub and gsub.  I do as
> following:
> 
> gsub("\\", "-", "some\\backslashed\\string")

This is a user bug. You need
    gsub("\\\\", "-", "some\\backslashed\\string")
Please read the documentation before submitting bug reports!!!

Uwe Ligges


> This ought return "some-backslashed-string", but prints warnings instead:
> 
> Error in sub("\\", "", "baba\\") : invalid regular expression '\'
> In addition: Warning message:
> In sub("\\", "", "baba\\") : regcomp error:  'Trailing backslash'
> 
> I believe this is a matter of a simple correction in the source code.
> 
> Leon
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From wdunlap at tibco.com  Wed Jan 21 23:28:10 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Wed, 21 Jan 2009 14:28:10 -0800
Subject: [Rd] typo in R-intro
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D70087E7A8@NA-PA-VBE03.na.tibco.com>

R-intro.pdf contains 'expect' where I would expect 'except':

  13.3 Namespaces
  Packages can have namespaces, and currently all of the base and
recommended packages do
  expect the datasets package.

I've attached a patch to doc/manual/R-intro.texi.

Bill Dunlap
TIBCO Software Inc - Spotfire Division
wdunlap tibco.com 

From guy.tillinghast at rivhs.com  Thu Jan 22 00:00:12 2009
From: guy.tillinghast at rivhs.com (guy.tillinghast at rivhs.com)
Date: Thu, 22 Jan 2009 00:00:12 +0100 (CET)
Subject: [Rd] encountering difficulty asking R to manipulate the correct
	columns in Expression Set class (object 4). (PR#13464)
Message-ID: <20090121230012.977A2282EFC2@mail.pubhealth.ku.dk>

Full_Name: Guy W. Tillinghast
Version: 2.8.0
OS: Windows XP professional
Submission from: (NULL) (24.248.24.3)


I am encountering difficulty asking R to manipulate the correct columns in
Expression Set class (object 4).

I download the ALL data with:
library(golubEsets)
data(Golub_Merge)

Note, the data has the samples not in order.  This is not R's fault (at least
not that I can tell):
> Golub_Merge$Samples
 [1] 39 40 42 47 48 49 41 43 44 45 46 70 71 72 68 69 67 55 56 59 52 53 51 50 54
[26] 57 58 60 61 65 66 63 64 62  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16
[51] 17 18 19 20 21 22 23 24 25 26 27 34 35 36 37 38 28 29 30 31 32 33

I want a subset:
> learning.set<-c(1,2,3,6,8,10,11,12,13,15,16,17,18,19,20,21,23,24,26,30,31,32,34,35,36,37,39,43,44,45,46,47,48,49,50,51,52,53,55,56,57,58,59,60,62,63,64,65,66,67,68,69,70,72)
> learningEset<-Golub_Merge[,learning.set]
> learningEset$Samples
 [1] 39 40 42 49 43 45 46 70 71 68 69 67 55 56 59 52 51 50 57 65 66 63 62  1  2
[26]  3  5  9 10 11 12 13 14 15 16 17 18 19 21 22 23 24 25 26 34 35 36 37 38 28
[51] 29 30 31 33
Note what happened: 
1)	the order is difference than learning.set
2)	samples have been switched: example: sample 72 out, sample 71 in. 

Okay, I troubleshoot: maybe it matters what order I request samples:

> learning.set<-c(39,47,48,49,43,44,45,46,70,72,68,69,67,55,56,59,52,53,51,50,57,58,60,65,66,63,64,62,1,2,3,6,8,10,11,12,13,15,16,17,18,19,20,21,23,24,26,34,35,36,37,30,31,32)
> learningEset<-Golub_Merge[,learning.set]
> learningEset$Samples
 [1]  5 13 14 15  9 10 11 12 31 33 29 30 28 21 22 25 18 19 17 16 23 24 26 37 38
[26] 35 36 34 39 40 42 49 43 45 46 70 71 68 69 67 55 56 59 52 51 50 57 62  1  2
[51]  3 65 66 63
Frankly, this is troubling that R did not do what it was told.


From yan at pixie.org.uk  Wed Jan 21 23:00:13 2009
From: yan at pixie.org.uk (yan at pixie.org.uk)
Date: Wed, 21 Jan 2009 23:00:13 +0100 (CET)
Subject: [Rd] Italics in svg output display as bold (PR#13463)
Message-ID: <20090121220013.97061282EFC2@mail.pubhealth.ku.dk>

Full_Name: Yan Wong
Version: 2.8.1
OS: Mac OS X 10.4
Submission from: (NULL) (78.149.167.246)


When printing a plot to and svg file, text intended to be in italics is rendered
in bold (svg file viewed using both Safari 3.2.1 and Firefox 2.0.0.9.

For example, try viewing the test.svg file generated by

svg("test.svg", width=4,4,8)
plot.new(); text(0.5,0.5,labels=expression(italic("This should be in
italics")))
dev.off()

Yan


From ripley at stats.ox.ac.uk  Thu Jan 22 12:42:32 2009
From: ripley at stats.ox.ac.uk (Brian D Ripley)
Date: Thu, 22 Jan 2009 11:42:32 +0000 (GMT)
Subject: [Rd] (PR#13464) encountering difficulty asking R to manipulate
 the correct columns in Expression Set class (object 4)
In-Reply-To: <20090121230012.977A2282EFC2@mail.pubhealth.ku.dk>
References: <20090121230012.977A2282EFC2@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0901221140260.27217@toucan.stats.ox.ac.uk>

'Frankly, this is troubling' that you did not read the FAQ.  This is a 
contributed package (from BioC, I presume) and you should report your 
troubles to the maintainer or the BioC support lists.

Please do read the FAQ to find out why you have made work for people 
with better things to do.

On Thu, 22 Jan 2009, guy.tillinghast at rivhs.com wrote:

> Full_Name: Guy W. Tillinghast
> Version: 2.8.0
> OS: Windows XP professional
> Submission from: (NULL) (24.248.24.3)
>
>
> I am encountering difficulty asking R to manipulate the correct columns in
> Expression Set class (object 4).
>
> I download the ALL data with:
> library(golubEsets)
> data(Golub_Merge)
>
> Note, the data has the samples not in order.  This is not R's fault (at least
> not that I can tell):
>> Golub_Merge$Samples
> [1] 39 40 42 47 48 49 41 43 44 45 46 70 71 72 68 69 67 55 56 59 52 53 51 50 54
> [26] 57 58 60 61 65 66 63 64 62  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16
> [51] 17 18 19 20 21 22 23 24 25 26 27 34 35 36 37 38 28 29 30 31 32 33
>
> I want a subset:
>> learning.set<-c(1,2,3,6,8,10,11,12,13,15,16,17,18,19,20,21,23,24,26,30,31,32,34,35,36,37,39,43,44,45,46,47,48,49,50,51,52,53,55,56,57,58,59,60,62,63,64,65,66,67,68,69,70,72)
>> learningEset<-Golub_Merge[,learning.set]
>> learningEset$Samples
> [1] 39 40 42 49 43 45 46 70 71 68 69 67 55 56 59 52 51 50 57 65 66 63 62  1  2
> [26]  3  5  9 10 11 12 13 14 15 16 17 18 19 21 22 23 24 25 26 34 35 36 37 38 28
> [51] 29 30 31 33
> Note what happened:
> 1)	the order is difference than learning.set
> 2)	samples have been switched: example: sample 72 out, sample 71 in.
>
> Okay, I troubleshoot: maybe it matters what order I request samples:
>
>> learning.set<-c(39,47,48,49,43,44,45,46,70,72,68,69,67,55,56,59,52,53,51,50,57,58,60,65,66,63,64,62,1,2,3,6,8,10,11,12,13,15,16,17,18,19,20,21,23,24,26,34,35,36,37,30,31,32)
>> learningEset<-Golub_Merge[,learning.set]
>> learningEset$Samples
> [1]  5 13 14 15  9 10 11 12 31 33 29 30 28 21 22 25 18 19 17 16 23 24 26 37 38
> [26] 35 36 34 39 40 42 49 43 45 46 70 71 68 69 67 55 56 59 52 51 50 57 62  1  2
> [51]  3 65 66 63
> Frankly, this is troubling that R did not do what it was told.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Thu Jan 22 12:58:38 2009
From: ripley at stats.ox.ac.uk (Brian D Ripley)
Date: Thu, 22 Jan 2009 11:58:38 +0000 (GMT)
Subject: [Rd] Italics in svg output display as bold (PR#13463)
In-Reply-To: <20090121220013.97061282EFC2@mail.pubhealth.ku.dk>
References: <20090121220013.97061282EFC2@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0901221153020.20762@toucan.stats.ox.ac.uk>

It is a bug on your system: this is done by cairographics, and I 
suspect that the version you have is broken (or possibly your viewer).
I'll attach the version I get, which does display in italics on my 
system.

I used cairo-1.8.0-1.fc10.x86_64 (on Fedora 10).


On Wed, 21 Jan 2009, yan at pixie.org.uk wrote:

> Full_Name: Yan Wong
> Version: 2.8.1
> OS: Mac OS X 10.4

And how did you compile it?  This might be a bug in the cairographics 
or fontconfig library used for the CRAN binary build, if you used that 
(and report such issues to R-sig-mac -- see the posting guide).

> Submission from: (NULL) (78.149.167.246)
>
>
> When printing a plot to and svg file, text intended to be in italics is rendered
> in bold (svg file viewed using both Safari 3.2.1 and Firefox 2.0.0.9.
>
> For example, try viewing the test.svg file generated by
>
> svg("test.svg", width=4,4,8)
> plot.new(); text(0.5,0.5,labels=expression(italic("This should be in
> italics")))
> dev.off()
>
> Yan
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From mtmorgan at fhcrc.org  Thu Jan 22 15:37:34 2009
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Thu, 22 Jan 2009 06:37:34 -0800
Subject: [Rd] encountering difficulty asking R to manipulate the correct
 columns in Expression Set class (object 4). (PR#13464)
In-Reply-To: <20090121230012.977A2282EFC2@mail.pubhealth.ku.dk> (guy
	tillinghast's message of "Thu, 22 Jan 2009 00:00:12 +0100 (CET)")
References: <20090121230012.977A2282EFC2@mail.pubhealth.ku.dk>
Message-ID: <6phab9jpftd.fsf@gopher4.fhcrc.org>

Hi Guy --

As noted, this should be sent to the Bioconductor mailing list, see
http://bioconductor.org/docs/mailList.html.

Some more comments below...

guy.tillinghast at rivhs.com writes:

> Full_Name: Guy W. Tillinghast
> Version: 2.8.0
> OS: Windows XP professional
> Submission from: (NULL) (24.248.24.3)
>
>
> I am encountering difficulty asking R to manipulate the correct columns in
> Expression Set class (object 4).
>
> I download the ALL data with:
> library(golubEsets)
> data(Golub_Merge)
>
> Note, the data has the samples not in order.  This is not R's fault (at least
> not that I can tell):
>> Golub_Merge$Samples
>  [1] 39 40 42 47 48 49 41 43 44 45 46 70 71 72 68 69 67 55 56 59 52 53 51 50 54
> [26] 57 58 60 61 65 66 63 64 62  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16
> [51] 17 18 19 20 21 22 23 24 25 26 27 34 35 36 37 38 28 29 30 31 32 33

'Samples' is a covariate, not an index into the ExpressionSet. It is
like any of the other 11 covariates in phenoData (try
pData(Golub_Merge) to get a data frame of all covariates).

> I want a subset:
>> learning.set<-c(1,2,3,6,8,10,11,12,13,15,16,17,18,19,20,21,23,24,26,30,31,32,34,35,36,37,39,43,44,45,46,47,48,49,50,51,52,53,55,56,57,58,59,60,62,63,64,65,66,67,68,69,70,72)
>> learningEset<-Golub_Merge[,learning.set]
>> learningEset$Samples
>  [1] 39 40 42 49 43 45 46 70 71 68 69 67 55 56 59 52 51 50 57 65 66 63 62  1  2
> [26]  3  5  9 10 11 12 13 14 15 16 17 18 19 21 22 23 24 25 26 34 35 36 37 38 28
> [51] 29 30 31 33

This selects columns 1, 2, 3 etc of the ExpressionSet, and the
corresponding phenoData. The column 1 corresponds to Sample 39, so you
select that Sample, and so on. If you want individuals with particular
values of the Samples column of phenoData, you might say something
like

Golub_Merge[, Golub_Merge$Samples %in% learning.set]

just as you might select all the male samples with

Golub_Merge[, Golub_Merge$Gender == "M"]

Kind of a powerful idiom.

> Note what happened: 
> 1)	the order is difference than learning.set
> 2)	samples have been switched: example: sample 72 out, sample 71 in. 
>
> Okay, I troubleshoot: maybe it matters what order I request samples:
>
>> learning.set<-c(39,47,48,49,43,44,45,46,70,72,68,69,67,55,56,59,52,53,51,50,57,58,60,65,66,63,64,62,1,2,3,6,8,10,11,12,13,15,16,17,18,19,20,21,23,24,26,34,35,36,37,30,31,32)
>> learningEset<-Golub_Merge[,learning.set]
>> learningEset$Samples
>  [1]  5 13 14 15  9 10 11 12 31 33 29 30 28 21 22 25 18 19 17 16 23 24 26 37 38
> [26] 35 36 34 39 40 42 49 43 45 46 70 71 68 69 67 55 56 59 52 51 50 57 62  1  2
> [51]  3 65 66 63
> Frankly, this is troubling that R did not do what it was told.

All Bioconductor packages have vignettes, which is a good place to
start to understand a package. An ExpressionSet is defined in Biobase,
so visit (from the front page of the Bioconductor site, following the
software link)
http://bioconductor.org/packages/2.3/bioc/html/Biobase.html

and read the ExpressionSetIntroduction.pdf as a starting point. There
is also extensive training material (under the 'workshops' tab at the
top of the page) and some excellent books.

The bioconductor mailing list and mailing list archives are also very
helpful places.

Martin

> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin Morgan
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M2 B169
Phone: (206) 667-2793


From gavin.simpson at ucl.ac.uk  Thu Jan 22 15:41:56 2009
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Thu, 22 Jan 2009 14:41:56 +0000
Subject: [Rd] [R] pdf() and pch problems
In-Reply-To: <18808.32996.632409.272360@stat.math.ethz.ch>
References: <49785A81.1030504@cam.ac.uk>
	<alpine.LFD.2.00.0901221143390.27217@toucan.stats.ox.ac.uk>
	<20090122145237.0o1rr6my68s40ggk@webmail.unibas.ch>
	<18808.32996.632409.272360@stat.math.ethz.ch>
Message-ID: <1232635316.1363.18.camel@prometheus.geog.ucl.ac.uk>

On Thu, 2009-01-22 at 15:21 +0100, Martin Maechler wrote:
> >>>>> "TZ" == T Zumbrunn <T.Zumbrunn at unibas.ch>
> >>>>>     on Thu, 22 Jan 2009 14:52:37 +0100 writes:
> 
>     TZ> Quoting Brian D Ripley <ripley at stats.ox.ac.uk>:
>     >> On Thu, 22 Jan 2009, Robin Hankin wrote:
>     >> 
>     >>> Hi
>     >>> 
>     >>> R-2.8.1,   Suse 11.1
>     >>> 
>     >>> I'm having problems with pdf(). In the following
>     >>> transcript, file 'f.pdf' does not use the expected symbols for the plot.
>     >>> It uses a 'q' letter instead of the open circle I get when
>     >>> viewing the graphics window.
>     >>> 
>     >>> I also get the same under  r47678.
>     >>> 
>     >>> Does anyone else get this?
>     >> 
>     >> Yes, if you use a broken PDF viewer (you have not told us yours). From ?pdf
>     >> 
>     >> useDingbats: logical.  Should small circles be rendered _via_ the
>     >> Dingbats font?  Defaults to true, which produces smaller and
>     >> better output - this is provided for those who insist on
>     >> using broken PDF viewers.
>     >> 
>     >> I get the problem in evince but not acroread in F10.
> 
>     TZ> The problem is caused by missing fontconfig rules in openSUSE 11.1  
>     TZ> (that the PDF library poppler depends on). I reported the problem a  
>     TZ> while ago here http://bugs.freedesktop.org/show_bug.cgi?id=18002  
>     TZ> (instructions on how to fix the issue are included) and filed a bug at  
>     TZ> the openSUSE bug database  
>     TZ> https://bugzilla.novell.com/show_bug.cgi?id=434676. The bug was  
>     TZ> closed, but I reopened it.
> 
> That's interesting, thank you very much, Thomas, for the extra
> explanation!
> 
> As you know (but your text above could be read differently) this
> bug ... quite long standing! ... seems to be much wider spread
> than just (Open)SuSE.  I have seen and still see it on Redhat
> (RHEL 5) and many Ubuntu versions too. 
> 
> And indeed, the workaround recommended (somewhere) in the above
> URL is working for me too:
> 
> Add the following (without the "-----" lines) to your
> ~/.fonts.conf file (or create such a file) :
> --snip---------------------------------------------------------
> <alias binding="same">
>  <family>ZapfDingbats</family>
>  <accept><family>Dingbats</family></accept>
> </alias>
> --snip---------------------------------------------------------
> 
> Martin Maechler, ETH Zurich

[Moved to R-Devel]

Same problem on Fedora 8 through 10. The snippet Martin shows fixes the
problem on those systems also. It would be very useful to have this
documented somewhere either as a note in ?pdf or in perhaps in the R
Installation and Administration Manual, until such a time as distro's
fix these problems.

To that end I'll also be filing a bug against fedora 10 when I get home
(and confirm it is still there) as my system has an entry for 'Zapf
Dingbats' but not 'ZapfDingbats' which causes the problems on my boxes.

Great to finally have worked around this issue --- not that it was R's
fault. I had completely missed the useDingbats argument of pdf(). The Rd
file does however make it sound that the default (TRUE) is there to fix
the problem of broken PDF viewers, where surely it is the FALSE state
that fixes the problem, or perhaps what was intended was that it is the
argument itself that was provided to fix buggy viewers.

I'd be happy to patch any/all of those sources if someone in R Core
would be willing to take a lot and possibly apply them?

All the best,

G

> 
> 
> 
>     >>> le112:~/scratch/R-2.8.1% R --vanilla --quiet
>     >>>> pdf(file='~/f.pdf')
>     >>>> plot(1:10 , pch=1)
>     >>>> dev.off()
>     >>> null device
>     >>> 1
>     >>>> sessionInfo()
>     >>> R version 2.8.1 (2008-12-22)
>     >>> i686-pc-linux-gnu
>     >>> 
>     >>> locale:
>     >>> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>     >>> 
>     >>> attached base packages:
>     >>> [1] stats     graphics  grDevices utils     datasets  methods     
>     >>> base    > q()
>     >>> le112:~/scratch/R-2.8.1%
>     >>> 
>     >>> 
>     >>> 
>     >>> 
>     >>> 
>     >>> 
>     >>> 
>     >>> 
>     >>> -- 
>     >>> Robin K. S. Hankin
>     >>> Uncertainty Analyst
>     >>> University of Cambridge
>     >>> 19 Silver Street
>     >>> Cambridge CB3 9EP
>     >>> 01223-764877
>     >>> 
>     >>> ______________________________________________
>     >>> R-help at r-project.org mailing list
>     >>> https://stat.ethz.ch/mailman/listinfo/r-help
>     >>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>     >>> and provide commented, minimal, self-contained, reproducible code.
>     >>> 
>     >> 
>     >> -- 
>     >> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>     >> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>     >> University of Oxford,             Tel:  +44 1865 272861 (self)
>     >> 1 South Parks Road,                     +44 1865 272866 (PA)
>     >> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>     >> 
>     >> ______________________________________________
>     >> R-help at r-project.org mailing list
>     >> https://stat.ethz.ch/mailman/listinfo/r-help
>     >> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>     >> and provide commented, minimal, self-contained, reproducible code.
> 
>     TZ> ______________________________________________
>     TZ> R-help at r-project.org mailing list
>     TZ> https://stat.ethz.ch/mailman/listinfo/r-help
>     TZ> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>     TZ> and provide commented, minimal, self-contained, reproducible code.
> 
> ______________________________________________
> R-help at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From ripley at stats.ox.ac.uk  Thu Jan 22 16:08:43 2009
From: ripley at stats.ox.ac.uk (Brian D Ripley)
Date: Thu, 22 Jan 2009 15:08:43 +0000 (GMT)
Subject: [Rd] [R] pdf() and pch problems
In-Reply-To: <1232635316.1363.18.camel@prometheus.geog.ucl.ac.uk>
References: <49785A81.1030504@cam.ac.uk>
	<alpine.LFD.2.00.0901221143390.27217@toucan.stats.ox.ac.uk>
	<20090122145237.0o1rr6my68s40ggk@webmail.unibas.ch>
	<18808.32996.632409.272360@stat.math.ethz.ch>
	<1232635316.1363.18.camel@prometheus.geog.ucl.ac.uk>
Message-ID: <alpine.LFD.2.00.0901221503280.10586@toucan.stats.ox.ac.uk>

On Thu, 22 Jan 2009, Gavin Simpson wrote:

> On Thu, 2009-01-22 at 15:21 +0100, Martin Maechler wrote:
>>>>>>> "TZ" == T Zumbrunn <T.Zumbrunn at unibas.ch>
>>>>>>>     on Thu, 22 Jan 2009 14:52:37 +0100 writes:
>>
>>     TZ> Quoting Brian D Ripley <ripley at stats.ox.ac.uk>:
>>    >> On Thu, 22 Jan 2009, Robin Hankin wrote:
>>    >>
>>    >>> Hi
>>    >>>
>>    >>> R-2.8.1,   Suse 11.1
>>    >>>
>>    >>> I'm having problems with pdf(). In the following
>>    >>> transcript, file 'f.pdf' does not use the expected symbols for the plot.
>>    >>> It uses a 'q' letter instead of the open circle I get when
>>    >>> viewing the graphics window.
>>    >>>
>>    >>> I also get the same under  r47678.
>>    >>>
>>    >>> Does anyone else get this?
>>    >>
>>    >> Yes, if you use a broken PDF viewer (you have not told us yours). From ?pdf
>>    >>
>>    >> useDingbats: logical.  Should small circles be rendered _via_ the
>>    >> Dingbats font?  Defaults to true, which produces smaller and
>>    >> better output - this is provided for those who insist on
>>    >> using broken PDF viewers.
>>    >>
>>    >> I get the problem in evince but not acroread in F10.
>>
>>     TZ> The problem is caused by missing fontconfig rules in openSUSE 11.1
>>     TZ> (that the PDF library poppler depends on). I reported the problem a
>>     TZ> while ago here http://bugs.freedesktop.org/show_bug.cgi?id=18002
>>     TZ> (instructions on how to fix the issue are included) and filed a bug at
>>     TZ> the openSUSE bug database
>>     TZ> https://bugzilla.novell.com/show_bug.cgi?id=434676. The bug was
>>     TZ> closed, but I reopened it.
>>
>> That's interesting, thank you very much, Thomas, for the extra
>> explanation!
>>
>> As you know (but your text above could be read differently) this
>> bug ... quite long standing! ... seems to be much wider spread
>> than just (Open)SuSE.  I have seen and still see it on Redhat
>> (RHEL 5) and many Ubuntu versions too.
>>
>> And indeed, the workaround recommended (somewhere) in the above
>> URL is working for me too:
>>
>> Add the following (without the "-----" lines) to your
>> ~/.fonts.conf file (or create such a file) :
>> --snip---------------------------------------------------------
>> <alias binding="same">
>>  <family>ZapfDingbats</family>
>>  <accept><family>Dingbats</family></accept>
>> </alias>
>> --snip---------------------------------------------------------
>>
>> Martin Maechler, ETH Zurich
>
> [Moved to R-Devel]
>
> Same problem on Fedora 8 through 10. The snippet Martin shows fixes the
> problem on those systems also. It would be very useful to have this
> documented somewhere either as a note in ?pdf or in perhaps in the R
> Installation and Administration Manual, until such a time as distro's
> fix these problems.
>
> To that end I'll also be filing a bug against fedora 10 when I get home
> (and confirm it is still there) as my system has an entry for 'Zapf
> Dingbats' but not 'ZapfDingbats' which causes the problems on my boxes.

It is there on my F10 system (brand-new, installed last night).

> Great to finally have worked around this issue --- not that it was R's
> fault. I had completely missed the useDingbats argument of pdf(). The Rd
> file does however make it sound that the default (TRUE) is there to fix
> the problem of broken PDF viewers, where surely it is the FALSE state
> that fixes the problem, or perhaps what was intended was that it is the
> argument itself that was provided to fix buggy viewers.

The argument itself.  (This is not the only issue in PDF viewers, 
BTW, but here xpdf and gs both also work correctly.)

> I'd be happy to patch any/all of those sources if someone in R Core
> would be willing to take a lot and possibly apply them?

Send them to me and I'll take a look.

>
> All the best,
>
> G
>
>>
>>
>>
>>    >>> le112:~/scratch/R-2.8.1% R --vanilla --quiet
>>    >>>> pdf(file='~/f.pdf')
>>    >>>> plot(1:10 , pch=1)
>>    >>>> dev.off()
>>    >>> null device
>>    >>> 1
>>    >>>> sessionInfo()
>>    >>> R version 2.8.1 (2008-12-22)
>>    >>> i686-pc-linux-gnu
>>    >>>
>>    >>> locale:
>>    >>> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>>    >>>
>>    >>> attached base packages:
>>    >>> [1] stats     graphics  grDevices utils     datasets  methods
>>    >>> base    > q()
>>    >>> le112:~/scratch/R-2.8.1%
>>    >>>
>>    >>>
>>    >>>
>>    >>>
>>    >>>
>>    >>>
>>    >>>
>>    >>>
>>    >>> --
>>    >>> Robin K. S. Hankin
>>    >>> Uncertainty Analyst
>>    >>> University of Cambridge
>>    >>> 19 Silver Street
>>    >>> Cambridge CB3 9EP
>>    >>> 01223-764877
>>    >>>
>>    >>> ______________________________________________
>>    >>> R-help at r-project.org mailing list
>>    >>> https://stat.ethz.ch/mailman/listinfo/r-help
>>    >>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>>    >>> and provide commented, minimal, self-contained, reproducible code.
>>    >>>
>>    >>
>>    >> --
>>    >> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>>    >> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>>    >> University of Oxford,             Tel:  +44 1865 272861 (self)
>>    >> 1 South Parks Road,                     +44 1865 272866 (PA)
>>    >> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>    >>
>>    >> ______________________________________________
>>    >> R-help at r-project.org mailing list
>>    >> https://stat.ethz.ch/mailman/listinfo/r-help
>>    >> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>>    >> and provide commented, minimal, self-contained, reproducible code.
>>
>>     TZ> ______________________________________________
>>     TZ> R-help at r-project.org mailing list
>>     TZ> https://stat.ethz.ch/mailman/listinfo/r-help
>>     TZ> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>>     TZ> and provide commented, minimal, self-contained, reproducible code.
>>
>> ______________________________________________
>> R-help at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
> -- 
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
> ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
> Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
> Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
> UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From scionforbai at gmail.com  Thu Jan 22 16:30:23 2009
From: scionforbai at gmail.com (Scionforbai)
Date: Thu, 22 Jan 2009 16:30:23 +0100
Subject: [Rd] Accessing a c-level complicated structure from R
Message-ID: <e9ee1f0a0901220730k7013c02sbac7cba06ce459c8@mail.gmail.com>

Hello,
R-devel seems to be the appropriated list for what I'm to ask: soory
if I'm wrong. I am a c newbie but nevertheless I am trying to 'couple'
an extern c software with R. The compiled library is actually a
stand-alone c program, which uses text file for input and output. It
uses *lots* of differents and (to me) rather complicated and nested
"struct"s to represent data for intern calculation. I want to make
this program a -shared lib to use with R.
I have (among many others) the following question: can I access from R
a c-level defined struct, as input/output of my .C called function? If
yes... how?

Any clue, manual, tutorial on c programming with R (other than R-exts
and R-ints),  and hint is greatly appreciated...
Thanks,
Scion


From gavin.simpson at ucl.ac.uk  Thu Jan 22 16:52:15 2009
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Thu, 22 Jan 2009 15:52:15 +0000
Subject: [Rd] [R] pdf() and pch problems
In-Reply-To: <alpine.LFD.2.00.0901221503280.10586@toucan.stats.ox.ac.uk>
References: <49785A81.1030504@cam.ac.uk>
	<alpine.LFD.2.00.0901221143390.27217@toucan.stats.ox.ac.uk>
	<20090122145237.0o1rr6my68s40ggk@webmail.unibas.ch>
	<18808.32996.632409.272360@stat.math.ethz.ch>
	<1232635316.1363.18.camel@prometheus.geog.ucl.ac.uk>
	<alpine.LFD.2.00.0901221503280.10586@toucan.stats.ox.ac.uk>
Message-ID: <1232639535.1363.33.camel@prometheus.geog.ucl.ac.uk>

On Thu, 2009-01-22 at 15:08 +0000, Brian D Ripley wrote:
> On Thu, 22 Jan 2009, Gavin Simpson wrote:
> 
> > On Thu, 2009-01-22 at 15:21 +0100, Martin Maechler wrote:
> >>>>>>> "TZ" == T Zumbrunn <T.Zumbrunn at unibas.ch>
> >>>>>>>     on Thu, 22 Jan 2009 14:52:37 +0100 writes:
> >>
> >>     TZ> Quoting Brian D Ripley <ripley at stats.ox.ac.uk>:
> >>    >> On Thu, 22 Jan 2009, Robin Hankin wrote:
<snip />
> 
> > I'd be happy to patch any/all of those sources if someone in R Core
> > would be willing to take a lot and possibly apply them?
> 
> Send them to me and I'll take a look.

Thanks Brian,

Attached is a patch to pdf.Rd against the SVN trunk, revision 47685,
which modifies the emphasis in the useDingbats argument and adds
information about the workaround on unix systems only. Please edit/use
as you see fit.

If this is sufficient to document the issue and workaround I won't patch
R-admin.texi as there doesn't appear to be anywhere suitable to insert
this note in that file - most platform specific information appears to
pertain to /building/ R not tweaking your system to work around a
problem whilst using R.

In case the attachment gets mangled somewhere on long the line, you can
grab the patch from:

http://www.homepages.ucl.ac.uk/~ucfagls/files/pdf.Rd.patch

All the best,

Gavin

> 
> >
> > All the best,
> >
> > G
> >
> >>
> >>
> >>
> >>    >>> le112:~/scratch/R-2.8.1% R --vanilla --quiet
> >>    >>>> pdf(file='~/f.pdf')
> >>    >>>> plot(1:10 , pch=1)
> >>    >>>> dev.off()
> >>    >>> null device
> >>    >>> 1
> >>    >>>> sessionInfo()
> >>    >>> R version 2.8.1 (2008-12-22)
> >>    >>> i686-pc-linux-gnu
> >>    >>>
> >>    >>> locale:
> >>    >>> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
> >>    >>>
> >>    >>> attached base packages:
> >>    >>> [1] stats     graphics  grDevices utils     datasets  methods
> >>    >>> base    > q()
> >>    >>> le112:~/scratch/R-2.8.1%
> >>    >>>
> >>    >>>
> >>    >>>
> >>    >>>
> >>    >>>
> >>    >>>
> >>    >>>
> >>    >>>
> >>    >>> --
> >>    >>> Robin K. S. Hankin
> >>    >>> Uncertainty Analyst
> >>    >>> University of Cambridge
> >>    >>> 19 Silver Street
> >>    >>> Cambridge CB3 9EP
> >>    >>> 01223-764877
> >>    >>>
> >>    >>> ______________________________________________
> >>    >>> R-help at r-project.org mailing list
> >>    >>> https://stat.ethz.ch/mailman/listinfo/r-help
> >>    >>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> >>    >>> and provide commented, minimal, self-contained, reproducible code.
> >>    >>>
> >>    >>
> >>    >> --
> >>    >> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> >>    >> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> >>    >> University of Oxford,             Tel:  +44 1865 272861 (self)
> >>    >> 1 South Parks Road,                     +44 1865 272866 (PA)
> >>    >> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> >>    >>
> >>    >> ______________________________________________
> >>    >> R-help at r-project.org mailing list
> >>    >> https://stat.ethz.ch/mailman/listinfo/r-help
> >>    >> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> >>    >> and provide commented, minimal, self-contained, reproducible code.
> >>
> >>     TZ> ______________________________________________
> >>     TZ> R-help at r-project.org mailing list
> >>     TZ> https://stat.ethz.ch/mailman/listinfo/r-help
> >>     TZ> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> >>     TZ> and provide commented, minimal, self-contained, reproducible code.
> >>
> >> ______________________________________________
> >> R-help at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-help
> >> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> >> and provide commented, minimal, self-contained, reproducible code.
> > -- 
> > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
> > ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
> > Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
> > Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
> > UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
> > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pdf.Rd.patch
Type: text/x-patch
Size: 1778 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090122/f9f0438f/attachment.bin>

From antonio.fabio at gmail.com  Thu Jan 22 17:31:22 2009
From: antonio.fabio at gmail.com (Antonio, Fabio Di Narzo)
Date: Thu, 22 Jan 2009 11:31:22 -0500
Subject: [Rd] Accessing a c-level complicated structure from R
In-Reply-To: <e9ee1f0a0901220730k7013c02sbac7cba06ce459c8@mail.gmail.com>
References: <e9ee1f0a0901220730k7013c02sbac7cba06ce459c8@mail.gmail.com>
Message-ID: <b0808fdc0901220831j32484413v79c8575b6d9d91d@mail.gmail.com>

Hi.

2009/1/22 Scionforbai <scionforbai at gmail.com>:
> Hello,
> R-devel seems to be the appropriated list for what I'm to ask: soory
> if I'm wrong. I am a c newbie but nevertheless I am trying to 'couple'
> an extern c software with R. The compiled library is actually a
> stand-alone c program, which uses text file for input and output. It
> uses *lots* of differents and (to me) rather complicated and nested
> "struct"s to represent data for intern calculation. I want to make
> this program a -shared lib to use with R.
> I have (among many others) the following question: can I access from R
> a c-level defined struct, as input/output of my .C called function? If
> yes... how?
>

If you have to pass these data structures up to R you have to use the
.Call interface and wrap your C objects in an extern ptr R obj. That's
described in  "Writing R extensions".

Let me note you're undertaking a major work. If the software isn't
conceived as being used as a shared library, it can be much work to
translate it that way.
You can consider to use the external program as is, i.e. a stand-alone
program, and use temp text files for input-output. You can wrap it in
convenient R functions, and keep all that invisible to the end user.
This would require much less work... That's for instance how RTisean
and some BUGS related CRAN packages works, and I'm sure there are
others there.

> Any clue, manual, tutorial on c programming with R (other than R-exts
> and R-ints),  and hint is greatly appreciated...
Actually, R-exts has the info you need. Look at it more carefully. You
don't even need R-ints.

HTH,
a.f.

> Thanks,
> Scion
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Antonio, Fabio Di Narzo
Ph.D. student at
Department of Statistical Sciences
University of Bologna, Italy


From tplate at acm.org  Thu Jan 22 19:01:21 2009
From: tplate at acm.org (Tony Plate)
Date: Thu, 22 Jan 2009 11:01:21 -0700
Subject: [Rd] x <- 1:2; dim(x) <- 2? A vector or not?
In-Reply-To: <18802.19793.445515.400975@cmath-5.math.ethz.ch>
References: <59d7961d0901121243j6c5c0fcn5836d94a90666623@mail.gmail.com>	<alpine.OSX.1.00.0901130744310.32363@tystie.local>	<59d7961d0901130754j335c480fi673346cd20e031e@mail.gmail.com>	<496CC8B8.6060606@pburns.seanet.com>	<18800.40724.985949.449350@stat.math.ethz.ch>	<4970E99C.9040907@acm.org>
	<18802.19793.445515.400975@cmath-5.math.ethz.ch>
Message-ID: <4978B471.70506@acm.org>

Martin Maechler wrote:
>>>>>> "TP" == Tony Plate <tplate at acm.org>
>>>>>>     on Fri, 16 Jan 2009 13:10:04 -0700 writes:
>>>>>>             
>
>     TP> Martin Maechler wrote:
>     >>>>>>> "PatB" == Patrick Burns <pburns at pburns.seanet.com>
>     >>>>>>> on Tue, 13 Jan 2009 17:00:40 +0000 writes:
>     >>>>>>> 
>     >> 
>     PatB> Henrik Bengtsson wrote:
>     >> >> Hi.
>     >> >> 
>     >> >> On Mon, Jan 12, 2009 at 11:58 PM, Prof Brian Ripley
>     >> >> <ripley at stats.ox.ac.uk> wrote:
>     >> >> 
>     >> >>> What you have is a one-dimensional array: they crop up
>     >> >>> in R most often from table() in my experience.
>     >> >>> 
>     >> >>> 
>     >> >>>> f <- table(rpois(100, 4)) str(f)
>     >> >>>> 
>     >> >>> 'table' int [, 1:10] 2 6 18 21 13 16 13 4 3 4 - attr(*,
>     >> >>> "dimnames")=List of 1 ..$ : chr [1:10] "0" "1" "2" "3"
>     >> >>> ...
>     >> >>> 
>     >> >>> and yes, f is an atmoic vector and yes, str()'s notation
>     >> >>> is confusing here but if it did [1:10] you would not
>     >> >>> know it was an array.  I recall discussing this with
>     >> >>> Martin Maechler (str's author) last century, and I've
>     >> >>> just checked that R 2.0.0 did the same.
>     >> >>> 
>     >> >>> The place in which one-dimensional arrays differ from
>     >> >>> normal vectors is how names are handled: notice that my
>     >> >>> example has dimnames not names, and ?names says
>     >> >>> 
>     >> >>> For a one-dimensional array the 'names' attribute really
>     >> >>> is 'dimnames[[1]]'.
>     >> >>> 
>     >> >> 
>     >> >> Thanks for this explanation.  One could then argue that
>     >> >> [1:10,] is somewhat better than [,1:10], but that is just polish.
>     >> 
>     >> yes.  And honestly I don't remember anymore why I chose the
>     >> "[,1:n]" notation.  It definitely was there already before R
>     >> came into existence, as  S  also has had one-dimensional arrays,
>     >> and I programmed the first version of str() in 1990.
>     >> 
>     PatB> Perhaps it could be:
>     >> 
>     PatB> [1:10(,)]
>     >> 
>     PatB> That is weird enough that it should not lead people to
>     PatB> believe that it is a matrix.  But might prompt them a
>     PatB> bit in that direction.
>     >> 
>     >> Well, str() was always aimed a bit at experienced S (and R)
>     >> users, and I had always aimed somewhat to keep it's output
>     >> "compact".  I'm quite astonished that the OP didn't know about
>     >> 1D arrays in spite of the many years he's been using R.
>     >> Would a wierd solution like the above have helped?
>     >> 
>     >> At the moment, I'd tend to keep it "as is" if only just for
>     >> historical reminescence, but I can be convinced to change the
>     >> current "tendency" ... 
>     >> 
>     >> Martin Maechler, ETH Zurich  
>     >> 
>     TP> What about just including "(1d-array)", something like this
>     >> str(f)
>     TP> 'table' int [1:10](1d array) 5 5 9 23 26 16 9 4 2 1
>     TP> - attr(*, "dimnames")=List of 1
>     TP> ..$ : chr [1:10] "0" "1" "2" "3" ...
>     >> 
>     TP> only 9 extra characters for a rare case, and much, much less cryptic?
>
> well,.. the next text request is to use
>  "character" instead of "chr", only 6 extra characters ....
>
> -> no way:  str() has its very concise "style" and should keep
> that.
>   
Brevity is good, but clarity is important too.   The output of str is 
usually decipherable, but not so much in this case.  It's easy to 
dismiss suggestions like replacing "chr" with "character" - the increase 
in clarity would be minimal.  However, the potential increase in clarity 
for a 1-d array is significant - the decrease in brevity is at question 
here. Given the rarity of the case it seems like a decent tradeoff to 
add "(1d-array)" (one could even just write "(1d)").   1-d arrays are 
sufficiently rare that no concise and clear method of indicating them 
using brackets or other symbols has arisen. You did say you "can be 
convinced to change" it, but I won't attempt beyond this! :-)

best,

Tony Plate
> Martin
>
>     TP> -- Tony Plate
>     >> 
>     >> 
>     PatB> Patrick Burns patrick at burns-stat.com +44 (0)20 8525
>     PatB> 0696 http://www.burns-stat.com (home of "The R
>     PatB> Inferno" and "A Guide for the Unwilling S User")
>     >> >> /Henrik
>     >> >> 
>     >> >> 
>     >> >>> I think these days we have enough internal glue in place
>     >> >>> that an end user would not notice the difference (but
>     >> >>> those working at C level with R objects may need to
>     >> >>> know).
>     >> >>> 
>     >> >>> On Mon, 12 Jan 2009, Henrik Bengtsson wrote:
>     >> >>> 
>     >> >>> 
>     >> >>>> Ran into the follow intermediate case in an external
>     >> >>>> package (w/ recent R v2.8.1 patched and R v2.9.0
>     >> >>>> devel):
>     >> >>>> 
>     >> >>>> 
>     >> >>>>> x <- 1:2 dim(x) <- 2 dim(x)
>     >> >>>>> 
>     >> >>>> [1] 2
>     >> >>>> 
>     >> >>>>> x
>     >> >>>>> 
>     >> >>>> [1] 1 2
>     >> >>>> 
>     >> >>>>> str(x)
>     >> >>>>> 
>     >> >>>> int [, 1:2] 1 2
>     >> >>>> 
>     >> >>>>> nrow(x)
>     >> >>>>> 
>     >> >>>> [1] 2
>     >> >>>> 
>     >> >>>>> ncol(x)
>     >> >>>>> 
>     >> >>>> [1] NA
>     >> >>>> 
>     >> >>>>> is.vector(x)
>     >> >>>>> 
>     >> >>>> [1] FALSE
>     >> >>>> 
>     >> >>>>> is.matrix(x)
>     >> >>>>> 
>     >> >>>> [1] FALSE
>     >> >>>> 
>     >> >>>>> is.array(x)
>     >> >>>>> 
>     >> >>>> [1] TRUE
>     >> >>>> 
>     >> >>>>> x[1]
>     >> >>>>> 
>     >> >>>> [1] 1
>     >> >>>> 
>     >> >>>>> x[,1]
>     >> >>>>> 
>     >> >>>> Error in x[, 1] : incorrect number of dimensions
>     >> >>>> 
>     >> >>>>> x[1,]
>     >> >>>>> 
>     >> >>>> Error in x[1, ] : incorrect number of dimensions
>     >> >>>> 
>     >> >>>> Is str() treating single-dimension arrays incorrectly?
>     >> >>>> 
>     >> >>>> What does it mean to have a single dimension this way?
>     >> >>>> Should it equal a vector?  I am aware of "is.vector
>     >> >>>> returns FALSE if x has any attributes except names".
>     >> >>>> 
>     >> >>>> /Henrik
>     >> >>>> 
>     >> >>>> ______________________________________________
>     >> >>>> R-devel at r-project.org mailing list
>     >> >>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>     >> >>>> 
>     >> >>>> 
>     >> >>> --
>     >> 
>     >>>> Brian D. Ripley, ripley at stats.ox.ac.uk Professor of Applied
>     >>>> 
>     >> >>> Statistics, http://www.stats.ox.ac.uk/~ripley/
>     >> >>> University of Oxford, Tel: +44 1865 272861 (self) 1
>     >> >>> South Parks Road, +44 1865 272866 (PA) Oxford OX1 3TG,
>     >> >>> UK Fax: +44 1865 272595
>     >> >>> 
>     >> >>> ______________________________________________
>     >> >>> R-devel at r-project.org mailing list
>     >> >>> https://stat.ethz.ch/mailman/listinfo/r-devel
>     >> >>> 
>     >> >>> 
>     >> >> 
>     >> 
>     >>> ______________________________________________
>     >>> 
>     >> >> R-devel at r-project.org mailing list
>     >> >> https://stat.ethz.ch/mailman/listinfo/r-devel
>     >> >> 
>     >> >> 
>     >> >> 
>     >> 
>     >> ______________________________________________
>     PatB> R-devel at r-project.org mailing list
>     PatB> https://stat.ethz.ch/mailman/listinfo/r-devel
>     >> 
>     >> ______________________________________________
>     >> R-devel at r-project.org mailing list
>     >> https://stat.ethz.ch/mailman/listinfo/r-devel
>     >> 
>     >> 
>
>     TP> ______________________________________________
>     TP> R-devel at r-project.org mailing list
>     TP> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From maechler at stat.math.ethz.ch  Fri Jan 23 14:36:47 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 23 Jan 2009 14:36:47 +0100
Subject: [Rd] str(<1d-array>)
In-Reply-To: <4978B471.70506@acm.org>
References: <59d7961d0901121243j6c5c0fcn5836d94a90666623@mail.gmail.com>
	<alpine.OSX.1.00.0901130744310.32363@tystie.local>
	<59d7961d0901130754j335c480fi673346cd20e031e@mail.gmail.com>
	<496CC8B8.6060606@pburns.seanet.com>
	<18800.40724.985949.449350@stat.math.ethz.ch>
	<4970E99C.9040907@acm.org>
	<18802.19793.445515.400975@cmath-5.math.ethz.ch>
	<4978B471.70506@acm.org>
Message-ID: <18809.51183.231595.496032@stat.math.ethz.ch>

>>>>> "TP" == Tony Plate <tplate at acm.org>
>>>>>     on Thu, 22 Jan 2009 11:01:21 -0700 writes:

    TP> Martin Maechler wrote:
    >>>>>>> "TP" == Tony Plate <tplate at acm.org>
    >>>>>>> on Fri, 16 Jan 2009 13:10:04 -0700 writes:
    >>>>>>> 
    >> 
    TP> Martin Maechler wrote:
    >> >>>>>>> "PatB" == Patrick Burns <pburns at pburns.seanet.com>
    >> >>>>>>> on Tue, 13 Jan 2009 17:00:40 +0000 writes:
    >> >>>>>>> 
    >> >> 
    PatB> Henrik Bengtsson wrote:
    >> >> >> Hi.
    >> >> >> 
    >> >> >> On Mon, Jan 12, 2009 at 11:58 PM, Prof Brian Ripley
    >> >> >> <ripley at stats.ox.ac.uk> wrote:
    >> >> >> 
    >> >> >>> What you have is a one-dimensional array: they crop up
    >> >> >>> in R most often from table() in my experience.
    >> >> >>> 
    >> >> >>> 
    >> >> >>>> f <- table(rpois(100, 4)) str(f)
    >> >> >>>> 
    >> >> >>> 'table' int [, 1:10] 2 6 18 21 13 16 13 4 3 4 - attr(*,
    >> >> >>> "dimnames")=List of 1 ..$ : chr [1:10] "0" "1" "2" "3"
    >> >> >>> ...
    >> >> >>> 
    >> >> >>> and yes, f is an atmoic vector and yes, str()'s notation
    >> >> >>> is confusing here but if it did [1:10] you would not
    >> >> >>> know it was an array.  I recall discussing this with
    >> >> >>> Martin Maechler (str's author) last century, and I've
    >> >> >>> just checked that R 2.0.0 did the same.
    >> >> >>> 
    >> >> >>> The place in which one-dimensional arrays differ from
    >> >> >>> normal vectors is how names are handled: notice that my
    >> >> >>> example has dimnames not names, and ?names says
    >> >> >>> 
    >> >> >>> For a one-dimensional array the 'names' attribute really
    >> >> >>> is 'dimnames[[1]]'.
    >> >> >>> 
    >> >> >> 
    >> >> >> Thanks for this explanation.  One could then argue that
    >> >> >> [1:10,] is somewhat better than [,1:10], but that is just polish.
    >> >> 
    >> >> yes.  And honestly I don't remember anymore why I chose the
    >> >> "[,1:n]" notation.  It definitely was there already before R
    >> >> came into existence, as  S  also has had one-dimensional arrays,
    >> >> and I programmed the first version of str() in 1990.
    >> >> 
    PatB> Perhaps it could be:
    >> >> 
    PatB> [1:10(,)]

    PatB> That is weird enough that it should not lead people to
    PatB> believe that it is a matrix.  But might prompt them a
    PatB> bit in that direction.
    >> >> 
    >> >> Well, str() was always aimed a bit at experienced S (and R)
    >> >> users, and I had always aimed somewhat to keep it's output
    >> >> "compact".  I'm quite astonished that the OP didn't know about
    >> >> 1D arrays in spite of the many years he's been using R.
    >> >> Would a wierd solution like the above have helped?
    >> >> 
    >> >> At the moment, I'd tend to keep it "as is" if only just for
    >> >> historical reminescence, but I can be convinced to change the
    >> >> current "tendency" ... 
    >> >> 
    >> >> Martin Maechler, ETH Zurich  
    >> >> 
    TP> What about just including "(1d-array)", something like this
    >> >> str(f)
    TP> 'table' int [1:10](1d array) 5 5 9 23 26 16 9 4 2 1
    TP> - attr(*, "dimnames")=List of 1
    TP> ..$ : chr [1:10] "0" "1" "2" "3" ...
    >> >> 
    TP> only 9 extra characters for a rare case, and much, much less cryptic?
    >> 
    >> well,.. the next text request is to use
    >> "character" instead of "chr", only 6 extra characters ....
    >> 
    >>  -> no way:  str() has its very concise "style" and should keep that.
    >> 
    TP> Brevity is good, but clarity is important too.   The output of str is 
    TP> usually decipherable, but not so much in this case.  It's easy to 
    TP> dismiss suggestions like replacing "chr" with "character" - the increase 
    TP> in clarity would be minimal.  However, the potential increase in clarity 
    TP> for a 1-d array is significant - the decrease in brevity is at question 
    TP> here. Given the rarity of the case it seems like a decent tradeoff to 
    TP> add "(1d-array)" (one could even just write "(1d)").   1-d arrays are 
    TP> sufficiently rare that no concise and clear method of indicating them 
    TP> using brackets or other symbols has arisen. You did say you "can be 
    TP> convinced to change" it, but I won't attempt beyond this! :-)

well, "still can be .." .....

So you currently propose to replace
     "int [,1:10] 5 5 9 23 26 16 9 4 2 1"
by
     "int [1:10](1d) 5 5 9 23 26 16 9 4 2 1"
where Pat had
     "int [1:10(,)] 5 5 9 23 26 16 9 4 2 1"

Since the [.....] is where we specify the dimensionality of all
arrays in str(), I'd like to try something where things remain
inside "[....]" as with Pat's version or e.g., with

     "int [1:10/1d] 5 5 9 23 26 16 9 4 2 1"

Opinions, further proposals ?

Martin


    PatB> Patrick Burns patrick at burns-stat.com +44 (0)20 8525
    PatB> 0696 http://www.burns-stat.com (home of "The R
    PatB> Inferno" and "A Guide for the Unwilling S User")
    >> >> >> /Henrik
    >> >> >> 
    >> >> >> 
    >> >> >>> I think these days we have enough internal glue in place
    >> >> >>> that an end user would not notice the difference (but
    >> >> >>> those working at C level with R objects may need to
    >> >> >>> know).
    >> >> >>> 
    >> >> >>> On Mon, 12 Jan 2009, Henrik Bengtsson wrote:
    >> >> >>> 
    >> >> >>> 
    >> >> >>>> Ran into the follow intermediate case in an external
    >> >> >>>> package (w/ recent R v2.8.1 patched and R v2.9.0
    >> >> >>>> devel):
    >> >> >>>> 
    >> >> >>>> 
    >> >> >>>>> x <- 1:2 dim(x) <- 2 dim(x)
    >> >> >>>>> 
    >> >> >>>> [1] 2
    >> >> >>>> 
    >> >> >>>>> x
    >> >> >>>>> 
    >> >> >>>> [1] 1 2
    >> >> >>>> 
    >> >> >>>>> str(x)
    >> >> >>>>> 
    >> >> >>>> int [, 1:2] 1 2
    >> >> >>>> 
    >> >> >>>>> nrow(x)
    >> >> >>>>> 
    >> >> >>>> [1] 2
    >> >> >>>> 
    >> >> >>>>> ncol(x)
    >> >> >>>>> 
    >> >> >>>> [1] NA
    >> >> >>>> 
    >> >> >>>>> is.vector(x)
    >> >> >>>>> 
    >> >> >>>> [1] FALSE
    >> >> >>>> 
    >> >> >>>>> is.matrix(x)
    >> >> >>>>> 
    >> >> >>>> [1] FALSE
    >> >> >>>> 
    >> >> >>>>> is.array(x)
    >> >> >>>>> 
    >> >> >>>> [1] TRUE
    >> >> >>>> 
    >> >> >>>>> x[1]
    >> >> >>>>> 
    >> >> >>>> [1] 1
    >> >> >>>> 
    >> >> >>>>> x[,1]
    >> >> >>>>> 
    >> >> >>>> Error in x[, 1] : incorrect number of dimensions
    >> >> >>>> 
    >> >> >>>>> x[1,]
    >> >> >>>>> 
    >> >> >>>> Error in x[1, ] : incorrect number of dimensions
    >> >> >>>> 
    >> >> >>>> Is str() treating single-dimension arrays incorrectly?
    >> >> >>>> 
    >> >> >>>> What does it mean to have a single dimension this way?
    >> >> >>>> Should it equal a vector?  I am aware of "is.vector
    >> >> >>>> returns FALSE if x has any attributes except names".
    >> >> >>>> 
    >> >> >>>> /Henrik
    >> >> >>>> 
    >> >> >>>> ______________________________________________
    >> >> >>>> R-devel at r-project.org mailing list
    >> >> >>>> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> >> >>>> 
    >> >> >>>> 
    >> >> >>> --
    >> >> 
    >> >>>> Brian D. Ripley, ripley at stats.ox.ac.uk Professor of Applied
    >> >>>> 
    >> >> >>> Statistics, http://www.stats.ox.ac.uk/~ripley/
    >> >> >>> University of Oxford, Tel: +44 1865 272861 (self) 1
    >> >> >>> South Parks Road, +44 1865 272866 (PA) Oxford OX1 3TG,
    >> >> >>> UK Fax: +44 1865 272595
    >> >> >>> 
    >> >> >>> ______________________________________________
    >> >> >>> R-devel at r-project.org mailing list
    >> >> >>> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> >> >>> 
    >> >> >>> 
    >> >> >> 
    >> >> 
    >> >>> ______________________________________________
    >> >>> 
    >> >> >> R-devel at r-project.org mailing list
    >> >> >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> >> >> 
    >> >> >> 
    >> >> >> 
    >> >> 
    >> >> ______________________________________________
    PatB> R-devel at r-project.org mailing list
    PatB> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> >> 
    >> >> ______________________________________________
    >> >> R-devel at r-project.org mailing list
    >> >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> >> 
    >> >> 
    >> 
    TP> ______________________________________________
    TP> R-devel at r-project.org mailing list
    TP> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 
    >> ______________________________________________
    >> R-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 
    >>


From marc_schwartz at comcast.net  Fri Jan 23 15:41:38 2009
From: marc_schwartz at comcast.net (Marc Schwartz)
Date: Fri, 23 Jan 2009 08:41:38 -0600
Subject: [Rd] str(<1d-array>)
In-Reply-To: <18809.51183.231595.496032@stat.math.ethz.ch>
References: <59d7961d0901121243j6c5c0fcn5836d94a90666623@mail.gmail.com>	<alpine.OSX.1.00.0901130744310.32363@tystie.local>	<59d7961d0901130754j335c480fi673346cd20e031e@mail.gmail.com>	<496CC8B8.6060606@pburns.seanet.com>	<18800.40724.985949.449350@stat.math.ethz.ch>	<4970E99C.9040907@acm.org>	<18802.19793.445515.400975@cmath-5.math.ethz.ch>	<4978B471.70506@acm.org>
	<18809.51183.231595.496032@stat.math.ethz.ch>
Message-ID: <4979D722.50404@comcast.net>

on 01/23/2009 07:36 AM Martin Maechler wrote:
>>>>>> "TP" == Tony Plate <tplate at acm.org>
>>>>>>     on Thu, 22 Jan 2009 11:01:21 -0700 writes:
> 
>     TP> Martin Maechler wrote:
>     >>>>>>> "TP" == Tony Plate <tplate at acm.org>
>     >>>>>>> on Fri, 16 Jan 2009 13:10:04 -0700 writes:
>     >>>>>>> 
>     >> 
>     TP> Martin Maechler wrote:
>     >> >>>>>>> "PatB" == Patrick Burns <pburns at pburns.seanet.com>
>     >> >>>>>>> on Tue, 13 Jan 2009 17:00:40 +0000 writes:
>     >> >>>>>>> 
>     >> >> 
>     PatB> Henrik Bengtsson wrote:
>     >> >> >> Hi.
>     >> >> >> 
>     >> >> >> On Mon, Jan 12, 2009 at 11:58 PM, Prof Brian Ripley
>     >> >> >> <ripley at stats.ox.ac.uk> wrote:
>     >> >> >> 
>     >> >> >>> What you have is a one-dimensional array: they crop up
>     >> >> >>> in R most often from table() in my experience.
>     >> >> >>> 
>     >> >> >>> 
>     >> >> >>>> f <- table(rpois(100, 4)) str(f)
>     >> >> >>>> 
>     >> >> >>> 'table' int [, 1:10] 2 6 18 21 13 16 13 4 3 4 - attr(*,
>     >> >> >>> "dimnames")=List of 1 ..$ : chr [1:10] "0" "1" "2" "3"
>     >> >> >>> ...
>     >> >> >>> 
>     >> >> >>> and yes, f is an atmoic vector and yes, str()'s notation
>     >> >> >>> is confusing here but if it did [1:10] you would not
>     >> >> >>> know it was an array.  I recall discussing this with
>     >> >> >>> Martin Maechler (str's author) last century, and I've
>     >> >> >>> just checked that R 2.0.0 did the same.
>     >> >> >>> 
>     >> >> >>> The place in which one-dimensional arrays differ from
>     >> >> >>> normal vectors is how names are handled: notice that my
>     >> >> >>> example has dimnames not names, and ?names says
>     >> >> >>> 
>     >> >> >>> For a one-dimensional array the 'names' attribute really
>     >> >> >>> is 'dimnames[[1]]'.
>     >> >> >>> 
>     >> >> >> 
>     >> >> >> Thanks for this explanation.  One could then argue that
>     >> >> >> [1:10,] is somewhat better than [,1:10], but that is just polish.
>     >> >> 
>     >> >> yes.  And honestly I don't remember anymore why I chose the
>     >> >> "[,1:n]" notation.  It definitely was there already before R
>     >> >> came into existence, as  S  also has had one-dimensional arrays,
>     >> >> and I programmed the first version of str() in 1990.
>     >> >> 
>     PatB> Perhaps it could be:
>     >> >> 
>     PatB> [1:10(,)]
> 
>     PatB> That is weird enough that it should not lead people to
>     PatB> believe that it is a matrix.  But might prompt them a
>     PatB> bit in that direction.
>     >> >> 
>     >> >> Well, str() was always aimed a bit at experienced S (and R)
>     >> >> users, and I had always aimed somewhat to keep it's output
>     >> >> "compact".  I'm quite astonished that the OP didn't know about
>     >> >> 1D arrays in spite of the many years he's been using R.
>     >> >> Would a wierd solution like the above have helped?
>     >> >> 
>     >> >> At the moment, I'd tend to keep it "as is" if only just for
>     >> >> historical reminescence, but I can be convinced to change the
>     >> >> current "tendency" ... 
>     >> >> 
>     >> >> Martin Maechler, ETH Zurich  
>     >> >> 
>     TP> What about just including "(1d-array)", something like this
>     >> >> str(f)
>     TP> 'table' int [1:10](1d array) 5 5 9 23 26 16 9 4 2 1
>     TP> - attr(*, "dimnames")=List of 1
>     TP> ..$ : chr [1:10] "0" "1" "2" "3" ...
>     >> >> 
>     TP> only 9 extra characters for a rare case, and much, much less cryptic?
>     >> 
>     >> well,.. the next text request is to use
>     >> "character" instead of "chr", only 6 extra characters ....
>     >> 
>     >>  -> no way:  str() has its very concise "style" and should keep that.
>     >> 
>     TP> Brevity is good, but clarity is important too.   The output of str is 
>     TP> usually decipherable, but not so much in this case.  It's easy to 
>     TP> dismiss suggestions like replacing "chr" with "character" - the increase 
>     TP> in clarity would be minimal.  However, the potential increase in clarity 
>     TP> for a 1-d array is significant - the decrease in brevity is at question 
>     TP> here. Given the rarity of the case it seems like a decent tradeoff to 
>     TP> add "(1d-array)" (one could even just write "(1d)").   1-d arrays are 
>     TP> sufficiently rare that no concise and clear method of indicating them 
>     TP> using brackets or other symbols has arisen. You did say you "can be 
>     TP> convinced to change" it, but I won't attempt beyond this! :-)
> 
> well, "still can be .." .....
> 
> So you currently propose to replace
>      "int [,1:10] 5 5 9 23 26 16 9 4 2 1"
> by
>      "int [1:10](1d) 5 5 9 23 26 16 9 4 2 1"
> where Pat had
>      "int [1:10(,)] 5 5 9 23 26 16 9 4 2 1"
> 
> Since the [.....] is where we specify the dimensionality of all
> arrays in str(), I'd like to try something where things remain
> inside "[....]" as with Pat's version or e.g., with
> 
>      "int [1:10/1d] 5 5 9 23 26 16 9 4 2 1"
> 
> Opinions, further proposals ?

Recognizing that I am coming to this discussion quite late, how about:

       int [1:10(1d)] 5 5 9 23 26 16 9 4 2 1

?

I do think that any str() representation that includes a ',' would
continue to reinforce the current misunderstandings pertaining to a 1d
array.

Since using str() is a common response to posts on r-help regarding how
to access components of an object, there will be naive users who would
see something like (using Prof. Ripley's example):

> str(f)
 'table' int [, 1:11] 1 9 15 21 15 17 13 5 1 2 ...
 - attr(*, "dimnames")=List of 1
  ..$ : chr [1:11] "0" "1" "2" "3" ...

and then think that they could do:

> f[, 1]
Error in f[, 1] : incorrect number of dimensions

which of course they cannot.

I think that the above change would help to reinforce the notion that a
1d array can, for the most part, be treated as an atomic vector.
However, as Prof. Ripley has noted, there is a subtle difference in how
names/dimnames are treated. The use of '(1d)' in the str() output would
make it clear that this object is not quite a simple atomic vector, but
when indexing, can be treated as such.

Regards,

Marc Schwartz


<snip of content below this point>


From mtmorgan at fhcrc.org  Fri Jan 23 15:49:27 2009
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Fri, 23 Jan 2009 06:49:27 -0800
Subject: [Rd] pass by reference for S4
In-Reply-To: <73B69AE489CA974C817780430D154F0901443833@dkfzex2.ad.dkfz-heidelberg.de>
	(Biczok Rudolf's message of "Mon, 19 Jan 2009 23:00:52 +0100")
References: <73B69AE489CA974C817780430D154F0901443833@dkfzex2.ad.dkfz-heidelberg.de>
Message-ID: <6phljt2qdqg.fsf@gopher4.fhcrc.org>

"Biczok Rudolf" <r.biczok at dkfz-heidelberg.de> writes:

> Hi all;
>
>
> Is it possible to modify the "@" operator that it can handle references
> (or external pointers) 

R has the notion of an external pointer, which is a pointer to C-level
data. Is that what you mean? See ?"externalptr-class" and the 'Writing
R Extensions' manual for details.

More likely you mean that you want to pass references rather than
values. An approach is to create an environment and place objects in
it; environments have pass-by-reference semantics.

  env <- new.env(parent=emptyenv())
  env$myobj <- ...

Environments can be placed in slots of an S4 class, so the contents of
instances of the class will not be copied. You have to pay attention
when creating the S4 instance that each instance gets a new
environment, e.g., defining an 'initialize' method or a class
constructor.

 setClass("MyClass", representation=representation(env="environment"))
 setMethod("initialize", "MyClass", function(.Object, myData, ...) {
     env <- new.env(parent=emptyenv())
     env$myData <- myData
     callNextMethod(.Object, env=env, ...)
 })

and then

> obj <- new("MyClass", myData=1:10)
> obj at env$myData
 [1]  1  2  3  4  5  6  7  8  9 10

R users will be confused by pass-by-reference semantics.  Others might
point you to the R.oo or proto packages.

Martin

> of S4 Object instead of the real Objects?
>
>
> Or is there any technical or compatibility issue which make it
> impossible?
>
>
>  
>
>
> I look forward to hear from you and also hope that you don't hate me for
> my nooby question.
>
>
>  
>
>
> Yours sincerely,
>
>
> Rudolf Biczok
>
>
>  
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin Morgan
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M2 B169
Phone: (206) 667-2793


From hb at stat.berkeley.edu  Fri Jan 23 16:47:10 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Fri, 23 Jan 2009 07:47:10 -0800
Subject: [Rd] Package impute exist in quite different version on CRAN and
	BioC
Message-ID: <59d7961d0901230747n6c5423edn6f951418687eca6f@mail.gmail.com>

[CC:ing package maintainer of 'impute' package and crossposting to
r-devel and bioc-devel because this affects both audiences]

Hi,

the 'impute' package is published both on CRAN and Bioconductor;

 http://cran.r-project.org/web/packages/impute/
 http://bioconductor.org/packages/2.3/bioc/html/impute.html

The one on CRAN is v1.0-5, and the one on BioC is v1.14.0.

The two different versions of impute.knn() returns different structures, e.g.

impute v1.0-5:
> library(impute)
> example(impute.knn)
> str(khan.imputed)
 num [1:2308, 1:63] 0.773 -2.438 -0.483 -2.721 -1.217 ...
 - attr(*, "dimnames")=List of 2
  ..$ : chr [1:2308] "2" "3" "4" "5" ...
  ..$ : chr [1:63] "sample1" "sample2" "sample3" "sample4" ...
 - attr(*, "rng.seed")= num 3.62e+08
 - attr(*, "rng.state")= int [1:626] 403 624 1638542565 108172386 -1884566405 -1
838154368 -250773631 919185230 -1001918601 -1002779316 ...

impute v1.14.0:
> library(impute)
> example(impute.knn)
> str(khan.imputed)
List of 3
 $ data     : num [1:2308, 1:63] 0.773 -2.438 -0.483 -2.721 -1.217 ...
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:2308] "2" "3" "4" "5" ...
  .. ..$ : chr [1:63] "sample1" "sample2" "sample3" "sample4" ...
 $ rng.seed : num 3.62e+08
 $ rng.state: int [1:626] 403 624 1638542565 108172386 -1884566405 -1838154368 -
250773631 919185230 -1001918601 -1002779316 ...

This caused me and my collaborators quite a bit of confusion, because
we both were sure we had the latest version installed.  I've located
at least one other case related to this issue, cf. Thread '[R] Help
with impute.knn' on Oct 30, 2008:

   https://stat.ethz.ch/pipermail/r-help/2008-October/178390.html

(People in that thread are also CC:ed, because it was never straightened out).

Could you please either make sure to keep both up to date, or
alternatively drop it from CRAN?  I'm sure the CRAN master can tell
you how to do this.

Cheers,

/Henrik


From jagerhi at ornl.gov  Thu Jan 22 23:02:06 2009
From: jagerhi at ornl.gov (Yetta Jager)
Date: Thu, 22 Jan 2009 17:02:06 -0500
Subject: [Rd] row.names in data.frame with row.names NULL
Message-ID: <0KDW00D2P7VVBU@emroute3.ornl.gov>

In response to the Aug 20 posting by Vadim, I had the same issue with 
all kinds of complaints about row.names when it was not given in the 
read.table command; when it was set to NULL (data were actually 
shifted to the wrong names). I believe the problem was no comma (or 
specified delimiter) at the end of the first row with the names in 
it. Don't know why, but in comparing two programs, one working one 
not, this is the only difference.  Would be nice if it were more 
robust...thanks.

Yetta

Yetta Jager
Environmental Sciences Division
Oak Ridge National Laboratory
P.O. Box 2008, MS 6036
Oak Ridge, TN 37831-6036 USA

For packages, please replace "P.O. Box 2008" with "Bethel Valley Road".

OFFICE: 865/574-8143  FAX:  865/576-3989
Work email: jagerhi at ornl.gov Home email: jagerhi at chartertn.net
My webpage: http://www.esd.ornl.gov/~zij/
Fish and Wildlife Modelling: 
http://www.esd.ornl.gov/research/ecol_management/fish_wildlife_modeling


From yan at pixie.org.uk  Thu Jan 22 23:39:13 2009
From: yan at pixie.org.uk (Yan Wong)
Date: Thu, 22 Jan 2009 22:39:13 +0000
Subject: [Rd] Italics in svg output display as bold (PR#13463)
In-Reply-To: <alpine.LFD.2.00.0901221153020.20762@toucan.stats.ox.ac.uk>
References: <20090121220013.97061282EFC2@mail.pubhealth.ku.dk>
	<alpine.LFD.2.00.0901221153020.20762@toucan.stats.ox.ac.uk>
Message-ID: <D8D645C3-B243-4D2F-877D-8C0F98ADB1D5@pixie.org.uk>

On 22 Jan 2009, at 11:58, Brian D Ripley wrote:

> It is a bug on your system: this is done by cairographics, and I  
> suspect that the version you have is broken (or possibly your viewer).
> I'll attach the version I get, which does display in italics on my  
> system.

Thanks for that. I do see italics in your file using my 2 viewers, so  
I guess that the problem is not my viewer.

> And how did you compile it?  This might be a bug in the  
> cairographics or fontconfig library used for the CRAN binary build,  
> if you used that (and report such issues to R-sig-mac -- see the  
> posting guide).

Yes, apologies for not stating: this is the latest OS X binary build  
from CRAN. I'll report the issue to R-sig-mac as you advise.

Cheers

Yan


From Sachinthaka.Abeywardana at csiro.au  Fri Jan 23 04:17:00 2009
From: Sachinthaka.Abeywardana at csiro.au (sachin1234)
Date: Thu, 22 Jan 2009 19:17:00 -0800 (PST)
Subject: [Rd]  loading RBlas.dll
Message-ID: <21617712.post@talk.nabble.com>


hi everyone,

Im implementing a new RBlas dll but just for optimising sake i need to know
how and WHERE (which source code) RBlas gets loaded. there is a call to
loadlibrary() in dynload.c BUT it seems this is not the function that is
loading Rblas. 

how do i know this? well i added the code :(just after the loadlibrary()
call)
        /*********************************************/
	/*this section writes into files which libraries were loaded*/
	file=fopen("libraries.txt","a");
	fputs(path,file);
	fputs("\n",file);
	fclose(file);
	/******************************************/
so that it prints out the path names of which ever libraries are loaded and
the output is:
C:/DOCUME~1/abe044/MYDOCU~1/PROJEC~1/GPU_BLAS/R-28~1.1/library/methods/libs/methods.dll
C:/DOCUME~1/abe044/MYDOCU~1/PROJEC~1/GPU_BLAS/R-28~1.1/library/grDevices/libs/grDevices.dll
C:/DOCUME~1/abe044/MYDOCU~1/PROJEC~1/GPU_BLAS/R-28~1.1/library/stats/libs/stats.dll

and i think i got tools.dll to load as well. I cant find where R.dll,
Rblas.dll etc gets loaded. My main focus is Rblas.dll

now heres what i expect. Whenever you open R it runs one of its script files
which contains dyn.load and loads it. HOWEVER as far as i understand
dyn.load must be using dynload.c. Hence it should spit loading blas into
libraries.txt which it doesnt do. 

I am stumped. I've spend nearly 2 days on this. any help would be
appreciated


-- 
View this message in context: http://www.nabble.com/loading-RBlas.dll-tp21617712p21617712.html
Sent from the R devel mailing list archive at Nabble.com.


From r.biczok at dkfz-heidelberg.de  Fri Jan 23 08:25:54 2009
From: r.biczok at dkfz-heidelberg.de (Biczok Rudolf)
Date: Fri, 23 Jan 2009 08:25:54 +0100
Subject: [Rd] "for" loop wiht S4 Objects
Message-ID: <73B69AE489CA974C817780430D154F0901213968@dkfzex2.ad.dkfz-heidelberg.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090123/6295dd09/attachment.pl>

From antonio.fabio at gmail.com  Fri Jan 23 20:21:45 2009
From: antonio.fabio at gmail.com (Antonio, Fabio Di Narzo)
Date: Fri, 23 Jan 2009 14:21:45 -0500
Subject: [Rd] loading RBlas.dll
In-Reply-To: <21617712.post@talk.nabble.com>
References: <21617712.post@talk.nabble.com>
Message-ID: <b0808fdc0901231121p77d3f26ctc45778ea689aa760@mail.gmail.com>

hi, whoever you are (I've seen no signature),

2009/1/22 sachin1234 <Sachinthaka.Abeywardana at csiro.au>:
>
> hi everyone,
>
> Im implementing a new RBlas dll but just for optimising sake i need to know
> how and WHERE (which source code) RBlas gets loaded. there is a call to
> loadlibrary() in dynload.c BUT it seems this is not the function that is
> loading Rblas.

Why do you need this? The R-admin manual explains how to replace the R
built-in version of Blas with a custom, optimized one. Is this what
are you looking for? One of the methods mentioned here doesn't even
require re-compilation of R.

Bests,
f.

>
> how do i know this? well i added the code :(just after the loadlibrary()
> call)
>        /*********************************************/
>        /*this section writes into files which libraries were loaded*/
>        file=fopen("libraries.txt","a");
>        fputs(path,file);
>        fputs("\n",file);
>        fclose(file);
>        /******************************************/
> so that it prints out the path names of which ever libraries are loaded and
> the output is:
> C:/DOCUME~1/abe044/MYDOCU~1/PROJEC~1/GPU_BLAS/R-28~1.1/library/methods/libs/methods.dll
> C:/DOCUME~1/abe044/MYDOCU~1/PROJEC~1/GPU_BLAS/R-28~1.1/library/grDevices/libs/grDevices.dll
> C:/DOCUME~1/abe044/MYDOCU~1/PROJEC~1/GPU_BLAS/R-28~1.1/library/stats/libs/stats.dll
>
> and i think i got tools.dll to load as well. I cant find where R.dll,
> Rblas.dll etc gets loaded. My main focus is Rblas.dll
>
> now heres what i expect. Whenever you open R it runs one of its script files
> which contains dyn.load and loads it. HOWEVER as far as i understand
> dyn.load must be using dynload.c. Hence it should spit loading blas into
> libraries.txt which it doesnt do.
>
> I am stumped. I've spend nearly 2 days on this. any help would be
> appreciated
>
>
> --
> View this message in context: http://www.nabble.com/loading-RBlas.dll-tp21617712p21617712.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Antonio, Fabio Di Narzo
Ph.D. student at
Department of Statistical Sciences
University of Bologna, Italy


From yizhang84 at gmail.com  Fri Jan 23 21:41:25 2009
From: yizhang84 at gmail.com (Yi Zhang)
Date: Fri, 23 Jan 2009 15:41:25 -0500
Subject: [Rd] overwriting '<-' and infinite recursions
Message-ID: <a0428ec90901231241u561a5848re009b252bf7d1808@mail.gmail.com>

Hello all,

I'm having a problem when overwriting the '<-' function and was told
I'd better post it here for help. The reason why I need to overwrite
it is complicated and not easy to tell in a few words; but this seems
the only clean option other than hacking R's core source code. My code
looks like:

# in .onLoad of a package; or if you want to test, put it in a function
env <- as.environment('package:base')
unlockBinding('<-',env)
assign('<-', newAssign, envir=env)
.Internal(lockBinding(as.name('<-'), env))
 #not using lockBinding directly because it calls '<-'

It gave me this error: Error: evaluation nested too deeply: infinite
recursion / options(expressions=)?

Any suggestion is appreciated!

-- 
Yi


From luke at stat.uiowa.edu  Fri Jan 23 22:25:49 2009
From: luke at stat.uiowa.edu (luke at stat.uiowa.edu)
Date: Fri, 23 Jan 2009 15:25:49 -0600 (CST)
Subject: [Rd] overwriting '<-' and infinite recursions
In-Reply-To: <a0428ec90901231241u561a5848re009b252bf7d1808@mail.gmail.com>
References: <a0428ec90901231241u561a5848re009b252bf7d1808@mail.gmail.com>
Message-ID: <alpine.DEB.1.00.0901231517430.6710@luke-inspiron>

While it _may_ be possible to make this work in current R (I don't
know if it is) this is a Really Bad Idea as it will affect every other
piece of R code run on the system. It also may not work at all in
future versions of R (assignment is sufficiently core functionality
that it may not be implemented via a function at all in some
circumstances).  Locked bindings are locked for a reason: we as
developers can assume that their values are what we intend them to be.
If those values are changed then that assumption fails and some things
may stop working.

If you explain what your needs are someone on the list can probably
help you find a more effective and less intrusive way of doing it.

luke


On Fri, 23 Jan 2009, Yi Zhang wrote:

> Hello all,
>
> I'm having a problem when overwriting the '<-' function and was told
> I'd better post it here for help. The reason why I need to overwrite
> it is complicated and not easy to tell in a few words; but this seems
> the only clean option other than hacking R's core source code. My code
> looks like:
>
> # in .onLoad of a package; or if you want to test, put it in a function
> env <- as.environment('package:base')
> unlockBinding('<-',env)
> assign('<-', newAssign, envir=env)
> .Internal(lockBinding(as.name('<-'), env))
> #not using lockBinding directly because it calls '<-'
>
> It gave me this error: Error: evaluation nested too deeply: infinite
> recursion / options(expressions=)?
>
> Any suggestion is appreciated!
>
> --
> Yi
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From yizhang84 at gmail.com  Fri Jan 23 22:48:00 2009
From: yizhang84 at gmail.com (Yi Zhang)
Date: Fri, 23 Jan 2009 16:48:00 -0500
Subject: [Rd] overwriting '<-' and infinite recursions
In-Reply-To: <alpine.DEB.1.00.0901231517430.6710@luke-inspiron>
References: <a0428ec90901231241u561a5848re009b252bf7d1808@mail.gmail.com>
	<alpine.DEB.1.00.0901231517430.6710@luke-inspiron>
Message-ID: <a0428ec90901231348u7a23facdl4c4cd26ec16fdc96@mail.gmail.com>

Thanks, Luke. I would certainly be very happy to see any non-intrusive
solution. The problem I'm dealing with is: I'm creating a new class
which references some external resource (file or database) and I want
to make the reference counting work. An example (-> means references):
Initially we have symbol a -> object oa of my class -> file fa.
Suppose then R code "b<-a" is executed. With no modification to the
'<-' function, R would make another symbol b and bind it to oa.
Imagine next "b[1]<-0" is executed. Here comes the trouble: R only
knows to duplicate oa to another ob; the modification will be done to
the underlying shared file fa. Of course, I have necessary code for
overriding "[<-" and make that modification. The whole thing is
because I'm not aware of any sharing of the external resource at the R
level. That's the motivation for me to
overwrite '<-' in the first place. Any potential alternative solutions?

On Fri, Jan 23, 2009 at 4:25 PM,  <luke at stat.uiowa.edu> wrote:
> While it _may_ be possible to make this work in current R (I don't
> know if it is) this is a Really Bad Idea as it will affect every other
> piece of R code run on the system. It also may not work at all in
> future versions of R (assignment is sufficiently core functionality
> that it may not be implemented via a function at all in some
> circumstances).  Locked bindings are locked for a reason: we as
> developers can assume that their values are what we intend them to be.
> If those values are changed then that assumption fails and some things
> may stop working.
>
> If you explain what your needs are someone on the list can probably
> help you find a more effective and less intrusive way of doing it.
>
> luke
>
>
> On Fri, 23 Jan 2009, Yi Zhang wrote:
>
>> Hello all,
>>
>> I'm having a problem when overwriting the '<-' function and was told
>> I'd better post it here for help. The reason why I need to overwrite
>> it is complicated and not easy to tell in a few words; but this seems
>> the only clean option other than hacking R's core source code. My code
>> looks like:
>>
>> # in .onLoad of a package; or if you want to test, put it in a function
>> env <- as.environment('package:base')
>> unlockBinding('<-',env)
>> assign('<-', newAssign, envir=env)
>> .Internal(lockBinding(as.name('<-'), env))
>> #not using lockBinding directly because it calls '<-'
>>
>> It gave me this error: Error: evaluation nested too deeply: infinite
>> recursion / options(expressions=)?
>>
>> Any suggestion is appreciated!
>>
>> --
>> Yi
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> --
> Luke Tierney
> Chair, Statistics and Actuarial Science
> Ralph E. Wareham Professor of Mathematical Sciences
> University of Iowa                  Phone:             319-335-3386
> Department of Statistics and        Fax:               319-335-3017
>   Actuarial Science
> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>



-- 
Yi


From bates at stat.wisc.edu  Fri Jan 23 23:21:37 2009
From: bates at stat.wisc.edu (Douglas Bates)
Date: Fri, 23 Jan 2009 16:21:37 -0600
Subject: [Rd] "for" loop wiht S4 Objects
In-Reply-To: <73B69AE489CA974C817780430D154F0901213968@dkfzex2.ad.dkfz-heidelberg.de>
References: <73B69AE489CA974C817780430D154F0901213968@dkfzex2.ad.dkfz-heidelberg.de>
Message-ID: <40e66e0b0901231421x15ef061era52124d0c00613d7@mail.gmail.com>

On Fri, Jan 23, 2009 at 1:25 AM, Biczok Rudolf
<r.biczok at dkfz-heidelberg.de> wrote:
> Hi all,

> I'm working with the S4-Class system and I have a little problem with

> Implementing iteration functionality in my S4 class but it don't work:

>> setClass("foo",representation(bar="list"))
>> x <- new("foo",bar=list(1,2,3))
>>for(e in x) cat(e)
> invalid type/length (S4/1) in vector allocation

I'm not sure why you would expect a for loop to work there.  Wouldn't
a function in the "apply" family be more natural?  At least in my code
it is much more common to use lapply to loop over the elements of a
list than it is to use 'for'.

I once suggested to John Chambers that it would be a good idea to have
a way of applying a function to the slots of an S4 object and he
persuaded me otherwise.  However, you can generate something like that
with

lapply(slotNames(x), function(nm) cat(slot(x, nm)))

or create a list out of the S4 object

S4toL <- function(x) {nms <- slotNames(x); names(nms) <- nms;
lapply(nms, slot, object = x)}

then use lapply on the result of S4toL

>
>
>
>
>
> But when I extend from a primitive vector it works:
>
>
>
>> setClass("foo",contains="list")
>
>
>
>> x <- new("foo",.Data=list(1,2,3))
>
>
>
>>for(e in x) cat(e)
>
> 123
>
>
>
> This is ok, but is there any other way to do this (for e.g. with a
> generic function)?
>
>
>
> Thanks,
>
> Rudolf
>
>
>        [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From luke at stat.uiowa.edu  Fri Jan 23 23:28:17 2009
From: luke at stat.uiowa.edu (luke at stat.uiowa.edu)
Date: Fri, 23 Jan 2009 16:28:17 -0600 (CST)
Subject: [Rd] overwriting '<-' and infinite recursions
In-Reply-To: <a0428ec90901231348u7a23facdl4c4cd26ec16fdc96@mail.gmail.com>
References: <a0428ec90901231241u561a5848re009b252bf7d1808@mail.gmail.com> 
	<alpine.DEB.1.00.0901231517430.6710@luke-inspiron>
	<a0428ec90901231348u7a23facdl4c4cd26ec16fdc96@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0901231621130.3628@itasca2.wildberry.org>

On Fri, 23 Jan 2009, Yi Zhang wrote:

> Thanks, Luke. I would certainly be very happy to see any non-intrusive
> solution. The problem I'm dealing with is: I'm creating a new class
> which references some external resource (file or database) and I want
> to make the reference counting work. An example (-> means references):
> Initially we have symbol a -> object oa of my class -> file fa.
> Suppose then R code "b<-a" is executed. With no modification to the
> '<-' function, R would make another symbol b and bind it to oa.
> Imagine next "b[1]<-0" is executed. Here comes the trouble: R only
> knows to duplicate oa to another ob; the modification will be done to
> the underlying shared file fa. Of course, I have necessary code for
> overriding "[<-" and make that modification. The whole thing is
> because I'm not aware of any sharing of the external resource at the R
> level. That's the motivation for me to
> overwrite '<-' in the first place. Any potential alternative solutions?

I'm still fuzzy about what you are trying to accomplish.  You have
some code, say openFA(), that produces the oa value with

    a <- openOA()

Then you could do

    b <- a

and then

    b[1] <- 0

or

    a[1] <- 0

Do you want these to have the same effect, do you want a[1] <- 0 to do
one thing if b <- a has happened and another if not, should one signal
an error, ...?

>From what you have written so far it would seem that messing with <-
would't really help as

    d <- list(a)

and

    f <- fuction(b) { ... }
    f(a)

would create similar issues that would not be addressed.

luke


>
> On Fri, Jan 23, 2009 at 4:25 PM,  <luke at stat.uiowa.edu> wrote:
>> While it _may_ be possible to make this work in current R (I don't
>> know if it is) this is a Really Bad Idea as it will affect every other
>> piece of R code run on the system. It also may not work at all in
>> future versions of R (assignment is sufficiently core functionality
>> that it may not be implemented via a function at all in some
>> circumstances).  Locked bindings are locked for a reason: we as
>> developers can assume that their values are what we intend them to be.
>> If those values are changed then that assumption fails and some things
>> may stop working.
>>
>> If you explain what your needs are someone on the list can probably
>> help you find a more effective and less intrusive way of doing it.
>>
>> luke
>>
>>
>> On Fri, 23 Jan 2009, Yi Zhang wrote:
>>
>>> Hello all,
>>>
>>> I'm having a problem when overwriting the '<-' function and was told
>>> I'd better post it here for help. The reason why I need to overwrite
>>> it is complicated and not easy to tell in a few words; but this seems
>>> the only clean option other than hacking R's core source code. My code
>>> looks like:
>>>
>>> # in .onLoad of a package; or if you want to test, put it in a function
>>> env <- as.environment('package:base')
>>> unlockBinding('<-',env)
>>> assign('<-', newAssign, envir=env)
>>> .Internal(lockBinding(as.name('<-'), env))
>>> #not using lockBinding directly because it calls '<-'
>>>
>>> It gave me this error: Error: evaluation nested too deeply: infinite
>>> recursion / options(expressions=)?
>>>
>>> Any suggestion is appreciated!
>>>
>>> --
>>> Yi
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> --
>> Luke Tierney
>> Chair, Statistics and Actuarial Science
>> Ralph E. Wareham Professor of Mathematical Sciences
>> University of Iowa                  Phone:             319-335-3386
>> Department of Statistics and        Fax:               319-335-3017
>>   Actuarial Science
>> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
>> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>>
>
>
>
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From tplate at acm.org  Sat Jan 24 00:09:48 2009
From: tplate at acm.org (Tony Plate)
Date: Fri, 23 Jan 2009 16:09:48 -0700
Subject: [Rd] overwriting '<-' and infinite recursions
In-Reply-To: <a0428ec90901231348u7a23facdl4c4cd26ec16fdc96@mail.gmail.com>
References: <a0428ec90901231241u561a5848re009b252bf7d1808@mail.gmail.com>	<alpine.DEB.1.00.0901231517430.6710@luke-inspiron>
	<a0428ec90901231348u7a23facdl4c4cd26ec16fdc96@mail.gmail.com>
Message-ID: <497A4E3C.9070709@acm.org>

I wonder if you might be able to make use of R's "active bindings."  
These enable you to set things up so that a user definable function is 
called when an assignment is made or when a value is accessed.  It's 
sort of like overriding assignment for a particular variable, but you 
don't need to mess with the definition of assignment.

Do
 > apropos("binding")
to see the related functions.  The help page for makeActiveBinding has a 
simple example.

-- Tony Plte

Yi Zhang wrote:
> Thanks, Luke. I would certainly be very happy to see any non-intrusive
> solution. The problem I'm dealing with is: I'm creating a new class
> which references some external resource (file or database) and I want
> to make the reference counting work. An example (-> means references):
> Initially we have symbol a -> object oa of my class -> file fa.
> Suppose then R code "b<-a" is executed. With no modification to the
> '<-' function, R would make another symbol b and bind it to oa.
> Imagine next "b[1]<-0" is executed. Here comes the trouble: R only
> knows to duplicate oa to another ob; the modification will be done to
> the underlying shared file fa. Of course, I have necessary code for
> overriding "[<-" and make that modification. The whole thing is
> because I'm not aware of any sharing of the external resource at the R
> level. That's the motivation for me to
> overwrite '<-' in the first place. Any potential alternative solutions?
>
> On Fri, Jan 23, 2009 at 4:25 PM,  <luke at stat.uiowa.edu> wrote:
>   
>> While it _may_ be possible to make this work in current R (I don't
>> know if it is) this is a Really Bad Idea as it will affect every other
>> piece of R code run on the system. It also may not work at all in
>> future versions of R (assignment is sufficiently core functionality
>> that it may not be implemented via a function at all in some
>> circumstances).  Locked bindings are locked for a reason: we as
>> developers can assume that their values are what we intend them to be.
>> If those values are changed then that assumption fails and some things
>> may stop working.
>>
>> If you explain what your needs are someone on the list can probably
>> help you find a more effective and less intrusive way of doing it.
>>
>> luke
>>
>>
>> On Fri, 23 Jan 2009, Yi Zhang wrote:
>>
>>     
>>> Hello all,
>>>
>>> I'm having a problem when overwriting the '<-' function and was told
>>> I'd better post it here for help. The reason why I need to overwrite
>>> it is complicated and not easy to tell in a few words; but this seems
>>> the only clean option other than hacking R's core source code. My code
>>> looks like:
>>>
>>> # in .onLoad of a package; or if you want to test, put it in a function
>>> env <- as.environment('package:base')
>>> unlockBinding('<-',env)
>>> assign('<-', newAssign, envir=env)
>>> .Internal(lockBinding(as.name('<-'), env))
>>> #not using lockBinding directly because it calls '<-'
>>>
>>> It gave me this error: Error: evaluation nested too deeply: infinite
>>> recursion / options(expressions=)?
>>>
>>> Any suggestion is appreciated!
>>>
>>> --
>>> Yi
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>       
>> --
>> Luke Tierney
>> Chair, Statistics and Actuarial Science
>> Ralph E. Wareham Professor of Mathematical Sciences
>> University of Iowa                  Phone:             319-335-3386
>> Department of Statistics and        Fax:               319-335-3017
>>   Actuarial Science
>> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
>> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>>
>>     
>
>
>
>


From wolfgang.koller at wu-wien.ac.at  Fri Jan 23 20:45:16 2009
From: wolfgang.koller at wu-wien.ac.at (wolfgang.koller at wu-wien.ac.at)
Date: Fri, 23 Jan 2009 20:45:16 +0100 (CET)
Subject: [Rd] Possible Bug in file.show (PR#13469)
Message-ID: <20090123194516.B4D08282EFC2@mail.pubhealth.ku.dk>

Dear R-developers,

Bug Report:

R 2.8.1, i386-pc-mingw32

When I want to display two existing files using the command

file.show(c("A.txt", "B.txt"))

or

file.show("A.txt", "B.txt")

the same file ('A.txt') is displayed twice, instead of displaying two 
different files.

With R 2.6.1 the same code works perfectly.

Best regards,

Wolfgang Koller


From murdoch at stats.uwo.ca  Sat Jan 24 13:13:35 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 24 Jan 2009 07:13:35 -0500
Subject: [Rd] Possible Bug in file.show (PR#13469)
In-Reply-To: <20090123194516.B4D08282EFC2@mail.pubhealth.ku.dk>
References: <20090123194516.B4D08282EFC2@mail.pubhealth.ku.dk>
Message-ID: <497B05EF.7090600@stats.uwo.ca>

On 23/01/2009 2:45 PM, wolfgang.koller at wu-wien.ac.at wrote:
> Dear R-developers,
> 
> Bug Report:
> 
> R 2.8.1, i386-pc-mingw32
> 
> When I want to display two existing files using the command
> 
> file.show(c("A.txt", "B.txt"))
> 
> or
> 
> file.show("A.txt", "B.txt")
> 
> the same file ('A.txt') is displayed twice, instead of displaying two 
> different files.
> 
> With R 2.6.1 the same code works perfectly.

I see the same in R-devel; I'll fix it.

Duncan Murdoch


From murdoch at stats.uwo.ca  Sat Jan 24 14:09:45 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 24 Jan 2009 08:09:45 -0500
Subject: [Rd] Possible Bug in file.show (PR#13469)
In-Reply-To: <20090123194516.B4D08282EFC2@mail.pubhealth.ku.dk>
References: <20090123194516.B4D08282EFC2@mail.pubhealth.ku.dk>
Message-ID: <497B1319.806@stats.uwo.ca>

On 23/01/2009 2:45 PM, wolfgang.koller at wu-wien.ac.at wrote:
> Dear R-developers,
> 
> Bug Report:
> 
> R 2.8.1, i386-pc-mingw32
> 
> When I want to display two existing files using the command
> 
> file.show(c("A.txt", "B.txt"))
> 
> or
> 
> file.show("A.txt", "B.txt")
> 
> the same file ('A.txt') is displayed twice, instead of displaying two 
> different files.
> 
> With R 2.6.1 the same code works perfectly.

Now fixed in R-devel and R-patched.  Thanks for the report!

Duncan Murdoch


From muenchen at utk.edu  Sat Jan 24 14:13:11 2009
From: muenchen at utk.edu (Muenchen, Robert A (Bob))
Date: Sat, 24 Jan 2009 08:13:11 -0500
Subject: [Rd] FW: [R] The Quality & Accuracy of R
Message-ID: <8C5F8DF18B90FA43BB9B356227F812D545145F@KFSVS6.utk.tennessee.edu>

Dear R Developers,

This is my first time subscribing to this list, so let me start out by saying thank you all very much for the incredible contribution you have made to science through your work on R. 

As you all know many users of commercial stat packages, their managers, directors, CIOs etc. are skeptical of R's quality/accuracy. And as the recent NY Times article demonstrated, the commercial vendors rarely miss an opportunity stoke those fears. I have read many r-help posts on this subject so I was aware that R was developed and tested with great care, but until I read the clinical trials doc, I was not aware that they were as many steps and that they were as rigorous (use of version management software, etc.) Even as I read the document, the opening paragraphs made me think it was far too focused to be of general use. Luckily, I kept reading through the CFRs. Modifying that doc would take little effort as I outlined in my original post (below). Putting it in easy reach of every R user is important. By adding that to the docs in R's Help menu, and adding a FAQ entry for it, all R users will have ready access to it. 

My second suggestion is adding an option to the R installation that would let every R user run the test suite, very clearly showing them that it is being done. I realize this is a superfluous step, since you have already run the test suite against R before releasing it. However, it would provide user assurance that they could easily demonstrate to skeptics that very thorough testing is being done. I don't know whether written messages that I suggested below would be best, or simply showing the output scrolling by would have the most impact. Perhaps both, as in a message "Testing accuracy of linear regression..." in a message window while the output scrolled by in the console.

Rather than having this as a part of installation, an alternative would be to end the installation with a message pointing people to a function like validate.R() and an equivalent menu selection as a following step. That would ensure that everyone knows the option exists, plus it enables any R user to run the tests for skeptics at any time. The easier it is to run the test suite the better. 

The complete set of validation programs you use may be huge and impractical for most people to run. In that case, perhaps just a subset could be compiled, with an emphasis on testing the common statistical functions that people are likely to focus their concern upon.

Asking to add a superfluous step to an installation may seem like a waste of time, and technically it is. But psychologically this testing will have a important impact that will silence many critics. Thanks for taking the time to consider it.

Best regards,
Bob


-----Original Message-----
From: Peter Dalgaard [mailto:p.dalgaard at biostat.ku.dk] 
Sent: Saturday, January 24, 2009 4:53 AM
To: Muenchen, Robert A (Bob)
Cc: R-help at r-project.org
Subject: Re: [R] The Quality & Accuracy of R

Bob,

Your point is well taken, but it also raises a number of issues 
(post-install testing to name one) for which the R-devel list would be 
more suitable. Could we move the discussion there?

	-Peter


Muenchen, Robert A (Bob) wrote:
> Hi All,
> 
>  
> 
> We have all had to face skeptical colleagues asking if software made by
> volunteers could match the quality and accuracy of commercially written
> software. Thanks to the prompting of a recent R-help thread, I read, "R:
> Regulatory Compliance and Validation Issues, A Guidance Document for the
> Use of R in Regulated Clinical Trial Environments
> (http://www.r-project.org/doc/R-FDA.pdf). This is an important document,
> of interest to the general R community. The question of R's accuracy is
> such a frequent one, it would be beneficial to increase the visibility
> of the non-clinical  information it contains. A document aimed at a
> general audience, entitled something like, "R: Controlling Quality and
> Assuring Accuracy" could be compiled from the these sections:
> 
>  
> 
> 1.      What is R? (section 4)
> 
> 2.      The R Foundation for Statistical Computing (section  3)
> 
> 3.      The Scope of this Guidance Document (section 2)
> 
> 4.      Software Development Life Cycle (section 6)
> 
>  
> 
> Marc Schwartz, Frank Harrell, Anthony Rossini, Ian Francis and others
> did such a great job that very few words would need to change. The only
> addition I suggest is to mention how well R did in, Keeling & Parvur's
> "A comparative study of the reliability to nine statistical software
> packages, May 1, 2007 Computational Statistics & Data Analysis, Vol.51,
> pp 3811-3831. 
> 
>  
> 
> Given the importance of this issue, I would like to see such a document
> added to the PDF manuals in R's Help.
> 
>  
> 
> The document mentions (Sect. 6.3) that a set of validation tests, data
> and known results are available. It would be useful to have an option to
> run that test suite in every R installation, providing clear progress,
> "Validating accuracy of t-tests...Validating accuracy of linear
> regression...." Whether or not people chose to run the tests, they would
> at least know that such tests are available. Back in my mainframe
> installation days, this step was part of many software installations and
> it certainly gave the impression that those were the companies that took
> accuracy seriously. Of course the other companies probably just ran
> their validation suite before shipping, but seeing it happen had a
> tremendous impact.  I don't know how much this would add to download,
> but if it was too much, perhaps it could be implemented as a separate
> download. 
> 
>  
> 
> I hope these suggestions can help mitigate the concerns so many non-R
> users have.
> 
>  
> 
> Cheers,
> 
> Bob
> 
>  
> 
> =========================================================
> 
> Bob Muenchen (pronounced Min'-chen), 
> 
> Manager, Research Computing Support 
> 
> U of TN Office of Information Technology
> 
> Stokely Management Center, Suite 200
> 
> 916 Volunteer Blvd., Knoxville, TN 37996-0520
> 
> Voice: (865) 974-5230
> 
> FAX: (865) 974-4810
> 
> Email: muenchen at utk.edu
> 
> Web: http://oit.utk.edu/research <http://oit.utk.edu/scc> 
> 
> Map to Office: http://www.utk.edu/maps    
> 
> Newsletter: http://listserv.utk.edu/archives/rcnews.html
> <http://listserv.utk.edu/archives/statnews.html> 
> 
> =========================================================
> 
>  
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From yizhang84 at gmail.com  Sat Jan 24 21:54:06 2009
From: yizhang84 at gmail.com (Yi Zhang)
Date: Sat, 24 Jan 2009 15:54:06 -0500
Subject: [Rd] overwriting '<-' and infinite recursions
In-Reply-To: <Pine.LNX.4.64.0901231621130.3628@itasca2.wildberry.org>
References: <a0428ec90901231241u561a5848re009b252bf7d1808@mail.gmail.com>
	<alpine.DEB.1.00.0901231517430.6710@luke-inspiron>
	<a0428ec90901231348u7a23facdl4c4cd26ec16fdc96@mail.gmail.com>
	<Pine.LNX.4.64.0901231621130.3628@itasca2.wildberry.org>
Message-ID: <a0428ec90901241254hbf7800aqdff1cec21fbe4d68@mail.gmail.com>

On Fri, Jan 23, 2009 at 5:28 PM,  <luke at stat.uiowa.edu> wrote:
> On Fri, 23 Jan 2009, Yi Zhang wrote:
>
>> Thanks, Luke. I would certainly be very happy to see any non-intrusive
>> solution. The problem I'm dealing with is: I'm creating a new class
>> which references some external resource (file or database) and I want
>> to make the reference counting work. An example (-> means references):
>> Initially we have symbol a -> object oa of my class -> file fa.
>> Suppose then R code "b<-a" is executed. With no modification to the
>> '<-' function, R would make another symbol b and bind it to oa.
>> Imagine next "b[1]<-0" is executed. Here comes the trouble: R only
>> knows to duplicate oa to another ob; the modification will be done to
>> the underlying shared file fa. Of course, I have necessary code for
>> overriding "[<-" and make that modification. The whole thing is
>> because I'm not aware of any sharing of the external resource at the R
>> level. That's the motivation for me to
>> overwrite '<-' in the first place. Any potential alternative solutions?
>
> I'm still fuzzy about what you are trying to accomplish.  You have
> some code, say openFA(), that produces the oa value with
>
>   a <- openOA()
>
> Then you could do
>
>   b <- a
>
> and then
>
>   b[1] <- 0
>
> or
>
>   a[1] <- 0
>
> Do you want these to have the same effect, do you want a[1] <- 0 to do
> one thing if b <- a has happened and another if not, should one signal
> an error, ...?

Yes, I want to do something extra if b<-a has happened.
>
> From what you have written so far it would seem that messing with <-
> would't really help as
>
>   d <- list(a)
>
> and
>
>   f <- fuction(b) { ... }
>   f(a)
>
> would create similar issues that would not be addressed.

I guess you're right... Argument passing is another kind of duplicate
and I don't know how to track this kind of sharing...


-- 
Yi


From sfischme at uwaterloo.ca  Sun Jan 25 03:19:32 2009
From: sfischme at uwaterloo.ca (Sebastian Fischmeister)
Date: Sat, 24 Jan 2009 21:19:32 -0500
Subject: [Rd] Warning for dropped text with devices that don't support
	clipping
Message-ID: <BD573A1E-792B-4919-B5E3-ECC0980FE610@uwaterloo.ca>

Hello,

   Without feedback, it's hard to understand why text does not show up  
in the output?especially, if it shows up on one device but not on  
another. I suggest adding a warning message when text gets ignored,  
because the device doesn't support clipping (see the attached patch).  
Unfortunately, I cannot add a test, because warnings are sent to  
stderr and not stdout; however, the attached R script shows the warning.

A point for discussion is: how often does the described case occur and  
will a warning message confuse the user? For example, warnings as text  
gets completely clipped (engine.c:1417) will offend users, because  
they happen too often. But then again, all devices will most likely  
omit the text in this case. This is does not hold for the described  
case.

   Sebastian


-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: patch.txt
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090124/902943f1/attachment.txt>

From sfischme at uwaterloo.ca  Sun Jan 25 03:45:42 2009
From: sfischme at uwaterloo.ca (Sebastian Fischmeister)
Date: Sat, 24 Jan 2009 21:45:42 -0500
Subject: [Rd] Warning for dropped text with devices that don't
	support	clipping (in text attachments)
Message-ID: <2AE1968C-4CFA-46B6-A159-0D24816E3026@uwaterloo.ca>

Hello,

   Apparently, the mail program doesn't like attachments. Here's the  
patch and the script again.

Sebastian

------- R Script -------

xfig 
(file 
= 
"test 
.fig",onefile=TRUE,width=6,height=4,textspecial=TRUE,defaultfont=TRUE)
barplot(seq(.8,0,-0.15))
legend("topright",legend=c("1234567890"),cex=.7,text.width=.5)
dev.off()
unlink("test.fig")

------- patch -------

Index: src/main/engine.c
===================================================================
--- src/main/engine.c	(revision 47716)
+++ src/main/engine.c	(working copy)
@@ -1424,7 +1424,7 @@
  	if (toDevice) /* Device will do clipping */
  	    textfn(x, y, str, rot, hadj, gc, dd->dev);
  	else /* don't draw anything; this could be made less crude :) */
-	    ;
+	    warning(_("current device doesn't support clipping, text removed  
'%s'"), str);
      }
  }


From ggrothendieck at gmail.com  Sun Jan 25 04:31:20 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 24 Jan 2009 22:31:20 -0500
Subject: [Rd] Warning for dropped text with devices that don't support
	clipping (in text attachments)
In-Reply-To: <2AE1968C-4CFA-46B6-A159-0D24816E3026@uwaterloo.ca>
References: <2AE1968C-4CFA-46B6-A159-0D24816E3026@uwaterloo.ca>
Message-ID: <971536df0901241931i3f000f6au9a98dd68a2f4779e@mail.gmail.com>

On Sat, Jan 24, 2009 at 9:45 PM, Sebastian Fischmeister
<sfischme at uwaterloo.ca> wrote:
>  Apparently, the mail program doesn't like attachments. Here's the patch and
> the script again.

The attachment does appear to have made to the archives:

https://stat.ethz.ch/pipermail/r-devel/2009-January/051917.html


From sfischme at uwaterloo.ca  Sun Jan 25 05:05:50 2009
From: sfischme at uwaterloo.ca (Sebastian Fischmeister)
Date: Sat, 24 Jan 2009 23:05:50 -0500
Subject: [Rd] Automatic shortening of text to fit into area
Message-ID: <05F24935-EBEE-432C-83C9-E2BF2717878E@uwaterloo.ca>

Hello,

   A comment in engine.c states: "/* don't draw anything; this could  
be made less crude :) */". The following patch makes it less crude: If  
the device doesn't support clipping and the text doesn't fit into the  
area, then remove one character after another from the text until  
either the text fits or the string is empty.

I attached the patch?it's not indented correctly to keep the patch  
size small?and a test script, so you can give it a try. I don't know  
the R core very well, so this change may need some discussion. Yet it  
works for my figures.

Have fun,
   Sebastian

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: test-auto-reduction.txt
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090124/a71fd017/attachment.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: nonclip-str-reduction.txt
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090124/a71fd017/attachment-0001.txt>

From ripley at stats.ox.ac.uk  Sun Jan 25 08:06:25 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 25 Jan 2009 07:06:25 +0000 (GMT)
Subject: [Rd] Automatic shortening of text to fit into area
In-Reply-To: <05F24935-EBEE-432C-83C9-E2BF2717878E@uwaterloo.ca>
References: <05F24935-EBEE-432C-83C9-E2BF2717878E@uwaterloo.ca>
Message-ID: <alpine.OSX.1.00.0901250659070.32948@tystie.local>

Almost all devices do support clipping, so this is  rather a minority 
interest.

The person who AFAIK worte that comment and designed the clipping in 
the engine is Paul Murrell.  He has been on summer vacation, but it 
looks like he has just returned.  I suggest contacting him directly if 
he does nto respond to these postings.

On Sat, 24 Jan 2009, Sebastian Fischmeister wrote:

> Hello,
>
> A comment in engine.c states: "/* don't draw anything; this could be made 
> less crude :) */". The following patch makes it less crude: If the device 
> doesn't support clipping and the text doesn't fit into the area, then remove 
> one character after another from the text until either the text fits or the 
> string is empty.
>
> I attached the patch?it's not indented correctly to keep the patch size 
> small?and a test script, so you can give it a try. I don't know the R core 
> very well, so this change may need some discussion. Yet it works for my 
> figures.
>
> Have fun,
> Sebastian
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From macrakis at alum.mit.edu  Sun Jan 25 22:09:19 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Sun, 25 Jan 2009 16:09:19 -0500
Subject: [Rd] Defining an iterator
Message-ID: <8b356f880901251309v7e986f3bl3e734657cf093245@mail.gmail.com>

Inspired by Rudolf Biczok's query of Fri, Jan 23, 2009 at 1:25 AM, I
tried to implement iteration in a generic way using S4. (Though I am
admittedly still struggling with learning S4.)

> setClass("foo",representation(bar="list"))
[1] "foo"
> x<-new("foo",bar=list(1,2,3))

Given this, I would not expect for(i in x)... to work, since R has no
way of knowing that x at bar should be used as is.  What would it do if
the representation included two lists?  What if list(1,2,3) is used by
the class foo to represent something else?

But I did hope that I could put in place some definitions so that the
*class* could define an iterator.

First I tried overloading `for` to allow the definition of iterator
classes, but as a primitive function, `for` cannot be overloaded.

Then I tried to see how the Containers package handles iterators:

> library(Containers);.jinit();.jpackage("Containers")
> ah = MaxHeap(); ah$insert(3)
> for (i in ah) print(i)
[1] NA
> as.list(ah)
[[1]]
[1] NA

Bit it appears that the Containers package's Iterators don't interface
with R's `for` or type conversion system.

So I gave up on iterators, but thought I'd try automatic conversion to lists.

So I defined an automatic conversion from foo to list, since `for`'s
seq argument is specified as "An expression evaluating to a vector
(including a list...)":

    setAs("foo","list",function(from)from at bar)

This and various variants (using "numeric" or "vector" instead of
"list") all give errors.  Is there perhaps some 'sequence' superclass
that I am ignorant of?

I *was* able to overload lapply:

> setMethod("lapply","foo",function(X,FUN,...) lapply(X at bar,FUN,...))
> lapply(x,dput); NULL
1
2
3
NULL

but of course that doesn't affect `for` and other places that expect sequences.

Is there in fact some generic way to handle define iterators or
abstract sequences in R?

          -s


From p.murrell at auckland.ac.nz  Sun Jan 25 23:01:51 2009
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Mon, 26 Jan 2009 11:01:51 +1300
Subject: [Rd] Automatic shortening of text to fit into area
In-Reply-To: <alpine.OSX.1.00.0901250659070.32948@tystie.local>
References: <05F24935-EBEE-432C-83C9-E2BF2717878E@uwaterloo.ca>
	<alpine.OSX.1.00.0901250659070.32948@tystie.local>
Message-ID: <497CE14F.1040409@stat.auckland.ac.nz>

Hi


Prof Brian Ripley wrote:
> Almost all devices do support clipping, so this is  rather a minority 
> interest.


As a measure of the rarity, I wrote that code almost 10 years ago and
this is the first mention of this problem (though perhaps there are
millions out there suffering in silence ...).

I agree that dropping one character at a time and trying again would be
better than just not drawing anything, and your patch is nice and light
(especially given the nasty complexity of the GEText code), but the
suggested patch only addresses the case where the text extends out the
right hand side of the device (and is not rotated).  The modification
also needs to handle the case(s) where the characters should be dropped
from the front of the text.  I also wonder whether it might be possible
to make the patch local to just the clipTextCode() function (because the
clipTextCode function that it calls does its own calculation of the text
width and height).

Paul


> The person who AFAIK worte that comment and designed the clipping in 
> the engine is Paul Murrell.  He has been on summer vacation, but it 
> looks like he has just returned.  I suggest contacting him directly if 
> he does nto respond to these postings.
> 
> On Sat, 24 Jan 2009, Sebastian Fischmeister wrote:
> 
>> Hello,
>>
>> A comment in engine.c states: "/* don't draw anything; this could be made 
>> less crude :) */". The following patch makes it less crude: If the device 
>> doesn't support clipping and the text doesn't fit into the area, then remove 
>> one character after another from the text until either the text fits or the 
>> string is empty.
>>
>> I attached the patch?it's not indented correctly to keep the patch size 
>> small?and a test script, so you can give it a try. I don't know the R core 
>> very well, so this change may need some discussion. Yet it works for my 
>> figures.
>>
>> Have fun,
>> Sebastian
>>
> 
> 
> ------------------------------------------------------------------------
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From jmc at r-project.org  Mon Jan 26 01:08:39 2009
From: jmc at r-project.org (John Chambers)
Date: Sun, 25 Jan 2009 16:08:39 -0800
Subject: [Rd] Defining an iterator
In-Reply-To: <8b356f880901251309v7e986f3bl3e734657cf093245@mail.gmail.com>
References: <8b356f880901251309v7e986f3bl3e734657cf093245@mail.gmail.com>
Message-ID: <497CFF07.4020203@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090125/6ec8230d/attachment.pl>

From p.dalgaard at biostat.ku.dk  Mon Jan 26 01:20:09 2009
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Mon, 26 Jan 2009 01:20:09 +0100
Subject: [Rd] FW: [R] The Quality & Accuracy of R
In-Reply-To: <8C5F8DF18B90FA43BB9B356227F812D545145F@KFSVS6.utk.tennessee.edu>
References: <8C5F8DF18B90FA43BB9B356227F812D545145F@KFSVS6.utk.tennessee.edu>
Message-ID: <497D01B9.7040303@biostat.ku.dk>

Muenchen, Robert A (Bob) wrote:
>Dear R Developers,
> 
> This is my first time subscribing to this list, so let me start out
> by
saying thank you all very much for the incredible contribution you have
made to science through your work on R.
> 
> As you all know many users of commercial stat packages, their
managers, directors, CIOs etc. are skeptical of R's quality/accuracy.
And as the recent NY Times article demonstrated, the commercial vendors
rarely miss an opportunity stoke those fears. I have read many r-help
posts on this subject so I was aware that R was developed and tested
with great care, but until I read the clinical trials doc, I was not
aware that they were as many steps and that they were as rigorous (use
of version management software, etc.) Even as I read the document, the
opening paragraphs made me think it was far too focused to be of general
use. Luckily, I kept reading through the CFRs. Modifying that doc would
take little effort as I outlined in my original post (below). Putting it
in easy reach of every R user is important. By adding that to the docs
in R's Help menu, and adding a FAQ entry for it, all R users will have
ready access to it.
> 
> My second suggestion is adding an option to the R installation that
would let every R user run the test suite, very clearly showing them
that it is being done. I realize this is a superfluous step, since you
have already run the test suite against R before releasing it. However,
it would provide user assurance that they could easily demonstrate to
skeptics that very thorough testing is being done. I don't know whether
written messages that I suggested below would be best, or simply showing
the output scrolling by would have the most impact. Perhaps both, as in
a message "Testing accuracy of linear regression..." in a message window
while the output scrolled by in the console.
> 
> Rather than having this as a part of installation, an alternative
would be to end the installation with a message pointing people to a
function like validate.R() and an equivalent menu selection as a
following step. That would ensure that everyone knows the option exists,
plus it enables any R user to run the tests for skeptics at any time.
The easier it is to run the test suite the better.
> 
> The complete set of validation programs you use may be huge and
impractical for most people to run. In that case, perhaps just a subset
could be compiled, with an emphasis on testing the common statistical
functions that people are likely to focus their concern upon.
> 
> Asking to add a superfluous step to an installation may seem like a
waste of time, and technically it is. But psychologically this testing
will have a important impact that will silence many critics. Thanks for
taking the time to consider it.

Now that I've asked you in, I probably should at least chip in with a 
couple of brief notes on the issue:

- not everything can be validated, and it's not like the commercial 
companies are validating everything. E.g. nonlinear regression code will 
give different results on different architectures, or even different 
compilers on the same architecture, and may converge on one and not on 
another.

- end-user validation is in principle a good thing, but please notice 
that what we currently do is part of a build from sources, and requires 
that build tools are installed. (E.g., we don't just run things, we also 
compare them to known outputs.) It's not entirely trivial to push these 
techniques to the end user.

- a good reason to want post-install validation is that validity can 
depend on other part of the system outside developer control (e.g. an 
overzealous BLAS optimization, sacrificing accuracy and/or standards 
compliance for speed, can cause trouble). This is also a reason for not 
making too far-reaching statements about validity.

- I'm not too happy about maintaining the same information in multiple 
places. One thing we learned from the FDA document is how easily factual 
errors creep in and how silly we'd look if, say, the location of a key 
server got stated incorrectly, or say that we release one patch version 
when in fact the most recent one had two. This kind of authoritative 
document itself needs a verification process to ensure that it is correct.

Best,

-pd

> 
> Best regards, Bob
> 
> -----Original Message-----
> From: Peter Dalgaard [mailto:p.dalgaard at biostat.ku.dk] 
> Sent: Saturday, January 24, 2009 4:53 AM
> To: Muenchen, Robert A (Bob)
> Cc: R-help at r-project.org
> Subject: Re: [R] The Quality & Accuracy of R
> 
> Bob,
> 
> Your point is well taken, but it also raises a number of issues 
> (post-install testing to name one) for which the R-devel list would be 
> more suitable. Could we move the discussion there?
> 
> 	-Peter
> 
> 
> Muenchen, Robert A (Bob) wrote:
>> Hi All,
>>
>>  
>>
>> We have all had to face skeptical colleagues asking if software made by
>> volunteers could match the quality and accuracy of commercially written
>> software. Thanks to the prompting of a recent R-help thread, I read, "R:
>> Regulatory Compliance and Validation Issues, A Guidance Document for the
>> Use of R in Regulated Clinical Trial Environments
>> (http://www.r-project.org/doc/R-FDA.pdf). This is an important document,
>> of interest to the general R community. The question of R's accuracy is
>> such a frequent one, it would be beneficial to increase the visibility
>> of the non-clinical  information it contains. A document aimed at a
>> general audience, entitled something like, "R: Controlling Quality and
>> Assuring Accuracy" could be compiled from the these sections:
>>
>>  
>>
>> 1.      What is R? (section 4)
>>
>> 2.      The R Foundation for Statistical Computing (section  3)
>>
>> 3.      The Scope of this Guidance Document (section 2)
>>
>> 4.      Software Development Life Cycle (section 6)
>>
>>  
>>
>> Marc Schwartz, Frank Harrell, Anthony Rossini, Ian Francis and others
>> did such a great job that very few words would need to change. The only
>> addition I suggest is to mention how well R did in, Keeling & Parvur's
>> "A comparative study of the reliability to nine statistical software
>> packages, May 1, 2007 Computational Statistics & Data Analysis, Vol.51,
>> pp 3811-3831. 
>>
>>  
>>
>> Given the importance of this issue, I would like to see such a document
>> added to the PDF manuals in R's Help.
>>
>>  
>>
>> The document mentions (Sect. 6.3) that a set of validation tests, data
>> and known results are available. It would be useful to have an option to
>> run that test suite in every R installation, providing clear progress,
>> "Validating accuracy of t-tests...Validating accuracy of linear
>> regression...." Whether or not people chose to run the tests, they would
>> at least know that such tests are available. Back in my mainframe
>> installation days, this step was part of many software installations and
>> it certainly gave the impression that those were the companies that took
>> accuracy seriously. Of course the other companies probably just ran
>> their validation suite before shipping, but seeing it happen had a
>> tremendous impact.  I don't know how much this would add to download,
>> but if it was too much, perhaps it could be implemented as a separate
>> download. 
>>
>>  
>>
>> I hope these suggestions can help mitigate the concerns so many non-R
>> users have.


-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From mtmorgan at fhcrc.org  Mon Jan 26 02:06:10 2009
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Sun, 25 Jan 2009 17:06:10 -0800
Subject: [Rd] Defining an iterator
In-Reply-To: <8b356f880901251309v7e986f3bl3e734657cf093245@mail.gmail.com>
	(Stavros Macrakis's message of "Sun, 25 Jan 2009 16:09:19 -0500")
References: <8b356f880901251309v7e986f3bl3e734657cf093245@mail.gmail.com>
Message-ID: <6phtz7mlvul.fsf@gopher4.fhcrc.org>

Stavros Macrakis <macrakis at alum.mit.edu> writes:

> Inspired by Rudolf Biczok's query of Fri, Jan 23, 2009 at 1:25 AM, I
> tried to implement iteration in a generic way using S4. (Though I am
> admittedly still struggling with learning S4.)
>
>> setClass("foo",representation(bar="list"))
> [1] "foo"
>> x<-new("foo",bar=list(1,2,3))

As an idea...

It seems like iteration (might) imply that the class to be iterated
over has methods for determining its length, and for subsetting. So...

setClass("Class",
         representation=representation(slt="numeric"))

## basic methods: construction, slot access, show

Class <- function(slt, ...) {
    new("Class", slt=slt, ...)
}

slt <- function(x, ...) slot(x, "slt")

setMethod(show, "Class", function(object) {
    cat("class:", class(object), " length:", length(object), "\n")
    cat("slt:", slt(object), "\n")
})

## an 'iterator' interface

setMethod(length, "Class", function(x) {
    length(slot(x, "slt"))
})

setMethod("[", c("Class", "ANY", "missing"),
          function(x, i, j, ..., drop=TRUE)
{
    new("Class", x, slt=slt(x)[i])
})

setMethod("[[", c("Class", "ANY", "missing"),
          function(x, i, j, ..., drop=TRUE)
{
    slt(x)[[i]]
})

I'd then want a generic function whose responsibility it is to return
an iterator

setGeneric("iterator",
           function(x, ...) standardGeneric("iterator"))

and an implementation for my class

setMethod(iterator, "Class", function(x, ...) {
    seq_len(length(x))
})


I'd then use it as

> x <- Class(1:5)
> for (i in iterator(x)) print(x[[i]])
[1] 1
[1] 2
[1] 3
[1] 4
[1] 5

One could kludge a cleaner syntax by having Class contain an integer
vector whose length was kept in synch with the length of the instance.

Alternative strategies might have the 'iterator' function return a
list of objects of a class that 'knows' about x and where in the
iteration it is, with a syntax like

for (it in iterator(x)) print(it(x))

or to define 'iterator' to return an object that knows how to find the
next iterator

it = iterator(x)
while (!done(it)) {
  print(it(x))
  it = next(it)
}

Both of these imply that 'it' is a class, and that potentially many of
these objects are to be created; the efficiency of the S4 system would
not encourage this approach. They might also imply copying of x,
leading to both performance issues and problems about what the value
of x is supposed to be if modified during an iteration.

Martin

> Given this, I would not expect for(i in x)... to work, since R has no
> way of knowing that x at bar should be used as is.  What would it do if
> the representation included two lists?  What if list(1,2,3) is used by
> the class foo to represent something else?
>
> But I did hope that I could put in place some definitions so that the
> *class* could define an iterator.
>
> First I tried overloading `for` to allow the definition of iterator
> classes, but as a primitive function, `for` cannot be overloaded.
>
> Then I tried to see how the Containers package handles iterators:
>
>> library(Containers);.jinit();.jpackage("Containers")
>> ah = MaxHeap(); ah$insert(3)
>> for (i in ah) print(i)
> [1] NA
>> as.list(ah)
> [[1]]
> [1] NA
>
> Bit it appears that the Containers package's Iterators don't interface
> with R's `for` or type conversion system.
>
> So I gave up on iterators, but thought I'd try automatic conversion to lists.
>
> So I defined an automatic conversion from foo to list, since `for`'s
> seq argument is specified as "An expression evaluating to a vector
> (including a list...)":
>
>     setAs("foo","list",function(from)from at bar)
>
> This and various variants (using "numeric" or "vector" instead of
> "list") all give errors.  Is there perhaps some 'sequence' superclass
> that I am ignorant of?
>
> I *was* able to overload lapply:
>
>> setMethod("lapply","foo",function(X,FUN,...) lapply(X at bar,FUN,...))
>> lapply(x,dput); NULL
> 1
> 2
> 3
> NULL
>
> but of course that doesn't affect `for` and other places that expect sequences.
>
> Is there in fact some generic way to handle define iterators or
> abstract sequences in R?
>
>           -s
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin Morgan
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M2 B169
Phone: (206) 667-2793


From luke at stat.uiowa.edu  Mon Jan 26 03:32:50 2009
From: luke at stat.uiowa.edu (luke at stat.uiowa.edu)
Date: Sun, 25 Jan 2009 20:32:50 -0600 (CST)
Subject: [Rd] Defining an iterator
In-Reply-To: <497CFF07.4020203@r-project.org>
References: <8b356f880901251309v7e986f3bl3e734657cf093245@mail.gmail.com>
	<497CFF07.4020203@r-project.org>
Message-ID: <Pine.LNX.4.64.0901252015430.3628@itasca2.wildberry.org>

On Sun, 25 Jan 2009, John Chambers wrote:

> It's unclear from your mail what you actually tried to do, but here are
> a few comments that may be relevant.
>
> The syntactic form for() is indeed implemented as a primitive
> function.   Some primitives can and are used as generic functions, but
> `for` is not currently one of them.
>
> > setGeneric("for")
> Error in genericForPrimitive(f) :
>  methods may not be defined for primitive function "for" in this
> version of R
>
> Allowing methods for it would be possible in a future version.  This
> would be a little odd, since the syntax does not look like a function
> call. Still, it's an interesting idea, and I don't know of anything
> offhand to prevent its implementation.

I would VERY STRONGLY prefer NOT to go down this road as it would
significantly complicate code analysis and compilation at no great
benefit I can see.  Allowing the current for() code to accept an
iterator object of some sort is reasonable and would not create any
issues.  Figuring out what such an iterator should be is a little
harder and depends in part on whether we would want to support things
more general than vector-like objects, such infinite and mutable
collections.

luke

>  The natural interpretation would
> be for the signature of the generic to be the second argument
> (primitives don't intrinsically have argument names, so we would make
> one up, `seq` is used in the documentation, although something like
> `object` would be more suggestive).
>
> Your comments about coercing are unclear and you showed no examples of
> what supposedly went wrong.  In fact, that approach works fine:
>
> > setClass("foo",representation(bar="list"))
> [1] "foo"
> > setAs("foo","list",function(from)from at bar)
> > xx = new("foo", bar = list(1,2,3))
> > as(xx, "list")
> [[1]]
> [1] 1
>
> [[2]]
> [1] 2
>
> [[3]]
> [1] 3
>
> > for(i in as(xx, "list")) dput(i)
> 1
> 2
> 3
>
> Of course, this is not exactly defining methods for the iterator, but
> would be a sensible workaround in practice.
>
> Along the same lines, if one asks how the underlying ideas fit naturally
> into R, as opposed to making R behave more like other languages, here's
> my take on that.  The `for` operator is defined to work on vectors of
> various kinds.  If a new class is supposed to be "like" a vector, then
> the two natural choices are to define a method to coerce it to a vector
> (as in the example above) or to make it a subclass of "vector" (or of a
> specific vector class):
>
> > setClass("baz", contains = "vector")
> [1] "baz"
> > yy = new("baz", list(1,2,3))
> > for(i in yy) dput(i)
> 1
> 2
> 3
>
> Which choice works best depends on what the "real" meaning of the class
> is (there's discussion of these and other alternatives in section 9.3 of
> "Software for Data Analysis").
>
>
> John Chambers
>
> Stavros Macrakis wrote:
>> Inspired by Rudolf Biczok's query of Fri, Jan 23, 2009 at 1:25 AM, I
>> tried to implement iteration in a generic way using S4. (Though I am
>> admittedly still struggling with learning S4.)
>>
>>
>>> setClass("foo",representation(bar="list"))
>>>
>> [1] "foo"
>>
>>> x<-new("foo",bar=list(1,2,3))
>>>
>>
>> Given this, I would not expect for(i in x)... to work, since R has no
>> way of knowing that x at bar should be used as is.  What would it do if
>> the representation included two lists?  What if list(1,2,3) is used by
>> the class foo to represent something else?
>>
>> But I did hope that I could put in place some definitions so that the
>> *class* could define an iterator.
>>
>> First I tried overloading `for` to allow the definition of iterator
>> classes, but as a primitive function, `for` cannot be overloaded.
>>
>> Then I tried to see how the Containers package handles iterators:
>>
>>
>>> library(Containers);.jinit();.jpackage("Containers")
>>> ah = MaxHeap(); ah$insert(3)
>>> for (i in ah) print(i)
>>>
>> [1] NA
>>
>>> as.list(ah)
>>>
>> [[1]]
>> [1] NA
>>
>> Bit it appears that the Containers package's Iterators don't interface
>> with R's `for` or type conversion system.
>>
>> So I gave up on iterators, but thought I'd try automatic conversion to lists.
>>
>> So I defined an automatic conversion from foo to list, since `for`'s
>> seq argument is specified as "An expression evaluating to a vector
>> (including a list...)":
>>
>>     setAs("foo","list",function(from)from at bar)
>>
>> This and various variants (using "numeric" or "vector" instead of
>> "list") all give errors.  Is there perhaps some 'sequence' superclass
>> that I am ignorant of?
>>
>> I *was* able to overload lapply:
>>
>>
>>> setMethod("lapply","foo",function(X,FUN,...) lapply(X at bar,FUN,...))
>>> lapply(x,dput); NULL
>>>
>> 1
>> 2
>> 3
>> NULL
>>
>> but of course that doesn't affect `for` and other places that expect sequences.
>>
>> Is there in fact some generic way to handle define iterators or
>> abstract sequences in R?
>>
>>           -s
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From macrakis at alum.mit.edu  Mon Jan 26 04:09:00 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Sun, 25 Jan 2009 22:09:00 -0500
Subject: [Rd] Defining an iterator
In-Reply-To: <497CFF07.4020203@r-project.org>
References: <8b356f880901251309v7e986f3bl3e734657cf093245@mail.gmail.com>
	<497CFF07.4020203@r-project.org>
Message-ID: <8b356f880901251909i7a9f78f8oce6a8e1f5dd1e96b@mail.gmail.com>

Thank you for your helpful reply, which clarified several issues for me.

         -s


From Dan.Kelley at dal.ca  Sun Jan 25 22:12:40 2009
From: Dan.Kelley at dal.ca (Dan Kelley)
Date: Sun, 25 Jan 2009 13:12:40 -0800 (PST)
Subject: [Rd]  Warning: closing unused connection 3
Message-ID: <21656751.post@talk.nabble.com>


The subject is a warning that occurs with my 'oce' package in the test on
r-devel-windows-ix86, i.e.

http://cran.r-project.org/web/checks/check_results_oce.html

I see that some other packages have this same error.  I tried searching
postings to this group for this warning, but found nothing.  I'm pretty sure
this warning message was not there a week ago.

Q: is there something I should do, to track down my error, or is this an
error in the testing itself?

Thanks.  Dan.
-- 
View this message in context: http://www.nabble.com/Warning%3A-closing-unused-connection-3-tp21656751p21656751.html
Sent from the R devel mailing list archive at Nabble.com.


From Sachinthaka.Abeywardana at csiro.au  Sun Jan 25 00:12:08 2009
From: Sachinthaka.Abeywardana at csiro.au (sachin1234)
Date: Sat, 24 Jan 2009 15:12:08 -0800 (PST)
Subject: [Rd] loading RBlas.dll
In-Reply-To: <b0808fdc0901231121p77d3f26ctc45778ea689aa760@mail.gmail.com>
References: <21617712.post@talk.nabble.com>
	<b0808fdc0901231121p77d3f26ctc45778ea689aa760@mail.gmail.com>
Message-ID: <21646457.post@talk.nabble.com>


hi Antonio,

The name's Sachin :) . I need this because im not implementing the ATLAS,
fast BLAS or anything like that. What im trying to do is to make a GPU
version of blas. I have implemented this so far but extremely inefficiently.
What i need to do is to do things like initialisation of the GPU hardware as
soon as Rblas.dll gets loaded.

Whats happening so far is something like this:

GPU_DGEMM (arguments)}/*this is a blas function*/
    initialise_GPU;
    /*rest of code*/
    return;
}

sorry for not being clear
sachin


Antonio, Fabio Di Narzo wrote:
> 
> hi, whoever you are (I've seen no signature),
> 
> 2009/1/22 sachin1234 <Sachinthaka.Abeywardana at csiro.au>:
>>
>> hi everyone,
>>
>> Im implementing a new RBlas dll but just for optimising sake i need to
>> know
>> how and WHERE (which source code) RBlas gets loaded. there is a call to
>> loadlibrary() in dynload.c BUT it seems this is not the function that is
>> loading Rblas.
> 
> Why do you need this? The R-admin manual explains how to replace the R
> built-in version of Blas with a custom, optimized one. Is this what
> are you looking for? One of the methods mentioned here doesn't even
> require re-compilation of R.
> 
> Bests,
> f.
> 
>>
>> how do i know this? well i added the code :(just after the loadlibrary()
>> call)
>>        /*********************************************/
>>        /*this section writes into files which libraries were loaded*/
>>        file=fopen("libraries.txt","a");
>>        fputs(path,file);
>>        fputs("\n",file);
>>        fclose(file);
>>        /******************************************/
>> so that it prints out the path names of which ever libraries are loaded
>> and
>> the output is:
>> C:/DOCUME~1/abe044/MYDOCU~1/PROJEC~1/GPU_BLAS/R-28~1.1/library/methods/libs/methods.dll
>> C:/DOCUME~1/abe044/MYDOCU~1/PROJEC~1/GPU_BLAS/R-28~1.1/library/grDevices/libs/grDevices.dll
>> C:/DOCUME~1/abe044/MYDOCU~1/PROJEC~1/GPU_BLAS/R-28~1.1/library/stats/libs/stats.dll
>>
>> and i think i got tools.dll to load as well. I cant find where R.dll,
>> Rblas.dll etc gets loaded. My main focus is Rblas.dll
>>
>> now heres what i expect. Whenever you open R it runs one of its script
>> files
>> which contains dyn.load and loads it. HOWEVER as far as i understand
>> dyn.load must be using dynload.c. Hence it should spit loading blas into
>> libraries.txt which it doesnt do.
>>
>> I am stumped. I've spend nearly 2 days on this. any help would be
>> appreciated
>>
>>
>> --
>> View this message in context:
>> http://www.nabble.com/loading-RBlas.dll-tp21617712p21617712.html
>> Sent from the R devel mailing list archive at Nabble.com.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> 
> 
> 
> -- 
> Antonio, Fabio Di Narzo
> Ph.D. student at
> Department of Statistical Sciences
> University of Bologna, Italy
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
View this message in context: http://www.nabble.com/loading-RBlas.dll-tp21617712p21646457.html
Sent from the R devel mailing list archive at Nabble.com.


From ripley at stats.ox.ac.uk  Mon Jan 26 09:07:52 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 26 Jan 2009 08:07:52 +0000 (GMT)
Subject: [Rd] Warning: closing unused connection 3
In-Reply-To: <21656751.post@talk.nabble.com>
References: <21656751.post@talk.nabble.com>
Message-ID: <alpine.OSX.1.00.0901260802190.49171@tystie.local>

Well, R-devel is 'under developemnt'.  That log is from Jan 22, and 
the message shouild no longer occur on Jan 25.

The help build process for R 2.9.0 is so far off final form that you 
just need some patience.

It would be helpful to mention in your subject line that this is for a 
development version of R on Windows.  Especially since Windows 
development lags that in Unix by a few days on occasion (and the cause 
here was specific to Windows, and harmless).

On Sun, 25 Jan 2009, Dan Kelley wrote:

>
> The subject is a warning that occurs with my 'oce' package in the test on
> r-devel-windows-ix86, i.e.
>
> http://cran.r-project.org/web/checks/check_results_oce.html
>
> I see that some other packages have this same error.  I tried searching
> postings to this group for this warning, but found nothing.  I'm pretty sure
> this warning message was not there a week ago.
>
> Q: is there something I should do, to track down my error, or is this an
> error in the testing itself?
>
> Thanks.  Dan.
> --
> View this message in context: http://www.nabble.com/Warning%3A-closing-unused-connection-3-tp21656751p21656751.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Mon Jan 26 09:10:46 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 26 Jan 2009 08:10:46 +0000 (GMT)
Subject: [Rd] loading RBlas.dll
In-Reply-To: <21646457.post@talk.nabble.com>
References: <21617712.post@talk.nabble.com>
	<b0808fdc0901231121p77d3f26ctc45778ea689aa760@mail.gmail.com>
	<21646457.post@talk.nabble.com>
Message-ID: <alpine.OSX.1.00.0901260808280.49171@tystie.local>

So you don't need this: you just need to replace Rblas.dll.

DLLs can contain initialization code: that is standard Windows' 
practice so please read up on it.

On Sat, 24 Jan 2009, sachin1234 wrote:

>
> hi Antonio,
>
> The name's Sachin :) . I need this because im not implementing the ATLAS,
> fast BLAS or anything like that. What im trying to do is to make a GPU
> version of blas. I have implemented this so far but extremely inefficiently.
> What i need to do is to do things like initialisation of the GPU hardware as
> soon as Rblas.dll gets loaded.
>
> Whats happening so far is something like this:
>
> GPU_DGEMM (arguments)}/*this is a blas function*/
>    initialise_GPU;
>    /*rest of code*/
>    return;
> }
>
> sorry for not being clear
> sachin
>
>
> Antonio, Fabio Di Narzo wrote:
>>
>> hi, whoever you are (I've seen no signature),
>>
>> 2009/1/22 sachin1234 <Sachinthaka.Abeywardana at csiro.au>:
>>>
>>> hi everyone,
>>>
>>> Im implementing a new RBlas dll but just for optimising sake i need to
>>> know
>>> how and WHERE (which source code) RBlas gets loaded. there is a call to
>>> loadlibrary() in dynload.c BUT it seems this is not the function that is
>>> loading Rblas.
>>
>> Why do you need this? The R-admin manual explains how to replace the R
>> built-in version of Blas with a custom, optimized one. Is this what
>> are you looking for? One of the methods mentioned here doesn't even
>> require re-compilation of R.
>>
>> Bests,
>> f.
>>
>>>
>>> how do i know this? well i added the code :(just after the loadlibrary()
>>> call)
>>>        /*********************************************/
>>>        /*this section writes into files which libraries were loaded*/
>>>        file=fopen("libraries.txt","a");
>>>        fputs(path,file);
>>>        fputs("\n",file);
>>>        fclose(file);
>>>        /******************************************/
>>> so that it prints out the path names of which ever libraries are loaded
>>> and
>>> the output is:
>>> C:/DOCUME~1/abe044/MYDOCU~1/PROJEC~1/GPU_BLAS/R-28~1.1/library/methods/libs/methods.dll
>>> C:/DOCUME~1/abe044/MYDOCU~1/PROJEC~1/GPU_BLAS/R-28~1.1/library/grDevices/libs/grDevices.dll
>>> C:/DOCUME~1/abe044/MYDOCU~1/PROJEC~1/GPU_BLAS/R-28~1.1/library/stats/libs/stats.dll
>>>
>>> and i think i got tools.dll to load as well. I cant find where R.dll,
>>> Rblas.dll etc gets loaded. My main focus is Rblas.dll
>>>
>>> now heres what i expect. Whenever you open R it runs one of its script
>>> files
>>> which contains dyn.load and loads it. HOWEVER as far as i understand
>>> dyn.load must be using dynload.c. Hence it should spit loading blas into
>>> libraries.txt which it doesnt do.
>>>
>>> I am stumped. I've spend nearly 2 days on this. any help would be
>>> appreciated
>>>
>>>
>>> --
>>> View this message in context:
>>> http://www.nabble.com/loading-RBlas.dll-tp21617712p21617712.html
>>> Sent from the R devel mailing list archive at Nabble.com.
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>>
>> --
>> Antonio, Fabio Di Narzo
>> Ph.D. student at
>> Department of Statistical Sciences
>> University of Bologna, Italy
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> --
> View this message in context: http://www.nabble.com/loading-RBlas.dll-tp21617712p21646457.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Mon Jan 26 11:56:24 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 26 Jan 2009 11:56:24 +0100
Subject: [Rd] str(<1d-array>)
In-Reply-To: <4979D722.50404@comcast.net>
References: <59d7961d0901121243j6c5c0fcn5836d94a90666623@mail.gmail.com>
	<alpine.OSX.1.00.0901130744310.32363@tystie.local>
	<59d7961d0901130754j335c480fi673346cd20e031e@mail.gmail.com>
	<496CC8B8.6060606@pburns.seanet.com>
	<18800.40724.985949.449350@stat.math.ethz.ch>
	<4970E99C.9040907@acm.org>
	<18802.19793.445515.400975@cmath-5.math.ethz.ch>
	<4978B471.70506@acm.org>
	<18809.51183.231595.496032@stat.math.ethz.ch>
	<4979D722.50404@comcast.net>
Message-ID: <18813.38616.157549.97701@stat.math.ethz.ch>

>>>>> "MS" == Marc Schwartz <marc_schwartz at comcast.net>
>>>>>     on Fri, 23 Jan 2009 08:41:38 -0600 writes:

    MS> on 01/23/2009 07:36 AM Martin Maechler wrote:
    >>>>>>> "TP" == Tony Plate <tplate at acm.org> on Thu, 22 Jan
    >>>>>>> 2009 11:01:21 -0700 writes:
    >> 
    TP> Martin Maechler wrote:
    >> >>>>>>> "TP" == Tony Plate <tplate at acm.org> >>>>>>> on
    >> Fri, 16 Jan 2009 13:10:04 -0700 writes:
    >> >>>>>>> 
    >> >> 
    TP> Martin Maechler wrote:
    >> >> >>>>>>> "PatB" == Patrick Burns
    >> <pburns at pburns.seanet.com> >> >>>>>>> on Tue, 13 Jan 2009
    >> 17:00:40 +0000 writes:
    >> >> >>>>>>> 
    >> >> >> 
    PatB> Henrik Bengtsson wrote:
    >> >> >> >> Hi.
    >> >> >> >> 
    >> >> >> >> On Mon, Jan 12, 2009 at 11:58 PM, Prof Brian
    >> Ripley >> >> >> <ripley at stats.ox.ac.uk> wrote:
    >> >> >> >> 
    >> >> >> >>> What you have is a one-dimensional array: they
    >> crop up >> >> >>> in R most often from table() in my
    >> experience.
    >> >> >> >>> 
    >> >> >> >>> 
    >> >> >> >>>> f <- table(rpois(100, 4)) str(f)
    >> >> >> >>>> 
    >> >> >> >>> 'table' int [, 1:10] 2 6 18 21 13 16 13 4 3 4 -
    >> attr(*, >> >> >>> "dimnames")=List of 1 ..$ : chr [1:10]
    >> "0" "1" "2" "3" >> >> >>> ...
    >> >> >> >>> 
    >> >> >> >>> and yes, f is an atmoic vector and yes, str()'s
    >> notation >> >> >>> is confusing here but if it did [1:10]
    >> you would not >> >> >>> know it was an array.  I recall
    >> discussing this with >> >> >>> Martin Maechler (str's
    >> author) last century, and I've >> >> >>> just checked
    >> that R 2.0.0 did the same.
    >> >> >> >>> 
    >> >> >> >>> The place in which one-dimensional arrays
    >> differ from >> >> >>> normal vectors is how names are
    >> handled: notice that my >> >> >>> example has dimnames
    >> not names, and ?names says
    >> >> >> >>> 
    >> >> >> >>> For a one-dimensional array the 'names'
    >> attribute really >> >> >>> is 'dimnames[[1]]'.
    >> >> >> >>> 
    >> >> >> >> 
    >> >> >> >> Thanks for this explanation.  One could then
    >> argue that >> >> >> [1:10,] is somewhat better than
    >> [,1:10], but that is just polish.
    >> >> >> 
    >> >> >> yes.  And honestly I don't remember anymore why I
    >> chose the >> >> "[,1:n]" notation.  It definitely was
    >> there already before R >> >> came into existence, as S
    >> also has had one-dimensional arrays, >> >> and I
    >> programmed the first version of str() in 1990.
    >> >> >> 
    PatB> Perhaps it could be:
    >> >> >> 
    PatB> [1:10(,)]
    >> 
    PatB> That is weird enough that it should not lead people to
    PatB> believe that it is a matrix.  But might prompt them a
    PatB> bit in that direction.
    >> >> >> 
    >> >> >> Well, str() was always aimed a bit at experienced S
    >> (and R) >> >> users, and I had always aimed somewhat to
    >> keep it's output >> >> "compact".  I'm quite astonished
    >> that the OP didn't know about >> >> 1D arrays in spite of
    >> the many years he's been using R.  >> >> Would a wierd
    >> solution like the above have helped?
    >> >> >> 
    >> >> >> At the moment, I'd tend to keep it "as is" if only
    >> just for >> >> historical reminescence, but I can be
    >> convinced to change the >> >> current "tendency" ...
    >> >> >> 
    >> >> >> Martin Maechler, ETH Zurich
    >> >> >> 
    TP> What about just including "(1d-array)", something like
    TP> this
    >> >> >> str(f)
    TP> 'table' int [1:10](1d array) 5 5 9 23 26 16 9 4 2 1 -
    TP> attr(*, "dimnames")=List of 1 ..$ : chr [1:10] "0" "1"
    TP> "2" "3" ...
    >> >> >> 
    TP> only 9 extra characters for a rare case, and much, much
    TP> less cryptic?
    >> >> 
    >> >> well,.. the next text request is to use >> "character"
    >> instead of "chr", only 6 extra characters ....
    >> >> 
    >> >> -> no way: str() has its very concise "style" and
    >> should keep that.
    >> >> 
    TP> Brevity is good, but clarity is important too.  The
    TP> output of str is usually decipherable, but not so much
    TP> in this case.  It's easy to dismiss suggestions like
    TP> replacing "chr" with "character" - the increase in
    TP> clarity would be minimal.  However, the potential
    TP> increase in clarity for a 1-d array is significant - the
    TP> decrease in brevity is at question here. Given the
    TP> rarity of the case it seems like a decent tradeoff to
    TP> add "(1d-array)" (one could even just write "(1d)").
    TP> 1-d arrays are sufficiently rare that no concise and
    TP> clear method of indicating them using brackets or other
    TP> symbols has arisen. You did say you "can be convinced to
    TP> change" it, but I won't attempt beyond this! :-)
    >> 
    >> well, "still can be .." .....
    >> 
    >> So you currently propose to replace "int [,1:10] 5 5 9 23
    >> 26 16 9 4 2 1" by "int [1:10](1d) 5 5 9 23 26 16 9 4 2 1"
    >> where Pat had "int [1:10(,)] 5 5 9 23 26 16 9 4 2 1"
    >> 
    >> Since the [.....] is where we specify the dimensionality
    >> of all arrays in str(), I'd like to try something where
    >> things remain inside "[....]" as with Pat's version or
    >> e.g., with
    >> 
    >> "int [1:10/1d] 5 5 9 23 26 16 9 4 2 1"
    >> 
    >> Opinions, further proposals ?

    MS> Recognizing that I am coming to this discussion quite
    MS> late, how about:

    MS>        int [1:10(1d)] 5 5 9 23 26 16 9 4 2 1

    MS> ?

    MS> I do think that any str() representation that includes a
    MS> ',' would continue to reinforce the current
    MS> misunderstandings pertaining to a 1d array.

    MS> Since using str() is a common response to posts on
    MS> r-help regarding how to access components of an object,
    MS> there will be naive users who would see something like
    MS> (using Prof. Ripley's example):

    >> str(f)
    MS>  'table' int [, 1:11] 1 9 15 21 15 17 13 5 1 2 ...  -
    MS> attr(*, "dimnames")=List of 1 ..$ : chr [1:11] "0" "1"
    MS> "2" "3" ...

    MS> and then think that they could do:

    >> f[, 1]
    MS> Error in f[, 1] : incorrect number of dimensions

    MS> which of course they cannot.

    MS> I think that the above change would help to reinforce
    MS> the notion that a 1d array can, for the most part, be
    MS> treated as an atomic vector.  However, as Prof. Ripley
    MS> has noted, there is a subtle difference in how
    MS> names/dimnames are treated. The use of '(1d)' in the
    MS> str() output would make it clear that this object is not
    MS> quite a simple atomic vector, but when indexing, can be
    MS> treated as such.

    MS> Regards,

    MS> Marc Schwartz

No further comments from the audience ...
In R-core tradition, I take this as 
"yes go ahead if you want"
and I'm about to implement the latest proposal from Marc 
for R-devel,

e.g.

> str(array(1:6, 6))
  int [1:6(1d)] 1 2 3 4 5 6

> str(array(LETTERS, 100))
 chr [1:100(1d)] "A" "B" "C" "D" "E" "F" "G" "H" "I" ...

-- 
Martin Maechler, ETH Zurich


From murdoch at stats.uwo.ca  Mon Jan 26 13:04:39 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 26 Jan 2009 07:04:39 -0500
Subject: [Rd] [R] can't load rJava in R 2.8.1 on Windows XP
In-Reply-To: <loom.20090126T082805-644@post.gmane.org>
References: <4979BA58.20909@googlemail.com>	<4979CAB7.1090708@stats.uwo.ca>	<4979D7D4.7000509@googlemail.com>	<4979DACF.2070206@stats.uwo.ca>	<loom.20090123T170231-341@post.gmane.org>	<497A21C5.1040507@stats.uwo.ca>	<loom.20090123T203821-818@post.gmane.org>	<497A5D6E.30309@stats.uwo.ca>	<loom.20090124T205510-904@post.gmane.org>	<497B879D.2000305@stats.uwo.ca>
	<loom.20090126T082805-644@post.gmane.org>
Message-ID: <497DA6D7.6070908@stats.uwo.ca>

Dieter Menne wrote:
> Duncan Murdoch <murdoch <at> stats.uwo.ca> writes:
>
>   
>> I don't know what's going wrong on your system.  I added a browser() 
>> call to the .onLoad function in R/windows/FirstLib.R on my system, and I 
>> see it successfully gets JAVA_HOME from the registry.  It gets a number 
>> of other files, then adds these paths to my PATH variable.  I've used 
>> strsplit() to separate them for viewing.
>>
>> [14] "C:\\Program Files\\Java\\jre1.6.0_07\\bin\\client"
>> [15] "C:\\Program Files\\Java\\jre1.6.0_07/bin"
>> [16] "C:\\Program Files\\Java\\jre1.6.0_07/bin/client"
>> [17] "C:\\Program Files\\Java\\jre1.6.0_07/jre/bin/client"
>>
>> I believe LoadLibrary needs paths to be specified with backslashes, so 
>> you might be able to fix things on your system by changing the file.path 
>> calls in that function to use fsep="\\" instead of the default "/".
>>     
>
> Thanks for your help. 
>
> I think I tracked it down. It has nothing to do with rJava, but
> rather with Sys.getenv(). Looks like this function truncates around 1024
> characters, and my path is very long due to Visual Studio + Delphi
> + SQL Server.
>
> See the printout below. Note that the last entry should read \\Delphi,
> and that more entries are coming in my system path.
> This also explains why only some people have the problem.
> No workaround found yet. I keep this message here for other people who 
> have the problem, but possibly this is more for R-devel to be continued.
>   

Yes, I've moved this to R-devel.

If this is an R problem, it's in Sys.setenv:  putting a very long string 
and then starting a shell shows the truncated string, but within the 
shell it's possible to set a much longer one.

However, I don't see a fixed buffer size in the internal R code, so this 
looks like a problem in the run-time.  The docs on MSDN say that the 
system maintains separate user environment variables and system 
environment variables, and the system ones are limited to 1024 
characters:  so this could be our problem.  Our _wputenv call may be 
trying to set a system environment variable, and having it truncated.  
(There's also an overall limit of 32767 chars for all environment 
variables, but I'd guess you're hitting the 1024 byte limit.)

The docs also say there's a SetEnvironmentVariable API function as of 
Win2k, which is our minimal platform these days, so maybe switching to 
that would solve the problem.  I'll give it a try, but probably not today.

Duncan Murdoch
> Dieter
>
>   
>> p = Sys.getenv("PATH")
>> nchar(p) 
>>     
> PATH 
> 1019 
>   
>> strsplit(p,";")$PATH[-(1:27)]
>>     
> [1] "C:\\Program Files\\Microsoft SQL
> Server\\100\\Tools\\Binn\\VSShell\\Common7\\IDE\\"
> [2] "C:\\Program Files\\MiKTeX 2.7\\miktex\\bin"                           
> [3] "C:\\Users\\Dieter\\Documents\\Delp"
>   
>
> ______________________________________________
> R-help at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>


From murdoch at stats.uwo.ca  Mon Jan 26 14:13:57 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 26 Jan 2009 08:13:57 -0500
Subject: [Rd] [R] can't load rJava in R 2.8.1 on Windows XP
In-Reply-To: <497DA6D7.6070908@stats.uwo.ca>
References: <4979BA58.20909@googlemail.com>	<4979CAB7.1090708@stats.uwo.ca>	<4979D7D4.7000509@googlemail.com>	<4979DACF.2070206@stats.uwo.ca>	<loom.20090123T170231-341@post.gmane.org>	<497A21C5.1040507@stats.uwo.ca>	<loom.20090123T203821-818@post.gmane.org>	<497A5D6E.30309@stats.uwo.ca>	<loom.20090124T205510-904@post.gmane.org>	<497B879D.2000305@stats.uwo.ca>	<loom.20090126T082805-644@post.gmane.org>
	<497DA6D7.6070908@stats.uwo.ca>
Message-ID: <497DB715.4030501@stats.uwo.ca>

On 1/26/2009 7:04 AM, Duncan Murdoch wrote:
> Dieter Menne wrote:
>> Duncan Murdoch <murdoch <at> stats.uwo.ca> writes:
>>
>>   
>>> I don't know what's going wrong on your system.  I added a browser() 
>>> call to the .onLoad function in R/windows/FirstLib.R on my system, and I 
>>> see it successfully gets JAVA_HOME from the registry.  It gets a number 
>>> of other files, then adds these paths to my PATH variable.  I've used 
>>> strsplit() to separate them for viewing.
>>>
>>> [14] "C:\\Program Files\\Java\\jre1.6.0_07\\bin\\client"
>>> [15] "C:\\Program Files\\Java\\jre1.6.0_07/bin"
>>> [16] "C:\\Program Files\\Java\\jre1.6.0_07/bin/client"
>>> [17] "C:\\Program Files\\Java\\jre1.6.0_07/jre/bin/client"
>>>
>>> I believe LoadLibrary needs paths to be specified with backslashes, so 
>>> you might be able to fix things on your system by changing the file.path 
>>> calls in that function to use fsep="\\" instead of the default "/".
>>>     
>>
>> Thanks for your help. 
>>
>> I think I tracked it down. It has nothing to do with rJava, but
>> rather with Sys.getenv(). Looks like this function truncates around 1024
>> characters, and my path is very long due to Visual Studio + Delphi
>> + SQL Server.
>>
>> See the printout below. Note that the last entry should read \\Delphi,
>> and that more entries are coming in my system path.
>> This also explains why only some people have the problem.
>> No workaround found yet. I keep this message here for other people who 
>> have the problem, but possibly this is more for R-devel to be continued.
>>   
> 
> Yes, I've moved this to R-devel.
> 
> If this is an R problem, it's in Sys.setenv:  putting a very long string 
> and then starting a shell shows the truncated string, but within the 
> shell it's possible to set a much longer one.
> 
> However, I don't see a fixed buffer size in the internal R code, so this 
> looks like a problem in the run-time.  The docs on MSDN say that the 
> system maintains separate user environment variables and system 
> environment variables, and the system ones are limited to 1024 
> characters:  so this could be our problem.  Our _wputenv call may be 
> trying to set a system environment variable, and having it truncated.  
> (There's also an overall limit of 32767 chars for all environment 
> variables, but I'd guess you're hitting the 1024 byte limit.)
> 
> The docs also say there's a SetEnvironmentVariable API function as of 
> Win2k, which is our minimal platform these days, so maybe switching to 
> that would solve the problem.  I'll give it a try, but probably not today.

One more followup:  This article

http://support.microsoft.com/kb/906469

says that this is a problem in Windows XP SP2 and Windows Server 2003, 
and provides a fix for those systems.

Duncan Murdoch


From savicky at cs.cas.cz  Mon Jan 26 17:16:00 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Mon, 26 Jan 2009 17:16:00 +0100
Subject: [Rd] bug in cor.test(method = "spearman")
In-Reply-To: <20090117151950.GA9473@cs.cas.cz>
References: <20090117151950.GA9473@cs.cas.cz>
Message-ID: <20090126161600.GA16715@cs.cas.cz>

Hi All:

The p-value of Spearman's rank correlation test is calculated using algorithm
AS 89. However, the way how AS 89 is used incures error, which may be an order
of magnitude larger than the error of the original algorithm.

In case of no ties AS 89 expects an even value of the statistic
  S = sum((rank(x)-rank(y))^2)
Clearly, S is even, since there is an even number of odd differences.
We will also need the fact that S ranges between 0 and 2*n*(n^2 - 1)/6,
where n = length(x) = length(y).

In some situations, R calls AS 89 with an odd value of S. Namely,
if S < n*(n^2 - 1)/6 (this corresponds to a positive correlation), then
the R call of AS 89 uses as input for computing the lower tail the odd
value S+1 instead of the correct S+2 (see the explanation below why this
makes a difference). For values S > n*(n^2 - 1)/6 (negative correlation),
the R call uses the upper tail of the distribution with input S, which
is correct.

The fact that in case of no ties AS 89 expects an even S may be seen in
the C code. The file R-patched/src/library/stats/src/prho.c, lines 90 - 93
contains the following comment ("is" is the parametr containing the value of S)
    /* NOT rounding to even anymore:  with ties, S, may even be non-integer!
     * js = *is;
     * if(fmod(js, 2.) != 0.) ++js;
     */
Older versions of the algorithm (the original fortran code is available
at http://lib.stat.cmu.edu/apstat/89) performed a correction by increasing a
possible odd value of "is" by one to an even number. Since now the correction
is removed, the calling program should guarantee an even value of S in case of
no ties.

The original AS 89 calculates only the upper tail. R uses a modification, where
the lower tail is computed in the C code as the complement of the upper tail.
Hence, in order to get P(S <= s), we can call AS 89 with the input s+2 and ask
for the complement of the upper tail, since
  P(S <= s) = P(S < s+2) = 1 - P(S >= s+2),
where S denotes the random variable and s is an even number.

For the true distribution, we could equivalently use
  P(S <= s) = P(S < s+1) = 1 - P(S >= s+1),
since P(S >= s+1) = P(S >= s+2).

However, the approximation is a continuous function and its value in s+1 is
roughly a linear interpolation between its values in s and s+2, so it is usually
different from its value in s+2. Since the approximation is done under the
assumption that the input is even, the correct approximation is P(S >= s+2).

The following table contains the maximum absolute error of the original
algorithm and of the R implementation for n = 12, ... ,22. For each n, the
maximum error is computed over those values of S which satisfy S < n*(n^2 - 1)/6
(positive correlation) and for which the correct p-value of the two-sided
test is in the range [0.01, 0.1]. 

  n    err.orig   err.R      err.R/err.orig

  12   3.83e-04   2.75e-03    7.18
  13   2.24e-04   2.10e-03    9.39
  14   1.43e-04   1.75e-03   12.24
  15   9.52e-05   1.46e-03   15.32
  16   6.85e-05   1.26e-03   18.45
  17   5.18e-05   1.08e-03   20.89
  18   4.07e-05   9.40e-04   23.09
  19   3.28e-05   8.11e-04   24.73
  20   2.66e-05   7.11e-04   26.73
  21   2.16e-05   6.31e-04   29.22
  22   1.77e-05   5.62e-04   31.77

On the side of negative correlation (S > n*(n^2 - 1)/6), there is no difference
between the original algorithm and its R implementation. The table of the
maximum errors for the same range of p-values on the side of negative correlation
is as follows

  n    err.orig   err.R      err.R/err.orig

  12   3.83e-04   3.83e-04   1
  13   2.24e-04   2.24e-04   1
  14   1.43e-04   1.43e-04   1
  15   9.52e-05   9.52e-05   1
  16   6.85e-05   6.85e-05   1
  17   5.18e-05   5.18e-05   1
  18   4.07e-05   4.07e-05   1
  19   3.28e-05   3.28e-05   1
  20   2.66e-05   2.66e-05   1
  21   2.16e-05   2.16e-05   1
  22   1.77e-05   1.77e-05   1

The value n = 22 is the largest n, for which I have the exact probabilities.

A patch correcting the problem follows. It is indented with 2 spaces. An intact
version of the patch is in an attachment.

  diff --minimal -U 4 -r R-patched/src/library/stats/R/cor.test.R R-cor.test/src/library/stats/R/cor.test.R
  --- R-patched/src/library/stats/R/cor.test.R	2008-10-21 10:29:37.000000000 +0200
  +++ R-cor.test/src/library/stats/R/cor.test.R	2009-01-26 16:58:59.123291744 +0100
  @@ -151,9 +151,9 @@
                   pspearman <- function(q, n, lower.tail = TRUE) {
                       if(n <= 1290 && exact) # n*(n^2 - 1) does not overflow
                           .C("prho",
                              as.integer(n),
  -                           as.double(round(q) + lower.tail),
  +                           as.double(round(q) + 2*lower.tail),
                              p = double(1),
                              integer(1),
                              as.logical(lower.tail),
                              PACKAGE = "stats")$p

Petr.

-------------- next part --------------
diff --minimal -U 4 -r R-patched/src/library/stats/R/cor.test.R R-cor.test/src/library/stats/R/cor.test.R
--- R-patched/src/library/stats/R/cor.test.R	2008-10-21 10:29:37.000000000 +0200
+++ R-cor.test/src/library/stats/R/cor.test.R	2009-01-26 16:58:59.123291744 +0100
@@ -151,9 +151,9 @@
                 pspearman <- function(q, n, lower.tail = TRUE) {
                     if(n <= 1290 && exact) # n*(n^2 - 1) does not overflow
                         .C("prho",
                            as.integer(n),
-                           as.double(round(q) + lower.tail),
+                           as.double(round(q) + 2*lower.tail),
                            p = double(1),
                            integer(1),
                            as.logical(lower.tail),
                            PACKAGE = "stats")$p

From simon.urbanek at r-project.org  Mon Jan 26 18:25:24 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 26 Jan 2009 12:25:24 -0500
Subject: [Rd] [R] can't load rJava in R 2.8.1 on Windows XP
In-Reply-To: <497DB715.4030501@stats.uwo.ca>
References: <4979BA58.20909@googlemail.com>	<4979CAB7.1090708@stats.uwo.ca>	<4979D7D4.7000509@googlemail.com>	<4979DACF.2070206@stats.uwo.ca>	<loom.20090123T170231-341@post.gmane.org>	<497A21C5.1040507@stats.uwo.ca>	<loom.20090123T203821-818@post.gmane.org>	<497A5D6E.30309@stats.uwo.ca>	<loom.20090124T205510-904@post.gmane.org>	<497B879D.2000305@stats.uwo.ca>	<loom.20090126T082805-644@post.gmane.org>
	<497DA6D7.6070908@stats.uwo.ca> <497DB715.4030501@stats.uwo.ca>
Message-ID: <888FEDF8-C075-4489-BDF2-8C5CE7EF88FC@r-project.org>

Duncan,

thanks for the analysis, I have updated rJava to check for the  
truncation and issue a warning with the kb link when detected. I have  
also made sure to not use file.path since it's using the wrong  
separator. The updated rJava version (0.6-2) should be available on  
CRAN soon.

Thanks,
Simon


On Jan 26, 2009, at 8:13 , Duncan Murdoch wrote:

> On 1/26/2009 7:04 AM, Duncan Murdoch wrote:
>> Dieter Menne wrote:
>>> Duncan Murdoch <murdoch <at> stats.uwo.ca> writes:
>>>
>>>
>>>> I don't know what's going wrong on your system.  I added a  
>>>> browser() call to the .onLoad function in R/windows/FirstLib.R on  
>>>> my system, and I see it successfully gets JAVA_HOME from the  
>>>> registry.  It gets a number of other files, then adds these paths  
>>>> to my PATH variable.  I've used strsplit() to separate them for  
>>>> viewing.
>>>>
>>>> [14] "C:\\Program Files\\Java\\jre1.6.0_07\\bin\\client"
>>>> [15] "C:\\Program Files\\Java\\jre1.6.0_07/bin"
>>>> [16] "C:\\Program Files\\Java\\jre1.6.0_07/bin/client"
>>>> [17] "C:\\Program Files\\Java\\jre1.6.0_07/jre/bin/client"
>>>>
>>>> I believe LoadLibrary needs paths to be specified with  
>>>> backslashes, so you might be able to fix things on your system by  
>>>> changing the file.path calls in that function to use fsep="\\"  
>>>> instead of the default "/".
>>>>
>>>
>>> Thanks for your help.
>>> I think I tracked it down. It has nothing to do with rJava, but
>>> rather with Sys.getenv(). Looks like this function truncates  
>>> around 1024
>>> characters, and my path is very long due to Visual Studio + Delphi
>>> + SQL Server.
>>>
>>> See the printout below. Note that the last entry should read \ 
>>> \Delphi,
>>> and that more entries are coming in my system path.
>>> This also explains why only some people have the problem.
>>> No workaround found yet. I keep this message here for other people  
>>> who have the problem, but possibly this is more for R-devel to be  
>>> continued.
>>>
>> Yes, I've moved this to R-devel.
>> If this is an R problem, it's in Sys.setenv:  putting a very long  
>> string and then starting a shell shows the truncated string, but  
>> within the shell it's possible to set a much longer one.
>> However, I don't see a fixed buffer size in the internal R code, so  
>> this looks like a problem in the run-time.  The docs on MSDN say  
>> that the system maintains separate user environment variables and  
>> system environment variables, and the system ones are limited to  
>> 1024 characters:  so this could be our problem.  Our _wputenv call  
>> may be trying to set a system environment variable, and having it  
>> truncated.  (There's also an overall limit of 32767 chars for all  
>> environment variables, but I'd guess you're hitting the 1024 byte  
>> limit.)
>> The docs also say there's a SetEnvironmentVariable API function as  
>> of Win2k, which is our minimal platform these days, so maybe  
>> switching to that would solve the problem.  I'll give it a try, but  
>> probably not today.
>
> One more followup:  This article
>
> http://support.microsoft.com/kb/906469
>
> says that this is a problem in Windows XP SP2 and Windows Server  
> 2003, and provides a fix for those systems.
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From muenchen at utk.edu  Tue Jan 27 01:30:19 2009
From: muenchen at utk.edu (Muenchen, Robert A (Bob))
Date: Mon, 26 Jan 2009 19:30:19 -0500
Subject: [Rd] FW: [R] The Quality & Accuracy of R
In-Reply-To: <497D01B9.7040303@biostat.ku.dk>
References: <8C5F8DF18B90FA43BB9B356227F812D545145F@KFSVS6.utk.tennessee.edu>
	<497D01B9.7040303@biostat.ku.dk>
Message-ID: <8C5F8DF18B90FA43BB9B356227F812D5451614@KFSVS6.utk.tennessee.edu>

Peter Dalgaard wrote:

Now that I've asked you in, I probably should at least chip in with a 
couple of brief notes on the issue:

- not everything can be validated, and it's not like the commercial 
companies are validating everything. E.g. nonlinear regression code will 
give different results on different architectures, or even different 
compilers on the same architecture, and may converge on one and not on 
another.

(Muenchen)==> Good point. The test suites that I ran when installing mainframe software were quite simple. Just one of each of various statistical methods, and I doubt any of them iterated back then. You would want to choose carefully the things to test to minimize such problems. The process I ran listed differences between my locally computed version and the one the company ran. If all went well, I would just see the different dates and times scroll by.

- end-user validation is in principle a good thing, but please notice 
that what we currently do is part of a build from sources, and requires 
that build tools are installed. (E.g., we don't just run things, we also 
compare them to known outputs.) It's not entirely trivial to push these 
techniques to the end user.

(Muenchen)==> It sounds like this is quite different from what I expected. The test suites I have seen were just standard code and datasets. They ran in the program I was installing so no extra tools were required. Known outputs did ship with the products for the comparison.

- a good reason to want post-install validation is that validity can 
depend on other part of the system outside developer control (e.g. an 
overzealous BLAS optimization, sacrificing accuracy and/or standards 
compliance for speed, can cause trouble). This is also a reason for not 
making too far-reaching statements about validity.

(Muenchen)==> Yes, and the combination of argument settings is probably close to infinite. We would want to emphasize that although testing is done, it's impossible for ANY organization to test all conditions.

- I'm not too happy about maintaining the same information in multiple 
places. One thing we learned from the FDA document is how easily factual 
errors creep in and how silly we'd look if, say, the location of a key 
server got stated incorrectly, or say that we release one patch version 
when in fact the most recent one had two. This kind of authoritative 
document itself needs a verification process to ensure that it is correct.

(Muenchen)==> Having maintained multiple docs that contained common sections, I can certainly agree it is hard to keep them synchronized. However, if there can only be one document, should it be focused on a small (albeit important) sliver of statistical use? If, as I suspect, the great majority of R users face this question, would it not make sense to address the bigger problem?

Would it be possible to address both audiences in the same document, by putting the information of general interest before the clinical-specific info? Would a more generic title lose the clinical audience?

Thanks,
Bob

> -----Original Message-----
> From: Peter Dalgaard [mailto:p.dalgaard at biostat.ku.dk] 
> Sent: Saturday, January 24, 2009 4:53 AM
> To: Muenchen, Robert A (Bob)
> Cc: R-help at r-project.org
> Subject: Re: [R] The Quality & Accuracy of R
> 
> Bob,
> 
> Your point is well taken, but it also raises a number of issues 
> (post-install testing to name one) for which the R-devel list would be 
> more suitable. Could we move the discussion there?
> 
> 	-Peter
> 
> 
> Muenchen, Robert A (Bob) wrote:
>> Hi All,
>>
>>  
>>
>> We have all had to face skeptical colleagues asking if software made by
>> volunteers could match the quality and accuracy of commercially written
>> software. Thanks to the prompting of a recent R-help thread, I read, "R:
>> Regulatory Compliance and Validation Issues, A Guidance Document for the
>> Use of R in Regulated Clinical Trial Environments
>> (http://www.r-project.org/doc/R-FDA.pdf). This is an important document,
>> of interest to the general R community. The question of R's accuracy is
>> such a frequent one, it would be beneficial to increase the visibility
>> of the non-clinical  information it contains. A document aimed at a
>> general audience, entitled something like, "R: Controlling Quality and
>> Assuring Accuracy" could be compiled from the these sections:
>>
>>  
>>
>> 1.      What is R? (section 4)
>>
>> 2.      The R Foundation for Statistical Computing (section  3)
>>
>> 3.      The Scope of this Guidance Document (section 2)
>>
>> 4.      Software Development Life Cycle (section 6)
>>
>>  
>>
>> Marc Schwartz, Frank Harrell, Anthony Rossini, Ian Francis and others
>> did such a great job that very few words would need to change. The only
>> addition I suggest is to mention how well R did in, Keeling & Parvur's
>> "A comparative study of the reliability to nine statistical software
>> packages, May 1, 2007 Computational Statistics & Data Analysis, Vol.51,
>> pp 3811-3831. 
>>
>>  
>>
>> Given the importance of this issue, I would like to see such a document
>> added to the PDF manuals in R's Help.
>>
>>  
>>
>> The document mentions (Sect. 6.3) that a set of validation tests, data
>> and known results are available. It would be useful to have an option to
>> run that test suite in every R installation, providing clear progress,
>> "Validating accuracy of t-tests...Validating accuracy of linear
>> regression...." Whether or not people chose to run the tests, they would
>> at least know that such tests are available. Back in my mainframe
>> installation days, this step was part of many software installations and
>> it certainly gave the impression that those were the companies that took
>> accuracy seriously. Of course the other companies probably just ran
>> their validation suite before shipping, but seeing it happen had a
>> tremendous impact.  I don't know how much this would add to download,
>> but if it was too much, perhaps it could be implemented as a separate
>> download. 
>>
>>  
>>
>> I hope these suggestions can help mitigate the concerns so many non-R
>> users have.


-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From david at revolution-computing.com  Tue Jan 27 02:01:42 2009
From: david at revolution-computing.com (David M Smith)
Date: Mon, 26 Jan 2009 17:01:42 -0800
Subject: [Rd] FW: [R] The Quality & Accuracy of R
In-Reply-To: <497D01B9.7040303@biostat.ku.dk>
References: <8C5F8DF18B90FA43BB9B356227F812D545145F@KFSVS6.utk.tennessee.edu>
	<497D01B9.7040303@biostat.ku.dk>
Message-ID: <475a3c8f0901261701h165158f0h5f9d29376854daac@mail.gmail.com>

On Sun, Jan 25, 2009 at 4:20 PM, Peter Dalgaard
<p.dalgaard at biostat.ku.dk> wrote:
>>> - a good reason to want post-install validation is that validity can depend on other part of the system outside developer control (e.g. an overzealous BLAS optimization, sacrificing accuracy and/or standards compliance for speed, can cause trouble). This is also a reason for not making too far-reaching statements about validity.

I wanted to echo Peter's point here.  It's the main reason why we
don't claim our distribution of R is validated: *no* software can be
considered validated outside of the environment where it is installed
and used.  (We do however claim Revolution R is ready for a validation
*process*, a small but significant part of which is coming on-site to
run tests and verify the results.) We've come across a number of
environmental issues (locales, random number generators, shared
libraries, path settings, many others) that may affect the validation
process.  My main point here is that R can only be validated in situ,
and the process isn't practical to automate.  With the right build
tools in place, many of the *tests* can be automated, but that leaves
out validation on how the results are stored, used, and accessed in
practice.

> Muenchen, Robert A (Bob) wrote:
>>> Asking to add a superfluous step to an installation may seem like a
> waste of time, and technically it is. But psychologically this testing
> will have a important impact that will silence many critics.

Nonetheless, Bob has an excellent point here -- even short of a
complete validation process, *perception* can prevent the validation
ball from getting stuck in the first place.  Giving the user some
degree of easily-digestible feedback that the installed R has run and
passed a battery of tests could help for that, and is something we'll
look at for the Revolution R distribution.

# David Smith

P.S. For those who subscribe to r-devel but not r-help, some further
discussion of validation for R is here:
http://blog.revolution-computing.com/2009/01/analyzing-clinical-trial-data-with-r.html

--
David M Smith <david at revolution-computing.com>
Director of Community, REvolution Computing www.revolution-computing.com
Tel: +1 (206) 577-4778 x3203 (Seattle, USA)


From jmc at r-project.org  Tue Jan 27 03:01:28 2009
From: jmc at r-project.org (John Chambers)
Date: Mon, 26 Jan 2009 18:01:28 -0800
Subject: [Rd] Inherited Methods in r-devel (for package maintainers mainly)
Message-ID: <497E6AF8.50105@r-project.org>

A recently committed revison of R-devel (47740) has introduced a new 
mechanism for ordering superclasses consistently, with related changes 
for selecting inherited methods.

As part of the process, a function testInheritedMethods has been  
introduced that examines method selection for the relevant subclasses 
and reports ambiguities.

Maintainers of packages that have methods involving multiple arguments 
are encouraged to run testInheritedMethods for the relevant generic 
functions (e.g., the binary operators).  The new method selection is 
unambiguous for single-argument selection.

It's preferable  to find such ambiguities during package development or 
revision, rather than having users encounter ambiguous method selection 
later on.  In that spirit, ambiguous method selection is no longer a 
warning, just a message.

The new mechanism for class ordering and method selection is described 
in a draft paper at http://stat.stanford.edu/~jmc4/classInheritance.pdf 
(later likely to be part of a submission to the R Journal).

John


From jon at restlesslemon.co.uk  Tue Jan 27 13:08:48 2009
From: jon at restlesslemon.co.uk (Jon Senior)
Date: Tue, 27 Jan 2009 13:08:48 +0100
Subject: [Rd] Return values from .Call and garbage collection
Message-ID: <20090127130848.9bf488d9.jon@restlesslemon.co.uk>

Hi all,

I'm posting this here as it discusses an issue with an external C library. If it would be better in R-Help, then I'll repost.

I'm using an external library which I've written, which provides a large set of data (>500MB in a highly condensed format) and the tools to return values from the data. The functionality has been tested call by call and using valgrind and works fine, with no memory leaks. After retrieval, I process the data in R. A specific function is causing a problem that appears to be related to the garbage collector (judging by symptoms).

In the C code, a Matrix is created using

PROTECT(retVal = allocMatrix(INTSXP, x, y));

Values are written into this matrix using

INTEGER(retVal)[translatedOffset]=z;

where "translatedOffset" is a conversion from a row/column pair to an offset as shown in R-exts.pdf.

The last two lines of the function call are:

UNPROTECT(1);
return retVal;

The shared library was compiled with R CMD SHLIB and is called using .Call.

Which returns our completed SEXP object to R where processing continues.

In R, we continue to process the data, replacing -1s with NAs (I couldn't find a way to do that in that would make it back into R), sorting it, and trimming it. All of these operations are carried out on the original data.

If I carry out the processing step by step from the interpreter, everything is fine and the data comes out how I would expect. But when I run the R code to carry out those steps, every now and again (Around 1/5th of the time), the returned data is garbage. I'm expecting to receive a bias per iteration that should be -5 <= bias <= 5, but for the garbaged data, I'm getting results of the order of 100s of thousands out (eg. -220627.7). If I call the routine which carries out the processing for one iteration from the intepreter, sometimes I get the correct data, sometimes (with the same frequency) I get garbage.

There are two possibilities that I can envisage.
1) Race condition: R is starting to execute the R code after the .Call before the .Call has returned, thus the data is corrupted.
2) Garbage collector: the GC is collecting my data between the UNPROTECT(1); call and the assignment to an R variable.

The created matrices can be large (where x > 1000, y > 100000), but the garbage doesn't appear to be related to the size of the matrix.

Any ideas what steps I could take to proceed with this? Or other possibilities than those I've suggested? For reasons of confidentiality I'm unable to release test code, and the large dataset might make testing difficult.

Thanks in advance

-- 
Jon Senior <jon at restlesslemon.co.uk>


From jon at restlesslemon.co.uk  Tue Jan 27 13:11:48 2009
From: jon at restlesslemon.co.uk (Jon Senior)
Date: Tue, 27 Jan 2009 13:11:48 +0100
Subject: [Rd] Return values from .Call and garbage collection [Additional
 information added]
Message-ID: <20090127131148.17b94d80.jon@restlesslemon.co.uk>

Hi all,

I'm posting this here as it discusses an issue with an external C library. If it would be better in R-Help, then I'll repost.

I'm using an external library which I've written, which provides a large set of data (>500MB in a highly condensed format) and the tools to return values from the data. The functionality has been tested call by call and using valgrind and works fine, with no memory leaks. After retrieval, I process the data in R. A specific function is causing a problem that appears to be related to the garbage collector (judging by symptoms).

In the C code, a Matrix is created using

PROTECT(retVal = allocMatrix(INTSXP, x, y));

Values are written into this matrix using

INTEGER(retVal)[translatedOffset]=z;

where "translatedOffset" is a conversion from a row/column pair to an offset as shown in R-exts.pdf.

The last two lines of the function call are:

UNPROTECT(1);
return retVal;

The shared library was compiled with R CMD SHLIB and is called using .Call.

Which returns our completed SEXP object to R where processing continues.

In R, we continue to process the data, replacing -1s with NAs (I couldn't find a way to do that in that would make it back into R), sorting it, and trimming it. All of these operations are carried out on the original data.

If I carry out the processing step by step from the interpreter, everything is fine and the data comes out how I would expect. But when I run the R code to carry out those steps, every now and again (Around 1/5th of the time), the returned data is garbage. I'm expecting to receive a bias per iteration that should be -5 <= bias <= 5, but for the garbaged data, I'm getting results of the order of 100s of thousands out (eg. -220627.7). If I call the routine which carries out the processing for one iteration from the intepreter, sometimes I get the correct data, sometimes (with the same frequency) I get garbage.

There are two possibilities that I can envisage.
1) Race condition: R is starting to execute the R code after the .Call before the .Call has returned, thus the data is corrupted.
2) Garbage collector: the GC is collecting my data between the UNPROTECT(1); call and the assignment to an R variable.

The created matrices can be large (where x > 1000, y > 100000), but the garbage doesn't appear to be related to the size of the matrix.

R version 2.8.1 (2008-12-22), running on Fedora 10 on a Centrino dual-core with 3GB of RAM.

Any ideas what steps I could take to proceed with this? Or other possibilities than those I've suggested? For reasons of confidentiality I'm unable to release test code, and the large dataset might make testing difficult.

Thanks in advance

-- 
Jon Senior <jon at restlesslemon.co.uk>


From murdoch at stats.uwo.ca  Tue Jan 27 13:23:30 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 27 Jan 2009 07:23:30 -0500
Subject: [Rd] Return values from .Call and garbage collection
 [Additional information added]
In-Reply-To: <20090127131148.17b94d80.jon@restlesslemon.co.uk>
References: <20090127131148.17b94d80.jon@restlesslemon.co.uk>
Message-ID: <497EFCC2.80700@stats.uwo.ca>

On 27/01/2009 7:11 AM, Jon Senior wrote:
> Hi all,
> 
> I'm posting this here as it discusses an issue with an external C library. If it would be better in R-Help, then I'll repost.
> 
> I'm using an external library which I've written, which provides a large set of data (>500MB in a highly condensed format) and the tools to return values from the data. The functionality has been tested call by call and using valgrind and works fine, with no memory leaks. After retrieval, I process the data in R. A specific function is causing a problem that appears to be related to the garbage collector (judging by symptoms).
> 
> In the C code, a Matrix is created using
> 
> PROTECT(retVal = allocMatrix(INTSXP, x, y));
> 
> Values are written into this matrix using
> 
> INTEGER(retVal)[translatedOffset]=z;
> 
> where "translatedOffset" is a conversion from a row/column pair to an offset as shown in R-exts.pdf.
> 
> The last two lines of the function call are:
> 
> UNPROTECT(1);
> return retVal;
> 
> The shared library was compiled with R CMD SHLIB and is called using .Call.
> 
> Which returns our completed SEXP object to R where processing continues.
> 
> In R, we continue to process the data, replacing -1s with NAs (I couldn't find a way to do that in that would make it back into R), sorting it, and trimming it. All of these operations are carried out on the original data.
> 
> If I carry out the processing step by step from the interpreter, everything is fine and the data comes out how I would expect. But when I run the R code to carry out those steps, every now and again (Around 1/5th of the time), the returned data is garbage. I'm expecting to receive a bias per iteration that should be -5 <= bias <= 5, but for the garbaged data, I'm getting results of the order of 100s of thousands out (eg. -220627.7). If I call the routine which carries out the processing for one iteration from the intepreter, sometimes I get the correct data, sometimes (with the same frequency) I get garbage.
> 
> There are two possibilities that I can envisage.
> 1) Race condition: R is starting to execute the R code after the .Call before the .Call has returned, thus the data is corrupted.
> 2) Garbage collector: the GC is collecting my data between the UNPROTECT(1); call and the assignment to an R variable.
> 
> The created matrices can be large (where x > 1000, y > 100000), but the garbage doesn't appear to be related to the size of the matrix.
> 
> R version 2.8.1 (2008-12-22), running on Fedora 10 on a Centrino dual-core with 3GB of RAM.
> 
> Any ideas what steps I could take to proceed with this? Or other possibilities than those I've suggested? For reasons of confidentiality I'm unable to release test code, and the large dataset might make testing difficult.

This sounds like a situation where gctorture() would help a lot.  After 
gctorture(TRUE), R will do a garbage collection before every allocation, 
so gc related errors will be much more likely to surface. As long as 
most of the work of your code is happening in C, this won't slow things 
down to be impossibly slow, as it sometimes does when all the work is in R.

It won't tell you where the error is, but making it happen reproducibly 
should help with that.

Duncan Murdoch


From osklyar at maninvestments.com  Tue Jan 27 13:25:12 2009
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Tue, 27 Jan 2009 12:25:12 -0000
Subject: [Rd] Return values from .Call and garbage collection
In-Reply-To: <20090127130848.9bf488d9.jon@restlesslemon.co.uk>
References: <20090127130848.9bf488d9.jon@restlesslemon.co.uk>
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE43047DF5E5@mildnpexmb01.maninvestments.ad.man.com>

- R is not multithreaded (or so it was) and thus race condition cannot
occur
- I would think there is no call to GC at the time of assignment of the
return value to a variable. GC is only called within other R calls as R
as mentioned above is not multithreaded

Most likely issue is your code itself, out of range indexing, failure to
initialise all elements of the allocated structure correctly, 1 and not
0-based indexing, use of other R variables for initialisation that
should have been protected but were not etc. 

Dr Oleg Sklyar
Research Technologist
AHL / Man Investments Ltd
+44 (0)20 7144 3107
osklyar at maninvestments.com 

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Jon Senior
> Sent: 27 January 2009 12:09
> To: r-devel at r-project.org
> Subject: [Rd] Return values from .Call and garbage collection
> 
> Hi all,
> 
> I'm posting this here as it discusses an issue with an 
> external C library. If it would be better in R-Help, then I'll repost.
> 
> I'm using an external library which I've written, which 
> provides a large set of data (>500MB in a highly condensed 
> format) and the tools to return values from the data. The 
> functionality has been tested call by call and using valgrind 
> and works fine, with no memory leaks. After retrieval, I 
> process the data in R. A specific function is causing a 
> problem that appears to be related to the garbage collector 
> (judging by symptoms).
> 
> In the C code, a Matrix is created using
> 
> PROTECT(retVal = allocMatrix(INTSXP, x, y));
> 
> Values are written into this matrix using
> 
> INTEGER(retVal)[translatedOffset]=z;
> 
> where "translatedOffset" is a conversion from a row/column 
> pair to an offset as shown in R-exts.pdf.
> 
> The last two lines of the function call are:
> 
> UNPROTECT(1);
> return retVal;
> 
> The shared library was compiled with R CMD SHLIB and is 
> called using .Call.
> 
> Which returns our completed SEXP object to R where processing 
> continues.
> 
> In R, we continue to process the data, replacing -1s with NAs 
> (I couldn't find a way to do that in that would make it back 
> into R), sorting it, and trimming it. All of these operations 
> are carried out on the original data.
> 
> If I carry out the processing step by step from the 
> interpreter, everything is fine and the data comes out how I 
> would expect. But when I run the R code to carry out those 
> steps, every now and again (Around 1/5th of the time), the 
> returned data is garbage. I'm expecting to receive a bias per 
> iteration that should be -5 <= bias <= 5, but for the 
> garbaged data, I'm getting results of the order of 100s of 
> thousands out (eg. -220627.7). If I call the routine which 
> carries out the processing for one iteration from the 
> intepreter, sometimes I get the correct data, sometimes (with 
> the same frequency) I get garbage.
> 
> There are two possibilities that I can envisage.
> 1) Race condition: R is starting to execute the R code after 
> the .Call before the .Call has returned, thus the data is corrupted.
> 2) Garbage collector: the GC is collecting my data between 
> the UNPROTECT(1); call and the assignment to an R variable.
> 
> The created matrices can be large (where x > 1000, y > 
> 100000), but the garbage doesn't appear to be related to the 
> size of the matrix.
> 
> Any ideas what steps I could take to proceed with this? Or 
> other possibilities than those I've suggested? For reasons of 
> confidentiality I'm unable to release test code, and the 
> large dataset might make testing difficult.
> 
> Thanks in advance
> 
> -- 
> Jon Senior <jon at restlesslemon.co.uk>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

**********************************************************************
Please consider the environment before printing this email or its attachments.
The contents of this email are for the named addressees ...{{dropped:19}}


From bernd_bischl at gmx.net  Tue Jan 27 14:20:10 2009
From: bernd_bischl at gmx.net (bernd_bischl at gmx.net)
Date: Tue, 27 Jan 2009 14:20:10 +0100 (CET)
Subject: [Rd] small bug in base::formatC (PR#13474)
Message-ID: <20090127132010.12703282EFF8@mail.pubhealth.ku.dk>

Full_Name: Bernd Bischl
Version: 2.8.1
OS: Windows XP Professional
Submission from: (NULL) (129.217.207.95)


Hi,

there seems to be a small bug in formatC:

formatC("foo", format="s", mode="charcacter")

Error in formatC("foo", format = "s", mode = "charcacter") : 
  'mode' must be "double" ("real") or "integer"

?formatC
says:

mode:  "double" (or "real"), "integer" or "character". Default: Determined from
the storage mode of x 

I tested this in the 2.8.1 release and the latest development version, both on
XP Professional.

sessionInfo for the second one:

R version 2.9.0 Under development (unstable) (2009-01-22 r47686) 
i386-pc-mingw32 

locale:
LC_COLLATE=German_Germany.1252;LC_CTYPE=German_Germany.1252;LC_MONETARY=German_Germany.1252;LC_NUMERIC=C;LC_TIME=German_Germany.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

Regards,

Bernd Bischl


From jon at restlesslemon.co.uk  Tue Jan 27 18:18:30 2009
From: jon at restlesslemon.co.uk (Jon Senior)
Date: Tue, 27 Jan 2009 18:18:30 +0100
Subject: [Rd] Return values from .Call and garbage collection
In-Reply-To: <1A68FCB28DE72F4BA3B967E6506CCE43047DF5E5@mildnpexmb01.maninvestments.ad.man.com>
References: <20090127130848.9bf488d9.jon@restlesslemon.co.uk>
	<1A68FCB28DE72F4BA3B967E6506CCE43047DF5E5@mildnpexmb01.maninvestments.ad.man.com>
Message-ID: <20090127181830.f244f1c2.jon@restlesslemon.co.uk>

On Tue, 27 Jan 2009 12:25:12 -0000
"Sklyar, Oleg \(London\)" <osklyar at maninvestments.com> wrote:

> Most likely issue is your code itself, out of range indexing, failure to
> initialise all elements of the allocated structure correctly, 1 and not
> 0-based indexing, use of other R variables for initialisation that
> should have been protected but were not etc. 

Apologies one and all. Oleg was right. I was writing into a Matrix but my method for doing so was wrong. Error fixed, and now it's all behaving. Thanks.

-- 
Jon Senior <jon at restlesslemon.co.uk>


From schlather at math.uni-goettingen.de  Tue Jan 27 16:20:07 2009
From: schlather at math.uni-goettingen.de (schlather at math.uni-goettingen.de)
Date: Tue, 27 Jan 2009 16:20:07 +0100 (CET)
Subject: [Rd] uninitialised value in R (PR#13476)
Message-ID: <20090127152007.9980A282EFF8@mail.pubhealth.ku.dk>


Hi,

I get an "Conditional jump or move depends on uninitialised value(s)"
from valgrind when using 'solve' in combination with some simple
C-code. (I did not use other functions of R besides 'solve'.)

In detail: running

R --vanilla -d "valgrind --tool=memcheck --memcheck:leak-check=yes
--num-callers=20 "

and calling

.Call("XXX")
nd <- 3
solve(diag(nd) , as.vector(1:nd))
.Call("XXX")

gives the above valgrind message for the second call of "XXX".
Without "solve" in the middle, there is no message
from valgrind.

Best regards,
Martin


/////////////////////////////// C source file u.cc
#include "u.h"

SEXP XXX() {
  SEXP ans;
  PROTECT (ans = allocVector(INTSXP, 1));
  INTEGER(ans)[0] = 1;
  UNPROTECT(1);
  return ans;
}


/////////////////////////////// header file u.h
#ifndef RFsimu_public_H
#define RFsimu_public_H 1

#include <R.h>
#include <Rinternals.h>
#include <Rmath.h>
#include <Rdefines.h>

extern "C" SEXP XXX();


#endif /* RF_simu_PUBLIC_H*/






--please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status = Under development (unstable)
 major = 2
 minor = 9.0
 year = 2009
 month = 01
 day = 13
 svn rev = 47573
 language = R
 version.string = R version 2.9.0 Under development (unstable)
(2009-01-13 r47573)

Locale:
LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;LC_COLLATE=en_GB.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_GB.UTF-8;LC_PAPER=en_GB.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_GB.UTF-8;LC_IDENTIFICATION=C

Search Path:
 .GlobalEnv, package:stats, package:graphics, package:grDevices,
package:utils, package:datasets, package:methods, Autoloads, package:base

-- 
Prof. Dr. Martin Schlather
Institut f?r Mathematische Stochastik & Zentrum f?r Statistik
Georg-August-Universit?t G?ttingen
Goldschmidtstr. 7, 5.111
D -- 37077 G?ttingen

schlather at math.uni-goettingen.de
http://www.stochastik.math.uni-goettingen.de/~schlather
http://zfs.uni-goettingen.de/
phone: +49 (0)551 39 17 2131       fax : +49 (0)551 39 13 505


From partho_bhowmick at ml.com  Tue Jan 27 16:15:05 2009
From: partho_bhowmick at ml.com (partho_bhowmick at ml.com)
Date: Tue, 27 Jan 2009 16:15:05 +0100 (CET)
Subject: [Rd] Package (PR#13475)
Message-ID: <20090127151505.49050282EFF8@mail.pubhealth.ku.dk>

Full_Name: Partho Bhowmick
Version: 2.8.1
OS: Windows XP
Submission from: (NULL) (199.43.48.131)


While trying to install package sn (I have tried multiple mirrors),
I get the following message

trying URL 'http://www.revolution-computing.com/cran/bin/windows/contrib/2.8/sn_0.4-10.zip'
Content type 'application/zip' length 320643 bytes (313 Kb)
opened URL
downloaded 313 Kb

package 'sn' successfully unpacked and MD5 sums checked
Error in normalizePath(path) : 
  path[1]: The system cannot find the file specified


From simon.urbanek at r-project.org  Tue Jan 27 18:50:58 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 27 Jan 2009 12:50:58 -0500
Subject: [Rd] small bug in base::formatC (PR#13474)
In-Reply-To: <20090127132010.12703282EFF8@mail.pubhealth.ku.dk>
References: <20090127132010.12703282EFF8@mail.pubhealth.ku.dk>
Message-ID: <37248589-7CB9-4B04-8CE2-6E337E624645@r-project.org>


On Jan 27, 2009, at 8:20 , bernd_bischl at gmx.net wrote:

> Full_Name: Bernd Bischl
> Version: 2.8.1
> OS: Windows XP Professional
> Submission from: (NULL) (129.217.207.95)
>
>
> Hi,
>
> there seems to be a small bug in formatC:
>
> formatC("foo", format="s", mode="charcacter")
>
> Error in formatC("foo", format = "s", mode = "charcacter") :
>  'mode' must be "double" ("real") or "integer"
>

I think you meant "character", not "charcacter" ;).
Anyway, thanks, it should be now fixed.

Cheers,
S



> ?formatC
> says:
>
> mode:  "double" (or "real"), "integer" or "character". Default:  
> Determined from
> the storage mode of x
>
> I tested this in the 2.8.1 release and the latest development  
> version, both on
> XP Professional.
>
> sessionInfo for the second one:
>
> R version 2.9.0 Under development (unstable) (2009-01-22 r47686)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=German_Germany.1252;LC_CTYPE=German_Germany. 
> 1252;LC_MONETARY=German_Germany. 
> 1252;LC_NUMERIC=C;LC_TIME=German_Germany.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> Regards,
>
> Bernd Bischl
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From murdoch at stats.uwo.ca  Tue Jan 27 18:59:35 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 27 Jan 2009 12:59:35 -0500
Subject: [Rd] Package (PR#13475)
In-Reply-To: <20090127151505.49050282EFF8@mail.pubhealth.ku.dk>
References: <20090127151505.49050282EFF8@mail.pubhealth.ku.dk>
Message-ID: <497F4B87.3050505@stats.uwo.ca>

On 1/27/2009 10:15 AM, partho_bhowmick at ml.com wrote:
> Full_Name: Partho Bhowmick
> Version: 2.8.1
> OS: Windows XP
> Submission from: (NULL) (199.43.48.131)
> 
> 
> While trying to install package sn (I have tried multiple mirrors),
> I get the following message
> 
> trying URL 'http://www.revolution-computing.com/cran/bin/windows/contrib/2.8/sn_0.4-10.zip'
> Content type 'application/zip' length 320643 bytes (313 Kb)
> opened URL
> downloaded 313 Kb
> 
> package 'sn' successfully unpacked and MD5 sums checked
> Error in normalizePath(path) : 
>   path[1]: The system cannot find the file specified


It works for me.  I suspect it's a permission problem or something 
similar on your system.

Duncan Murdoch


From mathieu.ribatet at epfl.ch  Tue Jan 27 19:04:02 2009
From: mathieu.ribatet at epfl.ch (Mathieu Ribatet)
Date: Tue, 27 Jan 2009 19:04:02 +0100
Subject: [Rd] uninitialised value in R (PR#13476)
In-Reply-To: <20090127152007.9980A282EFF8@mail.pubhealth.ku.dk>
References: <20090127152007.9980A282EFF8@mail.pubhealth.ku.dk>
Message-ID: <497F4C92.1060606@epfl.ch>

Hi Martin,

I wasn't able to compile your files. Replacing "extern "C" SEXP XXX();" 
by "SEXP XXX();" solve the issue and I got no message from valgrind - 
I'm not sure this is what you really want to do though.
I hope this might help.
Cheers,
Mathieu


schlather at math.uni-goettingen.de a ?crit :
> Hi,
>
> I get an "Conditional jump or move depends on uninitialised value(s)"
> from valgrind when using 'solve' in combination with some simple
> C-code. (I did not use other functions of R besides 'solve'.)
>
> In detail: running
>
> R --vanilla -d "valgrind --tool=memcheck --memcheck:leak-check=yes
> --num-callers=20 "
>
> and calling
>
> .Call("XXX")
> nd <- 3
> solve(diag(nd) , as.vector(1:nd))
> .Call("XXX")
>
> gives the above valgrind message for the second call of "XXX".
> Without "solve" in the middle, there is no message
> from valgrind.
>
> Best regards,
> Martin
>
>
> /////////////////////////////// C source file u.cc
> #include "u.h"
>
> SEXP XXX() {
>   SEXP ans;
>   PROTECT (ans = allocVector(INTSXP, 1));
>   INTEGER(ans)[0] = 1;
>   UNPROTECT(1);
>   return ans;
> }
>
>
> /////////////////////////////// header file u.h
> #ifndef RFsimu_public_H
> #define RFsimu_public_H 1
>
> #include <R.h>
> #include <Rinternals.h>
> #include <Rmath.h>
> #include <Rdefines.h>
>
> extern "C" SEXP XXX();
>
>
> #endif /* RF_simu_PUBLIC_H*/
>
>
>
>
>
>
> --please do not edit the information below--
>
> Version:
>  platform = i686-pc-linux-gnu
>  arch = i686
>  os = linux-gnu
>  system = i686, linux-gnu
>  status = Under development (unstable)
>  major = 2
>  minor = 9.0
>  year = 2009
>  month = 01
>  day = 13
>  svn rev = 47573
>  language = R
>  version.string = R version 2.9.0 Under development (unstable)
> (2009-01-13 r47573)
>
> Locale:
> LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;LC_COLLATE=en_GB.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_GB.UTF-8;LC_PAPER=en_GB.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_GB.UTF-8;LC_IDENTIFICATION=C
>
> Search Path:
>  .GlobalEnv, package:stats, package:graphics, package:grDevices,
> package:utils, package:datasets, package:methods, Autoloads, package:base
>
>   

-- 
Institute of Mathematics
Ecole Polytechnique F?d?rale de Lausanne
STAT-IMA-FSB-EPFL, Station 8
CH-1015 Lausanne   Switzerland
http://stat.epfl.ch/
Tel: + 41 (0)21 693 7907


From wdunlap at tibco.com  Tue Jan 27 20:02:07 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Tue, 27 Jan 2009 11:02:07 -0800
Subject: [Rd] Package (PR#13475)
In-Reply-To: <20090127151505.49050282EFF8@mail.pubhealth.ku.dk>
References: <20090127151505.49050282EFF8@mail.pubhealth.ku.dk>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D700912130@NA-PA-VBE03.na.tibco.com>

You can put a trace on normalizePath to get the name of the offending
input file name.  E.g.,

   > trace(normalizePath, Quote(cat("normalizePath: path=", path,
"\n")))
   Tracing function "normalizePath" in package "utils"
   [1] "normalizePath"
   > install.packages("sn")
   trying URL
'http://cran.fhcrc.org/bin/windows/contrib/2.8/sn_0.4-10.zip'
   Content type 'application/zip' length 320643 bytes (313 Kb)
   opened URL
   downloaded 313 Kb

   Tracing normalizePath(lib) on entry 
   normalizePath: path= E:/PROGRA~1/R/R-28~1.1/library 
   package 'sn' successfully unpacked and MD5 sums checked
   Tracing normalizePath(tmpd) on entry 
   normalizePath: path=
C:\DOCUME~1\wdunlap\LOCALS~1\Temp\Rtmp2XNJo1/downloaded_packages 

   The downloaded packages are in
           C:\Documents and Settings\wdunlap\Local
Settings\Temp\Rtmp2XNJo1\downloaded_packages
   updating HTML package descriptions

It looks like your second call to normalizePath caused the problem.
If the error message from normalizePath included the offending file
name it would be easier to track down the problem.  E.g.,
   > normalizePath(c(".", "no such file.txt"))
   Error in normalizePath(path) :
     path[2]="no such file.txt": The system cannot find the file
specified
instead of just
   > normalizePath(c(".", "no such file.txt"))
   Error in normalizePath(path) :
     path[2]: The system cannot find the file specified

The following, barely tested, patch does this on Windows.  I don't
know if
   ...[printf]... "%ls", filenameToWchar(string,FALSE)
is the proper way to display an R string.

Index: extra.c
===================================================================
--- extra.c	(revision 47193)
+++ extra.c	(working copy)
@@ -1107,13 +1107,13 @@
 	    if (!GetFullPathNameW(filenameToWchar(el, FALSE), MAX_PATH,
 			     wtmp, &wtmp2)
 	    	|| !GetLongPathNameW(wtmp, wlongpath, MAX_PATH))
-	    	errorcall(call, "path[%d]: %s", i+1,
formatError(GetLastError()));
+	    	errorcall(call, "path[%d]=\"%ls\": %s", i+1,
filenameToWchar(el,FALSE), formatError(GetLastError()));
 	    wcstoutf8(longpath, wlongpath, wcslen(wlongpath)+1);
 	    SET_STRING_ELT(ans, i, mkCharCE(longpath, CE_UTF8));
 	} else {
 	    if (!GetFullPathName(translateChar(el), MAX_PATH, tmp,
&tmp2)
 	        || !GetLongPathName(tmp, longpath, MAX_PATH))
-	        errorcall(call, "path[%d]: %s", i+1,
formatError(GetLastError()));
+	        errorcall(call, "path[%d]=\"%ls\": %s", i+1,
filenameToWchar(el, FALSE), formatError(GetLastError()));
 	    SET_STRING_ELT(ans, i, mkChar(longpath));
 	}
     }
It might be nice to include the current directory also.
  
Bill Dunlap
TIBCO Software Inc - Spotfire Division
wdunlap tibco.com  

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of 
> partho_bhowmick at ml.com
> Sent: Tuesday, January 27, 2009 7:15 AM
> To: r-devel at stat.math.ethz.ch
> Cc: R-bugs at r-project.org
> Subject: [Rd] Package (PR#13475)
> 
> Full_Name: Partho Bhowmick
> Version: 2.8.1
> OS: Windows XP
> Submission from: (NULL) (199.43.48.131)
> 
> 
> While trying to install package sn (I have tried multiple mirrors),
> I get the following message
> 
> trying URL 
> 'http://www.revolution-computing.com/cran/bin/windows/contrib/
2.8/sn_0.4-10.zip'
> Content type 'application/zip' length 320643 bytes (313 Kb)
> opened URL
> downloaded 313 Kb
> 
> package 'sn' successfully unpacked and MD5 sums checked
> Error in normalizePath(path) : 
>   path[1]: The system cannot find the file specified
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From murdoch at stats.uwo.ca  Tue Jan 27 21:59:13 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 27 Jan 2009 15:59:13 -0500
Subject: [Rd] Package (PR#13475)
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D700912130@NA-PA-VBE03.na.tibco.com>
References: <20090127151505.49050282EFF8@mail.pubhealth.ku.dk>
	<77EB52C6DD32BA4D87471DCD70C8D700912130@NA-PA-VBE03.na.tibco.com>
Message-ID: <497F75A1.4080303@stats.uwo.ca>

On 1/27/2009 2:02 PM, William Dunlap wrote:
> You can put a trace on normalizePath to get the name of the offending
> input file name.  E.g.,
> 
>    > trace(normalizePath, Quote(cat("normalizePath: path=", path,
> "\n")))
>    Tracing function "normalizePath" in package "utils"
>    [1] "normalizePath"
>    > install.packages("sn")
>    trying URL
> 'http://cran.fhcrc.org/bin/windows/contrib/2.8/sn_0.4-10.zip'
>    Content type 'application/zip' length 320643 bytes (313 Kb)
>    opened URL
>    downloaded 313 Kb
> 
>    Tracing normalizePath(lib) on entry 
>    normalizePath: path= E:/PROGRA~1/R/R-28~1.1/library 
>    package 'sn' successfully unpacked and MD5 sums checked
>    Tracing normalizePath(tmpd) on entry 
>    normalizePath: path=
> C:\DOCUME~1\wdunlap\LOCALS~1\Temp\Rtmp2XNJo1/downloaded_packages 
> 
>    The downloaded packages are in
>            C:\Documents and Settings\wdunlap\Local
> Settings\Temp\Rtmp2XNJo1\downloaded_packages
>    updating HTML package descriptions
> 
> It looks like your second call to normalizePath caused the problem.
> If the error message from normalizePath included the offending file
> name it would be easier to track down the problem.  E.g.,
>    > normalizePath(c(".", "no such file.txt"))
>    Error in normalizePath(path) :
>      path[2]="no such file.txt": The system cannot find the file
> specified
> instead of just
>    > normalizePath(c(".", "no such file.txt"))
>    Error in normalizePath(path) :
>      path[2]: The system cannot find the file specified
> 
> The following, barely tested, patch does this on Windows.  I don't
> know if
>    ...[printf]... "%ls", filenameToWchar(string,FALSE)
> is the proper way to display an R string.

I think your patch looks okay; I'll put it in.  Thanks!

Duncan Murdoch

> 
> Index: extra.c
> ===================================================================
> --- extra.c	(revision 47193)
> +++ extra.c	(working copy)
> @@ -1107,13 +1107,13 @@
>  	    if (!GetFullPathNameW(filenameToWchar(el, FALSE), MAX_PATH,
>  			     wtmp, &wtmp2)
>  	    	|| !GetLongPathNameW(wtmp, wlongpath, MAX_PATH))
> -	    	errorcall(call, "path[%d]: %s", i+1,
> formatError(GetLastError()));
> +	    	errorcall(call, "path[%d]=\"%ls\": %s", i+1,
> filenameToWchar(el,FALSE), formatError(GetLastError()));
>  	    wcstoutf8(longpath, wlongpath, wcslen(wlongpath)+1);
>  	    SET_STRING_ELT(ans, i, mkCharCE(longpath, CE_UTF8));
>  	} else {
>  	    if (!GetFullPathName(translateChar(el), MAX_PATH, tmp,
> &tmp2)
>  	        || !GetLongPathName(tmp, longpath, MAX_PATH))
> -	        errorcall(call, "path[%d]: %s", i+1,
> formatError(GetLastError()));
> +	        errorcall(call, "path[%d]=\"%ls\": %s", i+1,
> filenameToWchar(el, FALSE), formatError(GetLastError()));
>  	    SET_STRING_ELT(ans, i, mkChar(longpath));
>  	}
>      }
> It might be nice to include the current directory also.
>   
> Bill Dunlap
> TIBCO Software Inc - Spotfire Division
> wdunlap tibco.com  
> 
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org 
>> [mailto:r-devel-bounces at r-project.org] On Behalf Of 
>> partho_bhowmick at ml.com
>> Sent: Tuesday, January 27, 2009 7:15 AM
>> To: r-devel at stat.math.ethz.ch
>> Cc: R-bugs at r-project.org
>> Subject: [Rd] Package (PR#13475)
>> 
>> Full_Name: Partho Bhowmick
>> Version: 2.8.1
>> OS: Windows XP
>> Submission from: (NULL) (199.43.48.131)
>> 
>> 
>> While trying to install package sn (I have tried multiple mirrors),
>> I get the following message
>> 
>> trying URL 
>> 'http://www.revolution-computing.com/cran/bin/windows/contrib/
> 2.8/sn_0.4-10.zip'
>> Content type 'application/zip' length 320643 bytes (313 Kb)
>> opened URL
>> downloaded 313 Kb
>> 
>> package 'sn' successfully unpacked and MD5 sums checked
>> Error in normalizePath(path) : 
>>   path[1]: The system cannot find the file specified
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jmc at r-project.org  Wed Jan 28 01:00:33 2009
From: jmc at r-project.org (John Chambers)
Date: Tue, 27 Jan 2009 16:00:33 -0800
Subject: [Rd] Inherited Methods in r-devel (for package maintainers
	mainly)
In-Reply-To: <497E6AF8.50105@r-project.org>
References: <497E6AF8.50105@r-project.org>
Message-ID: <497FA021.90502@r-project.org>

These changes have been reverted (temporarily, I strongly hope) to sort 
out some incompatibilities with the Matrix recommended package.  They 
will be available on a branch for experimentation, once I sort out how 
to work with svn branches.

John

John Chambers wrote:
> A recently committed revison of R-devel (47740) has introduced a new 
> mechanism for ordering superclasses consistently, with related changes 
> for selecting inherited methods.
>
> As part of the process, a function testInheritedMethods has been  
> introduced that examines method selection for the relevant subclasses 
> and reports ambiguities.
>
> Maintainers of packages that have methods involving multiple arguments 
> are encouraged to run testInheritedMethods for the relevant generic 
> functions (e.g., the binary operators).  The new method selection is 
> unambiguous for single-argument selection.
>
> It's preferable  to find such ambiguities during package development 
> or revision, rather than having users encounter ambiguous method 
> selection later on.  In that spirit, ambiguous method selection is no 
> longer a warning, just a message.
>
> The new mechanism for class ordering and method selection is described 
> in a draft paper at 
> http://stat.stanford.edu/~jmc4/classInheritance.pdf (later likely to 
> be part of a submission to the R Journal).
>
> John
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From mathieu.ribatet at epfl.ch  Wed Jan 28 11:27:56 2009
From: mathieu.ribatet at epfl.ch (Mathieu Ribatet)
Date: Wed, 28 Jan 2009 11:27:56 +0100
Subject: [Rd] uninitialised value in R (PR#13476)
In-Reply-To: <497F9D80.2050102@math.uni-goettingen.de>
References: <20090127152007.9980A282EFF8@mail.pubhealth.ku.dk>
	<497F4C92.1060606@epfl.ch>
	<497F9D80.2050102@math.uni-goettingen.de>
Message-ID: <4980332C.1070400@epfl.ch>

Hi Martin,

Sorry I was stupid. Indeed, I named the file tom.c instead of tmp.cc. 
Now with the right extension, it works with the 'extern "C"' piece of code.

However, for your (ii) point, this shouldn't be related to the omission 
of 'extern "C"' but to the fact that the shared library is not loaded in R.
I used "dyn.load("tmp.so")" (or "tmp.dll" under Windows) before running 
your example. With this, you should not have the message "Error in 
.Call("XXX") : C symbol name "XXX" not in load table ".

It seems weired that you didn't get the message with the "extern "C"". 
Is the loaded shared library the latest version of your code - i.e. I 
mean that did you recompile and reload the latest version of your c++ code?

I hope this will help,
Cheers,
Mathieu

Martin Schlather a ?crit :
> Hi Mathieu,
>
> Very strange.
> (i) The whole package RandomFields is written with ` extern "C" '
>     and seems working. There is no message from valgrind
>     anywhere, except in two situations that I have boiled
>     down to the code in the bug report.
> (ii) without ` extern "C" ' I get a warning plus an
>     error:
>
>   
>> .Call("XXX")
>>     
> ==18032== Conditional jump or move depends on uninitialised value(s)
> ==18032==    at 0x401620C: (within /lib/ld-2.8.so)
> ==18032==    by 0x42825C3: (within /lib/libc-2.8.so)
> ==18032==    by 0x4282989: _dl_sym (in /lib/libc-2.8.so)
> ==18032==    by 0x417ADE7: (within /lib/libdl-2.8.so)
> ==18032==    by 0x400DE25: (within /lib/ld-2.8.so)
> ==18032==    by 0x417B0DB: (within /lib/libdl-2.8.so)
> ==18032==    by 0x417AD72: dlsym (in /lib/libdl-2.8.so)
> ==18032==    by 0x811012D: R_dlsym (Rdynload.c:787)
> ==18032==    by 0x8110A98: R_FindSymbol (Rdynload.c:836)
> ==18032==    by 0x816E41C: resolveNativeRoutine (dotcode.c:240)
> ==18032==    by 0x817473A: do_dotcall (dotcode.c:825)
> ==18032==    by 0x8194C12: Rf_eval (eval.c:487)
> ==18032==    by 0x805B163: Rf_ReplIteration (main.c:257)
> ==18032==    by 0x805B3E7: R_ReplConsole (main.c:306)
> ==18032==    by 0x805B6D7: run_Rmainloop (main.c:966)
> ==18032==    by 0x8058F80: main (Rmain.c:33)
> Error in .Call("XXX") : C symbol name "XXX" not in load table
>
> Have you named the file u.c or u.cc?
>
> Cheers,
> Martin
>
>
> Mathieu Ribatet wrote:
>   
>> Hi Martin,
>>
>> I wasn't able to compile your files. Replacing "extern "C" SEXP XXX();"
>> by "SEXP XXX();" solve the issue and I got no message from valgrind -
>> I'm not sure this is what you really want to do though.
>> I hope this might help.
>> Cheers,
>> Mathieu
>>
>>
>> schlather at math.uni-goettingen.de a ?crit :
>>     
>>> Hi,
>>>
>>> I get an "Conditional jump or move depends on uninitialised value(s)"
>>> from valgrind when using 'solve' in combination with some simple
>>> C-code. (I did not use other functions of R besides 'solve'.)
>>>
>>> In detail: running
>>>
>>> R --vanilla -d "valgrind --tool=memcheck --memcheck:leak-check=yes
>>> --num-callers=20 "
>>>
>>> and calling
>>>
>>> .Call("XXX")
>>> nd <- 3
>>> solve(diag(nd) , as.vector(1:nd))
>>> .Call("XXX")
>>>
>>> gives the above valgrind message for the second call of "XXX".
>>> Without "solve" in the middle, there is no message
>>> from valgrind.
>>>
>>> Best regards,
>>> Martin
>>>
>>>
>>> /////////////////////////////// C source file u.cc
>>> #include "u.h"
>>>
>>> SEXP XXX() {
>>>   SEXP ans;
>>>   PROTECT (ans = allocVector(INTSXP, 1));
>>>   INTEGER(ans)[0] = 1;
>>>   UNPROTECT(1);
>>>   return ans;
>>> }
>>>
>>>
>>> /////////////////////////////// header file u.h
>>> #ifndef RFsimu_public_H
>>> #define RFsimu_public_H 1
>>>
>>> #include <R.h>
>>> #include <Rinternals.h>
>>> #include <Rmath.h>
>>> #include <Rdefines.h>
>>>
>>> extern "C" SEXP XXX();
>>>
>>>
>>> #endif /* RF_simu_PUBLIC_H*/
>>>
>>>
>>>
>>>
>>>
>>>
>>> --please do not edit the information below--
>>>
>>> Version:
>>>  platform = i686-pc-linux-gnu
>>>  arch = i686
>>>  os = linux-gnu
>>>  system = i686, linux-gnu
>>>  status = Under development (unstable)
>>>  major = 2
>>>  minor = 9.0
>>>  year = 2009
>>>  month = 01
>>>  day = 13
>>>  svn rev = 47573
>>>  language = R
>>>  version.string = R version 2.9.0 Under development (unstable)
>>> (2009-01-13 r47573)
>>>
>>> Locale:
>>> LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;LC_COLLATE=en_GB.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_GB.UTF-8;LC_PAPER=en_GB.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_GB.UTF-8;LC_IDENTIFICATION=C
>>>
>>>
>>> Search Path:
>>>  .GlobalEnv, package:stats, package:graphics, package:grDevices,
>>> package:utils, package:datasets, package:methods, Autoloads, package:base
>>>
>>>   
>>>       
>
>
>   

-- 
Institute of Mathematics
Ecole Polytechnique F?d?rale de Lausanne
STAT-IMA-FSB-EPFL, Station 8
CH-1015 Lausanne   Switzerland
http://stat.epfl.ch/
Tel: + 41 (0)21 693 7907


From kjetilbrinchmannhalvorsen at gmail.com  Wed Jan 28 16:51:45 2009
From: kjetilbrinchmannhalvorsen at gmail.com (Kjetil Halvorsen)
Date: Wed, 28 Jan 2009 12:51:45 -0300
Subject: [Rd] asypow cran package
Message-ID: <556e90a80901280751g52d6b47bwe2d9bfa327494cc3@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090128/11489779/attachment.pl>

From benjamin.leblanc at igh.cnrs.fr  Wed Jan 28 17:46:13 2009
From: benjamin.leblanc at igh.cnrs.fr (Benjamin Leblanc)
Date: Wed, 28 Jan 2009 17:46:13 +0100
Subject: [Rd] File and console output does not work in C code
Message-ID: <49808BD5.2090105@igh.cnrs.fr>

Hello all,
I am getting into trouble when trying to do standard I/O from a C 
function called within R environment.

This function is written in a small C library that is loaded whith 
dyn.load() and called in R via the .C() interface. I need to debug the C 
code using a text file for some logs, and also to speed up its result 
visualization by creating images on the fly using the GD library.
Both of these outputs require to write into files from this C function.
Allthough everything goes smoothly from compilation and linking to 
execution into R without errors, no file is created. I have also tried 
to do some simple printf(), Rprintf() and REprintf() but even that 
didn't gave me any visible output.

Am I missing something trivial? Could anyone give me a hint on why it 
does not work?
Best regards,

Benjamin

-- 
Chromatin and Cell Biology Lab.
Institute for Human Genetics
141, rue de la Cardonille
F-34396 Montpellier
France
Phone  +33-(0)4 99 61 99 51
FAX      +33-(0)4 99 61 99 01


From jeff.horner at vanderbilt.edu  Wed Jan 28 18:03:55 2009
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Wed, 28 Jan 2009 11:03:55 -0600
Subject: [Rd] Recommendations for next maintenance release of RMySQL
Message-ID: <49808FFB.2080804@vanderbilt.edu>

Hi,

Due to the recent release of RMySQL 0.7-2 and incompatibilities with the 
MySQL client libraries, I'm planning the following change:

Load-time check of compiled vs. loaded MySQL client library version.

The client library version is an integer value with the format XYYZZ 
where X is the major version, YY  is the release level, and ZZ is the 
version number within the release level. RMySQL has been checking for 
equivalence in the major version and release level (supposedly, but I 
just found the source code for this and it may not have been working 
correctly), but I want to test for equivalence across the entire integer 
value and call warning() if equivalence fails. Those users who wish to 
suppress this message can then call suppressWarnings(library(RMySQL)).

I wouldn't mind doing this just for the windows version, as I haven't 
had any reports on the UNIX side, but that may be unfair and biased?

Comments?

Jeff
-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner


From ripley at stats.ox.ac.uk  Wed Jan 28 18:43:25 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 28 Jan 2009 17:43:25 +0000 (GMT)
Subject: [Rd] File and console output does not work in C code
In-Reply-To: <49808BD5.2090105@igh.cnrs.fr>
References: <49808BD5.2090105@igh.cnrs.fr>
Message-ID: <alpine.LFD.2.00.0901281738030.600@gannet.stats.ox.ac.uk>

On Wed, 28 Jan 2009, Benjamin Leblanc wrote:

> Hello all,
> I am getting into trouble when trying to do standard I/O from a C function 
> called within R environment.
>
> This function is written in a small C library that is loaded whith dyn.load() 
> and called in R via the .C() interface. I need to debug the C code using a 
> text file for some logs, and also to speed up its result visualization by 
> creating images on the fly using the GD library.
> Both of these outputs require to write into files from this C function.
> Allthough everything goes smoothly from compilation and linking to execution 
> into R without errors, no file is created. I have also tried to do some 
> simple printf(), Rprintf() and REprintf() but even that didn't gave me any 
> visible output.
>
> Am I missing something trivial? Could anyone give me a hint on why it does 
> not work?

It works in many other packages.  What OS are you using?  (There known 
issues with using stdout and stderr from GUIs, but those are 
documented in the R-exts manual.)

> Best regards,
>
> Benjamin
>
> -- 
> Chromatin and Cell Biology Lab.
> Institute for Human Genetics
> 141, rue de la Cardonille
> F-34396 Montpellier
> France
> Phone  +33-(0)4 99 61 99 51
> FAX      +33-(0)4 99 61 99 01
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From schlather at math.uni-goettingen.de  Wed Jan 28 00:49:20 2009
From: schlather at math.uni-goettingen.de (Martin Schlather)
Date: Wed, 28 Jan 2009 00:49:20 +0100
Subject: [Rd] uninitialised value in R (PR#13476)
In-Reply-To: <497F4C92.1060606@epfl.ch>
References: <20090127152007.9980A282EFF8@mail.pubhealth.ku.dk>
	<497F4C92.1060606@epfl.ch>
Message-ID: <497F9D80.2050102@math.uni-goettingen.de>

Hi Mathieu,

Very strange.
(i) The whole package RandomFields is written with ` extern "C" '
    and seems working. There is no message from valgrind
    anywhere, except in two situations that I have boiled
    down to the code in the bug report.
(ii) without ` extern "C" ' I get a warning plus an
    error:

> .Call("XXX")
==18032== Conditional jump or move depends on uninitialised value(s)
==18032==    at 0x401620C: (within /lib/ld-2.8.so)
==18032==    by 0x42825C3: (within /lib/libc-2.8.so)
==18032==    by 0x4282989: _dl_sym (in /lib/libc-2.8.so)
==18032==    by 0x417ADE7: (within /lib/libdl-2.8.so)
==18032==    by 0x400DE25: (within /lib/ld-2.8.so)
==18032==    by 0x417B0DB: (within /lib/libdl-2.8.so)
==18032==    by 0x417AD72: dlsym (in /lib/libdl-2.8.so)
==18032==    by 0x811012D: R_dlsym (Rdynload.c:787)
==18032==    by 0x8110A98: R_FindSymbol (Rdynload.c:836)
==18032==    by 0x816E41C: resolveNativeRoutine (dotcode.c:240)
==18032==    by 0x817473A: do_dotcall (dotcode.c:825)
==18032==    by 0x8194C12: Rf_eval (eval.c:487)
==18032==    by 0x805B163: Rf_ReplIteration (main.c:257)
==18032==    by 0x805B3E7: R_ReplConsole (main.c:306)
==18032==    by 0x805B6D7: run_Rmainloop (main.c:966)
==18032==    by 0x8058F80: main (Rmain.c:33)
Error in .Call("XXX") : C symbol name "XXX" not in load table

Have you named the file u.c or u.cc?

Cheers,
Martin


Mathieu Ribatet wrote:
> Hi Martin,
> 
> I wasn't able to compile your files. Replacing "extern "C" SEXP XXX();"
> by "SEXP XXX();" solve the issue and I got no message from valgrind -
> I'm not sure this is what you really want to do though.
> I hope this might help.
> Cheers,
> Mathieu
> 
> 
> schlather at math.uni-goettingen.de a ?crit :
>> Hi,
>>
>> I get an "Conditional jump or move depends on uninitialised value(s)"
>> from valgrind when using 'solve' in combination with some simple
>> C-code. (I did not use other functions of R besides 'solve'.)
>>
>> In detail: running
>>
>> R --vanilla -d "valgrind --tool=memcheck --memcheck:leak-check=yes
>> --num-callers=20 "
>>
>> and calling
>>
>> .Call("XXX")
>> nd <- 3
>> solve(diag(nd) , as.vector(1:nd))
>> .Call("XXX")
>>
>> gives the above valgrind message for the second call of "XXX".
>> Without "solve" in the middle, there is no message
>> from valgrind.
>>
>> Best regards,
>> Martin
>>
>>
>> /////////////////////////////// C source file u.cc
>> #include "u.h"
>>
>> SEXP XXX() {
>>   SEXP ans;
>>   PROTECT (ans = allocVector(INTSXP, 1));
>>   INTEGER(ans)[0] = 1;
>>   UNPROTECT(1);
>>   return ans;
>> }
>>
>>
>> /////////////////////////////// header file u.h
>> #ifndef RFsimu_public_H
>> #define RFsimu_public_H 1
>>
>> #include <R.h>
>> #include <Rinternals.h>
>> #include <Rmath.h>
>> #include <Rdefines.h>
>>
>> extern "C" SEXP XXX();
>>
>>
>> #endif /* RF_simu_PUBLIC_H*/
>>
>>
>>
>>
>>
>>
>> --please do not edit the information below--
>>
>> Version:
>>  platform = i686-pc-linux-gnu
>>  arch = i686
>>  os = linux-gnu
>>  system = i686, linux-gnu
>>  status = Under development (unstable)
>>  major = 2
>>  minor = 9.0
>>  year = 2009
>>  month = 01
>>  day = 13
>>  svn rev = 47573
>>  language = R
>>  version.string = R version 2.9.0 Under development (unstable)
>> (2009-01-13 r47573)
>>
>> Locale:
>> LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;LC_COLLATE=en_GB.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_GB.UTF-8;LC_PAPER=en_GB.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_GB.UTF-8;LC_IDENTIFICATION=C
>>
>>
>> Search Path:
>>  .GlobalEnv, package:stats, package:graphics, package:grDevices,
>> package:utils, package:datasets, package:methods, Autoloads, package:base
>>
>>   
> 


-- 
Prof. Dr. Martin Schlather
Institut f?r Mathematische Stochastik & Zentrum f?r Statistik
Georg-August-Universit?t G?ttingen
Goldschmidtstr. 7, 5.111
D -- 37077 G?ttingen

schlather at math.uni-goettingen.de
http://www.stochastik.math.uni-goettingen.de/~schlather
http://zfs.uni-goettingen.de/
phone: +49 (0)551 39 17 2131       fax : +49 (0)551 39 13 505


From schlather at math.uni-goettingen.de  Wed Jan 28 11:54:14 2009
From: schlather at math.uni-goettingen.de (Martin Schlather)
Date: Wed, 28 Jan 2009 11:54:14 +0100
Subject: [Rd] uninitialised value in R (PR#13476)
In-Reply-To: <4980332C.1070400@epfl.ch>
References: <20090127152007.9980A282EFF8@mail.pubhealth.ku.dk>
	<497F4C92.1060606@epfl.ch>
	<497F9D80.2050102@math.uni-goettingen.de>
	<4980332C.1070400@epfl.ch>
Message-ID: <49803956.6060309@math.uni-goettingen.de>

Mathieu,

I do not understand what you mean in your email.
I am only interested in the cause of the valgrind
message in

> .Call("XXX")
[1] 1
> nd <- 3
> solve(diag(nd) , as.vector(1:nd))
[1] 1 2 3
> .Call("XXX")
==25734== Conditional jump or move depends on uninitialised value(s)
==25734==    at 0x401620C: (within /lib/ld-2.8.so)
==25734==    by 0x42825C3: (within /lib/libc-2.8.so)
==25734==    by 0x4282989: _dl_sym (in /lib/libc-2.8.so)
==25734==    by 0x417ADE7: (within /lib/libdl-2.8.so)
==25734==    by 0x400DE25: (within /lib/ld-2.8.so)
==25734==    by 0x417B0DB: (within /lib/libdl-2.8.so)
==25734==    by 0x417AD72: dlsym (in /lib/libdl-2.8.so)
==25734==    by 0x811012D: R_dlsym (Rdynload.c:787)
==25734==    by 0x8110A98: R_FindSymbol (Rdynload.c:836)
==25734==    by 0x816E41C: resolveNativeRoutine (dotcode.c:240)
==25734==    by 0x817473A: do_dotcall (dotcode.c:825)
==25734==    by 0x8194C12: Rf_eval (eval.c:487)
==25734==    by 0x805B163: Rf_ReplIteration (main.c:257)
==25734==    by 0x805B3E7: R_ReplConsole (main.c:306)
==25734==    by 0x805B6D7: run_Rmainloop (main.c:966)
==25734==    by 0x8058F80: main (Rmain.c:33)
==25734==
==25734== Conditional jump or move depends on uninitialised value(s)
==25734==    at 0x4016217: (within /lib/ld-2.8.so)
==25734==    by 0x42825C3: (within /lib/libc-2.8.so)
==25734==    by 0x4282989: _dl_sym (in /lib/libc-2.8.so)
==25734==    by 0x417ADE7: (within /lib/libdl-2.8.so)
==25734==    by 0x400DE25: (within /lib/ld-2.8.so)
==25734==    by 0x417B0DB: (within /lib/libdl-2.8.so)
==25734==    by 0x417AD72: dlsym (in /lib/libdl-2.8.so)
==25734==    by 0x811012D: R_dlsym (Rdynload.c:787)
==25734==    by 0x8110A98: R_FindSymbol (Rdynload.c:836)
==25734==    by 0x816E41C: resolveNativeRoutine (dotcode.c:240)
==25734==    by 0x817473A: do_dotcall (dotcode.c:825)
==25734==    by 0x8194C12: Rf_eval (eval.c:487)
==25734==    by 0x805B163: Rf_ReplIteration (main.c:257)
==25734==    by 0x805B3E7: R_ReplConsole (main.c:306)
==25734==    by 0x805B6D7: run_Rmainloop (main.c:966)
==25734==    by 0x8058F80: main (Rmain.c:33)

with the code originally given. Even if it is a problem
of the library ld, there might be interest by R to have
the problem detected.

Martin


From benjamin.leblanc at igh.cnrs.fr  Wed Jan 28 19:44:53 2009
From: benjamin.leblanc at igh.cnrs.fr (Benjamin Leblanc)
Date: Wed, 28 Jan 2009 19:44:53 +0100
Subject: [Rd] File and console output does not work in C code
In-Reply-To: <alpine.LFD.2.00.0901281738030.600@gannet.stats.ox.ac.uk>
References: <49808BD5.2090105@igh.cnrs.fr>
	<alpine.LFD.2.00.0901281738030.600@gannet.stats.ox.ac.uk>
Message-ID: <4980A7A5.50309@igh.cnrs.fr>

Here are more specific details: I use GNU/Linux Ubuntu 8.04 on an x86_64 
workstation. R environnement was compiled from 2.8.0 sources.

Below is a part of my C code to test the file I/O.
When compiled as a standalone executable it prints "Test    1" on the 
console and generates "test.txt" and "test.png" file outputs as 
expected. When compiled as a shared library and invoked from R 
environment via .C() interface, it does nothing (to avoid any file 
access issue, file permissions were set to 777 in the "/test" output 
folder).

Am I missing a configuration option?
Thanks for your help,


----


#include <R.h>
#include <Rmath.h>
#include <stdio.h>
#include <gd.h>

// 
------------------------------------------------------------------------------
void c_bricks(double *x, int *nx, int *nw, double *gamma, double *Piw, 
double *V, double *W)  {

    fflush(stdout);
    printf("Test %10d\n", 1);
    Rprintf("Test %10d\n", 2);
    REprintf("Test %10d\n", 3);

    FILE *txtlog;
    txtlog = fopen("/test/test.txt", "w");
    fprintf(txtlog, "Test %10d\n", 1);
    fclose(txtlog);


    // *** Code imported from the GD2 tutorial, 
http://www.libgd.org/Manual ***
    // Declare the image
    gdImagePtr im;
    // Declare output files
    FILE *pngout;
    // Declare color indexes
    int black;
    int white;
    // Allocate the image: 64 pixels across by 64 pixels tall
    im = gdImageCreate(64, 64);
    /* Allocate the color black (red, green and blue all minimum).
    Since this is the first color in a new image, it will
    be the background color. */
    black = gdImageColorAllocate(im, 0, 0, 0);
    /* Allocate the color white (red, green and blue all maximum). */
    white = gdImageColorAllocate(im, 255, 255, 255);
    /* Draw a line from the upper left to the lower right,
    using white color index. */
    gdImageLine(im, 0, 0, 63, 63, white);
    /* Open a file for writing. "wb" means "write binary", important
    under MSDOS, harmless under Unix. */
    pngout = fopen("/test/test.png", "wb");

    /* Output the image to the disk file in PNG format. */
    gdImagePng(im, pngout);
    /* Close the files. */
    fclose(pngout);
    /* Destroy the image in memory. */
    gdImageDestroy(im);

}



Prof Brian Ripley a ?crit :
> On Wed, 28 Jan 2009, Benjamin Leblanc wrote:
>
>> Hello all,
>> I am getting into trouble when trying to do standard I/O from a C 
>> function called within R environment.
>>
>> This function is written in a small C library that is loaded whith 
>> dyn.load() and called in R via the .C() interface. I need to debug 
>> the C code using a text file for some logs, and also to speed up its 
>> result visualization by creating images on the fly using the GD library.
>> Both of these outputs require to write into files from this C function.
>> Allthough everything goes smoothly from compilation and linking to 
>> execution into R without errors, no file is created. I have also 
>> tried to do some simple printf(), Rprintf() and REprintf() but even 
>> that didn't gave me any visible output.
>>
>> Am I missing something trivial? Could anyone give me a hint on why it 
>> does not work?
>
> It works in many other packages.  What OS are you using?  (There known 
> issues with using stdout and stderr from GUIs, but those are 
> documented in the R-exts manual.)
>
>> Best regards,
>>
>> Benjamin
>>
>> -- 
>> Chromatin and Cell Biology Lab.
>> Institute for Human Genetics
>> 141, rue de la Cardonille
>> F-34396 Montpellier
>> France
>> Phone  +33-(0)4 99 61 99 51
>> FAX      +33-(0)4 99 61 99 01
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From edd at debian.org  Thu Jan 29 05:26:18 2009
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 28 Jan 2009 22:26:18 -0600
Subject: [Rd] Side-effects of require() vs library() on x86_64 aka amd64
Message-ID: <18817.12266.512527.675087@ron.nulle.part>


RDieHarder fails its regression tests on x86_64 (aka "amd64") at CRAN (using
Debian), and I see the same on Ubuntu 8.10 in 64 bit.  No issues on 32bit.

One odd thing is that the program behaves well if run via

    R --no-save < tests/RDieHarder.R

but NOT when started using 

    R --slave < tests/RDieHarder.R

as R CMD check does.

So I tried different things related to startup options, --vanilla, etc pp. No
luck, no change.  And I just poked around with gdb, valgrind, ... without
much luck until I noticed that

   echo 'library(RDieHarder); dh <- dieharder("rand", "runs", seed=12345); \
   	 print(summary(dh))' | R --slave

works whereas the test fails if run as encoded in tests/RDieHarder.R, ie as, 

   echo 'require(RDieHarder, quiet=TRUE); dh <- dieharder("rand", "runs", seed=12345); \
   	 print(summary(dh))' | R --slave

[ What actually happens is that the right result gets computed either way by
DieHarder (as verbose=TRUE shows), but incorrect data gets returned to R for
subsequent tests by R ]

So what side-effects does require() have that library() does not have ?  

How can I make my package robust to this side-effect?

Thanks for any pointers, Dirk

-- 
Three out of two people have difficulties with fractions.


From benjamin.leblanc at igh.cnrs.fr  Thu Jan 29 12:26:03 2009
From: benjamin.leblanc at igh.cnrs.fr (Benjamin Leblanc)
Date: Thu, 29 Jan 2009 12:26:03 +0100
Subject: [Rd] File and console output does not work in C code
In-Reply-To: <3225F02A-9599-4386-90F0-E4F2088C6C57@r-project.org>
References: <49808BD5.2090105@igh.cnrs.fr>
	<alpine.LFD.2.00.0901281738030.600@gannet.stats.ox.ac.uk>
	<4980A7A5.50309@igh.cnrs.fr>
	<3225F02A-9599-4386-90F0-E4F2088C6C57@r-project.org>
Message-ID: <4981924B.7000509@igh.cnrs.fr>

Hi Simon,
Yes, absolutely right, I just did this (...) mistake using copy/paste 
and forgetting to rename the called function.
Thank you for the help and the reference to graphic packages.

Benjamin


Simon Urbanek a ?crit :
> Ben,
>
> just FYI - GDD package uses libgd to create R graphics images so you 
> can have a look at that -- and even better you can use Cairo which has 
> much better rendering than libgd ... You can look at the sources if 
> you want to customize that ...
>
> Cheers,
> S
>
> PS: I don't think your c_bricks code gets called at all - that's 
> probably why you don't see any output.
>
>
> On Jan 28, 2009, at 13:44 , Benjamin Leblanc wrote:
>
>> Here are more specific details: I use GNU/Linux Ubuntu 8.04 on an 
>> x86_64 workstation. R environnement was compiled from 2.8.0 sources.
>>
>> Below is a part of my C code to test the file I/O.
>> When compiled as a standalone executable it prints "Test    1" on the 
>> console and generates "test.txt" and "test.png" file outputs as 
>> expected. When compiled as a shared library and invoked from R 
>> environment via .C() interface, it does nothing (to avoid any file 
>> access issue, file permissions were set to 777 in the "/test" output 
>> folder).
>>
>> Am I missing a configuration option?
>> Thanks for your help,
>>
>>
>> ----
>>
>>
>> #include <R.h>
>> #include <Rmath.h>
>> #include <stdio.h>
>> #include <gd.h>
>>
>> // 
>> ------------------------------------------------------------------------------ 
>>
>> void c_bricks(double *x, int *nx, int *nw, double *gamma, double 
>> *Piw, double *V, double *W)  {
>>
>>   fflush(stdout);
>>   printf("Test %10d\n", 1);
>>   Rprintf("Test %10d\n", 2);
>>   REprintf("Test %10d\n", 3);
>>
>>   FILE *txtlog;
>>   txtlog = fopen("/test/test.txt", "w");
>>   fprintf(txtlog, "Test %10d\n", 1);
>>   fclose(txtlog);
>>
>>
>>   // *** Code imported from the GD2 tutorial, 
>> http://www.libgd.org/Manual ***
>>   // Declare the image
>>   gdImagePtr im;
>>   // Declare output files
>>   FILE *pngout;
>>   // Declare color indexes
>>   int black;
>>   int white;
>>   // Allocate the image: 64 pixels across by 64 pixels tall
>>   im = gdImageCreate(64, 64);
>>   /* Allocate the color black (red, green and blue all minimum).
>>   Since this is the first color in a new image, it will
>>   be the background color. */
>>   black = gdImageColorAllocate(im, 0, 0, 0);
>>   /* Allocate the color white (red, green and blue all maximum). */
>>   white = gdImageColorAllocate(im, 255, 255, 255);
>>   /* Draw a line from the upper left to the lower right,
>>   using white color index. */
>>   gdImageLine(im, 0, 0, 63, 63, white);
>>   /* Open a file for writing. "wb" means "write binary", important
>>   under MSDOS, harmless under Unix. */
>>   pngout = fopen("/test/test.png", "wb");
>>
>>   /* Output the image to the disk file in PNG format. */
>>   gdImagePng(im, pngout);
>>   /* Close the files. */
>>   fclose(pngout);
>>   /* Destroy the image in memory. */
>>   gdImageDestroy(im);
>>
>> }
>>
>>
>>
>> Prof Brian Ripley a ?crit :
>>> On Wed, 28 Jan 2009, Benjamin Leblanc wrote:
>>>
>>>> Hello all,
>>>> I am getting into trouble when trying to do standard I/O from a C 
>>>> function called within R environment.
>>>>
>>>> This function is written in a small C library that is loaded whith 
>>>> dyn.load() and called in R via the .C() interface. I need to debug 
>>>> the C code using a text file for some logs, and also to speed up 
>>>> its result visualization by creating images on the fly using the GD 
>>>> library.
>>>> Both of these outputs require to write into files from this C 
>>>> function.
>>>> Allthough everything goes smoothly from compilation and linking to 
>>>> execution into R without errors, no file is created. I have also 
>>>> tried to do some simple printf(), Rprintf() and REprintf() but even 
>>>> that didn't gave me any visible output.
>>>>
>>>> Am I missing something trivial? Could anyone give me a hint on why 
>>>> it does not work?
>>>
>>> It works in many other packages.  What OS are you using?  (There 
>>> known issues with using stdout and stderr from GUIs, but those are 
>>> documented in the R-exts manual.)
>>>
>>>> Best regards,
>>>>
>>>> Benjamin
>>>>
>>>> -- 
>>>> Chromatin and Cell Biology Lab.
>>>> Institute for Human Genetics
>>>> 141, rue de la Cardonille
>>>> F-34396 Montpellier
>>>> France
>>>> Phone  +33-(0)4 99 61 99 51
>>>> FAX      +33-(0)4 99 61 99 01
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
>


From mcintosh at research.telcordia.com  Thu Jan 29 15:05:12 2009
From: mcintosh at research.telcordia.com (mcintosh at research.telcordia.com)
Date: Thu, 29 Jan 2009 15:05:12 +0100 (CET)
Subject: [Rd] arima error calling optim (PR#13485)
Message-ID: <20090129140512.CDF27282C76F@mail.pubhealth.ku.dk>

Hardware: Reported by kernel as
	Intel P4/Xeon Extended
	Intel(R) Pentium(R) 4 CPU 3.40GHz stepping 01
OS: Fedora core 8
R version:  2.8.1 compiled from source
Compiler versions:
	gcc-4.1.2-33
	libgcc-4.1.2-33
	gcc-c++-4.1.2-33
	gcc-gfortran-4.1.2-33


Problem:  The scripts below produce the following output:

$ R --vanilla --slave --no-save <script1.R
This one works
This one does not work
Error in optim(init[mask], armafn, method = "BFGS", hessian = TRUE, control = optim.control,  : 
  non-finite finite-difference value [1]
Calls: arima -> optim
Execution halted

$ R --vanilla --slave --no-save <script2.R
Run 1
Error in optim(init[mask], armafn, method = "BFGS", hessian = TRUE, control = optim.control,  : 
  non-finite finite-difference value [2]
Calls: arima -> optim
Execution halted

Notes:  This problem was hard to reproduce.  Notice that "yd" is
essentially roundoff error.  (It's the error introduced by writing
the original "yy" out and reading it back again.)  The second script
might reproduce the problem more easily if the RNG sequence is
reproducible.

The original dataset does not have these representation problems.
Unfortunately the owner considers it proprietary.  Releasing it is
not my decision to make.

Script 1:

`yy` <-
c(-0.840690131460208, -1.40450829756329, -1.29394465870196, -2.11230211794639, 
1.05929530179925, -0.607353923575772, -0.226119110129078, -0.89646828730511, 
-0.148278814273618, -0.780939339185766, -1.2420940473049, 1.21677982563681, 
-0.0157304733819275, 0.704134485834278, -0.391817205006062, -0.0639358255628398, 
0.789977753226263, 1.75792566759051, 1.12911592604021, -0.374014108104138, 
0.28373171581024, 0.140689605135059, -0.206279471085428, 0.634951375557152, 
0.89079574635072, 0.277858669176504, 1.23352653683379, -2.39984532875883, 
1.28087822274765, -1.97945896821191, -1.48908655907393, -1.06764291017465, 
1.65863605853845, -1.42218629593826, 2.67828538411911, -0.40335283489166, 
2.12592030384331, 0.126065414197491, 0.869189253780132, -0.640882228874854, 
0.936861134832615, -1.90179928632989, -0.880607896643904, 0.0944004150994985, 
-0.281002865806710, -0.316697984329877, 2.51367158211449, -0.861388680850758, 
0.183184886995942, -0.169819926593865, 0.204200594551216, 0.16697919398577, 
-1.38679477745426, 0.40341840006803, 2.08551981979758, 1.61470124301643, 
0.375407512112474, 0.0936698051629862, 0.281546254172161, 0.615434995237372, 
0.348470668244732, 1.25097597586149, -0.945686921301967, -0.165317653240734, 
-0.123997451324621, -0.754154753895942, -0.615270784222242, -0.416296842603215, 
-0.470616059622267, -1.68650558373106, 0.876489364236355, 0.547879122022283, 
-1.73090496074911, 0.609761350979291, -1.9079853894824, -0.0223540674368216, 
1.32773151889503, 0.893932306074729, 2.15473029517729, -1.19553704587258, 
-0.206149981767285, 1.60787049647948, 1.68187679544939, 0.451519161201612, 
-0.415017536775075, 0.205250754020979, -0.773949462055758, 1.36737836943093, 
-0.600046654553483, 1.23274982585232, -0.998231951375288, 1.73222671045037, 
0.72632410072033, 1.11368999090966, -1.71958399881410, 0.871033219373517, 
-1.32894436828882, -0.0184276239344807, -2.5247269415326, -1.18182304224171, 
-0.531270057966367, -0.58678861250904, -2.12886389811719, -0.0446544623261375, 
0.556005170491617, -0.477716620463226, 0.966136343067003, -0.512178520060399, 
1.07065433516057, 1.40164762979659, 0.364649200903727, -0.126618399018314, 
1.14113177817365, -0.341550601746757, 0.877678602140345, 0.917254027517884, 
-0.135870692221779, 0.529516280165112, -2.11210392038347, -0.797784736432461, 
-1.00079019617069, 2.26087789503914, 0.387714529165891, 1.08019521753992, 
-0.933546009165852, 0.559509039829687, 0.355614957578781, 0.683245533526791, 
-0.969667480854042, -0.476117155269606, -1.95294886044970, 0.905611750336983, 
-0.567360654385884, -1.03613460623193, 1.39078527090273, 0.331901084378441, 
0.910548266367308, 0.877414775622641, 1.61398331754711, 0.117423508765227, 
1.98096463437121, 0.94992006558381, 0.220348450104268, 0.105001087138020, 
-0.910881795550728, -0.995815719974953, 0.739745064132225, -0.0190631429509167, 
-0.560882214097405, 0.801139469184931, 0.692534095508309, 1.02349019355201, 
-1.34095167865017, 0.338063162307905, -0.537973794293519, -0.968131708631762, 
-1.09800448985329, 0.285805680922839, -0.719251595019427, -0.210723820699023, 
0.224010400709853, -0.137001107298269, 1.55062470212058, 0.508250144256034, 
-0.603733200515719, -0.335311446955605, -0.479320299910534, -0.236511200832754, 
0.00371667945861778, -2.34813814944937, 1.05726000685501, 0.179747072784616, 
-1.44327522285608, -1.49730753537626, 0.388773168677485, -0.484369110329069, 
2.68831980397760, 1.17570101816545, 0.759762158660358, 1.17590120320304, 
0.278920469680251, 0.610130973426969, 1.81616178238529, 0.338011582312414, 
-0.886655260127742, 0.340350794349858, 1.30087956807624, 2.20903164521989, 
0.48682161456389, -0.878712037868352, -0.463582447579783, 0.152458297699680, 
1.83213575809738, -0.550878581806268, -0.0408479070613953, -1.14170554083369, 
1.17066859119531, 0.653181425243385, -0.533826744388777, -1.89818667510794, 
0.668142259498847, -2.42656551318903, 0.835119444583113, 1.16590056116944, 
1.29022656333077, -0.372826700032392, -0.464139209164253, 0.539824411039963, 
-1.07301218202746, 0.943937577876397, -0.79217449816665, 0.417300584976612, 
-0.720294511638699, 1.87345416526917, 0.430386575847369, -1.29547836043419, 
-0.401801035368302, 0.178134713024635, 0.55406906793636, 0.288510292251450, 
0.585764522714884, 0.519527215431425, 1.26384993815631, -0.938727525750247, 
-0.820437776550901, 0.839956371467318, 0.104533487457143, -0.964433158991615, 
1.05310607806406, 0.82071667320489, -0.754163658596942, 0.560302394670317, 
-0.71371373018632, 1.39035540934623, -0.803048453937822, -0.0092974636834572, 
-0.835982795356605, 0.102801916770428, 0.854160791189263, -0.832961175997597, 
-0.116342517950512, -0.82059668510259, 1.8872463119571, 0.71317793762561, 
-1.68002570170194, -0.253143921380861, 0.252754823139040, -0.293390766066574, 
-0.747624500804794, -0.326790837734053, 1.34914282332823, 0.279218461652672, 
0.179899545439084, 1.57086161189677, -0.8312329860716, -0.525969538917517, 
0.875014939877276, -0.208265338877627, -0.0293404082639141, 0.0215778139083191, 
0.0917953789219502, 0.874303972802045, -0.591356266736863, -0.823011435123019, 
0.0527399437861307, -1.53478175741282, -1.01194466861257, 0.0861558160585145, 
-1.19422218133594, -0.188655186272839, 0.472537806224619, 0.164738796883351, 
1.37944336206983, -1.15000017389414, -0.994560678884363, -1.14368693832806, 
0.385362199412152, 0.724615586979741, 0.624737093532537, 1.18884554541078, 
-0.846026095164592, -0.283323675129905, 0.762749537687769, -0.94298856675097, 
0.426329846650416, -0.323245222374477, -1.10025045359974, -1.48334750393337, 
1.85788457748588, 0.540501682046102, 0.784480697518638, 0.410150749818478, 
-0.0405093523125161, 0.352994293523165, -0.0618254201393338, 
-0.136784692800631, 2.58068506452577, -0.288727247759506, -1.95608200044925, 
-0.381262645839809, -0.907259213067368, -0.444908086616175, -1.34593726388467, 
-0.704038384361968, 0.507597771647373, 0.246390843843337, 0.774464461126626, 
-0.488388109625396, 0.409916129930861, 0.387498924045661, -0.702260010337356, 
-1.12807647684658, -0.422463721953272, -0.535445646656505, 0.228807926016417, 
1.14208738569036, 0.216891759265026, -0.123408723315514, 0.0290644183233145, 
-3.04856410256294, 0.234974197148210, -1.28133982856159, 0.862669420992227, 
-0.81752540464735, -0.175182735245281, -1.53891824872510, 0.10512013049836, 
-0.399660218891159, 0.0942455410301345, 0.869068572692629, -1.01411653072132, 
0.0411021237291536, 1.5370524996664, -1.23666153187697, 0.354394224453905, 
-0.133328349893599, -0.687113628213178, 0.996994662468553, -0.888444758942794, 
-0.683404183361131, -0.817380771985826, -0.310529798386089, 0.716530643065964, 
1.88522057274785, 0.457893201095741, 0.623562594627724, -0.0601385944733414, 
-0.0173049123447236, 0.195552082327883, -0.150555253107204, -0.0734034778339424, 
1.34142469595703, 0.512479203543154, 2.31751657285253, 1.29623672522906, 
0.440175408758416, 0.353400532805921, -0.730995097042405, 1.16058978249156, 
-0.463746296053063, 0.273138804972324, -1.12231290934862, 0.527970031217308, 
-0.526836435063541, -0.240216233760469, -0.00249533374831955, 
-0.0740827343508213, 0.6580811688138, -0.834658206085837, 0.741546728413868, 
0.757571049273415, -1.08783677219989, 0.789622881239396, -0.665813077814629, 
1.46558616175154, 2.41101539134996, 2.15173911200233, -1.39434121187184, 
0.0125603712078982, 0.080171659553578, -1.38413087287245, 2.8262529166084, 
-0.267191138399221, -1.38156382676140, 0.092779105871715, 0.312729537340097, 
-1.14500010344488, 0.305012249803117, -1.25605521753349, 1.67976181788674, 
-1.02046272261049, 0.606877402826043, 0.475485680917476, 0.123486632611660, 
1.59012521904442, 0.455594297098771, 1.34359279689395, 0.628307755855998, 
-0.53992168020491, 0.999701976746295, 0.0847687761771345, 1.05994454864451, 
-0.71791876080586, -0.0206873114189906, -1.52698743176923, -1.49353285522989, 
-0.877046516343654, 0.133580635722464, -0.865621578671365, -0.344344921653624, 
1.25568975874886, 0.481011935157952, -1.54066779090999, -1.29158707484362, 
0.319966939170940, 0.377372675569837, 1.58958090393379, 2.24565855417845, 
1.05332030843742, 0.0406384651552341, 1.24389458387738, -1.62377917626387, 
0.0769390280487874, -0.290660468837854, 0.0419268509135299, 0.624071445497283, 
-0.196809295275556, -0.323380376586895, 0.651404498817378, -0.250091353393167, 
2.15583778129327, 1.42740310063701, -0.736390367788747, -1.44969112044885, 
-0.0850787846607928, 0.850436770479567, 0.681256739645353, -0.6098515754832, 
-0.31780179897751, -0.759189008754692, -0.399540907687982, 0.864719870498075, 
0.757132662577872, 1.23499855820984, 0.0724588161029354, -0.442855515550773, 
1.82990472786462, -0.587679778002965, -1.07395432610937, -0.325270098566879, 
-0.393282365503027, 0.119308121654312, 1.9152147824773, -0.316771818746397, 
-0.184514828363912, -0.711271802536048, -1.78893150963663, -1.36049160551652, 
0.74123827498459, -1.26205782107618, 1.01333693637840, -0.308631259020657, 
0.529798467539889, -0.0085716256073054, -1.12010284780002, -0.0498974801634198, 
0.6904870915195, 0.840527001524749, -0.911812310249371, 0.504951562061213, 
0.515709687173095, 2.13994455529447, 0.48601285685003, -0.765127818108483, 
-0.485968928428019, 0.296994122576485, 0.577102026593423, 0.784167756905208, 
-0.583275358551699, -0.605543128520339, 1.47420568377245, -0.320643313923355, 
-0.162542941176302, -1.15555144374556, -0.081543302362441, 2.50271190338851, 
0.670415079589065, 0.403714876209011, 0.729898887912757, -0.781795108701126, 
0.987181296079908, -0.523646574621954, -0.77810720585136, -0.252878543243552, 
0.186098161269671, 0.467356532122708, -0.239625192126417, -0.309232148795641, 
0.541616690600766, -0.79893631833108, -2.35257419720644, 1.73131906471714, 
0.340341734641456, 1.16288912611549, 1.10922648681171, -1.24823213881572, 
-2.3850397340323, 1.20074273876558, -0.99813876195885, -0.72897084963075, 
-1.71038494722132, -0.293686869868386, 0.410899872114529, -0.351610946777801, 
0.619542422375192, 0.374075802441872, -0.949622711444287, -0.111775555639892, 
1.11698948667528, -0.522137029980708, 0.908636760087743, 0.544580553594325, 
0.955764432353155, 0.361842373296796, 0.123106208648122, -1.96801839454992, 
-1.29254395175031, 0.171985837088715, -0.82430588803435, -0.532532682641037, 
-1.08754952672727, 0.586898008795016, 1.83641969749088, -0.0362927774825138, 
-1.17413367517086, -1.54962575420221, -1.66963544003937, 0.197286100109507, 
-0.0454432299770064, -1.83770127148819, -1.06730653169094, -0.167259456001220, 
0.970728862998809, -0.975938701987086, -0.542873860094031, 1.77080306206768, 
0.242984349026149, 0.296653101225955, -0.419606765331094, -0.449513181995977, 
-0.0781845999926611, 0.122351225488735, 0.696408912115317, 0.176689078155919, 
-1.98415137441390, 0.337259755678018, -0.602071331442156, 0.94830046810622, 
-0.526165896833768, 0.178825468764539, -1.57868731170312, 1.18600649395637, 
0.126137174425962, -0.0407675595150254, -0.688213394135851, -0.388171659871452, 
-0.286059802392794, -0.772138352820674, -0.413160100335895, -0.698815861964459, 
-0.239271541762128, -0.0624771579286337, 0.080646582415968, 0.199426087769641, 
1.02670452218549, -0.863734230959196, 0.500058757698541, 0.374799427752161, 
-0.497554268969082, 0.581640424464281, 1.14641041156045, -2.19393647874451, 
-1.48349066313815, -0.354074632091546, -2.00916006610373, 0.070658972038777, 
-0.679100218021465, -0.0779122408090768, 0.835287903743488, 0.0147477146502006, 
-0.865944453687329, 0.41274359304976, 0.664310927574973, 0.786438874148949, 
0.440321658151525, -1.84961623893254, -0.416194284695101, -2.31206735111925, 
0.802419440278075, 0.253012108350398, -1.43776112984782, -0.0588845809677416, 
1.504119242128, 2.19790620904031, 0.0532729616260897, -1.13111207013085, 
-0.532272516088628, 0.190792129806963, -0.726796876478938, -1.25658580946750, 
1.32639422405347, -0.612427842003563, -0.131568690881282, 0.293633976163618, 
-0.186924999701944, -1.87781303512962, -1.51687949086308, 0.910942963871329, 
-0.993503284526906, -0.623147962354737, -0.838479889848003, -1.05591531115586, 
0.602387474885685, 0.518716398708719, 1.07998882975504, 1.36194698098474, 
-1.89987042948676, 0.373520085203419, 0.81545961890019, -0.785703493832914, 
0.329032133307888, 0.260339440777304, 0.170370474022086, -0.589693795686468, 
0.476341222455943, 0.310246552793955, -1.10425523032579, -0.530008514338533, 
-0.826072478240797, 1.20154490855315, -1.17594057045996, 1.09009571886058, 
1.33172821651503, -0.00788551316997643, 0.755103026845178, 1.42396702314606, 
-1.10604772057710, 0.287980922449925, 0.315956100218193, 0.931589948630275, 
-0.54196123617554, -1.20137780188424, 1.11961405842455, 0.86979769096417, 
-1.11527846790909, -0.0023359675166655, 0.871315954213252, -1.53564474254927, 
0.0373830043931667, -0.358510969324437, -0.0432701532571276, 
-2.10140977287569, -0.60200241565331, -0.498619017852437, -0.942619499271487, 
-1.32776631009061, -0.73846071069314, -0.439343015060345, 0.648825351168209, 
-0.124645732060933, 0.0258122435017299, 1.49765367813, -0.188435209996373, 
0.845001366268212, 0.154732293349788, 0.29017112891514, -0.2802918402284, 
0.291570069718954, -0.420080908249449, 0.355044821633954, -1.3849794492195, 
0.0856803172579577, 0.729679441384085, 0.263793617689757, 2.11788168067991, 
-0.741177497731792, 1.26127313921720, -0.418386017217932, -0.392297089333424, 
0.083548536285541, -0.387607091273179, 0.882287829434078, -0.576500146655974, 
1.46338083506353, -0.91290807936345, 0.557231801348198, 1.50273174825544, 
0.759179692402217, -0.0671384740801666, -1.04571529277450, 0.252508699544882, 
-1.51130157415422, -1.83222986271953, 1.42517681406780, -0.539213174363868, 
-1.92255757508270, 1.11491890779091, 0.168273610360022, -0.273769788981617, 
2.02775533541283, -2.17897135276270, 0.281998784707382, -1.34786017588460, 
-1.79312564161281, 0.448934011496878, -0.426287179422488, -0.67065476831177, 
-0.228929015464126, -1.16117416069010, 0.297954777910865, 1.31401033421568, 
-2.40601301948693, -0.0948941690005386, -1.05755882923178, -1.55250531714077, 
-1.49278378766935, 0.641152697521116, 0.221057783527087, 0.469694585305377, 
0.637434957928513, -0.00145963816425745, 1.00798527140819, -0.63795043888976, 
0.286375919515529, 1.03002220232446, 1.20861829792270, -1.07711742592328, 
-0.477358366466218, 0.301081833760039, -1.38724098520843, -0.59568192761696, 
0.585059523275552, 0.967216321630569, 0.91836343253826, 1.42415062138505, 
-0.921680247589871, 1.14335144948740, 0.264415379758485, -0.581343503598341, 
0.154945052782282, 0.0639940325261636, 1.36062127088306, -0.249553045881261, 
-0.953502739168704, -1.66696972230238, 0.780302660023585, -0.0493636423865927, 
-0.52785865045857, -1.84452511499568, 1.63117118914048, 1.05783549416673, 
-1.02356436441626, -0.770882820491984, -0.156580093881625, 0.782369596387026, 
-0.373914022201161, -1.32412238362245, -0.526446921077027, 2.07014872208056, 
-0.367801769670053, -0.891491609230717, 0.00144414435614561, 
-1.05467365057067, 1.16567818562371, -0.339184363823701, 0.328928625776418, 
0.254189164698428, 0.924479607993615, 0.535404636531169, -0.207809590971756, 
-0.886132018905938, 0.485710384579265, -0.748827779202784, 0.255126597142758, 
0.313529433677476, 1.86525942488169, 1.30320678979599, -0.0850371396715938, 
0.782289670311778, 0.521625119337767, 0.38386934156565, 0.733796229585409, 
1.03533980535508, -0.469922167792048, -0.173944190119014, -0.455525494530579, 
-0.28915923618514, 1.43663862762549, 1.59907475395653, -1.20218927379180, 
-1.53866557553440, -0.644457204488695, 0.195184722017521, 1.65653103624158, 
1.90208998118085, 0.074580445744758, -0.540943647198965, 0.334044478209159, 
0.594729524641165, -0.864574834728664, -0.748529257482139, 0.12595412217302, 
0.41401789443317, 0.719997199950555, -0.550497500012114, 0.601218061555748, 
-0.551766135467873, -0.50567563818055, -0.285186975235174, 0.0470273255185525, 
0.254818245934305, 0.711416307162773, 1.09179707293091, 0.559044149262571, 
-2.24215419684190, 1.09027920778550, 0.776765388502631, 0.498055732923377, 
0.369505919041193, 0.677435513193204, -0.288348780564807, -0.42620501151372, 
0.817130475848047, 0.266804762703021, 0.748115773668517, -0.374533187975246, 
-0.195154277117867, 1.0378659520491, -1.16483866547479, 0.438708651950298, 
-1.58589892490082, 0.270559950311753, 0.242135763773341, 0.0935968676689364, 
-0.710977677140479, -0.281655674777306, 0.771593883549318, -1.70843025102399, 
1.57005197874806, -0.789866842578523, -0.555901720528284, -1.13787856827059, 
-0.0233117683379627, 1.87595892301264, 1.88277359451124, 0.61340040778882, 
0.339220252823854, 1.04876723688096, 0.111609867781861, 0.292099159403223, 
0.756948882038754, 0.953800678475251, 0.799196626438825, -1.81514143605735, 
-0.843754825084763, -0.0478096317509276, 2.23859985433011, -0.00550601606186956, 
1.25932174336444, 1.11628946861936, 0.288835844973054, 0.533447710591229, 
-1.24524278874342, 0.83430377540835, 0.456037211450233, 1.55730178323194, 
-0.557001640126917, -0.97954083181076, 1.32583651815059, -1.36392613407747, 
-0.0192040258389303, -0.0212923217233888, 1.32460013787885, -1.15994438754701, 
1.75065914267000, 0.152377973987320, -1.14443006673117, -0.762666126508999, 
0.230024257642875, -0.716357887601244, -1.31586562854855, -0.110225885281893, 
-0.976264803533448, -0.211132552275196, 0.608688381631994, 0.183399506477096, 
0.478475807770913, -0.0475803520016981, -0.144652252727743, 0.987495455841422, 
-0.114999874280100, 0.233224512027675, 0.162785484987346, 1.62303332235342, 
0.129783617142889, -0.429674988480246, 0.702733608906752, -0.592077146698622, 
0.302007816128887, 1.16899282998415, -0.168381330115094, 1.15817816571115, 
-0.395250156680108, 2.08010578042951, -0.162195268897019, -0.116158527153716, 
-0.858953492867534, 0.81918264175627, -0.7212400027515, -0.137716296492207, 
-2.06627859410517, 2.19884620747468, -0.0125749380973498, 1.70913434606797, 
-0.144555102293208, 0.0836873997728926, -0.396308164359041, -0.354776217515407, 
-1.81667782326663, 1.17194145280012, 2.13744432391320, 0.830162653754605, 
0.906917104871245, 0.194646587088641, 1.39334934575682, 1.91826011702085, 
-2.33000841272430, 0.359629067629063, 0.212330220427008, 0.320376318597972, 
0.518792393817343, -1.17968946825374, 0.00683006548729135, -4.00180295263648, 
0.0617472942235385, 1.04327047831670, 0.52340094156866, -1.15017149005248, 
0.191016488110876, 0.471292175843189, -1.93931873317958, -0.534009235787725, 
1.12669613947464, -0.591750667753711, 0.513584641373247, 0.86938081739698, 
0.548759257148199, 0.701022520257442, 0.397613584435104, 0.284335071675008, 
1.61521877206445, -0.304317948919622, -0.359377159414251, -0.0099008765423157, 
0.276498614954682, -1.9029651614997, 0.233874038831776, 0.901317089337418, 
-1.05271424532241, -1.00949369586316, -0.485204296192535, 0.958142335570404, 
0.0743022397188244, -1.12199784279282, 2.06200674414127, -1.32780217837901, 
0.139536491626003, 0.63320108530791, 0.622972048546289, -1.30820297287744, 
0.0749452206275407, 0.599885217229211, 1.17080060584762, 0.111580154550882, 
2.22069951819341, 1.30065175041054, -1.56688123383205, -0.100432299413717, 
1.13481368328142, 1.21810817649148, -0.933387325780808, 1.71476211093299, 
-0.0112350769821816, -1.30153124906002, -0.377660272025408, 0.505993244331378, 
0.941154109072143, 0.77102849607808, 0.0725042942587335, 2.09161973121222, 
-0.879654988712056, 0.273578805241776, -0.64790011198878, 1.07696066445675, 
-0.8154940325416, 0.270935110005708, 0.202230558135502, 0.689054578914443, 
0.674694186530012, -0.611537994797594, -1.59545179123207, -0.386889513554821, 
0.340533395059924, 2.04955994037116, -1.87477895070576, -0.094434694796737, 
1.72679016742442, -0.377960838818925, 1.73308388338398, 0.0184290789880763, 
0.0464738350396028, 0.560863402372568, 0.0557106480321128, -1.09076455170366, 
0.159630829985562, 1.60375741039551, -0.998534200482115, 1.44360975875030, 
-1.61274984695467, -0.567497738588217, -0.607292699592978, 0.965003061983236, 
-0.910539657910217, 0.380930269271552, 0.303770493614425, -0.357494206110972, 
1.76004324444484, 0.128424493893218, -0.00025700807462912, -0.806006543852262, 
-0.115803336411743, 0.797953814650296, -0.749148107102, -0.291767398735442, 
-1.90677861872725, -0.709764435203341, -0.856465542941131, -0.0197272494152757, 
0.0937896238625687, 0.275864455027501, -0.0797597989047341, 0.337110826190822, 
-0.227239551225028, 0.641671788110017, 1.78802260609969, -1.73497813763644, 
0.8871973549211, 0.955029132119112, 0.814010287453995, 0.306535186941667, 
1.35755758205079, -0.554185295423016, -0.334284052921307, 0.832983420318215, 
1.29868730637295, -0.235972433921115, 1.30550562769379, -0.205096584484535, 
-0.91317190423267, -1.53083212611471, -0.349136852313809, -0.820803062441346, 
0.889935386752815, 1.92692098578601, 1.81075541865645, -1.31452522218374, 
-1.06453341652919, 0.103310099137647, 0.138125875802759, 0.252854392639004, 
-0.73675610765038, 0.8675742852525, -0.179019393737280, -1.68492683241085, 
0.340304205586119, -0.00702346408356909, 0.109422720070815, 0.753285983069792, 
0.545582107527444, -0.273239462539068, -0.78765378250619, -0.260572790753242, 
-0.148572072275918, 0.350956616541204, 1.34093942762553, -0.308975583902049, 
-0.956320113386861, -1.10803940127736, -0.361637581668790, 0.666566577504044, 
1.41585124467498, 0.314425448174709, 0.471260582672512, -0.0577601056506695, 
-0.374008732859979, 0.257585977534661, -0.274111971019176, -0.511932276892002, 
2.37938605692732, 0.856499550867292, -1.14792998270851, -0.622495266860846, 
0.144444502047619, 1.32478385004802, -2.46384783987959, 0.717714630678988, 
-0.527416482929374, -0.734051368200739, -1.13173039371885, 1.06624818654305, 
1.56454211392810, -0.704508624933302, 1.98699151776478, -0.902328254985785, 
-0.927919346559421, -1.27297381398253, -0.269244918877019, 0.114250452411279, 
-1.09519446115506, 2.06131445319032, -0.454866632168003, 0.947477994318782, 
-1.25687107407457, 2.27614503918259, 0.0539093065674257, -1.83479772509982, 
-1.79304167578918, 0.221489588287694, 0.253082004523478, 0.268249506132774, 
-0.321037197070367, -0.393515853369597, -1.67714688637607, 0.171851063299134, 
-0.551456729749194, 0.485778631083587, 1.61096772733696, -1.27530269253871, 
-0.139817278682627, 0.124071131795680, -1.08632106943242, -1.58498411414791, 
-0.442799753860785, 0.721518170432995, 0.578168289907313, -1.94981795150426, 
-1.98729647309719, -0.539209715884223, 1.84890114793435, -1.48087285261068, 
-0.678245068892832, -0.99501645827757, -2.46155962709222, 3.46595347856157, 
2.59183544170237, -0.292466272695688, -0.686160602406745, 0.439360223090764, 
-0.461660703815587, -1.37511954151239, -0.454470602998719, -0.178806602923778, 
1.67010732822361, 0.869031797324198, -0.451400549242078, -0.627392843716514, 
-0.566317630129823, -0.493081085737239, 1.98234606530761, -0.339992826206061, 
-0.241182304326508, 1.17382671631880, -0.195269431719309, 0.307469128261357, 
2.26288015220138, -1.11951520670943, 0.478415393547573, 0.27748417441846, 
-0.286985839099211, -1.23005538658564, -0.353338001840546, -0.240874594629638, 
-0.914212304205874, -1.02523435423539, -0.336122589652262, 0.244342925542197, 
-0.494734199404275, 0.387436672591457, 0.0698283054990922, 0.84125495220197, 
0.169254573529889, -0.643544128424493, 0.698474106156157, -0.791846085332904, 
1.87923558226674, 1.37473093040503, -0.148936510251604, 0.425290272608244, 
-0.614213568713231, 0.922223211630492, -1.27356850006011, -0.922599196137881, 
0.786970077565374, 0.760739630438798, -0.331005821467472, -1.40388688079103, 
-1.45852593437219, -0.609499355074093, 0.735096615456253, 0.486588777938785, 
-0.912469510355147, 1.28324268665726, -0.6998294790371, 1.09727111248586, 
2.45719932871509, 1.07386598793418, 0.0677105929003263, -1.01349386652146, 
-1.01791161132688, -1.26792084438938, 0.554649140324944, 1.01126407771088, 
0.367317010075944, 1.53999756455162, 0.0200137521816615, 1.27084072465202, 
-0.152487362760140, -1.8320567813574, -0.203253034445207, -0.525909060957721, 
0.191314274892016, 0.0305494386660278, -0.59557297463332, 1.51995134760004, 
-0.620936106572781, -1.38155393052020, -0.929878076151318, 1.27328388345462, 
-1.86200028438669, -0.416056105367609, -0.795719119426427, 0.75165246608368, 
-0.241866099089196, -0.202382434427799, -0.629150610974796, 0.338185322067204, 
-0.986993779764113, -0.222492834290176, 0.529255529871565, -0.785998573860205, 
-3.37663010118087, -1.27714396964237, -0.0354992144976386, 0.937924571595946, 
0.691939566497171, -1.52396380415815, 0.536570243264708, 0.77709058485582, 
1.47957538685911, -0.176466381434999, 0.646642885557047, 1.04544837868221, 
-0.767818649443102, -2.07216626293734, 0.5344358225697, 0.990603971002157, 
-0.397006641327857, 0.879966699980307, 0.0634490863139123, -0.786979938299212, 
-0.145185511887209, -0.101159605005847, -2.70337117121590, -0.126645530302524, 
-1.56566583389718, 1.18448275331803, -1.06352460199838, 1.17312996409564, 
0.406978431272582, 0.199141507692813, -1.00728467088114, 0.395986189733847, 
0.74789444626741, -0.434966070907105, 0.565970915090677, -1.28574630060247, 
-0.967912614106643, 1.64463873564668, -0.226808475656731, -1.97229125383650, 
0.594579633894323, -0.444685468795058, -0.40583694842499, -0.631286818537584, 
0.925837711141467, 1.14049120655915, -1.69728492132810, -1.17352319551877, 
1.19214577109402, 0.907857433390574, -0.0923434268790137, -0.0939094211733372, 
-0.877351189076048, -0.311603753625177, -0.201659002114484, -1.20537724311770, 
-0.51387517141378, 0.859694724733604, -0.94900985614759, 0.905386124599929, 
-1.65098752817120, 0.432433943801305, 0.53027679072159, 0.191351905974135, 
-1.04124036324357, -0.838533514743392, -0.745046299889776, -0.661163780477474, 
-0.0203931481200985, 0.373450466431704, -0.866159493919523, 1.66602465735676, 
0.380271925451495, 0.0715817074896384, 0.991405778679616, -1.19967684705411, 
1.04114777311158, 0.490645264855755, 0.251660188757364, 0.180061927095617, 
1.68505853774456, -2.17089549756162, -1.12523274211776, 0.287866791713552, 
0.152925165392944, -0.0607804359778418, 0.316917220898807, 2.70546720097948, 
-0.269077781028010, -1.04187954547388, 0.187324604552201, 1.48637237955222, 
0.941758907055155, -0.659620153881713, -0.753188073650972, -1.02063045255115, 
-1.19833068268788, 1.33139934783629, 0.500719237179719, 1.20793292221464, 
-0.743431241344503, -1.34894687783647, 0.24221563903034, -1.63840125788094, 
-0.0648759402719248, 0.250763623454822, -2.07770283528580, 0.55558940964471, 
0.787346512682287, -0.572346546756351, 0.290008666014316, -2.19178557499735, 
-0.146176854488478, 1.07510725572799, 0.590609707986298, 0.0371939120154225, 
0.220364159619254, 0.106152545548600, 1.16986451976222, -1.27375240216042, 
-1.44836335936477, 0.559881814836823, 1.11064967858903, -1.859128970646, 
0.351987138362894, -0.561446837034046, -1.35230956493596, 1.06250193553179, 
1.91502463454126, 0.165461429993175, -0.127462928840205, -0.0209345390029897, 
0.325629382061574, 1.73351486640591, 0.755733133050867, 1.35831323600449, 
0.0587643754032217, -0.148738860349029, 0.997263727463973, -3.77339048152272, 
1.05324375522749, 0.314865184468631, 0.0540189435958218, -0.496016792448048, 
2.15724513226905, 0.165722929215546, -1.17724313232565, -0.674758923045003, 
0.214524349050295, -1.43543578511018, -0.345306867707621, 0.71092073670458, 
0.685688252480944, -0.063600506039241, -0.571495208873182, 0.78222720096802, 
0.052524650048863, 1.19030866009983, -0.98448326859282, 0.63112034350804, 
0.748413514808667, -0.964071702503998, -1.15077285730652, 0.400427511326532, 
0.164642584281575, 0.317550897648767, 0.855700198130759, 1.51508077163272, 
-0.954751242336187, 0.272102091256056, -1.8552117408988, 0.556828246785497, 
0.952557726158423, 1.03879624149239, -0.813738494437363, 0.612951467900235, 
1.06349429850339, 0.734744174005956, 0.253504152141048, 0.960380730428086, 
0.812052734275339, 0.170728649194322, 0.533687369371001, -1.47444340150188, 
-0.171307617757362, 1.83321602245542, -0.836582427045963, -0.929442859932066, 
-0.124944523617659, -1.5518619253069, -0.282421212031404, -0.491893072297921, 
-0.526313141569109, 0.54907222902868, -0.409370530748638, -0.00399874686399745, 
0.33770078197569, 1.27015999727871, 1.20980036308455, 0.0822246859008502, 
-0.311850506993473, 0.60452053353476, -0.227415689917231, -0.769440788122828, 
0.297146821931209, 0.319959950334811, 1.24116579548001, 0.147981652712037, 
-1.34157543000816, -0.63418315234088, 0.938058337412642, -0.847960433458717, 
0.0247790668119801, -1.87687471347133, 0.156757415838239, 1.00712116596194, 
-0.585311508690574, -0.222719573586936, 1.10741196138843, -0.267598273550227, 
-2.21712295716631, 0.361246026649366, -1.08703994002552, -0.832819146917914, 
1.58746675253009, -0.589534928171672, -0.0493960195216494, 0.0958154659489737, 
-2.17987278858107, -0.504241430075086, 0.550765491479302, -1.24747981435821, 
0.976112381319866, -1.60683216207126, 0.86050105442158, 1.18232579890110, 
1.74813954506503, 0.0705897043073214, 0.633075321471799, 0.476505472700023, 
-0.790787602736828, 1.07920970243537, 0.600343437806091, -0.126800632302646, 
1.54017064925738, 1.04442761157514, -1.09623383373589, -0.210711617417684, 
-1.0789784370861, -0.0329392327908080, 0.160926621784923, 0.215473217454434, 
-0.0879581171454887, -0.456522591466711, -1.39652233074848, -0.268841970151683, 
-0.12149636222544, -0.620736657662057, -0.340198954153922, -0.900475021881756, 
-1.46868826832618, -0.140476979925221, -0.0543877697897587, -1.48228617204286, 
-0.598962861302337, -0.998232968046467, 0.389431123453394, 0.63055475658949, 
0.382987784310497, 0.234070654414623, 1.35039560393014, 1.28460972087507, 
1.83259887488678, 1.17101674417173, 0.820513881890826, 1.46224980200873, 
-0.890700083508661, -0.875748916953829, 1.47042579375323, -3.10710119339184, 
0.20948136430522, 0.102464546894975, -0.793172728519324, -0.0118960930227127, 
-0.514189814233752, -0.317808875982276, -0.00778559055782594, 
-0.973291895840192, -1.54947451338867, -1.64128771910012, -0.059283237967415, 
-0.533033413858532, -0.808494284014745, 1.64594663552348, -0.572280538578606, 
-0.331518857906369, 0.0957038321309497, -1.35960704190436, 0.409371015680975, 
-0.151060478762868, -0.0337911506616560, -0.840757519070557, 
0.933827767096857, -0.129729378524382, 0.723043048482418, 0.451793298551381, 
1.13067790579345, 1.58642964534618, 0.00544368850975346, -1.92935899312504, 
-0.880590872914531, 0.781860684515152, 1.05738755351597, 0.0900271015819423, 
0.80538575031258, 1.50780193896387, -0.295324551547371, 0.213173141168358, 
-0.264058307470331, -0.0099667084490777, 1.08083037685368, -1.49804216201271, 
-0.500855228020053, 1.66835394114003, -0.57044077333303, -0.0284379655337312, 
-0.110477436023389, -0.273305986229143, 0.79493131266236, 0.821154114415601, 
0.904240505342357, 1.67247930590942, -2.57943391215294, 0.483698233718444, 
0.713958707913093, -0.356763266612781, -0.0328247001756959, -0.184318892955012, 
0.780901008501296, -0.470210155408324, 0.454365305661986, 0.598242463171053, 
0.272429586516191, -0.553989809316755, -0.558565507941217, -0.248622590810624, 
-1.82451712520608, 0.938550909564601, -0.102232823845932, 0.055994179530898, 
0.23160891442359, -0.944018311689892, 0.148797707026736, 0.532903053052318, 
-0.534609720482928, -0.214726523705616, 0.407659052148484, -0.562797458210746, 
1.12234956277403, -0.212984679404496, 1.07359976313580, 0.608476189980204, 
0.176222561840894, -0.497580303113466, -0.666020731636294, -0.80236812205792, 
-0.766125940763443, 0.346691592466946, 0.564487942819478, 0.390323919598311, 
-0.655144615751083, 0.615492764006428, 1.04652845647775, -1.98021022173873, 
0.440877431698176, -0.0666766833684802, -0.579731126245429, -1.66237524923504, 
0.109703194480705, 0.247624858518091, -0.000685110004977798, 
-0.780053936436778, -0.413985813088028, -0.327377148099347, -1.40398485493702, 
0.0996682986363143, 0.0204501472882174, 0.281251757922977, -1.04502379543106, 
0.643468228328536, 0.360635522214246, -0.67419650330072, 0.337986850768114, 
0.227711218577489, 1.73790994824529, -0.557706409830536, 0.678759178642586, 
-0.602963173958065, 1.41413920832205, 0.377275540936933, -0.169832230037524, 
-1.26902097517109, 1.19570329625357, -0.110864657353297, 0.76872819543754, 
-1.04304831343078, -0.50814066956173, -1.62997702182406, -1.92643252674732, 
-0.58604176480621, 1.0679810144807, 1.29959712876624, 0.406040820429355, 
-0.119985443489058, -0.601099239099528, -1.94752368195012, 0.673887485897653, 
-0.338528727891041, -0.658984294536393, -0.278612788450376, 0.108398918834890, 
0.766229910329707, -0.0343163858318422, -1.41243476453177, -0.495520216286397, 
0.279410219334013, 0.938858724048605, 1.83660010352115, -0.877826173987853, 
1.04309743729555, -0.52179374447242, 0.897924390074989, 1.90308914966918, 
0.61384950048545, 0.297585159195147, 0.475841822346016, 0.233976521897962, 
-0.103969745763402, 0.31014845207687, -0.805629177873887, -0.553959423379381, 
0.696126683615406, 0.377848476496444, 0.610916518705502, -0.818741573055781, 
0.62234203653773, -0.263695621311298, 1.87078097118808, -1.47501548710429, 
0.912111959091349, -0.589860986233675, 0.131991357219007, 0.446016954621267, 
0.265355773293284, -1.08516695519246, -1.60138590451669, -1.87479052426232, 
0.204933059703694, -0.627331670994047, -1.16698632885822, -0.574257322910893, 
0.746656805054838, 0.0448403396300787, -1.17986144928716, 0.315190549061558, 
0.323414791615978, 2.36358465797507, 0.756386455274183, 0.163701613647397, 
0.462743299793155, 3.21850215056582, 0.302559272123594, 0.903897902838266, 
-1.18199665197783, -0.727734976730098, -0.79908871415953, -0.224448798997371, 
0.65535562669085, 0.672358678082745, -1.84122561982858, 0.630553428538852, 
0.777639859190241, -0.994013102373233, 0.191645395564772, 0.304018243044113, 
0.462258202137283, 0.0697355012394914, -0.426562602587411, 0.803423118635298, 
1.48828179683615, -0.993617344561106, 1.12757133629112, 0.167024350626329, 
0.308295512122625, 0.0783935558968625, -0.0550079698815761, -1.01836932548489, 
-2.92155362615959, -1.01475454364858, 0.0442035829872547, -0.57163020085229, 
-0.843966833293626, -0.464463546985404, -0.551551970335692, 0.481379771931919, 
0.171166805317111, 0.289886514185055, 1.92060779038578, -0.518657398953335, 
0.249098776270677, -0.331039793965936, -2.38888222376660, -0.233710480590510, 
0.950361541116174, -0.124130217009424, 1.40889573126782, 1.67283603982813, 
-0.834853997262613, 1.67720833665451, 0.503569337142027, 0.411231015739972, 
-1.41645156311433, -0.586343938691072, -0.295185516828303, 1.65010605311991, 
-0.730420430841232, -2.43022998013547, -2.76405191786103, -0.111859179658703, 
-0.284190489583653, -2.36755802289574, -0.236022622526782, -0.361904893157186, 
0.0347180911055713, -1.84200374261526, -0.46368411523174, -0.682487094549016, 
0.982168215873038, -1.4866268487041, 0.186682330064654, 1.06297747645585, 
0.095008807480045, -0.257924661661987, -1.92245935940161, -0.66795230666392, 
-1.94199480015726, 0.766359995128608, -0.936485361831094)
`yd` <-
c(-4.44089209850063e-16, -3.77475828372553e-15, -4.44089209850063e-15, 
1.33226762955019e-15, 1.55431223447522e-15, -3.33066907387547e-16, 
-4.16333634234434e-16, -4.44089209850063e-16, 0, 3.33066907387547e-16, 
6.66133814775094e-16, -3.10862446895044e-15, 1.73472347597681e-17, 
-4.44089209850063e-16, -1.11022302462516e-16, 4.16333634234434e-17, 
-4.44089209850063e-16, 4.66293670342566e-15, -2.44249065417534e-15, 
1.11022302462516e-16, 1.11022302462516e-16, -5.55111512312578e-17, 
1.11022302462516e-16, -3.33066907387547e-16, -4.44089209850063e-16, 
-3.88578058618805e-16, 4.66293670342566e-15, -1.33226762955019e-15, 
4.88498130835069e-15, 3.10862446895044e-15, 2.22044604925031e-15, 
2.44249065417534e-15, -4.44089209850063e-16, 3.33066907387547e-15, 
2.22044604925031e-15, -2.77555756156289e-16, -2.22044604925031e-15, 
2.22044604925031e-16, 4.44089209850063e-16, 1.11022302462516e-16, 
2.22044604925031e-16, -6.66133814775094e-16, 3.33066907387547e-16, 
4.16333634234434e-17, -2.77555756156289e-16, 3.33066907387547e-16, 
1.77635683940025e-15, 4.44089209850063e-16, 3.33066907387547e-16, 
-4.16333634234434e-16, 2.22044604925031e-16, 0, 3.77475828372553e-15, 
1.11022302462516e-16, 3.5527136788005e-15, 2.22044604925031e-16, 
-3.33066907387547e-16, 1.38777878078145e-17, -1.11022302462516e-16, 
-2.22044604925031e-16, 0, -4.44089209850063e-15, -3.33066907387547e-16, 
-1.38777878078145e-16, -1.2490009027033e-16, 4.44089209850063e-16, 
1.11022302462516e-16, -4.9960036108132e-16, 4.44089209850063e-16, 
-1.55431223447522e-15, -1.11022302462516e-16, -2.22044604925031e-16, 
1.99840144432528e-15, -1.11022302462516e-16, 4.44089209850063e-16, 
-3.46944695195361e-18, 3.5527136788005e-15, 0, -3.5527136788005e-15, 
3.99680288865056e-15, -2.22044604925031e-16, -6.66133814775094e-16, 
-4.88498130835069e-15, 3.33066907387547e-16, 0, 3.88578058618805e-16, 
-4.44089209850063e-16, 1.77635683940025e-15, 1.11022302462516e-16, 
-2.88657986402541e-15, 1.11022302462516e-16, 1.11022302462516e-15, 
-6.66133814775094e-16, 3.99680288865056e-15, -2.66453525910038e-15, 
-4.44089209850063e-16, 2.88657986402541e-15, -1.04083408558608e-17, 
0, 1.77635683940025e-15, -3.33066907387547e-16, 4.44089209850063e-16, 
2.22044604925031e-15, 0, 3.33066907387547e-16, 0, -3.33066907387547e-16, 
4.44089209850063e-16, 3.99680288865056e-15, -3.33066907387547e-15, 
-1.66533453693773e-16, -4.16333634234434e-16, 0, 2.77555756156289e-16, 
3.33066907387547e-16, 3.33066907387547e-16, 1.94289029309402e-16, 
3.33066907387547e-16, -3.5527136788005e-15, 1.11022302462516e-16, 
3.10862446895044e-15, -1.33226762955019e-15, 1.11022302462516e-16, 
-3.99680288865056e-15, 0, 2.22044604925031e-16, -1.66533453693773e-16, 
-2.22044604925031e-16, -4.44089209850063e-16, 1.66533453693773e-16, 
2.44249065417534e-15, -1.11022302462516e-16, 4.44089209850063e-16, 
4.44089209850063e-16, -1.33226762955019e-15, -1.11022302462516e-16, 
-4.44089209850063e-16, -1.11022302462516e-16, -2.88657986402541e-15, 
-4.71844785465692e-16, 1.99840144432528e-15, 2.22044604925031e-16, 
2.22044604925031e-16, 1.52655665885959e-16, -3.33066907387547e-16, 
-2.22044604925031e-16, -3.33066907387547e-16, -2.77555756156289e-17, 
-1.11022302462516e-16, 1.11022302462516e-16, 0, -4.21884749357559e-15, 
-4.21884749357559e-15, 2.77555756156289e-16, -2.22044604925031e-16, 
-2.22044604925031e-16, 1.33226762955019e-15, -4.44089209850063e-16, 
1.11022302462516e-16, 1.66533453693773e-16, -2.77555756156289e-16, 
1.11022302462516e-16, 2.22044604925031e-16, 3.33066907387547e-16, 
1.11022302462516e-16, -4.9960036108132e-16, 5.55111512312578e-17, 
3.88578058618805e-16, -2.16840434497101e-18, 3.99680288865056e-15, 
-2.22044604925031e-16, -3.05311331771918e-16, -2.22044604925031e-16, 
4.88498130835069e-15, -1.11022302462516e-16, 3.88578058618805e-16, 
3.5527136788005e-15, -4.44089209850063e-15, 0, 2.88657986402541e-15, 
5.55111512312578e-17, -4.44089209850063e-16, -2.66453525910038e-15, 
5.55111512312578e-17, -1.11022302462516e-16, 4.44089209850063e-16, 
-3.33066907387547e-15, 8.88178419700125e-16, -1.11022302462516e-16, 
3.33066907387547e-16, -4.44089209850063e-16, 1.94289029309402e-16, 
8.88178419700125e-16, -3.33066907387547e-16, 2.77555756156289e-17, 
-2.44249065417534e-15, 2.22044604925031e-16, 1.11022302462516e-16, 
-3.33066907387547e-16, -8.88178419700125e-16, 1.11022302462516e-16, 
3.10862446895044e-15, 1.11022302462516e-16, 3.5527136788005e-15, 
3.77475828372553e-15, 1.11022302462516e-16, -5.55111512312578e-17, 
-1.11022302462516e-16, 2.88657986402541e-15, -3.33066907387547e-16, 
-5.55111512312578e-16, -2.77555756156289e-16, 2.22044604925031e-16, 
3.99680288865056e-15, -3.33066907387547e-16, -4.66293670342566e-15, 
1.66533453693773e-16, 1.94289029309402e-16, 1.11022302462516e-16, 
4.44089209850063e-16, 0, 3.33066907387547e-16, 4.88498130835069e-15, 
1.11022302462516e-16, 1.11022302462516e-16, -3.33066907387547e-16, 
1.94289029309402e-16, 4.44089209850063e-16, 4.66293670342566e-15, 
4.44089209850063e-16, 1.11022302462516e-16, -2.22044604925031e-16, 
1.11022302462516e-16, -6.66133814775094e-16, -2.22044604925031e-16, 
8.67361737988404e-18, -4.44089209850063e-16, -8.32667268468867e-17, 
3.33066907387547e-16, 3.33066907387547e-16, -3.33066907387547e-16, 
0, 1.77635683940025e-15, -1.11022302462516e-16, -2.66453525910038e-15, 
3.33066907387547e-16, -2.77555756156289e-16, 2.77555756156289e-16, 
0, 2.22044604925031e-16, -2.44249065417534e-15, 5.55111512312578e-17, 
-1.66533453693773e-16, 3.99680288865056e-15, -1.11022302462516e-16, 
0, -1.11022302462516e-16, 4.71844785465692e-16, 3.81639164714898e-17, 
-3.46944695195361e-17, -4.16333634234434e-17, 3.33066907387547e-16, 
0, 1.11022302462516e-16, 2.08166817117217e-17, -3.10862446895044e-15, 
-3.77475828372553e-15, -1.38777878078145e-17, 2.88657986402541e-15, 
0, 2.22044604925031e-16, -4.71844785465692e-16, 4.66293670342566e-15, 
-4.44089209850063e-16, -1.11022302462516e-16, -3.5527136788005e-15, 
-1.11022302462516e-16, -2.22044604925031e-16, 4.44089209850063e-16, 
3.77475828372553e-15, 1.11022302462516e-16, 3.33066907387547e-16, 
-4.44089209850063e-16, -7.7715611723761e-16, 1.66533453693773e-16, 
-1.11022302462516e-16, 1.33226762955019e-15, 1.55431223447522e-15, 
-4.21884749357559e-15, -1.11022302462516e-16, 2.22044604925031e-16, 
-3.88578058618805e-16, 0, 2.77555756156289e-16, 4.85722573273506e-17, 
3.88578058618805e-16, 4.88498130835069e-15, 2.22044604925031e-16, 
2.44249065417534e-15, -2.22044604925031e-16, -2.22044604925031e-16, 
-4.44089209850063e-16, -4.44089209850063e-16, 0, -2.22044604925031e-16, 
2.4980018054066e-16, 4.44089209850063e-16, 2.22044604925031e-16, 
-4.44089209850063e-16, -1.11022302462516e-16, 4.44089209850063e-16, 
6.66133814775094e-16, 2.22044604925031e-16, 1.11022302462516e-16, 
2.77555756156289e-17, 4.44089209850063e-16, 8.32667268468867e-17, 
-1.11022302462516e-16, 0, 1.77635683940025e-15, -4.44089209850063e-16, 
-2.22044604925031e-16, -2.22044604925031e-16, -3.33066907387547e-16, 
2.77555756156289e-17, 2.88657986402541e-15, -6.93889390390723e-17, 
4.44089209850063e-16, -4.16333634234434e-17, 0, -8.88178419700125e-16, 
4.16333634234434e-17, -6.66133814775094e-16, -1.55431223447522e-15, 
-5.55111512312578e-17, 2.22044604925031e-16, 2.22044604925031e-16, 
1.11022302462516e-16, -1.11022302462516e-16, 1.11022302462516e-16, 
-1.11022302462516e-16, -1.11022302462516e-16, -2.22044604925031e-16, 
-2.44249065417534e-15, -3.33066907387547e-16, 1.11022302462516e-16, 
0, 4.5102810375397e-17, -3.05311331771918e-16, 2.77555756156289e-16, 
1.38777878078145e-17, -3.33066907387547e-15, -4.44089209850063e-16, 
2.66453525910038e-15, -4.88498130835069e-15, 2.77555756156289e-16, 
4.9960036108132e-16, -1.11022302462516e-16, 2.22044604925031e-16, 
-4.44089209850063e-16, -1.66533453693773e-16, -1.55431223447522e-15, 
2.22044604925031e-16, 4.44089209850063e-16, -5.55111512312578e-17, 
-2.60208521396521e-18, 4.16333634234434e-17, 1.11022302462516e-16, 
0, -1.11022302462516e-16, -2.22044604925031e-16, 3.33066907387547e-15, 
-1.11022302462516e-16, -2.22044604925031e-16, 2.22044604925031e-15, 
-3.99680288865056e-15, 1.33226762955019e-15, -4.44089209850063e-15, 
1.04083408558608e-17, 0, 4.44089209850063e-15, 4.44089209850063e-16, 
-1.11022302462516e-16, 2.88657986402541e-15, 4.16333634234434e-17, 
5.55111512312578e-17, 4.88498130835069e-15, -2.77555756156289e-16, 
8.88178419700125e-16, -8.88178419700125e-16, 3.10862446895044e-15, 
-4.44089209850063e-16, -1.11022302462516e-16, -3.19189119579733e-16, 
0, -5.55111512312578e-17, 4.44089209850063e-16, 3.33066907387547e-16, 
1.11022302462516e-16, 1.11022302462516e-16, 4.16333634234434e-17, 
3.5527136788005e-15, 0, -1.38777878078145e-17, -2.22044604925031e-16, 
4.66293670342566e-15, -1.11022302462516e-16, 1.38777878078145e-16, 
-2.22044604925031e-16, -3.33066907387547e-16, -6.66133814775094e-16, 
-2.22044604925031e-16, 6.66133814775094e-16, -3.33066907387547e-15, 
4.44089209850063e-16, 2.77555756156289e-16, -6.66133814775094e-16, 
4.44089209850063e-15, -3.33066907387547e-15, -3.46944695195361e-17, 
-8.88178419700125e-16, 4.21884749357559e-15, -2.77555756156289e-17, 
-1.66533453693773e-16, -4.16333634234434e-17, 3.33066907387547e-16, 
-1.38777878078145e-16, -2.77555756156289e-16, 4.44089209850063e-16, 
-2.77555756156289e-16, 1.33226762955019e-15, -3.33066907387547e-15, 
-3.33066907387547e-16, -2.22044604925031e-15, 4.16333634234434e-17, 
-4.44089209850063e-16, -1.11022302462516e-16, 4.44089209850063e-16, 
1.66533453693773e-16, 0, 2.77555756156289e-16, 4.44089209850063e-16, 
3.33066907387547e-16, -3.99680288865056e-15, 1.38777878078145e-17, 
3.33066907387547e-16, -4.21884749357559e-15, -3.33066907387547e-16, 
8.88178419700125e-16, 2.77555756156289e-16, 2.77555756156289e-16, 
2.35922392732846e-16, -1.33226762955019e-15, -3.88578058618805e-16, 
3.60822483003176e-16, 4.44089209850063e-16, -3.10862446895044e-15, 
2.22044604925031e-15, 5.55111512312578e-16, -3.10862446895044e-15, 
4.66293670342566e-15, 2.77555756156289e-16, -1.11022302462516e-16, 
-1.73472347597681e-18, -2.22044604925031e-15, -6.93889390390723e-18, 
3.33066907387547e-16, 1.11022302462516e-16, 0, 2.22044604925031e-16, 
1.11022302462516e-16, -2.22044604925031e-15, 3.33066907387547e-16, 
-1.11022302462516e-16, 3.88578058618805e-16, -1.11022302462516e-16, 
-4.44089209850063e-16, 3.33066907387547e-16, -2.22044604925031e-16, 
-1.11022302462516e-16, 1.33226762955019e-15, -1.11022302462516e-16, 
2.22044604925031e-16, -3.99680288865056e-15, 8.32667268468867e-17, 
3.5527136788005e-15, -2.22044604925031e-16, 3.88578058618805e-16, 
2.22044604925031e-16, -3.33066907387547e-16, -4.44089209850063e-16, 
4.44089209850063e-16, -4.44089209850063e-16, 4.9960036108132e-16, 
-8.32667268468867e-17, 1.11022302462516e-16, -3.05311331771918e-16, 
-3.88578058618805e-16, 0, -3.33066907387547e-16, 2.66453525910038e-15, 
1.33226762955019e-15, 4.44089209850063e-16, 1.55431223447522e-15, 
1.77635683940025e-15, 6.66133814775094e-16, -1.33226762955019e-15, 
2.66453525910038e-15, 7.7715611723761e-16, 0, 3.10862446895044e-15, 
5.55111512312578e-17, 4.9960036108132e-16, 5.55111512312578e-17, 
-3.33066907387547e-16, 1.66533453693773e-16, 0, -9.71445146547012e-17, 
4.21884749357559e-15, -2.22044604925031e-16, 1.11022302462516e-16, 
1.11022302462516e-16, 2.22044604925031e-16, -5.55111512312578e-17, 
-2.22044604925031e-16, -3.99680288865056e-15, -4.44089209850063e-15, 
-1.38777878078145e-16, -5.55111512312578e-16, 0, -1.99840144432528e-15, 
-1.11022302462516e-16, -1.77635683940025e-15, -2.77555756156289e-17, 
4.66293670342566e-15, -2.22044604925031e-16, -3.5527136788005e-15, 
-1.94289029309402e-16, 0, -1.55431223447522e-15, 1.11022302462516e-15, 
-4.71844785465692e-16, -4.44089209850063e-16, -1.11022302462516e-16, 
-1.11022302462516e-16, 1.33226762955019e-15, -3.88578058618805e-16, 
4.44089209850063e-16, 1.11022302462516e-16, -3.88578058618805e-16, 
-1.38777878078145e-17, 3.33066907387547e-16, 2.22044604925031e-16, 
-1.11022302462516e-16, 2.88657986402541e-15, 3.33066907387547e-16, 
3.33066907387547e-16, 3.33066907387547e-16, 3.33066907387547e-16, 
2.22044604925031e-16, -2.88657986402541e-15, 2.66453525910038e-15, 
3.05311331771918e-16, 4.85722573273506e-17, -3.33066907387547e-16, 
-2.22044604925031e-16, 1.66533453693773e-16, 2.22044604925031e-16, 
2.22044604925031e-16, 2.22044604925031e-16, -1.11022302462516e-16, 
0, 0, -4.71844785465692e-16, -1.33226762955019e-15, 4.44089209850063e-16, 
1.11022302462516e-16, -2.77555756156289e-16, -1.66533453693773e-16, 
1.11022302462516e-16, 2.66453525910038e-15, 0, 0, -2.22044604925031e-16, 
3.10862446895044e-15, 6.93889390390723e-17, 3.33066907387547e-16, 
-1.38777878078145e-17, 1.11022302462516e-16, 0, 0, -5.55111512312578e-17, 
-4.44089209850063e-16, -4.44089209850063e-16, -3.88578058618805e-16, 
4.21884749357559e-15, 0, -8.88178419700125e-16, 2.22044604925031e-16, 
-1.66533453693773e-16, -4.66293670342566e-15, 2.77555756156289e-17, 
8.88178419700125e-16, -4.88498130835069e-15, 4.16333634234434e-17, 
3.33066907387547e-15, -3.33066907387547e-16, 1.66533453693773e-16, 
2.22044604925031e-16, 2.44249065417534e-15, 1.99840144432528e-15, 
0, -2.22044604925031e-16, 1.66533453693773e-16, -2.77555756156289e-17, 
2.44249065417534e-15, 4.44089209850063e-15, -1.11022302462516e-16, 
-2.22044604925031e-16, 1.11022302462516e-16, 2.22044604925031e-16, 
-4.44089209850063e-16, 4.44089209850063e-16, 0, 4.44089209850063e-16, 
6.66133814775094e-16, 2.22044604925031e-16, -5.55111512312578e-17, 
-6.66133814775094e-16, 4.44089209850063e-16, 2.77555756156289e-16, 
3.88578058618805e-16, 2.4980018054066e-16, 2.22044604925031e-16, 
-2.77555756156289e-16, -4.44089209850063e-16, -3.77475828372553e-15, 
-2.22044604925031e-16, -4.44089209850063e-16, -1.55431223447522e-15, 
-2.88657986402541e-15, 0, 2.88657986402541e-15, 3.46944695195361e-18, 
1.11022302462516e-16, -4.88498130835069e-15, 1.11022302462516e-15, 
-3.33066907387547e-16, 3.33066907387547e-16, 0, 0, 4.44089209850063e-16, 
1.77635683940025e-15, 4.44089209850063e-16, -2.22044604925031e-15, 
-1.30104260698261e-18, -3.33066907387547e-16, 1.77635683940025e-15, 
2.77555756156289e-17, 1.11022302462516e-16, 2.77555756156289e-17, 
3.99680288865056e-15, 0, 3.33066907387547e-16, -4.44089209850063e-16, 
-4.88498130835069e-15, 6.66133814775094e-16, -2.22044604925031e-16, 
0, -4.71844785465692e-16, 3.12250225675825e-17, 8.88178419700125e-16, 
-2.4980018054066e-16, -2.22044604925031e-16, 4.44089209850063e-16, 
5.55111512312578e-17, -2.22044604925031e-16, 1.66533453693773e-16, 
5.55111512312578e-17, 3.33066907387547e-16, 1.33226762955019e-15, 
0, 2.22044604925031e-16, -1.66533453693773e-16, 3.99680288865056e-15, 
-1.11022302462516e-16, -2.22044604925031e-15, -2.77555756156289e-16, 
-3.88578058618805e-16, -4.16333634234434e-17, -3.88578058618805e-16, 
2.22044604925031e-16, -4.44089209850063e-16, 4.88498130835069e-15, 
4.44089209850063e-16, -4.44089209850063e-16, 3.33066907387547e-15, 
-2.22044604925031e-16, 1.38777878078145e-17, 1.77635683940025e-15, 
2.22044604925031e-16, -2.22044604925031e-15, 2.66453525910038e-15, 
-3.5527136788005e-15, 4.44089209850063e-16, 3.99680288865056e-15, 
-2.22044604925031e-15, 3.33066907387547e-16, 4.44089209850063e-16, 
8.88178419700125e-16, 3.99680288865056e-15, -1.66533453693773e-16, 
-3.10862446895044e-15, -2.66453525910038e-15, 1.11022302462516e-16, 
3.88578058618805e-16, 4.44089209850063e-16, 2.22044604925031e-16, 
-3.99680288865056e-15, 3.33066907387547e-16, 4.44089209850063e-15, 
4.88498130835069e-15, 2.77555756156289e-17, -1.33226762955019e-15, 
-1.33226762955019e-15, -8.88178419700125e-16, -1.11022302462516e-16, 
1.11022302462516e-16, 3.33066907387547e-16, 4.44089209850063e-16, 
1.95156391047391e-18, 1.33226762955019e-15, 0, -5.55111512312578e-17, 
-4.88498130835069e-15, -2.44249065417534e-15, 4.66293670342566e-15, 
-2.77555756156289e-16, 0, 3.99680288865056e-15, -2.22044604925031e-16, 
4.44089209850063e-16, -1.11022302462516e-16, 8.88178419700125e-16, 
-3.33066907387547e-15, -2.22044604925031e-16, -3.99680288865056e-15, 
5.55111512312578e-17, 3.33066907387547e-16, 2.77555756156289e-16, 
4.16333634234434e-17, 3.10862446895044e-15, -8.32667268468867e-17, 
2.22044604925031e-16, -3.5527136788005e-15, -4.44089209850063e-16, 
0, -2.22044604925031e-16, 2.66453525910038e-15, 3.10862446895044e-15, 
3.77475828372553e-15, 3.10862446895044e-15, 1.11022302462516e-16, 
-2.22044604925031e-16, -3.33066907387547e-16, -4.9960036108132e-16, 
2.22044604925031e-16, -3.33066907387547e-16, 0, -4.44089209850063e-16, 
-4.44089209850063e-16, 3.46944695195361e-18, 2.22044604925031e-16, 
3.33066907387547e-15, -3.88578058618805e-16, 3.33066907387547e-16, 
-3.88578058618805e-16, -3.33066907387547e-16, 1.11022302462516e-16, 
2.77555756156289e-17, 3.33066907387547e-16, -3.33066907387547e-16, 
-3.33066907387547e-16, -3.88578058618805e-16, -5.55111512312578e-17, 
-3.99680288865056e-15, -2.22044604925031e-16, 0, -1.11022302462516e-16, 
3.33066907387547e-16, -3.33066907387547e-16, 0, 2.66453525910038e-15, 
4.44089209850063e-16, -4.44089209850063e-16, 1.11022302462516e-16, 
-2.77555756156289e-16, 1.33226762955019e-15, 4.88498130835069e-15, 
3.10862446895044e-15, 3.99680288865056e-15, 4.44089209850063e-16, 
-1.94289029309402e-16, 2.88657986402541e-15, 2.44249065417534e-15, 
2.77555756156289e-17, 0, -1.66533453693773e-16, 3.33066907387547e-16, 
1.11022302462516e-16, 2.22044604925031e-16, -5.55111512312578e-17, 
-3.88578058618805e-16, 4.44089209850063e-16, -3.33066907387547e-16, 
0, -4.44089209850063e-16, 1.11022302462516e-16, -1.66533453693773e-16, 
-1.38777878078145e-17, -1.66533453693773e-16, -3.33066907387547e-16, 
-4.44089209850063e-15, -3.33066907387547e-16, 2.66453525910038e-15, 
4.66293670342566e-15, 3.33066907387547e-16, -2.77555756156289e-16, 
1.11022302462516e-16, 4.44089209850063e-16, -5.55111512312578e-17, 
-1.66533453693773e-16, 0, -1.11022302462516e-16, 2.22044604925031e-16, 
2.77555756156289e-16, 2.77555756156289e-16, 0, 2.44249065417534e-15, 
-1.66533453693773e-16, 8.88178419700125e-16, -2.77555756156289e-16, 
1.11022302462516e-16, 0, -2.22044604925031e-16, 2.77555756156289e-16, 
-1.11022302462516e-16, -1.77635683940025e-15, 1.11022302462516e-15, 
-2.22044604925031e-16, -3.33066907387547e-16, 0, 2.77555756156289e-17, 
-2.66453525910038e-15, 1.33226762955019e-15, -3.33066907387547e-16, 
-3.33066907387547e-16, -4.21884749357559e-15, -1.52655665885959e-16, 
4.44089209850063e-16, 1.11022302462516e-16, 0, -1.11022302462516e-16, 
1.33226762955019e-15, -1.11022302462516e-16, 2.08166817117217e-17, 
3.10862446895044e-15, 3.46944695195361e-18, -4.88498130835069e-15, 
-3.33066907387547e-15, 4.9960036108132e-16, -2.22044604925031e-16, 
4.44089209850063e-16, 7.7715611723761e-16, 5.55111512312578e-17, 
4.44089209850063e-16, 0, 8.88178419700125e-16, 3.10862446895044e-15, 
-4.44089209850063e-15, -4.16333634234434e-17, -3.46944695195361e-18, 
0, -1.33226762955019e-15, -3.10862446895044e-15, 1.66533453693773e-16, 
2.88657986402541e-15, 2.22044604925031e-16, 2.77555756156289e-16, 
-4.44089209850063e-16, -1.77635683940025e-15, 0, -1.11022302462516e-16, 
-1.66533453693773e-16, 3.33066907387547e-16, 4.44089209850063e-16, 
0, -6.93889390390723e-18, 5.55111512312578e-17, -1.11022302462516e-16, 
3.88578058618805e-16, 1.38777878078145e-16, -4.71844785465692e-16, 
-4.66293670342566e-15, 1.11022302462516e-16, 5.55111512312578e-17, 
0, -1.11022302462516e-16, -1.11022302462516e-16, -3.99680288865056e-15, 
5.55111512312578e-17, 8.88178419700125e-16, -1.66533453693773e-16, 
3.10862446895044e-15, 1.66533453693773e-16, 4.30211422042248e-16, 
-1.11022302462516e-16, 6.66133814775094e-16, 1.11022302462516e-16, 
0, 4.44089209850063e-15, -4.44089209850063e-15, 1.56125112837913e-17, 
-4.44089209850063e-16, 2.4980018054066e-16, 4.16333634234434e-17, 
-4.44089209850063e-16, -4.44089209850063e-16, -1.77635683940025e-15, 
4.88498130835069e-15, -3.5527136788005e-15, 1.11022302462516e-16, 
-4.44089209850063e-16, -1.11022302462516e-16, -1.99840144432528e-15, 
1.77635683940025e-15, 3.99680288865056e-15, -1.66533453693773e-16, 
1.66533453693773e-16, -5.55111512312578e-17, 2.22044604925031e-16, 
1.77635683940025e-15, 1.73472347597681e-18, 4.44089209850063e-15, 
0, -4.44089209850063e-15, -3.33066907387547e-16, 3.77475828372553e-15, 
3.33066907387547e-16, 3.33066907387547e-16, -2.66453525910038e-15, 
4.44089209850063e-16, -2.22044604925031e-15, -4.44089209850063e-16, 
-1.11022302462516e-16, 1.11022302462516e-16, -4.44089209850063e-16, 
-4.44089209850063e-16, 0, -3.33066907387547e-16, -3.10862446895044e-15, 
-3.88578058618805e-16, 4.9960036108132e-16, -3.46944695195361e-18, 
-4.44089209850063e-16, 8.88178419700125e-16, -3.33066907387547e-16, 
1.11022302462516e-16, 1.99840144432528e-15, -4.44089209850063e-16, 
-4.44089209850063e-16, 0, 2.77555756156289e-17, -6.66133814775094e-16, 
4.44089209850063e-15, 4.66293670342566e-15, -2.4980018054066e-16, 
-2.22044604925031e-16, 2.22044604925031e-16, 1.55431223447522e-15, 
-4.16333634234434e-17, 1.11022302462516e-16, -1.55431223447522e-15, 
1.80411241501588e-16, -4.44089209850063e-15, -2.22044604925031e-15, 
-2.22044604925031e-15, 1.94289029309402e-16, 6.66133814775094e-16, 
4.66293670342566e-15, 3.33066907387547e-16, -2.22044604925031e-16, 
-6.93889390390723e-18, -1.33226762955019e-15, -5.55111512312578e-17, 
-3.33066907387547e-16, -2.22044604925031e-16, -5.55111512312578e-16, 
-2.77555756156289e-17, -2.22044604925031e-15, 1.11022302462516e-16, 
-1.11022302462516e-16, -2.22044604925031e-16, 2.88657986402541e-15, 
-1.11022302462516e-16, -4.9960036108132e-16, -2.22044604925031e-16, 
2.22044604925031e-16, 4.44089209850063e-16, -4.44089209850063e-16, 
6.66133814775094e-16, -5.55111512312578e-17, 2.77555756156289e-16, 
-1.77635683940025e-15, -3.99680288865056e-15, -4.16333634234434e-17, 
1.99840144432528e-15, -4.44089209850063e-16, -2.22044604925031e-15, 
4.85722573273506e-17, -6.93889390390723e-18, 3.33066907387547e-16, 
-2.77555756156289e-17, -2.88657986402541e-15, -2.77555756156289e-17, 
-4.88498130835069e-15, -1.11022302462516e-16, 3.5527136788005e-15, 
-3.10862446895044e-15, -1.11022302462516e-16, -4.44089209850063e-16, 
-4.44089209850063e-16, 4.44089209850063e-16, 2.77555756156289e-16, 
-4.44089209850063e-16, 1.11022302462516e-16, 0, -5.55111512312578e-17, 
-1.62630325872826e-19, 4.44089209850063e-16, -1.80411241501588e-16, 
3.33066907387547e-16, 5.55111512312578e-16, 2.22044604925031e-16, 
-8.88178419700125e-16, -1.11022302462516e-16, -2.22044604925031e-16, 
2.08166817117217e-17, -4.16333634234434e-17, -5.55111512312578e-17, 
-1.38777878078145e-17, 4.9960036108132e-16, 5.55111512312578e-17, 
4.44089209850063e-16, 4.44089209850063e-15, -3.33066907387547e-15, 
-1.11022302462516e-16, -3.33066907387547e-16, 3.33066907387547e-16, 
-1.11022302462516e-16, -1.77635683940025e-15, 4.44089209850063e-16, 
0, 1.11022302462516e-16, -8.88178419700125e-16, -4.9960036108132e-16, 
-1.77635683940025e-15, -3.05311331771918e-16, 4.44089209850063e-16, 
-1.55431223447522e-15, -3.33066907387547e-16, 0, 1.11022302462516e-16, 
2.66453525910038e-15, -3.77475828372553e-15, -2.44249065417534e-15, 
-1.33226762955019e-15, 1.38777878078145e-17, 1.11022302462516e-16, 
2.22044604925031e-16, -1.11022302462516e-16, -7.7715611723761e-16, 
3.33066907387547e-16, 2.22044604925031e-15, -2.22044604925031e-16, 
4.33680868994202e-18, -3.88578058618805e-16, 1.11022302462516e-16, 
-1.11022302462516e-16, 2.22044604925031e-16, 7.7715611723761e-16, 
1.11022302462516e-16, -4.71844785465692e-16, 3.88578058618805e-16, 
2.88657986402541e-15, -3.33066907387547e-16, 0, 3.5527136788005e-15, 
4.44089209850063e-16, 4.44089209850063e-16, 4.66293670342566e-15, 
-3.88578058618805e-16, 3.88578058618805e-16, 1.38777878078145e-17, 
-4.44089209850063e-16, -1.66533453693773e-16, -3.88578058618805e-16, 
3.33066907387547e-16, 4.88498130835069e-15, 0, -2.22044604925031e-16, 
-4.44089209850063e-16, 4.9960036108132e-16, 4.21884749357559e-15, 
1.33226762955019e-15, 3.33066907387547e-16, 0, -1.11022302462516e-16, 
-1.55431223447522e-15, 2.66453525910038e-15, -4.21884749357559e-15, 
-1.11022302462516e-16, 8.88178419700125e-16, 1.11022302462516e-16, 
-1.11022302462516e-16, -4.44089209850063e-15, -2.22044604925031e-16, 
-2.22044604925031e-16, -3.33066907387547e-15, 3.10862446895044e-15, 
-3.88578058618805e-16, -3.33066907387547e-16, 2.22044604925031e-16, 
4.44089209850063e-15, -4.16333634234434e-17, -3.99680288865056e-15, 
2.22044604925031e-15, 5.55111512312578e-17, -5.55111512312578e-17, 
2.77555756156289e-16, -3.88578058618805e-16, 4.44089209850063e-16, 
1.11022302462516e-15, -3.88578058618805e-16, 3.33066907387547e-16, 
2.22044604925031e-16, 4.44089209850063e-15, 4.44089209850063e-15, 
-4.9960036108132e-16, -3.33066907387547e-16, -3.99680288865056e-15, 
-2.66453525910038e-15, -3.33066907387547e-16, -4.44089209850063e-16, 
0, 4.21884749357559e-15, -8.88178419700125e-16, -4.44089209850063e-16, 
-4.44089209850063e-16, 1.77635683940025e-15, -2.22044604925031e-16, 
9.9920072216264e-16, 1.33226762955019e-15, -4.44089209850063e-15, 
-3.10862446895044e-15, 5.55111512312578e-17, 0, -1.11022302462516e-16, 
-2.22044604925031e-16, 4.44089209850063e-16, 1.66533453693773e-16, 
1.38777878078145e-16, -1.11022302462516e-15, -1.11022302462516e-16, 
-5.55111512312578e-17, -3.33066907387547e-16, 1.11022302462516e-16, 
-1.11022302462516e-16, 2.44249065417534e-15, 2.77555756156289e-16, 
-4.71844785465692e-16, -3.77475828372553e-15, -1.11022302462516e-16, 
-5.55111512312578e-17, -4.44089209850063e-16, 1.11022302462516e-15, 
-1.66533453693773e-16, 0, 3.33066907387547e-16, 3.5527136788005e-15, 
-3.88578058618805e-16, -2.4980018054066e-16, -2.22044604925031e-16, 
2.22044604925031e-15, -4.44089209850063e-16, 4.71844785465692e-16, 
3.88578058618805e-16, -3.33066907387547e-16, -1.38777878078145e-17, 
0, 1.38777878078145e-16, 1.11022302462516e-16, 0, -1.11022302462516e-16, 
-1.33226762955019e-15, -4.44089209850063e-16, -3.60822483003176e-16, 
0, -2.22044604925031e-16, 0, -1.77635683940025e-15, 0, 2.22044604925031e-16, 
4.44089209850063e-16, 5.55111512312578e-17, -2.44249065417534e-15, 
-4.44089209850063e-16, 3.33066907387547e-16, 0, 3.88578058618805e-16, 
-1.11022302462516e-16, 3.10862446895044e-15, -2.22044604925031e-16, 
-1.99840144432528e-15, -3.10862446895044e-15, -2.44249065417534e-15, 
2.77555756156289e-17, -3.10862446895044e-15, -4.66293670342566e-15, 
-1.99840144432528e-15, -2.22044604925031e-16, -8.88178419700125e-16, 
4.9960036108132e-16, 2.66453525910038e-15, -3.12250225675825e-17, 
4.44089209850063e-16, -4.44089209850063e-16, -1.11022302462516e-15, 
-4.71844785465692e-16, 1.11022302462516e-16, 3.33066907387547e-16, 
-2.08166817117217e-17, 0, 4.88498130835069e-15, -4.44089209850063e-16, 
1.77635683940025e-15, 4.44089209850063e-16, -4.66293670342566e-15, 
6.66133814775094e-16, 3.88578058618805e-16, 1.11022302462516e-16, 
0, 4.44089209850063e-16, -4.71844785465692e-16, 4.44089209850063e-16, 
-3.88578058618805e-16, 2.22044604925031e-16, 4.16333634234434e-16, 
0, 0, -4.44089209850063e-15, -1.33226762955019e-15, 4.16333634234434e-17, 
2.22044604925031e-16, 3.33066907387547e-16, 1.33226762955019e-15, 
-1.11022302462516e-16, 6.66133814775094e-16, 2.66453525910038e-15, 
-3.05311331771918e-16, -4.44089209850063e-16, -3.5527136788005e-15, 
-2.22044604925031e-16, 2.22044604925031e-15, -1.11022302462516e-16, 
-3.33066907387547e-16, 3.33066907387547e-16, 4.44089209850063e-16, 
0, -4.44089209850063e-16, -8.32667268468867e-17, 2.4980018054066e-16, 
-3.10862446895044e-15, -1.94289029309402e-16, 4.44089209850063e-16, 
0, 8.88178419700125e-16, 3.5527136788005e-15, 1.11022302462516e-16, 
-2.77555756156289e-16, 8.88178419700125e-16, 3.88578058618805e-16, 
-4.44089209850063e-16, 2.77555756156289e-16, 2.22044604925031e-16, 
-3.5527136788005e-15, 0, 4.44089209850063e-16, -4.44089209850063e-16, 
-3.77475828372553e-15, -3.33066907387547e-16, -2.77555756156289e-16, 
-2.22044604925031e-16, -3.33066907387547e-16, -1.11022302462516e-16, 
6.66133814775094e-16, -4.44089209850063e-15, 2.88657986402541e-15, 
4.44089209850063e-15, 2.22044604925031e-16, -2.77555756156289e-17, 
-4.16333634234434e-17, -4.44089209850063e-16, -5.55111512312578e-17, 
4.44089209850063e-16, 1.99840144432528e-15, -2.22044604925031e-16, 
-1.11022302462516e-16, -5.55111512312578e-16, -1.11022302462516e-16, 
-3.10862446895044e-15, 3.88578058618805e-16, 3.33066907387547e-16, 
-1.11022302462516e-16, -8.88178419700125e-16, -2.22044604925031e-16, 
4.44089209850063e-16, 2.22044604925031e-16, -4.5102810375397e-17, 
-5.55111512312578e-17, -3.33066907387547e-16, 4.66293670342566e-15, 
2.77555756156289e-16, 0, -2.22044604925031e-16, -4.44089209850063e-15, 
2.22044604925031e-16, 3.88578058618805e-16, -3.33066907387547e-16, 
4.71844785465692e-16, -2.22044604925031e-15, -2.22044604925031e-15, 
-3.99680288865056e-15, 2.77555756156289e-16, -2.4980018054066e-16, 
3.46944695195361e-17, 4.9960036108132e-16, -1.77635683940025e-15, 
3.33066907387547e-16, -3.10862446895044e-15, -2.77555756156289e-16, 
-4.44089209850063e-16, 4.44089209850063e-16, 0, 3.33066907387547e-16, 
-8.88178419700125e-16, 3.99680288865056e-15, 2.44249065417534e-15, 
2.22044604925031e-16, -2.88657986402541e-15, -4.44089209850063e-16, 
-3.77475828372553e-15, -1.38777878078145e-16, 3.5527136788005e-15, 
-1.38777878078145e-17, -2.22044604925031e-16, -3.99680288865056e-15, 
3.33066907387547e-16, 0, 0, 5.55111512312578e-17, 4.44089209850063e-16, 
-5.55111512312578e-17, 6.66133814775094e-16, 0, 4.16333634234434e-17, 
2.77555756156289e-16, -1.94289029309402e-16, 4.21884749357559e-15, 
-1.99840144432528e-15, 6.66133814775094e-16, -1.11022302462516e-16, 
-3.33066907387547e-15, -1.11022302462516e-15, 0, -3.33066907387547e-16, 
4.21884749357559e-15, -4.88498130835069e-15, 3.33066907387547e-15, 
-2.77555756156289e-16, -3.33066907387547e-16, 4.85722573273506e-17, 
-1.66533453693773e-16, 2.22044604925031e-15, -2.22044604925031e-16, 
-1.33226762955019e-15, -3.46944695195361e-17, 4.71844785465692e-16, 
2.22044604925031e-16, 3.99680288865056e-15, 2.66453525910038e-15, 
5.55111512312578e-17, 4.16333634234434e-17, -1.11022302462516e-16, 
3.99680288865056e-15, 3.05311331771918e-16, 1.11022302462516e-15, 
-1.11022302462516e-16, -4.44089209850063e-16, 1.99840144432528e-15, 
-2.22044604925031e-16, -3.33066907387547e-16, 0, -2.77555756156289e-17, 
-1.11022302462516e-16, 3.33066907387547e-16, -1.38777878078145e-17, 
-6.66133814775094e-16, 4.44089209850063e-16, 1.11022302462516e-16, 
-3.33066907387547e-16, 1.11022302462516e-16, -1.11022302462516e-15, 
2.22044604925031e-16, 3.88578058618805e-16, 4.44089209850063e-16, 
-1.11022302462516e-16, 2.22044604925031e-15, -3.33066907387547e-16, 
1.11022302462516e-16, 8.88178419700125e-16, -3.33066907387547e-16, 
0, -1.55431223447522e-15, -2.22044604925031e-16, 0, 4.44089209850063e-15, 
3.33066907387547e-16, 4.44089209850063e-16, -4.44089209850063e-16, 
-2.22044604925031e-16, -4.44089209850063e-16, 4.44089209850063e-16, 
-4.44089209850063e-16, -4.44089209850063e-16, -4.44089209850063e-16, 
-4.44089209850063e-16, 4.44089209850063e-16, -2.22044604925031e-16, 
4.44089209850063e-16, -1.66533453693773e-16, -4.44089209850063e-16, 
2.22044604925031e-16, -5.55111512312578e-16, -2.77555756156289e-16, 
-4.33680868994202e-18, -1.11022302462516e-16, 3.33066907387547e-15, 
4.44089209850063e-15, 2.77555756156289e-17, -4.44089209850063e-16, 
0, -1.66533453693773e-16, 0, -5.55111512312578e-17, -4.44089209850063e-16, 
4.66293670342566e-15, -2.4980018054066e-16, 3.99680288865056e-15, 
0, -4.44089209850063e-16, -1.11022302462516e-16, -4.85722573273506e-17, 
2.22044604925031e-16, 3.88578058618805e-16, 2.44249065417534e-15, 
1.11022302462516e-16, 1.38777878078145e-16, -4.88498130835069e-15, 
3.33066907387547e-16, 4.44089209850063e-16, 5.55111512312578e-17, 
-3.77475828372553e-15, -2.22044604925031e-16, -8.88178419700125e-16, 
-1.11022302462516e-16, 6.93889390390723e-18, 5.55111512312578e-17, 
-8.88178419700125e-16, -1.11022302462516e-16, 0, 2.66453525910038e-15, 
4.44089209850063e-16, 1.33226762955019e-15, -1.11022302462516e-16, 
4.66293670342566e-15, -1.11022302462516e-15, 0, -4.44089209850063e-16, 
3.88578058618805e-16, -2.22044604925031e-16, -1.99840144432528e-15, 
3.33066907387547e-16, 0, -4.44089209850063e-15, -4.21884749357559e-15, 
-3.99680288865056e-15, -3.05311331771918e-16, -4.44089209850063e-16, 
-4.16333634234434e-17, 3.05311331771918e-16, -3.33066907387547e-16, 
4.16333634234434e-17, 2.22044604925031e-16, -3.5527136788005e-15, 
1.66533453693773e-16, -1.38777878078145e-17, -3.33066907387547e-16, 
-4.44089209850063e-16, 4.44089209850063e-16, 0, 4.9960036108132e-16, 
1.38777878078145e-17, 1.55431223447522e-15, 1.11022302462516e-16, 
-3.33066907387547e-16, 2.22044604925031e-16, 0, -2.22044604925031e-16, 
2.77555756156289e-16, 4.88498130835069e-15, -8.88178419700125e-16, 
-2.22044604925031e-15, -1.77635683940025e-15, 2.22044604925031e-16, 
-1.99840144432528e-15, -1.11022302462516e-16, 1.11022302462516e-16, 
4.88498130835069e-15, -8.88178419700125e-16, -1.94289029309402e-16, 
-4.85722573273506e-16, -3.33066907387547e-16, 1.38777878078145e-17, 
3.33066907387547e-16, -2.77555756156289e-16, 2.60208521396521e-18, 
-4.44089209850063e-16, 4.21884749357559e-15, -4.44089209850063e-15, 
-6.93889390390723e-18, -4.44089209850063e-16, -3.33066907387547e-16, 
-6.66133814775094e-16, -4.44089209850063e-16, -3.33066907387547e-16, 
0, 6.66133814775094e-16, -1.11022302462516e-16, -5.55111512312578e-17, 
-4.16333634234434e-17, 2.22044604925031e-16, 0, 8.32667268468867e-17, 
3.33066907387547e-16, 3.88578058618805e-16, 1.99840144432528e-15, 
2.22044604925031e-16, -2.60208521396521e-18, -1.55431223447522e-15, 
-2.22044604925031e-16, -2.22044604925031e-16, -1.77635683940025e-15, 
4.16333634234434e-17, 6.66133814775094e-16, 3.77475828372553e-15, 
3.33066907387547e-16, -4.9960036108132e-16, -3.33066907387547e-16, 
-3.46944695195361e-18, -2.66453525910038e-15, 2.44249065417534e-15, 
-4.44089209850063e-16, -4.66293670342566e-15, -3.33066907387547e-16, 
-2.08166817117217e-17, 1.94289029309402e-16, -3.88578058618805e-16, 
-2.22044604925031e-16, 4.44089209850063e-16, 1.11022302462516e-16, 
2.66453525910038e-15, 4.44089209850063e-15, -4.44089209850063e-16, 
-2.22044604925031e-16, -5.55111512312578e-17, 0, -4.16333634234434e-16, 
-3.33066907387547e-16, -3.88578058618805e-16, -4.44089209850063e-16, 
-2.22044604925031e-16, -3.88578058618805e-16, 0, 3.33066907387547e-16, 
-3.88578058618805e-16, -2.44249065417534e-15, 4.44089209850063e-16, 
-2.91433543964104e-16, -4.85722573273506e-17, -8.32667268468867e-17, 
3.33066907387547e-16, -1.11022302462516e-16, 3.33066907387547e-16, 
-1.11022302462516e-16, -1.94289029309402e-16, 3.88578058618805e-16, 
3.33066907387547e-16, -4.44089209850063e-15, -5.55111512312578e-17, 
1.77635683940025e-15, 4.44089209850063e-16, -3.33066907387547e-16, 
3.33066907387547e-16, 0, 5.55111512312578e-16, 3.33066907387547e-16, 
4.9960036108132e-16, 2.22044604925031e-16, 0, -2.22044604925031e-16, 
4.44089209850063e-16, -2.22044604925031e-15, -3.5527136788005e-15, 
-2.77555756156289e-16, 2.77555756156289e-17, -1.11022302462516e-16, 
-2.44249065417534e-15, -3.46944695195361e-16, 1.11022302462516e-16, 
-1.08420217248550e-19, -4.44089209850063e-16, 3.88578058618805e-16, 
2.77555756156289e-16, 4.88498130835069e-15, -1.38777878078145e-17, 
-3.81639164714898e-17, -1.66533453693773e-16, -6.66133814775094e-16, 
-2.22044604925031e-16, 2.22044604925031e-16, 0, 2.77555756156289e-16, 
-3.60822483003176e-16, 4.66293670342566e-15, 0, -2.22044604925031e-16, 
-4.44089209850063e-16, 3.5527136788005e-15, -1.11022302462516e-16, 
-3.05311331771918e-16, 1.77635683940025e-15, -1.11022302462516e-15, 
2.22044604925031e-16, -2.22044604925031e-16, -1.33226762955019e-15, 
-4.44089209850063e-16, -3.77475828372553e-15, 1.11022302462516e-15, 
-1.11022302462516e-16, -2.22044604925031e-16, -3.77475828372553e-15, 
-2.77555756156289e-16, -1.52655665885959e-16, 3.33066907387547e-16, 
-2.22044604925031e-15, -2.22044604925031e-16, -1.11022302462516e-16, 
-4.44089209850063e-16, -2.22044604925031e-16, -1.52655665885959e-16, 
-4.44089209850063e-16, -1.38777878078145e-17, -3.10862446895044e-15, 
3.88578058618805e-16, 4.44089209850063e-16, 4.44089209850063e-16, 
6.66133814775094e-16, 1.11022302462516e-16, 4.44089209850063e-16, 
-4.44089209850063e-16, -2.22044604925031e-16, 6.66133814775094e-16, 
0, -1.66533453693773e-16, 3.88578058618805e-16, 4.16333634234434e-16, 
-3.7470027081099e-16, 3.33066907387547e-16, 3.33066907387547e-16, 
-3.33066907387547e-16, 1.11022302462516e-16, -3.33066907387547e-16, 
-1.11022302462516e-16, -1.11022302462516e-16, -3.33066907387547e-16, 
-1.66533453693773e-16, 1.11022302462516e-15, -1.99840144432528e-15, 
-3.33066907387547e-16, 2.22044604925031e-16, 3.88578058618805e-16, 
2.22044604925031e-16, -1.11022302462516e-16, 0, -3.5527136788005e-15, 
-1.55431223447522e-15, -2.77555756156289e-17, -4.44089209850063e-16, 
2.88657986402541e-15, 1.11022302462516e-16, 0, -2.77555756156289e-17, 
0, -4.9960036108132e-16, 3.33066907387547e-16, 2.22044604925031e-15, 
2.22044604925031e-16, 2.22044604925031e-16, 4.44089209850063e-16, 
8.88178419700125e-16, 2.22044604925031e-16, 2.22044604925031e-16, 
2.88657986402541e-15, 1.11022302462516e-16, -4.44089209850063e-16, 
1.94289029309402e-16, 2.22044604925031e-16, -3.33066907387547e-16, 
-1.11022302462516e-15, -4.44089209850063e-16, 1.11022302462516e-16, 
-2.22044604925031e-16, -2.4980018054066e-16, 3.33066907387547e-16, 
3.33066907387547e-16, 4.16333634234434e-17, 4.9960036108132e-16, 
-3.33066907387547e-16, 1.99840144432528e-15, 1.11022302462516e-16, 
1.33226762955019e-15, -2.77555756156289e-16, 2.77555756156289e-16, 
4.16333634234434e-17, -6.93889390390723e-18, 1.77635683940025e-15, 
8.88178419700125e-16, -2.88657986402541e-15, 4.85722573273506e-17, 
0, 2.22044604925031e-16, 1.66533453693773e-16, 0, -3.88578058618805e-16, 
-3.33066907387547e-16, 3.88578058618805e-16, -2.22044604925031e-15, 
-2.22044604925031e-16, 2.77555756156289e-16, -2.77555756156289e-16, 
-4.44089209850063e-15, -4.44089209850063e-16, -1.11022302462516e-16, 
2.91433543964104e-16, -4.21884749357559e-15, -1.55431223447522e-15, 
-2.22044604925031e-16, 6.66133814775094e-16, 1.11022302462516e-16, 
-4.9960036108132e-16, -4.88498130835069e-15, -2.22044604925031e-16, 
-1.66533453693773e-16, 2.44249065417534e-15, -4.44089209850063e-16, 
-2.22044604925031e-15, -3.10862446895044e-15, -2.91433543964104e-16, 
0, 2.66453525910038e-15, -1.94289029309402e-16, 0, -2.77555756156289e-17, 
2.44249065417534e-15, 2.77555756156289e-16, -3.33066907387547e-16, 
4.44089209850063e-16, -1.11022302462516e-15, -2.77555756156289e-16, 
-1.99840144432528e-15, 4.16333634234434e-17, 1.66533453693773e-16, 
4.66293670342566e-15, 0, -8.88178419700125e-16, 2.22044604925031e-16, 
2.22044604925031e-16)
cat("This one works\n")
z <- arima(ts(yy), order=c(1,0,0),seasonal=list(order=c(1,0,0),period=64))
y <- yy + yd
cat("This one does not work\n")
z <- arima(ts(y), order=c(1,0,0),seasonal=list(order=c(1,0,0),period=64))

-------------------------------------------------------------------------------

Script 2:

`.Random.seed` <-
c(403L, 369L, 1859149215L, 650002671L, -1156138679L, -333493279L, 
348638433L, 1680107254L, -1147967437L, 1056020536L, -1094521534L, 
1700325529L, -1824977710L, 577131964L, -1998427685L, -1242169536L, 
769502486L, 1908648216L, -345612971L, -189169486L, 1520654973L, 
1251286583L, 1184986247L, 1520809270L, 130721409L, 2081747044L, 
838322274L, -1073522666L, 1734105781L, 1798891861L, -689123819L, 
1402317637L, 1810893968L, -1122544808L, 765763688L, 2145444833L, 
1835869127L, -1638220713L, -195877692L, 202587885L, -924414672L, 
-1411434246L, 1592567025L, 1971199300L, -1187024425L, 1355666428L, 
1371324085L, -1999237658L, -392681320L, -540015241L, -1833088931L, 
699105389L, 1214217918L, -1591115476L, 487179757L, -1645369750L, 
-1130431023L, 1896105511L, 825808615L, -1387724352L, 1299326847L, 
-1263301392L, 1388545870L, 697548208L, 870474463L, 1925710362L, 
-1575346485L, -2136088514L, 490470811L, 638071333L, -615898573L, 
-1448502606L, -922796421L, 259432056L, 693560111L, 1244085125L, 
2077678875L, 170665397L, -148519358L, -2092658155L, -1890905035L, 
371134157L, 1824812067L, -1795646328L, -2055760195L, -1120208962L, 
1838854317L, 291808880L, -781300725L, -48886090L, -2029117220L, 
1774493839L, 1419110814L, 2071972190L, -1072869184L, 1460809141L, 
918947793L, -857433847L, 1968088972L, -460964487L, -2042983634L, 
1766929764L, -1361863891L, -1552829483L, 1383153439L, -387274792L, 
-541612361L, -247836198L, 1643997801L, -682276184L, 219442898L, 
1140996763L, -1028211111L, 1170585698L, 508642094L, 1463232447L, 
678105841L, 1477538785L, 1093777723L, -753479781L, 549338945L, 
-1817039408L, 1642454146L, -1202019548L, 751919343L, -1025538517L, 
1499321340L, 173829819L, 983605834L, -400532795L, 490323468L, 
-987256278L, 1114498447L, 1305395058L, 729133679L, 1926505283L, 
-1709098197L, -566577443L, -2036404530L, 37915007L, -2003399839L, 
1024054958L, -709199025L, -102038169L, -1015634875L, 2054242857L, 
765929395L, -1684838899L, -205727008L, 693574709L, 1367196532L, 
368129930L, 54354254L, 1063413909L, -1582612685L, -611433854L, 
-1954703210L, -1562753274L, -1538158521L, 1967002500L, 1553805562L, 
-528267139L, -793686176L, 1771529003L, 1700572856L, -248725018L, 
545708505L, 478185141L, 106139117L, 237487946L, 646583820L, 617418289L, 
581582727L, -114234603L, 696029870L, -1652649768L, -1857817319L, 
399918593L, -118563888L, -1469383538L, 143439612L, 1070964316L, 
1889989607L, 2090042737L, -1869145044L, 771829870L, -725085344L, 
2035615474L, -1636156454L, -1163704345L, -1898489855L, 671652928L, 
-87935314L, -1967548372L, 639433050L, 432406710L, -1937025506L, 
-2146887326L, -1920767192L, 1690944416L, 1224461310L, -1063447358L, 
-79809923L, -553129959L, -1492846383L, 659657873L, 1801369454L, 
1056509757L, -2052449861L, -1776020006L, -1187961605L, -529862325L, 
-431514193L, -1268860862L, 196474720L, 461188284L, -1006294941L, 
-1228682422L, 1736161575L, 391407666L, 767303235L, 1451250617L, 
-1038066454L, 1646492152L, -1445880666L, -1293036021L, -827131814L, 
-1000415375L, -1547051376L, -1603545573L, 809845792L, -1173395863L, 
-1522231305L, -2062359676L, 290288778L, 1902938242L, -217111151L, 
881892700L, 442982714L, -1478873681L, 1087310946L, 1897163723L, 
269996746L, 836334036L, 1331260762L, 1582358103L, 1685085577L, 
742880863L, 599014501L, 116503132L, -435440305L, 1757396482L, 
172820487L, 1756149061L, 1050052877L, 1785323558L, 576289115L, 
-311895990L, 1527811802L, 1378319190L, 916381951L, -1543355490L, 
832398941L, -1921543061L, -1532282518L, 1338636661L, -395961840L, 
-1290632732L, -462043557L, -899700869L, 91416772L, 1074503132L, 
1591921469L, -1546506289L, 241449806L, -1272376834L, -787024656L, 
-256692026L, -1315894695L, -1939967555L, 527738211L, -608054000L, 
-1126710793L, -1082097744L, 2059585721L, -978041365L, 1114654838L, 
-456881314L, -140743478L, -1531120958L, -31117139L, -2122352151L, 
-1542724041L, 1326683556L, -25069452L, -1739027406L, -2087174993L, 
-875155939L, 793358483L, -2018728304L, 1480107234L, -326030370L, 
-1421487832L, 1163375460L, -551308445L, 1134577272L, -1019455599L, 
-1954248853L, 1267749046L, 455458642L, 1931586301L, 1573482560L, 
959846513L, 2132027507L, -2047289854L, -1027458455L, 1068095499L, 
1346544606L, -1400048976L, -58000345L, 16227338L, -566955140L, 
25117817L, 616740919L, 1173074949L, 616088317L, -1788370135L, 
-343494398L, -1168125264L, 89904753L, 1400001712L, -760272004L, 
-338361192L, 554638886L, -1878616283L, 289634244L, 772056301L, 
523682450L, 1814129568L, -1193802480L, -1935034759L, 1019562616L, 
1007792790L, -239642130L, -1513377500L, 824036702L, 1850965535L, 
1474809992L, -146417711L, 1479289157L, 1993095810L, -98160814L, 
1869804858L, -1038974485L, -648609758L, -1174209484L, -1946900632L, 
-1493346236L, 980776693L, -1637238148L, 865811446L, 1366544525L, 
-1624693966L, 1572236571L, -420131474L, 666941472L, 1266335420L, 
866534947L, 1621421086L, -435524703L, -1900383309L, -962565887L, 
2090200464L, -732808361L, 1080059781L, 1760034174L, 1803644294L, 
-653512996L, -1363243204L, -306219216L, 1997351813L, 329697318L, 
2142461502L, 258615427L, -2134090295L, -676743049L, 1866107224L, 
1521964024L, 1401774543L, -1802833L, -1624729217L, 615008870L, 
-167090123L, -665542801L, -1920591557L, -162847173L, 595914355L, 
-553392394L, 1432098504L, 679022481L, 1380929924L, -1015905206L, 
-1688739168L, 1110105530L, -1143993694L, -1422188389L, 1537043370L, 
-1205701479L, 1451523003L, -1183958790L, 1301048318L, 1687180286L, 
1612009428L, 1039243347L, -1125270635L, 2026019011L, -119509309L, 
1178787608L, -2091362388L, 1162790040L, -2085428275L, 1536157009L, 
-96945301L, 1194476160L, -1758907465L, 115475607L, -604362914L, 
-1636599256L, -1500789863L, -1612595849L, -430447660L, -468371L, 
-426570891L, -1786847543L, 1724150698L, 1939478474L, -2079200289L, 
2126243037L, 1616658037L, 100269563L, 319468621L, -1957951623L, 
1620559940L, -634257673L, -1000607900L, -903538951L, 1072661849L, 
-949622133L, -1284810126L, 27424543L, -1848401977L, -391508917L, 
-1886394672L, -50993104L, 609862930L, -2047635735L, 589455163L, 
2060738560L, 1762212087L, 894472779L, -913219434L, 111616625L, 
-756398570L, 2078175929L, -1740139097L, -1603803521L, 2047444674L, 
928551059L, -777005922L, 526158728L, 624967824L, 278433016L, 
60429981L, 1941244811L, 1989705731L, -377261944L, -1891190702L, 
1422279080L, -1107651264L, 1249940103L, -1743368489L, -493767608L, 
575274513L, 264292692L, 601244282L, 1613016021L, 1082457936L, 
1224580692L, -655358007L, 1626219090L, 1528245605L, 1242026370L, 
-747142590L, -705391456L, 319036185L, 2011226042L, -1515601829L, 
-992154181L, -906614391L, 1892363099L, 948972506L, -233916621L, 
-1249541453L, 856188793L, 1087417774L, -1930058241L, -630825559L, 
1860422305L, 1875049161L, 2131290651L, 562925743L, -2067864095L, 
-1376837819L, -1290842131L, 55562271L, 1967955711L, 407642389L, 
-2109698402L, 342812886L, -1823293782L, 1391574094L, -1055591672L, 
-565832729L, 1495079128L, 1310275845L, 497092079L, 537812174L, 
-76268788L, 481471659L, -2135672976L, -1538876087L, 1241322652L, 
-1164553039L, 915436237L, 418986164L, 484250043L, 204921142L, 
131145385L, 155082825L, 1119213127L, -453360471L, 2018628712L, 
-1029754838L, -122231574L, 1053856498L, 1845040262L, -6951846L, 
914289787L, -1786776057L, -1872194277L, 1709797381L, 925812329L, 
1356101248L, 1409522192L, -1026609651L, 1704197761L, 1074440733L, 
-529449135L, -639570351L, -408842432L, -1181346781L, -2009794703L, 
-1509768465L, 1897224929L, 2144021488L, -1376273932L, 1070194812L, 
-1345877245L, -1610569523L, -2137648662L, -1573613006L, 551991341L, 
-1641118430L, -256664029L, 1925701819L, 1778069747L, -386394202L, 
-1935180804L, -1110900999L, 843001770L, 1425940058L, -2751965L, 
596199507L, -506661786L, -177783748L, 1737272841L, -613888536L, 
-2006777802L, 1455235754L, 536803098L, -2101678583L, 760958566L, 
15591537L, -1563420228L, -2091954506L, -423114129L, -253235046L, 
1987678003L, 2023931872L, 1295525269L, -1352111235L, 1320671854L, 
1397189586L, -596012400L, 1543399642L, 913941794L, -765611679L, 
-1780032952L, -334020610L, -1030641569L, 734316466L, 1645119731L, 
909900938L, 1519592771L, -1594818903L, 1063253467L, -738684810L, 
2094413779L, -927367444L, 836978449L, -2046126196L, 1739505080L, 
453830794L, -384398987L, -2087208534L, -79918888L)
for(runNumber in 1:100) {
	cat("Run ", runNumber, "\n", sep="")
	y <- rnorm(1808)
	z <- arima(ts(y), order=c(1,0,0),seasonal=list(order=c(1,0,0),period=64))
}


--please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status = 
 major = 2
 minor = 8.1
 year = 2008
 month = 12
 day = 22
 svn rev = 47281
 language = R
 version.string = R version 2.8.1 (2008-12-22)

Locale:
C

Search Path:
 .GlobalEnv, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, package:methods, Autoloads, package:base


From osklyar at maninvestments.com  Thu Jan 29 16:09:07 2009
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Thu, 29 Jan 2009 15:09:07 -0000
Subject: [Rd] after some time R stopped returning from Rmpi calls
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE43047DF5F8@mildnpexmb01.maninvestments.ad.man.com>

Hi,

this is not exactly a developer question, but maybe you have noticed
similar behaviour before. For quite some time R and Rmpi were working
perfectly for me until one day they just stopped doing so without any
changes in the configs. R still spawns jobs as requested, and if they
are small they run through and return, but as soon as their duration is
over 5s or so the spawned processes go to sleep and never return to the
head node. Below is the top of one of the slave nodes with the spawned
jobs, as you see their status is sleeping. It looks like a communication
problem between the master and the slave nodes, but this behaviour *is*
user specific: exactly the same script will work for some users and will
just lead to hanging for others.

Rmpi is installed with a default R CMD INSTALL without additional
arguments. LD_LIBRARY_PATH is set and the whole setup *was* working with
the same config. 

Has anybody experienced similar problems with Rmpi and LAM before?

Thank you,
Oleg

RHEL 5 x86_64, 16core Opteron

LAM 7.1.4/MPI 2 C++/ROMIO - Indiana University

It is quite a dated version of R I running now, but recent Rmpi.

> sessionInfo()
R version 2.9.0 Under development (unstable) (2008-09-30 r46585) 
x86_64-unknown-linux-gnu 

locale:
C

attached base packages:
[1] stats     graphics  utils     datasets  grDevices methods   base


other attached packages:
[1] Rmpi_0.5-5

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND

 7699 osklyar   16   0 19128 1448 1000 S    0  0.0   0:00.02 lamd

 7807 osklyar   16   0  8652  992  824 S    0  0.0   0:00.01 Rslaves.sh

 7808 osklyar   16   0  8656  992  824 S    0  0.0   0:00.01 Rslaves.sh

 7809 osklyar   16   0  8652  992  824 S    0  0.0   0:00.00 Rslaves.sh

 7810 osklyar   17   0  8656  992  824 S    0  0.0   0:00.01 Rslaves.sh

 7811 osklyar   18   0  8656  992  824 S    0  0.0   0:00.02 Rslaves.sh

 7812 osklyar   18   0  8656  992  824 S    0  0.0   0:00.02 Rslaves.sh

 7813 osklyar   18   0  8656  992  824 S    0  0.0   0:00.02 Rslaves.sh

 7814 osklyar   18   0  8656  992  824 S    0  0.0   0:00.02 Rslaves.sh

 7815 osklyar   15   0  165m  60m 4568 S    0  0.2   0:03.66 R

 7816 osklyar   16   0  161m  56m 4568 S    0  0.2   0:03.51 R

 7817 osklyar   15   0  161m  56m 4584 S    0  0.2   0:03.82 R

 7818 osklyar   16   0  161m  56m 4568 S    0  0.2   0:03.31 R

 7819 osklyar   16   0  165m  61m 4568 S    0  0.2   0:03.59 R

 7820 osklyar   15   0  162m  58m 4568 S    0  0.2   0:03.43 R

 7821 osklyar   16   0  162m  58m 4568 S    0  0.2   0:03.26 R

 7824 osklyar   16   0  161m  56m 4568 S    0  0.2   0:03.49 R

 7973 osklyar   15   0 87208 1880 1140 S    0  0.0   0:00.00 sshd

 7974 osklyar   15   0 72332 1716 1276 S    0  0.0   0:00.01 bash


Dr Oleg Sklyar
Research Technologist
AHL / Man Investments Ltd
+44 (0)20 7144 3107
osklyar at maninvestments.com

**********************************************************************
Please consider the environment before printing this email or its attachments.
The contents of this email are for the named addressees ...{{dropped:19}}


From brechbuehler at gmail.com  Thu Jan 29 16:35:04 2009
From: brechbuehler at gmail.com (brechbuehler at gmail.com)
Date: Thu, 29 Jan 2009 16:35:04 +0100 (CET)
Subject: [Rd] Segfault when mistakenly calling [.data.frame (PR#13487)
Message-ID: <20090129153504.D5170282C76F@mail.pubhealth.ku.dk>

Full_Name: Christian Brechbuehler
Version: 2.7.2, 2.8.1
OS: linux-gnu
Submission from: (NULL) (24.128.51.18)


Calling [.data.frame on an object that's not a data frame, specifically 1:10,
causes segmentation fault.

Context
=======
We can subscript with a number of different notations:

   > (1:10)[3]
   [1] 3
   > do.call(get("[",pos="package:base"),list(1:10,3))
   [1] 3
   > do.call(get("[.numeric_version",pos="package:base"),list(1:10,3))
   [1] 3

Problem
=======
If we mistakenly believe the object is a data frame (as we did in a much more
complicated real situation), this happens: 

   > do.call(get("[.data.frame",pos="package:base"),list(1:10,3))
   Error in NextMethod("[") : 
     no calling generic was found: was a method called directly?

    *** caught segfault ***
   address (nil), cause 'unknown'

   Process R:2 segmentation fault (core dumped) at Thu Jan 29 09:26:29 2009

The Error message is appropriate.  But the segmentation fault is unexpected.


Versions
========
I reproduced the problem on R 2.7.2 and 2.8.1.  Details:

> version
               _                                          
platform       x86_64-unknown-linux-gnu                   
arch           x86_64                                     
os             linux-gnu                                  
system         x86_64, linux-gnu                          
status         Patched                                    
major          2                                          
minor          7.2                                        
year           2008                                       
month          09                                         
day            20                                         
svn rev        46776                                      
language       R                                          
version.string R version 2.7.2 Patched (2008-09-20 r46776)

==========================================================

> version
               _                                          
platform       x86_64-unknown-linux-gnu                   
arch           x86_64                                     
os             linux-gnu                                  
system         x86_64, linux-gnu                          
status         Patched                                    
major          2                                          
minor          8.1                                        
year           2009                                       
month          01                                         
day            26                                         
svn rev        47743                                      
language       R                                          
version.string R version 2.8.1 Patched (2009-01-26 r47743)


From twoutopias at gmail.com  Wed Jan 28 23:15:18 2009
From: twoutopias at gmail.com (twoutopias at gmail.com)
Date: Wed, 28 Jan 2009 23:15:18 +0100 (CET)
Subject: [Rd] length of POSIXlt object (PR#13482)
Message-ID: <20090128221518.E0F0F282EFF0@mail.pubhealth.ku.dk>

The length() of a POSIXlt object is given as 9 regardless of the actual
length. For example:

> make.date.time
function (year=c(2006,2006),month=c(8,8),day=2:5,hour=13,minute=45)
{# convert year, etc., into POSIXlt object
#
d=as.character(make.date(year,month,day))
t=paste(hour,minute,sep=":")
as.POSIXlt(paste(d,t))
}
> t=make.date.time()
> t
[1] "2006-08-02 13:45:00" "2006-08-03 13:45:00" "2006-08-04 13:45:00"
[4] "2006-08-05 13:45:00"
> length(t)
[1] 9
> t[1]
[1] "2006-08-02 13:45:00"
> length(t[1])
[1] 9



-- 
blog.sethroberts.net
www.shangriladiet.com
boards.shangriladiet.com
cell phone 510 418 7753 (Berkeley)

	[[alternative HTML version deleted]]


From mauro.andreolini at unimore.it  Thu Jan 29 19:51:31 2009
From: mauro.andreolini at unimore.it (Mauro Andreolini)
Date: Thu, 29 Jan 2009 19:51:31 +0100
Subject: [Rd] Arima_Like() and NaN - a (possible) problem, a patch, and RFC
Message-ID: <1233255091.6200.20.camel@romanella>

Hi,

recently I have started working with R (v. 2.7.2), and I have been using
R's internal ARIMA_Like() function (from the "stats" package) to
estimate some ARIMA models. In particular, I use ARIMA_Like() in a
function "fn()" that I feed to the optim() method; the main goal is to
find optimal ARIMA prediction models for some time series.
The ARIMA_Like() function returns a three elements vector; under some
conditions (that I could not yet spot), the second element of this
vector is a 'NaN'. Since fn() is using this value to compute its return
value, it suddenly returns 'NaN' and optim() warns me about it:

Error in optim(init[mask], armafn, method = "BFGS", hessian = TRUE,
control = optim.control,  :
  non-finite finite-difference value [2] 

I looked into the code (file src/arima.c of the stats package) and
noticed that this second element is a sum of logarithmic terms, computed
through the following snippet of code:

gain = M[0];
for (j = 0; j < d; j++) gain += delta[j] * M[r + j];
if(gain < 1e4) {
    nu++;
    ssq += resid * resid / gain;
    sumlog += log(gain);
}

Here, sumlog is the second element of the resulting vector. However, the
"if(gain < 1e4) {" check does not explicitly check against negative
values of the gain variable. Indeed, whenever the gain variable assumes
a negative value, the statement "sumlog += log(gain);" evalutes to NaN.
I changed the check as follows:

if (gain > 0 && gain < 1e4) {

This avoids computation of logarithms on negative values. I recompiled
and reinstalled R, and the sumlog value is no more 'NaN'. As a result,
optim() never warns about the non-finite finite-difference value.

Here is my question: does this modification make any sense? Have I
missed something big? To me, it looks reasonable to avoid computing
log(x) when x < 0, but maybe returning 'NaN' may have its purposes.
Could someone please clarify this? I searched the mailing list archives
and I could not spot anything even close to this argument, which may be
an indication that I am doing something really wrong, but I would like
to understand why.

Best regards
Mauro Andreolini


From jeff.a.ryan at gmail.com  Thu Jan 29 21:27:17 2009
From: jeff.a.ryan at gmail.com (Jeff Ryan)
Date: Thu, 29 Jan 2009 14:27:17 -0600
Subject: [Rd] length of POSIXlt object (PR#13482)
In-Reply-To: <20090128221518.E0F0F282EFF0@mail.pubhealth.ku.dk>
References: <20090128221518.E0F0F282EFF0@mail.pubhealth.ku.dk>
Message-ID: <e8e755250901291227y120e3b6euea68f94fcb7f57be@mail.gmail.com>

Read the docs. POSIXlt is a list of 9 elements. Each element length is
what you think it should be returning.  That is not correct.

?POSIXlt

Details:

     There are two basic classes of date/times.  Class '"POSIXct"'
     represents the (signed) number of seconds since the beginning of
     1970 as a numeric vector.  Class '"POSIXlt"' is a named list of
     vectors representing

> unclass(as.POSIXlt(as.POSIXlt('2007-01-01')+1:11))
$sec
 [1]  1  2  3  4  5  6  7  8  9 10 11

$min
 [1] 0 0 0 0 0 0 0 0 0 0 0

$hour
 [1] 0 0 0 0 0 0 0 0 0 0 0

$mday
 [1] 1 1 1 1 1 1 1 1 1 1 1

$mon
 [1] 0 0 0 0 0 0 0 0 0 0 0

$year
 [1] 107 107 107 107 107 107 107 107 107 107 107

$wday
 [1] 1 1 1 1 1 1 1 1 1 1 1

$yday
 [1] 0 0 0 0 0 0 0 0 0 0 0

$isdst
 [1] 0 0 0 0 0 0 0 0 0 0 0

attr(,"tzone")
[1] ""    "CST" "CDT"


Jeff


On Wed, Jan 28, 2009 at 4:15 PM,  <twoutopias at gmail.com> wrote:
> The length() of a POSIXlt object is given as 9 regardless of the actual
> length. For example:
>
>> make.date.time
> function (year=c(2006,2006),month=c(8,8),day=2:5,hour=13,minute=45)
> {# convert year, etc., into POSIXlt object
> #
> d=as.character(make.date(year,month,day))
> t=paste(hour,minute,sep=":")
> as.POSIXlt(paste(d,t))
> }
>> t=make.date.time()
>> t
> [1] "2006-08-02 13:45:00" "2006-08-03 13:45:00" "2006-08-04 13:45:00"
> [4] "2006-08-05 13:45:00"
>> length(t)
> [1] 9
>> t[1]
> [1] "2006-08-02 13:45:00"
>> length(t[1])
> [1] 9
>
>
>
> --
> blog.sethroberts.net
> www.shangriladiet.com
> boards.shangriladiet.com
> cell phone 510 418 7753 (Berkeley)
>
>        [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Jeffrey Ryan
jeffrey.ryan at insightalgo.com

ia: insight algorithmics
www.insightalgo.com


From ripley at stats.ox.ac.uk  Thu Jan 29 22:44:40 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 29 Jan 2009 21:44:40 +0000 (GMT)
Subject: [Rd] (PR#13487) Segfault when mistakenly calling [.data.frame
In-Reply-To: <20090129153504.D5170282C76F@mail.pubhealth.ku.dk>
References: <20090129153504.D5170282C76F@mail.pubhealth.ku.dk>
Message-ID: <alpine.OSX.1.00.0901292124030.13855@tystie.local>

What did your actual application do?  This seems a very strange thing 
to do, and the segfault is in trying to construct the traceback.

Only by using do.call on the object (and not even by name) do I get 
this error.  E.g.

> `[.data.frame`(1:10, 3)
Error in NextMethod("[") : object not specified
> do.call("[.data.frame", list(1:10, 3))
Error in NextMethod("[") : object not specified

are fine.

Obviously it would be nice to fix this, but I'd like to understand the 
actual circumstances: there is more to it than the subject line.

On Thu, 29 Jan 2009, brechbuehler at gmail.com wrote:

> Full_Name: Christian Brechbuehler
> Version: 2.7.2, 2.8.1
> OS: linux-gnu
> Submission from: (NULL) (24.128.51.18)
>
>
> Calling [.data.frame on an object that's not a data frame, specifically 1:10,
> causes segmentation fault.
>
> Context
> =======
> We can subscript with a number of different notations:
>
>   > (1:10)[3]
>   [1] 3
>   > do.call(get("[",pos="package:base"),list(1:10,3))
>   [1] 3
>   > do.call(get("[.numeric_version",pos="package:base"),list(1:10,3))
>   [1] 3
>
> Problem
> =======
> If we mistakenly believe the object is a data frame (as we did in a much more
> complicated real situation), this happens:
>
>   > do.call(get("[.data.frame",pos="package:base"),list(1:10,3))
>   Error in NextMethod("[") :
>     no calling generic was found: was a method called directly?
>
>    *** caught segfault ***
>   address (nil), cause 'unknown'
>
>   Process R:2 segmentation fault (core dumped) at Thu Jan 29 09:26:29 2009
>
> The Error message is appropriate.  But the segmentation fault is unexpected.
>
>
> Versions
> ========
> I reproduced the problem on R 2.7.2 and 2.8.1.  Details:
>
>> version
>               _
> platform       x86_64-unknown-linux-gnu
> arch           x86_64
> os             linux-gnu
> system         x86_64, linux-gnu
> status         Patched
> major          2
> minor          7.2
> year           2008
> month          09
> day            20
> svn rev        46776
> language       R
> version.string R version 2.7.2 Patched (2008-09-20 r46776)
>
> ==========================================================
>
>> version
>               _
> platform       x86_64-unknown-linux-gnu
> arch           x86_64
> os             linux-gnu
> system         x86_64, linux-gnu
> status         Patched
> major          2
> minor          8.1
> year           2009
> month          01
> day            26
> svn rev        47743
> language       R
> version.string R version 2.8.1 Patched (2009-01-26 r47743)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ncrookston at fs.fed.us  Thu Jan 29 23:22:34 2009
From: ncrookston at fs.fed.us (Nicholas L Crookston)
Date: Thu, 29 Jan 2009 14:22:34 -0800
Subject: [Rd] In Rd: \describe \itemize and \item
Message-ID: <OFF6F98009.CE8A1170-ON8825754D.0075E349-8825754D.007AE647@fs.fed.us>

I rebuilt a test version of my yaImpute package using Uwe Ligges' windows 
build service. 
I got this reply: Check result: OK
R version 2.9.0 Under development (unstable) (2009-01-27 r47756)

Here is the issue: I have the following construct in help files (this 
example relates to "data"):

\format{
  A data frame with 847 rows and 29 columns: \cr\cr
  Ground based measurements of trees (Y-variables):
  \itemize{
     \item{TopHt}{Height of tallest trees (ft)}
     \item{LnVolL}{Log of the volume \eqn{(ft^3/acre)} of western larch}
 ...... many lines deleted ......
     \item{LnVolPP}{Log of the volume \eqn{(ft^3/acre)} of ponderosa pine}
     \item{CCover}{Canopy cover (percent)}
  }
  Geographic Location, Slope, and Aspect (X-variables):
  \itemize{
    \item{utmx}{UTM easting at plot center}
    \item{utmy}{UTM northing at plot center}
...... many lines deleted ......
    \item{elevm}{Mean elevation (ft) above sea level over plot}
    \item{slpsinaspm}{Mean of slope (proportion) times the sine of aspect}
  }
...... many lines deleted ......
}

What I get in the help file is:
=========================
Format  <this word is set in bold, correctly>
A data frame with 847 rows and 29 columns: 

Ground based measurements of trees (Y-variables): 

   TopHt 
      Height of tallest trees (ft) 
   LnVolL 
      Log of the volume (ft^3/acre) of western larch 
========================= ......and so on........
[I've inserted 3 spaces to mimic tabs in this illustration]

I would expect (and I used to get) something like this:
=========================
Ground based measurements of trees (Y-variables): 

 <bullet here>  TopHt   Height of tallest trees (ft) 
 <bullet here>  LnVolL  Log of the volume (ft^3/acre) of western larch 
=========================

Note that in version 2.6.2 (under SuSE 10.3) this code fails the check, 
but my original code worked. 

The entire issue came up in reference to Kurt Hornik's recent mail that we 
get our help files ready for the next release of R. 

My current production help files work, but do not comply with the 
instructions as I understand them and fail the check on the development 
versions. I'm not sure I have fixed them correctly, but I'm trying!

Suggestions?  Comments?

Thanks, Nick.

PS: If this Email is not simple text, please let me know.

Nicholas L. Crookston, Operations Research Analyst
Rocky Mountain Research Station
USDA Forest Service
1221 South Main, Moscow, ID 83843
Office: (208) 883-2317, FAX: (208) 883-2318
EMail: ncrookston at fs.fed.us


From murdoch at stats.uwo.ca  Fri Jan 30 04:14:11 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 29 Jan 2009 22:14:11 -0500
Subject: [Rd] In Rd: \describe \itemize and \item
In-Reply-To: <OFF6F98009.CE8A1170-ON8825754D.0075E349-8825754D.007AE647@fs.fed.us>
References: <OFF6F98009.CE8A1170-ON8825754D.0075E349-8825754D.007AE647@fs.fed.us>
Message-ID: <49827083.1000604@stats.uwo.ca>

On 29/01/2009 5:22 PM, Nicholas L Crookston wrote:
> I rebuilt a test version of my yaImpute package using Uwe Ligges' windows 
> build service. 
> I got this reply: Check result: OK
> R version 2.9.0 Under development (unstable) (2009-01-27 r47756)
> 
> Here is the issue: I have the following construct in help files (this 
> example relates to "data"):
> 
> \format{
>   A data frame with 847 rows and 29 columns: \cr\cr
>   Ground based measurements of trees (Y-variables):
>   \itemize{
>      \item{TopHt}{Height of tallest trees (ft)}
>      \item{LnVolL}{Log of the volume \eqn{(ft^3/acre)} of western larch}
>  ...... many lines deleted ......
>      \item{LnVolPP}{Log of the volume \eqn{(ft^3/acre)} of ponderosa pine}
>      \item{CCover}{Canopy cover (percent)}
>   }
>   Geographic Location, Slope, and Aspect (X-variables):
>   \itemize{
>     \item{utmx}{UTM easting at plot center}
>     \item{utmy}{UTM northing at plot center}
> ...... many lines deleted ......
>     \item{elevm}{Mean elevation (ft) above sea level over plot}
>     \item{slpsinaspm}{Mean of slope (proportion) times the sine of aspect}
>   }
> ...... many lines deleted ......
> }
> 
> What I get in the help file is:
> =========================
> Format  <this word is set in bold, correctly>
> A data frame with 847 rows and 29 columns: 
> 
> Ground based measurements of trees (Y-variables): 
> 
>    TopHt 
>       Height of tallest trees (ft) 
>    LnVolL 
>       Log of the volume (ft^3/acre) of western larch 
> ========================= ......and so on........
> [I've inserted 3 spaces to mimic tabs in this illustration]
> 
> I would expect (and I used to get) something like this:
> =========================
> Ground based measurements of trees (Y-variables): 
> 
>  <bullet here>  TopHt   Height of tallest trees (ft) 
>  <bullet here>  LnVolL  Log of the volume (ft^3/acre) of western larch 
> =========================
> 
> Note that in version 2.6.2 (under SuSE 10.3) this code fails the check, 
> but my original code worked. 
> 
> The entire issue came up in reference to Kurt Hornik's recent mail that we 
> get our help files ready for the next release of R. 
> 
> My current production help files work, but do not comply with the 
> instructions as I understand them and fail the check on the development 
> versions. I'm not sure I have fixed them correctly, but I'm trying!
> 
> Suggestions?  Comments?

I think we need more info to comment on.  Is this file one of the ones 
in the yaImpute package on CRAN, or is it unreleased?  Is the Rd file 
available for us to look at?  Does the man page look different in 2.8.1 
from what you expect (there haven't been serious changes there), or only 
in R-devel (2.9.0)?  2.6.2 is pretty old, but I don't think any of the 
requested changes should be incompatible with it.

Duncan Murdoch

> 
> Thanks, Nick.
> 
> PS: If this Email is not simple text, please let me know.
> 
> Nicholas L. Crookston, Operations Research Analyst
> Rocky Mountain Research Station
> USDA Forest Service
> 1221 South Main, Moscow, ID 83843
> Office: (208) 883-2317, FAX: (208) 883-2318
> EMail: ncrookston at fs.fed.us
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From dkor at northwestern.edu  Fri Jan 30 04:53:43 2009
From: dkor at northwestern.edu (Daniel Kornhauser)
Date: Thu, 29 Jan 2009 21:53:43 -0600
Subject: [Rd] How to generate a xyplot with multiple panels using an empty
	data frame ?
Message-ID: <332394640901291953t42c2192bs2b7eb337c205ec49@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090129/32951a9b/attachment.pl>

From cowan.pd at gmail.com  Fri Jan 30 05:04:47 2009
From: cowan.pd at gmail.com (Peter Cowan)
Date: Thu, 29 Jan 2009 20:04:47 -0800
Subject: [Rd] How to generate a xyplot with multiple panels using an
	empty data frame ?
In-Reply-To: <332394640901291953t42c2192bs2b7eb337c205ec49@mail.gmail.com>
References: <332394640901291953t42c2192bs2b7eb337c205ec49@mail.gmail.com>
Message-ID: <e1fc21b0901292004l1b2163d1ra77a6c16858fd240@mail.gmail.com>

On Thu, Jan 29, 2009 at 7:53 PM, Daniel Kornhauser
<dkor at northwestern.edu> wrote:
> Hi:
>
> I am coding some interactive interface using an xyplot from lattice.
> When a user clicks on a panel of the xyplot, a simulation is executed and
> the resulting data is plotted on the corresponding panel.
> The problem is that I start with an empty data frame and only fill it as the
> user request data from simulations.
> And, I have found it impossible to create a conditional plot that contains
> panels using an empty data frame.
>
> For example I want:
>
> library(lattice)
> e = data.frame("a", "b", "c", "d")
> xyplot(X.a. ~ X.b. | X.c. + X.d., data = e, xlim = c(c(50,60),c(60,70)),
> ylim = c(c(10,20),c(20,30)), drop.unused.levels=FALSE,layout = c(2,2))
>
> to create a empty xyplot that would look like:
>
>       50             60           70
>        ----------------------------
>   10   |             |             |
>        |             |             |
>        |             |             |
>   20   ----------------------------
>        |             |             |
>        |             |             |
>   30   |             |             |
>        -----------------------------
>
> but it doesn't create 4 panels it only creates a single panel:
>
>        50    60      70
>        ---------------
>   10   |              |
>   20   |              |
>   30   |              |
>        ----------------
>
> I am a novice in R so I hope this is not a question that is too easy for the
> r-devel list.

I think you've directed your email to the wrong list.  R-devel, is
primarily targeted at people who write add-on packages (such as
lattice itself) or the R core.

Please see: <http://www.r-project.org/posting-guide.html#which_list>

This question should be directed to r-help which you can subscribe to here:

<http://www.r-project.org/mail.html>

>
>          Thanks.
>
>                    Daniel.
>
> PS: I got around this problem by creating "dummy" data frames containing
> data with the sole purpose of indicating xyplot the data rages.
>       It works well, but I consider it a hack.

If it that works, why do you consider it a hack?  There's probably a
more elegant way, but I would probably just make data frames, filled
with NA.

HTH

Peter


From Jose at erini.ac.uk  Fri Jan 30 10:29:19 2009
From: Jose at erini.ac.uk (Jose Iparraguirre D'Elia)
Date: Fri, 30 Jan 2009 09:29:19 -0000
Subject: [Rd] "Panel Data Unit Root tests"
Message-ID: <C9328F0EEDC3BC439FDABD12060E91098E153F@erini1.ERINI.local>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090130/3085a0ad/attachment.pl>

From pburns at pburns.seanet.com  Fri Jan 30 11:14:28 2009
From: pburns at pburns.seanet.com (Patrick Burns)
Date: Fri, 30 Jan 2009 10:14:28 +0000
Subject: [Rd] length of POSIXlt object (PR#13482)
In-Reply-To: <20090128221518.E0F0F282EFF0@mail.pubhealth.ku.dk>
References: <20090128221518.E0F0F282EFF0@mail.pubhealth.ku.dk>
Message-ID: <4982D304.1000309@pburns.seanet.com>

'The R Inferno' page 93 and page 99.


Patrick Burns
patrick at burns-stat.com
+44 (0)20 8525 0696
http://www.burns-stat.com
(home of "The R Inferno" and "A Guide for the Unwilling S User")

twoutopias at gmail.com wrote:
> The length() of a POSIXlt object is given as 9 regardless of the actual
> length. For example:
>
>   
>> make.date.time
>>     
> function (year=c(2006,2006),month=c(8,8),day=2:5,hour=13,minute=45)
> {# convert year, etc., into POSIXlt object
> #
> d=as.character(make.date(year,month,day))
> t=paste(hour,minute,sep=":")
> as.POSIXlt(paste(d,t))
> }
>   
>> t=make.date.time()
>> t
>>     
> [1] "2006-08-02 13:45:00" "2006-08-03 13:45:00" "2006-08-04 13:45:00"
> [4] "2006-08-05 13:45:00"
>   
>> length(t)
>>     
> [1] 9
>   
>> t[1]
>>     
> [1] "2006-08-02 13:45:00"
>   
>> length(t[1])
>>     
> [1] 9
>
>
>
>


From Bernhard_Pfaff at fra.invesco.com  Fri Jan 30 12:12:34 2009
From: Bernhard_Pfaff at fra.invesco.com (Pfaff, Bernhard Dr.)
Date: Fri, 30 Jan 2009 11:12:34 -0000
Subject: [Rd] Methods not loaded in R-Devel vs 2.8.1
Message-ID: <B89F0CE41D45644A97CCC93DF548C1C3176BFBEF@GBHENXMB02.corp.amvescap.net>

Dear list-member,

I am currently developing a package with S4 classes. The NAMESPACE and DESCRIPTION is printed below. Within this package I have set a method "residuals" for two classes. In version 2.8.1 these two are reported whereas in R-Devel (2009-01-28 r47766). What have I missed? What has changed and how can I rectify the issue? Your help and pointers are welcome.


For 2.8.1:
**********

> library(gogarch)
Loading required package: fGarch
Loading required package: timeDate
Loading required package: timeSeries
Loading required package: fBasics
Loading required package: MASS
Warning message:
package 'gogarch' was built under R version 2.9.0 
> showMethods("residuals")
Function: residuals (package stats)
object="ANY"
object="fGARCH"
object="Goestml"
object="GoGARCH"

> getMethod("residuals", "GoGARCH")
Method Definition:

function (object, ...) 
{
    .local <- function (object, standardize = FALSE) 
    {
        m <- ncol(object at X)
        n <- nrow(object at X)
        resl <- lapply(object at models, residuals, standardize = standardize)
        resm <- matrix(c(unlist(resl)), ncol = m, nrow = n)
        ynames <- paste("y", 1:2, sep = "")
        colnames(resm) <- ynames
        rownames(resm) <- rownames(object at X)
        return(resm)
    }
    .local(object, ...)
}
<environment: namespace:gogarch>

Signatures:
        object   
target  "GoGARCH"
defined "GoGARCH"
> sessionInfo() 
R version 2.8.1 (2008-12-22) 
i386-pc-mingw32 

locale:
LC_COLLATE=German_Germany.1252;LC_CTYPE=German_Germany.1252;LC_MONETARY=German_Germany.1252;LC_NUMERIC=C;LC_TIME=German_Germany.1252

attached base packages:
[1] stats     graphics  datasets  utils     grDevices methods   base     

other attached packages:
[1] gogarch_0.2-8     fGarch_280.75     fBasics_280.74    MASS_7.2-44      
[5] timeSeries_290.79 timeDate_290.81   fortunes_1.3-6   
> 


For R-Devel:
************
> library(gogarch)
Loading required package: fGarch
Loading required package: timeDate
Loading required package: timeSeries
Loading required package: fBasics
Loading required package: MASS
> showMethods("residuals")
Function: residuals (package stats)
object="ANY"
object="fGARCH"

> getMethod("residuals", "GoGARCH")
Error in getMethod("residuals", "GoGARCH") : 
  No method found for function "residuals" and signature GoGARCH
> sessionInfo()
R version 2.9.0 Under development (unstable) (2009-01-28 r47766) 
i386-pc-mingw32 

locale:
LC_COLLATE=German_Germany.1252;LC_CTYPE=German_Germany.1252;LC_MONETARY=German_Germany.1252;LC_NUMERIC=C;LC_TIME=German_Germany.1252

attached base packages:
[1] stats     graphics  grDevices datasets  utils     methods   base     

other attached packages:
[1] gogarch_0.2-8     fGarch_280.75     fBasics_280.74    MASS_7.2-44      
[5] timeSeries_290.79 timeDate_290.81   fortunes_1.3-6   

loaded via a namespace (and not attached):
[1] grid_2.9.0      lattice_0.17-17 nlme_3.1-89     urca_1.2-2     
[5] vars_1.4-4     
> 


DESCRIPTION:
************
Package: gogarch
Version: 0.2-8
Type: Package
Title: Generalized Orthogonal GARCH (GO-GARCH) models
Date: 2009-01-30
Author: Bernhard Pfaff
Maintainer: Bernhard Pfaff <bernhard at pfaffikus.de>
Depends: R (>= 2.7.0), stats, methods, fGarch
Suggests: vars
Description: Implementation of the GO-GARCH model class. 
License: GPL (>= 2)
LazyLoad: yes
LazyLoad: yes

NAMESPACE:
**********
## Import packages
import(methods)

## Import functions
importFrom(stats, coef, logLik, residuals)

## Classes       
exportClasses(Goestml, GoGARCH, Goinit, Orthom)

## Methods
exportMethods(angles, cvar, ccor, ccov, coef, converged, goest, logLik, M, print, show, t, residuals)

## Functions
export(gogarch, goinit, gollh, gotheta, Rd2, UprodR, unvech, validOrthomObject, validGoinitObject)



Dr. Bernhard Pfaff
Director
Invesco Quantitative Strategies International

Invesco Asset Management Deutschland GmbH
Bleichstrasse 60-62
D-60313 Frankfurt am Main

Tel: +49 (0)69 29807 230
Fax: +49 (0)69 29807 178
www.institutional.invesco.com
Email: bernhard_pfaff at fra.invesco.com

Gesch?ftsf?hrer: Karl Georg Bayer, Bernhard Langer, Dr. Jens Langewand, Alexander Lehmann, Christian Puschmann
Handelsregister: Frankfurt am Main, HRB 28469
Sitz der Gesellschaft: Frankfurt am Main
 
*****************************************************************
Confidentiality Note: The information contained in this ...{{dropped:10}}


From Bernhard_Pfaff at fra.invesco.com  Fri Jan 30 12:46:56 2009
From: Bernhard_Pfaff at fra.invesco.com (Pfaff, Bernhard Dr.)
Date: Fri, 30 Jan 2009 11:46:56 -0000
Subject: [Rd] Methods not loaded in R-Devel vs 2.8.1
In-Reply-To: <B89F0CE41D45644A97CCC93DF548C1C3176BFBEF@GBHENXMB02.corp.amvescap.net>
References: <B89F0CE41D45644A97CCC93DF548C1C3176BFBEF@GBHENXMB02.corp.amvescap.net>
Message-ID: <B89F0CE41D45644A97CCC93DF548C1C3176BFC45@GBHENXMB02.corp.amvescap.net>

Sorry for bothering the list one more time. When I run the code with RGui.exe the methods are shown in both versions of R and everything is fine. However, there is a difference whence the showMethods("residuals") is invoked via Rterm.exe. Here, neither under 2.8.1 nor R-Devel are the methods reported for "GoGARCH" and "Goestml". I have the following in my .emacs:

(setq inferior-R-program-name "Q:/Shared/Applications/R/R-2.8.1/bin/Rterm.exe")
(setq inferior-R-args "--internet2")
(setq ess-ask-for-ess-directory nil)

and the result is the same:

> library(gogarch)
Loading required package: fGarch
Loading required package: timeDate
Loading required package: timeSeries
Loading required package: fBasics
Loading required package: MASS
Warning message:
package 'gogarch' was built under R version 2.9.0 
> showMethods("residuals")
Function: residuals (package stats)
object="ANY"
object="fGARCH"

> sessionInfo()
R version 2.8.1 (2008-12-22) 
i386-pc-mingw32 

locale:
LC_COLLATE=German_Germany.1252;LC_CTYPE=German_Germany.1252;LC_MONETARY=German_Germany.1252;LC_NUMERIC=C;LC_TIME=German_Germany.1252

attached base packages:
[1] stats     graphics  datasets  utils     grDevices methods   base     

other attached packages:
[1] gogarch_0.2-9     fGarch_280.75     fBasics_280.74    MASS_7.2-44      
[5] timeSeries_290.79 timeDate_290.81   fortunes_1.3-6   

loaded via a namespace (and not attached):
[1] grid_2.8.1      lattice_0.17-17 nlme_3.1-89     urca_1.2-2     
[5] vars_1.4-4     
> getMethod("residuals", "GoGARCH")
Error in getMethod("residuals", "GoGARCH") : 
  No method found for function "residuals" and signature GoGARCH
> 

So now my question is rather about the difference between RGui.exe and Rterm.exe with respect to the method map.

Best,
Bernhard



Dr. Bernhard Pfaff
Director
Invesco Quantitative Strategies International

Invesco Asset Management Deutschland GmbH
Bleichstrasse 60-62
D-60313 Frankfurt am Main

Tel: +49 (0)69 29807 230
Fax: +49 (0)69 29807 178
www.institutional.invesco.com
Email: bernhard_pfaff at fra.invesco.com

Gesch?ftsf?hrer: Karl Georg Bayer, Bernhard Langer, Dr. Jens Langewand, Alexander Lehmann, Christian Puschmann
Handelsregister: Frankfurt am Main, HRB 28469
Sitz der Gesellschaft: Frankfurt am Main
  

>-----Urspr?ngliche Nachricht-----
>Von: r-devel-bounces at r-project.org 
>[mailto:r-devel-bounces at r-project.org] Im Auftrag von Pfaff, 
>Bernhard Dr.
>Gesendet: Freitag, 30. Januar 2009 12:13
>An: r-devel at r-project.org
>Betreff: [Rd] Methods not loaded in R-Devel vs 2.8.1
>
>Dear list-member,
>
>I am currently developing a package with S4 classes. The 
>NAMESPACE and DESCRIPTION is printed below. Within this 
>package I have set a method "residuals" for two classes. In 
>version 2.8.1 these two are reported whereas in R-Devel 
>(2009-01-28 r47766). What have I missed? What has changed and 
>how can I rectify the issue? Your help and pointers are welcome.
>
>
>For 2.8.1:
>**********
>
>> library(gogarch)
>Loading required package: fGarch
>Loading required package: timeDate
>Loading required package: timeSeries
>Loading required package: fBasics
>Loading required package: MASS
>Warning message:
>package 'gogarch' was built under R version 2.9.0 
>> showMethods("residuals")
>Function: residuals (package stats)
>object="ANY"
>object="fGARCH"
>object="Goestml"
>object="GoGARCH"
>
>> getMethod("residuals", "GoGARCH")
>Method Definition:
>
>function (object, ...) 
>{
>    .local <- function (object, standardize = FALSE) 
>    {
>        m <- ncol(object at X)
>        n <- nrow(object at X)
>        resl <- lapply(object at models, residuals, standardize = 
>standardize)
>        resm <- matrix(c(unlist(resl)), ncol = m, nrow = n)
>        ynames <- paste("y", 1:2, sep = "")
>        colnames(resm) <- ynames
>        rownames(resm) <- rownames(object at X)
>        return(resm)
>    }
>    .local(object, ...)
>}
><environment: namespace:gogarch>
>
>Signatures:
>        object   
>target  "GoGARCH"
>defined "GoGARCH"
>> sessionInfo() 
>R version 2.8.1 (2008-12-22) 
>i386-pc-mingw32 
>
>locale:
>LC_COLLATE=German_Germany.1252;LC_CTYPE=German_Germany.1252;LC_
>MONETARY=German_Germany.1252;LC_NUMERIC=C;LC_TIME=German_Germany.1252
>
>attached base packages:
>[1] stats     graphics  datasets  utils     grDevices methods  
> base     
>
>other attached packages:
>[1] gogarch_0.2-8     fGarch_280.75     fBasics_280.74    
>MASS_7.2-44      
>[5] timeSeries_290.79 timeDate_290.81   fortunes_1.3-6   
>> 
>
>
>For R-Devel:
>************
>> library(gogarch)
>Loading required package: fGarch
>Loading required package: timeDate
>Loading required package: timeSeries
>Loading required package: fBasics
>Loading required package: MASS
>> showMethods("residuals")
>Function: residuals (package stats)
>object="ANY"
>object="fGARCH"
>
>> getMethod("residuals", "GoGARCH")
>Error in getMethod("residuals", "GoGARCH") : 
>  No method found for function "residuals" and signature GoGARCH
>> sessionInfo()
>R version 2.9.0 Under development (unstable) (2009-01-28 r47766) 
>i386-pc-mingw32 
>
>locale:
>LC_COLLATE=German_Germany.1252;LC_CTYPE=German_Germany.1252;LC_
>MONETARY=German_Germany.1252;LC_NUMERIC=C;LC_TIME=German_Germany.1252
>
>attached base packages:
>[1] stats     graphics  grDevices datasets  utils     methods  
> base     
>
>other attached packages:
>[1] gogarch_0.2-8     fGarch_280.75     fBasics_280.74    
>MASS_7.2-44      
>[5] timeSeries_290.79 timeDate_290.81   fortunes_1.3-6   
>
>loaded via a namespace (and not attached):
>[1] grid_2.9.0      lattice_0.17-17 nlme_3.1-89     urca_1.2-2     
>[5] vars_1.4-4     
>> 
>
>
>DESCRIPTION:
>************
>Package: gogarch
>Version: 0.2-8
>Type: Package
>Title: Generalized Orthogonal GARCH (GO-GARCH) models
>Date: 2009-01-30
>Author: Bernhard Pfaff
>Maintainer: Bernhard Pfaff <bernhard at pfaffikus.de>
>Depends: R (>= 2.7.0), stats, methods, fGarch
>Suggests: vars
>Description: Implementation of the GO-GARCH model class. 
>License: GPL (>= 2)
>LazyLoad: yes
>LazyLoad: yes
>
>NAMESPACE:
>**********
>## Import packages
>import(methods)
>
>## Import functions
>importFrom(stats, coef, logLik, residuals)
>
>## Classes       
>exportClasses(Goestml, GoGARCH, Goinit, Orthom)
>
>## Methods
>exportMethods(angles, cvar, ccor, ccov, coef, converged, 
>goest, logLik, M, print, show, t, residuals)
>
>## Functions
>export(gogarch, goinit, gollh, gotheta, Rd2, UprodR, unvech, 
>validOrthomObject, validGoinitObject)
>
>
>
>Dr. Bernhard Pfaff
>Director
>Invesco Quantitative Strategies International
>
>Invesco Asset Management Deutschland GmbH
>Bleichstrasse 60-62
>D-60313 Frankfurt am Main
>
>Tel: +49 (0)69 29807 230
>Fax: +49 (0)69 29807 178
>www.institutional.invesco.com
>Email: bernhard_pfaff at fra.invesco.com
>
>Gesch?ftsf?hrer: Karl Georg Bayer, Bernhard Langer, Dr. Jens 
>Langewand, Alexander Lehmann, Christian Puschmann
>Handelsregister: Frankfurt am Main, HRB 28469
>Sitz der Gesellschaft: Frankfurt am Main
> 
>*****************************************************************
>Confidentiality Note: The information contained in this 
>...{{dropped:10}}
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Fri Jan 30 12:56:54 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 30 Jan 2009 11:56:54 +0000 (GMT)
Subject: [Rd] Methods not loaded in R-Devel vs 2.8.1
In-Reply-To: <B89F0CE41D45644A97CCC93DF548C1C3176BFC45@GBHENXMB02.corp.amvescap.net>
References: <B89F0CE41D45644A97CCC93DF548C1C3176BFBEF@GBHENXMB02.corp.amvescap.net>
	<B89F0CE41D45644A97CCC93DF548C1C3176BFC45@GBHENXMB02.corp.amvescap.net>
Message-ID: <alpine.OSX.1.00.0901301152390.2881@tystie.local>

I don't believe this is Rgui vs Rterm either.  More likely it is in 
the startup files for the two sessions, e.g. the library search paths.

Try using --vanilla.

On Fri, 30 Jan 2009, Pfaff, Bernhard Dr. wrote:

> Sorry for bothering the list one more time. When I run the code with RGui.exe the methods are shown in both versions of R and everything is fine. However, there is a difference whence the showMethods("residuals") is invoked via Rterm.exe. Here, neither under 2.8.1 nor R-Devel are the methods reported for "GoGARCH" and "Goestml". I have the following in my .emacs:
>
> (setq inferior-R-program-name "Q:/Shared/Applications/R/R-2.8.1/bin/Rterm.exe")
> (setq inferior-R-args "--internet2")
> (setq ess-ask-for-ess-directory nil)
>
> and the result is the same:
>
>> library(gogarch)
> Loading required package: fGarch
> Loading required package: timeDate
> Loading required package: timeSeries
> Loading required package: fBasics
> Loading required package: MASS
> Warning message:
> package 'gogarch' was built under R version 2.9.0
>> showMethods("residuals")
> Function: residuals (package stats)
> object="ANY"
> object="fGARCH"
>
>> sessionInfo()
> R version 2.8.1 (2008-12-22)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=German_Germany.1252;LC_CTYPE=German_Germany.1252;LC_MONETARY=German_Germany.1252;LC_NUMERIC=C;LC_TIME=German_Germany.1252
>
> attached base packages:
> [1] stats     graphics  datasets  utils     grDevices methods   base
>
> other attached packages:
> [1] gogarch_0.2-9     fGarch_280.75     fBasics_280.74    MASS_7.2-44
> [5] timeSeries_290.79 timeDate_290.81   fortunes_1.3-6
>
> loaded via a namespace (and not attached):
> [1] grid_2.8.1      lattice_0.17-17 nlme_3.1-89     urca_1.2-2
> [5] vars_1.4-4
>> getMethod("residuals", "GoGARCH")
> Error in getMethod("residuals", "GoGARCH") :
>  No method found for function "residuals" and signature GoGARCH
>>
>
> So now my question is rather about the difference between RGui.exe 
> and Rterm.exe with respect to the method map.
>
> Best,
> Bernhard
>
>
>
> Dr. Bernhard Pfaff
> Director
> Invesco Quantitative Strategies International
>
> Invesco Asset Management Deutschland GmbH
> Bleichstrasse 60-62
> D-60313 Frankfurt am Main
>
> Tel: +49 (0)69 29807 230
> Fax: +49 (0)69 29807 178
> www.institutional.invesco.com
> Email: bernhard_pfaff at fra.invesco.com
>
> Gesch?ftsf?hrer: Karl Georg Bayer, Bernhard Langer, Dr. Jens Langewand, Alexander Lehmann, Christian Puschmann
> Handelsregister: Frankfurt am Main, HRB 28469
> Sitz der Gesellschaft: Frankfurt am Main
>
>
>> -----Urspr?ngliche Nachricht-----
>> Von: r-devel-bounces at r-project.org
>> [mailto:r-devel-bounces at r-project.org] Im Auftrag von Pfaff,
>> Bernhard Dr.
>> Gesendet: Freitag, 30. Januar 2009 12:13
>> An: r-devel at r-project.org
>> Betreff: [Rd] Methods not loaded in R-Devel vs 2.8.1
>>
>> Dear list-member,
>>
>> I am currently developing a package with S4 classes. The
>> NAMESPACE and DESCRIPTION is printed below. Within this
>> package I have set a method "residuals" for two classes. In
>> version 2.8.1 these two are reported whereas in R-Devel
>> (2009-01-28 r47766). What have I missed? What has changed and
>> how can I rectify the issue? Your help and pointers are welcome.
>>
>>
>> For 2.8.1:
>> **********
>>
>>> library(gogarch)
>> Loading required package: fGarch
>> Loading required package: timeDate
>> Loading required package: timeSeries
>> Loading required package: fBasics
>> Loading required package: MASS
>> Warning message:
>> package 'gogarch' was built under R version 2.9.0
>>> showMethods("residuals")
>> Function: residuals (package stats)
>> object="ANY"
>> object="fGARCH"
>> object="Goestml"
>> object="GoGARCH"
>>
>>> getMethod("residuals", "GoGARCH")
>> Method Definition:
>>
>> function (object, ...)
>> {
>>    .local <- function (object, standardize = FALSE)
>>    {
>>        m <- ncol(object at X)
>>        n <- nrow(object at X)
>>        resl <- lapply(object at models, residuals, standardize =
>> standardize)
>>        resm <- matrix(c(unlist(resl)), ncol = m, nrow = n)
>>        ynames <- paste("y", 1:2, sep = "")
>>        colnames(resm) <- ynames
>>        rownames(resm) <- rownames(object at X)
>>        return(resm)
>>    }
>>    .local(object, ...)
>> }
>> <environment: namespace:gogarch>
>>
>> Signatures:
>>        object
>> target  "GoGARCH"
>> defined "GoGARCH"
>>> sessionInfo()
>> R version 2.8.1 (2008-12-22)
>> i386-pc-mingw32
>>
>> locale:
>> LC_COLLATE=German_Germany.1252;LC_CTYPE=German_Germany.1252;LC_
>> MONETARY=German_Germany.1252;LC_NUMERIC=C;LC_TIME=German_Germany.1252
>>
>> attached base packages:
>> [1] stats     graphics  datasets  utils     grDevices methods
>> base
>>
>> other attached packages:
>> [1] gogarch_0.2-8     fGarch_280.75     fBasics_280.74
>> MASS_7.2-44
>> [5] timeSeries_290.79 timeDate_290.81   fortunes_1.3-6
>>>
>>
>>
>> For R-Devel:
>> ************
>>> library(gogarch)
>> Loading required package: fGarch
>> Loading required package: timeDate
>> Loading required package: timeSeries
>> Loading required package: fBasics
>> Loading required package: MASS
>>> showMethods("residuals")
>> Function: residuals (package stats)
>> object="ANY"
>> object="fGARCH"
>>
>>> getMethod("residuals", "GoGARCH")
>> Error in getMethod("residuals", "GoGARCH") :
>>  No method found for function "residuals" and signature GoGARCH
>>> sessionInfo()
>> R version 2.9.0 Under development (unstable) (2009-01-28 r47766)
>> i386-pc-mingw32
>>
>> locale:
>> LC_COLLATE=German_Germany.1252;LC_CTYPE=German_Germany.1252;LC_
>> MONETARY=German_Germany.1252;LC_NUMERIC=C;LC_TIME=German_Germany.1252
>>
>> attached base packages:
>> [1] stats     graphics  grDevices datasets  utils     methods
>> base
>>
>> other attached packages:
>> [1] gogarch_0.2-8     fGarch_280.75     fBasics_280.74
>> MASS_7.2-44
>> [5] timeSeries_290.79 timeDate_290.81   fortunes_1.3-6
>>
>> loaded via a namespace (and not attached):
>> [1] grid_2.9.0      lattice_0.17-17 nlme_3.1-89     urca_1.2-2
>> [5] vars_1.4-4
>>>
>>
>>
>> DESCRIPTION:
>> ************
>> Package: gogarch
>> Version: 0.2-8
>> Type: Package
>> Title: Generalized Orthogonal GARCH (GO-GARCH) models
>> Date: 2009-01-30
>> Author: Bernhard Pfaff
>> Maintainer: Bernhard Pfaff <bernhard at pfaffikus.de>
>> Depends: R (>= 2.7.0), stats, methods, fGarch
>> Suggests: vars
>> Description: Implementation of the GO-GARCH model class.
>> License: GPL (>= 2)
>> LazyLoad: yes
>> LazyLoad: yes
>>
>> NAMESPACE:
>> **********
>> ## Import packages
>> import(methods)
>>
>> ## Import functions
>> importFrom(stats, coef, logLik, residuals)
>>
>> ## Classes
>> exportClasses(Goestml, GoGARCH, Goinit, Orthom)
>>
>> ## Methods
>> exportMethods(angles, cvar, ccor, ccov, coef, converged,
>> goest, logLik, M, print, show, t, residuals)
>>
>> ## Functions
>> export(gogarch, goinit, gollh, gotheta, Rd2, UprodR, unvech,
>> validOrthomObject, validGoinitObject)
>>
>>
>>
>> Dr. Bernhard Pfaff
>> Director
>> Invesco Quantitative Strategies International
>>
>> Invesco Asset Management Deutschland GmbH
>> Bleichstrasse 60-62
>> D-60313 Frankfurt am Main
>>
>> Tel: +49 (0)69 29807 230
>> Fax: +49 (0)69 29807 178
>> www.institutional.invesco.com
>> Email: bernhard_pfaff at fra.invesco.com
>>
>> Gesch?ftsf?hrer: Karl Georg Bayer, Bernhard Langer, Dr. Jens
>> Langewand, Alexander Lehmann, Christian Puschmann
>> Handelsregister: Frankfurt am Main, HRB 28469
>> Sitz der Gesellschaft: Frankfurt am Main
>>
>> *****************************************************************
>> Confidentiality Note: The information contained in this
>> ...{{dropped:10}}
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From Achim.Zeileis at wu-wien.ac.at  Fri Jan 30 13:28:48 2009
From: Achim.Zeileis at wu-wien.ac.at (Achim Zeileis)
Date: Fri, 30 Jan 2009 13:28:48 +0100 (CET)
Subject: [Rd] "Panel Data Unit Root tests"
In-Reply-To: <C9328F0EEDC3BC439FDABD12060E91098E153F@erini1.ERINI.local>
References: <C9328F0EEDC3BC439FDABD12060E91098E153F@erini1.ERINI.local>
Message-ID: <Pine.LNX.4.64.0901301325120.3957@paninaro.stat-math.wu-wien.ac.at>

Jose,

this is not the list for asking questions like this. You should ask on 
R-help or (alternatively!) R-SIG-Finance would be a good place to ask.

> I could not find a package to run panel data unit root tests in R 
> (there's a STATA module, though - PANELUNIT- and routines for Sarno and 
> Taylor's MADF test, Levin-Lin-Chu's test, Im-Pesaran-Shin's Test, etc, 
> to do this).
>
> Hence, I am toying with the idea of having a go at writing up one for R, 
> but would like to know whether anyone is already working on this.

I think that there's currently no package for this on CRAN but I might be 
wrong. But there's a chance that someone on the SIG has code for this...

Best,
Z


From brechbuehler at gmail.com  Fri Jan 30 16:30:26 2009
From: brechbuehler at gmail.com (=?ISO-8859-1?Q?Christian_Brechb=FChler?=)
Date: Fri, 30 Jan 2009 10:30:26 -0500
Subject: [Rd] (PR#13487) Segfault when mistakenly calling [.data.frame
In-Reply-To: <alpine.OSX.1.00.0901292124030.13855@tystie.local>
References: <20090129153504.D5170282C76F@mail.pubhealth.ku.dk>
	<alpine.OSX.1.00.0901292124030.13855@tystie.local>
Message-ID: <c0177e5a0901300730pfe25cb3h3933baa9ef3f26b3@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090130/915dc54d/attachment.pl>

From simon.urbanek at r-project.org  Fri Jan 30 17:51:00 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 30 Jan 2009 11:51:00 -0500
Subject: [Rd] (PR#13487) Segfault when mistakenly calling [.data.frame
In-Reply-To: <c0177e5a0901300730pfe25cb3h3933baa9ef3f26b3@mail.gmail.com>
References: <20090129153504.D5170282C76F@mail.pubhealth.ku.dk>
	<alpine.OSX.1.00.0901292124030.13855@tystie.local>
	<c0177e5a0901300730pfe25cb3h3933baa9ef3f26b3@mail.gmail.com>
Message-ID: <157EE908-8A6C-46E4-A9FF-A933A25DEFD9@r-project.org>


On Jan 30, 2009, at 10:30 , Christian Brechb?hler wrote:

> On Thu, Jan 29, 2009 at 4:44 PM, Prof Brian Ripley <ripley at stats.ox.ac.uk 
> >wrote:
>
>> What did your actual application do?  This seems a very strange  
>> thing to
>> do, and the segfault is in trying to construct the traceback.
>>
>> Only by using do.call on the object (and not even by name) do I get  
>> this
>> error.  E.g.
>>
>> `[.data.frame`(1:10, 3)
>>>
>> Error in NextMethod("[") : object not specified
>>
>>> do.call("[.data.frame", list(1:10, 3))
>>>
>> Error in NextMethod("[") : object not specified
>>
>> are fine.
>>
>> Obviously it would be nice to fix this, but I'd like to understand  
>> the
>> actual circumstances: there is more to it than the subject line.
>
>
> Yes, there is more.  For reporting the problem, we tried to pare it  
> down to
> a concise, self-contained test case.
>
> My boss was debugging an issue in our R code.  We have our own "[...."
> functions, because stock R drops names when subscripting.

... if you tell it to do so, yes. If you tell it to not do that, it  
won't ... ever tried drop=FALSE ?

Cheers,
S


> To bypass our
> now-suspect functions and get the "real" subscripting method, he  
> used "get"
> from package:base.  He was examining a large object, and believing  
> it was a
> data frame, chose "[.data.frame".  As it turns out, that object was  
> not a
> data frame, and he got an unexpected segfault.  I think it was a  
> matrix.
> But it doesn't matter -- a vector as in the test case will give the  
> same.
>
> We have since fixed the bug in our replacement subscripting  
> function, so the
> issue might not affect us any more.
>
> Thanks,
> /Christian
>
>
>> On Thu, 29 Jan 2009, brechbuehler at gmail.com wrote:
>>
>> Full_Name: Christian Brechbuehler
>>> Version: 2.7.2, 2.8.1
>>> OS: linux-gnu
>>>
>>> If we mistakenly believe the object is a data frame (as we did in  
>>> a much
>>> more
>>> complicated real situation), this happens:
>>>
>>>> do.call(get("[.data.frame",pos="package:base"),list(1:10,3))
>>> Error in NextMethod("[") :
>>>   no calling generic was found: was a method called directly?
>>>
>>>  *** caught segfault ***
>>> address (nil), cause 'unknown'
>>>
>>> Process R:2 segmentation fault (core dumped) at Thu Jan 29  
>>> 09:26:29 2009
>>>
>>> The Error message is appropriate.  But the segmentation fault is
>>> unexpected.
>>>
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From tplate at acm.org  Fri Jan 30 18:38:14 2009
From: tplate at acm.org (Tony Plate)
Date: Fri, 30 Jan 2009 10:38:14 -0700
Subject: [Rd] (PR#13487) Segfault when mistakenly calling [.data.frame
In-Reply-To: <157EE908-8A6C-46E4-A9FF-A933A25DEFD9@r-project.org>
References: <20090129153504.D5170282C76F@mail.pubhealth.ku.dk>	<alpine.OSX.1.00.0901292124030.13855@tystie.local>	<c0177e5a0901300730pfe25cb3h3933baa9ef3f26b3@mail.gmail.com>
	<157EE908-8A6C-46E4-A9FF-A933A25DEFD9@r-project.org>
Message-ID: <49833B06.6060508@acm.org>

Simon Urbanek wrote:
>
> On Jan 30, 2009, at 10:30 , Christian Brechb?hler wrote:
>
>> On Thu, Jan 29, 2009 at 4:44 PM, Prof Brian Ripley 
>> <ripley at stats.ox.ac.uk>wrote:
>>
>>> What did your actual application do?  This seems a very strange 
>>> thing to
>>> do, and the segfault is in trying to construct the traceback.
>>>
>>> Only by using do.call on the object (and not even by name) do I get 
>>> this
>>> error.  E.g.
>>>
>>> `[.data.frame`(1:10, 3)
>>>>
>>> Error in NextMethod("[") : object not specified
>>>
>>>> do.call("[.data.frame", list(1:10, 3))
>>>>
>>> Error in NextMethod("[") : object not specified
>>>
>>> are fine.
>>>
>>> Obviously it would be nice to fix this, but I'd like to understand the
>>> actual circumstances: there is more to it than the subject line.
>>
>>
>> Yes, there is more.  For reporting the problem, we tried to pare it 
>> down to
>> a concise, self-contained test case.
>>
>> My boss was debugging an issue in our R code.  We have our own "[...."
>> functions, because stock R drops names when subscripting.
>
> ... if you tell it to do so, yes. If you tell it to not do that, it 
> won't ... ever tried drop=FALSE ?
The common situation I have (which might be the same as the OP's) is 
wanting to get a vector from a data frame, and having the rownames of 
the dataframe become the names on the vector.

With matrix, the behavior I want is the default behavior, e.g.,
 > x <- cbind(a=c(x=1,y=2,z=3),b=4:6)
 > x
  a b
x 1 4
y 2 5
z 3 6
 > x[,1]
x y z
1 2 3

But with a data frame, subscripting returns a vector with no names:
 > xd <- as.data.frame(x)
 > xd[,1]
[1] 1 2 3

One can use drop=FALSE, but then you've still got a data frame, not a 
vector:
 > (xd1 <- xd[,1,drop=FALSE])
  a
x 1
y 2
z 3

The simplest way I know to get a named vector is to use as.matrix on the 
one-column dataframe:
 > as.matrix(xd1)[,1]
x y z
1 2 3
 >
(Which works fine except in the case where xd1 has only one row...)

And BTW, am I missing something, or does the behavior of drop() not 
conform to the description in ?drop:
 > Value:
 >     If 'x' is an object with a 'dim' attribute (e.g., a matrix or
 >     'array'), then 'drop' returns an object like 'x', but with any
 >     extents of length one removed.  Any accompanying 'dimnames'
 >     attribute is adjusted and returned with 'x': if the result is a
 >     vector the 'names' are taken from the 'dimnames' (if any).  If the
 >     result is a length-one vector, the names are taken from the first
 >     dimension with a dimname.

How is this last sentence consistent with the following behavior?
 > dimnames(x[1,1,drop=F])
[[1]]
[1] "x"

[[2]]
[1] "a"

 > drop(x[1,1,drop=F])
[1] 1
 >
 From the description in "Value:" in ?drop, I would have expected above 
result to have the name "x" (the name from the first dimension with a 
dimname).

 > sessionInfo()
R version 2.8.1 (2008-12-22)
i386-pc-mingw32

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
States.1252;LC_MONETARY=English_United 
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base    
 >

-- Tony Plate
>
> Cheers,
> S
>
>
>> To bypass our
>> now-suspect functions and get the "real" subscripting method, he used 
>> "get"
>> from package:base.  He was examining a large object, and believing it 
>> was a
>> data frame, chose "[.data.frame".  As it turns out, that object was 
>> not a
>> data frame, and he got an unexpected segfault.  I think it was a matrix.
>> But it doesn't matter -- a vector as in the test case will give the 
>> same.
>>
>> We have since fixed the bug in our replacement subscripting function, 
>> so the
>> issue might not affect us any more.
>>
>> Thanks,
>> /Christian
>>
>>
>>> On Thu, 29 Jan 2009, brechbuehler at gmail.com wrote:
>>>
>>> Full_Name: Christian Brechbuehler
>>>> Version: 2.7.2, 2.8.1
>>>> OS: linux-gnu
>>>>
>>>> If we mistakenly believe the object is a data frame (as we did in a 
>>>> much
>>>> more
>>>> complicated real situation), this happens:
>>>>
>>>>> do.call(get("[.data.frame",pos="package:base"),list(1:10,3))
>>>> Error in NextMethod("[") :
>>>>   no calling generic was found: was a method called directly?
>>>>
>>>>  *** caught segfault ***
>>>> address (nil), cause 'unknown'
>>>>
>>>> Process R:2 segmentation fault (core dumped) at Thu Jan 29 09:26:29 
>>>> 2009
>>>>
>>>> The Error message is appropriate.  But the segmentation fault is
>>>> unexpected.
>>>>
>>>
>>
>>     [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ncrookston at fs.fed.us  Fri Jan 30 20:22:46 2009
From: ncrookston at fs.fed.us (Nicholas L Crookston)
Date: Fri, 30 Jan 2009 11:22:46 -0800
Subject: [Rd] In Rd: \describe \itemize and \item
In-Reply-To: <49827083.1000604@stats.uwo.ca>
Message-ID: <OF47937CCE.EC6C59B6-ON8825754E.005CB95E-8825754E.006A7034@fs.fed.us>

Duncan Murdoch <murdoch at stats.uwo.ca> wrote on 01/29/2009 07:14:11 PM:

> On 29/01/2009 5:22 PM, Nicholas L Crookston wrote:
> > I rebuilt a test version of my yaImpute package using Uwe Ligges' 
windows
> > build service.
> > I got this reply: Check result: OK
> > R version 2.9.0 Under development (unstable) (2009-01-27 r47756)
> >
> > Here is the issue: I have the following construct in help files (this
> > example relates to "data"):
> >
> > \format{
> >   A data frame with 847 rows and 29 columns: \cr\cr
> >   Ground based measurements of trees (Y-variables):
> >   \itemize{
> >      \item{TopHt}{Height of tallest trees (ft)}
> >      \item{LnVolL}{Log of the volume \eqn{(ft^3/acre)} of western 
larch}
> >  ...... many lines deleted ......
> >      \item{LnVolPP}{Log of the volume \eqn{(ft^3/acre)} of ponderosa 
pine}
> >      \item{CCover}{Canopy cover (percent)}
> >   }
> >   Geographic Location, Slope, and Aspect (X-variables):
> >   \itemize{
> >     \item{utmx}{UTM easting at plot center}
> >     \item{utmy}{UTM northing at plot center}
> > ...... many lines deleted ......
> >     \item{elevm}{Mean elevation (ft) above sea level over plot}
> >     \item{slpsinaspm}{Mean of slope (proportion) times the sine of 
aspect}
> >   }
> > ...... many lines deleted ......
> > }
> >
> > What I get in the help file is:
> > =========================
> > Format  <this word is set in bold, correctly>
> > A data frame with 847 rows and 29 columns:
> >
> > Ground based measurements of trees (Y-variables):
> >
> >    TopHt
> >       Height of tallest trees (ft)
> >    LnVolL
> >       Log of the volume (ft^3/acre) of western larch
> > ========================= ......and so on........
> > [I've inserted 3 spaces to mimic tabs in this illustration]
> >
> > I would expect (and I used to get) something like this:
> > =========================
> > Ground based measurements of trees (Y-variables):
> >
> >  <bullet here>  TopHt   Height of tallest trees (ft)
> >  <bullet here>  LnVolL  Log of the volume (ft^3/acre) of western larch
> > =========================
> >

> I think we need more info to comment on.  Is this file one of the ones
> in the yaImpute package on CRAN, or is it unreleased?  Is the Rd file
> available for us to look at?  Does the man page look different in 2.8.1
> from what you expect (there haven't been serious changes there), or only
> in R-devel (2.9.0)?  2.6.2 is pretty old, but I don't think any of the
> requested changes should be incompatible with it.

> Duncan Murdoch

The problem is in an unreleased version built in the development 
environment.
The entire unreleased package can be found at this temporary location: 
http://forest.moscowfsl.wsu.edu/gems/yaImpute_1.0-8.tar.gz

The original is on CRAN (version 1.0-7). It worked under the old parser, 
but
not using parser 2 (the warnings on CRAN point to the problem). 
You can see the difference by looking at TallyLake.Rd 
in the two versions. I would be happy to send you just these files if 
you'd 
like me to.

Note that text version of the help file builds as I expect it to. 
The problem is in the htlm version.

PS: I tried two versions of \items 
    \item{utmx}{UTM easting at plot center}
and 
    \item{utmx   }{UTM easting at plot center}
(note added spaces, added for readability of the Rd file 
this difference does not seem to matter.)

Thanks, Nick


From murdoch at stats.uwo.ca  Fri Jan 30 21:04:56 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 30 Jan 2009 15:04:56 -0500
Subject: [Rd] In Rd: \describe \itemize and \item
In-Reply-To: <OF47937CCE.EC6C59B6-ON8825754E.005CB95E-8825754E.006A7034@fs.fed.us>
References: <OF47937CCE.EC6C59B6-ON8825754E.005CB95E-8825754E.006A7034@fs.fed.us>
Message-ID: <49835D68.7040201@stats.uwo.ca>

On 1/30/2009 2:22 PM, Nicholas L Crookston wrote:
> Duncan Murdoch <murdoch at stats.uwo.ca> wrote on 01/29/2009 07:14:11 PM:
> 
>> On 29/01/2009 5:22 PM, Nicholas L Crookston wrote:
>> > I rebuilt a test version of my yaImpute package using Uwe Ligges' 
> windows
>> > build service.
>> > I got this reply: Check result: OK
>> > R version 2.9.0 Under development (unstable) (2009-01-27 r47756)
>> >
>> > Here is the issue: I have the following construct in help files (this
>> > example relates to "data"):
>> >
>> > \format{
>> >   A data frame with 847 rows and 29 columns: \cr\cr
>> >   Ground based measurements of trees (Y-variables):
>> >   \itemize{
>> >      \item{TopHt}{Height of tallest trees (ft)}
>> >      \item{LnVolL}{Log of the volume \eqn{(ft^3/acre)} of western 
> larch}
>> >  ...... many lines deleted ......
>> >      \item{LnVolPP}{Log of the volume \eqn{(ft^3/acre)} of ponderosa 
> pine}
>> >      \item{CCover}{Canopy cover (percent)}
>> >   }
>> >   Geographic Location, Slope, and Aspect (X-variables):
>> >   \itemize{
>> >     \item{utmx}{UTM easting at plot center}
>> >     \item{utmy}{UTM northing at plot center}
>> > ...... many lines deleted ......
>> >     \item{elevm}{Mean elevation (ft) above sea level over plot}
>> >     \item{slpsinaspm}{Mean of slope (proportion) times the sine of 
> aspect}
>> >   }
>> > ...... many lines deleted ......
>> > }
>> >
>> > What I get in the help file is:
>> > =========================
>> > Format  <this word is set in bold, correctly>
>> > A data frame with 847 rows and 29 columns:
>> >
>> > Ground based measurements of trees (Y-variables):
>> >
>> >    TopHt
>> >       Height of tallest trees (ft)
>> >    LnVolL
>> >       Log of the volume (ft^3/acre) of western larch
>> > ========================= ......and so on........
>> > [I've inserted 3 spaces to mimic tabs in this illustration]
>> >
>> > I would expect (and I used to get) something like this:
>> > =========================
>> > Ground based measurements of trees (Y-variables):
>> >
>> >  <bullet here>  TopHt   Height of tallest trees (ft)
>> >  <bullet here>  LnVolL  Log of the volume (ft^3/acre) of western larch
>> > =========================
>> >
> 
>> I think we need more info to comment on.  Is this file one of the ones
>> in the yaImpute package on CRAN, or is it unreleased?  Is the Rd file
>> available for us to look at?  Does the man page look different in 2.8.1
>> from what you expect (there haven't been serious changes there), or only
>> in R-devel (2.9.0)?  2.6.2 is pretty old, but I don't think any of the
>> requested changes should be incompatible with it.
> 
>> Duncan Murdoch
> 
> The problem is in an unreleased version built in the development 
> environment.
> The entire unreleased package can be found at this temporary location: 
> http://forest.moscowfsl.wsu.edu/gems/yaImpute_1.0-8.tar.gz
> 
> The original is on CRAN (version 1.0-7). It worked under the old parser, 
> but
> not using parser 2 (the warnings on CRAN point to the problem). 
> You can see the difference by looking at TallyLake.Rd 
> in the two versions. I would be happy to send you just these files if 
> you'd 
> like me to.
> 
> Note that text version of the help file builds as I expect it to. 
> The problem is in the htlm version.
> 
> PS: I tried two versions of \items 
>     \item{utmx}{UTM easting at plot center}
> and 
>     \item{utmx   }{UTM easting at plot center}
> (note added spaces, added for readability of the Rd file 
> this difference does not seem to matter.)


Okay, I think I see now.  I installed your package version 1.0-8 in 
R-devel (to be 2.9.0), and the ?TallyLake man page looks fine to me in 
text mode, looks slightly funny in HTML (with the labels one line above 
the thing they're describing).  But to me it looks better in the new 
HTML than version 1.0-7 looked in 2.8.1:  in that version, there was no 
attempt to line up the descriptions to a common left margin, so they 
tended to be confused with the thing they were describing.

So I'm not sure what you'd really like to see in the output.  Can you 
describe it again?

Duncan Murdoch


From ncrookston at fs.fed.us  Fri Jan 30 21:37:19 2009
From: ncrookston at fs.fed.us (Nicholas L Crookston)
Date: Fri, 30 Jan 2009 12:37:19 -0800
Subject: [Rd] In Rd: \describe \itemize and \item
In-Reply-To: <49835D68.7040201@stats.uwo.ca>
Message-ID: <OF00684B24.B84AF982-ON8825754E.007056A6-8825754E.0071434C@fs.fed.us>

Duncan Murdoch <murdoch at stats.uwo.ca> wrote on 01/30/2009 12:04:56 PM:


> 
> Okay, I think I see now.  I installed your package version 1.0-8 in
> R-devel (to be 2.9.0), and the ?TallyLake man page looks fine to me in
> text mode, looks slightly funny in HTML (with the labels one line above
> the thing they're describing).  But to me it looks better in the new
> HTML than version 1.0-7 looked in 2.8.1:  in that version, there was no
> attempt to line up the descriptions to a common left margin, so they
> tended to be confused with the thing they were describing.

> So I'm not sure what you'd really like to see in the output.  Can you
> describe it again?

Reading from the R-exts.pdf, section 2.4:

"The \itemize and \enumerate commands take a single argument, within which 
there may be
one or more \item commands. The text following each \item is formatted as 
one or more paragraphs,
suitably indented and with the first paragraph marked with a bullet point 
(\itemize)
or a number (\enumerate)."

I'm using \itemize so I expect to see a bullet point making the first 
paragraph of each item.

What I'm getting is what you would expect with the \describe command, as 
described here:

"The \describe command is similar to \itemize but allows initial labels to 
be specified.
The \items take two arguments, the label and the body of the item, in 
exactly the same way
as argument and value \items. \describe commands are mapped to <DL> lists 
in HTML and
\description lists in LATEX."

> Duncan Murdoch

Nick Crookston


From edd at debian.org  Sat Jan 31 05:38:53 2009
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 30 Jan 2009 22:38:53 -0600
Subject: [Rd] Side-effects of require() vs library() on x86_64 aka amd64
In-Reply-To: <18817.12266.512527.675087@ron.nulle.part>
References: <18817.12266.512527.675087@ron.nulle.part>
Message-ID: <18819.54749.999186.155947@ron.nulle.part>


On 28 January 2009 at 22:26, Dirk Eddelbuettel wrote:
| 
| RDieHarder fails its regression tests on x86_64 (aka "amd64") at CRAN (using
| Debian), and I see the same on Ubuntu 8.10 in 64 bit.  No issues on 32bit.
| 
| One odd thing is that the program behaves well if run via
| 
|     R --no-save < tests/RDieHarder.R
| 
| but NOT when started using 
| 
|     R --slave < tests/RDieHarder.R
| 
| as R CMD check does.

Turns out, as so often, that there was a regular bug lurking which is now
fixed in RDieHarder 0.1.1.  But I still would like to understand exactly what
is different so that --slave was able to trigger it when --vanilla,
--no-save, ... did not.  

[ The library() vs require() issue may have been a red herring. ]

Dirk

-- 
Three out of two people have difficulties with fractions.


From atp at piskorski.com  Sat Jan 31 13:31:58 2009
From: atp at piskorski.com (Andrew Piskorski)
Date: Sat, 31 Jan 2009 07:31:58 -0500
Subject: [Rd] (PR#8192) [ subscripting sometimes loses names
In-Reply-To: <157EE908-8A6C-46E4-A9FF-A933A25DEFD9@r-project.org>
References: <157EE908-8A6C-46E4-A9FF-A933A25DEFD9@r-project.org>
Message-ID: <20090131123158.GA31706@piskorski.com>

This (tangential) discussion really should be a separate thread so I
changed the subject line above.

On Fri, Jan 30, 2009 at 11:51:00AM -0500, Simon Urbanek wrote:
> Subject: Re: [Rd] (PR#13487) Segfault when mistakenly calling [.data.frame

> >My boss was debugging an issue in our R code.  We have our own "[...."
> >functions, because stock R drops names when subscripting.
> 
> ... if you tell it to do so, yes. If you tell it to not do that, it  
> won't ... ever tried drop=FALSE ?

Simon, no, the drop=FALSE argument has nothing to do with what
Christian was talking about.  The kind of thing he meant is PR# 8192,
"Subject: [ subscripting sometimes loses names":

  http://bugs.r-project.org/cgi-bin/R/wishlist?id=8192

In R, subscripting with "[" USUALLY retains names, but R has various
edge cases where it (IMNSHO) inappropriately discards them.  This
occurs with both .Primitive("[") and "[.data.frame".  This has been
known for years, but I have not yet tried digging into R's
implementation to see where and how the names are actually getting
lost.

Incidentally, versions of S-Plus since approximately S-Plus 6.0 back
in 2001 show similar buggy edge case behavior.  Older versions of
S-Plus, c. S-Plus 3.3 and earlier, had the correct, name preserving
behavior.  I presume that the original Bell Labs S had correct
name-preserving behavior, and then the S-Plus developers broke it
sometime along the way.

-- 
Andrew Piskorski <atp at piskorski.com>
http://www.piskorski.com/


From murdoch at stats.uwo.ca  Sat Jan 31 15:04:58 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 31 Jan 2009 09:04:58 -0500
Subject: [Rd] (PR#8192) [ subscripting sometimes loses names
In-Reply-To: <20090131123158.GA31706@piskorski.com>
References: <157EE908-8A6C-46E4-A9FF-A933A25DEFD9@r-project.org>
	<20090131123158.GA31706@piskorski.com>
Message-ID: <49845A8A.70000@stats.uwo.ca>

On 31/01/2009 7:31 AM, Andrew Piskorski wrote:
> This (tangential) discussion really should be a separate thread so I
> changed the subject line above.
> 
> On Fri, Jan 30, 2009 at 11:51:00AM -0500, Simon Urbanek wrote:
>> Subject: Re: [Rd] (PR#13487) Segfault when mistakenly calling [.data.frame
> 
>>> My boss was debugging an issue in our R code.  We have our own "[...."
>>> functions, because stock R drops names when subscripting.
>> ... if you tell it to do so, yes. If you tell it to not do that, it  
>> won't ... ever tried drop=FALSE ?
> 
> Simon, no, the drop=FALSE argument has nothing to do with what
> Christian was talking about.  The kind of thing he meant is PR# 8192,
> "Subject: [ subscripting sometimes loses names":
> 
>   http://bugs.r-project.org/cgi-bin/R/wishlist?id=8192

In that bug report you were asked to provide simple examples, and you 
didn't.  I imagine that's why there was no action on it.  It is not that 
easy for someone else to actually find the simple example that led you 
to print

      $vec.1
BAD  $vec.1[[1]]           $vec.1[[2]]
         a    c <NA>         a  c no
         1    3   NA         1  3 NA

I just tracked this one down, and can put together this simple example:

 > (1:3)["no"]
[1] NA

where I think you would want the name "no" attached to the output.  (Or 
maybe your more complicated example is wanted?  You don't explain.)  But 
that looks like documented behaviour to me:  according to my reading of 
"Indexing by vectors" in the R Language Definition manual, it should 
give the same answer as (1:3)[4], and it does.  So it's not a bug, but a 
wishlist item.

And the other two cases where you list "BAD" behaviour?  I didn't track 
them down.

I know you spent a lot of time putting together that bug report; it 
seems a shame that it is being ignored because you put in too much:  you 
really should simplify it as you were asked to do.

Duncan Murdoch


> 
> In R, subscripting with "[" USUALLY retains names, but R has various
> edge cases where it (IMNSHO) inappropriately discards them.  This
> occurs with both .Primitive("[") and "[.data.frame".  This has been
> known for years, but I have not yet tried digging into R's
> implementation to see where and how the names are actually getting
> lost.
> 
> Incidentally, versions of S-Plus since approximately S-Plus 6.0 back
> in 2001 show similar buggy edge case behavior.  Older versions of
> S-Plus, c. S-Plus 3.3 and earlier, had the correct, name preserving
> behavior.  I presume that the original Bell Labs S had correct
> name-preserving behavior, and then the S-Plus developers broke it
> sometime along the way.
>


From seth at userprimary.net  Sat Jan 31 15:59:13 2009
From: seth at userprimary.net (Seth Falcon)
Date: Sat, 31 Jan 2009 06:59:13 -0800
Subject: [Rd] Side-effects of require() vs library() on x86_64 aka amd64
In-Reply-To: <18819.54749.999186.155947@ron.nulle.part>
References: <18817.12266.512527.675087@ron.nulle.part>
	<18819.54749.999186.155947@ron.nulle.part>
Message-ID: <20090131145913.GI248@ziti.local>

Hi Dirk,

* On 2009-01-30 at 22:38 -0600 Dirk Eddelbuettel wrote:
> Turns out, as so often, that there was a regular bug lurking which is now
> fixed in RDieHarder 0.1.1.  But I still would like to understand exactly what
> is different so that --slave was able to trigger it when --vanilla,
> --no-save, ... did not.  
> 
> [ The library() vs require() issue may have been a red herring. ]

Without telling us any details about the nature of the bug you found,
it is difficult to speculate.  If the bug was in your C code and
memory related, it could simply be that the two different run paths
resulted in different allocation patterns, one of which triggered the
bug.

+ seth

-- 
Seth Falcon | http://userprimary.net/user/


From p.dalgaard at biostat.ku.dk  Sat Jan 31 16:13:30 2009
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sat, 31 Jan 2009 16:13:30 +0100
Subject: [Rd] (PR#8192) [ subscripting sometimes loses names
In-Reply-To: <49845A8A.70000@stats.uwo.ca>
References: <157EE908-8A6C-46E4-A9FF-A933A25DEFD9@r-project.org>	<20090131123158.GA31706@piskorski.com>
	<49845A8A.70000@stats.uwo.ca>
Message-ID: <49846A9A.8070308@biostat.ku.dk>

Duncan Murdoch wrote:
> On 31/01/2009 7:31 AM, Andrew Piskorski wrote:
>> This (tangential) discussion really should be a separate thread so I
>> changed the subject line above.
>>
>> On Fri, Jan 30, 2009 at 11:51:00AM -0500, Simon Urbanek wrote:
>>> Subject: Re: [Rd] (PR#13487) Segfault when mistakenly calling 
>>> [.data.frame
>>
>>>> My boss was debugging an issue in our R code.  We have our own "[...."
>>>> functions, because stock R drops names when subscripting.
>>> ... if you tell it to do so, yes. If you tell it to not do that, it  
>>> won't ... ever tried drop=FALSE ?
>>
>> Simon, no, the drop=FALSE argument has nothing to do with what
>> Christian was talking about.  The kind of thing he meant is PR# 8192,
>> "Subject: [ subscripting sometimes loses names":
>>
>>   http://bugs.r-project.org/cgi-bin/R/wishlist?id=8192
> 
> In that bug report you were asked to provide simple examples, and you 
> didn't.  I imagine that's why there was no action on it.  It is not that 
> easy for someone else to actually find the simple example that led you 
> to print
> 
>      $vec.1
> BAD  $vec.1[[1]]           $vec.1[[2]]
>         a    c <NA>         a  c no
>         1    3   NA         1  3 NA
> 
> I just tracked this one down, and can put together this simple example:
> 
>  > (1:3)["no"]
> [1] NA
> 
> where I think you would want the name "no" attached to the output.  (Or 
> maybe your more complicated example is wanted?  You don't explain.)  But 
> that looks like documented behaviour to me:  according to my reading of 
> "Indexing by vectors" in the R Language Definition manual, it should 
> give the same answer as (1:3)[4], and it does.  So it's not a bug, but a 
> wishlist item.
> 
> And the other two cases where you list "BAD" behaviour?  I didn't track 
> them down.

I did, and they boil down to variations of

 > data.frame(val=1:3,row.names=letters[1:3])[,1]
[1] 1 2 3

but it's not obvious that the result should be named using the row.names 
and (in particular) whether or why it should differ from .....[[1]] and 
....$val. Given that for most purposes, extracting the relevant names 
would just be unnecessary red tape, I'd say that we can do without it.



-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From edd at debian.org  Sat Jan 31 16:34:25 2009
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sat, 31 Jan 2009 09:34:25 -0600
Subject: [Rd] Side-effects of require() vs library() on x86_64 aka amd64
In-Reply-To: <20090131145913.GI248@ziti.local>
References: <18817.12266.512527.675087@ron.nulle.part>
	<18819.54749.999186.155947@ron.nulle.part>
	<20090131145913.GI248@ziti.local>
Message-ID: <18820.28545.87207.417437@ron.nulle.part>


Hi Seth,

Thanks for the follow-up.

On 31 January 2009 at 06:59, Seth Falcon wrote:
| * On 2009-01-30 at 22:38 -0600 Dirk Eddelbuettel wrote:
| > Turns out, as so often, that there was a regular bug lurking which is now
| > fixed in RDieHarder 0.1.1.  But I still would like to understand exactly what
| > is different so that --slave was able to trigger it when --vanilla,
| > --no-save, ... did not.  
| > 
| > [ The library() vs require() issue may have been a red herring. ]
| 
| Without telling us any details about the nature of the bug you found,
| it is difficult to speculate.  If the bug was in your C code and
| memory related, it could simply be that the two different run paths
| resulted in different allocation patterns, one of which triggered the
| bug.

Yes yes and yes :)  It was in C, and it was memory related and it dealt
getting results out of the library to which the package interfaces. 

But short of looking at the source, is there any documentation on what
--slave does differently?

Dirk

-- 
Three out of two people have difficulties with fractions.


From p.dalgaard at biostat.ku.dk  Sat Jan 31 16:55:05 2009
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sat, 31 Jan 2009 16:55:05 +0100
Subject: [Rd] Side-effects of require() vs library() on x86_64 aka amd64
In-Reply-To: <18820.28545.87207.417437@ron.nulle.part>
References: <18817.12266.512527.675087@ron.nulle.part>	<18819.54749.999186.155947@ron.nulle.part>	<20090131145913.GI248@ziti.local>
	<18820.28545.87207.417437@ron.nulle.part>
Message-ID: <49847459.4060109@biostat.ku.dk>

Dirk Eddelbuettel wrote:
> Hi Seth,
> 
> Thanks for the follow-up.
> 
> On 31 January 2009 at 06:59, Seth Falcon wrote:
> | * On 2009-01-30 at 22:38 -0600 Dirk Eddelbuettel wrote:
> | > Turns out, as so often, that there was a regular bug lurking which is now
> | > fixed in RDieHarder 0.1.1.  But I still would like to understand exactly what
> | > is different so that --slave was able to trigger it when --vanilla,
> | > --no-save, ... did not.  
> | > 
> | > [ The library() vs require() issue may have been a red herring. ]
> | 
> | Without telling us any details about the nature of the bug you found,
> | it is difficult to speculate.  If the bug was in your C code and
> | memory related, it could simply be that the two different run paths
> | resulted in different allocation patterns, one of which triggered the
> | bug.
> 
> Yes yes and yes :)  It was in C, and it was memory related and it dealt
> getting results out of the library to which the package interfaces. 
> 
> But short of looking at the source, is there any documentation on what
> --slave does differently?
> 
> Dirk
> 

Not really (and you know where to find the sources...). But sometimes it 
only takes one memory allocation more or less to shift the effect of a 
memory bug to a completely different point in space an time.

-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From seth at userprimary.net  Sat Jan 31 16:56:25 2009
From: seth at userprimary.net (Seth Falcon)
Date: Sat, 31 Jan 2009 07:56:25 -0800
Subject: [Rd] Side-effects of require() vs library() on x86_64 aka amd64
In-Reply-To: <18820.28545.87207.417437@ron.nulle.part>
References: <18817.12266.512527.675087@ron.nulle.part>
	<18819.54749.999186.155947@ron.nulle.part>
	<20090131145913.GI248@ziti.local>
	<18820.28545.87207.417437@ron.nulle.part>
Message-ID: <20090131155625.GK248@ziti.local>

* On 2009-01-31 at 09:34 -0600 Dirk Eddelbuettel wrote:
> | Without telling us any details about the nature of the bug you found,
> | it is difficult to speculate.  If the bug was in your C code and
> | memory related, it could simply be that the two different run paths
> | resulted in different allocation patterns, one of which triggered the
> | bug.
> 
> Yes yes and yes :)  It was in C, and it was memory related and it dealt
> getting results out of the library to which the package interfaces. 
> 
> But short of looking at the source, is there any documentation on what
> --slave does differently?

The R-intro manual has a brief description:

--slave
    Make R run as quietly as possible. This option is intended to
    support programs which use R to compute results for them. It
    implies --quiet and --no-save.

I suspect that for more detail than that, one would have to look at
the sources.  But the above helps explain the behavior you saw; a
"--quite" R will suppress some output and that will make a difference
in terms of memory allocation.

+ seth

-- 
Seth Falcon | http://userprimary.net/user/


From edd at debian.org  Sat Jan 31 17:15:40 2009
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sat, 31 Jan 2009 10:15:40 -0600
Subject: [Rd] Side-effects of require() vs library() on x86_64 aka amd64
In-Reply-To: <49847459.4060109@biostat.ku.dk>
References: <18817.12266.512527.675087@ron.nulle.part>
	<18819.54749.999186.155947@ron.nulle.part>
	<20090131145913.GI248@ziti.local>
	<18820.28545.87207.417437@ron.nulle.part>
	<49847459.4060109@biostat.ku.dk>
Message-ID: <18820.31020.62883.201251@ron.nulle.part>


Hi Peter,

On 31 January 2009 at 16:55, Peter Dalgaard wrote:
| Not really (and you know where to find the sources...).

Yes, and I had dug through that in the past for littler and other embedding
work.  I was just wondering if I had missed any documentation, besides the
few lines about --slave from the help page, --help switch and intro manual.

| But sometimes it 
| only takes one memory allocation more or less to shift the effect of a 
| memory bug to a completely different point in space an time.

That seems to have been the case. It also didn't help that x86 didn't trigger
it, or I would have noticed sooner after my 0.1.0 release.  Building on
different architectures help shaking these things out.

Dirk

-- 
Three out of two people have difficulties with fractions.


From brechbuehler at gmail.com  Sat Jan 31 21:26:34 2009
From: brechbuehler at gmail.com (=?ISO-8859-1?Q?Christian_Brechb=FChler?=)
Date: Sat, 31 Jan 2009 15:26:34 -0500
Subject: [Rd] (PR#8192) [ subscripting sometimes loses names
In-Reply-To: <49846A9A.8070308@biostat.ku.dk>
References: <157EE908-8A6C-46E4-A9FF-A933A25DEFD9@r-project.org>
	<20090131123158.GA31706@piskorski.com> <49845A8A.70000@stats.uwo.ca>
	<49846A9A.8070308@biostat.ku.dk>
Message-ID: <c0177e5a0901311226k6ec55fffk67455d5843dca4bc@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090131/30e53062/attachment.pl>

From Waclaw.Marcin.Kusnierczyk at idi.ntnu.no  Sat Jan 31 22:36:45 2009
From: Waclaw.Marcin.Kusnierczyk at idi.ntnu.no (Wacek Kusnierczyk)
Date: Sat, 31 Jan 2009 22:36:45 +0100
Subject: [Rd] (PR#8192) [ subscripting sometimes loses names
In-Reply-To: <c0177e5a0901311226k6ec55fffk67455d5843dca4bc@mail.gmail.com>
References: <157EE908-8A6C-46E4-A9FF-A933A25DEFD9@r-project.org>	<20090131123158.GA31706@piskorski.com>
	<49845A8A.70000@stats.uwo.ca>	<49846A9A.8070308@biostat.ku.dk>
	<c0177e5a0901311226k6ec55fffk67455d5843dca4bc@mail.gmail.com>
Message-ID: <4984C46D.3030101@idi.ntnu.no>

Christian Brechb?hler wrote:

<snip>
>
>>> data.frame(val=1:3,row.names=letters[1:3])[,1]
>>>       
>> [1] 1 2 3
>>
>> but it's not obvious that the result should be named using the row.names
>> and (in particular) whether or why it should differ from .....[[1]] and
>> ....$val. 

this might be a good argument, if not that [,1] returning a vector
rather than a one-column data frame is already inconsistent (with
[,1:2], for example).  if [,1] were not dropping the data.frame class
and were returning a data frame instead, it would be obvious the result
should use row names. 

data.frame(val=1:3,row.names=letters[1:3])[,1,drop=FALSE]

will keep the class and row names, though ?'[' says "drop: For matrices
and arrays.".

it doesn't mean that dropping row names (or dropping dimensions) isn't
useful and handy in specific cases, but this makes it no less
inconsistent. 

>> Given that for most purposes, extracting the relevant names would
>> just be unnecessary red tape, I'd say that we can do without it.
>>     
>
>
> Compare
>
>   
>> data.frame(val=1:3,row.names=letters[1:3])[,1]
>>     
> [1] 1 2 3
>   
>> as.matrix(data.frame(val=1:3,row.names=letters[1:3]))[,1]
>>     
> a b c
> 1 2 3
>
> X[,1] preserves row names if X is a matrix, and loses them if X is a data
> frame.  To me, this is ugly and inconsistent.
>
> One might argue that having names and dimnames at all is "red tape", and
> wastes memory and computational efficiency -- after all, Fortran arrays had
> no names.  But R chose to drag along the names (sometimes), and it can be
> very helpful to us humans.  Now R should do it consistently.
>   

i support this opinion.  whether to have or not to have row names is a
design decision, and both options may be reasonably argued for and
against.  but lack of consistency is seldom any good;  r consistently
lacks consistency.

vQ


