From S.Ellison at LGCGroup.com  Mon Oct  1 13:38:18 2012
From: S.Ellison at LGCGroup.com (S Ellison)
Date: Mon, 1 Oct 2012 12:38:18 +0100
Subject: [Rd] Is there an automatic method for updating an existing CRAN
 package from R-forge?
In-Reply-To: <yajfipbj95ml.fsf@gmail.com>
References: <0CAEE2B1235DF643B0F5E1EAE1487B53094747F7@023-CH1MPN1-043.023d.mgd.msft.net>
	<40D65328-9CBA-4E2D-AAEA-DAC0636A18F8@gmail.com>
	<yajfipbj95ml.fsf@gmail.com>
Message-ID: <A4E5A0B016B8CB41A485FC629B633CED47A5A7B9CF@GOLD.corp.lgc-group.com>

I have a package on CRAN and now have a modest update that's passing build checks on R-forge. 

Is there a mechanism on R-forge for updating an existing CRAN package, analogous to the 'submit to cran' link on the R-forge package page, or should I just follow the instructions at  http://cran.r-project.org/web/packages/policies.html for FTP upload?

S Ellison


*******************************************************************
This email and any attachments are confidential. Any use...{{dropped:8}}


From murdoch.duncan at gmail.com  Mon Oct  1 13:47:45 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 01 Oct 2012 07:47:45 -0400
Subject: [Rd] Is there an automatic method for updating an existing CRAN
 package from R-forge?
In-Reply-To: <A4E5A0B016B8CB41A485FC629B633CED47A5A7B9CF@GOLD.corp.lgc-group.com>
References: <0CAEE2B1235DF643B0F5E1EAE1487B53094747F7@023-CH1MPN1-043.023d.mgd.msft.net>
	<40D65328-9CBA-4E2D-AAEA-DAC0636A18F8@gmail.com>
	<yajfipbj95ml.fsf@gmail.com>
	<A4E5A0B016B8CB41A485FC629B633CED47A5A7B9CF@GOLD.corp.lgc-group.com>
Message-ID: <506982E1.1080106@gmail.com>

On 12-10-01 7:38 AM, S Ellison wrote:
> I have a package on CRAN and now have a modest update that's passing build checks on R-forge.
>
> Is there a mechanism on R-forge for updating an existing CRAN package, analogous to the 'submit to cran' link on the R-forge package page, or should I just follow the instructions at  http://cran.r-project.org/web/packages/policies.html for FTP upload?

If there were a "Submit to CRAN" button, that would be the method.  But 
I think that button has gone away, so the description on that page is 
the way to go.

Duncan Murdoch


From edd at debian.org  Mon Oct  1 13:55:10 2012
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 1 Oct 2012 06:55:10 -0500
Subject: [Rd] Is there an automatic method for updating an existing CRAN
 package from R-forge?
In-Reply-To: <A4E5A0B016B8CB41A485FC629B633CED47A5A7B9CF@GOLD.corp.lgc-group.com>
References: <0CAEE2B1235DF643B0F5E1EAE1487B53094747F7@023-CH1MPN1-043.023d.mgd.msft.net>
	<40D65328-9CBA-4E2D-AAEA-DAC0636A18F8@gmail.com>
	<yajfipbj95ml.fsf@gmail.com>
	<A4E5A0B016B8CB41A485FC629B633CED47A5A7B9CF@GOLD.corp.lgc-group.com>
Message-ID: <20585.33950.54462.979249@max.nulle.part>


On 1 October 2012 at 12:38, S Ellison wrote:
| I have a package on CRAN and now have a modest update that's passing build checks on R-forge. 
| 
| Is there a mechanism on R-forge for updating an existing CRAN package, analogous to the 'submit to cran' link on the R-forge package page, or should I just follow the instructions at  http://cran.r-project.org/web/packages/policies.html for FTP upload?

I prefer to do this 'by hand' but my understanding is that 'submit to cran'
is equivalent to 'push this current version to CRAN' --- and not to 'make one
initial upload' as you seem to read it.  So I say go for it.

Quite a few people seem to push from R-Forge if I read another field in
the DESCRIPTION file (once on CRAN) correctly.

Dirk

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From spencer.graves at prodsyse.com  Mon Oct  1 17:09:39 2012
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Mon, 01 Oct 2012 08:09:39 -0700
Subject: [Rd] Is there an automatic method for updating an existing CRAN
 package from R-forge?
In-Reply-To: <506982E1.1080106@gmail.com>
References: <0CAEE2B1235DF643B0F5E1EAE1487B53094747F7@023-CH1MPN1-043.023d.mgd.msft.net>
	<40D65328-9CBA-4E2D-AAEA-DAC0636A18F8@gmail.com>
	<yajfipbj95ml.fsf@gmail.com>
	<A4E5A0B016B8CB41A485FC629B633CED47A5A7B9CF@GOLD.corp.lgc-group.com>
	<506982E1.1080106@gmail.com>
Message-ID: <5069B233.4040200@prodsyse.com>

On 10/1/2012 4:47 AM, Duncan Murdoch wrote:
> On 12-10-01 7:38 AM, S Ellison wrote:
>> I have a package on CRAN and now have a modest update that's passing 
>> build checks on R-forge.
>>
>> Is there a mechanism on R-forge for updating an existing CRAN 
>> package, analogous to the 'submit to cran' link on the R-forge 
>> package page, or should I just follow the instructions at 
>> http://cran.r-project.org/web/packages/policies.html for FTP upload?
>
> If there were a "Submit to CRAN" button, that would be the method.  
> But I think that button has gone away, so the description on that page 
> is the way to go.


       The "Submit to CRAN" button on that page is hidden by default but 
is exposed by clicking on the "Show/Hide extra info" button right below 
where it gives "Build Status" and "R install command". (I had trouble 
finding the "Submit to CRAN" button for a while after it became hidden.  
You need "Build status:  Current".  Also, at least the for last 
submissions I made, the CRAN maintainers did NOT accept updates if there 
were Warnings or Notes in the "Package Checks";  these warnings are also 
hidden until you click "Show/Hide extra info".)


       Spencer
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Spencer Graves, PE, PhD
President and Chief Technology Officer
Structure Inspection and Monitoring, Inc.
751 Emerson Ct.
San Jos?, CA 95126
ph:  408-655-4567
web:  www.structuremonitoring.com


From pgilbert902 at gmail.com  Mon Oct  1 18:30:38 2012
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Mon, 01 Oct 2012 12:30:38 -0400
Subject: [Rd] Is there an automatic method for updating an existing CRAN
 package from R-forge?
In-Reply-To: <5069B233.4040200@prodsyse.com>
References: <0CAEE2B1235DF643B0F5E1EAE1487B53094747F7@023-CH1MPN1-043.023d.mgd.msft.net>
	<40D65328-9CBA-4E2D-AAEA-DAC0636A18F8@gmail.com>
	<yajfipbj95ml.fsf@gmail.com>
	<A4E5A0B016B8CB41A485FC629B633CED47A5A7B9CF@GOLD.corp.lgc-group.com>
	<506982E1.1080106@gmail.com> <5069B233.4040200@prodsyse.com>
Message-ID: <5069C52E.5030106@gmail.com>

Yes, the button is still there if you are logged in and unhide it. (You 
probably also need the appropriate developer permission.) Beware that 
R-forge needs to indicate the package build status is current, but also, 
if you have just made svn updates it may falsely indicate current. Check 
the revision number is accurate, or wait a couple of days, or submit "by 
hand".

If you do submit by ftp to incoming, beware that the CRAN policy now 
requires that your email state that you have read and agree with the 
CRAN policies. (Probably everyone else noticed that, but there is no 
need for others to generate extra work for CRAN maintainers, like I have 
just done.)

Paul

On 12-10-01 11:09 AM, Spencer Graves wrote:
> On 10/1/2012 4:47 AM, Duncan Murdoch wrote:
>> On 12-10-01 7:38 AM, S Ellison wrote:
>>> I have a package on CRAN and now have a modest update that's passing
>>> build checks on R-forge.
>>>
>>> Is there a mechanism on R-forge for updating an existing CRAN
>>> package, analogous to the 'submit to cran' link on the R-forge
>>> package page, or should I just follow the instructions at
>>> http://cran.r-project.org/web/packages/policies.html for FTP upload?
>>
>> If there were a "Submit to CRAN" button, that would be the method. But
>> I think that button has gone away, so the description on that page is
>> the way to go.
>
>
>        The "Submit to CRAN" button on that page is hidden by default but
> is exposed by clicking on the "Show/Hide extra info" button right below
> where it gives "Build Status" and "R install command". (I had trouble
> finding the "Submit to CRAN" button for a while after it became hidden.
> You need "Build status:  Current".  Also, at least the for last
> submissions I made, the CRAN maintainers did NOT accept updates if there
> were Warnings or Notes in the "Package Checks";  these warnings are also
> hidden until you click "Show/Hide extra info".)
>
>
>        Spencer
>>
>> Duncan Murdoch
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>


From spencer.graves at prodsyse.com  Mon Oct  1 19:27:00 2012
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Mon, 01 Oct 2012 10:27:00 -0700
Subject: [Rd] Is there an automatic method for updating an existing CRAN
 package from R-forge?
In-Reply-To: <5069C52E.5030106@gmail.com>
References: <0CAEE2B1235DF643B0F5E1EAE1487B53094747F7@023-CH1MPN1-043.023d.mgd.msft.net>
	<40D65328-9CBA-4E2D-AAEA-DAC0636A18F8@gmail.com>
	<yajfipbj95ml.fsf@gmail.com>
	<A4E5A0B016B8CB41A485FC629B633CED47A5A7B9CF@GOLD.corp.lgc-group.com>
	<506982E1.1080106@gmail.com> <5069B233.4040200@prodsyse.com>
	<5069C52E.5030106@gmail.com>
Message-ID: <5069D264.4010900@prodsyse.com>

On 10/1/2012 9:30 AM, Paul Gilbert wrote:
> Yes, the button is still there if you are logged in and unhide it. 
> (You probably also need the appropriate developer permission.) Beware 
> that R-forge needs to indicate the package build status is current, 
> but also, if you have just made svn updates it may falsely indicate 
> current. Check the revision number is accurate, or wait a couple of 
> days, or submit "by hand".
>
> If you do submit by ftp to incoming, beware that the CRAN policy now 
> requires that your email state that you have read and agree with the 
> CRAN policies. (Probably everyone else noticed that, but there is no 
> need for others to generate extra work for CRAN maintainers, like I 
> have just done.)


       ... and like I did also.


       I still think it would be good to look for grant money or to 
encourage donations by at least offering to provide an invoice to those 
(like Jim Ramsay) who have grant money and can pay an invoice but can't 
make contributions!  If done in the right way, more money could make 
life easier for the current CRAN maintainers, thereby giving them more 
time to develop new statistical algorithms, because they would no longer 
need as much time to maintain a database that is growing not quite 
exponentially.


       Spencer

>
> Paul
>
> On 12-10-01 11:09 AM, Spencer Graves wrote:
>> On 10/1/2012 4:47 AM, Duncan Murdoch wrote:
>>> On 12-10-01 7:38 AM, S Ellison wrote:
>>>> I have a package on CRAN and now have a modest update that's passing
>>>> build checks on R-forge.
>>>>
>>>> Is there a mechanism on R-forge for updating an existing CRAN
>>>> package, analogous to the 'submit to cran' link on the R-forge
>>>> package page, or should I just follow the instructions at
>>>> http://cran.r-project.org/web/packages/policies.html for FTP upload?
>>>
>>> If there were a "Submit to CRAN" button, that would be the method. But
>>> I think that button has gone away, so the description on that page is
>>> the way to go.
>>
>>
>>        The "Submit to CRAN" button on that page is hidden by default but
>> is exposed by clicking on the "Show/Hide extra info" button right below
>> where it gives "Build Status" and "R install command". (I had trouble
>> finding the "Submit to CRAN" button for a while after it became hidden.
>> You need "Build status:  Current".  Also, at least the for last
>> submissions I made, the CRAN maintainers did NOT accept updates if there
>> were Warnings or Notes in the "Package Checks";  these warnings are also
>> hidden until you click "Show/Hide extra info".)
>>
>>
>>        Spencer
>>>
>>> Duncan Murdoch
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Spencer Graves, PE, PhD
President and Chief Technology Officer
Structure Inspection and Monitoring, Inc.
751 Emerson Ct.
San Jos?, CA 95126
ph:  408-655-4567
web:  www.structuremonitoring.com


From hpages at fhcrc.org  Tue Oct  2 00:20:09 2012
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Mon, 01 Oct 2012 15:20:09 -0700
Subject: [Rd] False positive note about ambiguous dispatch
Message-ID: <506A1719.2010904@fhcrc.org>

Hi,

In the situation below the note issued by the dispatch algo doesn't
seem right:

   setClass("A", representation(stuff="complex"))
   setAs("ANY", "A", function(from) new("A", stuff=as.complex(from)))

   > as(6, "A")
   An object of class "A"
   Slot "stuff":
   [1] 6+0i

   > as(6L, "A")
   Note: Method with signature ?numeric#A? chosen for function ?coerce?,
  target signature ?integer#A?.
    "ANY#A" would also be valid
   An object of class "A"
   Slot "stuff":
   [1] 6+0i

First thing is that the note is in contradiction with the output of
selectMethod (seems like it's the method with signature "ANY#A" that
was chosen, not the method with signature "numeric#A"):

   > selectMethod("coerce", c("integer", "A"))
   Method Definition:

   function (from, to = "A", strict = TRUE)
   new("A", stuff = as.complex(from))

   Signatures:
           from      to
   target  "integer" "A"
   defined "ANY"     "A"

Second, and more importantly, there is no need for a note in the first
place because there is no ambiguity at all (the method for "numeric#A"
itself is inherited from "ANY#A"):

   > selectMethod("coerce", c("numeric", "A"))
   Method Definition:

   function (from, to = "A", strict = TRUE)
   new("A", stuff = as.complex(from))

   Signatures:
           from      to
   target  "numeric" "A"
   defined "ANY"     "A"

showMethod gives me an overview of the situation (which is much
simpler/cleaner than what the note is suggesting):

   > showMethods("coerce")
   Function: coerce (package methods)
   from="ANY", to="A"
   ...
   from="integer", to="A"
       (inherited from: from="ANY", to="A")
   ...
   from="numeric", to="A"
       (inherited from: from="ANY", to="A")

Finally, if I switch the order (i.e. if I do 'as(6L, "A")' before
'as(6, "A")'), I don't get the note.

I get this with R 2.15.1 and a recent R devel (2012-09-22 r60777).
It looks like a regression because I was not able to reproduce with
R <= 2.14.

Thanks,
H.


-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From jmc at r-project.org  Tue Oct  2 22:56:23 2012
From: jmc at r-project.org (John Chambers)
Date: Tue, 02 Oct 2012 13:56:23 -0700
Subject: [Rd] False positive note about ambiguous dispatch
In-Reply-To: <506A1719.2010904@fhcrc.org>
References: <506A1719.2010904@fhcrc.org>
Message-ID: <506B54F7.20803@r-project.org>

The as() function does some non-standard stuff, and it appears in this 
example to set up methods for coerce() in a way that fools the 
disambiguation code (which is newer than the as() code, I think).

Pending a rewrite of as() (not imminent) the Note has been deactivated 
for the coerce() generic. (rev 60859)

Thanks for the catch.
   John


On 10/1/12 3:20 PM, Herv? Pag?s wrote:
> Hi,
>
> In the situation below the note issued by the dispatch algo doesn't
> seem right:
>
>    setClass("A", representation(stuff="complex"))
>    setAs("ANY", "A", function(from) new("A", stuff=as.complex(from)))
>
>    > as(6, "A")
>    An object of class "A"
>    Slot "stuff":
>    [1] 6+0i
>
>    > as(6L, "A")
>    Note: Method with signature ?numeric#A? chosen for function ?coerce?,
>   target signature ?integer#A?.
>     "ANY#A" would also be valid
>    An object of class "A"
>    Slot "stuff":
>    [1] 6+0i
>
> First thing is that the note is in contradiction with the output of
> selectMethod (seems like it's the method with signature "ANY#A" that
> was chosen, not the method with signature "numeric#A"):
>
>    > selectMethod("coerce", c("integer", "A"))
>    Method Definition:
>
>    function (from, to = "A", strict = TRUE)
>    new("A", stuff = as.complex(from))
>
>    Signatures:
>            from      to
>    target  "integer" "A"
>    defined "ANY"     "A"
>
> Second, and more importantly, there is no need for a note in the first
> place because there is no ambiguity at all (the method for "numeric#A"
> itself is inherited from "ANY#A"):
>
>    > selectMethod("coerce", c("numeric", "A"))
>    Method Definition:
>
>    function (from, to = "A", strict = TRUE)
>    new("A", stuff = as.complex(from))
>
>    Signatures:
>            from      to
>    target  "numeric" "A"
>    defined "ANY"     "A"
>
> showMethod gives me an overview of the situation (which is much
> simpler/cleaner than what the note is suggesting):
>
>    > showMethods("coerce")
>    Function: coerce (package methods)
>    from="ANY", to="A"
>    ...
>    from="integer", to="A"
>        (inherited from: from="ANY", to="A")
>    ...
>    from="numeric", to="A"
>        (inherited from: from="ANY", to="A")
>
> Finally, if I switch the order (i.e. if I do 'as(6L, "A")' before
> 'as(6, "A")'), I don't get the note.
>
> I get this with R 2.15.1 and a recent R devel (2012-09-22 r60777).
> It looks like a regression because I was not able to reproduce with
> R <= 2.14.
>
> Thanks,
> H.
>
>


From hpages at fhcrc.org  Tue Oct  2 23:24:13 2012
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 02 Oct 2012 14:24:13 -0700
Subject: [Rd] False positive note about ambiguous dispatch
In-Reply-To: <506B54F7.20803@r-project.org>
References: <506A1719.2010904@fhcrc.org> <506B54F7.20803@r-project.org>
Message-ID: <506B5B7D.4040401@fhcrc.org>

Thanks you.

H.

On 10/02/2012 01:56 PM, John Chambers wrote:
> The as() function does some non-standard stuff, and it appears in this
> example to set up methods for coerce() in a way that fools the
> disambiguation code (which is newer than the as() code, I think).
>
> Pending a rewrite of as() (not imminent) the Note has been deactivated
> for the coerce() generic. (rev 60859)
>
> Thanks for the catch.
>    John
>
>
> On 10/1/12 3:20 PM, Herv? Pag?s wrote:
>> Hi,
>>
>> In the situation below the note issued by the dispatch algo doesn't
>> seem right:
>>
>>    setClass("A", representation(stuff="complex"))
>>    setAs("ANY", "A", function(from) new("A", stuff=as.complex(from)))
>>
>>    > as(6, "A")
>>    An object of class "A"
>>    Slot "stuff":
>>    [1] 6+0i
>>
>>    > as(6L, "A")
>>    Note: Method with signature ?numeric#A? chosen for function ?coerce?,
>>   target signature ?integer#A?.
>>     "ANY#A" would also be valid
>>    An object of class "A"
>>    Slot "stuff":
>>    [1] 6+0i
>>
>> First thing is that the note is in contradiction with the output of
>> selectMethod (seems like it's the method with signature "ANY#A" that
>> was chosen, not the method with signature "numeric#A"):
>>
>>    > selectMethod("coerce", c("integer", "A"))
>>    Method Definition:
>>
>>    function (from, to = "A", strict = TRUE)
>>    new("A", stuff = as.complex(from))
>>
>>    Signatures:
>>            from      to
>>    target  "integer" "A"
>>    defined "ANY"     "A"
>>
>> Second, and more importantly, there is no need for a note in the first
>> place because there is no ambiguity at all (the method for "numeric#A"
>> itself is inherited from "ANY#A"):
>>
>>    > selectMethod("coerce", c("numeric", "A"))
>>    Method Definition:
>>
>>    function (from, to = "A", strict = TRUE)
>>    new("A", stuff = as.complex(from))
>>
>>    Signatures:
>>            from      to
>>    target  "numeric" "A"
>>    defined "ANY"     "A"
>>
>> showMethod gives me an overview of the situation (which is much
>> simpler/cleaner than what the note is suggesting):
>>
>>    > showMethods("coerce")
>>    Function: coerce (package methods)
>>    from="ANY", to="A"
>>    ...
>>    from="integer", to="A"
>>        (inherited from: from="ANY", to="A")
>>    ...
>>    from="numeric", to="A"
>>        (inherited from: from="ANY", to="A")
>>
>> Finally, if I switch the order (i.e. if I do 'as(6L, "A")' before
>> 'as(6, "A")'), I don't get the note.
>>
>> I get this with R 2.15.1 and a recent R devel (2012-09-22 r60777).
>> It looks like a regression because I was not able to reproduce with
>> R <= 2.14.
>>
>> Thanks,
>> H.
>>
>>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From joshmobrien at gmail.com  Tue Oct  2 23:17:36 2012
From: joshmobrien at gmail.com (Josh O'Brien)
Date: Tue, 2 Oct 2012 14:17:36 -0700
Subject: [Rd] Minor edit to R-ints doc will be needed for R-2.15.2: axis()
 no longer uses .Internal()
Message-ID: <CAOwKfPTb+QWx3Y7K4pKncL3_g-0Sd1H22NYOGLs4r4Mfb2XL5g@mail.gmail.com>

Hello,

The second paragraph of Chapter 2: .Internal vs .Primitive of R-ints
uses axis() as an example of a function that uses .Internal(). Here's
the quote:

> Functions using .Internal() wrapped in a closure are in general preferred as this ensures
> standard handling of named and default arguments. For example, axis is defined as
>
> axis <- function(side, at = NULL, labels = NULL, ...)
> .Internal(axis(side, at, labels, ...))

As of R-2.15.2, though, this will no longer be true; as noted in the
Code Migration section of R-devel NEWS file:

> The C code underlying base graphics has been migrated to the graphics package
> (and hence no longer uses .Internal() calls).

So, a different example may be needed.

(Please let me know if a message of this type is better directed
somewhere else, or if it should wait until after some milestone in the
development cycle.)

Thanks,

Josh


From hb at biostat.ucsf.edu  Wed Oct  3 02:19:38 2012
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Tue, 2 Oct 2012 17:19:38 -0700
Subject: [Rd] Fastest non-overlapping binning mean function out there?
Message-ID: <CAFDcVCQ0SPAYLsgtVxyYoakWQCJavj2QSfLwtNuzwH_U-AR8_g@mail.gmail.com>

Hi,

I'm looking for a super-duper fast mean/sum binning implementation
available in R, and before implementing z = binnedMeans(x y) in native
code myself, does any one know of an existing function/package for
this?  I'm sure it already exists.  So, given data (x,y) and B bins
bx[1] < bx[2] < ... < bx[B] < bx[B+1], I'd like to calculate the
binned means (or sums) 'z' such that z[1] = mean(x[bx[1] <= x & x <
bx[2]]), z[2] = mean(x[bx[2] <= x & x < bx[3]]), .... z[B].  Let's
assume there are no missing values and 'x' and 'bx' is already
ordered.  The length of 'x' is in the order of 10,000-millions.  The
number of elements in each bin vary.

Thanks,

Henrik


From hpages at fhcrc.org  Wed Oct  3 03:11:14 2012
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 02 Oct 2012 18:11:14 -0700
Subject: [Rd] Fastest non-overlapping binning mean function out there?
In-Reply-To: <CAFDcVCQ0SPAYLsgtVxyYoakWQCJavj2QSfLwtNuzwH_U-AR8_g@mail.gmail.com>
References: <CAFDcVCQ0SPAYLsgtVxyYoakWQCJavj2QSfLwtNuzwH_U-AR8_g@mail.gmail.com>
Message-ID: <506B90B2.3010602@fhcrc.org>

Hi Henrik,

On 10/02/2012 05:19 PM, Henrik Bengtsson wrote:
> Hi,
>
> I'm looking for a super-duper fast mean/sum binning implementation
> available in R, and before implementing z = binnedMeans(x y) in native
> code myself, does any one know of an existing function/package for
> this?  I'm sure it already exists.  So, given data (x,y) and B bins
> bx[1] < bx[2] < ... < bx[B] < bx[B+1], I'd like to calculate the
> binned means (or sums) 'z' such that z[1] = mean(x[bx[1] <= x & x <
> bx[2]]), z[2] = mean(x[bx[2] <= x & x < bx[3]]), .... z[B].  Let's
> assume there are no missing values and 'x' and 'bx' is already
> ordered.  The length of 'x' is in the order of 10,000-millions.  The
> number of elements in each bin vary.

You didn't say if you have a lot of bins or not. If you don't have a lot
of bins (e.g. < 10000), something like

   aggregate(x, by=list(bin=findInterval(x, bx)), FUN=mean)

might not be too bad:

   > x <- seq(0, 8, by=0.1)
   > bx <- c(2, 2.5, 4, 5.8)
   > aggregate(x, by=list(bin=findInterval(x, bx)), FUN=mean)
     bin    x
   1   0 0.95
   2   1 2.20
   3   2 3.20
   4   3 4.85
   5   4 6.90

I didn't try it on a 10,000-millions-elements vector though (and I've
no idea how I could do this).

H.


>
> Thanks,
>
> Henrik
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From hpages at fhcrc.org  Wed Oct  3 04:46:18 2012
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 02 Oct 2012 19:46:18 -0700
Subject: [Rd] Fastest non-overlapping binning mean function out there?
In-Reply-To: <506B90B2.3010602@fhcrc.org>
References: <CAFDcVCQ0SPAYLsgtVxyYoakWQCJavj2QSfLwtNuzwH_U-AR8_g@mail.gmail.com>
	<506B90B2.3010602@fhcrc.org>
Message-ID: <506BA6FA.9000405@fhcrc.org>

On 10/02/2012 06:11 PM, Herv? Pag?s wrote:
> Hi Henrik,
>
> On 10/02/2012 05:19 PM, Henrik Bengtsson wrote:
>> Hi,
>>
>> I'm looking for a super-duper fast mean/sum binning implementation
>> available in R, and before implementing z = binnedMeans(x y) in native
>> code myself, does any one know of an existing function/package for
>> this?  I'm sure it already exists.  So, given data (x,y) and B bins
>> bx[1] < bx[2] < ... < bx[B] < bx[B+1], I'd like to calculate the
>> binned means (or sums) 'z' such that z[1] = mean(x[bx[1] <= x & x <
>> bx[2]]), z[2] = mean(x[bx[2] <= x & x < bx[3]]), .... z[B].  Let's
>> assume there are no missing values and 'x' and 'bx' is already
>> ordered.  The length of 'x' is in the order of 10,000-millions.  The
>> number of elements in each bin vary.
>
> You didn't say if you have a lot of bins or not. If you don't have a lot
> of bins (e.g. < 10000), something like
>
>    aggregate(x, by=list(bin=findInterval(x, bx)), FUN=mean)
>
> might not be too bad:
>
>    > x <- seq(0, 8, by=0.1)
>    > bx <- c(2, 2.5, 4, 5.8)
>    > aggregate(x, by=list(bin=findInterval(x, bx)), FUN=mean)
>      bin    x
>    1   0 0.95
>    2   1 2.20
>    3   2 3.20
>    4   3 4.85
>    5   4 6.90

Of course, if you have a lot of bins, using aggregate() is not optimal.
But you can replace it by your own optimized version e.g.:

   ## 'bin' must be a sorted vector of non-negative integers of the
   ## same length as 'x'.
   fast_aggregate_mean <- function(x, bin, nbins)
   {
     bin_count <- tabulate(bin + 1L, nbins=nbins)
     diff(c(0L, cumsum(x)[cumsum(bin_count)])) / bin_count
   }

Then:

   bin <- findInterval(x, bx)
   fast_aggregate_mean(x, bin, nbins=length(bx)+1L)

On my machine this is 100x faster or more than using aggregate() when
the number of bins is > 100k. Memory usage is also reduced a lot.
Another benefit of using fast_aggregate_mean() over aggregate() is
that all the bins are represented in the output (aggregate() ignores
empty bins).

Cheers,
H.

>
> I didn't try it on a 10,000-millions-elements vector though (and I've
> no idea how I could do this).
>
> H.
>
>
>>
>> Thanks,
>>
>> Henrik
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From ripley at stats.ox.ac.uk  Wed Oct  3 08:33:56 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 03 Oct 2012 07:33:56 +0100
Subject: [Rd] Minor edit to R-ints doc will be needed for R-2.15.2:
 axis() no longer uses .Internal()
In-Reply-To: <CAOwKfPTb+QWx3Y7K4pKncL3_g-0Sd1H22NYOGLs4r4Mfb2XL5g@mail.gmail.com>
References: <CAOwKfPTb+QWx3Y7K4pKncL3_g-0Sd1H22NYOGLs4r4Mfb2XL5g@mail.gmail.com>
Message-ID: <506BDC54.2060704@stats.ox.ac.uk>

On 02/10/2012 22:17, Josh O'Brien wrote:
> Hello,
>
> The second paragraph of Chapter 2: .Internal vs .Primitive of R-ints
> uses axis() as an example of a function that uses .Internal(). Here's
> the quote:
>
>> Functions using .Internal() wrapped in a closure are in general preferred as this ensures
>> standard handling of named and default arguments. For example, axis is defined as
>>
>> axis <- function(side, at = NULL, labels = NULL, ...)
>> .Internal(axis(side, at, labels, ...))
>
> As of R-2.15.2, though, this will no longer be true; as noted in the
> Code Migration section of R-devel NEWS file:
>
>> The C code underlying base graphics has been migrated to the graphics package
>> (and hence no longer uses .Internal() calls).
>
> So, a different example may be needed.

Not for 2.15.2 (which is not even mentioned in that file but will 
include the changes for 2.15.1 patched): that section of NEWS is about 
R-devel.

> (Please let me know if a message of this type is better directed
> somewhere else, or if it should wait until after some milestone in the
> development cycle.)

Yes, when R 2.16.0 is in its alpha/beta test period.  You are commenting 
on a change (code migration) that is still in progress. Manuals are 
reviewed once a R 2.x.0 version goes into feature-freeze.

>
> Thanks,
>
> Josh
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From therneau at mayo.edu  Wed Oct  3 14:50:45 2012
From: therneau at mayo.edu (Terry Therneau)
Date: Wed, 03 Oct 2012 07:50:45 -0500
Subject: [Rd] Fastest non-overlapping binning mean function out there?
In-Reply-To: <mailman.29.1349258410.27737.r-devel@r-project.org>
References: <mailman.29.1349258410.27737.r-devel@r-project.org>
Message-ID: <506C34A5.8000603@mayo.edu>

Look at rowsum.  It's pretty fast C code.

Terry T

On 10/03/2012 05:00 AM, r-devel-request at r-project.org wrote:
> Hi,
>
> I'm looking for a super-duper fast mean/sum binning implementation
> available in R, and before implementing z = binnedMeans(x y) in native
> code myself, does any one know of an existing function/package for
> this?  I'm sure it already exists.  So, given data (x,y) and B bins
> bx[1]<  bx[2]<  ...<  bx[B]<  bx[B+1], I'd like to calculate the
> binned means (or sums) 'z' such that z[1] = mean(x[bx[1]<= x&  x<
> bx[2]]), z[2] = mean(x[bx[2]<= x&  x<  bx[3]]), .... z[B].  Let's
> assume there are no missing values and 'x' and 'bx' is already
> ordered.  The length of 'x' is in the order of 10,000-millions.  The
> number of elements in each bin vary.
>
> Thanks,
>
> Henrik


From mtmorgan at fhcrc.org  Wed Oct  3 15:47:11 2012
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Wed, 03 Oct 2012 06:47:11 -0700
Subject: [Rd] Fastest non-overlapping binning mean function out there?
In-Reply-To: <CAFDcVCQ0SPAYLsgtVxyYoakWQCJavj2QSfLwtNuzwH_U-AR8_g@mail.gmail.com>
References: <CAFDcVCQ0SPAYLsgtVxyYoakWQCJavj2QSfLwtNuzwH_U-AR8_g@mail.gmail.com>
Message-ID: <506C41DF.2080204@fhcrc.org>

On 10/02/2012 05:19 PM, Henrik Bengtsson wrote:
> Hi,
>
> I'm looking for a super-duper fast mean/sum binning implementation
> available in R, and before implementing z = binnedMeans(x y) in native
> code myself, does any one know of an existing function/package for
> this?  I'm sure it already exists.  So, given data (x,y) and B bins
> bx[1] < bx[2] < ... < bx[B] < bx[B+1], I'd like to calculate the
> binned means (or sums) 'z' such that z[1] = mean(x[bx[1] <= x & x <
> bx[2]]), z[2] = mean(x[bx[2] <= x & x < bx[3]]), .... z[B].  Let's
> assume there are no missing values and 'x' and 'bx' is already
> ordered.  The length of 'x' is in the order of 10,000-millions.  The
> number of elements in each bin vary.

since x and bx are ordered (sorting x would be expensive), the C code seems 
pretty straight-forward and memory-efficient -- create a result vector as long 
as bx, then iterate through x accumulating n and it's sum until x[i] >= bx[i]. 
(I think R's implementation of mean() actually pays more attention to numerical 
error, but with this much data...)

library(inline)
binmean <- cfunction(signature(x="numeric", bx="numeric"),
"   int nx = Rf_length(x), nb = Rf_length(bx), i, j, n;
     SEXP ans = PROTECT(NEW_NUMERIC(nb));
     double sum, *xp = REAL(x), *bxp = REAL(bx), *ansp = REAL(ans);
     sum = j = n = 0;
     for (i = 0; i < nx; ++i) {
         while (xp[i] >= bxp[j]) {
              ansp[j++] = n > 0 ? sum / n : 0;
              sum = n = 0;
         }
         n += 1;
         sum += xp[i];
     }
     ansp[j] = n > 0 ? sum / n : 0;
     UNPROTECT(1);
     return ans;
")

with a test case

nx <- 4e7
nb <- 1e3
x <- sort(runif(nx))
bx <- do.call(seq, c(as.list(range(x)), length.out=nb))

leading to

 > bx1 <- c(bx[-1], bx[nb] + 1)
 > system.time(res <- binmean(x, bx1))
    user  system elapsed
   0.052   0.000   0.050

Martin

>
> Thanks,
>
> Henrik
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From h.wickham at gmail.com  Wed Oct  3 16:16:48 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Wed, 3 Oct 2012 09:16:48 -0500
Subject: [Rd] Creating functions programmatically
Message-ID: <CABdHhvH9Q3L16aCQPg=Tn5N+GqJTDW2vhf3=y6_DYcUOXwYvmQ@mail.gmail.com>

Hi all,

A function has three components: arguments, body and environment. Is
there no base function that allows us to create a function from those
three components?

The best I could come up with is:

make_function <- function(args, body, env = parent.frame()) {
  args <- as.pairlist(args)
  stopifnot(is.language(body))
  f <- eval(call("function", args, body))
  environment(f) <- env
  f
}
mquote <- function(...) as.list(substitute(list(...))[-1])

add <- make_function(mquote(a = 1, b = a), quote(a + b))
add(1)
add(1, 2)

add2 <- make_function(mquote(a = 1, b = a), quote(a + b + d))
d <- 3
add2(1)

Am I missing a built in way to do this?  Also, is there a built in
equivalent to my mquote (= multiquote, for producing a named list of
quoted inputs)?

Thanks!

Hadley

-- 
RStudio / Rice University
http://had.co.nz/


From h.wickham at gmail.com  Wed Oct  3 16:22:09 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Wed, 3 Oct 2012 09:22:09 -0500
Subject: [Rd] Creating functions programmatically
In-Reply-To: <CABdHhvH9Q3L16aCQPg=Tn5N+GqJTDW2vhf3=y6_DYcUOXwYvmQ@mail.gmail.com>
References: <CABdHhvH9Q3L16aCQPg=Tn5N+GqJTDW2vhf3=y6_DYcUOXwYvmQ@mail.gmail.com>
Message-ID: <CABdHhvFdaZfhjN3Gk3VMg_qC36fi9=HzzEDBp4XUvgD_9K4W1w@mail.gmail.com>

> Am I missing a built in way to do this?  Also, is there a built in
> equivalent to my mquote (= multiquote, for producing a named list of
> quoted inputs)?

Oops, built in equivalent to mquote is alist.  (It would be really
handy if that was referenced from quote)

Hadley

-- 
RStudio / Rice University
http://had.co.nz/


From murdoch.duncan at gmail.com  Wed Oct  3 16:26:39 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 03 Oct 2012 10:26:39 -0400
Subject: [Rd] Creating functions programmatically
In-Reply-To: <CABdHhvH9Q3L16aCQPg=Tn5N+GqJTDW2vhf3=y6_DYcUOXwYvmQ@mail.gmail.com>
References: <CABdHhvH9Q3L16aCQPg=Tn5N+GqJTDW2vhf3=y6_DYcUOXwYvmQ@mail.gmail.com>
Message-ID: <506C4B1F.3070403@gmail.com>

On 03/10/2012 10:16 AM, Hadley Wickham wrote:
> Hi all,
>
> A function has three components: arguments, body and environment. Is
> there no base function that allows us to create a function from those
> three components?

There is:  it is `function`.  The parser converts your function 
definitions into a call to it.  (It has 3 arguments: the formals, the 
body, and the srcref.  The environment is added when it is evaluated.)

So your make_function below is pretty similar (but because `function` is 
primitive, some of the evaluation rules might be different).

Duncan Murdoch

> The best I could come up with is:
>
> make_function <- function(args, body, env = parent.frame()) {
>    args <- as.pairlist(args)
>    stopifnot(is.language(body))
>    f <- eval(call("function", args, body))
>    environment(f) <- env
>    f
> }
> mquote <- function(...) as.list(substitute(list(...))[-1])
>
> add <- make_function(mquote(a = 1, b = a), quote(a + b))
> add(1)
> add(1, 2)
>
> add2 <- make_function(mquote(a = 1, b = a), quote(a + b + d))
> d <- 3
> add2(1)
>
> Am I missing a built in way to do this?  Also, is there a built in
> equivalent to my mquote (= multiquote, for producing a named list of
> quoted inputs)?
>
> Thanks!
>
> Hadley
>


From gmbecker at ucdavis.edu  Wed Oct  3 16:33:03 2012
From: gmbecker at ucdavis.edu (Gabriel Becker)
Date: Wed, 3 Oct 2012 07:33:03 -0700
Subject: [Rd] Creating functions programmatically
In-Reply-To: <506C4B1F.3070403@gmail.com>
References: <CABdHhvH9Q3L16aCQPg=Tn5N+GqJTDW2vhf3=y6_DYcUOXwYvmQ@mail.gmail.com>
	<506C4B1F.3070403@gmail.com>
Message-ID: <CADwqtCMEax2uGOioVDJhWsobJaB5Tk0XT=Ympze6wLvUMsrLSQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121003/c8b1bf87/attachment.pl>

From h.wickham at gmail.com  Wed Oct  3 16:47:12 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Wed, 3 Oct 2012 09:47:12 -0500
Subject: [Rd] Creating functions programmatically
In-Reply-To: <506C4B1F.3070403@gmail.com>
References: <CABdHhvH9Q3L16aCQPg=Tn5N+GqJTDW2vhf3=y6_DYcUOXwYvmQ@mail.gmail.com>
	<506C4B1F.3070403@gmail.com>
Message-ID: <CABdHhvGhFHTVUvCY_n9_VaxyEZ8+P7rZjZMh9wqQQZyDmQZSAA@mail.gmail.com>

> There is:  it is `function`.  The parser converts your function definitions
> into a call to it.  (It has 3 arguments: the formals, the body, and the
> srcref.  The environment is added when it is evaluated.)
>
> So your make_function below is pretty similar (but because `function` is
> primitive, some of the evaluation rules might be different).

Hmm, I thought I had it working, but now I can't figure out the
arguments to `function`:

> `function`(NULL,NULL)
function ()
NULL

> `function`(alist(a = 1), NULL)
Error: invalid formal argument list for "function"

I'm obviously missing something dumb.

Thanks!

Hadley

-- 
RStudio / Rice University
http://had.co.nz/


From h.wickham at gmail.com  Wed Oct  3 16:49:57 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Wed, 3 Oct 2012 09:49:57 -0500
Subject: [Rd] Creating functions programmatically
In-Reply-To: <CADwqtCMEax2uGOioVDJhWsobJaB5Tk0XT=Ympze6wLvUMsrLSQ@mail.gmail.com>
References: <CABdHhvH9Q3L16aCQPg=Tn5N+GqJTDW2vhf3=y6_DYcUOXwYvmQ@mail.gmail.com>
	<506C4B1F.3070403@gmail.com>
	<CADwqtCMEax2uGOioVDJhWsobJaB5Tk0XT=Ympze6wLvUMsrLSQ@mail.gmail.com>
Message-ID: <CABdHhvEF04Z0bzWZP-BU60ymdMpgaS68tVsEq5XFme_1-USiQA@mail.gmail.com>

On Wed, Oct 3, 2012 at 9:33 AM, Gabriel Becker <gmbecker at ucdavis.edu> wrote:
> Hadley,
>
> You could do this:
>
> make_fun = function(args, body, env)
> {
> f = function()
> formals(f) = args
> body(f) = body
> environment(f) = env
> f
> }
>
> If for some reason using function() itself as Duncan suggested won't work.

Oh that's an approach that's easier to explain to others - thanks!

Hadley

-- 
RStudio / Rice University
http://had.co.nz/


From gmbecker at ucdavis.edu  Wed Oct  3 17:04:38 2012
From: gmbecker at ucdavis.edu (Gabriel Becker)
Date: Wed, 3 Oct 2012 08:04:38 -0700
Subject: [Rd] Creating functions programmatically
In-Reply-To: <CABdHhvEF04Z0bzWZP-BU60ymdMpgaS68tVsEq5XFme_1-USiQA@mail.gmail.com>
References: <CABdHhvH9Q3L16aCQPg=Tn5N+GqJTDW2vhf3=y6_DYcUOXwYvmQ@mail.gmail.com>
	<506C4B1F.3070403@gmail.com>
	<CADwqtCMEax2uGOioVDJhWsobJaB5Tk0XT=Ympze6wLvUMsrLSQ@mail.gmail.com>
	<CABdHhvEF04Z0bzWZP-BU60ymdMpgaS68tVsEq5XFme_1-USiQA@mail.gmail.com>
Message-ID: <CADwqtCOyJbV8PWqHsbvH+ktcbFUUJyHktwoEjngX-XU67nbesw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121003/843e0f30/attachment.pl>

From pdalgd at gmail.com  Wed Oct  3 17:41:17 2012
From: pdalgd at gmail.com (peter dalgaard)
Date: Wed, 3 Oct 2012 17:41:17 +0200
Subject: [Rd] Creating functions programmatically
In-Reply-To: <CABdHhvEF04Z0bzWZP-BU60ymdMpgaS68tVsEq5XFme_1-USiQA@mail.gmail.com>
References: <CABdHhvH9Q3L16aCQPg=Tn5N+GqJTDW2vhf3=y6_DYcUOXwYvmQ@mail.gmail.com>
	<506C4B1F.3070403@gmail.com>
	<CADwqtCMEax2uGOioVDJhWsobJaB5Tk0XT=Ympze6wLvUMsrLSQ@mail.gmail.com>
	<CABdHhvEF04Z0bzWZP-BU60ymdMpgaS68tVsEq5XFme_1-USiQA@mail.gmail.com>
Message-ID: <A67545E5-155E-40F7-9B94-E30AB41EFE37@gmail.com>


On Oct 3, 2012, at 16:49 , Hadley Wickham wrote:

> On Wed, Oct 3, 2012 at 9:33 AM, Gabriel Becker <gmbecker at ucdavis.edu> wrote:
>> Hadley,
>> 
>> You could do this:
>> 
>> make_fun = function(args, body, env)
>> {
>> f = function()
>> formals(f) = args
>> body(f) = body
>> environment(f) = env
>> f
>> }
>> 
>> If for some reason using function() itself as Duncan suggested won't work.
> 
> Oh that's an approach that's easier to explain to others - thanks!
> 
> Hadley

There's also as.function(), although its semantics are a bit arcane. It and the converse as.list.function() have their origin in S-PLUS, where it was commonplace (or relatively so) to treat a function as a list, like in ls[[2]].

> 
> -- 
> RStudio / Rice University
> http://had.co.nz/
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From S.Ellison at LGCGroup.com  Wed Oct  3 18:20:38 2012
From: S.Ellison at LGCGroup.com (S Ellison)
Date: Wed, 3 Oct 2012 17:20:38 +0100
Subject: [Rd] Is there an automatic method for updating an existing CRAN
 package from R-forge? - resolved
In-Reply-To: <20585.33950.54462.979249@max.nulle.part>
References: <0CAEE2B1235DF643B0F5E1EAE1487B53094747F7@023-CH1MPN1-043.023d.mgd.msft.net>
	<40D65328-9CBA-4E2D-AAEA-DAC0636A18F8@gmail.com>
	<yajfipbj95ml.fsf@gmail.com>
	<A4E5A0B016B8CB41A485FC629B633CED47A5A7B9CF@GOLD.corp.lgc-group.com>
	<20585.33950.54462.979249@max.nulle.part>
Message-ID: <A4E5A0B016B8CB41A485FC629B633CED47A5ADA441@GOLD.corp.lgc-group.com>

 

>> | Is there a mechanism on R-forge for updating an existing 
>> CRAN package, analogous to the 'submit to cran' link on the 
>> R-forge package page, ....

> I prefer to do this 'by hand' but my understanding is that  'submit to cran'
> is equivalent to 'push this current version to CRAN' --- and 
> not to 'make one initial upload' as you seem to read it.  So 
> I say go for it.

I had; it was when it failed that I posted the question. 

However, you've encouraged me to try again and that helped; the second attempt indicates that I had misunderstood the error message. It wasnt indicating a clash with an existing package name but a clash with an existing version number. Probable explanation: I have failed to update my DESCRIPTION file. 

Apologies for wasting folks' time. Again.

S Ellison


*******************************************************************
This email and any attachments are confidential. Any use...{{dropped:8}}


From mtmorgan at fhcrc.org  Wed Oct  3 22:50:07 2012
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Wed, 03 Oct 2012 13:50:07 -0700
Subject: [Rd] Fastest non-overlapping binning mean function out there?
In-Reply-To: <506C41DF.2080204@fhcrc.org>
References: <CAFDcVCQ0SPAYLsgtVxyYoakWQCJavj2QSfLwtNuzwH_U-AR8_g@mail.gmail.com>
	<506C41DF.2080204@fhcrc.org>
Message-ID: <506CA4FF.7090806@fhcrc.org>

On 10/3/2012 6:47 AM, Martin Morgan wrote:
> On 10/02/2012 05:19 PM, Henrik Bengtsson wrote:
>> Hi,
>>
>> I'm looking for a super-duper fast mean/sum binning implementation
>> available in R, and before implementing z = binnedMeans(x y) in native
>> code myself, does any one know of an existing function/package for
>> this?  I'm sure it already exists.  So, given data (x,y) and B bins
>> bx[1] < bx[2] < ... < bx[B] < bx[B+1], I'd like to calculate the
>> binned means (or sums) 'z' such that z[1] = mean(x[bx[1] <= x & x <
>> bx[2]]), z[2] = mean(x[bx[2] <= x & x < bx[3]]), .... z[B].  Let's
>> assume there are no missing values and 'x' and 'bx' is already
>> ordered.  The length of 'x' is in the order of 10,000-millions.  The
>> number of elements in each bin vary.
>
> since x and bx are ordered (sorting x would be expensive), the C code seems
> pretty straight-forward and memory-efficient -- create a result vector as long
> as bx, then iterate through x accumulating n and it's sum until x[i] >= bx[i].
> (I think R's implementation of mean() actually pays more attention to numerical
> error, but with this much data...)
>
> library(inline)
> binmean <- cfunction(signature(x="numeric", bx="numeric"),
> "   int nx = Rf_length(x), nb = Rf_length(bx), i, j, n;

I'll take my solution back. The problem specification says that x has 
10,000-millions of elements, so we need to use R-devel and

     R_xlen_t nx = Rf_xlength(x), nb = Rf_xlength(bx), i, j, n;

but there are two further issues. The first is that on my system

p$ gcc --version
gcc (Ubuntu/Linaro 4.6.3-1ubuntu5) 4.6.3

I have __SIZEOF_SIZE_T__ 8 but

(a) the test in Rinternals.h:52 is of SIZEOF_SIZE_T, which is undefined. I end 
up with typedef int R_xlen_t (e.g., after R CMD SHLIB, instead of using the 
inline package, to avoid that level of uncertainty) and then

>      SEXP ans = PROTECT(NEW_NUMERIC(nb));
>      double sum, *xp = REAL(x), *bxp = REAL(bx), *ansp = REAL(ans);
>      sum = j = n = 0;
>      for (i = 0; i < nx; ++i) {

(b) because nx is a signed type, and since nx > .Machine$integer.max is 
represented as a negative number, I don't ever iterate this loop. So I'd have to 
be more clever if I wanted this to work on all platforms.

For what it's worth, Herve's solution is also problematic

 > xx = findInterval(bx, x)
Error in findInterval(bx, x) : long vector 'vec' is not supported

A different strategy for the problem at hand would seem to involve iteration 
over sequences of x, collecting sufficient statistics (n, sum) for each 
iteration, and calculating the mean at the end of the day. This might also 
result in better memory use and allow parallel processing.

Martin

>          while (xp[i] >= bxp[j]) {
>               ansp[j++] = n > 0 ? sum / n : 0;
>               sum = n = 0;
>          }
>          n += 1;
>          sum += xp[i];
>      }
>      ansp[j] = n > 0 ? sum / n : 0;
>      UNPROTECT(1);
>      return ans;
> ")
>
> with a test case
>
> nx <- 4e7
> nb <- 1e3
> x <- sort(runif(nx))
> bx <- do.call(seq, c(as.list(range(x)), length.out=nb))
>
> leading to
>
>  > bx1 <- c(bx[-1], bx[nb] + 1)
>  > system.time(res <- binmean(x, bx1))
>     user  system elapsed
>    0.052   0.000   0.050
>
> Martin
>
>>
>> Thanks,
>>
>> Henrik
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>


-- 
Dr. Martin Morgan, PhD
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109


From peter.meilstrup at gmail.com  Thu Oct  4 00:05:53 2012
From: peter.meilstrup at gmail.com (Peter Meilstrup)
Date: Wed, 3 Oct 2012 15:05:53 -0700
Subject: [Rd] Creating functions programmatically
In-Reply-To: <CABdHhvGhFHTVUvCY_n9_VaxyEZ8+P7rZjZMh9wqQQZyDmQZSAA@mail.gmail.com>
References: <CABdHhvH9Q3L16aCQPg=Tn5N+GqJTDW2vhf3=y6_DYcUOXwYvmQ@mail.gmail.com>
	<506C4B1F.3070403@gmail.com>
	<CABdHhvGhFHTVUvCY_n9_VaxyEZ8+P7rZjZMh9wqQQZyDmQZSAA@mail.gmail.com>
Message-ID: <CAJoaRhagfQPR4F9DTQH6yR-8KW1bJ0GVhb5dEGsYoLq38xVhTw@mail.gmail.com>

On Wed, Oct 3, 2012 at 7:47 AM, Hadley Wickham <h.wickham at gmail.com> wrote:
>> There is:  it is `function`.  The parser converts your function definitions
>> into a call to it.  (It has 3 arguments: the formals, the body, and the
>> srcref.  The environment is added when it is evaluated.)
>>
>> So your make_function below is pretty similar (but because `function` is
>> primitive, some of the evaluation rules might be different).
>
> Hmm, I thought I had it working, but now I can't figure out the
> arguments to `function`:
>
>> `function`(NULL,NULL)
> function ()
> NULL
>
>> `function`(alist(a = 1), NULL)
> Error: invalid formal argument list for "function"
>
> I'm obviously missing something dumb.

I think `function` does not eval its arguments, and it demands a
pairlist. So this works:

f <- eval(substitute(`function`(args, body),
list(args=as.pairlist(alist(a=1)), body=quote(a+1))))

The other thing to notice is a syntax difference between function and
ordinary calls: when writing

function(b=default, a) {}

"a" is interpreted as a name rather than value; to programatically get
the same effect you'd have to use

alist(b=default, a= )

Peter


From h.wickham at gmail.com  Thu Oct  4 00:55:17 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Wed, 3 Oct 2012 17:55:17 -0500
Subject: [Rd] Creating functions programmatically
In-Reply-To: <CAJoaRhagfQPR4F9DTQH6yR-8KW1bJ0GVhb5dEGsYoLq38xVhTw@mail.gmail.com>
References: <CABdHhvH9Q3L16aCQPg=Tn5N+GqJTDW2vhf3=y6_DYcUOXwYvmQ@mail.gmail.com>
	<506C4B1F.3070403@gmail.com>
	<CABdHhvGhFHTVUvCY_n9_VaxyEZ8+P7rZjZMh9wqQQZyDmQZSAA@mail.gmail.com>
	<CAJoaRhagfQPR4F9DTQH6yR-8KW1bJ0GVhb5dEGsYoLq38xVhTw@mail.gmail.com>
Message-ID: <CABdHhvF7Pofa10MLsbd3j+ue2d1D4JHjBSny28etakRN+T5H4g@mail.gmail.com>

> I think `function` does not eval its arguments, and it demands a
> pairlist. So this works:
>
> f <- eval(substitute(`function`(args, body),
> list(args=as.pairlist(alist(a=1)), body=quote(a+1))))
>
> The other thing to notice is a syntax difference between function and
> ordinary calls: when writing

Thanks.

So as far as I can tell, we have 4 basic ways of making a function
from args, body and env:

    make_function1 <- function(args, body, env = parent.frame()) {
      args <- as.pairlist(args)
      eval(call("function", args, body), env)
    }
    make_function2 <- function(args, body, env = parent.frame()) {
      f <- function() {}
      formals(f) <- args
      body(f) <- body
      environment(f) <- env

      f
    }
    make_function3 <- function(args, body, env = parent.frame()) {
      as.function(c(args, body), env)
    }
    make_function4 <- function(args, body, env = parent.frame()) {
      subs <- list(args = as.pairlist(args), body = body)
      eval(substitute(`function`(args, body), subs), env)
    }

    args <- alist(a = 1, b = 2)
    body <- quote(a + b)
    make_function1(args, body)
    make_function2(args, body)
    make_function3(args, body)
    make_function4(args, body)

And not that speed really matters much here, but:

    library(microbenchmark)
    microbenchmark(
      make_function1(args, body),
      make_function2(args, body),
      make_function3(args, body),
      make_function4(args, body),
      function(a = 1, b = 2) a + b
    )

Unit: nanoseconds
                          expr   min    lq median    uq    max
1 function(a = 1, b = 2) a + b   165   228    279   330    703
2   make_function1(args, body)  3540  4276   4774  5340  12947
3   make_function2(args, body) 47150 49170  49972 52510 147753
4   make_function3(args, body)  7461  8482   9116  9515  14763
5   make_function4(args, body)  4818  5814   6424  7102  13385

So constructing the call explicitly is fastest, followed by using
function, then as.function.  Modifying an empty function is an order
of magnitude slower. Even the fastest approach is about 20x slower
than creating it by hand.

Hadley

-- 
RStudio / Rice University
http://had.co.nz/


From peter.meilstrup at gmail.com  Thu Oct  4 04:37:24 2012
From: peter.meilstrup at gmail.com (Peter Meilstrup)
Date: Wed, 3 Oct 2012 19:37:24 -0700
Subject: [Rd] How to build a list with missing values? What is missing,
	anyway?
Message-ID: <CAJoaRhb8gq79aB3EXPeMa+n6eK6pj9NTFHFBJRUbP_=S1bbTaA@mail.gmail.com>

This is tangentially related to Hadley's question.

Suppose I'm building a function programmatically; I have assembled an
expression for the body and I know the names of the arguments it wants
to take.

Suppose I have some convenience function such that writing
    make_function(alist(a=, b=), quote(a+b), environment())
is equivalent to writing
    function(a,b) a+b

So how do I make the list that goes in the first argument? Suppose I
start with a character vector of argument names. What I need is a list
with names and quoted values, but the values are "empty".

Say I have argnames <- c("a", "b", "c").
>From that I want to construct the equivalent of alist(a=, b=, c=).

"missing" seems different from NULL; if I do

arglist <- rep(list(NULL), length(argnames))
names(arglist) <- argnames
make_function(arglist, quote(a+b+c))

I get a function where NULL is the default value for each argument,
rather than a function with no default values.

It seems I can assign a "missing value" to a variable by

the_missing_value <- formals(function(x) NULL)[[1]]

or by

the_missing_value = quote(expr=)

However this backfires when I try to use it:

> arglist <- rep(list(the_missing_value), length(argnames))
Error in list(the_missing_value) :  'the_missing_value' is missing

> arglist <- rep(list(NULL), 3)
> arglist[] <- the_missing_value
Error: argument "the_missing_value" is missing, with no default

Besides which, roxygen2 (and other package tools) choked on
encountering a missing value assigned to a name in my package.

So, what's going on with missing? Missing and '...' are the two pieces
of R's semantics I'm most fuzzy on.

(Somewhere along this experimentation I also managed to assign a value
to the empty name, and could not figure out how to remove it...)

Peter


From h.wickham at gmail.com  Thu Oct  4 05:10:00 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Wed, 3 Oct 2012 22:10:00 -0500
Subject: [Rd] How to build a list with missing values? What is missing,
	anyway?
In-Reply-To: <CAJoaRhb8gq79aB3EXPeMa+n6eK6pj9NTFHFBJRUbP_=S1bbTaA@mail.gmail.com>
References: <CAJoaRhb8gq79aB3EXPeMa+n6eK6pj9NTFHFBJRUbP_=S1bbTaA@mail.gmail.com>
Message-ID: <CABdHhvE2DvG630dZCwuExkKuq1muUgB+gGKhpuDdAoW17bJo+A@mail.gmail.com>

On Wed, Oct 3, 2012 at 9:37 PM, Peter Meilstrup
<peter.meilstrup at gmail.com> wrote:
> This is tangentially related to Hadley's question.
>
> Suppose I'm building a function programmatically; I have assembled an
> expression for the body and I know the names of the arguments it wants
> to take.
>
> Suppose I have some convenience function such that writing
>     make_function(alist(a=, b=), quote(a+b), environment())
> is equivalent to writing
>     function(a,b) a+b
>
> So how do I make the list that goes in the first argument? Suppose I
> start with a character vector of argument names. What I need is a list
> with names and quoted values, but the values are "empty".
>
> Say I have argnames <- c("a", "b", "c").
> >From that I want to construct the equivalent of alist(a=, b=, c=).

Here's one approach:

args <- alist()
for (n in argnames) {
  args[[n]] <- bquote()
}

You have to be really careful dealing with the missing symbol, because
if R attempts to evaluate it, you get the missing argument error.

Hadley

-- 
RStudio / Rice University
http://had.co.nz/


From joshmobrien at gmail.com  Thu Oct  4 08:21:44 2012
From: joshmobrien at gmail.com (Josh O'Brien)
Date: Wed, 3 Oct 2012 23:21:44 -0700 (PDT)
Subject: [Rd] How to build a list with missing values? What is missing,
 anyway?
In-Reply-To: <CAJoaRhb8gq79aB3EXPeMa+n6eK6pj9NTFHFBJRUbP_=S1bbTaA@mail.gmail.com>
References: <CAJoaRhb8gq79aB3EXPeMa+n6eK6pj9NTFHFBJRUbP_=S1bbTaA@mail.gmail.com>
Message-ID: <1349331704206-4644965.post@n4.nabble.com>


>Say I have argnames <- c("a", "b", "c").
>From that I want to construct the equivalent of alist(a=, b=, c=).

Here's a one liner that'll do that for you:

argnames <- letters[1:3]
setNames(rep(list(bquote()), length(argnames)), argnames)

- Josh



--
View this message in context: http://r.789695.n4.nabble.com/How-to-build-a-list-with-missing-values-What-is-missing-anyway-tp4644957p4644965.html
Sent from the R devel mailing list archive at Nabble.com.


From hb at biostat.ucsf.edu  Thu Oct  4 22:45:30 2012
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Thu, 4 Oct 2012 10:45:30 -1000
Subject: [Rd] Fastest non-overlapping binning mean function out there?
In-Reply-To: <506CA4FF.7090806@fhcrc.org>
References: <CAFDcVCQ0SPAYLsgtVxyYoakWQCJavj2QSfLwtNuzwH_U-AR8_g@mail.gmail.com>
	<506C41DF.2080204@fhcrc.org> <506CA4FF.7090806@fhcrc.org>
Message-ID: <CAFDcVCTeVN4NTmkeiVfmxbAxhGNgjgZqD7vwYBahvGK-e5E+=g@mail.gmail.com>

Thank you all - I appreciate all your suggestions.  My post was mainly
to check if there's already an existing and fast implementation out
there.  I've ended up adopting Martin's first proposal.  Something
like this:

#include <Rdefines.h>
#include <R.h>
#include <R_ext/Error.h>

SEXP binMeans(SEXP y, SEXP x, SEXP bx, SEXP retCount) {
  int ny = Rf_length(y), nx = Rf_length(x), nb = Rf_length(bx)-1;
  double *yp = REAL(y), *xp = REAL(x), *bxp = REAL(bx);
  SEXP ans = PROTECT(NEW_NUMERIC(nb));
  double *ansp = REAL(ans);
  int retcount = LOGICAL(retCount)[0];
  SEXP count = NULL;
  int *countp = NULL;
  int i = 0, j = 0, n = 0, iStart=0;
  double sum = 0.0;

  // Assert same lengths of 'x' and 'y'
  if (ny != nx) {
    error("Argument 'y' and 'x' are of different lengths: %d != %d", ny, nx);
  }

  if (retcount) {
    count = PROTECT(NEW_INTEGER(nb));
    countp = INTEGER(count);
  }

  // Skip to the first bin
  while (xp[iStart] < bxp[0]) {
    ++iStart;
  }

  // For each x...
  for (i = iStart; i < nx; ++i) {
    // Skip to a new bin?
    while (xp[i] >= bxp[j+1]) {
      // Update statistic of current bin?
      if (retcount) { countp[j] = n; }
      ansp[j] = n > 0 ? sum / n : 0;
      sum = 0.0;
      n = 0;
      // ...and move to next
      ++j;
    }
    sum += yp[i];
    n += 1;
  }

  // Update statistic of last bin
  ansp[j] = n > 0 ? sum / n : 0;
  if (retcount) {
    countp[j] = n;
    setAttrib(ans, install("count"), count);
    UNPROTECT(1); // 'count'
  }
  UNPROTECT(1); // 'ans'

  return ans;
} // binMeans()

BTW, "10,000-millions" was supposed to read as a range (10^4 to 10^6)
and not a scalar (10^10), but the misinterpretation got Martin to
point out some of the exciting work extending R core to support "very
large" integers.  And, as Herve pointed out, I forgot to say that the
number of bins could be of that range as well, or maybe an order of
magnitude less (say ~1-100 data points per bin).

/Henrik

On Wed, Oct 3, 2012 at 10:50 AM, Martin Morgan <mtmorgan at fhcrc.org> wrote:
> On 10/3/2012 6:47 AM, Martin Morgan wrote:
>>
>> On 10/02/2012 05:19 PM, Henrik Bengtsson wrote:
>>>
>>> Hi,
>>>
>>> I'm looking for a super-duper fast mean/sum binning implementation
>>> available in R, and before implementing z = binnedMeans(x y) in native
>>> code myself, does any one know of an existing function/package for
>>> this?  I'm sure it already exists.  So, given data (x,y) and B bins
>>> bx[1] < bx[2] < ... < bx[B] < bx[B+1], I'd like to calculate the
>>> binned means (or sums) 'z' such that z[1] = mean(x[bx[1] <= x & x <
>>> bx[2]]), z[2] = mean(x[bx[2] <= x & x < bx[3]]), .... z[B].  Let's
>>> assume there are no missing values and 'x' and 'bx' is already
>>> ordered.  The length of 'x' is in the order of 10,000-millions.  The
>>> number of elements in each bin vary.
>>
>>
>> since x and bx are ordered (sorting x would be expensive), the C code
>> seems
>> pretty straight-forward and memory-efficient -- create a result vector as
>> long
>> as bx, then iterate through x accumulating n and it's sum until x[i] >=
>> bx[i].
>> (I think R's implementation of mean() actually pays more attention to
>> numerical
>> error, but with this much data...)
>>
>> library(inline)
>> binmean <- cfunction(signature(x="numeric", bx="numeric"),
>> "   int nx = Rf_length(x), nb = Rf_length(bx), i, j, n;
>
>
> I'll take my solution back. The problem specification says that x has
> 10,000-millions of elements, so we need to use R-devel and
>
>     R_xlen_t nx = Rf_xlength(x), nb = Rf_xlength(bx), i, j, n;
>
> but there are two further issues. The first is that on my system
>
> p$ gcc --version
> gcc (Ubuntu/Linaro 4.6.3-1ubuntu5) 4.6.3
>
> I have __SIZEOF_SIZE_T__ 8 but
>
> (a) the test in Rinternals.h:52 is of SIZEOF_SIZE_T, which is undefined. I
> end up with typedef int R_xlen_t (e.g., after R CMD SHLIB, instead of using
> the inline package, to avoid that level of uncertainty) and then
>
>
>>      SEXP ans = PROTECT(NEW_NUMERIC(nb));
>>      double sum, *xp = REAL(x), *bxp = REAL(bx), *ansp = REAL(ans);
>>      sum = j = n = 0;
>>      for (i = 0; i < nx; ++i) {
>
>
> (b) because nx is a signed type, and since nx > .Machine$integer.max is
> represented as a negative number, I don't ever iterate this loop. So I'd
> have to be more clever if I wanted this to work on all platforms.
>
> For what it's worth, Herve's solution is also problematic
>
>> xx = findInterval(bx, x)
> Error in findInterval(bx, x) : long vector 'vec' is not supported
>
> A different strategy for the problem at hand would seem to involve iteration
> over sequences of x, collecting sufficient statistics (n, sum) for each
> iteration, and calculating the mean at the end of the day. This might also
> result in better memory use and allow parallel processing.
>
> Martin
>
>
>>          while (xp[i] >= bxp[j]) {
>>               ansp[j++] = n > 0 ? sum / n : 0;
>>               sum = n = 0;
>>          }
>>          n += 1;
>>          sum += xp[i];
>>      }
>>      ansp[j] = n > 0 ? sum / n : 0;
>>      UNPROTECT(1);
>>      return ans;
>> ")
>>
>> with a test case
>>
>> nx <- 4e7
>> nb <- 1e3
>> x <- sort(runif(nx))
>> bx <- do.call(seq, c(as.list(range(x)), length.out=nb))
>>
>> leading to
>>
>>  > bx1 <- c(bx[-1], bx[nb] + 1)
>>  > system.time(res <- binmean(x, bx1))
>>     user  system elapsed
>>    0.052   0.000   0.050
>>
>> Martin
>>
>>>
>>> Thanks,
>>>
>>> Henrik
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>
>
> --
> Dr. Martin Morgan, PhD
>
> Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N.
> PO Box 19024 Seattle, WA 98109


From mtmorgan at fhcrc.org  Thu Oct  4 22:57:18 2012
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Thu, 04 Oct 2012 13:57:18 -0700
Subject: [Rd] identical() fails to compare isS4(<S4 instance>) to TRUE
Message-ID: <506DF82E.7080507@fhcrc.org>


 > setClass("A", "integer")
 > isS4(new("A"))
[1] TRUE
 > identical(isS4(new("A")), TRUE)
[1] FALSE

 > sessionInfo()
R Under development (unstable) (2012-10-04 r60876)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
  [7] LC_PAPER=C                 LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base
-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From murdoch.duncan at gmail.com  Thu Oct  4 23:23:34 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 04 Oct 2012 17:23:34 -0400
Subject: [Rd] identical() fails to compare isS4(<S4 instance>) to TRUE
In-Reply-To: <506DF82E.7080507@fhcrc.org>
References: <506DF82E.7080507@fhcrc.org>
Message-ID: <506DFE56.30501@gmail.com>

On 12-10-04 4:57 PM, Martin Morgan wrote:
>
>   > setClass("A", "integer")
>   > isS4(new("A"))
> [1] TRUE
>   > identical(isS4(new("A")), TRUE)
> [1] FALSE
>
>   > sessionInfo()
> R Under development (unstable) (2012-10-04 r60876)
> Platform: x86_64-unknown-linux-gnu (64-bit)
>
> locale:
>    [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>    [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>    [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>    [7] LC_PAPER=C                 LC_NAME=C
>    [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>

I can confirm this in R-devel, but it doesn't happen in R-patched.  In 
R-devel, isS4 is returning a vector marked as LGLSXP, but containing the 
value 16, not the usual 1 for TRUE.

 > .Internal(inspect(isS4(new("A"))))
@4bfbed8 10 LGLSXP g0c1 [] (len=1, tl=0) 16

I'm not going to have time to track this down and fix it.

Duncan Murdoch


From mtmorgan at fhcrc.org  Thu Oct  4 23:50:43 2012
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Thu, 04 Oct 2012 14:50:43 -0700
Subject: [Rd] identical() fails to compare isS4(<S4 instance>) to TRUE
In-Reply-To: <506DFE56.30501@gmail.com>
References: <506DF82E.7080507@fhcrc.org> <506DFE56.30501@gmail.com>
Message-ID: <506E04B3.7030101@fhcrc.org>

On 10/04/2012 02:23 PM, Duncan Murdoch wrote:
> On 12-10-04 4:57 PM, Martin Morgan wrote:
>>
>>   > setClass("A", "integer")
>>   > isS4(new("A"))
>> [1] TRUE
>>   > identical(isS4(new("A")), TRUE)
>> [1] FALSE
>>
>>   > sessionInfo()
>> R Under development (unstable) (2012-10-04 r60876)
>> Platform: x86_64-unknown-linux-gnu (64-bit)
>>
>> locale:
>>    [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>>    [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>    [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>>    [7] LC_PAPER=C                 LC_NAME=C
>>    [9] LC_ADDRESS=C               LC_TELEPHONE=C
>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>
> I can confirm this in R-devel, but it doesn't happen in R-patched.  In R-devel,
> isS4 is returning a vector marked as LGLSXP, but containing the value 16, not
> the usual 1 for TRUE.
>
>  > .Internal(inspect(isS4(new("A"))))
> @4bfbed8 10 LGLSXP g0c1 [] (len=1, tl=0) 16
>
> I'm not going to have time to track this down and fix it.

The bit is set at src/include/Rinternals.h:278

  39103        jmc #define IS_S4_OBJECT(x) ((x)->sxpinfo.gp & S4_OBJECT_MASK)

but it's identical that has changed; it looks as though there are other similar 
operations in that header and probably elsewhere.

Martin

>
> Duncan Murdoch


-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From peter.meilstrup at gmail.com  Fri Oct  5 00:53:12 2012
From: peter.meilstrup at gmail.com (Peter Meilstrup)
Date: Thu, 4 Oct 2012 15:53:12 -0700
Subject: [Rd] How to build a list with missing values? What is missing,
	anyway?
In-Reply-To: <1349331704206-4644965.post@n4.nabble.com>
References: <CAJoaRhb8gq79aB3EXPeMa+n6eK6pj9NTFHFBJRUbP_=S1bbTaA@mail.gmail.com>
	<1349331704206-4644965.post@n4.nabble.com>
Message-ID: <CAJoaRhbgikc=3Gpa8LAvSakjE=e95Z5akS7w5dHEND+yWHfJ6Q@mail.gmail.com>

On Wed, Oct 3, 2012 at 11:21 PM, Josh O'Brien <joshmobrien at gmail.com> wrote:
>
>>Say I have argnames <- c("a", "b", "c").
> >From that I want to construct the equivalent of alist(a=, b=, c=).
>
> Here's a one liner that'll do that for you:
>
> argnames <- letters[1:3]
> setNames(rep(list(bquote()), length(argnames)), argnames)

Thanks.

Just so I have my mental model correct, I'm gathering that missing/``
is a symbol that the interpreter has a special rule for -- evaluating
it raises an error, as opposed to objects that evaluate to themselves
or variable names that evaluate to objects.

Does the same sort of thing explain the behavior of `...`? When the
interpreter comes across `...` in the arguments during evaluation of a
call, it trips a special argument-interpolating behavior?

Peter


From murdoch.duncan at gmail.com  Fri Oct  5 01:05:37 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 04 Oct 2012 19:05:37 -0400
Subject: [Rd] identical() fails to compare isS4(<S4 instance>) to TRUE
In-Reply-To: <506E04B3.7030101@fhcrc.org>
References: <506DF82E.7080507@fhcrc.org> <506DFE56.30501@gmail.com>
	<506E04B3.7030101@fhcrc.org>
Message-ID: <506E1641.2030405@gmail.com>

On 12-10-04 5:50 PM, Martin Morgan wrote:
> On 10/04/2012 02:23 PM, Duncan Murdoch wrote:
>> On 12-10-04 4:57 PM, Martin Morgan wrote:
>>>
>>>    > setClass("A", "integer")
>>>    > isS4(new("A"))
>>> [1] TRUE
>>>    > identical(isS4(new("A")), TRUE)
>>> [1] FALSE
>>>
>>>    > sessionInfo()
>>> R Under development (unstable) (2012-10-04 r60876)
>>> Platform: x86_64-unknown-linux-gnu (64-bit)
>>>
>>> locale:
>>>     [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>>>     [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>>     [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>>>     [7] LC_PAPER=C                 LC_NAME=C
>>>     [9] LC_ADDRESS=C               LC_TELEPHONE=C
>>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>
>>
>> I can confirm this in R-devel, but it doesn't happen in R-patched.  In R-devel,
>> isS4 is returning a vector marked as LGLSXP, but containing the value 16, not
>> the usual 1 for TRUE.
>>
>>   > .Internal(inspect(isS4(new("A"))))
>> @4bfbed8 10 LGLSXP g0c1 [] (len=1, tl=0) 16
>>
>> I'm not going to have time to track this down and fix it.
>
> The bit is set at src/include/Rinternals.h:278
>
>    39103        jmc #define IS_S4_OBJECT(x) ((x)->sxpinfo.gp & S4_OBJECT_MASK)
>
> but it's identical that has changed; it looks as though there are other similar
> operations in that header and probably elsewhere.

In R-patched, it returned the value 1 for TRUE, so I'm not sure 
identical() has changed.

Duncan Murdoch

>
> Martin
>
>>
>> Duncan Murdoch
>
>


From mtmorgan at fhcrc.org  Fri Oct  5 02:56:08 2012
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Thu, 04 Oct 2012 17:56:08 -0700
Subject: [Rd] identical() fails to compare isS4(<S4 instance>) to TRUE
In-Reply-To: <506E1641.2030405@gmail.com>
References: <506DF82E.7080507@fhcrc.org> <506DFE56.30501@gmail.com>
	<506E04B3.7030101@fhcrc.org> <506E1641.2030405@gmail.com>
Message-ID: <506E3028.7090405@fhcrc.org>

On 10/04/2012 04:05 PM, Duncan Murdoch wrote:
> On 12-10-04 5:50 PM, Martin Morgan wrote:
>> On 10/04/2012 02:23 PM, Duncan Murdoch wrote:
>>> On 12-10-04 4:57 PM, Martin Morgan wrote:
>>>>
>>>>    > setClass("A", "integer")
>>>>    > isS4(new("A"))
>>>> [1] TRUE
>>>>    > identical(isS4(new("A")), TRUE)
>>>> [1] FALSE
>>>>
>>>>    > sessionInfo()
>>>> R Under development (unstable) (2012-10-04 r60876)
>>>> Platform: x86_64-unknown-linux-gnu (64-bit)
>>>>
>>>> locale:
>>>>     [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>>>>     [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>>>     [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>>>>     [7] LC_PAPER=C                 LC_NAME=C
>>>>     [9] LC_ADDRESS=C               LC_TELEPHONE=C
>>>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>>>
>>>> attached base packages:
>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>>
>>>
>>> I can confirm this in R-devel, but it doesn't happen in R-patched.  In R-devel,
>>> isS4 is returning a vector marked as LGLSXP, but containing the value 16, not
>>> the usual 1 for TRUE.
>>>
>>>   > .Internal(inspect(isS4(new("A"))))
>>> @4bfbed8 10 LGLSXP g0c1 [] (len=1, tl=0) 16
>>>
>>> I'm not going to have time to track this down and fix it.
>>
>> The bit is set at src/include/Rinternals.h:278
>>
>>    39103        jmc #define IS_S4_OBJECT(x) ((x)->sxpinfo.gp & S4_OBJECT_MASK)
>>
>> but it's identical that has changed; it looks as though there are other similar
>> operations in that header and probably elsewhere.
>
> In R-patched, it returned the value 1 for TRUE, so I'm not sure identical() has
> changed.

R version 2.15.1 Patched (2012-09-24 r60798) has

 > isS4
function (object)
.Call("R_isS4Object", object, PACKAGE = "base")

with objects.c:1531

SEXP R_isS4Object(SEXP object)
{
     /* wanted: return isS4(object) ? mkTrue() : mkFalse(); */
     return IS_S4_OBJECT(object) ? mkTrue() : mkFalse(); ;
}

where R-devel has

 > isS4
function (object)  .Primitive("isS4")

with coerce.c:1843

     case 51:		/* isS4 */
	LOGICAL(ans)[0] = IS_S4_OBJECT(CAR(args));
	break;

made in r60395

Martin

>
> Duncan Murdoch
>
>>
>> Martin
>>
>>>
>>> Duncan Murdoch
>>
>>
>


-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From peter.meilstrup at gmail.com  Fri Oct  5 03:31:26 2012
From: peter.meilstrup at gmail.com (Peter Meilstrup)
Date: Thu, 4 Oct 2012 18:31:26 -0700
Subject: [Rd] How to build a list with missing values? What is missing,
	anyway?
In-Reply-To: <CACk-te23paBonBtKY+eNoqVVdz_0186Y-DnfaMQ4zJOsZS-Gww@mail.gmail.com>
References: <CAJoaRhb8gq79aB3EXPeMa+n6eK6pj9NTFHFBJRUbP_=S1bbTaA@mail.gmail.com>
	<1349331704206-4644965.post@n4.nabble.com>
	<CAJoaRhbgikc=3Gpa8LAvSakjE=e95Z5akS7w5dHEND+yWHfJ6Q@mail.gmail.com>
	<CACk-te23paBonBtKY+eNoqVVdz_0186Y-DnfaMQ4zJOsZS-Gww@mail.gmail.com>
Message-ID: <CAJoaRhYaRyoSzCKWgNNsuo63BazcG_CPDaAW_o4bXMMTeUdeLA@mail.gmail.com>

On Thu, Oct 4, 2012 at 6:12 PM, Bert Gunter <gunter.berton at gene.com> wrote:
> The R Language definition manual explains all of this. Read it.

I always reread that before I post to this list.

The only relevant mention of "missing" in the R Language Definition
that I could find were in section 4.1.2 on page 25, and that section
did not answer anything about "missing" as a special symbol (e.g. that
my be put in a formal argument list.)

There is another mention of `...` in section 4.3.2 and it does not
explain some things, such as under what circumstances one would get a
"`...` used in incorrect context" error.

Peter

>>
>> Thanks.
>>
>> Just so I have my mental model correct, I'm gathering that missing/``
>> is a symbol that the interpreter has a special rule for -- evaluating
>> it raises an error, as opposed to objects that evaluate to themselves
>> or variable names that evaluate to objects.
>>
>> Does the same sort of thing explain the behavior of `...`? When the
>> interpreter comes across `...` in the arguments during evaluation of a
>> call, it trips a special argument-interpolating behavior?
>>
>> Peter
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>
> --
>
> Bert Gunter
> Genentech Nonclinical Biostatistics
>
> Internal Contact Info:
> Phone: 467-7374
> Website:
> http://pharmadevelopment.roche.com/index/pdb/pdb-functional-groups/pdb-biostatistics/pdb-ncb-home.htm


From pdalgd at gmail.com  Fri Oct  5 08:34:13 2012
From: pdalgd at gmail.com (peter dalgaard)
Date: Fri, 5 Oct 2012 08:34:13 +0200
Subject: [Rd] How to build a list with missing values? What is missing,
	anyway?
In-Reply-To: <CAJoaRhYaRyoSzCKWgNNsuo63BazcG_CPDaAW_o4bXMMTeUdeLA@mail.gmail.com>
References: <CAJoaRhb8gq79aB3EXPeMa+n6eK6pj9NTFHFBJRUbP_=S1bbTaA@mail.gmail.com>
	<1349331704206-4644965.post@n4.nabble.com>
	<CAJoaRhbgikc=3Gpa8LAvSakjE=e95Z5akS7w5dHEND+yWHfJ6Q@mail.gmail.com>
	<CACk-te23paBonBtKY+eNoqVVdz_0186Y-DnfaMQ4zJOsZS-Gww@mail.gmail.com>
	<CAJoaRhYaRyoSzCKWgNNsuo63BazcG_CPDaAW_o4bXMMTeUdeLA@mail.gmail.com>
Message-ID: <7BF47B8D-A110-4BD3-BEE5-ACE46D7D52A4@gmail.com>


On Oct 5, 2012, at 03:31 , Peter Meilstrup wrote:

> On Thu, Oct 4, 2012 at 6:12 PM, Bert Gunter <gunter.berton at gene.com> wrote:
>> The R Language definition manual explains all of this. Read it.
> 
> I always reread that before I post to this list.
> 
> The only relevant mention of "missing" in the R Language Definition
> that I could find were in section 4.1.2 on page 25, and that section
> did not answer anything about "missing" as a special symbol (e.g. that
> my be put in a formal argument list.)

It's not defined as an R object. We did consider doing so briefly, but the semantics would be weird, as you have experienced: An R object that can't be evaluated without triggering an error. 

It is something that is used by the internals, so that missing values propagate with lazy evaluation semantics. It happens to be implemented as the equivalent of as.name(""), but that's not to be relied upon. It leaks out into user space because arguments can have missing defaults, and there needs to be a way to manipulate argument lists. It also slips out in substitute() with no argument, and I suppose that too is at least semi-intentional. It is not completely obvious that the two are necessarily identical.

It's one of those things where you shouldn't rely on behavior outside of well-establihed idioms. If you do, and it breaks, you get to keep both pieces...

I suppose we could try documenting it better, but it would be at the risk of authorizing semantics that we might want to change (e.g., it is far from clear that we should be allowing direct assignment of missings to simple symbols).

("..." and friends is a somewhat different kettle of fish which I don't want to go into just now.)

-pd

> There is another mention of `...` in section 4.3.2 and it does not
> explain some things, such as under what circumstances one would get a
> "`...` used in incorrect context" error.
> 
> Peter
> 
>>> 
>>> Thanks.
>>> 
>>> Just so I have my mental model correct, I'm gathering that missing/``
>>> is a symbol that the interpreter has a special rule for -- evaluating
>>> it raises an error, as opposed to objects that evaluate to themselves
>>> or variable names that evaluate to objects.
>>> 
>>> Does the same sort of thing explain the behavior of `...`? When the
>>> interpreter comes across `...` in the arguments during evaluation of a
>>> call, it trips a special argument-interpolating behavior?
>>> 

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From gunter.berton at gene.com  Thu Oct  4 15:40:31 2012
From: gunter.berton at gene.com (Bert Gunter)
Date: Thu, 4 Oct 2012 06:40:31 -0700
Subject: [Rd] How to build a list with missing values? What is missing,
	anyway?
In-Reply-To: <1349331704206-4644965.post@n4.nabble.com>
References: <CAJoaRhb8gq79aB3EXPeMa+n6eK6pj9NTFHFBJRUbP_=S1bbTaA@mail.gmail.com>
	<1349331704206-4644965.post@n4.nabble.com>
Message-ID: <CACk-te25RZaj8f_TqLW1WLmqFKv5KV_jciVKjyv1xqqPGiw+qA@mail.gmail.com>

Why not just use the list constructor:

theList <- setNames(vector("list",3),letters[1:3])

## The list components are empty = NULL, not NA)

This also doesn't seem to be an R-devel topic.

-- Bert

On Wed, Oct 3, 2012 at 11:21 PM, Josh O'Brien <joshmobrien at gmail.com> wrote:
>
>>Say I have argnames <- c("a", "b", "c").
> >From that I want to construct the equivalent of alist(a=, b=, c=).
>
> Here's a one liner that'll do that for you:
>
> argnames <- letters[1:3]
> setNames(rep(list(bquote()), length(argnames)), argnames)
>
> - Josh
>
>
>
> --
> View this message in context: http://r.789695.n4.nabble.com/How-to-build-a-list-with-missing-values-What-is-missing-anyway-tp4644957p4644965.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 

Bert Gunter
Genentech Nonclinical Biostatistics

Internal Contact Info:
Phone: 467-7374
Website:
http://pharmadevelopment.roche.com/index/pdb/pdb-functional-groups/pdb-biostatistics/pdb-ncb-home.htm


From gunter.berton at gene.com  Fri Oct  5 03:12:48 2012
From: gunter.berton at gene.com (Bert Gunter)
Date: Thu, 4 Oct 2012 18:12:48 -0700
Subject: [Rd] How to build a list with missing values? What is missing,
	anyway?
In-Reply-To: <CAJoaRhbgikc=3Gpa8LAvSakjE=e95Z5akS7w5dHEND+yWHfJ6Q@mail.gmail.com>
References: <CAJoaRhb8gq79aB3EXPeMa+n6eK6pj9NTFHFBJRUbP_=S1bbTaA@mail.gmail.com>
	<1349331704206-4644965.post@n4.nabble.com>
	<CAJoaRhbgikc=3Gpa8LAvSakjE=e95Z5akS7w5dHEND+yWHfJ6Q@mail.gmail.com>
Message-ID: <CACk-te23paBonBtKY+eNoqVVdz_0186Y-DnfaMQ4zJOsZS-Gww@mail.gmail.com>

The R Language definition manual explains all of this. Read it.

-- Bert

On Thu, Oct 4, 2012 at 3:53 PM, Peter Meilstrup
<peter.meilstrup at gmail.com> wrote:
> On Wed, Oct 3, 2012 at 11:21 PM, Josh O'Brien <joshmobrien at gmail.com> wrote:
>>
>>>Say I have argnames <- c("a", "b", "c").
>> >From that I want to construct the equivalent of alist(a=, b=, c=).
>>
>> Here's a one liner that'll do that for you:
>>
>> argnames <- letters[1:3]
>> setNames(rep(list(bquote()), length(argnames)), argnames)
>
> Thanks.
>
> Just so I have my mental model correct, I'm gathering that missing/``
> is a symbol that the interpreter has a special rule for -- evaluating
> it raises an error, as opposed to objects that evaluate to themselves
> or variable names that evaluate to objects.
>
> Does the same sort of thing explain the behavior of `...`? When the
> interpreter comes across `...` in the arguments during evaluation of a
> call, it trips a special argument-interpolating behavior?
>
> Peter
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 

Bert Gunter
Genentech Nonclinical Biostatistics

Internal Contact Info:
Phone: 467-7374
Website:
http://pharmadevelopment.roche.com/index/pdb/pdb-functional-groups/pdb-biostatistics/pdb-ncb-home.htm


From gunter.berton at gene.com  Fri Oct  5 05:07:53 2012
From: gunter.berton at gene.com (Bert Gunter)
Date: Thu, 4 Oct 2012 20:07:53 -0700
Subject: [Rd] How to build a list with missing values? What is missing,
	anyway?
In-Reply-To: <CAJoaRhYaRyoSzCKWgNNsuo63BazcG_CPDaAW_o4bXMMTeUdeLA@mail.gmail.com>
References: <CAJoaRhb8gq79aB3EXPeMa+n6eK6pj9NTFHFBJRUbP_=S1bbTaA@mail.gmail.com>
	<1349331704206-4644965.post@n4.nabble.com>
	<CAJoaRhbgikc=3Gpa8LAvSakjE=e95Z5akS7w5dHEND+yWHfJ6Q@mail.gmail.com>
	<CACk-te23paBonBtKY+eNoqVVdz_0186Y-DnfaMQ4zJOsZS-Gww@mail.gmail.com>
	<CAJoaRhYaRyoSzCKWgNNsuo63BazcG_CPDaAW_o4bXMMTeUdeLA@mail.gmail.com>
Message-ID: <CACk-te3Vtbi8gQWks4CjMt=xjS+g1UUptMgaEornRRy_sWXbnA@mail.gmail.com>

On Thu, Oct 4, 2012 at 6:31 PM, Peter Meilstrup
<peter.meilstrup at gmail.com> wrote:
> On Thu, Oct 4, 2012 at 6:12 PM, Bert Gunter <gunter.berton at gene.com> wrote:
>> The R Language definition manual explains all of this. Read it.
>
> I always reread that before I post to this list.
>
> The only relevant mention of "missing" in the R Language Definition
> that I could find were in section 4.1.2 on page 25, and that section

Page 15, "NA handling" seems "relevant, " as does ?NA (at the command
prompt in R).
See also 2.5 in the Introduction to R tutorial.

> did not answer anything about "missing" as a special symbol (e.g. that
> my be put in a formal argument list.)
>
> There is another mention of `...` in section 4.3.2 and it does not

See section 2.1.9 of the Language Definition manual and 10.4 of Intro to R.

> explain some things, such as under what circumstances one would get a
> "`...` used in incorrect context" error.

How could it possibly know that?

-- Bert

>
> Peter
>
>>>
>>> Thanks.
>>>
>>> Just so I have my mental model correct, I'm gathering that missing/``
>>> is a symbol that the interpreter has a special rule for -- evaluating
>>> it raises an error, as opposed to objects that evaluate to themselves
>>> or variable names that evaluate to objects.
>>>
>>> Does the same sort of thing explain the behavior of `...`? When the
>>> interpreter comes across `...` in the arguments during evaluation of a
>>> call, it trips a special argument-interpolating behavior?
>>>
>>> Peter
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>>
>> --
>>
>> Bert Gunter
>> Genentech Nonclinical Biostatistics
>>
>> Internal Contact Info:
>> Phone: 467-7374
>> Website:
>> http://pharmadevelopment.roche.com/index/pdb/pdb-functional-groups/pdb-biostatistics/pdb-ncb-home.htm



-- 

Bert Gunter
Genentech Nonclinical Biostatistics

Internal Contact Info:
Phone: 467-7374
Website:
http://pharmadevelopment.roche.com/index/pdb/pdb-functional-groups/pdb-biostatistics/pdb-ncb-home.htm


From mtmorgan at fhcrc.org  Fri Oct  5 14:24:48 2012
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Fri, 05 Oct 2012 05:24:48 -0700
Subject: [Rd] identical() fails to compare isS4(<S4 instance>) to TRUE
In-Reply-To: <506E3028.7090405@fhcrc.org>
References: <506DF82E.7080507@fhcrc.org> <506DFE56.30501@gmail.com>
	<506E04B3.7030101@fhcrc.org> <506E1641.2030405@gmail.com>
	<506E3028.7090405@fhcrc.org>
Message-ID: <506ED190.7010001@fhcrc.org>

On 10/04/2012 05:56 PM, Martin Morgan wrote:
> On 10/04/2012 04:05 PM, Duncan Murdoch wrote:
>> On 12-10-04 5:50 PM, Martin Morgan wrote:
>>> On 10/04/2012 02:23 PM, Duncan Murdoch wrote:
>>>> On 12-10-04 4:57 PM, Martin Morgan wrote:
>>>>>
>>>>>    > setClass("A", "integer")
>>>>>    > isS4(new("A"))
>>>>> [1] TRUE
>>>>>    > identical(isS4(new("A")), TRUE)
>>>>> [1] FALSE
>>>>>
>>>>>    > sessionInfo()
>>>>> R Under development (unstable) (2012-10-04 r60876)
>>>>> Platform: x86_64-unknown-linux-gnu (64-bit)
>>>>>
>>>>> locale:
>>>>>     [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>>>>>     [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>>>>     [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>>>>>     [7] LC_PAPER=C                 LC_NAME=C
>>>>>     [9] LC_ADDRESS=C               LC_TELEPHONE=C
>>>>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>>>>
>>>>> attached base packages:
>>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>>>
>>>>
>>>> I can confirm this in R-devel, but it doesn't happen in R-patched.  In R-devel,
>>>> isS4 is returning a vector marked as LGLSXP, but containing the value 16, not
>>>> the usual 1 for TRUE.
>>>>
>>>>   > .Internal(inspect(isS4(new("A"))))
>>>> @4bfbed8 10 LGLSXP g0c1 [] (len=1, tl=0) 16
>>>>
>>>> I'm not going to have time to track this down and fix it.
>>>
>>> The bit is set at src/include/Rinternals.h:278
>>>
>>>    39103        jmc #define IS_S4_OBJECT(x) ((x)->sxpinfo.gp & S4_OBJECT_MASK)
>>>
>>> but it's identical that has changed; it looks as though there are other similar
>>> operations in that header and probably elsewhere.
>>
>> In R-patched, it returned the value 1 for TRUE, so I'm not sure identical() has
>> changed.
>
> R version 2.15.1 Patched (2012-09-24 r60798) has
>
>  > isS4
> function (object)
> .Call("R_isS4Object", object, PACKAGE = "base")
>
> with objects.c:1531
>
> SEXP R_isS4Object(SEXP object)
> {
>      /* wanted: return isS4(object) ? mkTrue() : mkFalse(); */
>      return IS_S4_OBJECT(object) ? mkTrue() : mkFalse(); ;
> }
>
> where R-devel has
>
>  > isS4
> function (object)  .Primitive("isS4")
>
> with coerce.c:1843
>
>      case 51:        /* isS4 */
>      LOGICAL(ans)[0] = IS_S4_OBJECT(CAR(args));
>      break;
>
> made in r60395

and fixed in r60877, thanks. Martin

>
> Martin
>
>>
>> Duncan Murdoch
>>
>>>
>>> Martin
>>>
>>>>
>>>> Duncan Murdoch
>>>
>>>
>>
>
>


-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From winstonchang1 at gmail.com  Sat Oct  6 06:42:37 2012
From: winstonchang1 at gmail.com (Winston Chang)
Date: Fri, 5 Oct 2012 23:42:37 -0500
Subject: [Rd] Problems with install.packages when Ncpus > 1
Message-ID: <CAFOpNVERM_zfiB3NkYb6KXzzM43ia1JPmVAzEncd60Aatvn7dQ@mail.gmail.com>

I have a Ubuntu Linux 12.04.1 machine running R 2.15.1. I'm trying to
run tests building packages, so install.packages() is trying to
install about about 1000 packages from source. I'm running into some
strange issues that seem related to using values for Ncpus other than 1.

When I use Ncpus=32, about 260 of the packages fail to install. When I
tried again with Ncpus=2, more of them get installed, and there were
only 234 failed packages. I tried it again with Ncpus=1, after which
there were only 142 failed packages. (I think these remaining failed
packages are due to missing external dependencies, like RODBC, Java,
and various development libraries, so these aren't a concern at the
moment.)

In the code for install.packages, I see that if Ncpus>1, it passes the
Ncpus to make, as in 'make -k -j 32'. Is it possible that these
packages are failing because of this option to make?

Has anyone else run into this issue before?

Thanks!
-Winston


From ripley at stats.ox.ac.uk  Sat Oct  6 07:52:36 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 06 Oct 2012 06:52:36 +0100
Subject: [Rd] Problems with install.packages when Ncpus > 1
In-Reply-To: <CAFOpNVERM_zfiB3NkYb6KXzzM43ia1JPmVAzEncd60Aatvn7dQ@mail.gmail.com>
References: <CAFOpNVERM_zfiB3NkYb6KXzzM43ia1JPmVAzEncd60Aatvn7dQ@mail.gmail.com>
Message-ID: <506FC724.6050207@stats.ox.ac.uk>

On 06/10/2012 05:42, Winston Chang wrote:
> I have a Ubuntu Linux 12.04.1 machine running R 2.15.1. I'm trying to
> run tests building packages, so install.packages() is trying to
> install about about 1000 packages from source. I'm running into some
> strange issues that seem related to using values for Ncpus other than 1.
>
> When I use Ncpus=32, about 260 of the packages fail to install. When I
> tried again with Ncpus=2, more of them get installed, and there were
> only 234 failed packages. I tried it again with Ncpus=1, after which
> there were only 142 failed packages. (I think these remaining failed
> packages are due to missing external dependencies, like RODBC, Java,
> and various development libraries, so these aren't a concern at the
> moment.)
>
> In the code for install.packages, I see that if Ncpus>1, it passes the
> Ncpus to make, as in 'make -k -j 32'. Is it possible that these
> packages are failing because of this option to make?

It is perfectly correct option: please do your homework before posting 
as the posting guide asked of you.
>
> Has anyone else run into this issue before?

Yes.  It is due to missing dependencies between packages.   I find this 
works well on CRAN *provided* that the BioC repositories are also 
selected so that dependencies can be traced via BioC dependencies. 
However, BioC does have a fair few missing dependencies in its packages 
(run R CMD check over BioC to see them).

Take a look at the logs of the failed packages.  One I see frequently is 
that ddgraph fails because it depends indirectly on RBGL which takes a 
long time to install and is still being done.

>
> Thanks!
> -Winston


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From winstonchang1 at gmail.com  Sat Oct  6 18:02:18 2012
From: winstonchang1 at gmail.com (Winston Chang)
Date: Sat, 6 Oct 2012 11:02:18 -0500
Subject: [Rd] Problems with install.packages when Ncpus > 1
In-Reply-To: <506FC724.6050207@stats.ox.ac.uk>
References: <CAFOpNVERM_zfiB3NkYb6KXzzM43ia1JPmVAzEncd60Aatvn7dQ@mail.gmail.com>
	<506FC724.6050207@stats.ox.ac.uk>
Message-ID: <CAFOpNVFDkJ_TSTobYiitiKvDZcgKLTrp50xwj-VqXfUKt4QEKA@mail.gmail.com>

>> In the code for install.packages, I see that if Ncpus>1, it passes the
>> Ncpus to make, as in 'make -k -j 32'. Is it possible that these
>> packages are failing because of this option to make?
>
>
> It is perfectly correct option: please do your homework before posting as the posting guide asked of you.



The question isn't about whether these are valid make options. I
realize that '-j <n>' is a valid option for make, just like Ncpus is a
valid option for install.packages. The question is whether that option
is unexpectedly resulting in failed compiles for some packages.


>>
>> Has anyone else run into this issue before?
>
>
> Yes.  It is due to missing dependencies between packages.   I find this works well on CRAN *provided* that the BioC repositories are also selected so that dependencies can be traced via BioC dependencies. However, BioC does have a fair few missing dependencies in its packages (run R CMD check over BioC to see them).
>
> Take a look at the logs of the failed packages.  One I see frequently is that ddgraph fails because it depends indirectly on RBGL which takes a long time to install and is still being done.



Thanks, I'll take a closer look at these those cross dependencies.

-Winston


From ligges at statistik.tu-dortmund.de  Sat Oct  6 19:02:42 2012
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sat, 06 Oct 2012 19:02:42 +0200
Subject: [Rd] Problems with install.packages when Ncpus > 1
In-Reply-To: <CAFOpNVFDkJ_TSTobYiitiKvDZcgKLTrp50xwj-VqXfUKt4QEKA@mail.gmail.com>
References: <CAFOpNVERM_zfiB3NkYb6KXzzM43ia1JPmVAzEncd60Aatvn7dQ@mail.gmail.com>
	<506FC724.6050207@stats.ox.ac.uk>
	<CAFOpNVFDkJ_TSTobYiitiKvDZcgKLTrp50xwj-VqXfUKt4QEKA@mail.gmail.com>
Message-ID: <50706432.6090202@statistik.tu-dortmund.de>



On 06.10.2012 18:02, Winston Chang wrote:
>>> In the code for install.packages, I see that if Ncpus>1, it passes the
>>> Ncpus to make, as in 'make -k -j 32'. Is it possible that these
>>> packages are failing because of this option to make?
>>
>>
>> It is perfectly correct option: please do your homework before posting as the posting guide asked of you.
>
>
>
> The question isn't about whether these are valid make options. I
> realize that '-j <n>' is a valid option for make, just like Ncpus is a
> valid option for install.packages. The question is whether that option
> is unexpectedly resulting in failed compiles for some packages.

I think Brian answered this already:
Not unexpectedly. It fails in case when a package installation requires 
another package and that is installed at the same time or not yet 
installed. Such things happen when install time dependencies are not 
correctly declared. R CMD check finds (at least most of) such 
declaration errors  nowadays.

Uwe Ligges


>
>
>>>
>>> Has anyone else run into this issue before?
>>
>>
>> Yes.  It is due to missing dependencies between packages.   I find this works well on CRAN *provided* that the BioC repositories are also selected so that dependencies can be traced via BioC dependencies. However, BioC does have a fair few missing dependencies in its packages (run R CMD check over BioC to see them).
>>
>> Take a look at the logs of the failed packages.  One I see frequently is that ddgraph fails because it depends indirectly on RBGL which takes a long time to install and is still being done.
>
>
>
> Thanks, I'll take a closer look at these those cross dependencies.
>
> -Winston
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From michael.weylandt at gmail.com  Sun Oct  7 17:34:27 2012
From: michael.weylandt at gmail.com (R. Michael Weylandt)
Date: Sun, 7 Oct 2012 16:34:27 +0100
Subject: [Rd] malloc error in tab-completion: OS X
Message-ID: <CAAmySGNgB6S3Ww1e1mhVqxg4T4qn143-H3=dejkU+Y7PCJPakA@mail.gmail.com>

I've just built R-devel (r60889) from source on my Mac OS X 10.6.8
using gcc from Xcode and gfortran from Simon. I didn't use all the
recommended configuration flags only

./configure && make

Still, I seem to pass "make check" and
"make test-Segfault" in the tests directory with no problem, but the
following leads
to a persistent error + instant abort.

1) Start R
2) Type "tools::"
3) Tab to attempt to auto-complete

resulting in some variation on

mweylandt-laptop:~ michaelweylandt$ rDEVEL/bin/R --vanilla -q
> tools::R(44436) malloc: *** error for object 0x1006d8700: incorrect checksum for freed object - object was probably modified after being freed.
*** set a breakpoint in malloc_error_break to debug
Abort trap

at which point hitting <RET> drops me back into bash. This seems to
only occur with tools and no other packages (that I've found). It also
occurs whether tools has been library()'d or not, but sometimes it
takes two tabbings.

My compiler info follows

mweylandt-laptop:~ michaelweylandt$ gcc --version
i686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5666) (dot 3)
Copyright (C) 2007 Free Software Foundation, Inc.

mweylandt-laptop:~ michaelweylandt$ gfortran --version
GNU Fortran (GCC) 4.2.1 (Apple Inc. build 5664)
Copyright (C) 2007 Free Software Foundation, Inc.

I do think that it's only a problem with my local build, as I can't
replicate with Simon's nightly builds (http://r.research.att.com/),
which are at r60887 currently. Is there anything else I should check
with my setup? I don't see any advice on this particular issue in the
R installation manual, but I easily could have overlooked it.

Thanks,
Michael


From bhh at xs4all.nl  Sun Oct  7 19:11:01 2012
From: bhh at xs4all.nl (Berend Hasselman)
Date: Sun, 7 Oct 2012 19:11:01 +0200
Subject: [Rd] malloc error in tab-completion: OS X
In-Reply-To: <CAAmySGNgB6S3Ww1e1mhVqxg4T4qn143-H3=dejkU+Y7PCJPakA@mail.gmail.com>
References: <CAAmySGNgB6S3Ww1e1mhVqxg4T4qn143-H3=dejkU+Y7PCJPakA@mail.gmail.com>
Message-ID: <B83EA524-7DB6-4E6B-A5F4-8F6302460756@xs4all.nl>


On 07-10-2012, at 17:34, R. Michael Weylandt wrote:

> I've just built R-devel (r60889) from source on my Mac OS X 10.6.8
> using gcc from Xcode and gfortran from Simon. I didn't use all the
> recommended configuration flags only
> 
> .....
> My compiler info follows
> 
> mweylandt-laptop:~ michaelweylandt$ gcc --version
> i686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5666) (dot 3)
> Copyright (C) 2007 Free Software Foundation, Inc.
> 
> mweylandt-laptop:~ michaelweylandt$ gfortran --version
> GNU Fortran (GCC) 4.2.1 (Apple Inc. build 5664)
> Copyright (C) 2007 Free Software Foundation, Inc.
> 
> I do think that it's only a problem with my local build, as I can't
> replicate with Simon's nightly builds (http://r.research.att.com/),
> which are at r60887 currently. Is there anything else I should check
> with my setup? I don't see any advice on this particular issue in the
> R installation manual, but I easily could have overlooked it.

Just a thought.

According to http://r.research.att.com/tools/ shouldn't you be using gcc 5664 on Snow Leopard.
If I read the tools page correctly you seem to be using a Lion version of gcc.
On my 10.6.8 I have

[.../~]: gcc --version
i686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5664)
Copyright (C) 2007 Free Software Foundation, Inc.

[.../~]: gfortran --version
GNU Fortran (GCC) 4.2.1 (Apple Inc. build 5664)
Copyright (C) 2007 Free Software Foundation, Inc.


Berend


From ripley at stats.ox.ac.uk  Sun Oct  7 20:51:53 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 07 Oct 2012 19:51:53 +0100
Subject: [Rd] malloc error in tab-completion: OS X
In-Reply-To: <B83EA524-7DB6-4E6B-A5F4-8F6302460756@xs4all.nl>
References: <CAAmySGNgB6S3Ww1e1mhVqxg4T4qn143-H3=dejkU+Y7PCJPakA@mail.gmail.com>
	<B83EA524-7DB6-4E6B-A5F4-8F6302460756@xs4all.nl>
Message-ID: <5071CF49.2010606@stats.ox.ac.uk>

On 07/10/2012 18:11, Berend Hasselman wrote:
>
> On 07-10-2012, at 17:34, R. Michael Weylandt wrote:
>
>> I've just built R-devel (r60889) from source on my Mac OS X 10.6.8
>> using gcc from Xcode and gfortran from Simon. I didn't use all the
>> recommended configuration flags only
>>
>> .....
>> My compiler info follows
>>
>> mweylandt-laptop:~ michaelweylandt$ gcc --version
>> i686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5666) (dot 3)
>> Copyright (C) 2007 Free Software Foundation, Inc.
>>
>> mweylandt-laptop:~ michaelweylandt$ gfortran --version
>> GNU Fortran (GCC) 4.2.1 (Apple Inc. build 5664)
>> Copyright (C) 2007 Free Software Foundation, Inc.
>>
>> I do think that it's only a problem with my local build, as I can't
>> replicate with Simon's nightly builds (http://r.research.att.com/),
>> which are at r60887 currently. Is there anything else I should check
>> with my setup? I don't see any advice on this particular issue in the
>> R installation manual, but I easily could have overlooked it.
>
> Just a thought.
>
> According to http://r.research.att.com/tools/ shouldn't you be using gcc 5664 on Snow Leopard.
> If I read the tools page correctly you seem to be using a Lion version of gcc.
> On my 10.6.8 I have
>
> [.../~]: gcc --version
> i686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5664)
> Copyright (C) 2007 Free Software Foundation, Inc.

His and yours both say darwin10.  The Lion version says darwin11.  So it 
is claiming to be an OS 10.6.x aka Darwin 10.x compiler.


>
> [.../~]: gfortran --version
> GNU Fortran (GCC) 4.2.1 (Apple Inc. build 5664)
> Copyright (C) 2007 Free Software Foundation, Inc.
>
>
> Berend
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Sun Oct  7 21:00:12 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 07 Oct 2012 20:00:12 +0100
Subject: [Rd] malloc error in tab-completion: OS X
In-Reply-To: <CAAmySGNgB6S3Ww1e1mhVqxg4T4qn143-H3=dejkU+Y7PCJPakA@mail.gmail.com>
References: <CAAmySGNgB6S3Ww1e1mhVqxg4T4qn143-H3=dejkU+Y7PCJPakA@mail.gmail.com>
Message-ID: <5071D13C.3090005@stats.ox.ac.uk>

I would check the version of libreadline you compiled against.  Tab 
completion involves that library.

It works correctly for all my local builds, and nothing in that area in 
the R sources has changed for a long time.  I believe I am using 
http://r.research.att.com/libs/readline-5.2-12-darwin8-bin4.tar.gz .
And this is on Lion whereas Simon is building on Leopard (AFAIK).

On 07/10/2012 16:34, R. Michael Weylandt wrote:
> I've just built R-devel (r60889) from source on my Mac OS X 10.6.8
> using gcc from Xcode and gfortran from Simon. I didn't use all the
> recommended configuration flags only
>
> ./configure && make
>
> Still, I seem to pass "make check" and
> "make test-Segfault" in the tests directory with no problem, but the
> following leads
> to a persistent error + instant abort.
>
> 1) Start R
> 2) Type "tools::"
> 3) Tab to attempt to auto-complete
>
> resulting in some variation on
>
> mweylandt-laptop:~ michaelweylandt$ rDEVEL/bin/R --vanilla -q
>> tools::R(44436) malloc: *** error for object 0x1006d8700: incorrect checksum for freed object - object was probably modified after being freed.
> *** set a breakpoint in malloc_error_break to debug
> Abort trap
>
> at which point hitting <RET> drops me back into bash. This seems to
> only occur with tools and no other packages (that I've found). It also
> occurs whether tools has been library()'d or not, but sometimes it
> takes two tabbings.
>
> My compiler info follows
>
> mweylandt-laptop:~ michaelweylandt$ gcc --version
> i686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5666) (dot 3)
> Copyright (C) 2007 Free Software Foundation, Inc.
>
> mweylandt-laptop:~ michaelweylandt$ gfortran --version
> GNU Fortran (GCC) 4.2.1 (Apple Inc. build 5664)
> Copyright (C) 2007 Free Software Foundation, Inc.
>
> I do think that it's only a problem with my local build, as I can't
> replicate with Simon's nightly builds (http://r.research.att.com/),
> which are at r60887 currently. Is there anything else I should check
> with my setup? I don't see any advice on this particular issue in the
> R installation manual, but I easily could have overlooked it.
>
> Thanks,
> Michael
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From tlumley at uw.edu  Sun Oct  7 21:54:54 2012
From: tlumley at uw.edu (Thomas Lumley)
Date: Mon, 8 Oct 2012 08:54:54 +1300
Subject: [Rd] How to build a list with missing values? What is missing,
	anyway?
In-Reply-To: <CACk-te3Vtbi8gQWks4CjMt=xjS+g1UUptMgaEornRRy_sWXbnA@mail.gmail.com>
References: <CAJoaRhb8gq79aB3EXPeMa+n6eK6pj9NTFHFBJRUbP_=S1bbTaA@mail.gmail.com>
	<1349331704206-4644965.post@n4.nabble.com>
	<CAJoaRhbgikc=3Gpa8LAvSakjE=e95Z5akS7w5dHEND+yWHfJ6Q@mail.gmail.com>
	<CACk-te23paBonBtKY+eNoqVVdz_0186Y-DnfaMQ4zJOsZS-Gww@mail.gmail.com>
	<CAJoaRhYaRyoSzCKWgNNsuo63BazcG_CPDaAW_o4bXMMTeUdeLA@mail.gmail.com>
	<CACk-te3Vtbi8gQWks4CjMt=xjS+g1UUptMgaEornRRy_sWXbnA@mail.gmail.com>
Message-ID: <CAJ55+d+pq8Z7Dxp5TmTTSmpcoq9Qaf6OzEa5D_bhZ6NdY5Hg=w@mail.gmail.com>

On Fri, Oct 5, 2012 at 4:07 PM, Bert Gunter <gunter.berton at gene.com> wrote:
> On Thu, Oct 4, 2012 at 6:31 PM, Peter Meilstrup

>> explain some things, such as under what circumstances one would get a
>> "`...` used in incorrect context" error.
>
> How could it possibly know that?
>
> -- Bert

By looking at the code that throws the error.

The code is in src/main/eval.c, and the error is thrown in several
places when the symbol ... appears in a call being evaluated, and the
value of the symbol is neither the special DOTSXP type nor NULL.  That
is, if you use ... in code and there isn't a ... formal argument in
scope.

   -thomas


-- 
Thomas Lumley
Professor of Biostatistics
University of Auckland


From pdalgd at gmail.com  Sun Oct  7 22:54:19 2012
From: pdalgd at gmail.com (peter dalgaard)
Date: Sun, 7 Oct 2012 22:54:19 +0200
Subject: [Rd] malloc error in tab-completion: OS X
In-Reply-To: <5071D13C.3090005@stats.ox.ac.uk>
References: <CAAmySGNgB6S3Ww1e1mhVqxg4T4qn143-H3=dejkU+Y7PCJPakA@mail.gmail.com>
	<5071D13C.3090005@stats.ox.ac.uk>
Message-ID: <81D6F1FA-BE9A-4DCB-9E2A-B1841B2EEF04@gmail.com>


On Oct 7, 2012, at 21:00 , Prof Brian Ripley wrote:

> I would check the version of libreadline you compiled against.  Tab completion involves that library.
> 
> It works correctly for all my local builds, and nothing in that area in the R sources has changed for a long time.  I believe I am using http://r.research.att.com/libs/readline-5.2-12-darwin8-bin4.tar.gz .
> And this is on Lion whereas Simon is building on Leopard (AFAIK).

And Peter is building on Snow Leopard with AFAICT same libreadline:

$ ls /usr/local/lib/libreadline*
/usr/local/lib/libreadline.5.2.dylib	/usr/local/lib/libreadline.a
/usr/local/lib/libreadline.5.dylib	/usr/local/lib/libreadline.dylib

and has no issues with tools::<TAB>

BTW: readline is configurable. There wouldn't happen to be a rogue .inputrc around by any chance?


> 
> On 07/10/2012 16:34, R. Michael Weylandt wrote:
>> I've just built R-devel (r60889) from source on my Mac OS X 10.6.8
>> using gcc from Xcode and gfortran from Simon. I didn't use all the
>> recommended configuration flags only
>> 
>> ./configure && make
>> 
>> Still, I seem to pass "make check" and
>> "make test-Segfault" in the tests directory with no problem, but the
>> following leads
>> to a persistent error + instant abort.
>> 
>> 1) Start R
>> 2) Type "tools::"
>> 3) Tab to attempt to auto-complete
>> 
>> resulting in some variation on
>> 
>> mweylandt-laptop:~ michaelweylandt$ rDEVEL/bin/R --vanilla -q
>>> tools::R(44436) malloc: *** error for object 0x1006d8700: incorrect checksum for freed object - object was probably modified after being freed.
>> *** set a breakpoint in malloc_error_break to debug
>> Abort trap
>> 
>> at which point hitting <RET> drops me back into bash. This seems to
>> only occur with tools and no other packages (that I've found). It also
>> occurs whether tools has been library()'d or not, but sometimes it
>> takes two tabbings.
>> 
>> My compiler info follows
>> 
>> mweylandt-laptop:~ michaelweylandt$ gcc --version
>> i686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5666) (dot 3)
>> Copyright (C) 2007 Free Software Foundation, Inc.
>> 
>> mweylandt-laptop:~ michaelweylandt$ gfortran --version
>> GNU Fortran (GCC) 4.2.1 (Apple Inc. build 5664)
>> Copyright (C) 2007 Free Software Foundation, Inc.
>> 
>> I do think that it's only a problem with my local build, as I can't
>> replicate with Simon's nightly builds (http://r.research.att.com/),
>> which are at r60887 currently. Is there anything else I should check
>> with my setup? I don't see any advice on this particular issue in the
>> R installation manual, but I easily could have overlooked it.
>> 
>> Thanks,
>> Michael
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
> 
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From h.wickham at gmail.com  Mon Oct  8 15:22:06 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Mon, 8 Oct 2012 08:22:06 -0500
Subject: [Rd] Capturing environment associated with a promise
Message-ID: <CABdHhvHGm8qABh7XWeMNCA9qLUFEf1ksJaf0NDH_xhyHK=jtpw@mail.gmail.com>

Hi all,

It's possible to capture the expression associated with a promise
(using substitute). Is there any way to capture the environment
associated with a promise?  Similarly, is there any way to tell if
something is a promise without accidentally evaluating it?

Thanks!

Hadley

-- 
RStudio / Rice University
http://had.co.nz/


From murdoch.duncan at gmail.com  Mon Oct  8 15:50:50 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 08 Oct 2012 09:50:50 -0400
Subject: [Rd] Capturing environment associated with a promise
In-Reply-To: <CABdHhvHGm8qABh7XWeMNCA9qLUFEf1ksJaf0NDH_xhyHK=jtpw@mail.gmail.com>
References: <CABdHhvHGm8qABh7XWeMNCA9qLUFEf1ksJaf0NDH_xhyHK=jtpw@mail.gmail.com>
Message-ID: <5072DA3A.2030709@gmail.com>

On 12-10-08 9:22 AM, Hadley Wickham wrote:
> Hi all,
>
> It's possible to capture the expression associated with a promise
> (using substitute). Is there any way to capture the environment
> associated with a promise?  Similarly, is there any way to tell if
> something is a promise without accidentally evaluating it?


Neither of those is possible in user-level code.  The special functions 
get to see their arguments unevaluated, but users can't write specials, 
and there is no special to extract an environment from a promise.

I think the reasoning is that it keeps the semantics simpler, but I 
can't remember the cases that make user-level promise handling problematic.

Duncan Murdoch


From sylvain.loiseau at univ-paris13.fr  Mon Oct  8 16:11:48 2012
From: sylvain.loiseau at univ-paris13.fr (Sylvain Loiseau)
Date: Mon, 8 Oct 2012 16:11:48 +0200
Subject: [Rd] Effect of the R framework on ctype.c
Message-ID: <F6DDF0FF-58EB-4D94-97A5-2E290BA4A48F@univ-paris13.fr>

Dear all,

I'm facing a strange behavior in the the C code of a R package. This package, "rcqp", is a wrapper on an existing program that I did not write, "CWB".

In this package, on a linux (ubuntu and debian) system, the code :
     printf(%d\n", isupper('A'));
outputs :
    0
When compiled with the R framework (It behaves correctly when CWB is compiled as a standalone program).

On mac osx, the code produce the expected output.

This unexpected output is observed only in the context of CWB compiled through rcqp, only on linux (not mac osx), and only under certains circumstances, since a minimal R package produce the expected output. Even in CWB, this strange behavior is not observed in any part of the code.

When observed, a work-around for this problem is to remove the include in which this very function, isupper, is defined:
    #include <ctype.h>

Since the program is compiled and run correctly without this "include", isupper() seems to be also declared elsewhere or ctype to be found by another mechanism, and the problem seems be due to interactions between the R headers (?) and the include of the CWB code?

Have you already observed such an effect or do you have any hint?
Best,
Sylvain


-----
Sylvain Loiseau
sylvain.loiseau at univ-paris13.fr

Universit? Paris 13-Nord
Laboratoire Lexiques, Dictionnaires, Informatique
(UMR 7187 CNRS/Universit? Paris 13-Nord)
99 avenue Jean-Baptiste Cl?ment
F-93410 Villetaneuse


From luke-tierney at uiowa.edu  Mon Oct  8 16:35:52 2012
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Mon, 8 Oct 2012 09:35:52 -0500
Subject: [Rd] Capturing environment associated with a promise
In-Reply-To: <CABdHhvHGm8qABh7XWeMNCA9qLUFEf1ksJaf0NDH_xhyHK=jtpw@mail.gmail.com>
References: <CABdHhvHGm8qABh7XWeMNCA9qLUFEf1ksJaf0NDH_xhyHK=jtpw@mail.gmail.com>
Message-ID: <alpine.LFD.2.02.1210080933540.1869@nokomis.stat.uiowa.edu>

Promises are an implementation detail -- we need to be able to change
them, optimize them away, etc, so there is a limit on what we want to
expose.  Allowing a query of whether a binding is delayed or not
should be OK but would want to think that through more carefully
before committing to this.

luke

On Mon, 8 Oct 2012, Hadley Wickham wrote:

> Hi all,
>
> It's possible to capture the expression associated with a promise
> (using substitute). Is there any way to capture the environment
> associated with a promise?  Similarly, is there any way to tell if
> something is a promise without accidentally evaluating it?
>
> Thanks!
>
> Hadley
>
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From simon.urbanek at r-project.org  Mon Oct  8 17:17:23 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 8 Oct 2012 11:17:23 -0400
Subject: [Rd] Effect of the R framework on ctype.c
In-Reply-To: <F6DDF0FF-58EB-4D94-97A5-2E290BA4A48F@univ-paris13.fr>
References: <F6DDF0FF-58EB-4D94-97A5-2E290BA4A48F@univ-paris13.fr>
Message-ID: <845023F5-516E-41E9-8F36-58CFCA961DF9@r-project.org>

Sylvain,

I can see two possible reasons for this (both just speculative without an actual example):

a) it could be a conflict in (probably system) headers. isupper is typically a macro so I suspect what happens is that you have two definitions and depending on the sequence of includes and only the first one wins. By including/removing ctype.h you probably just change its sequence. Check the pre-processed .c files containing the isupper() for each of the two cases to see how they differ.

b) locale issues in your system. The implementation of isupper() may respect locales and R will setup the locale according to the environment, so maybe the locale is not defining isupper as you think. Maybe a) is only triggered by b) since the two versions may differ by locale.

There are other reasons one could think of (compiler bug when optimizing the isupper('A') constant) - it's hard to tell without a way to reproduce it.

Cheers,
Simon


On Oct 8, 2012, at 10:11 AM, Sylvain Loiseau wrote:

> Dear all,
> 
> I'm facing a strange behavior in the the C code of a R package. This package, "rcqp", is a wrapper on an existing program that I did not write, "CWB".
> 
> In this package, on a linux (ubuntu and debian) system, the code :
>     printf(%d\n", isupper('A'));
> outputs :
>    0
> When compiled with the R framework (It behaves correctly when CWB is compiled as a standalone program).
> 
> On mac osx, the code produce the expected output.
> 
> This unexpected output is observed only in the context of CWB compiled through rcqp, only on linux (not mac osx), and only under certains circumstances, since a minimal R package produce the expected output. Even in CWB, this strange behavior is not observed in any part of the code.
> 
> When observed, a work-around for this problem is to remove the include in which this very function, isupper, is defined:
>    #include <ctype.h>
> 
> Since the program is compiled and run correctly without this "include", isupper() seems to be also declared elsewhere or ctype to be found by another mechanism, and the problem seems be due to interactions between the R headers (?) and the include of the CWB code?
> 
> Have you already observed such an effect or do you have any hint?
> Best,
> Sylvain
> 
> 
> -----
> Sylvain Loiseau
> sylvain.loiseau at univ-paris13.fr
> 
> Universit? Paris 13-Nord
> Laboratoire Lexiques, Dictionnaires, Informatique
> (UMR 7187 CNRS/Universit? Paris 13-Nord)
> 99 avenue Jean-Baptiste Cl?ment
> F-93410 Villetaneuse
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From ggrothendieck at gmail.com  Mon Oct  8 17:23:57 2012
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 8 Oct 2012 11:23:57 -0400
Subject: [Rd] Capturing environment associated with a promise
In-Reply-To: <CABdHhvHGm8qABh7XWeMNCA9qLUFEf1ksJaf0NDH_xhyHK=jtpw@mail.gmail.com>
References: <CABdHhvHGm8qABh7XWeMNCA9qLUFEf1ksJaf0NDH_xhyHK=jtpw@mail.gmail.com>
Message-ID: <CAP01uR=x1SdWNZ+8c2=Prynm18om7yq0_u_Rf9UuAVFUA_zNwg@mail.gmail.com>

On Mon, Oct 8, 2012 at 9:22 AM, Hadley Wickham <h.wickham at gmail.com> wrote:
> Hi all,
>
> It's possible to capture the expression associated with a promise
> (using substitute). Is there any way to capture the environment
> associated with a promise?  Similarly, is there any way to tell if
> something is a promise without accidentally evaluating it?
>

Both of these are possible in C. See:

https://stat.ethz.ch/pipermail/r-devel/2007-September/046943.html

It shows how to query an object to see if its a promise and but rather
than extract the environment it shows how to copy a promise without
evaluating it; however, it was also my experience that these two were
what was actually needed rather than being able to extract the
environment.

I would also recommend you do some testing since I found that adding
promises did not always make as big a difference in performance as I
had hoped and the added complexity may not be worth it in all cases.
For example, I had a version of proto that supported promises but
ggplot2 only ran slightly faster with it so I did not pursue it any
further.  On the other hand if you are doing it to support
self-referential structures then that is a different matter.

-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From h.wickham at gmail.com  Tue Oct  9 17:57:52 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Tue, 9 Oct 2012 10:57:52 -0500
Subject: [Rd] Capturing environment associated with a promise
In-Reply-To: <alpine.LFD.2.02.1210080933540.1869@nokomis.stat.uiowa.edu>
References: <CABdHhvHGm8qABh7XWeMNCA9qLUFEf1ksJaf0NDH_xhyHK=jtpw@mail.gmail.com>
	<alpine.LFD.2.02.1210080933540.1869@nokomis.stat.uiowa.edu>
Message-ID: <CABdHhvEVcNzWcqhtMeQa2jOeWFcx+bkLTRenkDwsjrNZNmwY=w@mail.gmail.com>

> Promises are an implementation detail -- we need to be able to change
> them, optimize them away, etc, so there is a limit on what we want to
> expose.  Allowing a query of whether a binding is delayed or not
> should be OK but would want to think that through more carefully
> before committing to this.

Ok, thanks.

Hadley


-- 
RStudio / Rice University
http://had.co.nz/


From h.wickham at gmail.com  Tue Oct  9 17:58:35 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Tue, 9 Oct 2012 10:58:35 -0500
Subject: [Rd] Capturing environment associated with a promise
In-Reply-To: <CAP01uR=x1SdWNZ+8c2=Prynm18om7yq0_u_Rf9UuAVFUA_zNwg@mail.gmail.com>
References: <CABdHhvHGm8qABh7XWeMNCA9qLUFEf1ksJaf0NDH_xhyHK=jtpw@mail.gmail.com>
	<CAP01uR=x1SdWNZ+8c2=Prynm18om7yq0_u_Rf9UuAVFUA_zNwg@mail.gmail.com>
Message-ID: <CABdHhvGs62RRL8ky8hgZjvASLsXT8NA1EAZiJM2gzgt1R_1wGQ@mail.gmail.com>

> Both of these are possible in C. See:
>
> https://stat.ethz.ch/pipermail/r-devel/2007-September/046943.html

Cool, thanks.

> It shows how to query an object to see if its a promise and but rather
> than extract the environment it shows how to copy a promise without
> evaluating it; however, it was also my experience that these two were
> what was actually needed rather than being able to extract the
> environment.
>
> I would also recommend you do some testing since I found that adding
> promises did not always make as big a difference in performance as I
> had hoped and the added complexity may not be worth it in all cases.
> For example, I had a version of proto that supported promises but
> ggplot2 only ran slightly faster with it so I did not pursue it any
> further.  On the other hand if you are doing it to support
> self-referential structures then that is a different matter.

I'm mainly interested in this for pedagogy - giving students some
tools to inspect promises without evaluating them would be useful.

Hadley

-- 
RStudio / Rice University
http://had.co.nz/


From hb at biostat.ucsf.edu  Wed Oct 10 10:51:12 2012
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Tue, 9 Oct 2012 22:51:12 -1000
Subject: [Rd] setTimeLimit(): Is it possible to get the current time limits?
Message-ID: <CAFDcVCS-cEXQncLRusziP0iC1G+e5z=8WOZNR=xwemEFXxkbag@mail.gmail.com>

I'd like to set a temporary time limit with setTimeLimit() and then
undo these set time limits, i.e. return back to whatever the time
limits were before.  Is it possible to get the current time limits
(e.g. getTimeLimit())?

Thanks,

Henrik


From hpages at fhcrc.org  Thu Oct 11 08:22:55 2012
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Wed, 10 Oct 2012 23:22:55 -0700
Subject: [Rd] as.data.frame.matrix() returns an invalid object
Message-ID: <507665BF.9040000@fhcrc.org>

Hi,

Two ways to create what should normally be the same data frame:

   > df1 <- data.frame(a=character(0), b=character(0))> df1
   [1] a b
   <0 rows> (or 0-length row.names)

   > df2 <- as.data.frame(matrix(character(0), ncol=2, 
dimnames=list(NULL, letters[1:2])))
   > df2
   [1] a b
   <0 rows> (or 0-length row.names)

unique() works as expected except that I get a warning on 'df2':

   > unique(df1)
   [1] a b
   <0 rows> (or 0-length row.names)

   > unique(df2)
   [1] a b
   <0 rows> (or 0-length row.names)
   Warning message:
   In is.na(rows) : is.na() applied to non-(list or vector) of type 'NULL'

Look like the two data frames are not identical:

   > identical(df1, df2)
   [1] FALSE

   > all.equal(df1, df2)
   [1] "Attributes: < Length mismatch: comparison on first 1 components >"

   > attributes(df1)
   $names
   [1] "a" "b"

   $row.names
   integer(0)

   $class
   [1] "data.frame"

   > attributes(df2)
   $names
   [1] "a" "b"

   $class
   [1] "data.frame"

Actually 'df2' is considered broken by validObject():

   > validObject(df1)
   [1] TRUE

   > validObject(df2)
   Error in validObject(df2) :
     invalid class ?data.frame? object: slots in class definition but 
not in object: "row.names"

This is with R 2.15 and recent R devel.

Cheers,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From wdunlap at tibco.com  Thu Oct 11 20:59:52 2012
From: wdunlap at tibco.com (William Dunlap)
Date: Thu, 11 Oct 2012 18:59:52 +0000
Subject: [Rd] simplify2array edge case
Message-ID: <E66794E69CFDE04D9A70842786030B933713B7@PA-MBX04.na.tibco.com>

Should simplify2array(higher=TRUE) treat 1 by 1 matrices differently than others?
I expected a 3-dimensional array from all of the following 3 examples, not just the last 2.

  > str(simplify2array(list(array(11,c(1,1)), array(21,c(1,1))), higher=TRUE))
   num [1:2] 11 21
  > str(simplify2array(list(array(11:13,c(3,1)), array(21:23,c(3,1))), higher=TRUE))
   int [1:3, 1, 1:2] 11 12 13 21 22 23
  > str(simplify2array(list(array(11:13,c(1,3)), array(21:23,c(1,3))), higher=TRUE))
   int [1, 1:3, 1:2] 11 12 13 21 22 23

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com


From h.wickham at gmail.com  Fri Oct 12 05:13:16 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Thu, 11 Oct 2012 22:13:16 -0500
Subject: [Rd] Unevaluated .Call
Message-ID: <CABdHhvE3pvvbDbtWSVuTi_0YQfkebdrEqnaNbvmwAA480UszHQ@mail.gmail.com>

Hi all,

Is there an equivalent to .Call that passes the unevaluated arguments?
(e.g. like the equivalent of .Interval + eval = 10 in names.c)

If not, are there any disadvantages to doing something like this?

myfun <- function(...) {
  .Call("myfun", match.call(), parent.env())
}

Thanks!

Hadley

-- 
RStudio / Rice University
http://had.co.nz/


From smz.yij at gmail.com  Fri Oct 12 00:56:01 2012
From: smz.yij at gmail.com (smzyij)
Date: Thu, 11 Oct 2012 15:56:01 -0700 (PDT)
Subject: [Rd] R CMD SHLIB error bad value (core2) for -mtune= switch
Message-ID: <1349996161811-4645928.post@n4.nabble.com>

Hi there,

I'm having trouble to compile the R + C/C++ codes for this project from
Yahoo folks on latent factor models: 
https://github.com/yahoo/Latent-Factor-Models#readme

After downloading the package from the site, I could not successfully *make*
the files.

Here is the message: 
======================================================================================
sh-4.1$ make
R CMD SHLIB src/C/util.c src/C/factor_model_util.c src/C/pagerank.c
src/C/hierarchical.c src/C/factor_model_multicontext.c
src/C/factor_model_util2.cpp -o lib/c_funcs.so
make[1]: Entering directory `/cygdrive/c/Users/yi/Desktop/Yi/Latent Factor
models'
g++  -I"C:/PROGRA~1/R/R-215~1.1/include" -DNDEBUG          -O2 -Wall 
-mtune=core2 -c src/C/factor_model_util2.cpp -o src/C/factor_model_util2.o
src/C/factor_model_util2.cpp:1: error: bad value (core2) for -mtune= switch
C:/PROGRA~1/R/R-215~1.1/etc/i386/Makeconf:179: recipe for target
`src/C/factor_model_util2.o' failed
make[1]: *** [src/C/factor_model_util2.o] Error 1
make[1]: Leaving directory `/cygdrive/c/Users/yi/Desktop/Yi/Latent Factor
models'
Makefile:8: recipe for target `c_funcs' failed
make: *** [c_funcs] Error 1
======================================================================================

I am running cygwin (virtual linux environment on windows) on Windows 7
64bit Professional with Intel core i5 650 @3.20GHz 3.33GHz with 4GB memory
to take advantage of its c/c++ compile capabilities. My R version is R
2.15.1. It looks to me from the files in my src/C folder that  "src/C/util.c
src/C/factor_model_util.c src/C/pagerank.c src/C/hierarchical.c
src/C/factor_model_multicontext.c " have all been complied to their
corresponding *.o files, but not "src/C/factor_model_util2.cpp ".

Here is the makefile contents (You can download them from the link I posted
above):
======================================================================================
all: lib c_funcs

pagerank: src/C/pagerank.c src/C/util.h
	R CMD SHLIB src/C/pagerank.c -o lib/pagerank.so

c_funcs: src/C/util.h src/C/factor_model_util.h src/C/pagerank.c
src/C/util.c src/C/factor_model_util.c src/C/factor_model_util2.cpp
src/C/hierarchical.c src/C/hierarchical.h src/C/factor_model_multicontext.c
	R CMD SHLIB src/C/util.c src/C/factor_model_util.c src/C/pagerank.c
src/C/hierarchical.c src/C/factor_model_multicontext.c
src/C/factor_model_util2.cpp -o lib/c_funcs.so

clean:
	rm -f src/C/*.o src/C/*.so lib/*.so

lib:
	mkdir lib
======================================================================================

Here is the contents of the makevars:
======================================================================================
PKG_LIBS = $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS) -Wall
======================================================================================

I did check my C:\Program Files\R\R-2.15.1\etc\i386\Makeconf file, but could
not figure out why this matters:
bad value (core2) for -mtune= switch


Can someone help or what else do you need to help diagnose the issue here?

Many Thanks!

YI



--
View this message in context: http://r.789695.n4.nabble.com/R-CMD-SHLIB-error-bad-value-core2-for-mtune-switch-tp4645928.html
Sent from the R devel mailing list archive at Nabble.com.


From gunter.berton at gene.com  Thu Oct 11 16:02:20 2012
From: gunter.berton at gene.com (Bert Gunter)
Date: Thu, 11 Oct 2012 07:02:20 -0700
Subject: [Rd] as.data.frame.matrix() returns an invalid object
In-Reply-To: <507665BF.9040000@fhcrc.org>
References: <507665BF.9040000@fhcrc.org>
Message-ID: <CACk-te39O9M3XZ=MFBLSht1XP09N2Ce0iBDiFM66YEuLouGOeg@mail.gmail.com>

... and further

> identical(as.list(df2),as.list(df1))
[1] TRUE

in R 2.15.0

Not sure whether these sorts of degenerate cases are of much value,
though. But I'll leave that for the wizards.

-- Bert

On Wed, Oct 10, 2012 at 11:22 PM, Herv? Pag?s <hpages at fhcrc.org> wrote:
> Hi,
>
> Two ways to create what should normally be the same data frame:
>
>   > df1 <- data.frame(a=character(0), b=character(0))> df1
>   [1] a b
>   <0 rows> (or 0-length row.names)
>
>   > df2 <- as.data.frame(matrix(character(0), ncol=2, dimnames=list(NULL,
> letters[1:2])))
>   > df2
>   [1] a b
>   <0 rows> (or 0-length row.names)
>
> unique() works as expected except that I get a warning on 'df2':
>
>   > unique(df1)
>   [1] a b
>   <0 rows> (or 0-length row.names)
>
>   > unique(df2)
>   [1] a b
>   <0 rows> (or 0-length row.names)
>   Warning message:
>   In is.na(rows) : is.na() applied to non-(list or vector) of type 'NULL'
>
> Look like the two data frames are not identical:
>
>   > identical(df1, df2)
>   [1] FALSE
>
>   > all.equal(df1, df2)
>   [1] "Attributes: < Length mismatch: comparison on first 1 components >"
>
>   > attributes(df1)
>   $names
>   [1] "a" "b"
>
>   $row.names
>   integer(0)
>
>   $class
>   [1] "data.frame"
>
>   > attributes(df2)
>   $names
>   [1] "a" "b"
>
>   $class
>   [1] "data.frame"
>
> Actually 'df2' is considered broken by validObject():
>
>   > validObject(df1)
>   [1] TRUE
>
>   > validObject(df2)
>   Error in validObject(df2) :
>     invalid class ?data.frame? object: slots in class definition but not in
> object: "row.names"
>
> This is with R 2.15 and recent R devel.
>
> Cheers,
> H.
>
> --
> Herv? Pag?s
>
> Program in Computational Biology
> Division of Public Health Sciences
> Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N, M1-B514
> P.O. Box 19024
> Seattle, WA 98109-1024
>
> E-mail: hpages at fhcrc.org
> Phone:  (206) 667-5791
> Fax:    (206) 667-1319
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 

Bert Gunter
Genentech Nonclinical Biostatistics

Internal Contact Info:
Phone: 467-7374
Website:
http://pharmadevelopment.roche.com/index/pdb/pdb-functional-groups/pdb-biostatistics/pdb-ncb-home.htm


From ripley at stats.ox.ac.uk  Fri Oct 12 23:58:45 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 12 Oct 2012 22:58:45 +0100
Subject: [Rd] R CMD SHLIB error bad value (core2) for -mtune= switch
In-Reply-To: <1349996161811-4645928.post@n4.nabble.com>
References: <1349996161811-4645928.post@n4.nabble.com>
Message-ID: <50789295.5020905@stats.ox.ac.uk>

1) Cygwin is not a supported platform. See the 'R Installation and 
Administration Manual'.

2) C:\Program Files\R\R-2.15.1\etc\i386\Makeconf is for the Windows port 
of R, not Cygwin.

Are you perchance trying to use Windows R with Cygwin compilers? It will 
not work ....  Binary installations of R have to be used with exactly 
the compilers used to build R.

On 11/10/2012 23:56, smzyij wrote:
> Hi there,
>
> I'm having trouble to compile the R + C/C++ codes for this project from
> Yahoo folks on latent factor models:
> https://github.com/yahoo/Latent-Factor-Models#readme
>
> After downloading the package from the site, I could not successfully *make*
> the files.
>
> Here is the message:
> ======================================================================================
> sh-4.1$ make
> R CMD SHLIB src/C/util.c src/C/factor_model_util.c src/C/pagerank.c
> src/C/hierarchical.c src/C/factor_model_multicontext.c
> src/C/factor_model_util2.cpp -o lib/c_funcs.so
> make[1]: Entering directory `/cygdrive/c/Users/yi/Desktop/Yi/Latent Factor
> models'
> g++  -I"C:/PROGRA~1/R/R-215~1.1/include" -DNDEBUG          -O2 -Wall
> -mtune=core2 -c src/C/factor_model_util2.cpp -o src/C/factor_model_util2.o
> src/C/factor_model_util2.cpp:1: error: bad value (core2) for -mtune= switch
> C:/PROGRA~1/R/R-215~1.1/etc/i386/Makeconf:179: recipe for target
> `src/C/factor_model_util2.o' failed
> make[1]: *** [src/C/factor_model_util2.o] Error 1
> make[1]: Leaving directory `/cygdrive/c/Users/yi/Desktop/Yi/Latent Factor
> models'
> Makefile:8: recipe for target `c_funcs' failed
> make: *** [c_funcs] Error 1
> ======================================================================================
>
> I am running cygwin (virtual linux environment on windows) on Windows 7
> 64bit Professional with Intel core i5 650 @3.20GHz 3.33GHz with 4GB memory
> to take advantage of its c/c++ compile capabilities. My R version is R
> 2.15.1. It looks to me from the files in my src/C folder that  "src/C/util.c
> src/C/factor_model_util.c src/C/pagerank.c src/C/hierarchical.c
> src/C/factor_model_multicontext.c " have all been complied to their
> corresponding *.o files, but not "src/C/factor_model_util2.cpp ".
>
> Here is the makefile contents (You can download them from the link I posted
> above):
> ======================================================================================
> all: lib c_funcs
>
> pagerank: src/C/pagerank.c src/C/util.h
> 	R CMD SHLIB src/C/pagerank.c -o lib/pagerank.so
>
> c_funcs: src/C/util.h src/C/factor_model_util.h src/C/pagerank.c
> src/C/util.c src/C/factor_model_util.c src/C/factor_model_util2.cpp
> src/C/hierarchical.c src/C/hierarchical.h src/C/factor_model_multicontext.c
> 	R CMD SHLIB src/C/util.c src/C/factor_model_util.c src/C/pagerank.c
> src/C/hierarchical.c src/C/factor_model_multicontext.c
> src/C/factor_model_util2.cpp -o lib/c_funcs.so
>
> clean:
> 	rm -f src/C/*.o src/C/*.so lib/*.so
>
> lib:
> 	mkdir lib
> ======================================================================================
>
> Here is the contents of the makevars:
> ======================================================================================
> PKG_LIBS = $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS) -Wall
> ======================================================================================
>
> I did check my C:\Program Files\R\R-2.15.1\etc\i386\Makeconf file, but could
> not figure out why this matters:
> bad value (core2) for -mtune= switch
>
>
> Can someone help or what else do you need to help diagnose the issue here?
>
> Many Thanks!
>
> YI
>
>
>
> --
> View this message in context: http://r.789695.n4.nabble.com/R-CMD-SHLIB-error-bad-value-core2-for-mtune-switch-tp4645928.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From rkjandra at gmail.com  Sat Oct 13 09:09:38 2012
From: rkjandra at gmail.com (Rob Anderson)
Date: Sat, 13 Oct 2012 03:09:38 -0400
Subject: [Rd] Multithreaded code in .Call interface
Message-ID: <CAApt6DJx=5yH2T=R424XkO9+nDUo_vh-AV7TuYZf8ANESzvJxg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121013/aa482751/attachment.pl>

From pdalgd at gmail.com  Sat Oct 13 09:10:47 2012
From: pdalgd at gmail.com (peter dalgaard)
Date: Sat, 13 Oct 2012 09:10:47 +0200
Subject: [Rd] as.data.frame.matrix() returns an invalid object
In-Reply-To: <CACk-te39O9M3XZ=MFBLSht1XP09N2Ce0iBDiFM66YEuLouGOeg@mail.gmail.com>
References: <507665BF.9040000@fhcrc.org>
	<CACk-te39O9M3XZ=MFBLSht1XP09N2Ce0iBDiFM66YEuLouGOeg@mail.gmail.com>
Message-ID: <75E59C99-BA7C-4A93-ADEF-1BCE949BA5D1@gmail.com>


On Oct 11, 2012, at 16:02 , Bert Gunter wrote:

> ... and further
> 
>> identical(as.list(df2),as.list(df1))
> [1] TRUE
> 
> in R 2.15.0
> 
> Not sure whether these sorts of degenerate cases are of much value,
> though. But I'll leave that for the wizards.

Looks like this is easier to fix that to argue pro/con fixing it...

AFAICS, there's a gap in the logic in as.data.frame.matrix:

    if (length(row.names) != nrows) 
        row.names <- .set_row_names(nrows)

but length(NULL) is 0 so we can end up leaving row.names at NULL and eventually nulling it in the result. An explicit check for is.null(row.names) should help.

-pd
> 
> -- Bert
> 
> On Wed, Oct 10, 2012 at 11:22 PM, Herv? Pag?s <hpages at fhcrc.org> wrote:
>> Hi,
>> 
>> Two ways to create what should normally be the same data frame:
>> 
>>> df1 <- data.frame(a=character(0), b=character(0))> df1
>>  [1] a b
>>  <0 rows> (or 0-length row.names)
>> 
>>> df2 <- as.data.frame(matrix(character(0), ncol=2, dimnames=list(NULL,
>> letters[1:2])))
>>> df2
>>  [1] a b
>>  <0 rows> (or 0-length row.names)
>> 
>> unique() works as expected except that I get a warning on 'df2':
>> 
>>> unique(df1)
>>  [1] a b
>>  <0 rows> (or 0-length row.names)
>> 
>>> unique(df2)
>>  [1] a b
>>  <0 rows> (or 0-length row.names)
>>  Warning message:
>>  In is.na(rows) : is.na() applied to non-(list or vector) of type 'NULL'
>> 
>> Look like the two data frames are not identical:
>> 
>>> identical(df1, df2)
>>  [1] FALSE
>> 
>>> all.equal(df1, df2)
>>  [1] "Attributes: < Length mismatch: comparison on first 1 components >"
>> 
>>> attributes(df1)
>>  $names
>>  [1] "a" "b"
>> 
>>  $row.names
>>  integer(0)
>> 
>>  $class
>>  [1] "data.frame"
>> 
>>> attributes(df2)
>>  $names
>>  [1] "a" "b"
>> 
>>  $class
>>  [1] "data.frame"
>> 
>> Actually 'df2' is considered broken by validObject():
>> 
>>> validObject(df1)
>>  [1] TRUE
>> 
>>> validObject(df2)
>>  Error in validObject(df2) :
>>    invalid class ?data.frame? object: slots in class definition but not in
>> object: "row.names"
>> 
>> This is with R 2.15 and recent R devel.
>> 
>> Cheers,
>> H.
>> 
>> --
>> Herv? Pag?s
>> 
>> Program in Computational Biology
>> Division of Public Health Sciences
>> Fred Hutchinson Cancer Research Center
>> 1100 Fairview Ave. N, M1-B514
>> P.O. Box 19024
>> Seattle, WA 98109-1024
>> 
>> E-mail: hpages at fhcrc.org
>> Phone:  (206) 667-5791
>> Fax:    (206) 667-1319
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 
> 
> -- 
> 
> Bert Gunter
> Genentech Nonclinical Biostatistics
> 
> Internal Contact Info:
> Phone: 467-7374
> Website:
> http://pharmadevelopment.roche.com/index/pdb/pdb-functional-groups/pdb-biostatistics/pdb-ncb-home.htm
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From ripley at stats.ox.ac.uk  Sat Oct 13 10:57:22 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 13 Oct 2012 09:57:22 +0100
Subject: [Rd] Multithreaded code in .Call interface
In-Reply-To: <CAApt6DJx=5yH2T=R424XkO9+nDUo_vh-AV7TuYZf8ANESzvJxg@mail.gmail.com>
References: <CAApt6DJx=5yH2T=R424XkO9+nDUo_vh-AV7TuYZf8ANESzvJxg@mail.gmail.com>
Message-ID: <50792CF2.4010006@stats.ox.ac.uk>

On 13/10/2012 08:09, Rob Anderson wrote:
> Hi,
>
> I was wondering if it is safe to call R functions and/or R BLAS functions
> from within multithreaded C/C++ code(.Call interface)? It is not in case
> with MATLAB. I was experimenting  using pthreads and OpenMP.

Not unless it is documented to be so.  (I believe the internal BLAS to 
be fine, but you could use an external one: although with care if that 
also uses threads.)

See also ?8.1.5 of 'Writing R Extensions'.

> Thanks,
> Rob


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From O.Kullmann at swansea.ac.uk  Sat Oct 13 23:16:00 2012
From: O.Kullmann at swansea.ac.uk (Oliver Kullmann)
Date: Sat, 13 Oct 2012 22:16:00 +0100
Subject: [Rd] installation of R (2.14.1 and 2.15.1) fails due to
 [reg-packages.Rout] Error
Message-ID: <20121013211600.GB3069@csltok.swansea.ac.uk>

Hello,

I'm trying to install R from sources on two Linux machines (both with Suse 12.2):

1.
> uname -a
Linux cs-wsok 3.4.6-2.10-desktop #1 SMP PREEMPT Thu Jul 26 09:36:26 UTC
2012 (641c197) x86_64 x86_64 x86_64 GNU/Linux
2.
> uname -a
Linux csltok.swansea.ac.uk 3.4.6-2.10-desktop #1 SMP PREEMPT Thu Jul 26
09:36:26 UTC 2012 (641c197) x86_64 x86_64 x86_64 GNU/Linux

I am trying version 2.14.1 on first machine and 2.15.1 on second machine.
On both machines I'm using gcc and gfortran, version 4.5.4.
On both machines I get the same test-error (the example below is for
2.14.1, but the messages are identicall with 2.15.1):

running code in 'reg-examples1.R' ... OK
running code in 'reg-examples2.R' ... OK
running code in 'reg-packages.R' ...make[4]: *** [reg-packages.Rout]
Error 1
make[4]: Leaving directory
`/home/csoliver/OKplatform/ExternalSources/builds/R/R-2.14.1/tests'
make[3]: *** [test-Reg] Error 2
make[3]: Leaving directory
`/home/csoliver/OKplatform/ExternalSources/builds/R/R-2.14.1/tests'
make[2]: *** [test-all-basics] Error 1

The error-log in reg-packages.Rout.fail is (again for 2.14.1, but it is
identical for 2.15.1, except of the obvious differences):

---

R version 2.14.1 (2011-12-22)
Copyright (C) 2011 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ## PR 1271  detach("package:base") crashes R.
> try(detach("package:base"))
Error in detach("package:base") : detaching "package:base" is not allowed
> 
> 
> ## invalid 'lib.loc'
> stopifnot(length(installed.packages("mgcv")) == 0)
> ## gave a low-level error message
> 
> 
> ## package.skeleton() with metadata-only code
> ## work in current (= ./tests/ directory):
> tmp <- tempfile()
> writeLines(c('setClass("foo", contains="numeric")',
+              'setMethod("show", "foo",',
+              '          function(object) cat("I am a \\"foo\\"\\n"))'),
+            tmp)
> if(file.exists("myTst")) unlink("myTst", recursive=TRUE)
> package.skeleton("myTst", code_files = tmp)# with a file name warning
Creating directories ...
Creating DESCRIPTION ...
Creating NAMESPACE ...
Creating Read-and-delete-me ...
Copying code files ...
Making help files ...
Done.
Further steps are described in './myTst/Read-and-delete-me'.
Warning message:
In package.skeleton("myTst", code_files = tmp) :
  Invalid file name(s) for R code in ./myTst/R:
  'file7da22fb20b64'
 are now renamed to 'z<name>.R'
> file.copy(tmp, (tm2 <- paste(tmp,".R", sep="")))
[1] TRUE
> unlink("myTst", recursive=TRUE)
> op <- options(warn=2) # *NO* "invalid file name" warning {failed in 2.7.[01]}:
> package.skeleton("myTst", code_files = tm2, namespace=TRUE)
Creating directories ...
Creating DESCRIPTION ...
Creating NAMESPACE ...
Creating Read-and-delete-me ...
Copying code files ...
Making help files ...
Done.
Further steps are described in './myTst/Read-and-delete-me'.
> options(op)
> ##_2_ only a class, no generics/methods:
> writeLines(c('setClass("DocLink",',
+              'representation(name="character",',
+              '               desc="character"))'), tmp)
> if(file.exists("myTst2")) unlink("myTst2", recursive=TRUE)
> package.skeleton("myTst2", code_files = tmp)
Creating directories ...
Creating DESCRIPTION ...
Creating NAMESPACE ...
Creating Read-and-delete-me ...
Copying code files ...
Making help files ...
Done.
Further steps are described in './myTst2/Read-and-delete-me'.
Warning message:
In package.skeleton("myTst2", code_files = tmp) :
  Invalid file name(s) for R code in ./myTst2/R:
  'file7da22fb20b64'
 are now renamed to 'z<name>.R'
> ##- end_2_ # failed in R 2.11.0
> stopifnot(1 == grep("setClass",
+         readLines(list.files("myTst/R", full.names=TRUE))),
+         c("foo-class.Rd","show-methods.Rd") %in% list.files("myTst/man"))
> ## failed for several reasons in R < 2.7.0
> ##
> ## Part 2: -- build, install, load and "inspect" the package:
> dir.exists <- function(x)
+     is.character(x) && file.exists(x) && file.info(path.expand(x))$isdir
> build.pkg <- function(dir) {
+     stopifnot(dir.exists(dir))
+     patt <- paste(basename(dir), ".*tar\\.gz$", sep="_")
+     unlink(dir('.', pattern = patt))
+     Rcmd <- paste(file.path(R.home("bin"), "R"), "CMD")
+     r <- tail(system(paste(Rcmd, "build --keep-empty-dirs", dir),
+                      intern = TRUE), 3)
+     ## return name of tar file built
+     dir('.', pattern = patt)
+ }
> build.pkg("myTst")

[1] "myTst_1.0.tar.gz"
> ## clean up any previous attempt (which might have left a 00LOCK)
> unlink("myLib", recursive = TRUE)
> dir.create("myLib")
> install.packages("myTst", lib = "myLib", repos=NULL, type = "source") # with warnings
* installing *source* package 'myTst' ...
** R
** preparing package for lazy loading
** help
Warning: /home/csoliver/OKplatform/ExternalSources/builds/R/R-2.14.1/tests/myTst/man/myTst-package.Rd:34: All text must be in a section
Warning: /home/csoliver/OKplatform/ExternalSources/builds/R/R-2.14.1/tests/myTst/man/myTst-package.Rd:35: All text must be in a section
*** installing help indices
** building package indices ...
** testing if installed package can be loaded

* DONE (myTst)
> print(installed.packages(lib.loc= "myLib", priority= "NA"))## (PR#13332)
      Package LibPath Version Priority Depends   Imports LinkingTo Suggests
myTst "myTst" "myLib" "1.0"   NA       "methods" NA      NA        NA      
      Enhances OS_type License                     Built   
myTst NA       NA      "What license is it under?" "2.14.1"
> stopifnot(require("myTst",lib = "myLib"))
Loading required package: myTst
> sm <- findMethods(show, where= as.environment("package:myTst"))
> stopifnot(names(sm at names) == "foo")
> unlink("myTst_*")
> 
> ## More building & installing packages
> ## NB: tests were added here for 2.11.0.
> ## NB^2: do not do this in the R sources!
> ## and this testdir is not installed.
> pkgSrcPath <- file.path(Sys.getenv("SRCDIR"), "Pkgs")
> if(file_test("-d", pkgSrcPath)) {
+     ## could use file.copy(recursive = TRUE)
+     system(paste('cp -r', shQuote(pkgSrcPath), shQuote(tempdir())))
+     pkgPath <- file.path(tempdir(), "Pkgs")
+ #    op <- options(warn = 2)    # There should be *NO* warnings here!
+     ## pkgB tests an empty R directory
+     dir.create(file.path(pkgPath, "pkgB", "R"), recursive = TRUE,
+                showWarnings = FALSE)
+     p.lis <- c("pkgA", "pkgB", "exNSS4")
+     for(p. in p.lis) {
+         cat("building package", p., "...\n")
+         r <- build.pkg(file.path(pkgPath, p.))
+         cat("installing package", p., "using file", r, "...\n")
+         ## we could install the tar file ... (see build.pkg()'s definition)
+         install.packages(r, lib = "myLib", repos=NULL, type = "source")
+         stopifnot(require(p.,lib = "myLib", character.only=TRUE))
+         detach(pos = match(p., sub("^package:","", search())))
+     }
+     ## TODO: not just print, but check the "list":
+     res <- installed.packages(lib.loc = "myLib", priority = "NA")
+     print(res)
+ #    options(op)
+     unlink("myLib", recursive = TRUE)
+     unlink(file.path(pkgPath), recursive = TRUE)
+ }
building package pkgA ...

installing package pkgA using file pkgA_1.1.tar.gz ...
Error in untar2(tarfile, files, list, exdir) : unsupported entry type 'x'
Loading required package: pkgA
Error: require(p., lib = "myLib", character.only = TRUE) is not TRUE
In addition: Warning messages:
1: In install.packages(r, lib = "myLib", repos = NULL, type = "source") :
  installation of package 'pkgA_1.1.tar.gz' had non-zero exit status
2: In library(package, lib.loc = lib.loc, character.only = TRUE, logical.return = TRUE,  :
  there is no package called 'pkgA'
Execution halted

---

Unfortunatly the above says nothing to me, and I didn't find information
on the Internet.

I hope somebody can help. In the past the build-process worked (at least
for R-version 2.14.1) with Suse 11.2 and gcc version 4.5.3.

Thanks for your attention.

Oliver


From richierocks at gmail.com  Sun Oct 14 13:06:17 2012
From: richierocks at gmail.com (Richard Cotton)
Date: Sun, 14 Oct 2012 12:06:17 +0100
Subject: [Rd] How deep can/should lists be nested?
Message-ID: <CAPp_+=f2tkG2nZ-bctBDdg41AEZsgvAmM0Qt4X8g3F5U=XA59w@mail.gmail.com>

I started idly wondering how deeply lists could be nested, and
couldn't find an explicit limit in the documentation.  With this
simple test

a_list <- list()
count <- 0
repeat
{
  a_list[[1]] <- a_list
  count <- count + 1
}

my (Win7, R-2.16.0 devel) machine threw an error when count got close to 25000.

The error that stopped it was

Error: protect(): protection stack overflow

I don't know how easy it would be to stop such an error occuring, and
it probably isn't that useful to be able to nest lists any further.  I
do think it might be useful for users to be able to know how deeply
they can nest lists though.

Perhaps it would be better to limit nesting to the value of
getOption("expressions").  Does anyone have any strong feelings on
what the correct behaviour should be?

--
Regards,
Richie

live-analytics.com
4dpiecharts.com


From murdoch.duncan at gmail.com  Sun Oct 14 13:53:09 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sun, 14 Oct 2012 07:53:09 -0400
Subject: [Rd] How deep can/should lists be nested?
In-Reply-To: <CAPp_+=f2tkG2nZ-bctBDdg41AEZsgvAmM0Qt4X8g3F5U=XA59w@mail.gmail.com>
References: <CAPp_+=f2tkG2nZ-bctBDdg41AEZsgvAmM0Qt4X8g3F5U=XA59w@mail.gmail.com>
Message-ID: <507AA7A5.4060109@gmail.com>

On 12-10-14 7:06 AM, Richard Cotton wrote:
> I started idly wondering how deeply lists could be nested, and
> couldn't find an explicit limit in the documentation.  With this
> simple test
>
> a_list <- list()
> count <- 0
> repeat
> {
>    a_list[[1]] <- a_list
>    count <- count + 1
> }
>
> my (Win7, R-2.16.0 devel) machine threw an error when count got close to 25000.
>
> The error that stopped it was
>
> Error: protect(): protection stack overflow
>
> I don't know how easy it would be to stop such an error occuring, and
> it probably isn't that useful to be able to nest lists any further.  I
> do think it might be useful for users to be able to know how deeply
> they can nest lists though.
>
> Perhaps it would be better to limit nesting to the value of
> getOption("expressions").  Does anyone have any strong feelings on
> what the correct behaviour should be?

There should be no limit other than memory.  That overflow you saw is a 
bug.  Not sure it's worth fixing, since 25000 is far beyond any sensible 
nesting level, but I'll take a look.

Duncan Murdoch


From ripley at stats.ox.ac.uk  Sun Oct 14 14:39:56 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 14 Oct 2012 13:39:56 +0100
Subject: [Rd] How deep can/should lists be nested?
In-Reply-To: <507AA7A5.4060109@gmail.com>
References: <CAPp_+=f2tkG2nZ-bctBDdg41AEZsgvAmM0Qt4X8g3F5U=XA59w@mail.gmail.com>
	<507AA7A5.4060109@gmail.com>
Message-ID: <507AB29C.2030500@stats.ox.ac.uk>

On 14/10/2012 12:53, Duncan Murdoch wrote:
> On 12-10-14 7:06 AM, Richard Cotton wrote:
>> I started idly wondering how deeply lists could be nested, and
>> couldn't find an explicit limit in the documentation.  With this
>> simple test
>>
>> a_list <- list()
>> count <- 0
>> repeat
>> {
>>    a_list[[1]] <- a_list
>>    count <- count + 1
>> }
>>
>> my (Win7, R-2.16.0 devel) machine threw an error when count got close
>> to 25000.
>>
>> The error that stopped it was
>>
>> Error: protect(): protection stack overflow
>>
>> I don't know how easy it would be to stop such an error occuring, and
>> it probably isn't that useful to be able to nest lists any further.  I
>> do think it might be useful for users to be able to know how deeply
>> they can nest lists though.
>>
>> Perhaps it would be better to limit nesting to the value of
>> getOption("expressions").  Does anyone have any strong feelings on
>> what the correct behaviour should be?
>
> There should be no limit other than memory.  That overflow you saw is a
> bug.  Not sure it's worth fixing, since 25000 is far beyond any sensible
> nesting level, but I'll take a look.

I'm not so sure it is a bug.  There have to be limits other than the 
total amount of memory (the C stack size is another one): one was 
reached and the computation was stopped cleanly.  We even allow the size 
of the ppstack to be changed in the extremely rare cases where this 
might matter.

But the real point is that that limit is not on the nesting of lists but 
on that particular way to create a deeply nested list.  We know that 
some code to copy lists is sub-optimal, but we've not been shown a 
real-world example where it mattered enough to prioritize looking into.

>
> Duncan Murdoch


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From richierocks at gmail.com  Sun Oct 14 15:36:29 2012
From: richierocks at gmail.com (Richard Cotton)
Date: Sun, 14 Oct 2012 14:36:29 +0100
Subject: [Rd] How deep can/should lists be nested?
In-Reply-To: <507AB29C.2030500@stats.ox.ac.uk>
References: <CAPp_+=f2tkG2nZ-bctBDdg41AEZsgvAmM0Qt4X8g3F5U=XA59w@mail.gmail.com>
	<507AA7A5.4060109@gmail.com> <507AB29C.2030500@stats.ox.ac.uk>
Message-ID: <CAPp_+=efR7rrWJBGWi514PZvQkwk2pNrjFWZY=pqAADQfse79w@mail.gmail.com>

I agree that real-world uses of nesting this deep are rare enough to
not worry about fixing code (unless there is something extremely
trivial that can done).

My main concern is that it doesn't seem to be documented how much
nesting is possible, and I couldn't even guess the order of magnitude
without trying it.

This was why I thought setting the value to getOption("expressions")
might be beneficial - at least the user knows when they have to stop.
The simpler alternative may just be to add a line to the documentation
to say something like "although lists can theoretically be nested
indefinitely, in practice allocation is limited by memory and stack
size, typically to tens of thousands of levels".

The obvious place to put such a message would be in ?list, though at
the moment there are no nesting examples on the page.

On 14 October 2012 13:39, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On 14/10/2012 12:53, Duncan Murdoch wrote:
>>
>> On 12-10-14 7:06 AM, Richard Cotton wrote:
>>>
>>> I started idly wondering how deeply lists could be nested, and
>>> couldn't find an explicit limit in the documentation.  With this
>>> simple test
>>>
>>> a_list <- list()
>>> count <- 0
>>> repeat
>>> {
>>>    a_list[[1]] <- a_list
>>>    count <- count + 1
>>> }
>>>
>>> my (Win7, R-2.16.0 devel) machine threw an error when count got close
>>> to 25000.
>>>
>>> The error that stopped it was
>>>
>>> Error: protect(): protection stack overflow
>>>
>>> I don't know how easy it would be to stop such an error occuring, and
>>> it probably isn't that useful to be able to nest lists any further.  I
>>> do think it might be useful for users to be able to know how deeply
>>> they can nest lists though.
>>>
>>> Perhaps it would be better to limit nesting to the value of
>>> getOption("expressions").  Does anyone have any strong feelings on
>>> what the correct behaviour should be?
>>
>>
>> There should be no limit other than memory.  That overflow you saw is a
>> bug.  Not sure it's worth fixing, since 25000 is far beyond any sensible
>> nesting level, but I'll take a look.
>
>
> I'm not so sure it is a bug.  There have to be limits other than the total
> amount of memory (the C stack size is another one): one was reached and the
> computation was stopped cleanly.  We even allow the size of the ppstack to
> be changed in the extremely rare cases where this might matter.
>
> But the real point is that that limit is not on the nesting of lists but on
> that particular way to create a deeply nested list.  We know that some code
> to copy lists is sub-optimal, but we've not been shown a real-world example
> where it mattered enough to prioritize looking into.
>
>>
>> Duncan Murdoch
>
>
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595



-- 
Regards,
Richie

live-analytics.com
4dpiecharts.com


From ripley at stats.ox.ac.uk  Mon Oct 15 10:29:57 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 15 Oct 2012 09:29:57 +0100 (BST)
Subject: [Rd] Translations in R 2.15.2-to-be
Message-ID: <alpine.LFD.2.02.1210150859510.10489@auk.stats.ox.ac.uk>

This year we have done a refresh of the translations mid-cycle: all 
the updates are now in R-patched for release in R 2.15.2 on the 26th. 
This includes several of the recommended packages.

If you use R set to a language other than English, please try 
R-patched (binaries are available for Windows at 
http://cran.r-project.org/bin/windows/base/rpatched.html and OS X at 
http://r.research.att.com/R-2.15-branch-leopard.pkg) and report any 
problems with translations to the translation team 
(http://developer.r-project.org/TranslationTeams.html) or if they are 
serious (e.g. R will not even start in that language) to R-core.

Brian Ripley

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From r.d.morey at rug.nl  Sun Oct 14 15:33:20 2012
From: r.d.morey at rug.nl (Richard D. Morey)
Date: Sun, 14 Oct 2012 15:33:20 +0200
Subject: [Rd] problem with OSX binary package build?
Message-ID: <507ABF20.6000403@rug.nl>

I noticed that my package BayesFactor 
(http://cran.r-project.org/web/packages/BayesFactor/index.html) is not 
available on Mac OS, and the note says to see the check log. The only 
issue in the check log is a note:

checking R code for possible problems ... NOTE
all.Nways.env.mc : <local>: no visible binding for global variable 'i'
all.Nways.env.mc: no visible binding for global variable 'i'

This is due to the fact that I'm using the foreach package. Do I need to 
change something to get the OSX binary on CRAN?


From ligges at statistik.tu-dortmund.de  Mon Oct 15 13:50:21 2012
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Mon, 15 Oct 2012 13:50:21 +0200
Subject: [Rd] problem with OSX binary package build?
In-Reply-To: <507ABF20.6000403@rug.nl>
References: <507ABF20.6000403@rug.nl>
Message-ID: <507BF87D.8080309@statistik.tu-dortmund.de>



On 14.10.2012 15:33, Richard D. Morey wrote:
> I noticed that my package BayesFactor
> (http://cran.r-project.org/web/packages/BayesFactor/index.html) is not
> available on Mac OS, and the note says to see the check log. The only
> issue in the check log is a note:
>
> checking R code for possible problems ... NOTE
> all.Nways.env.mc : <local>: no visible binding for global variable 'i'
> all.Nways.env.mc: no visible binding for global variable 'i'
>
> This is due to the fact that I'm using the foreach package. Do I need to
> change something to get the OSX binary on CRAN?

It seems to be there when I follow that link.

Uwe Ligges


> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From simon.urbanek at r-project.org  Mon Oct 15 14:06:20 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 15 Oct 2012 08:06:20 -0400
Subject: [Rd] problem with OSX binary package build?
In-Reply-To: <507ABF20.6000403@rug.nl>
References: <507ABF20.6000403@rug.nl>
Message-ID: <FEB5A8C9-6822-4BE2-844C-8970A1BB3B66@r-project.org>


On Oct 14, 2012, at 9:33 AM, Richard D. Morey wrote:

> I noticed that my package BayesFactor (http://cran.r-project.org/web/packages/BayesFactor/index.html) is not available on Mac OS, and the note says to see the check log.

Are you sure you're looking at the right page? CRAN says

Downloads:

Package source:	BayesFactor_0.8.3.tar.gz
MacOS X binary:	BayesFactor_0.8.3.tgz
Windows binary:	BayesFactor_0.8.3.zip

Cheers,
Simon


> The only issue in the check log is a note:
> 
> checking R code for possible problems ... NOTE
> all.Nways.env.mc : <local>: no visible binding for global variable 'i'
> all.Nways.env.mc: no visible binding for global variable 'i'
> 
> This is due to the fact that I'm using the foreach package. Do I need to change something to get the OSX binary on CRAN?
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From r.d.morey at rug.nl  Mon Oct 15 14:10:22 2012
From: r.d.morey at rug.nl (Richard D. Morey)
Date: Mon, 15 Oct 2012 14:10:22 +0200
Subject: [Rd] problem with OSX binary package build?
In-Reply-To: <FEB5A8C9-6822-4BE2-844C-8970A1BB3B66@r-project.org>
References: <507ABF20.6000403@rug.nl>
	<FEB5A8C9-6822-4BE2-844C-8970A1BB3B66@r-project.org>
Message-ID: <507BFD2E.1040109@rug.nl>

Yes, I was looking at the right package. At some point last night it 
changed from "not available (see check log)" to available.

Previous to "not available (see check log)" it was "not available (the 
package is either new or...)" So when it changed to "not available (see 
check log)" I assumed there was a problem.

Richard

On 15/10/12 2:06 PM, Simon Urbanek wrote:
> On Oct 14, 2012, at 9:33 AM, Richard D. Morey wrote:
>
>> I noticed that my package BayesFactor (http://cran.r-project.org/web/packages/BayesFactor/index.html) is not available on Mac OS, and the note says to see the check log.
> Are you sure you're looking at the right page? CRAN says
>
> Downloads:
>
> Package source:	BayesFactor_0.8.3.tar.gz
> MacOS X binary:	BayesFactor_0.8.3.tgz
> Windows binary:	BayesFactor_0.8.3.zip
>
> Cheers,
> Simon
>
>
>> The only issue in the check log is a note:
>>
>> checking R code for possible problems ... NOTE
>> all.Nways.env.mc : <local>: no visible binding for global variable 'i'
>> all.Nways.env.mc: no visible binding for global variable 'i'
>>
>> This is due to the fact that I'm using the foreach package. Do I need to change something to get the OSX binary on CRAN?
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>


From rkjandra at gmail.com  Tue Oct 16 01:02:12 2012
From: rkjandra at gmail.com (Rob Anderson)
Date: Mon, 15 Oct 2012 16:02:12 -0700
Subject: [Rd] Multithreaded code in .Call interface
In-Reply-To: <50792CF2.4010006@stats.ox.ac.uk>
References: <CAApt6DJx=5yH2T=R424XkO9+nDUo_vh-AV7TuYZf8ANESzvJxg@mail.gmail.com>
	<50792CF2.4010006@stats.ox.ac.uk>
Message-ID: <CAApt6DLd0iWRKmPmcYeYpiugz4F-NQGq94kU=BA+kaRVRjEEGQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121015/ca726cd8/attachment.pl>

From christopher.g.green at gmail.com  Tue Oct 16 02:38:23 2012
From: christopher.g.green at gmail.com (Chris Green)
Date: Mon, 15 Oct 2012 17:38:23 -0700
Subject: [Rd] Licensing concerns in porting S-Plus code to R libraries
Message-ID: <CAKtC-d3=gbLpu-Q15c9JDiA+G09Ufyqf_fE0F33eVu0ptv1QQQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121015/30e4cb9d/attachment.pl>

From murdoch.duncan at gmail.com  Tue Oct 16 15:02:31 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 16 Oct 2012 09:02:31 -0400
Subject: [Rd] Licensing concerns in porting S-Plus code to R libraries
In-Reply-To: <CAKtC-d3=gbLpu-Q15c9JDiA+G09Ufyqf_fE0F33eVu0ptv1QQQ@mail.gmail.com>
References: <CAKtC-d3=gbLpu-Q15c9JDiA+G09Ufyqf_fE0F33eVu0ptv1QQQ@mail.gmail.com>
Message-ID: <507D5AE7.3020402@gmail.com>

On 12-10-15 8:38 PM, Chris Green wrote:
> I used S-Plus for many years, and developed lots of code for my research.
> When I switched to R a few years ago, I ported most of my S-Plus code over
> to R for my own use. Now that some of this code is quite polished, I would
> like to make it available as an R package on CRAN.
>
> Some of my S-Plus code, however, was based on Insightful S-Plus functions;
> for instance, I took a Trellis function, and modified to suit my needs. In
> some cases the modifications are minor (e.g., adding extra functionality,
> changing colors), while in other cases I've made substantial changes (e.g.,
> a new function that just uses the techniques of the internal function).
> Furthermore, in porting the code to R, I of course had to make further
> changes (e.g., Trellis functions for lattice/grid functions, new C code to
> replace internal S-Plus routines to which I did not have the source code).
>
> I wondering if anyone can provide some guidance here as to what I can
> release without running afoul of any user agreement that may have come with
> S-Plus long ago. I'm assuming other package developers, especially those
> that were S-Plus users long ago, have encountered this issue and can advise
> me on what to do.
>

For the functions that just use the same techniques but are new code, 
you probably don't need to worry.  But for the ones that include 
non-trivial amounts of S-PLUS code, you probably need permission from 
the copyright holder to release them.

I would write to Tibco (the current owners of S-PLUS) and ask permission 
to release your functions under the GPL.  Include copyright notices for 
them as well as for yourself.  You should include copies of the 
functions that are based on their work, so they know how much you are 
asking for.

You can also offer to release them under some other open license, if 
they'd prefer that.

I have no idea how receptive they'll be to this offer, but I think it's 
worth a try.  If they say no, then you should rewrite (or better still, 
get someone else to rewrite, based on your specs) those functions that 
use their code so they're all new.

Duncan Murdoch


From kasperdanielhansen at gmail.com  Tue Oct 16 22:27:05 2012
From: kasperdanielhansen at gmail.com (Kasper Daniel Hansen)
Date: Tue, 16 Oct 2012 16:27:05 -0400
Subject: [Rd] possible bug in print.bibentry
Message-ID: <CAC2h7utP5rgawxAyj3H2dHvx8SFZFeC6-Jizc=AY=73BzhxqBw@mail.gmail.com>

bsseq is a Bioconductor package.  I think the main issue here is that
CITATION has a volume field, like

bibentry("Article",
         title = "{BSmooth: from whole genome bisulfite sequencing
reads to differentially methylated regions}",
         author = personList(
         person(c("Kasper", "D."), "Hansen"),
         person("Benjamin", "Langmead"),
         person(c("Rafael", "A."), "Irizarry")),
         journal = "Genome Biology",
         year = 2012,
         volume = "13",
         pages = "R83",
         textVersion =
         paste("KD Hansen, B Langmead, and RA Irizarry.",
               "BSmooth: from whole genome bisulfite sequencing reads
to differentially methylated regions.",
"Genome Biology, 13:R83 (2012)")
)

When I do

> print(citation("bsseq"), style = "latex")
Hansen KD, Langmead B and Irizarry RA (2012).
``BSmooth: from whole genome bisulfite sequencing reads to
differentially methylated regions.''
\emph{Genome Biology}, \bold{13}, pp. R83.

the output uses \bold, which is not recognized by my Latex
installation.  I believe it should be using \textbf.

Kasper


From hb at biostat.ucsf.edu  Wed Oct 17 03:53:00 2012
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Tue, 16 Oct 2012 18:53:00 -0700
Subject: [Rd] Do *not* pass '...' to NextMethod() - it'll do it for you;
 missing documentation, a bug or just me?
Message-ID: <CAFDcVCSak6YS5nKSybAz0TcR+_YQ=NWFwwRjWJXTRE-pSbj8dQ@mail.gmail.com>

Hi,

although I've done S3 dispatching for more than a decade now, I think
I managed to overlook/avoid the following pitfall when using
NextMethod():

If you explicitly pass argument '...' to NextMethod(), you will
effectively pass those argument twice to the "next" method!


EXAMPLE:

foo0 <- function(...) UseMethod("foo0");
foo1 <- function(...) UseMethod("foo1");
foo2 <- function(...) UseMethod("foo2");

foo2.A <- foo1.A <- foo0.A <- function(object, a=1, b=2, c=3, d=4, ...) {
  str(c(list(object=object, a=a, b=b, c=c, d=d), list(...)));
}

## CORRECT: Don't pass arguments '...', but all other
## *named* arguments that you wish to be changed in the call.
foo0.B <- function(object, ..., b=-2) {
  NextMethod("foo0", object=object, b=b);
}

## INCORRECT: Passing arguments '...' explicitly will *duplicated* them.
foo1.B <- function(object, ..., b=-2) {
  NextMethod("foo1", object=object, ..., b=b);
}

## INCORRECT: As an illustration, *triplication* of arguments '...'.
foo2.B <- function(object, ..., b=-2) {
  NextMethod("foo2", object=object, ..., ..., b=b);
}

objB <- structure(NA, class=c("B", "A"));

foo0(objB, "???", "!!!");
## Gives:
## List of 5
##  $ object:Classes 'B', 'A'  logi NA
##  $ a     : chr "???"
##  $ b     : num -2
##  $ c     : chr "!!!"
##  $ d     : num 4

foo1(objB, "???", "!!!");
## Gives:
## List of 6
##  $ object:Classes 'B', 'A'  logi NA
##  $ a     : chr "???"
##  $ b     : num -2
##  $ c     : chr "!!!"
##  $ d     : chr "???"
##  $       : chr "!!!"

foo2(objB, "???", "!!!");
## Gives:
## List of 8
##  $ object:Classes 'B', 'A'  logi NA
##  $ a     : chr "???"
##  $ b     : num -2
##  $ c     : chr "!!!"
##  $ d     : chr "???"
##  $       : chr "!!!"
##  $       : chr "???"
##  $       : chr "!!!"

This behavior does not seem to be documented (at least not
explicitly), cf. help("NextMethod", package="base") and Section
'NextMethod' in 'R Language Definition'.  I don't have the 'White
Book', so I don't know what that is saying about this.

I can reproduce this on Windows, OSX and Linux and various versions of
R, e.g. R v2.10.0, R v2.15.1 patched, R devel.

Is this a bug, should it be detected as a user error, should it be
documented, or is this already old news?

Thanks,

Henrik


From simon.urbanek at r-project.org  Wed Oct 17 04:35:11 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 16 Oct 2012 22:35:11 -0400
Subject: [Rd] Do *not* pass '...' to NextMethod() - it'll do it for you;
	missing documentation, a bug or just me?
In-Reply-To: <CAFDcVCSak6YS5nKSybAz0TcR+_YQ=NWFwwRjWJXTRE-pSbj8dQ@mail.gmail.com>
References: <CAFDcVCSak6YS5nKSybAz0TcR+_YQ=NWFwwRjWJXTRE-pSbj8dQ@mail.gmail.com>
Message-ID: <7E48E20D-1268-43B7-97C0-0AAED5DA8CB2@r-project.org>


On Oct 16, 2012, at 9:53 PM, Henrik Bengtsson wrote:

> Hi,
> 
> although I've done S3 dispatching for more than a decade now, I think
> I managed to overlook/avoid the following pitfall when using
> NextMethod():
> 
> If you explicitly pass argument '...' to NextMethod(), you will
> effectively pass those argument twice to the "next" method!
> 
> 
> EXAMPLE:
> 
> foo0 <- function(...) UseMethod("foo0");
> foo1 <- function(...) UseMethod("foo1");
> foo2 <- function(...) UseMethod("foo2");
> 
> foo2.A <- foo1.A <- foo0.A <- function(object, a=1, b=2, c=3, d=4, ...) {
>  str(c(list(object=object, a=a, b=b, c=c, d=d), list(...)));
> }
> 
> ## CORRECT: Don't pass arguments '...', but all other
> ## *named* arguments that you wish to be changed in the call.
> foo0.B <- function(object, ..., b=-2) {
>  NextMethod("foo0", object=object, b=b);
> }
> 
> ## INCORRECT: Passing arguments '...' explicitly will *duplicated* them.
> foo1.B <- function(object, ..., b=-2) {
>  NextMethod("foo1", object=object, ..., b=b);
> }
> 
> ## INCORRECT: As an illustration, *triplication* of arguments '...'.
> foo2.B <- function(object, ..., b=-2) {
>  NextMethod("foo2", object=object, ..., ..., b=b);
> }
> 
> objB <- structure(NA, class=c("B", "A"));
> 
> foo0(objB, "???", "!!!");
> ## Gives:
> ## List of 5
> ##  $ object:Classes 'B', 'A'  logi NA
> ##  $ a     : chr "???"
> ##  $ b     : num -2
> ##  $ c     : chr "!!!"
> ##  $ d     : num 4
> 
> foo1(objB, "???", "!!!");
> ## Gives:
> ## List of 6
> ##  $ object:Classes 'B', 'A'  logi NA
> ##  $ a     : chr "???"
> ##  $ b     : num -2
> ##  $ c     : chr "!!!"
> ##  $ d     : chr "???"
> ##  $       : chr "!!!"
> 
> foo2(objB, "???", "!!!");
> ## Gives:
> ## List of 8
> ##  $ object:Classes 'B', 'A'  logi NA
> ##  $ a     : chr "???"
> ##  $ b     : num -2
> ##  $ c     : chr "!!!"
> ##  $ d     : chr "???"
> ##  $       : chr "!!!"
> ##  $       : chr "???"
> ##  $       : chr "!!!"
> 
> This behavior does not seem to be documented (at least not
> explicitly),

I would argue it does:
"Normally ?NextMethod? is used with only one argument, ?generic?, but if further arguments are supplied these modify the call to the next method."
The whole point of NextMethod is that it starts off with the full call *including* ... from the function - by calling NextMethod you are modifying that call, so by adding unnamed arguments you will append them.

And the ... override is explicitly documented: "Any named arguments matched to ?...? are handled specially: they either replace existing arguments of the same name or are appended to the argument list." Try foo1(objB, c="foo", "bla") in your example - it illustrates the difference.

Also why would you pass ... when you don't do it for UseMethod?

Cheers,
Simon



> cf. help("NextMethod", package="base") and Section
> 'NextMethod' in 'R Language Definition'.  I don't have the 'White
> Book', so I don't know what that is saying about this.
> 
> I can reproduce this on Windows, OSX and Linux and various versions of
> R, e.g. R v2.10.0, R v2.15.1 patched, R devel.
> 
> Is this a bug, should it be detected as a user error, should it be
> documented, or is this already old news?
> 
> Thanks,
> 
> Henrik
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From hb at biostat.ucsf.edu  Wed Oct 17 07:48:10 2012
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Tue, 16 Oct 2012 22:48:10 -0700
Subject: [Rd] Do *not* pass '...' to NextMethod() - it'll do it for you;
 missing documentation, a bug or just me?
In-Reply-To: <7E48E20D-1268-43B7-97C0-0AAED5DA8CB2@r-project.org>
References: <CAFDcVCSak6YS5nKSybAz0TcR+_YQ=NWFwwRjWJXTRE-pSbj8dQ@mail.gmail.com>
	<7E48E20D-1268-43B7-97C0-0AAED5DA8CB2@r-project.org>
Message-ID: <CAFDcVCRwWQb+btStwBz6uBFBOFYAr46OQvJA-baaR83teLGBXg@mail.gmail.com>

Hi Simon,

thanks for the prompt reply.  Comments below...

On Tue, Oct 16, 2012 at 7:35 PM, Simon Urbanek
<simon.urbanek at r-project.org> wrote:
>
> On Oct 16, 2012, at 9:53 PM, Henrik Bengtsson wrote:
>
>> Hi,
>>
>> although I've done S3 dispatching for more than a decade now, I think
>> I managed to overlook/avoid the following pitfall when using
>> NextMethod():
>>
>> If you explicitly pass argument '...' to NextMethod(), you will
>> effectively pass those argument twice to the "next" method!
>>
>>
>> EXAMPLE:
>>
>> foo0 <- function(...) UseMethod("foo0");
>> foo1 <- function(...) UseMethod("foo1");
>> foo2 <- function(...) UseMethod("foo2");
>>
>> foo2.A <- foo1.A <- foo0.A <- function(object, a=1, b=2, c=3, d=4, ...) {
>>  str(c(list(object=object, a=a, b=b, c=c, d=d), list(...)));
>> }
>>
>> ## CORRECT: Don't pass arguments '...', but all other
>> ## *named* arguments that you wish to be changed in the call.
>> foo0.B <- function(object, ..., b=-2) {
>>  NextMethod("foo0", object=object, b=b);
>> }
>>
>> ## INCORRECT: Passing arguments '...' explicitly will *duplicated* them.
>> foo1.B <- function(object, ..., b=-2) {
>>  NextMethod("foo1", object=object, ..., b=b);
>> }
>>
>> ## INCORRECT: As an illustration, *triplication* of arguments '...'.
>> foo2.B <- function(object, ..., b=-2) {
>>  NextMethod("foo2", object=object, ..., ..., b=b);
>> }
>>
>> objB <- structure(NA, class=c("B", "A"));
>>
>> foo0(objB, "???", "!!!");
>> ## Gives:
>> ## List of 5
>> ##  $ object:Classes 'B', 'A'  logi NA
>> ##  $ a     : chr "???"
>> ##  $ b     : num -2
>> ##  $ c     : chr "!!!"
>> ##  $ d     : num 4
>>
>> foo1(objB, "???", "!!!");
>> ## Gives:
>> ## List of 6
>> ##  $ object:Classes 'B', 'A'  logi NA
>> ##  $ a     : chr "???"
>> ##  $ b     : num -2
>> ##  $ c     : chr "!!!"
>> ##  $ d     : chr "???"
>> ##  $       : chr "!!!"
>>
>> foo2(objB, "???", "!!!");
>> ## Gives:
>> ## List of 8
>> ##  $ object:Classes 'B', 'A'  logi NA
>> ##  $ a     : chr "???"
>> ##  $ b     : num -2
>> ##  $ c     : chr "!!!"
>> ##  $ d     : chr "???"
>> ##  $       : chr "!!!"
>> ##  $       : chr "???"
>> ##  $       : chr "!!!"

Just to give further practical motivation for the latter case:

foo1.C <- function(object, ..., c=-3) {
  NextMethod("foo1", object=object, ..., c=c);
}

objC <- structure(NA, class=c("C", "B", "A"));

foo1(objC, "???", "!!!")
## List of 11
##  $ object:Classes 'C', 'B', 'A'  logi NA
##  $ a     : chr "???"
##  $ b     : num -2
##  $ c     : num -3
##  $ d     : chr "!!!"
##  $       : chr "???"
##  $       : chr "!!!"
##  $       : chr "???"
##  $       : chr "!!!"
##  $       : chr "???"
##  $       : chr "!!!"

>>
>> This behavior does not seem to be documented (at least not
>> explicitly),
>
> I would argue it does:
> "Normally ?NextMethod? is used with only one argument, ?generic?, but if further arguments are supplied these modify the call to the next method."
> The whole point of NextMethod is that it starts off with the full call *including* ... from the function - by calling NextMethod you are modifying that call, so by adding unnamed arguments you will append them.

Maybe it's possible to make help("NextMethod") more explicit about
this?  It's a bit tricky because there are two different '...'; one for
NextMethod() and one for the S3 function that calls NextMethod().
What about:

\item{...}{\emph{further} arguments to be passed to the next method.
Named arguments will override same-name arguments to the function
containing NextMethod, otherwise they will be appended.  Non-named
arguments (including those passed as \code{...}) will be appended.}

instead of as now:

\item{...}{further arguments to be passed to the next method.},

and adding the following note to the Details section of help("NextMethod"):

NextMethod invokes the next method (determined by the class vector,
either of the object supplied to the generic, or of the first argument
to the function containing NextMethod if a method was invoked
directly). Normally NextMethod is used with only one argument,
generic, but if further arguments are supplied these _modify_ the call
to the next method.  Note, if the function containing NextMethod has
an argument '...', it is likely a mistake to pass it explicitly to
NextMethod, because such will be \emph{appended} to the set of
arguments passed to this function (already containing '...') and
therefore result in duplicated entries.

>
> And the ... override is explicitly documented: "Any named arguments matched to ?...? are handled specially: they either replace existing arguments of the same name or are appended to the argument list." Try foo1(objB, c="foo", "bla") in your example - it illustrates the difference.

Yes, that part I understood, but thanks for the clarification.

>
> Also why would you pass ... when you don't do it for UseMethod?

Yes, I tried to make that analogue as well, but however I looked at
'...' and UseMethod()/NextMethod() I saw multiple interpretations.
Maybe less so now after spending hours of testing/reading the source
code (and trying to find a better documentation/alternative algorithm
for NextMethod()/understanding the developer's intentions).  From a
more practical point of view, (since R v1.8.0 or so) UseMethod() gives
an error if you pass it more than two arguments, which in turn begs
the question if NextMethod() could give an error is you pass an
explicit '...' (unless one can argue that there are use cases when
that is wanted).

Looking at my own packages, I found several occurrences where I pass
'...' to NextMethod().  I'd bet you I'm not the only one that has
been/will be bitten by this behavior.  Indeed, in R devel (r60951)
there are a few cases:

% cd src/library/
% grep 'NextMethod("[^)]*[.][.][.])' */R/*.R
(The above grep will not catch cases where NextMethod() spans multiple
lines.  However, I could only find one such case and it did not pass
'...').

base/R/print.R:##- Need '...' such that it can be called as
NextMethod("print", ...):
stats/R/ts.R:    NextMethod("print", x, quote = FALSE, right = TRUE, ...)
utils/R/citation.R:    NextMethod("print", x, style = style, ...)
utils/R/str.R:  invisible(NextMethod("str", ...))
utils/R/str.R:    else invisible(NextMethod("str", give.length=FALSE,...))

none of which look serious, but explains for instance why you get:

> x <- ts(1:10, frequency=4, start=c(1959, 2))
> class(x)
[1] "ts"
> print(x, calendar=TRUE, 3L)
Error in print.default(x, calendar = TRUE, 3L, quote = FALSE, right = TRUE) :
  invalid 'na.print' specification

Try debug(print.default) and you'll see that both 'digits' and
'na.print' are assigned 3L (despite what the call in the debug output
says).  Instead, you have to do:

> print(x, calendar=TRUE, digits=3L)
     Qtr1 Qtr2 Qtr3 Qtr4
1959         1    2    3
1960    4    5    6    7
1961    8    9   10

Maybe 'R CMD check' should give a NOTE, WARNING, or ERROR on passing
'...' to NextMethod()?

Thanks,

Henrik

>
> Cheers,
> Simon
>
>
>
>> cf. help("NextMethod", package="base") and Section
>> 'NextMethod' in 'R Language Definition'.  I don't have the 'White
>> Book', so I don't know what that is saying about this.
>>
>> I can reproduce this on Windows, OSX and Linux and various versions of
>> R, e.g. R v2.10.0, R v2.15.1 patched, R devel.
>>
>> Is this a bug, should it be detected as a user error, should it be
>> documented, or is this already old news?
>>
>> Thanks,
>>
>> Henrik
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>


From guxiaobo1982 at gmail.com  Wed Oct 17 06:46:57 2012
From: guxiaobo1982 at gmail.com (Xiaobo Gu)
Date: Wed, 17 Oct 2012 12:46:57 +0800
Subject: [Rd] What's your opinion about the Transparency Layer feature of
	Oracle R Enterprise?
Message-ID: <CACOCgcnDgwUPQEwWvDr6acNC4nFUPk-snGh8vTT1ZU+xpKOKAQ@mail.gmail.com>

Hi,

The Transparency Layer feature of Oracle R Enterprise overcomes the
RAM limitation of R, and can take advantage of multiple core
processing of the database server by translating R expression into
SQL, what about building a open source version of the transparency
layer for relational databases?


Xiaobo Gu


From edd at debian.org  Wed Oct 17 16:59:28 2012
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 17 Oct 2012 09:59:28 -0500
Subject: [Rd] Rcmd_environ and R_LIBS_{USER,SITE}
Message-ID: <20606.51152.929307.770692@max.nulle.part>


Is there a fundamental reason why I cannot set either one of

  ## add local library path -- doesn't work either
  R_LIBS_USER="c:/opt/R-library"
  R_LIBS_SITE="c:/opt/R-library"

in $R_HOME/etc/Rcmd_environ even though I can seemingly set other things here?

It breaks "R CMD check" for me as I prefer NOT to install packages in a
versioned path.  

FWIW, defaulting to a versioned path is (to this no-longer-bemused user) as
much a permenent R bug (on Windoze) as the default installation into a path
with spaces.

Dirk

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From bbolker at gmail.com  Wed Oct 17 17:37:18 2012
From: bbolker at gmail.com (Ben Bolker)
Date: Wed, 17 Oct 2012 15:37:18 +0000
Subject: [Rd]
	=?utf-8?q?What=27s_your_opinion_about_the_Transparency_Layer?=
	=?utf-8?q?_feature_of=09Oracle_R_Enterprise=3F?=
References: <CACOCgcnDgwUPQEwWvDr6acNC4nFUPk-snGh8vTT1ZU+xpKOKAQ@mail.gmail.com>
Message-ID: <loom.20121017T173428-238@post.gmane.org>

Xiaobo Gu <guxiaobo1982 <at> gmail.com> writes:

> 
> Hi,
> 
> The Transparency Layer feature of Oracle R Enterprise overcomes the
> RAM limitation of R, and can take advantage of multiple core
> processing of the database server by translating R expression into
> SQL, what about building a open source version of the transparency
> layer for relational databases?
> 
> Xiaobo Gu
> 

  Sounds great. Let us know how it's going ...

  Without the sarcasm -- R is an open source, publicly developed
project. The R Core team, and most of the non-R-core R developers,
are REALLY busy with their own projects.  If you volunteered to
lead such a project, you might get some volunteers.  But in general,
just saying "I think feature XXX would be great to have in R"
is not likely to get much more than vague agreement (or disagreement).
  
  There are several existing public domain R-to-SQL-server
interfaces -- see the High Performance Computing Task View (I think).
Does any of them do what you want, or *nearly* do what you want?


From lbajuk at tibco.com  Thu Oct 18 04:47:54 2012
From: lbajuk at tibco.com (Louis Bajuk-Yorgan)
Date: Thu, 18 Oct 2012 02:47:54 +0000
Subject: [Rd] Licensing concerns in porting S-Plus code to R libraries
In-Reply-To: <E66794E69CFDE04D9A70842786030B93374A5F@PA-MBX04.na.tibco.com>
References: <CAKtC-d3=gbLpu-Q15c9JDiA+G09Ufyqf_fE0F33eVu0ptv1QQQ@mail.gmail.com>
	<E66794E69CFDE04D9A70842786030B933747A5@PA-MBX04.na.tibco.com>
	<B6B83B4D8B4C5B48A81903EC3EB874EA6DAA8E@PA-MBX04.na.tibco.com>
	<E66794E69CFDE04D9A70842786030B93374A5F@PA-MBX04.na.tibco.com>
Message-ID: <B6B83B4D8B4C5B48A81903EC3EB874EA6DEE20@PA-MBX04.na.tibco.com>

Hi Chris

Thanks for asking about this. In general, 3rd parties aren't allowed to modify Insightful (now TIBCO) code and then re-release it under a different license, since we own the copyright to the code. However, we strive to be strong supporters of the R community, and to make contributions where we can, so I'd be happy to discuss potentially giving you permission to do so. I'd have to consult with our internal legal team on the details. 

Please contact me directly at lbajuk at tibco.com so we can discuss.

Regards
Lou

--------------------------
Lou Bajuk-Yorgan
Sr. Director, Product Management
Spotfire, TIBCO Software
lbajuk at tibco.com
Twitter: @LouBajuk


> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Chris Green
> Sent: Monday, October 15, 2012 5:38 PM
> To: r-devel at r-project.org
> Subject: [Rd] Licensing concerns in porting S-Plus code to R libraries
> 
> I used S-Plus for many years, and developed lots of code for my research.
> When I switched to R a few years ago, I ported most of my S-Plus code 
> over to R for my own use. Now that some of this code is quite 
> polished, I would like to make it available as an R package on CRAN.
> 
> Some of my S-Plus code, however, was based on Insightful S-Plus 
> functions; for instance, I took a Trellis function, and modified to 
> suit my needs. In some cases the modifications are minor (e.g., adding 
> extra functionality, changing colors), while in other cases I've made 
> substantial changes (e.g., a new function that just uses the techniques of the internal function).
> Furthermore, in porting the code to R, I of course had to make further 
> changes (e.g., Trellis functions for lattice/grid functions, new C 
> code to replace internal S-Plus routines to which I did not have the source code).
> 
> I wondering if anyone can provide some guidance here as to what I can 
> release without running afoul of any user agreement that may have come 
> with S-Plus long ago. I'm assuming other package developers, 
> especially those that were S-Plus users long ago, have encountered this issue and can advise me on what to do.
> 
> Many thanks,
> 
> Chris Green
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From k.jewell at campden.co.uk  Thu Oct 18 10:14:44 2012
From: k.jewell at campden.co.uk (Keith Jewell)
Date: Thu, 18 Oct 2012 09:14:44 +0100
Subject: [Rd] Rcmd_environ and R_LIBS_{USER,SITE}
In-Reply-To: <20606.51152.929307.770692@max.nulle.part>
References: <20606.51152.929307.770692@max.nulle.part>
Message-ID: <k5odpj$kqp$1@ger.gmane.org>

No reply in a number of hours, so here is a suggestion from ignorance :-}

?Startup refers to a number of other "site and user files to process for 
setting environment variables" but not to Rcmd_environ. The contents of 
$R_HOME/etc/Rcmd_environ seem to reflect (some of) the contents of 
(some) other files.

I have similar lines (defining library paths) in
     $R_HOME/etc/Renviron.site

Is it correct to directly edit Rcmd_environ or should it be modified 
only via other files? (A genuine question).

On 17/10/2012 15:59, Dirk Eddelbuettel wrote:
>
> Is there a fundamental reason why I cannot set either one of
>
>    ## add local library path -- doesn't work either
>    R_LIBS_USER="c:/opt/R-library"
>    R_LIBS_SITE="c:/opt/R-library"
>
> in $R_HOME/etc/Rcmd_environ even though I can seemingly set other things here?
>
> It breaks "R CMD check" for me as I prefer NOT to install packages in a
> versioned path.
>
> FWIW, defaulting to a versioned path is (to this no-longer-bemused user) as
> much a permenent R bug (on Windoze) as the default installation into a path
> with spaces.
>
> Dirk
>


From mtmorgan at fhcrc.org  Thu Oct 18 15:31:44 2012
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Thu, 18 Oct 2012 06:31:44 -0700
Subject: [Rd] S4 fails to initialize linear hierarchies with intermediate
 VIRTUAL classes
Message-ID: <508004C0.3010208@fhcrc.org>

Initialization of this simple hierarchy

   A = setClass("A", representation(x="numeric"))
   setClass("B", contains=c("VIRTUAL", "A"))
   C = setClass("C", contains="B")

fails (neat that setClass returns generators; I hadn't realized that before!)

 > C(A())
Error: evaluation nested too deeply: infinite recursion / options(expressions=)?

because in the default coerce<-,C,A-method

 > selectMethod("coerce<-", c("C", "A"))
Method Definition:

function (from, to = "A", value)
{
     .value <- as(from, "B", TRUE)
     as(.value, "A") <- value
...

as(from, "B", TRUE) correctly returns an instance of C.

Also VIRTUAL isn't mentioned on ?Classes or ?setClass and isn't documented on 
class?VIRTUAL, making me wonder whether virtual classes are actually meant to be 
supported as part of S4 (they are used regularly in Bioconductor packages)?

Martin
-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From edd at debian.org  Thu Oct 18 16:12:50 2012
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 18 Oct 2012 09:12:50 -0500
Subject: [Rd] Rcmd_environ and R_LIBS_{USER,SITE}
In-Reply-To: <k5odpj$kqp$1@ger.gmane.org>
References: <20606.51152.929307.770692@max.nulle.part>
	<k5odpj$kqp$1@ger.gmane.org>
Message-ID: <20608.3682.541568.225279@max.nulle.part>


Keith,

On 18 October 2012 at 09:14, Keith Jewell wrote:
| No reply in a number of hours, so here is a suggestion from ignorance :-}
| 
| ?Startup refers to a number of other "site and user files to process for 

Thanks, and I know, and use those on Linux (and on 'doze when I use it).  My
question was specifically about 'R CMD foo' which skips some of these by
choice, and which Rcmd_environ appears to overcome, albeit imcompletely. I
still have an issue on Windows where I cannot split my package installations
between those that come and go with R installations, and the others.  

But it is truly bizarre that I can do (on Windows)

  R CMD INSTALL foo_1.2-3.tar.gz

and a moment later

  R CMD check foo_1.2-3.tar.gz

fails in its tests and examples with "no package called 'foo'"

Doing 'R CMD check --no-examples --no-tests foo_1.2-3.tar.gz' works, but is
less helpful as we're running the check to run those very tests...

Dirk


| setting environment variables" but not to Rcmd_environ. The contents of 
| $R_HOME/etc/Rcmd_environ seem to reflect (some of) the contents of 
| (some) other files.
| 
| I have similar lines (defining library paths) in
|      $R_HOME/etc/Renviron.site
| 
| Is it correct to directly edit Rcmd_environ or should it be modified 
| only via other files? (A genuine question).
| 
| On 17/10/2012 15:59, Dirk Eddelbuettel wrote:
| >
| > Is there a fundamental reason why I cannot set either one of
| >
| >    ## add local library path -- doesn't work either
| >    R_LIBS_USER="c:/opt/R-library"
| >    R_LIBS_SITE="c:/opt/R-library"
| >
| > in $R_HOME/etc/Rcmd_environ even though I can seemingly set other things here?
| >
| > It breaks "R CMD check" for me as I prefer NOT to install packages in a
| > versioned path.
| >
| > FWIW, defaulting to a versioned path is (to this no-longer-bemused user) as
| > much a permenent R bug (on Windoze) as the default installation into a path
| > with spaces.
| >
| > Dirk
| >
| 
| ______________________________________________
| R-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From kasperdanielhansen at gmail.com  Thu Oct 18 16:41:10 2012
From: kasperdanielhansen at gmail.com (Kasper Daniel Hansen)
Date: Thu, 18 Oct 2012 10:41:10 -0400
Subject: [Rd] Rcmd_environ and R_LIBS_{USER,SITE}
In-Reply-To: <20608.3682.541568.225279@max.nulle.part>
References: <20606.51152.929307.770692@max.nulle.part>
	<k5odpj$kqp$1@ger.gmane.org>
	<20608.3682.541568.225279@max.nulle.part>
Message-ID: <CAC2h7ut6Gm3Bz9h3qUhtpZ7iSs5qDFKinv3kiOfvZVKzb=N3vQ@mail.gmail.com>

Dirk,

I set my user libraries in .Rprofile for this very reason.  I agree it
is weird that .Renviron is not always read etc.

Kasper

On Thu, Oct 18, 2012 at 10:12 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
>
> Keith,
>
> On 18 October 2012 at 09:14, Keith Jewell wrote:
> | No reply in a number of hours, so here is a suggestion from ignorance :-}
> |
> | ?Startup refers to a number of other "site and user files to process for
>
> Thanks, and I know, and use those on Linux (and on 'doze when I use it).  My
> question was specifically about 'R CMD foo' which skips some of these by
> choice, and which Rcmd_environ appears to overcome, albeit imcompletely. I
> still have an issue on Windows where I cannot split my package installations
> between those that come and go with R installations, and the others.
>
> But it is truly bizarre that I can do (on Windows)
>
>   R CMD INSTALL foo_1.2-3.tar.gz
>
> and a moment later
>
>   R CMD check foo_1.2-3.tar.gz
>
> fails in its tests and examples with "no package called 'foo'"
>
> Doing 'R CMD check --no-examples --no-tests foo_1.2-3.tar.gz' works, but is
> less helpful as we're running the check to run those very tests...
>
> Dirk
>
>
> | setting environment variables" but not to Rcmd_environ. The contents of
> | $R_HOME/etc/Rcmd_environ seem to reflect (some of) the contents of
> | (some) other files.
> |
> | I have similar lines (defining library paths) in
> |      $R_HOME/etc/Renviron.site
> |
> | Is it correct to directly edit Rcmd_environ or should it be modified
> | only via other files? (A genuine question).
> |
> | On 17/10/2012 15:59, Dirk Eddelbuettel wrote:
> | >
> | > Is there a fundamental reason why I cannot set either one of
> | >
> | >    ## add local library path -- doesn't work either
> | >    R_LIBS_USER="c:/opt/R-library"
> | >    R_LIBS_SITE="c:/opt/R-library"
> | >
> | > in $R_HOME/etc/Rcmd_environ even though I can seemingly set other things here?
> | >
> | > It breaks "R CMD check" for me as I prefer NOT to install packages in a
> | > versioned path.
> | >
> | > FWIW, defaulting to a versioned path is (to this no-longer-bemused user) as
> | > much a permenent R bug (on Windoze) as the default installation into a path
> | > with spaces.
> | >
> | > Dirk
> | >
> |
> | ______________________________________________
> | R-devel at r-project.org mailing list
> | https://stat.ethz.ch/mailman/listinfo/r-devel
>
> --
> Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From edd at debian.org  Thu Oct 18 17:18:16 2012
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 18 Oct 2012 10:18:16 -0500
Subject: [Rd] Rcmd_environ and R_LIBS_{USER,SITE}
In-Reply-To: <CAC2h7ut6Gm3Bz9h3qUhtpZ7iSs5qDFKinv3kiOfvZVKzb=N3vQ@mail.gmail.com>
References: <20606.51152.929307.770692@max.nulle.part>
	<k5odpj$kqp$1@ger.gmane.org>
	<20608.3682.541568.225279@max.nulle.part>
	<CAC2h7ut6Gm3Bz9h3qUhtpZ7iSs5qDFKinv3kiOfvZVKzb=N3vQ@mail.gmail.com>
Message-ID: <20608.7608.577340.915403@max.nulle.part>


Kasper,

On 18 October 2012 at 10:41, Kasper Daniel Hansen wrote:
| I set my user libraries in .Rprofile for this very reason.  I agree it
| is weird that .Renviron is not always read etc.

Sorry, no cigar either -- this equivalent to using files in $R_HOME/etc/ and
is also ignored by R CMD check, which still fails in my setup as it doesn't
find the package -- whereas any normal R session does.

Dirk



| 
| Kasper
| 
| On Thu, Oct 18, 2012 at 10:12 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
| >
| > Keith,
| >
| > On 18 October 2012 at 09:14, Keith Jewell wrote:
| > | No reply in a number of hours, so here is a suggestion from ignorance :-}
| > |
| > | ?Startup refers to a number of other "site and user files to process for
| >
| > Thanks, and I know, and use those on Linux (and on 'doze when I use it).  My
| > question was specifically about 'R CMD foo' which skips some of these by
| > choice, and which Rcmd_environ appears to overcome, albeit imcompletely. I
| > still have an issue on Windows where I cannot split my package installations
| > between those that come and go with R installations, and the others.
| >
| > But it is truly bizarre that I can do (on Windows)
| >
| >   R CMD INSTALL foo_1.2-3.tar.gz
| >
| > and a moment later
| >
| >   R CMD check foo_1.2-3.tar.gz
| >
| > fails in its tests and examples with "no package called 'foo'"
| >
| > Doing 'R CMD check --no-examples --no-tests foo_1.2-3.tar.gz' works, but is
| > less helpful as we're running the check to run those very tests...
| >
| > Dirk
| >
| >
| > | setting environment variables" but not to Rcmd_environ. The contents of
| > | $R_HOME/etc/Rcmd_environ seem to reflect (some of) the contents of
| > | (some) other files.
| > |
| > | I have similar lines (defining library paths) in
| > |      $R_HOME/etc/Renviron.site
| > |
| > | Is it correct to directly edit Rcmd_environ or should it be modified
| > | only via other files? (A genuine question).
| > |
| > | On 17/10/2012 15:59, Dirk Eddelbuettel wrote:
| > | >
| > | > Is there a fundamental reason why I cannot set either one of
| > | >
| > | >    ## add local library path -- doesn't work either
| > | >    R_LIBS_USER="c:/opt/R-library"
| > | >    R_LIBS_SITE="c:/opt/R-library"
| > | >
| > | > in $R_HOME/etc/Rcmd_environ even though I can seemingly set other things here?
| > | >
| > | > It breaks "R CMD check" for me as I prefer NOT to install packages in a
| > | > versioned path.
| > | >
| > | > FWIW, defaulting to a versioned path is (to this no-longer-bemused user) as
| > | > much a permenent R bug (on Windoze) as the default installation into a path
| > | > with spaces.
| > | >
| > | > Dirk
| > | >
| > |
| > | ______________________________________________
| > | R-devel at r-project.org mailing list
| > | https://stat.ethz.ch/mailman/listinfo/r-devel
| >
| > --
| > Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com
| >
| > ______________________________________________
| > R-devel at r-project.org mailing list
| > https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From jmc at r-project.org  Thu Oct 18 21:03:49 2012
From: jmc at r-project.org (John Chambers)
Date: Thu, 18 Oct 2012 12:03:49 -0700
Subject: [Rd] S4 fails to initialize linear hierarchies with
 intermediate VIRTUAL classes
In-Reply-To: <508004C0.3010208@fhcrc.org>
References: <508004C0.3010208@fhcrc.org>
Message-ID: <50805295.2030302@r-project.org>



On 10/18/12 6:31 AM, Martin Morgan wrote:
> Initialization of this simple hierarchy
>
>    A = setClass("A", representation(x="numeric"))
>    setClass("B", contains=c("VIRTUAL", "A"))
>    C = setClass("C", contains="B")
>
> fails (neat that setClass returns generators; I hadn't realized that
> before!)
Yes, from 2.15.0. See ?setClass and the NEWS file.

>
>  > C(A())
> Error: evaluation nested too deeply: infinite recursion /
> options(expressions=)?
>
> because in the default coerce<-,C,A-method
>
>  > selectMethod("coerce<-", c("C", "A"))
> Method Definition:
>
> function (from, to = "A", value)
> {
>      .value <- as(from, "B", TRUE)
>      as(.value, "A") <- value
> ...
>
> as(from, "B", TRUE) correctly returns an instance of C.

Hmm, correct.  Direct specification of the slots is fine, but supplying 
a superclass object fails as you show.  A "harmless" solution to this 
may take some thinking (suggestions welcome).  Not for 2.15.2 at any rate.

A workaround is to define the inheritance relation directly. In this 
example:

setIs("C", "A",
        coerce = function(from) new("A", x = from at x),
        replace = function(from, value) {from at x = value at x; from})

Or, if it's more natural, supply an initialize() method for "C" to 
intercept such arguments.

>
> Also VIRTUAL isn't mentioned on ?Classes or ?setClass and isn't
> documented on class?VIRTUAL, making me wonder whether virtual classes
> are actually meant to be supported as part of S4 (they are used
> regularly in Bioconductor packages)?

Eh??  Of course they are.  E.g., section 9.4 of the Software for Data 
Analysis reference.  In particular, page 353:

"Any ordinary class definition can create a virtual class, by including 
the special class "VIRTUAL" in the contains= argument to setClass()."

John
>
> Martin


From hb at biostat.ucsf.edu  Fri Oct 19 01:46:07 2012
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Thu, 18 Oct 2012 16:46:07 -0700
Subject: [Rd] Do *not* pass '...' to NextMethod() - it'll do it for you;
 missing documentation, a bug or just me?
In-Reply-To: <CAFDcVCRwWQb+btStwBz6uBFBOFYAr46OQvJA-baaR83teLGBXg@mail.gmail.com>
References: <CAFDcVCSak6YS5nKSybAz0TcR+_YQ=NWFwwRjWJXTRE-pSbj8dQ@mail.gmail.com>
	<7E48E20D-1268-43B7-97C0-0AAED5DA8CB2@r-project.org>
	<CAFDcVCRwWQb+btStwBz6uBFBOFYAr46OQvJA-baaR83teLGBXg@mail.gmail.com>
Message-ID: <CAFDcVCT9AfPXvVL4c3cAo5jJTf41-Kmtgm2S3Zftq3NNw2rhkw@mail.gmail.com>

Alright, now I'm even more confused about passing argument via
NextMethod().  Here is another example where an argument is duplicated
despite '...' is *not* explicitly passed to NextMethod().

bar <- function(...) UseMethod("bar");

bar.A <- function(object, a=1, b=2, ...) {
  print(sys.call());
  str(list(a=a, b=b, ...));
}

bar.B <- function(object, a=-1, ...) {
  print(sys.call());
  set <- NextMethod("bar", a=a);
}

objB <- structure(NA, class=c("B", "A"));

## As wanted; default of argument 'a' is set to -1.
bar(objB)
## bar.B(objB)
## bar.A(objB, a = -1)
## List of 2
##  $ a: num -1
##  $ b: num 2

## As wanted; user overrides default argument 'a'
bar(objB, a="foo")
## bar.B(objB, a = "foo")
## bar.A(objB, a = "foo")
## List of 2
##  $ a: chr "foo"
##  $ b: num 2

## But if not named, the argument value gets duplicated
bar(objB, "foo")
## bar.A(objB, "foo", a = "foo")
## List of 2
##  $ a: chr "foo"
##  $ b: chr "foo"

I don't see how to programatically avoid this or detect this in
bar.A() without tedious workarounds.  NB: Reordering arguments, e.g.
foo.B <- function(object, ..., a=-1), will avoid the duplication but
break the design that 'a' should be assigned if a non-named argument
is passed).

In help("NextMethod") under 'Technical Details' it says: "Any named
arguments matched to ... are handled specially: they either replace
existing arguments of the same name or are appended to the argument
list.".   In the above example, it's not "either ... or ...", it's
"both".

Still me?

/Henrik


On Tue, Oct 16, 2012 at 10:48 PM, Henrik Bengtsson <hb at biostat.ucsf.edu> wrote:
> Hi Simon,
>
> thanks for the prompt reply.  Comments below...
>
> On Tue, Oct 16, 2012 at 7:35 PM, Simon Urbanek
> <simon.urbanek at r-project.org> wrote:
>>
>> On Oct 16, 2012, at 9:53 PM, Henrik Bengtsson wrote:
>>
>>> Hi,
>>>
>>> although I've done S3 dispatching for more than a decade now, I think
>>> I managed to overlook/avoid the following pitfall when using
>>> NextMethod():
>>>
>>> If you explicitly pass argument '...' to NextMethod(), you will
>>> effectively pass those argument twice to the "next" method!
>>>
>>>
>>> EXAMPLE:
>>>
>>> foo0 <- function(...) UseMethod("foo0");
>>> foo1 <- function(...) UseMethod("foo1");
>>> foo2 <- function(...) UseMethod("foo2");
>>>
>>> foo2.A <- foo1.A <- foo0.A <- function(object, a=1, b=2, c=3, d=4, ...) {
>>>  str(c(list(object=object, a=a, b=b, c=c, d=d), list(...)));
>>> }
>>>
>>> ## CORRECT: Don't pass arguments '...', but all other
>>> ## *named* arguments that you wish to be changed in the call.
>>> foo0.B <- function(object, ..., b=-2) {
>>>  NextMethod("foo0", object=object, b=b);
>>> }
>>>
>>> ## INCORRECT: Passing arguments '...' explicitly will *duplicated* them.
>>> foo1.B <- function(object, ..., b=-2) {
>>>  NextMethod("foo1", object=object, ..., b=b);
>>> }
>>>
>>> ## INCORRECT: As an illustration, *triplication* of arguments '...'.
>>> foo2.B <- function(object, ..., b=-2) {
>>>  NextMethod("foo2", object=object, ..., ..., b=b);
>>> }
>>>
>>> objB <- structure(NA, class=c("B", "A"));
>>>
>>> foo0(objB, "???", "!!!");
>>> ## Gives:
>>> ## List of 5
>>> ##  $ object:Classes 'B', 'A'  logi NA
>>> ##  $ a     : chr "???"
>>> ##  $ b     : num -2
>>> ##  $ c     : chr "!!!"
>>> ##  $ d     : num 4
>>>
>>> foo1(objB, "???", "!!!");
>>> ## Gives:
>>> ## List of 6
>>> ##  $ object:Classes 'B', 'A'  logi NA
>>> ##  $ a     : chr "???"
>>> ##  $ b     : num -2
>>> ##  $ c     : chr "!!!"
>>> ##  $ d     : chr "???"
>>> ##  $       : chr "!!!"
>>>
>>> foo2(objB, "???", "!!!");
>>> ## Gives:
>>> ## List of 8
>>> ##  $ object:Classes 'B', 'A'  logi NA
>>> ##  $ a     : chr "???"
>>> ##  $ b     : num -2
>>> ##  $ c     : chr "!!!"
>>> ##  $ d     : chr "???"
>>> ##  $       : chr "!!!"
>>> ##  $       : chr "???"
>>> ##  $       : chr "!!!"
>
> Just to give further practical motivation for the latter case:
>
> foo1.C <- function(object, ..., c=-3) {
>   NextMethod("foo1", object=object, ..., c=c);
> }
>
> objC <- structure(NA, class=c("C", "B", "A"));
>
> foo1(objC, "???", "!!!")
> ## List of 11
> ##  $ object:Classes 'C', 'B', 'A'  logi NA
> ##  $ a     : chr "???"
> ##  $ b     : num -2
> ##  $ c     : num -3
> ##  $ d     : chr "!!!"
> ##  $       : chr "???"
> ##  $       : chr "!!!"
> ##  $       : chr "???"
> ##  $       : chr "!!!"
> ##  $       : chr "???"
> ##  $       : chr "!!!"
>
>>>
>>> This behavior does not seem to be documented (at least not
>>> explicitly),
>>
>> I would argue it does:
>> "Normally ?NextMethod? is used with only one argument, ?generic?, but if further arguments are supplied these modify the call to the next method."
>> The whole point of NextMethod is that it starts off with the full call *including* ... from the function - by calling NextMethod you are modifying that call, so by adding unnamed arguments you will append them.
>
> Maybe it's possible to make help("NextMethod") more explicit about
> this?  It's a bit tricky because there are two different '...'; one for
> NextMethod() and one for the S3 function that calls NextMethod().
> What about:
>
> \item{...}{\emph{further} arguments to be passed to the next method.
> Named arguments will override same-name arguments to the function
> containing NextMethod, otherwise they will be appended.  Non-named
> arguments (including those passed as \code{...}) will be appended.}
>
> instead of as now:
>
> \item{...}{further arguments to be passed to the next method.},
>
> and adding the following note to the Details section of help("NextMethod"):
>
> NextMethod invokes the next method (determined by the class vector,
> either of the object supplied to the generic, or of the first argument
> to the function containing NextMethod if a method was invoked
> directly). Normally NextMethod is used with only one argument,
> generic, but if further arguments are supplied these _modify_ the call
> to the next method.  Note, if the function containing NextMethod has
> an argument '...', it is likely a mistake to pass it explicitly to
> NextMethod, because such will be \emph{appended} to the set of
> arguments passed to this function (already containing '...') and
> therefore result in duplicated entries.
>
>>
>> And the ... override is explicitly documented: "Any named arguments matched to ?...? are handled specially: they either replace existing arguments of the same name or are appended to the argument list." Try foo1(objB, c="foo", "bla") in your example - it illustrates the difference.
>
> Yes, that part I understood, but thanks for the clarification.
>
>>
>> Also why would you pass ... when you don't do it for UseMethod?
>
> Yes, I tried to make that analogue as well, but however I looked at
> '...' and UseMethod()/NextMethod() I saw multiple interpretations.
> Maybe less so now after spending hours of testing/reading the source
> code (and trying to find a better documentation/alternative algorithm
> for NextMethod()/understanding the developer's intentions).  From a
> more practical point of view, (since R v1.8.0 or so) UseMethod() gives
> an error if you pass it more than two arguments, which in turn begs
> the question if NextMethod() could give an error is you pass an
> explicit '...' (unless one can argue that there are use cases when
> that is wanted).
>
> Looking at my own packages, I found several occurrences where I pass
> '...' to NextMethod().  I'd bet you I'm not the only one that has
> been/will be bitten by this behavior.  Indeed, in R devel (r60951)
> there are a few cases:
>
> % cd src/library/
> % grep 'NextMethod("[^)]*[.][.][.])' */R/*.R
> (The above grep will not catch cases where NextMethod() spans multiple
> lines.  However, I could only find one such case and it did not pass
> '...').
>
> base/R/print.R:##- Need '...' such that it can be called as
> NextMethod("print", ...):
> stats/R/ts.R:    NextMethod("print", x, quote = FALSE, right = TRUE, ...)
> utils/R/citation.R:    NextMethod("print", x, style = style, ...)
> utils/R/str.R:  invisible(NextMethod("str", ...))
> utils/R/str.R:    else invisible(NextMethod("str", give.length=FALSE,...))
>
> none of which look serious, but explains for instance why you get:
>
>> x <- ts(1:10, frequency=4, start=c(1959, 2))
>> class(x)
> [1] "ts"
>> print(x, calendar=TRUE, 3L)
> Error in print.default(x, calendar = TRUE, 3L, quote = FALSE, right = TRUE) :
>   invalid 'na.print' specification
>
> Try debug(print.default) and you'll see that both 'digits' and
> 'na.print' are assigned 3L (despite what the call in the debug output
> says).  Instead, you have to do:
>
>> print(x, calendar=TRUE, digits=3L)
>      Qtr1 Qtr2 Qtr3 Qtr4
> 1959         1    2    3
> 1960    4    5    6    7
> 1961    8    9   10
>
> Maybe 'R CMD check' should give a NOTE, WARNING, or ERROR on passing
> '...' to NextMethod()?
>
> Thanks,
>
> Henrik
>
>>
>> Cheers,
>> Simon
>>
>>
>>
>>> cf. help("NextMethod", package="base") and Section
>>> 'NextMethod' in 'R Language Definition'.  I don't have the 'White
>>> Book', so I don't know what that is saying about this.
>>>
>>> I can reproduce this on Windows, OSX and Linux and various versions of
>>> R, e.g. R v2.10.0, R v2.15.1 patched, R devel.
>>>
>>> Is this a bug, should it be detected as a user error, should it be
>>> documented, or is this already old news?
>>>
>>> Thanks,
>>>
>>> Henrik
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>


From hpages at fhcrc.org  Fri Oct 19 07:52:29 2012
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Thu, 18 Oct 2012 22:52:29 -0700
Subject: [Rd] Mac and Windows binaries of rJava broken for R-devel?
Message-ID: <5080EA9D.3030809@fhcrc.org>

Hi,

Here is a problem we see with the Mac and Windows binaries of
rJava (0.9-3) currently available on CRAN for R-devel (i.e. under
bin/macosx/leopard/contrib/2.16/ and bin/windows/contrib/2.16/):

   > library(rJava)
   > .jinit("gaggle/inst/jars/gaggleRShell.jar")
   Error in .Call("R_do_new_object", ClassDef, PACKAGE = "base") :
     "R_do_new_object" not available for .Call() for package "base"

The same code works fine with R-devel on Linux and the same version
of rJava, or with R-2.15 on all platforms and the same version of
rJava (Mac or Windows binaries installed from CRAN).

The binaries currently available on CRAN for R-devel seem to predate
some important changes in R-devel with respect to the exposure of
some .Call entry points. Could it be that those binaries just need
to be rebuilt with a more recent version of R-devel?

FWIW, we have a few packages in the development version of Bioconductor
that are affected by this issue.

Thanks in advance,
H.

 > sessionInfo()
R Under development (unstable) (2012-10-17 r60955)
Platform: i386-apple-darwin9.8.0/i386 (32-bit)

locale:
[1] en_US/en_US/en_US/C/en_US/en_US

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rJava_0.9-3

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From ralmond at macosx.com  Thu Oct 18 18:17:56 2012
From: ralmond at macosx.com (Russell G. Almond)
Date: Thu, 18 Oct 2012 12:17:56 -0400
Subject: [Rd] R CMD check --force-biarch
Message-ID: <CC047C72-07B4-459E-ADBF-72971648FD5F@macosx.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121018/76c6ba73/attachment.pl>

From matthew at catalysis.com  Fri Oct 19 01:24:24 2012
From: matthew at catalysis.com (Matthew Schall)
Date: Thu, 18 Oct 2012 23:24:24 +0000
Subject: [Rd] =?utf-8?q?R_64bit_for_Windows_on_Windows_2012_server_running?=
 =?utf-8?q?_Microsoft=E2=80=99s_Hyper-V_2012=3F?=
In-Reply-To: <2F1B0A66E8124A4DA5B4C4D3EC18BA2633530274@MAIL02.TUCKER.CATALYSIS.com>
References: <2F1B0A66E8124A4DA5B4C4D3EC18BA2633530274@MAIL02.TUCKER.CATALYSIS.com>
Message-ID: <2F1B0A66E8124A4DA5B4C4D3EC18BA2633532526@MAIL02.TUCKER.CATALYSIS.com>

Seeking confirmation/disconfirmation that R 64bit for Windows will run on Windows 2012 server running Microsoft?s Hyper-V 2012 server virtualization software and advice on building this on AMD 16 core or Intel 8 core processors where we want to put up a 64 core VM. We have not built this yet, we are seeking advice on whether R will run in this environment. 

Thank you;

Matthew Schall
Matthew at Catalysis.com

catalysis? 1601 East John Street ? Seattle, Washington ?98112 matthew at catalysis.com ? 206.860.2534 (direct) ? catalysis.com


From b.h.mevik at usit.uio.no  Fri Oct 19 09:53:33 2012
From: b.h.mevik at usit.uio.no (=?iso-8859-1?Q?Bj=F8rn-Helge_Mevik?=)
Date: Fri, 19 Oct 2012 09:53:33 +0200
Subject: [Rd] --enable-R-shlib and external BLAS/LAPACK libraries
Message-ID: <s3sd30ehp8i.fsf@slagelg.uio.no>

A couple of years ago (in 2008, using R 2.7.x, I believe) I noted that
using the configure switch --enable-R-shlib when buildig R made
configure ignore any specified external LAPACK library and use the
internal one insted. I asked why, and was told it was intentional.

Now, with R 2.15.1, I see that it at least appears that this is no
longer the case.  I've run configure like this:

fast="-ip -O3 -opt-mem-layout-trans=3 -xHost -mavx"
export CC="icc"
export CFLAGS="$fast -wd188 -fp-model precise"
export F77="ifort"
export FFLAGS="$fast -fp-model precise"
export CXX="icpc"
export CXXFLAGS="$fast -fp-model precise"
export FC="ifort"
export FCFLAGS="$fast -fp-model precise"

./configure --with-blas='-mkl=parallel' --with-lapack --enable-R-shlib

(in addition, paths to the intel compilers and librareis are set up).

The output from configure says:

  Interfaces supported:      X11, tcltk
  External libraries:        readline, BLAS(generic), LAPACK(in blas)
  Additional capabilities:   PNG, JPEG, TIFF, NLS, cairo
  Options enabled:           shared R library, R profiling, Java

After make install, we get a libR.so linked to MKL libraries (see below
for details).

Am I correct in assuming that this R will use the intel MKL libraries
for BLAS and LAPACK routines?  (That would be very nice, because we want
to use the fast libraries, but some of our uses need to have libR.so, so
up to now, we've had to build to versions of R.)


# ldd libR.so 
        linux-vdso.so.1 =>  (0x00007ff52bcf8000)
        libifport.so.5 => /cluster/software/VERSIONS/intel-2011.10/composer_xe_2011_sp1/lib/intel64/libifport.so.5 (0x00007ff52b47d000)
        libifcore.so.5 => /cluster/software/VERSIONS/intel-2011.10/composer_xe_2011_sp1/lib/intel64/libifcore.so.5 (0x00007ff52b238000)
        libimf.so => /cluster/software/VERSIONS/intel-2011.10/composer_xe_2011_sp1/lib/intel64/libimf.so (0x00007ff52ae6d000)
        libsvml.so => /cluster/software/VERSIONS/intel-2011.10/composer_xe_2011_sp1/lib/intel64/libsvml.so (0x00007ff52a6f3000)
        libm.so.6 => /lib64/libm.so.6 (0x00007ff52a45a000)
        libirc.so => /cluster/software/VERSIONS/intel-2011.10/composer_xe_2011_sp1/lib/intel64/libirc.so (0x00007ff52a30b000)
        libpthread.so.0 => /lib64/libpthread.so.0 (0x00007ff52a0ee000)
        libdl.so.2 => /lib64/libdl.so.2 (0x00007ff529ee9000)
        libreadline.so.6 => /lib64/libreadline.so.6 (0x00007ff529ca6000)
        librt.so.1 => /lib64/librt.so.1 (0x00007ff529a9e000)
        libmkl_intel_lp64.so => /cluster/software/VERSIONS/intel-2011.10/composer_xe_2011_sp1/mkl/lib/intel64/libmkl_intel_lp64.so (0x00007ff5292b7000)
        libmkl_intel_thread.so => /cluster/software/VERSIONS/intel-2011.10/composer_xe_2011_sp1/mkl/lib/intel64/libmkl_intel_thread.so (0x00007ff528238000)
        libmkl_core.so => /cluster/software/VERSIONS/intel-2011.10/composer_xe_2011_sp1/mkl/lib/intel64/libmkl_core.so (0x00007ff5271c2000)
        libiomp5.so => /cluster/software/VERSIONS/intel-2011.10/composer_xe_2011_sp1/lib/intel64/libiomp5.so (0x00007ff526ecf000)
        libgcc_s.so.1 => /lib64/libgcc_s.so.1 (0x00007ff526cb9000)
        libintlc.so.5 => /cluster/software/VERSIONS/intel-2011.10/composer_xe_2011_sp1/lib/intel64/libintlc.so.5 (0x00007ff526b6a000)
        libc.so.6 => /lib64/libc.so.6 (0x00007ff5267d7000)
        /lib64/ld-linux-x86-64.so.2 (0x0000003445200000)
        libtinfo.so.5 => /lib64/libtinfo.so.5 (0x00007ff5265b6000)


-- 
Regards,
Bj?rn-Helge Mevik


From maechler at stat.math.ethz.ch  Fri Oct 19 11:09:22 2012
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 19 Oct 2012 11:09:22 +0200
Subject: [Rd] simplify2array edge case
In-Reply-To: <E66794E69CFDE04D9A70842786030B933713B7@PA-MBX04.na.tibco.com>
References: <E66794E69CFDE04D9A70842786030B933713B7@PA-MBX04.na.tibco.com>
Message-ID: <20609.6338.465537.274685@stat.math.ethz.ch>

>>>>> William Dunlap <wdunlap at tibco.com>
>>>>>     on Thu, 11 Oct 2012 18:59:52 +0000 writes:

    > Should simplify2array(higher=TRUE) treat 1 by 1 matrices differently than others?
    > I expected a 3-dimensional array from all of the following 3 examples, not just the last 2.

    >> str(simplify2array(list(array(11,c(1,1)), array(21,c(1,1))), higher=TRUE))
    > num [1:2] 11 21
    >> str(simplify2array(list(array(11:13,c(3,1)), array(21:23,c(3,1))), higher=TRUE))
    > int [1:3, 1, 1:2] 11 12 13 21 22 23
    >> str(simplify2array(list(array(11:13,c(1,3)), array(21:23,c(1,3))), higher=TRUE))
    > int [1, 1:3, 1:2] 11 12 13 21 22 23

I wrote simplify2array() in order to modularize sapply()
and have mapply() and sapply() behave identically
and because its utility seemed useful in at least on other case.
In the mean time it is also used in the parallel package's
*apply() functions.

The distinction of  1 x 1  vs  n x n  for n >= 2
i.e.,

       if (common.len == 1L) 
            unlist(answer, recursive = FALSE)
        else if (common.len > 1L) 
            array(unlist(answer, recursive = FALSE), dim = c(common.len, 
	          .......
		  ....... )

had really been part of sapply() at the time and hence needed to
go into simplify2array() in order to keep sapply() completely
back compatible.

Bill, have you looked into optional different behavior?

Martin Maechler, ETH Zurich

    > Bill Dunlap
    > Spotfire, TIBCO Software
    > wdunlap tibco.com


From gavin.simpson at ucl.ac.uk  Fri Oct 19 13:39:26 2012
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Fri, 19 Oct 2012 12:39:26 +0100
Subject: [Rd] Rcmd_environ and R_LIBS_{USER,SITE}
In-Reply-To: <20608.7608.577340.915403@max.nulle.part>
References: <20606.51152.929307.770692@max.nulle.part>
	<k5odpj$kqp$1@ger.gmane.org> <20608.3682.541568.225279@max.nulle.part>
	<CAC2h7ut6Gm3Bz9h3qUhtpZ7iSs5qDFKinv3kiOfvZVKzb=N3vQ@mail.gmail.com>
	<20608.7608.577340.915403@max.nulle.part>
Message-ID: <1350646766.3967.1.camel@prometheus.geog.ucl.ac.uk>

On Thu, 2012-10-18 at 10:18 -0500, Dirk Eddelbuettel wrote:
> Kasper,
> 
> On 18 October 2012 at 10:41, Kasper Daniel Hansen wrote:
> | I set my user libraries in .Rprofile for this very reason.  I agree it
> | is weird that .Renviron is not always read etc.
> 
> Sorry, no cigar either -- this equivalent to using files in $R_HOME/etc/ and
> is also ignored by R CMD check, which still fails in my setup as it doesn't
> find the package -- whereas any normal R session does.
> 
> Dirk

I have R_LIBS set in my Bash profile (~/.bashrc) for IIRC this very
reason. Can you do the same on Windows?

G

> 
> 
> | 
> | Kasper
> | 
> | On Thu, Oct 18, 2012 at 10:12 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
> | >
> | > Keith,
> | >
> | > On 18 October 2012 at 09:14, Keith Jewell wrote:
> | > | No reply in a number of hours, so here is a suggestion from ignorance :-}
> | > |
> | > | ?Startup refers to a number of other "site and user files to process for
> | >
> | > Thanks, and I know, and use those on Linux (and on 'doze when I use it).  My
> | > question was specifically about 'R CMD foo' which skips some of these by
> | > choice, and which Rcmd_environ appears to overcome, albeit imcompletely. I
> | > still have an issue on Windows where I cannot split my package installations
> | > between those that come and go with R installations, and the others.
> | >
> | > But it is truly bizarre that I can do (on Windows)
> | >
> | >   R CMD INSTALL foo_1.2-3.tar.gz
> | >
> | > and a moment later
> | >
> | >   R CMD check foo_1.2-3.tar.gz
> | >
> | > fails in its tests and examples with "no package called 'foo'"
> | >
> | > Doing 'R CMD check --no-examples --no-tests foo_1.2-3.tar.gz' works, but is
> | > less helpful as we're running the check to run those very tests...
> | >
> | > Dirk
> | >
> | >
> | > | setting environment variables" but not to Rcmd_environ. The contents of
> | > | $R_HOME/etc/Rcmd_environ seem to reflect (some of) the contents of
> | > | (some) other files.
> | > |
> | > | I have similar lines (defining library paths) in
> | > |      $R_HOME/etc/Renviron.site
> | > |
> | > | Is it correct to directly edit Rcmd_environ or should it be modified
> | > | only via other files? (A genuine question).
> | > |
> | > | On 17/10/2012 15:59, Dirk Eddelbuettel wrote:
> | > | >
> | > | > Is there a fundamental reason why I cannot set either one of
> | > | >
> | > | >    ## add local library path -- doesn't work either
> | > | >    R_LIBS_USER="c:/opt/R-library"
> | > | >    R_LIBS_SITE="c:/opt/R-library"
> | > | >
> | > | > in $R_HOME/etc/Rcmd_environ even though I can seemingly set other things here?
> | > | >
> | > | > It breaks "R CMD check" for me as I prefer NOT to install packages in a
> | > | > versioned path.
> | > | >
> | > | > FWIW, defaulting to a versioned path is (to this no-longer-bemused user) as
> | > | > much a permenent R bug (on Windoze) as the default installation into a path
> | > | > with spaces.
> | > | >
> | > | > Dirk
> | > | >
> | > |
> | > | ______________________________________________
> | > | R-devel at r-project.org mailing list
> | > | https://stat.ethz.ch/mailman/listinfo/r-devel
> | >
> | > --
> | > Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com
> | >
> | > ______________________________________________
> | > R-devel at r-project.org mailing list
> | > https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From edd at debian.org  Fri Oct 19 15:21:47 2012
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 19 Oct 2012 08:21:47 -0500
Subject: [Rd] Rcmd_environ and R_LIBS_{USER,SITE}
In-Reply-To: <1350646766.3967.1.camel@prometheus.geog.ucl.ac.uk>
References: <20606.51152.929307.770692@max.nulle.part>
	<k5odpj$kqp$1@ger.gmane.org>
	<20608.3682.541568.225279@max.nulle.part>
	<CAC2h7ut6Gm3Bz9h3qUhtpZ7iSs5qDFKinv3kiOfvZVKzb=N3vQ@mail.gmail.com>
	<20608.7608.577340.915403@max.nulle.part>
	<1350646766.3967.1.camel@prometheus.geog.ucl.ac.uk>
Message-ID: <20609.21483.803720.948373@max.nulle.part>


On 19 October 2012 at 12:39, Gavin Simpson wrote:
| On Thu, 2012-10-18 at 10:18 -0500, Dirk Eddelbuettel wrote:
| > Kasper,
| > 
| > On 18 October 2012 at 10:41, Kasper Daniel Hansen wrote:
| > | I set my user libraries in .Rprofile for this very reason.  I agree it
| > | is weird that .Renviron is not always read etc.
| > 
| > Sorry, no cigar either -- this equivalent to using files in $R_HOME/etc/ and
| > is also ignored by R CMD check, which still fails in my setup as it doesn't
| > find the package -- whereas any normal R session does.
| > 
| > Dirk
| 
| I have R_LIBS set in my Bash profile (~/.bashrc) for IIRC this very
| reason. Can you do the same on Windows?

Thanks for the suggestion, Gavin,  But well, let me count the ways ....

i)   As a general principle, I prefer to minimize env variables. So on Linux,
     I prefer (and use) ~/.Rprofile and/or ~/.Renviron, or even the site-wide
     ones

ii)  Similarly, I asked for site-wide config as that can be scripted.
     Your solution, if it worked, would not (as easily) allow that.

iii) The question was specific about the intentional castration of R CMD ...
     I actually get the .libPaths() adjusted on Windows too via the method
     mentioned in i)

iv)  When I do what you helpfully suggest, .libPaths() in R shows the entry
     twice yet the braindead R CMD check .... __still fails the same way__ not
     being able to load the very package tested from the location that is __not
     below__ the $R_HOME/library/ path.

This really is silly beyond words, but seemingly all by design and intentional.

Dirk




| 
| G
| 
| > 
| > 
| > | 
| > | Kasper
| > | 
| > | On Thu, Oct 18, 2012 at 10:12 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
| > | >
| > | > Keith,
| > | >
| > | > On 18 October 2012 at 09:14, Keith Jewell wrote:
| > | > | No reply in a number of hours, so here is a suggestion from ignorance :-}
| > | > |
| > | > | ?Startup refers to a number of other "site and user files to process for
| > | >
| > | > Thanks, and I know, and use those on Linux (and on 'doze when I use it).  My
| > | > question was specifically about 'R CMD foo' which skips some of these by
| > | > choice, and which Rcmd_environ appears to overcome, albeit imcompletely. I
| > | > still have an issue on Windows where I cannot split my package installations
| > | > between those that come and go with R installations, and the others.
| > | >
| > | > But it is truly bizarre that I can do (on Windows)
| > | >
| > | >   R CMD INSTALL foo_1.2-3.tar.gz
| > | >
| > | > and a moment later
| > | >
| > | >   R CMD check foo_1.2-3.tar.gz
| > | >
| > | > fails in its tests and examples with "no package called 'foo'"
| > | >
| > | > Doing 'R CMD check --no-examples --no-tests foo_1.2-3.tar.gz' works, but is
| > | > less helpful as we're running the check to run those very tests...
| > | >
| > | > Dirk
| > | >
| > | >
| > | > | setting environment variables" but not to Rcmd_environ. The contents of
| > | > | $R_HOME/etc/Rcmd_environ seem to reflect (some of) the contents of
| > | > | (some) other files.
| > | > |
| > | > | I have similar lines (defining library paths) in
| > | > |      $R_HOME/etc/Renviron.site
| > | > |
| > | > | Is it correct to directly edit Rcmd_environ or should it be modified
| > | > | only via other files? (A genuine question).
| > | > |
| > | > | On 17/10/2012 15:59, Dirk Eddelbuettel wrote:
| > | > | >
| > | > | > Is there a fundamental reason why I cannot set either one of
| > | > | >
| > | > | >    ## add local library path -- doesn't work either
| > | > | >    R_LIBS_USER="c:/opt/R-library"
| > | > | >    R_LIBS_SITE="c:/opt/R-library"
| > | > | >
| > | > | > in $R_HOME/etc/Rcmd_environ even though I can seemingly set other things here?
| > | > | >
| > | > | > It breaks "R CMD check" for me as I prefer NOT to install packages in a
| > | > | > versioned path.
| > | > | >
| > | > | > FWIW, defaulting to a versioned path is (to this no-longer-bemused user) as
| > | > | > much a permenent R bug (on Windoze) as the default installation into a path
| > | > | > with spaces.
| > | > | >
| > | > | > Dirk
| > | > | >
| > | > |
| > | > | ______________________________________________
| > | > | R-devel at r-project.org mailing list
| > | > | https://stat.ethz.ch/mailman/listinfo/r-devel
| > | >
| > | > --
| > | > Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com
| > | >
| > | > ______________________________________________
| > | > R-devel at r-project.org mailing list
| > | > https://stat.ethz.ch/mailman/listinfo/r-devel
| > 
| 
| -- 
| %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
|  Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
|  ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
|  Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
|  Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
|  UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
| %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
| 
| 

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From simon.urbanek at r-project.org  Fri Oct 19 16:00:46 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 19 Oct 2012 10:00:46 -0400
Subject: [Rd] R CMD check --force-biarch
In-Reply-To: <CC047C72-07B4-459E-ADBF-72971648FD5F@macosx.com>
References: <CC047C72-07B4-459E-ADBF-72971648FD5F@macosx.com>
Message-ID: <C389F10A-9CB6-4202-90CB-F1953009A0FA@r-project.org>


On Oct 18, 2012, at 12:17 PM, Russell G. Almond wrote:

> I'm having problems getting R CMD check to work correctly on Windows 7 (64 bit) in a package that uses C code.  What I want to do is to be able to pass the equivalent of the "--force-biarch" option to check, but this is only supported for INSTALL.
> 
> Background:
> I'm writing a package (RNetica) which forms a link between R and a third-party library (Netica.dll).  The vendor supplies this library in both a 32 bit and a 64 bit version.
> Under Linux, I use configure to link against the 32 or 64 bit version of libnetica.a as appropriate.
> Under Windows, I use configure.win to copy the 32 and 64 bit versions to "$R_PACKAGE_DIR/libs/i386"  and "$R_PACKAGE_DIR/libs/x64" respectively.
> 
> Installation:
> This mostly works.  If I run R CMD INSTALL RNetica, R detects the configure.win and only builds the 64 bit version of RNetica.  [I'm not entirely clear on why R doesn't at least try to build both architectures. Wouldn't the default assumption be that the author wrote the configure.win file to handle both cases?]

No, it's not configure's job to detect anything but the current architecture. Typically it needs to modify files so it can only modify them for one architecture. Your use of configure is very odd since you don't actually configure the package, you are copying dependencies into installation directories (so you can't even test it without override - that's very unusual and a bit questionable).


>  But if I use R CMD INSTALL RNetica --force-biarch, it correctly builds and installs both the 32 and 64 bit versions.  I can verify that I can load my library and call a few functions that exercise the DLL.
> 
> Checking:
> When I run R CMD check RNetica, I get the following problem in my 00install.out log:
>> Warning: this package has a non-empty 'configure.win' file,
>> so building only the main architecture
> It then fails with the message:
>> Error:  .onLoad failed in loadNamespace() for 'RNetica', details:
>> Call:  library.dynam("RNetica",pkgname, libname)
>> Error:  DLL 'RNetica' not found:  maybe not installed for this architecture?
> Sure enough, if I check the directory RNetica.Rcheck/RNetica/libs/x64
> It has Netica.dll, RNetica.dll, and symbols.rds
> If I check the directory RNetica.Rcheck/RNetica/libs/i386
> It only has Netica.dll (copied there by the configure.win).
> 
> If I run R CMD check RNetica --no-multiarch, this test runs correctly.
> If I run R CMD check RNetica --extra-arch, this fails at the same point.
> 

You probably mean to use R --arch i386 to check your 32-bit version - architectures are normally tested separately.

Cheers,
Simon


> Thanks in advance for any help.
> 
> 
> 
> Russell Almond
> almond at acm.org
> http://ralmond.net/
> 
> 
> Russell G. Almond
> 12065 Cedar Bluff Trail
> Tallahassee, FL 32312
> 1-850-668-9624
> http://ralmond.net
> almond at acm.org
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From ripley at stats.ox.ac.uk  Fri Oct 19 16:58:08 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 19 Oct 2012 15:58:08 +0100
Subject: [Rd] R CMD check --force-biarch
In-Reply-To: <C389F10A-9CB6-4202-90CB-F1953009A0FA@r-project.org>
References: <CC047C72-07B4-459E-ADBF-72971648FD5F@macosx.com>
	<C389F10A-9CB6-4202-90CB-F1953009A0FA@r-project.org>
Message-ID: <50816A80.8030802@stats.ox.ac.uk>

On 19/10/2012 15:00, Simon Urbanek wrote:
>
> On Oct 18, 2012, at 12:17 PM, Russell G. Almond wrote:
>
>> I'm having problems getting R CMD check to work correctly on Windows 7 (64 bit) in a package that uses C code.  What I want to do is to be able to pass the equivalent of the "--force-biarch" option to check, but this is only supported for INSTALL.

And he seems to have missed

R CMD check --help

includes

       --install-args=	command-line args to be passed to INSTALL

so I would have used

R CMD check --install-args=--force-biarch

(and when I do, it works for me).

>> Background:
>> I'm writing a package (RNetica) which forms a link between R and a third-party library (Netica.dll).  The vendor supplies this library in both a 32 bit and a 64 bit version.
>> Under Linux, I use configure to link against the 32 or 64 bit version of libnetica.a as appropriate.
>> Under Windows, I use configure.win to copy the 32 and 64 bit versions to "$R_PACKAGE_DIR/libs/i386"  and "$R_PACKAGE_DIR/libs/x64" respectively.
>>
>> Installation:
>> This mostly works.  If I run R CMD INSTALL RNetica, R detects the configure.win and only builds the 64 bit version of RNetica.  [I'm not entirely clear on why R doesn't at least try to build both architectures. Wouldn't the default assumption be that the author wrote the configure.win file to handle both cases?]
>
> No, it's not configure's job to detect anything but the current architecture. Typically it needs to modify files so it can only modify them for one architecture. Your use of configure is very odd since you don't actually configure the package, you are copying dependencies into installation directories (so you can't even test it without override - that's very unusual and a bit questionable).
>
>
>>   But if I use R CMD INSTALL RNetica --force-biarch, it correctly builds and installs both the 32 and 64 bit versions.  I can verify that I can load my library and call a few functions that exercise the DLL.
>>
>> Checking:
>> When I run R CMD check RNetica, I get the following problem in my 00install.out log:
>>> Warning: this package has a non-empty 'configure.win' file,
>>> so building only the main architecture
>> It then fails with the message:
>>> Error:  .onLoad failed in loadNamespace() for 'RNetica', details:
>>> Call:  library.dynam("RNetica",pkgname, libname)
>>> Error:  DLL 'RNetica' not found:  maybe not installed for this architecture?
>> Sure enough, if I check the directory RNetica.Rcheck/RNetica/libs/x64
>> It has Netica.dll, RNetica.dll, and symbols.rds
>> If I check the directory RNetica.Rcheck/RNetica/libs/i386
>> It only has Netica.dll (copied there by the configure.win).
>>
>> If I run R CMD check RNetica --no-multiarch, this test runs correctly.
>> If I run R CMD check RNetica --extra-arch, this fails at the same point.
>>
>
> You probably mean to use R --arch i386 to check your 32-bit version - architectures are normally tested separately.
>
> Cheers,
> Simon
>
>
>> Thanks in advance for any help.
>>
>>
>>
>> Russell Almond
>> almond at acm.org
>> http://ralmond.net/
>>
>>
>> Russell G. Almond
>> 12065 Cedar Bluff Trail
>> Tallahassee, FL 32312
>> 1-850-668-9624
>> http://ralmond.net
>> almond at acm.org
>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ligges at statistik.tu-dortmund.de  Fri Oct 19 19:00:49 2012
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Fri, 19 Oct 2012 19:00:49 +0200
Subject: [Rd]
 =?utf-8?q?R_64bit_for_Windows_on_Windows_2012_server_running?=
 =?utf-8?q?_Microsoft=E2=80=99s_Hyper-V_2012=3F?=
In-Reply-To: <2F1B0A66E8124A4DA5B4C4D3EC18BA2633532526@MAIL02.TUCKER.CATALYSIS.com>
References: <2F1B0A66E8124A4DA5B4C4D3EC18BA2633530274@MAIL02.TUCKER.CATALYSIS.com>
	<2F1B0A66E8124A4DA5B4C4D3EC18BA2633532526@MAIL02.TUCKER.CATALYSIS.com>
Message-ID: <50818741.3090406@statistik.tu-dortmund.de>



On 19.10.2012 01:24, Matthew Schall wrote:
> Seeking confirmation/disconfirmation that R 64bit for Windows will run on Windows 2012 server running Microsoft?s Hyper-V 2012 server virtualization software and advice on building this on AMD 16 core or Intel 8 core processors where we want to put up a 64 core VM. We have not built this yet, we are seeking advice on whether R will run in this environment.

Probably yes, but untested. Those who develop the Windows part of R do 
not have access to such a system, so do not know.

Uwe Ligges



> Thank you;
>
> Matthew Schall
> Matthew at Catalysis.com
>
> catalysis? 1601 East John Street ? Seattle, Washington  98112 matthew at catalysis.com ? 206.860.2534 (direct) ? catalysis.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ligges at statistik.tu-dortmund.de  Fri Oct 19 19:02:54 2012
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Fri, 19 Oct 2012 19:02:54 +0200
Subject: [Rd] Mac and Windows binaries of rJava broken for R-devel?
In-Reply-To: <5080EA9D.3030809@fhcrc.org>
References: <5080EA9D.3030809@fhcrc.org>
Message-ID: <508187BE.2030706@statistik.tu-dortmund.de>

Thanks for letting me know.
Currently the ./2.16 Window binary tree on CRAN is still a link to 
./2.15. We will work to get binaries up within a week.

Uwe Ligges





On 19.10.2012 07:52, Herv? Pag?s wrote:
> Hi,
>
> Here is a problem we see with the Mac and Windows binaries of
> rJava (0.9-3) currently available on CRAN for R-devel (i.e. under
> bin/macosx/leopard/contrib/2.16/ and bin/windows/contrib/2.16/):
>
>    > library(rJava)
>    > .jinit("gaggle/inst/jars/gaggleRShell.jar")
>    Error in .Call("R_do_new_object", ClassDef, PACKAGE = "base") :
>      "R_do_new_object" not available for .Call() for package "base"
>
> The same code works fine with R-devel on Linux and the same version
> of rJava, or with R-2.15 on all platforms and the same version of
> rJava (Mac or Windows binaries installed from CRAN).
>
> The binaries currently available on CRAN for R-devel seem to predate
> some important changes in R-devel with respect to the exposure of
> some .Call entry points. Could it be that those binaries just need
> to be rebuilt with a more recent version of R-devel?
>
> FWIW, we have a few packages in the development version of Bioconductor
> that are affected by this issue.
>
> Thanks in advance,
> H.
>
>  > sessionInfo()
> R Under development (unstable) (2012-10-17 r60955)
> Platform: i386-apple-darwin9.8.0/i386 (32-bit)
>
> locale:
> [1] en_US/en_US/en_US/C/en_US/en_US
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rJava_0.9-3
>


From therneau at mayo.edu  Fri Oct 19 19:15:26 2012
From: therneau at mayo.edu (Terry Therneau)
Date: Fri, 19 Oct 2012 12:15:26 -0500
Subject: [Rd] Addition of plot=F argument to termplot
Message-ID: <50818AAE.6030008@mayo.edu>

I have a suggested addition to termplot.
We have a local mod that is used whenever none of the termplot options is quite right.  It 
is used here almost daily for Cox models in order to put the y axis on a risk scale:

----
fit <- coxph(Surv(time, status) ~ ph.ecog + pspline(age), data=lung)
zz <- termplot(fit, se=TRUE, plot=FALSE)

yy <- zz$age$y + outer(zz$age$se, c(0, -2, 2), '*')
matplot(zz$age$x, exp(yy), log='y', type='l', lty=c(1,2,2),
     xlab="Age", ylab="Relative risk")

----
The return value is a list, each element of which is a dataframe.  Another use is to 
overlay the fits from two different models.
The changes to termplot.R and .Rd are small.  Since we're not supposed to add attachments 
to these emails, where to I send the updated files?

Terry T


From ripley at stats.ox.ac.uk  Fri Oct 19 19:20:57 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 19 Oct 2012 18:20:57 +0100
Subject: [Rd] Addition of plot=F argument to termplot
In-Reply-To: <50818AAE.6030008@mayo.edu>
References: <50818AAE.6030008@mayo.edu>
Message-ID: <50818BF9.1010304@stats.ox.ac.uk>

On 19/10/2012 18:15, Terry Therneau wrote:
> I have a suggested addition to termplot.
> We have a local mod that is used whenever none of the termplot options
> is quite right.  It is used here almost daily for Cox models in order to
> put the y axis on a risk scale:
>
> ----
> fit <- coxph(Surv(time, status) ~ ph.ecog + pspline(age), data=lung)
> zz <- termplot(fit, se=TRUE, plot=FALSE)
>
> yy <- zz$age$y + outer(zz$age$se, c(0, -2, 2), '*')
> matplot(zz$age$x, exp(yy), log='y', type='l', lty=c(1,2,2),
>      xlab="Age", ylab="Relative risk")
>
> ----
> The return value is a list, each element of which is a dataframe.
> Another use is to overlay the fits from two different models.
> The changes to termplot.R and .Rd are small.  Since we're not supposed
> to add attachments to these emails, where to I send the updated files?

bugs.r-project.org is the best place to lodge enhancement suggestions: 
it accepts attachments.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ligges at statistik.tu-dortmund.de  Fri Oct 19 19:25:34 2012
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Fri, 19 Oct 2012 19:25:34 +0200
Subject: [Rd] Rcmd_environ and R_LIBS_{USER,SITE}
In-Reply-To: <20609.21483.803720.948373@max.nulle.part>
References: <20606.51152.929307.770692@max.nulle.part>
	<k5odpj$kqp$1@ger.gmane.org>
	<20608.3682.541568.225279@max.nulle.part>
	<CAC2h7ut6Gm3Bz9h3qUhtpZ7iSs5qDFKinv3kiOfvZVKzb=N3vQ@mail.gmail.com>
	<20608.7608.577340.915403@max.nulle.part>
	<1350646766.3967.1.camel@prometheus.geog.ucl.ac.uk>
	<20609.21483.803720.948373@max.nulle.part>
Message-ID: <50818D0E.8090104@statistik.tu-dortmund.de>

Dirk,

if you ask R to

R CMD check foo_1.2-3.tar.gz


and the output is

"no package called 'foo'"

then something went wrong with your setup or your package.

Can we have details?

Best,
Uwe




On 19.10.2012 15:21, Dirk Eddelbuettel wrote:
>
> On 19 October 2012 at 12:39, Gavin Simpson wrote:
> | On Thu, 2012-10-18 at 10:18 -0500, Dirk Eddelbuettel wrote:
> | > Kasper,
> | >
> | > On 18 October 2012 at 10:41, Kasper Daniel Hansen wrote:
> | > | I set my user libraries in .Rprofile for this very reason.  I agree it
> | > | is weird that .Renviron is not always read etc.
> | >
> | > Sorry, no cigar either -- this equivalent to using files in $R_HOME/etc/ and
> | > is also ignored by R CMD check, which still fails in my setup as it doesn't
> | > find the package -- whereas any normal R session does.
> | >
> | > Dirk
> |
> | I have R_LIBS set in my Bash profile (~/.bashrc) for IIRC this very
> | reason. Can you do the same on Windows?
>
> Thanks for the suggestion, Gavin,  But well, let me count the ways ....
>
> i)   As a general principle, I prefer to minimize env variables. So on Linux,
>       I prefer (and use) ~/.Rprofile and/or ~/.Renviron, or even the site-wide
>       ones
>
> ii)  Similarly, I asked for site-wide config as that can be scripted.
>       Your solution, if it worked, would not (as easily) allow that.
>
> iii) The question was specific about the intentional castration of R CMD ...
>       I actually get the .libPaths() adjusted on Windows too via the method
>       mentioned in i)
>
> iv)  When I do what you helpfully suggest, .libPaths() in R shows the entry
>       twice yet the braindead R CMD check .... __still fails the same way__ not
>       being able to load the very package tested from the location that is __not
>       below__ the $R_HOME/library/ path.
>
> This really is silly beyond words, but seemingly all by design and intentional.
>
> Dirk
>
>
>
>
> |
> | G
> |
> | >
> | >
> | > |
> | > | Kasper
> | > |
> | > | On Thu, Oct 18, 2012 at 10:12 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
> | > | >
> | > | > Keith,
> | > | >
> | > | > On 18 October 2012 at 09:14, Keith Jewell wrote:
> | > | > | No reply in a number of hours, so here is a suggestion from ignorance :-}
> | > | > |
> | > | > | ?Startup refers to a number of other "site and user files to process for
> | > | >
> | > | > Thanks, and I know, and use those on Linux (and on 'doze when I use it).  My
> | > | > question was specifically about 'R CMD foo' which skips some of these by
> | > | > choice, and which Rcmd_environ appears to overcome, albeit imcompletely. I
> | > | > still have an issue on Windows where I cannot split my package installations
> | > | > between those that come and go with R installations, and the others.
> | > | >
> | > | > But it is truly bizarre that I can do (on Windows)
> | > | >
> | > | >   R CMD INSTALL foo_1.2-3.tar.gz
> | > | >
> | > | > and a moment later
> | > | >
> | > | >   R CMD check foo_1.2-3.tar.gz
> | > | >
> | > | > fails in its tests and examples with "no package called 'foo'"
> | > | >
> | > | > Doing 'R CMD check --no-examples --no-tests foo_1.2-3.tar.gz' works, but is
> | > | > less helpful as we're running the check to run those very tests...
> | > | >
> | > | > Dirk
> | > | >
> | > | >
> | > | > | setting environment variables" but not to Rcmd_environ. The contents of
> | > | > | $R_HOME/etc/Rcmd_environ seem to reflect (some of) the contents of
> | > | > | (some) other files.
> | > | > |
> | > | > | I have similar lines (defining library paths) in
> | > | > |      $R_HOME/etc/Renviron.site
> | > | > |
> | > | > | Is it correct to directly edit Rcmd_environ or should it be modified
> | > | > | only via other files? (A genuine question).
> | > | > |
> | > | > | On 17/10/2012 15:59, Dirk Eddelbuettel wrote:
> | > | > | >
> | > | > | > Is there a fundamental reason why I cannot set either one of
> | > | > | >
> | > | > | >    ## add local library path -- doesn't work either
> | > | > | >    R_LIBS_USER="c:/opt/R-library"
> | > | > | >    R_LIBS_SITE="c:/opt/R-library"
> | > | > | >
> | > | > | > in $R_HOME/etc/Rcmd_environ even though I can seemingly set other things here?
> | > | > | >
> | > | > | > It breaks "R CMD check" for me as I prefer NOT to install packages in a
> | > | > | > versioned path.
> | > | > | >
> | > | > | > FWIW, defaulting to a versioned path is (to this no-longer-bemused user) as
> | > | > | > much a permenent R bug (on Windoze) as the default installation into a path
> | > | > | > with spaces.
> | > | > | >
> | > | > | > Dirk
> | > | > | >
> | > | > |
> | > | > | ______________________________________________
> | > | > | R-devel at r-project.org mailing list
> | > | > | https://stat.ethz.ch/mailman/listinfo/r-devel
> | > | >
> | > | > --
> | > | > Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com
> | > | >
> | > | > ______________________________________________
> | > | > R-devel at r-project.org mailing list
> | > | > https://stat.ethz.ch/mailman/listinfo/r-devel
> | >
> |
> | --
> | %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> |  Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
> |  ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
> |  Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
> |  Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
> |  UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
> | %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> |
> |
>


From xie at yihui.name  Fri Oct 19 20:22:13 2012
From: xie at yihui.name (Yihui Xie)
Date: Fri, 19 Oct 2012 13:22:13 -0500
Subject: [Rd] customize building package vignettes
Message-ID: <CANROs4dt_cdn8Ed3eVJTecMHcSo278T9mawO5e0Tx+eGQ26HmA@mail.gmail.com>

Hi,

I mentioned this at useR! 2012 but I guess the relevant R core members
were not there (presumably Fritz, Duncan and Brian), so I'm making
this wishlist again:

Currently package vignettes have to be processed through Sweave, which
is too restrictive since several add-on packages aiming to improve or
extend Sweave have appeared (e.g. cacheSweave, pgfSweave, R.rsp,
highlight, knitr, ...). The common hack that package authors use, as
far as I can see, is the Makefile. One example is at
https://github.com/yihui/knitr/blob/master/inst/doc/Makefile

Although this hack works well for some cases, it is potentially
problematic in two aspects:

1. The vignette has to be processed by Sweave anyway, and it is a
waste of time because it will be processed by another package later in
the Makefile;
2. The syntax of the vignette may not be compatible with Sweave, so
Sweave can run into errors (e.g. <<eval = if (foo > 5) TRUE else
FALSE>>=); there is a darker hack for this but we really hate hacks;

Vignettes are extremely valuable resources for R packages, and I
really wish there could be a natural way for package developers to
compile vignettes using a customized routine. For example, introduce a
build.R under inst/doc or vignettes/ which takes care of building the
vignettes; if it does not exist, just call Sweave() as the default
approach.

Here is one discussion about a package on Bioconductor which should
strengthen my proposal:
http://grokbase.com/t/r/bioc-devel/129vxrxabm/to-use-knitr-how-to-write-the-right-makefile-for-bioconductor-devel-and-released-branch

There are further advantages if package authors are not restricted to
Sweave; the corrplot package is an example of building an HTML
vignette which could be easier for authors who are not familiar with
LaTeX and they can also distribute the vignette on the web easily.
See:

if (!require('corrplot')) install.packages('corrplot')
help(package = 'corrplot', help_type = 'html')

I have talked to some R core and Bioc core members offline, and this
seems to be a reasonable request. I will be grateful if this can be
considered and implemented in the future.

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Phone: 515-294-2465 Web: http://yihui.name
Department of Statistics, Iowa State University
2215 Snedecor Hall, Ames, IA


From charlie at stat.umn.edu  Fri Oct 19 23:35:03 2012
From: charlie at stat.umn.edu (Charles Geyer)
Date: Fri, 19 Oct 2012 16:35:03 -0500
Subject: [Rd] setting option in function
Message-ID: <CAKctRd3mh4xK2+09yCvqi1fM2REMGQtQj1A=1M7voxcqw7r1Zw@mail.gmail.com>

is it possible to set an option inside a function ((I want to set
na.action = na.fail) and have the previous state restored if there is
an error so that the function doesn't change the option behind the
user's back?

Sorry if this has been answered before, but this subject is hard to Google.

--
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From edd at debian.org  Fri Oct 19 23:58:30 2012
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 19 Oct 2012 16:58:30 -0500
Subject: [Rd] Rcmd_environ and R_LIBS_{USER,SITE}
In-Reply-To: <50818D0E.8090104@statistik.tu-dortmund.de>
References: <20606.51152.929307.770692@max.nulle.part>
	<k5odpj$kqp$1@ger.gmane.org>
	<20608.3682.541568.225279@max.nulle.part>
	<CAC2h7ut6Gm3Bz9h3qUhtpZ7iSs5qDFKinv3kiOfvZVKzb=N3vQ@mail.gmail.com>
	<20608.7608.577340.915403@max.nulle.part>
	<1350646766.3967.1.camel@prometheus.geog.ucl.ac.uk>
	<20609.21483.803720.948373@max.nulle.part>
	<50818D0E.8090104@statistik.tu-dortmund.de>
Message-ID: <20609.52486.220382.619704@max.nulle.part>


Hi Uwe,

On 19 October 2012 at 19:25, Uwe Ligges wrote:
| Dirk,
| 
| if you ask R to
| 
| R CMD check foo_1.2-3.tar.gz
| 
| 
| and the output is
| 
| "no package called 'foo'"
| 
| then something went wrong with your setup or your package.

That is not what I said, or tried to say. My issue is that the _tests_ and
_examples_ fail.
 
| Can we have details?

Sure -- See below.  Cut and pasted from an Emacs buffer on Windoze as
evidenved by the U:\ directory at mingw id shown. Emacs has no role here, it
also fails the same way in a normal DOS prompt.


u:\R\src>R CMD check foo_0.2.2.tar.gz
R CMD check foo_0.2.2.tar.gz
* using log directory 'u:/R/src/foo.Rcheck'
* using R version 2.15.1 (2012-06-22)
* using platform: x86_64-pc-mingw32 (64-bit)
* using session charset: ISO8859-1
* checking for file 'foo/DESCRIPTION' ... OK
* checking extension type ... Package
* this is package 'foo' version '0.2.2'
* checking package namespace information ... OK
* checking package dependencies ... OK
* checking if this is a source package ... OK
* checking if there is a namespace ... OK
* checking for executable files ... OK
* checking whether package 'foo' can be installed ... [34s] OK
* checking installed package size ... OK
* checking package directory ... OK
* checking for portable file names ... OK
* checking DESCRIPTION meta-information ... OK
* checking top-level files ... OK
* checking index information ... OK
* checking package subdirectories ... OK
* checking R files for non-ASCII characters ... OK
* checking R files for syntax errors ... OK
* loading checks for arch 'i386'
** checking whether the package can be loaded ... OK
** checking whether the package can be loaded with stated dependencies ... OK
** checking whether the package can be unloaded cleanly ... OK
** checking whether the namespace can be loaded with stated dependencies
... OK
** checking whether the namespace can be unloaded cleanly ... OK
* loading checks for arch 'x64'
** checking whether the package can be loaded ... OK
** checking whether the package can be loaded with stated dependencies ... OK
** checking whether the package can be unloaded cleanly ... OK
** checking whether the namespace can be loaded with stated dependencies
... OK
** checking whether the namespace can be unloaded cleanly ... OK
* checking for unstated dependencies in R code ... OK
* checking S3 generic/method consistency ... OK
* checking replacement functions ... OK
* checking foreign function calls ... OK
* checking R code for possible problems ... OK
* checking Rd files ... OK
* checking Rd metadata ... OK
* checking Rd cross-references ... OK
* checking for missing documentation entries ... OK
* checking for code/documentation mismatches ... OK
* checking Rd \usage sections ... OK
* checking Rd contents ... OK
* checking for unstated dependencies in examples ... OK
* checking contents of 'data' directory ... OK
* checking data for non-ASCII characters ... OK
* checking data for ASCII and uncompressed saves ... OK
* checking line endings in C/C++/Fortran sources/headers ... OK
* checking line endings in Makefiles ... OK
* checking for portable compilation flags in Makevars ... OK
* checking for portable use of $(BLAS_LIBS) and $(LAPACK_LIBS) ... OK
* checking compiled code ... OK
* checking examples ...
** running examples for arch 'i386' ... ERROR
Running examples in 'foo-Ex.R' failed
The error occurred in:


R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
Copyright (C) 2012 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: i386-pc-mingw32/i386 (32-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> pkgname <- "foo"
> source(file.path(R.home("share"), "R", "examples-header.R"))
> options(warn = 1)
> options(pager = "console")
> library('foo')
Error in library("foo") : there is no package called 'foo'
Execution halted
** running examples for arch 'x64' ... ERROR
Running examples in 'foo-Ex.R' failed
The error occurred in:


R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
Copyright (C) 2012 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: x86_64-pc-mingw32/x64 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> pkgname <- "foo"
> source(file.path(R.home("share"), "R", "examples-header.R"))
> options(warn = 1)
> options(pager = "console")
> library('foo')
Error in library("foo") : there is no package called 'foo'
Execution halted

u:\R\src>

Needless to say the package __does__ of course exist, is installed and
loadable:


u:\R\src>R --no-save
R --no-save

R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
Copyright (C) 2012 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: x86_64-pc-mingw32/x64 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

R> library(foo)
library(foo)
Loading required package: Rcpp
Loading required package: xts
Loading required package: zoo

Attaching package: 'zoo'

The following object(s) are masked from 'package:base':

    as.Date, as.Date.numeric

R> 


[ foo is a placeholder here, the package has a different name which plays no
role in the misbehaviour demonstrated above. ]

Thanks for looking into this.  

Dirk


| Best,
| Uwe
| 
| 
| 
| 
| On 19.10.2012 15:21, Dirk Eddelbuettel wrote:
| >
| > On 19 October 2012 at 12:39, Gavin Simpson wrote:
| > | On Thu, 2012-10-18 at 10:18 -0500, Dirk Eddelbuettel wrote:
| > | > Kasper,
| > | >
| > | > On 18 October 2012 at 10:41, Kasper Daniel Hansen wrote:
| > | > | I set my user libraries in .Rprofile for this very reason.  I agree it
| > | > | is weird that .Renviron is not always read etc.
| > | >
| > | > Sorry, no cigar either -- this equivalent to using files in $R_HOME/etc/ and
| > | > is also ignored by R CMD check, which still fails in my setup as it doesn't
| > | > find the package -- whereas any normal R session does.
| > | >
| > | > Dirk
| > |
| > | I have R_LIBS set in my Bash profile (~/.bashrc) for IIRC this very
| > | reason. Can you do the same on Windows?
| >
| > Thanks for the suggestion, Gavin,  But well, let me count the ways ....
| >
| > i)   As a general principle, I prefer to minimize env variables. So on Linux,
| >       I prefer (and use) ~/.Rprofile and/or ~/.Renviron, or even the site-wide
| >       ones
| >
| > ii)  Similarly, I asked for site-wide config as that can be scripted.
| >       Your solution, if it worked, would not (as easily) allow that.
| >
| > iii) The question was specific about the intentional castration of R CMD ...
| >       I actually get the .libPaths() adjusted on Windows too via the method
| >       mentioned in i)
| >
| > iv)  When I do what you helpfully suggest, .libPaths() in R shows the entry
| >       twice yet the braindead R CMD check .... __still fails the same way__ not
| >       being able to load the very package tested from the location that is __not
| >       below__ the $R_HOME/library/ path.
| >
| > This really is silly beyond words, but seemingly all by design and intentional.
| >
| > Dirk
| >
| >
| >
| >
| > |
| > | G
| > |
| > | >
| > | >
| > | > |
| > | > | Kasper
| > | > |
| > | > | On Thu, Oct 18, 2012 at 10:12 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
| > | > | >
| > | > | > Keith,
| > | > | >
| > | > | > On 18 October 2012 at 09:14, Keith Jewell wrote:
| > | > | > | No reply in a number of hours, so here is a suggestion from ignorance :-}
| > | > | > |
| > | > | > | ?Startup refers to a number of other "site and user files to process for
| > | > | >
| > | > | > Thanks, and I know, and use those on Linux (and on 'doze when I use it).  My
| > | > | > question was specifically about 'R CMD foo' which skips some of these by
| > | > | > choice, and which Rcmd_environ appears to overcome, albeit imcompletely. I
| > | > | > still have an issue on Windows where I cannot split my package installations
| > | > | > between those that come and go with R installations, and the others.
| > | > | >
| > | > | > But it is truly bizarre that I can do (on Windows)
| > | > | >
| > | > | >   R CMD INSTALL foo_1.2-3.tar.gz
| > | > | >
| > | > | > and a moment later
| > | > | >
| > | > | >   R CMD check foo_1.2-3.tar.gz
| > | > | >
| > | > | > fails in its tests and examples with "no package called 'foo'"
| > | > | >
| > | > | > Doing 'R CMD check --no-examples --no-tests foo_1.2-3.tar.gz' works, but is
| > | > | > less helpful as we're running the check to run those very tests...
| > | > | >
| > | > | > Dirk
| > | > | >
| > | > | >
| > | > | > | setting environment variables" but not to Rcmd_environ. The contents of
| > | > | > | $R_HOME/etc/Rcmd_environ seem to reflect (some of) the contents of
| > | > | > | (some) other files.
| > | > | > |
| > | > | > | I have similar lines (defining library paths) in
| > | > | > |      $R_HOME/etc/Renviron.site
| > | > | > |
| > | > | > | Is it correct to directly edit Rcmd_environ or should it be modified
| > | > | > | only via other files? (A genuine question).
| > | > | > |
| > | > | > | On 17/10/2012 15:59, Dirk Eddelbuettel wrote:
| > | > | > | >
| > | > | > | > Is there a fundamental reason why I cannot set either one of
| > | > | > | >
| > | > | > | >    ## add local library path -- doesn't work either
| > | > | > | >    R_LIBS_USER="c:/opt/R-library"
| > | > | > | >    R_LIBS_SITE="c:/opt/R-library"
| > | > | > | >
| > | > | > | > in $R_HOME/etc/Rcmd_environ even though I can seemingly set other things here?
| > | > | > | >
| > | > | > | > It breaks "R CMD check" for me as I prefer NOT to install packages in a
| > | > | > | > versioned path.
| > | > | > | >
| > | > | > | > FWIW, defaulting to a versioned path is (to this no-longer-bemused user) as
| > | > | > | > much a permenent R bug (on Windoze) as the default installation into a path
| > | > | > | > with spaces.
| > | > | > | >
| > | > | > | > Dirk
| > | > | > | >
| > | > | > |
| > | > | > | ______________________________________________
| > | > | > | R-devel at r-project.org mailing list
| > | > | > | https://stat.ethz.ch/mailman/listinfo/r-devel
| > | > | >
| > | > | > --
| > | > | > Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com
| > | > | >
| > | > | > ______________________________________________
| > | > | > R-devel at r-project.org mailing list
| > | > | > https://stat.ethz.ch/mailman/listinfo/r-devel
| > | >
| > |
| > | --
| > | %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
| > |  Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
| > |  ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
| > |  Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
| > |  Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
| > |  UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
| > | %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
| > |
| > |
| >

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From tlumley at uw.edu  Sat Oct 20 00:10:34 2012
From: tlumley at uw.edu (Thomas Lumley)
Date: Sat, 20 Oct 2012 11:10:34 +1300
Subject: [Rd] setting option in function
In-Reply-To: <CAKctRd3mh4xK2+09yCvqi1fM2REMGQtQj1A=1M7voxcqw7r1Zw@mail.gmail.com>
References: <CAKctRd3mh4xK2+09yCvqi1fM2REMGQtQj1A=1M7voxcqw7r1Zw@mail.gmail.com>
Message-ID: <CAJ55+dJGga2TVxN_2KfnYHVWighCp5fgnRhHgEVEPPzXfpYfTg@mail.gmail.com>

old_options <- options(na.action=na.fail)
on.exit(options(old_options))

You can also use this to define a wrapper that executes an expression
using special options

withOptions<-function(optlist,expr){
        oldopt<-options(optlist)
        on.exit(options(oldopt))
        expr<-substitute(expr)
        eval.parent(expr)
        }


    -thomas



On Sat, Oct 20, 2012 at 10:35 AM, Charles Geyer <charlie at stat.umn.edu> wrote:
> is it possible to set an option inside a function ((I want to set
> na.action = na.fail) and have the previous state restored if there is
> an error so that the function doesn't change the option behind the
> user's back?
>
> Sorry if this has been answered before, but this subject is hard to Google.
>
> --
> Charles Geyer
> Professor, School of Statistics
> University of Minnesota
> charlie at stat.umn.edu
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 
Thomas Lumley
Professor of Biostatistics
University of Auckland


From hpages at fhcrc.org  Sat Oct 20 00:30:50 2012
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Fri, 19 Oct 2012 15:30:50 -0700
Subject: [Rd] Mac and Windows binaries of rJava broken for R-devel?
In-Reply-To: <508187BE.2030706@statistik.tu-dortmund.de>
References: <5080EA9D.3030809@fhcrc.org>
	<508187BE.2030706@statistik.tu-dortmund.de>
Message-ID: <5081D49A.1030007@fhcrc.org>

On 10/19/2012 10:02 AM, Uwe Ligges wrote:
> Thanks for letting me know.
> Currently the ./2.16 Window binary tree on CRAN is still a link to
> ./2.15. We will work to get binaries up within a week.

Sounds good. Thanks!  H.

>
> Uwe Ligges
>
>
>
>
>
> On 19.10.2012 07:52, Herv? Pag?s wrote:
>> Hi,
>>
>> Here is a problem we see with the Mac and Windows binaries of
>> rJava (0.9-3) currently available on CRAN for R-devel (i.e. under
>> bin/macosx/leopard/contrib/2.16/ and bin/windows/contrib/2.16/):
>>
>>    > library(rJava)
>>    > .jinit("gaggle/inst/jars/gaggleRShell.jar")
>>    Error in .Call("R_do_new_object", ClassDef, PACKAGE = "base") :
>>      "R_do_new_object" not available for .Call() for package "base"
>>
>> The same code works fine with R-devel on Linux and the same version
>> of rJava, or with R-2.15 on all platforms and the same version of
>> rJava (Mac or Windows binaries installed from CRAN).
>>
>> The binaries currently available on CRAN for R-devel seem to predate
>> some important changes in R-devel with respect to the exposure of
>> some .Call entry points. Could it be that those binaries just need
>> to be rebuilt with a more recent version of R-devel?
>>
>> FWIW, we have a few packages in the development version of Bioconductor
>> that are affected by this issue.
>>
>> Thanks in advance,
>> H.
>>
>>  > sessionInfo()
>> R Under development (unstable) (2012-10-17 r60955)
>> Platform: i386-apple-darwin9.8.0/i386 (32-bit)
>>
>> locale:
>> [1] en_US/en_US/en_US/C/en_US/en_US
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> other attached packages:
>> [1] rJava_0.9-3
>>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From hpages at fhcrc.org  Sat Oct 20 01:04:12 2012
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Fri, 19 Oct 2012 16:04:12 -0700
Subject: [Rd] Change in the RNG implementation?
Message-ID: <5081DC6C.2010306@fhcrc.org>

Hi,

Looks like the implementation of random number generation changed in
R-devel with respect to R-2.15.1.

With R-2.15.1:

   > set.seed(33)
   > sample(49821115, 10)
    [1] 22217252 19661919 24099911 45779422 42043111 25774933 21778053 
17098516
    [9]   773073  5878451

With recent R-devel:

   > set.seed(33)
   > sample(49821115, 10)
    [1] 22217252 19661919 24099912 45779425 42043115 25774935 21778056 
17098518
    [9]   773073  5878452

This is on a 64-bit Ubuntu system.

Is this change intended? I didn't see anything in the NEWS file.

A potential problem with this is that it will break unit tests
for algorithms that make use of RNG.

Another more practical problem (at least for me) is the following:
Bioconductor package maintainers are sometimes working hard on the
development version of their package to improve the performance of
some key functions. Comparing performance between BioC release
(based on R-2.15) and devel (based on R-devel) often requires big
input data that is randomly generated, because it's easiest than
working with real data. Typically a small script is written that
takes care of loading the required packages, generating the input
data, and running a simple analysis. The same script is sourced in
R-2.15 and R-devel, and performance and results are compared.

Not being able to generate exactly the same input in the script is
a problem. It can be worked around by generating the input once,
serializing it, and use load() in the script, but that makes things
more complicated and the script is not a standalone script anymore
(cannot be passed around without also passing around the big .rda
file).

Thanks,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From wdunlap at tibco.com  Sat Oct 20 01:18:12 2012
From: wdunlap at tibco.com (William Dunlap)
Date: Fri, 19 Oct 2012 23:18:12 +0000
Subject: [Rd] setting option in function
In-Reply-To: <CAKctRd3mh4xK2+09yCvqi1fM2REMGQtQj1A=1M7voxcqw7r1Zw@mail.gmail.com>
References: <CAKctRd3mh4xK2+09yCvqi1fM2REMGQtQj1A=1M7voxcqw7r1Zw@mail.gmail.com>
Message-ID: <E66794E69CFDE04D9A70842786030B93378D44@PA-MBX04.na.tibco.com>

Hi Charley,

You can use the idiom
   oldNaAction <- options(na.action=na.fail)
   on.exit(options(oldNaAction))
or the slightly safer (protected again an interrupt
between the first two lines or an error calling options
to set them)
   oldNaAction <- getOption("na.action")
   on.exit(options(oldNaAction))
   options(na.action=na.fail)
.
I prefer to bury it in a function like
   withOption <- function(optionList, expr) {
       stopifnot(is.list(optionList))
       oldOptionList <- options(names(optionList))
       on.exit(options(oldOptionList))
       options(optionList)
       expr # lazily evaluate now
   }
used as
  > getOption("na.action")
  [1] "na.omit"
  > withOption(list(na.action = "na.fail"), lm(y~x, data=data.frame(x=c(1,2,NA), y=1:3)))
  Error in na.fail.default(list(y = 1:3, x = c(1, 2, NA))) : 
    missing values in object
  > withOption(list(na.action = "na.exclude"), lm(y~x, data=data.frame(x=c(1,2,NA), y=1:3)))  

  Call:
  lm(formula = y ~ x, data = data.frame(x = c(1, 2, NA), y = 1:3))
  
  Coefficients:
  (Intercept)            x  
            0            1  

  > getOption("na.action")
  [1] "na.omit"

The function makes it  less painful to use the safer version and you
don't have to worry about a subsequent call to on.exit()
wiping out the current request to do something on exiting
the function.

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com


> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf
> Of Charles Geyer
> Sent: Friday, October 19, 2012 2:35 PM
> To: r-devel at r-project.org
> Subject: [Rd] setting option in function
> 
> is it possible to set an option inside a function ((I want to set
> na.action = na.fail) and have the previous state restored if there is
> an error so that the function doesn't change the option behind the
> user's back?
> 
> Sorry if this has been answered before, but this subject is hard to Google.
> 
> --
> Charles Geyer
> Professor, School of Statistics
> University of Minnesota
> charlie at stat.umn.edu
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From charlie at stat.umn.edu  Sat Oct 20 01:02:45 2012
From: charlie at stat.umn.edu (Charles Geyer)
Date: Fri, 19 Oct 2012 18:02:45 -0500
Subject: [Rd] setting option in function
In-Reply-To: <CAJ55+dJGga2TVxN_2KfnYHVWighCp5fgnRhHgEVEPPzXfpYfTg@mail.gmail.com>
References: <CAKctRd3mh4xK2+09yCvqi1fM2REMGQtQj1A=1M7voxcqw7r1Zw@mail.gmail.com>
	<CAJ55+dJGga2TVxN_2KfnYHVWighCp5fgnRhHgEVEPPzXfpYfTg@mail.gmail.com>
Message-ID: <CAKctRd3HH+wBMbkk2OckbEySvr37rPd89PiKaaQp_UJE=JtM_Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121019/54e5f715/attachment.pl>

From murdoch.duncan at gmail.com  Sat Oct 20 01:26:39 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 19 Oct 2012 19:26:39 -0400
Subject: [Rd] Change in the RNG implementation?
In-Reply-To: <5081DC6C.2010306@fhcrc.org>
References: <5081DC6C.2010306@fhcrc.org>
Message-ID: <5081E1AF.8020308@gmail.com>

On 12-10-19 7:04 PM, Herv? Pag?s wrote:
> Hi,
>
> Looks like the implementation of random number generation changed in
> R-devel with respect to R-2.15.1.
>
> With R-2.15.1:
>
>     > set.seed(33)
>     > sample(49821115, 10)
>      [1] 22217252 19661919 24099911 45779422 42043111 25774933 21778053
> 17098516
>      [9]   773073  5878451
>
> With recent R-devel:
>
>     > set.seed(33)
>     > sample(49821115, 10)
>      [1] 22217252 19661919 24099912 45779425 42043115 25774935 21778056
> 17098518
>      [9]   773073  5878452
>
> This is on a 64-bit Ubuntu system.
>
> Is this change intended? I didn't see anything in the NEWS file.
>
> A potential problem with this is that it will break unit tests
> for algorithms that make use of RNG.
>
> Another more practical problem (at least for me) is the following:
> Bioconductor package maintainers are sometimes working hard on the
> development version of their package to improve the performance of
> some key functions. Comparing performance between BioC release
> (based on R-2.15) and devel (based on R-devel) often requires big
> input data that is randomly generated, because it's easiest than
> working with real data. Typically a small script is written that
> takes care of loading the required packages, generating the input
> data, and running a simple analysis. The same script is sourced in
> R-2.15 and R-devel, and performance and results are compared.
>
> Not being able to generate exactly the same input in the script is
> a problem. It can be worked around by generating the input once,
> serializing it, and use load() in the script, but that makes things
> more complicated and the script is not a standalone script anymore
> (cannot be passed around without also passing around the big .rda
> file).
>
> Thanks,
> H.
>

I think it was mentioned in the NEWS:

  \code{sample.int()} has some support for  \eqn{n \ge
  2^{31}}{n >= 2^31}: see its help for the limitations.

  A different algorithm is used for \code{(n, size, replace = FALSE,
  prob = NULL)} for \code{n > 1e7} and \code{size <= n/2}.  This
  is much faster and uses less memory, but does give different results.

I don't think the old algorithm is available, but perhaps it could be 
made available by an optional parameter.

Duncan Murdoch


From torekp at gmail.com  Sat Oct 20 03:46:11 2012
From: torekp at gmail.com (torekp)
Date: Fri, 19 Oct 2012 18:46:11 -0700 (PDT)
Subject: [Rd] Wait for user input with readline()
In-Reply-To: <1335113484862-4578455.post@n4.nabble.com>
References: <AANLkTikAG_8ynt2+SP=b5WYJ2u2w5iwqit=0R_1FDsJr@mail.gmail.com>
	<1291652739318-3074781.post@n4.nabble.com>
	<20101207171921.GA21470@cs.cas.cz>
	<5C3B1203-2810-4CBE-9501-A3F2A36C18C3@r-project.org>
	<1291798668564-3077878.post@n4.nabble.com>
	<1335113484862-4578455.post@n4.nabble.com>
Message-ID: <1350697571911-4646826.post@n4.nabble.com>

jcharlto,

Thank you thank you thank you, you just saved me about 7.9 hours!



--
View this message in context: http://r.789695.n4.nabble.com/Wait-for-user-input-with-readline-tp3054517p4646826.html
Sent from the R devel mailing list archive at Nabble.com.


From m.cowley at garvan.org.au  Sat Oct 20 13:01:52 2012
From: m.cowley at garvan.org.au (Mark Cowley)
Date: Sat, 20 Oct 2012 22:01:52 +1100
Subject: [Rd] R-2.15.1 CMD CHECK output: "Call Sequence"
Message-ID: <F7EACB21-9D34-4F5B-87EA-D72597E96971@garvan.org.au>

Hi guRus,
i'm running R-2.15.1 and the R CMD CHECK output appears to have changed substantially, in that instead of pointing me to the offending functions or files, I get lots of 'call sequence' traces as below.

I've been using R CMD CHECK for years &  never seen anything like this before. This is on a pretty fresh OSX 10.8 Mountain Lion installation, where I installed R from CRAN via pkg. Is this a problem unique to me?

cheers,
Mark

heres' a snippet from testing one of my packages under development:

* checking for unstated dependencies in R code ... WARNING
Error: package/namespace load failed for ?metaGSEA?
Call sequence:
2: stop(gettextf("package/namespace load failed for %s", sQuote(package)), 
      call. = FALSE, domain = NA)
1: library(package, lib.loc = lib.loc, character.only = TRUE, verbose = FALSE)
Execution halted
See the information on DESCRIPTION files in the chapter ?Creating R
packages? of the ?Writing R Extensions? manual.
* checking S3 generic/method consistency ... WARNING
Error: package/namespace load failed for ?metaGSEA?
Call sequence:
2: stop(gettextf("package/namespace load failed for %s", sQuote(package)), 
      call. = FALSE, domain = NA)
1: library(package, lib.loc = lib.loc, character.only = TRUE, verbose = FALSE)
Execution halted
See section ?Generic functions and methods? of the ?Writing R
Extensions? manual.
* checking replacement functions ... WARNING
Error: package/namespace load failed for ?metaGSEA?
Call sequence:
2: stop(gettextf("package/namespace load failed for %s", sQuote(package)), 
      call. = FALSE, domain = NA)
1: library(package, lib.loc = lib.loc, character.only = TRUE, verbose = FALSE)
Execution halted
The argument of a replacement function which corresponds to the right
hand side must be named ?value?.
* checking foreign function calls ... WARNING
Error: package/namespace load failed for ?metaGSEA?
Call sequence:
2: stop(gettextf("package/namespace load failed for %s", sQuote(package)), 
      call. = FALSE, domain = NA)
1: library(package, lib.loc = lib.loc, character.only = TRUE, verbose = FALSE)
Execution halted

> sessionInfo()
R version 2.15.1 (2012-06-22)
Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)

locale:
[1] en_AU.UTF-8/en_AU.UTF-8/en_AU.UTF-8/C/en_AU.UTF-8/en_AU.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

From ripley at stats.ox.ac.uk  Sat Oct 20 16:50:41 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 20 Oct 2012 15:50:41 +0100 (BST)
Subject: [Rd] R-2.15.1 CMD CHECK output: "Call Sequence"
In-Reply-To: <F7EACB21-9D34-4F5B-87EA-D72597E96971@garvan.org.au>
References: <F7EACB21-9D34-4F5B-87EA-D72597E96971@garvan.org.au>
Message-ID: <alpine.LFD.2.02.1210201414120.11586@auk.stats.ox.ac.uk>

On Sat, 20 Oct 2012, Mark Cowley wrote:

> Hi guRus,

> i'm running R-2.15.1 and the R CMD CHECK output appears to have 
> changed substantially, in that instead of pointing me to the

Changed since when?   This has been the behaviour for years with the 
error quoted.

> offending functions or files, I get lots of 'call sequence' traces 
> as below.

It is an offending _package_, and it tells you which one in

> Error: package/namespace load failed for ?metaGSEA?

Package 'metaGSEA' seems not to be installed properly.  It also tells 
you that 'library' is involved, so it looks like it is a package load 
and not a namespace load.

You have not told us if ?metaGSEA? is the package under test or a 
dependent.  Given that in earlier 'check' output which you excised the 
loading of the package under test was checked, the latter looks more 
plausible.

> I've been using R CMD CHECK for years & never seen anything like 
> this before. This is on a pretty fresh OSX 10.8 Mountain Lion 
> installation, where I installed R from CRAN via pkg. Is this a 
> problem unique to me?

Maybe not, but unusual.  It is a lot harder to get a package installed 
non-functionally these days, but it can happen if it were installed 
with a different version or architecture, or if binary packages are 
involved.

>
> cheers,
> Mark
>
> heres' a snippet from testing one of my packages under development:
>
> * checking for unstated dependencies in R code ... WARNING
> Error: package/namespace load failed for ?metaGSEA?
> Call sequence:
> 2: stop(gettextf("package/namespace load failed for %s", sQuote(package)),
>      call. = FALSE, domain = NA)
> 1: library(package, lib.loc = lib.loc, character.only = TRUE, verbose = FALSE)
> Execution halted
> See the information on DESCRIPTION files in the chapter ?Creating R
> packages? of the ?Writing R Extensions? manual.
> * checking S3 generic/method consistency ... WARNING
> Error: package/namespace load failed for ?metaGSEA?
> Call sequence:
> 2: stop(gettextf("package/namespace load failed for %s", sQuote(package)),
>      call. = FALSE, domain = NA)
> 1: library(package, lib.loc = lib.loc, character.only = TRUE, verbose = FALSE)
> Execution halted
> See section ?Generic functions and methods? of the ?Writing R
> Extensions? manual.
> * checking replacement functions ... WARNING
> Error: package/namespace load failed for ?metaGSEA?
> Call sequence:
> 2: stop(gettextf("package/namespace load failed for %s", sQuote(package)),
>      call. = FALSE, domain = NA)
> 1: library(package, lib.loc = lib.loc, character.only = TRUE, verbose = FALSE)
> Execution halted
> The argument of a replacement function which corresponds to the right
> hand side must be named ?value?.
> * checking foreign function calls ... WARNING
> Error: package/namespace load failed for ?metaGSEA?
> Call sequence:
> 2: stop(gettextf("package/namespace load failed for %s", sQuote(package)),
>      call. = FALSE, domain = NA)
> 1: library(package, lib.loc = lib.loc, character.only = TRUE, verbose = FALSE)
> Execution halted
>
>> sessionInfo()
> R version 2.15.1 (2012-06-22)
> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
>
> locale:
> [1] en_AU.UTF-8/en_AU.UTF-8/en_AU.UTF-8/C/en_AU.UTF-8/en_AU.UTF-8
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ligges at statistik.tu-dortmund.de  Sat Oct 20 16:57:34 2012
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sat, 20 Oct 2012 16:57:34 +0200
Subject: [Rd] Rcmd_environ and R_LIBS_{USER,SITE}
In-Reply-To: <20609.52486.220382.619704@max.nulle.part>
References: <20606.51152.929307.770692@max.nulle.part>
	<k5odpj$kqp$1@ger.gmane.org>
	<20608.3682.541568.225279@max.nulle.part>
	<CAC2h7ut6Gm3Bz9h3qUhtpZ7iSs5qDFKinv3kiOfvZVKzb=N3vQ@mail.gmail.com>
	<20608.7608.577340.915403@max.nulle.part>
	<1350646766.3967.1.camel@prometheus.geog.ucl.ac.uk>
	<20609.21483.803720.948373@max.nulle.part>
	<50818D0E.8090104@statistik.tu-dortmund.de>
	<20609.52486.220382.619704@max.nulle.part>
Message-ID: <5082BBDE.70209@statistik.tu-dortmund.de>

Dirk,

if you are checking "foo", then "foo" is found in the examples (on all 
OSs), even if it is NOT installed at all!

Can you make the sources available for me?

Uwe







On 19.10.2012 23:58, Dirk Eddelbuettel wrote:
>
> Hi Uwe,
>
> On 19 October 2012 at 19:25, Uwe Ligges wrote:
> | Dirk,
> |
> | if you ask R to
> |
> | R CMD check foo_1.2-3.tar.gz
> |
> |
> | and the output is
> |
> | "no package called 'foo'"
> |
> | then something went wrong with your setup or your package.
>
> That is not what I said, or tried to say. My issue is that the _tests_ and
> _examples_ fail.
>
> | Can we have details?
>
> Sure -- See below.  Cut and pasted from an Emacs buffer on Windoze as
> evidenved by the U:\ directory at mingw id shown. Emacs has no role here, it
> also fails the same way in a normal DOS prompt.
>
>
> u:\R\src>R CMD check foo_0.2.2.tar.gz
> R CMD check foo_0.2.2.tar.gz
> * using log directory 'u:/R/src/foo.Rcheck'
> * using R version 2.15.1 (2012-06-22)
> * using platform: x86_64-pc-mingw32 (64-bit)
> * using session charset: ISO8859-1
> * checking for file 'foo/DESCRIPTION' ... OK
> * checking extension type ... Package
> * this is package 'foo' version '0.2.2'
> * checking package namespace information ... OK
> * checking package dependencies ... OK
> * checking if this is a source package ... OK
> * checking if there is a namespace ... OK
> * checking for executable files ... OK
> * checking whether package 'foo' can be installed ... [34s] OK
> * checking installed package size ... OK
> * checking package directory ... OK
> * checking for portable file names ... OK
> * checking DESCRIPTION meta-information ... OK
> * checking top-level files ... OK
> * checking index information ... OK
> * checking package subdirectories ... OK
> * checking R files for non-ASCII characters ... OK
> * checking R files for syntax errors ... OK
> * loading checks for arch 'i386'
> ** checking whether the package can be loaded ... OK
> ** checking whether the package can be loaded with stated dependencies ... OK
> ** checking whether the package can be unloaded cleanly ... OK
> ** checking whether the namespace can be loaded with stated dependencies
> ... OK
> ** checking whether the namespace can be unloaded cleanly ... OK
> * loading checks for arch 'x64'
> ** checking whether the package can be loaded ... OK
> ** checking whether the package can be loaded with stated dependencies ... OK
> ** checking whether the package can be unloaded cleanly ... OK
> ** checking whether the namespace can be loaded with stated dependencies
> ... OK
> ** checking whether the namespace can be unloaded cleanly ... OK
> * checking for unstated dependencies in R code ... OK
> * checking S3 generic/method consistency ... OK
> * checking replacement functions ... OK
> * checking foreign function calls ... OK
> * checking R code for possible problems ... OK
> * checking Rd files ... OK
> * checking Rd metadata ... OK
> * checking Rd cross-references ... OK
> * checking for missing documentation entries ... OK
> * checking for code/documentation mismatches ... OK
> * checking Rd \usage sections ... OK
> * checking Rd contents ... OK
> * checking for unstated dependencies in examples ... OK
> * checking contents of 'data' directory ... OK
> * checking data for non-ASCII characters ... OK
> * checking data for ASCII and uncompressed saves ... OK
> * checking line endings in C/C++/Fortran sources/headers ... OK
> * checking line endings in Makefiles ... OK
> * checking for portable compilation flags in Makevars ... OK
> * checking for portable use of $(BLAS_LIBS) and $(LAPACK_LIBS) ... OK
> * checking compiled code ... OK
> * checking examples ...
> ** running examples for arch 'i386' ... ERROR
> Running examples in 'foo-Ex.R' failed
> The error occurred in:
>
>
> R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
> Copyright (C) 2012 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
> Platform: i386-pc-mingw32/i386 (32-bit)
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
>
>    Natural language support but running in an English locale
>
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
>
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
>
>> pkgname <- "foo"
>> source(file.path(R.home("share"), "R", "examples-header.R"))
>> options(warn = 1)
>> options(pager = "console")
>> library('foo')
> Error in library("foo") : there is no package called 'foo'
> Execution halted
> ** running examples for arch 'x64' ... ERROR
> Running examples in 'foo-Ex.R' failed
> The error occurred in:
>
>
> R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
> Copyright (C) 2012 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
> Platform: x86_64-pc-mingw32/x64 (64-bit)
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
>
>    Natural language support but running in an English locale
>
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
>
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
>
>> pkgname <- "foo"
>> source(file.path(R.home("share"), "R", "examples-header.R"))
>> options(warn = 1)
>> options(pager = "console")
>> library('foo')
> Error in library("foo") : there is no package called 'foo'
> Execution halted
>
> u:\R\src>
>
> Needless to say the package __does__ of course exist, is installed and
> loadable:
>
>
> u:\R\src>R --no-save
> R --no-save
>
> R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
> Copyright (C) 2012 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
> Platform: x86_64-pc-mingw32/x64 (64-bit)
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
>
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
>
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
>
> R> library(foo)
> library(foo)
> Loading required package: Rcpp
> Loading required package: xts
> Loading required package: zoo
>
> Attaching package: 'zoo'
>
> The following object(s) are masked from 'package:base':
>
>      as.Date, as.Date.numeric
>
> R>
>
>
> [ foo is a placeholder here, the package has a different name which plays no
> role in the misbehaviour demonstrated above. ]
>
> Thanks for looking into this.
>
> Dirk
>
>
> | Best,
> | Uwe
> |
> |
> |
> |
> | On 19.10.2012 15:21, Dirk Eddelbuettel wrote:
> | >
> | > On 19 October 2012 at 12:39, Gavin Simpson wrote:
> | > | On Thu, 2012-10-18 at 10:18 -0500, Dirk Eddelbuettel wrote:
> | > | > Kasper,
> | > | >
> | > | > On 18 October 2012 at 10:41, Kasper Daniel Hansen wrote:
> | > | > | I set my user libraries in .Rprofile for this very reason.  I agree it
> | > | > | is weird that .Renviron is not always read etc.
> | > | >
> | > | > Sorry, no cigar either -- this equivalent to using files in $R_HOME/etc/ and
> | > | > is also ignored by R CMD check, which still fails in my setup as it doesn't
> | > | > find the package -- whereas any normal R session does.
> | > | >
> | > | > Dirk
> | > |
> | > | I have R_LIBS set in my Bash profile (~/.bashrc) for IIRC this very
> | > | reason. Can you do the same on Windows?
> | >
> | > Thanks for the suggestion, Gavin,  But well, let me count the ways ....
> | >
> | > i)   As a general principle, I prefer to minimize env variables. So on Linux,
> | >       I prefer (and use) ~/.Rprofile and/or ~/.Renviron, or even the site-wide
> | >       ones
> | >
> | > ii)  Similarly, I asked for site-wide config as that can be scripted.
> | >       Your solution, if it worked, would not (as easily) allow that.
> | >
> | > iii) The question was specific about the intentional castration of R CMD ...
> | >       I actually get the .libPaths() adjusted on Windows too via the method
> | >       mentioned in i)
> | >
> | > iv)  When I do what you helpfully suggest, .libPaths() in R shows the entry
> | >       twice yet the braindead R CMD check .... __still fails the same way__ not
> | >       being able to load the very package tested from the location that is __not
> | >       below__ the $R_HOME/library/ path.
> | >
> | > This really is silly beyond words, but seemingly all by design and intentional.
> | >
> | > Dirk
> | >
> | >
> | >
> | >
> | > |
> | > | G
> | > |
> | > | >
> | > | >
> | > | > |
> | > | > | Kasper
> | > | > |
> | > | > | On Thu, Oct 18, 2012 at 10:12 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
> | > | > | >
> | > | > | > Keith,
> | > | > | >
> | > | > | > On 18 October 2012 at 09:14, Keith Jewell wrote:
> | > | > | > | No reply in a number of hours, so here is a suggestion from ignorance :-}
> | > | > | > |
> | > | > | > | ?Startup refers to a number of other "site and user files to process for
> | > | > | >
> | > | > | > Thanks, and I know, and use those on Linux (and on 'doze when I use it).  My
> | > | > | > question was specifically about 'R CMD foo' which skips some of these by
> | > | > | > choice, and which Rcmd_environ appears to overcome, albeit imcompletely. I
> | > | > | > still have an issue on Windows where I cannot split my package installations
> | > | > | > between those that come and go with R installations, and the others.
> | > | > | >
> | > | > | > But it is truly bizarre that I can do (on Windows)
> | > | > | >
> | > | > | >   R CMD INSTALL foo_1.2-3.tar.gz
> | > | > | >
> | > | > | > and a moment later
> | > | > | >
> | > | > | >   R CMD check foo_1.2-3.tar.gz
> | > | > | >
> | > | > | > fails in its tests and examples with "no package called 'foo'"
> | > | > | >
> | > | > | > Doing 'R CMD check --no-examples --no-tests foo_1.2-3.tar.gz' works, but is
> | > | > | > less helpful as we're running the check to run those very tests...
> | > | > | >
> | > | > | > Dirk
> | > | > | >
> | > | > | >
> | > | > | > | setting environment variables" but not to Rcmd_environ. The contents of
> | > | > | > | $R_HOME/etc/Rcmd_environ seem to reflect (some of) the contents of
> | > | > | > | (some) other files.
> | > | > | > |
> | > | > | > | I have similar lines (defining library paths) in
> | > | > | > |      $R_HOME/etc/Renviron.site
> | > | > | > |
> | > | > | > | Is it correct to directly edit Rcmd_environ or should it be modified
> | > | > | > | only via other files? (A genuine question).
> | > | > | > |
> | > | > | > | On 17/10/2012 15:59, Dirk Eddelbuettel wrote:
> | > | > | > | >
> | > | > | > | > Is there a fundamental reason why I cannot set either one of
> | > | > | > | >
> | > | > | > | >    ## add local library path -- doesn't work either
> | > | > | > | >    R_LIBS_USER="c:/opt/R-library"
> | > | > | > | >    R_LIBS_SITE="c:/opt/R-library"
> | > | > | > | >
> | > | > | > | > in $R_HOME/etc/Rcmd_environ even though I can seemingly set other things here?
> | > | > | > | >
> | > | > | > | > It breaks "R CMD check" for me as I prefer NOT to install packages in a
> | > | > | > | > versioned path.
> | > | > | > | >
> | > | > | > | > FWIW, defaulting to a versioned path is (to this no-longer-bemused user) as
> | > | > | > | > much a permenent R bug (on Windoze) as the default installation into a path
> | > | > | > | > with spaces.
> | > | > | > | >
> | > | > | > | > Dirk
> | > | > | > | >
> | > | > | > |
> | > | > | > | ______________________________________________
> | > | > | > | R-devel at r-project.org mailing list
> | > | > | > | https://stat.ethz.ch/mailman/listinfo/r-devel
> | > | > | >
> | > | > | > --
> | > | > | > Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com
> | > | > | >
> | > | > | > ______________________________________________
> | > | > | > R-devel at r-project.org mailing list
> | > | > | > https://stat.ethz.ch/mailman/listinfo/r-devel
> | > | >
> | > |
> | > | --
> | > | %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> | > |  Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
> | > |  ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
> | > |  Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
> | > |  Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
> | > |  UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
> | > | %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> | > |
> | > |
> | >
>


From edd at debian.org  Sat Oct 20 17:52:36 2012
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sat, 20 Oct 2012 10:52:36 -0500
Subject: [Rd] Rcmd_environ and R_LIBS_{USER,SITE}
In-Reply-To: <5082BBDE.70209@statistik.tu-dortmund.de>
References: <20606.51152.929307.770692@max.nulle.part>
	<k5odpj$kqp$1@ger.gmane.org>
	<20608.3682.541568.225279@max.nulle.part>
	<CAC2h7ut6Gm3Bz9h3qUhtpZ7iSs5qDFKinv3kiOfvZVKzb=N3vQ@mail.gmail.com>
	<20608.7608.577340.915403@max.nulle.part>
	<1350646766.3967.1.camel@prometheus.geog.ucl.ac.uk>
	<20609.21483.803720.948373@max.nulle.part>
	<50818D0E.8090104@statistik.tu-dortmund.de>
	<20609.52486.220382.619704@max.nulle.part>
	<5082BBDE.70209@statistik.tu-dortmund.de>
Message-ID: <20610.51396.940734.395724@max.nulle.part>


Hi Uwe,

On 20 October 2012 at 16:57, Uwe Ligges wrote:
| Dirk,
| 
| if you are checking "foo", then "foo" is found in the examples (on all 
| OSs), even if it is NOT installed at all!

Well the log you asked me to supply very clearly shows otherwise.

All I doing is 

 i)  R itself in  c:\opt\R-current\     (currently 2.15.1)

 ii) packages in c:\opt\R-library\	(incl. the pkg in question)
 
| Can you make the sources available for me?

 a) It contains code from work code I cannot distribute.

 b) I will check next week about using a CRAN package. I suspect that, say,
    my small-ish digest package will fail the same way.

 c) Having authored what must be around two dozen packages of which around
    three quarters are actively maintained and on CRAN, I am reasonably
    confident that I did nothing "wrong" here.

 d) Once I add '--no-tests --no-examples' then R CMD check passes fine. So
    the package seems fine.

 e) No issues whatsoever on Linux. 

More on Monday or Tuesday. 

Thanks,  Dirk
 
| Uwe
| 
| 
| 
| 
| 
| 
| 
| On 19.10.2012 23:58, Dirk Eddelbuettel wrote:
| >
| > Hi Uwe,
| >
| > On 19 October 2012 at 19:25, Uwe Ligges wrote:
| > | Dirk,
| > |
| > | if you ask R to
| > |
| > | R CMD check foo_1.2-3.tar.gz
| > |
| > |
| > | and the output is
| > |
| > | "no package called 'foo'"
| > |
| > | then something went wrong with your setup or your package.
| >
| > That is not what I said, or tried to say. My issue is that the _tests_ and
| > _examples_ fail.
| >
| > | Can we have details?
| >
| > Sure -- See below.  Cut and pasted from an Emacs buffer on Windoze as
| > evidenved by the U:\ directory at mingw id shown. Emacs has no role here, it
| > also fails the same way in a normal DOS prompt.
| >
| >
| > u:\R\src>R CMD check foo_0.2.2.tar.gz
| > R CMD check foo_0.2.2.tar.gz
| > * using log directory 'u:/R/src/foo.Rcheck'
| > * using R version 2.15.1 (2012-06-22)
| > * using platform: x86_64-pc-mingw32 (64-bit)
| > * using session charset: ISO8859-1
| > * checking for file 'foo/DESCRIPTION' ... OK
| > * checking extension type ... Package
| > * this is package 'foo' version '0.2.2'
| > * checking package namespace information ... OK
| > * checking package dependencies ... OK
| > * checking if this is a source package ... OK
| > * checking if there is a namespace ... OK
| > * checking for executable files ... OK
| > * checking whether package 'foo' can be installed ... [34s] OK
| > * checking installed package size ... OK
| > * checking package directory ... OK
| > * checking for portable file names ... OK
| > * checking DESCRIPTION meta-information ... OK
| > * checking top-level files ... OK
| > * checking index information ... OK
| > * checking package subdirectories ... OK
| > * checking R files for non-ASCII characters ... OK
| > * checking R files for syntax errors ... OK
| > * loading checks for arch 'i386'
| > ** checking whether the package can be loaded ... OK
| > ** checking whether the package can be loaded with stated dependencies ... OK
| > ** checking whether the package can be unloaded cleanly ... OK
| > ** checking whether the namespace can be loaded with stated dependencies
| > ... OK
| > ** checking whether the namespace can be unloaded cleanly ... OK
| > * loading checks for arch 'x64'
| > ** checking whether the package can be loaded ... OK
| > ** checking whether the package can be loaded with stated dependencies ... OK
| > ** checking whether the package can be unloaded cleanly ... OK
| > ** checking whether the namespace can be loaded with stated dependencies
| > ... OK
| > ** checking whether the namespace can be unloaded cleanly ... OK
| > * checking for unstated dependencies in R code ... OK
| > * checking S3 generic/method consistency ... OK
| > * checking replacement functions ... OK
| > * checking foreign function calls ... OK
| > * checking R code for possible problems ... OK
| > * checking Rd files ... OK
| > * checking Rd metadata ... OK
| > * checking Rd cross-references ... OK
| > * checking for missing documentation entries ... OK
| > * checking for code/documentation mismatches ... OK
| > * checking Rd \usage sections ... OK
| > * checking Rd contents ... OK
| > * checking for unstated dependencies in examples ... OK
| > * checking contents of 'data' directory ... OK
| > * checking data for non-ASCII characters ... OK
| > * checking data for ASCII and uncompressed saves ... OK
| > * checking line endings in C/C++/Fortran sources/headers ... OK
| > * checking line endings in Makefiles ... OK
| > * checking for portable compilation flags in Makevars ... OK
| > * checking for portable use of $(BLAS_LIBS) and $(LAPACK_LIBS) ... OK
| > * checking compiled code ... OK
| > * checking examples ...
| > ** running examples for arch 'i386' ... ERROR
| > Running examples in 'foo-Ex.R' failed
| > The error occurred in:
| >
| >
| > R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
| > Copyright (C) 2012 The R Foundation for Statistical Computing
| > ISBN 3-900051-07-0
| > Platform: i386-pc-mingw32/i386 (32-bit)
| >
| > R is free software and comes with ABSOLUTELY NO WARRANTY.
| > You are welcome to redistribute it under certain conditions.
| > Type 'license()' or 'licence()' for distribution details.
| >
| >    Natural language support but running in an English locale
| >
| > R is a collaborative project with many contributors.
| > Type 'contributors()' for more information and
| > 'citation()' on how to cite R or R packages in publications.
| >
| > Type 'demo()' for some demos, 'help()' for on-line help, or
| > 'help.start()' for an HTML browser interface to help.
| > Type 'q()' to quit R.
| >
| >> pkgname <- "foo"
| >> source(file.path(R.home("share"), "R", "examples-header.R"))
| >> options(warn = 1)
| >> options(pager = "console")
| >> library('foo')
| > Error in library("foo") : there is no package called 'foo'
| > Execution halted
| > ** running examples for arch 'x64' ... ERROR
| > Running examples in 'foo-Ex.R' failed
| > The error occurred in:
| >
| >
| > R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
| > Copyright (C) 2012 The R Foundation for Statistical Computing
| > ISBN 3-900051-07-0
| > Platform: x86_64-pc-mingw32/x64 (64-bit)
| >
| > R is free software and comes with ABSOLUTELY NO WARRANTY.
| > You are welcome to redistribute it under certain conditions.
| > Type 'license()' or 'licence()' for distribution details.
| >
| >    Natural language support but running in an English locale
| >
| > R is a collaborative project with many contributors.
| > Type 'contributors()' for more information and
| > 'citation()' on how to cite R or R packages in publications.
| >
| > Type 'demo()' for some demos, 'help()' for on-line help, or
| > 'help.start()' for an HTML browser interface to help.
| > Type 'q()' to quit R.
| >
| >> pkgname <- "foo"
| >> source(file.path(R.home("share"), "R", "examples-header.R"))
| >> options(warn = 1)
| >> options(pager = "console")
| >> library('foo')
| > Error in library("foo") : there is no package called 'foo'
| > Execution halted
| >
| > u:\R\src>
| >
| > Needless to say the package __does__ of course exist, is installed and
| > loadable:
| >
| >
| > u:\R\src>R --no-save
| > R --no-save
| >
| > R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
| > Copyright (C) 2012 The R Foundation for Statistical Computing
| > ISBN 3-900051-07-0
| > Platform: x86_64-pc-mingw32/x64 (64-bit)
| >
| > R is free software and comes with ABSOLUTELY NO WARRANTY.
| > You are welcome to redistribute it under certain conditions.
| > Type 'license()' or 'licence()' for distribution details.
| >
| > R is a collaborative project with many contributors.
| > Type 'contributors()' for more information and
| > 'citation()' on how to cite R or R packages in publications.
| >
| > Type 'demo()' for some demos, 'help()' for on-line help, or
| > 'help.start()' for an HTML browser interface to help.
| > Type 'q()' to quit R.
| >
| > R> library(foo)
| > library(foo)
| > Loading required package: Rcpp
| > Loading required package: xts
| > Loading required package: zoo
| >
| > Attaching package: 'zoo'
| >
| > The following object(s) are masked from 'package:base':
| >
| >      as.Date, as.Date.numeric
| >
| > R>
| >
| >
| > [ foo is a placeholder here, the package has a different name which plays no
| > role in the misbehaviour demonstrated above. ]
| >
| > Thanks for looking into this.
| >
| > Dirk
| >
| >
| > | Best,
| > | Uwe
| > |
| > |
| > |
| > |
| > | On 19.10.2012 15:21, Dirk Eddelbuettel wrote:
| > | >
| > | > On 19 October 2012 at 12:39, Gavin Simpson wrote:
| > | > | On Thu, 2012-10-18 at 10:18 -0500, Dirk Eddelbuettel wrote:
| > | > | > Kasper,
| > | > | >
| > | > | > On 18 October 2012 at 10:41, Kasper Daniel Hansen wrote:
| > | > | > | I set my user libraries in .Rprofile for this very reason.  I agree it
| > | > | > | is weird that .Renviron is not always read etc.
| > | > | >
| > | > | > Sorry, no cigar either -- this equivalent to using files in $R_HOME/etc/ and
| > | > | > is also ignored by R CMD check, which still fails in my setup as it doesn't
| > | > | > find the package -- whereas any normal R session does.
| > | > | >
| > | > | > Dirk
| > | > |
| > | > | I have R_LIBS set in my Bash profile (~/.bashrc) for IIRC this very
| > | > | reason. Can you do the same on Windows?
| > | >
| > | > Thanks for the suggestion, Gavin,  But well, let me count the ways ....
| > | >
| > | > i)   As a general principle, I prefer to minimize env variables. So on Linux,
| > | >       I prefer (and use) ~/.Rprofile and/or ~/.Renviron, or even the site-wide
| > | >       ones
| > | >
| > | > ii)  Similarly, I asked for site-wide config as that can be scripted.
| > | >       Your solution, if it worked, would not (as easily) allow that.
| > | >
| > | > iii) The question was specific about the intentional castration of R CMD ...
| > | >       I actually get the .libPaths() adjusted on Windows too via the method
| > | >       mentioned in i)
| > | >
| > | > iv)  When I do what you helpfully suggest, .libPaths() in R shows the entry
| > | >       twice yet the braindead R CMD check .... __still fails the same way__ not
| > | >       being able to load the very package tested from the location that is __not
| > | >       below__ the $R_HOME/library/ path.
| > | >
| > | > This really is silly beyond words, but seemingly all by design and intentional.
| > | >
| > | > Dirk
| > | >
| > | >
| > | >
| > | >
| > | > |
| > | > | G
| > | > |
| > | > | >
| > | > | >
| > | > | > |
| > | > | > | Kasper
| > | > | > |
| > | > | > | On Thu, Oct 18, 2012 at 10:12 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
| > | > | > | >
| > | > | > | > Keith,
| > | > | > | >
| > | > | > | > On 18 October 2012 at 09:14, Keith Jewell wrote:
| > | > | > | > | No reply in a number of hours, so here is a suggestion from ignorance :-}
| > | > | > | > |
| > | > | > | > | ?Startup refers to a number of other "site and user files to process for
| > | > | > | >
| > | > | > | > Thanks, and I know, and use those on Linux (and on 'doze when I use it).  My
| > | > | > | > question was specifically about 'R CMD foo' which skips some of these by
| > | > | > | > choice, and which Rcmd_environ appears to overcome, albeit imcompletely. I
| > | > | > | > still have an issue on Windows where I cannot split my package installations
| > | > | > | > between those that come and go with R installations, and the others.
| > | > | > | >
| > | > | > | > But it is truly bizarre that I can do (on Windows)
| > | > | > | >
| > | > | > | >   R CMD INSTALL foo_1.2-3.tar.gz
| > | > | > | >
| > | > | > | > and a moment later
| > | > | > | >
| > | > | > | >   R CMD check foo_1.2-3.tar.gz
| > | > | > | >
| > | > | > | > fails in its tests and examples with "no package called 'foo'"
| > | > | > | >
| > | > | > | > Doing 'R CMD check --no-examples --no-tests foo_1.2-3.tar.gz' works, but is
| > | > | > | > less helpful as we're running the check to run those very tests...
| > | > | > | >
| > | > | > | > Dirk
| > | > | > | >
| > | > | > | >
| > | > | > | > | setting environment variables" but not to Rcmd_environ. The contents of
| > | > | > | > | $R_HOME/etc/Rcmd_environ seem to reflect (some of) the contents of
| > | > | > | > | (some) other files.
| > | > | > | > |
| > | > | > | > | I have similar lines (defining library paths) in
| > | > | > | > |      $R_HOME/etc/Renviron.site
| > | > | > | > |
| > | > | > | > | Is it correct to directly edit Rcmd_environ or should it be modified
| > | > | > | > | only via other files? (A genuine question).
| > | > | > | > |
| > | > | > | > | On 17/10/2012 15:59, Dirk Eddelbuettel wrote:
| > | > | > | > | >
| > | > | > | > | > Is there a fundamental reason why I cannot set either one of
| > | > | > | > | >
| > | > | > | > | >    ## add local library path -- doesn't work either
| > | > | > | > | >    R_LIBS_USER="c:/opt/R-library"
| > | > | > | > | >    R_LIBS_SITE="c:/opt/R-library"
| > | > | > | > | >
| > | > | > | > | > in $R_HOME/etc/Rcmd_environ even though I can seemingly set other things here?
| > | > | > | > | >
| > | > | > | > | > It breaks "R CMD check" for me as I prefer NOT to install packages in a
| > | > | > | > | > versioned path.
| > | > | > | > | >
| > | > | > | > | > FWIW, defaulting to a versioned path is (to this no-longer-bemused user) as
| > | > | > | > | > much a permenent R bug (on Windoze) as the default installation into a path
| > | > | > | > | > with spaces.
| > | > | > | > | >
| > | > | > | > | > Dirk
| > | > | > | > | >
| > | > | > | > |
| > | > | > | > | ______________________________________________
| > | > | > | > | R-devel at r-project.org mailing list
| > | > | > | > | https://stat.ethz.ch/mailman/listinfo/r-devel
| > | > | > | >
| > | > | > | > --
| > | > | > | > Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com
| > | > | > | >
| > | > | > | > ______________________________________________
| > | > | > | > R-devel at r-project.org mailing list
| > | > | > | > https://stat.ethz.ch/mailman/listinfo/r-devel
| > | > | >
| > | > |
| > | > | --
| > | > | %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
| > | > |  Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
| > | > |  ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
| > | > |  Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
| > | > |  Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
| > | > |  UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
| > | > | %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
| > | > |
| > | > |
| > | >
| >

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From maechler at stat.math.ethz.ch  Sat Oct 20 21:50:41 2012
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 20 Oct 2012 21:50:41 +0200
Subject: [Rd] Change in the RNG implementation?
In-Reply-To: <5081E1AF.8020308@gmail.com>
References: <5081DC6C.2010306@fhcrc.org>
	<5081E1AF.8020308@gmail.com>
Message-ID: <20611.145.516405.58517@stat.math.ethz.ch>

>>>>> Duncan Murdoch <murdoch.duncan at gmail.com>
>>>>>     on Fri, 19 Oct 2012 19:26:39 -0400 writes:

    > On 12-10-19 7:04 PM, Herv? Pag?s wrote:
    >> Hi,
    >> 
    >> Looks like the implementation of random number generation changed in
    >> R-devel with respect to R-2.15.1.
    >> 
    >> With R-2.15.1:
    >> 
    >> > set.seed(33)
    >> > sample(49821115, 10)
    >> [1] 22217252 19661919 24099911 45779422 42043111 25774933 21778053
    >> 17098516
    >> [9]   773073  5878451
    >> 
    >> With recent R-devel:
    >> 
    >> > set.seed(33)
    >> > sample(49821115, 10)
    >> [1] 22217252 19661919 24099912 45779425 42043115 25774935 21778056
    >> 17098518
    >> [9]   773073  5878452
    >> 
    >> This is on a 64-bit Ubuntu system.
    >> 
    >> Is this change intended? I didn't see anything in the NEWS file.
    >> 
    >> A potential problem with this is that it will break unit tests
    >> for algorithms that make use of RNG.
    >> 
    >> Another more practical problem (at least for me) is the following:
    >> Bioconductor package maintainers are sometimes working hard on the
    >> development version of their package to improve the performance of
    >> some key functions. Comparing performance between BioC release
    >> (based on R-2.15) and devel (based on R-devel) often requires big
    >> input data that is randomly generated, because it's easiest than
    >> working with real data. Typically a small script is written that
    >> takes care of loading the required packages, generating the input
    >> data, and running a simple analysis. The same script is sourced in
    >> R-2.15 and R-devel, and performance and results are compared.
    >> 
    >> Not being able to generate exactly the same input in the script is
    >> a problem. It can be worked around by generating the input once,
    >> serializing it, and use load() in the script, but that makes things
    >> more complicated and the script is not a standalone script anymore
    >> (cannot be passed around without also passing around the big .rda
    >> file).
    >> 
    >> Thanks,
    >> H.
    >> 

    > I think it was mentioned in the NEWS:

    > \code{sample.int()} has some support for  \eqn{n \ge
    > 2^{31}}{n >= 2^31}: see its help for the limitations.

    > A different algorithm is used for \code{(n, size, replace = FALSE,
    > prob = NULL)} for \code{n > 1e7} and \code{size <= n/2}.  This
    > is much faster and uses less memory, but does give different results.

So, to iterate : The  RNG  has not been changed at all,
but  sample() has, for extreme cases (large n) like yours.

    > I don't think the old algorithm is available, but perhaps it could be 
    > made available by an optional parameter.

I do think we should ideally add such an option or probably
rather allow the more thorough way of either using  
RNGversion(..) or something similar to set sample()'s behavior
to exactly as previously.
Doing "globally" is really needed, as sample() maybe called from a
function (from a function from a function) that is not in the
programmer's hand, and so the programmeR could not even
set the new optional argument if he found out that he had to.

Honestly, I'm surprised Herv? found a real case where the
difference is visible.

Martin


    > Duncan Murdoch


From m.cowley at garvan.org.au  Sun Oct 21 12:17:02 2012
From: m.cowley at garvan.org.au (Mark Cowley)
Date: Sun, 21 Oct 2012 21:17:02 +1100
Subject: [Rd] R-2.15.1 CMD CHECK output: "Call Sequence"
In-Reply-To: <alpine.LFD.2.02.1210201414120.11586@auk.stats.ox.ac.uk>
References: <F7EACB21-9D34-4F5B-87EA-D72597E96971@garvan.org.au>
	<alpine.LFD.2.02.1210201414120.11586@auk.stats.ox.ac.uk>
Message-ID: <B5A4F100-4DFE-47F0-AAB6-F7409E6B8C2C@garvan.org.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121021/7509599b/attachment.pl>

From bbolker at gmail.com  Sun Oct 21 21:28:03 2012
From: bbolker at gmail.com (Ben Bolker)
Date: Sun, 21 Oct 2012 15:28:03 -0400
Subject: [Rd] suppress *specific* warnings?
Message-ID: <50844CC3.6020302@ufl.edu>


  Not desperately important, but nice to have and possibly of use to
others, is the ability to suppress specific warnings rather than
suppressing warnings indiscriminately.  I often know of a specific
warning that I want to ignore (because I know that's it's a false
positive/ignorable), but the current design of suppressWarnings() forces
me to ignore *any* warnings coming from the expression.

  I started to write a new version that would check and, if supplied
with a regular expression, would only block matching warnings and
otherwise would produce the warnings as usual, but I don't quite know
enough about what I'm doing: see ??? in expression below.

  Can anyone help, or suggest pointers to relevant
examples/documentation (I've looked at demo(error.catching), which isn't
helping me ... ?)

suppressWarnings2 <- function(expr,regex=NULL) {
    opts <- options(warn = -1)
    on.exit(options(opts))
    withCallingHandlers(expr, warning = function(w) {
        ## browser()
        if (is.null(regex) || grepl(w[["message"]],regex)) {
            invokeRestart("muffleWarning")
        } else {
            ## ? what do I here to get the warning issued?
            ## browser()
            ## computeRestarts() shows "browser",
            ##    "muffleWarning", and "abort" ...
            options(opts)
            warning(w$message)
            ## how can I get back from here to the calling point
            ##   *without* muffling warnings ... ?
        }
    })
}

suppressWarnings2(sqrt(-1))
suppressWarnings2(sqrt(-1),"abc")

  It seems to me I'd like to have a restart option that just returns to
the point where the warning was caught, *without* muffling warnings ...
?  But I don't quite understand how to set one up ...

  Ben Bolker


From mtmorgan at fhcrc.org  Mon Oct 22 03:08:07 2012
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Sun, 21 Oct 2012 18:08:07 -0700
Subject: [Rd] suppress *specific* warnings?
In-Reply-To: <50844CC3.6020302@ufl.edu>
References: <50844CC3.6020302@ufl.edu>
Message-ID: <50849C77.6050106@fhcrc.org>

On 10/21/2012 12:28 PM, Ben Bolker wrote:
>
>    Not desperately important, but nice to have and possibly of use to
> others, is the ability to suppress specific warnings rather than
> suppressing warnings indiscriminately.  I often know of a specific
> warning that I want to ignore (because I know that's it's a false
> positive/ignorable), but the current design of suppressWarnings() forces
> me to ignore *any* warnings coming from the expression.
>
>    I started to write a new version that would check and, if supplied
> with a regular expression, would only block matching warnings and
> otherwise would produce the warnings as usual, but I don't quite know
> enough about what I'm doing: see ??? in expression below.
>
>    Can anyone help, or suggest pointers to relevant
> examples/documentation (I've looked at demo(error.catching), which isn't
> helping me ... ?)
>
> suppressWarnings2 <- function(expr,regex=NULL) {
>      opts <- options(warn = -1)
>      on.exit(options(opts))

I'm not really sure what the options(warn=-1) is doing there, maybe its for 
efficiency to avoid generating a warning message (as distinct from signalling a 
warning). I think you're after something like

   suppressWarnings2 <-
       function(expr, regex=character())
   {
       withCallingHandlers(expr, warning=function(w) {
           if (length(regex) == 1 && length(grep(regex, conditionMessage(w)))) {
               invokeRestart("muffleWarning")
           }
       })
   }

If the  restart isn't invoked, then the next handler is called and the warning 
is handled as normal. So with

   f <- function() {
       warning("oops")
       2
   }

there is

 > suppressWarnings2(f())
[1] 2
Warning message:
In f() : oops
 > suppressWarnings2(f(), "oops")
[1] 2

For your own code I think a better strategy is to create a sub-class of warnings 
that can be handled differently

   mywarn <-
       function(..., call.=TRUE, immediate.=FALSE, domain=NULL)
   {
       msg <- .makeMessage(..., domain=domain, appendLF=FALSE)
       call <- NULL
       if (call.)
           call <- sys.call(1L)
       class <- c("silencable", "simpleWarning",  "warning", "condition")
       cond <- structure(list(message=msg, call=call), class=class)
       warning(cond)
   }

   suppressWarnings3 <-
           function(expr)
   {
       withCallingHandlers(expr, silencable=function(w) {
           invokeRestart("muffleWarning")
       })
   }

then with

   g <- function() {
       mywarn("oops")
       3
   }

 > suppressWarnings3(f())
[1] 2
Warning message:
In f() : oops
 > g()
[1] 3
Warning message:
In g() : oops
 > suppressWarnings3(g())
[1] 3

>      withCallingHandlers(expr, warning = function(w) {
>          ## browser()
>          if (is.null(regex) || grepl(w[["message"]],regex)) {
>              invokeRestart("muffleWarning")
>          } else {
>              ## ? what do I here to get the warning issued?
>              ## browser()
>              ## computeRestarts() shows "browser",
>              ##    "muffleWarning", and "abort" ...
>              options(opts)
>              warning(w$message)
>              ## how can I get back from here to the calling point
>              ##   *without* muffling warnings ... ?
>          }
>      })
> }
>
> suppressWarnings2(sqrt(-1))
> suppressWarnings2(sqrt(-1),"abc")
>
>    It seems to me I'd like to have a restart option that just returns to
> the point where the warning was caught, *without* muffling warnings ...
> ?  But I don't quite understand how to set one up ...
>
>    Ben Bolker
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From bbolker at gmail.com  Mon Oct 22 03:25:45 2012
From: bbolker at gmail.com (Ben Bolker)
Date: Sun, 21 Oct 2012 21:25:45 -0400
Subject: [Rd] suppress *specific* warnings?
In-Reply-To: <50849C77.6050106@fhcrc.org>
References: <50844CC3.6020302@ufl.edu> <50849C77.6050106@fhcrc.org>
Message-ID: <5084A099.2020105@gmail.com>

On 12-10-21 09:08 PM, Martin Morgan wrote:
> On 10/21/2012 12:28 PM, Ben Bolker wrote:
>>
>>    Not desperately important, but nice to have and possibly of use to
>> others, is the ability to suppress specific warnings rather than
>> suppressing warnings indiscriminately.  I often know of a specific
>> warning that I want to ignore (because I know that's it's a false
>> positive/ignorable), but the current design of suppressWarnings() forces
>> me to ignore *any* warnings coming from the expression.
>>
>>    I started to write a new version that would check and, if supplied
>> with a regular expression, would only block matching warnings and
>> otherwise would produce the warnings as usual, but I don't quite know
>> enough about what I'm doing: see ??? in expression below.
>>
>>    Can anyone help, or suggest pointers to relevant
>> examples/documentation (I've looked at demo(error.catching), which isn't
>> helping me ... ?)
>>
>> suppressWarnings2 <- function(expr,regex=NULL) {
>>      opts <- options(warn = -1)
>>      on.exit(options(opts))
> 
> I'm not really sure what the options(warn=-1) is doing there, maybe its
> for efficiency to avoid generating a warning message (as distinct from
> signalling a warning).

  As may have been obvious, I was copying suppressWarnings() verbatim --
so I guess you'd have to ask R-core for the reasoning there ...

> I think you're after something like
> 
>   suppressWarnings2 <-
>       function(expr, regex=character())
>   {
>       withCallingHandlers(expr, warning=function(w) {
>           if (length(regex) == 1 && length(grep(regex,
> conditionMessage(w)))) {
>               invokeRestart("muffleWarning")
>           }
>       })
>   }
> 
> If the  restart isn't invoked, then the next handler is called and the
> warning is handled as normal. So with
> 
>   f <- function() {
>       warning("oops")
>       2
>   }
> 
> there is
> 
>> suppressWarnings2(f())
> [1] 2
> Warning message:
> In f() : oops
>> suppressWarnings2(f(), "oops")
> [1] 2

  Great, thank you!

> 
> For your own code I think a better strategy is to create a sub-class of
> warnings that can be handled differently
> 
>   mywarn <-
>       function(..., call.=TRUE, immediate.=FALSE, domain=NULL)
>   {
>       msg <- .makeMessage(..., domain=domain, appendLF=FALSE)
>       call <- NULL
>       if (call.)
>           call <- sys.call(1L)
>       class <- c("silencable", "simpleWarning",  "warning", "condition")
>       cond <- structure(list(message=msg, call=call), class=class)
>       warning(cond)
>   }
> 
>   suppressWarnings3 <-
>           function(expr)
>   {
>       withCallingHandlers(expr, silencable=function(w) {
>           invokeRestart("muffleWarning")
>       })
>   }
> 
> then with
> 
>   g <- function() {
>       mywarn("oops")
>       3
>   }
> 
>> suppressWarnings3(f())
> [1] 2
> Warning message:
> In f() : oops
>> g()
> [1] 3
> Warning message:
> In g() : oops
>> suppressWarnings3(g())
> [1] 3
> 
>>      withCallingHandlers(expr, warning = function(w) {
>>          ## browser()
>>          if (is.null(regex) || grepl(w[["message"]],regex)) {
>>              invokeRestart("muffleWarning")
>>          } else {
>>              ## ? what do I here to get the warning issued?
>>              ## browser()
>>              ## computeRestarts() shows "browser",
>>              ##    "muffleWarning", and "abort" ...
>>              options(opts)
>>              warning(w$message)
>>              ## how can I get back from here to the calling point
>>              ##   *without* muffling warnings ... ?
>>          }
>>      })
>> }
>>
>> suppressWarnings2(sqrt(-1))
>> suppressWarnings2(sqrt(-1),"abc")
>>
>>    It seems to me I'd like to have a restart option that just returns to
>> the point where the warning was caught, *without* muffling warnings ...
>> ?  But I don't quite understand how to set one up ...
>>
>>    Ben Bolker
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> 
>


From hpages at fhcrc.org  Mon Oct 22 08:02:50 2012
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Sun, 21 Oct 2012 23:02:50 -0700
Subject: [Rd] Change in the RNG implementation?
In-Reply-To: <20611.145.516405.58517@stat.math.ethz.ch>
References: <5081DC6C.2010306@fhcrc.org> <5081E1AF.8020308@gmail.com>
	<20611.145.516405.58517@stat.math.ethz.ch>
Message-ID: <5084E18A.2090901@fhcrc.org>

Hi Duncan, Martin,

Thanks for your answers.

For my real case I was generating millions of random positions
on a genome.

I compared sample.int() performance between R-2.15.1 and R-devel,
and, for me, it performs better in R-2.15.1 (almost 3x faster and
also uses slightly less memory):

With R-2.15.1:

   > set.seed(33)

   > system.time(random_chrom_pos <- sample(199000666L, 95000777L))
      user  system elapsed
     4.964   0.268   5.242

   > gc()
              used  (Mb) gc trigger   (Mb)  max used   (Mb)
   Ncells   137285   7.4     350000   18.7    350000   18.7
   Vcells 47633785 363.5  154735917 1180.6 147135703 1122.6

   > sessionInfo()
   R version 2.15.1 (2012-06-22)
   Platform: x86_64-unknown-linux-gnu (64-bit)

   locale:
    [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
    [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
    [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
    [7] LC_PAPER=C                 LC_NAME=C
    [9] LC_ADDRESS=C               LC_TELEPHONE=C
   [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

   attached base packages:
   [1] stats     graphics  grDevices utils     datasets  methods   base

With R-devel:

   > set.seed(33)

   > system.time(random_chrom_pos <- sample(199000666L, 95000777L))
      user  system elapsed
    14.532   0.296  14.854

   > gc()
              used  (Mb) gc trigger   (Mb)  max used   (Mb)
   Ncells   145525   7.8     350000   18.7    350000   18.7
   Vcells 47644082 363.5  152959996 1167.0 182023372 1388.8

   > sessionInfo()
   R Under development (unstable) (2012-10-02 r60861)
   Platform: x86_64-unknown-linux-gnu (64-bit)

   locale:
    [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
    [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
    [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
    [7] LC_PAPER=C                 LC_NAME=C
    [9] LC_ADDRESS=C               LC_TELEPHONE=C
   [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

   attached base packages:
   [1] stats     graphics  grDevices utils     datasets  methods   base

FWIW my R-2.15.1 and R-devel were configured with
--disable-byte-compiled-packages, otherwise, I use all the
defaults. Also my system is a standard Ubuntu 12.04 installation
with no fancy settings/tweakings/customizations.

Thanks,
H.


On 10/20/2012 12:50 PM, Martin Maechler wrote:
>>>>>> Duncan Murdoch <murdoch.duncan at gmail.com>
>>>>>>      on Fri, 19 Oct 2012 19:26:39 -0400 writes:
>
>      > On 12-10-19 7:04 PM, Herv? Pag?s wrote:
>      >> Hi,
>      >>
>      >> Looks like the implementation of random number generation changed in
>      >> R-devel with respect to R-2.15.1.
>      >>
>      >> With R-2.15.1:
>      >>
>      >> > set.seed(33)
>      >> > sample(49821115, 10)
>      >> [1] 22217252 19661919 24099911 45779422 42043111 25774933 21778053
>      >> 17098516
>      >> [9]   773073  5878451
>      >>
>      >> With recent R-devel:
>      >>
>      >> > set.seed(33)
>      >> > sample(49821115, 10)
>      >> [1] 22217252 19661919 24099912 45779425 42043115 25774935 21778056
>      >> 17098518
>      >> [9]   773073  5878452
>      >>
>      >> This is on a 64-bit Ubuntu system.
>      >>
>      >> Is this change intended? I didn't see anything in the NEWS file.
>      >>
>      >> A potential problem with this is that it will break unit tests
>      >> for algorithms that make use of RNG.
>      >>
>      >> Another more practical problem (at least for me) is the following:
>      >> Bioconductor package maintainers are sometimes working hard on the
>      >> development version of their package to improve the performance of
>      >> some key functions. Comparing performance between BioC release
>      >> (based on R-2.15) and devel (based on R-devel) often requires big
>      >> input data that is randomly generated, because it's easiest than
>      >> working with real data. Typically a small script is written that
>      >> takes care of loading the required packages, generating the input
>      >> data, and running a simple analysis. The same script is sourced in
>      >> R-2.15 and R-devel, and performance and results are compared.
>      >>
>      >> Not being able to generate exactly the same input in the script is
>      >> a problem. It can be worked around by generating the input once,
>      >> serializing it, and use load() in the script, but that makes things
>      >> more complicated and the script is not a standalone script anymore
>      >> (cannot be passed around without also passing around the big .rda
>      >> file).
>      >>
>      >> Thanks,
>      >> H.
>      >>
>
>      > I think it was mentioned in the NEWS:
>
>      > \code{sample.int()} has some support for  \eqn{n \ge
>      > 2^{31}}{n >= 2^31}: see its help for the limitations.
>
>      > A different algorithm is used for \code{(n, size, replace = FALSE,
>      > prob = NULL)} for \code{n > 1e7} and \code{size <= n/2}.  This
>      > is much faster and uses less memory, but does give different results.
>
> So, to iterate : The  RNG  has not been changed at all,
> but  sample() has, for extreme cases (large n) like yours.
>
>      > I don't think the old algorithm is available, but perhaps it could be
>      > made available by an optional parameter.
>
> I do think we should ideally add such an option or probably
> rather allow the more thorough way of either using
> RNGversion(..) or something similar to set sample()'s behavior
> to exactly as previously.
> Doing "globally" is really needed, as sample() maybe called from a
> function (from a function from a function) that is not in the
> programmer's hand, and so the programmeR could not even
> set the new optional argument if he found out that he had to.
>
> Honestly, I'm surprised Herv? found a real case where the
> difference is visible.




>
> Martin
>
>
>      > Duncan Murdoch
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From luke-tierney at uiowa.edu  Mon Oct 22 18:57:49 2012
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Mon, 22 Oct 2012 11:57:49 -0500
Subject: [Rd] suppress *specific* warnings?
In-Reply-To: <50849C77.6050106@fhcrc.org>
References: <50844CC3.6020302@ufl.edu> <50849C77.6050106@fhcrc.org>
Message-ID: <alpine.LFD.2.02.1210221153530.1869@nokomis.stat.uiowa.edu>

On Sun, 21 Oct 2012, Martin Morgan wrote:

> On 10/21/2012 12:28 PM, Ben Bolker wrote:
>>
>>    Not desperately important, but nice to have and possibly of use to
>> others, is the ability to suppress specific warnings rather than
>> suppressing warnings indiscriminately.  I often know of a specific
>> warning that I want to ignore (because I know that's it's a false
>> positive/ignorable), but the current design of suppressWarnings() forces
>> me to ignore *any* warnings coming from the expression.
>>
>>    I started to write a new version that would check and, if supplied
>> with a regular expression, would only block matching warnings and
>> otherwise would produce the warnings as usual, but I don't quite know
>> enough about what I'm doing: see ??? in expression below.
>>
>>    Can anyone help, or suggest pointers to relevant
>> examples/documentation (I've looked at demo(error.catching), which isn't
>> helping me ... ?)
>> 
>> suppressWarnings2 <- function(expr,regex=NULL) {
>>      opts <- options(warn = -1)
>>      on.exit(options(opts))
>
> I'm not really sure what the options(warn=-1) is doing there, maybe its for 
> efficiency to avoid generating a warning message (as distinct from signalling

The sources in srs/library/base/conditions.R have

suppressWarnings <- function(expr) {
     ops <- options(warn = -1) ## FIXME: temporary hack until R_tryEval
     on.exit(options(ops))     ## calls are removed from methods code
     withCallingHandlers(expr,
                         warning=function(w)
                             invokeRestart("muffleWarning"))
}

I uspect we have still not entirely eliminated R_tryEval in this context
but I'm not sure. Will check when I get a chance.

> a warning). I think you're after something like
>
>  suppressWarnings2 <-
>      function(expr, regex=character())
>  {
>      withCallingHandlers(expr, warning=function(w) {
>          if (length(regex) == 1 && length(grep(regex, conditionMessage(w)))) 
> {
>              invokeRestart("muffleWarning")
>          }
>      })
>  }

A problem with using expression matching is of course that this fails
with internationalized messages. Ideally warnings should be signaled as
warning conditions of a particular class, and that class can be used
to discriminate. Unfortunately very few warnings are designed this way.

Best,

luke

>
> If the  restart isn't invoked, then the next handler is called and the 
> warning is handled as normal. So with
>
>  f <- function() {
>      warning("oops")
>      2
>  }
>
> there is
>
>> suppressWarnings2(f())
> [1] 2
> Warning message:
> In f() : oops
>> suppressWarnings2(f(), "oops")
> [1] 2
>
> For your own code I think a better strategy is to create a sub-class of 
> warnings that can be handled differently
>
>  mywarn <-
>      function(..., call.=TRUE, immediate.=FALSE, domain=NULL)
>  {
>      msg <- .makeMessage(..., domain=domain, appendLF=FALSE)
>      call <- NULL
>      if (call.)
>          call <- sys.call(1L)
>      class <- c("silencable", "simpleWarning",  "warning", "condition")
>      cond <- structure(list(message=msg, call=call), class=class)
>      warning(cond)
>  }
>
>  suppressWarnings3 <-
>          function(expr)
>  {
>      withCallingHandlers(expr, silencable=function(w) {
>          invokeRestart("muffleWarning")
>      })
>  }
>
> then with
>
>  g <- function() {
>      mywarn("oops")
>      3
>  }
>
>> suppressWarnings3(f())
> [1] 2
> Warning message:
> In f() : oops
>> g()
> [1] 3
> Warning message:
> In g() : oops
>> suppressWarnings3(g())
> [1] 3
>
>>      withCallingHandlers(expr, warning = function(w) {
>>          ## browser()
>>          if (is.null(regex) || grepl(w[["message"]],regex)) {
>>              invokeRestart("muffleWarning")
>>          } else {
>>              ## ? what do I here to get the warning issued?
>>              ## browser()
>>              ## computeRestarts() shows "browser",
>>              ##    "muffleWarning", and "abort" ...
>>              options(opts)
>>              warning(w$message)
>>              ## how can I get back from here to the calling point
>>              ##   *without* muffling warnings ... ?
>>          }
>>      })
>> }
>> 
>> suppressWarnings2(sqrt(-1))
>> suppressWarnings2(sqrt(-1),"abc")
>>
>>    It seems to me I'd like to have a restart option that just returns to
>> the point where the warning was caught, *without* muffling warnings ...
>> ?  But I don't quite understand how to set one up ...
>>
>>    Ben Bolker
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>
>
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From joseph.barry at embl.de  Tue Oct 23 13:10:03 2012
From: joseph.barry at embl.de (Joseph Barry)
Date: Tue, 23 Oct 2012 13:10:03 +0200
Subject: [Rd] 12-bit functionality in tiff package
Message-ID: <BFACF534-500B-448A-B4AC-B26F51519F64@embl.de>

Hi,

We have recently been using the tiff package for reading tiff images into the Bioconductor Package EBImage. This has been extremely helpful in conjunction with other steps to eliminate dependencies on ImageMagick.

However, it seems that 12-bit images are not supported. We were wondering if there are plans to extend the functionality of the readTIFF() function in the tiff package to accommodate 12-bit images?

Best wishes,

Joseph Barry
(EMBL Heidelberg, Germany)

From mtmorgan at fhcrc.org  Tue Oct 23 14:28:48 2012
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Tue, 23 Oct 2012 05:28:48 -0700
Subject: [Rd] suppress *specific* warnings?
In-Reply-To: <alpine.LFD.2.02.1210221153530.1869@nokomis.stat.uiowa.edu>
References: <50844CC3.6020302@ufl.edu> <50849C77.6050106@fhcrc.org>
	<alpine.LFD.2.02.1210221153530.1869@nokomis.stat.uiowa.edu>
Message-ID: <50868D80.10308@fhcrc.org>

On 10/22/2012 09:57 AM, luke-tierney at uiowa.edu wrote:
> On Sun, 21 Oct 2012, Martin Morgan wrote:
>
>> On 10/21/2012 12:28 PM, Ben Bolker wrote:
>>>
>>>    Not desperately important, but nice to have and possibly of use to
>>> others, is the ability to suppress specific warnings rather than
>>> suppressing warnings indiscriminately.  I often know of a specific
>>> warning that I want to ignore (because I know that's it's a false
>>> positive/ignorable), but the current design of suppressWarnings() forces
>>> me to ignore *any* warnings coming from the expression.
>>>
>>>    I started to write a new version that would check and, if supplied
>>> with a regular expression, would only block matching warnings and
>>> otherwise would produce the warnings as usual, but I don't quite know
>>> enough about what I'm doing: see ??? in expression below.
>>>
>>>    Can anyone help, or suggest pointers to relevant
>>> examples/documentation (I've looked at demo(error.catching), which isn't
>>> helping me ... ?)
>>>
>>> suppressWarnings2 <- function(expr,regex=NULL) {
>>>      opts <- options(warn = -1)
>>>      on.exit(options(opts))
>>
>> I'm not really sure what the options(warn=-1) is doing there, maybe its for
>> efficiency to avoid generating a warning message (as distinct from signalling
>
> The sources in srs/library/base/conditions.R have
>
> suppressWarnings <- function(expr) {
>      ops <- options(warn = -1) ## FIXME: temporary hack until R_tryEval
>      on.exit(options(ops))     ## calls are removed from methods code
>      withCallingHandlers(expr,
>                          warning=function(w)
>                              invokeRestart("muffleWarning"))
> }
>
> I uspect we have still not entirely eliminated R_tryEval in this context
> but I'm not sure. Will check when I get a chance.
>
>> a warning). I think you're after something like
>>
>>  suppressWarnings2 <-
>>      function(expr, regex=character())
>>  {
>>      withCallingHandlers(expr, warning=function(w) {
>>          if (length(regex) == 1 && length(grep(regex, conditionMessage(w)))) {
>>              invokeRestart("muffleWarning")
>>          }
>>      })
>>  }
>
> A problem with using expression matching is of course that this fails
> with internationalized messages. Ideally warnings should be signaled as
> warning conditions of a particular class, and that class can be used
> to discriminate. Unfortunately very few warnings are designed this way.

Probably specific messages, rather than patterns, would be handled and then

   suppressWarnings2 <- function(expr, messages = character())
   {
       opts <- options(warn = -1)
       on.exit(options(ops))
       withCallingHandlers(expr, warning=function(w) {
           if (conditionMessage(w) %in% messages)
               invokeRestart("muffleWarning")
       })
   }

gives one the illusion of speaking many languages

   suppressWarnings2(log(-1), gettext("NaNs introduced", domain="R"))

Martin

>
> Best,
>
> luke
>
>>
>> If the  restart isn't invoked, then the next handler is called and the warning
>> is handled as normal. So with
>>
>>  f <- function() {
>>      warning("oops")
>>      2
>>  }
>>
>> there is
>>
>>> suppressWarnings2(f())
>> [1] 2
>> Warning message:
>> In f() : oops
>>> suppressWarnings2(f(), "oops")
>> [1] 2
>>
>> For your own code I think a better strategy is to create a sub-class of
>> warnings that can be handled differently
>>
>>  mywarn <-
>>      function(..., call.=TRUE, immediate.=FALSE, domain=NULL)
>>  {
>>      msg <- .makeMessage(..., domain=domain, appendLF=FALSE)
>>      call <- NULL
>>      if (call.)
>>          call <- sys.call(1L)
>>      class <- c("silencable", "simpleWarning",  "warning", "condition")
>>      cond <- structure(list(message=msg, call=call), class=class)
>>      warning(cond)
>>  }
>>
>>  suppressWarnings3 <-
>>          function(expr)
>>  {
>>      withCallingHandlers(expr, silencable=function(w) {
>>          invokeRestart("muffleWarning")
>>      })
>>  }
>>
>> then with
>>
>>  g <- function() {
>>      mywarn("oops")
>>      3
>>  }
>>
>>> suppressWarnings3(f())
>> [1] 2
>> Warning message:
>> In f() : oops
>>> g()
>> [1] 3
>> Warning message:
>> In g() : oops
>>> suppressWarnings3(g())
>> [1] 3
>>
>>>      withCallingHandlers(expr, warning = function(w) {
>>>          ## browser()
>>>          if (is.null(regex) || grepl(w[["message"]],regex)) {
>>>              invokeRestart("muffleWarning")
>>>          } else {
>>>              ## ? what do I here to get the warning issued?
>>>              ## browser()
>>>              ## computeRestarts() shows "browser",
>>>              ##    "muffleWarning", and "abort" ...
>>>              options(opts)
>>>              warning(w$message)
>>>              ## how can I get back from here to the calling point
>>>              ##   *without* muffling warnings ... ?
>>>          }
>>>      })
>>> }
>>>
>>> suppressWarnings2(sqrt(-1))
>>> suppressWarnings2(sqrt(-1),"abc")
>>>
>>>    It seems to me I'd like to have a restart option that just returns to
>>> the point where the warning was caught, *without* muffling warnings ...
>>> ?  But I don't quite understand how to set one up ...
>>>
>>>    Ben Bolker
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>>
>


-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From smz.yij at gmail.com  Tue Oct 23 19:58:29 2012
From: smz.yij at gmail.com (smzyij)
Date: Tue, 23 Oct 2012 10:58:29 -0700 (PDT)
Subject: [Rd] R CMD SHLIB error bad value (core2) for -mtune= switch
In-Reply-To: <50789295.5020905@stats.ox.ac.uk>
References: <1349996161811-4645928.post@n4.nabble.com>
	<50789295.5020905@stats.ox.ac.uk>
Message-ID: <1351015109937-4647182.post@n4.nabble.com>

Thank you so much Prof Ripley.

You are right. So instead of using Windows R, I tried to compile binary R
under Cygwin, but it errored out everytime at different places when I tried
different options to configure. So I guess I need to seek other alternate
ways.

Is there any chance you think that I could find Windows C/C++ compilers
(rather than Cygwin compilers) to compile the codes I mentioned that's
written in conjuction with Linux R/C/C++, and then run the codes under
Windows R? Or the only way out here is to spin up a linux machine to have R
installed?

Thanks,

Yi



--
View this message in context: http://r.789695.n4.nabble.com/R-CMD-SHLIB-error-bad-value-core2-for-mtune-switch-tp4645928p4647182.html
Sent from the R devel mailing list archive at Nabble.com.


From lgautier at gmail.com  Tue Oct 23 21:20:05 2012
From: lgautier at gmail.com (Laurent Gautier)
Date: Tue, 23 Oct 2012 21:20:05 +0200
Subject: [Rd] Spurious warning when calling data() ?
Message-ID: <5086EDE5.1000401@gmail.com>

Hi,

When calling data, a warning seems to have been left behind

> data(package="stats", verbose=FALSE)
Warning message:
In data(package = "stats", verbose = FALSE) :
   datasets have been moved from package 'stats' to package 'datasets'

(full version details further below).

Best,

Laurent

> sessionInfo()

R version 2.15.1 Patched (2012-08-24 r60412)

Platform: x86_64-unknown-linux-gnu (64-bit)

locale:

  [1] LC_CTYPE=en_DK.UTF-8       LC_NUMERIC=C

  [3] LC_TIME=en_DK.UTF-8        LC_COLLATE=en_DK.UTF-8

  [5] LC_MONETARY=en_DK.UTF-8    LC_MESSAGES=en_DK.UTF-8

  [7] LC_PAPER=C                 LC_NAME=C

  [9] LC_ADDRESS=C               LC_TELEPHONE=C

[11] LC_MEASUREMENT=en_DK.UTF-8 LC_IDENTIFICATION=C

attached base packages:

[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):

[1] tools_2.15.1

>


From murdoch.duncan at gmail.com  Tue Oct 23 21:43:02 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 23 Oct 2012 15:43:02 -0400
Subject: [Rd] Spurious warning when calling data() ?
In-Reply-To: <5086EDE5.1000401@gmail.com>
References: <5086EDE5.1000401@gmail.com>
Message-ID: <5086F346.5030409@gmail.com>

On 23/10/2012 3:20 PM, Laurent Gautier wrote:
> Hi,
>
> When calling data, a warning seems to have been left behind
>
> > data(package="stats", verbose=FALSE)
> Warning message:
> In data(package = "stats", verbose = FALSE) :
>     datasets have been moved from package 'stats' to package 'datasets'

What is spurious about that warning?  It's still as true now as it was 
when the move happened several years ago.

Duncan Murdoch

>
> (full version details further below).
>
> Best,
>
> Laurent
>
> > sessionInfo()
>
> R version 2.15.1 Patched (2012-08-24 r60412)
>
> Platform: x86_64-unknown-linux-gnu (64-bit)
>
> locale:
>
>    [1] LC_CTYPE=en_DK.UTF-8       LC_NUMERIC=C
>
>    [3] LC_TIME=en_DK.UTF-8        LC_COLLATE=en_DK.UTF-8
>
>    [5] LC_MONETARY=en_DK.UTF-8    LC_MESSAGES=en_DK.UTF-8
>
>    [7] LC_PAPER=C                 LC_NAME=C
>
>    [9] LC_ADDRESS=C               LC_TELEPHONE=C
>
> [11] LC_MEASUREMENT=en_DK.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
>
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> loaded via a namespace (and not attached):
>
> [1] tools_2.15.1
>
> >
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From lgautier at gmail.com  Tue Oct 23 21:46:36 2012
From: lgautier at gmail.com (Laurent Gautier)
Date: Tue, 23 Oct 2012 21:46:36 +0200
Subject: [Rd] Spurious warning when calling data() ?
In-Reply-To: <5086F346.5030409@gmail.com>
References: <5086EDE5.1000401@gmail.com> <5086F346.5030409@gmail.com>
Message-ID: <5086F41C.9010703@gmail.com>

On 2012-10-23 21:43, Duncan Murdoch wrote:
> On 23/10/2012 3:20 PM, Laurent Gautier wrote:
>> Hi,
>>
>> When calling data, a warning seems to have been left behind
>>
>> > data(package="stats", verbose=FALSE)
>> Warning message:
>> In data(package = "stats", verbose = FALSE) :
>>     datasets have been moved from package 'stats' to package 'datasets'
>
> What is spurious about that warning?  It's still as true now as it was 
> when the move happened several years ago.

Beside the possible debate that a note about the moving might have more 
its place in release notes or documentation than in a warning message, 
shouldn't this disappear after one or may be two releases ?


>
> Duncan Murdoch
>
>>
>> (full version details further below).
>>
>> Best,
>>
>> Laurent
>>
>> > sessionInfo()
>>
>> R version 2.15.1 Patched (2012-08-24 r60412)
>>
>> Platform: x86_64-unknown-linux-gnu (64-bit)
>>
>> locale:
>>
>>    [1] LC_CTYPE=en_DK.UTF-8       LC_NUMERIC=C
>>
>>    [3] LC_TIME=en_DK.UTF-8        LC_COLLATE=en_DK.UTF-8
>>
>>    [5] LC_MONETARY=en_DK.UTF-8    LC_MESSAGES=en_DK.UTF-8
>>
>>    [7] LC_PAPER=C                 LC_NAME=C
>>
>>    [9] LC_ADDRESS=C               LC_TELEPHONE=C
>>
>> [11] LC_MEASUREMENT=en_DK.UTF-8 LC_IDENTIFICATION=C
>>
>> attached base packages:
>>
>> [1] stats     graphics  grDevices utils     datasets  methods base
>>
>> loaded via a namespace (and not attached):
>>
>> [1] tools_2.15.1
>>
>> >
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Tue Oct 23 22:08:51 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 23 Oct 2012 21:08:51 +0100
Subject: [Rd] Spurious warning when calling data() ?
In-Reply-To: <5086EDE5.1000401@gmail.com>
References: <5086EDE5.1000401@gmail.com>
Message-ID: <5086F953.7060604@stats.ox.ac.uk>

On 23/10/2012 20:20, Laurent Gautier wrote:
> Hi,
>
> When calling data, a warning seems to have been left behind
>
>> data(package="stats", verbose=FALSE)
> Warning message:
> In data(package = "stats", verbose = FALSE) :
>    datasets have been moved from package 'stats' to package 'datasets'

Why do you think that is not an intentional warning for people who are 
using very old documentation?


>
> (full version details further below).
>
> Best,
>
> Laurent
>
>> sessionInfo()
>
> R version 2.15.1 Patched (2012-08-24 r60412)
>
> Platform: x86_64-unknown-linux-gnu (64-bit)
>
> locale:
>
>   [1] LC_CTYPE=en_DK.UTF-8       LC_NUMERIC=C
>
>   [3] LC_TIME=en_DK.UTF-8        LC_COLLATE=en_DK.UTF-8
>
>   [5] LC_MONETARY=en_DK.UTF-8    LC_MESSAGES=en_DK.UTF-8
>
>   [7] LC_PAPER=C                 LC_NAME=C
>
>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
>
> [11] LC_MEASUREMENT=en_DK.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
>
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> loaded via a namespace (and not attached):
>
> [1] tools_2.15.1
>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bbolker at gmail.com  Tue Oct 23 23:10:18 2012
From: bbolker at gmail.com (Ben Bolker)
Date: Tue, 23 Oct 2012 21:10:18 +0000
Subject: [Rd] 12-bit functionality in tiff package
References: <BFACF534-500B-448A-B4AC-B26F51519F64@embl.de>
Message-ID: <loom.20121023T230928-12@post.gmane.org>

Joseph Barry <joseph.barry <at> embl.de> writes:


> We have recently been using the tiff package for reading tiff images
> into the Bioconductor Package EBImage. This has been extremely
> helpful in conjunction with other steps to eliminate dependencies on
> ImageMagick.
 
> However, it seems that 12-bit images are not supported. We were
> wondering if there are plans to extend the functionality of the
> readTIFF() function in the tiff package to accommodate 12-bit
> images?

  It would probably be more efficient to query the package maintainer,
which according to 
http://cran.r-project.org/web/packages/rtiff/

is

 	Eric Kort <eric.kort at vai.org>


From joseph.barry at embl.de  Tue Oct 23 23:26:35 2012
From: joseph.barry at embl.de (Joseph Barry)
Date: Tue, 23 Oct 2012 23:26:35 +0200
Subject: [Rd] 12-bit functionality in tiff package
In-Reply-To: <loom.20121023T230928-12@post.gmane.org>
References: <BFACF534-500B-448A-B4AC-B26F51519F64@embl.de>
	<loom.20121023T230928-12@post.gmane.org>
Message-ID: <093D94B8-7AE1-4541-AF5C-D7549C491C3B@embl.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121023/041525c7/attachment.pl>

From hpages at fhcrc.org  Wed Oct 24 00:33:48 2012
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 23 Oct 2012 15:33:48 -0700
Subject: [Rd] Typos/omissions/inconsistencies in man page for clusterApply
Message-ID: <50871B4C.50205@fhcrc.org>

Hi,

Here are the issues I found:

Typos
-----

   (a) Found: It a parallel version of ?evalq?,

"is" missing.

   (b) Found: 'parLapplyLB', 'parSapplyLB' are load-balancing versions,
       intended for use when applying ?FUN? to

'parLapplyLB' has no 'FUN' arg (more on this below).

   (c) Found: 'clusterApply' calls 'fun' on the first node with arguments
       'seq[[1]]' and

'clusterApply' has no 'seq' arg.

There are a few other occurences of mistake (c) in the \details
and \value section, for clusterApply() and clusterApplyLB().

Omissions
---------

   o X: A vector (atomic or list) for ?parLapply? and ?parSapply?, an
        array for ?parApply?.

     ==> Nothing is said for the 'X' argument of parLapplyLB()
         and parSapplyLB().

Inconsistencies
---------------

The only function in that man page with a 'seq' argument is
clusterSplit(), which is a questionable choice since split() (and
strsplit()) use 'x'. Choosing 'seq' is also inconsistent with all
the other cluster* and par* functions in that man page which use
either 'x' or 'X'. Unless this 'seq' argument is different in nature
but it doesn't seem so.

Also any reason why the argument receiving the function is sometimes
named 'fun' (parLapply), and sometimes 'FUN' (parSapply)? Especially
since the \note section says:

      Two exceptions: ?parLapply? has argument ?X? not ?x? for
      consistency with ?lapply?, and ?parSapply? has been updated to
      match ?sapply?.

Well done for parSapply:

   > args(parSapply)
   function (cl = NULL, X, FUN, ..., simplify = TRUE, USE.NAMES = TRUE)
   NULL
   > args(sapply)
   function (X, FUN, ..., simplify = TRUE, USE.NAMES = TRUE)
   NULL

Not so well for parLapply (parLapply not consistent anymore with
snow:::parLapply but still not consistent with lapply):

   > args(lapply)
   function (X, FUN, ...)
   NULL
   > args(parLapply)
   function (cl = NULL, X, fun, ...)
   NULL
   > args(snow::parLapply)
   function (cl, x, fun, ...)
   NULL

Same kind of problem with clusterMap (departing from snow::clusterMap
but not fully embracing naming convention used by mapply):

   > args(mapply)
   function (FUN, ..., MoreArgs = NULL, SIMPLIFY = TRUE, USE.NAMES = TRUE)
   NULL
   > args(clusterMap)
   function (cl = NULL, fun, ..., MoreArgs = NULL, RECYCLE = TRUE,
       SIMPLIFY = FALSE, USE.NAMES = TRUE, .scheduling = c("static",
           "dynamic"))
   NULL
   > args(snow::clusterMap)
   function (cl, fun, ..., MoreArgs = NULL, RECYCLE = TRUE)
   NULL

Same problem with parRapply and parCapply and the naming of the x/X
argument:

   > args(apply)
   function (X, MARGIN, FUN, ...)
   NULL
   > args(parApply)
   function (cl = NULL, X, MARGIN, FUN, ...)
   NULL
   > args(parRapply)
   function (cl = NULL, x, FUN, ...)
   NULL
   > args(parCapply)
   function (cl = NULL, x, FUN, ...)
   NULL

Note that the naming of the arguments is not consistent with
snow::parRapply and snow::parCapply either:

   > args(snow::parRapply)
   function (cl, x, fun, ...)
   NULL
   > args(snow::parCapply)
   function (cl, x, fun, ...)
   NULL

and this exception (and maybe others) are not mentioned in the \note
section.

Overall it feels like the API for the 14 functions documented in this
man page could be a little bit cleaner.

Thanks,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From dwinsemius at comcast.net  Wed Oct 24 03:21:03 2012
From: dwinsemius at comcast.net (David Winsemius)
Date: Tue, 23 Oct 2012 18:21:03 -0700
Subject: [Rd] R CMD SHLIB error bad value (core2) for -mtune= switch
In-Reply-To: <1351015109937-4647182.post@n4.nabble.com>
References: <1349996161811-4645928.post@n4.nabble.com>
	<50789295.5020905@stats.ox.ac.uk>
	<1351015109937-4647182.post@n4.nabble.com>
Message-ID: <38EB87B9-8458-4587-A592-2AF275CE5A6E@comcast.net>


On Oct 23, 2012, at 10:58 AM, smzyij wrote:

> Thank you so much Prof Ripley.
> 
> You are right. So instead of using Windows R, I tried to compile binary R
> under Cygwin, but it errored out everytime at different places when I tried
> different options to configure. So I guess I need to seek other alternate
> ways.
> 
> Is there any chance you think that I could find Windows C/C++ compilers
> (rather than Cygwin compilers) to compile the codes I mentioned that's
> written in conjuction with Linux R/C/C++, and then run the codes under
> Windows R? Or the only way out here is to spin up a linux machine to have R
> installed?
> 

http://cran.r-project.org/bin/windows/base/rw-FAQ.html#Building-from-Source
http://cran.r-project.org/doc/manuals/R-admin.html
http://cran.r-project.org/doc/manuals/R-admin.html#Getting-the-tools
http://cran.r-project.org/doc/manuals/R-admin.html#The-Windows-toolset

> 
> --
> View this message in context: http://r.789695.n4.nabble.com/R-CMD-SHLIB-error-bad-value-core2-for-mtune-switch-tp4645928p4647182.html
> Sent from the R devel mailing list archive at Nabble.com.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
David Winsemius, MD
Alameda, CA, USA


From r.d.morey at rug.nl  Wed Oct 24 20:13:21 2012
From: r.d.morey at rug.nl (Richard D. Morey)
Date: Wed, 24 Oct 2012 20:13:21 +0200
Subject: [Rd] concurrent requests (Rook,
	but I think the question is more general)
Message-ID: <50882FC1.40608@rug.nl>

This question involves Rook, but I think the answer will be general 
enough that it pays to post here. At any rate, I don't know enough to 
know whether this is a Rook only issue or a general R issue.

Here's what I'd like to do (and indeed, have code that should do this):

1. Start R, Rook
2. Start an analysis via a HTTP request to Rook. This analysis uses 
.Call() to some compiled C code, if that matters. The C code calls a 
callback function to update a variable with its progress.
3. While the analysis is happening, use Rook to obtain current status 
with an HTTP request

The problem is that once the analysis starts, Rook does not respond to 
requests. All of the status requests to Rook pile up, and then are 
answered when the analysis (step 2) is done. Here is some example code 
to demonstrate what the issue:

##########

library(Rook)
s <- Rhttpd$new()
s$add(
   name="pingpong",
   app=Rook::URLMap$new(
     '/ping' = function(env){
       req <- Rook::Request$new(env)
       res <- Rook::Response$new()
       res$write('This is ping.')
       Sys.sleep(20)
       res$finish()
     },
     '/pong' = function(env){
       req <- Rook::Request$new(env)
       res <- Rook::Response$new()
       res$write("This is pong.")
       res$finish()
     },
     '/?' = function(env){
       req <- Rook::Request$new(env)
       res <- Rook::Response$new()
       res$redirect(req$to_url('/pong'))
       res$finish()
     }
   )
)

s$start(quiet=TRUE)
s$browse('pingpong')

#############################

If you request /ping, R runs Sys.sleep() for 20 seconds. This is where 
my .Call() statement would be. While the .Call() (Sys.sleep()) function 
is doing its thing, I need to get Rook to respond on /pong (which would 
simply respond with the progress), but if you run this code, request 
/ping, then immediately request /pong, you'll see that the /pong request 
will not be answered until the Sys.sleep() is done.

Of course, for a progress report to be useful, the requests have to be 
answered immediately. Is this a Rook issue, or an R issue? Or am I 
asking something unreasonable?


From dtenenba at fhcrc.org  Wed Oct 24 20:23:31 2012
From: dtenenba at fhcrc.org (Dan Tenenbaum)
Date: Wed, 24 Oct 2012 11:23:31 -0700
Subject: [Rd] concurrent requests (Rook,
	but I think the question is more general)
In-Reply-To: <50882FC1.40608@rug.nl>
References: <50882FC1.40608@rug.nl>
Message-ID: <CAF42j23oK_dmv4Mq3k48zwQGVYmw+jME6pBEgd87Sza=8DojEg@mail.gmail.com>

On Wed, Oct 24, 2012 at 11:13 AM, Richard D. Morey <r.d.morey at rug.nl> wrote:
> This question involves Rook, but I think the answer will be general enough
> that it pays to post here. At any rate, I don't know enough to know whether
> this is a Rook only issue or a general R issue.
>
> Here's what I'd like to do (and indeed, have code that should do this):
>
> 1. Start R, Rook
> 2. Start an analysis via a HTTP request to Rook. This analysis uses .Call()
> to some compiled C code, if that matters. The C code calls a callback
> function to update a variable with its progress.
> 3. While the analysis is happening, use Rook to obtain current status with
> an HTTP request
>
> The problem is that once the analysis starts, Rook does not respond to
> requests. All of the status requests to Rook pile up, and then are answered
> when the analysis (step 2) is done. Here is some example code to demonstrate
> what the issue:
>
> ##########
>
> library(Rook)
> s <- Rhttpd$new()
> s$add(
>   name="pingpong",
>   app=Rook::URLMap$new(
>     '/ping' = function(env){
>       req <- Rook::Request$new(env)
>       res <- Rook::Response$new()
>       res$write('This is ping.')
>       Sys.sleep(20)
>       res$finish()
>     },
>     '/pong' = function(env){
>       req <- Rook::Request$new(env)
>       res <- Rook::Response$new()
>       res$write("This is pong.")
>       res$finish()
>     },
>     '/?' = function(env){
>       req <- Rook::Request$new(env)
>       res <- Rook::Response$new()
>       res$redirect(req$to_url('/pong'))
>       res$finish()
>     }
>   )
> )
>
> s$start(quiet=TRUE)
> s$browse('pingpong')
>
> #############################
>
> If you request /ping, R runs Sys.sleep() for 20 seconds. This is where my
> .Call() statement would be. While the .Call() (Sys.sleep()) function is
> doing its thing, I need to get Rook to respond on /pong (which would simply
> respond with the progress), but if you run this code, request /ping, then
> immediately request /pong, you'll see that the /pong request will not be
> answered until the Sys.sleep() is done.
>
> Of course, for a progress report to be useful, the requests have to be
> answered immediately. Is this a Rook issue, or an R issue? Or am I asking
> something unreasonable?

One answer would be to start an Rserve instance on your local machine.
When your web app initiates processing, it actually starts the
long-running task on the server with RS.eval(wait=FALSE). See ?RCC
with the RS.client package loaded.
Then when you check for task completion, call RS.collect () with a
short timeout, and if it has something for you it will give it to you.

That doesn't give you a numeric progress report, but perhaps if your
long-running task writes its status somewhere (to a file?) the
progress-checking task could look there as well.

Dan


>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From simon.urbanek at r-project.org  Wed Oct 24 20:53:17 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 24 Oct 2012 14:53:17 -0400
Subject: [Rd] concurrent requests (Rook,
	but I think the question is more general)
In-Reply-To: <50882FC1.40608@rug.nl>
References: <50882FC1.40608@rug.nl>
Message-ID: <F8B3AAEF-822A-4970-BD6A-AB88FF8E8B9B@r-project.org>


On Oct 24, 2012, at 2:13 PM, Richard D. Morey wrote:

> This question involves Rook, but I think the answer will be general enough that it pays to post here. At any rate, I don't know enough to know whether this is a Rook only issue or a general R issue.
> 
> Here's what I'd like to do (and indeed, have code that should do this):
> 
> 1. Start R, Rook
> 2. Start an analysis via a HTTP request to Rook. This analysis uses .Call() to some compiled C code, if that matters. The C code calls a callback function to update a variable with its progress.
> 3. While the analysis is happening, use Rook to obtain current status with an HTTP request
> 

You can't. R doesn't support threading so it's simply not possible to have an asynchronous eval. The R HTTP server works by simply enqueuing an eval to run while R is idle, it can't do that if R is busy. (Note that the HTTP server was *only* designed for the internal help).

What you can do is have your C code start another thread that reports the progress when asked e.g. on a socket, but that thread is not allowed to call any R API so you want that progress to be entirely in your C code.

Note that if your C code is robust enough, it can call R_CheckUserInterrupt() to allow external events to happen, but a) your C code must in that case be prepared for early termination (clean up memory etc.) and b) I don't remember if the httpd is allowed to run during interrupt check on all platforms - you may want to check that first.

Cheers,
Simon




> The problem is that once the analysis starts, Rook does not respond to requests. All of the status requests to Rook pile up, and then are answered when the analysis (step 2) is done. Here is some example code to demonstrate what the issue:
> 
> ##########
> 
> library(Rook)
> s <- Rhttpd$new()
> s$add(
>  name="pingpong",
>  app=Rook::URLMap$new(
>    '/ping' = function(env){
>      req <- Rook::Request$new(env)
>      res <- Rook::Response$new()
>      res$write('This is ping.')
>      Sys.sleep(20)
>      res$finish()
>    },
>    '/pong' = function(env){
>      req <- Rook::Request$new(env)
>      res <- Rook::Response$new()
>      res$write("This is pong.")
>      res$finish()
>    },
>    '/?' = function(env){
>      req <- Rook::Request$new(env)
>      res <- Rook::Response$new()
>      res$redirect(req$to_url('/pong'))
>      res$finish()
>    }
>  )
> )
> 
> s$start(quiet=TRUE)
> s$browse('pingpong')
> 
> #############################
> 
> If you request /ping, R runs Sys.sleep() for 20 seconds. This is where my .Call() statement would be. While the .Call() (Sys.sleep()) function is doing its thing, I need to get Rook to respond on /pong (which would simply respond with the progress), but if you run this code, request /ping, then immediately request /pong, you'll see that the /pong request will not be answered until the Sys.sleep() is done.
> 
> Of course, for a progress report to be useful, the requests have to be answered immediately. Is this a Rook issue, or an R issue? Or am I asking something unreasonable?
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From r.d.morey at rug.nl  Wed Oct 24 21:09:13 2012
From: r.d.morey at rug.nl (Richard D. Morey)
Date: Wed, 24 Oct 2012 21:09:13 +0200
Subject: [Rd] concurrent requests (Rook,
 but I think the question is more general)
In-Reply-To: <F8B3AAEF-822A-4970-BD6A-AB88FF8E8B9B@r-project.org>
References: <50882FC1.40608@rug.nl>
	<F8B3AAEF-822A-4970-BD6A-AB88FF8E8B9B@r-project.org>
Message-ID: <50883CD9.1090509@rug.nl>

On 24/10/12 8:53 PM, Simon Urbanek wrote:
> On Oct 24, 2012, at 2:13 PM, Richard D. Morey wrote:
>
>> This question involves Rook, but I think the answer will be general enough that it pays to post here. At any rate, I don't know enough to know whether this is a Rook only issue or a general R issue.
>>
>> Here's what I'd like to do (and indeed, have code that should do this):
>>
>> 1. Start R, Rook
>> 2. Start an analysis via a HTTP request to Rook. This analysis uses .Call() to some compiled C code, if that matters. The C code calls a callback function to update a variable with its progress.
>> 3. While the analysis is happening, use Rook to obtain current status with an HTTP request
>>
> You can't. R doesn't support threading so it's simply not possible to have an asynchronous eval. The R HTTP server works by simply enqueuing an eval to run while R is idle, it can't do that if R is busy. (Note that the HTTP server was *only* designed for the internal help).
>
> What you can do is have your C code start another thread that reports the progress when asked e.g. on a socket, but that thread is not allowed to call any R API so you want that progress to be entirely in your C code.
How can I start a new thread? By running R again from the command line, 
or is there a better way?

>
> Note that if your C code is robust enough, it can call R_CheckUserInterrupt() to allow external events to happen, but a) your C code must in that case be prepared for early termination (clean up memory etc.) and b) I don't remember if the httpd is allowed to run during interrupt check on all platforms - you may want to check that first.
I do use R_CheckUserInterrupt(), but if I understand what you're saying 
then given that it doesn't work, httpd must not run during the interrupt 
check. At least, on OSX, which is what I'm testing on.

> Cheers,
> Simon
>
>
>
>
>> The problem is that once the analysis starts, Rook does not respond to requests. All of the status requests to Rook pile up, and then are answered when the analysis (step 2) is done. Here is some example code to demonstrate what the issue:
>>
>> ##########
>>
>> library(Rook)
>> s <- Rhttpd$new()
>> s$add(
>>   name="pingpong",
>>   app=Rook::URLMap$new(
>>     '/ping' = function(env){
>>       req <- Rook::Request$new(env)
>>       res <- Rook::Response$new()
>>       res$write('This is ping.')
>>       Sys.sleep(20)
>>       res$finish()
>>     },
>>     '/pong' = function(env){
>>       req <- Rook::Request$new(env)
>>       res <- Rook::Response$new()
>>       res$write("This is pong.")
>>       res$finish()
>>     },
>>     '/?' = function(env){
>>       req <- Rook::Request$new(env)
>>       res <- Rook::Response$new()
>>       res$redirect(req$to_url('/pong'))
>>       res$finish()
>>     }
>>   )
>> )
>>
>> s$start(quiet=TRUE)
>> s$browse('pingpong')
>>
>> #############################
>>
>> If you request /ping, R runs Sys.sleep() for 20 seconds. This is where my .Call() statement would be. While the .Call() (Sys.sleep()) function is doing its thing, I need to get Rook to respond on /pong (which would simply respond with the progress), but if you run this code, request /ping, then immediately request /pong, you'll see that the /pong request will not be answered until the Sys.sleep() is done.
>>
>> Of course, for a progress report to be useful, the requests have to be answered immediately. Is this a Rook issue, or an R issue? Or am I asking something unreasonable?
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>


From simon.urbanek at r-project.org  Wed Oct 24 21:23:15 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 24 Oct 2012 15:23:15 -0400
Subject: [Rd] concurrent requests (Rook,
	but I think the question is more general)
In-Reply-To: <50883CD9.1090509@rug.nl>
References: <50882FC1.40608@rug.nl>
	<F8B3AAEF-822A-4970-BD6A-AB88FF8E8B9B@r-project.org>
	<50883CD9.1090509@rug.nl>
Message-ID: <FEE1BFBC-494F-4CA6-BBE8-5F3D4D8559CD@r-project.org>

On Oct 24, 2012, at 3:09 PM, Richard D. Morey wrote:

> On 24/10/12 8:53 PM, Simon Urbanek wrote:
>> On Oct 24, 2012, at 2:13 PM, Richard D. Morey wrote:
>> 
>>> This question involves Rook, but I think the answer will be general enough that it pays to post here. At any rate, I don't know enough to know whether this is a Rook only issue or a general R issue.
>>> 
>>> Here's what I'd like to do (and indeed, have code that should do this):
>>> 
>>> 1. Start R, Rook
>>> 2. Start an analysis via a HTTP request to Rook. This analysis uses .Call() to some compiled C code, if that matters. The C code calls a callback function to update a variable with its progress.
>>> 3. While the analysis is happening, use Rook to obtain current status with an HTTP request
>>> 
>> You can't. R doesn't support threading so it's simply not possible to have an asynchronous eval. The R HTTP server works by simply enqueuing an eval to run while R is idle, it can't do that if R is busy. (Note that the HTTP server was *only* designed for the internal help).
>> 
>> What you can do is have your C code start another thread that reports the progress when asked e.g. on a socket, but that thread is not allowed to call any R API so you want that progress to be entirely in your C code.
> How can I start a new thread? By running R again from the command line, or is there a better way?
> 

No, you have to use the system thread API like pthreads, NSThread etc. If you have to ask about this, you probably don't want to go there ;) - threads can be quite dangerous if you are not familiar with them.

Another poor man's solution is to simply have your C code write out a file with the progress. Along the same lines you could use a shared object to store the progress (e.g. via bigmemory) ...


>> Note that if your C code is robust enough, it can call R_CheckUserInterrupt() to allow external events to happen, but a) your C code must in that case be prepared for early termination (clean up memory etc.) and b) I don't remember if the httpd is allowed to run during interrupt check on all platforms - you may want to check that first.
> I do use R_CheckUserInterrupt(), but if I understand what you're saying then given that it doesn't work, httpd must not run during the interrupt check. At least, on OSX, which is what I'm testing on.
> 

Yes, if your code calls R_CheckUserInterrupt() and httpd doesn't respond at that point then it may not be allowed to run. On OS X you can try your luck with R_ProcessEvents() as well.

Cheers,
Simon



>> Cheers,
>> Simon
>> 
>> 
>> 
>> 
>>> The problem is that once the analysis starts, Rook does not respond to requests. All of the status requests to Rook pile up, and then are answered when the analysis (step 2) is done. Here is some example code to demonstrate what the issue:
>>> 
>>> ##########
>>> 
>>> library(Rook)
>>> s <- Rhttpd$new()
>>> s$add(
>>>  name="pingpong",
>>>  app=Rook::URLMap$new(
>>>    '/ping' = function(env){
>>>      req <- Rook::Request$new(env)
>>>      res <- Rook::Response$new()
>>>      res$write('This is ping.')
>>>      Sys.sleep(20)
>>>      res$finish()
>>>    },
>>>    '/pong' = function(env){
>>>      req <- Rook::Request$new(env)
>>>      res <- Rook::Response$new()
>>>      res$write("This is pong.")
>>>      res$finish()
>>>    },
>>>    '/?' = function(env){
>>>      req <- Rook::Request$new(env)
>>>      res <- Rook::Response$new()
>>>      res$redirect(req$to_url('/pong'))
>>>      res$finish()
>>>    }
>>>  )
>>> )
>>> 
>>> s$start(quiet=TRUE)
>>> s$browse('pingpong')
>>> 
>>> #############################
>>> 
>>> If you request /ping, R runs Sys.sleep() for 20 seconds. This is where my .Call() statement would be. While the .Call() (Sys.sleep()) function is doing its thing, I need to get Rook to respond on /pong (which would simply respond with the progress), but if you run this code, request /ping, then immediately request /pong, you'll see that the /pong request will not be answered until the Sys.sleep() is done.
>>> 
>>> Of course, for a progress report to be useful, the requests have to be answered immediately. Is this a Rook issue, or an R issue? Or am I asking something unreasonable?
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>>> 
> 
> 


From r.d.morey at rug.nl  Wed Oct 24 21:47:55 2012
From: r.d.morey at rug.nl (Richard D. Morey)
Date: Wed, 24 Oct 2012 21:47:55 +0200
Subject: [Rd] concurrent requests (Rook,
 but I think the question is more general)
In-Reply-To: <FEE1BFBC-494F-4CA6-BBE8-5F3D4D8559CD@r-project.org>
References: <50882FC1.40608@rug.nl>
	<F8B3AAEF-822A-4970-BD6A-AB88FF8E8B9B@r-project.org>
	<50883CD9.1090509@rug.nl>
	<FEE1BFBC-494F-4CA6-BBE8-5F3D4D8559CD@r-project.org>
Message-ID: <508845EB.2090007@rug.nl>


Richard D. Morey
Assistant Professor
Psychometrics and Statistics
Rijksuniversiteit Groningen / University of Groningen
http://drsmorey.org/research/rdmorey

On 24/10/12 9:23 PM, Simon Urbanek wrote:
> On Oct 24, 2012, at 3:09 PM, Richard D. Morey wrote:
>
>> On 24/10/12 8:53 PM, Simon Urbanek wrote:
>>> On Oct 24, 2012, at 2:13 PM, Richard D. Morey wrote:
>>>
>>>> This question involves Rook, but I think the answer will be general enough that it pays to post here. At any rate, I don't know enough to know whether this is a Rook only issue or a general R issue.
>>>>
>>>> Here's what I'd like to do (and indeed, have code that should do this):
>>>>
>>>> 1. Start R, Rook
>>>> 2. Start an analysis via a HTTP request to Rook. This analysis uses .Call() to some compiled C code, if that matters. The C code calls a callback function to update a variable with its progress.
>>>> 3. While the analysis is happening, use Rook to obtain current status with an HTTP request
>>>>
>>> You can't. R doesn't support threading so it's simply not possible to have an asynchronous eval. The R HTTP server works by simply enqueuing an eval to run while R is idle, it can't do that if R is busy. (Note that the HTTP server was *only* designed for the internal help).
>>>
>>> What you can do is have your C code start another thread that reports the progress when asked e.g. on a socket, but that thread is not allowed to call any R API so you want that progress to be entirely in your C code.
>> How can I start a new thread? By running R again from the command line, or is there a better way?
>>
> No, you have to use the system thread API like pthreads, NSThread etc. If you have to ask about this, you probably don't want to go there ;) - threads can be quite dangerous if you are not familiar with them.
>
> Another poor man's solution is to simply have your C code write out a file with the progress. Along the same lines you could use a shared object to store the progress (e.g. via bigmemory) ...

I'd be fine with the poor man's solution (maybe with tempfile()?) if I 
can get access to the local file via javascript. But I don't think I 
can, due to the security limitations of the browser. I may have to 
rethink this significantly.

>
>
>>> Note that if your C code is robust enough, it can call R_CheckUserInterrupt() to allow external events to happen, but a) your C code must in that case be prepared for early termination (clean up memory etc.) and b) I don't remember if the httpd is allowed to run during interrupt check on all platforms - you may want to check that first.
>> I do use R_CheckUserInterrupt(), but if I understand what you're saying then given that it doesn't work, httpd must not run during the interrupt check. At least, on OSX, which is what I'm testing on.
>>
> Yes, if your code calls R_CheckUserInterrupt() and httpd doesn't respond at that point then it may not be allowed to run. On OS X you can try your luck with R_ProcessEvents() as well.
>
> Cheers,
> Simon
>
>
>
>>> Cheers,
>>> Simon
>>>
>>>
>>>
>>>
>>>> The problem is that once the analysis starts, Rook does not respond to requests. All of the status requests to Rook pile up, and then are answered when the analysis (step 2) is done. Here is some example code to demonstrate what the issue:
>>>>
>>>> ##########
>>>>
>>>> library(Rook)
>>>> s <- Rhttpd$new()
>>>> s$add(
>>>>   name="pingpong",
>>>>   app=Rook::URLMap$new(
>>>>     '/ping' = function(env){
>>>>       req <- Rook::Request$new(env)
>>>>       res <- Rook::Response$new()
>>>>       res$write('This is ping.')
>>>>       Sys.sleep(20)
>>>>       res$finish()
>>>>     },
>>>>     '/pong' = function(env){
>>>>       req <- Rook::Request$new(env)
>>>>       res <- Rook::Response$new()
>>>>       res$write("This is pong.")
>>>>       res$finish()
>>>>     },
>>>>     '/?' = function(env){
>>>>       req <- Rook::Request$new(env)
>>>>       res <- Rook::Response$new()
>>>>       res$redirect(req$to_url('/pong'))
>>>>       res$finish()
>>>>     }
>>>>   )
>>>> )
>>>>
>>>> s$start(quiet=TRUE)
>>>> s$browse('pingpong')
>>>>
>>>> #############################
>>>>
>>>> If you request /ping, R runs Sys.sleep() for 20 seconds. This is where my .Call() statement would be. While the .Call() (Sys.sleep()) function is doing its thing, I need to get Rook to respond on /pong (which would simply respond with the progress), but if you run this code, request /ping, then immediately request /pong, you'll see that the /pong request will not be answered until the Sys.sleep() is done.
>>>>
>>>> Of course, for a progress report to be useful, the requests have to be answered immediately. Is this a Rook issue, or an R issue? Or am I asking something unreasonable?
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>
>>


From mlilback at stat.wvu.edu  Wed Oct 24 20:14:07 2012
From: mlilback at stat.wvu.edu (Mark Lilback)
Date: Wed, 24 Oct 2012 14:14:07 -0400
Subject: [Rd] Getting ordered factor levels from C
Message-ID: <574D6602-6F6E-4EB3-99A6-6E1651A65D1B@stat.wvu.edu>

I'm working on an R package in C and can't seem to get the same level information about a factor that the R console displays.

If I define a factor as:

lvls <- factor(c('red','blue','blue','green','red'), c('blue','green','red'), ordered=TRUE)

When I get the "levels" attribute in C, I get back the the first vector, not the second. If I run attr(lvls,"levels") in R, I get back the second vector. There are no attributes besides class and levels, so how do I get the list of levels in the correct order?

Thanks

-- 
Mark Lilback
West Virginia University Department of Statistics
mlilback at stat.wvu.edu


From simon.urbanek at r-project.org  Wed Oct 24 22:07:16 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 24 Oct 2012 16:07:16 -0400
Subject: [Rd] concurrent requests (Rook,
	but I think the question is more general)
In-Reply-To: <508845EB.2090007@rug.nl>
References: <50882FC1.40608@rug.nl>
	<F8B3AAEF-822A-4970-BD6A-AB88FF8E8B9B@r-project.org>
	<50883CD9.1090509@rug.nl>
	<FEE1BFBC-494F-4CA6-BBE8-5F3D4D8559CD@r-project.org>
	<508845EB.2090007@rug.nl>
Message-ID: <F1CBF6BC-B328-4298-9033-1859F04CD67B@r-project.org>


On Oct 24, 2012, at 3:47 PM, Richard D. Morey wrote:

> 
> Richard D. Morey
> Assistant Professor
> Psychometrics and Statistics
> Rijksuniversiteit Groningen / University of Groningen
> http://drsmorey.org/research/rdmorey
> 
> On 24/10/12 9:23 PM, Simon Urbanek wrote:
>> On Oct 24, 2012, at 3:09 PM, Richard D. Morey wrote:
>> 
>>> On 24/10/12 8:53 PM, Simon Urbanek wrote:
>>>> On Oct 24, 2012, at 2:13 PM, Richard D. Morey wrote:
>>>> 
>>>>> This question involves Rook, but I think the answer will be general enough that it pays to post here. At any rate, I don't know enough to know whether this is a Rook only issue or a general R issue.
>>>>> 
>>>>> Here's what I'd like to do (and indeed, have code that should do this):
>>>>> 
>>>>> 1. Start R, Rook
>>>>> 2. Start an analysis via a HTTP request to Rook. This analysis uses .Call() to some compiled C code, if that matters. The C code calls a callback function to update a variable with its progress.
>>>>> 3. While the analysis is happening, use Rook to obtain current status with an HTTP request
>>>>> 
>>>> You can't. R doesn't support threading so it's simply not possible to have an asynchronous eval. The R HTTP server works by simply enqueuing an eval to run while R is idle, it can't do that if R is busy. (Note that the HTTP server was *only* designed for the internal help).
>>>> 
>>>> What you can do is have your C code start another thread that reports the progress when asked e.g. on a socket, but that thread is not allowed to call any R API so you want that progress to be entirely in your C code.
>>> How can I start a new thread? By running R again from the command line, or is there a better way?
>>> 
>> No, you have to use the system thread API like pthreads, NSThread etc. If you have to ask about this, you probably don't want to go there ;) - threads can be quite dangerous if you are not familiar with them.
>> 
>> Another poor man's solution is to simply have your C code write out a file with the progress. Along the same lines you could use a shared object to store the progress (e.g. via bigmemory) ...
> 
> I'd be fine with the poor man's solution (maybe with tempfile()?) if I can get access to the local file via javascript. But I don't think I can, due to the security limitations of the browser. I may have to rethink this significantly.
> 

That should be no problem, you can have another R instance serving the monitoring page (or you can use Rserve's HTTP server and have just one instance with arbitrarily many connections as needed).

Cheers,
Simon


>> 
>> 
>>>> Note that if your C code is robust enough, it can call R_CheckUserInterrupt() to allow external events to happen, but a) your C code must in that case be prepared for early termination (clean up memory etc.) and b) I don't remember if the httpd is allowed to run during interrupt check on all platforms - you may want to check that first.
>>> I do use R_CheckUserInterrupt(), but if I understand what you're saying then given that it doesn't work, httpd must not run during the interrupt check. At least, on OSX, which is what I'm testing on.
>>> 
>> Yes, if your code calls R_CheckUserInterrupt() and httpd doesn't respond at that point then it may not be allowed to run. On OS X you can try your luck with R_ProcessEvents() as well.
>> 
>> Cheers,
>> Simon
>> 
>> 
>> 
>>>> Cheers,
>>>> Simon
>>>> 
>>>> 
>>>> 
>>>> 
>>>>> The problem is that once the analysis starts, Rook does not respond to requests. All of the status requests to Rook pile up, and then are answered when the analysis (step 2) is done. Here is some example code to demonstrate what the issue:
>>>>> 
>>>>> ##########
>>>>> 
>>>>> library(Rook)
>>>>> s <- Rhttpd$new()
>>>>> s$add(
>>>>>  name="pingpong",
>>>>>  app=Rook::URLMap$new(
>>>>>    '/ping' = function(env){
>>>>>      req <- Rook::Request$new(env)
>>>>>      res <- Rook::Response$new()
>>>>>      res$write('This is ping.')
>>>>>      Sys.sleep(20)
>>>>>      res$finish()
>>>>>    },
>>>>>    '/pong' = function(env){
>>>>>      req <- Rook::Request$new(env)
>>>>>      res <- Rook::Response$new()
>>>>>      res$write("This is pong.")
>>>>>      res$finish()
>>>>>    },
>>>>>    '/?' = function(env){
>>>>>      req <- Rook::Request$new(env)
>>>>>      res <- Rook::Response$new()
>>>>>      res$redirect(req$to_url('/pong'))
>>>>>      res$finish()
>>>>>    }
>>>>>  )
>>>>> )
>>>>> 
>>>>> s$start(quiet=TRUE)
>>>>> s$browse('pingpong')
>>>>> 
>>>>> #############################
>>>>> 
>>>>> If you request /ping, R runs Sys.sleep() for 20 seconds. This is where my .Call() statement would be. While the .Call() (Sys.sleep()) function is doing its thing, I need to get Rook to respond on /pong (which would simply respond with the progress), but if you run this code, request /ping, then immediately request /pong, you'll see that the /pong request will not be answered until the Sys.sleep() is done.
>>>>> 
>>>>> Of course, for a progress report to be useful, the requests have to be answered immediately. Is this a Rook issue, or an R issue? Or am I asking something unreasonable?
>>>>> 
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>> 
>>>>> 
>>> 
> 
> 


From hpages at fhcrc.org  Wed Oct 24 22:12:04 2012
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Wed, 24 Oct 2012 13:12:04 -0700
Subject: [Rd] Shouldn't the \usage section tell the truth?
Message-ID: <50884B94.4030004@fhcrc.org>

Hi,

The signature of mget() changed between R-2.15.1 and recent R-devel.

In R-2.15.1:

   > args(mget)
   function (x, envir, mode = "any", ifnotfound = list(function(x) 
stop(paste0("value for '",
       x, "' not found"), call. = FALSE)), inherits = FALSE)
   NULL

In R-devel:

   > args(mget)
   function (x, envir, mode = "any", ifnotfound = list(function(x) 
stop(gettextf("value for %s not found",
       sQuote(x)), call. = FALSE, domain = NA)), inherits = FALSE)
   NULL

What has changed exactly is the default value for the 'ifnotfound'
argument. This change generates an 'R CMD check' warning for the
BiocGenerics package where the \usage section is still using
the old default:

   * checking for code/documentation mismatches ... WARNING
   Codoc mismatches from documentation object 'get':
   mget
     Code: function(x, envir, mode = "any", ifnotfound = list(function(x)
                    stop(gettextf("value for %s not found", sQuote(x)),
                    call. = FALSE, domain = NA)), inherits = FALSE)
     Docs: function(x, envir, mode = "any", ifnotfound = list(function(x)
                    stop(paste0("value for '", x, "' not found"), call. =
                    FALSE)), inherits = FALSE)
     Mismatches in argument default values:
       Name: 'ifnotfound'
       Code: list(function(x) stop(gettextf("value for %s not found", 
sQuote(x)),
             call. = FALSE, domain = NA))
       Docs: list(function(x) stop(paste0("value for '", x, "' not found"),
             call. = FALSE))

It's good to have the warning, and the fix is easy.

Now surprisingly, in R-devel, the \usage section for mget() doesn't
show the new default value (it used to in previous versions of R):

   mget(x, envir, mode = "any", ifnotfound, inherits = FALSE)

As you can see, it doesn't show a default value at all! And it
seems that 'R CMD check' is fine with that.

So my question is: is this the intended behavior for 'R CMD check'?
I hope not.

My view on argument default values is that they are fully part of the
API so they should appear in the \usage section. I can see that the
default value for 'ifnotfound' is not very exciting and showing it
in the \usage section is not that helpful (and can fairly be considered
distracting). But isn't this a situation where the default value
should rather be set to NULL or NA? Or, alternatively, no default
value is specified in the argument list and 'if (missing(ifnotfound))'
is used internally? Note that what is shown in \usage for mget() is
suggesting that this last solution was retained, which is misleading.
Then, whatever solution is used (NULL, NA, or no default value at
all), the documentation should probably explain how the argument
will be handled in case it's missing (unless this is obvious).

Anyway, what solution should be retained for mget() is not important.
My point is that the \usage section should tell the truth, and, if
not, 'R CMD check' should issue a warning.

Many times we've seen argument default values for Bioconductor functions 
not reported in the \usage section. Each time it was
*not* intended (typically the maintainer would add the argument
default value in the function definition and forget to update the
\usage section). And each time, when someone brings this to the
attention of the maintainer (sometimes weeks or months later),
everybody was surprised that 'R CMD check' didn't report the problem.

Hopefully that can be fixed.

Thanks in advance,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From simon.urbanek at r-project.org  Wed Oct 24 22:16:54 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 24 Oct 2012 16:16:54 -0400
Subject: [Rd] Getting ordered factor levels from C
In-Reply-To: <574D6602-6F6E-4EB3-99A6-6E1651A65D1B@stat.wvu.edu>
References: <574D6602-6F6E-4EB3-99A6-6E1651A65D1B@stat.wvu.edu>
Message-ID: <47E3E25E-E4DE-451E-BC1F-71D0B857E64C@r-project.org>


On Oct 24, 2012, at 2:14 PM, Mark Lilback wrote:

> I'm working on an R package in C and can't seem to get the same level information about a factor that the R console displays.
> 
> If I define a factor as:
> 
> lvls <- factor(c('red','blue','blue','green','red'), c('blue','green','red'), ordered=TRUE)
> 
> When I get the "levels" attribute in C, I get back the the first vector, not the second.

What are you using in C? AFAICS it works just fine:

> f=cfunction(c(foo="factor"), "return getAttrib(foo, R_LevelsSymbol);")
> f(lvls)
[1] "blue"  "green" "red"  

Cheers,
Simon



> If I run attr(lvls,"levels") in R, I get back the second vector. There are no attributes besides class and levels, so how do I get the list of levels in the correct order?
> 
> Thanks
> 
> -- 
> Mark Lilback
> West Virginia University Department of Statistics
> mlilback at stat.wvu.edu
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From r.d.morey at rug.nl  Wed Oct 24 22:35:00 2012
From: r.d.morey at rug.nl (Richard D. Morey)
Date: Wed, 24 Oct 2012 22:35:00 +0200
Subject: [Rd] concurrent requests (Rook,
 but I think the question is more general)
In-Reply-To: <F1CBF6BC-B328-4298-9033-1859F04CD67B@r-project.org>
References: <50882FC1.40608@rug.nl>
	<F8B3AAEF-822A-4970-BD6A-AB88FF8E8B9B@r-project.org>
	<50883CD9.1090509@rug.nl>
	<FEE1BFBC-494F-4CA6-BBE8-5F3D4D8559CD@r-project.org>
	<508845EB.2090007@rug.nl>
	<F1CBF6BC-B328-4298-9033-1859F04CD67B@r-project.org>
Message-ID: <508850F4.8090208@rug.nl>

On 24/10/12 10:07 PM, Simon Urbanek wrote:
> On Oct 24, 2012, at 3:47 PM, Richard D. Morey wrote:
>
>> I'd be fine with the poor man's solution (maybe with tempfile()?) if I can get access to the local file via javascript. But I don't think I can, due to the security limitations of the browser. I may have to rethink this significantly.
>>
> That should be no problem, you can have another R instance serving the monitoring page (or you can use Rserve's HTTP server and have just one instance with arbitrarily many connections as needed).

OK, I'm looking at Rserve. I get the impression that one needs to start 
a separate server, so it would be difficult to make this transparent to 
a user who installs my package and just wants to do an analysis with a 
GUI. It also appears that there is a separate binary install, at least 
on Windows, which would mean anyone using my package would need to 
install and run something separate. Is that accurate?


From simon.urbanek at r-project.org  Wed Oct 24 22:55:09 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 24 Oct 2012 16:55:09 -0400
Subject: [Rd] concurrent requests (Rook,
	but I think the question is more general)
In-Reply-To: <508850F4.8090208@rug.nl>
References: <50882FC1.40608@rug.nl>
	<F8B3AAEF-822A-4970-BD6A-AB88FF8E8B9B@r-project.org>
	<50883CD9.1090509@rug.nl>
	<FEE1BFBC-494F-4CA6-BBE8-5F3D4D8559CD@r-project.org>
	<508845EB.2090007@rug.nl>
	<F1CBF6BC-B328-4298-9033-1859F04CD67B@r-project.org>
	<508850F4.8090208@rug.nl>
Message-ID: <3E5C503F-4CE8-4130-B255-011C20C7D438@r-project.org>


On Oct 24, 2012, at 4:35 PM, Richard D. Morey wrote:

> On 24/10/12 10:07 PM, Simon Urbanek wrote:
>> On Oct 24, 2012, at 3:47 PM, Richard D. Morey wrote:
>> 
>>> I'd be fine with the poor man's solution (maybe with tempfile()?) if I can get access to the local file via javascript. But I don't think I can, due to the security limitations of the browser. I may have to rethink this significantly.
>>> 
>> That should be no problem, you can have another R instance serving the monitoring page (or you can use Rserve's HTTP server and have just one instance with arbitrarily many connections as needed).
> 
> OK, I'm looking at Rserve. I get the impression that one needs to start a separate server, so it would be difficult to make this transparent to a user who installs my package and just wants to do an analysis with a GUI. It also appears that there is a separate binary install, at least on Windows, which would mean anyone using my package would need to install and run something separate. Is that accurate?
> 

Not quite - it is all in the Rserve package, many years ago we used to supply Rserve.exe just because it did not require installation of any packages, but we don't do that anymore. Typically Java GUIs use Rserve to run R - it's trivial to start it (e.g., there is the StartRserve.java example) so your GUI can start it and shut it down. I don't know how you are driving your GUI so this may or may not be a good way - on unix you get the benefit of parallel HTTP server, that's really all I was pointing out. BTW: if you are talking web-GUI then Rserve is great for that because the GUI consist simply of R scripts (see FastRWeb) - but I mat be thinking bigger than what you have in mind.

The point is that you need a separate monitoring process or threads. That process can be R, Rserve or any thing else.

Cheers,
Simon


From mlilback at stat.wvu.edu  Wed Oct 24 23:19:44 2012
From: mlilback at stat.wvu.edu (Mark Lilback)
Date: Wed, 24 Oct 2012 17:19:44 -0400
Subject: [Rd] Getting ordered factor levels from C
In-Reply-To: <47E3E25E-E4DE-451E-BC1F-71D0B857E64C@r-project.org>
References: <574D6602-6F6E-4EB3-99A6-6E1651A65D1B@stat.wvu.edu>
	<47E3E25E-E4DE-451E-BC1F-71D0B857E64C@r-project.org>
Message-ID: <D5E4B933-D6E2-4B1F-B720-DA59765AA6C0@stat.wvu.edu>

I was banging my head for an hour on this. I just pasted the code into an email and see that I was getting the contents of the SEXP for the factor, not the one returned by getAttrib. Sorry for the waste of time.


On Oct 24, 2012, at 4:16 PM, Simon Urbanek <simon.urbanek at r-project.org> wrote:

> 
> On Oct 24, 2012, at 2:14 PM, Mark Lilback wrote:
> 
>> I'm working on an R package in C and can't seem to get the same level information about a factor that the R console displays.
>> 
>> If I define a factor as:
>> 
>> lvls <- factor(c('red','blue','blue','green','red'), c('blue','green','red'), ordered=TRUE)
>> 
>> When I get the "levels" attribute in C, I get back the the first vector, not the second.
> 
> What are you using in C? AFAICS it works just fine:
> 
>> f=cfunction(c(foo="factor"), "return getAttrib(foo, R_LevelsSymbol);")
>> f(lvls)
> [1] "blue"  "green" "red"  
> 



-- 
Mark Lilback
West Virginia University Department of Statistics
mlilback at stat.wvu.edu


From maechler at stat.math.ethz.ch  Thu Oct 25 11:28:23 2012
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 25 Oct 2012 11:28:23 +0200
Subject: [Rd] suppress *specific* warnings?
In-Reply-To: <50868D80.10308@fhcrc.org>
References: <50844CC3.6020302@ufl.edu> <50849C77.6050106@fhcrc.org>
	<alpine.LFD.2.02.1210221153530.1869@nokomis.stat.uiowa.edu>
	<50868D80.10308@fhcrc.org>
Message-ID: <20617.1591.947596.745192@stat.math.ethz.ch>

Sorry guys, for coming late,
but *please* don't go there.

I've been there years ago,
and found later why the approach is flawed "by design" :

Internationalization / Localization:

- If the warning comes from a "standard R" function,
  the warning is almost surely different in a (say) German
  locale, and your pattern won't be detected.

- Ditto if from a recommended package.

- If it is a warning that is not translated then it may be that
  it is just not *YET*  translated.

The really dangerous thing about matching error / warning
messages -- I had done it in the past with the error message I
caught via tryCatch() --
is that
- in your tests the code will work perfectly.
- on CRAN the code will work perfectly, as "they" also use
  the English (or C) locale.

So, by doing this you are distributing code that "almost always"
works ... in your environment if you are US, UK or similarly
based.

Indeed, a *really* dangerous practice.

Martin Maechler, ETH Zurich




>>>>> Martin Morgan <mtmorgan at fhcrc.org>
>>>>>     on Tue, 23 Oct 2012 05:28:48 -0700 writes:

    > On 10/22/2012 09:57 AM, luke-tierney at uiowa.edu wrote:
    >> On Sun, 21 Oct 2012, Martin Morgan wrote:
    >> 
    >>> On 10/21/2012 12:28 PM, Ben Bolker wrote:
    >>>> 
    >>>> Not desperately important, but nice to have and possibly of use to
    >>>> others, is the ability to suppress specific warnings rather than
    >>>> suppressing warnings indiscriminately.  I often know of a specific
    >>>> warning that I want to ignore (because I know that's it's a false
    >>>> positive/ignorable), but the current design of suppressWarnings() forces
    >>>> me to ignore *any* warnings coming from the expression.
    >>>> 
    >>>> I started to write a new version that would check and, if supplied
    >>>> with a regular expression, would only block matching warnings and
    >>>> otherwise would produce the warnings as usual, but I don't quite know
    >>>> enough about what I'm doing: see ??? in expression below.
    >>>> 
    >>>> Can anyone help, or suggest pointers to relevant
    >>>> examples/documentation (I've looked at demo(error.catching), which isn't
    >>>> helping me ... ?)
    >>>> 
    >>>> suppressWarnings2 <- function(expr,regex=NULL) {
    >>>> opts <- options(warn = -1)
    >>>> on.exit(options(opts))
    >>> 
    >>> I'm not really sure what the options(warn=-1) is doing there, maybe its for
    >>> efficiency to avoid generating a warning message (as distinct from signalling
    >> 
    >> The sources in srs/library/base/conditions.R have
    >> 
    >> suppressWarnings <- function(expr) {
    >> ops <- options(warn = -1) ## FIXME: temporary hack until R_tryEval
    >> on.exit(options(ops))     ## calls are removed from methods code
    >> withCallingHandlers(expr,
    >> warning=function(w)
    >> invokeRestart("muffleWarning"))
    >> }
    >> 
    >> I uspect we have still not entirely eliminated R_tryEval in this context
    >> but I'm not sure. Will check when I get a chance.
    >> 
    >>> a warning). I think you're after something like
    >>> 
    >>> suppressWarnings2 <-
    >>> function(expr, regex=character())
    >>> {
    >>> withCallingHandlers(expr, warning=function(w) {
    >>> if (length(regex) == 1 && length(grep(regex, conditionMessage(w)))) {
    >>> invokeRestart("muffleWarning")
    >>> }
    >>> })
    >>> }
    >> 
    >> A problem with using expression matching is of course that this fails
    >> with internationalized messages. Ideally warnings should be signaled as
    >> warning conditions of a particular class, and that class can be used
    >> to discriminate. Unfortunately very few warnings are designed this way.

    > Probably specific messages, rather than patterns, would be handled and then

    > suppressWarnings2 <- function(expr, messages = character())
    > {
    > opts <- options(warn = -1)
    > on.exit(options(ops))
    > withCallingHandlers(expr, warning=function(w) {
    > if (conditionMessage(w) %in% messages)
    > invokeRestart("muffleWarning")
    > })
    > }

    > gives one the illusion of speaking many languages

    > suppressWarnings2(log(-1), gettext("NaNs introduced", domain="R"))

    > Martin

    >> 
    >> Best,
    >> 
    >> luke
    >> 
    >>> 
    >>> If the  restart isn't invoked, then the next handler is called and the warning
    >>> is handled as normal. So with
    >>> 
    >>> f <- function() {
    >>> warning("oops")
    >>> 2
    >>> }
    >>> 
    >>> there is
    >>> 
    >>>> suppressWarnings2(f())
    >>> [1] 2
    >>> Warning message:
    >>> In f() : oops
    >>>> suppressWarnings2(f(), "oops")
    >>> [1] 2
    >>> 
    >>> For your own code I think a better strategy is to create a sub-class of
    >>> warnings that can be handled differently
    >>> 
    >>> mywarn <-
    >>> function(..., call.=TRUE, immediate.=FALSE, domain=NULL)
    >>> {
    >>> msg <- .makeMessage(..., domain=domain, appendLF=FALSE)
    >>> call <- NULL
    >>> if (call.)
    >>> call <- sys.call(1L)
    >>> class <- c("silencable", "simpleWarning",  "warning", "condition")
    >>> cond <- structure(list(message=msg, call=call), class=class)
    >>> warning(cond)
    >>> }
    >>> 
    >>> suppressWarnings3 <-
    >>> function(expr)
    >>> {
    >>> withCallingHandlers(expr, silencable=function(w) {
    >>> invokeRestart("muffleWarning")
    >>> })
    >>> }
    >>> 
    >>> then with
    >>> 
    >>> g <- function() {
    >>> mywarn("oops")
    >>> 3
    >>> }
    >>> 
    >>>> suppressWarnings3(f())
    >>> [1] 2
    >>> Warning message:
    >>> In f() : oops
    >>>> g()
    >>> [1] 3
    >>> Warning message:
    >>> In g() : oops
    >>>> suppressWarnings3(g())
    >>> [1] 3
    >>> 
    >>>> withCallingHandlers(expr, warning = function(w) {
    >>>> ## browser()
    >>>> if (is.null(regex) || grepl(w[["message"]],regex)) {
    >>>> invokeRestart("muffleWarning")
    >>>> } else {
    >>>> ## ? what do I here to get the warning issued?
    >>>> ## browser()
    >>>> ## computeRestarts() shows "browser",
    >>>> ##    "muffleWarning", and "abort" ...
    >>>> options(opts)
    >>>> warning(w$message)
    >>>> ## how can I get back from here to the calling point
    >>>> ##   *without* muffling warnings ... ?
    >>>> }
    >>>> })
    >>>> }
    >>>> 
    >>>> suppressWarnings2(sqrt(-1))
    >>>> suppressWarnings2(sqrt(-1),"abc")
    >>>> 
    >>>> It seems to me I'd like to have a restart option that just returns to
    >>>> the point where the warning was caught, *without* muffling warnings ...
    >>>> ?  But I don't quite understand how to set one up ...
    >>>> 
    >>>> Ben Bolker
    >>>> 
    >>>> ______________________________________________
    >>>> R-devel at r-project.org mailing list
    >>>> https://stat.ethz.ch/mailman/listinfo/r-devel
    >>>> 
    >>> 
    >>> 
    >>> 
    >> 


    > -- 
    > Computational Biology / Fred Hutchinson Cancer Research Center
    > 1100 Fairview Ave. N.
    > PO Box 19024 Seattle, WA 98109

    > Location: Arnold Building M1 B861
    > Phone: (206) 667-2793

    > ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Thu Oct 25 12:51:25 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 25 Oct 2012 06:51:25 -0400
Subject: [Rd] suppress *specific* warnings?
In-Reply-To: <20617.1591.947596.745192@stat.math.ethz.ch>
References: <50844CC3.6020302@ufl.edu> <50849C77.6050106@fhcrc.org>
	<alpine.LFD.2.02.1210221153530.1869@nokomis.stat.uiowa.edu>
	<50868D80.10308@fhcrc.org>
	<20617.1591.947596.745192@stat.math.ethz.ch>
Message-ID: <508919AD.3090205@gmail.com>

On 12-10-25 5:28 AM, Martin Maechler wrote:
> Sorry guys, for coming late,
> but *please* don't go there.
>
> I've been there years ago,
> and found later why the approach is flawed "by design" :
>
> Internationalization / Localization:
>
> - If the warning comes from a "standard R" function,
>    the warning is almost surely different in a (say) German
>    locale, and your pattern won't be detected.
>
> - Ditto if from a recommended package.
>
> - If it is a warning that is not translated then it may be that
>    it is just not *YET*  translated.

I think the other Martin's suggestion addressed this:  he matched the 
translated message, not the English original.

Duncan Murdoch

>
> The really dangerous thing about matching error / warning
> messages -- I had done it in the past with the error message I
> caught via tryCatch() --
> is that
> - in your tests the code will work perfectly.
> - on CRAN the code will work perfectly, as "they" also use
>    the English (or C) locale.
>
> So, by doing this you are distributing code that "almost always"
> works ... in your environment if you are US, UK or similarly
> based.
>
> Indeed, a *really* dangerous practice.
>
> Martin Maechler, ETH Zurich
>
>
>
>
>>>>>> Martin Morgan <mtmorgan at fhcrc.org>
>>>>>>      on Tue, 23 Oct 2012 05:28:48 -0700 writes:
>
>      > On 10/22/2012 09:57 AM, luke-tierney at uiowa.edu wrote:
>      >> On Sun, 21 Oct 2012, Martin Morgan wrote:
>      >>
>      >>> On 10/21/2012 12:28 PM, Ben Bolker wrote:
>      >>>>
>      >>>> Not desperately important, but nice to have and possibly of use to
>      >>>> others, is the ability to suppress specific warnings rather than
>      >>>> suppressing warnings indiscriminately.  I often know of a specific
>      >>>> warning that I want to ignore (because I know that's it's a false
>      >>>> positive/ignorable), but the current design of suppressWarnings() forces
>      >>>> me to ignore *any* warnings coming from the expression.
>      >>>>
>      >>>> I started to write a new version that would check and, if supplied
>      >>>> with a regular expression, would only block matching warnings and
>      >>>> otherwise would produce the warnings as usual, but I don't quite know
>      >>>> enough about what I'm doing: see ??? in expression below.
>      >>>>
>      >>>> Can anyone help, or suggest pointers to relevant
>      >>>> examples/documentation (I've looked at demo(error.catching), which isn't
>      >>>> helping me ... ?)
>      >>>>
>      >>>> suppressWarnings2 <- function(expr,regex=NULL) {
>      >>>> opts <- options(warn = -1)
>      >>>> on.exit(options(opts))
>      >>>
>      >>> I'm not really sure what the options(warn=-1) is doing there, maybe its for
>      >>> efficiency to avoid generating a warning message (as distinct from signalling
>      >>
>      >> The sources in srs/library/base/conditions.R have
>      >>
>      >> suppressWarnings <- function(expr) {
>      >> ops <- options(warn = -1) ## FIXME: temporary hack until R_tryEval
>      >> on.exit(options(ops))     ## calls are removed from methods code
>      >> withCallingHandlers(expr,
>      >> warning=function(w)
>      >> invokeRestart("muffleWarning"))
>      >> }
>      >>
>      >> I uspect we have still not entirely eliminated R_tryEval in this context
>      >> but I'm not sure. Will check when I get a chance.
>      >>
>      >>> a warning). I think you're after something like
>      >>>
>      >>> suppressWarnings2 <-
>      >>> function(expr, regex=character())
>      >>> {
>      >>> withCallingHandlers(expr, warning=function(w) {
>      >>> if (length(regex) == 1 && length(grep(regex, conditionMessage(w)))) {
>      >>> invokeRestart("muffleWarning")
>      >>> }
>      >>> })
>      >>> }
>      >>
>      >> A problem with using expression matching is of course that this fails
>      >> with internationalized messages. Ideally warnings should be signaled as
>      >> warning conditions of a particular class, and that class can be used
>      >> to discriminate. Unfortunately very few warnings are designed this way.
>
>      > Probably specific messages, rather than patterns, would be handled and then
>
>      > suppressWarnings2 <- function(expr, messages = character())
>      > {
>      > opts <- options(warn = -1)
>      > on.exit(options(ops))
>      > withCallingHandlers(expr, warning=function(w) {
>      > if (conditionMessage(w) %in% messages)
>      > invokeRestart("muffleWarning")
>      > })
>      > }
>
>      > gives one the illusion of speaking many languages
>
>      > suppressWarnings2(log(-1), gettext("NaNs introduced", domain="R"))
>
>      > Martin
>
>      >>
>      >> Best,
>      >>
>      >> luke
>      >>
>      >>>
>      >>> If the  restart isn't invoked, then the next handler is called and the warning
>      >>> is handled as normal. So with
>      >>>
>      >>> f <- function() {
>      >>> warning("oops")
>      >>> 2
>      >>> }
>      >>>
>      >>> there is
>      >>>
>      >>>> suppressWarnings2(f())
>      >>> [1] 2
>      >>> Warning message:
>      >>> In f() : oops
>      >>>> suppressWarnings2(f(), "oops")
>      >>> [1] 2
>      >>>
>      >>> For your own code I think a better strategy is to create a sub-class of
>      >>> warnings that can be handled differently
>      >>>
>      >>> mywarn <-
>      >>> function(..., call.=TRUE, immediate.=FALSE, domain=NULL)
>      >>> {
>      >>> msg <- .makeMessage(..., domain=domain, appendLF=FALSE)
>      >>> call <- NULL
>      >>> if (call.)
>      >>> call <- sys.call(1L)
>      >>> class <- c("silencable", "simpleWarning",  "warning", "condition")
>      >>> cond <- structure(list(message=msg, call=call), class=class)
>      >>> warning(cond)
>      >>> }
>      >>>
>      >>> suppressWarnings3 <-
>      >>> function(expr)
>      >>> {
>      >>> withCallingHandlers(expr, silencable=function(w) {
>      >>> invokeRestart("muffleWarning")
>      >>> })
>      >>> }
>      >>>
>      >>> then with
>      >>>
>      >>> g <- function() {
>      >>> mywarn("oops")
>      >>> 3
>      >>> }
>      >>>
>      >>>> suppressWarnings3(f())
>      >>> [1] 2
>      >>> Warning message:
>      >>> In f() : oops
>      >>>> g()
>      >>> [1] 3
>      >>> Warning message:
>      >>> In g() : oops
>      >>>> suppressWarnings3(g())
>      >>> [1] 3
>      >>>
>      >>>> withCallingHandlers(expr, warning = function(w) {
>      >>>> ## browser()
>      >>>> if (is.null(regex) || grepl(w[["message"]],regex)) {
>      >>>> invokeRestart("muffleWarning")
>      >>>> } else {
>      >>>> ## ? what do I here to get the warning issued?
>      >>>> ## browser()
>      >>>> ## computeRestarts() shows "browser",
>      >>>> ##    "muffleWarning", and "abort" ...
>      >>>> options(opts)
>      >>>> warning(w$message)
>      >>>> ## how can I get back from here to the calling point
>      >>>> ##   *without* muffling warnings ... ?
>      >>>> }
>      >>>> })
>      >>>> }
>      >>>>
>      >>>> suppressWarnings2(sqrt(-1))
>      >>>> suppressWarnings2(sqrt(-1),"abc")
>      >>>>
>      >>>> It seems to me I'd like to have a restart option that just returns to
>      >>>> the point where the warning was caught, *without* muffling warnings ...
>      >>>> ?  But I don't quite understand how to set one up ...
>      >>>>
>      >>>> Ben Bolker
>      >>>>
>      >>>> ______________________________________________
>      >>>> R-devel at r-project.org mailing list
>      >>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>      >>>>
>      >>>
>      >>>
>      >>>
>      >>
>
>
>      > --
>      > Computational Biology / Fred Hutchinson Cancer Research Center
>      > 1100 Fairview Ave. N.
>      > PO Box 19024 Seattle, WA 98109
>
>      > Location: Arnold Building M1 B861
>      > Phone: (206) 667-2793
>
>      > ______________________________________________
>      > R-devel at r-project.org mailing list
>      > https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From r.d.morey at rug.nl  Thu Oct 25 17:45:46 2012
From: r.d.morey at rug.nl (Richard D. Morey)
Date: Thu, 25 Oct 2012 17:45:46 +0200
Subject: [Rd] concurrent requests (Rook,
 but I think the question is more general)
In-Reply-To: <3E5C503F-4CE8-4130-B255-011C20C7D438@r-project.org>
References: <50882FC1.40608@rug.nl>
	<F8B3AAEF-822A-4970-BD6A-AB88FF8E8B9B@r-project.org>
	<50883CD9.1090509@rug.nl>
	<FEE1BFBC-494F-4CA6-BBE8-5F3D4D8559CD@r-project.org>
	<508845EB.2090007@rug.nl>
	<F1CBF6BC-B328-4298-9033-1859F04CD67B@r-project.org>
	<508850F4.8090208@rug.nl>
	<3E5C503F-4CE8-4130-B255-011C20C7D438@r-project.org>
Message-ID: <50895EAA.50403@rug.nl>

On 24/10/12 10:55 PM, Simon Urbanek wrote:
>
> The point is that you need a separate monitoring process or threads. That process can be R, Rserve or any thing else.
>
>
>

Thanks for the tips. This is what I'm currently contemplating:

1. Main interface starts in user's R session, and opens up the interface 
(HTML/Javascript using Rook package)
2. When analysis starts, Rserve is started, with its own web server, 
using Rook, for status updates
3. During analysis, main process calls a callback function which uses 
RSassign() to send progress updates to the Rserve server
4. HTML/Javascript interface can connect to the webserver on the Rserve 
server to get status updates
5. When analysis is done, use RSshutdown() and RSclose() to clean up.

Does this seem reasonable?

One problem I'm having is that when I start Rook on the Rserve server, 
the webserver does not respond (although it is started). Does Rserve 
only respond to requests on the port assigned for RSclient commands?

Best,
Richard

Here's an example:

#######################

library(Rserve)

### This works:

stuff = expression({
   library(Rook)
   s <- Rhttpd$new()
   s$add(
     app=system.file('exampleApps/helloworld.R',package='Rook'),
     name='hello'
   )
   s$start(quiet=TRUE)
   s$browse(1)
   print(s$full_url(1))
})

# This will open the browser to the test app, asking for your name
eval(stuff)

### This does not:

Rserve(args="--no-save")
c <- RSconnect()
RSassign(c, stuff)

# This opens the browser to the correct URL, but the webserver doesn't 
respond.
RSeval(c, quote(eval(stuff)))


#####
# cleanup
RSshutdown(c)
RSclose(c)


From dtenenba at fhcrc.org  Thu Oct 25 19:14:41 2012
From: dtenenba at fhcrc.org (Dan Tenenbaum)
Date: Thu, 25 Oct 2012 10:14:41 -0700
Subject: [Rd] concurrent requests (Rook,
	but I think the question is more general)
In-Reply-To: <50895EAA.50403@rug.nl>
References: <50882FC1.40608@rug.nl>
	<F8B3AAEF-822A-4970-BD6A-AB88FF8E8B9B@r-project.org>
	<50883CD9.1090509@rug.nl>
	<FEE1BFBC-494F-4CA6-BBE8-5F3D4D8559CD@r-project.org>
	<508845EB.2090007@rug.nl>
	<F1CBF6BC-B328-4298-9033-1859F04CD67B@r-project.org>
	<508850F4.8090208@rug.nl>
	<3E5C503F-4CE8-4130-B255-011C20C7D438@r-project.org>
	<50895EAA.50403@rug.nl>
Message-ID: <CAF42j22bBzfeN6=bg8Ovp2YcA7d+HxYA5Zw-zSPrc4K1X-bJfw@mail.gmail.com>

On Thu, Oct 25, 2012 at 8:45 AM, Richard D. Morey <r.d.morey at rug.nl> wrote:
> On 24/10/12 10:55 PM, Simon Urbanek wrote:
>>
>>
>> The point is that you need a separate monitoring process or threads. That
>> process can be R, Rserve or any thing else.
>>
>>
>>
>
> Thanks for the tips. This is what I'm currently contemplating:
>
> 1. Main interface starts in user's R session, and opens up the interface
> (HTML/Javascript using Rook package)
> 2. When analysis starts, Rserve is started, with its own web server, using
> Rook, for status updates
> 3. During analysis, main process calls a callback function which uses
> RSassign() to send progress updates to the Rserve server
> 4. HTML/Javascript interface can connect to the webserver on the Rserve
> server to get status updates
> 5. When analysis is done, use RSshutdown() and RSclose() to clean up.
>
> Does this seem reasonable?
>
> One problem I'm having is that when I start Rook on the Rserve server, the
> webserver does not respond (although it is started). Does Rserve only
> respond to requests on the port assigned for RSclient commands?
>
> Best,
> Richard
>
> Here's an example:
>
> #######################
>
> library(Rserve)
>
> ### This works:
>
> stuff = expression({
>
>   library(Rook)
>   s <- Rhttpd$new()
>   s$add(
>     app=system.file('exampleApps/helloworld.R',package='Rook'),
>     name='hello'
>   )
>   s$start(quiet=TRUE)
>   s$browse(1)
>   print(s$full_url(1))
> })
>
> # This will open the browser to the test app, asking for your name
> eval(stuff)
>
> ### This does not:
>
> Rserve(args="--no-save")
> c <- RSconnect()
> RSassign(c, stuff)
>
> # This opens the browser to the correct URL, but the webserver doesn't
> respond.
> RSeval(c, quote(eval(stuff)))
>
>
> #####
> # cleanup
> RSshutdown(c)
> RSclose(c)
>

This "works" for me if I omit the quote(). I get an error, but the
webapp seems to work. Also, I didn't eval(stuff) locally, only on the
server:

> RSeval(c, eval(stuff))
Loading required package: tools
Loading required package: brew
starting httpd help server ... done
[1] "http://127.0.0.1:15583/custom/hello"
Error in parse(text = paste("{", paste(expr, collapse = "\n"), "}")) :
  <text>:1:8: unexpected '/'
1: { http:/
          ^
> traceback()
3: parse(text = paste("{", paste(expr, collapse = "\n"), "}"))
2: serialize(parse(text = paste("{", paste(expr, collapse = "\n"),
       "}"))[[1]], NULL)
1: RSeval(c, eval(stuff))
> sessionInfo()
R Under development (unstable) (2012-10-23 r61007)
Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] tools     stats     graphics  grDevices utils     datasets  methods
[8] base

other attached packages:
[1] Rook_1.0-8          brew_1.0-6          Rserve_0.6-8
[4] BiocInstaller_1.9.4

Dan

>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From r.d.morey at rug.nl  Thu Oct 25 19:19:17 2012
From: r.d.morey at rug.nl (Richard D. Morey)
Date: Thu, 25 Oct 2012 19:19:17 +0200
Subject: [Rd] concurrent requests (Rook,
 but I think the question is more general)
In-Reply-To: <CAF42j22bBzfeN6=bg8Ovp2YcA7d+HxYA5Zw-zSPrc4K1X-bJfw@mail.gmail.com>
References: <50882FC1.40608@rug.nl>
	<F8B3AAEF-822A-4970-BD6A-AB88FF8E8B9B@r-project.org>
	<50883CD9.1090509@rug.nl>
	<FEE1BFBC-494F-4CA6-BBE8-5F3D4D8559CD@r-project.org>
	<508845EB.2090007@rug.nl>
	<F1CBF6BC-B328-4298-9033-1859F04CD67B@r-project.org>
	<508850F4.8090208@rug.nl>
	<3E5C503F-4CE8-4130-B255-011C20C7D438@r-project.org>
	<50895EAA.50403@rug.nl>
	<CAF42j22bBzfeN6=bg8Ovp2YcA7d+HxYA5Zw-zSPrc4K1X-bJfw@mail.gmail.com>
Message-ID: <50897495.7090904@rug.nl>

On 25/10/12 7:14 PM, Dan Tenenbaum wrote:
> On Thu, Oct 25, 2012 at 8:45 AM, Richard D. Morey <r.d.morey at rug.nl> wrote:
>> On 24/10/12 10:55 PM, Simon Urbanek wrote:
>>>
>>> The point is that you need a separate monitoring process or threads. That
>>> process can be R, Rserve or any thing else.
>>>
>>>
>>>
>> Thanks for the tips. This is what I'm currently contemplating:
>>
>> 1. Main interface starts in user's R session, and opens up the interface
>> (HTML/Javascript using Rook package)
>> 2. When analysis starts, Rserve is started, with its own web server, using
>> Rook, for status updates
>> 3. During analysis, main process calls a callback function which uses
>> RSassign() to send progress updates to the Rserve server
>> 4. HTML/Javascript interface can connect to the webserver on the Rserve
>> server to get status updates
>> 5. When analysis is done, use RSshutdown() and RSclose() to clean up.
>>
>> Does this seem reasonable?
>>
>> One problem I'm having is that when I start Rook on the Rserve server, the
>> webserver does not respond (although it is started). Does Rserve only
>> respond to requests on the port assigned for RSclient commands?
>>
>> Best,
>> Richard
>>
>> Here's an example:
>>
>> #######################
>>
>> library(Rserve)
>>
>> ### This works:
>>
>> stuff = expression({
>>
>>    library(Rook)
>>    s <- Rhttpd$new()
>>    s$add(
>>      app=system.file('exampleApps/helloworld.R',package='Rook'),
>>      name='hello'
>>    )
>>    s$start(quiet=TRUE)
>>    s$browse(1)
>>    print(s$full_url(1))
>> })
>>
>> # This will open the browser to the test app, asking for your name
>> eval(stuff)
>>
>> ### This does not:
>>
>> Rserve(args="--no-save")
>> c <- RSconnect()
>> RSassign(c, stuff)
>>
>> # This opens the browser to the correct URL, but the webserver doesn't
>> respond.
>> RSeval(c, quote(eval(stuff)))
>>
>>
>> #####
>> # cleanup
>> RSshutdown(c)
>> RSclose(c)
>>
> This "works" for me if I omit the quote(). I get an error, but the
> webapp seems to work. Also, I didn't eval(stuff) locally, only on the
> server:
I'll try this in a bit and see what happens.

I forgot my sessionInfo()...

 > sessionInfo()
R version 2.15.1 (2012-06-22)
Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)

locale:
[1] en_AU.UTF-8/en_AU.UTF-8/en_AU.UTF-8/C/en_AU.UTF-8/en_AU.UTF-8

attached base packages:
[1] tools     stats     graphics  grDevices utils     datasets methods   
base

other attached packages:
[1] Rook_1.0-8   brew_1.0-6   Rserve_0.6-8


From simon.urbanek at r-project.org  Thu Oct 25 19:44:15 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 25 Oct 2012 13:44:15 -0400
Subject: [Rd] concurrent requests (Rook,
	but I think the question is more general)
In-Reply-To: <50895EAA.50403@rug.nl>
References: <50882FC1.40608@rug.nl>
	<F8B3AAEF-822A-4970-BD6A-AB88FF8E8B9B@r-project.org>
	<50883CD9.1090509@rug.nl>
	<FEE1BFBC-494F-4CA6-BBE8-5F3D4D8559CD@r-project.org>
	<508845EB.2090007@rug.nl>
	<F1CBF6BC-B328-4298-9033-1859F04CD67B@r-project.org>
	<508850F4.8090208@rug.nl>
	<3E5C503F-4CE8-4130-B255-011C20C7D438@r-project.org>
	<50895EAA.50403@rug.nl>
Message-ID: <D81F9050-F5E1-421E-B295-87AD83BA1578@r-project.org>

Richard,

that is not what I had in mind :). Also Rserve 0.x doesn't have built-in HTTP, only the 1.x series does. Unfortunately I don't have any time today to write example code, but I would suggest using HTTP for both - just have a hook that simply accepts serialized R object in the body of the HTTP request and assigns it to your result. Then you have a second hook that delivers the result back (in whatever form you want it). It should be really easy to do with Rook in a separate process. In your computation session you simply fire off a HTTP POST request with the current status as a serialized R object.

Cheers,
Simon



On Oct 25, 2012, at 11:45 AM, Richard D. Morey wrote:

> On 24/10/12 10:55 PM, Simon Urbanek wrote:
>> 
>> The point is that you need a separate monitoring process or threads. That process can be R, Rserve or any thing else.
>> 
>> 
>> 
> 
> Thanks for the tips. This is what I'm currently contemplating:
> 
> 1. Main interface starts in user's R session, and opens up the interface (HTML/Javascript using Rook package)
> 2. When analysis starts, Rserve is started, with its own web server, using Rook, for status updates
> 3. During analysis, main process calls a callback function which uses RSassign() to send progress updates to the Rserve server
> 4. HTML/Javascript interface can connect to the webserver on the Rserve server to get status updates
> 5. When analysis is done, use RSshutdown() and RSclose() to clean up.
> 
> Does this seem reasonable?
> 
> One problem I'm having is that when I start Rook on the Rserve server, the webserver does not respond (although it is started). Does Rserve only respond to requests on the port assigned for RSclient commands?
> 
> Best,
> Richard
> 
> Here's an example:
> 
> #######################
> 
> library(Rserve)
> 
> ### This works:
> 
> stuff = expression({
>  library(Rook)
>  s <- Rhttpd$new()
>  s$add(
>    app=system.file('exampleApps/helloworld.R',package='Rook'),
>    name='hello'
>  )
>  s$start(quiet=TRUE)
>  s$browse(1)
>  print(s$full_url(1))
> })
> 
> # This will open the browser to the test app, asking for your name
> eval(stuff)
> 
> ### This does not:
> 
> Rserve(args="--no-save")
> c <- RSconnect()
> RSassign(c, stuff)
> 
> # This opens the browser to the correct URL, but the webserver doesn't respond.
> RSeval(c, quote(eval(stuff)))
> 
> 
> #####
> # cleanup
> RSshutdown(c)
> RSclose(c)
> 
> 
> 
> 
> 
> 


From bbolker at gmail.com  Fri Oct 26 01:18:22 2012
From: bbolker at gmail.com (Ben Bolker)
Date: Thu, 25 Oct 2012 19:18:22 -0400
Subject: [Rd] trivial typo in relist.Rd
Message-ID: <5089C8BE.5010506@mcmaster.ca>

in src/library/utils/man/relist.Rd, line 50:

  objects into a vector representation.  \code{relist()}, it's methods and

  spurious apostrophe ...

  Ben Bolker


From murdoch.duncan at gmail.com  Fri Oct 26 01:51:42 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 25 Oct 2012 19:51:42 -0400
Subject: [Rd] trivial typo in relist.Rd
In-Reply-To: <5089C8BE.5010506@mcmaster.ca>
References: <5089C8BE.5010506@mcmaster.ca>
Message-ID: <5089D08E.4060802@gmail.com>

On 12-10-25 7:18 PM, Ben Bolker wrote:
> in src/library/utils/man/relist.Rd, line 50:
>
>    objects into a vector representation.  \code{relist()}, it's methods and
>
>    spurious apostrophe ...
>

Thanks, will fix.

Duncan Murdoch


From mtmorgan at fhcrc.org  Fri Oct 26 06:35:59 2012
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Fri, 26 Oct 2012 05:35:59 +0100
Subject: [Rd] parallel::pvec FUN types differ when v is a list;
	code simplifications?
In-Reply-To: <CCAD6650.13593%mec@stowers.org>
References: <CCAD6650.13593%mec@stowers.org>
Message-ID: <508A132F.2040804@fhcrc.org>


In pvec(list(1, 2), FUN, mc.cores=2) FUN sees integer() arguments whereas 
pvec(list(1, 2, 3), FUN, mc.cores=2) FUN sees list() arguments; the latter seems 
consistent with pvec's description.

This came up in a complicated Bioconductor thread about generics and parallel 
evaluation

   https://stat.ethz.ch/pipermail/bioc-devel/2012-October/003745.html

One relevant point is that a light-weight re-write of parallel/R/unix/pvec.R 
(below) appears to avoid the need for an object v to satisfy

   is.vector
   as.list
   [

and instead only requires

   [

This can be important when as.list() forces an inefficient representation of an 
object that can nonetheless be subset with [. It also seems like the code below 
will be more space efficient, since v is not split into a second object in the 
parent but only subset in the children?

Index: pvec.R
===================================================================
--- pvec.R	(revision 61012)
+++ pvec.R	(working copy)
@@ -21,8 +21,6 @@
   pvec <- function(v, FUN, ..., mc.set.seed = TRUE, mc.silent = FALSE,
                    mc.cores = getOption("mc.cores", 2L), mc.cleanup = TRUE)
   {
-    if (!is.vector(v)) stop("'v' must be a vector")
-
       env <- parent.frame()
       cores <- as.integer(mc.cores)
       if(cores < 1L) stop("'mc.cores' must be >= 1")
@@ -31,16 +29,7 @@
       if(mc.set.seed) mc.reset.stream()

       n <- length(v)
-    l <- if (n <= cores) as.list(v) else {
-        ## compute the scheduling, making it as fair as possible
-        il <- as.integer(n / cores)
-        xc <- n - il * cores
-        sl <- rep(il, cores)
-        if (xc) sl[1:xc] <- il + 1L
-        si <- cumsum(c(1L, sl))
-        se <- si + c(sl, 0L) - 1L
-        lapply(seq_len(cores), function(ix) v[si[ix]:se[ix]])
-    }
+    si <- splitIndices(n, cores)
       jobs <- NULL
       cleanup <- function() {
           ## kill children if cleanup is requested
@@ -59,8 +48,8 @@
       on.exit(cleanup())
       FUN <- match.fun(FUN)
       ## may have more cores than tasks ....
-    jobs <- lapply(seq_len(min(n, cores)),
-                   function(i) mcparallel(FUN(l[[i]], ...), name = i,
+    jobs <- lapply(si,
+                   function(i) mcparallel(FUN(v[i], ...),
                                             mc.set.seed = mc.set.seed,
                                             silent = mc.silent))
       res <- mccollect(jobs)


On 10/24/2012 05:07 PM, Cook, Malcolm wrote:
> On 10/24/12 12:44 AM, "Michael Lawrence" <lawrence.michael at gene.com> wrote:
>
>> I agree that it would fruitful to have parLapply in BiocGenerics. It looks
>> to be a flexible abstraction and its presence in the parallel package
>> makes
>> it ubiquitous. If it hasn't been done already, mclapply (and mcmapply)
>> would be good candidates, as well. The fork-based parallelism is
>> substantively different in terms of the API from the more general
>> parallelism of parLapply.
>>
>> Someone was working on some more robust and convenient wrappers around
>> mclapply. Did that ever see the light of day?
>
>
> If you are referring to
> http://thread.gmane.org/gmane.science.biology.informatics.conductor/43660
>
> in which I had offered some small changes to parallel::pvec
>
> 	https://gist.github.com/3757873/
>
> and after which Martin had provided me with a route I have not (yet?)
> followed toward submitting a patch to R for consideration by R-devel /
> Simon Urbanek in
>
> http://grokbase.com/t/r/bioc-devel/129rbmxp5b/applying-over-granges-and-oth
> er-vectors-of-ranges#201209248dcn0tpwt7k7g9zsjr4dha6f1c
>
>
>
>
>>>> On Tue, Oct 23, 2012 at 12:13 PM, Steve Lianoglou <
>>>> mailinglist.honeypot at gmail.com**> wrote:
>>>>
>>>>   In response to a question from yesterday, I pointed someone to the
>>>>> ShortRead `srapply` function and I wondered to myself why it had to
>>>>> necessarily by "burried" in the ShortRead package (aside from it
>>>>> having a `sr` prefix).
>>>>>
>>>>
>>> I don't know that srapply necessarily 'got it right'...
>
>
> One thing I like about srapply is its support for a reduce argument.
>
>>>>> I had thought it might be a good idea to move that (or something like
>>>>> that) to BiocGenerics (unless implementations aren't allowed there)
>>>>> but also realized that it would add more dependencies where someone
>>>>> might not necessarily need them.
>
>
>>>>>
>>>>> But, almost surely, a large majority of the people will be happy to do
>>>>> some form of ||-ization, so in my mind it's not such an onerous thing
>>>>> to add -- on the other hand, this large majority is probably enriched
>>>>> for people who are doing NGS analysis, in which case, keeping it in
>>>>> ShortRead can make some sense.
>
> I remain confused about the need for putting any of this into BiocGenerics
> at all.  It seems to me that properly construed parallization primitives
> ought to 'just work' with any object which supports indexing and length.
>
> I would appreciate hearing arguments to the contrary.
>
> Florian, in a similar vein, could we not seek to change
> parallel::makeCluster to be extensible to, say, support SGE cluster?  THis
> seems like the 'right thing to do'.  ???
>
>
> Regardless, I think we have raised some considerations that might inform
> improvements to parallel, including points about error handling, reducing
> results, block-level parallization over List/Vector (in addition to
> vector), etc.
>
> I think perhaps having a google doc that we can collectively edit to
> contain the requirements we are trying to achieve might move us forward
> effectively. Would this help? Or perhaps a page under
> http://wiki.fhcrc.org/bioc/DeveloperPage/#discussions ???
>
>
>>>>> Taking one step back, I recall some chatter last week (or two) about
>>>>> some better ||-ization "primitives" -- something about a pvec doo-dad,
>>>>> and there being ideas to wrap different types of ||-ization behind an
>>>>> easy to use interface (I think this was the convo), and then I took a
>>>>> further step back and often wonder why we just don't bite the bullet
>>>>> and take advantage of the `foreach` infrastructure that is already out
>>>>> there -- in which case, I could imagne a "doSGE" package that might
>>>>> handle the particulars of what Florain is referring to. You could then
>>>>> configure it externally via some `registerDoSGE(some.config.**object)`
>>>>> and just have the package code happily run it through `foreach(...)
>>>>> %dopar%` and be done w/ it.
>>>>>
>>>>>
>>>>>   IMHO it is relevant.  I have not looked for other abstractions, and
>>>>> this
>>>> one seems
>>>> to work.  Florian's objectives might be a good test case for adequacy.
>>>>
>>>
>>> The registerDoDah does seem to be a useful abstraction.
>
> Is this not more-or-less the intention of parallel::setDefaultCluster?
>
> --Malcolm
>
>
>
>>>
>>> I think there's a lot of work to do for some sort of coordinated
>>> parallelization that putting parLapply into BiocGenerics might
>>> encourage;
>>> not good things will happen when everyone in a call stack tries to
>>> parallelize independently. But I'm in favor of parLapply in
>>> BiocGenerics at
>>> least for the moment.
>>>
>>> Martin
>>>
>>>
>>>
>>>>
>>>>   ... at least, I thought this is what was being talked about here (and
>>>>> popped up a week or two ago) -- sorry if I completely missed the mark
>>>>> ...
>>>>>
>>>>> -steve
>>>>>
>>>>>
>>>>> On Tue, Oct 23, 2012 at 10:38 AM, Hahne, Florian
>>>>> <florian.hahne at novartis.com> wrote:
>>>>>
>>>>>> Hi Martin,
>>>>>> I could define the generics in my own package, but that would mean
>>>>>> that
>>>>>> those will only be available there, or in the global environment
>>>>>> assuming
>>>>>> that I also export them, or in all additional packages that
>>>>>> explicitly
>>>>>> import them from my name space. Now there already are a whole bunch
>>>>>> of
>>>>>> packages around that all allow for parallelization via a cluster
>>>>>> object.
>>>>>> Obviously those all import the parLapply function from the parallel
>>>>>> package. That means that I can't simply supply my own modified
>>>>>> cluster
>>>>>> object, because the code that calls parLapply will not know about the
>>>>>> generic in my package, even if it is attached. Ideally parLapply
>>>>>> would
>>>>>> be
>>>>>> a generic function already in the parallel package. Not sure who
>>>>>> needs
>>>>>> to
>>>>>> be convinced in order for this to happen, but my gut feeling was
>>>>>> that it
>>>>>> could be easier to have the generic in BiocGenerics.
>>>>>> Maybe I am missing something obvious here, but imo there is no way to
>>>>>> overwrite parLapply globally for my own class unless the generic is
>>>>>> imported by everyone who wants to make use of the special method.
>>>>>> Florian
>>>>>> --
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>> On 10/23/12 2:20 PM, "Martin Morgan" <mtmorgan at fhcrc.org> wrote:
>>>>>>
>>>>>>   On 10/17/2012 05:45 AM, Hahne, Florian wrote:
>>>>>>>
>>>>>>>> Hi all,
>>>>>>>> I was wondering whether it would be possible to have proper
>>>>>>>> generics
>>>>>>>>
>>>>>>> for
>>>>>
>>>>>> some of the functions in the parallel package, e.g. parLapply and
>>>>>>>> clusterCall. The reason I am asking is because I want to build an
>>>>>>>> S4
>>>>>>>> class
>>>>>>>> that essentially looks like an S3 cluster object but knows how to
>>>>>>>> deal
>>>>>>>> with the SGE. That way I can abstract away all the overhead
>>>>>>>> regarding
>>>>>>>> job
>>>>>>>> submission, job status and reducing the results in the parLapply
>>>>>>>> method
>>>>>>>> of
>>>>>>>> that class, and would be able to supply this new cluster object to
>>>>>>>> all
>>>>>>>> of
>>>>>>>> my existing functions that can be processed in parallel using a
>>>>>>>> cluster
>>>>>>>> object as input. I have played around with the BatchJobs package
>>>>>>>> as an
>>>>>>>> abstraction layer to SGE and that work nicely. As a test case I
>>>>>>>> have
>>>>>>>> created the necessary generics myself in order to supply my own
>>>>>>>> SGEcluster
>>>>>>>> object to a function that normally deals with the "regular"
>>>>>>>> parallel
>>>>>>>> package S3 cluster objects and everything just worked out of the
>>>>>>>> box,
>>>>>>>> but
>>>>>>>> obviously this fails once I am in a name space and my generic is
>>>>>>>> not
>>>>>>>> found
>>>>>>>> anymore. Of course what we would really want is some proper
>>>>>>>> abstraction
>>>>>>>> of
>>>>>>>> parallelization in R, but for now this seem to be at least a cheap
>>>>>>>> compromise. Any thoughts on this?
>
>>>>>>>>
>>>>>>>
>>>>>>> Hi Florian -- we talked about this locally, but I guess we didn't
>>>>>>> actually send
>>>>>>> any email!
>>>>>>>
>>>>>>> Is there an obstacle to promoting these to generics in your own
>>>>>>> package?
>>>>>>> The
>>>>>>> usual motivation for inclusion in BiocGenerics has been to avoid
>>>>>>> conflicts
>>>>>>> between packages, but I'm not sure whether this is the case (yet)?
>>>>>>> This
>>>>>>> would
>>>>>>> also add a dependency fairly deep in the hierarchy.
>>>>>>>
>>>>>>> What do you think?
>>>>>>>
>>>>>>> Martin
>>>>>>>
>>>>>>>   Florian
>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>> --
>>>>>>> Computational Biology / Fred Hutchinson Cancer Research Center
>>>>>>> 1100 Fairview Ave. N.
>>>>>>> PO Box 19024 Seattle, WA 98109
>>>>>>>
>>>>>>> Location: Arnold Building M1 B861
>>>>>>> Phone: (206) 667-2793
>>>>>>>
>>>>>>
>>>>>> ______________________________**_________________
>>>>>> Bioc-devel at r-project.org mailing list
>>>>>>
>>>>>> https://stat.ethz.ch/mailman/**listinfo/bioc-devel<https://stat.ethz.c
>>>>>> h/mailman/listinfo/bioc-devel>
>>>>>>
>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> Steve Lianoglou
>>>>> Graduate Student: Computational Systems Biology
>>>>>    | Memorial Sloan-Kettering Cancer Center
>>>>>    | Weill Medical College of Cornell University
>>>>> Contact Info:
>>>>> http://cbio.mskcc.org/~lianos/**contact<http://cbio.mskcc.org/%7Elianos
>>>>> /contact>
>>>>>
>>>>> ______________________________**_________________
>>>>> Bioc-devel at r-project.org mailing list
>>>>>
>>>>> https://stat.ethz.ch/mailman/**listinfo/bioc-devel<https://stat.ethz.ch
>>>>> /mailman/listinfo/bioc-devel>
>>>>>
>>>>>
>>>>          [[alternative HTML version deleted]]
>>>>
>>>> ______________________________**_________________
>>>> Bioc-devel at r-project.org mailing list
>>>>
>>>> https://stat.ethz.ch/mailman/**listinfo/bioc-devel<https://stat.ethz.ch/
>>>> mailman/listinfo/bioc-devel>
>>>>
>>>>
>>>
>>> --
>>> Computational Biology / Fred Hutchinson Cancer Research Center
>>> 1100 Fairview Ave. N.
>>> PO Box 19024 Seattle, WA 98109
>>>
>>> Location: Arnold Building M1 B861
>>> Phone: (206) 667-2793
>>>
>>> ______________________________**_________________
>>> Bioc-devel at r-project.org mailing list
>>>
>>> https://stat.ethz.ch/mailman/**listinfo/bioc-devel<https://stat.ethz.ch/m
>>> ailman/listinfo/bioc-devel>
>>>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> Bioc-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/bioc-devel
>


-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From maechler at stat.math.ethz.ch  Fri Oct 26 11:17:50 2012
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 26 Oct 2012 11:17:50 +0200
Subject: [Rd] suppress *specific* warnings?
In-Reply-To: <508919AD.3090205@gmail.com>
References: <50844CC3.6020302@ufl.edu> <50849C77.6050106@fhcrc.org>
	<alpine.LFD.2.02.1210221153530.1869@nokomis.stat.uiowa.edu>
	<50868D80.10308@fhcrc.org>
	<20617.1591.947596.745192@stat.math.ethz.ch>
	<508919AD.3090205@gmail.com>
Message-ID: <20618.21822.411471.735141@stat.math.ethz.ch>

>>>>> Duncan Murdoch <murdoch.duncan at gmail.com>
>>>>>     on Thu, 25 Oct 2012 06:51:25 -0400 writes:

    > On 12-10-25 5:28 AM, Martin Maechler wrote:
    >> Sorry guys, for coming late,
    >> but *please* don't go there.
    >> 
    >> I've been there years ago,
    >> and found later why the approach is flawed "by design" :
    >> 
    >> Internationalization / Localization:
    >> 
    >> - If the warning comes from a "standard R" function,
    >> the warning is almost surely different in a (say) German
    >> locale, and your pattern won't be detected.
    >> 
    >> - Ditto if from a recommended package.
    >> 
    >> - If it is a warning that is not translated then it may be that
    >> it is just not *YET*  translated.

    > I think the other Martin's suggestion addressed this:  he matched the 
    > translated message, not the English original.

    > Duncan Murdoch

Well, I don't think I understand.
Of course you can only match "the message" that  warning() or
error()  {or rather tryCatch() ,...}  produces.
But you cannot guarantee nor know (for sure) if that message is 'original'
or translated.
"cannot", because AFAIK
we cannot guarantee  Sys.setlocale() is obeyed platform
independently:
You would have to query the current and save that, set it to C, get the
message, and then reset the locale to the previously saved one.
And these do not work reliably, on some platforms, AFAIK and
read our documentation.

Martin

    >> 
    >> The really dangerous thing about matching error / warning
    >> messages -- I had done it in the past with the error message I
    >> caught via tryCatch() --
    >> is that
    >> - in your tests the code will work perfectly.
    >> - on CRAN the code will work perfectly, as "they" also use
    >> the English (or C) locale.
    >> 
    >> So, by doing this you are distributing code that "almost always"
    >> works ... in your environment if you are US, UK or similarly
    >> based.
    >> 
    >> Indeed, a *really* dangerous practice.
    >> 
    >> Martin Maechler, ETH Zurich
    >> 
    >> 
    >> 
    >> 
    >>>>>>> Martin Morgan <mtmorgan at fhcrc.org>
    >>>>>>> on Tue, 23 Oct 2012 05:28:48 -0700 writes:
    >> 
    >> > On 10/22/2012 09:57 AM, luke-tierney at uiowa.edu wrote:
    >> >> On Sun, 21 Oct 2012, Martin Morgan wrote:
    >> >>
    >> >>> On 10/21/2012 12:28 PM, Ben Bolker wrote:
    >> >>>>
    >> >>>> Not desperately important, but nice to have and possibly of use to
    >> >>>> others, is the ability to suppress specific warnings rather than
    >> >>>> suppressing warnings indiscriminately.  I often know of a specific
    >> >>>> warning that I want to ignore (because I know that's it's a false
    >> >>>> positive/ignorable), but the current design of suppressWarnings() forces
    >> >>>> me to ignore *any* warnings coming from the expression.
    >> >>>>
    >> >>>> I started to write a new version that would check and, if supplied
    >> >>>> with a regular expression, would only block matching warnings and
    >> >>>> otherwise would produce the warnings as usual, but I don't quite know
    >> >>>> enough about what I'm doing: see ??? in expression below.
    >> >>>>
    >> >>>> Can anyone help, or suggest pointers to relevant
    >> >>>> examples/documentation (I've looked at demo(error.catching), which isn't
    >> >>>> helping me ... ?)
    >> >>>>
    >> >>>> suppressWarnings2 <- function(expr,regex=NULL) {
    >> >>>> opts <- options(warn = -1)
    >> >>>> on.exit(options(opts))
    >> >>>
    >> >>> I'm not really sure what the options(warn=-1) is doing there, maybe its for
    >> >>> efficiency to avoid generating a warning message (as distinct from signalling
    >> >>
    >> >> The sources in srs/library/base/conditions.R have
    >> >>
    >> >> suppressWarnings <- function(expr) {
    >> >> ops <- options(warn = -1) ## FIXME: temporary hack until R_tryEval
    >> >> on.exit(options(ops))     ## calls are removed from methods code
    >> >> withCallingHandlers(expr,
    >> >> warning=function(w)
    >> >> invokeRestart("muffleWarning"))
    >> >> }
    >> >>
    >> >> I uspect we have still not entirely eliminated R_tryEval in this context
    >> >> but I'm not sure. Will check when I get a chance.
    >> >>
    >> >>> a warning). I think you're after something like
    >> >>>
    >> >>> suppressWarnings2 <-
    >> >>> function(expr, regex=character())
    >> >>> {
    >> >>> withCallingHandlers(expr, warning=function(w) {
    >> >>> if (length(regex) == 1 && length(grep(regex, conditionMessage(w)))) {
    >> >>> invokeRestart("muffleWarning")
    >> >>> }
    >> >>> })
    >> >>> }
    >> >>
    >> >> A problem with using expression matching is of course that this fails
    >> >> with internationalized messages. Ideally warnings should be signaled as
    >> >> warning conditions of a particular class, and that class can be used
    >> >> to discriminate. Unfortunately very few warnings are designed this way.
    >> 
    >> > Probably specific messages, rather than patterns, would be handled and then
    >> 
    >> > suppressWarnings2 <- function(expr, messages = character())
    >> > {
    >> > opts <- options(warn = -1)
    >> > on.exit(options(ops))
    >> > withCallingHandlers(expr, warning=function(w) {
    >> > if (conditionMessage(w) %in% messages)
    >> > invokeRestart("muffleWarning")
    >> > })
    >> > }
    >> 
    >> > gives one the illusion of speaking many languages
    >> 
    >> > suppressWarnings2(log(-1), gettext("NaNs introduced", domain="R"))
    >> 
    >> > Martin
    >> 
    >> >>
    >> >> Best,
    >> >>
    >> >> luke
    >> >>
    >> >>>
    >> >>> If the  restart isn't invoked, then the next handler is called and the warning
    >> >>> is handled as normal. So with
    >> >>>
    >> >>> f <- function() {
    >> >>> warning("oops")
    >> >>> 2
    >> >>> }
    >> >>>
    >> >>> there is
    >> >>>
    >> >>>> suppressWarnings2(f())
    >> >>> [1] 2
    >> >>> Warning message:
    >> >>> In f() : oops
    >> >>>> suppressWarnings2(f(), "oops")
    >> >>> [1] 2
    >> >>>
    >> >>> For your own code I think a better strategy is to create a sub-class of
    >> >>> warnings that can be handled differently
    >> >>>
    >> >>> mywarn <-
    >> >>> function(..., call.=TRUE, immediate.=FALSE, domain=NULL)
    >> >>> {
    >> >>> msg <- .makeMessage(..., domain=domain, appendLF=FALSE)
    >> >>> call <- NULL
    >> >>> if (call.)
    >> >>> call <- sys.call(1L)
    >> >>> class <- c("silencable", "simpleWarning",  "warning", "condition")
    >> >>> cond <- structure(list(message=msg, call=call), class=class)
    >> >>> warning(cond)
    >> >>> }
    >> >>>
    >> >>> suppressWarnings3 <-
    >> >>> function(expr)
    >> >>> {
    >> >>> withCallingHandlers(expr, silencable=function(w) {
    >> >>> invokeRestart("muffleWarning")
    >> >>> })
    >> >>> }
    >> >>>
    >> >>> then with
    >> >>>
    >> >>> g <- function() {
    >> >>> mywarn("oops")
    >> >>> 3
    >> >>> }
    >> >>>
    >> >>>> suppressWarnings3(f())
    >> >>> [1] 2
    >> >>> Warning message:
    >> >>> In f() : oops
    >> >>>> g()
    >> >>> [1] 3
    >> >>> Warning message:
    >> >>> In g() : oops
    >> >>>> suppressWarnings3(g())
    >> >>> [1] 3
    >> >>>
    >> >>>> withCallingHandlers(expr, warning = function(w) {
    >> >>>> ## browser()
    >> >>>> if (is.null(regex) || grepl(w[["message"]],regex)) {
    >> >>>> invokeRestart("muffleWarning")
    >> >>>> } else {
    >> >>>> ## ? what do I here to get the warning issued?
    >> >>>> ## browser()
    >> >>>> ## computeRestarts() shows "browser",
    >> >>>> ##    "muffleWarning", and "abort" ...
    >> >>>> options(opts)
    >> >>>> warning(w$message)
    >> >>>> ## how can I get back from here to the calling point
    >> >>>> ##   *without* muffling warnings ... ?
    >> >>>> }
    >> >>>> })
    >> >>>> }
    >> >>>>
    >> >>>> suppressWarnings2(sqrt(-1))
    >> >>>> suppressWarnings2(sqrt(-1),"abc")
    >> >>>>
    >> >>>> It seems to me I'd like to have a restart option that just returns to
    >> >>>> the point where the warning was caught, *without* muffling warnings ...
    >> >>>> ?  But I don't quite understand how to set one up ...
    >> >>>>
    >> >>>> Ben Bolker
    >> >>>>
    >> >>>> ______________________________________________
    >> >>>> R-devel at r-project.org mailing list
    >> >>>> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> >>>>
    >> >>>
    >> >>>
    >> >>>
    >> >>
    >> 
    >> 
    >> > --
    >> > Computational Biology / Fred Hutchinson Cancer Research Center
    >> > 1100 Fairview Ave. N.
    >> > PO Box 19024 Seattle, WA 98109
    >> 
    >> > Location: Arnold Building M1 B861
    >> > Phone: (206) 667-2793
    >> 
    >> > ______________________________________________
    >> > R-devel at r-project.org mailing list
    >> > https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 
    >> ______________________________________________
    >> R-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >>


From Mayank.Bansal at mu-sigma.com  Fri Oct 26 13:01:01 2012
From: Mayank.Bansal at mu-sigma.com (Mayank Bansal)
Date: Fri, 26 Oct 2012 06:01:01 -0500
Subject: [Rd] Namespace Dependencies not required
Message-ID: <7073291669E5764EB68B5914AC4204744E30446371@AUSP01VMBX11.collaborationhost.net>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121026/fefb9d81/attachment.pl>

From pdalgd at gmail.com  Fri Oct 26 13:04:24 2012
From: pdalgd at gmail.com (peter dalgaard)
Date: Fri, 26 Oct 2012 13:04:24 +0200
Subject: [Rd] suppress *specific* warnings?
In-Reply-To: <20618.21822.411471.735141@stat.math.ethz.ch>
References: <50844CC3.6020302@ufl.edu> <50849C77.6050106@fhcrc.org>
	<alpine.LFD.2.02.1210221153530.1869@nokomis.stat.uiowa.edu>
	<50868D80.10308@fhcrc.org>
	<20617.1591.947596.745192@stat.math.ethz.ch>
	<508919AD.3090205@gmail.com>
	<20618.21822.411471.735141@stat.math.ethz.ch>
Message-ID: <5809ACD3-8FE3-4F57-AD7C-604DF82D8981@gmail.com>


On Oct 26, 2012, at 11:17 , Martin Maechler wrote:

>>>>>> Duncan Murdoch <murdoch.duncan at gmail.com>
>>>>>>    on Thu, 25 Oct 2012 06:51:25 -0400 writes:
> 
>> On 12-10-25 5:28 AM, Martin Maechler wrote:
>>> Sorry guys, for coming late,
>>> but *please* don't go there.
>>> 
>>> I've been there years ago,
>>> and found later why the approach is flawed "by design" :
>>> 
>>> Internationalization / Localization:
>>> 
>>> - If the warning comes from a "standard R" function,
>>> the warning is almost surely different in a (say) German
>>> locale, and your pattern won't be detected.
>>> 
>>> - Ditto if from a recommended package.
>>> 
>>> - If it is a warning that is not translated then it may be that
>>> it is just not *YET*  translated.
> 
>> I think the other Martin's suggestion addressed this:  he matched the 
>> translated message, not the English original.
> 
>> Duncan Murdoch
> 
> Well, I don't think I understand.
> Of course you can only match "the message" that  warning() or
> error()  {or rather tryCatch() ,...}  produces.
> But you cannot guarantee nor know (for sure) if that message is 'original'
> or translated.
> "cannot", because AFAIK
> we cannot guarantee  Sys.setlocale() is obeyed platform
> independently:
> You would have to query the current and save that, set it to C, get the
> message, and then reset the locale to the previously saved one.
> And these do not work reliably, on some platforms, AFAIK and
> read our documentation.

I think the point was to use gettext() on the pattern-to-match. If the warning is translated, so would this be. The main limitations would seem to be that you have to be d*mn sure to get the spelling right and, presumably, it only works with straight string translations, not variant forms like

     msgid "found %d fatal error"
     msgid_plural "found %d fatal errors"
     msgstr[0] "s'ha trobat %d error fatal"
     msgstr[1] "s'han trobat %d errors fatals"




> 
> Martin
> 
>>> 
>>> The really dangerous thing about matching error / warning
>>> messages -- I had done it in the past with the error message I
>>> caught via tryCatch() --
>>> is that
>>> - in your tests the code will work perfectly.
>>> - on CRAN the code will work perfectly, as "they" also use
>>> the English (or C) locale.
>>> 
>>> So, by doing this you are distributing code that "almost always"
>>> works ... in your environment if you are US, UK or similarly
>>> based.
>>> 
>>> Indeed, a *really* dangerous practice.
>>> 
>>> Martin Maechler, ETH Zurich
>>> 
>>> 
>>> 
>>> 
>>>>>>>> Martin Morgan <mtmorgan at fhcrc.org>
>>>>>>>> on Tue, 23 Oct 2012 05:28:48 -0700 writes:
>>> 
>>>> On 10/22/2012 09:57 AM, luke-tierney at uiowa.edu wrote:
>>>>> On Sun, 21 Oct 2012, Martin Morgan wrote:
>>>>> 
>>>>>> On 10/21/2012 12:28 PM, Ben Bolker wrote:
>>>>>>> 
>>>>>>> Not desperately important, but nice to have and possibly of use to
>>>>>>> others, is the ability to suppress specific warnings rather than
>>>>>>> suppressing warnings indiscriminately.  I often know of a specific
>>>>>>> warning that I want to ignore (because I know that's it's a false
>>>>>>> positive/ignorable), but the current design of suppressWarnings() forces
>>>>>>> me to ignore *any* warnings coming from the expression.
>>>>>>> 
>>>>>>> I started to write a new version that would check and, if supplied
>>>>>>> with a regular expression, would only block matching warnings and
>>>>>>> otherwise would produce the warnings as usual, but I don't quite know
>>>>>>> enough about what I'm doing: see ??? in expression below.
>>>>>>> 
>>>>>>> Can anyone help, or suggest pointers to relevant
>>>>>>> examples/documentation (I've looked at demo(error.catching), which isn't
>>>>>>> helping me ... ?)
>>>>>>> 
>>>>>>> suppressWarnings2 <- function(expr,regex=NULL) {
>>>>>>> opts <- options(warn = -1)
>>>>>>> on.exit(options(opts))
>>>>>> 
>>>>>> I'm not really sure what the options(warn=-1) is doing there, maybe its for
>>>>>> efficiency to avoid generating a warning message (as distinct from signalling
>>>>> 
>>>>> The sources in srs/library/base/conditions.R have
>>>>> 
>>>>> suppressWarnings <- function(expr) {
>>>>> ops <- options(warn = -1) ## FIXME: temporary hack until R_tryEval
>>>>> on.exit(options(ops))     ## calls are removed from methods code
>>>>> withCallingHandlers(expr,
>>>>> warning=function(w)
>>>>> invokeRestart("muffleWarning"))
>>>>> }
>>>>> 
>>>>> I uspect we have still not entirely eliminated R_tryEval in this context
>>>>> but I'm not sure. Will check when I get a chance.
>>>>> 
>>>>>> a warning). I think you're after something like
>>>>>> 
>>>>>> suppressWarnings2 <-
>>>>>> function(expr, regex=character())
>>>>>> {
>>>>>> withCallingHandlers(expr, warning=function(w) {
>>>>>> if (length(regex) == 1 && length(grep(regex, conditionMessage(w)))) {
>>>>>> invokeRestart("muffleWarning")
>>>>>> }
>>>>>> })
>>>>>> }
>>>>> 
>>>>> A problem with using expression matching is of course that this fails
>>>>> with internationalized messages. Ideally warnings should be signaled as
>>>>> warning conditions of a particular class, and that class can be used
>>>>> to discriminate. Unfortunately very few warnings are designed this way.
>>> 
>>>> Probably specific messages, rather than patterns, would be handled and then
>>> 
>>>> suppressWarnings2 <- function(expr, messages = character())
>>>> {
>>>> opts <- options(warn = -1)
>>>> on.exit(options(ops))
>>>> withCallingHandlers(expr, warning=function(w) {
>>>> if (conditionMessage(w) %in% messages)
>>>> invokeRestart("muffleWarning")
>>>> })
>>>> }
>>> 
>>>> gives one the illusion of speaking many languages
>>> 
>>>> suppressWarnings2(log(-1), gettext("NaNs introduced", domain="R"))
>>> 
>>>> Martin
>>> 
>>>>> 
>>>>> Best,
>>>>> 
>>>>> luke
>>>>> 
>>>>>> 
>>>>>> If the  restart isn't invoked, then the next handler is called and the warning
>>>>>> is handled as normal. So with
>>>>>> 
>>>>>> f <- function() {
>>>>>> warning("oops")
>>>>>> 2
>>>>>> }
>>>>>> 
>>>>>> there is
>>>>>> 
>>>>>>> suppressWarnings2(f())
>>>>>> [1] 2
>>>>>> Warning message:
>>>>>> In f() : oops
>>>>>>> suppressWarnings2(f(), "oops")
>>>>>> [1] 2
>>>>>> 
>>>>>> For your own code I think a better strategy is to create a sub-class of
>>>>>> warnings that can be handled differently
>>>>>> 
>>>>>> mywarn <-
>>>>>> function(..., call.=TRUE, immediate.=FALSE, domain=NULL)
>>>>>> {
>>>>>> msg <- .makeMessage(..., domain=domain, appendLF=FALSE)
>>>>>> call <- NULL
>>>>>> if (call.)
>>>>>> call <- sys.call(1L)
>>>>>> class <- c("silencable", "simpleWarning",  "warning", "condition")
>>>>>> cond <- structure(list(message=msg, call=call), class=class)
>>>>>> warning(cond)
>>>>>> }
>>>>>> 
>>>>>> suppressWarnings3 <-
>>>>>> function(expr)
>>>>>> {
>>>>>> withCallingHandlers(expr, silencable=function(w) {
>>>>>> invokeRestart("muffleWarning")
>>>>>> })
>>>>>> }
>>>>>> 
>>>>>> then with
>>>>>> 
>>>>>> g <- function() {
>>>>>> mywarn("oops")
>>>>>> 3
>>>>>> }
>>>>>> 
>>>>>>> suppressWarnings3(f())
>>>>>> [1] 2
>>>>>> Warning message:
>>>>>> In f() : oops
>>>>>>> g()
>>>>>> [1] 3
>>>>>> Warning message:
>>>>>> In g() : oops
>>>>>>> suppressWarnings3(g())
>>>>>> [1] 3
>>>>>> 
>>>>>>> withCallingHandlers(expr, warning = function(w) {
>>>>>>> ## browser()
>>>>>>> if (is.null(regex) || grepl(w[["message"]],regex)) {
>>>>>>> invokeRestart("muffleWarning")
>>>>>>> } else {
>>>>>>> ## ? what do I here to get the warning issued?
>>>>>>> ## browser()
>>>>>>> ## computeRestarts() shows "browser",
>>>>>>> ##    "muffleWarning", and "abort" ...
>>>>>>> options(opts)
>>>>>>> warning(w$message)
>>>>>>> ## how can I get back from here to the calling point
>>>>>>> ##   *without* muffling warnings ... ?
>>>>>>> }
>>>>>>> })
>>>>>>> }
>>>>>>> 
>>>>>>> suppressWarnings2(sqrt(-1))
>>>>>>> suppressWarnings2(sqrt(-1),"abc")
>>>>>>> 
>>>>>>> It seems to me I'd like to have a restart option that just returns to
>>>>>>> the point where the warning was caught, *without* muffling warnings ...
>>>>>>> ?  But I don't quite understand how to set one up ...
>>>>>>> 
>>>>>>> Ben Bolker
>>>>>>> 
>>>>>>> ______________________________________________
>>>>>>> R-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> 
>>>>> 
>>> 
>>> 
>>>> --
>>>> Computational Biology / Fred Hutchinson Cancer Research Center
>>>> 1100 Fairview Ave. N.
>>>> PO Box 19024 Seattle, WA 98109
>>> 
>>>> Location: Arnold Building M1 B861
>>>> Phone: (206) 667-2793
>>> 
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From ripley at stats.ox.ac.uk  Fri Oct 26 14:20:18 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 26 Oct 2012 13:20:18 +0100
Subject: [Rd] suppress *specific* warnings?
In-Reply-To: <5809ACD3-8FE3-4F57-AD7C-604DF82D8981@gmail.com>
References: <50844CC3.6020302@ufl.edu> <50849C77.6050106@fhcrc.org>
	<alpine.LFD.2.02.1210221153530.1869@nokomis.stat.uiowa.edu>
	<50868D80.10308@fhcrc.org>
	<20617.1591.947596.745192@stat.math.ethz.ch>
	<508919AD.3090205@gmail.com>
	<20618.21822.411471.735141@stat.math.ethz.ch>
	<5809ACD3-8FE3-4F57-AD7C-604DF82D8981@gmail.com>
Message-ID: <508A8002.3020408@stats.ox.ac.uk>

On 26/10/2012 12:04, peter dalgaard wrote:
>
> On Oct 26, 2012, at 11:17 , Martin Maechler wrote:
>
>>>>>>> Duncan Murdoch <murdoch.duncan at gmail.com>
>>>>>>>     on Thu, 25 Oct 2012 06:51:25 -0400 writes:
>>
>>> On 12-10-25 5:28 AM, Martin Maechler wrote:
>>>> Sorry guys, for coming late,
>>>> but *please* don't go there.
>>>>
>>>> I've been there years ago,
>>>> and found later why the approach is flawed "by design" :
>>>>
>>>> Internationalization / Localization:
>>>>
>>>> - If the warning comes from a "standard R" function,
>>>> the warning is almost surely different in a (say) German
>>>> locale, and your pattern won't be detected.
>>>>
>>>> - Ditto if from a recommended package.
>>>>
>>>> - If it is a warning that is not translated then it may be that
>>>> it is just not *YET*  translated.
>>
>>> I think the other Martin's suggestion addressed this:  he matched the
>>> translated message, not the English original.
>>
>>> Duncan Murdoch
>>
>> Well, I don't think I understand.
>> Of course you can only match "the message" that  warning() or
>> error()  {or rather tryCatch() ,...}  produces.
>> But you cannot guarantee nor know (for sure) if that message is 'original'
>> or translated.
>> "cannot", because AFAIK
>> we cannot guarantee  Sys.setlocale() is obeyed platform
>> independently:
>> You would have to query the current and save that, set it to C, get the
>> message, and then reset the locale to the previously saved one.
>> And these do not work reliably, on some platforms, AFAIK and
>> read our documentation.
>
> I think the point was to use gettext() on the pattern-to-match. If
> the  warning is translated, so would this be. The main limitations would seem
to be that you have to be d*mn sure to get the spelling right and,
presumably, it only works with straight string translations, not variant
forms like
>
>       msgid "found %d fatal error"
>       msgid_plural "found %d fatal errors"
>       msgstr[0] "s'ha trobat %d error fatal"
>       msgstr[1] "s'han trobat %d errors fatals"

Yes: you also need to get the domain right (and it would be unsafe not 
to specify it on the gettext() call).  And C-level messages do move 
between domains; for example between R 2.15.x and R-devel most of the 
graphics ones have moved from 'R' to 'graphics'.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From edd at debian.org  Fri Oct 26 16:07:09 2012
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 26 Oct 2012 09:07:09 -0500
Subject: [Rd] R 2.15.2 still missing two files useful with the X11 icon patch
Message-ID: <20618.39181.371366.555549@max.nulle.part>


Congrats on getting 2.15.2 out on schedule. Debian builds have been uploaded.

It is my understanding that Phil's patch for the X11 logo -- so promimently
featured as the first item in the NEWS file for the release -- offers more
when two extra files are supplied.  I have supplied these for the Debian test
release, for our 2.15.1-* releases and again now.  We install these files as

	 /usr/share/icons/hicolor/48x48/apps/rlogo_icon.png
	 /usr/share/applications/R.desktop

and I would urge R Core to do the same so that users of other binaries get
the same benefit.  I have in fact mailed twice already before about this.  As
I understand, with the 'desktop' files and the png it references, menus
showing R as an entry get more meta info, and a crisper (png) logo.

Now, the NEWS file entry is also half-incorrect. The benefit of the patch is
visible in Ubuntu, nomatter which desktop env you use, but not limited to
it. Even under Windows 7, the taskbar now supplies the R icon when the
patched Debian / Ubuntu build is used --- but not with an rpm build of 2.15.1
where the generic x11 icon is shown.  Having R windows visually identified as
such is very useful, no matter the Linux or X11 flavour. And that is what
Phil's patch does this: adds the feature no matter the X11 GUI or desktop
environment.

Dirk


-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From pgilbert902 at gmail.com  Fri Oct 26 17:37:09 2012
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Fri, 26 Oct 2012 11:37:09 -0400
Subject: [Rd] R 2.15.2 make check failure on 32-bit --with-blas="-lgoto2"
In-Reply-To: <BB567862-451A-4831-9454-721868A41069@cbs.dk>
References: <BB567862-451A-4831-9454-721868A41069@cbs.dk>
Message-ID: <508AAE25.6090500@gmail.com>

Is --with-blas="-lgoto2"  a known problem (other than possibly not being 
the preferred choice)?

I thought I had been testing RC with the same setup I regularly use, but 
I now see there was a slight difference. I am now getting the following 
failure in make check on  32-bit Ubuntu 12.04, configuring with 
--with-blas="-lgoto2". (These may not be surprising statistically or 
numerically, but it is a bit disconcerting when make check fails.)

...
Testing examples for package ?stats?
   comparing ?stats-Ex.Rout? to ?stats-Ex.Rout.save? ...
2959c2959
< N:K        1  33.13   33.13   2.146 0.16865
---
 > N:K        1  33.14   33.14   2.146 0.16865
12782c12782
< Murder   -0.536  0.418  0.341  0.649
---
 > Murder   -0.536  0.418 -0.341  0.649
12783c12783
< Assault  -0.583  0.188  0.268 -0.743
---
 > Assault  -0.583  0.188 -0.268 -0.743
12784c12784
< UrbanPop -0.278 -0.873  0.378  0.134
---
 > UrbanPop -0.278 -0.873 -0.378  0.134
12785c12785
< Rape     -0.543 -0.167 -0.818
---
 > Rape     -0.543 -0.167  0.818
12943c12943
< 6  -0.5412  20.482886    -0.845157
---
 > 6  -0.5412  20.482887    -0.845157
14481c14481
< Sum of Squares   780.1250  276.1250 2556.1250  112.5000  774.0937
---
 > Sum of Squares   780.1250  276.1250 2556.1250  112.5000  774.0938
15571c15571
< Murder   -0.54   0.42   0.34   0.65
---
 > Murder   -0.54   0.42  -0.34   0.65
15572c15572
< Assault  -0.58          0.27  -0.74
---
 > Assault  -0.58         -0.27  -0.74
15573c15573
< UrbanPop -0.28  -0.87   0.38
---
 > UrbanPop -0.28  -0.87  -0.38
15574c15574
< Rape     -0.54         -0.82
---
 > Rape     -0.54          0.82
Testing examples for package ?datasets?
   comparing ?datasets-Ex.Rout? to ?datasets-Ex.Rout.save? ... OK
...

I inadvertently seemed to have set things slightly differently while 
testing RC. While testing the RC,  I was using
./configure --prefix=/home/paul/RoboRC/R-test/  --enable-R-shlib

and configure gave
...
   External libraries:        readline
   Additional capabilities:   PNG, NLS
   Options enabled:           shared R library, shared BLAS, R 
profiling, Java

whereas with the release I used
./configure --prefix=/home/paul/RoboAdmin/R-2.15.2 --enable-R-shlib 
--with-blas="-lgoto2"

and configure gave
...
   External libraries:        readline, BLAS(generic)
   Additional capabilities:   PNG, NLS
   Options enabled:           shared R library, R profiling, Java

Thanks,
Paul


From ripley at stats.ox.ac.uk  Fri Oct 26 18:15:55 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 26 Oct 2012 17:15:55 +0100
Subject: [Rd] R 2.15.2 make check failure on 32-bit --with-blas="-lgoto2"
In-Reply-To: <508AAE25.6090500@gmail.com>
References: <BB567862-451A-4831-9454-721868A41069@cbs.dk>
	<508AAE25.6090500@gmail.com>
Message-ID: <508AB73B.7060604@stats.ox.ac.uk>

On 26/10/2012 16:37, Paul Gilbert wrote:
> Is --with-blas="-lgoto2"  a known problem (other than possibly not being
> the preferred choice)?

And what precisely is it? And what chipset are you using?

> I thought I had been testing RC with the same setup I regularly use, but
> I now see there was a slight difference. I am now getting the following
> failure in make check on  32-bit Ubuntu 12.04, configuring with
> --with-blas="-lgoto2". (These may not be surprising statistically or
> numerically, but it is a bit disconcerting when make check fails.)

No failure shown here ...  surely you know that the signs of principal 
components are not determined?

And 32-bit platforms seem prone to round in different ways (to each 
other and to 64-bit platforms): the differences in the last digit are 
typical of 32-bit platforms.

> ...
> Testing examples for package ?stats?
>    comparing ?stats-Ex.Rout? to ?stats-Ex.Rout.save? ...
> 2959c2959
> < N:K        1  33.13   33.13   2.146 0.16865
> ---
>  > N:K        1  33.14   33.14   2.146 0.16865
> 12782c12782
> < Murder   -0.536  0.418  0.341  0.649
> ---
>  > Murder   -0.536  0.418 -0.341  0.649
> 12783c12783
> < Assault  -0.583  0.188  0.268 -0.743
> ---
>  > Assault  -0.583  0.188 -0.268 -0.743
> 12784c12784
> < UrbanPop -0.278 -0.873  0.378  0.134
> ---
>  > UrbanPop -0.278 -0.873 -0.378  0.134
> 12785c12785
> < Rape     -0.543 -0.167 -0.818
> ---
>  > Rape     -0.543 -0.167  0.818
> 12943c12943
> < 6  -0.5412  20.482886    -0.845157
> ---
>  > 6  -0.5412  20.482887    -0.845157
> 14481c14481
> < Sum of Squares   780.1250  276.1250 2556.1250  112.5000  774.0937
> ---
>  > Sum of Squares   780.1250  276.1250 2556.1250  112.5000  774.0938
> 15571c15571
> < Murder   -0.54   0.42   0.34   0.65
> ---
>  > Murder   -0.54   0.42  -0.34   0.65
> 15572c15572
> < Assault  -0.58          0.27  -0.74
> ---
>  > Assault  -0.58         -0.27  -0.74
> 15573c15573
> < UrbanPop -0.28  -0.87   0.38
> ---
>  > UrbanPop -0.28  -0.87  -0.38
> 15574c15574
> < Rape     -0.54         -0.82
> ---
>  > Rape     -0.54          0.82
> Testing examples for package ?datasets?
>    comparing ?datasets-Ex.Rout? to ?datasets-Ex.Rout.save? ... OK
> ...
>
> I inadvertently seemed to have set things slightly differently while
> testing RC. While testing the RC,  I was using
> ./configure --prefix=/home/paul/RoboRC/R-test/  --enable-R-shlib
>
> and configure gave
> ...
>    External libraries:        readline
>    Additional capabilities:   PNG, NLS
>    Options enabled:           shared R library, shared BLAS, R
> profiling, Java
>
> whereas with the release I used
> ./configure --prefix=/home/paul/RoboAdmin/R-2.15.2 --enable-R-shlib
> --with-blas="-lgoto2"
>
> and configure gave
> ...
>    External libraries:        readline, BLAS(generic)
>    Additional capabilities:   PNG, NLS
>    Options enabled:           shared R library, R profiling, Java
>
> Thanks,
> Paul
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From pgilbert902 at gmail.com  Fri Oct 26 20:58:06 2012
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Fri, 26 Oct 2012 14:58:06 -0400
Subject: [Rd] R 2.15.2 make check failure on 32-bit --with-blas="-lgoto2"
In-Reply-To: <508AB73B.7060604@stats.ox.ac.uk>
References: <BB567862-451A-4831-9454-721868A41069@cbs.dk>
	<508AAE25.6090500@gmail.com> <508AB73B.7060604@stats.ox.ac.uk>
Message-ID: <508ADD3E.4060301@gmail.com>



On 12-10-26 12:15 PM, Prof Brian Ripley wrote:
> On 26/10/2012 16:37, Paul Gilbert wrote:
>> Is --with-blas="-lgoto2"  a known problem (other than possibly not being
>> the preferred choice)?
>
> And what precisely is it? And what chipset are you using?
>
>> I thought I had been testing RC with the same setup I regularly use, but
>> I now see there was a slight difference. I am now getting the following
>> failure in make check on  32-bit Ubuntu 12.04, configuring with
>> --with-blas="-lgoto2". (These may not be surprising statistically or
>> numerically, but it is a bit disconcerting when make check fails.)
>
> No failure shown here ...  surely you know that the signs of principal
> components are not determined?

I apologize, I missed the real error. (But yes, I am aware of this, and 
also that I should expect precision differences with different libraries 
and different architectures.) I thought for a moment that make was 
throwing an error because of the differences, but in fact it was later:

Testing examples for package ?grid?
   comparing ?grid-Ex.Rout? to ?grid-Ex.Rout.save? ... OK
Testing examples for package ?splines?
Error: testing 'splines' failed
Execution halted
make[3]: *** [test-Examples-Base] Error 1
make[3]: Leaving directory `/home/paul/RoboAdmin/R-2.15.2/tests/Examples'
make[2]: *** [test-Examples] Error 2
make[2]: Leaving directory `/home/paul/RoboAdmin/R-2.15.2/tests'
make[1]: *** [test-all-basics] Error 1
make[1]: Leaving directory `/home/paul/RoboAdmin/R-2.15.2/tests'
make: *** [check] Error 2
paul at toaster:~/RoboAdmin/R-2.15.2$


The problem seems to be here:

 > source("~/RoboAdmin/R-2.15.2/tests/Examples/splines-Ex.R")
List of 2
  $ x: num [1:51] 58 58.3 58.6 58.8 59.1 ...
  $ y: num [1:51] 115 115 116 117 117 ...
  - attr(*, "class")= chr "xyVector"
Warning in bs(height, degree = 3L, knots = c(62.6666666666667, 
67.3333333333333 :
   some 'x' values beyond boundary knots may cause ill-conditioned bases
Error: identical(ns(x, df = 2), ns(x, df = 2, knots = NULL)) is not TRUE
 > traceback()
6: stop(paste0(ch, " is not ", if (length(r) > 1L) "all ", "TRUE"),
        call. = FALSE)
5: stopifnot(identical(ns(x), ns(x, df = 1)), identical(ns(x, df = 2),
        ns(x, df = 2, knots = NULL)), !is.null(kk <- attr(ns(x),
        "knots")), length(kk) == 0) at splines-Ex.R#130
4: eval(expr, envir, enclos)
3: eval(ei, envir)
2: withVisible(eval(ei, envir))
1: source("~/RoboAdmin/R-2.15.2/tests/Examples/splines-Ex.R")
 >

It also seems that this error is transient. If I rerun several times, it 
does not always happen. Is anyone aware of other cases of transient 
problems with 32-bit goto2?

Here is the cpu info:

paul at toaster:~$ cat /proc/cpuinfo
processor	: 0
vendor_id	: GenuineIntel
cpu family	: 6
model		: 15
model name	: Intel(R) Core(TM)2 Duo CPU     T7300  @ 2.00GHz
stepping	: 10
microcode	: 0x92
cpu MHz		: 800.000
cache size	: 4096 KB
physical id	: 0
siblings	: 2
core id		: 0
cpu cores	: 2
apicid		: 0
initial apicid	: 0
fdiv_bug	: no
hlt_bug		: no
f00f_bug	: no
coma_bug	: no
fpu		: yes
fpu_exception	: yes
cpuid level	: 10
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 apic mtrr pge mca cmov pat 
pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe nx lm constant_tsc 
arch_perfmon pebs bts aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 
ssse3 cx16 xtpr pdcm lahf_lm ida dtherm tpr_shadow vnmi flexpriority
bogomips	: 3989.99
clflush size	: 64
cache_alignment	: 64
address sizes	: 36 bits physical, 48 bits virtual
power management:

processor	: 1
vendor_id	: GenuineIntel
cpu family	: 6
model		: 15
model name	: Intel(R) Core(TM)2 Duo CPU     T7300  @ 2.00GHz
stepping	: 10
microcode	: 0x92
cpu MHz		: 800.000
cache size	: 4096 KB
physical id	: 0
siblings	: 2
core id		: 1
cpu cores	: 2
apicid		: 1
initial apicid	: 1
fdiv_bug	: no
hlt_bug		: no
f00f_bug	: no
coma_bug	: no
fpu		: yes
fpu_exception	: yes
cpuid level	: 10
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 apic mtrr pge mca cmov pat 
pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe nx lm constant_tsc 
arch_perfmon pebs bts aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 
ssse3 cx16 xtpr pdcm lahf_lm ida dtherm tpr_shadow vnmi flexpriority
bogomips	: 3989.97
clflush size	: 64
cache_alignment	: 64
address sizes	: 36 bits physical, 48 bits virtual
power management:

Paul

>
> And 32-bit platforms seem prone to round in different ways (to each
> other and to 64-bit platforms): the differences in the last digit are
> typical of 32-bit platforms.
>
>> ...
>> Testing examples for package ?stats?
>>    comparing ?stats-Ex.Rout? to ?stats-Ex.Rout.save? ...
>> 2959c2959
>> < N:K        1  33.13   33.13   2.146 0.16865
>> ---
>>  > N:K        1  33.14   33.14   2.146 0.16865
>> 12782c12782
>> < Murder   -0.536  0.418  0.341  0.649
>> ---
>>  > Murder   -0.536  0.418 -0.341  0.649
>> 12783c12783
>> < Assault  -0.583  0.188  0.268 -0.743
>> ---
>>  > Assault  -0.583  0.188 -0.268 -0.743
>> 12784c12784
>> < UrbanPop -0.278 -0.873  0.378  0.134
>> ---
>>  > UrbanPop -0.278 -0.873 -0.378  0.134
>> 12785c12785
>> < Rape     -0.543 -0.167 -0.818
>> ---
>>  > Rape     -0.543 -0.167  0.818
>> 12943c12943
>> < 6  -0.5412  20.482886    -0.845157
>> ---
>>  > 6  -0.5412  20.482887    -0.845157
>> 14481c14481
>> < Sum of Squares   780.1250  276.1250 2556.1250  112.5000  774.0937
>> ---
>>  > Sum of Squares   780.1250  276.1250 2556.1250  112.5000  774.0938
>> 15571c15571
>> < Murder   -0.54   0.42   0.34   0.65
>> ---
>>  > Murder   -0.54   0.42  -0.34   0.65
>> 15572c15572
>> < Assault  -0.58          0.27  -0.74
>> ---
>>  > Assault  -0.58         -0.27  -0.74
>> 15573c15573
>> < UrbanPop -0.28  -0.87   0.38
>> ---
>>  > UrbanPop -0.28  -0.87  -0.38
>> 15574c15574
>> < Rape     -0.54         -0.82
>> ---
>>  > Rape     -0.54          0.82
>> Testing examples for package ?datasets?
>>    comparing ?datasets-Ex.Rout? to ?datasets-Ex.Rout.save? ... OK
>> ...
>>
>> I inadvertently seemed to have set things slightly differently while
>> testing RC. While testing the RC,  I was using
>> ./configure --prefix=/home/paul/RoboRC/R-test/  --enable-R-shlib
>>
>> and configure gave
>> ...
>>    External libraries:        readline
>>    Additional capabilities:   PNG, NLS
>>    Options enabled:           shared R library, shared BLAS, R
>> profiling, Java
>>
>> whereas with the release I used
>> ./configure --prefix=/home/paul/RoboAdmin/R-2.15.2 --enable-R-shlib
>> --with-blas="-lgoto2"
>>
>> and configure gave
>> ...
>>    External libraries:        readline, BLAS(generic)
>>    Additional capabilities:   PNG, NLS
>>    Options enabled:           shared R library, R profiling, Java
>>
>> Thanks,
>> Paul
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From plfjohnson at emory.edu  Fri Oct 26 17:20:50 2012
From: plfjohnson at emory.edu (Philip Johnson)
Date: Fri, 26 Oct 2012 11:20:50 -0400
Subject: [Rd] R 2.15.2 still missing two files useful with the X11 icon
	patch
In-Reply-To: <20618.39181.371366.555549@max.nulle.part>
References: <20618.39181.371366.555549@max.nulle.part>
Message-ID: <508AAA52.6000002@emory.edu>

Glad to see this as well.

Two notes on Dirk's comments:

   1) As Dirk wrote, the changes in 2.15.2 apply to almost any X11 
system (although, as the NEWS says, this change is particularly crucial 
with Ubuntu's new Unity interface).

   2) The additional two files mentioned by Dirk are only useful on 
systems complying with the freedesktop.org standards (i.e., at least 
gnome and kde).  With Unity, these files result in a crisper icon in the 
Unity launcher.

To summarize: the change in R 2.15.2 helps any X11 system.  The 
additional two files not yet in mainline R help only 
freedesktop.org-compliant systems -- although I can't imagine how they 
would hurt any other system.

Thanks for incorporating at least the first patch into main line 
development!

Regards,
Philip


On 10/26/2012 10:07 AM, Dirk Eddelbuettel wrote:
>
> Congrats on getting 2.15.2 out on schedule. Debian builds have been uploaded.
>
> It is my understanding that Phil's patch for the X11 logo -- so promimently
> featured as the first item in the NEWS file for the release -- offers more
> when two extra files are supplied.  I have supplied these for the Debian test
> release, for our 2.15.1-* releases and again now.  We install these files as
>
> 	 /usr/share/icons/hicolor/48x48/apps/rlogo_icon.png
> 	 /usr/share/applications/R.desktop
>
> and I would urge R Core to do the same so that users of other binaries get
> the same benefit.  I have in fact mailed twice already before about this.  As
> I understand, with the 'desktop' files and the png it references, menus
> showing R as an entry get more meta info, and a crisper (png) logo.
>
> Now, the NEWS file entry is also half-incorrect. The benefit of the patch is
> visible in Ubuntu, nomatter which desktop env you use, but not limited to
> it. Even under Windows 7, the taskbar now supplies the R icon when the
> patched Debian / Ubuntu build is used --- but not with an rpm build of 2.15.1
> where the generic x11 icon is shown.  Having R windows visually identified as
> such is very useful, no matter the Linux or X11 flavour. And that is what
> Phil's patch does this: adds the feature no matter the X11 GUI or desktop
> environment.
>
> Dirk
>
>


From nalimilan at club.fr  Sat Oct 27 13:39:06 2012
From: nalimilan at club.fr (Milan Bouchet-Valat)
Date: Sat, 27 Oct 2012 13:39:06 +0200
Subject: [Rd] contr.sum() and contrast names
Message-ID: <1351337946.21857.130.camel@milan>

Hi!

I would like to suggest to make it possible, in one way or another, to
get meaningful contrast names when using contr.sum(). Currently, when
using contr.treatment(), one gets factor levels as contrast names; but
when using contr.sum(), contrasts are merely numbered, which is not
practical and can lead to mistakes (see code at the end of this
message).

This issue was discussed quickly in 2005 by Brian Ripley in a reply to a
message on R-help [1]. He rightly stressed that treatment and sum
contrasts are not equivalent to levels of a factor, because one needs to
know the reference (here, level or sum) to interpret them. But when one
knows the type of contrasts that are being used, useful labels are still
of high value. I don't think anybody does serious work with sum
contrasts named myfactor1, myfactor2, myfactor3. (This reasoning does
not so much apply to contr.helmert() since ordered factors can quite
naturally be reported using numbers.)

Thus, would it be possible to add an option to contr.sum() so that it
returns a matrix whose column names are the levels of the input factor?
Such an option could also be added to other contrasts with default to
FALSE. Another solution, which could be even more practical, would be to
add a new function, called for example contr.sum2(), which would do the
same thing - after all, we already have contr.SAS() to implement a
slightly different behavior while being essentially the same as
contr.treatment().

This contr.sum() issue really sounds like a detail, but it's sad one
given that factors work really great in R in all other situations. The
only reason I can think of to explain this behavior is that people
rarely use it. When fitting log-linear models with glm(), for example,
this contrast is the most natural one, but currently gives poorly named
coefficients when everything could be so easy to interpret if factor
levels were used. This means people have to implement a replacement for
contr.sum() by hand, which is not the end of the world but is definitely
not optimal given how simple the solution is.

Thanks for your attention!


Illustration of the current difference between contr.sum() and
contr.treatment():

> z <- factor(LETTERS[1:3])
> contr.treatment(z)
  B C
A 0 0
B 1 0
C 0 1
> contr.sum(z)
  [,1] [,2]
A    1    0
B    0    1
C   -1   -1

1: https://stat.ethz.ch/pipermail/r-help/2005-July/075430.html


From jfox at mcmaster.ca  Sat Oct 27 16:44:39 2012
From: jfox at mcmaster.ca (John Fox)
Date: Sat, 27 Oct 2012 10:44:39 -0400
Subject: [Rd] contr.sum() and contrast names
In-Reply-To: <1351337946.21857.130.camel@milan>
References: <1351337946.21857.130.camel@milan>
Message-ID: <web-429728255@cgpsrv2.cis.mcmaster.ca>

Hi Milan,

Take a look at the contr.Sum() and contr.Treatment() functions in the car package.

(I recall, BTW, the sometimes acrimonious previous discussion of this issue.)

Best,
 John

------------------------------------------------
John Fox
Sen. William McMaster Prof. of Social Statistics
Department of Sociology
McMaster University
Hamilton, Ontario, Canada
http://socserv.mcmaster.ca/jfox/
	
On Sat, 27 Oct 2012 13:39:06 +0200
 Milan Bouchet-Valat <nalimilan at club.fr> wrote:
> Hi!
> 
> I would like to suggest to make it possible, in one way or another, to
> get meaningful contrast names when using contr.sum(). Currently, when
> using contr.treatment(), one gets factor levels as contrast names; but
> when using contr.sum(), contrasts are merely numbered, which is not
> practical and can lead to mistakes (see code at the end of this
> message).
> 
> This issue was discussed quickly in 2005 by Brian Ripley in a reply to a
> message on R-help [1]. He rightly stressed that treatment and sum
> contrasts are not equivalent to levels of a factor, because one needs to
> know the reference (here, level or sum) to interpret them. But when one
> knows the type of contrasts that are being used, useful labels are still
> of high value. I don't think anybody does serious work with sum
> contrasts named myfactor1, myfactor2, myfactor3. (This reasoning does
> not so much apply to contr.helmert() since ordered factors can quite
> naturally be reported using numbers.)
> 
> Thus, would it be possible to add an option to contr.sum() so that it
> returns a matrix whose column names are the levels of the input factor?
> Such an option could also be added to other contrasts with default to
> FALSE. Another solution, which could be even more practical, would be to
> add a new function, called for example contr.sum2(), which would do the
> same thing - after all, we already have contr.SAS() to implement a
> slightly different behavior while being essentially the same as
> contr.treatment().
> 
> This contr.sum() issue really sounds like a detail, but it's sad one
> given that factors work really great in R in all other situations. The
> only reason I can think of to explain this behavior is that people
> rarely use it. When fitting log-linear models with glm(), for example,
> this contrast is the most natural one, but currently gives poorly named
> coefficients when everything could be so easy to interpret if factor
> levels were used. This means people have to implement a replacement for
> contr.sum() by hand, which is not the end of the world but is definitely
> not optimal given how simple the solution is.
> 
> Thanks for your attention!
> 
> 
> Illustration of the current difference between contr.sum() and
> contr.treatment():
> 
> > z <- factor(LETTERS[1:3])
> > contr.treatment(z)
>   B C
> A 0 0
> B 1 0
> C 0 1
> > contr.sum(z)
>   [,1] [,2]
> A    1    0
> B    0    1
> C   -1   -1
> 
> 1: https://stat.ethz.ch/pipermail/r-help/2005-July/075430.html
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jmc at r-project.org  Sat Oct 27 23:07:34 2012
From: jmc at r-project.org (John Chambers)
Date: Sat, 27 Oct 2012 14:07:34 -0700
Subject: [Rd] Class generator functions for reference classes
Message-ID: <508C4D16.4070104@r-project.org>

As of rev. 61035 in r-devel, setRefClass() now returns a generator 
function, as setClass() has done since 2.15.0.

The convenient style is now:
   mEdit <- setRefClass("mEdit",......)
   xx <- mEdit(data = xMat)

instead of
   xx <- mEdit$new(data = xMat)

The returned object still has fields and methods accessible as before.

See the "Value" and "Reference Class Generators" sections of 
?ReferenceClasses for details.

Thanks to Romain Fran?ois for suggesting this.

John


From Ken.Williams at windlogics.com  Mon Oct 29 17:20:09 2012
From: Ken.Williams at windlogics.com (Ken Williams)
Date: Mon, 29 Oct 2012 11:20:09 -0500
Subject: [Rd] data.frame() args in transform()
Message-ID: <21A5E1E970CD46459ECBE86D6CC4B28C679B72F5@spexch01.WindLogics.local>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121029/93fdf30f/attachment.pl>

From h.wickham at gmail.com  Mon Oct 29 23:35:32 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Mon, 29 Oct 2012 17:35:32 -0500
Subject: [Rd] install.packages() fails if .libPaths() set
Message-ID: <CABdHhvHhi_paqqK1wUhqcg0KqOeh2YTHX-FszNHwhFYbZfb5wg@mail.gmail.com>

Reproducible example:

dir.create("test")
.libPaths("test")
install.packages("relations", type = "source")

Fails with:

...
* installing *source* package ?relations? ...
...
** testing if installed package can be loaded
*** arch - i386
Error : package ?sets? required by ?relations? could not be found
Error: loading failed
Execution halted
*** arch - x86_64
Error : package ?sets? required by ?relations? could not be found
Error: loading failed
Execution halted
ERROR: loading failed for ?i386?, ?x86_64?

If I don't set .libPaths() it installs without error.

This is on a fairly recent version of R-devel (Oct 3) and on R 2.15.1

Hadley

-- 
RStudio / Rice University
http://had.co.nz/


From jramaza at gmail.com  Mon Oct 29 21:11:44 2012
From: jramaza at gmail.com (jose ramon mazaira)
Date: Mon, 29 Oct 2012 21:11:44 +0100
Subject: [Rd] Retrieving data from aspx pages
Message-ID: <CAMd97KyY-PMRFZ=ktgqp2t-u73vs2_frcWLE31uOivU9T-j5Yg@mail.gmail.com>

Hi. I'm trying to write an application to retrieve financial data
(specially bonds data) from FINRA. The web page is served dynamically
from an asp.net application:

http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx

I'd like to know if it's possible to fill dynamically the web page
form from R and, after filling it (with the issuer name), retrieve the
web page, parse the data, and covert it to appropiate R objects.
For example, suppose I want to search data for AT&T bonds. I'd like to
know if it's possible, within R, to fill the page served from:

http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx

select the "corporate" option and fill with AT&T the field for "Issuer
name", ask the page to display the results, and retrieve the results
for each of the bonds issued by AT&T (for example:

http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/BondDetail.aspx?ID=MDAxOTU3Qko3)

and parsing the data from the web page.

Thanks in advance.


From nalimilan at club.fr  Tue Oct 30 10:25:56 2012
From: nalimilan at club.fr (Milan Bouchet-Valat)
Date: Tue, 30 Oct 2012 10:25:56 +0100
Subject: [Rd] contr.sum() and contrast names
In-Reply-To: <web-429728255@cgpsrv2.cis.mcmaster.ca>
References: <1351337946.21857.130.camel@milan>
	<web-429728255@cgpsrv2.cis.mcmaster.ca>
Message-ID: <1351589156.21857.162.camel@milan>

Le samedi 27 octobre 2012 ? 10:44 -0400, John Fox a ?crit :
> Hi Milan,
> 
> Take a look at the contr.Sum() and contr.Treatment() functions in the
> car package.
Yeah, this is the kind of function I had in mind. Just that I think we
should have an equivalent in the base packages.

> (I recall, BTW, the sometimes acrimonious previous discussion of this
> issue.)
I could not find this discussion, do you have any pointer?

Anyways, going deeper and deeper into the archives, I've found you made
the same proposal almost exactly 10 years ago[1]! Oddly enough, it only
prompted one reply at the time - has the rest of the discussion been
removed from the archives because it was too rude? ;-) Should we reopen
the debate now that some time has been spent without actions being taken
on that front?


Regards

1: http://tolstoy.newcastle.edu.au/R/devel/02b/0878.html


From michael.weylandt at gmail.com  Tue Oct 30 10:44:03 2012
From: michael.weylandt at gmail.com (R. Michael Weylandt)
Date: Tue, 30 Oct 2012 09:44:03 +0000
Subject: [Rd] Retrieving data from aspx pages
In-Reply-To: <CAMd97KyY-PMRFZ=ktgqp2t-u73vs2_frcWLE31uOivU9T-j5Yg@mail.gmail.com>
References: <CAMd97KyY-PMRFZ=ktgqp2t-u73vs2_frcWLE31uOivU9T-j5Yg@mail.gmail.com>
Message-ID: <CAAmySGM-CeWF0HXqEhaGK+bTAZifi0KDOaXwPG0tfFkbWBDW3w@mail.gmail.com>

Hi Jose,

I think this is more of an r-help question so I'm going to forward
your question there: R-devel is really for the development of R
itself, not development with R.

Cheers,
Michael

On Mon, Oct 29, 2012 at 8:11 PM, jose ramon mazaira <jramaza at gmail.com> wrote:
> Hi. I'm trying to write an application to retrieve financial data
> (specially bonds data) from FINRA. The web page is served dynamically
> from an asp.net application:
>
> http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx
>
> I'd like to know if it's possible to fill dynamically the web page
> form from R and, after filling it (with the issuer name), retrieve the
> web page, parse the data, and covert it to appropiate R objects.
> For example, suppose I want to search data for AT&T bonds. I'd like to
> know if it's possible, within R, to fill the page served from:
>
> http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx
>
> select the "corporate" option and fill with AT&T the field for "Issuer
> name", ask the page to display the results, and retrieve the results
> for each of the bonds issued by AT&T (for example:
>
> http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/BondDetail.aspx?ID=MDAxOTU3Qko3)
>
> and parsing the data from the web page.
>
> Thanks in advance.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From pdalgd at gmail.com  Tue Oct 30 11:04:52 2012
From: pdalgd at gmail.com (peter dalgaard)
Date: Tue, 30 Oct 2012 11:04:52 +0100
Subject: [Rd] Retrieving data from aspx pages
In-Reply-To: <CAAmySGM-CeWF0HXqEhaGK+bTAZifi0KDOaXwPG0tfFkbWBDW3w@mail.gmail.com>
References: <CAMd97KyY-PMRFZ=ktgqp2t-u73vs2_frcWLE31uOivU9T-j5Yg@mail.gmail.com>
	<CAAmySGM-CeWF0HXqEhaGK+bTAZifi0KDOaXwPG0tfFkbWBDW3w@mail.gmail.com>
Message-ID: <7C2CC209-7721-442F-966A-A1A0E8765C4B@gmail.com>


On Oct 30, 2012, at 10:44 , R. Michael Weylandt wrote:

> Hi Jose,
> 
> I think this is more of an r-help question so I'm going to forward
> your question there: R-devel is really for the development of R
> itself, not development with R.

Er, no! 

R help is (mainly) for helping beginners. We usually put the dividing line where the answers would become incomprehensible to many of the list readers. So compiler issues and internal C code is off-limits there, but I'd say that so is HTML and ASP. So unless there happens to be a precooked package that fits the query exactly, I'd say that it belongs here.

To wit:

"This list is intended for questions and discussion about code development in R. Questions likely to prompt discussion unintelligible to non-programmers or topics that are too technical for R-help's audience should go to R-devel, see the posting guide section."
 


> 
> Cheers,
> Michael
> 
> On Mon, Oct 29, 2012 at 8:11 PM, jose ramon mazaira <jramaza at gmail.com> wrote:
>> Hi. I'm trying to write an application to retrieve financial data
>> (specially bonds data) from FINRA. The web page is served dynamically
>> from an asp.net application:
>> 
>> http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx
>> 
>> I'd like to know if it's possible to fill dynamically the web page
>> form from R and, after filling it (with the issuer name), retrieve the
>> web page, parse the data, and covert it to appropiate R objects.
>> For example, suppose I want to search data for AT&T bonds. I'd like to
>> know if it's possible, within R, to fill the page served from:
>> 
>> http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx
>> 
>> select the "corporate" option and fill with AT&T the field for "Issuer
>> name", ask the page to display the results, and retrieve the results
>> for each of the bonds issued by AT&T (for example:
>> 
>> http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/BondDetail.aspx?ID=MDAxOTU3Qko3)
>> 
>> and parsing the data from the web page.
>> 
>> Thanks in advance.
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From mdowle at mdowle.plus.com  Tue Oct 30 12:03:00 2012
From: mdowle at mdowle.plus.com (Matthew Dowle)
Date: Tue, 30 Oct 2012 11:03:00 -0000
Subject: [Rd] There is pmin and pmax each taking na.rm, how about psum?
Message-ID: <b7c77d7038af15f6c18a37eadd00b4df.squirrel@webmail.plus.net>


Hi,

Please consider the following :

x = c(1,3,NA,5)
y = c(2,NA,4,1)

min(x,y,na.rm=TRUE)    # ok
[1] 1
max(x,y,na.rm=TRUE)    # ok
[1] 5
sum(x,y,na.rm=TRUE)    # ok
[1] 16

pmin(x,y,na.rm=TRUE)   # ok
[1] 1 3 4 1
pmax(x,y,na.rm=TRUE)   # ok
[1] 2 3 4 5
psum(x,y,na.rm=TRUE)
[1] 3 3 4 6                             # expected result
Error: could not find function "psum"   # actual result

I realise that + is already like psum, but what about NA?

x+y
[1]  3 NA NA  6        # can't supply `na.rm=TRUE` to `+`

Is there a case to add psum? Or have I missed something.

This question survived when I asked on Stack Overflow :
http://stackoverflow.com/questions/13123638/there-is-pmin-and-pmax-each-taking-na-rm-why-no-psum

And a search of the archives found that has Gabor has suggested it too as
an aside :
http://r.789695.n4.nabble.com/How-to-do-it-without-for-loops-tp794745p794750.html

If someone from R core is willing to sponsor the idea, I am willing to
write, test and submit the code for psum. Implemented in a very similar
fashion to pmin and pmax.  Or perhaps it exists already in a package
somewhere (I searched but didn't find it).

Matthew


From jfox at mcmaster.ca  Tue Oct 30 13:08:44 2012
From: jfox at mcmaster.ca (John Fox)
Date: Tue, 30 Oct 2012 08:08:44 -0400
Subject: [Rd] contr.sum() and contrast names
In-Reply-To: <1351589156.21857.162.camel@milan>
References: <1351337946.21857.130.camel@milan>
	<web-429728255@cgpsrv2.cis.mcmaster.ca>
	<1351589156.21857.162.camel@milan>
Message-ID: <web-430024951@cgpsrv2.cis.mcmaster.ca>

Hi Milan,

On Tue, 30 Oct 2012 10:25:56 +0100
 Milan Bouchet-Valat <nalimilan at club.fr> wrote:
> Le samedi 27 octobre 2012 ? 10:44 -0400, John Fox a ?crit :
> > Hi Milan,
> > 
> > Take a look at the contr.Sum() and contr.Treatment() functions in the
> > car package.
> Yeah, this is the kind of function I had in mind. Just that I think we
> should have an equivalent in the base packages.

Given the history of the issue, I think that it's unlikely that this will happen. Your message hasn't generated a cascade of discussion. And, of course, even if you had provoked a discussion, R Core would have to agree that this kind of change is desirable. 

> 
> > (I recall, BTW, the sometimes acrimonious previous discussion of this
> > issue.)
> I could not find this discussion, do you have any pointer?

Sorry. I don't recall when the discussion took place and failed to find it just now when I tried to locate it in the R email list archives.

> 
> Anyways, going deeper and deeper into the archives, I've found you made
> the same proposal almost exactly 10 years ago[1]! Oddly enough, it only
> prompted one reply at the time - has the rest of the discussion been
> removed from the archives because it was too rude? ;-) 

I think that you know that the answer to that is "no." And to be clear, the nasty comments that I recall weren't directed at me, and the rudeness was bidirectional (at least insofar as I remember the exchange accurately, which I may not).

> Should we reopen
> the debate now that some time has been spent without actions being taken
> on that front?

You *have* reopened the issue but haven't elicited a response.

A nice characteristic of R is that if you don't like how something is implemented, you can offer your own version, which is what I did with contr.Treatment(), contr.Sum(), and contr.Helmert() in the car package, and similarly with Anova() in the car package. Sometimes these kinds of changes get into the standard R distribution, but more commonly, people who agree with you are free to use the alternatives that you provide.

Best,
 John

> 
> 
> Regards
> 
> 1: http://tolstoy.newcastle.edu.au/R/devel/02b/0878.html
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From Thierry.ONKELINX at inbo.be  Tue Oct 30 13:13:55 2012
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Tue, 30 Oct 2012 12:13:55 +0000
Subject: [Rd] There is pmin and pmax each taking na.rm, how about psum?
In-Reply-To: <b7c77d7038af15f6c18a37eadd00b4df.squirrel@webmail.plus.net>
References: <b7c77d7038af15f6c18a37eadd00b4df.squirrel@webmail.plus.net>
Message-ID: <AA818EAD2576BC488B4F623941DA7427947242CD@inbomail.inbo.be>

Why don't you make a matrix and use colSums or rowSums?

x = c(1,3,NA,5)
y = c(2,NA,4,1)
colSums(rbind(x, y), na.rm = TRUE)


ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature and Forest
team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
Kliniekstraat 25
1070 Anderlecht
Belgium
+ 32 2 525 02 51
+ 32 54 43 61 85
Thierry.Onkelinx at inbo.be
www.inbo.be

To call in the statistician after the experiment is done may be no more than asking him to perform a post-mortem examination: he may be able to say what the experiment died of.
~ Sir Ronald Aylmer Fisher

The plural of anecdote is not data.
~ Roger Brinner

The combination of some data and an aching desire for an answer does not ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey


-----Oorspronkelijk bericht-----
Van: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] Namens Matthew Dowle
Verzonden: dinsdag 30 oktober 2012 12:03
Aan: r-devel at r-project.org
Onderwerp: [Rd] There is pmin and pmax each taking na.rm, how about psum?


Hi,

Please consider the following :

x = c(1,3,NA,5)
y = c(2,NA,4,1)

min(x,y,na.rm=TRUE)    # ok
[1] 1
max(x,y,na.rm=TRUE)    # ok
[1] 5
sum(x,y,na.rm=TRUE)    # ok
[1] 16

pmin(x,y,na.rm=TRUE)   # ok
[1] 1 3 4 1
pmax(x,y,na.rm=TRUE)   # ok
[1] 2 3 4 5
psum(x,y,na.rm=TRUE)
[1] 3 3 4 6                             # expected result
Error: could not find function "psum"   # actual result

I realise that + is already like psum, but what about NA?

x+y
[1]  3 NA NA  6        # can't supply `na.rm=TRUE` to `+`

Is there a case to add psum? Or have I missed something.

This question survived when I asked on Stack Overflow :
http://stackoverflow.com/questions/13123638/there-is-pmin-and-pmax-each-taking-na-rm-why-no-psum

And a search of the archives found that has Gabor has suggested it too as an aside :
http://r.789695.n4.nabble.com/How-to-do-it-without-for-loops-tp794745p794750.html

If someone from R core is willing to sponsor the idea, I am willing to write, test and submit the code for psum. Implemented in a very similar fashion to pmin and pmax.  Or perhaps it exists already in a package somewhere (I searched but didn't find it).

Matthew

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel
* * * * * * * * * * * * * D I S C L A I M E R * * * * * * * * * * * * *
Dit bericht en eventuele bijlagen geven enkel de visie van de schrijver weer en binden het INBO onder geen enkel beding, zolang dit bericht niet bevestigd is door een geldig ondertekend document.
The views expressed in this message and any annex are purely those of the writer and may not be regarded as stating an official position of INBO, as long as the message is not confirmed by a duly signed document.


From mdowle at mdowle.plus.com  Tue Oct 30 13:36:23 2012
From: mdowle at mdowle.plus.com (Matthew Dowle)
Date: Tue, 30 Oct 2012 12:36:23 -0000
Subject: [Rd] There is pmin and pmax each taking na.rm, how about psum?
In-Reply-To: <AA818EAD2576BC488B4F623941DA7427947242CD@inbomail.inbo.be>
References: <b7c77d7038af15f6c18a37eadd00b4df.squirrel@webmail.plus.net>
	<AA818EAD2576BC488B4F623941DA7427947242CD@inbomail.inbo.be>
Message-ID: <86430461b5dee4f5461b0bf9e01bda8a.squirrel@webmail.plus.net>


Because that's inconsistent with pmin and pmax when two NAs are summed.

x = c(1,3,NA,NA,5)
y = c(2,NA,4,NA,1)
colSums(rbind(x, y), na.rm = TRUE)
[1] 3 3 4 0 6    # actual
[1] 3 3 4 NA 6   # desired

and it would be less convenient/natural (and slower) than a psum which
would call .Internal(psum(na.rm,...)) in the same way as pmin and pmax.

> Why don't you make a matrix and use colSums or rowSums?
>
> x = c(1,3,NA,5)
> y = c(2,NA,4,1)
> colSums(rbind(x, y), na.rm = TRUE)
>
>
> ir. Thierry Onkelinx
> Instituut voor natuur- en bosonderzoek / Research Institute for Nature and
> Forest
> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
> Kliniekstraat 25
> 1070 Anderlecht
> Belgium
> + 32 2 525 02 51
> + 32 54 43 61 85
> Thierry.Onkelinx at inbo.be
> www.inbo.be
>
> To call in the statistician after the experiment is done may be no more
> than asking him to perform a post-mortem examination: he may be able to
> say what the experiment died of.
> ~ Sir Ronald Aylmer Fisher
>
> The plural of anecdote is not data.
> ~ Roger Brinner
>
> The combination of some data and an aching desire for an answer does not
> ensure that a reasonable answer can be extracted from a given body of
> data.
> ~ John Tukey
>
>
> -----Oorspronkelijk bericht-----
> Van: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org]
> Namens Matthew Dowle
> Verzonden: dinsdag 30 oktober 2012 12:03
> Aan: r-devel at r-project.org
> Onderwerp: [Rd] There is pmin and pmax each taking na.rm, how about psum?
>
>
> Hi,
>
> Please consider the following :
>
> x = c(1,3,NA,5)
> y = c(2,NA,4,1)
>
> min(x,y,na.rm=TRUE)    # ok
> [1] 1
> max(x,y,na.rm=TRUE)    # ok
> [1] 5
> sum(x,y,na.rm=TRUE)    # ok
> [1] 16
>
> pmin(x,y,na.rm=TRUE)   # ok
> [1] 1 3 4 1
> pmax(x,y,na.rm=TRUE)   # ok
> [1] 2 3 4 5
> psum(x,y,na.rm=TRUE)
> [1] 3 3 4 6                             # expected result
> Error: could not find function "psum"   # actual result
>
> I realise that + is already like psum, but what about NA?
>
> x+y
> [1]  3 NA NA  6        # can't supply `na.rm=TRUE` to `+`
>
> Is there a case to add psum? Or have I missed something.
>
> This question survived when I asked on Stack Overflow :
> http://stackoverflow.com/questions/13123638/there-is-pmin-and-pmax-each-taking-na-rm-why-no-psum
>
> And a search of the archives found that has Gabor has suggested it too as
> an aside :
> http://r.789695.n4.nabble.com/How-to-do-it-without-for-loops-tp794745p794750.html
>
> If someone from R core is willing to sponsor the idea, I am willing to
> write, test and submit the code for psum. Implemented in a very similar
> fashion to pmin and pmax.  Or perhaps it exists already in a package
> somewhere (I searched but didn't find it).
>
> Matthew
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> * * * * * * * * * * * * * D I S C L A I M E R * * * * * * * * * * * * *
> Dit bericht en eventuele bijlagen geven enkel de visie van de schrijver
> weer en binden het INBO onder geen enkel beding, zolang dit bericht niet
> bevestigd is door een geldig ondertekend document.
> The views expressed in this message and any annex are purely those of the
> writer and may not be regarded as stating an official position of INBO, as
> long as the message is not confirmed by a duly signed document.
>


From pgilbert902 at gmail.com  Tue Oct 30 13:38:23 2012
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Tue, 30 Oct 2012 08:38:23 -0400
Subject: [Rd] Retrieving data from aspx pages
In-Reply-To: <CAMd97KyY-PMRFZ=ktgqp2t-u73vs2_frcWLE31uOivU9T-j5Yg@mail.gmail.com>
References: <CAMd97KyY-PMRFZ=ktgqp2t-u73vs2_frcWLE31uOivU9T-j5Yg@mail.gmail.com>
Message-ID: <508FCA3F.2070104@gmail.com>

I don't know of an easy way to do this in R. I've been doing something 
similar with python scripts called from R. If anyone knows how to do 
this with just R, I would appreciate hearing too.

Paul

On 12-10-29 04:11 PM, jose ramon mazaira wrote:
> Hi. I'm trying to write an application to retrieve financial data
> (specially bonds data) from FINRA. The web page is served dynamically
> from an asp.net application:
>
> http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx
>
> I'd like to know if it's possible to fill dynamically the web page
> form from R and, after filling it (with the issuer name), retrieve the
> web page, parse the data, and covert it to appropiate R objects.
> For example, suppose I want to search data for AT&T bonds. I'd like to
> know if it's possible, within R, to fill the page served from:
>
> http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx
>
> select the "corporate" option and fill with AT&T the field for "Issuer
> name", ask the page to display the results, and retrieve the results
> for each of the bonds issued by AT&T (for example:
>
> http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/BondDetail.aspx?ID=MDAxOTU3Qko3)
>
> and parsing the data from the web page.
>
> Thanks in advance.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From gmbecker at ucdavis.edu  Tue Oct 30 14:08:59 2012
From: gmbecker at ucdavis.edu (Gabriel Becker)
Date: Tue, 30 Oct 2012 06:08:59 -0700
Subject: [Rd] Retrieving data from aspx pages
In-Reply-To: <508FCA3F.2070104@gmail.com>
References: <CAMd97KyY-PMRFZ=ktgqp2t-u73vs2_frcWLE31uOivU9T-j5Yg@mail.gmail.com>
	<508FCA3F.2070104@gmail.com>
Message-ID: <CADwqtCNafNe=daUD7BAcvb2wS8rgNvtCJPynBuukqvNOtO0BbA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20121030/587e3d93/attachment.pl>

From pgilbert902 at gmail.com  Tue Oct 30 14:35:13 2012
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Tue, 30 Oct 2012 09:35:13 -0400
Subject: [Rd] Retrieving data from aspx pages
In-Reply-To: <CADwqtCNafNe=daUD7BAcvb2wS8rgNvtCJPynBuukqvNOtO0BbA@mail.gmail.com>
References: <CAMd97KyY-PMRFZ=ktgqp2t-u73vs2_frcWLE31uOivU9T-j5Yg@mail.gmail.com>
	<508FCA3F.2070104@gmail.com>
	<CADwqtCNafNe=daUD7BAcvb2wS8rgNvtCJPynBuukqvNOtO0BbA@mail.gmail.com>
Message-ID: <508FD791.6090209@gmail.com>

I think RHTMLForms works if you have a single form, but I have not been 
able to see how to use it when you need to go through a sequence of 
dynamically generated forms (like you can do with Python mechanize).

Paul

On 12-10-30 09:08 AM, Gabriel Becker wrote:
> I haven't used it extensively myself, and can't speak to it's current
> state but on quick inspection RHTMLForms seems worth a look for what you
> want.
>
> http://www.omegahat.org/RHTMLForms/
>
> ~G
>
> On Tue, Oct 30, 2012 t 5:38 AM, Paul Gilbert <pgilbert902 at gmail.com
> <mailto:pgilbert902 at gmail.com>> wrote:
>
>     I don't know of an easy way to do this in R. I've been doing
>     something similar with python scripts called from R. If anyone knows
>     how to do this with just R, I would appreciate hearing too.
>
>     Paul
>
>
>     On 12-10-29 04:11 PM, jose ramon mazaira wrote:
>
>         Hi. I'm trying to write an application to retrieve financial data
>         (specially bonds data) from FINRA. The web page is served
>         dynamically
>         from an asp.net <http://asp.net> application:
>
>         http://cxa.gtm.__idmanagedsolutions.com/finra/__BondCenter/AdvancedScreener.__aspx
>         <http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx>
>
>         I'd like to know if it's possible to fill dynamically the web page
>         form from R and, after filling it (with the issuer name),
>         retrieve the
>         web page, parse the data, and covert it to appropiate R objects.
>         For example, suppose I want to search data for AT&T bonds. I'd
>         like to
>         know if it's possible, within R, to fill the page served from:
>
>         http://cxa.gtm.__idmanagedsolutions.com/finra/__BondCenter/AdvancedScreener.__aspx
>         <http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx>
>
>         select the "corporate" option and fill with AT&T the field for
>         "Issuer
>         name", ask the page to display the results, and retrieve the results
>         for each of the bonds issued by AT&T (for example:
>
>         http://cxa.gtm.__idmanagedsolutions.com/finra/__BondCenter/BondDetail.aspx?ID=__MDAxOTU3Qko3
>         <http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/BondDetail.aspx?ID=MDAxOTU3Qko3>)
>
>         and parsing the data from the web page.
>
>         Thanks in advance.
>
>         ________________________________________________
>         R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>         https://stat.ethz.ch/mailman/__listinfo/r-devel
>         <https://stat.ethz.ch/mailman/listinfo/r-devel>
>
>
>     ________________________________________________
>     R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>     https://stat.ethz.ch/mailman/__listinfo/r-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-devel>
>
>
>
>
> --
> Gabriel Becker
> Graduate Student
> Statistics Department
> University of California, Davis
>


From h.wickham at gmail.com  Tue Oct 30 14:47:18 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Tue, 30 Oct 2012 08:47:18 -0500
Subject: [Rd] There is pmin and pmax each taking na.rm, how about psum?
In-Reply-To: <b7c77d7038af15f6c18a37eadd00b4df.squirrel@webmail.plus.net>
References: <b7c77d7038af15f6c18a37eadd00b4df.squirrel@webmail.plus.net>
Message-ID: <CABdHhvFqn2ESQ1YtsuyN=_9-uO9VsT6ttVLo8d1cC+k-w=9o9Q@mail.gmail.com>

> Is there a case to add psum? Or have I missed something.

If psum, then why not pdiff (-), pprod (*) and precip (/) ?  And
similarly, what about equivalent functions for ^, %%, %/%, &, and | ?

Hadley

-- 
RStudio / Rice University
http://had.co.nz/


From ligges at statistik.tu-dortmund.de  Tue Oct 30 14:55:54 2012
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Tue, 30 Oct 2012 14:55:54 +0100
Subject: [Rd] install.packages() fails if .libPaths() set
In-Reply-To: <CABdHhvHhi_paqqK1wUhqcg0KqOeh2YTHX-FszNHwhFYbZfb5wg@mail.gmail.com>
References: <CABdHhvHhi_paqqK1wUhqcg0KqOeh2YTHX-FszNHwhFYbZfb5wg@mail.gmail.com>
Message-ID: <508FDC6A.30502@statistik.tu-dortmund.de>



On 29.10.2012 23:35, Hadley Wickham wrote:
> Reproducible example:
>
> dir.create("test")
> .libPaths("test")
> install.packages("relations", type = "source")
>
> Fails with:
>
> ...
> * installing *source* package ?relations? ...
> ...
> ** testing if installed package can be loaded
> *** arch - i386
> Error : package ?sets? required by ?relations? could not be found
> Error: loading failed
> Execution halted
> *** arch - x86_64
> Error : package ?sets? required by ?relations? could not be found
> Error: loading failed
> Execution halted
> ERROR: loading failed for ?i386?, ?x86_64?
>
> If I don't set .libPaths() it installs without error.

Yes, since your package set is installed in a library that is not 
"test". And you have omitted that library from the search path by 
changing .libPaths().

Uwe Ligges


>
> This is on a fairly recent version of R-devel (Oct 3) and on R 2.15.1
>
> Hadley
>


From h.wickham at gmail.com  Tue Oct 30 15:01:53 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Tue, 30 Oct 2012 09:01:53 -0500
Subject: [Rd] install.packages() fails if .libPaths() set
In-Reply-To: <508FDC6A.30502@statistik.tu-dortmund.de>
References: <CABdHhvHhi_paqqK1wUhqcg0KqOeh2YTHX-FszNHwhFYbZfb5wg@mail.gmail.com>
	<508FDC6A.30502@statistik.tu-dortmund.de>
Message-ID: <CABdHhvGB+-Hx1a_K6g7YnEYvNTP1DhgAGtPNfErP0ZtueJo9Hw@mail.gmail.com>

>> * installing *source* package ?relations? ...
>> ...
>> ** testing if installed package can be loaded
>> *** arch - i386
>> Error : package ?sets? required by ?relations? could not be found
>> Error: loading failed
>> Execution halted
>> *** arch - x86_64
>> Error : package ?sets? required by ?relations? could not be found
>> Error: loading failed
>> Execution halted
>> ERROR: loading failed for ?i386?, ?x86_64?
>>
>> If I don't set .libPaths() it installs without error.
>
>
> Yes, since your package set is installed in a library that is not "test".
> And you have omitted that library from the search path by changing
> .libPaths().

I'm not sure I follow. I thought install.packages() installs into the
first element of .libPaths(), and indeed I get this message:

Installing package into ?/Users/hadley/Desktop/test?
(as ?lib? is unspecified)

Hadley


-- 
RStudio / Rice University
http://had.co.nz/


From ligges at statistik.tu-dortmund.de  Tue Oct 30 15:03:42 2012
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Tue, 30 Oct 2012 15:03:42 +0100
Subject: [Rd] install.packages() fails if .libPaths() set
In-Reply-To: <CABdHhvGB+-Hx1a_K6g7YnEYvNTP1DhgAGtPNfErP0ZtueJo9Hw@mail.gmail.com>
References: <CABdHhvHhi_paqqK1wUhqcg0KqOeh2YTHX-FszNHwhFYbZfb5wg@mail.gmail.com>
	<508FDC6A.30502@statistik.tu-dortmund.de>
	<CABdHhvGB+-Hx1a_K6g7YnEYvNTP1DhgAGtPNfErP0ZtueJo9Hw@mail.gmail.com>
Message-ID: <508FDE3E.7060501@statistik.tu-dortmund.de>



On 30.10.2012 15:01, Hadley Wickham wrote:
>>> * installing *source* package ?relations? ...
>>> ...
>>> ** testing if installed package can be loaded
>>> *** arch - i386
>>> Error : package ?sets? required by ?relations? could not be found
>>> Error: loading failed
>>> Execution halted
>>> *** arch - x86_64
>>> Error : package ?sets? required by ?relations? could not be found
>>> Error: loading failed
>>> Execution halted
>>> ERROR: loading failed for ?i386?, ?x86_64?
>>>
>>> If I don't set .libPaths() it installs without error.
>>
>>
>> Yes, since your package set is installed in a library that is not "test".
>> And you have omitted that library from the search path by changing
>> .libPaths().
>
> I'm not sure I follow. I thought install.packages() installs into the
> first element of .libPaths(), and indeed I get this message:
>
> Installing package into ?/Users/hadley/Desktop/test?
> (as ?lib? is unspecified)

Yes, but "sets" is not there.

Uwe

>
> Hadley
>
>


From h.wickham at gmail.com  Tue Oct 30 15:05:57 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Tue, 30 Oct 2012 09:05:57 -0500
Subject: [Rd] install.packages() fails if .libPaths() set
In-Reply-To: <508FDE3E.7060501@statistik.tu-dortmund.de>
References: <CABdHhvHhi_paqqK1wUhqcg0KqOeh2YTHX-FszNHwhFYbZfb5wg@mail.gmail.com>
	<508FDC6A.30502@statistik.tu-dortmund.de>
	<CABdHhvGB+-Hx1a_K6g7YnEYvNTP1DhgAGtPNfErP0ZtueJo9Hw@mail.gmail.com>
	<508FDE3E.7060501@statistik.tu-dortmund.de>
Message-ID: <CABdHhvHx_-Frk9vcrvmMp1Hx053ygGVYDgdiUyXMQABgrdpQqw@mail.gmail.com>

>> I'm not sure I follow. I thought install.packages() installs into the
>> first element of .libPaths(), and indeed I get this message:
>>
>> Installing package into ?/Users/hadley/Desktop/test?
>> (as ?lib? is unspecified)
>
> Yes, but "sets" is not there.

I'm trying to understand why it's not there - if install.packages()
installs dependent packages does it put them somewhere else?

Hadley

-- 
RStudio / Rice University
http://had.co.nz/


From mdowle at mdowle.plus.com  Tue Oct 30 15:40:57 2012
From: mdowle at mdowle.plus.com (Matthew Dowle)
Date: Tue, 30 Oct 2012 14:40:57 -0000
Subject: [Rd] There is pmin and pmax each taking na.rm, how about psum?
In-Reply-To: <CABdHhvFqn2ESQ1YtsuyN=_9-uO9VsT6ttVLo8d1cC+k-w=9o9Q@mail.gmail.com>
References: <b7c77d7038af15f6c18a37eadd00b4df.squirrel@webmail.plus.net>
	<CABdHhvFqn2ESQ1YtsuyN=_9-uO9VsT6ttVLo8d1cC+k-w=9o9Q@mail.gmail.com>
Message-ID: <0b7ca5941b68e0f3ba2a39a18f1b6199.squirrel@webmail.plus.net>


Not pdiff because i) psum(x,-y,na.rm=TRUE) would do that and ii) diff is
quite unlike -. Yes, pprod too, but not pdiv (or precip) because
pprod(x,y^-1,na.rm=TRUE) would dominate that.

> what about equivalent functions for ^, %%, %/%, &, and | ?

I like the suggestion, but not as useful as psum and pprod. It would
probably be going too far to add those too. Plus in ?groupGeneric, under
section 3, there are 7 functions listed :

    min, max, sum, prod, range, all, any

The p* would be extended to 2 more of those 7. Wouldn't make sense for
prange, pall or pany.  So, just psum and pprod. ^, %%, %/%, &, and | are
listed in section 2, Group "ops" and seem different to sum and prod in
that sense.


>> Is there a case to add psum? Or have I missed something.
>
> If psum, then why not pdiff (-), pprod (*) and precip (/) ?  And
> similarly, what about equivalent functions for ^, %%, %/%, &, and | ?
>
> Hadley
>
> --
> RStudio / Rice University
> http://had.co.nz/
>


From pgilbert902 at gmail.com  Tue Oct 30 20:14:03 2012
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Tue, 30 Oct 2012 15:14:03 -0400
Subject: [Rd] Retrieving data from aspx pages
In-Reply-To: <CAMd97KztkXTpj99JsMxOzSy=cmg9PmM15Fq43t1tLFNBfeVaoA@mail.gmail.com>
References: <CAMd97KyY-PMRFZ=ktgqp2t-u73vs2_frcWLE31uOivU9T-j5Yg@mail.gmail.com>
	<508FCA3F.2070104@gmail.com>
	<CADwqtCNafNe=daUD7BAcvb2wS8rgNvtCJPynBuukqvNOtO0BbA@mail.gmail.com>
	<508FD791.6090209@gmail.com>
	<CAMd97KztkXTpj99JsMxOzSy=cmg9PmM15Fq43t1tLFNBfeVaoA@mail.gmail.com>
Message-ID: <509026FB.6000302@gmail.com>

Jose

As far as getting to the data, I think the best way to do this sort of 
thing would be if the site supports a SOAP or REST interface. When they 
don't (yet) then one is faced with clicking through some pages. Python 
or Java is one way to automate the process of clicking through the 
pages. I don't know how to do that in R, but would like to know if it is 
possible.

But, I guess I was confused about the part you want to improve. What I 
have works fairly smoothly parsing and passing back JSON data, converted 
from a csv file, into R. The downside is that this approach requires 
more than R to be installed on the client machine. But if the object you 
get back is ASPX, then you either need to parse it directly, or convert 
it to JSON, or something else you can deal with. I suspect that will be 
fairly specific to a particular web site, but I don't really know enough 
about ASPX to be sure.

Paul

On 12-10-30 01:12 PM, jose ramon mazaira wrote:
> Thanks for your interest, Paul.
> I've checked the source code of TSjson and I've seen that what it does
> is to call a Python script to retrieve the data. In fact, I've already
> done this with Java using the URLConnection class and sending the
> requested values to fill the form.
> However, I think it would be more useful to open a connection with R
> and to send the requested values within R, and not through an external
> program.
> The application I've designed, like yours, is also page-specific
> (i.e., designed for
> http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx),
> but I think that our applications would be more powerful if they were
> able to parse the name-value pairs generated from ASPX (or of any
> other dynamically generated web page) and ask the user to select the
> appropiate values.
>
> 2012/10/30, Paul Gilbert <pgilbert902 at gmail.com>:
>> I think RHTMLForms works if you have a single form, but I have not been
>> able to see how to use it when you need to go through a sequence of
>> dynamically generated forms (like you can do with Python mechanize).
>>
>> Paul
>>
>> On 12-10-30 09:08 AM, Gabriel Becker wrote:
>>> I haven't used it extensively myself, and can't speak to it's current
>>> state but on quick inspection RHTMLForms seems worth a look for what you
>>> want.
>>>
>>> http://www.omegahat.org/RHTMLForms/
>>>
>>> ~G
>>>
>>> On Tue, Oct 30, 2012 t 5:38 AM, Paul Gilbert <pgilbert902 at gmail.com
>>> <mailto:pgilbert902 at gmail.com>> wrote:
>>>
>>>      I don't know of an easy way to do this in R. I've been doing
>>>      something similar with python scripts called from R. If anyone knows
>>>      how to do this with just R, I would appreciate hearing too.
>>>
>>>      Paul
>>>
>>>
>>>      On 12-10-29 04:11 PM, jose ramon mazaira wrote:
>>>
>>>          Hi. I'm trying to write an application to retrieve financial data
>>>          (specially bonds data) from FINRA. The web page is served
>>>          dynamically
>>>          from an asp.net <http://asp.net> application:
>>>
>>>
>>> http://cxa.gtm.__idmanagedsolutions.com/finra/__BondCenter/AdvancedScreener.__aspx
>>>
>>> <http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx>
>>>
>>>          I'd like to know if it's possible to fill dynamically the web
>>> page
>>>          form from R and, after filling it (with the issuer name),
>>>          retrieve the
>>>          web page, parse the data, and covert it to appropiate R objects.
>>>          For example, suppose I want to search data for AT&T bonds. I'd
>>>          like to
>>>          know if it's possible, within R, to fill the page served from:
>>>
>>>
>>> http://cxa.gtm.__idmanagedsolutions.com/finra/__BondCenter/AdvancedScreener.__aspx
>>>
>>> <http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx>
>>>
>>>          select the "corporate" option and fill with AT&T the field for
>>>          "Issuer
>>>          name", ask the page to display the results, and retrieve the
>>> results
>>>          for each of the bonds issued by AT&T (for example:
>>>
>>>
>>> http://cxa.gtm.__idmanagedsolutions.com/finra/__BondCenter/BondDetail.aspx?ID=__MDAxOTU3Qko3
>>>
>>> <http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/BondDetail.aspx?ID=MDAxOTU3Qko3>)
>>>
>>>          and parsing the data from the web page.
>>>
>>>          Thanks in advance.
>>>
>>>          ________________________________________________
>>>          R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>>>          https://stat.ethz.ch/mailman/__listinfo/r-devel
>>>          <https://stat.ethz.ch/mailman/listinfo/r-devel>
>>>
>>>
>>>      ________________________________________________
>>>      R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>>>      https://stat.ethz.ch/mailman/__listinfo/r-devel
>>>      <https://stat.ethz.ch/mailman/listinfo/r-devel>
>>>
>>>
>>>
>>>
>>> --
>>> Gabriel Becker
>>> Graduate Student
>>> Statistics Department
>>> University of California, Davis
>>>
>>


From jmc at r-project.org  Tue Oct 30 22:09:05 2012
From: jmc at r-project.org (John Chambers)
Date: Tue, 30 Oct 2012 14:09:05 -0700
Subject: [Rd] Class generator functions for reference classes
In-Reply-To: <508C4D16.4070104@r-project.org>
References: <508C4D16.4070104@r-project.org>
Message-ID: <509041F1.1050004@r-project.org>

A heads up for those using Rcpp and perhaps other packages related to 
reference classes.

The changes in 61035 cause a problem for classes defined with a slot 
using the return value of setRefClass(), notably for Rcpp. The name of 
that class changed.

Rather than introduce back-incompatibility, I will rename a couple of 
classes so the class name of the return value remains the same.  (It's 
not as natural a naming scheme as what is in place, but not the first 
time back-compatibility has won out over preferred design.)

It will be a day or two before I can get to this, so don't panic if your 
package does not install from the current r-devel until then.

John

On 10/27/12 2:07 PM, John Chambers wrote:
> As of rev. 61035 in r-devel, setRefClass() now returns a generator 
> function, as setClass() has done since 2.15.0.
>
> The convenient style is now:
>   mEdit <- setRefClass("mEdit",......)
>   xx <- mEdit(data = xMat)
>
> instead of
>   xx <- mEdit$new(data = xMat)
>
> The returned object still has fields and methods accessible as before.
>
> See the "Value" and "Reference Class Generators" sections of 
> ?ReferenceClasses for details.
>
> Thanks to Romain Fran?ois for suggesting this.
>
> John
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From h.wickham at gmail.com  Tue Oct 30 23:25:55 2012
From: h.wickham at gmail.com (Hadley Wickham)
Date: Tue, 30 Oct 2012 17:25:55 -0500
Subject: [Rd] Class generator functions for reference classes
In-Reply-To: <508C4D16.4070104@r-project.org>
References: <508C4D16.4070104@r-project.org>
Message-ID: <CABdHhvGCd2QwBV=94hSn92-L3aoBchyEGAyyVrgTwrcysve0BQ@mail.gmail.com>

> As of rev. 61035 in r-devel, setRefClass() now returns a generator function,
> as setClass() has done since 2.15.0.
>
> The convenient style is now:
>   mEdit <- setRefClass("mEdit",......)
>   xx <- mEdit(data = xMat)
>
> instead of
>   xx <- mEdit$new(data = xMat)
>
> The returned object still has fields and methods accessible as before.

Similarly, would it be possible for setGeneric and setMethod to return
the equivalent generic and method objects?

Hadley

-- 
RStudio / Rice University
http://had.co.nz/


From winstonchang1 at gmail.com  Wed Oct 31 01:12:22 2012
From: winstonchang1 at gmail.com (Winston Chang)
Date: Tue, 30 Oct 2012 19:12:22 -0500
Subject: [Rd] install.packages() fails if .libPaths() set
In-Reply-To: <CABdHhvHx_-Frk9vcrvmMp1Hx053ygGVYDgdiUyXMQABgrdpQqw@mail.gmail.com>
References: <CABdHhvHhi_paqqK1wUhqcg0KqOeh2YTHX-FszNHwhFYbZfb5wg@mail.gmail.com>
	<508FDC6A.30502@statistik.tu-dortmund.de>
	<CABdHhvGB+-Hx1a_K6g7YnEYvNTP1DhgAGtPNfErP0ZtueJo9Hw@mail.gmail.com>
	<508FDE3E.7060501@statistik.tu-dortmund.de>
	<CABdHhvHx_-Frk9vcrvmMp1Hx053ygGVYDgdiUyXMQABgrdpQqw@mail.gmail.com>
Message-ID: <CAFOpNVHEaFdXrFTFDZAiVoB57+NJdULtvsC-V4ytytfrZOAP1A@mail.gmail.com>

It appears that this problem only happens when R_LIBS is specified in
~/.Renviron. When it compiles 'relations', it's somehow not passing
along the correct lib paths.


This is the test code:
dir.create("test")
.libPaths("test")
install.packages("relations", type = "source")


The 'relations' package depends on 'sets' and 'slam'. When there is no
~/.Renviron file it works: all three packages get installed into
test/.


The story is different when there is an file ~/.Renviron with the contents:
R_LIBS=~/R

(And the ~/R directory exists, of course.)

It manages to install 'sets' and 'slam' into test/, but it fails to
install 'relations'. I've added the output to the bottom of this
email.

I test this with  R 2.15.1 and R 2.15.2 on Windows XP, and R 2.15.1 on
Mac OS X 10.7.5. In all cases, I get the same result.


Here's the output when there _is_ an .Renviron file:

> install.packages("relations", type = "source")
Installing package(s) into ?C:/Documents and Settings/user/My Documents/test?
(as ?lib? is unspecified)
also installing the dependencies ?sets?, ?slam?

trying URL 'http://cran.rstudio.com/src/contrib/sets_1.0-11.tar.gz'
Content type 'application/x-gzip' length 283388 bytes (276 Kb)
opened URL
downloaded 276 Kb

trying URL 'http://cran.rstudio.com/src/contrib/slam_0.1-26.tar.gz'
Content type 'application/x-gzip' length 39506 bytes (38 Kb)
opened URL
downloaded 38 Kb

trying URL 'http://cran.rstudio.com/src/contrib/relations_0.6.tar.gz'
Content type 'application/x-gzip' length 493292 bytes (481 Kb)
opened URL
downloaded 481 Kb

* installing *source* package 'sets' ...
** package 'sets' successfully unpacked and MD5 sums checked
** libs
cygwin warning:
  MS-DOS style path detected: C:/R/R-215~1.1/etc/i386/Makeconf
  Preferred POSIX equivalent is: /cygdrive/c/R/R-215~1.1/etc/i386/Makeconf
  CYGWIN environment variable option "nodosfilewarning" turns off this warning.
  Consult the user's guide for more details about POSIX paths:
    http://cygwin.com/cygwin-ug-net/using.html#using-pathnames
gcc  -I"C:/R/R-215~1.1/include" -DNDEBUG          -O3 -Wall
-std=gnu99 -mtune=core2 -c closure.c -o closure.o
gcc -shared -s -static-libgcc -o sets.dll tmp.def closure.o
-LC:/R/R-215~1.1/bin/i386 -lR
installing to C:/Documents and Settings/user/My Documents/test/sets/libs/i386
** R
** data
** inst
** preparing package for lazy loading
** help
*** installing help indices
** building package indices
** installing vignettes
   'sets.Rnw'
** testing if installed package can be loaded

* DONE (sets)
* installing *source* package 'slam' ...
** package 'slam' successfully unpacked and MD5 sums checked
** libs
cygwin warning:
  MS-DOS style path detected: C:/R/R-215~1.1/etc/i386/Makeconf
  Preferred POSIX equivalent is: /cygdrive/c/R/R-215~1.1/etc/i386/Makeconf
  CYGWIN environment variable option "nodosfilewarning" turns off this warning.
  Consult the user's guide for more details about POSIX paths:
    http://cygwin.com/cygwin-ug-net/using.html#using-pathnames
gcc  -I"C:/R/R-215~1.1/include" -DNDEBUG          -O3 -Wall
-std=gnu99 -mtune=core2 -c grouped.c -o grouped.o
gcc  -I"C:/R/R-215~1.1/include" -DNDEBUG          -O3 -Wall
-std=gnu99 -mtune=core2 -c sparse.c -o sparse.o
gcc  -I"C:/R/R-215~1.1/include" -DNDEBUG          -O3 -Wall
-std=gnu99 -mtune=core2 -c util.c -o util.o
gcc -shared -s -static-libgcc -o slam.dll tmp.def grouped.o sparse.o
util.o -LC:/R/R-215~1.1/bin/i386 -lRblas -lgfortran
-LC:/R/R-215~1.1/bin/i386 -lR
installing to C:/Documents and Settings/user/My Documents/test/slam/libs/i386
** R
** preparing package for lazy loading
** help
*** installing help indices
** building package indices
** testing if installed package can be loaded

* DONE (slam)
* installing *source* package 'relations' ...
** package 'relations' successfully unpacked and MD5 sums checked
** R
** data
**  moving datasets to lazyload DB
** inst
** preparing package for lazy loading
** help
*** installing help indices
** building package indices
** installing vignettes
   'relations.Rnw'
** testing if installed package can be loaded
Error : package 'sets' required by 'relations' could not be found
Error: loading failed
Execution halted
ERROR: loading failed
* removing 'C:/Documents and Settings/user/My Documents/test/relations'
Warning in install.packages :
  running command 'C:/R/R-215~1.1/bin/i386/R CMD INSTALL -l
"C:/Documents and Settings/user/My Documents/test"
C:\DOCUME~1\user\LOCALS~1\Temp\RtmpGSxf4J/downloaded_packages/relations_0.6.tar.gz'
had status 1
Warning in install.packages :
  installation of package ?relations? had non-zero exit status

The downloaded source packages are in
?C:\Documents and Settings\user\Local
Settings\Temp\RtmpGSxf4J\downloaded_packages?


From htl10 at users.sourceforge.net  Wed Oct 31 13:26:22 2012
From: htl10 at users.sourceforge.net (Hin-Tak Leung)
Date: Wed, 31 Oct 2012 12:26:22 +0000 (GMT)
Subject: [Rd] R_SVN_REVISION breakage on current R trunk.
Message-ID: <1351686382.96703.YahooMailClassic@web29402.mail.ird.yahoo.com>

Hi,

src/unix/Rscript.c on R trunk stopped building with a compiler error of "unknown not defined/declared" on line 160-ish, where R_SVN_REVISION is , on my system.

I see trunk r60972, trunk r60975 changes R_SVN_REVISION to a number - if it can be found, from being a string.

The thing is, I track R development with git's svn support (which IMHO works far better). So svn info cannot work out what revision it is, and it has always defaulted back to 'unknown', which is set in line 96-ish in the top-level "Makefile.in" if 'svn info' fails, which it always does on my system since I don't use svn to track R development.

I assume this problem affects anybody who manages to get a development snapshot by any means but it not sitting on a svn checkout?

May I suggest 

   $(ECHO) "Revision: unknown"

on line 96-ish in the top-level "Makefile.in" be changed to 999999, 0, -1 or some number to match r60972/r60975 ?

Cheers,
Hin-Tak


From pgilbert902 at gmail.com  Wed Oct 31 18:45:55 2012
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Wed, 31 Oct 2012 13:45:55 -0400
Subject: [Rd] Retrieving data from aspx pages
In-Reply-To: <CAMd97KyACq9nv0vpc+iVTYAXjxXBmNL2ScjcCgaL+1r=NZ3BaQ@mail.gmail.com>
References: <CAMd97KyY-PMRFZ=ktgqp2t-u73vs2_frcWLE31uOivU9T-j5Yg@mail.gmail.com>
	<508FCA3F.2070104@gmail.com>
	<CADwqtCNafNe=daUD7BAcvb2wS8rgNvtCJPynBuukqvNOtO0BbA@mail.gmail.com>
	<508FD791.6090209@gmail.com>
	<CAMd97KztkXTpj99JsMxOzSy=cmg9PmM15Fq43t1tLFNBfeVaoA@mail.gmail.com>
	<509026FB.6000302@gmail.com>
	<CAMd97KyACq9nv0vpc+iVTYAXjxXBmNL2ScjcCgaL+1r=NZ3BaQ@mail.gmail.com>
Message-ID: <509163D3.5040703@gmail.com>

I must be really dense, I know RCurl provides a POST capability, but I 
don't see how this allows "interaction". Suppose the example actually 
worked, which it does not. (Unfortunately many of the examples in RCurl 
seem to be marked \dontrun{} or disabled with some if() condition.) When 
you post to a page like this you will often get something back that has 
a dynamically generated URI, and you will need  to post more information 
to that page. But how do you find out the URI of that next dynamically 
generated page? Even when you know what you will need to post, you need 
the URI to do it. If RCurl provided interaction you would be able get 
the URI so you could post to the next page. Maybe you can do that, but I 
have not discover how. If you know how, I would appreciate a real 
working example.

Paul

On 12-10-31 12:14 PM, jose ramon mazaira wrote:
> I'd like to make you note that I've discovered that package RCurl
> already provides a utility that allows interaction via POST requests
> with servers. In fact, the FAQ for RCurl contains specifically an
> example with an aspx page:
>
> x = postForm("http://www.fas.usda.gov/psdonline/psdResult.aspx",
>               style = "post",
>              .params = list(visited="1",
>                            lstGroup = "all",
>                            lstCommodity="2631000",
>                            lstAttribute="88",
>                            lstCountry="**",
>                            lstDate="2011",
>                            lstColumn="Year",
>                            lstOrder="Commodity%2FAttribute%2FCountry"))
>
> Check this link: http://www.omegahat.org/RCurl
> However, I think that it would be more useful to automate the
> interaction with servers retrieving automatically the name-value pairs
> required by the server (parsing the page source code) instead of
> examining in each web page the appropiate fields.
>
> 2012/10/30, Paul Gilbert <pgilbert902 at gmail.com>:
>> Jose
>>
>> As far as getting to the data, I think the best way to do this sort of
>> thing would be if the site supports a SOAP or REST interface. When they
>> don't (yet) then one is faced with clicking through some pages. Python
>> or Java is one way to automate the process of clicking through the
>> pages. I don't know how to do that in R, but would like to know if it is
>> possible.
>>
>> But, I guess I was confused about the part you want to improve. What I
>> have works fairly smoothly parsing and passing back JSON data, converted
>> from a csv file, into R. The downside is that this approach requires
>> more than R to be installed on the client machine. But if the object you
>> get back is ASPX, then you either need to parse it directly, or convert
>> it to JSON, or something else you can deal with. I suspect that will be
>> fairly specific to a particular web site, but I don't really know enough
>> about ASPX to be sure.
>>
>> Paul
>>
>> On 12-10-30 01:12 PM, jose ramon mazaira wrote:
>>> Thanks for your interest, Paul.
>>> I've checked the source code of TSjson and I've seen that what it does
>>> is to call a Python script to retrieve the data. In fact, I've already
>>> done this with Java using the URLConnection class and sending the
>>> requested values to fill the form.
>>> However, I think it would be more useful to open a connection with R
>>> and to send the requested values within R, and not through an external
>>> program.
>>> The application I've designed, like yours, is also page-specific
>>> (i.e., designed for
>>> http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx),
>>> but I think that our applications would be more powerful if they were
>>> able to parse the name-value pairs generated from ASPX (or of any
>>> other dynamically generated web page) and ask the user to select the
>>> appropiate values.
>>>
>>> 2012/10/30, Paul Gilbert <pgilbert902 at gmail.com>:
>>>> I think RHTMLForms works if you have a single form, but I have not been
>>>> able to see how to use it when you need to go through a sequence of
>>>> dynamically generated forms (like you can do with Python mechanize).
>>>>
>>>> Paul
>>>>
>>>> On 12-10-30 09:08 AM, Gabriel Becker wrote:
>>>>> I haven't used it extensively myself, and can't speak to it's current
>>>>> state but on quick inspection RHTMLForms seems worth a look for what
>>>>> you
>>>>> want.
>>>>>
>>>>> http://www.omegahat.org/RHTMLForms/
>>>>>
>>>>> ~G
>>>>>
>>>>> On Tue, Oct 30, 2012 t 5:38 AM, Paul Gilbert <pgilbert902 at gmail.com
>>>>> <mailto:pgilbert902 at gmail.com>> wrote:
>>>>>
>>>>>       I don't know of an easy way to do this in R. I've been doing
>>>>>       something similar with python scripts called from R. If anyone
>>>>> knows
>>>>>       how to do this with just R, I would appreciate hearing too.
>>>>>
>>>>>       Paul
>>>>>
>>>>>
>>>>>       On 12-10-29 04:11 PM, jose ramon mazaira wrote:
>>>>>
>>>>>           Hi. I'm trying to write an application to retrieve financial
>>>>> data
>>>>>           (specially bonds data) from FINRA. The web page is served
>>>>>           dynamically
>>>>>           from an asp.net <http://asp.net> application:
>>>>>
>>>>>
>>>>> http://cxa.gtm.__idmanagedsolutions.com/finra/__BondCenter/AdvancedScreener.__aspx
>>>>>
>>>>> <http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx>
>>>>>
>>>>>           I'd like to know if it's possible to fill dynamically the web
>>>>> page
>>>>>           form from R and, after filling it (with the issuer name),
>>>>>           retrieve the
>>>>>           web page, parse the data, and covert it to appropiate R
>>>>> objects.
>>>>>           For example, suppose I want to search data for AT&T bonds. I'd
>>>>>           like to
>>>>>           know if it's possible, within R, to fill the page served from:
>>>>>
>>>>>
>>>>> http://cxa.gtm.__idmanagedsolutions.com/finra/__BondCenter/AdvancedScreener.__aspx
>>>>>
>>>>> <http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx>
>>>>>
>>>>>           select the "corporate" option and fill with AT&T the field for
>>>>>           "Issuer
>>>>>           name", ask the page to display the results, and retrieve the
>>>>> results
>>>>>           for each of the bonds issued by AT&T (for example:
>>>>>
>>>>>
>>>>> http://cxa.gtm.__idmanagedsolutions.com/finra/__BondCenter/BondDetail.aspx?ID=__MDAxOTU3Qko3
>>>>>
>>>>> <http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/BondDetail.aspx?ID=MDAxOTU3Qko3>)
>>>>>
>>>>>           and parsing the data from the web page.
>>>>>
>>>>>           Thanks in advance.
>>>>>
>>>>>           ________________________________________________
>>>>>           R-devel at r-project.org <mailto:R-devel at r-project.org> mailing
>>>>> list
>>>>>           https://stat.ethz.ch/mailman/__listinfo/r-devel
>>>>>           <https://stat.ethz.ch/mailman/listinfo/r-devel>
>>>>>
>>>>>
>>>>>       ________________________________________________
>>>>>       R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>>>>>       https://stat.ethz.ch/mailman/__listinfo/r-devel
>>>>>       <https://stat.ethz.ch/mailman/listinfo/r-devel>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> Gabriel Becker
>>>>> Graduate Student
>>>>> Statistics Department
>>>>> University of California, Davis
>>>>>
>>>>
>>


From hb at biostat.ucsf.edu  Wed Oct 31 22:04:04 2012
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Wed, 31 Oct 2012 14:04:04 -0700
Subject: [Rd] file.symlink() creates zero-size file/link on Windows
	7/NTFS/admin
Message-ID: <CAFDcVCRh3FSRadsdPpEXg5VRv51HZYU3=yKMu-rr+RYYZrG6=w@mail.gmail.com>

With R 2.15.2 patched (2012-10-29 r61044) and R devel
(2012-10-29r61044) on **Windows 7 w/ NTFS ** running in admin mode, I
get:

EXAMPLE:
> cat("Hello world", file="foo.txt")
> file.exists("foo-lnk.txt")
[1] FALSE
> res <- file.symlink(from="foo.txt", to="foo-lnk.txt")
> warnings()
NULL
> res
[1] TRUE
> file.info("foo-lnk.txt")$size
[1] 0

That zero-size "foo-lnk.txt" file/link is invalid, correct?  Am I
doing something wrong?  Should I expect file.syslink() to work on my
system?

SUGGESTION:
Currently I have a wrapper that checks if file.symlink() creates a
zero-size file/link, and if so, it file.remove() it.  There are
several notes/disclaimers in help("file.symlink", package="base") on
creating symbolic links on Windows. Despite those, wouldn't it be
better if file.symlink() detected that it created an empty file/link
and removed it together with a warning/an error analogously to the
other conditions it may throw?

DETAILS:
>From src/main/platform.c::do_filesymlink() it looks like it's Windows
that creates the empty file but still returning 0:

#ifdef Win32
[...]
 pCSL = (PCSL) GetProcAddress(GetModuleHandle(TEXT("kernel32.dll")),
"CreateSymbolicLinkW");
 [...]
 LOGICAL(ans)[i] = pCSL(to, from, isDir) != 0;
 if(!LOGICAL(ans)[i])
   warning(_("cannot symlink '%ls' to '%ls', reason '%s'"), from, to,
formatError(GetLastError()));


> sessionInfo()
R Under development (unstable) (2012-10-29 r61044)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] tools_2.16.0

Thanks,

Henrik


From jmc at r-project.org  Wed Oct 31 22:34:41 2012
From: jmc at r-project.org (John Chambers)
Date: Wed, 31 Oct 2012 14:34:41 -0700
Subject: [Rd] Class generator functions for reference classes
In-Reply-To: <509041F1.1050004@r-project.org>
References: <508C4D16.4070104@r-project.org> <509041F1.1050004@r-project.org>
Message-ID: <50919971.5030407@r-project.org>

The values returned by setRefClass(), getRefClass() now  (rev. 61058) 
have  class "refObjectGenerator" as they do in 2.15.2, for the sake of 
back compatibility.

This is only a reversion of the class name.  The behavior of such 
objects as generator functions with additional reference methods should 
remain as in rev. 61035.

John

On 10/30/12 2:09 PM, John Chambers wrote:
> A heads up for those using Rcpp and perhaps other packages related to
> reference classes.
>
> The changes in 61035 cause a problem for classes defined with a slot
> using the return value of setRefClass(), notably for Rcpp. The name of
> that class changed.
>
> Rather than introduce back-incompatibility, I will rename a couple of
> classes so the class name of the return value remains the same.  (It's
> not as natural a naming scheme as what is in place, but not the first
> time back-compatibility has won out over preferred design.)
>
> It will be a day or two before I can get to this, so don't panic if your
> package does not install from the current r-devel until then.
>
> John
>
> On 10/27/12 2:07 PM, John Chambers wrote:
>> As of rev. 61035 in r-devel, setRefClass() now returns a generator
>> function, as setClass() has done since 2.15.0.
>>
>> The convenient style is now:
>>   mEdit <- setRefClass("mEdit",......)
>>   xx <- mEdit(data = xMat)
>>
>> instead of
>>   xx <- mEdit$new(data = xMat)
>>
>> The returned object still has fields and methods accessible as before.
>>
>> See the "Value" and "Reference Class Generators" sections of
>> ?ReferenceClasses for details.
>>
>> Thanks to Romain Fran?ois for suggesting this.
>>
>> John
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From hpages at fhcrc.org  Wed Oct 31 23:00:29 2012
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Wed, 31 Oct 2012 15:00:29 -0700
Subject: [Rd] Incomplete list of default fields in man page for
	available.packages()
Message-ID: <50919F7D.2000305@fhcrc.org>

Hi,

Found in available.packages man page:

   Value:

      A matrix with one row per package, row names the package names and
      column names ?"Package"?, ?"Version"?, ?"Priority"?, ?"Depends"?,
      ?"Imports"?, ?"LinkingTo"?, ?"Suggests"?, ?"Enhances"?,
      ?"OS_type"?, ?"License"?, ?"File"? and ?"Repository"?.  Additional
      columns can be specified using the ?fields? argument.

"Archs" is missing from the above list:

   > colnames(available.packages())
    [1] "Package"    "Version"    "Priority"   "Depends"    "Imports"
    [6] "LinkingTo"  "Suggests"   "Enhances"   "OS_type"    "License"
   [11] "Archs"      "File"       "Repository"

Thanks,
H.


 > sessionInfo()
R Under development (unstable) (2012-10-31 r61057)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
  [7] LC_PAPER=C                 LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] tcltk_2.16.0 tools_2.16.0

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From jtalbot at stanford.edu  Wed Oct 31 16:38:33 2012
From: jtalbot at stanford.edu (Justin Talbot)
Date: Wed, 31 Oct 2012 08:38:33 -0700
Subject: [Rd] There is pmin and pmax each taking na.rm, how about psum?
Message-ID: <CALLn38N-wJz=n9bwQyzkzM1pE2eUDcE=FOgCiUnwPmKkXAyQ2A@mail.gmail.com>

> Because that's inconsistent with pmin and pmax when two NAs are summed.
>
> x = c(1,3,NA,NA,5)
> y = c(2,NA,4,NA,1)
> colSums(rbind(x, y), na.rm = TRUE)
> [1] 3 3 4 0 6    # actual
> [1] 3 3 4 NA 6   # desired

But your desired result would be inconsistent with sum:
sum(NA,NA,na.rm=TRUE)
[1] 0

>From a language definition perspective I think having psum return 0
here is right choice. R consistently distinguishes between operators
that have a sensible identity (+:0, *:1, &:TRUE, |:FALSE) which return
the identity if removing NAs results in no items, and those that kind
of don't (pmin, pmax) which return NA. Let's not break that.

(I would argue that pmin and pmax should return their actual
identities too: Inf and -Inf respectively, but I can understand the
current behavior.)


My 2 cents on psum:

R has a natural set of associative & commutative operators: +, *, &,
|, pmin, pmax.

These correspond directly to the reduction functions: sum, prod, all,
any, min, max

The current problem is that pmin and pmax are more powerful than +, *,
&, and |. The right fix is to extend the rest of the associative &
commutative operators to have the same power as pmin and pmax.

Thus, + should have the signature: `+`(..., na.rm=FALSE), which would
allow you to do things like:

`+`(c(1,2),c(1,2),c(1,2),NA, na.rm=TRUE) = c(3,6)

If you don't like typing `+`, you could always alias psum to `+`.

Additionally, R currently has two simple reduction functions that
don't have corresponding operators: range and length. Having a prange
operator and a plength operator would nicely round out the language.

Justin


From jramaza at gmail.com  Tue Oct 30 18:12:21 2012
From: jramaza at gmail.com (jose ramon mazaira)
Date: Tue, 30 Oct 2012 18:12:21 +0100
Subject: [Rd] Retrieving data from aspx pages
In-Reply-To: <508FD791.6090209@gmail.com>
References: <CAMd97KyY-PMRFZ=ktgqp2t-u73vs2_frcWLE31uOivU9T-j5Yg@mail.gmail.com>
	<508FCA3F.2070104@gmail.com>
	<CADwqtCNafNe=daUD7BAcvb2wS8rgNvtCJPynBuukqvNOtO0BbA@mail.gmail.com>
	<508FD791.6090209@gmail.com>
Message-ID: <CAMd97KztkXTpj99JsMxOzSy=cmg9PmM15Fq43t1tLFNBfeVaoA@mail.gmail.com>

Thanks for your interest, Paul.
I've checked the source code of TSjson and I've seen that what it does
is to call a Python script to retrieve the data. In fact, I've already
done this with Java using the URLConnection class and sending the
requested values to fill the form.
However, I think it would be more useful to open a connection with R
and to send the requested values within R, and not through an external
program.
The application I've designed, like yours, is also page-specific
(i.e., designed for
http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx),
but I think that our applications would be more powerful if they were
able to parse the name-value pairs generated from ASPX (or of any
other dynamically generated web page) and ask the user to select the
appropiate values.

2012/10/30, Paul Gilbert <pgilbert902 at gmail.com>:
> I think RHTMLForms works if you have a single form, but I have not been
> able to see how to use it when you need to go through a sequence of
> dynamically generated forms (like you can do with Python mechanize).
>
> Paul
>
> On 12-10-30 09:08 AM, Gabriel Becker wrote:
>> I haven't used it extensively myself, and can't speak to it's current
>> state but on quick inspection RHTMLForms seems worth a look for what you
>> want.
>>
>> http://www.omegahat.org/RHTMLForms/
>>
>> ~G
>>
>> On Tue, Oct 30, 2012 t 5:38 AM, Paul Gilbert <pgilbert902 at gmail.com
>> <mailto:pgilbert902 at gmail.com>> wrote:
>>
>>     I don't know of an easy way to do this in R. I've been doing
>>     something similar with python scripts called from R. If anyone knows
>>     how to do this with just R, I would appreciate hearing too.
>>
>>     Paul
>>
>>
>>     On 12-10-29 04:11 PM, jose ramon mazaira wrote:
>>
>>         Hi. I'm trying to write an application to retrieve financial data
>>         (specially bonds data) from FINRA. The web page is served
>>         dynamically
>>         from an asp.net <http://asp.net> application:
>>
>>
>> http://cxa.gtm.__idmanagedsolutions.com/finra/__BondCenter/AdvancedScreener.__aspx
>>
>> <http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx>
>>
>>         I'd like to know if it's possible to fill dynamically the web
>> page
>>         form from R and, after filling it (with the issuer name),
>>         retrieve the
>>         web page, parse the data, and covert it to appropiate R objects.
>>         For example, suppose I want to search data for AT&T bonds. I'd
>>         like to
>>         know if it's possible, within R, to fill the page served from:
>>
>>
>> http://cxa.gtm.__idmanagedsolutions.com/finra/__BondCenter/AdvancedScreener.__aspx
>>
>> <http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx>
>>
>>         select the "corporate" option and fill with AT&T the field for
>>         "Issuer
>>         name", ask the page to display the results, and retrieve the
>> results
>>         for each of the bonds issued by AT&T (for example:
>>
>>
>> http://cxa.gtm.__idmanagedsolutions.com/finra/__BondCenter/BondDetail.aspx?ID=__MDAxOTU3Qko3
>>
>> <http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/BondDetail.aspx?ID=MDAxOTU3Qko3>)
>>
>>         and parsing the data from the web page.
>>
>>         Thanks in advance.
>>
>>         ________________________________________________
>>         R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>>         https://stat.ethz.ch/mailman/__listinfo/r-devel
>>         <https://stat.ethz.ch/mailman/listinfo/r-devel>
>>
>>
>>     ________________________________________________
>>     R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>>     https://stat.ethz.ch/mailman/__listinfo/r-devel
>>     <https://stat.ethz.ch/mailman/listinfo/r-devel>
>>
>>
>>
>>
>> --
>> Gabriel Becker
>> Graduate Student
>> Statistics Department
>> University of California, Davis
>>
>


From jramaza at gmail.com  Wed Oct 31 17:14:54 2012
From: jramaza at gmail.com (jose ramon mazaira)
Date: Wed, 31 Oct 2012 17:14:54 +0100
Subject: [Rd] Retrieving data from aspx pages
In-Reply-To: <509026FB.6000302@gmail.com>
References: <CAMd97KyY-PMRFZ=ktgqp2t-u73vs2_frcWLE31uOivU9T-j5Yg@mail.gmail.com>
	<508FCA3F.2070104@gmail.com>
	<CADwqtCNafNe=daUD7BAcvb2wS8rgNvtCJPynBuukqvNOtO0BbA@mail.gmail.com>
	<508FD791.6090209@gmail.com>
	<CAMd97KztkXTpj99JsMxOzSy=cmg9PmM15Fq43t1tLFNBfeVaoA@mail.gmail.com>
	<509026FB.6000302@gmail.com>
Message-ID: <CAMd97KyACq9nv0vpc+iVTYAXjxXBmNL2ScjcCgaL+1r=NZ3BaQ@mail.gmail.com>

I'd like to make you note that I've discovered that package RCurl
already provides a utility that allows interaction via POST requests
with servers. In fact, the FAQ for RCurl contains specifically an
example with an aspx page:

x = postForm("http://www.fas.usda.gov/psdonline/psdResult.aspx",
             style = "post",
            .params = list(visited="1",
                          lstGroup = "all",
                          lstCommodity="2631000",
                          lstAttribute="88",
                          lstCountry="**",
                          lstDate="2011",
                          lstColumn="Year",
                          lstOrder="Commodity%2FAttribute%2FCountry"))

Check this link: http://www.omegahat.org/RCurl
However, I think that it would be more useful to automate the
interaction with servers retrieving automatically the name-value pairs
required by the server (parsing the page source code) instead of
examining in each web page the appropiate fields.

2012/10/30, Paul Gilbert <pgilbert902 at gmail.com>:
> Jose
>
> As far as getting to the data, I think the best way to do this sort of
> thing would be if the site supports a SOAP or REST interface. When they
> don't (yet) then one is faced with clicking through some pages. Python
> or Java is one way to automate the process of clicking through the
> pages. I don't know how to do that in R, but would like to know if it is
> possible.
>
> But, I guess I was confused about the part you want to improve. What I
> have works fairly smoothly parsing and passing back JSON data, converted
> from a csv file, into R. The downside is that this approach requires
> more than R to be installed on the client machine. But if the object you
> get back is ASPX, then you either need to parse it directly, or convert
> it to JSON, or something else you can deal with. I suspect that will be
> fairly specific to a particular web site, but I don't really know enough
> about ASPX to be sure.
>
> Paul
>
> On 12-10-30 01:12 PM, jose ramon mazaira wrote:
>> Thanks for your interest, Paul.
>> I've checked the source code of TSjson and I've seen that what it does
>> is to call a Python script to retrieve the data. In fact, I've already
>> done this with Java using the URLConnection class and sending the
>> requested values to fill the form.
>> However, I think it would be more useful to open a connection with R
>> and to send the requested values within R, and not through an external
>> program.
>> The application I've designed, like yours, is also page-specific
>> (i.e., designed for
>> http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx),
>> but I think that our applications would be more powerful if they were
>> able to parse the name-value pairs generated from ASPX (or of any
>> other dynamically generated web page) and ask the user to select the
>> appropiate values.
>>
>> 2012/10/30, Paul Gilbert <pgilbert902 at gmail.com>:
>>> I think RHTMLForms works if you have a single form, but I have not been
>>> able to see how to use it when you need to go through a sequence of
>>> dynamically generated forms (like you can do with Python mechanize).
>>>
>>> Paul
>>>
>>> On 12-10-30 09:08 AM, Gabriel Becker wrote:
>>>> I haven't used it extensively myself, and can't speak to it's current
>>>> state but on quick inspection RHTMLForms seems worth a look for what
>>>> you
>>>> want.
>>>>
>>>> http://www.omegahat.org/RHTMLForms/
>>>>
>>>> ~G
>>>>
>>>> On Tue, Oct 30, 2012 t 5:38 AM, Paul Gilbert <pgilbert902 at gmail.com
>>>> <mailto:pgilbert902 at gmail.com>> wrote:
>>>>
>>>>      I don't know of an easy way to do this in R. I've been doing
>>>>      something similar with python scripts called from R. If anyone
>>>> knows
>>>>      how to do this with just R, I would appreciate hearing too.
>>>>
>>>>      Paul
>>>>
>>>>
>>>>      On 12-10-29 04:11 PM, jose ramon mazaira wrote:
>>>>
>>>>          Hi. I'm trying to write an application to retrieve financial
>>>> data
>>>>          (specially bonds data) from FINRA. The web page is served
>>>>          dynamically
>>>>          from an asp.net <http://asp.net> application:
>>>>
>>>>
>>>> http://cxa.gtm.__idmanagedsolutions.com/finra/__BondCenter/AdvancedScreener.__aspx
>>>>
>>>> <http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx>
>>>>
>>>>          I'd like to know if it's possible to fill dynamically the web
>>>> page
>>>>          form from R and, after filling it (with the issuer name),
>>>>          retrieve the
>>>>          web page, parse the data, and covert it to appropiate R
>>>> objects.
>>>>          For example, suppose I want to search data for AT&T bonds. I'd
>>>>          like to
>>>>          know if it's possible, within R, to fill the page served from:
>>>>
>>>>
>>>> http://cxa.gtm.__idmanagedsolutions.com/finra/__BondCenter/AdvancedScreener.__aspx
>>>>
>>>> <http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/AdvancedScreener.aspx>
>>>>
>>>>          select the "corporate" option and fill with AT&T the field for
>>>>          "Issuer
>>>>          name", ask the page to display the results, and retrieve the
>>>> results
>>>>          for each of the bonds issued by AT&T (for example:
>>>>
>>>>
>>>> http://cxa.gtm.__idmanagedsolutions.com/finra/__BondCenter/BondDetail.aspx?ID=__MDAxOTU3Qko3
>>>>
>>>> <http://cxa.gtm.idmanagedsolutions.com/finra/BondCenter/BondDetail.aspx?ID=MDAxOTU3Qko3>)
>>>>
>>>>          and parsing the data from the web page.
>>>>
>>>>          Thanks in advance.
>>>>
>>>>          ________________________________________________
>>>>          R-devel at r-project.org <mailto:R-devel at r-project.org> mailing
>>>> list
>>>>          https://stat.ethz.ch/mailman/__listinfo/r-devel
>>>>          <https://stat.ethz.ch/mailman/listinfo/r-devel>
>>>>
>>>>
>>>>      ________________________________________________
>>>>      R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>>>>      https://stat.ethz.ch/mailman/__listinfo/r-devel
>>>>      <https://stat.ethz.ch/mailman/listinfo/r-devel>
>>>>
>>>>
>>>>
>>>>
>>>> --
>>>> Gabriel Becker
>>>> Graduate Student
>>>> Statistics Department
>>>> University of California, Davis
>>>>
>>>
>


