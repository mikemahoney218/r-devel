From jeff.horner at vanderbilt.edu  Fri Sep  1 00:07:32 2006
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Thu, 31 Aug 2006 17:07:32 -0500
Subject: [Rd] Overriding InitTempDir
Message-ID: <44F75DA4.6000209@vanderbilt.edu>

For embedded projects, one may want to eliminate the per-session temp 
directory created by InitTempDir() and just use a system-specific temp 
directory. Here's my solution:

extern char *R_TempDir;

void my_InitTempDir()
{
     char *tmp;

     if (R_TempDir){
         if (rmdir(R_TempDir) != 0){
             perror("Fatal Error: could not remove R's TempDir!");
             exit(1);
         }
     }

     tmp = getenv("TMPDIR");
     if (tmp == NULL) {
         tmp = getenv("TMP");
             if (tmp == NULL) {
                 tmp = getenv("TEMP");
                 if (tmp == NULL)
                     tmp = "/tmp";
             }
     }

     R_TempDir=tmp;

     if (setenv("R_SESSION_TMPDIR",tmp,1) != 0){
         perror("Fatal Error: couldn't set/replace R_SESSION_TMPDIR!");
         exit(1);
     }
}

This function is called after Rf_initEmbeddedR; it's seems like a hack 
but it works. Does anyone have other solutions?

Maybe InitTempDir could check if R_TempDir was not NULL and then just 
return.

-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner



From ripley at stats.ox.ac.uk  Fri Sep  1 07:35:08 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 1 Sep 2006 06:35:08 +0100 (BST)
Subject: [Rd] S4 changes - sp fails
In-Reply-To: <Pine.LNX.4.44.0608312159380.5231-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0608312159380.5231-100000@reclus.nhh.no>
Message-ID: <Pine.LNX.4.64.0609010622070.1772@gannet.stats.ox.ac.uk>

Roger,

I had managed to run R CMD check on sp successfully on r39021 and r39043 
(current) in my nightly checks.  (There are a couple of tests where the 
show/print method is not being invoked, but that is not new.)

All I can suggest is to install R from scratch (make distclean), and then 
reinstall all relevant packages.  At a guess, your interactive use and R 
CMD check are picking up different libraries.

There are around a dozen S4-using packages on CRAN that are currently 
failing their checks: some look like newly-discovered bugs but some look 
like problems in S4 dispatch (even of S3 dispatch for S3 generics turned 
into S4 generics).  More are producing apparently incorrect warnings.

Brian


On Thu, 31 Aug 2006, Roger Bivand wrote:

> Under R version 2.4.0 (2006-08-30 r39024), sp fails CMD check following
> the latest changes in methods.
> 
> The failures are in running examples and occur in CMD check:
> 
> > data(state)
> > dd2dms(state.center$x)
> Error in function (classes, fdef, mtable)  : 
>         unable to find an inherited method for function "initialize", for 
> signature "integer"
> 
> Offending code:
> 
> 	deg <- as(floor(dd), "integer") 
> 
> After replacing by as.integer(floor(dd)), it fails on the local class 
> definition:
> 
> > dd2dms(state.center$x)
> Error in function (classes, fdef, mtable)  : 
>         unable to find an inherited method for function "initialize", for 
> signature "DMS"
> 
> Installing sp, example("DMS-class") runs successfully interactively 
> (other examples do too).
> 
> The methods package is declared as Depends: in DESCRIPTION, and
> import(methods) in NAMESPACE; 
> 
> .onLoad <- function(lib, pkg) require(methods) is in the first R source 
> file in Collate: order.
> 
> Should the methods package be being invoked in some other way, is there a 
> reason why the installed package appears to run examples successfully that 
> fail under CMD check?
> 
> Roger
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From Roger.Bivand at nhh.no  Fri Sep  1 10:23:04 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 1 Sep 2006 10:23:04 +0200 (CEST)
Subject: [Rd] S4 changes - sp fails
In-Reply-To: <Pine.LNX.4.64.0609010622070.1772@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.44.0609010931490.5844-100000@reclus.nhh.no>

On Fri, 1 Sep 2006, Prof Brian Ripley wrote:

> Roger,
> 
> I had managed to run R CMD check on sp successfully on r39021 and r39043 
> (current) in my nightly checks.  (There are a couple of tests where the 
> show/print method is not being invoked, but that is not new.)
> 
> All I can suggest is to install R from scratch (make distclean), and then 
> reinstall all relevant packages.  At a guess, your interactive use and R 
> CMD check are picking up different libraries.

Brian,

I added .libPaths() and sessionInfo() to the offending example, and tried
with a fresh svn checkout built in a fresh directory and installed in a
fresh directory (no sp or methods in /home/rsb/topics/r_libs, which was
set with export R_LIBS=):

> data(state)
> .libPaths()
[1] "/home/rsb/topics/packages/sp-bundle/sp.Rcheck"
[2] "/home/rsb/topics/r_libs"                      
[3] "/home/rsb/topics/Rtobe240/lib/R/library"      
> sessionInfo()
R version 2.4.0 Under development (unstable) (2006-08-31 r39045) 
i686-pc-linux-gnu 

locale:
LC_CTYPE=en_GB;LC_NUMERIC=C;LC_TIME=en_GB;LC_COLLATE=en_GB;LC_MONETARY=en_GB;LC_
MESSAGES=en_GB;LC_PAPER=en_GB;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREME
NT=en_GB;LC_IDENTIFICATION=C

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[7] "base"     

other attached packages:
      sp 
"0.8-19" 
> dd2dms(state.center$x)
Error in function (classes, fdef, mtable)  : 
        unable to find an inherited method for function "initialize", for 
signature "integer"
Execution halted

I also tried to replicate the problem by making a new, very small, package 
with just the apparently offending files:

spS4:
DESCRIPTION  man/  NAMESPACE  R/

spS4/man:
char2dms.Rd  DMS-class.Rd

spS4/R:
AAA.R  dms.R

and edited DESCRIPTION, NAMESPACE, and AAA.R to suit. In this setting 
there was no problem. I'll carry on looking. None of these files has 
changed between released 0.8-18 and CVS 0.8-19. 

Roger

> 
> There are around a dozen S4-using packages on CRAN that are currently 
> failing their checks: some look like newly-discovered bugs but some look 
> like problems in S4 dispatch (even of S3 dispatch for S3 generics turned 
> into S4 generics).  More are producing apparently incorrect warnings.
> 
> Brian
> 
> 
> On Thu, 31 Aug 2006, Roger Bivand wrote:
> 
> > Under R version 2.4.0 (2006-08-30 r39024), sp fails CMD check following
> > the latest changes in methods.
> > 
> > The failures are in running examples and occur in CMD check:
> > 
> > > data(state)
> > > dd2dms(state.center$x)
> > Error in function (classes, fdef, mtable)  : 
> >         unable to find an inherited method for function "initialize", for 
> > signature "integer"
> > 
> > Offending code:
> > 
> > 	deg <- as(floor(dd), "integer") 
> > 
> > After replacing by as.integer(floor(dd)), it fails on the local class 
> > definition:
> > 
> > > dd2dms(state.center$x)
> > Error in function (classes, fdef, mtable)  : 
> >         unable to find an inherited method for function "initialize", for 
> > signature "DMS"
> > 
> > Installing sp, example("DMS-class") runs successfully interactively 
> > (other examples do too).
> > 
> > The methods package is declared as Depends: in DESCRIPTION, and
> > import(methods) in NAMESPACE; 
> > 
> > .onLoad <- function(lib, pkg) require(methods) is in the first R source 
> > file in Collate: order.
> > 
> > Should the methods package be being invoked in some other way, is there a 
> > reason why the installed package appears to run examples successfully that 
> > fail under CMD check?
> > 
> > Roger
> > 
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From ripley at stats.ox.ac.uk  Fri Sep  1 10:28:08 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 1 Sep 2006 09:28:08 +0100 (BST)
Subject: [Rd] S4 changes - sp fails
In-Reply-To: <Pine.LNX.4.44.0609010931490.5844-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0609010931490.5844-100000@reclus.nhh.no>
Message-ID: <Pine.LNX.4.64.0609010925120.26402@gannet.stats.ox.ac.uk>

Since writing that, I have found that there is a similar problem with 
testing mvoutliers (which does load sp), and it depends on exactly what 
has been done in what order.  (I'll forward to you the exact description.)

I now suspect there is a protection problem in the new S4 dispatch code.
Using gctorture/valgrind may help locate it.

Brian

On Fri, 1 Sep 2006, Roger Bivand wrote:

> On Fri, 1 Sep 2006, Prof Brian Ripley wrote:
> 
> > Roger,
> > 
> > I had managed to run R CMD check on sp successfully on r39021 and r39043 
> > (current) in my nightly checks.  (There are a couple of tests where the 
> > show/print method is not being invoked, but that is not new.)
> > 
> > All I can suggest is to install R from scratch (make distclean), and then 
> > reinstall all relevant packages.  At a guess, your interactive use and R 
> > CMD check are picking up different libraries.
> 
> Brian,
> 
> I added .libPaths() and sessionInfo() to the offending example, and tried
> with a fresh svn checkout built in a fresh directory and installed in a
> fresh directory (no sp or methods in /home/rsb/topics/r_libs, which was
> set with export R_LIBS=):
> 
> > data(state)
> > .libPaths()
> [1] "/home/rsb/topics/packages/sp-bundle/sp.Rcheck"
> [2] "/home/rsb/topics/r_libs"                      
> [3] "/home/rsb/topics/Rtobe240/lib/R/library"      
> > sessionInfo()
> R version 2.4.0 Under development (unstable) (2006-08-31 r39045) 
> i686-pc-linux-gnu 
> 
> locale:
> LC_CTYPE=en_GB;LC_NUMERIC=C;LC_TIME=en_GB;LC_COLLATE=en_GB;LC_MONETARY=en_GB;LC_
> MESSAGES=en_GB;LC_PAPER=en_GB;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREME
> NT=en_GB;LC_IDENTIFICATION=C
> 
> attached base packages:
> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets" 
> [7] "base"     
> 
> other attached packages:
>       sp 
> "0.8-19" 
> > dd2dms(state.center$x)
> Error in function (classes, fdef, mtable)  : 
>         unable to find an inherited method for function "initialize", for 
> signature "integer"
> Execution halted
> 
> I also tried to replicate the problem by making a new, very small, package 
> with just the apparently offending files:
> 
> spS4:
> DESCRIPTION  man/  NAMESPACE  R/
> 
> spS4/man:
> char2dms.Rd  DMS-class.Rd
> 
> spS4/R:
> AAA.R  dms.R
> 
> and edited DESCRIPTION, NAMESPACE, and AAA.R to suit. In this setting 
> there was no problem. I'll carry on looking. None of these files has 
> changed between released 0.8-18 and CVS 0.8-19. 
> 
> Roger
> 
> > 
> > There are around a dozen S4-using packages on CRAN that are currently 
> > failing their checks: some look like newly-discovered bugs but some look 
> > like problems in S4 dispatch (even of S3 dispatch for S3 generics turned 
> > into S4 generics).  More are producing apparently incorrect warnings.
> > 
> > Brian
> > 
> > 
> > On Thu, 31 Aug 2006, Roger Bivand wrote:
> > 
> > > Under R version 2.4.0 (2006-08-30 r39024), sp fails CMD check following
> > > the latest changes in methods.
> > > 
> > > The failures are in running examples and occur in CMD check:
> > > 
> > > > data(state)
> > > > dd2dms(state.center$x)
> > > Error in function (classes, fdef, mtable)  : 
> > >         unable to find an inherited method for function "initialize", for 
> > > signature "integer"
> > > 
> > > Offending code:
> > > 
> > > 	deg <- as(floor(dd), "integer") 
> > > 
> > > After replacing by as.integer(floor(dd)), it fails on the local class 
> > > definition:
> > > 
> > > > dd2dms(state.center$x)
> > > Error in function (classes, fdef, mtable)  : 
> > >         unable to find an inherited method for function "initialize", for 
> > > signature "DMS"
> > > 
> > > Installing sp, example("DMS-class") runs successfully interactively 
> > > (other examples do too).
> > > 
> > > The methods package is declared as Depends: in DESCRIPTION, and
> > > import(methods) in NAMESPACE; 
> > > 
> > > .onLoad <- function(lib, pkg) require(methods) is in the first R source 
> > > file in Collate: order.
> > > 
> > > Should the methods package be being invoked in some other way, is there a 
> > > reason why the installed package appears to run examples successfully that 
> > > fail under CMD check?
> > > 
> > > Roger
> > > 
> > > 
> > 
> > 
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From Roger.Bivand at nhh.no  Fri Sep  1 11:07:24 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 1 Sep 2006 11:07:24 +0200 (CEST)
Subject: [Rd] S4 changes - sp fails
In-Reply-To: <Pine.LNX.4.64.0609010925120.26402@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.44.0609011053390.5844-100000@reclus.nhh.no>

On Fri, 1 Sep 2006, Prof Brian Ripley wrote:

> Since writing that, I have found that there is a similar problem with 
> testing mvoutliers (which does load sp), and it depends on exactly what 
> has been done in what order.  (I'll forward to you the exact description.)

Thanks.

I reran the interactive test:

library(sp, lib.loc="sp.Rcheck")
example("DMS-class")

which ran without problems.

> .libPaths()
[1] "/home/rsb/topics/r_libs"                
[2] "/home/rsb/topics/Rtobe240/lib/R/library"
> list.files(.libPaths()[1])
[1] "abind"        "maptools"     "pixmap"       "RColorBrewer" "R.css"       
[6] "rgdal"        "SparseM"      "spdep"        "tripack"
> sessionInfo()
R version 2.4.0 Under development (unstable) (2006-08-31 r39045) 
i686-pc-linux-gnu 

locale:
LC_CTYPE=en_GB;LC_NUMERIC=C;LC_TIME=en_GB;LC_COLLATE=en_GB;LC_MONETARY=en_GB;LC_
MESSAGES=en_GB;LC_PAPER=en_GB;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREME
NT=en_GB;LC_IDENTIFICATION=C

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[7] "base"     

other attached packages:
      sp 
"0.8-19" 

> 
> I now suspect there is a protection problem in the new S4 dispatch code.
> Using gctorture/valgrind may help locate it.

Running check --use-gct sp now.

Roger

> 
> Brian
> 
> On Fri, 1 Sep 2006, Roger Bivand wrote:
> 
> > On Fri, 1 Sep 2006, Prof Brian Ripley wrote:
> > 
> > > Roger,
> > > 
> > > I had managed to run R CMD check on sp successfully on r39021 and r39043 
> > > (current) in my nightly checks.  (There are a couple of tests where the 
> > > show/print method is not being invoked, but that is not new.)
> > > 
> > > All I can suggest is to install R from scratch (make distclean), and then 
> > > reinstall all relevant packages.  At a guess, your interactive use and R 
> > > CMD check are picking up different libraries.
> > 
> > Brian,
> > 
> > I added .libPaths() and sessionInfo() to the offending example, and tried
> > with a fresh svn checkout built in a fresh directory and installed in a
> > fresh directory (no sp or methods in /home/rsb/topics/r_libs, which was
> > set with export R_LIBS=):
> > 
> > > data(state)
> > > .libPaths()
> > [1] "/home/rsb/topics/packages/sp-bundle/sp.Rcheck"
> > [2] "/home/rsb/topics/r_libs"                      
> > [3] "/home/rsb/topics/Rtobe240/lib/R/library"      
> > > sessionInfo()
> > R version 2.4.0 Under development (unstable) (2006-08-31 r39045) 
> > i686-pc-linux-gnu 
> > 
> > locale:
> > LC_CTYPE=en_GB;LC_NUMERIC=C;LC_TIME=en_GB;LC_COLLATE=en_GB;LC_MONETARY=en_GB;LC_
> > MESSAGES=en_GB;LC_PAPER=en_GB;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREME
> > NT=en_GB;LC_IDENTIFICATION=C
> > 
> > attached base packages:
> > [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets" 
> > [7] "base"     
> > 
> > other attached packages:
> >       sp 
> > "0.8-19" 
> > > dd2dms(state.center$x)
> > Error in function (classes, fdef, mtable)  : 
> >         unable to find an inherited method for function "initialize", for 
> > signature "integer"
> > Execution halted
> > 
> > I also tried to replicate the problem by making a new, very small, package 
> > with just the apparently offending files:
> > 
> > spS4:
> > DESCRIPTION  man/  NAMESPACE  R/
> > 
> > spS4/man:
> > char2dms.Rd  DMS-class.Rd
> > 
> > spS4/R:
> > AAA.R  dms.R
> > 
> > and edited DESCRIPTION, NAMESPACE, and AAA.R to suit. In this setting 
> > there was no problem. I'll carry on looking. None of these files has 
> > changed between released 0.8-18 and CVS 0.8-19. 
> > 
> > Roger
> > 
> > > 
> > > There are around a dozen S4-using packages on CRAN that are currently 
> > > failing their checks: some look like newly-discovered bugs but some look 
> > > like problems in S4 dispatch (even of S3 dispatch for S3 generics turned 
> > > into S4 generics).  More are producing apparently incorrect warnings.
> > > 
> > > Brian
> > > 
> > > 
> > > On Thu, 31 Aug 2006, Roger Bivand wrote:
> > > 
> > > > Under R version 2.4.0 (2006-08-30 r39024), sp fails CMD check following
> > > > the latest changes in methods.
> > > > 
> > > > The failures are in running examples and occur in CMD check:
> > > > 
> > > > > data(state)
> > > > > dd2dms(state.center$x)
> > > > Error in function (classes, fdef, mtable)  : 
> > > >         unable to find an inherited method for function "initialize", for 
> > > > signature "integer"
> > > > 
> > > > Offending code:
> > > > 
> > > > 	deg <- as(floor(dd), "integer") 
> > > > 
> > > > After replacing by as.integer(floor(dd)), it fails on the local class 
> > > > definition:
> > > > 
> > > > > dd2dms(state.center$x)
> > > > Error in function (classes, fdef, mtable)  : 
> > > >         unable to find an inherited method for function "initialize", for 
> > > > signature "DMS"
> > > > 
> > > > Installing sp, example("DMS-class") runs successfully interactively 
> > > > (other examples do too).
> > > > 
> > > > The methods package is declared as Depends: in DESCRIPTION, and
> > > > import(methods) in NAMESPACE; 
> > > > 
> > > > .onLoad <- function(lib, pkg) require(methods) is in the first R source 
> > > > file in Collate: order.
> > > > 
> > > > Should the methods package be being invoked in some other way, is there a 
> > > > reason why the installed package appears to run examples successfully that 
> > > > fail under CMD check?
> > > > 
> > > > Roger
> > > > 
> > > > 
> > > 
> > > 
> > 
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From gael.millot at curie.fr  Fri Sep  1 11:14:55 2006
From: gael.millot at curie.fr (gael.millot at curie.fr)
Date: Fri,  1 Sep 2006 11:14:55 +0200 (CEST)
Subject: [Rd] round() increases or decreases (PR#9195)
Message-ID: <20060901091455.2D1D519A0A@slim.kubism.ku.dk>

Full_Name: Gael Millot
Version: 2.3.1.
OS: XP
Submission from: (NULL) (195.220.102.23)


Hello.

I have a strange behavior with round() when it has to deal with 5.
It sometimes rounds up, sometimes rounds down. Example :

coma effect :
> round(0.5,0)
[1] 0
> round(0.25,1)
[1] 0.2
> round(0.225,2)
[1] 0.23

Previous number effect :
> round(0.35,1)
[1] 0.3
> round(0.45,1)
[1] 0.5

It also happens with signif()

Is it normal ?
Many thanks.

Gael.



From erich.neuwirth at univie.ac.at  Fri Sep  1 11:27:16 2006
From: erich.neuwirth at univie.ac.at (erich.neuwirth at univie.ac.at)
Date: Fri,  1 Sep 2006 11:27:16 +0200 (CEST)
Subject: [Rd] Date conversion with as.POSIXct and as.POSIXlt (PR#9196)
Message-ID: <20060901092716.784165866B@slim.kubism.ku.dk>

Full_Name: Erich Neuwirth
Version: 2.3.1
OS: Windows XP, Linux
Submission from: (NULL) (131.130.135.167)


Converting Sys.Date() to a POSIX compliant time type in different ways 
produces inconsistent results:
> Sys.date()
[1] "2006-09-01"
> as.POSIXct(Sys.Date())
[1] "2006-09-01 02:00:00 CEST"
> as.POSIXlt(Sys.Date())
[1] "2006-09-01"
> as.POSIXct(as.POSIXlt(Sys.Date()))
[1] "2006-09-01 01:00:00 CEST"

Applying as.POSIXct directly or first applying as.POSIXlt and then
applying as.POSIXct produces different results.

This happens on Linux with timezone "CEST"
> Sys.time()
[1] "2006-09-01 11:03:36 CEST"
and on Windows with timezone "W. Europe Daylight Time"
> Sys.time()
[1] "2006-09-01 11:11:15 W. Europe Daylight Time"



From berwin at maths.uwa.edu.au  Fri Sep  1 11:39:44 2006
From: berwin at maths.uwa.edu.au (berwin at maths.uwa.edu.au)
Date: Fri,  1 Sep 2006 11:39:44 +0200 (CEST)
Subject: [Rd] round() increases or decreases (PR#9195)
Message-ID: <20060901093944.7842B5869B@slim.kubism.ku.dk>

G'day Gael,

>>>>> "GM" == gael millot <gael.millot at curie.fr> writes:

    GM> I have a strange behavior with round() when it has to deal
    GM> with 5. [...]  It also happens with signif()

    GM> Is it normal ?
The "Details" section in the help page of round (?round or
help(round)) suggests yes.

Cheers,

        Berwin



From p.dalgaard at biostat.ku.dk  Fri Sep  1 12:08:38 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 01 Sep 2006 12:08:38 +0200
Subject: [Rd] Date conversion with as.POSIXct and as.POSIXlt (PR#9196)
In-Reply-To: <20060901092716.784165866B@slim.kubism.ku.dk>
References: <20060901092716.784165866B@slim.kubism.ku.dk>
Message-ID: <x264g7zyop.fsf@viggo.kubism.ku.dk>

erich.neuwirth at univie.ac.at writes:

> Full_Name: Erich Neuwirth
> Version: 2.3.1
> OS: Windows XP, Linux
> Submission from: (NULL) (131.130.135.167)
> 
> 
> Converting Sys.Date() to a POSIX compliant time type in different ways 
> produces inconsistent results:
> > Sys.date()
> [1] "2006-09-01"
> > as.POSIXct(Sys.Date())
> [1] "2006-09-01 02:00:00 CEST"
> > as.POSIXlt(Sys.Date())
> [1] "2006-09-01"
> > as.POSIXct(as.POSIXlt(Sys.Date()))
> [1] "2006-09-01 01:00:00 CEST"
> 
> Applying as.POSIXct directly or first applying as.POSIXlt and then
> applying as.POSIXct produces different results.
> 
> This happens on Linux with timezone "CEST"
> > Sys.time()
> [1] "2006-09-01 11:03:36 CEST"
> and on Windows with timezone "W. Europe Daylight Time"
> > Sys.time()
> [1] "2006-09-01 11:11:15 W. Europe Daylight Time"


Or,

> as.POSIXct(Sys.Date()) - as.POSIXlt(Sys.Date())
Time difference of 1 hours
> as.POSIXct(Sys.time()) - as.POSIXlt(Sys.time())
Time difference of -0.0003409386 secs

Whereas

> Sys.putenv("TZ"="GMT")
> as.POSIXct(Sys.Date()) - as.POSIXlt(Sys.Date())
Time difference of 0 secs

and

> Sys.putenv("TZ"="EST")
> as.POSIXct(Sys.Date()) - as.POSIXlt(Sys.Date())
Time difference of -5 hours

So the difference is that as.POSIXct works in GMT whereas as.POSIXlt
works in the local timezone w/o DST corrections, the point of the
latter likely being that

> as.POSIXlt(as.Date("2006-7-1"))-as.POSIXlt(as.Date("2006-1-1"))
Time difference of 181 days

comes out as an integer number of days.

BTW, the habit of format.POSIXlt dropping off the time when it is
exactly 01:00 in CEST (i.e. would have been midnight, save for
Daylight Savings Time) is a bit confusing too...  

I'm not sure any of this is actual bugs (Brian will tell us soon
enough), but it does appear at least to be underdocumented.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From ripley at stats.ox.ac.uk  Fri Sep  1 12:21:28 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 1 Sep 2006 11:21:28 +0100 (BST)
Subject: [Rd] Date conversion with as.POSIXct and as.POSIXlt (PR#9196)
In-Reply-To: <20060901092716.784165866B@slim.kubism.ku.dk>
References: <20060901092716.784165866B@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0609011115500.11470@gannet.stats.ox.ac.uk>

You misunderstand the role of timezones.

as.POSIXct(Sys.Date())

is in UTC, as documented.

as.POSIXlt(Sys.Date())

does not have a timezone (POSIXlt objects do not need one).

as.POSIXct(as.POSIXlt(Sys.Date()))

means

as.POSIXct(as.POSIXlt(Sys.Date()), tz="")

which is asking to interpret this in the local timezone.

I've expanded the documentation, but I see no sign you had studied it so 
that it unlikely to help you.

On Fri, 1 Sep 2006, erich.neuwirth at univie.ac.at wrote:

> Full_Name: Erich Neuwirth
> Version: 2.3.1
> OS: Windows XP, Linux
> Submission from: (NULL) (131.130.135.167)
> 
> 
> Converting Sys.Date() to a POSIX compliant time type in different ways 
> produces inconsistent results:
> > Sys.date()
> [1] "2006-09-01"
> > as.POSIXct(Sys.Date())
> [1] "2006-09-01 02:00:00 CEST"
> > as.POSIXlt(Sys.Date())
> [1] "2006-09-01"
> > as.POSIXct(as.POSIXlt(Sys.Date()))
> [1] "2006-09-01 01:00:00 CEST"
> 
> Applying as.POSIXct directly or first applying as.POSIXlt and then
> applying as.POSIXct produces different results.
> 
> This happens on Linux with timezone "CEST"
> > Sys.time()
> [1] "2006-09-01 11:03:36 CEST"
> and on Windows with timezone "W. Europe Daylight Time"
> > Sys.time()
> [1] "2006-09-01 11:11:15 W. Europe Daylight Time"
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From ggrothendieck at gmail.com  Fri Sep  1 12:25:36 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 1 Sep 2006 06:25:36 -0400
Subject: [Rd] Date conversion with as.POSIXct and as.POSIXlt (PR#9196)
In-Reply-To: <20060901092716.784165866B@slim.kubism.ku.dk>
References: <20060901092716.784165866B@slim.kubism.ku.dk>
Message-ID: <971536df0609010325v45e18cd9ub7194b98f4965d52@mail.gmail.com>

Note that there is some discussion in the help desk article
in R News 4/1 and a table of tested conversions at
the end of that article.    If x is of class "Date" then for
converting from Date to POSIXct the table suggests
as.POSIXct(format(x)) or as.POSIXct(format(x), tz = "GMT")
according to whether you want the current time zone or GMT.

On 9/1/06, erich.neuwirth at univie.ac.at <erich.neuwirth at univie.ac.at> wrote:
> Full_Name: Erich Neuwirth
> Version: 2.3.1
> OS: Windows XP, Linux
> Submission from: (NULL) (131.130.135.167)
>
>
> Converting Sys.Date() to a POSIX compliant time type in different ways
> produces inconsistent results:
> > Sys.date()
> [1] "2006-09-01"
> > as.POSIXct(Sys.Date())
> [1] "2006-09-01 02:00:00 CEST"
> > as.POSIXlt(Sys.Date())
> [1] "2006-09-01"
> > as.POSIXct(as.POSIXlt(Sys.Date()))
> [1] "2006-09-01 01:00:00 CEST"
>
> Applying as.POSIXct directly or first applying as.POSIXlt and then
> applying as.POSIXct produces different results.
>
> This happens on Linux with timezone "CEST"
> > Sys.time()
> [1] "2006-09-01 11:03:36 CEST"
> and on Windows with timezone "W. Europe Daylight Time"
> > Sys.time()
> [1] "2006-09-01 11:11:15 W. Europe Daylight Time"
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



From ripley at stats.ox.ac.uk  Fri Sep  1 12:43:54 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 1 Sep 2006 11:43:54 +0100 (BST)
Subject: [Rd] Date conversion with as.POSIXct and as.POSIXlt (PR#9196)
In-Reply-To: <x264g7zyop.fsf@viggo.kubism.ku.dk>
References: <20060901092716.784165866B@slim.kubism.ku.dk>
	<x264g7zyop.fsf@viggo.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0609011137060.11470@gannet.stats.ox.ac.uk>

On Fri, 1 Sep 2006, Peter Dalgaard wrote:

[...]

> I'm not sure any of this is actual bugs (Brian will tell us soon
> enough), but it does appear at least to be underdocumented.

(Your message crossed mine.)

I think it is not a bug and actually explicitly documented in ?as.POSIXlt.  
What may help those who have not read that documentation is to stick the 
UTC timezone on the conversion to POSIXlt.  Getting

> as.POSIXlt(Sys.Date())
[1] "2006-09-01 UTC"
> as.POSIXct(as.POSIXlt(Sys.Date()))
[1] "2006-09-01 UTC"
> as.POSIXct(as.POSIXlt(Sys.Date()), tz="")
[1] "2006-09-01 01:00:00 GMT Daylight Time"

might be helpful to non-readers.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From r.hankin at noc.soton.ac.uk  Fri Sep  1 12:51:43 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Fri, 1 Sep 2006 11:51:43 +0100
Subject: [Rd] as.environment(NULL)
Message-ID: <2C801228-5D95-48D2-B328-7E4D70DAB842@soc.soton.ac.uk>

Hi

In NEWS, it says

	R CMD check now tests that the package can be loaded, and that
	the package and namespace (if there is one) can each be loaded
	in startup code (before the standard packages are loaded).


For package "onion",  I think I have followed all of
sections 1.6.1 - 1.6.6 of R-exts, and it passes  R CMD check for  
R-2.3.1.


However, using  R version 2.4.0 Under development (unstable)  
(2006-08-31 r39045)
under MacOSX 10.4.7, I get  this:


* checking R files for non-ASCII characters ... OK
* checking whether the package can be loaded ... ERROR
Error in get("Re", pos = NULL, mode = "function") :
         using 'as.environment(NULL)' is defunct
Error: unable to load R code in package 'onion'
Error: package/namespace load failed for 'onion'
Execution halted

It looks like this package has a loading problem: see the messages for
details.





in 00check.log.

I don't understand what I have to do to fix this.
In my NAMESPACE file there are lots of lines like this:


S3method("Re", quaternion)
S3method("Im", quaternion)
S3method("i", quaternion)
S3method("j", quaternion)
S3method("k", quaternion)


what do I have to do to make onion work under R-devel?



--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743



From Roger.Bivand at nhh.no  Fri Sep  1 13:30:32 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 1 Sep 2006 13:30:32 +0200 (CEST)
Subject: [Rd] S4 changes - sp fails
In-Reply-To: <Pine.LNX.4.44.0609011053390.5844-100000@reclus.nhh.no>
Message-ID: <Pine.LNX.4.44.0609011321510.5974-100000@reclus.nhh.no>

On Fri, 1 Sep 2006, Roger Bivand wrote:

> On Fri, 1 Sep 2006, Prof Brian Ripley wrote:
> 
> > Since writing that, I have found that there is a similar problem with 
> > testing mvoutliers (which does load sp), and it depends on exactly what 
> > has been done in what order.  (I'll forward to you the exact description.)

On a different RHEL 4 i386 with R version 2.4.0 (2006-09-01 r39049), and 
fully updated sp CVS from 

cvs -z3 -d:pserver:anonymous at r-spatial.cvs.sourceforge.net:/cvsroot/r-spatial checkout sp

CND check sp passes with no error (with RColorBrewer the only installed 
package in a test library).

I'll try again on the first machine (which is also RHEL 4 i386, but where 
R was at 2006-08-31 r39045, and where there may have been configuration 
issues (wrong library path?).

Roger

> 
> Thanks.
> 
> I reran the interactive test:
> 
> library(sp, lib.loc="sp.Rcheck")
> example("DMS-class")
> 
> which ran without problems.
> 
> > .libPaths()
> [1] "/home/rsb/topics/r_libs"                
> [2] "/home/rsb/topics/Rtobe240/lib/R/library"
> > list.files(.libPaths()[1])
> [1] "abind"        "maptools"     "pixmap"       "RColorBrewer" "R.css"       
> [6] "rgdal"        "SparseM"      "spdep"        "tripack"
> > sessionInfo()
> R version 2.4.0 Under development (unstable) (2006-08-31 r39045) 
> i686-pc-linux-gnu 
> 
> locale:
> LC_CTYPE=en_GB;LC_NUMERIC=C;LC_TIME=en_GB;LC_COLLATE=en_GB;LC_MONETARY=en_GB;LC_
> MESSAGES=en_GB;LC_PAPER=en_GB;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREME
> NT=en_GB;LC_IDENTIFICATION=C
> 
> attached base packages:
> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets" 
> [7] "base"     
> 
> other attached packages:
>       sp 
> "0.8-19" 
> 
> > 
> > I now suspect there is a protection problem in the new S4 dispatch code.
> > Using gctorture/valgrind may help locate it.
> 
> Running check --use-gct sp now.
> 
> Roger
> 
> > 
> > Brian
> > 
> > On Fri, 1 Sep 2006, Roger Bivand wrote:
> > 
> > > On Fri, 1 Sep 2006, Prof Brian Ripley wrote:
> > > 
> > > > Roger,
> > > > 
> > > > I had managed to run R CMD check on sp successfully on r39021 and r39043 
> > > > (current) in my nightly checks.  (There are a couple of tests where the 
> > > > show/print method is not being invoked, but that is not new.)
> > > > 
> > > > All I can suggest is to install R from scratch (make distclean), and then 
> > > > reinstall all relevant packages.  At a guess, your interactive use and R 
> > > > CMD check are picking up different libraries.
> > > 
> > > Brian,
> > > 
> > > I added .libPaths() and sessionInfo() to the offending example, and tried
> > > with a fresh svn checkout built in a fresh directory and installed in a
> > > fresh directory (no sp or methods in /home/rsb/topics/r_libs, which was
> > > set with export R_LIBS=):
> > > 
> > > > data(state)
> > > > .libPaths()
> > > [1] "/home/rsb/topics/packages/sp-bundle/sp.Rcheck"
> > > [2] "/home/rsb/topics/r_libs"                      
> > > [3] "/home/rsb/topics/Rtobe240/lib/R/library"      
> > > > sessionInfo()
> > > R version 2.4.0 Under development (unstable) (2006-08-31 r39045) 
> > > i686-pc-linux-gnu 
> > > 
> > > locale:
> > > LC_CTYPE=en_GB;LC_NUMERIC=C;LC_TIME=en_GB;LC_COLLATE=en_GB;LC_MONETARY=en_GB;LC_
> > > MESSAGES=en_GB;LC_PAPER=en_GB;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREME
> > > NT=en_GB;LC_IDENTIFICATION=C
> > > 
> > > attached base packages:
> > > [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets" 
> > > [7] "base"     
> > > 
> > > other attached packages:
> > >       sp 
> > > "0.8-19" 
> > > > dd2dms(state.center$x)
> > > Error in function (classes, fdef, mtable)  : 
> > >         unable to find an inherited method for function "initialize", for 
> > > signature "integer"
> > > Execution halted
> > > 
> > > I also tried to replicate the problem by making a new, very small, package 
> > > with just the apparently offending files:
> > > 
> > > spS4:
> > > DESCRIPTION  man/  NAMESPACE  R/
> > > 
> > > spS4/man:
> > > char2dms.Rd  DMS-class.Rd
> > > 
> > > spS4/R:
> > > AAA.R  dms.R
> > > 
> > > and edited DESCRIPTION, NAMESPACE, and AAA.R to suit. In this setting 
> > > there was no problem. I'll carry on looking. None of these files has 
> > > changed between released 0.8-18 and CVS 0.8-19. 
> > > 
> > > Roger
> > > 
> > > > 
> > > > There are around a dozen S4-using packages on CRAN that are currently 
> > > > failing their checks: some look like newly-discovered bugs but some look 
> > > > like problems in S4 dispatch (even of S3 dispatch for S3 generics turned 
> > > > into S4 generics).  More are producing apparently incorrect warnings.
> > > > 
> > > > Brian
> > > > 
> > > > 
> > > > On Thu, 31 Aug 2006, Roger Bivand wrote:
> > > > 
> > > > > Under R version 2.4.0 (2006-08-30 r39024), sp fails CMD check following
> > > > > the latest changes in methods.
> > > > > 
> > > > > The failures are in running examples and occur in CMD check:
> > > > > 
> > > > > > data(state)
> > > > > > dd2dms(state.center$x)
> > > > > Error in function (classes, fdef, mtable)  : 
> > > > >         unable to find an inherited method for function "initialize", for 
> > > > > signature "integer"
> > > > > 
> > > > > Offending code:
> > > > > 
> > > > > 	deg <- as(floor(dd), "integer") 
> > > > > 
> > > > > After replacing by as.integer(floor(dd)), it fails on the local class 
> > > > > definition:
> > > > > 
> > > > > > dd2dms(state.center$x)
> > > > > Error in function (classes, fdef, mtable)  : 
> > > > >         unable to find an inherited method for function "initialize", for 
> > > > > signature "DMS"
> > > > > 
> > > > > Installing sp, example("DMS-class") runs successfully interactively 
> > > > > (other examples do too).
> > > > > 
> > > > > The methods package is declared as Depends: in DESCRIPTION, and
> > > > > import(methods) in NAMESPACE; 
> > > > > 
> > > > > .onLoad <- function(lib, pkg) require(methods) is in the first R source 
> > > > > file in Collate: order.
> > > > > 
> > > > > Should the methods package be being invoked in some other way, is there a 
> > > > > reason why the installed package appears to run examples successfully that 
> > > > > fail under CMD check?
> > > > > 
> > > > > Roger
> > > > > 
> > > > > 
> > > > 
> > > > 
> > > 
> > > 
> > 
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From ripley at stats.ox.ac.uk  Fri Sep  1 13:56:51 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 1 Sep 2006 12:56:51 +0100 (BST)
Subject: [Rd] as.environment(NULL)
In-Reply-To: <2C801228-5D95-48D2-B328-7E4D70DAB842@soc.soton.ac.uk>
References: <2C801228-5D95-48D2-B328-7E4D70DAB842@soc.soton.ac.uk>
Message-ID: <Pine.LNX.4.64.0609011253380.11719@gannet.stats.ox.ac.uk>

Your code contains

onion.R:"Re.default" <- get("Re",pos=NULL,mode="function")
onion.R:"Im.default" <- get("Im",pos=NULL,mode="function")

and has been giving deprecated warnings for a while (and ?get does not say 
NULL is allowable).  The relevant NEWS item is

    o	Use of NULL as an environment is now an error.


You need pos="package:base" there.


On Fri, 1 Sep 2006, Robin Hankin wrote:

> Hi
> 
> In NEWS, it says
> 
> 	R CMD check now tests that the package can be loaded, and that
> 	the package and namespace (if there is one) can each be loaded
> 	in startup code (before the standard packages are loaded).
> 
> 
> For package "onion",  I think I have followed all of
> sections 1.6.1 - 1.6.6 of R-exts, and it passes  R CMD check for  
> R-2.3.1.
> 
> 
> However, using  R version 2.4.0 Under development (unstable)  
> (2006-08-31 r39045)
> under MacOSX 10.4.7, I get  this:
> 
> 
> * checking R files for non-ASCII characters ... OK
> * checking whether the package can be loaded ... ERROR
> Error in get("Re", pos = NULL, mode = "function") :
>          using 'as.environment(NULL)' is defunct
> Error: unable to load R code in package 'onion'
> Error: package/namespace load failed for 'onion'
> Execution halted
> 
> It looks like this package has a loading problem: see the messages for
> details.
> 
> 
> 
> 
> 
> in 00check.log.
> 
> I don't understand what I have to do to fix this.
> In my NAMESPACE file there are lots of lines like this:
> 
> 
> S3method("Re", quaternion)
> S3method("Im", quaternion)
> S3method("i", quaternion)
> S3method("j", quaternion)
> S3method("k", quaternion)
> 
> 
> what do I have to do to make onion work under R-devel?
> 
> 
> 
> --
> Robin Hankin
> Uncertainty Analyst
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>   tel  023-8059-7743
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From gregor.gorjanc at bfro.uni-lj.si  Fri Sep  1 13:58:39 2006
From: gregor.gorjanc at bfro.uni-lj.si (gregor.gorjanc at bfro.uni-lj.si)
Date: Fri,  1 Sep 2006 13:58:39 +0200 (CEST)
Subject: [Rd] [<-.POSIXlt changes order of attributes (PR#9197)
Message-ID: <20060901115839.3758019A05@slim.kubism.ku.dk>

This is a multi-part message in MIME format.
--------------090203020600020104020707
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 7bit

Hello!

I was doing some tests with identical() and found out that [<-.POSIXlt
method changes order of attributes. This example shows that:

x <- strptime("1900-1-1", format="%Y-%m-%d")
x <- c(x)
y <- c(x, x+1)
x1 <- x
y1 <- y

attributes(x)
$names
[1] "sec"   "min"   "hour"  "mday"  "mon"   "year"  "wday"  "yday"  "isdst"

$class
[1] "POSIXt"  "POSIXlt"

$tzone
[1] ""     "CET"  "CEST"

identical(attributes(x), attributes(y))
TRUE

x[1] <- NA
attributes(x)
$names
[1] "sec"   "min"   "hour"  "mday"  "mon"   "year"  "wday"  "yday"  "isdst"

$tzone
[1] ""     "CET"  "CEST"

$class
[1] "POSIXt"  "POSIXlt"

y[1] <- NA
attributes(y)
$names
[1] "sec"   "min"   "hour"  "mday"  "mon"   "year"  "wday"  "yday"  "isdst"

$tzone
[1] ""     "CET"  "CEST"

$class
[1] "POSIXt"  "POSIXlt"

identical(attributes(x), attributes(x1))
FALSE

identical(attributes(y), attributes(y1))
FALSE

This can be solved with either:

Index: R/src/library/base/R/datetime.R
===================================================================
--- R/src/library/base/R/datetime.R     (revision 39045)
+++ R/src/library/base/R/datetime.R     (working copy)
@@ -713,10 +713,10 @@
 {
     if(!as.logical(length(value))) return(x)
     value <- as.POSIXlt(value)
-    cl <- oldClass(x)
+    att <- attributes(x)
     class(x) <- class(value) <- NULL
     for(n in names(x)) x[[n]][i] <- value[[n]]
-    class(x) <- cl
+    attributes(x) <- att
     x
 }

or in the same way as it is done in [.<-POSIXct method

Index: R/src/library/base/R/datetime.R
===================================================================
--- R/src/library/base/R/datetime.R     (revision 39045)
+++ R/src/library/base/R/datetime.R     (working copy)
@@ -714,9 +714,11 @@
     if(!as.logical(length(value))) return(x)
     value <- as.POSIXlt(value)
     cl <- oldClass(x)
+    tz <- attr(x, "tzone")
     class(x) <- class(value) <- NULL
     for(n in names(x)) x[[n]][i] <- value[[n]]
     class(x) <- cl
+    attr(x, "tzone") <- tz
     x
 }

I have checked both versions in r-devel with make check-all and all went
fine.

Regards, Gregor


-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.
----------------------------------------------------------------------

--------------090203020600020104020707
Content-Type: application/x-gzip;
 name="datetime.R.patchVer1.gz"
Content-Transfer-Encoding: base64
Content-Disposition: inline;
 filename="datetime.R.patchVer1.gz"

H4sICH7v90QCA2RhdGV0aW1lLlIucGF0Y2hWZXIxAKVOz0vDMBQ+m7/ieUvosmxMGYpCwdNg
qFSEQekhTbMazBJJ0tkh/u+atE5vO/guyft+vW9lGtlfQ8G8E0yr2nF3YDX3khWs4UEGtZPT
At3+fxCl9NSdM+zkXnllDSyuZheXBGVZdtr0bt2rMi0I+3YgKM+BLueLyXwG2fjmOYIPBHHU
Fp9zP9W2VYJrrKVpwwvec91JQgg4GTpncE8GdcLhhsK35fHhabXRYdQiGnmhI2l1c6e599GW
RZiHkEwhOFV3QfpjoBh1kR7+Q1zc75/X60G1tQ4bUAYM3yUzgb4sTVWVqorK5EnAT42/qccO
v8fHNkN6j+ATAfoCTtG/r/sBAAA=
--------------090203020600020104020707
Content-Type: application/x-gzip;
 name="datetime.R.patchVer2.gz"
Content-Transfer-Encoding: base64
Content-Disposition: inline;
 filename="datetime.R.patchVer2.gz"

H4sICCXw90QCA2RhdGV0aW1lLlIucGF0Y2hWZXIyAKWOwUoDMRCGz+Ypxp4S0jQuVqSisOCp
UFRWBGHZQ7qbrsE0kSSt6YLvrtmIBxF6cC5J/vm+mSxNJ+MVVNy7lmu1dsId+Fp4ySveiSCD
2spZhW7+X4gxdmzPCXZyr7yyBs4XZ/MLgiilx6V3616V6aG1bweCyhLYZTGfLoCmoyigLBGk
Uht8KvxM2161QmMtTR9e8F7onSSEgJNh5wyOJNNjDtcMvpSH+8flsw7fbO63OjWt7m618D5p
NMVhGJ0QHI5TmITBGjn5UTKZiHzPA9P77mm1ytTGOmxAGTBiKxNOINa1aZpaNYkcnTH4a2r+
xe/9qReGzEcEHwjQJ/Ktnoj7AQAA
--------------090203020600020104020707--



From p.dalgaard at biostat.ku.dk  Fri Sep  1 14:40:01 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 01 Sep 2006 14:40:01 +0200
Subject: [Rd] Date conversion with as.POSIXct and as.POSIXlt (PR#9196)
In-Reply-To: <Pine.LNX.4.64.0609011137060.11470@gannet.stats.ox.ac.uk>
References: <20060901092716.784165866B@slim.kubism.ku.dk>
	<x264g7zyop.fsf@viggo.kubism.ku.dk>
	<Pine.LNX.4.64.0609011137060.11470@gannet.stats.ox.ac.uk>
Message-ID: <x21wqvzroe.fsf@viggo.kubism.ku.dk>

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> On Fri, 1 Sep 2006, Peter Dalgaard wrote:
> 
> [...]
> 
> > I'm not sure any of this is actual bugs (Brian will tell us soon
> > enough), but it does appear at least to be underdocumented.
> 
> (Your message crossed mine.)
> 
> I think it is not a bug and actually explicitly documented in ?as.POSIXlt.  
> What may help those who have not read that documentation is to stick the 
> UTC timezone on the conversion to POSIXlt.  Getting


Hmmm, which part of ?as.POSIXlt didn't I understand? I can't seem to
spot anything pointing to -lt being different from -ct conversion (in
a week-old version of r-devel). What I do see is:


    The 'as.POSIX*' functions convert an object to one of the two
     classes used to represent date/times (calendar dates plus time to
     the nearest second).  They can convert a wide variety of objects,
     including objects of the other class and of classes '"Date"',
     '"date"' (from package 'date' or 'survival'), '"chron"' and
     '"dates"' (from package 'chron') to these classes.  Dates are
     treated as being at midnight UTC.

The last sentence would appear not to be true for as.POSIXlt; dates
are treated as midnight in the _current_ timezone ignoring DST (which
of course is undetectable in Oxford because that _is_ UTC in your
timezone) .

> > as.POSIXlt(Sys.Date())
> [1] "2006-09-01 UTC"
> > as.POSIXct(as.POSIXlt(Sys.Date()))
> [1] "2006-09-01 UTC"
> > as.POSIXct(as.POSIXlt(Sys.Date()), tz="")
> [1] "2006-09-01 01:00:00 GMT Daylight Time"
> 
> might be helpful to non-readers.

I have

> as.POSIXct(as.POSIXlt(Sys.Date()), tz="")
[1] "2006-09-01 01:00:00 CEST"

and of course the whole issue is that 

> dput(as.POSIXlt(Sys.Date(), tz="UTC"))
structure(list(sec = 0, min = 0, hour = 0, mday = 1, mon = 8,
    year = 106, wday = 5, yday = 243, isdst = 0), .Names = c("sec",
"min", "hour", "mday", "mon", "year", "wday", "yday", "isdst"
), class = c("POSIXt", "POSIXlt"))
> dput(as.POSIXlt(Sys.Date()))
structure(list(sec = 0, min = 0, hour = 0, mday = 1, mon = 8,
    year = 106, wday = 5, yday = 243, isdst = 0), .Names = c("sec",
"min", "hour", "mday", "mon", "year", "wday", "yday", "isdst"
), class = c("POSIXt", "POSIXlt"))

are exactly the same -- the tz arg is ignored.

The documentation in ?POSIXlt does have some hints about POSIXlt being
converted to current locale, but I still find the whole thing a bit
unclear.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From ripley at stats.ox.ac.uk  Fri Sep  1 15:16:27 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 1 Sep 2006 14:16:27 +0100 (BST)
Subject: [Rd] Date conversion with as.POSIXct and as.POSIXlt (PR#9196)
In-Reply-To: <x21wqvzroe.fsf@viggo.kubism.ku.dk>
References: <20060901092716.784165866B@slim.kubism.ku.dk>
	<x264g7zyop.fsf@viggo.kubism.ku.dk>
	<Pine.LNX.4.64.0609011137060.11470@gannet.stats.ox.ac.uk>
	<x21wqvzroe.fsf@viggo.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0609011341000.11719@gannet.stats.ox.ac.uk>

On Fri, 1 Sep 2006, Peter Dalgaard wrote:

> Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
> 
> > On Fri, 1 Sep 2006, Peter Dalgaard wrote:
> > 
> > [...]
> > 
> > > I'm not sure any of this is actual bugs (Brian will tell us soon
> > > enough), but it does appear at least to be underdocumented.
> > 
> > (Your message crossed mine.)
> > 
> > I think it is not a bug and actually explicitly documented in ?as.POSIXlt.  
> > What may help those who have not read that documentation is to stick the 
> > UTC timezone on the conversion to POSIXlt.  Getting
> 
> Hmmm, which part of ?as.POSIXlt didn't I understand? I can't seem to
> spot anything pointing to -lt being different from -ct conversion (in
> a week-old version of r-devel). What I do see is:
> 
>     The 'as.POSIX*' functions convert an object to one of the two
>      classes used to represent date/times (calendar dates plus time to
>      the nearest second).  They can convert a wide variety of objects,
>      including objects of the other class and of classes '"Date"',
>      '"date"' (from package 'date' or 'survival'), '"chron"' and
>      '"dates"' (from package 'chron') to these classes.  Dates are
>      treated as being at midnight UTC.
> 
> The last sentence would appear not to be true for as.POSIXlt; dates
> are treated as midnight in the _current_ timezone ignoring DST (which
> of course is undetectable in Oxford because that _is_ UTC in your
> timezone) .

As it tells you it was treated as being in UTC, you need to tell 
subsequent conversions that it is a time in UTC, e.g.

   as.POSIXct(as.POSIXlt(Sys.Date()), tz="UTC")

It is as.POSIXct() that is doing 'dates are treated as midnight in the 
_current_ timezone ignoring DST', and that is what the documentation of 
argument 'tz' says will happen.  (Since UTC has no DST, it has specified 
that DST is not in effect, as that is part of a POSIXlt object.)

In your version of R, as.POSIXlt(Sys.Date()) did not specify a timezone 
(they are optional).  Now it does.

> The documentation in ?POSIXlt does have some hints about POSIXlt being
> converted to current locale, but I still find the whole thing a bit
> unclear.

Which is why I have (I hope) clarified it so tz="UTC" is not needed 
explicitly anymore.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From jmc at r-project.org  Fri Sep  1 15:33:12 2006
From: jmc at r-project.org (John Chambers)
Date: Fri, 01 Sep 2006 09:33:12 -0400
Subject: [Rd] S4 changes - sp fails
In-Reply-To: <Pine.LNX.4.44.0609011321510.5974-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0609011321510.5974-100000@reclus.nhh.no>
Message-ID: <44F83698.50205@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060901/5fb476be/attachment-0003.pl 

From edd at debian.org  Fri Sep  1 15:54:17 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 1 Sep 2006 08:54:17 -0500
Subject: [Rd] Date conversion with as.POSIXct and as.POSIXlt (PR#9196)
In-Reply-To: <971536df0609010325v45e18cd9ub7194b98f4965d52@mail.gmail.com>
References: <20060901092716.784165866B@slim.kubism.ku.dk>
	<971536df0609010325v45e18cd9ub7194b98f4965d52@mail.gmail.com>
Message-ID: <17656.15241.6490.945036@basebud.nulle.part>


On 1 September 2006 at 06:25, Gabor Grothendieck wrote:
| Note that there is some discussion in the help desk article
| in R News 4/1 and a table of tested conversions at
| the end of that article.    If x is of class "Date" then for
| converting from Date to POSIXct the table suggests
| as.POSIXct(format(x)) or as.POSIXct(format(x), tz = "GMT")
| according to whether you want the current time zone or GMT.

Could we get something like this table into the on-line documentation?
Incidentally, just yesterday I was just mud-wrestling the same DST and TZ
issue ...

Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison



From r.hankin at noc.soton.ac.uk  Fri Sep  1 15:58:29 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Fri, 1 Sep 2006 14:58:29 +0100
Subject: [Rd] setMethod("Logic", ...)
Message-ID: <91AD8AFC-E5A3-4F79-821D-CACC2705333D@soc.soton.ac.uk>

Hi


In V&R the "polynomial" class is explicitly specified to have no  
logical operators:

setMethod("Logic", signature(e1="polynomial"), function(e1,e2){stop 
("...")})


  I too have a class of objects for which I want to
specify that Logic operators do not work, but executing



setClass("brob",
          representation = representation 
(x="numeric",positive="logical"),
          prototype      = list(x=numeric(),positive=logical())
          )

setMethod("Logic",signature(e1="brob"), function(e1,e2)
           {
             stop("No logic currently implemented for brob objects")
           }
)


gives me


Error in setMethod("Logic", signature(e1 = "brob"), function(e1, e2) { :
	no existing definition for function 'Logic'


?Math seems to imply that there is no "Logic" group.

So, what is the correct way to specify that logical operations are
not allowed  for "brob" objects?





--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743



From goedman at mac.com  Fri Sep  1 16:39:32 2006
From: goedman at mac.com (Rob J Goedman)
Date: Fri, 1 Sep 2006 07:39:32 -0700
Subject: [Rd] R crashes in Mac OS 10.4 when Find is used (PR#9192)
In-Reply-To: <20060831144227.755F64C9A1@slim.kubism.ku.dk>
References: <20060831144227.755F64C9A1@slim.kubism.ku.dk>
Message-ID: <03986B2A-CC2C-4C35-A986-722985EA9DC2@mac.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060901/9a407b5e/attachment-0003.pl 

From nakama at ki.rim.or.jp  Fri Sep  1 16:47:26 2006
From: nakama at ki.rim.or.jp (Ei-ji Nakama)
Date: Fri, 1 Sep 2006 23:47:26 +0900
Subject: [Rd] Thai locale not working on Mac OSX (PR#9175)
In-Reply-To: <20060827031605.DAC9E4C9C4@slim.kubism.ku.dk>
References: <20060827031605.DAC9E4C9C4@slim.kubism.ku.dk>
Message-ID: <dc41e1260609010747i2fea96d2vf7c9740231536cf3@mail.gmail.com>

th_TH does not exist at locale of OSX.

I should be able to handle Thai character string in UTF-8
locale such as en_US.UTF-8.

There is also a method of preparing th_TH local with localedef.

2006/8/27, hutcha.s at psu.ac.th <hutcha.s at psu.ac.th>:
> Full_Name: Hutcha Sriplung
> Version: R-2.3.1
> OS: Mac OSX
> Submission from: (NULL) (61.90.155.1)
>
>
> I am using Mac OSX 10.4.7 and find that locale setting is not working properly.
>
>
> > Sys.getlocale()
> [1] "C"
> > Sys.setlocale(category="LC_ALL",locale="th_TH")
> [1] "C"
>
> When I change locale to some other languages such as french, chinese, and
> japanese, it works fine but not with some other languages such as Bahasa
> Indonesia and Bahasa Malaysia. Thai locale is OK on Windows and Linux.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>


-- 
EI-JI Nakama  <nakama at ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb"  <nakama at ki.rim.or.jp>



From gcbooma at yahoo.com  Fri Sep  1 16:54:22 2006
From: gcbooma at yahoo.com (gcbooma)
Date: Fri, 1 Sep 2006 07:54:22 -0700 (PDT)
Subject: [Rd] read.ssd (foreign) 'wishes': enable long variable names,
	add output object to windows example
Message-ID: <20060901145422.71071.qmail@web38913.mail.mud.yahoo.com>

Hello,

A couple of quick 'wishes' for read.ssd in the foreign package:

1) Enable long variable names by adding 'options validvarname=v6;' line
directly before doing 'proc copy', e.g. (from my own alteration of
read.ssd):
    #export the data
    st7 <- "options validvarname=v6;\n"
    st8 <- paste("proc copy in=src2rd out=rd;\n")
    st9 <- paste("select", "tempfile", ";\n", sep = " ")
...and corresponding 'cat' to 'tmpProg', of course.

2) Add output object to windows example in the help file. In v0.8-15
help file for 'foreign', no object is indicated, causing R to kill the
output if run as-is - potentially confusing for newbies.

Thank you for this useful function!

-Greg



From jeff.horner at vanderbilt.edu  Fri Sep  1 17:03:21 2006
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Fri, 01 Sep 2006 10:03:21 -0500
Subject: [Rd] Overriding InitTempDir
In-Reply-To: <44F75DA4.6000209@vanderbilt.edu>
References: <44F75DA4.6000209@vanderbilt.edu>
Message-ID: <44F84BB9.5050107@vanderbilt.edu>

Jeffrey Horner wrote:
> For embedded projects, one may want to eliminate the per-session temp 
> directory created by InitTempDir() and just use a system-specific temp 
> directory. Here's my solution:
> 
> extern char *R_TempDir;
> 
> void my_InitTempDir()
> {
>      char *tmp;
> 
>      if (R_TempDir){
>          if (rmdir(R_TempDir) != 0){
>              perror("Fatal Error: could not remove R's TempDir!");
>              exit(1);
>          }
>      }
> 
>      tmp = getenv("TMPDIR");
>      if (tmp == NULL) {
>          tmp = getenv("TMP");
>              if (tmp == NULL) {
>                  tmp = getenv("TEMP");
>                  if (tmp == NULL)
>                      tmp = "/tmp";
>              }
>      }
> 
>      R_TempDir=tmp;
> 
>      if (setenv("R_SESSION_TMPDIR",tmp,1) != 0){
>          perror("Fatal Error: couldn't set/replace R_SESSION_TMPDIR!");
>          exit(1);
>      }
> }
> 
> This function is called after Rf_initEmbeddedR; it's seems like a hack 
> but it works. Does anyone have other solutions?

I just found a fault with the above solution, but only if a program that 
embeds R calls the R edit function; highly unlikely. Nevertheless, It 
turns out that soon after InitTempDir is called, InitEd is called and 
sets the variable DefaultFileName (which is hidden by storage class 
static, unlike R_TempDir) to a temporary filename located in the 
directory which was just deleted by my_initTempDir.

> Maybe InitTempDir could check if R_TempDir was not NULL and then just 
> return.

So it would be nice if the above (InitTempDir only creating a directory 
when R_TempDir is NULL) could be added to R-trunk.

Note also that in the case that R_TempDir is set to a system-specific 
temp directory, the program would then have to set it back to NULL as 
the new function Rf_endEmbeddedR now tests to see if R_TempDir has been set:

/* use fatal !=0 for emergency bail out */
void Rf_endEmbeddedR(int fatal)
{
     unsigned char buf[1024];
     char * tmpdir;

     R_RunExitFinalizers();
     CleanEd();
     if(!fatal) KillAllDevices();
     if((tmpdir = R_TempDir)) {
     snprintf((char *)buf, 1024, "rm -rf %s", tmpdir);
     R_system((char *)buf);
     }
     if(!fatal && R_CollectWarnings)
     PrintWarnings();    /* from device close and .Last */
     fpu_setup(FALSE);
}

Jeff
-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner



From ripley at stats.ox.ac.uk  Fri Sep  1 17:18:50 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 1 Sep 2006 16:18:50 +0100 (BST)
Subject: [Rd] [<-.POSIXlt changes order of attributes (PR#9197)
In-Reply-To: <20060901115839.3758019A05@slim.kubism.ku.dk>
References: <20060901115839.3758019A05@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0609011416490.11719@gannet.stats.ox.ac.uk>

Please point us to the documentation that says attributes are ordered.
E.g. R-lang.texi says

  All objects except @code{NULL} can have one or more attributes attached
  to them.  Attributes are stored as a list where all elements are named.

(although in fact they are stored in a pairlist).

I know of tens of functions that change the order of attributes, and 
did look at teaching identical() that they are not ordered.  But 
since they are stored as a pairlist, it would be quite expensive.
(Given that attributes seem to be growing in use, another internal storage 
mechanism is becoming more appropriate.)

BTW, all.equal() does not assume attributes are ordered.


On Fri, 1 Sep 2006, gregor.gorjanc at bfro.uni-lj.si wrote:

> This is a multi-part message in MIME format.
> --------------090203020600020104020707
> Content-Type: text/plain; charset=UTF-8
> Content-Transfer-Encoding: 7bit
> 
> Hello!
> 
> I was doing some tests with identical() and found out that [<-.POSIXlt
> method changes order of attributes. This example shows that:
> 
> x <- strptime("1900-1-1", format="%Y-%m-%d")
> x <- c(x)
> y <- c(x, x+1)
> x1 <- x
> y1 <- y
> 
> attributes(x)
> $names
> [1] "sec"   "min"   "hour"  "mday"  "mon"   "year"  "wday"  "yday"  "isdst"
> 
> $class
> [1] "POSIXt"  "POSIXlt"
> 
> $tzone
> [1] ""     "CET"  "CEST"
> 
> identical(attributes(x), attributes(y))
> TRUE
> 
> x[1] <- NA
> attributes(x)
> $names
> [1] "sec"   "min"   "hour"  "mday"  "mon"   "year"  "wday"  "yday"  "isdst"
> 
> $tzone
> [1] ""     "CET"  "CEST"
> 
> $class
> [1] "POSIXt"  "POSIXlt"
> 
> y[1] <- NA
> attributes(y)
> $names
> [1] "sec"   "min"   "hour"  "mday"  "mon"   "year"  "wday"  "yday"  "isdst"
> 
> $tzone
> [1] ""     "CET"  "CEST"
> 
> $class
> [1] "POSIXt"  "POSIXlt"
> 
> identical(attributes(x), attributes(x1))
> FALSE
> 
> identical(attributes(y), attributes(y1))
> FALSE
> 
> This can be solved with either:
> 
> Index: R/src/library/base/R/datetime.R
> ===================================================================
> --- R/src/library/base/R/datetime.R     (revision 39045)
> +++ R/src/library/base/R/datetime.R     (working copy)
> @@ -713,10 +713,10 @@
>  {
>      if(!as.logical(length(value))) return(x)
>      value <- as.POSIXlt(value)
> -    cl <- oldClass(x)
> +    att <- attributes(x)
>      class(x) <- class(value) <- NULL
>      for(n in names(x)) x[[n]][i] <- value[[n]]
> -    class(x) <- cl
> +    attributes(x) <- att
>      x
>  }
> 
> or in the same way as it is done in [.<-POSIXct method
> 
> Index: R/src/library/base/R/datetime.R
> ===================================================================
> --- R/src/library/base/R/datetime.R     (revision 39045)
> +++ R/src/library/base/R/datetime.R     (working copy)
> @@ -714,9 +714,11 @@
>      if(!as.logical(length(value))) return(x)
>      value <- as.POSIXlt(value)
>      cl <- oldClass(x)
> +    tz <- attr(x, "tzone")
>      class(x) <- class(value) <- NULL
>      for(n in names(x)) x[[n]][i] <- value[[n]]
>      class(x) <- cl
> +    attr(x, "tzone") <- tz
>      x
>  }
> 
> I have checked both versions in r-devel with make check-all and all went
> fine.
> 
> Regards, Gregor
> 
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From ripley at stats.ox.ac.uk  Fri Sep  1 17:31:35 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 1 Sep 2006 16:31:35 +0100 (BST)
Subject: [Rd] Overriding InitTempDir
In-Reply-To: <44F84BB9.5050107@vanderbilt.edu>
References: <44F75DA4.6000209@vanderbilt.edu> <44F84BB9.5050107@vanderbilt.edu>
Message-ID: <Pine.LNX.4.64.0609011619270.15998@gannet.stats.ox.ac.uk>

It is conventional for people proposing changes to R to set out a 
compelling case as to why they are needed.  I have not seen any case here.
Can we please have one?

Someone will have to think through the ramifications of such a change (and 
BTW using edit() in an R console is not at all unlikely), and continue to 
maintain it for years to come.  I have to say that in the past I have 
accepted quite a few user suggestions that became maintenance nightmares, 
so I have become very wary.

It's not really a good time: R-devel is about to start solidifying towards 
2.4.0, and we have quite a few issues to work through (e.g. the internal 
changes to S4 methods).


On Fri, 1 Sep 2006, Jeffrey Horner wrote:

> Jeffrey Horner wrote:
> > For embedded projects, one may want to eliminate the per-session temp 
> > directory created by InitTempDir() and just use a system-specific temp 
> > directory. Here's my solution:
> > 
> > extern char *R_TempDir;
> > 
> > void my_InitTempDir()
> > {
> >      char *tmp;
> > 
> >      if (R_TempDir){
> >          if (rmdir(R_TempDir) != 0){
> >              perror("Fatal Error: could not remove R's TempDir!");
> >              exit(1);
> >          }
> >      }
> > 
> >      tmp = getenv("TMPDIR");
> >      if (tmp == NULL) {
> >          tmp = getenv("TMP");
> >              if (tmp == NULL) {
> >                  tmp = getenv("TEMP");
> >                  if (tmp == NULL)
> >                      tmp = "/tmp";
> >              }
> >      }
> > 
> >      R_TempDir=tmp;
> > 
> >      if (setenv("R_SESSION_TMPDIR",tmp,1) != 0){
> >          perror("Fatal Error: couldn't set/replace R_SESSION_TMPDIR!");
> >          exit(1);
> >      }
> > }
> > 
> > This function is called after Rf_initEmbeddedR; it's seems like a hack 
> > but it works. Does anyone have other solutions?
> 
> I just found a fault with the above solution, but only if a program that 
> embeds R calls the R edit function; highly unlikely. Nevertheless, It 
> turns out that soon after InitTempDir is called, InitEd is called and 
> sets the variable DefaultFileName (which is hidden by storage class 
> static, unlike R_TempDir) to a temporary filename located in the 
> directory which was just deleted by my_initTempDir.
> 
> > Maybe InitTempDir could check if R_TempDir was not NULL and then just 
> > return.
> 
> So it would be nice if the above (InitTempDir only creating a directory 
> when R_TempDir is NULL) could be added to R-trunk.
> 
> Note also that in the case that R_TempDir is set to a system-specific 
> temp directory, the program would then have to set it back to NULL as 
> the new function Rf_endEmbeddedR now tests to see if R_TempDir has been set:
> 
> /* use fatal !=0 for emergency bail out */
> void Rf_endEmbeddedR(int fatal)
> {
>      unsigned char buf[1024];
>      char * tmpdir;
> 
>      R_RunExitFinalizers();
>      CleanEd();
>      if(!fatal) KillAllDevices();
>      if((tmpdir = R_TempDir)) {
>      snprintf((char *)buf, 1024, "rm -rf %s", tmpdir);
>      R_system((char *)buf);
>      }
>      if(!fatal && R_CollectWarnings)
>      PrintWarnings();    /* from device close and .Last */
>      fpu_setup(FALSE);
> }
> 
> Jeff
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From ripley at stats.ox.ac.uk  Fri Sep  1 17:40:19 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 1 Sep 2006 16:40:19 +0100 (BST)
Subject: [Rd] Interface for package supplied random number generator
In-Reply-To: <20060831135739.GA7336@essek.stat-math.wu-wien.ac.at>
References: <20060831135739.GA7336@essek.stat-math.wu-wien.ac.at>
Message-ID: <Pine.LNX.4.64.0609011636340.16133@gannet.stats.ox.ac.uk>

This really is not a good time for us (and apparently you've know about 
this for a year).  Could you come back to it once 2.4.0 is released (due 
Oct 23)?

[We are busy with getting R-devel ready for 2.4.0, and I think that other 
mechanisms for this have been mooted, again at a time which was not 
opportune.]

On Thu, 31 Aug 2006, Josef Leydold wrote:

> Hi,
> 
> As you probably know, there is a problem with the interface for adding uniform
> random number generators in R (see by article in R News 5/2, November 2005).
> There exists a mechanism called "user-supplied" that allows users of R
> to run their own generator in R. However, there is no such mechanism for
> package writers. Those who want to add their own generators abuse 
> RNGkind(kind="user-supplied") for their purpose.
> The problem with this approach is that it relies on the unique existence of the
> function "user_unif_rand". When two packages are loaded that use this interface,
> then at least one package is broken. If the user herself loads a shared library
> that contains such a function, some of the functionalities of all the 
> corresponding packages are broken.
> 
> When writing my paper I found the following packages on CRAN that abuse this
> interface (meanwhile there might be more packages):
> 
> randaes_0.1.tar.gz
> rlecuyer_0.1.tar.gz
> rsprng_0.3-1.tar.gz
> rstream_1.1.tar.gz
> SuppDists_1.0-13.tar.gz
> 
> what makes the situation even more complicated is the fact that some of these
> packages are loaded automaticall by other packages.
> For example, package 'rlecuyer' is loaded by
> 
> snow_0.2-1.tar.gz
> snowFT_0.0-1.tar.gz
> varSelRF_0.6-2.tar.gz
> 
> To solve this problem, Stefan Theussl and I have tried to extend the mechanism
> for random number generators in the following way:
> 
> - we have added a new kind of generators: "package-supplied"
> 
> - this generator kind needs functions named 'package_unif_rand', 'package_unif_init',
>   'package_unif_nseed', and 'package_unif_seedloc'
>   (analogously to the functions for kind "user-supplied")
> 
> - RNGkind has an additional optional argument:
>     RNGkind <- function(kind = NULL, normal.kind = NULL, PACKAGE = "")
>   argument 'PACKAGE' is only used for the new generator kind "package-supplied"
> 
> - similarly the function set.seed needs the optinal argument 'PACKAGE'
> 
> Since I need such an extended interface (and I assume that other package
> write do also) I ask whether this extension can be included into R.
> We have implemented a first experimental version of this modified interface. 
> A patch against the development snapshot R-devel_2006-08-30.tar.gz is available.
> However, it is a little bit too long (239 lines) to be posted here.
> 
> Of course suggestions for an alternative approach are welcome.
> 
> Josef
> 
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From ripley at stats.ox.ac.uk  Fri Sep  1 17:45:45 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 1 Sep 2006 16:45:45 +0100 (BST)
Subject: [Rd] setMethod("Logic", ...)
In-Reply-To: <91AD8AFC-E5A3-4F79-821D-CACC2705333D@soc.soton.ac.uk>
References: <91AD8AFC-E5A3-4F79-821D-CACC2705333D@soc.soton.ac.uk>
Message-ID: <Pine.LNX.4.64.0609011642240.16133@gannet.stats.ox.ac.uk>

Accordng to the S4groupGeneric page, there is no such group.

My guess as to why:

Those operators are not S3 generic in R, and S4 dispatch is piggy-backed 
on S3 dispatch (not necessarily, but for convenience).


On Fri, 1 Sep 2006, Robin Hankin wrote:

> Hi
> 
> 
> In V&R the "polynomial" class is explicitly specified to have no  
> logical operators:
> 
> setMethod("Logic", signature(e1="polynomial"), function(e1,e2){stop 
> ("...")})
> 
> 
>   I too have a class of objects for which I want to
> specify that Logic operators do not work, but executing
> 
> 
> 
> setClass("brob",
>           representation = representation 
> (x="numeric",positive="logical"),
>           prototype      = list(x=numeric(),positive=logical())
>           )
> 
> setMethod("Logic",signature(e1="brob"), function(e1,e2)
>            {
>              stop("No logic currently implemented for brob objects")
>            }
> )
> 
> 
> gives me
> 
> 
> Error in setMethod("Logic", signature(e1 = "brob"), function(e1, e2) { :
> 	no existing definition for function 'Logic'
> 
> 
> ?Math seems to imply that there is no "Logic" group.
> 
> So, what is the correct way to specify that logical operations are
> not allowed  for "brob" objects?
> 
> 
> 
> 
> 
> --
> Robin Hankin
> Uncertainty Analyst
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>   tel  023-8059-7743
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From ripley at stats.ox.ac.uk  Fri Sep  1 17:46:36 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 1 Sep 2006 16:46:36 +0100 (BST)
Subject: [Rd] Interface for package supplied random number generator
In-Reply-To: <Pine.LNX.4.64.0609011636340.16133@gannet.stats.ox.ac.uk>
References: <20060831135739.GA7336@essek.stat-math.wu-wien.ac.at>
	<Pine.LNX.4.64.0609011636340.16133@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0609011646040.16133@gannet.stats.ox.ac.uk>

On Fri, 1 Sep 2006, Prof Brian Ripley wrote:

> This really is not a good time for us (and apparently you've know about 
> this for a year).  Could you come back to it once 2.4.0 is released (due 
> Oct 23)?

Oops, a backspace failed:  Oct 3.

> 
> [We are busy with getting R-devel ready for 2.4.0, and I think that other 
> mechanisms for this have been mooted, again at a time which was not 
> opportune.]
> 
> On Thu, 31 Aug 2006, Josef Leydold wrote:
> 
> > Hi,
> > 
> > As you probably know, there is a problem with the interface for adding uniform
> > random number generators in R (see by article in R News 5/2, November 2005).
> > There exists a mechanism called "user-supplied" that allows users of R
> > to run their own generator in R. However, there is no such mechanism for
> > package writers. Those who want to add their own generators abuse 
> > RNGkind(kind="user-supplied") for their purpose.
> > The problem with this approach is that it relies on the unique existence of the
> > function "user_unif_rand". When two packages are loaded that use this interface,
> > then at least one package is broken. If the user herself loads a shared library
> > that contains such a function, some of the functionalities of all the 
> > corresponding packages are broken.
> > 
> > When writing my paper I found the following packages on CRAN that abuse this
> > interface (meanwhile there might be more packages):
> > 
> > randaes_0.1.tar.gz
> > rlecuyer_0.1.tar.gz
> > rsprng_0.3-1.tar.gz
> > rstream_1.1.tar.gz
> > SuppDists_1.0-13.tar.gz
> > 
> > what makes the situation even more complicated is the fact that some of these
> > packages are loaded automaticall by other packages.
> > For example, package 'rlecuyer' is loaded by
> > 
> > snow_0.2-1.tar.gz
> > snowFT_0.0-1.tar.gz
> > varSelRF_0.6-2.tar.gz
> > 
> > To solve this problem, Stefan Theussl and I have tried to extend the mechanism
> > for random number generators in the following way:
> > 
> > - we have added a new kind of generators: "package-supplied"
> > 
> > - this generator kind needs functions named 'package_unif_rand', 'package_unif_init',
> >   'package_unif_nseed', and 'package_unif_seedloc'
> >   (analogously to the functions for kind "user-supplied")
> > 
> > - RNGkind has an additional optional argument:
> >     RNGkind <- function(kind = NULL, normal.kind = NULL, PACKAGE = "")
> >   argument 'PACKAGE' is only used for the new generator kind "package-supplied"
> > 
> > - similarly the function set.seed needs the optinal argument 'PACKAGE'
> > 
> > Since I need such an extended interface (and I assume that other package
> > write do also) I ask whether this extension can be included into R.
> > We have implemented a first experimental version of this modified interface. 
> > A patch against the development snapshot R-devel_2006-08-30.tar.gz is available.
> > However, it is a little bit too long (239 lines) to be posted here.
> > 
> > Of course suggestions for an alternative approach are welcome.
> > 
> > Josef
> > 
> > 
> > 
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From macq at llnl.gov  Fri Sep  1 17:56:03 2006
From: macq at llnl.gov (Don MacQueen)
Date: Fri, 1 Sep 2006 08:56:03 -0700
Subject: [Rd] R-Project logo in SVG format
In-Reply-To: <Pine.LNX.4.64.0608310839160.32642@goldenaxe.gpcc.itd.umich.edu>
References: <Pine.LNX.4.64.0608310839160.32642@goldenaxe.gpcc.itd.umich.edu>
Message-ID: <p06230902c11e06f59b75@[128.115.153.6]>

I have a file named Rlogo-5.svg, created by 
downloading Rlogo-5.png, opening it with Adobe 
Illustrator, Saving as SVG.
I didn't tinker with any of Illustrator's options 
with regard to how, exactly, to save it, since I 
pretty much don't know what they mean. Whether it 
is of any use to anyone, or whether it is truly 
scalable, I have no idea. All I know is that 
Illustrator claims it is an SVG file.

Took about 2 minutes, all together (writing this email took longer).

If any R Core member (or anyone else, for that 
matter), wants a copy, please let me know. I 
don't want to burden lots of people with a file 
they probably don't want.

I've emailed a copy separately to Lars.

-Don


At 8:41 AM -0400 8/31/06, Lars D. Nood?n wrote:
>Hi,
>
>I'm looking for a version of the R-Project logo in SVG format.  I've found
>the bitmapped versions,
>  	http://developer.r-project.org/Logo/
>
>but would prefer a scalable version as it usually looks better when
>printed.
>
>Where may I find one?
>-Lars
>
>Lars Nooden (lars at umich.edu)
>  	On the Internet, nobody knows you're a dog ...
>  	... until you start barking.
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
--------------------------------------
Don MacQueen
Environmental Protection Department
Lawrence Livermore National Laboratory
Livermore, CA, USA



From jeff.horner at vanderbilt.edu  Fri Sep  1 21:09:22 2006
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Fri, 01 Sep 2006 14:09:22 -0500
Subject: [Rd] Overriding InitTempDir
In-Reply-To: <Pine.LNX.4.64.0609011619270.15998@gannet.stats.ox.ac.uk>
References: <44F75DA4.6000209@vanderbilt.edu> <44F84BB9.5050107@vanderbilt.edu>
	<Pine.LNX.4.64.0609011619270.15998@gannet.stats.ox.ac.uk>
Message-ID: <44F88562.8050809@vanderbilt.edu>

Prof Brian Ripley wrote:
> It is conventional for people proposing changes to R to set out a 
> compelling case as to why they are needed.  I have not seen any case here.
> Can we please have one?

Here's the case for RApache:

An Apache server built with the prefork multi-processing module creates 
and destroys many processes, and if it loads the RApache module, this 
means that each server process initializes its own R interpreter, 
thereby creating many new temp directories. Now, the Apache API provides 
shutdown hooks to allow modules (such as with RApache) to do cleanup 
work, e.g. remove temporary directories, before a process is destroyed, 
but there are occasions when processes just die. I'd like RApache to 
fail a little more gracefully, in this case, by not leaving around a 
(usually empty) temp directory.

> 
> Someone will have to think through the ramifications of such a change (and 
> BTW using edit() in an R console is not at all unlikely), and continue to 
> maintain it for years to come.  I have to say that in the past I have 
> accepted quite a few user suggestions that became maintenance nightmares, 
> so I have become very wary.

Understood, but I have to say that I'm even more confused about how a 
program that embeds R is expected to shut itself down with the 
introduction of Rf_endEmbeddedR. Does this implicitly deprecate the use 
of overriding the callback R_CleanUp?

> 
> It's not really a good time: R-devel is about to start solidifying towards 
> 2.4.0, and we have quite a few issues to work through (e.g. the internal 
> changes to S4 methods).

Of course, that does seem a bit more important.

> 
> 
> On Fri, 1 Sep 2006, Jeffrey Horner wrote:
> 
>> Jeffrey Horner wrote:
>>> For embedded projects, one may want to eliminate the per-session temp 
>>> directory created by InitTempDir() and just use a system-specific temp 
>>> directory. Here's my solution:
>>>
>>> extern char *R_TempDir;
>>>
>>> void my_InitTempDir()
>>> {
>>>      char *tmp;
>>>
>>>      if (R_TempDir){
>>>          if (rmdir(R_TempDir) != 0){
>>>              perror("Fatal Error: could not remove R's TempDir!");
>>>              exit(1);
>>>          }
>>>      }
>>>
>>>      tmp = getenv("TMPDIR");
>>>      if (tmp == NULL) {
>>>          tmp = getenv("TMP");
>>>              if (tmp == NULL) {
>>>                  tmp = getenv("TEMP");
>>>                  if (tmp == NULL)
>>>                      tmp = "/tmp";
>>>              }
>>>      }
>>>
>>>      R_TempDir=tmp;
>>>
>>>      if (setenv("R_SESSION_TMPDIR",tmp,1) != 0){
>>>          perror("Fatal Error: couldn't set/replace R_SESSION_TMPDIR!");
>>>          exit(1);
>>>      }
>>> }
>>>
>>> This function is called after Rf_initEmbeddedR; it's seems like a hack 
>>> but it works. Does anyone have other solutions?
>> I just found a fault with the above solution, but only if a program that 
>> embeds R calls the R edit function; highly unlikely. Nevertheless, It 
>> turns out that soon after InitTempDir is called, InitEd is called and 
>> sets the variable DefaultFileName (which is hidden by storage class 
>> static, unlike R_TempDir) to a temporary filename located in the 
>> directory which was just deleted by my_initTempDir.
>>
>>> Maybe InitTempDir could check if R_TempDir was not NULL and then just 
>>> return.
>> So it would be nice if the above (InitTempDir only creating a directory 
>> when R_TempDir is NULL) could be added to R-trunk.
>>
>> Note also that in the case that R_TempDir is set to a system-specific 
>> temp directory, the program would then have to set it back to NULL as 
>> the new function Rf_endEmbeddedR now tests to see if R_TempDir has been set:
>>
>> /* use fatal !=0 for emergency bail out */
>> void Rf_endEmbeddedR(int fatal)
>> {
>>      unsigned char buf[1024];
>>      char * tmpdir;
>>
>>      R_RunExitFinalizers();
>>      CleanEd();
>>      if(!fatal) KillAllDevices();
>>      if((tmpdir = R_TempDir)) {
>>      snprintf((char *)buf, 1024, "rm -rf %s", tmpdir);
>>      R_system((char *)buf);
>>      }
>>      if(!fatal && R_CollectWarnings)
>>      PrintWarnings();    /* from device close and .Last */
>>      fpu_setup(FALSE);
>> }
>>
>> Jeff
>>
> 


-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner



From ggrothendieck at gmail.com  Fri Sep  1 21:53:06 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 1 Sep 2006 15:53:06 -0400
Subject: [Rd] R svn log problem
In-Reply-To: <971536df0608212005t1ba7a341vfb5e6a29794e975d@mail.gmail.com>
References: <971536df0608212005t1ba7a341vfb5e6a29794e975d@mail.gmail.com>
Message-ID: <971536df0609011253g271ce394taa4809066c2571d9@mail.gmail.com>

The svn log seems to be missing again.  This also happened
10 days ago.

On 8/21/06, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> The R svn log usually available at:
>
> http://developer.r-project.org/R.svnlog.2006
>
> seems to be missing.
>



From murdoch at stats.uwo.ca  Fri Sep  1 21:58:15 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 01 Sep 2006 15:58:15 -0400
Subject: [Rd] R svn log problem
In-Reply-To: <971536df0609011253g271ce394taa4809066c2571d9@mail.gmail.com>
References: <971536df0608212005t1ba7a341vfb5e6a29794e975d@mail.gmail.com>
	<971536df0609011253g271ce394taa4809066c2571d9@mail.gmail.com>
Message-ID: <44F890D7.4010204@stats.uwo.ca>

On 9/1/2006 3:53 PM, Gabor Grothendieck wrote:
> The svn log seems to be missing again.  This also happened
> 10 days ago.
> 
> On 8/21/06, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
>> The R svn log usually available at:
>>
>> http://developer.r-project.org/R.svnlog.2006
>>
>> seems to be missing.

Fixed now.  There was a transient failure to connect to the server last 
night; I'll change the script so that if this happens, the old log is 
left online.

Duncan Murdoch



From ggrothendieck at gmail.com  Sat Sep  2 05:40:29 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 1 Sep 2006 23:40:29 -0400
Subject: [Rd] typo in as.POSIXlt.Rd example
Message-ID: <971536df0609012040j18b20e33ge0354d400b06cd55@mail.gmail.com>

In the R 2.4.0 as.POSIXlt.Rd example section:

https://svn.r-project.org/R/trunk/src/library/base/man/as.POSIXlt.Rd

"GMT" is mispelled as "GNT".

That example does not appear in 2.3.1



From ripley at stats.ox.ac.uk  Sat Sep  2 18:41:24 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 2 Sep 2006 17:41:24 +0100 (BST)
Subject: [Rd] [<-.POSIXlt changes order of attributes (PR#9197)
In-Reply-To: <Pine.LNX.4.64.0609011416490.11719@gannet.stats.ox.ac.uk>
References: <20060901115839.3758019A05@slim.kubism.ku.dk>
	<Pine.LNX.4.64.0609011416490.11719@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0609021738120.11327@gannet.stats.ox.ac.uk>

There is a bug in identical(), though:

> identical(pairlist(a=1, b=2), pairlist(a=1, aa=2))
[1] TRUE
> identical(structure(pi, a=1, b=2), structure(pi,a=1, aa=2))
[1] TRUE

so identical() is not even looking at the names of the attributes but only 
checking their values.  Oops ....

On Fri, 1 Sep 2006, Prof Brian Ripley wrote:

> Please point us to the documentation that says attributes are ordered.
> E.g. R-lang.texi says
> 
>   All objects except @code{NULL} can have one or more attributes attached
>   to them.  Attributes are stored as a list where all elements are named.
> 
> (although in fact they are stored in a pairlist).
> 
> I know of tens of functions that change the order of attributes, and 
> did look at teaching identical() that they are not ordered.  But 
> since they are stored as a pairlist, it would be quite expensive.
> (Given that attributes seem to be growing in use, another internal storage 
> mechanism is becoming more appropriate.)
> 
> BTW, all.equal() does not assume attributes are ordered.
> 
> 
> On Fri, 1 Sep 2006, gregor.gorjanc at bfro.uni-lj.si wrote:
> 
> > This is a multi-part message in MIME format.
> > --------------090203020600020104020707
> > Content-Type: text/plain; charset=UTF-8
> > Content-Transfer-Encoding: 7bit
> > 
> > Hello!
> > 
> > I was doing some tests with identical() and found out that [<-.POSIXlt
> > method changes order of attributes. This example shows that:
> > 
> > x <- strptime("1900-1-1", format="%Y-%m-%d")
> > x <- c(x)
> > y <- c(x, x+1)
> > x1 <- x
> > y1 <- y
> > 
> > attributes(x)
> > $names
> > [1] "sec"   "min"   "hour"  "mday"  "mon"   "year"  "wday"  "yday"  "isdst"
> > 
> > $class
> > [1] "POSIXt"  "POSIXlt"
> > 
> > $tzone
> > [1] ""     "CET"  "CEST"
> > 
> > identical(attributes(x), attributes(y))
> > TRUE
> > 
> > x[1] <- NA
> > attributes(x)
> > $names
> > [1] "sec"   "min"   "hour"  "mday"  "mon"   "year"  "wday"  "yday"  "isdst"
> > 
> > $tzone
> > [1] ""     "CET"  "CEST"
> > 
> > $class
> > [1] "POSIXt"  "POSIXlt"
> > 
> > y[1] <- NA
> > attributes(y)
> > $names
> > [1] "sec"   "min"   "hour"  "mday"  "mon"   "year"  "wday"  "yday"  "isdst"
> > 
> > $tzone
> > [1] ""     "CET"  "CEST"
> > 
> > $class
> > [1] "POSIXt"  "POSIXlt"
> > 
> > identical(attributes(x), attributes(x1))
> > FALSE
> > 
> > identical(attributes(y), attributes(y1))
> > FALSE
> > 
> > This can be solved with either:
> > 
> > Index: R/src/library/base/R/datetime.R
> > ===================================================================
> > --- R/src/library/base/R/datetime.R     (revision 39045)
> > +++ R/src/library/base/R/datetime.R     (working copy)
> > @@ -713,10 +713,10 @@
> >  {
> >      if(!as.logical(length(value))) return(x)
> >      value <- as.POSIXlt(value)
> > -    cl <- oldClass(x)
> > +    att <- attributes(x)
> >      class(x) <- class(value) <- NULL
> >      for(n in names(x)) x[[n]][i] <- value[[n]]
> > -    class(x) <- cl
> > +    attributes(x) <- att
> >      x
> >  }
> > 
> > or in the same way as it is done in [.<-POSIXct method
> > 
> > Index: R/src/library/base/R/datetime.R
> > ===================================================================
> > --- R/src/library/base/R/datetime.R     (revision 39045)
> > +++ R/src/library/base/R/datetime.R     (working copy)
> > @@ -714,9 +714,11 @@
> >      if(!as.logical(length(value))) return(x)
> >      value <- as.POSIXlt(value)
> >      cl <- oldClass(x)
> > +    tz <- attr(x, "tzone")
> >      class(x) <- class(value) <- NULL
> >      for(n in names(x)) x[[n]][i] <- value[[n]]
> >      class(x) <- cl
> > +    attr(x, "tzone") <- tz
> >      x
> >  }
> > 
> > I have checked both versions in r-devel with make check-all and all went
> > fine.
> > 
> > Regards, Gregor
> > 
> > 
> > 
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From gregor.gorjanc at bfro.uni-lj.si  Sat Sep  2 22:02:10 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Sat, 02 Sep 2006 22:02:10 +0200
Subject: [Rd] [<-.POSIXlt changes order of attributes (PR#9197)
In-Reply-To: <Pine.LNX.4.64.0609011416490.11719@gannet.stats.ox.ac.uk>
References: <20060901115839.3758019A05@slim.kubism.ku.dk>
	<Pine.LNX.4.64.0609011416490.11719@gannet.stats.ox.ac.uk>
Message-ID: <44F9E342.9050900@bfro.uni-lj.si>

Hello,

Prof Brian Ripley wrote:
> Please point us to the documentation that says attributes are ordered.
> E.g. R-lang.texi says
> 
>   All objects except @code{NULL} can have one or more attributes attached
>   to them.  Attributes are stored as a list where all elements are named.
> 
> (although in fact they are stored in a pairlist).
> 
> I know of tens of functions that change the order of attributes, and 
> did look at teaching identical() that they are not ordered.  But 
> since they are stored as a pairlist, it would be quite expensive.

I agree that there is no need for attributes to be always in the same
order as this is tedious to achieve as you noted above, but identical()
seems to care about this.

> (Given that attributes seem to be growing in use, another internal storage 
> mechanism is becoming more appropriate.)

Which internal storage mechanism are you talking about here?

> BTW, all.equal() does not assume attributes are ordered.

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.



From gregor.gorjanc at bfro.uni-lj.si  Sat Sep  2 22:05:01 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Sat, 02 Sep 2006 22:05:01 +0200
Subject: [Rd] [<-.POSIXlt changes order of attributes (PR#9197)
In-Reply-To: <Pine.LNX.4.64.0609021738120.11327@gannet.stats.ox.ac.uk>
References: <20060901115839.3758019A05@slim.kubism.ku.dk>
	<Pine.LNX.4.64.0609011416490.11719@gannet.stats.ox.ac.uk>
	<Pine.LNX.4.64.0609021738120.11327@gannet.stats.ox.ac.uk>
Message-ID: <44F9E3ED.6040702@bfro.uni-lj.si>

Hello,

Prof Brian Ripley wrote:
> There is a bug in identical(), though:
> 
>> identical(pairlist(a=1, b=2), pairlist(a=1, aa=2))
> [1] TRUE
>> identical(structure(pi, a=1, b=2), structure(pi,a=1, aa=2))
> [1] TRUE
> 
> so identical() is not even looking at the names of the attributes but only 
> checking their values.  Oops ....

Aha, so this is the problem then. Thank you for tracking down the problem!

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.



From jmc at r-project.org  Sat Sep  2 23:01:04 2006
From: jmc at r-project.org (John Chambers)
Date: Sat, 02 Sep 2006 17:01:04 -0400
Subject: [Rd] Update on S4 Method dispatch changes
Message-ID: <44F9F110.2010709@r-project.org>

As of a recent revision (39064 in svn), the problems we've been able to 
isolate in the CRAN packages seem either to be solved or not obviously 
related to the methods changes.  If anyone has a reproducible example 
that seems to point to the changes, let me know.

One more change is planned, likely for tomorrow:  We will introduce a 
bit in the internal data structure that is turned on for S4 objects, 
giving a quick and reliable test.  Compared to the last round of 
changes, this should have little direct impact, but it will allow more 
reliable and efficient handling of S4 objects.  It will, however, also 
require objects to be created with the new code in order for the test to 
work.  So don't file away your saved data images just yet, if they 
contain S4 objects they will need to be recreated.

John



From ripley at stats.ox.ac.uk  Sun Sep  3 07:07:08 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 3 Sep 2006 06:07:08 +0100 (BST)
Subject: [Rd] [<-.POSIXlt changes order of attributes (PR#9197)
In-Reply-To: <44F9E342.9050900@bfro.uni-lj.si>
References: <20060901115839.3758019A05@slim.kubism.ku.dk>
	<Pine.LNX.4.64.0609011416490.11719@gannet.stats.ox.ac.uk>
	<44F9E342.9050900@bfro.uni-lj.si>
Message-ID: <Pine.LNX.4.64.0609030604590.10774@gannet.stats.ox.ac.uk>

On Sat, 2 Sep 2006, Gregor Gorjanc wrote:

> Hello,
> 
> Prof Brian Ripley wrote:
> > Please point us to the documentation that says attributes are ordered.
> > E.g. R-lang.texi says
> > 
> >   All objects except @code{NULL} can have one or more attributes attached
> >   to them.  Attributes are stored as a list where all elements are named.
> > 
> > (although in fact they are stored in a pairlist).
> > 
> > I know of tens of functions that change the order of attributes, and 
> > did look at teaching identical() that they are not ordered.  But 
> > since they are stored as a pairlist, it would be quite expensive.
> 
> I agree that there is no need for attributes to be always in the same
> order as this is tedious to achieve as you noted above, but identical()
> seems to care about this.
> 
> > (Given that attributes seem to be growing in use, another internal storage 
> > mechanism is becoming more appropriate.)
> 
> Which internal storage mechanism are you talking about here?

The one mentioned at

	'Attributes are stored as a list'

(but in fact a pairlist). We may want to change to e.g. a hash table.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From Roger.Bivand at nhh.no  Sun Sep  3 17:00:18 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 3 Sep 2006 17:00:18 +0200 (CEST)
Subject: [Rd] S4 changes - sp fails
In-Reply-To: <44F83698.50205@r-project.org>
Message-ID: <Pine.LNX.4.44.0609031649120.3162-100000@reclus.nhh.no>

On Fri, 1 Sep 2006, John Chambers wrote:

> General comments.  A number of packages will likely be showing weird 
> warnings on attach() about packages being out of date.  Likely caused by 
> a confusion when two packages define the same generic.  The bug is being 
> worked on, but there are some issues of package design that will need 
> discussion later.
> 
> Early revisions with the new code did have a C-level problem but that is 
> now fixed AFAIK, so any hard evidence of protection problems would be 
> valuable.

>From 39062 on a fresh login, R and offending package fresh on the machine
with problems reported earlier, no failure. With 39062 on my usual login
but after a thorough make distclean and control over errant R_LIBS, no
failure. This morning with make distclean and updates to methods - svn
39076, no failure. So I think the failures were probably provoked by stale
software components as Brian Ripley suggested, rather than by unresolved
methods package issues as such. Happily, rgdal (depends on sp) also
passed check at R 39076.

Roger

> 
> There have been some changes, up to svn revision 39037 at the moment, 
> but there will be some more.  All reports are appreciated.  Some are 
> easier for me to check out than others (I'm working from a home setup 
> that does not have all of CRAN available (!) so it takes time to test a 
> package with many dependencies in "CMD check"s view of things.)
> 
> John
> 
> 
> Roger Bivand wrote:
> > On Fri, 1 Sep 2006, Roger Bivand wrote:
> >
> >   
> >> On Fri, 1 Sep 2006, Prof Brian Ripley wrote:
> >>
> >>     
> >>> Since writing that, I have found that there is a similar problem with 
> >>> testing mvoutliers (which does load sp), and it depends on exactly what 
> >>> has been done in what order.  (I'll forward to you the exact description.)
> >>>       
> >
> > On a different RHEL 4 i386 with R version 2.4.0 (2006-09-01 r39049), and 
> > fully updated sp CVS from 
> >
> > cvs -z3 -d:pserver:anonymous at r-spatial.cvs.sourceforge.net:/cvsroot/r-spatial checkout sp
> >
> > CND check sp passes with no error (with RColorBrewer the only installed 
> > package in a test library).
> >
> > I'll try again on the first machine (which is also RHEL 4 i386, but where 
> > R was at 2006-08-31 r39045, and where there may have been configuration 
> > issues (wrong library path?).
> >
> > Roger
> >
> >   
> >> Thanks.
> >>
> >> I reran the interactive test:
> >>
> >> library(sp, lib.loc="sp.Rcheck")
> >> example("DMS-class")
> >>
> >> which ran without problems.
> >>
> >>     
> >>> .libPaths()
> >>>       
> >> [1] "/home/rsb/topics/r_libs"                
> >> [2] "/home/rsb/topics/Rtobe240/lib/R/library"
> >>     
> >>> list.files(.libPaths()[1])
> >>>       
> >> [1] "abind"        "maptools"     "pixmap"       "RColorBrewer" "R.css"       
> >> [6] "rgdal"        "SparseM"      "spdep"        "tripack"
> >>     
> >>> sessionInfo()
> >>>       
> >> R version 2.4.0 Under development (unstable) (2006-08-31 r39045) 
> >> i686-pc-linux-gnu 
> >>
> >> locale:
> >> LC_CTYPE=en_GB;LC_NUMERIC=C;LC_TIME=en_GB;LC_COLLATE=en_GB;LC_MONETARY=en_GB;LC_
> >> MESSAGES=en_GB;LC_PAPER=en_GB;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREME
> >> NT=en_GB;LC_IDENTIFICATION=C
> >>
> >> attached base packages:
> >> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets" 
> >> [7] "base"     
> >>
> >> other attached packages:
> >>       sp 
> >> "0.8-19" 
> >>
> >>     
> >>> I now suspect there is a protection problem in the new S4 dispatch code.
> >>> Using gctorture/valgrind may help locate it.
> >>>       
> >> Running check --use-gct sp now.
> >>
> >> Roger
> >>
> >>     
> >>> Brian
> >>>
> >>> On Fri, 1 Sep 2006, Roger Bivand wrote:
> >>>
> >>>       
> >>>> On Fri, 1 Sep 2006, Prof Brian Ripley wrote:
> >>>>
> >>>>         
> >>>>> Roger,
> >>>>>
> >>>>> I had managed to run R CMD check on sp successfully on r39021 and r39043 
> >>>>> (current) in my nightly checks.  (There are a couple of tests where the 
> >>>>> show/print method is not being invoked, but that is not new.)
> >>>>>
> >>>>> All I can suggest is to install R from scratch (make distclean), and then 
> >>>>> reinstall all relevant packages.  At a guess, your interactive use and R 
> >>>>> CMD check are picking up different libraries.
> >>>>>           
> >>>> Brian,
> >>>>
> >>>> I added .libPaths() and sessionInfo() to the offending example, and tried
> >>>> with a fresh svn checkout built in a fresh directory and installed in a
> >>>> fresh directory (no sp or methods in /home/rsb/topics/r_libs, which was
> >>>> set with export R_LIBS=):
> >>>>
> >>>>         
> >>>>> data(state)
> >>>>> .libPaths()
> >>>>>           
> >>>> [1] "/home/rsb/topics/packages/sp-bundle/sp.Rcheck"
> >>>> [2] "/home/rsb/topics/r_libs"                      
> >>>> [3] "/home/rsb/topics/Rtobe240/lib/R/library"      
> >>>>         
> >>>>> sessionInfo()
> >>>>>           
> >>>> R version 2.4.0 Under development (unstable) (2006-08-31 r39045) 
> >>>> i686-pc-linux-gnu 
> >>>>
> >>>> locale:
> >>>> LC_CTYPE=en_GB;LC_NUMERIC=C;LC_TIME=en_GB;LC_COLLATE=en_GB;LC_MONETARY=en_GB;LC_
> >>>> MESSAGES=en_GB;LC_PAPER=en_GB;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREME
> >>>> NT=en_GB;LC_IDENTIFICATION=C
> >>>>
> >>>> attached base packages:
> >>>> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets" 
> >>>> [7] "base"     
> >>>>
> >>>> other attached packages:
> >>>>       sp 
> >>>> "0.8-19" 
> >>>>         
> >>>>> dd2dms(state.center$x)
> >>>>>           
> >>>> Error in function (classes, fdef, mtable)  : 
> >>>>         unable to find an inherited method for function "initialize", for 
> >>>> signature "integer"
> >>>> Execution halted
> >>>>
> >>>> I also tried to replicate the problem by making a new, very small, package 
> >>>> with just the apparently offending files:
> >>>>
> >>>> spS4:
> >>>> DESCRIPTION  man/  NAMESPACE  R/
> >>>>
> >>>> spS4/man:
> >>>> char2dms.Rd  DMS-class.Rd
> >>>>
> >>>> spS4/R:
> >>>> AAA.R  dms.R
> >>>>
> >>>> and edited DESCRIPTION, NAMESPACE, and AAA.R to suit. In this setting 
> >>>> there was no problem. I'll carry on looking. None of these files has 
> >>>> changed between released 0.8-18 and CVS 0.8-19. 
> >>>>
> >>>> Roger
> >>>>
> >>>>         
> >>>>> There are around a dozen S4-using packages on CRAN that are currently 
> >>>>> failing their checks: some look like newly-discovered bugs but some look 
> >>>>> like problems in S4 dispatch (even of S3 dispatch for S3 generics turned 
> >>>>> into S4 generics).  More are producing apparently incorrect warnings.
> >>>>>
> >>>>> Brian
> >>>>>
> >>>>>
> >>>>> On Thu, 31 Aug 2006, Roger Bivand wrote:
> >>>>>
> >>>>>           
> >>>>>> Under R version 2.4.0 (2006-08-30 r39024), sp fails CMD check following
> >>>>>> the latest changes in methods.
> >>>>>>
> >>>>>> The failures are in running examples and occur in CMD check:
> >>>>>>
> >>>>>>             
> >>>>>>> data(state)
> >>>>>>> dd2dms(state.center$x)
> >>>>>>>               
> >>>>>> Error in function (classes, fdef, mtable)  : 
> >>>>>>         unable to find an inherited method for function "initialize", for 
> >>>>>> signature "integer"
> >>>>>>
> >>>>>> Offending code:
> >>>>>>
> >>>>>> 	deg <- as(floor(dd), "integer") 
> >>>>>>
> >>>>>> After replacing by as.integer(floor(dd)), it fails on the local class 
> >>>>>> definition:
> >>>>>>
> >>>>>>             
> >>>>>>> dd2dms(state.center$x)
> >>>>>>>               
> >>>>>> Error in function (classes, fdef, mtable)  : 
> >>>>>>         unable to find an inherited method for function "initialize", for 
> >>>>>> signature "DMS"
> >>>>>>
> >>>>>> Installing sp, example("DMS-class") runs successfully interactively 
> >>>>>> (other examples do too).
> >>>>>>
> >>>>>> The methods package is declared as Depends: in DESCRIPTION, and
> >>>>>> import(methods) in NAMESPACE; 
> >>>>>>
> >>>>>> .onLoad <- function(lib, pkg) require(methods) is in the first R source 
> >>>>>> file in Collate: order.
> >>>>>>
> >>>>>> Should the methods package be being invoked in some other way, is there a 
> >>>>>> reason why the installed package appears to run examples successfully that 
> >>>>>> fail under CMD check?
> >>>>>>
> >>>>>> Roger
> >>>>>>
> >>>>>>
> >>>>>>             
> >>>>>           
> >>>>         
> >>>       
> >>     
> >
> >   
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From h.wickham at gmail.com  Sun Sep  3 17:46:02 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Sun, 3 Sep 2006 10:46:02 -0500
Subject: [Rd] lm, weights and ...
Message-ID: <f8e6ff050609030846l462be0f1m1e41ea5ecb2c0414@mail.gmail.com>

> lm2 <- function(...) lm(...)
> lm2(mpg ~ wt, data=mtcars)

Call:
lm(formula = ..1, data = ..2)

Coefficients:
(Intercept)           wt
     37.285       -5.344

> lm2(mpg ~ wt, weights=cyl, data=mtcars)
Error in eval(expr, envir, enclos) : ..2 used in an incorrect context,
no ... to look in


Can anyone explain why this is happening?  (Obviously this is a
manufactured example, but it crops up in ggplot when you want to
provide a function to perform smoothing)

Thanks,

Hadley



From jmc at r-project.org  Sun Sep  3 17:53:46 2006
From: jmc at r-project.org (John Chambers)
Date: Sun, 03 Sep 2006 11:53:46 -0400
Subject: [Rd] Internal flag for S4 objects
Message-ID: <44FAFA8A.9030202@r-project.org>

A recent revision (svn version 39077) has introduced an internal flag (a 
bit in the C structure) that is turned on by the code that generates 
objects from an S4 class.

There are corresponding tests for an S4 object, isS4() in R and 
IS_S4_OBJECT() in C.  These are fast and reliable, and should replace 
any heuristic tests previously used.

The tests are not currently used widely, but in the future could be 
combined with some of the other recent changes to improve reliability 
and efficiency of computations with S4 objects.  Most such changes are 
more likely for 2.5.x than 2.4.0.

S4 objects in saved sessions and other binary files will not have the 
bit set, so they should be regenerated.  A likely symptom that you have 
not done so is that the objects will not print automatically with the 
standard S4 method, because the internal code now checks for an S4 
object before dispatching show().

John



From p.dalgaard at biostat.ku.dk  Sun Sep  3 18:26:09 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 03 Sep 2006 18:26:09 +0200
Subject: [Rd] lm, weights and ...
In-Reply-To: <f8e6ff050609030846l462be0f1m1e41ea5ecb2c0414@mail.gmail.com>
References: <f8e6ff050609030846l462be0f1m1e41ea5ecb2c0414@mail.gmail.com>
Message-ID: <x2odtwncgu.fsf@turmalin.kubism.ku.dk>

"hadley wickham" <h.wickham at gmail.com> writes:

> > lm2 <- function(...) lm(...)
> > lm2(mpg ~ wt, data=mtcars)
> 
> Call:
> lm(formula = ..1, data = ..2)
> 
> Coefficients:
> (Intercept)           wt
>      37.285       -5.344
> 
> > lm2(mpg ~ wt, weights=cyl, data=mtcars)
> Error in eval(expr, envir, enclos) : ..2 used in an incorrect context,
> no ... to look in
> 
> 
> Can anyone explain why this is happening?  (Obviously this is a
> manufactured example, but it crops up in ggplot when you want to
> provide a function to perform smoothing)

Presumably this is due to the nonstandard evaluation of the weights
argument. This is a long story, the short version is that the argument
ought to have been designed to be a model formula, but we haven't been
willing to sacrifice S-PLUS compatibility. A more extensive
white-paper on the issues, written by Thomas Lumley, is at

http://developer.r-project.org/nonstandard-eval.pdf

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From ligges at statistik.uni-dortmund.de  Sun Sep  3 18:35:07 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Sun, 03 Sep 2006 18:35:07 +0200
Subject: [Rd] Internal flag for S4 objects
In-Reply-To: <44FAFA8A.9030202@r-project.org>
References: <44FAFA8A.9030202@r-project.org>
Message-ID: <44FB043B.4090209@statistik.uni-dortmund.de>



John Chambers wrote:
> A recent revision (svn version 39077) has introduced an internal flag (a 
> bit in the C structure) that is turned on by the code that generates 
> objects from an S4 class.
> 
> There are corresponding tests for an S4 object, isS4() in R and 
> IS_S4_OBJECT() in C.  These are fast and reliable, and should replace 
> any heuristic tests previously used.
> 
> The tests are not currently used widely, but in the future could be 
> combined with some of the other recent changes to improve reliability 
> and efficiency of computations with S4 objects.  Most such changes are 
> more likely for 2.5.x than 2.4.0.
> 
> S4 objects in saved sessions and other binary files will not have the 
> bit set, so they should be regenerated.  A likely symptom that you have 
> not done so is that the objects will not print automatically with the 
> standard S4 method, because the internal code now checks for an S4 
> object before dispatching show().
> 
> John

Dear R-devel testers under Windows,

this means that I won't upload the newly built Windows binary packages 
right now, but I will rebuild all of them again under current R-devel 
tomorrow. They won't appear on CRAN master before Wednesday. In the 
meantime, the link to R-2.3.x packages will remain active and some 
packages simply won't work.

Best,
Uwe Ligges



From ggrothendieck at gmail.com  Sun Sep  3 18:45:39 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 3 Sep 2006 12:45:39 -0400
Subject: [Rd] lm, weights and ...
In-Reply-To: <f8e6ff050609030846l462be0f1m1e41ea5ecb2c0414@mail.gmail.com>
References: <f8e6ff050609030846l462be0f1m1e41ea5ecb2c0414@mail.gmail.com>
Message-ID: <971536df0609030945w38f42af6o2f38ce6a05a0651d@mail.gmail.com>

If you change it to:

lm3 <- function(...) eval.parent(substitute(lm(...)))

then it works.

> lm3(mpg ~ wt, weights=cyl, data=mtcars)

Call:
lm(formula = mpg ~ wt, data = mtcars, weights = cyl)

Coefficients:
(Intercept)           wt
      35.50        -4.91


On 9/3/06, hadley wickham <h.wickham at gmail.com> wrote:
> > lm2 <- function(...) lm(...)
> > lm2(mpg ~ wt, data=mtcars)
>
> Call:
> lm(formula = ..1, data = ..2)
>
> Coefficients:
> (Intercept)           wt
>     37.285       -5.344
>
> > lm2(mpg ~ wt, weights=cyl, data=mtcars)
> Error in eval(expr, envir, enclos) : ..2 used in an incorrect context,
> no ... to look in
>
>
> Can anyone explain why this is happening?  (Obviously this is a
> manufactured example, but it crops up in ggplot when you want to
> provide a function to perform smoothing)
>
> Thanks,
>
> Hadley
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



From sdavis2 at mail.nih.gov  Sun Sep  3 22:25:57 2006
From: sdavis2 at mail.nih.gov (Sean Davis)
Date: Sun, 3 Sep 2006 16:25:57 -0400
Subject: [Rd] Unexpected source() behavior in R-devel
Message-ID: <200609031625.57963.sdavis2@mail.nih.gov>

Why am I seeing the following in R-devel (sept 2, 2006 build) on opensuse 
10.1?  I'm sure it is something simple I am missing, but I just don't see it 
(output below).  

Thanks,
Sean


> readLines(url("http://www.bioconductor.org/biocLite.R"))
[1] "source(\"http://bioconductor.org/getBioC.R\")"       
[2] ""                                                    
[3] "biocLite <- function(pkgs, groupName=\"lite\", ...)" 
[4] "{"                                                   
[5] "    if (missing(pkgs))"                              
[6] "        getBioC(groupName=groupName, ...)"           
[7] "    else"                                            
[8] "        getBioC(pkgs=pkgs, groupName=groupName, ...)"
[9] "}"                                                   
> source(url("http://www.bioconductor.org/biocLite.R"))
Error in file(file, "r", encoding = encoding) : 
	unable to open connection
In addition: Warning message:
cannot open: HTTP status was '404 Not Found' 
> sessionInfo()
R version 2.4.0 Under development (unstable) (2006-09-02 r39068) 
x86_64-unknown-linux-gnu 

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[7] "base"     
>



From p.dalgaard at biostat.ku.dk  Sun Sep  3 23:06:01 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 03 Sep 2006 23:06:01 +0200
Subject: [Rd] Unexpected source() behavior in R-devel
In-Reply-To: <200609031625.57963.sdavis2@mail.nih.gov>
References: <200609031625.57963.sdavis2@mail.nih.gov>
Message-ID: <x21wqsmzie.fsf@turmalin.kubism.ku.dk>

Sean Davis <sdavis2 at mail.nih.gov> writes:

> Why am I seeing the following in R-devel (sept 2, 2006 build) on opensuse 
> 10.1?  I'm sure it is something simple I am missing, but I just don't see it 
> (output below).  
> 
> Thanks,
> Sean
> 
> 
> > readLines(url("http://www.bioconductor.org/biocLite.R"))
> [1] "source(\"http://bioconductor.org/getBioC.R\")"       
> [2] ""                                                    
> [3] "biocLite <- function(pkgs, groupName=\"lite\", ...)" 
> [4] "{"                                                   
> [5] "    if (missing(pkgs))"                              
> [6] "        getBioC(groupName=groupName, ...)"           
> [7] "    else"                                            
> [8] "        getBioC(pkgs=pkgs, groupName=groupName, ...)"
> [9] "}"                                                   
> > source(url("http://www.bioconductor.org/biocLite.R"))
> Error in file(file, "r", encoding = encoding) : 
> 	unable to open connection
> In addition: Warning message:
> cannot open: HTTP status was '404 Not Found' 
> > sessionInfo()
> R version 2.4.0 Under development (unstable) (2006-09-02 r39068) 
> x86_64-unknown-linux-gnu 
> 
> locale:
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
> 
> attached base packages:
> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets" 
> [7] "base"     
> >

Hmm, something is up. I got

> source(url("http://www.bioconductor.org/biocLite.R"))
Error in file(file, "r", encoding = encoding) :
        unable to open connection
In addition: Warning message:
cannot open: HTTP status was '404 Not Found'
> source(url("http://www.bioconductor.org/biocLite.R"))

 *** caught segfault ***
address 0x21, cause 'memory not mapped'

Traceback:
 1: file(file, "r", encoding = encoding)
 2: source("http://bioconductor.org/getBioC.R")
 3: eval.with.vis(expr, envir, enclos)
 4: eval.with.vis(ei, envir)
 5: source(url("http://www.bioconductor.org/biocLite.R"))

Possible actions:
1: abort (with core dump)
2: normal R exit
3: exit R without saving workspace
4: exit R saving workspace
Selection:


Oops...

The immediate cause would seem to be that
http://bioconductor.org/getBioC.R is non-existent (needs to be
www.bioconductor.org). 

That's a server-side issue, not an R problem, but what was that bit
with the segfault? I can't seem to reproduce it in a fresh session.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From hb at stat.berkeley.edu  Sun Sep  3 23:27:18 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sun, 3 Sep 2006 14:27:18 -0700
Subject: [Rd] Unexpected source() behavior in R-devel
In-Reply-To: <x21wqsmzie.fsf@turmalin.kubism.ku.dk>
References: <200609031625.57963.sdavis2@mail.nih.gov>
	<x21wqsmzie.fsf@turmalin.kubism.ku.dk>
Message-ID: <59d7961d0609031427v6239ac5bp16c7b2af679e996c@mail.gmail.com>

This has been reported before on r-devel, e.g. May 9, 2006 "[Rd] Seg
fault when installing package from bad repository".

It's happening on Mac OSX when trying to download non-existing
webpages (HTTP status 404). That's all I know (not using OSX myself).

/Henrik

On 03 Sep 2006 23:06:01 +0200, Peter Dalgaard <p.dalgaard at biostat.ku.dk> wrote:
> Sean Davis <sdavis2 at mail.nih.gov> writes:
>
> > Why am I seeing the following in R-devel (sept 2, 2006 build) on opensuse
> > 10.1?  I'm sure it is something simple I am missing, but I just don't see it
> > (output below).
> >
> > Thanks,
> > Sean
> >
> >
> > > readLines(url("http://www.bioconductor.org/biocLite.R"))
> > [1] "source(\"http://bioconductor.org/getBioC.R\")"
> > [2] ""
> > [3] "biocLite <- function(pkgs, groupName=\"lite\", ...)"
> > [4] "{"
> > [5] "    if (missing(pkgs))"
> > [6] "        getBioC(groupName=groupName, ...)"
> > [7] "    else"
> > [8] "        getBioC(pkgs=pkgs, groupName=groupName, ...)"
> > [9] "}"
> > > source(url("http://www.bioconductor.org/biocLite.R"))
> > Error in file(file, "r", encoding = encoding) :
> >       unable to open connection
> > In addition: Warning message:
> > cannot open: HTTP status was '404 Not Found'
> > > sessionInfo()
> > R version 2.4.0 Under development (unstable) (2006-09-02 r39068)
> > x86_64-unknown-linux-gnu
> >
> > locale:
> > LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
> >
> > attached base packages:
> > [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"
> > [7] "base"
> > >
>
> Hmm, something is up. I got
>
> > source(url("http://www.bioconductor.org/biocLite.R"))
> Error in file(file, "r", encoding = encoding) :
>         unable to open connection
> In addition: Warning message:
> cannot open: HTTP status was '404 Not Found'
> > source(url("http://www.bioconductor.org/biocLite.R"))
>
>  *** caught segfault ***
> address 0x21, cause 'memory not mapped'
>
> Traceback:
>  1: file(file, "r", encoding = encoding)
>  2: source("http://bioconductor.org/getBioC.R")
>  3: eval.with.vis(expr, envir, enclos)
>  4: eval.with.vis(ei, envir)
>  5: source(url("http://www.bioconductor.org/biocLite.R"))
>
> Possible actions:
> 1: abort (with core dump)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
> Selection:
>
>
> Oops...
>
> The immediate cause would seem to be that
> http://bioconductor.org/getBioC.R is non-existent (needs to be
> www.bioconductor.org).
>
> That's a server-side issue, not an R problem, but what was that bit
> with the segfault? I can't seem to reproduce it in a fresh session.
>
> --
>    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
>  (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>



From p.dalgaard at biostat.ku.dk  Sun Sep  3 23:43:41 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 03 Sep 2006 23:43:41 +0200
Subject: [Rd] Unexpected source() behavior in R-devel
In-Reply-To: <59d7961d0609031427v6239ac5bp16c7b2af679e996c@mail.gmail.com>
References: <200609031625.57963.sdavis2@mail.nih.gov>
	<x21wqsmzie.fsf@turmalin.kubism.ku.dk>
	<59d7961d0609031427v6239ac5bp16c7b2af679e996c@mail.gmail.com>
Message-ID: <x2wt8klj76.fsf@turmalin.kubism.ku.dk>

"Henrik Bengtsson" <hb at stat.berkeley.edu> writes:

> This has been reported before on r-devel, e.g. May 9, 2006 "[Rd] Seg
> fault when installing package from bad repository".
> 
> It's happening on Mac OSX when trying to download non-existing
> webpages (HTTP status 404). That's all I know (not using OSX myself).

It is not entirely obvious that it is the same problem, but it might be.

This happened to me on Linux (2.3.1 on FC5), but it has only happened
that one time. I don't think I did anything particularly strange
earlier in that session.

Of course, with 20/20 hindsight, I should have taken the core dump
option...


> > Possible actions:
> > 1: abort (with core dump)
> > 2: normal R exit
> > 3: exit R without saving workspace
> > 4: exit R saving workspace


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From sdavis2 at mail.nih.gov  Mon Sep  4 13:04:30 2006
From: sdavis2 at mail.nih.gov (Sean Davis)
Date: Mon, 04 Sep 2006 07:04:30 -0400
Subject: [Rd] Unexpected source() behavior in R-devel
In-Reply-To: <x21wqsmzie.fsf@turmalin.kubism.ku.dk>
References: <200609031625.57963.sdavis2@mail.nih.gov>
	<x21wqsmzie.fsf@turmalin.kubism.ku.dk>
Message-ID: <44FC083E.4060207@mail.nih.gov>

Peter Dalgaard wrote:
> Sean Davis <sdavis2 at mail.nih.gov> writes:
>
>   
>> Why am I seeing the following in R-devel (sept 2, 2006 build) on opensuse 
>> 10.1?  I'm sure it is something simple I am missing, but I just don't see it 
>> (output below).  
>>
>> Thanks,
>> Sean
>>
>>
>>     
>>> readLines(url("http://www.bioconductor.org/biocLite.R"))
>>>       
>> [1] "source(\"http://bioconductor.org/getBioC.R\")"       
>> [2] ""                                                    
>> [3] "biocLite <- function(pkgs, groupName=\"lite\", ...)" 
>> [4] "{"                                                   
>> [5] "    if (missing(pkgs))"                              
>> [6] "        getBioC(groupName=groupName, ...)"           
>> [7] "    else"                                            
>> [8] "        getBioC(pkgs=pkgs, groupName=groupName, ...)"
>> [9] "}"                                                   
>>     
>>> source(url("http://www.bioconductor.org/biocLite.R"))
>>>       
>> Error in file(file, "r", encoding = encoding) : 
>> 	unable to open connection
>> In addition: Warning message:
>> cannot open: HTTP status was '404 Not Found' 
>>     
>>> sessionInfo()
>>>       
>> R version 2.4.0 Under development (unstable) (2006-09-02 r39068) 
>> x86_64-unknown-linux-gnu 
>>
>> locale:
>> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets" 
>> [7] "base"     
>>     
>
> Hmm, something is up. I got
>
>   
>> source(url("http://www.bioconductor.org/biocLite.R"))
>>     
> Error in file(file, "r", encoding = encoding) :
>         unable to open connection
> In addition: Warning message:
> cannot open: HTTP status was '404 Not Found'
>   
>> source(url("http://www.bioconductor.org/biocLite.R"))
>>     
>
>  *** caught segfault ***
> address 0x21, cause 'memory not mapped'
>
> Traceback:
>  1: file(file, "r", encoding = encoding)
>  2: source("http://bioconductor.org/getBioC.R")
>  3: eval.with.vis(expr, envir, enclos)
>  4: eval.with.vis(ei, envir)
>  5: source(url("http://www.bioconductor.org/biocLite.R"))
>
> Possible actions:
> 1: abort (with core dump)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
> Selection:
>
>
> Oops...
>
> The immediate cause would seem to be that
> http://bioconductor.org/getBioC.R is non-existent (needs to be
> www.bioconductor.org). 
>
> That's a server-side issue, not an R problem, but what was that bit
> with the segfault? I can't seem to reproduce it in a fresh session.
>
>   
Thanks, Peter, for pointing out the obvious.  I'll talk to the bioc folks. 

On that other point, I have not gotten any segmentation faults so far.  
If I do, I'll repost.

Sean



From sfalcon at fhcrc.org  Mon Sep  4 02:26:03 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Sun, 03 Sep 2006 17:26:03 -0700
Subject: [Rd] Unexpected source() behavior in R-devel
In-Reply-To: <x2wt8klj76.fsf@turmalin.kubism.ku.dk> (Peter Dalgaard's message
	of "03 Sep 2006 23:43:41 +0200")
References: <200609031625.57963.sdavis2@mail.nih.gov>
	<x21wqsmzie.fsf@turmalin.kubism.ku.dk>
	<59d7961d0609031427v6239ac5bp16c7b2af679e996c@mail.gmail.com>
	<x2wt8klj76.fsf@turmalin.kubism.ku.dk>
Message-ID: <m264g4cw9w.fsf@ziti.fhcrc.org>

Peter Dalgaard <p.dalgaard at biostat.ku.dk> writes:

> "Henrik Bengtsson" <hb at stat.berkeley.edu> writes:
>
>> This has been reported before on r-devel, e.g. May 9, 2006 "[Rd] Seg
>> fault when installing package from bad repository".
>> 
>> It's happening on Mac OSX when trying to download non-existing
>> webpages (HTTP status 404). That's all I know (not using OSX myself).
>
> It is not entirely obvious that it is the same problem, but it might be.
>
> This happened to me on Linux (2.3.1 on FC5), but it has only happened
> that one time. I don't think I did anything particularly strange
> earlier in that session.
>
> Of course, with 20/20 hindsight, I should have taken the core dump
> option...

I'm pretty sure this is the same issue and one that has been fixed in
R-devel.

    r38716 | ripley | 2006-07-30 00:19:35 -0700 (Sun, 30 Jul 2006) | 1 line
    Changed paths:
       M /trunk/src/modules/internet/internet.c
    
    crash workaround from Seth Falcon


Sean: can you try just download.file with a URL that gives 404?  Are
you running an R version prior to the above commit?


Bw,

+ seth



From sdavis2 at mail.nih.gov  Mon Sep  4 14:37:01 2006
From: sdavis2 at mail.nih.gov (Sean Davis)
Date: Mon, 04 Sep 2006 08:37:01 -0400
Subject: [Rd] Unexpected source() behavior in R-devel
In-Reply-To: <m264g4cw9w.fsf@ziti.fhcrc.org>
References: <200609031625.57963.sdavis2@mail.nih.gov>	<x21wqsmzie.fsf@turmalin.kubism.ku.dk>	<59d7961d0609031427v6239ac5bp16c7b2af679e996c@mail.gmail.com>	<x2wt8klj76.fsf@turmalin.kubism.ku.dk>
	<m264g4cw9w.fsf@ziti.fhcrc.org>
Message-ID: <44FC1DED.4010500@mail.nih.gov>

Seth Falcon wrote:
> Peter Dalgaard <p.dalgaard at biostat.ku.dk> writes:
>
>   
>> "Henrik Bengtsson" <hb at stat.berkeley.edu> writes:
>>
>>     
>>> This has been reported before on r-devel, e.g. May 9, 2006 "[Rd] Seg
>>> fault when installing package from bad repository".
>>>
>>> It's happening on Mac OSX when trying to download non-existing
>>> webpages (HTTP status 404). That's all I know (not using OSX myself).
>>>       
>> It is not entirely obvious that it is the same problem, but it might be.
>>
>> This happened to me on Linux (2.3.1 on FC5), but it has only happened
>> that one time. I don't think I did anything particularly strange
>> earlier in that session.
>>
>> Of course, with 20/20 hindsight, I should have taken the core dump
>> option...
>>     
>
> I'm pretty sure this is the same issue and one that has been fixed in
> R-devel.
>
>     r38716 | ripley | 2006-07-30 00:19:35 -0700 (Sun, 30 Jul 2006) | 1 line
>     Changed paths:
>        M /trunk/src/modules/internet/internet.c
>     
>     crash workaround from Seth Falcon
>
>
> Sean: can you try just download.file with a URL that gives 404?  Are
> you running an R version prior to the above commit?
>   
Seth,

As Peter pointed out, this looks like a simple server-side issue.  Here 
is the sessionInfo() from my original post.  And below is the output of 
two versions of download.file.

> sessionInfo()
R version 2.4.0 Under development (unstable) (2006-09-02 r39068) 

 > download.file('http://bioconductor.org/getBioC.R',destfile='/tmp/junk.R')
trying URL 'http://bioconductor.org/getBioC.R'
Error in download.file("http://bioconductor.org/getBioC.R", destfile = 
"/tmp/junk.R") :
        cannot open URL 'http://bioconductor.org/getBioC.R'
In addition: Warning message:
cannot open: HTTP status was '404 Not Found'
 > 
download.file('http://www.bioconductor.org/getBioC.R',destfile='/tmp/junk.R')
trying URL 'http://www.bioconductor.org/getBioC.R'
Content type 'text/plain; charset=ISO-8859-1' length 1345 bytes
opened URL
==================================================
downloaded 1345 bytes



From hb at stat.berkeley.edu  Mon Sep  4 06:14:57 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sun, 3 Sep 2006 21:14:57 -0700
Subject: [Rd] Unexpected source() behavior in R-devel
In-Reply-To: <44FC1DED.4010500@mail.nih.gov>
References: <200609031625.57963.sdavis2@mail.nih.gov>
	<x21wqsmzie.fsf@turmalin.kubism.ku.dk>
	<59d7961d0609031427v6239ac5bp16c7b2af679e996c@mail.gmail.com>
	<x2wt8klj76.fsf@turmalin.kubism.ku.dk> <m264g4cw9w.fsf@ziti.fhcrc.org>
	<44FC1DED.4010500@mail.nih.gov>
Message-ID: <59d7961d0609032114x43665bc0r8bf1a72e22541a9@mail.gmail.com>

On 9/4/06, Sean Davis <sdavis2 at mail.nih.gov> wrote:
> Seth Falcon wrote:
> > Peter Dalgaard <p.dalgaard at biostat.ku.dk> writes:
> >
> >
> >> "Henrik Bengtsson" <hb at stat.berkeley.edu> writes:
> >>
> >>
> >>> This has been reported before on r-devel, e.g. May 9, 2006 "[Rd] Seg
> >>> fault when installing package from bad repository".
> >>>
> >>> It's happening on Mac OSX when trying to download non-existing
> >>> webpages (HTTP status 404). That's all I know (not using OSX myself).
> >>>
> >> It is not entirely obvious that it is the same problem, but it might be.
> >>
> >> This happened to me on Linux (2.3.1 on FC5), but it has only happened
> >> that one time. I don't think I did anything particularly strange
> >> earlier in that session.
> >>
> >> Of course, with 20/20 hindsight, I should have taken the core dump
> >> option...
> >>
> >
> > I'm pretty sure this is the same issue and one that has been fixed in
> > R-devel.
> >
> >     r38716 | ripley | 2006-07-30 00:19:35 -0700 (Sun, 30 Jul 2006) | 1 line
> >     Changed paths:
> >        M /trunk/src/modules/internet/internet.c
> >
> >     crash workaround from Seth Falcon
> >
> >
> > Sean: can you try just download.file with a URL that gives 404?  Are
> > you running an R version prior to the above commit?
> >
> Seth,
>
> As Peter pointed out, this looks like a simple server-side issue.  Here
> is the sessionInfo() from my original post.  And below is the output of
> two versions of download.file.
>
> > sessionInfo()
> R version 2.4.0 Under development (unstable) (2006-09-02 r39068)
>
>  > download.file('http://bioconductor.org/getBioC.R',destfile='/tmp/junk.R')
> trying URL 'http://bioconductor.org/getBioC.R'
> Error in download.file("http://bioconductor.org/getBioC.R", destfile =
> "/tmp/junk.R") :
>         cannot open URL 'http://bioconductor.org/getBioC.R'
> In addition: Warning message:
> cannot open: HTTP status was '404 Not Found'
>  >
> download.file('http://www.bioconductor.org/getBioC.R',destfile='/tmp/junk.R')
> trying URL 'http://www.bioconductor.org/getBioC.R'
> Content type 'text/plain; charset=ISO-8859-1' length 1345 bytes
> opened URL
> ==================================================
> downloaded 1345 bytes
>

Yes, there's been some problems with the Bioconductor server the last
few days, e.g. http://bioconductor.org/biocLite.R is not working
either.  It was down on Monday night too and then it was not possible
to install any packages from them.  I think they are aware of this
problem, but maybe not that it is down in this very minute.  I've
cross-posted this reply to the bioc-devel to make sure the right
person gets it.

However, a HTTP 404 response should not crash R regardless.  For
instance, the code for install.packages() tries to download
PACKAGES.gz and if missing it tries to download PACKAGES.  All of a
sudden I started to receive reports for OSX users that tried to
install my packages from http://www.braju.com/R/ saying my code core
dumped their R session.  I didn't have PACKAGE.gz and it worked for
everyone but OSX users.  It sounds like they've located and solved
this problem in R-devel by the end of July.

/Henrik



From r.hankin at noc.soton.ac.uk  Mon Sep  4 10:41:46 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Mon, 4 Sep 2006 09:41:46 +0100
Subject: [Rd] setMethod("Logic", ...)
In-Reply-To: <Pine.LNX.4.64.0609011642240.16133@gannet.stats.ox.ac.uk>
References: <91AD8AFC-E5A3-4F79-821D-CACC2705333D@soc.soton.ac.uk>
	<Pine.LNX.4.64.0609011642240.16133@gannet.stats.ox.ac.uk>
Message-ID: <7F7440CD-18B2-4AB6-B0BA-6DB0B0491727@soc.soton.ac.uk>

Professor Ripley

thank you for this (and indeed thank you for solving my earlier
problem on octonions).

I still don't know how  to force logic operations on brob objects to  
give an error.


06, at 16:45, Prof Brian Ripley wrote:

> Accordng to the S4groupGeneric page, there is no such group.
>
> My guess as to why:
>
> Those operators are not S3 generic in R, and S4 dispatch is piggy- 
> backed
> on S3 dispatch (not necessarily, but for convenience).
>
>



I have been trying to use the  example on p119 of S Programming as
a template:


setClass("brob",
          representation = representation 
(x="numeric",positive="logical"),
          prototype      = list(x=numeric(),positive=logical())
          )


.logicBrob <- function(e1,e2){
   stop("No logic currently implemented for Brobdingnagian numbers")
}


setMethod("Logic",signature(e1="brob"), .logicBrob)
setMethod("Logic",signature(e2="brob"), .logicBrob)



but this does not work as desired (setMethod() gives an error).  I want,
for example,

!new("brob", x=1:10,positive=rep(T,10))

to call .logicBrob() and report an error.





--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743



From Friedrich.Leisch at stat.uni-muenchen.de  Mon Sep  4 11:46:14 2006
From: Friedrich.Leisch at stat.uni-muenchen.de (Friedrich Leisch)
Date: Mon, 4 Sep 2006 11:46:14 +0200
Subject: [Rd] R-Project logo in SVG format
In-Reply-To: <p06230902c11e06f59b75@[128.115.153.6]>
References: <Pine.LNX.4.64.0608310839160.32642@goldenaxe.gpcc.itd.umich.edu>
	<p06230902c11e06f59b75@[128.115.153.6]>
Message-ID: <17659.62950.171120.478342@celebrian.ci.tuwien.ac.at>

>>>>> On Fri, 1 Sep 2006 08:56:03 -0700,
>>>>> Don MacQueen (DM) wrote:

  > I have a file named Rlogo-5.svg, created by 
  > downloading Rlogo-5.png, opening it with Adobe 
  > Illustrator, Saving as SVG.
  > I didn't tinker with any of Illustrator's options 
  > with regard to how, exactly, to save it, since I 
  > pretty much don't know what they mean. Whether it 
  > is of any use to anyone, or whether it is truly 
  > scalable, I have no idea. All I know is that 
  > Illustrator claims it is an SVG file.

  > Took about 2 minutes, all together (writing this email took longer).

  > If any R Core member (or anyone else, for that 
  > matter), wants a copy, please let me know. I 
  > don't want to burden lots of people with a file 
  > they probably don't want.

I guess that Illustrator simply has embedded the bitmap into the SVG
file, such that scaling properties are the same. I know how to
"convert" the PNG to EPS or PDF (and it takes even less than two
minutes), but that again simply embeds the bitmap, so nothing gained.

To be sure you can send me the SVG, I'll have a look.

Best,
Fritz



From ripley at stats.ox.ac.uk  Mon Sep  4 11:49:33 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 4 Sep 2006 10:49:33 +0100 (BST)
Subject: [Rd] setMethod("Logic", ...)
In-Reply-To: <7F7440CD-18B2-4AB6-B0BA-6DB0B0491727@soc.soton.ac.uk>
References: <91AD8AFC-E5A3-4F79-821D-CACC2705333D@soc.soton.ac.uk>
	<Pine.LNX.4.64.0609011642240.16133@gannet.stats.ox.ac.uk>
	<7F7440CD-18B2-4AB6-B0BA-6DB0B0491727@soc.soton.ac.uk>
Message-ID: <Pine.LNX.4.64.0609041043490.20222@gannet.stats.ox.ac.uk>

On Mon, 4 Sep 2006, Robin Hankin wrote:

> Professor Ripley
> 
> thank you for this (and indeed thank you for solving my earlier
> problem on octonions).
> 
> I still don't know how  to force logic operations on brob objects to give an
> error.

I found this in the methods sources

    ## R does not currently do the Logic group (! & |)
    ## A strange group, since the argument lists are different.  But
    ## perhaps we'll add it sometime.

(Not sure about the comment: there are unary and binary operators in 
Arith.)

It looks to me as if you can work around this by defining S3 methods for 
the class, if that is all you want to do.

setClass("foo", representation="numeric")
x <- new("foo", pi)
> !x
[1] FALSE
> "!.foo" <- function(x) stop("not supported")
> !x
Error in "!.foo"(x) : not supported



> 06, at 16:45, Prof Brian Ripley wrote:
> 
> >Accordng to the S4groupGeneric page, there is no such group.
> >
> >My guess as to why:
> >
> >Those operators are not S3 generic in R, and S4 dispatch is piggy-backed
> >on S3 dispatch (not necessarily, but for convenience).

I was wrong here.

> I have been trying to use the  example on p119 of S Programming as
> a template:
> 
> 
> setClass("brob",
>         representation = representation(x="numeric",positive="logical"),
>         prototype      = list(x=numeric(),positive=logical())
>         )
> 
> 
> .logicBrob <- function(e1,e2){
>  stop("No logic currently implemented for Brobdingnagian numbers")
> }
> 
> 
> setMethod("Logic",signature(e1="brob"), .logicBrob)
> setMethod("Logic",signature(e2="brob"), .logicBrob)
> 
> 
> 
> but this does not work as desired (setMethod() gives an error).  I want,
> for example,
> 
> !new("brob", x=1:10,positive=rep(T,10))
> 
> to call .logicBrob() and report an error.
> 
> 
> 
> 
> 
> --
> Robin Hankin
> Uncertainty Analyst
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
> tel  023-8059-7743
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From Friedrich.Leisch at stat.uni-muenchen.de  Mon Sep  4 11:54:32 2006
From: Friedrich.Leisch at stat.uni-muenchen.de (Friedrich Leisch)
Date: Mon, 4 Sep 2006 11:54:32 +0200
Subject: [Rd] R-Project logo in SVG format
In-Reply-To: <44F7067A.6030108@lancaster.ac.uk>
References: <Pine.LNX.4.64.0608310839160.32642@goldenaxe.gpcc.itd.umich.edu>
	<61685.151.100.49.234.1157032368.squirrel@webmail.lrz-muenchen.de>
	<44F7067A.6030108@lancaster.ac.uk>
Message-ID: <17659.63448.393617.152802@celebrian.ci.tuwien.ac.at>

>>>>> On Thu, 31 Aug 2006 16:55:38 +0100,
>>>>> Barry Rowlingson (BR) wrote:

  > friedrich.leisch at stat.uni-muenchen.de wrote:
  >> After you created one and submitted it to us probably at the same place as
  >> the bitmaps. In the meantime it will have to suffice that you use all we
  >> have, and that are the bitmaps (the logo was done by a volunteer who chose
  >> to use a bitmapped graphics program). It is not like we keep the good
  >> stuff back on purpose ...

  >   It does look like it would be near-impossible to parameterise the logo 
  > efficiently into a vector format - all that shading and 3-d effect 
  > stuff. The largest PNG file there is 1450x1100 pixels which at 300 dpi 
  > gives you a 4-inch logo. Although looking at it full-size on my monitor 
  > reveals some artifacts in the 3-d shading...

  >   Do any other materials exist for making the logo? A description of the 
  > fonts used, a 3-d model R and O-shape, a layered PSD or XCF file, or a 
  > Gimp/Photoshop macro set for getting that effect? I dont believe this 
  > was painted pixel-by-pixel...

No, certainly not. But you would have to ask Stefano Iacus about
details, he contributed the files. IIRC a relative of Stefano did the
actual work.

  >   When was the last time the mailing list had a 'need a new logo' thread?

;-)

.f



From maechler at stat.math.ethz.ch  Mon Sep  4 11:57:15 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 4 Sep 2006 11:57:15 +0200
Subject: [Rd] setMethod("Logic", ...)
In-Reply-To: <7F7440CD-18B2-4AB6-B0BA-6DB0B0491727@soc.soton.ac.uk>
References: <91AD8AFC-E5A3-4F79-821D-CACC2705333D@soc.soton.ac.uk>
	<Pine.LNX.4.64.0609011642240.16133@gannet.stats.ox.ac.uk>
	<7F7440CD-18B2-4AB6-B0BA-6DB0B0491727@soc.soton.ac.uk>
Message-ID: <17659.63611.323669.893701@stat.math.ethz.ch>

>>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
>>>>>     on Mon, 4 Sep 2006 09:41:46 +0100 writes:

    Robin> Professor Ripley
    Robin> thank you for this (and indeed thank you for solving my earlier
    Robin> problem on octonions).

    Robin> I still don't know how  to force logic operations on brob objects to  
    Robin> give an error.

You "just" {as we will see below, your question is more interesting
	    than I first thought !}
define methods for all three of

           '"&"', '"|"', '"!"'

e.g.

  > setClass("brob", contains="numeric")
  [1] "brob"
  > setMethod("!", "brob", function(e1) {cat("not a brob\n"); invisible(e1)})
  [1] "!"
  > !new("brob")
  not a brob
  > 



To keep things consistent, I would use helper functions {that
I'd keep hidden in the namespace}.

## Something like

logic.brob.error <- function(name) {
    stop("logic operator '", name, "' not applicable to brobs")
}

logic2 <- function(e1,e2) {
       logic.brob.error(.Generic)
}

setMethod("!", "brob",
          function(e1) { logic.brob.error("!") })

setMethod("&", signature("brob", "ANY"),  logic2) # -- okay --
setMethod("&", signature("ANY", "brob"),  logic2) # ERR  ----> bug in R (?)
## Error in ...
## the method for function '&' and signature e1="ANY", e2="brob" is sealed and cannot be re-defined

setMethod("|", signature("brob", "ANY"),  logic2) # -- okay --
setMethod("|", signature("ANY", "brob"),  logic2) # ERR  ----> bug in R (?!)

new("brob", 3) & new("brob", 0) #-> proper error
new("brob") & 1                 #-> proper error

TRUE & new("brob", pi) # -> TRUE  -- oops!

##--------------------------------------------------------------

I think this reveals a bug in R (still present in R-devel as of
this morning):

signature("ANY", "brob")  should not be sealed for method
definition but it is.


Martin Maechler



From r.hankin at noc.soton.ac.uk  Mon Sep  4 15:47:29 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Mon, 4 Sep 2006 14:47:29 +0100
Subject: [Rd] setMethod("Summary")
Message-ID: <C7B9E5CB-E340-445D-A5B9-FC86AB6CC1DE@soc.soton.ac.uk>

Hi everyone and thanks for being patient.   I've used "!.foo"() et  
seq pro tem.

Next problem: how to define "Summary" methods for brobs.

?max says

   'max' and 'min' are generic functions: methods can be defined for
      them individually or via the 'Summary' group generic. For this to
      work properly, the arguments '...' should be unnamed.

OK, so what is the correct procedure to make sum() operate on brob  
objects?

My best effort follows.



setClass("brob",
          representation = representation 
(x="numeric",positive="logical"),
          prototype      = list(x=numeric(),positive=logical())
          )


.Brob.max <- function(...){
   stop("not yet impemented")
}


setMethod("Summary", signature("brob"),
           function(...){
             switch(.Generic,
                    max    =  .Brob.max(...),
                    stop(paste(.Generic, "not implemented yet "))
                      )
           }
)


but this gives an error from conformMethod().

[I've left the arguments to signature() unnamed because ? 
GenericFunctions
says

          A signature is
           a named or unnamed vector of character strings.  If named,
           the names must be formal argument names for the generic
           function.  If 'signature' is unnamed, the default is to use
           the first 'length(signature)' formal arguments of the
           function.

which seems to tell me (in conjunction with the advice from  
Extremes.Rd quote above)
to use unnamed arguments to signature()
]


What is the correct way to make sum(x) call .Brob.max() if x is a  
"brob" object?
Or is is it better to define a sum.brob() function and use that?



--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743



From sfalcon at fhcrc.org  Mon Sep  4 16:51:55 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Mon, 04 Sep 2006 07:51:55 -0700
Subject: [Rd] Unexpected source() behavior in R-devel
In-Reply-To: <44FC1DED.4010500@mail.nih.gov> (Sean Davis's message of "Mon,
	04 Sep 2006 08:37:01 -0400")
References: <200609031625.57963.sdavis2@mail.nih.gov>
	<x21wqsmzie.fsf@turmalin.kubism.ku.dk>
	<59d7961d0609031427v6239ac5bp16c7b2af679e996c@mail.gmail.com>
	<x2wt8klj76.fsf@turmalin.kubism.ku.dk> <m264g4cw9w.fsf@ziti.fhcrc.org>
	<44FC1DED.4010500@mail.nih.gov>
Message-ID: <m2bqpvbs6s.fsf@ziti.fhcrc.org>

Sean Davis <sdavis2 at mail.nih.gov> writes:
> Seth Falcon wrote:
>> Peter Dalgaard <p.dalgaard at biostat.ku.dk> writes:
>>
>>   
>>> "Henrik Bengtsson" <hb at stat.berkeley.edu> writes:
>>>
>>>     
>>>> This has been reported before on r-devel, e.g. May 9, 2006 "[Rd] Seg
>>>> fault when installing package from bad repository".
>>>>
>>>> It's happening on Mac OSX when trying to download non-existing
>>>> webpages (HTTP status 404). That's all I know (not using OSX myself).
>>>>       
>>> It is not entirely obvious that it is the same problem, but it might be.
>>>
>>> This happened to me on Linux (2.3.1 on FC5), but it has only happened
>>> that one time. I don't think I did anything particularly strange
>>> earlier in that session.
>>>
>>> Of course, with 20/20 hindsight, I should have taken the core dump
>>> option...
>>>     
>>
>> I'm pretty sure this is the same issue and one that has been fixed in
>> R-devel.
>>
>>     r38716 | ripley | 2006-07-30 00:19:35 -0700 (Sun, 30 Jul 2006) | 1 line
>>     Changed paths:
>>        M /trunk/src/modules/internet/internet.c
>>         crash workaround from Seth Falcon
>>
>>
>> Sean: can you try just download.file with a URL that gives 404?  Are
>> you running an R version prior to the above commit?
>>   
> Seth,
>
> As Peter pointed out, this looks like a simple server-side issue.
> Here is the sessionInfo() from my original post.  And below is the
> output of two versions of download.file.

Yes, there is an issue with the BioC website (investigating) and I
didn't mean to imply otherwise.  For now, as you discovered, use
http://www.bioconductor.org (note the 'www').

I only responded here because of the segfault you reported which most
certainly is not a simple server-side issue :-)

Did you see the segfault with a recent R or an older one?  If more
recent, then it might be worth trying to reproduce and tracking down
the bug.



From sdavis2 at mail.nih.gov  Tue Sep  5 05:05:42 2006
From: sdavis2 at mail.nih.gov (Sean Davis)
Date: Mon, 04 Sep 2006 23:05:42 -0400
Subject: [Rd] Unexpected source() behavior in R-devel
In-Reply-To: <m2bqpvbs6s.fsf@ziti.fhcrc.org>
References: <200609031625.57963.sdavis2@mail.nih.gov>	<x21wqsmzie.fsf@turmalin.kubism.ku.dk>	<59d7961d0609031427v6239ac5bp16c7b2af679e996c@mail.gmail.com>	<x2wt8klj76.fsf@turmalin.kubism.ku.dk>
	<m264g4cw9w.fsf@ziti.fhcrc.org>	<44FC1DED.4010500@mail.nih.gov>
	<m2bqpvbs6s.fsf@ziti.fhcrc.org>
Message-ID: <44FCE986.8000004@mail.nih.gov>

Seth Falcon wrote:
> Sean Davis <sdavis2 at mail.nih.gov> writes:
>   
>> Seth Falcon wrote:
>>     
>>> Peter Dalgaard <p.dalgaard at biostat.ku.dk> writes:
>>>
>>>   
>>>       
>>>> "Henrik Bengtsson" <hb at stat.berkeley.edu> writes:
>>>>
>>>>     
>>>>         
>>>>> This has been reported before on r-devel, e.g. May 9, 2006 "[Rd] Seg
>>>>> fault when installing package from bad repository".
>>>>>
>>>>> It's happening on Mac OSX when trying to download non-existing
>>>>> webpages (HTTP status 404). That's all I know (not using OSX myself).
>>>>>       
>>>>>           
>>>> It is not entirely obvious that it is the same problem, but it might be.
>>>>
>>>> This happened to me on Linux (2.3.1 on FC5), but it has only happened
>>>> that one time. I don't think I did anything particularly strange
>>>> earlier in that session.
>>>>
>>>> Of course, with 20/20 hindsight, I should have taken the core dump
>>>> option...
>>>>     
>>>>         
>>> I'm pretty sure this is the same issue and one that has been fixed in
>>> R-devel.
>>>
>>>     r38716 | ripley | 2006-07-30 00:19:35 -0700 (Sun, 30 Jul 2006) | 1 line
>>>     Changed paths:
>>>        M /trunk/src/modules/internet/internet.c
>>>         crash workaround from Seth Falcon
>>>
>>>
>>> Sean: can you try just download.file with a URL that gives 404?  Are
>>> you running an R version prior to the above commit?
>>>   
>>>       
>> Seth,
>>
>> As Peter pointed out, this looks like a simple server-side issue.
>> Here is the sessionInfo() from my original post.  And below is the
>> output of two versions of download.file.
>>     
>
> Yes, there is an issue with the BioC website (investigating) and I
> didn't mean to imply otherwise.  For now, as you discovered, use
> http://www.bioconductor.org (note the 'www').
>
> I only responded here because of the segfault you reported which most
> certainly is not a simple server-side issue :-)
>
> Did you see the segfault with a recent R or an older one?  If more
> recent, then it might be worth trying to reproduce and tracking down
> the bug.
>   
Seth,

Peter was the person who reported the segmentation fault, not I.  I
didn't experience that behavior.  And it sounds like Peter wasn't able
to reproduce it, so I'm not sure there is any bug here to be fixed.

Sean



From p.dalgaard at biostat.ku.dk  Mon Sep  4 17:11:49 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 04 Sep 2006 17:11:49 +0200
Subject: [Rd] Unexpected source() behavior in R-devel
In-Reply-To: <44FCE986.8000004@mail.nih.gov>
References: <200609031625.57963.sdavis2@mail.nih.gov>
	<x21wqsmzie.fsf@turmalin.kubism.ku.dk>
	<59d7961d0609031427v6239ac5bp16c7b2af679e996c@mail.gmail.com>
	<x2wt8klj76.fsf@turmalin.kubism.ku.dk> <m264g4cw9w.fsf@ziti.fhcrc.org>
	<44FC1DED.4010500@mail.nih.gov> <m2bqpvbs6s.fsf@ziti.fhcrc.org>
	<44FCE986.8000004@mail.nih.gov>
Message-ID: <x2hcznekei.fsf@viggo.kubism.ku.dk>

Sean Davis <sdavis2 at mail.nih.gov> writes:

> >
> > Did you see the segfault with a recent R or an older one?  If more
> > recent, then it might be worth trying to reproduce and tracking down
> > the bug.
> >
> Seth,
> 
> Peter was the person who reported the segmentation fault, not I.  I
> didn't experience that behavior.  And it sounds like Peter wasn't able
> to reproduce it, so I'm not sure there is any bug here to be fixed.
> 
> Sean

It was with 2.3.1, but there have been some indications that it was
likely fixed since, and I couldn't even reproduce it in 2.3.1. So
there might and might not be a bug, but in any case we have no handle
on it...

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From stranak at ufal.ms.mff.cuni.cz  Mon Sep  4 17:25:02 2006
From: stranak at ufal.ms.mff.cuni.cz (stranak at ufal.ms.mff.cuni.cz)
Date: Mon,  4 Sep 2006 17:25:02 +0200 (CEST)
Subject: [Rd] Unable to save a plot containing Chinese (two-byte) Characters
	(PR#9201)
Message-ID: <20060904152502.CFA534C9DC@slim.kubism.ku.dk>

Full_Name: Pavel Stranak
Version: 2.3.1
OS: Mac OS X
Submission from: (NULL) (195.113.20.81)


Whenever I draw a plot containing Chinese character, it draws fine on screen,
but never saves to a file.
It does not matter, whether I first draw it on screen and than save or draw
straight to pdf.
It is also all the same, whether the characters are in label or in the plot
itself (via "pch=..." or text()).
The Error is always: "conversion failure in 'mbcsToSbcs' "

This is an example:

plot(1:20, 1:20, main="&#27721;&#35821; Derivational Characters' Productivity")
# it draws well, I attempt to 'Save As...' in GUI

Error in dev.copy(device = pdf, file = "/Users/pavel/Desktop/hanyu.pdf",  : 
	conversion failure in 'mbcsToSbcs'



From p.dalgaard at biostat.ku.dk  Mon Sep  4 18:22:33 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 04 Sep 2006 18:22:33 +0200
Subject: [Rd] Start of release process for R 2.4.0
Message-ID: <x24pvneh4m.fsf@viggo.kubism.ku.dk>


R 2.4.0 has been scheduled for October 3.

The first alpha tarballs of R 2.4.0 will be made available through 

  http://cran.r-project.org/src/base-prerelease/

starting tomorrow morning.

The release schedule is available on 

  http://developer.r-project.org 

As usual, bug reports are more useful before release than after, so
please do what you can to check things out. This goes especially for
those of you with uncommon platforms.


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From sfalcon at fhcrc.org  Mon Sep  4 20:33:47 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Mon, 04 Sep 2006 11:33:47 -0700
Subject: [Rd] Unexpected source() behavior in R-devel
In-Reply-To: <59d7961d0609032114x43665bc0r8bf1a72e22541a9@mail.gmail.com>
	(Henrik Bengtsson's message of "Sun, 3 Sep 2006 21:14:57 -0700")
References: <200609031625.57963.sdavis2@mail.nih.gov>
	<x21wqsmzie.fsf@turmalin.kubism.ku.dk>
	<59d7961d0609031427v6239ac5bp16c7b2af679e996c@mail.gmail.com>
	<x2wt8klj76.fsf@turmalin.kubism.ku.dk> <m264g4cw9w.fsf@ziti.fhcrc.org>
	<44FC1DED.4010500@mail.nih.gov>
	<59d7961d0609032114x43665bc0r8bf1a72e22541a9@mail.gmail.com>
Message-ID: <m2d5ab8os4.fsf@ziti.fhcrc.org>

"Henrik Bengtsson" <hb at stat.berkeley.edu> writes:
> Yes, there's been some problems with the Bioconductor server the last
> few days, e.g. http://bioconductor.org/biocLite.R is not working
> either.  It was down on Monday night too and then it was not possible
> to install any packages from them.  I think they are aware of this
> problem, but maybe not that it is down in this very minute.  I've
> cross-posted this reply to the bioc-devel to make sure the right
> person gets it.

The website issue should be fixed.  bioconductor.org and
www.bioconductor.org should be serving the same content.  Please let
us know of any difficulties you encounter.

Bw,

+ seth



From fparlamis at mac.com  Mon Sep  4 20:58:36 2006
From: fparlamis at mac.com (Parlamis Franklin)
Date: Mon, 4 Sep 2006 08:58:36 -1000
Subject: [Rd] setMethod("Summary")
In-Reply-To: <C7B9E5CB-E340-445D-A5B9-FC86AB6CC1DE@soc.soton.ac.uk>
References: <C7B9E5CB-E340-445D-A5B9-FC86AB6CC1DE@soc.soton.ac.uk>
Message-ID: <C4E5D78B-28AB-4A25-8112-3668F31444E4@mac.com>

i believe, if the function you are trying to work with has "..." as  
the first formal argument (as do most if not all of the "Summary"  
group functions), you will need to redefine the generic in order to  
provide a "real" S4 argument on which to dispatch.

the following works for me (IIRC it was martin who initially pointed  
me in this direction, so any thanks are his).

setGeneric("max", function(x, ..., na.rm = FALSE)
	{
		standardGeneric("max")
	},
	useAsDefault = function(x, ..., na.rm = FALSE)
	{
		base::max(x, ..., na.rm = na.rm)
	},
	group = "Summary")

i don't have bleeding edge devel version installed, so i am not sure  
whether recent changes to S4 have mooted the above.

(also, i thought i sent this last week, but i may have neglected to  
make it plain text, so maybe you didn't get it)

franklin parlamis

On Sep 4, 2006, at 3:47 AM, Robin Hankin wrote:

> Hi everyone and thanks for being patient.   I've used "!.foo"() et
> seq pro tem.
>
> Next problem: how to define "Summary" methods for brobs.
>
> ?max says
>
>    'max' and 'min' are generic functions: methods can be defined for
>       them individually or via the 'Summary' group generic. For  
> this to
>       work properly, the arguments '...' should be unnamed.
>
> OK, so what is the correct procedure to make sum() operate on brob
> objects?
>
> My best effort follows.
>
>
>
> setClass("brob",
>           representation = representation
> (x="numeric",positive="logical"),
>           prototype      = list(x=numeric(),positive=logical())
>           )
>
>
> .Brob.max <- function(...){
>    stop("not yet impemented")
> }
>
>
> setMethod("Summary", signature("brob"),
>            function(...){
>              switch(.Generic,
>                     max    =  .Brob.max(...),
>                     stop(paste(.Generic, "not implemented yet "))
>                       )
>            }
> )
>
>
> but this gives an error from conformMethod().
>
> [I've left the arguments to signature() unnamed because ?
> GenericFunctions
> says
>
>           A signature is
>            a named or unnamed vector of character strings.  If named,
>            the names must be formal argument names for the generic
>            function.  If 'signature' is unnamed, the default is to use
>            the first 'length(signature)' formal arguments of the
>            function.
>
> which seems to tell me (in conjunction with the advice from
> Extremes.Rd quote above)
> to use unnamed arguments to signature()
> ]
>
>
> What is the correct way to make sum(x) call .Brob.max() if x is a
> "brob" object?
> Or is is it better to define a sum.brob() function and use that?
>
>
>
> --
> Robin Hankin
> Uncertainty Analyst
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>   tel  023-8059-7743
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



From ripley at stats.ox.ac.uk  Mon Sep  4 21:16:34 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 4 Sep 2006 20:16:34 +0100 (BST)
Subject: [Rd] (PR#9201) Unable to save a plot containing Chinese
 (two-byte) Characters
In-Reply-To: <20060904152502.CFA534C9DC@slim.kubism.ku.dk>
References: <20060904152502.CFA534C9DC@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0609041634460.26104@gannet.stats.ox.ac.uk>

Please can we have a full reproducible example, including the locales 
used, and exactly how you 'saved' the plot?  (As we do ask.)

If Chinese characters are 'two-byte', then this likely will not work (but 
at least European locales on MacOS X are UTF-8, so I expected Chinese ones 
to be also).

The issues are discussed in an article in the May 2006 R-News.  You do 
need to set up a suitable family to support Chinese, and the error message 
suggests that you have failed to do so: if so this is not a bug in R.

On Mon, 4 Sep 2006, stranak at ufal.ms.mff.cuni.cz wrote:

> Full_Name: Pavel Stranak
> Version: 2.3.1
> OS: Mac OS X
> Submission from: (NULL) (195.113.20.81)
> 
> 
> Whenever I draw a plot containing Chinese character, it draws fine on screen,
> but never saves to a file.
> It does not matter, whether I first draw it on screen and than save or draw
> straight to pdf.
> It is also all the same, whether the characters are in label or in the plot
> itself (via "pch=..." or text()).
> The Error is always: "conversion failure in 'mbcsToSbcs' "
> 
> This is an example:
> 
> plot(1:20, 1:20, main="&#27721;&#35821; Derivational Characters' Productivity")
> # it draws well, I attempt to 'Save As...' in GUI
> 
> Error in dev.copy(device = pdf, file = "/Users/pavel/Desktop/hanyu.pdf",  : 
> 	conversion failure in 'mbcsToSbcs'
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From ripley at stats.ox.ac.uk  Mon Sep  4 22:26:56 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon,  4 Sep 2006 22:26:56 +0200 (CEST)
Subject: [Rd] (PR#9201) Unable to save a plot containing Chinese
	(two-byte)
Message-ID: <20060904202656.BE8B344FC4@slim.kubism.ku.dk>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--27464147-689190176-1157401193=:15799
Content-Type: TEXT/PLAIN; CHARSET=ISO-8859-1
Content-Transfer-Encoding: 8BIT
Content-ID: <Pine.LNX.4.64.0609042121261.15799 at gannet.stats.ox.ac.uk>

On Mon, 4 Sep 2006, Pavel Stranak wrote:

> On 4.9.2006, at 21:16, Prof Brian Ripley wrote:
> 
> >Please can we have a full reproducible example, including the locales
> >used, and exactly how you 'saved' the plot?  (As we do ask.)

You have _still_ not told us what we asked, including the locales!

> I have used GUI command "File->Save As .." Im Mac GUI.

That may well not work, but reports on the Mac GUI are inappropriate for 
R-bugs.

> It works perfectly with the same plots, when I don't use Chinese.
> It also works fine, when I use Czech accented characters. At least some of
> them are also two-byte in UTF-8.

Yes, but Chinese chars are not.

> But the problem also occures when I direct pdf device right into the file:
> > pdf(file="Rplot.pdf")

Incorrect usage.

> > plot(1:20, 1:20, main="P??li? ?lu?ou?k? k?? ?p?l ??belsk? ?dy.")
> # Czech accents work fine
> > plot(1:20, 1:20, main="?P??li? ?lu?ou?k? k?? ?p?l ??belsk? ?dy.")
> Error in title(...) : conversion failure in 'mbcsToSbcs'
> # One Chinese character => Error
> 
> >
> >If Chinese characters are 'two-byte', then this likely will not work (but
> >at least European locales on MacOS X are UTF-8, so I expected Chinese ones
> >to be also).

> As far as I know, UTF-8 contains at least 1byte and 2byte characters.

and 3 byte and 4 byte chars, and potentially up to 6.

> All the chinese characters are represented by two bytes in UTF-8.

Please give your reference!  They are in the Unicode ranges from 2F00, and 
characters above 07Ff need 3 or more bytes in UTF-8.

http://www.cl.cam.ac.uk/~mgk25/unicode.html


> The characters I have used (but that fail to display in your bug-tracking
> system)
> are two characters "Chinese language".
> 
> My locales are set to UTF-8.

That is *not* a locale but a character encoding.

> I have not set any fonts in R because all the Chinese characters display fine
> both in the console and the plot.

But not in pdf, as you said.  You really have failed to read the 
references, including the help page and tutorial I very kindly pointed you 
to.

In case it has still not got through to you: PDF is not written in UTF-8 
and most fonts do not include Chinese ideographs, including Helvetica, the 
default font for PDF.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595
--27464147-689190176-1157401193=:15799--



From pinard at iro.umontreal.ca  Tue Sep  5 01:53:59 2006
From: pinard at iro.umontreal.ca (=?iso-8859-1?Q?Fran=E7ois?= Pinard)
Date: Mon, 4 Sep 2006 19:53:59 -0400
Subject: [Rd] make test-Specific?
In-Reply-To: <44F62019.7030907@bfro.uni-lj.si>
References: <44F62019.7030907@bfro.uni-lj.si>
Message-ID: <20060904235359.GA28805@alcyon.progiciels-bpi.ca>

[Gregor Gorjanc]

>In Writing R Extensions manual, section "Testing R code"[1] says:
>"be careful to check if make test-Specific or particularly, cd tests;
>make no-segfault.Rout"

>Actually, make test-Specific also needs "cd tests;" in front.

>[1]http://cran.r-project.org/doc/manuals/R-exts.html#Testing-R-code

Allow me a quick comment about using "cd" in Makefiles, reading by.

Whenever possible, prefer "cd DIR && ACTION" to "cd DIR; ACTION".  This 
protects you from ACTION when it has some destructive effect, and DIR 
either happens to not exist or is just mistyped, in which case ACTION is 
executed in the current directory.

A little good habit that saved me a few times along all those years! :-)

-- 
Fran?ois Pinard   http://pinard.progiciels-bpi.ca



From amaliy1 at uic.edu  Tue Sep  5 03:40:02 2006
From: amaliy1 at uic.edu (amaliy1 at uic.edu)
Date: Tue,  5 Sep 2006 03:40:02 +0200 (CEST)
Subject: [Rd] Bugs with partial name matching during partial replacement
	(PR#9202)
Message-ID: <20060905014002.634C928F8E@slim.kubism.ku.dk>

Hello,

First the version info:
platform       powerpc-apple-darwin8.6.0
arch           powerpc
os             darwin8.6.0
system         powerpc, darwin8.6.0
status
major          2
minor          3.1
year           2006
month          06
day            01
svn rev        38247
language       R
version.string Version 2.3.1 (2006-06-01)

I have encountered some unusual behavior when trying to create new  
columns in a data frame that have names that would generate a partial  
match with an existing column with a longer name.  It is my  
understanding that replacement operations shouldn't have partial  
matching, but it is not clear to me whether this applies only when  
the named column exists and not for new assignments.

The first example:

 > D = data.frame(M=c(T,T,F,F,F,T,F,T,F,F,T,T,T),V=I(sprintf("ZZ%02d", 
1:13)),ABCD=13:1)
 > D
        M    V ABCD
1   TRUE ZZ01   13
2   TRUE ZZ02   12
3  FALSE ZZ03   11
4  FALSE ZZ04   10
5  FALSE ZZ05    9
6   TRUE ZZ06    8
7  FALSE ZZ07    7
8   TRUE ZZ08    6
9  FALSE ZZ09    5
10 FALSE ZZ10    4
11  TRUE ZZ11    3
12  TRUE ZZ12    2
13  TRUE ZZ13    1
 > D$CBA[D$M] = D$V[D$M]
 > D
        M    V ABCD  CBA
1   TRUE ZZ01   13 ZZ01
2   TRUE ZZ02   12 ZZ02
3  FALSE ZZ03   11 <NA>
4  FALSE ZZ04   10 <NA>
5  FALSE ZZ05    9 <NA>
6   TRUE ZZ06    8 ZZ06
7  FALSE ZZ07    7 <NA>
8   TRUE ZZ08    6 ZZ08
9  FALSE ZZ09    5 <NA>
10 FALSE ZZ10    4 <NA>
11  TRUE ZZ11    3 ZZ11
12  TRUE ZZ12    2 ZZ12
13  TRUE ZZ13    1 ZZ13
 > D$ABC[D$M] = D$V[D$M]
 > D
        M    V ABCD  CBA  ABC
1   TRUE ZZ01   13 ZZ01 ZZ01
2   TRUE ZZ02   12 ZZ02 ZZ02
3  FALSE ZZ03   11 <NA>   11
4  FALSE ZZ04   10 <NA>   10
5  FALSE ZZ05    9 <NA>    9
6   TRUE ZZ06    8 ZZ06 ZZ06
7  FALSE ZZ07    7 <NA>    7
8   TRUE ZZ08    6 ZZ08 ZZ08
9  FALSE ZZ09    5 <NA>    5
10 FALSE ZZ10    4 <NA>    4
11  TRUE ZZ11    3 ZZ11 ZZ11
12  TRUE ZZ12    2 ZZ12 ZZ12
13  TRUE ZZ13    1 ZZ13 ZZ13

I expected ABC to equal CBA with NA values in rows not assigned, but  
instead it appears that an extraction from D$ABCD and coercion to  
string is being performed in the process of creating D$ABC.

Here is something I believe is definitely a bug:

 > D = data.frame(M=c(T,T,F,F,F,T,F,T,F,F,T,T,T),V=1:13,ABCD=13:1)
 > D
        M  V ABCD
1   TRUE  1   13
2   TRUE  2   12
3  FALSE  3   11
4  FALSE  4   10
5  FALSE  5    9
6   TRUE  6    8
7  FALSE  7    7
8   TRUE  8    6
9  FALSE  9    5
10 FALSE 10    4
11  TRUE 11    3
12  TRUE 12    2
13  TRUE 13    1
 > D$CBA[D$M] = D$V[D$M]
 > D
        M  V ABCD CBA
1   TRUE  1   13   1
2   TRUE  2   12   2
3  FALSE  3   11  NA
4  FALSE  4   10  NA
5  FALSE  5    9  NA
6   TRUE  6    8   6
7  FALSE  7    7  NA
8   TRUE  8    6   8
9  FALSE  9    5  NA
10 FALSE 10    4  NA
11  TRUE 11    3  11
12  TRUE 12    2  12
13  TRUE 13    1  13
 > D$ABC[D$M] = D$V[D$M]
 > D
        M  V ABCD CBA ABC
1   TRUE  1    1   1   1
2   TRUE  2    2   2   2
3  FALSE  3   11  NA  11
4  FALSE  4   10  NA  10
5  FALSE  5    9  NA   9
6   TRUE  6    6   6   6
7  FALSE  7    7  NA   7
8   TRUE  8    8   8   8
9  FALSE  9    5  NA   5
10 FALSE 10    4  NA   4
11  TRUE 11   11  11  11
12  TRUE 12   12  12  12
13  TRUE 13   13  13  13

ABC is created as before with valued from ABCD in the unassigned  
rows, but ABCD is being modified as well.  The only difference form  
the previous example is that V is now just a numeric column.

Anil Maliyekkel



From rmh at temple.edu  Tue Sep  5 05:13:39 2006
From: rmh at temple.edu (Richard M. Heiberger)
Date: Mon,  4 Sep 2006 23:13:39 -0400 (EDT)
Subject: [Rd] Two submitted packages
Message-ID: <20060904231339.BHG87597@po-d.temple.edu>

## This example runs in R 2.3.1 and does not run in R 2.4.1.  I am
## raising it here for two questions: one on how to debug functions
## inside a namespace, the other on how to control clipping.

tmp <- data.frame(x=1:5, y=1:5, a=factor(c(1,1,1,1,1), levels=1:4))
xyplot(y ~ x,
       data=tmp, ylim=c(1.5,4.5),
       panel=function(x,y, ...) {
         cpv <- current.viewport()
         cpv$clip <- "off"
         pushViewport(cpv)
         panel.xyplot(x, y, ...)
         popViewport()
       })

## R version 2.4.0 Under development (unstable) (2006-08-14 r38872)
## gives the error message
Error in grid.Call.graphics("L_setviewport", pvp, TRUE) : 
        LOGICAL() can only be applied to a 'logical', not a 'character'
>

## Question 1.  How do I place a trace() on grid.Call.graphics to make
## it stop and give me a traceback.  I tried many variations of the
## command
##    trace(grid:::grid.Call.graphics, exit=recover,
##          where=environment(grid:::grid.Call.graphics))
## None of them trapped the error and let me trace it.  What is the
## correct incantation?



## Question 2.  How do I control clipping from within a panel
## function?  In 2.3.1, both of the following statements run without
## error.  Neither of them turns clipping off.
##
## In 2.4.0, the "off" statement gives the error message above.  The
## FALSE statement runs without error, but it didn't turn clipping off.

xyplot(y ~ x | a,
       data=tmp, ylim=c(1.5,4.5),
       panel=function(x,y, ...) {
         cpv <- current.viewport()
         cpv$clip <- "off"
         pushViewport(cpv)
         panel.xyplot(x, y, ...)
         popViewport()
       },
       layout=c(2,2))

xyplot(y ~ x | a,
       data=tmp, ylim=c(1.5,4.5),
       panel=function(x,y, ...) {
         cpv <- current.viewport()
         cpv$clip <- FALSE
         pushViewport(cpv)
         panel.xyplot(x, y, ...)
         popViewport()
       },
       layout=c(2,2))


## ?viewport in 2.4.0 says
## clip
##
## One of "on", "inherit", or "off", indicating whether to clip to the
## extent of this viewport, inherit the clipping region from the
## parent viewport, or turn clipping off altogether. For
## back-compatibility, a logical value of TRUE corresponds to "on" and
## FALSE corresponds to "inherit".

## Notice that "off" is current and FALSE is back-compatible, and
## "off" is the value that causes the error.

## What is the correct way to turn off clipping?
## The way that I would like to use is something on the order of

xyplot(y ~ x | a,
       data=tmp, ylim=c(1.5,4.5),
       panel=function(x,y, ...) {
         panel.xyplot(x, y, ...,
                      par.settings = list(clip = list(panel = "off")))
       },
       layout=c(2,2))

## I believe par.settings is currently valid only in xyplot() and not
## valid in panel functions.  Is my understanding correct?  Can the
## behavior be changed?
##
## The following statement works correctly in both 2.3.1 and 2.4.0.
## This statement controls clipping for the entire xyplot, not just
## for the single statement within the panel function.

xyplot(y ~ x | a,
       data=tmp, ylim=c(1.5,4.5),
       par.settings = list(clip = list(panel = "off")),
       layout=c(2,2))



From r.hankin at noc.soton.ac.uk  Tue Sep  5 09:58:23 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Tue, 5 Sep 2006 08:58:23 +0100
Subject: [Rd] setMethod("Summary")
In-Reply-To: <C4E5D78B-28AB-4A25-8112-3668F31444E4@mac.com>
References: <C7B9E5CB-E340-445D-A5B9-FC86AB6CC1DE@soc.soton.ac.uk>
	<C4E5D78B-28AB-4A25-8112-3668F31444E4@mac.com>
Message-ID: <E28E6E71-5DD8-4B38-81C9-BB6014F6C16E@soc.soton.ac.uk>

Dear Franklin


thank you for this.


Your suggestion works.  But now I'm confused because I'm not sure how  
the
setGeneric() call actually helps.

If I source:

setClass("brob",
          representation = representation 
(x="numeric",positive="logical"),
          prototype      = list(x=numeric(),positive=logical())
          )


max.brob <- function(..., na.rm=FALSE){stop("not YET implemented")}


---ie no call to setGeneric()--- then in an R session I can do the  
following:


R> x <- new("brob",x=6,positive=T)
R> max(x)
Error in max.brob(..., na.rm = na.rm) : not YET implemented


So max(x) calls max.brob() as intended.  Why would a call to  
setGeneric()
be desirable here?  What do I gain from it?


thanks again


Robin




On 4 Sep 2006, at 19:58, Parlamis Franklin wrote:

> i believe, if the function you are trying to work with has "..." as
> the first formal argument (as do most if not all of the "Summary"
> group functions), you will need to redefine the generic in order to
> provide a "real" S4 argument on which to dispatch.
>
> the following works for me (IIRC it was martin who initially pointed
> me in this direction, so any thanks are his).
>
> setGeneric("max", function(x, ..., na.rm = FALSE)
> 	{
> 		standardGeneric("max")
> 	},
> 	useAsDefault = function(x, ..., na.rm = FALSE)
> 	{
> 		base::max(x, ..., na.rm = na.rm)
> 	},
> 	group = "Summary")
>
> i don't have bleeding edge devel version installed, so i am not sure
> whether recent changes to S4 have mooted the above.
>
> (also, i thought i sent this last week, but i may have neglected to
> make it plain text, so maybe you didn't get it)
>
> franklin parlamis
>
> On Sep 4, 2006, at 3:47 AM, Robin Hankin wrote:
>
>> Hi everyone and thanks for being patient.   I've used "!.foo"() et
>> seq pro tem.
>>
>> Next problem: how to define "Summary" methods for brobs.
>>
>> ?max says
>>
>>    'max' and 'min' are generic functions: methods can be defined for
>>       them individually or via the 'Summary' group generic. For
>> this to
>>       work properly, the arguments '...' should be unnamed.
>>
>> OK, so what is the correct procedure to make sum() operate on brob
>> objects?
>>
>> My best effort follows.
>>
[snipped]


--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743



From maechler at stat.math.ethz.ch  Tue Sep  5 10:35:12 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 5 Sep 2006 10:35:12 +0200
Subject: [Rd] setMethod("Summary")
In-Reply-To: <E28E6E71-5DD8-4B38-81C9-BB6014F6C16E@soc.soton.ac.uk>
References: <C7B9E5CB-E340-445D-A5B9-FC86AB6CC1DE@soc.soton.ac.uk>
	<C4E5D78B-28AB-4A25-8112-3668F31444E4@mac.com>
	<E28E6E71-5DD8-4B38-81C9-BB6014F6C16E@soc.soton.ac.uk>
Message-ID: <17661.14016.528539.481357@stat.math.ethz.ch>

>>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
>>>>>     on Tue, 5 Sep 2006 08:58:23 +0100 writes:

    Robin> Dear Franklin
    Robin> thank you for this.

yes, and he *did* send it already last week.

    Robin> Your suggestion works.

and continues to do so in R-devel aka "R-2.4.0 alpha" (as of today?)

    Robin> But now I'm confused because I'm not sure how  
    Robin> the
    Robin> setGeneric() call actually helps.

Robin, I think you got confused because you are mixing S3 and S4
("max.brob" is S3).

You should (typically) not define S3 methods for S4 classes,
and you should definitely not do it in this case where Franklin 
has shown the correct S4 way.
(and for my taste you should also not do it for the "Logic" case
 in that other thread last week: It does not bring you anything and is
 ugly for me, from the point of view of S4.)

BTW: As Franklin mentioned last time, he has most probably
learned the example from the example in the 'Matrix' package.
Since we develop the Matrix package using a world-readable
subversion archive, you can always have a look there.
The  "Summary" [ "max" etc ] generic definitions are in
   https://svn.R-project.org/R-packages/trunk/Matrix/R/AllGeneric.R
BTW, the above file contains
>> ## "Summary" --- this needs some hoop jumping that may become unnecessary
>> ##               in a future version of R (>= 2.3.x):

where the hope there has not yet been fulfilled ...

Martin Maechler, ETH Zurich


    Robin> If I source:

    Robin> setClass("brob",
    Robin> representation = representation 
    Robin> (x="numeric",positive="logical"),
    Robin> prototype      = list(x=numeric(),positive=logical())
    Robin> )


    Robin> max.brob <- function(..., na.rm=FALSE){stop("not YET implemented")}


    Robin> ---ie no call to setGeneric()--- then in an R session I can do the  
    Robin> following:


    R> x <- new("brob",x=6,positive=T)
    R> max(x)
    Robin> Error in max.brob(..., na.rm = na.rm) : not YET implemented


    Robin> So max(x) calls max.brob() as intended.  Why would a call to  
    Robin> setGeneric()
    Robin> be desirable here?  What do I gain from it?


    Robin> thanks again


    Robin> Robin




    Robin> On 4 Sep 2006, at 19:58, Parlamis Franklin wrote:

    >> i believe, if the function you are trying to work with has "..." as
    >> the first formal argument (as do most if not all of the "Summary"
    >> group functions), you will need to redefine the generic in order to
    >> provide a "real" S4 argument on which to dispatch.
    >> 
    >> the following works for me (IIRC it was martin who initially pointed
    >> me in this direction, so any thanks are his).
    >> 
    >> setGeneric("max", function(x, ..., na.rm = FALSE)
    >> {
    >> standardGeneric("max")
    >> },
    >> useAsDefault = function(x, ..., na.rm = FALSE)
    >> {
    >> base::max(x, ..., na.rm = na.rm)
    >> },
    >> group = "Summary")
    >> 
    >> i don't have bleeding edge devel version installed, so i am not sure
    >> whether recent changes to S4 have mooted the above.
    >> 
    >> (also, i thought i sent this last week, but i may have neglected to
    >> make it plain text, so maybe you didn't get it)
    >> 
    >> franklin parlamis
    >> 
    >> On Sep 4, 2006, at 3:47 AM, Robin Hankin wrote:
    >> 
    >>> Hi everyone and thanks for being patient.   I've used "!.foo"() et
    >>> seq pro tem.
    >>> 
    >>> Next problem: how to define "Summary" methods for brobs.
    >>> 
    >>> ?max says
    >>> 
    >>> 'max' and 'min' are generic functions: methods can be defined for
    >>> them individually or via the 'Summary' group generic. For
    >>> this to
    >>> work properly, the arguments '...' should be unnamed.
    >>> 
    >>> OK, so what is the correct procedure to make sum() operate on brob
    >>> objects?
    >>> 
    >>> My best effort follows.
    >>> 
    Robin> [snipped]


    Robin> --
    Robin> Robin Hankin
    Robin> Uncertainty Analyst
    Robin> National Oceanography Centre, Southampton
    Robin> European Way, Southampton SO14 3ZH, UK
    Robin> tel  023-8059-7743

    Robin> ______________________________________________
    Robin> R-devel at r-project.org mailing list
    Robin> https://stat.ethz.ch/mailman/listinfo/r-devel



From ripley at stats.ox.ac.uk  Tue Sep  5 11:21:42 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 5 Sep 2006 10:21:42 +0100 (BST)
Subject: [Rd] setMethod("Summary")
In-Reply-To: <17661.14016.528539.481357@stat.math.ethz.ch>
References: <C7B9E5CB-E340-445D-A5B9-FC86AB6CC1DE@soc.soton.ac.uk>
	<C4E5D78B-28AB-4A25-8112-3668F31444E4@mac.com>
	<E28E6E71-5DD8-4B38-81C9-BB6014F6C16E@soc.soton.ac.uk>
	<17661.14016.528539.481357@stat.math.ethz.ch>
Message-ID: <Pine.LNX.4.64.0609050958480.13577@gannet.stats.ox.ac.uk>

On Tue, 5 Sep 2006, Martin Maechler wrote:

> >>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
> >>>>>     on Tue, 5 Sep 2006 08:58:23 +0100 writes:
> 
>     Robin> Dear Franklin
>     Robin> thank you for this.
> 
> yes, and he *did* send it already last week.
> 
>     Robin> Your suggestion works.
> 
> and continues to do so in R-devel aka "R-2.4.0 alpha" (as of today?)
> 
>     Robin> But now I'm confused because I'm not sure how  
>     Robin> the
>     Robin> setGeneric() call actually helps.
> 
> Robin, I think you got confused because you are mixing S3 and S4
> ("max.brob" is S3).
> 
> You should (typically) not define S3 methods for S4 classes,
> and you should definitely not do it in this case where Franklin 
> has shown the correct S4 way.
> (and for my taste you should also not do it for the "Logic" case
>  in that other thread last week: It does not bring you anything and is
>  ugly for me, from the point of view of S4.)

But it *does* bring you something, efficiency.  If all you want to do is 
to stop the default method dispatching, using an S3 method can be lot more 
efficient than an S4 method.  In the example which has been omitted here, 
making 'max' S4 generic adds an overhead to *all* calls to max() in the 
rest of the session.  Adding a max.brob method costs nothing at all (max 
is already S3 generic and efficiently so).

People tend to forget how expensive it is to mess with R basics, which 
applies both to taking them over as S4 generics and making them S3 generic 
via UseMethod.

If a function/operator has already been made S4 generic or is not written 
for efficiency then it is reasonable to add an S4 method.  But otherwise, 
please think carefully about the impact on other people's code.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From ripley at stats.ox.ac.uk  Tue Sep  5 11:49:35 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 5 Sep 2006 10:49:35 +0100 (BST)
Subject: [Rd] setMethod("Summary")
In-Reply-To: <Pine.LNX.4.64.0609050958480.13577@gannet.stats.ox.ac.uk>
References: <C7B9E5CB-E340-445D-A5B9-FC86AB6CC1DE@soc.soton.ac.uk>
	<C4E5D78B-28AB-4A25-8112-3668F31444E4@mac.com>
	<E28E6E71-5DD8-4B38-81C9-BB6014F6C16E@soc.soton.ac.uk>
	<17661.14016.528539.481357@stat.math.ethz.ch>
	<Pine.LNX.4.64.0609050958480.13577@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0609051034220.29103@gannet.stats.ox.ac.uk>

On Tue, 5 Sep 2006, Prof Brian Ripley wrote:

> On Tue, 5 Sep 2006, Martin Maechler wrote:
> 
> > >>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
> > >>>>>     on Tue, 5 Sep 2006 08:58:23 +0100 writes:
> > 
> >     Robin> Dear Franklin
> >     Robin> thank you for this.
> > 
> > yes, and he *did* send it already last week.
> > 
> >     Robin> Your suggestion works.
> > 
> > and continues to do so in R-devel aka "R-2.4.0 alpha" (as of today?)
> > 
> >     Robin> But now I'm confused because I'm not sure how  
> >     Robin> the
> >     Robin> setGeneric() call actually helps.
> > 
> > Robin, I think you got confused because you are mixing S3 and S4
> > ("max.brob" is S3).
> > 
> > You should (typically) not define S3 methods for S4 classes,
> > and you should definitely not do it in this case where Franklin 
> > has shown the correct S4 way.
> > (and for my taste you should also not do it for the "Logic" case
> >  in that other thread last week: It does not bring you anything and is
> >  ugly for me, from the point of view of S4.)
> 
> But it *does* bring you something, efficiency.  If all you want to do is 
> to stop the default method dispatching, using an S3 method can be lot more 
> efficient than an S4 method.  In the example which has been omitted here, 
> making 'max' S4 generic adds an overhead to *all* calls to max() in the 
> rest of the session.  Adding a max.brob method costs nothing at all (max 
> is already S3 generic and efficiently so).

Another issue.  I meant in the session commands, and forgot to mention 
what happens to calls to max() from within functions.  max() is in the 
base namespace.  If you add an S3 method, it will be used by all functions 
calling max(). If you make the function S4 generic, the S4 generic only 
gets called if your package is ahead of the base namespace in the current 
search(), that is from your own package and from packages without 
namespaces.

Now, the current behaviour is

> setClass("foo", "numeric")
[1] "foo"
> xx <- new("foo", pi)
> setMethod("max", signature="foo", function(x, ..., na.rm=FALSE) 
stop("foo"))
[1] "max"
> max(xx)
Error in max(xx) : foo
> base::max(xx)
[1] 3.141593

(and I got an error and then a segfault after leaving off na.rm=FALSE, 
which ought to be allowed).

> max.foo <- function(...) stop("S3 foo")
> base::max(xx)
Error in max.foo(..., na.rm = na.rm) : S3 foo

That's probably a bigger win.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From Torsten.Hothorn at rzmail.uni-erlangen.de  Tue Sep  5 14:12:01 2006
From: Torsten.Hothorn at rzmail.uni-erlangen.de (Torsten Hothorn)
Date: Tue, 5 Sep 2006 14:12:01 +0200 (CEST)
Subject: [Rd] Typo in print.default.Rd
Message-ID: <Pine.LNX.4.64.0609051410230.5600@imbe153.imbe.med.uni-erlangen.de>


line 17 has `intepretation', should read `interpretation'

Torsten



From phillip.endicott at zoology.oxford.ac.uk  Tue Sep  5 15:13:46 2006
From: phillip.endicott at zoology.oxford.ac.uk (phillip.endicott at zoology.oxford.ac.uk)
Date: Tue,  5 Sep 2006 15:13:46 +0200 (CEST)
Subject: [Rd] ISwR (PR#9204)
Message-ID: <20060905131346.6A92529C44@slim.kubism.ku.dk>


I wanted to install the ISwR package onto my Linux system and used the 
install.packages command but it returns the message that  the package 
was not found at the repositories.

So I tried to install locally adding the argument repos=NULL but it gave 
a non-zero exit status report and the package is not present on the system.

I am a novice UNIX user and also new to R but I have followed the syntax 
faithfully and presumably successfully to get the messages I did.

I would be most grateful of to hear if you know of a problem with this 
package.


Many thanks

Phillip Endicott



From p.dalgaard at biostat.ku.dk  Tue Sep  5 15:42:29 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 05 Sep 2006 15:42:29 +0200
Subject: [Rd] ISwR (PR#9204)
In-Reply-To: <20060905131346.6A92529C44@slim.kubism.ku.dk>
References: <20060905131346.6A92529C44@slim.kubism.ku.dk>
Message-ID: <x2r6yqfn0a.fsf@viggo.kubism.ku.dk>

phillip.endicott at zoology.oxford.ac.uk writes:

> I wanted to install the ISwR package onto my Linux system and used the 
> install.packages command but it returns the message that  the package 
> was not found at the repositories.
> 
> So I tried to install locally adding the argument repos=NULL but it gave 
> a non-zero exit status report and the package is not present on the system.
> 
> I am a novice UNIX user and also new to R but I have followed the syntax 
> faithfully and presumably successfully to get the messages I did.
> 
> I would be most grateful of to hear if you know of a problem with this 
> package.

Installs happily here. You do need to give more information about
which commands you tried and what the responses were. Which version of
R, which repository, etc.

(Expect to see a couple of acidic notes about posting bug reports
prematurely...)

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From r.hankin at noc.soton.ac.uk  Tue Sep  5 16:48:53 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Tue, 5 Sep 2006 15:48:53 +0100
Subject: [Rd] setMethod("c") [was: setMethod("Summary")]
In-Reply-To: <17661.14016.528539.481357@stat.math.ethz.ch>
References: <C7B9E5CB-E340-445D-A5B9-FC86AB6CC1DE@soc.soton.ac.uk>
	<C4E5D78B-28AB-4A25-8112-3668F31444E4@mac.com>
	<E28E6E71-5DD8-4B38-81C9-BB6014F6C16E@soc.soton.ac.uk>
	<17661.14016.528539.481357@stat.math.ethz.ch>
Message-ID: <528BF1A2-3961-454D-B32C-FEE1F756BBBD@soc.soton.ac.uk>

Hello everybody.

I didn't see Franklin's first message; sorry.

Bearing in mind Professor Ripley's comments
on the efficiency of S4 vs S3, I'm beginning to think I
  should just stick with S3 methods for my brob objects.  After
all, S3 was perfectly adequate for the onion package.

Notwithstanding that,  here's my next problem.  I want to define a
brob method for "c".  Using the example in package "arules" as a
template (I couldn't see one in Matrix), I have


setClass("brob",
          representation = representation 
(x="numeric",positive="logical"),
          prototype      = list(x=numeric(),positive=logical())
          )

"brob" <- function(x,positive){
   if(missing(positive)){
     positive <- rep(TRUE,length(x))
   }
   if(length(positive)==1){
     positive <- rep(positive,length(x))
   }
   new("brob",x=x,positive=positive)
}

setGeneric("getX",function(x){standardGeneric("getX")})
setGeneric("getP",function(x){standardGeneric("getP")})
setMethod("getX","brob",function(x){x at x})
setMethod("getP","brob",function(x){x at positive})


setMethod("c",signature(x="brob"),
           function(x, ..., recursive=FALSE){
             xx <- x at x
             xpos <- x at positive
             z <- list(...)
             return(
                    brob(
                         c(xx,do.call("c",lapply(z,getX))),
                         c(xpos,do.call("c",lapply(z,getP)))
                         )
                    )
           }
           )




Now,  this works for something like

 > x <- new("brob",x=pi,positive=T)
 > c(x,x)

but c(1,x) isn't dispatched to my function.  How to
deal cleanly with this case?   Perhaps if any argument
to c() is a brob object, I would like to coerce them all to brobs.
Is this possible?













--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743



From h.wickham at gmail.com  Tue Sep  5 17:13:58 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Tue, 5 Sep 2006 10:13:58 -0500
Subject: [Rd] Capturing warnings with capture.output
In-Reply-To: <971536df0608290807m607951f8j6ded7cba36e7c5c9@mail.gmail.com>
References: <f8e6ff050608290746x420b56e7i5c7d7fabea9a9c98@mail.gmail.com>
	<971536df0608290807m607951f8j6ded7cba36e7c5c9@mail.gmail.com>
Message-ID: <f8e6ff050609050813t46851a59xf4325fd813e6d503@mail.gmail.com>

> Something like this which displays the warnings and also writes
> them to out so that they are captured:

Is it possible to not display the warnings (just write them out) ?

Hadley




>
> out <- capture.output(
>    withCallingHandlers({
>         print(1)
>         warning("A warning.")
>         print(2)
>         warning("Another warning.")
>         print(3)
>    }, warning = function(x) cat(x$message, "\n"))
> )
>
> print(out)
>
>
> On 8/29/06, hadley wickham <h.wickham at gmail.com> wrote:
> > Is there any way to include warnings in the output from capture.output?  eg:
> >
> > a <- capture.output(warning("test"))
> > all.equal(a, "Warning message: \n test ")
> >
> > Conceptually, this seems like redirecting stderr to stdout, or somehow
> > changing warning to simple print it's output.  I've had a look at
> > tryCatch and using a warning handler, but this terminates execution at
> > the warning.
> >
> > Thanks,
> >
> > Hadley
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>



From jmc at r-project.org  Tue Sep  5 17:28:12 2006
From: jmc at r-project.org (John Chambers)
Date: Tue, 05 Sep 2006 11:28:12 -0400
Subject: [Rd] setMethod("c") [was: setMethod("Summary")]
In-Reply-To: <528BF1A2-3961-454D-B32C-FEE1F756BBBD@soc.soton.ac.uk>
References: <C7B9E5CB-E340-445D-A5B9-FC86AB6CC1DE@soc.soton.ac.uk>
	<C4E5D78B-28AB-4A25-8112-3668F31444E4@mac.com>
	<E28E6E71-5DD8-4B38-81C9-BB6014F6C16E@soc.soton.ac.uk>
	<17661.14016.528539.481357@stat.math.ethz.ch>
	<528BF1A2-3961-454D-B32C-FEE1F756BBBD@soc.soton.ac.uk>
Message-ID: <44FD978C.9020208@r-project.org>

It's all very well to go on about efficiency, but the purpose of 
statistical computing is insight into data, not saving CPU cycles (to 
paraphrase Dick Hamming).

S3 methods do some things fine; other tasks need more flexibility.  One 
should ask what's important in a particular application and try to find 
tools that match the needs well.

Now, the c() function.  This has been discussed in various forms (and 
languages) for some time.  As I remember and as far as I know, the only 
really general way to ensure dispatch on _any_ applicable argument is to 
turn the computation into a pair-wise one and define the methods (NOT S3 
methods) for the two arguments of the pairwise function.

I won't try to reproduce the details off the top of my head (if I locate 
a reference I'll pass it on), but very roughly the idea is to say 
something like

cWithMethods <- function(x, ...) {
   if(nargs()<3)
      cPair(x,...)
    else
      cPair(x, cWithMethods(...))
}

and then write methods for cPair().

John

Robin Hankin wrote:
> Hello everybody.
>
> I didn't see Franklin's first message; sorry.
>
> Bearing in mind Professor Ripley's comments
> on the efficiency of S4 vs S3, I'm beginning to think I
>   should just stick with S3 methods for my brob objects.  After
> all, S3 was perfectly adequate for the onion package.
>
> Notwithstanding that,  here's my next problem.  I want to define a
> brob method for "c".  Using the example in package "arules" as a
> template (I couldn't see one in Matrix), I have
>
>
> setClass("brob",
>           representation = representation 
> (x="numeric",positive="logical"),
>           prototype      = list(x=numeric(),positive=logical())
>           )
>
> "brob" <- function(x,positive){
>    if(missing(positive)){
>      positive <- rep(TRUE,length(x))
>    }
>    if(length(positive)==1){
>      positive <- rep(positive,length(x))
>    }
>    new("brob",x=x,positive=positive)
> }
>
> setGeneric("getX",function(x){standardGeneric("getX")})
> setGeneric("getP",function(x){standardGeneric("getP")})
> setMethod("getX","brob",function(x){x at x})
> setMethod("getP","brob",function(x){x at positive})
>
>
> setMethod("c",signature(x="brob"),
>            function(x, ..., recursive=FALSE){
>              xx <- x at x
>              xpos <- x at positive
>              z <- list(...)
>              return(
>                     brob(
>                          c(xx,do.call("c",lapply(z,getX))),
>                          c(xpos,do.call("c",lapply(z,getP)))
>                          )
>                     )
>            }
>            )
>
>
>
>
> Now,  this works for something like
>
>  > x <- new("brob",x=pi,positive=T)
>  > c(x,x)
>
> but c(1,x) isn't dispatched to my function.  How to
> deal cleanly with this case?   Perhaps if any argument
> to c() is a brob object, I would like to coerce them all to brobs.
> Is this possible?
>
>
>
>
>
>
>
>
>
>
>
>
>
> --
> Robin Hankin
> Uncertainty Analyst
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>   tel  023-8059-7743
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>



From ggrothendieck at gmail.com  Tue Sep  5 17:43:09 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 5 Sep 2006 11:43:09 -0400
Subject: [Rd] Capturing warnings with capture.output
In-Reply-To: <f8e6ff050609050813t46851a59xf4325fd813e6d503@mail.gmail.com>
References: <f8e6ff050608290746x420b56e7i5c7d7fabea9a9c98@mail.gmail.com>
	<971536df0608290807m607951f8j6ded7cba36e7c5c9@mail.gmail.com>
	<f8e6ff050609050813t46851a59xf4325fd813e6d503@mail.gmail.com>
Message-ID: <971536df0609050843n13ec4e72ufdc4f410436cfda3@mail.gmail.com>

Modify withWarnings in:
   https://stat.ethz.ch/pipermail/r-help/2004-June/052132.html
like this:

withWarnings <- function(expr) {
     wHandler <- function(w) {
      cat(w$message, "\n")
      invokeRestart("muffleWarning")
     }
     withCallingHandlers(expr, warning = wHandler)
}

# test
out <- capture.output(
   withWarnings({
      print(1)
      warning("A")
      print(2)
      warning("B")
      print(3)
   })
)

On 9/5/06, hadley wickham <h.wickham at gmail.com> wrote:
> > Something like this which displays the warnings and also writes
> > them to out so that they are captured:
>
> Is it possible to not display the warnings (just write them out) ?
>
> Hadley
>
>
>
>
> >
> > out <- capture.output(
> >    withCallingHandlers({
> >         print(1)
> >         warning("A warning.")
> >         print(2)
> >         warning("Another warning.")
> >         print(3)
> >    }, warning = function(x) cat(x$message, "\n"))
> > )
> >
> > print(out)
> >
> >
> > On 8/29/06, hadley wickham <h.wickham at gmail.com> wrote:
> > > Is there any way to include warnings in the output from capture.output?  eg:
> > >
> > > a <- capture.output(warning("test"))
> > > all.equal(a, "Warning message: \n test ")
> > >
> > > Conceptually, this seems like redirecting stderr to stdout, or somehow
> > > changing warning to simple print it's output.  I've had a look at
> > > tryCatch and using a warning handler, but this terminates execution at
> > > the warning.
> > >
> > > Thanks,
> > >
> > > Hadley
> > >
> > > ______________________________________________
> > > R-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-devel
> > >
> >
>



From maechler at stat.math.ethz.ch  Tue Sep  5 17:47:59 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 5 Sep 2006 17:47:59 +0200
Subject: [Rd] setMethod("c") [was: setMethod("Summary")]
In-Reply-To: <44FD978C.9020208@r-project.org>
References: <C7B9E5CB-E340-445D-A5B9-FC86AB6CC1DE@soc.soton.ac.uk>
	<C4E5D78B-28AB-4A25-8112-3668F31444E4@mac.com>
	<E28E6E71-5DD8-4B38-81C9-BB6014F6C16E@soc.soton.ac.uk>
	<17661.14016.528539.481357@stat.math.ethz.ch>
	<528BF1A2-3961-454D-B32C-FEE1F756BBBD@soc.soton.ac.uk>
	<44FD978C.9020208@r-project.org>
Message-ID: <17661.39983.145393.491797@stat.math.ethz.ch>

One reference to a very similar problem 
is  help(cbind2), 
about the cbind2() and rbind2() functions which I had added
to R a little while ago exactly for the same reason as we talk
about 'c()' or "c" here,
and thanks to original "hand holding" by you, John.

Martin

>>>>> "JMC" == John Chambers <jmc at r-project.org>
>>>>>     on Tue, 05 Sep 2006 11:28:12 -0400 writes:

    JMC> It's all very well to go on about efficiency, but the purpose of 
    JMC> statistical computing is insight into data, not saving CPU cycles (to 
    JMC> paraphrase Dick Hamming).

    JMC> S3 methods do some things fine; other tasks need more flexibility.  One 
    JMC> should ask what's important in a particular application and try to find 
    JMC> tools that match the needs well.

    JMC> Now, the c() function.  This has been discussed in various forms (and 
    JMC> languages) for some time.  As I remember and as far as I know, the only 
    JMC> really general way to ensure dispatch on _any_ applicable argument is to 
    JMC> turn the computation into a pair-wise one and define the methods (NOT S3 
    JMC> methods) for the two arguments of the pairwise function.

    JMC> I won't try to reproduce the details off the top of my head (if I locate 
    JMC> a reference I'll pass it on), but very roughly the idea is to say 
    JMC> something like

    JMC> cWithMethods <- function(x, ...) {
    JMC> if(nargs()<3)
    JMC> cPair(x,...)
    JMC> else
    JMC> cPair(x, cWithMethods(...))
    JMC> }

    JMC> and then write methods for cPair().

    JMC> John

    JMC> Robin Hankin wrote:
    >> Hello everybody.
    >> 
    >> I didn't see Franklin's first message; sorry.
    >> 
    >> Bearing in mind Professor Ripley's comments
    >> on the efficiency of S4 vs S3, I'm beginning to think I
    >> should just stick with S3 methods for my brob objects.  After
    >> all, S3 was perfectly adequate for the onion package.
    >> 
    >> Notwithstanding that,  here's my next problem.  I want to define a
    >> brob method for "c".  Using the example in package "arules" as a
    >> template (I couldn't see one in Matrix), I have
    >> 
    >> 
    >> setClass("brob",
    >> representation = representation 
    >> (x="numeric",positive="logical"),
    >> prototype      = list(x=numeric(),positive=logical())
    >> )
    >> 
    >> "brob" <- function(x,positive){
    >> if(missing(positive)){
    >> positive <- rep(TRUE,length(x))
    >> }
    >> if(length(positive)==1){
    >> positive <- rep(positive,length(x))
    >> }
    >> new("brob",x=x,positive=positive)
    >> }
    >> 
    >> setGeneric("getX",function(x){standardGeneric("getX")})
    >> setGeneric("getP",function(x){standardGeneric("getP")})
    >> setMethod("getX","brob",function(x){x at x})
    >> setMethod("getP","brob",function(x){x at positive})
    >> 
    >> 
    >> setMethod("c",signature(x="brob"),
    >> function(x, ..., recursive=FALSE){
    >> xx <- x at x
    >> xpos <- x at positive
    >> z <- list(...)
    >> return(
    >> brob(
    >> c(xx,do.call("c",lapply(z,getX))),
    >> c(xpos,do.call("c",lapply(z,getP)))
    >> )
    >> )
    >> }
    >> )
    >> 
    >> 
    >> 
    >> 
    >> Now,  this works for something like
    >> 
    >> > x <- new("brob",x=pi,positive=T)
    >> > c(x,x)
    >> 
    >> but c(1,x) isn't dispatched to my function.  How to
    >> deal cleanly with this case?   Perhaps if any argument
    >> to c() is a brob object, I would like to coerce them all to brobs.
    >> Is this possible?
    >> 
    >> 
    >> 
    >> 
    >> 
    >> 
    >> 
    >> 
    >> 
    >> 
    >> 
    >> 
    >> 
    >> --
    >> Robin Hankin
    >> Uncertainty Analyst
    >> National Oceanography Centre, Southampton
    >> European Way, Southampton SO14 3ZH, UK
    >> tel  023-8059-7743
    >> 
    >> ______________________________________________
    >> R-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 
    >> 

    JMC> ______________________________________________
    JMC> R-devel at r-project.org mailing list
    JMC> https://stat.ethz.ch/mailman/listinfo/r-devel



From jmc at r-project.org  Tue Sep  5 17:47:30 2006
From: jmc at r-project.org (John Chambers)
Date: Tue, 05 Sep 2006 11:47:30 -0400
Subject: [Rd] setMethod("c") [was: setMethod("Summary")]
In-Reply-To: <44FD978C.9020208@r-project.org>
References: <C7B9E5CB-E340-445D-A5B9-FC86AB6CC1DE@soc.soton.ac.uk>
	<C4E5D78B-28AB-4A25-8112-3668F31444E4@mac.com>
	<E28E6E71-5DD8-4B38-81C9-BB6014F6C16E@soc.soton.ac.uk>
	<17661.14016.528539.481357@stat.math.ethz.ch>
	<528BF1A2-3961-454D-B32C-FEE1F756BBBD@soc.soton.ac.uk>
	<44FD978C.9020208@r-project.org>
Message-ID: <44FD9C12.70705@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060905/7c38d9ef/attachment-0003.pl 

From luke at stat.uiowa.edu  Tue Sep  5 17:53:05 2006
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Tue, 5 Sep 2006 10:53:05 -0500 (CDT)
Subject: [Rd] Capturing warnings with capture.output
In-Reply-To: <f8e6ff050609050813t46851a59xf4325fd813e6d503@mail.gmail.com>
References: <f8e6ff050608290746x420b56e7i5c7d7fabea9a9c98@mail.gmail.com>
	<971536df0608290807m607951f8j6ded7cba36e7c5c9@mail.gmail.com>
	<f8e6ff050609050813t46851a59xf4325fd813e6d503@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0609051052440.30445@nokomis.stat.uiowa.edu>

Look at how suppressWarnings does this.

Best,

luke

On Tue, 5 Sep 2006, hadley wickham wrote:

>> Something like this which displays the warnings and also writes
>> them to out so that they are captured:
>
> Is it possible to not display the warnings (just write them out) ?
>
> Hadley
>
>
>
>
>>
>> out <- capture.output(
>>    withCallingHandlers({
>>         print(1)
>>         warning("A warning.")
>>         print(2)
>>         warning("Another warning.")
>>         print(3)
>>    }, warning = function(x) cat(x$message, "\n"))
>> )
>>
>> print(out)
>>
>>
>> On 8/29/06, hadley wickham <h.wickham at gmail.com> wrote:
>>> Is there any way to include warnings in the output from capture.output?  eg:
>>>
>>> a <- capture.output(warning("test"))
>>> all.equal(a, "Warning message: \n test ")
>>>
>>> Conceptually, this seems like redirecting stderr to stdout, or somehow
>>> changing warning to simple print it's output.  I've had a look at
>>> tryCatch and using a warning handler, but this terminates execution at
>>> the warning.
>>>
>>> Thanks,
>>>
>>> Hadley
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu



From kjetilbrinchmannhalvorsen at gmail.com  Tue Sep  5 20:06:51 2006
From: kjetilbrinchmannhalvorsen at gmail.com (Kjetil Halvorsen)
Date: Tue, 5 Sep 2006 14:06:51 -0400
Subject: [Rd] CRAN problem
Message-ID: <556e90a80609051106i798e35cw6ec349c8ff37f070@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060905/0640a5e3/attachment-0003.pl 

From rdpeng at gmail.com  Tue Sep  5 21:41:15 2006
From: rdpeng at gmail.com (Roger D. Peng)
Date: Tue, 05 Sep 2006 15:41:15 -0400
Subject: [Rd] serialize changes for 2.4.0
Message-ID: <44FDD2DB.9080309@gmail.com>

I noticed today that in R 2.3.1, I get

 > serialize(list(1,2,3), NULL, ascii = TRUE)
[1] "A\n2\n131841\n131840\n19\n3\n14\n1\n1\n14\n1\n2\n14\n1\n3\n"
 >

but in R 2.4.0 alpha I get

 > serialize(list(1,2,3), NULL, ascii = TRUE)
  [1] 41 0a 32 0a 31 33 32 30 39 36 0a 31 33 31 38 34 30 0a 31 39 0a 33 0a 31 34
[26] 0a 31 0a 31 0a 31 34 0a 31 0a 32 0a 31 34 0a 31 0a 33 0a
 >

It seems I need to use 'rawToChar()' to get the character vector that I used to 
get in R 2.3.1.

Is this intentional?  I couldn't find any mention of this change in the NEWS 
file; from the docs, it seems to me that either return value could be correct.

 > version
                _
platform       x86_64-unknown-linux-gnu
arch           x86_64
os             linux-gnu
system         x86_64, linux-gnu
status         alpha
major          2
minor          4.0
year           2006
month          09
day            05
svn rev        39121
language       R
version.string R version 2.4.0 alpha (2006-09-05 r39121)
 >

-roger
-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/



From dheide at nld.ds.mpg.de  Tue Sep  5 21:57:02 2006
From: dheide at nld.ds.mpg.de (dheide at nld.ds.mpg.de)
Date: Tue,  5 Sep 2006 21:57:02 +0200 (CEST)
Subject: [Rd] problem in contour/contourLines (PR#9205)
Message-ID: <20060905195702.C721D4C9E6@slim.kubism.ku.dk>

Full_Name: Dominik Heide
Version: 2.3.1
OS: Linux (Suse 9.3)
Submission from: (NULL) (134.76.220.200)


The contour functions has sommewhere (I think in .../main/plot3d.c) a maximum
number of line segments that is set using a define. The contour line in my data
too long for this and therefore not correct analysed (I get the message
'contour(): circular/long seglist -- bug.report()!'). Since I can't analyse my
data right now, it's mybe better to give the maximum seg-number as an option ?!



From ripley at stats.ox.ac.uk  Tue Sep  5 22:39:54 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 5 Sep 2006 21:39:54 +0100 (BST)
Subject: [Rd] serialize changes for 2.4.0
In-Reply-To: <44FDD2DB.9080309@gmail.com>
References: <44FDD2DB.9080309@gmail.com>
Message-ID: <Pine.LNX.4.64.0609052136410.12320@gannet.stats.ox.ac.uk>

NEW FEATURES

    o	serialize(connection = NULL) now returns a raw vector (and not
	a character string).  unserialize() accepts both old and new
	formats (and has since 2.3.0).

serialize.Rd:

  The function \code{serialize} writes \code{object} to the specified
  connection.  Sharing of reference objects is preserved within the
  object but not across separate calls to serialize.  If
  \code{connection} is \code{NULL} then \code{object} is serialized to a
  raw vector, which is returned as the result of \code{serialize}.
  ^^^^^^^^^^
\section{Warning}{
  These functions are still experimental.  Names, interfaces and
  values might change in future versions (and was changed for \R 2.4.0).
  \code{.saveRDS} and \code{.readRDS} are intended for internal use.
}

\examples{
x <- serialize(list(1,2,3), NULL)
unserialize(x)
## test pre-2.3.0 interface as a length-one character vector
y <- rawToChar(x)
unserialize(y)
}

all seem clear enough to me ..., including the statement about being 
experimental.


On Tue, 5 Sep 2006, Roger D. Peng wrote:

> I noticed today that in R 2.3.1, I get
> 
>  > serialize(list(1,2,3), NULL, ascii = TRUE)
> [1] "A\n2\n131841\n131840\n19\n3\n14\n1\n1\n14\n1\n2\n14\n1\n3\n"
>  >
> 
> but in R 2.4.0 alpha I get
> 
>  > serialize(list(1,2,3), NULL, ascii = TRUE)
>   [1] 41 0a 32 0a 31 33 32 30 39 36 0a 31 33 31 38 34 30 0a 31 39 0a 33 0a 31 34
> [26] 0a 31 0a 31 0a 31 34 0a 31 0a 32 0a 31 34 0a 31 0a 33 0a
>  >
> 
> It seems I need to use 'rawToChar()' to get the character vector that I used to 
> get in R 2.3.1.
> 
> Is this intentional?  I couldn't find any mention of this change in the NEWS 
> file; from the docs, it seems to me that either return value could be correct.
> 
>  > version
>                 _
> platform       x86_64-unknown-linux-gnu
> arch           x86_64
> os             linux-gnu
> system         x86_64, linux-gnu
> status         alpha
> major          2
> minor          4.0
> year           2006
> month          09
> day            05
> svn rev        39121
> language       R
> version.string R version 2.4.0 alpha (2006-09-05 r39121)
>  >
> 
> -roger
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From ripley at stats.ox.ac.uk  Tue Sep  5 22:50:34 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 5 Sep 2006 21:50:34 +0100 (BST)
Subject: [Rd] problem in contour/contourLines (PR#9205)
In-Reply-To: <20060905195702.C721D4C9E6@slim.kubism.ku.dk>
References: <20060905195702.C721D4C9E6@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0609052142390.12320@gannet.stats.ox.ac.uk>

It says

/* maximal number of line segments of one contour segment:
 * for preventing infinite loops -- shouldn't be needed --> warning */
#define MAX_ns 25000

so it would be very helpful to have a reproducible example.  Please also 
let us have exact details of how you compiled R (CPU, compiler versions, 
optimization level ...).

I have tracked a couple of things like this down to extended floating 
point issues on ix86 chips, so it may very well be that this is an issue 
of stopping an infinite loop.

(25000 segments is very large: a space filling graph on a 50x50 grid only 
needs about that many.)

On Tue, 5 Sep 2006, dheide at nld.ds.mpg.de wrote:

> Full_Name: Dominik Heide
> Version: 2.3.1
> OS: Linux (Suse 9.3)

On which CPU?

> Submission from: (NULL) (134.76.220.200)
> 
> 
> The contour functions has sommewhere (I think in .../main/plot3d.c) a 
> maximum number of line segments that is set using a define. The contour 
> line in my data too long for this and therefore not correct analysed (I 
> get the message 'contour(): circular/long seglist -- bug.report()!'). 
> Since I can't analyse my data right now, it's mybe better to give the 
> maximum seg-number as an option ?!

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From deepayan.sarkar at gmail.com  Tue Sep  5 23:09:22 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Tue, 5 Sep 2006 14:09:22 -0700
Subject: [Rd] Two submitted packages
In-Reply-To: <20060904231339.BHG87597@po-d.temple.edu>
References: <20060904231339.BHG87597@po-d.temple.edu>
Message-ID: <eb555e660609051409s6c3115cfxdc49031d7f0020a4@mail.gmail.com>

On 9/4/06, Richard M. Heiberger <rmh at temple.edu> wrote:
> ## This example runs in R 2.3.1 and does not run in R 2.4.1.  I am
> ## raising it here for two questions: one on how to debug functions
> ## inside a namespace, the other on how to control clipping.
>
> tmp <- data.frame(x=1:5, y=1:5, a=factor(c(1,1,1,1,1), levels=1:4))
> xyplot(y ~ x,
>        data=tmp, ylim=c(1.5,4.5),
>        panel=function(x,y, ...) {
>          cpv <- current.viewport()
>          cpv$clip <- "off"
>          pushViewport(cpv)
>          panel.xyplot(x, y, ...)
>          popViewport()
>        })
>
> ## R version 2.4.0 Under development (unstable) (2006-08-14 r38872)
> ## gives the error message
> Error in grid.Call.graphics("L_setviewport", pvp, TRUE) :
>         LOGICAL() can only be applied to a 'logical', not a 'character'
> >
>
> ## Question 1.  How do I place a trace() on grid.Call.graphics to make
>
> [snipped]
>
>
> ## Question 2.  How do I control clipping from within a panel
> ## function?  In 2.3.1, both of the following statements run without
> ## error.  Neither of them turns clipping off.
> ##
> ## In 2.4.0, the "off" statement gives the error message above.  The
> ## FALSE statement runs without error, but it didn't turn clipping off.
>
> xyplot(y ~ x | a,
>        data=tmp, ylim=c(1.5,4.5),
>        panel=function(x,y, ...) {
>          cpv <- current.viewport()
>          cpv$clip <- "off"
>          pushViewport(cpv)
>          panel.xyplot(x, y, ...)
>          popViewport()
>        },
>        layout=c(2,2))
>
> xyplot(y ~ x | a,
>        data=tmp, ylim=c(1.5,4.5),
>        panel=function(x,y, ...) {
>          cpv <- current.viewport()
>          cpv$clip <- FALSE
>          pushViewport(cpv)
>          panel.xyplot(x, y, ...)
>          popViewport()
>        },
>        layout=c(2,2))
>
>
> ## ?viewport in 2.4.0 says
> ## clip
> ##
> ## One of "on", "inherit", or "off", indicating whether to clip to the
> ## extent of this viewport, inherit the clipping region from the
> ## parent viewport, or turn clipping off altogether. For
> ## back-compatibility, a logical value of TRUE corresponds to "on" and
> ## FALSE corresponds to "inherit".
>
> ## Notice that "off" is current and FALSE is back-compatible, and
> ## "off" is the value that causes the error.
>
> ## What is the correct way to turn off clipping?

I don't believe there /is/ a documented way.

> ## The way that I would like to use is something on the order of
>
> xyplot(y ~ x | a,
>        data=tmp, ylim=c(1.5,4.5),
>        panel=function(x,y, ...) {
>          panel.xyplot(x, y, ...,
>                       par.settings = list(clip = list(panel = "off")))
>        },
>        layout=c(2,2))
>
> ## I believe par.settings is currently valid only in xyplot() and not
> ## valid in panel functions.  Is my understanding correct?

Yes.

> ## Can the
> ## behavior be changed?

In the original design of lattice, no. In the current design, two
separate viewports exist for each panel (which is why you can use
trellis.focus with clipping turned off). So, there might be a way to
switch to that. A reasonably clean approach might be to do the
following:

xyplot(y ~ x,
       data=tmp, ylim=c(1.5,4.5),
       panel=function(x, y, ...) {
           upViewport()
           downViewport(trellis.vpname("panel",
                                       row = 1, column = 1, clip.off = TRUE))
           panel.xyplot(x, y, ...)
           panel.points(1.4, 1.4)
      })

Unfortunately, there is currently no easy way to find out which column
and row the current panel occupies. I plan to make some changes before
R 2.4.0 is released that should expose that information, so please try
again in a few weeks.

> ## The following statement works correctly in both 2.3.1 and 2.4.0.
> ## This statement controls clipping for the entire xyplot, not just
> ## for the single statement within the panel function.
>
> xyplot(y ~ x | a,
>        data=tmp, ylim=c(1.5,4.5),
>        par.settings = list(clip = list(panel = "off")),
>        layout=c(2,2))

I'm curious to know why this functionality is not enough.

Deepayan



From ripley at stats.ox.ac.uk  Tue Sep  5 23:15:37 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 5 Sep 2006 22:15:37 +0100 (BST)
Subject: [Rd] Two submitted packages
In-Reply-To: <20060904231339.BHG87597@po-d.temple.edu>
References: <20060904231339.BHG87597@po-d.temple.edu>
Message-ID: <Pine.LNX.4.64.0609050731100.29360@gannet.stats.ox.ac.uk>

On Mon, 4 Sep 2006, Richard M. Heiberger wrote:

> ## This example runs in R 2.3.1 and does not run in R 2.4.1.  I am

There is no '2.4.1', and your R-devel is not very recent.  It looks as if 
R-devel has detected an error of yours that previously went undetected.

You set cpv$clip <- "off" and the internal code assumes that it is logical 
(as the message says).  I can't find any documentation to support your 
code: if there is some please report it to the maintainer of grid (Paul 
Murrell).

> ## raising it here for two questions: one on how to debug functions
> ## inside a namespace, the other on how to control clipping.
> 
> tmp <- data.frame(x=1:5, y=1:5, a=factor(c(1,1,1,1,1), levels=1:4))
> xyplot(y ~ x,
>        data=tmp, ylim=c(1.5,4.5),
>        panel=function(x,y, ...) {
>          cpv <- current.viewport()
>          cpv$clip <- "off"
>          pushViewport(cpv)
>          panel.xyplot(x, y, ...)
>          popViewport()
>        })
> 
> ## R version 2.4.0 Under development (unstable) (2006-08-14 r38872)
> ## gives the error message
> Error in grid.Call.graphics("L_setviewport", pvp, TRUE) : 
>         LOGICAL() can only be applied to a 'logical', not a 'character'
> >
> 
> ## Question 1.  How do I place a trace() on grid.Call.graphics to make
> ## it stop and give me a traceback.  I tried many variations of the
> ## command
> ##    trace(grid:::grid.Call.graphics, exit=recover,
> ##          where=environment(grid:::grid.Call.graphics))
> ## None of them trapped the error and let me trace it.  What is the
> ## correct incantation?

Not sure why you want to do that, as traceback() works here.

> traceback(max.lines=3)
10: .Call.graphics(fnname, ..., PACKAGE = "grid")
9: grid.Call.graphics("L_setviewport", pvp, TRUE)
8: push.vp.viewport(X[[1]], ...)
7: FUN(X[[1]], ...)
6: lapply(vps, push.vp, recording)
5: pushViewport(cpv)
4: panel(x = c(1, 2, 3, 4, 5), y = c(1, 2, 3, 4, 5), packet.number = 1, 
       panel.number = 1)
3: do.call("panel", pargs)
2: print.trellis(list(formula = y ~ x, as.table = FALSE, aspect.fill = 
TRUE, 
       legend = NULL, panel = function (x, y, ...) 
       {
     ...
1: print(list(formula = y ~ x, as.table = FALSE, aspect.fill = TRUE, 
       legend = NULL, panel = function (x, y, ...) 
       {
     ...

as does options(error=recover).  What does a namespace have to do with 
this?

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From tlumley at u.washington.edu  Wed Sep  6 00:22:49 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Tue, 5 Sep 2006 15:22:49 -0700 (PDT)
Subject: [Rd] (PR#9202) Re: Bugs with partial name matching during partial
In-Reply-To: <20060905014002.634C928F8E@slim.kubism.ku.dk>
References: <20060905014002.634C928F8E@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0609051507530.17674@homer23.u.washington.edu>


The partial matching is fairly deeply built in to complex assignment, 
another example being
> x<-list(ab=1:2)
> names(x$ab)=c("A","B")
> names(x$a)=c("a","b")
> x
$ab
A B
1 2

$a
a b
1 2

because as evalseq works through the nested calls on the LHS the code 
being called doesn't know it is in an assignment call.


The bug is a bug. It isn't specific to data frames or to replacing only 
some elements of a vector
> x<-list(ab=1:2)
> x$a[]<-2:1
> x
$ab
[1] 2 1

$a
[1] 2 1

It also happens when $ is replaced by [[. It looks like a failure to 
duplicate. A workaround would be not to modify list elements or database 
columns that don't exist ;).


 	-thomas



From tlumley at u.washington.edu  Wed Sep  6 00:54:45 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Tue, 5 Sep 2006 15:54:45 -0700 (PDT)
Subject: [Rd] (PR#9202) Re: Bugs with partial name matching
In-Reply-To: <Pine.LNX.4.64.0609051507530.17674@homer23.u.washington.edu>
References: <20060905014002.634C928F8E@slim.kubism.ku.dk>
	<Pine.LNX.4.64.0609051507530.17674@homer23.u.washington.edu>
Message-ID: <Pine.LNX.4.64.0609051542310.17674@homer23.u.washington.edu>

On Tue, 5 Sep 2006, Thomas Lumley wrote:

>
> The partial matching is fairly deeply built in to complex assignment,
<sip>
> because as evalseq works through the nested calls on the LHS the code
> being called doesn't know it is in an assignment call.


The problem in
> D = list(ABCD=2:1)
>  D$ABC[]<-3:4
> D
$ABCD
[1] 3 4

$ABC
[1] 3 4

is that eval.c:evalseq ends up with a reference to D$ABCD from evaluating 
D$ABC with partial matching.  Since evalseq doesn't (and shouldn't) 
increase NAMED on these partially evaluated calls, NAMED is still 1 for 
D$ABCD.  When evalseq's D$ABC has 3:4 assigned into it the vector is 
changed directly, since NAMED=1, and both D$ABC and D$ABCD change.

The minimal fix would appear to be the horrible hack of incrementing NAMED 
whenever a list element is even looked at with partial matching. Otherwise 
evalseq would have to be taught to recognize aliasing from partial 
matching.


 	-thomas



From rmh at temple.edu  Wed Sep  6 01:40:18 2006
From: rmh at temple.edu (Richard M. Heiberger)
Date: Tue,  5 Sep 2006 19:40:18 -0400 (EDT)
Subject: [Rd] Two submitted packages
Message-ID: <20060905194018.BHI53591@po-d.temple.edu>

From: Prof Brian Ripley
> There is no '2.4.1', and your R-devel is not very recent.

Apologies on the typo and the two-week old 2.4.0dev.

I just downloaded
   version 2.4.0 Under development (unstable) (2006-09-04 r39086)


1.
> You set cpv$clip <- "off" and the internal code assumes that it is logical 
> (as the message says).  I can't find any documentation to support your 
> code: if there is some please report it to the maintainer of grid (Paul 
> Murrell).

The documentation for "off" comes from ?viewport that is part of 2.4.0dev.
> installed.packages()["grid",]
                           Package                            LibPath 
                            "grid" "C:/PROGRA~1/R/R-24~1.0DE/library" 
                           Version                           Priority 
                           "2.4.0"                             "base" 
                            Bundle                           Contains 
                                NA                                 NA 
                           Depends                            Imports 
                       "grDevices"                                 NA 
                          Suggests                              Built 
                         "lattice"                            "2.4.0" 

clip
    One of "on", "inherit", or "off", indicating whether to clip to the
    extent of this viewport, inherit the clipping region from the parent
    viewport, or turn clipping off altogether. For back-compatibility, a
    logical value of TRUE corresponds to "on" and FALSE corresponds to
    "inherit".

The above description of clip is identical to the description in
?viewport in the released 2.3.1.


I still get the same error in 2.4.0dev that did not appear in 2.3.1
and it still looks to me like this is an equally valid statement in both
versions of R.
>  Error in grid.Call.graphics("L_setviewport", pvp, TRUE) : 
>          LOGICAL() can only be applied to a 'logical', not a 'character'
>  >

I think something needs to be changed to make the documentation and the
program consistent.  I like the documentation, with the three options
for clipping, and hope to see the program changed to match it.


2.
> > ## Question 1.  How do I place a trace() on grid.Call.graphics to make
> > ## it stop and give me a traceback.
> Not sure why you want to do that, as traceback() works here.
... as does options(error=recover).

I was interested in the argument
    trace(..., exit=recover)
I see now that
    options(error=recover)
does exactly what I want.  That is the incantation I was looking for.
Thank you.



From rmh at temple.edu  Wed Sep  6 01:41:16 2006
From: rmh at temple.edu (Richard M. Heiberger)
Date: Tue,  5 Sep 2006 19:41:16 -0400 (EDT)
Subject: [Rd] enhancement request for labeling help windows in Windows
Message-ID: <20060905194116.BHI53673@po-d.temple.edu>

I would like to make a formal request for an enhancement.

The default help for RGui in 2.4.0dev seems to be the .chm format
outside of the RGui frame.  Previously the default help was individual
windows inside the RGui frame.  Every package in R has its own help
file and all of them are labeled identically as "Help" by Windows.
The labels appear in the title of the window, in the task bar, and in
the alt-tab menu.

The request is to give each a unique name, for example
    R Help --- base
    R Help --- grid
    R Help --- lattice



From murdoch at stats.uwo.ca  Wed Sep  6 02:03:14 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 05 Sep 2006 20:03:14 -0400
Subject: [Rd] enhancement request for labeling help windows in Windows
In-Reply-To: <20060905194116.BHI53673@po-d.temple.edu>
References: <20060905194116.BHI53673@po-d.temple.edu>
Message-ID: <44FE1042.1090101@stats.uwo.ca>

On 9/5/2006 7:41 PM, Richard M. Heiberger wrote:
> I would like to make a formal request for an enhancement.
> 
> The default help for RGui in 2.4.0dev seems to be the .chm format
> outside of the RGui frame.  Previously the default help was individual
> windows inside the RGui frame.  Every package in R has its own help
> file and all of them are labeled identically as "Help" by Windows.
> The labels appear in the title of the window, in the task bar, and in
> the alt-tab menu.
> 
> The request is to give each a unique name, for example
>     R Help --- base
>     R Help --- grid
>     R Help --- lattice
> 

No problem:  let me know what to do.

Duncan Murdoch



From p.murrell at auckland.ac.nz  Wed Sep  6 02:20:51 2006
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Wed, 06 Sep 2006 12:20:51 +1200
Subject: [Rd] Two submitted packages
In-Reply-To: <20060905194018.BHI53591@po-d.temple.edu>
References: <20060905194018.BHI53591@po-d.temple.edu>
Message-ID: <44FE1463.2000509@stat.auckland.ac.nz>

Hi


Richard M. Heiberger wrote:
> From: Prof Brian Ripley
>> There is no '2.4.1', and your R-devel is not very recent.
> 
> Apologies on the typo and the two-week old 2.4.0dev.
> 
> I just downloaded
>    version 2.4.0 Under development (unstable) (2006-09-04 r39086)
> 
> 
> 1.
>> You set cpv$clip <- "off" and the internal code assumes that it is logical 
>> (as the message says).  I can't find any documentation to support your 
>> code: if there is some please report it to the maintainer of grid (Paul 
>> Murrell).
> 
> The documentation for "off" comes from ?viewport that is part of 2.4.0dev.
>> installed.packages()["grid",]
>                            Package                            LibPath 
>                             "grid" "C:/PROGRA~1/R/R-24~1.0DE/library" 
>                            Version                           Priority 
>                            "2.4.0"                             "base" 
>                             Bundle                           Contains 
>                                 NA                                 NA 
>                            Depends                            Imports 
>                        "grDevices"                                 NA 
>                           Suggests                              Built 
>                          "lattice"                            "2.4.0" 
> 
> clip
>     One of "on", "inherit", or "off", indicating whether to clip to the
>     extent of this viewport, inherit the clipping region from the parent
>     viewport, or turn clipping off altogether. For back-compatibility, a
>     logical value of TRUE corresponds to "on" and FALSE corresponds to
>     "inherit".
> 
> The above description of clip is identical to the description in
> ?viewport in the released 2.3.1.


That's the documentation for the (public) viewport() function, which
allows either string or logical values.  Your code is directly modifying
the (internal, private, undocumented) structure of a "viewport" object,
which only allows logical values.

There is currently no public interface for editing a viewport (this is
something that I need to address).  In the meantime, I think a
workaround for your example would be to use ...

cpv$clip <- NA

Paul


> I still get the same error in 2.4.0dev that did not appear in 2.3.1
> and it still looks to me like this is an equally valid statement in both
> versions of R.
>>  Error in grid.Call.graphics("L_setviewport", pvp, TRUE) : 
>>          LOGICAL() can only be applied to a 'logical', not a 'character'
>>  >
> 
> I think something needs to be changed to make the documentation and the
> program consistent.  I like the documentation, with the three options
> for clipping, and hope to see the program changed to match it.
> 
> 
> 2.
>>> ## Question 1.  How do I place a trace() on grid.Call.graphics to make
>>> ## it stop and give me a traceback.
>> Not sure why you want to do that, as traceback() works here.
> ... as does options(error=recover).
> 
> I was interested in the argument
>     trace(..., exit=recover)
> I see now that
>     options(error=recover)
> does exactly what I want.  That is the incantation I was looking for.
> Thank you.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/



From deepayan.sarkar at gmail.com  Wed Sep  6 02:25:41 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Tue, 5 Sep 2006 17:25:41 -0700
Subject: [Rd] Two submitted packages
In-Reply-To: <20060905194018.BHI53591@po-d.temple.edu>
References: <20060905194018.BHI53591@po-d.temple.edu>
Message-ID: <eb555e660609051725s1d3ed863v535638187d1bce0f@mail.gmail.com>

On 9/5/06, Richard M. Heiberger <rmh at temple.edu> wrote:
> From: Prof Brian Ripley
> > There is no '2.4.1', and your R-devel is not very recent.
>
> Apologies on the typo and the two-week old 2.4.0dev.
>
> I just downloaded
>    version 2.4.0 Under development (unstable) (2006-09-04 r39086)
>
>
> 1.
> > You set cpv$clip <- "off" and the internal code assumes that it is logical
> > (as the message says).  I can't find any documentation to support your
> > code: if there is some please report it to the maintainer of grid (Paul
> > Murrell).
>
> The documentation for "off" comes from ?viewport that is part of 2.4.0dev.
> > installed.packages()["grid",]
>                            Package                            LibPath
>                             "grid" "C:/PROGRA~1/R/R-24~1.0DE/library"
>                            Version                           Priority
>                            "2.4.0"                             "base"
>                             Bundle                           Contains
>                                 NA                                 NA
>                            Depends                            Imports
>                        "grDevices"                                 NA
>                           Suggests                              Built
>                          "lattice"                            "2.4.0"
>
> clip
>     One of "on", "inherit", or "off", indicating whether to clip to the
>     extent of this viewport, inherit the clipping region from the parent
>     viewport, or turn clipping off altogether. For back-compatibility, a
>     logical value of TRUE corresponds to "on" and FALSE corresponds to
>     "inherit".
>
> The above description of clip is identical to the description in
> ?viewport in the released 2.3.1.

As far as I can tell, this description applies to the 'clip' argument
of the function 'viewport'. In your call

cpv$clip <- "off"

cpv is the return value of a viewport() call. The only description I
see of the return value is

Value:

     An R object of class 'viewport'.

No one is giving you any guarantees that this is a list or similar
object, let alone that it will further contain a component called
'clip' that you are allowed to modify. I don't see how the description
of a function argument you have quoted has any relevance to the use
which is giving you an error.

> I still get the same error in 2.4.0dev that did not appear in 2.3.1
> and it still looks to me like this is an equally valid statement in both
> versions of R.

Which is another way of saying that the statement is equally invalid
in both versions of R. Your use is in fact invalid, and the newer
version complains about it while the older did not.

> >  Error in grid.Call.graphics("L_setviewport", pvp, TRUE) :
> >          LOGICAL() can only be applied to a 'logical', not a 'character'
> >  >
>
> I think something needs to be changed to make the documentation and the
> program consistent.

If by that you mean you want R to throw an error everytime you do
something that is not documented, that's never going to happen.

> I like the documentation, with the three options
> for clipping, and hope to see the program changed to match it.

The program does exactly what the documentation says (or am I missing
something?). The three options for clipping _are_ available to you
when you create a viewport using the viewport() function.

Deepayan

[...]



From rmh at temple.edu  Wed Sep  6 02:56:07 2006
From: rmh at temple.edu (Richard M. Heiberger)
Date: Tue,  5 Sep 2006 20:56:07 -0400 (EDT)
Subject: [Rd] enhancement request for labeling help windows in Windows
Message-ID: <20060905205607.BHI62206@po-d.temple.edu>

I am looking at the HTML Help Workshop which I got from wherever
your website told me to get it.

There is no documentation in the material I have.  My guess is that one
of the variables in the file  "c:/Program Files/HTML Help Workshop/include/htmlhelp.h"
needs to be changed.  My first guess is the line
    LPCTSTR pszCaption;      // IN/OUT: Window title
although how to change the value of pszCaption is not at all obvious.

I opened up the .chm files in emacs for other applications and they all
have a string buried inside that contains the name that appears on the window.

Rich



From rmh at temple.edu  Wed Sep  6 04:30:31 2006
From: rmh at temple.edu (Richard M. Heiberger)
Date: Tue,  5 Sep 2006 22:30:31 -0400 (EDT)
Subject: [Rd] Two submitted packages
Message-ID: <20060905223031.BHI71699@po-d.temple.edu>

Deepayan wrote:

> > xyplot(y ~ x | a,
> >        data=tmp, ylim=c(1.5,4.5),
> >        par.settings = list(clip = list(panel = "off")),
> >        layout=c(2,2))
> 
> I'm curious to know why this functionality is not enough.


## 1. Here is a more realistic example.

tmp <- data.frame(x=1:5, y=1:5, a=factor(c(1,1,1,1,1), levels=1:4))

## This gives what I want.
## It looks like the upViewport/downViewport sequence is the control I
## should be using.  If this is a stable sequence, it answers my needs.
xyplot(y ~ x,
       data=tmp, ylim=c(1.5,4.5),
       panel=function(...) {
          panel.xyplot(...)
            upViewport()
            downViewport(trellis.vpname("panel",
                                        row = 1, column = 1, clip.off = TRUE))
          panel.axis(side="right", outside=TRUE)
       },
       layout=c(2,2),
       main="right axis visible by control, points clipped by default")

## If I turned off clipping at the top, I would get the unwanted points
## plotted outside the figure region.
xyplot(y ~ x,
       data=tmp, ylim=c(1.5,4.5),
       par.settings = list(clip = list(panel = "off")),
       panel=function(...) {
          panel.xyplot(...)
          panel.axis(side="right", outside=TRUE)
       },
       layout=c(2,2),
       main="right axis visible by control, points not clipped")


## this is what happens if I don't do any control of clipping
xyplot(y ~ x,
       data=tmp, ylim=c(1.5,4.5),
       panel=function(...) {
          panel.xyplot(...)
          panel.axis(side="right", outside=TRUE)
       },
       layout=c(2,2),
       main="right axis invisible by clipping, points clipped by default")


## This doesn't work, but it illustrates the syntax I would like.
xyplot(y ~ x,
       data=tmp, ylim=c(1.5,4.5),
       panel=function(...) {
          panel.xyplot(...)
          panel.axis(side="right", outside=TRUE, clip="off")
       },
       layout=c(2,2),
       main="right axis visible by control, points clipped by default")




## 2
> Unfortunately, there is currently no easy way to find out which column
> and row the current panel occupies. I plan to make some changes before
> R 2.4.0 is released that should expose that information, so please try
> again in a few weeks.

The way I have been using is to back up the calling sequence and
use statements like
{
    ## This loop is needed because
    ##    console usage has i=2,
    ##    Rcmdr script window has i=5,
    ##    Rcmdr justDoIt has i=20
    for (i in seq(2, length=30)) {
      sf2 <- sys.frame(i)
      column.tmp <- try(get("column", pos=sf2), silent=TRUE)
      if (class(column.tmp) != "try-error") break
    }
    if (class(column.tmp) == "try-error")
      stop("panel.interaction2wt is too deeply nested in the system stack.")
    row <- get("row", pos=sf2)
    column <- get("column", pos=sf2)
    cols.per.page <- get("cols.per.page", pos=sf2)
    rows.per.page <- get("rows.per.page", pos=sf2)
  }

## A cleaner way would be preferable.  Will the above stay valid?  The
## need for a loop to find out how far up the calling sequence to go
## caught me by surprise.  I don't understand why generating commands
## the way Rcmdr does it should have an effect on the depth of the
## calling sequence.



From deepayan.sarkar at gmail.com  Wed Sep  6 05:28:57 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Tue, 5 Sep 2006 20:28:57 -0700
Subject: [Rd] Two submitted packages
In-Reply-To: <20060905223031.BHI71699@po-d.temple.edu>
References: <20060905223031.BHI71699@po-d.temple.edu>
Message-ID: <eb555e660609052028t45899247lc443af40da9ebbda@mail.gmail.com>

On 9/5/06, Richard M. Heiberger <rmh at temple.edu> wrote:
> Deepayan wrote:
>
> > > xyplot(y ~ x | a,
> > >        data=tmp, ylim=c(1.5,4.5),
> > >        par.settings = list(clip = list(panel = "off")),
> > >        layout=c(2,2))
> >
> > I'm curious to know why this functionality is not enough.
>
>
> ## 1. Here is a more realistic example.
>
> tmp <- data.frame(x=1:5, y=1:5, a=factor(c(1,1,1,1,1), levels=1:4))
>
> ## This gives what I want.
> ## It looks like the upViewport/downViewport sequence is the control I
> ## should be using.  If this is a stable sequence, it answers my needs.
> xyplot(y ~ x,
>        data=tmp, ylim=c(1.5,4.5),
>        panel=function(...) {
>           panel.xyplot(...)
>             upViewport()
>             downViewport(trellis.vpname("panel",
>                                         row = 1, column = 1, clip.off = TRUE))
>           panel.axis(side="right", outside=TRUE)
>        },
>        layout=c(2,2),
>        main="right axis visible by control, points clipped by default")
>
> ## If I turned off clipping at the top, I would get the unwanted points
> ## plotted outside the figure region.
> xyplot(y ~ x,
>        data=tmp, ylim=c(1.5,4.5),
>        par.settings = list(clip = list(panel = "off")),
>        panel=function(...) {
>           panel.xyplot(...)
>           panel.axis(side="right", outside=TRUE)
>        },
>        layout=c(2,2),
>        main="right axis visible by control, points not clipped")

I see.

> ## This doesn't work, but it illustrates the syntax I would like.
> xyplot(y ~ x,
>        data=tmp, ylim=c(1.5,4.5),
>        panel=function(...) {
>           panel.xyplot(...)
>           panel.axis(side="right", outside=TRUE, clip="off")
>        },
>        layout=c(2,2),
>        main="right axis visible by control, points clipped by default")

This might be possible, but there is a potential for unanticipated
problems. On the other hand, it's easy to achieve the equivalent of
this with a couple of extra lines, e.g.

xyplot(y ~ x,
       data=tmp, ylim=c(1.5,4.5),
       panel=function(...) {
           cpl <- current.panel.limits()
           panel.xyplot(...)
           pushViewport(viewport(xscale = cpl$xlim,
                                 yscale = cpl$ylim,
                                 clip = "off"))
           ## put anything you want unclipped inside this:
           panel.axis(side="right", outside=TRUE)
           ## end of unclipped part
           upViewport()
       },
       layout=c(2,2))

This already works, and should be stable, but I'm not sure; Paul has
previously mentioned this feature that an unclipped viewport inside a
clipped viewport allows plotting outside the clipped one, but I don't
know if that's intentional. Even if this behaviour does change, the
opposite should be stable: turn off clipping globally and then insert
the part of the panel function you want clipped into a clipped
viewport, e.g.:

xyplot(y ~ x,
       data=tmp, ylim=c(1.5,4.5),
       par.settings = list(clip = list(panel = "off")),
       panel=function(...) {
           cpl <- current.panel.limits()
           pushViewport(viewport(xscale = cpl$xlim,
                                 yscale = cpl$ylim,
                                 clip = "on"))
           panel.xyplot(...)
           upViewport()
           panel.axis(side="right", outside=TRUE)
       },
       layout=c(2,2))

> ## 2
> > Unfortunately, there is currently no easy way to find out which column
> > and row the current panel occupies. I plan to make some changes before
> > R 2.4.0 is released that should expose that information, so please try
> > again in a few weeks.
>
> The way I have been using is to back up the calling sequence and
> use statements like
> {
>     ## This loop is needed because
>     ##    console usage has i=2,
>     ##    Rcmdr script window has i=5,
>     ##    Rcmdr justDoIt has i=20
>     for (i in seq(2, length=30)) {
>       sf2 <- sys.frame(i)
>       column.tmp <- try(get("column", pos=sf2), silent=TRUE)
>       if (class(column.tmp) != "try-error") break
>     }
>     if (class(column.tmp) == "try-error")
>       stop("panel.interaction2wt is too deeply nested in the system stack.")
>     row <- get("row", pos=sf2)
>     column <- get("column", pos=sf2)
>     cols.per.page <- get("cols.per.page", pos=sf2)
>     rows.per.page <- get("rows.per.page", pos=sf2)
>   }
>
> ## A cleaner way would be preferable.  Will the above stay valid?  The
> ## need for a loop to find out how far up the calling sequence to go
> ## caught me by surprise.  I don't understand why generating commands
> ## the way Rcmdr does it should have an effect on the depth of the
> ## calling sequence.

I hope to add 3 new features before R 2.4.0, two of which are relevant
for you: (1) more control over axis annotation and (2) an API to
access auxiliary information (like row/column/layout) from inside a
panel function. I should have a testable version in a week or so,
after which I'll be happy to consider suggestions for further
additions.

Deepayan



From p.murrell at auckland.ac.nz  Wed Sep  6 05:35:28 2006
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Wed, 06 Sep 2006 15:35:28 +1200
Subject: [Rd] Two submitted packages
In-Reply-To: <eb555e660609052028t45899247lc443af40da9ebbda@mail.gmail.com>
References: <20060905223031.BHI71699@po-d.temple.edu>
	<eb555e660609052028t45899247lc443af40da9ebbda@mail.gmail.com>
Message-ID: <44FE4200.5030908@stat.auckland.ac.nz>

Hi


Deepayan Sarkar wrote:
> On 9/5/06, Richard M. Heiberger <rmh at temple.edu> wrote:
>> Deepayan wrote:
>>
>>>> xyplot(y ~ x | a,
>>>>        data=tmp, ylim=c(1.5,4.5),
>>>>        par.settings = list(clip = list(panel = "off")),
>>>>        layout=c(2,2))
>>> I'm curious to know why this functionality is not enough.
>>
>> ## 1. Here is a more realistic example.
>>
>> tmp <- data.frame(x=1:5, y=1:5, a=factor(c(1,1,1,1,1), levels=1:4))
>>
>> ## This gives what I want.
>> ## It looks like the upViewport/downViewport sequence is the control I
>> ## should be using.  If this is a stable sequence, it answers my needs.
>> xyplot(y ~ x,
>>        data=tmp, ylim=c(1.5,4.5),
>>        panel=function(...) {
>>           panel.xyplot(...)
>>             upViewport()
>>             downViewport(trellis.vpname("panel",
>>                                         row = 1, column = 1, clip.off = TRUE))
>>           panel.axis(side="right", outside=TRUE)
>>        },
>>        layout=c(2,2),
>>        main="right axis visible by control, points clipped by default")
>>
>> ## If I turned off clipping at the top, I would get the unwanted points
>> ## plotted outside the figure region.
>> xyplot(y ~ x,
>>        data=tmp, ylim=c(1.5,4.5),
>>        par.settings = list(clip = list(panel = "off")),
>>        panel=function(...) {
>>           panel.xyplot(...)
>>           panel.axis(side="right", outside=TRUE)
>>        },
>>        layout=c(2,2),
>>        main="right axis visible by control, points not clipped")
> 
> I see.
> 
>> ## This doesn't work, but it illustrates the syntax I would like.
>> xyplot(y ~ x,
>>        data=tmp, ylim=c(1.5,4.5),
>>        panel=function(...) {
>>           panel.xyplot(...)
>>           panel.axis(side="right", outside=TRUE, clip="off")
>>        },
>>        layout=c(2,2),
>>        main="right axis visible by control, points clipped by default")
> 
> This might be possible, but there is a potential for unanticipated
> problems. On the other hand, it's easy to achieve the equivalent of
> this with a couple of extra lines, e.g.
> 
> xyplot(y ~ x,
>        data=tmp, ylim=c(1.5,4.5),
>        panel=function(...) {
>            cpl <- current.panel.limits()
>            panel.xyplot(...)
>            pushViewport(viewport(xscale = cpl$xlim,
>                                  yscale = cpl$ylim,
>                                  clip = "off"))
>            ## put anything you want unclipped inside this:
>            panel.axis(side="right", outside=TRUE)
>            ## end of unclipped part
>            upViewport()
>        },
>        layout=c(2,2))
> 
> This already works, and should be stable, but I'm not sure; Paul has
> previously mentioned this feature that an unclipped viewport inside a
> clipped viewport allows plotting outside the clipped one, but I don't
> know if that's intentional. 


Yep, that's intentional.

Paul


Even if this behaviour does change, the
> opposite should be stable: turn off clipping globally and then insert
> the part of the panel function you want clipped into a clipped
> viewport, e.g.:
> 
> xyplot(y ~ x,
>        data=tmp, ylim=c(1.5,4.5),
>        par.settings = list(clip = list(panel = "off")),
>        panel=function(...) {
>            cpl <- current.panel.limits()
>            pushViewport(viewport(xscale = cpl$xlim,
>                                  yscale = cpl$ylim,
>                                  clip = "on"))
>            panel.xyplot(...)
>            upViewport()
>            panel.axis(side="right", outside=TRUE)
>        },
>        layout=c(2,2))
> 
>> ## 2
>>> Unfortunately, there is currently no easy way to find out which column
>>> and row the current panel occupies. I plan to make some changes before
>>> R 2.4.0 is released that should expose that information, so please try
>>> again in a few weeks.
>> The way I have been using is to back up the calling sequence and
>> use statements like
>> {
>>     ## This loop is needed because
>>     ##    console usage has i=2,
>>     ##    Rcmdr script window has i=5,
>>     ##    Rcmdr justDoIt has i=20
>>     for (i in seq(2, length=30)) {
>>       sf2 <- sys.frame(i)
>>       column.tmp <- try(get("column", pos=sf2), silent=TRUE)
>>       if (class(column.tmp) != "try-error") break
>>     }
>>     if (class(column.tmp) == "try-error")
>>       stop("panel.interaction2wt is too deeply nested in the system stack.")
>>     row <- get("row", pos=sf2)
>>     column <- get("column", pos=sf2)
>>     cols.per.page <- get("cols.per.page", pos=sf2)
>>     rows.per.page <- get("rows.per.page", pos=sf2)
>>   }
>>
>> ## A cleaner way would be preferable.  Will the above stay valid?  The
>> ## need for a loop to find out how far up the calling sequence to go
>> ## caught me by surprise.  I don't understand why generating commands
>> ## the way Rcmdr does it should have an effect on the depth of the
>> ## calling sequence.
> 
> I hope to add 3 new features before R 2.4.0, two of which are relevant
> for you: (1) more control over axis annotation and (2) an API to
> access auxiliary information (like row/column/layout) from inside a
> panel function. I should have a testable version in a week or so,
> after which I'll be happy to consider suggestions for further
> additions.
> 
> Deepayan
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/



From amaliy1 at uic.edu  Wed Sep  6 05:50:30 2006
From: amaliy1 at uic.edu (Anil Maliyekkel)
Date: Tue, 5 Sep 2006 22:50:30 -0500
Subject: [Rd] (PR#9202) Re: Bugs with partial name matching
In-Reply-To: <Pine.LNX.4.64.0609051542310.17674@homer23.u.washington.edu>
References: <20060905014002.634C928F8E@slim.kubism.ku.dk>
	<Pine.LNX.4.64.0609051507530.17674@homer23.u.washington.edu>
	<Pine.LNX.4.64.0609051542310.17674@homer23.u.washington.edu>
Message-ID: <69C0202D-ED5A-495A-9F38-FD2F7F132C29@uic.edu>


On Sep 5, 2006, at 5:54 PM, Thomas Lumley wrote:
> The problem in
>> D = list(ABCD=2:1)
>>  D$ABC[]<-3:4
>> D
> $ABCD
> [1] 3 4
>
> $ABC
> [1] 3 4
>
> is that eval.c:evalseq ends up with a reference to D$ABCD from  
> evaluating D$ABC with partial matching.  Since evalseq doesn't (and  
> shouldn't) increase NAMED on these partially evaluated calls, NAMED  
> is still 1 for D$ABCD.  When evalseq's D$ABC has 3:4 assigned into  
> it the vector is changed directly, since NAMED=1, and both D$ABC  
> and D$ABCD change.

This problem does not appear when the following is done

 > D = list(ABCD=2:1)
 > D$ABC[]=c(3,4)
 > D
$ABCD
[1] 2 1

$ABC
[1] 3 4

Or when this is done:

 > D = list(ABCD=2:1)
 > D[["ABC"]][]=3:4
 > D
$ABCD
[1] 2 1

$ABC
[1] 3 4


But it does appear when the following is done:

 > D = list(ABCD=2:1)
 > X = 3:4
 > D$ABC[]=X
 > D
$ABCD
[1] 3 4

$ABC
[1] 3 4

But not when the following is done:
 > D = list(ABCD=2:1)
 > X = 3:4
 > X[1] = 1
 > D$ABC[]=X
 > D
$ABCD
[1] 2 1

$ABC
[1] 1 4

It appears to be a sequence specific bug for the $ operator, which  
might explain why it did not occur with my original examples where I  
had a character data column, but did appear where I had a numeric  
data column that was a sequence.

Going back to the original partial replacement problem, is there  
anyway to turn off partial matching, or to selectively apply exact  
matching when trying to access a single element?  I can get the  
desired single element match using the convoluted syntax D["ABC"] 
[[1]] and perform partial replacement operations on a new column.   
However, it would be nice to have single element access operator that  
does exact matching.

Anil



From maechler at stat.math.ethz.ch  Wed Sep  6 09:27:44 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 6 Sep 2006 09:27:44 +0200
Subject: [Rd] (PR#9202) Re: Bugs with partial name matching
In-Reply-To: <69C0202D-ED5A-495A-9F38-FD2F7F132C29@uic.edu>
References: <20060905014002.634C928F8E@slim.kubism.ku.dk>
	<Pine.LNX.4.64.0609051507530.17674@homer23.u.washington.edu>
	<Pine.LNX.4.64.0609051542310.17674@homer23.u.washington.edu>
	<69C0202D-ED5A-495A-9F38-FD2F7F132C29@uic.edu>
Message-ID: <17662.30832.422990.781097@stat.math.ethz.ch>

>>>>> "Anil" == Anil Maliyekkel <amaliy1 at uic.edu>
>>>>>     on Tue, 5 Sep 2006 22:50:30 -0500 writes:

 [...................]
 [...................]

    Anil> Going back to the original partial replacement
    Anil> problem, is there anyway to turn off partial matching,

One way would be to use S4 classes (and '@') instead of lists
(and '$'). 
That has other advantages  {?validObject; methods,..}, but also can be
a drawback to you since you need to know in advance
what "components" (called "slots" for S4 objects) your object
will be allowed to contain.

    Anil> or to selectively apply exact matching when trying to
    Anil> access a single element?  I can get the desired single
    Anil> element match using the convoluted syntax D["ABC"]
    Anil> [[1]] and perform partial replacement operations on a
    Anil> new column.  However, it would be nice to have single
    Anil> element access operator that does exact matching.

    Anil> Anil



From r.hankin at noc.soton.ac.uk  Wed Sep  6 10:21:00 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Wed, 6 Sep 2006 09:21:00 +0100
Subject: [Rd] setMethod("c") [was: setMethod("Summary")]
In-Reply-To: <44FD9C12.70705@r-project.org>
References: <C7B9E5CB-E340-445D-A5B9-FC86AB6CC1DE@soc.soton.ac.uk>
	<C4E5D78B-28AB-4A25-8112-3668F31444E4@mac.com>
	<E28E6E71-5DD8-4B38-81C9-BB6014F6C16E@soc.soton.ac.uk>
	<17661.14016.528539.481357@stat.math.ethz.ch>
	<528BF1A2-3961-454D-B32C-FEE1F756BBBD@soc.soton.ac.uk>
	<44FD978C.9020208@r-project.org> <44FD9C12.70705@r-project.org>
Message-ID: <95EB4180-77B6-41FC-9897-FDA61185BFE4@soc.soton.ac.uk>

Dear All

thank you for your continued patience and help.
The example in the Green Book is


setGeneric("max",
            function(x, ..., na.rm=FALSE){
              if(nDotArgs(...)>0){
                max(c(max(x, na.rm=na.rm), max(..., na.rm=na.rm)))
              } else {
                standardGeneric("max")
              }
            }
            )

The point of this example is to implement a tail recursion.    But it  
isn't applicable
to c() because it is a primitive function and the generic function  
cannot be changed:


setGeneric("c",
            function(x, ...){
              z <- list(...)
              if(length(z)>0){
                return(c(x, c(...)))
              } else {
                return(standardGeneric("c"))
              }
            }
            )


  gives the following error:


Error in setGeneric("c", function(x, ...) { :
	'c' is a primitive function;  methods can be defined, but the  
generic function is implicit, and cannot be changed.


OK,  plan B (or should that be plan A?) is to define cPair() and call  
that .
Minimal self-contained code follows


setClass("brob",
          representation = representation 
(x="numeric",positive="logical"),
          prototype      = list(x=numeric(),positive=logical())
          )


"brob" <- function(x,positive){
   if(missing(positive)){
     positive <- rep(TRUE,length(x))
   }
   if(length(positive)==1){
     positive <- rep(positive,length(x))
   }
   new("brob",x=x,positive=positive)
}

is.brob <- function(x){is(x,"brob")}

as.brob <- function(x){
   if(is.brob(x)){
     return(x)
   } else {
     return(brob(log(abs(x)),x>0))
   }
}


cWithMethods <- function(x, ..., recursive=TRUE) {
   if(nargs()<3){
     return(cPairOfBrobs(x, ...))
   } else {
     return(cPairOfBrobs(x, cWithMethods(...)))
   }
}

cPairOfBrobs <- function(x,y){
   x <- as.brob(x)
   y <- as.brob(y)
   brob(c(x at x,y at x),c(x at positive,y at positive))
}

setMethod("c",signature("brob"),cWithMethods)



But this has the same problem as before; if x is a brob,
then c(x,1) is fine but c(1,x) isn't:



  x <- new("brob",x=pi,positive=T)
  c(x,1)
An object of class "brob"
Slot "x":
[1] 3.141593 0.000000

Slot "positive":
[1] TRUE TRUE

 > c(1,x)
[[1]]
[1] 1




How do I tell setMethod("c", ...) to call the appropriate functions  
if any object passed to c()
is a brob?





On 5 Sep 2006, at 16:47, John Chambers wrote:

> (Before someone else can embarrass me with the reference)
>
> There is a variant on the c() example discussed in "Programming with
> Data", page 351, for the function max().
>
> John
>
> John Chambers wrote:
>> It's all very well to go on about efficiency, but the purpose of
>> statistical computing is insight into data, not saving CPU cycles (to
>> paraphrase Dick Hamming).
>>
>> S3 methods do some things fine; other tasks need more  
>> flexibility.  One
>> should ask what's important in a particular application and try to  
>> find
>> tools that match the needs well.
>>
>> Now, the c() function.  This has been discussed in various forms (and
>> languages) for some time.  As I remember and as far as I know, the  
>> only
>> really general way to ensure dispatch on _any_ applicable argument  
>> is to
>> turn the computation into a pair-wise one and define the methods  
>> (NOT S3
>> methods) for the two arguments of the pairwise function.
>>
>> I won't try to reproduce the details off the top of my head (if I  
>> locate
>> a reference I'll pass it on), but very roughly the idea is to say
>> something like
>>
>> cWithMethods <- function(x, ...) {
>>    if(nargs()<3)
>>       cPair(x,...)
>>     else
>>       cPair(x, cWithMethods(...))
>> }
>>
>> and then write methods for cPair().
>>
>> John
>>
>> Robin Hankin wrote:
>>
>>> Hello everybody.
>>>
>>> I didn't see Franklin's first message; sorry.
>>>
>>> Bearing in mind Professor Ripley's comments
>>> on the efficiency of S4 vs S3, I'm beginning to think I
>>>   should just stick with S3 methods for my brob objects.  After
>>> all, S3 was perfectly adequate for the onion package.
>>>
>>> Notwithstanding that,  here's my next problem.  I want to define a
>>> brob method for "c".  Using the example in package "arules" as a
>>> template (I couldn't see one in Matrix), I have
>>>
[snip]
>>>
>>>
>>> Now,  this works for something like
>>>
>>>> x <- new("brob",x=pi,positive=T)
>>>> c(x,x)
>>>
>>> but c(1,x) isn't dispatched to my function.  How to
>>> deal cleanly with this case?   Perhaps if any argument
>>> to c() is a brob object, I would like to coerce them all to brobs.
>>> Is this possible?
>>>
>>>

--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743



From Johannes.Prix at wu-wien.ac.at  Wed Sep  6 16:53:30 2006
From: Johannes.Prix at wu-wien.ac.at (Johannes.Prix at wu-wien.ac.at)
Date: Wed,  6 Sep 2006 16:53:30 +0200 (CEST)
Subject: [Rd] R 2.3.1 and R2.3.0 crash with system() and shell() commands
	(PR#9207)
Message-ID: <20060906145330.7FCFF4A005@slim.kubism.ku.dk>

Full_Name: Johannes Prix
Version: 2.3.1/2.3.0 not 2.1.1
OS: Windows XP Service Pack 2 Build 2600.xpsp_sp2_gdr.0503011519
Submission from: (NULL) (137.208.41.103)



In a vanilla R, version 2.3.1 or version 2.3.0 the following crashes:

system("gzip.exe")

where I did nothing, prior to this command, but change the directory to my other
working directory where there's gzip.exe.  Same happens for PUTTY's pscp.exe and
other commands.  Normally, I use a longer command line than the one above, but
it also crashes with this short one.  Makes no difference if  I use Rgui.exe or
Rterm.exe.  Same result with "shell" instead of "system".

With non-existing commands, I get

> system("asdf")
Warning message:
asdf nicht gefunden 
> 

It works on an 2.1.1 installation though.

The machine is otherwise "normal" but has lots of memory.

Any clues on how to circumvent this would be wonderful.  Otherwise I'll just
stick to the R-2.1.1 where it's working.  Please let me know if anything else in
this bug report is missing.

Thanks a lot and see ya, 
Johannes Prix.



From ripley at stats.ox.ac.uk  Wed Sep  6 17:22:25 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 6 Sep 2006 16:22:25 +0100 (BST)
Subject: [Rd] R 2.3.1 and R2.3.0 crash with system() and shell()
 commands (PR#9207)
In-Reply-To: <20060906145330.7FCFF4A005@slim.kubism.ku.dk>
References: <20060906145330.7FCFF4A005@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0609061621490.6227@gannet.stats.ox.ac.uk>

Works correctly for me in the Rtools directory on 2.3.1.

Any more clues as to how to reproduce this?

On Wed, 6 Sep 2006, Johannes.Prix at wu-wien.ac.at wrote:

> Full_Name: Johannes Prix
> Version: 2.3.1/2.3.0 not 2.1.1
> OS: Windows XP Service Pack 2 Build 2600.xpsp_sp2_gdr.0503011519
> Submission from: (NULL) (137.208.41.103)
> 
> 
> 
> In a vanilla R, version 2.3.1 or version 2.3.0 the following crashes:
> 
> system("gzip.exe")
> 
> where I did nothing, prior to this command, but change the directory to my other
> working directory where there's gzip.exe.  Same happens for PUTTY's pscp.exe and
> other commands.  Normally, I use a longer command line than the one above, but
> it also crashes with this short one.  Makes no difference if  I use Rgui.exe or
> Rterm.exe.  Same result with "shell" instead of "system".
> 
> With non-existing commands, I get
> 
> > system("asdf")
> Warning message:
> asdf nicht gefunden 
> > 
> 
> It works on an 2.1.1 installation though.
> 
> The machine is otherwise "normal" but has lots of memory.
> 
> Any clues on how to circumvent this would be wonderful.  Otherwise I'll just
> stick to the R-2.1.1 where it's working.  Please let me know if anything else in
> this bug report is missing.
> 
> Thanks a lot and see ya, 
> Johannes Prix.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From ripley at stats.ox.ac.uk  Wed Sep  6 17:22:40 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Wed,  6 Sep 2006 17:22:40 +0200 (CEST)
Subject: [Rd] R 2.3.1 and R2.3.0 crash with system() and shell()
	commands (PR#9208)
Message-ID: <20060906152240.442D758670@slim.kubism.ku.dk>

Works correctly for me in the Rtools directory on 2.3.1.

Any more clues as to how to reproduce this?

On Wed, 6 Sep 2006, Johannes.Prix at wu-wien.ac.at wrote:

> Full_Name: Johannes Prix
> Version: 2.3.1/2.3.0 not 2.1.1
> OS: Windows XP Service Pack 2 Build 2600.xpsp_sp2_gdr.0503011519
> Submission from: (NULL) (137.208.41.103)
> 
> 
> 
> In a vanilla R, version 2.3.1 or version 2.3.0 the following crashes:
> 
> system("gzip.exe")
> 
> where I did nothing, prior to this command, but change the directory to my other
> working directory where there's gzip.exe.  Same happens for PUTTY's pscp.exe and
> other commands.  Normally, I use a longer command line than the one above, but
> it also crashes with this short one.  Makes no difference if  I use Rgui.exe or
> Rterm.exe.  Same result with "shell" instead of "system".
> 
> With non-existing commands, I get
> 
> > system("asdf")
> Warning message:
> asdf nicht gefunden 
> > 
> 
> It works on an 2.1.1 installation though.
> 
> The machine is otherwise "normal" but has lots of memory.
> 
> Any clues on how to circumvent this would be wonderful.  Otherwise I'll just
> stick to the R-2.1.1 where it's working.  Please let me know if anything else in
> this bug report is missing.
> 
> Thanks a lot and see ya, 
> Johannes Prix.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From spector at stat.berkeley.edu  Wed Sep  6 18:02:31 2006
From: spector at stat.berkeley.edu (spector at stat.berkeley.edu)
Date: Wed,  6 Sep 2006 18:02:31 +0200 (CEST)
Subject: [Rd] JPEG struct mismatch on Intel Macs (PR#9209)
Message-ID: <20060906160231.4D46458670@slim.kubism.ku.dk>

Full_Name: Phil Spector
Version: 2.3.1
OS: Mac OS X (Tiger)
Submission from: (NULL) (128.32.135.22)


Trying to close a jpeg() device on an Intel Mac causes the following:

> jpeg('out.jpg')
> plot(1:10)
> dev.off()
JPEG parameter struct mismatch: library thinks size is 372, caller expects 376
null device
          1
>


An empty jpg file is produced in 'out.jpg'                                      
-                         

                                                   - Phil Spector
                                                     Statistical Computing
Facility
                                                     Department of Statistics
                                                     UC Berkeley



From bill at insightful.com  Wed Sep  6 18:29:46 2006
From: bill at insightful.com (Bill Dunlap)
Date: Wed, 6 Sep 2006 09:29:46 -0700 (PDT)
Subject: [Rd] enhancement request for labeling help windows in Windows
In-Reply-To: <20060905205607.BHI62206@po-d.temple.edu>
References: <20060905205607.BHI62206@po-d.temple.edu>
Message-ID: <Pine.GSO.4.56.0609060924210.9799@durian.statsci.com>

On Tue, 5 Sep 2006, Richard M. Heiberger wrote:

> I am looking at the HTML Help Workshop which I got from wherever
> your website told me to get it.
>
> There is no documentation in the material I have.  My guess is that one
> of the variables in the file  "c:/Program Files/HTML Help Workshop/include/htmlhelp.h"
> needs to be changed.  My first guess is the line
>     LPCTSTR pszCaption;      // IN/OUT: Window title
> although how to change the value of pszCaption is not at all obvious.
>
> I opened up the .chm files in emacs for other applications and they all
> have a string buried inside that contains the name that appears on the window.

I think the help window title comes from the
  Title=...
line in the *.hhp file.  share/perl/build-help-windows.pl:open_hhp()
adds a bunch of similar lines to the *.hhp file,
but not Title=.

See, e.g.,
  http://www.helpware.net/FAR/help/dlg_hhpedit_sec.htm

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."



From p.dalgaard at biostat.ku.dk  Wed Sep  6 18:34:05 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 06 Sep 2006 18:34:05 +0200
Subject: [Rd] JPEG struct mismatch on Intel Macs (PR#9209)
In-Reply-To: <20060906160231.4D46458670@slim.kubism.ku.dk>
References: <20060906160231.4D46458670@slim.kubism.ku.dk>
Message-ID: <x2y7sx0xaa.fsf@turmalin.kubism.ku.dk>

spector at stat.berkeley.edu writes:

> Full_Name: Phil Spector
> Version: 2.3.1
> OS: Mac OS X (Tiger)
> Submission from: (NULL) (128.32.135.22)
> 
> 
> Trying to close a jpeg() device on an Intel Mac causes the following:
> 
> > jpeg('out.jpg')
> > plot(1:10)
> > dev.off()
> JPEG parameter struct mismatch: library thinks size is 372, caller expects 376
> null device
>           1
> >
> 
> 
> An empty jpg file is produced in 'out.jpg'                
   
AFAICT, this wouldn't be a bug in R. Your version of R appears to
have been built with one version of the jpeg libraries and you have
another version installed. Unless we have a compiler issue and one
part is padding out to a multiple of 8 bytes.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From simon.urbanek at r-project.org  Wed Sep  6 19:15:34 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 6 Sep 2006 13:15:34 -0400
Subject: [Rd] JPEG struct mismatch on Intel Macs (PR#9209)
In-Reply-To: <x2y7sx0xaa.fsf@turmalin.kubism.ku.dk>
References: <20060906160231.4D46458670@slim.kubism.ku.dk>
	<x2y7sx0xaa.fsf@turmalin.kubism.ku.dk>
Message-ID: <9CE5E987-5C7B-465F-A48B-4414DB7CB8EF@r-project.org>


On Sep 6, 2006, at 12:34 PM, Peter Dalgaard wrote:

> spector at stat.berkeley.edu writes:
>
>> Full_Name: Phil Spector
>> Version: 2.3.1
>> OS: Mac OS X (Tiger)
>> Submission from: (NULL) (128.32.135.22)
>>
>>
>> Trying to close a jpeg() device on an Intel Mac causes the following:
>>
>>> jpeg('out.jpg')
>>> plot(1:10)
>>> dev.off()
>> JPEG parameter struct mismatch: library thinks size is 372, caller  
>> expects 376
>> null device
>>           1
>>>
>>
>>
>> An empty jpg file is produced in 'out.jpg'
>
> AFAICT, this wouldn't be a bug in R. Your version of R appears to  
> have been built with one version of the jpeg libraries and you have  
> another version installed. Unless we have a compiler issue and one  
> part is padding out to a multiple of 8 bytes.
>

Although it's not a bug in R, it is a problem with the Mac binary  
which uses static libjpeg. I have re-compiled libjpeg for Intel Mac  
so tonight's nightly build should be ok.

Thanks,
Simon



From simon.urbanek at r-project.org  Wed Sep  6 19:16:37 2006
From: simon.urbanek at r-project.org (simon.urbanek at r-project.org)
Date: Wed,  6 Sep 2006 19:16:37 +0200 (CEST)
Subject: [Rd] JPEG struct mismatch on Intel Macs (PR#9209)
Message-ID: <20060906171637.A249458664@slim.kubism.ku.dk>


On Sep 6, 2006, at 12:34 PM, Peter Dalgaard wrote:

> spector at stat.berkeley.edu writes:
>
>> Full_Name: Phil Spector
>> Version: 2.3.1
>> OS: Mac OS X (Tiger)
>> Submission from: (NULL) (128.32.135.22)
>>
>>
>> Trying to close a jpeg() device on an Intel Mac causes the following:
>>
>>> jpeg('out.jpg')
>>> plot(1:10)
>>> dev.off()
>> JPEG parameter struct mismatch: library thinks size is 372, caller  
>> expects 376
>> null device
>>           1
>>>
>>
>>
>> An empty jpg file is produced in 'out.jpg'
>
> AFAICT, this wouldn't be a bug in R. Your version of R appears to  
> have been built with one version of the jpeg libraries and you have  
> another version installed. Unless we have a compiler issue and one  
> part is padding out to a multiple of 8 bytes.
>

Although it's not a bug in R, it is a problem with the Mac binary  
which uses static libjpeg. I have re-compiled libjpeg for Intel Mac  
so tonight's nightly build should be ok.

Thanks,
Simon



From jmc at r-project.org  Wed Sep  6 19:32:18 2006
From: jmc at r-project.org (John Chambers)
Date: Wed, 06 Sep 2006 13:32:18 -0400
Subject: [Rd] setMethod("c") [was: setMethod("Summary")]
In-Reply-To: <95EB4180-77B6-41FC-9897-FDA61185BFE4@soc.soton.ac.uk>
References: <C7B9E5CB-E340-445D-A5B9-FC86AB6CC1DE@soc.soton.ac.uk>
	<C4E5D78B-28AB-4A25-8112-3668F31444E4@mac.com>
	<E28E6E71-5DD8-4B38-81C9-BB6014F6C16E@soc.soton.ac.uk>
	<17661.14016.528539.481357@stat.math.ethz.ch>
	<528BF1A2-3961-454D-B32C-FEE1F756BBBD@soc.soton.ac.uk>
	<44FD978C.9020208@r-project.org> <44FD9C12.70705@r-project.org>
	<95EB4180-77B6-41FC-9897-FDA61185BFE4@soc.soton.ac.uk>
Message-ID: <44FF0622.50705@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060906/ae206253/attachment-0003.pl 

From erich.neuwirth at univie.ac.at  Thu Sep  7 10:34:08 2006
From: erich.neuwirth at univie.ac.at (Erich Neuwirth)
Date: Thu, 07 Sep 2006 10:34:08 +0200
Subject: [Rd] Date conversion with as.POSIXct and as.POSIXlt
Message-ID: <44FFD980.1010608@univie.ac.at>

After the discussions which really helped me understanding
the issues involved let me summarize some possibly surprising
behavior of as.POSIXlt and as.POSIXct and the print method of
class POSIXlt (the print method problem seems to be a Windows
only problem) in R 2.3.1

- as.POSIXlt and as.POSIXct accept but ignore tz parameters
  when the argument object is of class Date. They do react to
  tz parameters when the argument object is a string representing
  a date.

> as.POSIXct(firstjan)
[1] "2006-01-01 01:00:00 CET"
> as.POSIXct(firstjan,tz="HST10")
[1] "2006-01-01 01:00:00 CET"
> as.POSIXlt(firstjan)
[1] "2006-01-01"
> as.POSIXlt(firstjan,tz="HST10")
[1] "2006-01-01"
> as.POSIXct(as.character(firstjan))
[1] "2006-01-01 CET"
> as.POSIXct(as.character(firstjan),tz="HST10")
[1] "2006-01-01 HST"
> as.POSIXlt(as.character(firstjan))
[1] "2006-01-01"
> as.POSIXlt(as.character(firstjan),tz="HST10")
[1] "2006-01-01 HST10"

  Furthermore, for string arguments the timezone label for as.POSIXct
  and as.POSIXlt is different in the example above ("HST" and "HST10")


- as.POSIXlt in R 2.4.0alpha (I could test this only on Windows)
  seems to behave slightly differently, it attaches timezone UTC
  for inputs of class Date.

> as.POSIXlt(firstjan)
[1] "2006-01-01 UTC"
> as.POSIXlt(firstjan,tz="HST10")
[1] "2006-01-01 UTC"

  It still does not attach a timezone if the input is a string
  representing a date (like in the first example).

- as.POSIXct will give different results for Date objects
  and their string representations in non-UTC timezones
  (the first example illustrates this fact)

- the print method for POSIXlt objects on Windows in some cases
  will not display the correct timezone label, it will convert it
  to a sometimes somewhat strange 3 letter string. The docs state
  that timezone labels have to have a standardized format,
  but (at least for me) it is unexpected that using Sys.timezone()
  as tz argument gives a very strange timezone label.	
  See the following example

> Sys.time()
[1] "2006-09-05 23:05:48 W. Europe Daylight Time"
> as.POSIXct(Sys.time(),tz=Sys.timezone())
[1] "2006-09-05 23:06:06 W. Europe Daylight Time"
> as.POSIXlt(Sys.time(),tz=Sys.timezone())
[1] "2006-09-05 22:06:11 Eur"

-- 
Erich Neuwirth, University of Vienna
Faculty of Computer Science
Computer Supported Didactics Working Group
Visit our SunSITE at http://sunsite.univie.ac.at
Phone: +43-1-4277-39464 Fax: +43-1-4277-39459



From r.hankin at noc.soton.ac.uk  Thu Sep  7 13:18:51 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Thu, 7 Sep 2006 12:18:51 +0100
Subject: [Rd] setMethod("c") [was: setMethod("Summary")]
In-Reply-To: <44FF0622.50705@r-project.org>
References: <C7B9E5CB-E340-445D-A5B9-FC86AB6CC1DE@soc.soton.ac.uk>
	<C4E5D78B-28AB-4A25-8112-3668F31444E4@mac.com>
	<E28E6E71-5DD8-4B38-81C9-BB6014F6C16E@soc.soton.ac.uk>
	<17661.14016.528539.481357@stat.math.ethz.ch>
	<528BF1A2-3961-454D-B32C-FEE1F756BBBD@soc.soton.ac.uk>
	<44FD978C.9020208@r-project.org> <44FD9C12.70705@r-project.org>
	<95EB4180-77B6-41FC-9897-FDA61185BFE4@soc.soton.ac.uk>
	<44FF0622.50705@r-project.org>
Message-ID: <5C9927A0-281D-4FD6-BE3B-EC3FB9B22713@soc.soton.ac.uk>

Thank you for this.   Minimal self-contained code included below.
It is slightly modified from the original because brob objects have two
slots, both of which are needed by c().

[
A "brob" obect is represents a real number with two slots: "x"  holds  
its natural
logarithm; slot "positive" is Boolean, indicating whether the number  
is positive.
I want this because I need to manipulate numbers up to ~1e20000.
The hard bit is addition:  log(exp(x) + exp(y)) == x + log1p(exp(y-x))
]

It seemed to make sense to coerce non-brob arguments to brobs,
then make cPair() use cPairOfBrobs() [with coerced arguments] in
three of the cases, and c() for the fourth with signature c("ANY",  
"ANY").

Now below, JC states that  "cWithMethods() _replaces_ the ordinary c 
(), it's not
just a method for it".  Does this imply that one cannot  set up an R  
package
so that the following code:

x <- as.brob(1:10)
x1 <- c(1,x)
x2 <- c(x,1)

works as expected?  Or is there some workaround that would enable
me to do this?




best wishes

Robin



setClass("brob",
          representation = representation 
(x="numeric",positive="logical"),
          prototype      = list(x=numeric(),positive=logical())
          )


"brob" <- function(x,positive){
   if(missing(positive)){
     positive <- rep(TRUE,length(x))
   }
   if(length(positive)==1){
     positive <- rep(positive,length(x))
   }
   new("brob",x=x,positive=positive)
}

is.brob <- function(x){is(x,"brob")}

as.brob <- function(x){
   if(is.brob(x)){
     return(x)
   } else {
     return(brob(log(abs(x)),x>0))
   }
}


cWithMethods <- function(x, ...) {
    if(nargs()<3)
       cPair(x,...)
     else
       cPair(x, cWithMethods(...))
}


cPairOfBrobs <- function(x,y){
   x <- as.brob(x)
   y <- as.brob(y)
   brob(c(x at x,y at x),c(x at positive,y at positive))
}

setGeneric("cPair", function(x,y)standardGeneric("cPair"))

setMethod("cPair", c("brob", "brob"), function(x,y)cPairOfBrobs(x,y))
setMethod("cPair", c("brob", "ANY"),  function(x,y)cPairOfBrobs 
(x,as.brob(y)))
setMethod("cPair", c("ANY", "brob"),  function(x,y)cPairOfBrobs 
(as.brob(x),y))
setMethod("cPair", c("ANY", "ANY"), function(x,y)c(x,y))








On 6 Sep 2006, at 18:32, John Chambers wrote:

> You missed the point of the example, which is why your own
> implementation didn't work.
>
> It's not the tail recursion that is important, but the recasting of
> max() (or of c()) to not just a standard generic, but to a recursive
> computation, so that methods need only be defined for  a finite number
> of arguments.
>
> Because the recursion in c() requires two arguments, not one as with
> max(), the methods are more naturally transferred to an auxiliary
> function, cPair in my sketch.  Then cWithMethods _replaces_ the  
> ordinary
> c(), it's not just a method for it.
>
> Also required are a set of methods that corresponds to what you  
> want to
> do.  The methods apply, as I said before, to cPair(), which is a  
> generic
> with two arguments.
>
> If your picture is that you can bind your class to anything, in either
> order, then you need methods for ("ANY", "brob") and ("brob",  
> "ANY"), as
> well as the method ("brob", "brob"), equivalent to the function
> cPairOfBrobs(), and a default method that just uses c().
>
> Something like:
> ---------------------
> cWithMethods <- function(x, ...) {
>    if(nargs()<3)
>       cPair(x,...)
>     else
>       cPair(x, cWithMethods(...))
> }
>
> setGeneric("cPair", function(x,y)standardGeneric("cPair"))
>
> setMethod("cPair", c("brob", "brob"), function(x,y)cPairOfBrobs(x,y))
>
> setMethod("cPair", c("brob", "ANY"), function(x,y)c(x at x, y))
>
> setMethod("cPair", c("ANY", "brob"), function(x,y)c(x, y at x))
>
> setMethod("cPair", c("ANY", "ANY"), function(x,y)c(x,y))
>
>
> Robin Hankin wrote:
>>
[snip]

--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743



From maechler at stat.math.ethz.ch  Thu Sep  7 15:01:51 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 7 Sep 2006 15:01:51 +0200
Subject: [Rd] setMethod("c") [was: setMethod("Summary")]
In-Reply-To: <5C9927A0-281D-4FD6-BE3B-EC3FB9B22713@soc.soton.ac.uk>
References: <C7B9E5CB-E340-445D-A5B9-FC86AB6CC1DE@soc.soton.ac.uk>
	<C4E5D78B-28AB-4A25-8112-3668F31444E4@mac.com>
	<E28E6E71-5DD8-4B38-81C9-BB6014F6C16E@soc.soton.ac.uk>
	<17661.14016.528539.481357@stat.math.ethz.ch>
	<528BF1A2-3961-454D-B32C-FEE1F756BBBD@soc.soton.ac.uk>
	<44FD978C.9020208@r-project.org> <44FD9C12.70705@r-project.org>
	<95EB4180-77B6-41FC-9897-FDA61185BFE4@soc.soton.ac.uk>
	<44FF0622.50705@r-project.org>
	<5C9927A0-281D-4FD6-BE3B-EC3FB9B22713@soc.soton.ac.uk>
Message-ID: <17664.6207.726759.686976@stat.math.ethz.ch>

>>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
>>>>>     on Thu, 7 Sep 2006 12:18:51 +0100 writes:

    Robin> Thank you for this.   Minimal self-contained code included below.
    Robin> It is slightly modified from the original because brob objects have two
    Robin> slots, both of which are needed by c().

    Robin> [
    Robin> A "brob" obect is represents a real number with two slots: "x"  holds  
    Robin> its natural
    Robin> logarithm; slot "positive" is Boolean, indicating whether the number  
    Robin> is positive.
    Robin> I want this because I need to manipulate numbers up to ~1e20000.
    Robin> The hard bit is addition:  log(exp(x) + exp(y)) == x + log1p(exp(y-x))
    Robin> ]

I know and I really like your idea.
However....

    Robin> It seemed to make sense to coerce non-brob arguments to brobs,
    Robin> then make cPair() use cPairOfBrobs() [with coerced arguments] in
    Robin> three of the cases, and c() for the fourth with signature c("ANY",  
    Robin> "ANY").

    Robin> Now below, JC states that  "cWithMethods() _replaces_ the ordinary c 
    Robin> (), it's not
    Robin> just a method for it".  Does this imply that one cannot  set up an R  
    Robin> package
    Robin> so that the following code:

    Robin> x <- as.brob(1:10)
    Robin> x1 <- c(1,x)
    Robin> x2 <- c(x,1)

    Robin> works as expected?  

No. There's no way {which does not break much other R code} currently.
More than two days ago, 
I had told you (and the R-devel readers) that you should look at
   help(cbind2)  {and said why}.
If you *really* look at it, and then 
think about or better study the code underlying
the      methods:::bind_activation(TRUE)
kludge,
you will shudder (and run :-) and probably understand that a
similar kludge for c() is not appropriate.

    Robin> Or is there some workaround that would enable me to do this?

well, yes: As John Chambers has tried to say, you have to teach
your users to use  cWithPairs() or c2() or myC() or c.() or any
reasonable name,  but not c().

Martin



From jmc at r-project.org  Thu Sep  7 15:16:22 2006
From: jmc at r-project.org (John Chambers)
Date: Thu, 07 Sep 2006 09:16:22 -0400
Subject: [Rd] setMethod("c") [was: setMethod("Summary")]
In-Reply-To: <17664.6207.726759.686976@stat.math.ethz.ch>
References: <C7B9E5CB-E340-445D-A5B9-FC86AB6CC1DE@soc.soton.ac.uk>
	<C4E5D78B-28AB-4A25-8112-3668F31444E4@mac.com>
	<E28E6E71-5DD8-4B38-81C9-BB6014F6C16E@soc.soton.ac.uk>
	<17661.14016.528539.481357@stat.math.ethz.ch>
	<528BF1A2-3961-454D-B32C-FEE1F756BBBD@soc.soton.ac.uk>
	<44FD978C.9020208@r-project.org>	<44FD9C12.70705@r-project.org>
	<95EB4180-77B6-41FC-9897-FDA61185BFE4@soc.soton.ac.uk>
	<44FF0622.50705@r-project.org>
	<5C9927A0-281D-4FD6-BE3B-EC3FB9B22713@soc.soton.ac.uk>
	<17664.6207.726759.686976@stat.math.ethz.ch>
Message-ID: <45001BA6.5020001@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060907/2aaa67ac/attachment-0003.pl 

From kjetilbrinchmannhalvorsen at gmail.com  Thu Sep  7 20:02:58 2006
From: kjetilbrinchmannhalvorsen at gmail.com (Kjetil Halvorsen)
Date: Thu, 7 Sep 2006 14:02:58 -0400
Subject: [Rd] Matrix package in R-2.4.0alpha
Message-ID: <556e90a80609071102n48897aag68928cd0dde0b246@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060907/cbbeb857/attachment-0003.pl 

From ripley at stats.ox.ac.uk  Thu Sep  7 20:31:00 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 7 Sep 2006 19:31:00 +0100 (BST)
Subject: [Rd] Matrix package in R-2.4.0alpha
In-Reply-To: <556e90a80609071102n48897aag68928cd0dde0b246@mail.gmail.com>
References: <556e90a80609071102n48897aag68928cd0dde0b246@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0609071927370.25865@gannet.stats.ox.ac.uk>

As you may know from the R-devel list, things are very fluid re S4 just 
now.

Which CRAN mirror did you use?  Windows 2.4 packages are only just on the 
master and may not have got to mirrors yet.

It does work for me compiling from source: you may want to try that.

B.

On Thu, 7 Sep 2006, Kjetil Halvorsen wrote:

> In a newly downloaded version (today) of R-2-4-0alpha, with all packages
> from CRAN also installed today, I get:
> 
> > library(Matrix)
> Erro en loadNamespace(package, c(which.lib.loc, lib.loc), keep.source =
> keep.source) :
>         in 'Matrix' methods specified for export, but none defined: BIC,
> anova, coef, confint, deviance, fitted, fixef, formula, head, lmer, logLik,
> mcmcsamp, plot, qqmath, ranef, residuals, resid, simulate, summary, tail,
> terms, update, vcov, VarCorr, with, cbind2, rbind2, Arith, Math, Math2,
> Summary, Compare, !, +, %*%, Schur, as.array, as.matrix, as.vector, band,
> chol, colMeans, colSums, coerce, crossprod, determinant, diag, dim,
> dimnames, dimnames<-, expand, expm, kronecker, image, isSymmetric, norm,
> rcond, rowMeans, rowSums, show, solve, t, tcrossprod, tril, triu
> Error: package/namespace load failed for 'Matrix'
> > sessionInfo()
> R version 2.4.0 alpha (2006-09-05 r39134)
> i386-pc-mingw32
> 
> locale:
> LC_COLLATE=Spanish_Chile.1252;LC_CTYPE=Spanish_Chile.1252;LC_MONETARY=Spanish_Chile.1252;LC_NUMERIC=C;LC_TIME=Spanish_Chile.1252
> 
> attached base packages:
> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"
> [7] "base"
> 
> other attached packages:
>   lattice
> "0.13-10"
> 
> 
> Kjetil
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From jmc at r-project.org  Thu Sep  7 20:55:35 2006
From: jmc at r-project.org (John Chambers)
Date: Thu, 07 Sep 2006 14:55:35 -0400
Subject: [Rd] Matrix package in R-2.4.0alpha
In-Reply-To: <556e90a80609071102n48897aag68928cd0dde0b246@mail.gmail.com>
References: <556e90a80609071102n48897aag68928cd0dde0b246@mail.gmail.com>
Message-ID: <45006B27.9080700@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060907/68a0541b/attachment-0003.pl 

From hb at stat.berkeley.edu  Fri Sep  8 01:14:07 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Thu, 7 Sep 2006 16:14:07 -0700
Subject: [Rd] R CMD check: unstated dependence on a standard package.
Message-ID: <59d7961d0609071614t1bb79b2r6bcf7049a178ab3d@mail.gmail.com>

In the recent R-devel version, I receive the following error:

* checking whether the package can be loaded with stated dependencies
... WARNING
Error in doTryCatch(return(expr), name, parentenv, handler) :
	could not find function "packageDescription"
Error in library(R.oo) : .First.lib failed for 'R.oo'
Execution halted

It looks like this package (or one of its dependent packages) has an
unstated dependence on a standard package.  All dependencies must be
declared in DESCRIPTION.
See the information on DESCRIPTION files in the chapter 'Creating R
packages' of the 'Writing R Extensions' manual.

I found the following comment in NEWS.R-2.5.0dev under "CHANGES IN R
VERSION 2.4.0" related to two packages only:

	- throws an error if the standard packages 'methods' and
          'stats4' are imported from and not declared in the
          DESCRIPTION file.

When I add 'utils' to "Depends:" in the DESCRIPTION file the error
goes away.  Could you please confirm that you from now on have to
specify also the 'utils' package and other standard package in
Depends?

Thanks

Henrik



From Kurt.Hornik at wu-wien.ac.at  Fri Sep  8 08:56:33 2006
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Fri, 8 Sep 2006 08:56:33 +0200
Subject: [Rd] R CMD check: unstated dependence on a standard package.
In-Reply-To: <59d7961d0609071614t1bb79b2r6bcf7049a178ab3d@mail.gmail.com>
References: <59d7961d0609071614t1bb79b2r6bcf7049a178ab3d@mail.gmail.com>
Message-ID: <17665.5153.202576.453435@mithrandir.hornik.net>

>>>>> Henrik Bengtsson writes:

> In the recent R-devel version, I receive the following error:
> * checking whether the package can be loaded with stated dependencies
> ... WARNING
> Error in doTryCatch(return(expr), name, parentenv, handler) :
> 	could not find function "packageDescription"
> Error in library(R.oo) : .First.lib failed for 'R.oo'
> Execution halted

> It looks like this package (or one of its dependent packages) has an
> unstated dependence on a standard package.  All dependencies must be
> declared in DESCRIPTION.
> See the information on DESCRIPTION files in the chapter 'Creating R
> packages' of the 'Writing R Extensions' manual.

> I found the following comment in NEWS.R-2.5.0dev under "CHANGES IN R
> VERSION 2.4.0" related to two packages only:

> 	- throws an error if the standard packages 'methods' and
>           'stats4' are imported from and not declared in the
>           DESCRIPTION file.

> When I add 'utils' to "Depends:" in the DESCRIPTION file the error
> goes away.  Could you please confirm that you from now on have to
> specify also the 'utils' package and other standard package in
> Depends?

Yes, strictness was increased.  In your non name space case, add to
Depends.  If the package had a name space, you would e.g. add

   importFrom("utils", "packageDescription")

to NAMESPACE and add utils to the DESCRIPTION Imports.

-k



From maechler at stat.math.ethz.ch  Fri Sep  8 15:13:31 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 8 Sep 2006 15:13:31 +0200
Subject: [Rd] [R] R drop behavior -- set as option in later version?
In-Reply-To: <loom.20060908T132749-283@post.gmane.org>
References: <39422c340609080251u6c367b5ch3ad0cbe33a87d015@mail.gmail.com>
	<loom.20060908T132749-283@post.gmane.org>
Message-ID: <17665.27771.344614.466034@stat.math.ethz.ch>


       >>> Balaji S. Srinivasan <balajis <at> stanford.edu> writes:

    Balaji> I know the topic of drop=TRUE/FALSE has been
    Balaji> discussed quite a bit,

 { indeed and often enough by great minds so that at one point in time
   newcomres could believe it was not worth the pain to take it up again ...
   There are many much more interesting problems to be tackled! 
 }


    Balaji> discussed quite a bit, but I was wondering whether
    Balaji> it might be possible to set "drop=FALSE" as a global
    Balaji> setting (e.g. as an option in options()) so that one
    Balaji> does not have to remember ...................

   [..........]

No, no, no!

In my book, options()  should  *NEVER* change fundamental
behavior of function of the S language (nor its R implementation).

Ideally, options() should only influence printed output;
pragmatically a few exceptions have been allowed,
but for some of them I'm not sure it was a wise decision to
introduce.

One of the major features and beauties of S it's that it is a
functional language {in most respects} and functions --- think
about a function in the mathematical sense! --- should not
return different results for the same function arguments
depending on some ``outer settings''.

At the first DSC meeting 1999 (and/or the second, 2001 ?),
several of the R developers had several chats with
John Eaton, author of GNU octave [the first matlab clone],
and I think he also had a talk on this:
He said one of the biggest mistakes (or even the only real bad
mistake) he made in octave development was to allow such
options, more and more, on user requests {many for matlab
compatibility, and matlab was inferior sometimes, and later
changed itself, etc etc}

    Balaji> I searched in R-help and did not see any previous
    Balaji> proposals along these lines,

for good reasons: 
    1) it does not at all belong to R-help, but to R-devel
    2) if you think more about it, as Gregor has in parts,

       see below.

 [..............]

    Gregor> I agree with you that you find yourself typing the
    Gregor> same constructs over and over. I think that we need
    Gregor> to distinguish two modes of working with R. If you
    Gregor> do analysis, then you can really get tired of typing
    Gregor> drop=FALSE, na.rm=TRUE etc.  But this things are
    Gregor> very important when you are programming in R. Since
    Gregor> these two modes are not really separated in R I do
    Gregor> not think this is an easy task, but it would be
    Gregor> great to have it. I had recently the same question
    Gregor> for na.rm=TRUE.  But imagine how hard would it be to
    Gregor> have two separate modes ... argh, probably a mess^2
    Gregor> or have I missed something obvious.

Yes, exactly : "Mess ^ 2" --- and if you allow both 'drop' and
'na.rm' options, it's  "Mess ^ 3" -- not something anyone really wants!

In the history of S, I think there have been several attempts of
having a hack and an ``own local better'' version of S (or R),
sometimes indeed implemented even via such an options() setting.

Longer term it always becomes a maintenance nightmare
(unless you want to entirely decouple from the rest of the progammeRs)!
Particularly with the high quality assurance code in effect for
R packages -- how could you try to ensure that all packages
work correctly with all such possible options() setting
combinations ??

Martin Maechler, ETH Zurich



From pbautist2 at yahoo.com.mx  Fri Sep  8 16:03:35 2006
From: pbautist2 at yahoo.com.mx (Patricia Bautista)
Date: Fri, 8 Sep 2006 09:03:35 -0500 (CDT)
Subject: [Rd] Complete documentation gram.y ??
Message-ID: <20060908140335.76780.qmail@web32706.mail.mud.yahoo.com>

Hi everybody, 

Does anybody know where I can find documentation about
file gram.y?. What I need to do is related to the
parse tree. I need the parse tree of a R user defined
function for being used by a c++ function. Briefly, I
have a C++ function that is used to generate random
numbers from a specified objective function and I want
to use R just to verified the sintaxis of the function
and I want C++ for doing the evaluations of the
mentioned function.

Thanks for any help in advance.
Patricia. 


	
	
		
___________________________________________________________ 
Do You Yahoo!? 
La mejor conexi?n a Internet y <b >2GB</b> extra a tu correo por $100 al mes. http://net.yahoo.com.mx



From murdoch at stats.uwo.ca  Fri Sep  8 16:10:11 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 08 Sep 2006 10:10:11 -0400
Subject: [Rd] Complete documentation gram.y ??
In-Reply-To: <20060908140335.76780.qmail@web32706.mail.mud.yahoo.com>
References: <20060908140335.76780.qmail@web32706.mail.mud.yahoo.com>
Message-ID: <450179C3.2030800@stats.uwo.ca>

On 9/8/2006 10:03 AM, Patricia Bautista wrote:
> Hi everybody, 
> 
> Does anybody know where I can find documentation about
> file gram.y?. 

It's input to bison (or yacc).  You could read bison documentation to 
find what it does.  I don't think there is any documentation for it 
other than that and the source code itself.

Duncan Murdoch


What I need to do is related to the
> parse tree. I need the parse tree of a R user defined
> function for being used by a c++ function. Briefly, I
> have a C++ function that is used to generate random
> numbers from a specified objective function and I want
> to use R just to verified the sintaxis of the function
> and I want C++ for doing the evaluations of the
> mentioned function.
> 
> Thanks for any help in advance.
> Patricia. 
> 
> 
> 	
> 	
> 		
> ___________________________________________________________ 
> Do You Yahoo!? 
> La mejor conexi?n a Internet y <b >2GB</b> extra a tu correo por $100 al mes. http://net.yahoo.com.mx
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



From jverzani at gmail.com  Fri Sep  8 18:04:24 2006
From: jverzani at gmail.com (jverzani at gmail.com)
Date: Fri,  8 Sep 2006 18:04:24 +0200 (CEST)
Subject: [Rd] Extending [ method to S4 class and drop argument (PR#9211)
Message-ID: <20060908160424.636BECCD9@slim.kubism.ku.dk>

Full_Name: John Verzani
Version: 2.4.0 alpha (2006-09-05 r39134)
OS: linux, gentoo 2.6.17
Submission from: (NULL) (163.238.43.26)


When extending the "[" method to a new S4 class, the default value for the drop
argument is not being found. Here is a small example:

setClass("test",representation(x="character"))
setMethod("[","test",function(x,i,j,...,drop=TRUE) {print(i);print(drop)})
a = new("test",x="fred")
a[1]

resulting in:

[1] 1
Error in print(drop) : argument "drop" is missing, with no default

I'm expecting TRUE for the value of drop. That's correct isn't?



From B.Rowlingson at lancaster.ac.uk  Fri Sep  8 18:08:07 2006
From: B.Rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 08 Sep 2006 17:08:07 +0100
Subject: [Rd] Complete documentation gram.y ??
In-Reply-To: <20060908140335.76780.qmail@web32706.mail.mud.yahoo.com>
References: <20060908140335.76780.qmail@web32706.mail.mud.yahoo.com>
Message-ID: <45019567.9060709@lancaster.ac.uk>

Patricia Bautista wrote:
> Hi everybody, 
> 
> Does anybody know where I can find documentation about
> file gram.y?. What I need to do is related to the
> parse tree. I need the parse tree of a R user defined
> function for being used by a c++ function. Briefly, I
> have a C++ function that is used to generate random
> numbers from a specified objective function and I want
> to use R just to verified the sintaxis of the function
> and I want C++ for doing the evaluations of the
> mentioned function.

  A function in R can't exist unless its syntactically correct. Or is 
your function reading a text representation of an R function (from a 
file or user input as a string)? In which case it would be easier to 
check the syntax from R just by using 'eval' in a 'try' clause, and then 
pass the function object to C++ in the usual documented way (as an SEXP).


Barry



From ggrothendieck at gmail.com  Fri Sep  8 18:12:55 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 8 Sep 2006 12:12:55 -0400
Subject: [Rd] Extending [ method to S4 class and drop argument (PR#9211)
In-Reply-To: <20060908160424.636BECCD9@slim.kubism.ku.dk>
References: <20060908160424.636BECCD9@slim.kubism.ku.dk>
Message-ID: <971536df0609080912w386d56d7vf9d064ccfa999dfe@mail.gmail.com>

Try this:

> setClass("test",representation(x="character"))
[1] "test"
> setMethod("[","test",function(x,i,j,...,drop) {
+    print(i)
+    if (missing(drop)) drop <- TRUE
+    print(drop)
+ })
[1] "["
> a = new("test",x="fred")
> a[1]
[1] 1
[1] TRUE


On 9/8/06, jverzani at gmail.com <jverzani at gmail.com> wrote:
> Full_Name: John Verzani
> Version: 2.4.0 alpha (2006-09-05 r39134)
> OS: linux, gentoo 2.6.17
> Submission from: (NULL) (163.238.43.26)
>
>
> When extending the "[" method to a new S4 class, the default value for the drop
> argument is not being found. Here is a small example:
>
> setClass("test",representation(x="character"))
> setMethod("[","test",function(x,i,j,...,drop=TRUE) {print(i);print(drop)})
> a = new("test",x="fred")
> a[1]
>
> resulting in:
>
> [1] 1
> Error in print(drop) : argument "drop" is missing, with no default
>
> I'm expecting TRUE for the value of drop. That's correct isn't?
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



From tlumley at u.washington.edu  Fri Sep  8 18:20:23 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Fri, 8 Sep 2006 09:20:23 -0700 (PDT)
Subject: [Rd] (PR#9202) Re: Bugs with partial name matching
In-Reply-To: <69C0202D-ED5A-495A-9F38-FD2F7F132C29@uic.edu>
References: <20060905014002.634C928F8E@slim.kubism.ku.dk>
	<Pine.LNX.4.64.0609051507530.17674@homer23.u.washington.edu>
	<Pine.LNX.4.64.0609051542310.17674@homer23.u.washington.edu>
	<69C0202D-ED5A-495A-9F38-FD2F7F132C29@uic.edu>
Message-ID: <Pine.LNX.4.64.0609080916200.24159@homer23.u.washington.edu>

On Tue, 5 Sep 2006, Anil Maliyekkel wrote:

> This problem does not appear when the following is done
>
> > D = list(ABCD=2:1)
> > D$ABC[]=c(3,4)
> > D
> $ABCD
> [1] 2 1
>
> $ABC
> [1] 3 4
>
<other examples snipped>
>
> It appears to be a sequence specific bug for the $ operator, which
> might explain why it did not occur with my original examples where I
> had a character data column, but did appear where I had a numeric
> data column that was a sequence.


Appearances can be deceptive. The point is that 2:1 and 3:4 are integer 
vectors but c(3,4) is a double precision vector.  Assigning  values of a 
different type into a vector requires copying and so masks the bug.


> Going back to the original partial replacement problem, is there
> anyway to turn off partial matching, or to selectively apply exact
> matching when trying to access a single element?

No.

>  I can get the
> desired single element match using the convoluted syntax D["ABC"]
> [[1]] and perform partial replacement operations on a new column.
> However, it would be nice to have single element access operator that
> does exact matching.

It wouldn't fix the bug, and we are running low on symbols that could be 
used.

 	-thomas


Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle



From bill at insightful.com  Fri Sep  8 19:05:43 2006
From: bill at insightful.com (Bill Dunlap)
Date: Fri, 8 Sep 2006 10:05:43 -0700 (PDT)
Subject: [Rd] (PR#9202) Re: Bugs with partial name matching
In-Reply-To: <Pine.LNX.4.64.0609080916200.24159@homer23.u.washington.edu>
References: <20060905014002.634C928F8E@slim.kubism.ku.dk>
	<Pine.LNX.4.64.0609051507530.17674@homer23.u.washington.edu>
	<Pine.LNX.4.64.0609051542310.17674@homer23.u.washington.edu>
	<69C0202D-ED5A-495A-9F38-FD2F7F132C29@uic.edu>
	<Pine.LNX.4.64.0609080916200.24159@homer23.u.washington.edu>
Message-ID: <Pine.GSO.4.56.0609080954590.19218@durian.statsci.com>

> >  I can get the
> > desired single element match using the convoluted syntax D["ABC"]
> > [[1]] and perform partial replacement operations on a new column.
> > However, it would be nice to have single element access operator that
> > does exact matching.
>
> It wouldn't fix the bug, and we are running low on symbols that could be
> used.

SV4 and Splus have a function called elNamed() (and a corresponding
elNamed<-) that does exact matching.  E.g.,

> zlist<-list(abc=1, xyz=2)
> elNamed(zlist, "a")
NULL
> elNamed(zlist, "a", mustfind=TRUE) # error should say "element", not "slot"
Problem in elNamed(zlist, "a", mustfind = TRUE): Failed to find required slot "a"
Use traceback() to see the call stack
> elNamed(zlist, "abc")
[1] 1
> elNamed(zlist, "ab") <- 3
> dput(zlist)
list("abc" = 1
, "xyz" = 2
, "ab" = 3
)

It works on lists and atomic vectors and I think it
is not intended to be a generic function.  There is
a similar el(x, i) function for numeric subsetting
that is not intended to be generic (that is for
speed and safety when writing methods for [).

Its only documentation is some self-doc:

> elNamed
# extract or (when used on left of assignment) replace the element of `object' associated
# with `name'.  Differs from `$' in using only exact matching. Set `mustfind=T' if you
# want an error to occur when there is no such named element. NOT to be used for slots.
function(object, name, mustfind = F)
.Internal(elNamed(object, name, mustfind), "S_el_named", T, 0)

It isn't used much and has some surprises.  E.g.,
   elNamed(zlist, "ab")<-NULL
sets $ab to NULL; it doesn't remove it as ab$ab would.

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."



From mtmorgan at fhcrc.org  Fri Sep  8 19:20:59 2006
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Fri, 08 Sep 2006 10:20:59 -0700
Subject: [Rd] Extending [ method to S4 class and drop argument (PR#9211)
In-Reply-To: <971536df0609080912w386d56d7vf9d064ccfa999dfe@mail.gmail.com>
	(Gabor Grothendieck's message of "Fri, 8 Sep 2006 12:12:55 -0400")
References: <20060908160424.636BECCD9@slim.kubism.ku.dk>
	<971536df0609080912w386d56d7vf9d064ccfa999dfe@mail.gmail.com>
Message-ID: <6ph1wqmjmv8.fsf@gopher4.fhcrc.org>

Or more in the spirit of method dispatch, and to get some insight into
why this design decision is not a bug:

> setClass("test",representation(x="character"))
[1] "test"
> 
> setMethod("[",
+           signature(x="test", drop="missing"),
+           function(x, i, j, ..., drop) {
+               cat("here\n")
+               callNextMethod(x, i, j, ..., drop=TRUE)
+       })
[1] "["
> 
> setMethod("[","test",function(x, i, j, ..., drop) {
+     cat("there\n")
+     print(drop)
+ })
[1] "["
> 
> a = new("test",x="fred")
> a[1]
here
there
[1] TRUE

'drop' is 'missing', and 'missing' satisfies the implicit 'ANY'
condition in the signature of the original method. With this insight,
the design decision to 'ignore' the default argument seems appropriate
to me -- developers implementing the generic might well want to
dispatch on it, since after all it is in the generic signature. This
could lead to an explosion of methods if many arguments have 'default'
values, but such an explosion probably points to a nice distinction
between arguments-for-dispatch and arguments-for-evaluation.

To tell the truth, I hadn't really understood why the error originally
reported occurred, until writing the method with drop="missing" just
now.

Martin

"Gabor Grothendieck" <ggrothendieck at gmail.com> writes:

> Try this:
>
>> setClass("test",representation(x="character"))
> [1] "test"
>> setMethod("[","test",function(x,i,j,...,drop) {
> +    print(i)
> +    if (missing(drop)) drop <- TRUE
> +    print(drop)
> + })
> [1] "["
>> a = new("test",x="fred")
>> a[1]
> [1] 1
> [1] TRUE
>
>
> On 9/8/06, jverzani at gmail.com <jverzani at gmail.com> wrote:
>> Full_Name: John Verzani
>> Version: 2.4.0 alpha (2006-09-05 r39134)
>> OS: linux, gentoo 2.6.17
>> Submission from: (NULL) (163.238.43.26)
>>
>>
>> When extending the "[" method to a new S4 class, the default value for the drop
>> argument is not being found. Here is a small example:
>>
>> setClass("test",representation(x="character"))
>> setMethod("[","test",function(x,i,j,...,drop=TRUE) {print(i);print(drop)})
>> a = new("test",x="fred")
>> a[1]
>>
>> resulting in:
>>
>> [1] 1
>> Error in print(drop) : argument "drop" is missing, with no default
>>
>> I'm expecting TRUE for the value of drop. That's correct isn't?
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin T. Morgan
Bioconductor / Computational Biology
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024
Seattle, WA 98109

http://bioconductor.org



From mtmorgan at fhcrc.org  Fri Sep  8 19:21:28 2006
From: mtmorgan at fhcrc.org (mtmorgan at fhcrc.org)
Date: Fri,  8 Sep 2006 19:21:28 +0200 (CEST)
Subject: [Rd] Extending [ method to S4 class and drop argument (PR#9211)
Message-ID: <20060908172128.6C41528FB0@slim.kubism.ku.dk>

Or more in the spirit of method dispatch, and to get some insight into
why this design decision is not a bug:

> setClass("test",representation(x="character"))
[1] "test"
> 
> setMethod("[",
+           signature(x="test", drop="missing"),
+           function(x, i, j, ..., drop) {
+               cat("here\n")
+               callNextMethod(x, i, j, ..., drop=TRUE)
+       })
[1] "["
> 
> setMethod("[","test",function(x, i, j, ..., drop) {
+     cat("there\n")
+     print(drop)
+ })
[1] "["
> 
> a = new("test",x="fred")
> a[1]
here
there
[1] TRUE

'drop' is 'missing', and 'missing' satisfies the implicit 'ANY'
condition in the signature of the original method. With this insight,
the design decision to 'ignore' the default argument seems appropriate
to me -- developers implementing the generic might well want to
dispatch on it, since after all it is in the generic signature. This
could lead to an explosion of methods if many arguments have 'default'
values, but such an explosion probably points to a nice distinction
between arguments-for-dispatch and arguments-for-evaluation.

To tell the truth, I hadn't really understood why the error originally
reported occurred, until writing the method with drop="missing" just
now.

Martin

"Gabor Grothendieck" <ggrothendieck at gmail.com> writes:

> Try this:
>
>> setClass("test",representation(x="character"))
> [1] "test"
>> setMethod("[","test",function(x,i,j,...,drop) {
> +    print(i)
> +    if (missing(drop)) drop <- TRUE
> +    print(drop)
> + })
> [1] "["
>> a = new("test",x="fred")
>> a[1]
> [1] 1
> [1] TRUE
>
>
> On 9/8/06, jverzani at gmail.com <jverzani at gmail.com> wrote:
>> Full_Name: John Verzani
>> Version: 2.4.0 alpha (2006-09-05 r39134)
>> OS: linux, gentoo 2.6.17
>> Submission from: (NULL) (163.238.43.26)
>>
>>
>> When extending the "[" method to a new S4 class, the default value for the drop
>> argument is not being found. Here is a small example:
>>
>> setClass("test",representation(x="character"))
>> setMethod("[","test",function(x,i,j,...,drop=TRUE) {print(i);print(drop)})
>> a = new("test",x="fred")
>> a[1]
>>
>> resulting in:
>>
>> [1] 1
>> Error in print(drop) : argument "drop" is missing, with no default
>>
>> I'm expecting TRUE for the value of drop. That's correct isn't?
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin T. Morgan
Bioconductor / Computational Biology
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024
Seattle, WA 98109

http://bioconductor.org



From tplate at blackmesacapital.com  Fri Sep  8 22:21:20 2006
From: tplate at blackmesacapital.com (Tony Plate)
Date: Fri, 08 Sep 2006 14:21:20 -0600
Subject: [Rd] (PR#9202) Re: Bugs with partial name matching
In-Reply-To: <69C0202D-ED5A-495A-9F38-FD2F7F132C29@uic.edu>
References: <20060905014002.634C928F8E@slim.kubism.ku.dk>	<Pine.LNX.4.64.0609051507530.17674@homer23.u.washington.edu>	<Pine.LNX.4.64.0609051542310.17674@homer23.u.washington.edu>
	<69C0202D-ED5A-495A-9F38-FD2F7F132C29@uic.edu>
Message-ID: <4501D0C0.7080705@blackmesacapital.com>

Anil Maliyekkel wrote:
> [snip]
> 
> Going back to the original partial replacement problem, is there  
> anyway to turn off partial matching, or to selectively apply exact  
> matching when trying to access a single element?  I can get the  
> desired single element match using the convoluted syntax D["ABC"] 
> [[1]] and perform partial replacement operations on a new column.   
> However, it would be nice to have single element access operator that  
> does exact matching.

The easiest thing to do is probably to always supply full names, and if 
you want to create a new component, then create it in its entirity (not 
by assigning to a subset of a non-existent component).

A couple of years ago I proposed (with code) an operator '$$' that did 
only exact matching, but that proposal didn't gather any interest at the 
time.  It might actually make more sense to have the roles switched, so 
that the ordinary '$' required exact matches, while the special '$$' 
allowed partial matching (to allow for convenient interactive use). 
But, that's probably a bigger change than the R code base & community 
could bear.

Then again, what about the following as a way forward to eliminating 
partial matching on names for "$" and "[[":

(1) Announce that partial matching for "$" and "[[" is deprecated

(1a) (optional) Introduce "$$" operator with partial matching, intended 
solely for interactive use, with QA checks to ensure that it is not used 
in packages

(2) Introduce warnings upon use of partial matching with "$" and "[[", 
with an option() to turn them off.  Initially these warnings are off by 
default, but QA tools turn them on, and package maintainers see the 
warnings.

(3) After a year or two (assuming most packages no longer contain use of 
partial matching), change the default warning about partial matching to 
"on".

(4) After another year, eliminate partial matching with "$" and "[[".

Opinions?

-- Tony Plate

> 
> Anil
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



From hpages at fhcrc.org  Sat Sep  9 01:35:22 2006
From: hpages at fhcrc.org (hpages at fhcrc.org)
Date: Fri,  8 Sep 2006 16:35:22 -0700
Subject: [Rd] install.packages(,type="source") broken on Windows
Message-ID: <1157758522.4501fe3aa6ff4@webmail.fhcrc.org>

Hi,

On Windows, 'install.packages(,type="source")' displays the same output
than 'R CMD INSTALL --help' and doesn't install anything...

This is with R version 2.4.0 alpha (2006-09-06 r39158).


> install.packages('cat',type='source')
trying URL 'http://cran.cnr.Berkeley.edu/src/contrib/cat_0.0-6.tar.gz'
Content type 'application/x-gzip' length 22914 bytes
opened URL
downloaded 22Kb

Unknown option: configure-args
Usage: R CMD INSTALL [options] pkgs

Install the add-on packages specified by pkgs into the default R library
tree (/library) or the tree specified via '--library'.  The
elements of pkgs can be relative or absolute paths to directories with
the package (bundle) sources, or to gzipped package 'tar' archives.
Then optionally pack the installed package into a zip file.

Options:
  -h, --help            print short help message and exit
  -v, --version         print version info and exit
  -c, --clean           remove all files created during installation

  --fake                do minimal install for testing purposes
  --unsafe              install on top of any existing installation
  -d, --debug           [x] turn on shell and build-help debugging
  -l, --library=LIB     install packages to library tree LIB
  --docs=TYPE           type(s) of documentation to build and install
  --with-package-versions
                        allow for multiple versions of the same package
  --use-zip-data        collect data files in zip archive
  --use-zip-help        collect help and examples into zip archives
  --use-zip             combine '--use-zip-data' and '--use-zip-help'
  --auto-zip            select whether to zip automatically
  --build               zip-up the installation.  Implies --auto-zip


TYPE can be "none" or "normal" or "chm" (the default) or "all", or
  a comma-separated list of one or more of
  'txt', 'html', 'latex', "example' and 'chm'.

Report bugs to <r-bugs at r-project.org>.

The downloaded packages are in
        c:\temp\RtmpoKYvqb\downloaded_packages
updating HTML package descriptions


H.



From p.dalgaard at biostat.ku.dk  Sat Sep  9 02:15:00 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 09 Sep 2006 02:15:00 +0200
Subject: [Rd] install.packages(,type="source") broken on Windows
In-Reply-To: <1157758522.4501fe3aa6ff4@webmail.fhcrc.org>
References: <1157758522.4501fe3aa6ff4@webmail.fhcrc.org>
Message-ID: <x21wql520r.fsf@turmalin.kubism.ku.dk>

hpages at fhcrc.org writes:

> Hi,
> 
> On Windows, 'install.packages(,type="source")' displays the same output
> than 'R CMD INSTALL --help' and doesn't install anything...

Yes. The culprit is

------------------------------------------------------------------------
r39127 | urbaneks | 2006-09-05 20:45:00 +0200 (Tue, 05 Sep 2006) | 1 line

Bugfix: install.packages ignored unnamed configure.args
------------------------------------------------------------------------

which forgets to check whether there are any args to name. (There is a
generic issue in that available.packages has a configure.args argument
which is passed on to --configure-args in the INSTALL script: The
Windows INSTALL doesn't understand the argument since configure
doesn't work on Windows. However, things should work when no such
arguments are passed.)

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From hpages at fhcrc.org  Sat Sep  9 03:16:24 2006
From: hpages at fhcrc.org (Herve Pages)
Date: Fri, 08 Sep 2006 18:16:24 -0700
Subject: [Rd] install.packages(,type="source") broken on Windows
In-Reply-To: <x21wql520r.fsf@turmalin.kubism.ku.dk>
References: <1157758522.4501fe3aa6ff4@webmail.fhcrc.org>
	<x21wql520r.fsf@turmalin.kubism.ku.dk>
Message-ID: <450215E8.1000600@fhcrc.org>

OK thanks. Just FYI the same thing happens with R version 2.5.0
devel (2006-09-07 r39185).
Best,

H.

Peter Dalgaard wrote:
> hpages at fhcrc.org writes:
>
>   
>> Hi,
>>
>> On Windows, 'install.packages(,type="source")' displays the same output
>> than 'R CMD INSTALL --help' and doesn't install anything...
>>     
>
> Yes. The culprit is
>
> ------------------------------------------------------------------------
> r39127 | urbaneks | 2006-09-05 20:45:00 +0200 (Tue, 05 Sep 2006) | 1 line
>
> Bugfix: install.packages ignored unnamed configure.args
> ------------------------------------------------------------------------
>
> which forgets to check whether there are any args to name. (There is a
> generic issue in that available.packages has a configure.args argument
> which is passed on to --configure-args in the INSTALL script: The
> Windows INSTALL doesn't understand the argument since configure
> doesn't work on Windows. However, things should work when no such
> arguments are passed.)
>
>   


-- 
------------------------
Herv? Pag?s
E-mail: hpages at fhcrc.org
 Phone: (206) 667-5791
   Fax: (206) 667-1319



From murdoch at stats.uwo.ca  Mon Sep 11 12:56:18 2006
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Mon, 11 Sep 2006 12:56:18 +0200 (CEST)
Subject: [Rd] [R] function changes argument (PR#9216)
Message-ID: <20060911105618.747A54C9BF@slim.kubism.ku.dk>

(This report appeared in R-help.  I've sent it separately to the bugs 
list to avoid a long string of cross-postings.)

On 9/11/2006 4:49 AM, Moeltner, Andreas wrote:
> Dear R-list,
> 
> the following function f changes L. I thought, assignments within
> functions are only local?

That looks like a bug, still present in R-patched and R-devel.  (I
haven't got the latest pre-release built yet today, but I expect it's
there, too.)  Thanks for the report.

I'll send a copy of this to the bugs list, but I won't be able to
attempt to fix it.

Duncan Murdoch

> 
> 
> f<-function(LL)
> { for (ll in LL)
>   { ll$txt<-"changed in f"
>   }
> }
> 
> l<-list(txt="original value")
> L<-list(l)
> L[[1]]$txt 
> f(L)
> L[[1]]$txt
> 
> 
> gives (using R 2.3.1):
> 
> ...
>> L[[1]]$txt
> [1] "original value"
>> f(L)
>> L[[1]]$txt
> [1] "changed in f"
> 
> Thanks in advance
> 
> Andreas
> 
> ______________________________________________
> R-help at stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.



From ripley at stats.ox.ac.uk  Mon Sep 11 13:32:29 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 11 Sep 2006 12:32:29 +0100 (BST)
Subject: [Rd] [R] function changes argument (PR#9216)
In-Reply-To: <20060911105618.747A54C9BF@slim.kubism.ku.dk>
References: <20060911105618.747A54C9BF@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0609111206460.1481@gannet.stats.ox.ac.uk>

I can tell you where the problem is and a workaround:

f <- function(LL) for (ll in names(LL)) LL[[ll]]$txt<-"changed in f"

works.  The problem is that for() is directly exposing the elements of a 
list.

Of course, a more idiomatic construction would be

LL <- lapply(LL, function(x) x$txt <- "changed in f")

which also works.

The question is whether we do wish to change this to make the construction 
work as Andreas appears to intend.  The simplest solution is a 
precautionary duplicate in for(), which is potentially very expensive and 
almost always unneeded.

However, we already have

x <- 1:10
for(i in x) i <- pi
x

which does not change x, so I think the right solution is to make the list 
(LL here) read-only, which can be done cheaply.  That is also AFAICS what 
S does.


On Mon, 11 Sep 2006, murdoch at stats.uwo.ca wrote:

> (This report appeared in R-help.  I've sent it separately to the bugs 
> list to avoid a long string of cross-postings.)
> 
> On 9/11/2006 4:49 AM, Moeltner, Andreas wrote:
> > Dear R-list,
> > 
> > the following function f changes L. I thought, assignments within
> > functions are only local?
> 
> That looks like a bug, still present in R-patched and R-devel.  (I
> haven't got the latest pre-release built yet today, but I expect it's
> there, too.)  Thanks for the report.
> 
> I'll send a copy of this to the bugs list, but I won't be able to
> attempt to fix it.
> 
> Duncan Murdoch
> 
> > 
> > 
> > f<-function(LL)
> > { for (ll in LL)
> >   { ll$txt<-"changed in f"
> >   }
> > }
> > 
> > l<-list(txt="original value")
> > L<-list(l)
> > L[[1]]$txt 
> > f(L)
> > L[[1]]$txt
> > 
> > 
> > gives (using R 2.3.1):
> > 
> > ...
> >> L[[1]]$txt
> > [1] "original value"
> >> f(L)
> >> L[[1]]$txt
> > [1] "changed in f"
> > 
> > Thanks in advance
> > 
> > Andreas
> > 
> > ______________________________________________
> > R-help at stat.math.ethz.ch mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From ripley at stats.ox.ac.uk  Mon Sep 11 13:32:58 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon, 11 Sep 2006 13:32:58 +0200 (CEST)
Subject: [Rd] [R] function changes argument (PR#9216)
Message-ID: <20060911113258.029B14C9CF@slim.kubism.ku.dk>

I can tell you where the problem is and a workaround:

f <- function(LL) for (ll in names(LL)) LL[[ll]]$txt<-"changed in f"

works.  The problem is that for() is directly exposing the elements of a 
list.

Of course, a more idiomatic construction would be

LL <- lapply(LL, function(x) x$txt <- "changed in f")

which also works.

The question is whether we do wish to change this to make the construction 
work as Andreas appears to intend.  The simplest solution is a 
precautionary duplicate in for(), which is potentially very expensive and 
almost always unneeded.

However, we already have

x <- 1:10
for(i in x) i <- pi
x

which does not change x, so I think the right solution is to make the list 
(LL here) read-only, which can be done cheaply.  That is also AFAICS what 
S does.


On Mon, 11 Sep 2006, murdoch at stats.uwo.ca wrote:

> (This report appeared in R-help.  I've sent it separately to the bugs 
> list to avoid a long string of cross-postings.)
> 
> On 9/11/2006 4:49 AM, Moeltner, Andreas wrote:
> > Dear R-list,
> > 
> > the following function f changes L. I thought, assignments within
> > functions are only local?
> 
> That looks like a bug, still present in R-patched and R-devel.  (I
> haven't got the latest pre-release built yet today, but I expect it's
> there, too.)  Thanks for the report.
> 
> I'll send a copy of this to the bugs list, but I won't be able to
> attempt to fix it.
> 
> Duncan Murdoch
> 
> > 
> > 
> > f<-function(LL)
> > { for (ll in LL)
> >   { ll$txt<-"changed in f"
> >   }
> > }
> > 
> > l<-list(txt="original value")
> > L<-list(l)
> > L[[1]]$txt 
> > f(L)
> > L[[1]]$txt
> > 
> > 
> > gives (using R 2.3.1):
> > 
> > ...
> >> L[[1]]$txt
> > [1] "original value"
> >> f(L)
> >> L[[1]]$txt
> > [1] "changed in f"
> > 
> > Thanks in advance
> > 
> > Andreas
> > 
> > ______________________________________________
> > R-help at stat.math.ethz.ch mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From J.Oosting at lumc.nl  Mon Sep 11 14:23:33 2006
From: J.Oosting at lumc.nl (Oosting, J. (PATH))
Date: Mon, 11 Sep 2006 14:23:33 +0200
Subject: [Rd] S4 Method dispatch in recent 2.4.0alpha
Message-ID: <40964D91251A18469CB08B6E96FB30BABAD8D0@mailc.lumcnet.prod.intern>

I use 2 packages that both implement a S4 plot method, where one package
depends on the other (the bioconductor package globaltest which depends
on multtest). When the plot method is used from within the package, it
seems the default plot method is used, and an error is generated. When
the method is invoked from the console, the plot is created correctly. I
have reproduced this with 2 small packages (minipkg and minipkg2)
implementing just this part.
I've seen a thread about a similar problem, but that seemed mostly due
to already installed packages not handling the new S4 stuff.

mpplot() is a function that creates a class instance and (usually)
invokes the plot immediately. When the dependency on minipkg2 is removed
from the DESCRIPTION file the first call to mpplot() gives no error and
shows the plot.


Jan Oosting

> library(minipkg)
Loading required package: minipkg2
Creating a new generic function for 'plot' in 'minipkg2'
> mpplot(1:10)
Error in as.vector(x, "double") : cannot coerce to vector
> plot(mpplot(1:10,plot=FALSE)) # this shows a proper plot
> showMethods("plot")
Function: plot, (package graphics)
x="ANY"
x="mp.plot"
x="mp2.plot"
> sessionInfo()
R version 2.4.0 Under development (unstable) (2006-09-04 r39086) 
i386-pc-mingw32 

locale:
LC_COLLATE=Dutch_Netherlands.1252;LC_CTYPE=Dutch_Netherlands.1252;LC_MON
ETARY=Dutch_Netherlands.1252;LC_NUMERIC=C;LC_TIME=Dutch_Netherlands.1252

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"
"datasets" 
[7] "base"     

other attached packages:
 minipkg minipkg2 
 "1.0.0"  "1.0.0" 
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: minipkg_1.0.0.tar.gz
Type: application/x-gzip
Size: 694 bytes
Desc: minipkg_1.0.0.tar.gz
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20060911/539e3c96/attachment-0008.gz 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: minipkg2_1.0.0.tar.gz
Type: application/x-gzip
Size: 536 bytes
Desc: minipkg2_1.0.0.tar.gz
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20060911/539e3c96/attachment-0009.gz 

From p.dalgaard at biostat.ku.dk  Mon Sep 11 14:35:05 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 11 Sep 2006 14:35:05 +0200
Subject: [Rd] [R] function changes argument (PR#9216)
In-Reply-To: <20060911113258.029B14C9CF@slim.kubism.ku.dk>
References: <20060911113258.029B14C9CF@slim.kubism.ku.dk>
Message-ID: <x21wqieg3q.fsf@viggo.kubism.ku.dk>

ripley at stats.ox.ac.uk writes:

> I can tell you where the problem is and a workaround:
> 
> f <- function(LL) for (ll in names(LL)) LL[[ll]]$txt<-"changed in f"
> 
> works.  The problem is that for() is directly exposing the elements of a 
> list.
> 
> Of course, a more idiomatic construction would be
> 
> LL <- lapply(LL, function(x) x$txt <- "changed in f")
> 
> which also works.
> 
> The question is whether we do wish to change this to make the construction 
> work as Andreas appears to intend.  The simplest solution is a 
> precautionary duplicate in for(), which is potentially very expensive and 
> almost always unneeded.
> 
> However, we already have
> 
> x <- 1:10
> for(i in x) i <- pi
> x
> 
> which does not change x, so I think the right solution is to make the list 
> (LL here) read-only, which can be done cheaply.  That is also AFAICS what 
> S does.

We could have a precautionary (virtual) assignment, effectively

for (`*tmp*` in L) { ll <- `*tmp*` ; .......}

I think this is what is supposed to happen in the R semantics, it also
satisfies the convention that ll is defined at the end of the loop as
the last value obtained. Assigning to the loop variable should not
change the structure from which it comes, even if Andreas intended
otherwise.

It's not the same as duplicating: it may change NAMED on the elements
of L and cause extra duplication down the line, but not invariably so.

I suspect that the only reason it isn't what currently happens is
that we have forgotten to diddle the NAMED flag in the implementation
of for(), in the same way as is done for "<-".


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From ripley at stats.ox.ac.uk  Mon Sep 11 14:58:00 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 11 Sep 2006 13:58:00 +0100 (BST)
Subject: [Rd] [R] function changes argument (PR#9216)
In-Reply-To: <x21wqieg3q.fsf@viggo.kubism.ku.dk>
References: <20060911113258.029B14C9CF@slim.kubism.ku.dk>
	<x21wqieg3q.fsf@viggo.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0609111343460.974@gannet.stats.ox.ac.uk>

On Mon, 11 Sep 2006, Peter Dalgaard wrote:

> ripley at stats.ox.ac.uk writes:
> 
> > I can tell you where the problem is and a workaround:
> > 
> > f <- function(LL) for (ll in names(LL)) LL[[ll]]$txt<-"changed in f"
> > 
> > works.  The problem is that for() is directly exposing the elements of a 
> > list.
> > 
> > Of course, a more idiomatic construction would be
> > 
> > LL <- lapply(LL, function(x) x$txt <- "changed in f")
> > 
> > which also works.
> > 
> > The question is whether we do wish to change this to make the construction 
> > work as Andreas appears to intend.  The simplest solution is a 
> > precautionary duplicate in for(), which is potentially very expensive and 
> > almost always unneeded.
> > 
> > However, we already have
> > 
> > x <- 1:10
> > for(i in x) i <- pi
> > x
> > 
> > which does not change x, so I think the right solution is to make the list 
> > (LL here) read-only, which can be done cheaply.  That is also AFAICS what 
> > S does.
> 
> We could have a precautionary (virtual) assignment, effectively
> 
> for (`*tmp*` in L) { ll <- `*tmp*` ; .......}
> 
> I think this is what is supposed to happen in the R semantics, it also
> satisfies the convention that ll is defined at the end of the loop as
> the last value obtained. Assigning to the loop variable should not
> change the structure from which it comes, even if Andreas intended
> otherwise.
> 
> It's not the same as duplicating: it may change NAMED on the elements
> of L and cause extra duplication down the line, but not invariably so.
> 
> I suspect that the only reason it isn't what currently happens is
> that we have forgotten to diddle the NAMED flag in the implementation
> of for(), in the same way as is done for "<-".

Yes, on the list elements if the list is itself named, which I have 
already implemented. (I also added a shallow copy, which is needed if L is 
not to be read-only, but that seems not the closest analogy in 
retrospect.)

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From jmc at r-project.org  Mon Sep 11 16:05:23 2006
From: jmc at r-project.org (John Chambers)
Date: Mon, 11 Sep 2006 10:05:23 -0400
Subject: [Rd] S4 Method dispatch in recent 2.4.0alpha
In-Reply-To: <40964D91251A18469CB08B6E96FB30BABAD8D0@mailc.lumcnet.prod.intern>
References: <40964D91251A18469CB08B6E96FB30BABAD8D0@mailc.lumcnet.prod.intern>
Message-ID: <45056D23.5040201@r-project.org>

Good example.

The basic problem is in the NAMESPACE file:

importFrom(graphics, plot)

But the version of plot() in the graphics package is not a generic 
function.  Therefore, when your mpplot() calls it there is no method 
dispatch.

You need to import the generic version of plot() from minipkg2 (notice 
that there's a message about creating a new generic for plot() when you 
install minipkg2).

The line in the NAMESPACE file should be:

importFrom(minipkg2, plot)

In your mini-example, there are some additional steps needed, not 
directly related to the problem & possibly not true in the real example.

1.  minipkg2 also needs a NAMESPACE, in which it imports from methods 
and graphics and exports plot and the class mp2.plot (example attached).

2.  Highly recommended though maybe not required here is to use some 
form of saved image, e.g. by including "LazyLoad:yes" in the two 
DESCRIPTION files.

John


Oosting, J. (PATH) wrote:
> I use 2 packages that both implement a S4 plot method, where one package
> depends on the other (the bioconductor package globaltest which depends
> on multtest). When the plot method is used from within the package, it
> seems the default plot method is used, and an error is generated. When
> the method is invoked from the console, the plot is created correctly. I
> have reproduced this with 2 small packages (minipkg and minipkg2)
> implementing just this part.
> I've seen a thread about a similar problem, but that seemed mostly due
> to already installed packages not handling the new S4 stuff.
>
> mpplot() is a function that creates a class instance and (usually)
> invokes the plot immediately. When the dependency on minipkg2 is removed
> from the DESCRIPTION file the first call to mpplot() gives no error and
> shows the plot.
>
>
> Jan Oosting
>
>   
>> library(minipkg)
>>     
> Loading required package: minipkg2
> Creating a new generic function for 'plot' in 'minipkg2'
>   
>> mpplot(1:10)
>>     
> Error in as.vector(x, "double") : cannot coerce to vector
>   
>> plot(mpplot(1:10,plot=FALSE)) # this shows a proper plot
>> showMethods("plot")
>>     
> Function: plot, (package graphics)
> x="ANY"
> x="mp.plot"
> x="mp2.plot"
>   
>> sessionInfo()
>>     
> R version 2.4.0 Under development (unstable) (2006-09-04 r39086) 
> i386-pc-mingw32 
>
> locale:
> LC_COLLATE=Dutch_Netherlands.1252;LC_CTYPE=Dutch_Netherlands.1252;LC_MON
> ETARY=Dutch_Netherlands.1252;LC_NUMERIC=C;LC_TIME=Dutch_Netherlands.1252
>
> attached base packages:
> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"
> "datasets" 
> [7] "base"     
>
> other attached packages:
>  minipkg minipkg2 
>  "1.0.0"  "1.0.0" 
>   
>> ------------------------------------------------------------------------
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>     
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: NAMESPACE
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060911/1b86f259/attachment-0003.pl 

From jjp.schalken at few.vu.nl  Mon Sep 11 18:02:19 2006
From: jjp.schalken at few.vu.nl (Joost Schalken)
Date: Mon, 11 Sep 2006 18:02:19 +0200
Subject: [Rd] Failure to build home-made package on WINDOWS 2000 professional
Message-ID: <4505888B.8060602@few.vu.nl>

Dear all,

I am trying to build a home-made package (log2html) to
log R output to an HTML file. The package can be build
successfully under Solaris, however I am unable to build
the system under Windows 2000 Professional.

I read (and tried to follow to the letter) Duncan Murdoch's
"Building R for Windows" (http://www.murdoch-sutherland.com/Rtools/),
in combination with the newest version of R (2.3.1), yet when
doing this I receive the following message while compiling the
system:

    > R CMD check log2html
    * checking for working latex ...latex: not found  NO
    * using log directory 'D:/tmp/log2html.Rcheck'
    * using Version 2.3.1 (2006-06-01)
    * checking for file 'log2html/DESCRIPTION' ... OK
    * checking extension type ... Package
    * this is package 'log2html' version '1.0-1'
    * checking package dependencies ... OK
    * checking if this is a source package ... OK
    * checking whether package 'log2html' can be installed ... ERROR
    Installation failed.
    See 'D:/tmp/log2html.Rcheck/00install.out' for details.

In the file D:/tmp/log2html.Rcheck/00install.out are the following
messages:
    installing R.css in H:/tmp/log2html.Rcheck
    '.' is not recognized as an internal or external command, operable
program or batch file.
    '.' is not recognized as an internal or external command, operable
program or batch file.
    '.' is not recognized as an internal or external command, operable
program or batch file.
    make: *** /log2html: No such file or directory.  Stop.
    make: *** [pkg-log2html] Error 2
    *** Installation of log2html failed ***
    Removing 'D:/tmp/log2html.Rcheck/log2html'

Can anybody provide me with hints how to solve this
problem?

Kind regards,

Joost Schalken



From ligges at statistik.uni-dortmund.de  Mon Sep 11 18:50:55 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Mon, 11 Sep 2006 18:50:55 +0200
Subject: [Rd] Failure to build home-made package on WINDOWS 2000
	professional
In-Reply-To: <4505888B.8060602@few.vu.nl>
References: <4505888B.8060602@few.vu.nl>
Message-ID: <450593EF.9050704@statistik.uni-dortmund.de>



Joost Schalken wrote:
> Dear all,
> 
> I am trying to build a home-made package (log2html) to
> log R output to an HTML file. The package can be build
> successfully under Solaris, however I am unable to build
> the system under Windows 2000 Professional.
> 
> I read (and tried to follow to the letter) Duncan Murdoch's
> "Building R for Windows" (http://www.murdoch-sutherland.com/Rtools/),
> in combination with the newest version of R (2.3.1), yet when
> doing this I receive the following message while compiling the
> system:
> 
>     > R CMD check log2html
>     * checking for working latex ...latex: not found  NO
>     * using log directory 'D:/tmp/log2html.Rcheck'
>     * using Version 2.3.1 (2006-06-01)
>     * checking for file 'log2html/DESCRIPTION' ... OK
>     * checking extension type ... Package
>     * this is package 'log2html' version '1.0-1'
>     * checking package dependencies ... OK
>     * checking if this is a source package ... OK
>     * checking whether package 'log2html' can be installed ... ERROR
>     Installation failed.
>     See 'D:/tmp/log2html.Rcheck/00install.out' for details.
> 
> In the file D:/tmp/log2html.Rcheck/00install.out are the following
> messages:
>     installing R.css in H:/tmp/log2html.Rcheck
>     '.' is not recognized as an internal or external command, operable
> program or batch file.
>     '.' is not recognized as an internal or external command, operable
> program or batch file.
>     '.' is not recognized as an internal or external command, operable
> program or batch file.
>     make: *** /log2html: No such file or directory.  Stop.
>     make: *** [pkg-log2html] Error 2
>     *** Installation of log2html failed ***
>     Removing 'D:/tmp/log2html.Rcheck/log2html'
> 
> Can anybody provide me with hints how to solve this
> problem?


Can you tell us your exact PATH settings, please?

Uwe Ligges


> Kind regards,
> 
> Joost Schalken
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



From rmh at temple.edu  Mon Sep 11 22:30:55 2006
From: rmh at temple.edu (Richard M. Heiberger)
Date: Mon, 11 Sep 2006 16:30:55 -0400 (EDT)
Subject: [Rd] problems in installing packages with R version 2.4.0 alpha
 (2006-09-05 r39134)
Message-ID: <20060911163055.BHS69946@po-d.temple.edu>

I just downloaded the windows version 
 R version 2.4.0 alpha (2006-09-05 r39134)

1. When I downloaded the packages, the following two were not found.
> utils:::menuInstallPkgs()
--- Please select a CRAN mirror for use in this session ---
dependency ''fCalendar'' is not available

dependency ''SparseM'' is not available


I am not sure which other packages depend on these.


2. Of the others, several didn't install cleanly

package 'mlbench' successfully unpacked and MD5 sums checked
Warning: unable to move temporary installation 'C:\Program Files\R\R-
2.4.0alpha\library\file41bb5af1\mlbench' to 'C:\Program Files\R\R-2.4.0alpha\library\mlbench'
package 'tseries' successfully unpacked and MD5 sums checked
Warning: unable to move temporary installation 'C:\Program Files\R\R-2.4.0alpha\library\file305e124
\tseries' to 'C:\Program Files\R\R-2.4.0alpha\library\tseries'
package 'DAAG' successfully unpacked and MD5 sums checked
Warning: unable to move temporary installation 'C:\Program Files\R\R-
2.4.0alpha\library\file491c440d\DAAG' to 'C:\Program Files\R\R-2.4.0alpha\library\DAAG'
package 'acepack' successfully unpacked and MD5 sums checked
Warning: unable to move temporary installation 'C:\Program Files\R\R-
2.4.0alpha\library\file767d7a5a\acepack' to 'C:\Program Files\R\R-2.4.0alpha\library\acepack'
package 'rcom' successfully unpacked and MD5 sums checked
Warning: unable to move temporary installation 'C:\Program Files\R\R-
2.4.0alpha\library\file58784b40\rcom' to 'C:\Program Files\R\R-2.4.0alpha\library\rcom'


I reinstalled all five from the local zip files that were downloaded as part of the above
installation, and four worked and one didn't.
I needed to reinstall mlbench a third time and this time it worked.

This type of problem frequently happens when I download a new version of R.


3. rgl is still not working in Windows

package 'rgl' successfully unpacked and MD5 sums checked

> library(rgl)
Error in dyn.load(x, as.logical(local), as.logical(now)) : 
        unable to load shared library 'C:/PROGRA~1/R/R-24~1.0AL/library/rgl/libs/rgl.dll':
  LoadLibrary failure:  The specified procedure could not be found.

Error: package/namespace load failed for 'rgl'
>


Therefore the Rcmdr 3-d graphics isn't working.


Rich



From ripley at stats.ox.ac.uk  Mon Sep 11 23:25:58 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 11 Sep 2006 22:25:58 +0100 (BST)
Subject: [Rd] problems in installing packages with R version 2.4.0 alpha
 (2006-09-05 r39134)
In-Reply-To: <20060911163055.BHS69946@po-d.temple.edu>
References: <20060911163055.BHS69946@po-d.temple.edu>
Message-ID: <Pine.LNX.4.64.0609112205460.16814@gannet.stats.ox.ac.uk>

At least some of this will go away if you use a current version of 2.4.0 
alpha rather than one that is a week old (as the posting guide does ask).  
We are now at r39258, and some of those binary packages were built against 
a substantially later version of 2.4.0 alpha.

If you look at the list of available packages at

http://cran.r-project.org/bin/windows/contrib/checkSummaryWin.htm

you will see which are unavailable as Windows binaries and why.  More can 
be installed from the sources but do not pass R CMD check for Uwe (or in 
most cases for anyone else: see the other CRAN summaries).

This is the 'alpha' period, and we are waiting for updates on quite a 
number of packages (especially ones that use S4 methods).  However, R 
2.4.0 is not even in feature freeze yet, and it is quite possible that 
packages will need to be reinstalled again prior to release.

On Mon, 11 Sep 2006, Richard M. Heiberger wrote:

> I just downloaded the windows version 
>  R version 2.4.0 alpha (2006-09-05 r39134)
> 
> 1. When I downloaded the packages, the following two were not found.
> > utils:::menuInstallPkgs()
> --- Please select a CRAN mirror for use in this session ---
> dependency ''fCalendar'' is not available
> 
> dependency ''SparseM'' is not available
> 
> I am not sure which other packages depend on these.
> 
> 
> 2. Of the others, several didn't install cleanly
> 
> package 'mlbench' successfully unpacked and MD5 sums checked
> Warning: unable to move temporary installation 'C:\Program Files\R\R-
> 2.4.0alpha\library\file41bb5af1\mlbench' to 'C:\Program Files\R\R-2.4.0alpha\library\mlbench'
> package 'tseries' successfully unpacked and MD5 sums checked
> Warning: unable to move temporary installation 'C:\Program Files\R\R-2.4.0alpha\library\file305e124
> \tseries' to 'C:\Program Files\R\R-2.4.0alpha\library\tseries'
> package 'DAAG' successfully unpacked and MD5 sums checked
> Warning: unable to move temporary installation 'C:\Program Files\R\R-
> 2.4.0alpha\library\file491c440d\DAAG' to 'C:\Program Files\R\R-2.4.0alpha\library\DAAG'
> package 'acepack' successfully unpacked and MD5 sums checked
> Warning: unable to move temporary installation 'C:\Program Files\R\R-
> 2.4.0alpha\library\file767d7a5a\acepack' to 'C:\Program Files\R\R-2.4.0alpha\library\acepack'
> package 'rcom' successfully unpacked and MD5 sums checked
> Warning: unable to move temporary installation 'C:\Program Files\R\R-
> 2.4.0alpha\library\file58784b40\rcom' to 'C:\Program Files\R\R-2.4.0alpha\library\rcom'
> 
> 
> I reinstalled all five from the local zip files that were downloaded as part of the above
> installation, and four worked and one didn't.
> I needed to reinstall mlbench a third time and this time it worked.
> 
> This type of problem frequently happens when I download a new version of R.

This suggests problems with your local file system: it is definitely a 
Windows rather than an R problem.

> 3. rgl is still not working in Windows
> 
> package 'rgl' successfully unpacked and MD5 sums checked
> 
> > library(rgl)
> Error in dyn.load(x, as.logical(local), as.logical(now)) : 
>         unable to load shared library 'C:/PROGRA~1/R/R-24~1.0AL/library/rgl/libs/rgl.dll':
>   LoadLibrary failure:  The specified procedure could not be found.
> 
> Error: package/namespace load failed for 'rgl'
> >
> 
> 
> Therefore the Rcmdr 3-d graphics isn't working.
> 
> 
> Rich
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From jjonphl at gmail.com  Tue Sep 12 05:32:59 2006
From: jjonphl at gmail.com (miguel manese)
Date: Tue, 12 Sep 2006 11:32:59 +0800
Subject: [Rd] Failure to build home-made package on WINDOWS 2000
	professional
In-Reply-To: <450593EF.9050704@statistik.uni-dortmund.de>
References: <4505888B.8060602@few.vu.nl>
	<450593EF.9050704@statistik.uni-dortmund.de>
Message-ID: <d35b9da60609112032l1cc0e159rb682071106790fbf@mail.gmail.com>

Maybe you're doing bash

. script.sh

(i.e. source the script) ?

M. Manese

On 9/12/06, Uwe Ligges <ligges at statistik.uni-dortmund.de> wrote:
>
>
> Joost Schalken wrote:
> > Dear all,
> >
> > I am trying to build a home-made package (log2html) to
> > log R output to an HTML file. The package can be build
> > successfully under Solaris, however I am unable to build
> > the system under Windows 2000 Professional.
> >
> > I read (and tried to follow to the letter) Duncan Murdoch's
> > "Building R for Windows" (http://www.murdoch-sutherland.com/Rtools/),
> > in combination with the newest version of R (2.3.1), yet when
> > doing this I receive the following message while compiling the
> > system:
> >
> >     > R CMD check log2html
> >     * checking for working latex ...latex: not found  NO
> >     * using log directory 'D:/tmp/log2html.Rcheck'
> >     * using Version 2.3.1 (2006-06-01)
> >     * checking for file 'log2html/DESCRIPTION' ... OK
> >     * checking extension type ... Package
> >     * this is package 'log2html' version '1.0-1'
> >     * checking package dependencies ... OK
> >     * checking if this is a source package ... OK
> >     * checking whether package 'log2html' can be installed ... ERROR
> >     Installation failed.
> >     See 'D:/tmp/log2html.Rcheck/00install.out' for details.
> >
> > In the file D:/tmp/log2html.Rcheck/00install.out are the following
> > messages:
> >     installing R.css in H:/tmp/log2html.Rcheck
> >     '.' is not recognized as an internal or external command, operable
> > program or batch file.
> >     '.' is not recognized as an internal or external command, operable
> > program or batch file.
> >     '.' is not recognized as an internal or external command, operable
> > program or batch file.
> >     make: *** /log2html: No such file or directory.  Stop.
> >     make: *** [pkg-log2html] Error 2
> >     *** Installation of log2html failed ***
> >     Removing 'D:/tmp/log2html.Rcheck/log2html'
> >
> > Can anybody provide me with hints how to solve this
> > problem?
>
>
> Can you tell us your exact PATH settings, please?
>
> Uwe Ligges
>
>
> > Kind regards,
> >
> > Joost Schalken
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



From kamila.naxerova at childrens.harvard.edu  Tue Sep 12 04:08:48 2006
From: kamila.naxerova at childrens.harvard.edu (kamila.naxerova at childrens.harvard.edu)
Date: Tue, 12 Sep 2006 04:08:48 +0200 (CEST)
Subject: [Rd] Readline bug (PR#9217)
Message-ID: <20060912020848.E0F5613509@slim.kubism.ku.dk>

Full_Name: Kamila Naxerova
Version: 2.3.1
OS: Windows XP
Submission from: (NULL) (209.6.158.235)


R crashes consistently when I use readline (i.e. I hold the arrow up button for
a couple of seconds to go back to previous commands quickly). Thanks!

platform       i386-pc-mingw32           
arch           i386                      
os             mingw32                   
system         i386, mingw32             
status                                   
major          2                         
minor          3.1                       
year           2006                      
month          06                        
day            01                        
svn rev        38247                     
language       R                         
version.string Version 2.3.1 (2006-06-01)



From deepayan.sarkar at gmail.com  Tue Sep 12 01:26:24 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Mon, 11 Sep 2006 16:26:24 -0700
Subject: [Rd] unexpected behaviour when defining a function
Message-ID: <eb555e660609111626t3f03dd69q2e3ebfe845f6540c@mail.gmail.com>

Hi,

I know S manuals used to warn against using the same names for a
variable and a function, but I have never seen that cause problems in
R, so I usually don't pay much attention to it. Which is why the
following behaviour came as a surprise:

> bar <- function() 1
> foo <- function(bar = bar()) {
+     bar
+ }
> foo(9)
[1] 9
> foo()
Error in foo() : recursive default argument reference

Exactly what rule am I violating here?

The following gives a slightly different error, but I assume it has a
similar origin:

bar <- function() 1
foo <- function(bar) {
    if (missing(bar)) bar <- bar()
    bar
}
foo()

This version works fine though (so the rule probably involves function
arguments somehow):

foo <- function(baz) {
    if (missing(baz)) {
        baz <- function() 2
        baz <- baz()
    }
    baz
}
foo()

-Deepayan



From gregor.gorjanc at bfro.uni-lj.si  Tue Sep 12 07:53:52 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Tue, 12 Sep 2006 07:53:52 +0200
Subject: [Rd] R Citation through time
Message-ID: <45064B70.3050809@bfro.uni-lj.si>

Hello!

I keep my local bib file and up to now I had entry

  @Manual{R:2003,
    title = {R: A Language and Environment for Statistical Computing},
    author = {{R Development Core Team}},
    organization = {R Foundation for Statistical Computing},
    address = {Vienna, Austria},
    year = {2005},
    note = {{ISBN} 3-900051-00-3},
    url = {http://www.R-project.org},
  }

With recent versions ISBN changed to 3-900051-07-0. Now I wonder if
there is any canonical way to refer to R without the need to change R
entry over and over. It would probably be the best just to add new entry
for "new version" for R. Now the question is what is new version or when
does ISBN number change?

Thanks.

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.



From ggrothendieck at gmail.com  Tue Sep 12 07:55:55 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 12 Sep 2006 01:55:55 -0400
Subject: [Rd] unexpected behaviour when defining a function
In-Reply-To: <eb555e660609111626t3f03dd69q2e3ebfe845f6540c@mail.gmail.com>
References: <eb555e660609111626t3f03dd69q2e3ebfe845f6540c@mail.gmail.com>
Message-ID: <971536df0609112255s5d46b1abu35720fe5264c69a2@mail.gmail.com>

You can't have x=x in an argument list.

Try the following noting that we put a dot at the end of bar:

> bar <- function() 1
> foo <- function(bar. = bar()) {
+      bar
+ }
> foo()
function() 1
> foo(bar = bar)
function() 1

On 9/11/06, Deepayan Sarkar <deepayan.sarkar at gmail.com> wrote:
> Hi,
>
> I know S manuals used to warn against using the same names for a
> variable and a function, but I have never seen that cause problems in
> R, so I usually don't pay much attention to it. Which is why the
> following behaviour came as a surprise:
>
> > bar <- function() 1
> > foo <- function(bar = bar()) {
> +     bar
> + }
> > foo(9)
> [1] 9
> > foo()
> Error in foo() : recursive default argument reference
>
> Exactly what rule am I violating here?
>
> The following gives a slightly different error, but I assume it has a
> similar origin:
>
> bar <- function() 1
> foo <- function(bar) {
>    if (missing(bar)) bar <- bar()
>    bar
> }
> foo()
>
> This version works fine though (so the rule probably involves function
> arguments somehow):
>
> foo <- function(baz) {
>    if (missing(baz)) {
>        baz <- function() 2
>        baz <- baz()
>    }
>    baz
> }
> foo()
>
> -Deepayan
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



From ggrothendieck at gmail.com  Tue Sep 12 07:57:22 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 12 Sep 2006 01:57:22 -0400
Subject: [Rd] unexpected behaviour when defining a function
In-Reply-To: <971536df0609112255s5d46b1abu35720fe5264c69a2@mail.gmail.com>
References: <eb555e660609111626t3f03dd69q2e3ebfe845f6540c@mail.gmail.com>
	<971536df0609112255s5d46b1abu35720fe5264c69a2@mail.gmail.com>
Message-ID: <971536df0609112257l73b7f266s2c21b047ceb6f058@mail.gmail.com>

Sorry I forgot one of the dots.  Here it is corrected:

> bar <- function() 1
> foo <- function(bar. = bar()) {
+      bar.
+ }
> foo()
[1] 1
> foo(bar = bar)
function() 1

On 9/12/06, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> You can't have x=x in an argument list.
>
> Try the following noting that we put a dot at the end of bar:
>
> > bar <- function() 1
> > foo <- function(bar. = bar()) {
> +      bar
> + }
> > foo()
> function() 1
> > foo(bar = bar)
> function() 1
>
> On 9/11/06, Deepayan Sarkar <deepayan.sarkar at gmail.com> wrote:
> > Hi,
> >
> > I know S manuals used to warn against using the same names for a
> > variable and a function, but I have never seen that cause problems in
> > R, so I usually don't pay much attention to it. Which is why the
> > following behaviour came as a surprise:
> >
> > > bar <- function() 1
> > > foo <- function(bar = bar()) {
> > +     bar
> > + }
> > > foo(9)
> > [1] 9
> > > foo()
> > Error in foo() : recursive default argument reference
> >
> > Exactly what rule am I violating here?
> >
> > The following gives a slightly different error, but I assume it has a
> > similar origin:
> >
> > bar <- function() 1
> > foo <- function(bar) {
> >    if (missing(bar)) bar <- bar()
> >    bar
> > }
> > foo()
> >
> > This version works fine though (so the rule probably involves function
> > arguments somehow):
> >
> > foo <- function(baz) {
> >    if (missing(baz)) {
> >        baz <- function() 2
> >        baz <- baz()
> >    }
> >    baz
> > }
> > foo()
> >
> > -Deepayan
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>



From ripley at stats.ox.ac.uk  Tue Sep 12 08:42:42 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 12 Sep 2006 07:42:42 +0100 (BST)
Subject: [Rd] unexpected behaviour when defining a function
In-Reply-To: <eb555e660609111626t3f03dd69q2e3ebfe845f6540c@mail.gmail.com>
References: <eb555e660609111626t3f03dd69q2e3ebfe845f6540c@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0609120725010.10962@gannet.stats.ox.ac.uk>

On Mon, 11 Sep 2006, Deepayan Sarkar wrote:

> Hi,
> 
> I know S manuals used to warn against using the same names for a
> variable and a function, but I have never seen that cause problems in
> R, so I usually don't pay much attention to it. 

But in this case you have a promise.  (BTW, it can still cause problems in 
R, hence the following NEWS item for 2.4.0:

	Lookup for S3 methods is confined to functions: previously a
	non-function 'fun.class' could have masked a function of the
	same name.
)

Note that you do have to look at an object to find out if it is a 
function, and that means forcing promises, the problem here.

> Which is why the following behaviour came as a surprise:
> 
> > bar <- function() 1
> > foo <- function(bar = bar()) {
> +     bar
> + }
> > foo(9)
> [1] 9
> > foo()
> Error in foo() : recursive default argument reference
> 
> Exactly what rule am I violating here?

That an argument default value cannot refer to the argument.

This is an argument with a default value that is relying on lazy 
evaluation. When you come to evaluate 'bar' it is a promise with value 
bar().  Evaluating that value looks up 'bar' from the evaluation frame of 
foo() and the first candidate it finds is the argument it is the process 
of evaluating, hence the message.

> The following gives a slightly different error, but I assume it has a
> similar origin:
> 
> bar <- function() 1
> foo <- function(bar) {
>     if (missing(bar)) bar <- bar()
>     bar
> }
> foo()

It says

> Error in foo() : argument "bar" is missing, with no default

and that is caused by bar <- bar():  it is looking for argument bar (to 
see if it is a function which can be called) and that argument has no 
default.  (I would have thought that one was clear enough.)

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From maechler at stat.math.ethz.ch  Tue Sep 12 08:56:41 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 12 Sep 2006 08:56:41 +0200
Subject: [Rd] problems in installing packages with R version 2.4.0 alpha
	(2006-09-05 r39134)
In-Reply-To: <Pine.LNX.4.64.0609112205460.16814@gannet.stats.ox.ac.uk>
References: <20060911163055.BHS69946@po-d.temple.edu>
	<Pine.LNX.4.64.0609112205460.16814@gannet.stats.ox.ac.uk>
Message-ID: <17670.23081.331425.916500@stat.math.ethz.ch>


>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>>>     on Mon, 11 Sep 2006 22:25:58 +0100 (BST) writes:

    BDR> At least some of this will go away if you use a current
    BDR> version of 2.4.0 alpha rather than one that is a week
    BDR> old (as the posting guide does ask).  We are now at
    BDR> r39258, and some of those binary packages were built
    BDR> against a substantially later version of 2.4.0 alpha.

    [............]

Still "Thank you, Rich!" for running R-alpha and your report.
We are grateful for everyone who does use R-alpha and reports
"unusual" findings, even if some of them are already known to
the R developers.

Martin



From ligges at statistik.uni-dortmund.de  Tue Sep 12 08:59:32 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Tue, 12 Sep 2006 08:59:32 +0200
Subject: [Rd] problems in installing packages with R version 2.4.0 alpha
 (2006-09-05 r39134)
In-Reply-To: <Pine.LNX.4.64.0609112205460.16814@gannet.stats.ox.ac.uk>
References: <20060911163055.BHS69946@po-d.temple.edu>
	<Pine.LNX.4.64.0609112205460.16814@gannet.stats.ox.ac.uk>
Message-ID: <45065AD4.3080403@statistik.uni-dortmund.de>



Prof Brian Ripley wrote:
> At least some of this will go away if you use a current version of 2.4.0 
> alpha rather than one that is a week old (as the posting guide does ask).  
> We are now at r39258, and some of those binary packages were built against 
> a substantially later version of 2.4.0 alpha.
> 
> If you look at the list of available packages at
> 
> http://cran.r-project.org/bin/windows/contrib/checkSummaryWin.htm
> 
> you will see which are unavailable as Windows binaries and why.  More can 
> be installed from the sources but do not pass R CMD check for Uwe (or in 
> most cases for anyone else: see the other CRAN summaries).
> 
> This is the 'alpha' period, and we are waiting for updates on quite a 
> number of packages (especially ones that use S4 methods).  However, R 
> 2.4.0 is not even in feature freeze yet, and it is quite possible that 
> packages will need to be reinstalled again prior to release.


Currently, the main problems with many packages are missing *recent* 
binaries (after the latest S4 changes) of BioC packages, hence many 
dependencies may not be working. I do not want to compile the whole BioC 
repository as well.

Uwe



> On Mon, 11 Sep 2006, Richard M. Heiberger wrote:
> 
>> I just downloaded the windows version 
>>  R version 2.4.0 alpha (2006-09-05 r39134)
>>
>> 1. When I downloaded the packages, the following two were not found.
>>> utils:::menuInstallPkgs()
>> --- Please select a CRAN mirror for use in this session ---
>> dependency ''fCalendar'' is not available
>>
>> dependency ''SparseM'' is not available
>>
>> I am not sure which other packages depend on these.
>>
>>
>> 2. Of the others, several didn't install cleanly
>>
>> package 'mlbench' successfully unpacked and MD5 sums checked
>> Warning: unable to move temporary installation 'C:\Program Files\R\R-
>> 2.4.0alpha\library\file41bb5af1\mlbench' to 'C:\Program Files\R\R-2.4.0alpha\library\mlbench'
>> package 'tseries' successfully unpacked and MD5 sums checked
>> Warning: unable to move temporary installation 'C:\Program Files\R\R-2.4.0alpha\library\file305e124
>> \tseries' to 'C:\Program Files\R\R-2.4.0alpha\library\tseries'
>> package 'DAAG' successfully unpacked and MD5 sums checked
>> Warning: unable to move temporary installation 'C:\Program Files\R\R-
>> 2.4.0alpha\library\file491c440d\DAAG' to 'C:\Program Files\R\R-2.4.0alpha\library\DAAG'
>> package 'acepack' successfully unpacked and MD5 sums checked
>> Warning: unable to move temporary installation 'C:\Program Files\R\R-
>> 2.4.0alpha\library\file767d7a5a\acepack' to 'C:\Program Files\R\R-2.4.0alpha\library\acepack'
>> package 'rcom' successfully unpacked and MD5 sums checked
>> Warning: unable to move temporary installation 'C:\Program Files\R\R-
>> 2.4.0alpha\library\file58784b40\rcom' to 'C:\Program Files\R\R-2.4.0alpha\library\rcom'
>>
>>
>> I reinstalled all five from the local zip files that were downloaded as part of the above
>> installation, and four worked and one didn't.
>> I needed to reinstall mlbench a third time and this time it worked.
>>
>> This type of problem frequently happens when I download a new version of R.
> 
> This suggests problems with your local file system: it is definitely a 
> Windows rather than an R problem.
> 
>> 3. rgl is still not working in Windows
>>
>> package 'rgl' successfully unpacked and MD5 sums checked
>>
>>> library(rgl)
>> Error in dyn.load(x, as.logical(local), as.logical(now)) : 
>>         unable to load shared library 'C:/PROGRA~1/R/R-24~1.0AL/library/rgl/libs/rgl.dll':
>>   LoadLibrary failure:  The specified procedure could not be found.
>>
>> Error: package/namespace load failed for 'rgl'
>>
>> Therefore the Rcmdr 3-d graphics isn't working.
>>
>>
>> Rich
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>



From Friedrich.Leisch at stat.uni-muenchen.de  Tue Sep 12 09:01:42 2006
From: Friedrich.Leisch at stat.uni-muenchen.de (Friedrich Leisch)
Date: Tue, 12 Sep 2006 09:01:42 +0200
Subject: [Rd] R Citation through time
In-Reply-To: <45064B70.3050809@bfro.uni-lj.si>
References: <45064B70.3050809@bfro.uni-lj.si>
Message-ID: <17670.23382.939954.269492@celebrian.ci.tuwien.ac.at>

>>>>> On Tue, 12 Sep 2006 07:53:52 +0200,
>>>>> Gregor Gorjanc (GG) wrote:

  > Hello!
  > I keep my local bib file and up to now I had entry

  >   @Manual{R:2003,
  >     title = {R: A Language and Environment for Statistical Computing},
  >     author = {{R Development Core Team}},
  >     organization = {R Foundation for Statistical Computing},
  >     address = {Vienna, Austria},
  >     year = {2005},
  >     note = {{ISBN} 3-900051-00-3},
  >     url = {http://www.R-project.org},
  >   }

  > With recent versions ISBN changed to 3-900051-07-0.

It changed with 2.0.0, which is not that recent ...

  > Now I wonder if there is any canonical way to refer to R without
  > the need to change R entry over and over. It would probably be the
  > best just to add new entry for "new version" for R. Now the
  > question is what is new version or when does ISBN number change?

The ISBN changes with every major version of R, i.e., it will change
next when 3.0.0 is released. We are already stretching the ISBN rules
to the limit (on the no-change-side) with that policy, and the
reason is exactly to make the reference more stable. But with a major
release we really need to assign a new ISBN.

Best,
Fritz



From r.hankin at noc.soton.ac.uk  Tue Sep 12 09:26:58 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Tue, 12 Sep 2006 08:26:58 +0100
Subject: [Rd] package.skeleton() in R-2.4.1
Message-ID: <3D629878-2F94-4831-B61B-398BA052F61A@soc.soton.ac.uk>

Hi

R version 2.4.0 alpha (2006-09-06 r39158)
MacOSX 10.4.7


There was a thread some time ago as to whether  the structure created by
package.skeleton() would pass R CMD check.

I have an example where package.skeleton() gives an R file that gives an
error when sourced.


If I type

setClass("brob",
          representation = representation 
(x="numeric",positive="logical"),
          prototype      = list(x=numeric(),positive=logical())
          )

setGeneric("getX",function(x){standardGeneric("getX")})
setMethod("getX","brob",function(x){x at x})


(which is legal, AFAICS), then

package.skeleton(path="~")

I get a file ~/anRpackage/R/getX.R containing:


"getX" <-
structure(function(x){standardGeneric("getX")}
, generic = structure("getX", package = ".GlobalEnv"), package =  
".GlobalEnv", group = list(), valueClass = character(0), signature =  
"x", default = <S4
object of class structure("MethodsList", package = "methods")>,  
skeleton = quote(function (x)
stop("invalid call in method dispatch to 'getX' (no default method)",
     domain = NA)(x)), class = structure 
("nonstandardGenericFunction", package = "methods"))


[subject to line breaking] but this file gives an error when
sourced (below).   I didn't get this problem with R-2.3.1.


 > > source("/Users/rksh/anRpackage/R/getX.R")
Error in parse(file, n = -1, NULL, "?") : syntax error at
2: structure(function(x){standardGeneric("getX")}
3: , generic = structure("getX", package = ".GlobalEnv"), package =  
".GlobalEnv", group = list(), valueClass = character(0), signature =  
"x", default = <
 >



Am I doing something wrong?



--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743



From jjp.schalken at few.vu.nl  Tue Sep 12 10:20:55 2006
From: jjp.schalken at few.vu.nl (Joost Schalken)
Date: Tue, 12 Sep 2006 10:20:55 +0200
Subject: [Rd] Failure to build home-made package on WINDOWS 2000
	professional
In-Reply-To: <d35b9da60609112032l1cc0e159rb682071106790fbf@mail.gmail.com>
References: <4505888B.8060602@few.vu.nl>	
	<450593EF.9050704@statistik.uni-dortmund.de>
	<d35b9da60609112032l1cc0e159rb682071106790fbf@mail.gmail.com>
Message-ID: <45066DE7.4030602@few.vu.nl>

Thank you for the interest in my problem.
>From the questions I see I forgot to provide some
vital information, for which I am sorry.

Based on the question Uwe Ligges, I scrutinized
my PATH settings and saw that my system administrators
included a reference to a Cygwin installation (which
caused problems).

Secondly my PATH contained NETBIOS mounted
shares (e.g. \\sever\path) and directories containing whitespace.
When I remove those also from my path (converting the whitespace-
containing paths to the corresponding DOS names), I was able to
compile the software based on Duncan Murdoch's instructions

Thank you all for your interest and time, kind regards,

Joost Schalken

miguel manese wrote:
> Maybe you're doing bash
>
> . script.sh
>
> (i.e. source the script) ?
>
> M. Manese
>
> On 9/12/06, Uwe Ligges <ligges at statistik.uni-dortmund.de> wrote:
>>
>>
>> Joost Schalken wrote:
>> > Dear all,
>> >
>> > I am trying to build a home-made package (log2html) to
>> > log R output to an HTML file. The package can be build
>> > successfully under Solaris, however I am unable to build
>> > the system under Windows 2000 Professional.
>> >
>> > I read (and tried to follow to the letter) Duncan Murdoch's
>> > "Building R for Windows" (http://www.murdoch-sutherland.com/Rtools/),
>> > in combination with the newest version of R (2.3.1), yet when
>> > doing this I receive the following message while compiling the
>> > system:
>> >
>> >     > R CMD check log2html
>> >     * checking for working latex ...latex: not found  NO
>> >     * using log directory 'D:/tmp/log2html.Rcheck'
>> >     * using Version 2.3.1 (2006-06-01)
>> >     * checking for file 'log2html/DESCRIPTION' ... OK
>> >     * checking extension type ... Package
>> >     * this is package 'log2html' version '1.0-1'
>> >     * checking package dependencies ... OK
>> >     * checking if this is a source package ... OK
>> >     * checking whether package 'log2html' can be installed ... ERROR
>> >     Installation failed.
>> >     See 'D:/tmp/log2html.Rcheck/00install.out' for details.
>> >
>> > In the file D:/tmp/log2html.Rcheck/00install.out are the following
>> > messages:
>> >     installing R.css in H:/tmp/log2html.Rcheck
>> >     '.' is not recognized as an internal or external command, operable
>> > program or batch file.
>> >     '.' is not recognized as an internal or external command, operable
>> > program or batch file.
>> >     '.' is not recognized as an internal or external command, operable
>> > program or batch file.
>> >     make: *** /log2html: No such file or directory.  Stop.
>> >     make: *** [pkg-log2html] Error 2
>> >     *** Installation of log2html failed ***
>> >     Removing 'D:/tmp/log2html.Rcheck/log2html'
>> >
>> > Can anybody provide me with hints how to solve this
>> > problem?
>>
>> Can you tell us your exact PATH settings, please?
>>
>> Uwe Ligges
>>
>> > Kind regards,
>> >
>> > Joost Schalken
>> >
>> > ______________________________________________
>> > R-devel at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: R-output.txt
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060912/b71903b7/attachment-0004.txt 

From maechler at stat.math.ethz.ch  Tue Sep 12 11:37:04 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 12 Sep 2006 11:37:04 +0200
Subject: [Rd] problems in installing packages with R version 2.4.0 alpha
	(2006-09-05 r39134)
In-Reply-To: <17670.23081.331425.916500@stat.math.ethz.ch>
References: <20060911163055.BHS69946@po-d.temple.edu>
	<Pine.LNX.4.64.0609112205460.16814@gannet.stats.ox.ac.uk>
	<17670.23081.331425.916500@stat.math.ethz.ch>
Message-ID: <17670.32704.739575.701904@stat.math.ethz.ch>

>>>>> "MM" == Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Tue, 12 Sep 2006 08:56:41 +0200 writes:

  >>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
  >>>>>     on Mon, 11 Sep 2006 22:25:58 +0100 (BST) writes:

       BDR> At least some of this will go away if you use a current
       BDR> version of 2.4.0 alpha rather than one that is a week
       BDR> old (as the posting guide does ask).  We are now at
       BDR> r39258, and some of those binary packages were built
       BDR> against a substantially later version of 2.4.0 alpha.

       BDR> [............]

    MM> Still "Thank you, Rich!" for running R-alpha and your report.
    MM> We are grateful for everyone who does use R-alpha and reports
    MM> "unusual" findings, even if some of them are already known to
    MM> the R developers.

I have really failed to add the following:

The fact that you get *binary* windows packages for R-alpha **at all**
is already remarkable and only the result of extensive, persistent and
diligent work by Uwe Ligges and Brian Ripley.
They shall be thanked thoroughly hereby!

[ For alpha-testing, I'd typically expect anyone to build
  anything from the sources -- which of course is quite a
  requirement for users of R for windows. ]

Martin



From tom.mccallum at levelelimited.com  Tue Sep 12 12:39:41 2006
From: tom.mccallum at levelelimited.com (Tom McCallum)
Date: Tue, 12 Sep 2006 11:39:41 +0100
Subject: [Rd] Memory problems with a custom R package
Message-ID: <op.tfrg8fgpffxks9@norisk>

Hi everyone,

I have been attempting to build a very simple R package interfacing with  
some very simple C++ code.  Everything I try though results in the  
function working but on return it produces a memory error.  Here is the  
output:

***********OUTPUT***************************

> library(MyPackage)
> hello();

  *** caught segfault ***
address 0x3, cause 'memory not mapped'

**********END OUTPUT*************************

I have read that some time this occurs because it cannot find the function  
in the shared library but I have tested this theory with a simple text  
message and this is displayed but again the memory error occurs.

The C++ code has been reduced to the simplest possible:

*** helloworld.h

extern "C" void helloworld(void);

*** helloworld.cpp

#include <iostream>
#include "helloworld.h"

void helloworld(void) {
//	This was my test line that was displayed as described above.
//      std::cout << "My first R Package Test." << std::endl;
}

I also wrote an R wrapper called hello as follows:

*** helloworld.R

hello <- function()
{
  .Call("helloworld", PACKAGE="MyPackage");
}

The namespaces file (NAMESPACE) is as follows:

useDynLib(MyPackage)
export(hello)

I have compared mine against other package sources available that do the  
same thing and cannot find the key difference.

Thank you for your help in advance,

Tom



From ripley at stats.ox.ac.uk  Tue Sep 12 12:56:58 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 12 Sep 2006 11:56:58 +0100 (BST)
Subject: [Rd] Memory problems with a custom R package
In-Reply-To: <op.tfrg8fgpffxks9@norisk>
References: <op.tfrg8fgpffxks9@norisk>
Message-ID: <Pine.LNX.4.64.0609121150460.5945@gannet.stats.ox.ac.uk>

On Tue, 12 Sep 2006, Tom McCallum wrote:

> Hi everyone,
> 
> I have been attempting to build a very simple R package interfacing with  
> some very simple C++ code.  Everything I try though results in the  
> function working but on return it produces a memory error.  Here is the  
> output:
> 
> ***********OUTPUT***************************
> 
> > library(MyPackage)
> > hello();
> 
>   *** caught segfault ***
> address 0x3, cause 'memory not mapped'
> 
> **********END OUTPUT*************************
> 
> I have read that some time this occurs because it cannot find the function  
> in the shared library but I have tested this theory with a simple text  

Where did you read that?  It is not true: you get an R error message in 
that case.

> message and this is displayed but again the memory error occurs.
> 
> The C++ code has been reduced to the simplest possible:
> 
> *** helloworld.h
> 
> extern "C" void helloworld(void);
> 
> *** helloworld.cpp
> 
> #include <iostream>
> #include "helloworld.h"
> 
> void helloworld(void) {
> //	This was my test line that was displayed as described above.
> //      std::cout << "My first R Package Test." << std::endl;
> }
> 

But that is the problem: .Call requires a SEXP return value from the entry 
point it calls.


> I also wrote an R wrapper called hello as follows:
> 
> *** helloworld.R
> 
> hello <- function()
> {
>   .Call("helloworld", PACKAGE="MyPackage");
> }
> 
> The namespaces file (NAMESPACE) is as follows:
> 
> useDynLib(MyPackage)
> export(hello)
> 
> I have compared mine against other package sources available that do the  
> same thing and cannot find the key difference.
> 
> Thank you for your help in advance,
> 
> Tom
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From hin-tak.leung at cimr.cam.ac.uk  Tue Sep 12 14:23:33 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Tue, 12 Sep 2006 13:23:33 +0100
Subject: [Rd] Memory problems with a custom R package
In-Reply-To: <op.tfrg8fgpffxks9@norisk>
References: <op.tfrg8fgpffxks9@norisk>
Message-ID: <4506A6C5.6060502@cimr.cam.ac.uk>

compiler/platform?

I did this:
R CMD SHLIB helloworld.cpp

Then this in R:
 >  dyn.load("helloworld.so")
 > .Call("helloworld")

and it doesn't segfault. (x86_64 linux with 32-bit R).


Tom McCallum wrote:
> Hi everyone,
> 
> I have been attempting to build a very simple R package interfacing with  
> some very simple C++ code.  Everything I try though results in the  
> function working but on return it produces a memory error.  Here is the  
> output:
> 
> ***********OUTPUT***************************
> 
>> library(MyPackage)
>> hello();
> 
>   *** caught segfault ***
> address 0x3, cause 'memory not mapped'
> 
> **********END OUTPUT*************************
> 
> I have read that some time this occurs because it cannot find the function  
> in the shared library but I have tested this theory with a simple text  
> message and this is displayed but again the memory error occurs.
> 
> The C++ code has been reduced to the simplest possible:
> 
> *** helloworld.h
> 
> extern "C" void helloworld(void);
> 
> *** helloworld.cpp
> 
> #include <iostream>
> #include "helloworld.h"
> 
> void helloworld(void) {
> //	This was my test line that was displayed as described above.
> //      std::cout << "My first R Package Test." << std::endl;
> }
> 
> I also wrote an R wrapper called hello as follows:
> 
> *** helloworld.R
> 
> hello <- function()
> {
>   .Call("helloworld", PACKAGE="MyPackage");
> }
> 
> The namespaces file (NAMESPACE) is as follows:
> 
> useDynLib(MyPackage)
> export(hello)
> 
> I have compared mine against other package sources available that do the  
> same thing and cannot find the key difference.
> 
> Thank you for your help in advance,
> 
> Tom
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



From gregor.gorjanc at bfro.uni-lj.si  Tue Sep 12 15:22:23 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Tue, 12 Sep 2006 15:22:23 +0200
Subject: [Rd] R Citation through time
In-Reply-To: <17670.23382.939954.269492@celebrian.ci.tuwien.ac.at>
References: <45064B70.3050809@bfro.uni-lj.si>
	<17670.23382.939954.269492@celebrian.ci.tuwien.ac.at>
Message-ID: <4506B48F.8060807@bfro.uni-lj.si>

Friedrich Leisch wrote:
>>>>>> On Tue, 12 Sep 2006 07:53:52 +0200,
>>>>>> Gregor Gorjanc (GG) wrote:
> 
>   > Hello!
>   > I keep my local bib file and up to now I had entry
> 
>   >   @Manual{R:2003,
>   >     title = {R: A Language and Environment for Statistical Computing},
>   >     author = {{R Development Core Team}},
>   >     organization = {R Foundation for Statistical Computing},
>   >     address = {Vienna, Austria},
>   >     year = {2005},
>   >     note = {{ISBN} 3-900051-00-3},
>   >     url = {http://www.R-project.org},
>   >   }
> 
>   > With recent versions ISBN changed to 3-900051-07-0.
> 
> It changed with 2.0.0, which is not that recent ...
> 
>   > Now I wonder if there is any canonical way to refer to R without
>   > the need to change R entry over and over. It would probably be the
>   > best just to add new entry for "new version" for R. Now the
>   > question is what is new version or when does ISBN number change?
> 
> The ISBN changes with every major version of R, i.e., it will change
> next when 3.0.0 is released. We are already stretching the ISBN rules
> to the limit (on the no-change-side) with that policy, and the
> reason is exactly to make the reference more stable. But with a major
> release we really need to assign a new ISBN.

Thank you for this clarifications. As indicated ISBN is not changing
very often and I can live with couple of BibTeX entries for R.

Thanks!

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.



From candrews at buffalo.edu  Tue Sep 12 16:17:33 2006
From: candrews at buffalo.edu (candrews at buffalo.edu)
Date: Tue, 12 Sep 2006 16:17:33 +0200 (CEST)
Subject: [Rd] mcnemar.test helpfile (PR#9220)
Message-ID: <20060912141733.B64AE11340@slim.kubism.ku.dk>

Full_Name: Chris Andrews
Version: 2.3.1
OS: Windows
Submission from: (NULL) (128.205.253.147)


?mcnemar.test

ends with an example:

     ## Agresti (1990), p. 350.
     ## Presidential Approval Ratings.
     ##  Approval of the President's performance in office in two surveys,
     ##  one month apart, for a random sample of 1600 voting-age Americans.
     Performance <-
     matrix(c(794, 86, 150, 570),
            nr = 2,
            dimnames = list("1st Survey" = c("Approve", "Disapprove"),
                            "2nd Survey" = c("Approve", "Disapprove")))
     Performance
     mcnemar.test(Performance)
     ## => very strong association between the two successive ratings

The example runs fine.  The final statement ("very strong association between
the two successive ratings") is true.  But they are unrelated.  McNemar's test
is a test of marginal homogeneity.  The conclusion should be that opinion has
changed.  The marginal distributions are different.  The approval rating has
dropped from 59% to 55% (p=4e-5).



From sfalcon at fhcrc.org  Tue Sep 12 16:30:56 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Tue, 12 Sep 2006 07:30:56 -0700
Subject: [Rd] problems in installing packages with R version 2.4.0 alpha
	(2006-09-05 r39134)
In-Reply-To: <45065AD4.3080403@statistik.uni-dortmund.de> (Uwe Ligges's
	message of "Tue, 12 Sep 2006 08:59:32 +0200")
References: <20060911163055.BHS69946@po-d.temple.edu>
	<Pine.LNX.4.64.0609112205460.16814@gannet.stats.ox.ac.uk>
	<45065AD4.3080403@statistik.uni-dortmund.de>
Message-ID: <m2hczd88db.fsf@ziti.fhcrc.org>

Uwe Ligges <ligges at statistik.uni-dortmund.de> writes:
> Currently, the main problems with many packages are missing *recent* 
> binaries (after the latest S4 changes) of BioC packages, hence many 
> dependencies may not be working. I do not want to compile the whole BioC 
> repository as well.

The Bioconductor build systems have been updated to a recent R 2.4.0
alpha and binary packages should be available Real Soon Now.

+ seth



From bhx5 at mevik.net  Tue Sep 12 16:35:19 2006
From: bhx5 at mevik.net (bhx5 at mevik.net)
Date: Tue, 12 Sep 2006 16:35:19 +0200 (CEST)
Subject: [Rd] segfault in plot(x, y, col = aFactor) (PR#9221)
Message-ID: <20060912143519.0910BE0DC@slim.kubism.ku.dk>

After the following commands (issued just after starting R)

set.seed(1)
n <- 600
x <- rnorm(n)
y <- rnorm(n)
aFactor <- factor(rep(1:5, length = n))
plot(x, y, col = aFactor)

R prints

 *** caught segfault ***
address 0x10, cause 'memory not mapped'
Segmentation fault

and dies.

(Yes, I know that using a factor as `col' is wrong; I discovered this by a
mistake. :-)

Substituting "aFactor <- factor(rep(1:5, length = n))" with
"aFactor <- rep(1:5, length = n)" (obviously) works as expected.

When n is smaller, for instance 400, no seg.fault seems to happen.

I also tested this on R 2.3.1 (that's actually where I discovered it :-), and
the same thing happens there.



--please do not edit the information below--

Version:
 platform = x86_64-unknown-linux-gnu
 arch = x86_64
 os = linux-gnu
 system = x86_64, linux-gnu
 status = alpha
 major = 2
 minor = 4.0
 year = 2006
 month = 09
 day = 11
 svn rev = 39258
 language = R
 version.string = R version 2.4.0 alpha (2006-09-11 r39258)

Locale:
LC_CTYPE=no_NO.UTF-8;LC_NUMERIC=C;LC_TIME=no_NO.UTF-8;LC_COLLATE=no_NO.UTF-8;LC_MONETARY=no_NO.UTF-8;LC_MESSAGES=no_NO.UTF-8;LC_PAPER=no_NO.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=no_NO.UTF-8;LC_IDENTIFICATION=C

Search Path:
 .GlobalEnv, package:methods, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, Autoloads, package:base

-- 
Bj?rn-Helge Mevik



From maechler at stat.math.ethz.ch  Tue Sep 12 17:18:48 2006
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Tue, 12 Sep 2006 17:18:48 +0200 (CEST)
Subject: [Rd] segfault in plot(x, y, col = aFactor) (PR#9221)
Message-ID: <20060912151848.D1411589F2@slim.kubism.ku.dk>

Thank you, Bj?rn-Helge.
A shorter version is
   plot(1:500, col = gl(2,250))

Interestingly, with much shorter vectors of length (n), the correct warning
is produced (n times).
And once that has happened, you can use longer vectors without
any problem.

As you said  ``issued just after starting R''
seems quite relevant.

When run in 'R -d gdb', the backtrace ("bt") seems to indicate
that the problem is happening during the  (C-level) warning() call.

Martin



From ripley at stats.ox.ac.uk  Tue Sep 12 17:46:05 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 12 Sep 2006 16:46:05 +0100 (BST)
Subject: [Rd] segfault in plot(x, y, col = aFactor) (PR#9221)
In-Reply-To: <20060912151848.D1411589F2@slim.kubism.ku.dk>
References: <20060912151848.D1411589F2@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0609121637520.10358@gannet.stats.ox.ac.uk>

valgrind solves this:

> plot(x, y, col = aFactor)
==10339== Invalid write of size 4
==10339==    at 0x4F70CE: Rf_FixupCol (plot.c:354)
==10339==    by 0x4FC124: do_plot_xy (plot.c:1554)
==10339==    by 0x4D75DC: do_internal (names.c:1094)
==10339==    by 0x499C05: Rf_eval (eval.c:431)
==10339==    by 0x49A365: Rf_applyClosure (eval.c:614)
==10339==    by 0x499E1F: Rf_eval (eval.c:455)
==10339==    by 0x49B869: do_begin (eval.c:1107)
==10339==    by 0x499C05: Rf_eval (eval.c:431)
==10339==    by 0x49A365: Rf_applyClosure (eval.c:614)
==10339==    by 0x4D7B47: applyMethod (objects.c:121)
==10339==    by 0x4D8505: Rf_usemethod (objects.c:307)
==10339==    by 0x4D8825: do_usemethod (objects.c:391)
==10339==  Address 0x9898130 is 224 bytes inside a block of size 2,440 free'd
==10339==    at 0x49057C8: free (vg_replace_malloc.c:233)

It needs protection in FixupCol because warning() allocates.

On Tue, 12 Sep 2006, maechler at stat.math.ethz.ch wrote:

> Thank you, Bj?rn-Helge.
> A shorter version is
>    plot(1:500, col = gl(2,250))
> 
> Interestingly, with much shorter vectors of length (n), the correct warning
> is produced (n times).
> And once that has happened, you can use longer vectors without
> any problem.
> 
> As you said  ``issued just after starting R''
> seems quite relevant.
> 
> When run in 'R -d gdb', the backtrace ("bt") seems to indicate
> that the problem is happening during the  (C-level) warning() call.
> 
> Martin
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From idimakos at upatras.gr  Tue Sep 12 20:22:13 2006
From: idimakos at upatras.gr (Ioannis Dimakos)
Date: Tue, 12 Sep 2006 21:22:13 +0300 (EEST)
Subject: [Rd] R Citation through time
In-Reply-To: <4506B48F.8060807@bfro.uni-lj.si>
References: <45064B70.3050809@bfro.uni-lj.si>
	<17670.23382.939954.269492@celebrian.ci.tuwien.ac.at>
	<4506B48F.8060807@bfro.uni-lj.si>
Message-ID: <33599.84.254.7.156.1158085333.squirrel@mail.upatras.gr>

Forgive me for being naive,

but I have not seen any reference where the ISBN was required.  The apa
style that I use does not require the ISBN.

Best,

Ioannis

=====
On Tue, Sep 12, 2006 16:22, Gregor Gorjanc wrote:
> Friedrich Leisch wrote:
>>>>>>> On Tue, 12 Sep 2006 07:53:52 +0200,
>>>>>>> Gregor Gorjanc (GG) wrote:
>>
>>   > Hello!
>>   > I keep my local bib file and up to now I had entry
>>
>>   >   @Manual{R:2003,
>>   >     title = {R: A Language and Environment for Statistical
>> Computing},
>>   >     author = {{R Development Core Team}},
>>   >     organization = {R Foundation for Statistical Computing},
>>   >     address = {Vienna, Austria},
>>   >     year = {2005},
>>   >     note = {{ISBN} 3-900051-00-3},
>>   >     url = {http://www.R-project.org},
>>   >   }
>>
>>   > With recent versions ISBN changed to 3-900051-07-0.
>>
>> It changed with 2.0.0, which is not that recent ...
>>
>>   > Now I wonder if there is any canonical way to refer to R without
>>   > the need to change R entry over and over. It would probably be the
>>   > best just to add new entry for "new version" for R. Now the
>>   > question is what is new version or when does ISBN number change?
>>
>> The ISBN changes with every major version of R, i.e., it will change
>> next when 3.0.0 is released. We are already stretching the ISBN rules
>> to the limit (on the no-change-side) with that policy, and the
>> reason is exactly to make the reference more stable. But with a major
>> release we really need to assign a new ISBN.
>
> Thank you for this clarifications. As indicated ISBN is not changing
> very often and I can live with couple of BibTeX entries for R.
>
> Thanks!
>
> --
> Lep pozdrav / With regards,
>     Gregor Gorjanc
>
> ----------------------------------------------------------------------
> University of Ljubljana     PhD student
> Biotechnical Faculty
> Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
> Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si
>
> SI-1230 Domzale             tel: +386 (0)1 72 17 861
> Slovenia, Europe            fax: +386 (0)1 72 17 888
>
> ----------------------------------------------------------------------
> "One must learn by doing the thing; for though you think you know it,
>  you have no certainty until you try." Sophocles ~ 450 B.C.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Ioannis C. Dimakos, Ph.D.
University of Patras
Department of Elementary Education
Patras, GR-26500 GREECE
http://www.elemedu.upatras.gr/dimakos/
http://thedailyblahblah.blogspot.com/



From deepayan.sarkar at gmail.com  Tue Sep 12 20:48:03 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Tue, 12 Sep 2006 11:48:03 -0700
Subject: [Rd] unexpected behaviour when defining a function
In-Reply-To: <Pine.LNX.4.64.0609120725010.10962@gannet.stats.ox.ac.uk>
References: <eb555e660609111626t3f03dd69q2e3ebfe845f6540c@mail.gmail.com>
	<Pine.LNX.4.64.0609120725010.10962@gannet.stats.ox.ac.uk>
Message-ID: <eb555e660609121148o11c6b809n152dca3874380547@mail.gmail.com>

On 9/11/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On Mon, 11 Sep 2006, Deepayan Sarkar wrote:
>
> > Hi,
> >
> > I know S manuals used to warn against using the same names for a
> > variable and a function, but I have never seen that cause problems in
> > R, so I usually don't pay much attention to it.
>
> But in this case you have a promise.  (BTW, it can still cause problems in
> R, hence the following NEWS item for 2.4.0:
>
>         Lookup for S3 methods is confined to functions: previously a
>         non-function 'fun.class' could have masked a function of the
>         same name.
> )
>
> Note that you do have to look at an object to find out if it is a
> function, and that means forcing promises, the problem here.
>
> > Which is why the following behaviour came as a surprise:
> >
> > > bar <- function() 1
> > > foo <- function(bar = bar()) {
> > +     bar
> > + }
> > > foo(9)
> > [1] 9
> > > foo()
> > Error in foo() : recursive default argument reference
> >
> > Exactly what rule am I violating here?
>
> That an argument default value cannot refer to the argument.
>
> This is an argument with a default value that is relying on lazy
> evaluation. When you come to evaluate 'bar' it is a promise with value
> bar().  Evaluating that value looks up 'bar' from the evaluation frame of
> foo() and the first candidate it finds is the argument it is the process
> of evaluating, hence the message.
>
> > The following gives a slightly different error, but I assume it has a
> > similar origin:
> >
> > bar <- function() 1
> > foo <- function(bar) {
> >     if (missing(bar)) bar <- bar()
> >     bar
> > }
> > foo()
>
> It says
>
> > Error in foo() : argument "bar" is missing, with no default
>
> and that is caused by bar <- bar():  it is looking for argument bar (to
> see if it is a function which can be called) and that argument has no
> default.  (I would have thought that one was clear enough.)

It is clear enough once I think about it (I was probably hoping that
it would continue searching, but that does not make sense). Thanks for
the explanation.

Deepayan


>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>



From gregor.gorjanc at bfro.uni-lj.si  Tue Sep 12 21:14:23 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Tue, 12 Sep 2006 21:14:23 +0200
Subject: [Rd] R Citation through time
In-Reply-To: <33599.84.254.7.156.1158085333.squirrel@mail.upatras.gr>
References: <45064B70.3050809@bfro.uni-lj.si>
	<17670.23382.939954.269492@celebrian.ci.tuwien.ac.at>
	<4506B48F.8060807@bfro.uni-lj.si>
	<33599.84.254.7.156.1158085333.squirrel@mail.upatras.gr>
Message-ID: <4507070F.9060700@bfro.uni-lj.si>

Ioannis Dimakos wrote:
> Forgive me for being naive,
> 
> but I have not seen any reference where the ISBN was required.  The apa
> style that I use does not require the ISBN.
> 
> Best,
> 
> Ioannis

You can put that part in note field as it is done in output of
citation() function.

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.



From oceanclear at gmial.com  Tue Sep 12 22:46:59 2006
From: oceanclear at gmial.com (oceanclear at gmial.com)
Date: Tue, 12 Sep 2006 22:46:59 +0200 (CEST)
Subject: [Rd] make check error (PR#9222)
Message-ID: <20060912204659.12F7258A1B@slim.kubism.ku.dk>

Full_Name: 
Version: 3.2.1
OS: RHEL AS 4.0 update 4
Submission from: (NULL) (151.152.101.44)


Error in make check:

running code in 'reg-tests-1.R' .../bin/sh: line 1:  9538 Segmentation fault    
 LC_ALL=C SRCDIR=. R_DEFAULT_PACKAGES= ../bin/R --vanilla <reg-tests-1.R
>reg-tests-1.Rout 2>&1
make[3]: *** [reg-tests-1.Rout] Error 1
make[3]: Leaving directory `/home/xwu/R-2.3.1/tests'
make[2]: *** [test-Reg] Error 2
make[2]: Leaving directory `/home/xwu/R-2.3.1/tests'
make[1]: *** [test-all-basics] Error 1
make[1]: Leaving directory `/home/xwu/R-2.3.1/tests'
make: *** [check] Error 2

At the end of the reg-tests-1.Rout.fail file:

 *** caught segfault ***
address (nil), cause 'unknown'

Traceback:
 1: .Fortran("rg", n, n, x, values = dbl.n, ivalues = dbl.n, !only.values,    
vectors = x, integer(n), dbl.n, ierr = integer(1), PACKAGE = "base")
 2: eigen(Gm, EISPACK = TRUE)
aborting ...


Thanks.
Note: I tried 3.2.0 and got the same error.



From J.Oosting at lumc.nl  Tue Sep 12 23:42:52 2006
From: J.Oosting at lumc.nl (Oosting, J. (PATH))
Date: Tue, 12 Sep 2006 23:42:52 +0200
Subject: [Rd] S4 Method dispatch in recent 2.4.0alpha
References: <40964D91251A18469CB08B6E96FB30BABAD8D0@mailc.lumcnet.prod.intern>
	<45056D23.5040201@r-project.org>
Message-ID: <40964D91251A18469CB08B6E96FB30BA0EF819@mailc.lumcnet.prod.intern>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060912/dc0b6012/attachment-0003.pl 

From Friedrich.Leisch at stat.uni-muenchen.de  Wed Sep 13 09:43:34 2006
From: Friedrich.Leisch at stat.uni-muenchen.de (Friedrich Leisch)
Date: Wed, 13 Sep 2006 09:43:34 +0200
Subject: [Rd] R Citation through time
In-Reply-To: <33599.84.254.7.156.1158085333.squirrel@mail.upatras.gr>
References: <45064B70.3050809@bfro.uni-lj.si>
	<17670.23382.939954.269492@celebrian.ci.tuwien.ac.at>
	<4506B48F.8060807@bfro.uni-lj.si>
	<33599.84.254.7.156.1158085333.squirrel@mail.upatras.gr>
Message-ID: <17671.46758.385797.638043@celebrian.ci.tuwien.ac.at>

>>>>> On Tue, 12 Sep 2006 21:22:13 +0300 (EEST),
>>>>> Ioannis Dimakos (ID) wrote:

  > Forgive me for being naive,
  > but I have not seen any reference where the ISBN was required.  The apa
  > style that I use does not require the ISBN.

It is not required for most citation *styles*. The main reason that we
assigned an ISBN to R is that some
people/journals/departments/... think that software cannot or should
not be cited, and in that cases it often helps to have an ISBN,
because it "looks more official". And the ISBN rules explicitly state
that software should get an ISBN for full references.

Best,
Fritz



From gregor.gorjanc at bfro.uni-lj.si  Wed Sep 13 10:56:02 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Wed, 13 Sep 2006 10:56:02 +0200
Subject: [Rd] Error: package/namespace load failed for 'fortunes'
Message-ID: <4507C7A2.3080708@bfro.uni-lj.si>

Hello!

I have the following R code in my .Rprofile file - just for fun.

  library(fortunes)
  fortune()
  detach("package:fortunes")

This works nicely in R 2.3.1, but it throws the following error under
latest R-devel:

...
...
Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

Error in rbind(rval, read.table(file, header = TRUE, sep = ";", quote =
"\"",  :
        could not find function "read.table"
Error: .onLoad failed in 'loadNamespace' for 'fortunes'
Error: package/namespace load failed for 'fortunes'
>

If I start R-devel with empty .Rprofile I am able to issue above R code
without problems. Is this caused by move of read.table() to utils package?

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.



From hb at stat.berkeley.edu  Wed Sep 13 11:51:51 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Wed, 13 Sep 2006 02:51:51 -0700
Subject: [Rd] example(..., ask=getOption("example.ask"))
Message-ID: <59d7961d0609130251o536208f8j2c2dc7f12f738b26@mail.gmail.com>

Hi,

I wish to return to the topic "[Rd] example(ask = .) - default ?"
discussed in R-devel on May 1, 2006, because I think it is related to
my problem.

In one of my Rd examples I generate multiple (20-30!) PNG files using
png()/dev.off().  I noticed that I get a "Hit <Return> to see next
plot:" for each png() call, when calling example() [interactively].

The code for example() has:

    if (ask == "default")
        ask <- echo && dev.interactive(orNone = TRUE)
    if (ask) {
        if (.Device != "null device") {
            opar <- par(ask = TRUE)
            on.exit(par(opar))
        }
        op <- options(par.ask.default = TRUE)
        on.exit(options(op), add = TRUE)
    }

When calling example() interactively, either with ask=TRUE (explicitly
or indirectly with getOption("example.ask") == "default"), option
'par.ask.default' is set to TRUE.  This seems to be the reason for the
above.  Example:

> options(par.ask.default=TRUE)
> png("foo.png"); plot(1); dev.off()
Hit <Return> to see next plot:
null device
          1
> options(par.ask.default=FALSE)
> png("foo.png"); plot(1); dev.off()
null device
          1

Best

Henrik



From gregor.gorjanc at bfro.uni-lj.si  Wed Sep 13 12:22:20 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Wed, 13 Sep 2006 12:22:20 +0200
Subject: [Rd] [Fwd: Byte size in human readable format]
Message-ID: <4507DBDC.3000204@bfro.uni-lj.si>

Hello,

I have looked once more into this issue and used options() approach with
(yet another :() option - humanReadable. This is the behaviour in R-devel.

> object.size(1000)
[1] 32
> c(object.size(1000), object.size(1:1000), object.size(1:1000000))
[1]      32    4024 4000024
> options(humanReadable=TRUE)
> object.size(1000)
[1] 32 B
> c(object.size(1000), object.size(1:1000), object.size(1:1000000))
[1] 32 B 4 kB 4 MB

I am not very satisfied with the class approach I have taken as a lot of
functions in R drop class attribute, say

> sort(c(object.size(1:1000), object.size(1000)) )
[1]   32 4024

Is it possible to bypass this without writing special methods for "byte"
class. I would appreciate any comments, suggestion. Thanks!

Patches are available at:

http://www.bfro.uni-lj.si/MR/ggorjan/tmp/object.size.R.patch
http://www.bfro.uni-lj.si/MR/ggorjan/tmp/object.size.Rd.patch
http://www.bfro.uni-lj.si/MR/ggorjan/tmp/NAMESPACE.patch
http://www.bfro.uni-lj.si/MR/ggorjan/tmp/humanReadable.Rd

-------- Original Message --------
Subject: Byte size in human readable format
Date: Mon, 21 Aug 2006 14:14:52 +0200
From: Gregor Gorjanc <gregor.gorjanc at bfro.uni-lj.si>
Reply-To: gregor.gorjanc at bfro.uni-lj.si
Organization: University of Ljubljana
To: r-devel at r-project.org
CC: Ales Korosec <korosale at email.si>

Dear R-core,

My friend and I have written a function to convert byte size into human
readable format as can be done with -h argument in say ls, df or du
shell commands. I have also tried to wrap it with print method with
object.size. Is there any intereset to include such a function into say
utils package? Any additional comments, suggestions are more than welcome.

Function and its man page can be found at

http://www.bfro.uni-lj.si/MR/ggorjan/tmp/object.size.R
http://www.bfro.uni-lj.si/MR/ggorjan/tmp/humanReadable.Rd

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.



From ripley at stats.ox.ac.uk  Wed Sep 13 12:31:21 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 13 Sep 2006 11:31:21 +0100 (BST)
Subject: [Rd] example(..., ask=getOption("example.ask"))
In-Reply-To: <59d7961d0609130251o536208f8j2c2dc7f12f738b26@mail.gmail.com>
References: <59d7961d0609130251o536208f8j2c2dc7f12f738b26@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0609131128480.19668@gannet.stats.ox.ac.uk>

And your point/question is?

par(ask = TRUE) applies to all devices, including png.  Try setting
options(par.ask.default = FALSE in your example?


On Wed, 13 Sep 2006, Henrik Bengtsson wrote:

> Hi,
> 
> I wish to return to the topic "[Rd] example(ask = .) - default ?"
> discussed in R-devel on May 1, 2006, because I think it is related to
> my problem.
> 
> In one of my Rd examples I generate multiple (20-30!) PNG files using
> png()/dev.off().  I noticed that I get a "Hit <Return> to see next
> plot:" for each png() call, when calling example() [interactively].
> 
> The code for example() has:
> 
>     if (ask == "default")
>         ask <- echo && dev.interactive(orNone = TRUE)
>     if (ask) {
>         if (.Device != "null device") {
>             opar <- par(ask = TRUE)
>             on.exit(par(opar))
>         }
>         op <- options(par.ask.default = TRUE)
>         on.exit(options(op), add = TRUE)
>     }
> 
> When calling example() interactively, either with ask=TRUE (explicitly
> or indirectly with getOption("example.ask") == "default"), option
> 'par.ask.default' is set to TRUE.  This seems to be the reason for the
> above.  Example:
> 
> > options(par.ask.default=TRUE)
> > png("foo.png"); plot(1); dev.off()
> Hit <Return> to see next plot:
> null device
>           1
> > options(par.ask.default=FALSE)
> > png("foo.png"); plot(1); dev.off()
> null device
>           1
> 
> Best
> 
> Henrik
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From jeff.horner at vanderbilt.edu  Wed Sep 13 17:31:01 2006
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Wed, 13 Sep 2006 10:31:01 -0500
Subject: [Rd] Error: package/namespace load failed for 'fortunes'
In-Reply-To: <4507C7A2.3080708@bfro.uni-lj.si>
References: <4507C7A2.3080708@bfro.uni-lj.si>
Message-ID: <45082435.2080400@vanderbilt.edu>

Gregor Gorjanc wrote:
> Hello!
> 
> I have the following R code in my .Rprofile file - just for fun.
> 
>   library(fortunes)
>   fortune()
>   detach("package:fortunes")
> 
> This works nicely in R 2.3.1, but it throws the following error under
> latest R-devel:
> 
> ...
> ...
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
> 
> Error in rbind(rval, read.table(file, header = TRUE, sep = ";", quote =
> "\"",  :
>         could not find function "read.table"
> Error: .onLoad failed in 'loadNamespace' for 'fortunes'
> Error: package/namespace load failed for 'fortunes'
> 
> If I start R-devel with empty .Rprofile I am able to issue above R code
> without problems. Is this caused by move of read.table() to utils package?

Your intuition was right. Just add library(utils) before 
library(fortunes), and it works. Your .Rprofile is executed before 
.First.sys() (which loads default packages) in base package.

?Startup explains it all.

This raises an interesting topic for me:

  In R-2.3.1, .First.sys() autloads() a few functions from the various 
default packages (utils, stats, methods, graphics) IF those packages 
weren't specified in the default packages option (or the environment 
variable R_DEFAULT_PACKAGES). For instance, if a user doesn't want the 
utils package automatically loaded, then .First.sys() does this:

     sch <- search()
     if(! "package:utils" %in% sch) {
         autoload("example", "utils")
         autoload("methods", "utils")
         autoload("str", "utils")
     }

which will automagically load utils if a call to example, methods, or 
str is made (why just those three? why not others in utils). I presume 
there was some heuristic to determine exactly which functions were 
autoloaded.

Now in R-trunk today, I see that there are no autloaded functions set up 
from .First.sys() for any of the default packages. So if R is started 
with R_DEFAULT_PACKAGES=NULL, then no default packages will be loaded 
and no functions will be set up via autoload(). Why?

Jeff
-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner



From ripley at stats.ox.ac.uk  Wed Sep 13 17:34:06 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 13 Sep 2006 16:34:06 +0100 (BST)
Subject: [Rd] package.skeleton() in R-2.4.1
In-Reply-To: <3D629878-2F94-4831-B61B-398BA052F61A@soc.soton.ac.uk>
References: <3D629878-2F94-4831-B61B-398BA052F61A@soc.soton.ac.uk>
Message-ID: <Pine.LNX.4.64.0609120911400.4185@gannet.stats.ox.ac.uk>

The issue here is the incomplete deparsing of S4 objects in pre-2.4.0.

I am really not sure you want to make a package this way: rather I would 
want the setClass etc calls in the package code.

On Tue, 12 Sep 2006, Robin Hankin wrote:

> Hi
> 
> R version 2.4.0 alpha (2006-09-06 r39158)
> MacOSX 10.4.7
> 
> 
> There was a thread some time ago as to whether  the structure created by
> package.skeleton() would pass R CMD check.
> 
> I have an example where package.skeleton() gives an R file that gives an
> error when sourced.
> 
> 
> If I type
> 
> setClass("brob",
>           representation = representation 
> (x="numeric",positive="logical"),
>           prototype      = list(x=numeric(),positive=logical())
>           )
> 
> setGeneric("getX",function(x){standardGeneric("getX")})
> setMethod("getX","brob",function(x){x at x})
> 
> 
> (which is legal, AFAICS), then
> 
> package.skeleton(path="~")
> 
> I get a file ~/anRpackage/R/getX.R containing:
> 
> 
> "getX" <-
> structure(function(x){standardGeneric("getX")}
> , generic = structure("getX", package = ".GlobalEnv"), package = 
> ".GlobalEnv", group = list(), valueClass = character(0), signature = 
> "x", default = <S4
> object of class structure("MethodsList", package = "methods")>, 
> skeleton = quote(function (x)
> stop("invalid call in method dispatch to 'getX' (no default method)",
>      domain = NA)(x)), class = structure 
> ("nonstandardGenericFunction", package = "methods"))
> 
> 
> [subject to line breaking] but this file gives an error when
> sourced (below).   I didn't get this problem with R-2.3.1.
> 
>
>  > > source("/Users/rksh/anRpackage/R/getX.R")
> Error in parse(file, n = -1, NULL, "?") : syntax error at
> 2: structure(function(x){standardGeneric("getX")}
> 3: , generic = structure("getX", package = ".GlobalEnv"), package = 
> ".GlobalEnv", group = list(), valueClass = character(0), signature = 
> "x", default = <
>  >
> 
> 
> 
> Am I doing something wrong?
> 
> 
> 
> --
> Robin Hankin
> Uncertainty Analyst
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>   tel  023-8059-7743
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From jeff.horner at vanderbilt.edu  Wed Sep 13 17:40:27 2006
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Wed, 13 Sep 2006 10:40:27 -0500
Subject: [Rd] No more autload() calls in .First.sys() ?
In-Reply-To: <45082435.2080400@vanderbilt.edu>
References: <4507C7A2.3080708@bfro.uni-lj.si> <45082435.2080400@vanderbilt.edu>
Message-ID: <4508266B.2090808@vanderbilt.edu>

Jeffrey Horner wrote:
[...]
> This raises an interesting topic for me:
> 
>   In R-2.3.1, .First.sys() autloads() a few functions from the various 
> default packages (utils, stats, methods, graphics) IF those packages 
> weren't specified in the default packages option (or the environment 
> variable R_DEFAULT_PACKAGES). For instance, if a user doesn't want the 
> utils package automatically loaded, then .First.sys() does this:
> 
>      sch <- search()
>      if(! "package:utils" %in% sch) {
>          autoload("example", "utils")
>          autoload("methods", "utils")
>          autoload("str", "utils")
>      }
> 
> which will automagically load utils if a call to example, methods, or 
> str is made (why just those three? why not others in utils). I presume 
> there was some heuristic to determine exactly which functions were 
> autoloaded.

To answer this, all I had to do is look at the subversion log:
-------------------------------------------------------------------------
r27733 | ripley | 2003-12-21 04:21:33 -0600 (Sun, 21 Dec 2003) | 3 lines

allow all the standard examples to run with R_DEFAULT_PACKAGES=NULL
by judicious autoloading
-------------------------------------------------------------------------

That makes sense. But what about the change for R-trunk?

> 
> Now in R-trunk today, I see that there are no autloaded functions set up 
> from .First.sys() for any of the default packages. So if R is started 
> with R_DEFAULT_PACKAGES=NULL, then no default packages will be loaded 
> and no functions will be set up via autoload(). Why?
> 
> Jeff


-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner



From jmc at r-project.org  Wed Sep 13 20:34:06 2006
From: jmc at r-project.org (John Chambers)
Date: Wed, 13 Sep 2006 14:34:06 -0400
Subject: [Rd] S4 Method dispatch in recent 2.4.0alpha
In-Reply-To: <40964D91251A18469CB08B6E96FB30BA0EF819@mailc.lumcnet.prod.intern>
References: <40964D91251A18469CB08B6E96FB30BABAD8D0@mailc.lumcnet.prod.intern>
	<45056D23.5040201@r-project.org>
	<40964D91251A18469CB08B6E96FB30BA0EF819@mailc.lumcnet.prod.intern>
Message-ID: <45084F1E.4070500@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060913/0a24bf1c/attachment-0003.pl 

From J.Oosting at lumc.nl  Wed Sep 13 22:36:26 2006
From: J.Oosting at lumc.nl (Oosting, J. (PATH))
Date: Wed, 13 Sep 2006 22:36:26 +0200
Subject: [Rd] S4 Method dispatch in recent 2.4.0alpha
References: <40964D91251A18469CB08B6E96FB30BABAD8D0@mailc.lumcnet.prod.intern><45056D23.5040201@r-project.org>
	<40964D91251A18469CB08B6E96FB30BA0EF819@mailc.lumcnet.prod.intern>
	<45084F1E.4070500@r-project.org>
Message-ID: <40964D91251A18469CB08B6E96FB30BA0EF81B@mailc.lumcnet.prod.intern>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060913/730b4667/attachment-0003.pl 

From dsamperi at DecisionSynergy.com  Thu Sep 14 03:03:40 2006
From: dsamperi at DecisionSynergy.com (Dominick Samperi)
Date: Wed, 13 Sep 2006 21:03:40 -0400
Subject: [Rd] demo names with spaces?
Message-ID: <4508AA6C.8000609@DecisionSynergy.com>

Does R support demo names with spaces?

I tried placing a file like "My Demo Name.R" in
the demo subdirectory, and placing a line that
begins with "My Demo Name" in 00Index, but
R CMD check does not like this. It reads the
line in 00Index as "My, and it doesn't think there
is a 00Index entry for "My Demo Name".

I have no problem going back to MyDemoName.R,
but I'm curious to know if there is support for
names containing spaces.

Thanks,
ds



From ripley at stats.ox.ac.uk  Thu Sep 14 04:06:57 2006
From: ripley at stats.ox.ac.uk (Prof Brian D Ripley)
Date: Thu, 14 Sep 2006 03:06:57 +0100 (GMT Daylight Time)
Subject: [Rd] demo names with spaces?
In-Reply-To: <4508AA6C.8000609@DecisionSynergy.com>
References: <4508AA6C.8000609@DecisionSynergy.com>
Message-ID: <Pine.WNT.4.64.0609140302120.3584@Petrel>

There are two issues here:

1) file names with spaces are not supported, and indeed you cannot
install such a package on Windows.  Because make is used, this is
pretty fundamental.

2) The parsing code for 00Index used by 'check' assumes whitespace 
separates the name and the title.  In index files generated by R the 
separator is a tab, but demo indices are hand-crafted.

You can use underlines in the file and demo names.

On Wed, 13 Sep 2006, Dominick Samperi wrote:

> Does R support demo names with spaces?
>
> I tried placing a file like "My Demo Name.R" in
> the demo subdirectory, and placing a line that
> begins with "My Demo Name" in 00Index, but
> R CMD check does not like this. It reads the
> line in 00Index as "My, and it doesn't think there
> is a 00Index entry for "My Demo Name".
>
> I have no problem going back to MyDemoName.R,
> but I'm curious to know if there is support for
> names containing spaces.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From gregor.gorjanc at bfro.uni-lj.si  Thu Sep 14 07:52:18 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Thu, 14 Sep 2006 07:52:18 +0200
Subject: [Rd] R-devel: rownames of a data.frame
Message-ID: <4508EE12.7030004@bfro.uni-lj.si>

Hello!

Data.frames have new rownames funcionality, however in use of colnames<-
in R-devel "changes" this. Here is the example:

> df1 <- data.frame(letters[1:5])
> attributes(df1)
$names
[1] "letters.1.5."

$row.names
[1] 1 2 3 4 5

$class
[1] "data.frame"

> colnames(df1) <- "bla"
> attributes(df1)
$names
[1] "bla"

$row.names
[1] "1" "2" "3" "4" "5"

$class
[1] "data.frame"

?rownames/colnames help page (R-devel) says that value is coerced to
character, but why are rownames coerced to character if I assign
colnames to a data.frame?

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.



From fparlamis at mac.com  Thu Sep 14 08:07:53 2006
From: fparlamis at mac.com (Parlamis Franklin)
Date: Wed, 13 Sep 2006 20:07:53 -1000
Subject: [Rd] attributes of S4 objects
Message-ID: <B1EBE009-6321-40D6-B427-BAF7BEE415D3@mac.com>

I am having a bit of a struggle deciding when to use attributes with  
S4 objects.  Clearly the 'class' attribute will always be present.   
But it is not clear to me whether the architects of the methods  
package intend that other attributes, such as 'names', will still be  
used when the S4 implementation is complete.

I notice that, when you create a formal object from an informal one  
with attributes, the attributes are (often) assigned to the formal  
object.  For example,

setClass("Numeric", representation("numeric"))
vec <- 1:10
names(vec) <- letters[1:10]
comment(vec) <- "comment"
Vec <- new("Numeric", vec)
attributes(Vec) ## 'names' and 'comment' attributes are assigned to  
the formal object

But I also notice that, in the absence of an appropriate 'coerce'  
method, 'as(   , superclass)' will return an object without attributes

as(Vec, "numeric") ## gives an unnamed vector of mode numeric with no  
comment attribute

Because of this, I have found myself writing methods for the sole  
purpose of preserving attributes when coercing between basic data  
types and formal classes that extend them.  But the default methods  
for coercing to the basic data types clearly want attributes to be  
stripped (they do so explicitly when strict=TRUE (the default)).  I  
am thinking that maybe it was always intended that non-class  
attributes would not be used with formal objects, and that instead  
analogous slots would appear in any formal objects that extend basic  
data types (like the Dim and Dimnames attributes in the 'Matrix'  
mother class from the Matrix package).

Is that true?  Are attributes un-S4?  Any and all style advice or  
examples would be appreciated.

Franklin Parlamis



From sgiannerini at gmail.com  Thu Sep 14 11:14:51 2006
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Thu, 14 Sep 2006 11:14:51 +0200
Subject: [Rd] digits in summary.default
Message-ID: <3c12769c0609140214u4534ade5p3a4cbc22beb51781@mail.gmail.com>

Dear all,

the number of significant digits in summary default is

digits = max(3, getOption("digits") -  3)

on my platform this results to be 4. The point is that if you have,
say, integer data of magnitude greater than 10^3 the command summary
will produce heavily rounded results.
A simple example follow:

> x <- c(123456,234567,345678)

> x
[1] 123456 234567 345678

> summary(x)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
 123500  179000  234600  234600  290100  345700

# quite different from

> quantile(x)
      0%      25%      50%      75%     100%
123456.0 179011.5 234567.0 290122.5 345678.0

Is it  possible to adapt the number of significant digits to the
magnitude of the data?
The first thing that comes into my mind is
digits = nchar(trunc(max(x)))   #

If it is not possible then I think it would be nice to mention the
issue in the documentation.

Thanks for the attention,

Simone

> R.version
               _
platform       i386-pc-mingw32
arch           i386
os             mingw32
system         i386, mingw32
status
major          2
minor          3.1
year           2006
month          06
day            01
svn rev        38247
language       R
version.string Version 2.3.1 (2006-06-01)

> Sys.getlocale()
[1] "LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
States.1252;LC_MONETARY=English_United
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252"
>

______________________________________________________

Simone Giannerini
Dipartimento di Scienze Statistiche "Paolo Fortunati"
Universita' di Bologna
Via delle belle arti 41 - 40126  Bologna,  ITALY
Tel: +39 051 2098262  Fax: +39 051 232153



From deepayan.sarkar at gmail.com  Thu Sep 14 20:18:31 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Thu, 14 Sep 2006 11:18:31 -0700
Subject: [Rd] changes in upcoming lattice
Message-ID: <eb555e660609141118l4ecbde39u5e9abfa6be0044c4@mail.gmail.com>

Hi,

there will be some fairly major changes in the lattice that will get
released with R 2.4.0. A first version is now available on CRAN, at

http://cran.r-project.org/src/contrib/2.4.0/Recommended/lattice_0.14-3.tar.gz

Although there is a dependency on R 2.4, the package passes R CMD
check on 2.3.1 as well if you change the Depends line in DESCRIPTION.
In other words, you should be able to test it even if you are not
running r-devel.

There are 3 types of changes:

1. Some new features. These are of the most interest in the long run
(albeit to a very small number of users) , but they have not been
thoroughly tested or documented (and some features not even
implemented). Documentation, such as it is, can be found in

?axis.default
?packet.panel.default
?panel.number

2. Bugs that have been introduced in the course of implementing these
new features. Of course I'm hoping that there aren't any such, but I'm
sure there are. So testing your lattice code to flesh out these bugs
before the 2.4.0 release would be appreciated.

3. This is where I might get some legitimate complaints. For the last
several versions of lattice, there has been a feature where the panel
function would get passed arguments called panel.number and
packet.number under certain circumstances. This was to enable the
panel function to know which panel was being plotted. This was
intended as a quick hack, but apparently several users have found the
feature useful. Some new functions, described in ?panel.number,
address this issue in a cleaner and more general way.

Given these new functions, I would like to remove the earlier features
(arguments to panel functions). In fact, I have removed them in
lattice_0.14-3. I will put them back if other packages on CRAN start
to fail or if enough users want it back. I would normally have kept it
in with some sort of warning, but the formal deprecation mechanism
doesn't work in this setting, and I would rather start cleaning up
code that made this work than make it even more complicated. I would
be happy to assist package developers who want to write portable code
that works in both older and newer versions of lattice.

Comments / suggestions / bug reports are welcome.

Deepayan



From mok2 at enthalpy.physics.buffalo.edu  Thu Sep 14 20:35:59 2006
From: mok2 at enthalpy.physics.buffalo.edu (mok2 at enthalpy.physics.buffalo.edu)
Date: Thu, 14 Sep 2006 20:35:59 +0200 (CEST)
Subject: [Rd] Legend Title missing (PR#9226)
Message-ID: <20060914183559.0CC16103E9@slim.kubism.ku.dk>

Full_Name: Mark O. Kimball
Version: 2.1
OS: Linux
Submission from: (NULL) (128.253.11.148)


When log="x" is used in a plot() function, the legend "title" option creates
room for the text but does not display it. When the log="x" function is
disabled, the text is again displayed. The symbols and/or lines and legend text
is not affected.



From mschwartz at mn.rr.com  Thu Sep 14 20:49:11 2006
From: mschwartz at mn.rr.com (mschwartz at mn.rr.com)
Date: Thu, 14 Sep 2006 20:49:11 +0200 (CEST)
Subject: [Rd] Legend Title missing (PR#9226)
Message-ID: <20060914184911.9293B28E9F@slim.kubism.ku.dk>

On Thu, 2006-09-14 at 20:35 +0200, mok2 at enthalpy.physics.buffalo.edu
wrote:
> Full_Name: Mark O. Kimball
> Version: 2.1
> OS: Linux
> Submission from: (NULL) (128.253.11.148)
> 
> 
> When log="x" is used in a plot() function, the legend "title" option creates
> room for the text but does not display it. When the log="x" function is
> disabled, the text is again displayed. The symbols and/or lines and legend text
> is not affected.

>From NEWS for R 2.3.1:

 o	legend() with log axes would place the title in the wrong place.

Upgrade to the current version.

Please don't report bugs on obsolete versions.

HTH,

Marc Schwartz



From sfalcon at fhcrc.org  Thu Sep 14 21:01:31 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Thu, 14 Sep 2006 12:01:31 -0700
Subject: [Rd] Question about substitute() and function def
Message-ID: <m2d59y8e7o.fsf@ziti.fhcrc.org>

Hi,

Can someone help me understand why

  substitute(function(a) a + 1, list(a=quote(foo)))

gives

  function(a) foo + 1

and not

  function(foo) foo + 1

The man page leads me to believe this is related to lazy evaluation of
function arguments, but I'm not getting the big picture.

Thanks,

+ seth


Using R 2.4 alpha svn r39255



From murdoch at stats.uwo.ca  Thu Sep 14 21:38:12 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 14 Sep 2006 15:38:12 -0400
Subject: [Rd] Question about substitute() and function def
In-Reply-To: <m2d59y8e7o.fsf@ziti.fhcrc.org>
References: <m2d59y8e7o.fsf@ziti.fhcrc.org>
Message-ID: <4509AFA4.6010203@stats.uwo.ca>

On 9/14/2006 3:01 PM, Seth Falcon wrote:
> Hi,
> 
> Can someone help me understand why
> 
>   substitute(function(a) a + 1, list(a=quote(foo)))
> 
> gives
> 
>   function(a) foo + 1
> 
> and not
> 
>   function(foo) foo + 1
> 
> The man page leads me to believe this is related to lazy evaluation of
> function arguments, but I'm not getting the big picture.

I think it's the same reason that this happens:

 > substitute(c( a = 1, b = a), list(a = quote(foo)))
c(a = 1, b = foo)

The "a" in function(a) is the name of the arg, it's not the arg itself 
(which is missing).  Now a harder question to answer is why this happens:

 > substitute(function(a=a) 1, list(a=quote(foo)))
function(a = a) 1

I would have expected to get "function(a = foo) 1".

Duncan Murdoch



From rgentlem at fhcrc.org  Thu Sep 14 21:49:01 2006
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Thu, 14 Sep 2006 12:49:01 -0700
Subject: [Rd] Question about substitute() and function def
In-Reply-To: <4509AFA4.6010203@stats.uwo.ca>
References: <m2d59y8e7o.fsf@ziti.fhcrc.org> <4509AFA4.6010203@stats.uwo.ca>
Message-ID: <4509B22D.1050604@fhcrc.org>



Duncan Murdoch wrote:
> On 9/14/2006 3:01 PM, Seth Falcon wrote:
>> Hi,
>>
>> Can someone help me understand why
>>
>>   substitute(function(a) a + 1, list(a=quote(foo)))
>>
>> gives
>>
>>   function(a) foo + 1
>>
>> and not
>>
>>   function(foo) foo + 1
>>
>> The man page leads me to believe this is related to lazy evaluation of
>> function arguments, but I'm not getting the big picture.
> 
> I think it's the same reason that this happens:
> 
>  > substitute(c( a = 1, b = a), list(a = quote(foo)))
> c(a = 1, b = foo)
> 
> The "a" in function(a) is the name of the arg, it's not the arg itself 

yes, but the logic seems to be broken. In Seth's case there seems to be 
no way to use substitute to globally change an argument and all 
instances throughout a function, which seems like a task that would be 
useful.

even here, I would have expected all instances of a to change, not some

> (which is missing).  Now a harder question to answer is why this happens:
> 
>  > substitute(function(a=a) 1, list(a=quote(foo)))
> function(a = a) 1

   a bug for sure


> I would have expected to get "function(a = foo) 1".
> 
> Duncan Murdoch
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org



From bill at insightful.com  Thu Sep 14 21:54:34 2006
From: bill at insightful.com (Bill Dunlap)
Date: Thu, 14 Sep 2006 12:54:34 -0700 (PDT)
Subject: [Rd] Question about substitute() and function def
In-Reply-To: <4509AFA4.6010203@stats.uwo.ca>
References: <m2d59y8e7o.fsf@ziti.fhcrc.org> <4509AFA4.6010203@stats.uwo.ca>
Message-ID: <Pine.GSO.4.56.0609141248020.2611@durian.statsci.com>

On Thu, 14 Sep 2006, Duncan Murdoch wrote:

> I think it's the same reason that this happens:
>
>  > substitute(c( a = 1, b = a), list(a = quote(foo)))
> c(a = 1, b = foo)
>
> The "a" in function(a) is the name of the arg, it's not the arg itself
> (which is missing).  Now a harder question to answer is why this happens:
>
>  > substitute(function(a=a) 1, list(a=quote(foo)))
> function(a = a) 1
>
> I would have expected to get "function(a = foo) 1".

In Splus you do get what you expected.
   > substitute(function(a=a) 1, list(a=quote(foo)))
   function(a = foo)
   1
   > substitute(function(a=func(100))func(a), list(func=quote(myFunction)))
   function(a = myFunction(100))
   myFunction(a)

R's substitute does not appear to go into
the 'formals' of a function definition
when looking for names to replace.

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."



From pbautist2 at yahoo.com.mx  Thu Sep 14 22:47:12 2006
From: pbautist2 at yahoo.com.mx (Patricia Bautista)
Date: Thu, 14 Sep 2006 15:47:12 -0500 (CDT)
Subject: [Rd] Evaluating R expresions from C
Message-ID: <20060914204712.38442.qmail@web32701.mail.mud.yahoo.com>

Good afternood everybody,

I have a question about using "Rinternals.h": If I
need to evaluate a R expresion from my c++ code Do I
have to change my c++ code enterelly?, I'm thinking
about the way I allocate memory and the way I print
for example.

Thanks for any help in advance.
Patricia



	
	
		
___________________________________________________________ 
Do You Yahoo!? 
La mejor conexi?n a Internet y <b >2GB</b> extra a tu correo por $100 al mes. http://net.yahoo.com.mx



From bill at insightful.com  Thu Sep 14 23:08:23 2006
From: bill at insightful.com (Bill Dunlap)
Date: Thu, 14 Sep 2006 14:08:23 -0700 (PDT)
Subject: [Rd] Question about substitute() and function def
In-Reply-To: <4509B22D.1050604@fhcrc.org>
References: <m2d59y8e7o.fsf@ziti.fhcrc.org> <4509AFA4.6010203@stats.uwo.ca>
	<4509B22D.1050604@fhcrc.org>
Message-ID: <Pine.GSO.4.56.0609141355250.2611@durian.statsci.com>

On Thu, 14 Sep 2006, Robert Gentleman wrote:

> >  > substitute(c( a = 1, b = a), list(a = quote(foo)))
> > c(a = 1, b = foo)
> >
> > The "a" in function(a) is the name of the arg, it's not the arg itself
>
> yes, but the logic seems to be broken. In Seth's case there seems to be
> no way to use substitute to globally change an argument and all
> instances throughout a function, which seems like a task that would be
> useful.
>
> even here, I would have expected all instances of a to change, not some

In Splus, substitute changes all "name" objects with
the values given by the names on the list given as its
second argument.  In Splus the argument name
in the formals list is not of class "name" - it is
of class "character".  Hence it is not substituted.
I agree it would be handy if it were substituted.

In R I'm not sure what class/mode the argument name
in the formals list has.  The formals list is a "pairlist"
and the argument names are th names of the pairlist.
What internal class/mode do they have?

However, substitute() in R does not appear to go into
formal arguments of a function at all.

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."



From murdoch at stats.uwo.ca  Fri Sep 15 01:24:32 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 14 Sep 2006 19:24:32 -0400
Subject: [Rd] Question about substitute() and function def
In-Reply-To: <4509B22D.1050604@fhcrc.org>
References: <m2d59y8e7o.fsf@ziti.fhcrc.org> <4509AFA4.6010203@stats.uwo.ca>
	<4509B22D.1050604@fhcrc.org>
Message-ID: <4509E4B0.4020702@stats.uwo.ca>

On 9/14/2006 3:49 PM, Robert Gentleman wrote:
> 
> Duncan Murdoch wrote:
>> On 9/14/2006 3:01 PM, Seth Falcon wrote:
>>> Hi,
>>>
>>> Can someone help me understand why
>>>
>>>   substitute(function(a) a + 1, list(a=quote(foo)))
>>>
>>> gives
>>>
>>>   function(a) foo + 1
>>>
>>> and not
>>>
>>>   function(foo) foo + 1
>>>
>>> The man page leads me to believe this is related to lazy evaluation of
>>> function arguments, but I'm not getting the big picture.
>> I think it's the same reason that this happens:
>>
>>  > substitute(c( a = 1, b = a), list(a = quote(foo)))
>> c(a = 1, b = foo)
>>
>> The "a" in function(a) is the name of the arg, it's not the arg itself 
> 
> yes, but the logic seems to be broken. In Seth's case there seems to be 
> no way to use substitute to globally change an argument and all 
> instances throughout a function, which seems like a task that would be 
> useful.

I think variables and argument names are fundamentally different things, 
so I don't see this as very surprising.  It should take two steps to 
make a change like that.  Use substitute() to change the variables, put 
the result in f, change the names of the formals using

names(formals(f)) <- "foo".

I'm not sure if there's a simple way to change the first "a" in the 
expression c(a=1, b=a), but there are probably convoluted ways to do it.

> 
> even here, I would have expected all instances of a to change, not some
> 
>> (which is missing).  Now a harder question to answer is why this happens:
>>
>>  > substitute(function(a=a) 1, list(a=quote(foo)))
>> function(a = a) 1
> 
>    a bug for sure

Yes.

Duncan



From maechler at stat.math.ethz.ch  Fri Sep 15 09:52:14 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 15 Sep 2006 09:52:14 +0200
Subject: [Rd] digits in summary.default
In-Reply-To: <3c12769c0609140214u4534ade5p3a4cbc22beb51781@mail.gmail.com>
References: <3c12769c0609140214u4534ade5p3a4cbc22beb51781@mail.gmail.com>
Message-ID: <17674.23470.428546.240383@stat.math.ethz.ch>

>>>>> "Simone" == Simone Giannerini <sgiannerini at gmail.com>
>>>>>     on Thu, 14 Sep 2006 11:14:51 +0200 writes:

    Simone> Dear all, the number of significant digits in
    Simone> summary default is

    Simone> digits = max(3, getOption("digits") - 3)

    Simone> on my platform this results to be 4. The point is
    Simone> that if you have, say, integer data of magnitude
    Simone> greater than 10^3 the command summary will produce
    Simone> heavily rounded results.

    Simone>   A simple example follow:

    >> x <- c(123456,234567,345678)

    >> x
    Simone> [1] 123456 234567 345678

    >> summary(x)
    Simone>    Min. 1st Qu.  Median Mean 3rd Qu.  Max.  123500
    Simone> 179000 234600 234600 290100 345700

    Simone> # quite different from

    >> quantile(x)
    Simone>       0%        25%     50%      75%     100%
    Simone>  123456.0 179011.5 234567.0 290122.5 345678.0

            
Yes, a very very very old topic, and has been frequently on the
R lists.
The reason for this default has been compatibility with S
and in particular Splus-3.4 (1996) which used to be a partial
role model for R in its infancy.

However, I now see that Insightful also must have decided that
the old S setting was not satisfactory and that one can and
should do better.

    Simone> Is it possible to adapt the number of significant
    Simone> digits to the magnitude of the data?  The first
    Simone> thing that comes into my mind is 

    Simone>      digits = nchar(trunc(max(x))) #

that's a first step of one thing to consider, yes,
but does need quite a bit of fixup before it's usable.

Since I've now seen the code of summary.default in S-plus 6.2,
I'm not in a good position to propose a code change here ---
unless Insightful ``donates'' their 3 lines of implementation to
R  {which I think would be quite fair given the recent flurry of
    things they've recently ported into S-plus 8.x}

    Simone> If it is not possible then I think it would be nice
    Simone> to mention the issue in the documentation.

The issue is mentioned but maybe in a too terse way.

I agree that I'd also want to change this behavior.
It's definitely too late for R 2.4.0, since although this may
seem like a small thing to do,
it can have quite a large effect in many outputs of R scripts.

    Simone> Thanks for the attention,

    Simone> Simone

    >> R.version
    ..............
    (does not really matter - here for once)

Martin Maechler, ETH Zurich



From p.dalgaard at biostat.ku.dk  Fri Sep 15 10:05:32 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 15 Sep 2006 10:05:32 +0200
Subject: [Rd] Question about substitute() and function def
In-Reply-To: <4509E4B0.4020702@stats.uwo.ca>
References: <m2d59y8e7o.fsf@ziti.fhcrc.org> <4509AFA4.6010203@stats.uwo.ca>
	<4509B22D.1050604@fhcrc.org> <4509E4B0.4020702@stats.uwo.ca>
Message-ID: <x2venpy2pf.fsf@turmalin.kubism.ku.dk>

Duncan Murdoch <murdoch at stats.uwo.ca> writes:

> >>  > substitute(function(a=a) 1, list(a=quote(foo)))
> >> function(a = a) 1
> > 
> >    a bug for sure
> 
> Yes.

Hmm... The issue is that the argument to `function` is a pairlist (not
LANGSXP), and we don't recurse into those. Any R object can turn up as
part of objects of mode "call" (by various methods, not least call()
constructions), and I don't think we want to substitute into any
recursive object. However, it's unlikely that pairlists would be used
for anything other than function arguments, so I suppose we could
change the behaviour (special-casing calls to `function` is an
alternative). Luke?

To wit:

> mode(quote(function(x)1)[[1]])
[1] "name"
> mode(quote(function(x)1)[[2]])
[1] "pairlist"
> mode(quote(function(x)1)[[3]])
[1] "numeric"


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From karloh at mi.uib.no  Fri Sep 15 11:21:03 2006
From: karloh at mi.uib.no (Karl Ove Hufthammer)
Date: Fri, 15 Sep 2006 11:21:03 +0200
Subject: [Rd] digits in summary.default
References: <3c12769c0609140214u4534ade5p3a4cbc22beb51781@mail.gmail.com>
	<17674.23470.428546.240383@stat.math.ethz.ch>
Message-ID: <eedr9v$l9b$1@sea.gmane.org>

Martin Maechler skreiv:

> Since I've now seen the code of summary.default in S-plus 6.2,
> I'm not in a good position to propose a code change here ---
> unless Insightful ``donates'' their 3 lines of implementation to
> R??{which?I?think?would?be?quite?fair?given?the?recent?flurry?of
> things?they've?recently?ported?into?S-plus?8.x}

It's also possible to be a bit smarter in specific cases. See for example
the LaTeX table functions for regression summaries in the Dmisc package[1],
which uses the magnitude of the standard errors to dermine the number of
digits shown for estimates (s.t. the number of digits vary for each row/
estimate).

[1] Not on CRAN. See http://www.menne-biomed.de/download/download.html

-- 
Karl Ove Hufthammer
E-mail and Jabber: karl at huftis.org



From wilder at well.ox.ac.uk  Fri Sep 15 12:44:45 2006
From: wilder at well.ox.ac.uk (wilder at well.ox.ac.uk)
Date: Fri, 15 Sep 2006 12:44:45 +0200 (CEST)
Subject: [Rd] Help on "title" wrongly specifies axis label font (PR#9230)
Message-ID: <20060915104445.E3963589EB@slim.kubism.ku.dk>

Full_Name: Steven Wilder
Version: 2.3.1
OS: Windows XP
Submission from: (NULL) (129.67.45.165)


The help on title help("title") states
xlab: X axis label using font and character expansion
          'par("font.axis")' and color 'par("col.axis")'.

but these have no effect, font.lab and col.lab should be used.

These are stated correctly in help("par").



From jmc at r-project.org  Fri Sep 15 15:46:42 2006
From: jmc at r-project.org (John Chambers)
Date: Fri, 15 Sep 2006 09:46:42 -0400
Subject: [Rd] attributes of S4 objects
In-Reply-To: <B1EBE009-6321-40D6-B427-BAF7BEE415D3@mac.com>
References: <B1EBE009-6321-40D6-B427-BAF7BEE415D3@mac.com>
Message-ID: <450AAEC2.7060103@r-project.org>

Parlamis Franklin wrote:
> I am having a bit of a struggle deciding when to use attributes with  
> S4 objects.  Clearly the 'class' attribute will always be present.   
> But it is not clear to me whether the architects of the methods  
> package intend that other attributes, such as 'names', will still be  
> used when the S4 implementation is complete.
>   
"Can of worms" might be a good description of this situation.

The cautious approach would be to not assume attributes get carried over 
to an object that uses a basic R data type ("numeric" in your example) 
as the data in the new class.  If you need arbitrary attributes, it's 
safer to make the old-style object into a slot:
  setClass("Numeric", representation(x = "numeric"))
which should not balk at the slot having attributes.

Here's the underlying point:  There are two very different computing 
models here.  Old-style attributes were basically undisciplined; each 
object could have its own collection of attributes and these could 
appear and disappear.  Names are a good example:

 > z = 1:10
 > names(z) <- letters[1:10]
 > names(attributes(z))
[1] "names"
 > names(z) <- NULL
 > names(attributes(z))
NULL

In contrast, S4 class definitions guarantee what slots are available, 
and that they inherit from specified classes.  So if names() in the S3 
sense were made a part of the S4 object, they could not just disappear 
as in this example.  But then it's doubtful that the great mound of code 
that uses names in the S3 sense would still all work correctly for 
objects from the S4 classes.  So the safe approach is to keep the two 
ideas separate.

There are many ways to bridge the gap; for example, by having an 
initialize() method for the S4 class that takes attributes from an S3 
object and copies them into slots in the S4 object, when the attributes 
happen to be there.


> I notice that, when you create a formal object from an informal one  
> with attributes, the attributes are (often) assigned to the formal  
> object.  For example,
>
> setClass("Numeric", representation("numeric"))
> vec <- 1:10
> names(vec) <- letters[1:10]
> comment(vec) <- "comment"
> Vec <- new("Numeric", vec)
> attributes(Vec) ## 'names' and 'comment' attributes are assigned to  
> the formal object
>
> But I also notice that, in the absence of an appropriate 'coerce'  
> method, 'as(   , superclass)' will return an object without attributes
>
> as(Vec, "numeric") ## gives an unnamed vector of mode numeric with no  
> comment attribute
>
> Because of this, I have found myself writing methods for the sole  
> purpose of preserving attributes when coercing between basic data  
> types and formal classes that extend them.  But the default methods  
> for coercing to the basic data types clearly want attributes to be  
> stripped (they do so explicitly when strict=TRUE (the default)).  I  
> am thinking that maybe it was always intended that non-class  
> attributes would not be used with formal objects, and that instead  
> analogous slots would appear in any formal objects that extend basic  
> data types (like the Dim and Dimnames attributes in the 'Matrix'  
> mother class from the Matrix package).
>
> Is that true?  Are attributes un-S4?  Any and all style advice or  
> examples would be appreciated.
>
> Franklin Parlamis
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>



From Alex.Randriamiharisoa at chuv.ch  Fri Sep 15 15:45:14 2006
From: Alex.Randriamiharisoa at chuv.ch (Alex.Randriamiharisoa at chuv.ch)
Date: Fri, 15 Sep 2006 15:45:14 +0200
Subject: [Rd] How to create the couple of  files .rdb and .rdx
Message-ID: <5.1.0.14.2.20060915145456.023fbf08@pop.intranet.chuv>

Dear all,
I would like to create new version (for R >= 2.0.0)  of my old libraries 
(under Windows XP).
The conversion of FORTRAN source  to  dll file is OK (via Rcmd SHLIB ) but 
the command
   Rcmd.exe  build  pkgdirs
did not create the two files .rdb and .rdx of the R functions (Warning 
message .../R is empty). How can I manually create them ?
With the command
   save(list=..., compress=TRUE, ascii=FALSE)
only one binary file  is created.
Thanks in advance for any help.
Alex



From r.hankin at noc.soton.ac.uk  Fri Sep 15 15:56:56 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Fri, 15 Sep 2006 14:56:56 +0100
Subject: [Rd] setMethod() woes
Message-ID: <04A1F698-8422-4DB8-B586-6613E51A9BAC@soc.soton.ac.uk>

Hello everybody

R version 2.4.0 alpha (2006-09-15 r39323), MacOSX 10.4.7


Next S4 problem.

I have "brob" objects that are large real numbers, and now I want "glub"
numbers that are to be a pair of glubs that represent complex numbers.

I want to define binary operator "+" so that if either the left or right
argument are glubs,  it uses .ArithGlub.

If either argument is a brob (but neither is a glub), use .ArithGlub

If neither is a brob or a glub, use standard "+"

(just like real/complex "+").

My attempt (self contained, minimal) is included below.
But, with this, the following session shows that something is wrong:



 > a <- new("brob",x=1:5,positive=rep(T,5))
 > b <- new("glub",real=a,imag=a)
 > a+b
Error in a + b : binary operator " + " not defined for Brobdingnagian  
numbers
In addition: Warning message:
Ambiguous method selection for "+", target "brob#glub" (the first of  
the signatures shown will be used)
     brob#ANY
     ANY#glub
in: .findInheritedMethods(classes, fdef, mtable)



I don't understand what to do to avoid getting the warning
message [and it's also using  the wrong function: I want it
to call .ArithGlub() here, not .ArithBrob() ]

I need to use signature(e1="brob", e2="anything except a glub")
but I can't figure out how to do this.







setClass("brob",
          representation = representation 
(x="numeric",positive="logical"),
          prototype      = list(x=numeric(),positive=logical())
          )

setClass("glub",
          representation = representation(real="brob",imag="brob"),
          prototype      = list(real=new("brob"), imag=new("brob"))
          )

.ArithBrob <- function(e1,e2){	
   stop(paste("binary operator \"", .Generic, "\" not defined for  
Brobdingnagian numbers"))	
}		     	

.ArithGlub <- function(e1,e2){	
   stop(paste("binary operator \"", .Generic, "\" not defined for  
Glub numbers"))
}		     	

setMethod("Arith",signature(e1 = "brob", e2="brob"), .ArithBrob)
setMethod("Arith",signature(e1 = "brob", e2="ANY" ), .ArithBrob)
setMethod("Arith",signature(e1 = "ANY" , e2="brob"), .ArithBrob)

setMethod("Arith",signature(e1 = "glub"), .ArithGlub)
setMethod("Arith",signature(e2 = "glub"), .ArithGlub)







--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743



From jmc at r-project.org  Fri Sep 15 16:40:44 2006
From: jmc at r-project.org (John Chambers)
Date: Fri, 15 Sep 2006 10:40:44 -0400
Subject: [Rd] setMethod() woes
In-Reply-To: <04A1F698-8422-4DB8-B586-6613E51A9BAC@soc.soton.ac.uk>
References: <04A1F698-8422-4DB8-B586-6613E51A9BAC@soc.soton.ac.uk>
Message-ID: <450ABB6C.2020805@r-project.org>

The document on developer.r-project.org/howMethodsWork.pdf explains why 
the two methods are equally close.  Please (re)read it.

If you know what methods you want for mixing the two objects, you must 
either say so or arrange the classes in an inheritance that includes 
both classes.

Robin Hankin wrote:
> Hello everybody
>
> R version 2.4.0 alpha (2006-09-15 r39323), MacOSX 10.4.7
>
>
> Next S4 problem.
>
> I have "brob" objects that are large real numbers, and now I want "glub"
> numbers that are to be a pair of glubs that represent complex numbers.
>
> I want to define binary operator "+" so that if either the left or right
> argument are glubs,  it uses .ArithGlub.
>
> If either argument is a brob (but neither is a glub), use .ArithGlub
>   
You don't mean what you just said, presumably ".ArithBrob"

But this is not specifiable as a method signature unless you create a 
"brobOrGlub" class.  This is a Do What I Mean.
> If neither is a brob or a glub, use standard "+"
>
> (just like real/complex "+").
>
> My attempt (self contained, minimal) is included below.
> But, with this, the following session shows that something is wrong:
>
>
>
>  > a <- new("brob",x=1:5,positive=rep(T,5))
>  > b <- new("glub",real=a,imag=a)
>  > a+b
> Error in a + b : binary operator " + " not defined for Brobdingnagian  
> numbers
> In addition: Warning message:
> Ambiguous method selection for "+", target "brob#glub" (the first of  
> the signatures shown will be used)
>      brob#ANY
>      ANY#glub
> in: .findInheritedMethods(classes, fdef, mtable)
>
>
>
> I don't understand what to do to avoid getting the warning
> message [and it's also using  the wrong function: I want it
> to call .ArithGlub() here, not .ArithBrob() ]
>
> I need to use signature(e1="brob", e2="anything except a glub")
> but I can't figure out how to do this.
>
>
>
>
>
>
>
> setClass("brob",
>           representation = representation 
> (x="numeric",positive="logical"),
>           prototype      = list(x=numeric(),positive=logical())
>           )
>
> setClass("glub",
>           representation = representation(real="brob",imag="brob"),
>           prototype      = list(real=new("brob"), imag=new("brob"))
>           )
>
> .ArithBrob <- function(e1,e2){	
>    stop(paste("binary operator \"", .Generic, "\" not defined for  
> Brobdingnagian numbers"))	
> }		     	
>
> .ArithGlub <- function(e1,e2){	
>    stop(paste("binary operator \"", .Generic, "\" not defined for  
> Glub numbers"))
> }		     	
>
> setMethod("Arith",signature(e1 = "brob", e2="brob"), .ArithBrob)
> setMethod("Arith",signature(e1 = "brob", e2="ANY" ), .ArithBrob)
> setMethod("Arith",signature(e1 = "ANY" , e2="brob"), .ArithBrob)
>
> setMethod("Arith",signature(e1 = "glub"), .ArithGlub)
> setMethod("Arith",signature(e2 = "glub"), .ArithGlub)
>
>
>
>
>
>
>
> --
> Robin Hankin
> Uncertainty Analyst
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>   tel  023-8059-7743
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>



From kwright68 at gmail.com  Fri Sep 15 19:12:54 2006
From: kwright68 at gmail.com (Kevin Wright)
Date: Fri, 15 Sep 2006 12:12:54 -0500
Subject: [Rd] pdf default version
Message-ID: <adf71a630609151012t7c579dd7l8e80f9f83a3112da@mail.gmail.com>

R has had the ability to generate pdfs with transparent colors for a
couple of years now using pdf(..., version="1.4").

By default, Sweave uses just 'pdf' (without version 1.4), so a hack is
needed when using Sweave to create pdfs with transparent colors.  See
http://tolstoy.newcastle.edu.au/R/help/04/11/6655.html

I would find my work process simpler if R defaulted to generating PDFs
using version="1.4".  The help page for R's pdf command says there is
a risk of some older pdf viewers not being able to view newer PDFs.
Does anyone have a feeling for how big a risk this is?  I tried for a
while to search google for pdf metadata and the distribution of pdf
documents of different versions, but could find nothing useful to
report.

The PDF 1.4 specification appears to have been published in November, 2001.

Is updating pdf() to version="1.4" feasible?

Discussions on this topic will be watched with interest.

Kevin Wright



From mschwartz at mn.rr.com  Fri Sep 15 19:42:59 2006
From: mschwartz at mn.rr.com (Marc Schwartz (via MN))
Date: Fri, 15 Sep 2006 12:42:59 -0500
Subject: [Rd] pdf default version
In-Reply-To: <adf71a630609151012t7c579dd7l8e80f9f83a3112da@mail.gmail.com>
References: <adf71a630609151012t7c579dd7l8e80f9f83a3112da@mail.gmail.com>
Message-ID: <1158342179.4414.15.camel@localhost.localdomain>

On Fri, 2006-09-15 at 12:12 -0500, Kevin Wright wrote:
> R has had the ability to generate pdfs with transparent colors for a
> couple of years now using pdf(..., version="1.4").
> 
> By default, Sweave uses just 'pdf' (without version 1.4), so a hack is
> needed when using Sweave to create pdfs with transparent colors.  See
> http://tolstoy.newcastle.edu.au/R/help/04/11/6655.html
> 
> I would find my work process simpler if R defaulted to generating PDFs
> using version="1.4".  The help page for R's pdf command says there is
> a risk of some older pdf viewers not being able to view newer PDFs.
> Does anyone have a feeling for how big a risk this is?  I tried for a
> while to search google for pdf metadata and the distribution of pdf
> documents of different versions, but could find nothing useful to
> report.
> 
> The PDF 1.4 specification appears to have been published in November, 2001.
> 
> Is updating pdf() to version="1.4" feasible?
> 
> Discussions on this topic will be watched with interest.
> 
> Kevin Wright

Rather than globally changing R, wouldn't it be better to add another
option to Sweave?

For example, one can already specify 'height' and 'width' arguments for
figures, why not a pdf version value?

If I am reading it correctly, the relevant code from Sweave.R seems to
be within the RweaveLatexRuncode() function:

  if(options$pdf){
       pdf(file=paste(chunkprefix, "pdf", sep="."),
           width=options$width, height=options$height)

Could this not be modified to something like:

  if(options$pdf){
       pdf(file=paste(chunkprefix, "pdf", sep="."),
           width=options$width, height=options$height,
           version = pdf.version)

Then the call within the .Rnw file could be something like:

  <<fig=true,width=6,height=4,pdf.version=1.4,include=false>>=

I am presuming that I am oversimplifying the changes here as I have not
looked at the other code that would be affected by this change.

Comments?

HTH,

Marc Schwartz



From mschwartz at mn.rr.com  Fri Sep 15 21:02:47 2006
From: mschwartz at mn.rr.com (Marc Schwartz (via MN))
Date: Fri, 15 Sep 2006 14:02:47 -0500
Subject: [Rd] pdf default version
In-Reply-To: <1158342179.4414.15.camel@localhost.localdomain>
References: <adf71a630609151012t7c579dd7l8e80f9f83a3112da@mail.gmail.com>
	<1158342179.4414.15.camel@localhost.localdomain>
Message-ID: <1158346969.11014.5.camel@localhost.localdomain>

On Fri, 2006-09-15 at 12:43 -0500, Marc Schwartz (via MN) wrote:
> On Fri, 2006-09-15 at 12:12 -0500, Kevin Wright wrote:
> > R has had the ability to generate pdfs with transparent colors for a
> > couple of years now using pdf(..., version="1.4").
> > 
> > By default, Sweave uses just 'pdf' (without version 1.4), so a hack is
> > needed when using Sweave to create pdfs with transparent colors.  See
> > http://tolstoy.newcastle.edu.au/R/help/04/11/6655.html
> > 
> > I would find my work process simpler if R defaulted to generating PDFs
> > using version="1.4".  The help page for R's pdf command says there is
> > a risk of some older pdf viewers not being able to view newer PDFs.
> > Does anyone have a feeling for how big a risk this is?  I tried for a
> > while to search google for pdf metadata and the distribution of pdf
> > documents of different versions, but could find nothing useful to
> > report.
> > 
> > The PDF 1.4 specification appears to have been published in November, 2001.
> > 
> > Is updating pdf() to version="1.4" feasible?
> > 
> > Discussions on this topic will be watched with interest.
> > 
> > Kevin Wright
> 
> Rather than globally changing R, wouldn't it be better to add another
> option to Sweave?
> 
> For example, one can already specify 'height' and 'width' arguments for
> figures, why not a pdf version value?
> 
> If I am reading it correctly, the relevant code from Sweave.R seems to
> be within the RweaveLatexRuncode() function:
> 
>   if(options$pdf){
>        pdf(file=paste(chunkprefix, "pdf", sep="."),
>            width=options$width, height=options$height)
> 
> Could this not be modified to something like:
> 
>   if(options$pdf){
>        pdf(file=paste(chunkprefix, "pdf", sep="."),
>            width=options$width, height=options$height,
>            version = pdf.version)

Quick correction here. That final line should be:

  version = options$pdf.version)

Thanks to Dirk for pointing out my typo.

Marc



From deepayan.sarkar at gmail.com  Fri Sep 15 21:22:15 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Fri, 15 Sep 2006 12:22:15 -0700
Subject: [Rd] An update method for lists?
Message-ID: <eb555e660609151222u2f1a7856l6b5f786c8677966@mail.gmail.com>

Hi,

since lattice uses nested lists in various situations, it has had an
unexported function called updateList for a while, which looks like

> lattice:::updateList
function (x, val)
{
    if (is.null(x))
        x <- list()
    if (!is.list(x))
        stop("x must be NULL or a list")
    if (!is.list(val))
        stop("val must be a list")
    xnames <- names(x)
    for (v in names(val)) {
        existing <- v %in% xnames
        if (existing && is.list(x[[v]]) && is.list(val[[v]]))
            x[[v]] <- updateList(x[[v]], val[[v]])
        else x[[v]] <- val[[v]]
    }
    x
}

Basically, it recursively replaces elements that have been specified
in val, leaving the other components alone. I'm not aware of any other
actual situation where this is useful, but it certainly can be, so I
want to export this functionaliy. At least one other person (Gabor)
has also asked for that.

Now, as the name suggests, I think it might be reasonable to export
this as an update method for "list" objects. Depending on what others
(in particular r-core) think, one of these things might happen:

(1) I export it as updateList (or some other name) in lattice
(2) I export it as an S3 method update.list in lattice
(3) It gets added as an S3 method update.list in one of the base packages

The default option is (1), and I guess Sept 19 is the deadline for any
of these to be included in R 2.4.0.

Comments?

Deepayan



From maechler at stat.math.ethz.ch  Fri Sep 15 22:23:08 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 15 Sep 2006 22:23:08 +0200
Subject: [Rd] An update method for lists?
In-Reply-To: <eb555e660609151222u2f1a7856l6b5f786c8677966@mail.gmail.com>
References: <eb555e660609151222u2f1a7856l6b5f786c8677966@mail.gmail.com>
Message-ID: <17675.2988.727158.326024@stat.math.ethz.ch>

>>>>> "DeepS" == Deepayan Sarkar <deepayan.sarkar at gmail.com>
>>>>>     on Fri, 15 Sep 2006 12:22:15 -0700 writes:

    DeepS> Hi, since lattice uses nested lists in various
    DeepS> situations, it has had an unexported function called
    DeepS> updateList for a while, which looks like

 >>     > lattice:::updateList
 >>     function (x, val)
 >>     {
 >> 	if (is.null(x))
 >> 	    x <- list()
 >> 	if (!is.list(x))
 >> 	    stop("x must be NULL or a list")
 >> 	if (!is.list(val))
 >> 	    stop("val must be a list")
 >> 	xnames <- names(x)
 >> 	for (v in names(val)) {
 >> 	    existing <- v %in% xnames
 >> 	    if (existing && is.list(x[[v]]) && is.list(val[[v]]))
 >> 		x[[v]] <- updateList(x[[v]], val[[v]])
 >> 	    else x[[v]] <- val[[v]]
 >> 	}
 >> 	x
 >>     }
 
[I'm not sure I'd allow NULL for 'x';  typing list() instead of
 NULL is not much more, but when the function name even includes  'list'
 I'd really require a list for 'x']

You could hence collapse the first 6 lines to the single

   stopifnot(is.list(x), is.list(val))


    DeepS> Basically, it recursively replaces elements that have
    DeepS> been specified in val, leaving the other components
    DeepS> alone. I'm not aware of any other actual situation
    DeepS> where this is useful, but it certainly can be, so I
    DeepS> want to export this functionaliy. At least one other
    DeepS> person (Gabor) has also asked for that.

I've had a similar need only recently:
If a list is used to store "defaults" and you want a safe way to
change only a few of the values...
I presume you use this for manipulating the settings of lattice
parts ?

    DeepS> Now, as the name suggests, I think it might be
    DeepS> reasonable to export this as an update method for
    DeepS> "list" objects. Depending on what others (in
    DeepS> particular r-core) think, one of these things might
    DeepS> happen:

    DeepS> (1) I export it as updateList (or some other name) in lattice
    DeepS> (2) I export it as an S3 method update.list in lattice
    DeepS> (3) It gets added as an S3 method update.list in one of the base packages
or
    (4) it gets added as utility function updateList() to
        'utils' {= one of the base packages}

which I'd favor momentarily.
- update() is typically for updating *models* 
- it's not clear that this is *the* method for update()ing a list

I'm also a bit wondering if it wouldn't make sense to change the name to 
something like assignInList().

    DeepS> The default option is (1), and I guess Sept 19 is the deadline for any
    DeepS> of these to be included in R 2.4.0.

Yes, that's true for (3) & (4) are higher if you provide a patch
to R-devel (not R-alpha) which includes a man page ...  [but
don't hurry, I'd like to see other comments]

Martin



From h.wickham at gmail.com  Fri Sep 15 22:34:45 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 15 Sep 2006 15:34:45 -0500
Subject: [Rd] An update method for lists?
In-Reply-To: <17675.2988.727158.326024@stat.math.ethz.ch>
References: <eb555e660609151222u2f1a7856l6b5f786c8677966@mail.gmail.com>
	<17675.2988.727158.326024@stat.math.ethz.ch>
Message-ID: <f8e6ff050609151334j7729b00cx5a7affcf6ca7794d@mail.gmail.com>

> If a list is used to store "defaults" and you want a safe way to
> change only a few of the values...
> I presume you use this for manipulating the settings of lattice
> parts ?

I use something similar in ggplot (except not recursive):

defaults <- function(x, y)  {
	c(x, y[setdiff(names(y), names(x))])
}

Hadley



From deepayan.sarkar at gmail.com  Fri Sep 15 22:54:07 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Fri, 15 Sep 2006 13:54:07 -0700
Subject: [Rd] An update method for lists?
In-Reply-To: <17675.2988.727158.326024@stat.math.ethz.ch>
References: <eb555e660609151222u2f1a7856l6b5f786c8677966@mail.gmail.com>
	<17675.2988.727158.326024@stat.math.ethz.ch>
Message-ID: <eb555e660609151354t22c68166s4b0144a286c68f50@mail.gmail.com>

On 9/15/06, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
> >>>>> "DeepS" == Deepayan Sarkar <deepayan.sarkar at gmail.com>
> >>>>>     on Fri, 15 Sep 2006 12:22:15 -0700 writes:
>
>     DeepS> Hi, since lattice uses nested lists in various
>     DeepS> situations, it has had an unexported function called
>     DeepS> updateList for a while, which looks like
>
>  >>     > lattice:::updateList
>  >>     function (x, val)
>  >>     {
>  >>     if (is.null(x))
>  >>         x <- list()
>  >>     if (!is.list(x))
>  >>         stop("x must be NULL or a list")
>  >>     if (!is.list(val))
>  >>         stop("val must be a list")
>  >>     xnames <- names(x)
>  >>     for (v in names(val)) {
>  >>         existing <- v %in% xnames
>  >>         if (existing && is.list(x[[v]]) && is.list(val[[v]]))
>  >>             x[[v]] <- updateList(x[[v]], val[[v]])
>  >>         else x[[v]] <- val[[v]]
>  >>     }
>  >>     x
>  >>     }
>
> [I'm not sure I'd allow NULL for 'x';  typing list() instead of
>  NULL is not much more, but when the function name even includes  'list'
>  I'd really require a list for 'x']

Makes sense.

> You could hence collapse the first 6 lines to the single
>
>    stopifnot(is.list(x), is.list(val))

I'll check if lattice needs some fixes with this.

>     DeepS> Basically, it recursively replaces elements that have
>     DeepS> been specified in val, leaving the other components
>     DeepS> alone. I'm not aware of any other actual situation
>     DeepS> where this is useful, but it certainly can be, so I
>     DeepS> want to export this functionaliy. At least one other
>     DeepS> person (Gabor) has also asked for that.
>
> I've had a similar need only recently:
> If a list is used to store "defaults" and you want a safe way to
> change only a few of the values...
> I presume you use this for manipulating the settings of lattice
> parts ?

Yes, it's primarily used inside trellis.par.set, but many other places as well.

>     DeepS> Now, as the name suggests, I think it might be
>     DeepS> reasonable to export this as an update method for
>     DeepS> "list" objects. Depending on what others (in
>     DeepS> particular r-core) think, one of these things might
>     DeepS> happen:
>
>     DeepS> (1) I export it as updateList (or some other name) in lattice
>     DeepS> (2) I export it as an S3 method update.list in lattice
>     DeepS> (3) It gets added as an S3 method update.list in one of the base packages
> or
>     (4) it gets added as utility function updateList() to
>         'utils' {= one of the base packages}

Yes, that a good option too (certainly better than (1))

> which I'd favor momentarily.
> - update() is typically for updating *models*
> - it's not clear that this is *the* method for update()ing a list

I agree. Part of the reason I brought this up is because it is not
clear to me what justifies a new method for an existing generic. An
argument for is that one doesn't introduce yet another function, which
(I thought) might be enough if the other choice is to not have any
method at all.

> I'm also a bit wondering if it wouldn't make sense to change the name to
> something like assignInList().

I'm open to suggestions for the name. I didn't think too much about it
since it was unexported anyway.

>     DeepS> The default option is (1), and I guess Sept 19 is the deadline for any
>     DeepS> of these to be included in R 2.4.0.
>
> Yes, that's true for (3) & (4) are higher if you provide a patch
> to R-devel (not R-alpha) which includes a man page ...  [but
> don't hurry, I'd like to see other comments]

-Deepayan



From jeff.horner at vanderbilt.edu  Fri Sep 15 23:05:50 2006
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Fri, 15 Sep 2006 16:05:50 -0500
Subject: [Rd] Ice cream flavor metaphor in statistical computing
Message-ID: <450B15AE.8080601@vanderbilt.edu>

Forgive me, but since it's Friday and I've been thinking about command 
line options lately, I thought I'd find out who came up with the name of 
the --vanilla argument for R. From the svn log:

------------------------------------------------------------------------
r2509 | maechler | 1998-10-10 10:52:53 -0500 (Sat, 10 Oct 1998) | 2 lines
Changed paths:
    M /trunk/src/unix/system.c

new --vanilla

------------------------------------------------------------------------

Are there any interesting anecdotes about this... Did Martin Maechler 
name it? Certainly --plain could have been used instead...

Jeff
-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner



From mschwartz at mn.rr.com  Fri Sep 15 23:28:06 2006
From: mschwartz at mn.rr.com (Marc Schwartz (via MN))
Date: Fri, 15 Sep 2006 16:28:06 -0500
Subject: [Rd] Ice cream flavor metaphor in statistical computing
In-Reply-To: <450B15AE.8080601@vanderbilt.edu>
References: <450B15AE.8080601@vanderbilt.edu>
Message-ID: <1158355686.7213.9.camel@localhost.localdomain>

On Fri, 2006-09-15 at 16:05 -0500, Jeffrey Horner wrote:
> Forgive me, but since it's Friday and I've been thinking about command 
> line options lately, I thought I'd find out who came up with the name of 
> the --vanilla argument for R. From the svn log:
> 
> ------------------------------------------------------------------------
> r2509 | maechler | 1998-10-10 10:52:53 -0500 (Sat, 10 Oct 1998) | 2 lines
> Changed paths:
>     M /trunk/src/unix/system.c
> 
> new --vanilla
> 
> ------------------------------------------------------------------------
> 
> Are there any interesting anecdotes about this... Did Martin Maechler 
> name it? Certainly --plain could have been used instead...
> 
> Jeff

Hey Jeff,

I suppose that we should be glad that Martin was not eating Ben and
Jerry's at the time or the command line might be:

  R --NewYorkSuperFudgeChunk?

;-)

This reference might be of help:

  http://dictionary.reference.com/search?q=plain-vanilla

Regards,

Marc



From p.dalgaard at biostat.ku.dk  Sat Sep 16 00:19:59 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 16 Sep 2006 00:19:59 +0200
Subject: [Rd] Ice cream flavor metaphor in statistical computing
In-Reply-To: <1158355686.7213.9.camel@localhost.localdomain>
References: <450B15AE.8080601@vanderbilt.edu>
	<1158355686.7213.9.camel@localhost.localdomain>
Message-ID: <x264fo7oxc.fsf@turmalin.kubism.ku.dk>

"Marc Schwartz (via MN)" <mschwartz at mn.rr.com> writes:

> On Fri, 2006-09-15 at 16:05 -0500, Jeffrey Horner wrote:
> > Forgive me, but since it's Friday and I've been thinking about command 
> > line options lately, I thought I'd find out who came up with the name of 
> > the --vanilla argument for R. From the svn log:
> > 
> > ------------------------------------------------------------------------
> > r2509 | maechler | 1998-10-10 10:52:53 -0500 (Sat, 10 Oct 1998) | 2 lines
> > Changed paths:
> >     M /trunk/src/unix/system.c
> > 
> > new --vanilla
> > 
> > ------------------------------------------------------------------------
> > 
> > Are there any interesting anecdotes about this... Did Martin Maechler 
> > name it? Certainly --plain could have been used instead...
> > 
> > Jeff
> 
> Hey Jeff,
> 
> I suppose that we should be glad that Martin was not eating Ben and
> Jerry's at the time or the command line might be:
> 
>   R --NewYorkSuperFudgeChunk?
> 
> ;-)
> 
> This reference might be of help:
> 
>   http://dictionary.reference.com/search?q=plain-vanilla

It is unclear from my records of R-core mails at the time what the
decision process, if any, might have been, but terms like "vanilla S"
(AT&T S as opposed to S-PLUS) were being bandied about. The option
--vanilla was preceded by constructions like

../bin/R --no-init-file --no-save --no-restore < simple-true.R > simple-true.Rout

which was indeed a bit long-winded.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From maechler at stat.math.ethz.ch  Sat Sep 16 15:05:59 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 16 Sep 2006 15:05:59 +0200
Subject: [Rd] Ice cream flavor metaphor in statistical computing
In-Reply-To: <x264fo7oxc.fsf@turmalin.kubism.ku.dk>
References: <450B15AE.8080601@vanderbilt.edu>
	<1158355686.7213.9.camel@localhost.localdomain>
	<x264fo7oxc.fsf@turmalin.kubism.ku.dk>
Message-ID: <17675.63159.48248.542763@stat.math.ethz.ch>

>>>>> "PD" == Peter Dalgaard <p.dalgaard at biostat.ku.dk>
>>>>>     on 16 Sep 2006 00:19:59 +0200 writes:

    PD> "Marc Schwartz (via MN)" <mschwartz at mn.rr.com> writes:
    >> On Fri, 2006-09-15 at 16:05 -0500, Jeffrey Horner wrote:
    >> > Forgive me, but since it's Friday and I've been thinking about command 
    >> > line options lately, I thought I'd find out who came up with the name of 
    >> > the --vanilla argument for R. From the svn log:
    >> > 
    >> > ------------------------------------------------------------------------
    >> > r2509 | maechler | 1998-10-10 10:52:53 -0500 (Sat, 10 Oct 1998) | 2 lines
    >> > Changed paths:
    >> >     M /trunk/src/unix/system.c
    >> > 
    >> > new --vanilla
    >> > 
    >> > ------------------------------------------------------------------------
    >> > 
    >> > Are there any interesting anecdotes about this... Did Martin Maechler 
    >> > name it? Certainly --plain could have been used instead...

Sorry to come in a bit late...  have been enjoying Mozart this morning..
I had previously seen the use of 'vanilla' as such a command
line argument for xemacs, and even though I've been preferring
GNU emacs, and Mango or Citrus, Apricot, ... to Vanilla, I still
found it cute enough to be remembered and then used for R.

Martin

    >> > Jeff
    >> 
    >> Hey Jeff,
    >> 
    >> I suppose that we should be glad that Martin was not eating Ben and
    >> Jerry's at the time or the command line might be:
    >> 
    >> R --NewYorkSuperFudgeChunk?
    >> 
    >> ;-)
    >> 
    >> This reference might be of help:
    >> 
    >> http://dictionary.reference.com/search?q=plain-vanilla

    PD> It is unclear from my records of R-core mails at the time what the
    PD> decision process, if any, might have been, but terms like "vanilla S"
    PD> (AT&T S as opposed to S-PLUS) were being bandied about. The option
    PD> --vanilla was preceded by constructions like

    PD> ../bin/R --no-init-file --no-save --no-restore < simple-true.R > simple-true.Rout

    PD> which was indeed a bit long-winded.

    PD> -- 
    PD> O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
    PD> c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
    PD> (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
    PD> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907

    PD> ______________________________________________
    PD> R-devel at r-project.org mailing list
    PD> https://stat.ethz.ch/mailman/listinfo/r-devel



    PD> "Marc Schwartz (via MN)" <mschwartz at mn.rr.com> writes:
    >> On Fri, 2006-09-15 at 16:05 -0500, Jeffrey Horner wrote:
    >> > Forgive me, but since it's Friday and I've been
    >> thinking about command > line options lately, I thought
    >> I'd find out who came up with the name of > the --vanilla
    >> argument for R. From the svn log:
    >> > 
    >> > ------------------------------------------------------------------------
    >> > r2509 | maechler | 1998-10-10 10:52:53 -0500 (Sat, 10
    >> Oct 1998) | 2 lines > Changed paths: > M
    >> /trunk/src/unix/system.c
    >> > 
    >> > new --vanilla
    >> > 
    >> > ------------------------------------------------------------------------
    >> > 
    >> > Are there any interesting anecdotes about this... Did
    >> Martin Maechler > name it? Certainly --plain could have
    >> been used instead...
    >> > 
    >> > Jeff
    >> 
    >> Hey Jeff,
    >> 
    >> I suppose that we should be glad that Martin was not
    >> eating Ben and Jerry's at the time or the command line
    >> might be:
    >> 
    >> R --NewYorkSuperFudgeChunk?
    >> 
    >> ;-)
    >> 
    >> This reference might be of help:
    >> 
    >> http://dictionary.reference.com/search?q=plain-vanilla

    PD> It is unclear from my records of R-core mails at the
    PD> time what the decision process, if any, might have been,
    PD> but terms like "vanilla S" (AT&T S as opposed to S-PLUS)
    PD> were being bandied about. The option --vanilla was
    PD> preceded by constructions like

    PD> ../bin/R --no-init-file --no-save --no-restore <
    PD> simple-true.R > simple-true.Rout

    PD> which was indeed a bit long-winded.

    PD> -- O__ ---- Peter Dalgaard ?ster Farimagsgade 5, Entr.B
    PD> c/ /'_ --- Dept. of Biostatistics PO Box 2099, 1014
    PD> Cph. K (*) \(*) -- University of Copenhagen Denmark Ph:
    PD> (+45) 35327918 ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)
    PD> FAX: (+45) 35327907

    PD> ______________________________________________
    PD> R-devel at r-project.org mailing list
    PD> https://stat.ethz.ch/mailman/listinfo/r-devel



From ripley at stats.ox.ac.uk  Sat Sep 16 21:26:31 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 16 Sep 2006 20:26:31 +0100 (BST)
Subject: [Rd] pdf default version
In-Reply-To: <1158342179.4414.15.camel@localhost.localdomain>
References: <adf71a630609151012t7c579dd7l8e80f9f83a3112da@mail.gmail.com>
	<1158342179.4414.15.camel@localhost.localdomain>
Message-ID: <Pine.LNX.4.64.0609152242340.4265@gannet.stats.ox.ac.uk>

On Fri, 15 Sep 2006, Marc Schwartz (via MN) wrote:

> On Fri, 2006-09-15 at 12:12 -0500, Kevin Wright wrote:
>> R has had the ability to generate pdfs with transparent colors for a
>> couple of years now using pdf(..., version="1.4").

I presume we are talking about translucency aka semitransparency (alpha 
channel strictly between 0 and 1) here, introduced in R 2.0.0: support for 
col="transparent" is much older.

>> By default, Sweave uses just 'pdf' (without version 1.4), so a hack is
>> needed when using Sweave to create pdfs with transparent colors.  See
>> http://tolstoy.newcastle.edu.au/R/help/04/11/6655.html
>>
>> I would find my work process simpler if R defaulted to generating PDFs
>> using version="1.4".  The help page for R's pdf command says there is
>> a risk of some older pdf viewers not being able to view newer PDFs.
>> Does anyone have a feeling for how big a risk this is?  I tried for a
>> while to search google for pdf metadata and the distribution of pdf
>> documents of different versions, but could find nothing useful to
>> report.
>>
>> The PDF 1.4 specification appears to have been published in November, 2001.

Both C99 and Fortran 90 are older, and compilers for them are not yet 
universally available.  Many R users even use older OSes than that date. 
Given Adobe's patchy support for non-popularist OSes, there are lots of 
viewers from quite a while back out there (I found Acroread 4.05 on one of 
our systems without looking very hard).  According to Distiller, PDF 1.4 
was introduced in Acrobat 5, and 1.3 is still recommended as the lowest 
common denominator.

>> Is updating pdf() to version="1.4" feasible?

In what sense: it does support that as an option?  As the default, no.

>> Discussions on this topic will be watched with interest.
>>
>> Kevin Wright
>
> Rather than globally changing R, wouldn't it be better to add another
> option to Sweave?
>
> For example, one can already specify 'height' and 'width' arguments for
> figures, why not a pdf version value?
>
> If I am reading it correctly, the relevant code from Sweave.R seems to
> be within the RweaveLatexRuncode() function:
>
>  if(options$pdf){
>       pdf(file=paste(chunkprefix, "pdf", sep="."),
>           width=options$width, height=options$height)
>
> Could this not be modified to something like:
>
>  if(options$pdf){
>       pdf(file=paste(chunkprefix, "pdf", sep="."),
>           width=options$width, height=options$height,
>           version = pdf.version)
>
> Then the call within the .Rnw file could be something like:
>
>  <<fig=true,width=6,height=4,pdf.version=1.4,include=false>>=

or even

\SweaveOpts{echo=FALSE, pdf.version=1.4}

> I am presuming that I am oversimplifying the changes here as I have not
> looked at the other code that would be affected by this change.

You would need to set a default value, and that's non-trivial due to lack 
of documentation of Sweave options (the internals need to be told that the 
option is NOLOG (non-logical) and not numeric).

> Comments?

That seems a much better approach, and I've added it for 2.4.0.

Howver, I think the ideal solution is for the driver to keep track 
of the features used and set the version number accordingly.  I am not 
sure why Paul did not do it that way (PDF viewers are supposed to ignore 
non-conformant features), as if you use semitransparent colours you would 
presumably like to see them where possible.  Also implemented for 2.4.0, 
but with a warning that setting pdf(version=1.4) will suppress.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From lr at proxc.net  Sun Sep 17 04:42:39 2006
From: lr at proxc.net (Logan Lewis)
Date: Sat, 16 Sep 2006 22:42:39 -0400
Subject: [Rd] R-base licensing question
Message-ID: <200609162242.40228.lr@proxc.net>

It is my understanding that R is licensed under the GPL with the 
exception of a few header files for the purposes of linking binary code 
with R under non-GPL licenses.

However, the R-base package itself is licensed under the GPL, as are 
many (but not all) packages in CRAN.  Furthermore, basically any R 
script will use functionality from R-base.  As I understand it, the 
situation isn't clear as to the licensing restrictions on R scripts 
which use R-base (or any other GPL package).  The FSF's FAQ on the 
issue says the following (of course, this is just their 
interpretation):

(http://www.gnu.org/licenses/gpl-faq.html#IfInterpreterIsGPL)

"[...]Another similar and very common case is to provide libraries with 
the interpreter which are themselves interpreted. For instance, Perl 
comes with many Perl modules, and a Java implementation comes with many 
Java classes. These libraries and the programs that call them are 
always dynamically linked together. A consequence is that if you choose 
to use GPL'd Perl modules or Java classes in your program, you must 
release the program in a GPL-compatible way, regardless of the license 
used in the Perl or Java interpreter that the combined Perl or Java 
program will run on."

Clearly, having R scripts (and basically all R add-on packages) be 
required to have GPL-compatible licenses is not the intent (especially 
considering the LGPLed header files mentioned above).  R's position is 
somewhat unique in having much of the base functionality interpreted.  
In practice, this legal interpretation (IANAL, etc) would require 
essentially all R packages and other R scripts to be licensed in a 
GPL-compatible way.  Is a legal exception in order here?

My apologies if this question is more appropriate for r-users or has 
been answered elsewhere.

Thanks,
Logan



From murdoch at stats.uwo.ca  Sun Sep 17 07:53:04 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sun, 17 Sep 2006 01:53:04 -0400
Subject: [Rd] R-base licensing question
In-Reply-To: <200609162242.40228.lr@proxc.net>
References: <200609162242.40228.lr@proxc.net>
Message-ID: <450CE2C0.4020506@stats.uwo.ca>

On 9/16/2006 10:42 PM, Logan Lewis wrote:
> It is my understanding that R is licensed under the GPL with the 
> exception of a few header files for the purposes of linking binary code 
> with R under non-GPL licenses.
> 
> However, the R-base package itself is licensed under the GPL, as are 
> many (but not all) packages in CRAN.  Furthermore, basically any R 
> script will use functionality from R-base.  As I understand it, the 
> situation isn't clear as to the licensing restrictions on R scripts 
> which use R-base (or any other GPL package).  The FSF's FAQ on the 
> issue says the following (of course, this is just their 
> interpretation):
> 
> (http://www.gnu.org/licenses/gpl-faq.html#IfInterpreterIsGPL)
> 
> "[...]Another similar and very common case is to provide libraries with 
> the interpreter which are themselves interpreted. For instance, Perl 
> comes with many Perl modules, and a Java implementation comes with many 
> Java classes. These libraries and the programs that call them are 
> always dynamically linked together. A consequence is that if you choose 
> to use GPL'd Perl modules or Java classes in your program, you must 
> release the program in a GPL-compatible way, regardless of the license 
> used in the Perl or Java interpreter that the combined Perl or Java 
> program will run on."
> 
> Clearly, having R scripts (and basically all R add-on packages) be 
> required to have GPL-compatible licenses is not the intent (especially 
> considering the LGPLed header files mentioned above).  R's position is 
> somewhat unique in having much of the base functionality interpreted.  
> In practice, this legal interpretation (IANAL, etc) would require 
> essentially all R packages and other R scripts to be licensed in a 
> GPL-compatible way.  Is a legal exception in order here?
> 
> My apologies if this question is more appropriate for r-users or has 
> been answered elsewhere.

I'm not sure what you are asking, but in general R's GPL license is 
completely irrelevant unless you are distributing R.  If you're writing 
a package and distributing only your own work, you can license it as you 
like.

If you want to distribute R (or GPL'd parts of it, or a GPL'd package) 
as part of another project, then that project will need to be GPL'd.

The header files are LGPL'd because you would need to incorporate them 
into your package to distribute a binary.  The LGPL allows you to do 
that, without GPL'ing your package.

IANAL, etc.

Duncan Murdoch



From lr at proxc.net  Sun Sep 17 08:34:06 2006
From: lr at proxc.net (Logan Lewis)
Date: Sun, 17 Sep 2006 02:34:06 -0400
Subject: [Rd] R-base licensing question
In-Reply-To: <450CE2C0.4020506@stats.uwo.ca>
References: <200609162242.40228.lr@proxc.net> <450CE2C0.4020506@stats.uwo.ca>
Message-ID: <200609170234.06630.lr@proxc.net>

On Sunday 17 September 2006 1:53 am, you wrote:

> I'm not sure what you are asking, but in general R's GPL license is
> completely irrelevant unless you are distributing R.  If you're
> writing a package and distributing only your own work, you can
> license it as you like.
>[snip]

I realize how semantic this issue seems, but it boils down to what 
constitutes a derivative work under copyright.  The standard (at least 
as the FSF sees it) is not whether you include GPL code for 
distribution, but whether you link to GPL code at all (even 
dynamically).  This is, as you note, why the LGPL exists.

My point is that interpreted languages blur the lines (I've found 
similar discussions for other programming languages).  Most of the 
time, the interpreter is clearly distinct from software written in the 
interpreted language.  Perl is an example.  Write Perl code, using the 
base language, and you can license it however you'd like.  However, 
this particular FAQ argues that if you _use_ (not even include) GPL 
code written in Perl (like a Perl module), then you must distribute 
your code with a GPL-compatible license.  It certainly struck me as a 
strict interpretation, but when you compare it to linking to a 
non-standard library of a compiled language, it is analogous.  This is 
why the standard libraries in GCC are LGPL or have exceptions for 
non-GPL linking.  

What makes R relatively unique is that almost everything a user will 
code calls functions from R-base, written in R itself (i.e. just 
another package, really).  Certainly other R packages would be in the 
same position as the Perl modules mentioned as an example from this 
FAQ.  That is, if you use a package's functionality in your code, you 
must distribute your code in accordance with the terms of the package's 
license. 

Regards,
Logan



From MSchwartz at mn.rr.com  Sun Sep 17 17:13:52 2006
From: MSchwartz at mn.rr.com (Marc Schwartz)
Date: Sun, 17 Sep 2006 10:13:52 -0500
Subject: [Rd] pdf default version
In-Reply-To: <Pine.LNX.4.64.0609152242340.4265@gannet.stats.ox.ac.uk>
References: <adf71a630609151012t7c579dd7l8e80f9f83a3112da@mail.gmail.com>
	<1158342179.4414.15.camel@localhost.localdomain>
	<Pine.LNX.4.64.0609152242340.4265@gannet.stats.ox.ac.uk>
Message-ID: <1158506033.12595.2.camel@localhost.localdomain>

On Sat, 2006-09-16 at 20:26 +0100, Prof Brian Ripley wrote:
> On Fri, 15 Sep 2006, Marc Schwartz (via MN) wrote:
> 
> > On Fri, 2006-09-15 at 12:12 -0500, Kevin Wright wrote:
> >> R has had the ability to generate pdfs with transparent colors for a
> >> couple of years now using pdf(..., version="1.4").
> 
> I presume we are talking about translucency aka semitransparency (alpha 
> channel strictly between 0 and 1) here, introduced in R 2.0.0: support for 
> col="transparent" is much older.
> 
> >> By default, Sweave uses just 'pdf' (without version 1.4), so a hack is
> >> needed when using Sweave to create pdfs with transparent colors.  See
> >> http://tolstoy.newcastle.edu.au/R/help/04/11/6655.html
> >>
> >> I would find my work process simpler if R defaulted to generating PDFs
> >> using version="1.4".  The help page for R's pdf command says there is
> >> a risk of some older pdf viewers not being able to view newer PDFs.
> >> Does anyone have a feeling for how big a risk this is?  I tried for a
> >> while to search google for pdf metadata and the distribution of pdf
> >> documents of different versions, but could find nothing useful to
> >> report.
> >>
> >> The PDF 1.4 specification appears to have been published in November, 2001.
> 
> Both C99 and Fortran 90 are older, and compilers for them are not yet 
> universally available.  Many R users even use older OSes than that date. 
> Given Adobe's patchy support for non-popularist OSes, there are lots of 
> viewers from quite a while back out there (I found Acroread 4.05 on one of 
> our systems without looking very hard).  According to Distiller, PDF 1.4 
> was introduced in Acrobat 5, and 1.3 is still recommended as the lowest 
> common denominator.
> 
> >> Is updating pdf() to version="1.4" feasible?
> 
> In what sense: it does support that as an option?  As the default, no.
> 
> >> Discussions on this topic will be watched with interest.
> >>
> >> Kevin Wright
> >
> > Rather than globally changing R, wouldn't it be better to add another
> > option to Sweave?
> >
> > For example, one can already specify 'height' and 'width' arguments for
> > figures, why not a pdf version value?
> >
> > If I am reading it correctly, the relevant code from Sweave.R seems to
> > be within the RweaveLatexRuncode() function:
> >
> >  if(options$pdf){
> >       pdf(file=paste(chunkprefix, "pdf", sep="."),
> >           width=options$width, height=options$height)
> >
> > Could this not be modified to something like:
> >
> >  if(options$pdf){
> >       pdf(file=paste(chunkprefix, "pdf", sep="."),
> >           width=options$width, height=options$height,
> >           version = pdf.version)
> >
> > Then the call within the .Rnw file could be something like:
> >
> >  <<fig=true,width=6,height=4,pdf.version=1.4,include=false>>=
> 
> or even
> 
> \SweaveOpts{echo=FALSE, pdf.version=1.4}

Indeed.

> > I am presuming that I am oversimplifying the changes here as I have not
> > looked at the other code that would be affected by this change.
> 
> You would need to set a default value, and that's non-trivial due to lack 
> of documentation of Sweave options (the internals need to be told that the 
> option is NOLOG (non-logical) and not numeric).

Right, I had not reviewed the code where the options are actually set.

> > Comments?
> 
> That seems a much better approach, and I've added it for 2.4.0.
> 
> Howver, I think the ideal solution is for the driver to keep track 
> of the features used and set the version number accordingly.  I am not 
> sure why Paul did not do it that way (PDF viewers are supposed to ignore 
> non-conformant features), as if you use semitransparent colours you would 
> presumably like to see them where possible.  Also implemented for 2.4.0, 
> but with a warning that setting pdf(version=1.4) will suppress.

Terrific. Thank you!

Regards,

Marc



From gavin.simpson at ucl.ac.uk  Mon Sep 18 15:38:57 2006
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Mon, 18 Sep 2006 14:38:57 +0100
Subject: [Rd] Using \u2030 in plot axis label -> stack smashing
Message-ID: <1158586738.28530.52.camel@gsimpson.geog.ucl.ac.uk>

Dear List

I just noticed the following behaviour in R 2.3.1 Patched (2006-06-13
r38342) and confirmed similar behaviour in R 2.4.0 alpha (2006-09-18
r39383) & R 2.5.0 (2006-09-18 r39383) - which may actually be the same
thing?, that trying to plot the unicode character \u2030 (which should
be in a ? [per mille] sign) in an axis label leads to the following
error:

*** stack smashing detected ***: /home/gavin/R/R-devel/build/bin/exec/R
terminated
Aborted

The simplest, reproducible example I have tried is:

plot(1:10, ylab = "\u2030")

This is on a Fedora Core 5 box. Relevant version/session info below.

I presume this is how you are supposed to enter Unicode characters for
use in stings etc? If so, can anyone else reproduce this - or is this
something peculiar to my set-up and/or lack of fonts?

Cheers

Gav

## R 2.3.1 patched
> sessionInfo()
Version 2.3.1 Patched (2006-06-13 r38342)
i686-pc-linux-gnu

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"
"datasets"
[7] "base"
> version
               _
platform       i686-pc-linux-gnu
arch           i686
os             linux-gnu
system         i686, linux-gnu
status         Patched
major          2
minor          3.1
year           2006
month          06
day            13
svn rev        38342
language       R
version.string Version 2.3.1 Patched (2006-06-13 r38342)

## R 2.4.0
> sessionInfo()
R version 2.4.0 alpha (2006-09-18 r39383)
i686-pc-linux-gnu

locale:
LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;LC_COLLATE=en_GB.UTF-8;LC_MONETARY=en_GB.UTF-8;LC_MESSAGES=en_GB.UTF-8;LC_PAPER=en_GB.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_GB.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"
"datasets"
[7] "base"
> version
               _
platform       i686-pc-linux-gnu
arch           i686
os             linux-gnu
system         i686, linux-gnu
status         alpha
major          2
minor          4.0
year           2006
month          09
day            18
svn rev        39383
language       R
version.string R version 2.4.0 alpha (2006-09-18 r39383)

## R 2.5.0
> sessionInfo()
R version 2.5.0 Under development (unstable) (2006-09-18 r39383)
i686-pc-linux-gnu

locale:
LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;LC_COLLATE=en_GB.UTF-8;LC_MONETARY=en_GB.UTF-8;LC_MESSAGES=en_GB.UTF-8;LC_PAPER=en_GB.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_GB.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"
"datasets"
[7] "base"
> version
               _
platform       i686-pc-linux-gnu
arch           i686
os             linux-gnu
system         i686, linux-gnu
status         Under development (unstable)
major          2
minor          5.0
year           2006
month          09
day            18
svn rev        39383
language       R
version.string R version 2.5.0 Under development (unstable) (2006-09-18
r39383)
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Gavin Simpson                 [t] +44 (0)20 7679 0522
 ECRC & ENSIS, UCL Geography,  [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%



From edd at debian.org  Mon Sep 18 17:23:22 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 18 Sep 2006 10:23:22 -0500
Subject: [Rd] R 2.4.0, methods and rebuild management
Message-ID: <17678.47594.366448.331044@basebud.nulle.part>


With R 2.4.0 around the corner, I intend to resume the usual process of
providing beta snapshot packages in Debian unstable. By updating them before
they hit 'testing', we give ourselves a nice window in which we can update
the packages as needed so that once 2.4.0 comes out for good on October 3, we
should be in good shape.

But how can I effectively manage this?  Running 

	$ apt-cache search ^r-.* | \
	   grep -v "r-base\|r-doc\|r-gnome\|r-mathlib\|r-recom" | wc -l

leads to 80 entries all of which are indeed packages.  Is there a way to
proactively tell which ones use S4 and the methods package, and need updates?

Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison



From h.wickham at gmail.com  Mon Sep 18 17:24:27 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Mon, 18 Sep 2006 10:24:27 -0500
Subject: [Rd] Help for methods
Message-ID: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com>

Help for help says:

The 'topic' argument may also be a function call, to ask for
          documentation on a corresponding method.  See the section on
          method documentation.

and

     The authors of formal ('S4') methods can provide documentation on
     specific methods, as well as overall documentation on the methods
     of a particular function.  The '"?"' operator allows access to
     this documentation in three ways.

...

     There are two different ways to look for documentation on a
     particular method.  The first is to supply the 'topic' argument in
     the form of a function call, omitting the 'type' argument. The
     effect is to look for documentation on the method that would be
     used if this function call were actually evaluated. See the
     examples below.  If the function is not a generic (no S4 methods
     are defined for it), the help reverts to documentation on the
     function name.

Which doesn't explicitly mention whether this will work for S3 either
way, but the results from:

?summary
?summary(lm(wt ~ mpg, data=mtcars)
?summary(data.frame())

seem to indicate that it doesn't (at least in my R2.3.0, which is out
of date, but I did also search the latest NEWS file for anthing
mentioning help).  Would it be possible to extend this method to deal
with S3 classes as well?

Hadley



From ripley at stats.ox.ac.uk  Mon Sep 18 18:14:56 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 18 Sep 2006 17:14:56 +0100 (BST)
Subject: [Rd] R 2.4.0, methods and rebuild management
In-Reply-To: <17678.47594.366448.331044@basebud.nulle.part>
References: <17678.47594.366448.331044@basebud.nulle.part>
Message-ID: <Pine.LNX.4.64.0609181706001.4302@gannet.stats.ox.ac.uk>

On Mon, 18 Sep 2006, Dirk Eddelbuettel wrote:

>
> With R 2.4.0 around the corner, I intend to resume the usual process of
> providing beta snapshot packages in Debian unstable. By updating them before
> they hit 'testing', we give ourselves a nice window in which we can update
> the packages as needed so that once 2.4.0 comes out for good on October 3, we
> should be in good shape.
>
> But how can I effectively manage this?  Running
>
> 	$ apt-cache search ^r-.* | \
> 	   grep -v "r-base\|r-doc\|r-gnome\|r-mathlib\|r-recom" | wc -l
>
> leads to 80 entries all of which are indeed packages.  Is there a way to
> proactively tell which ones use S4 and the methods package, and need updates?

Only with some difficulty.  Such packages ought to declare 'methods' in 
the Depends or Imports fields of their DESCRIPTION files, and most do. 
Exceptions found by 'R CMD check' are Hmisc e1071 gRbase kinship rggobi 
rstream startupmsg wavelets:  the checks used are not exhaustive.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From edd at debian.org  Mon Sep 18 19:00:19 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 18 Sep 2006 12:00:19 -0500
Subject: [Rd] R 2.4.0, methods and rebuild management
In-Reply-To: <Pine.LNX.4.64.0609181706001.4302@gannet.stats.ox.ac.uk>
References: <17678.47594.366448.331044@basebud.nulle.part>
	<Pine.LNX.4.64.0609181706001.4302@gannet.stats.ox.ac.uk>
Message-ID: <17678.53411.41756.686641@basebud.nulle.part>


On 18 September 2006 at 17:14, Prof Brian Ripley wrote:
| On Mon, 18 Sep 2006, Dirk Eddelbuettel wrote:
| 
| >
| > With R 2.4.0 around the corner, I intend to resume the usual process of
| > providing beta snapshot packages in Debian unstable. By updating them before
| > they hit 'testing', we give ourselves a nice window in which we can update
| > the packages as needed so that once 2.4.0 comes out for good on October 3, we
| > should be in good shape.
| >
| > But how can I effectively manage this?  Running
| >
| > 	$ apt-cache search ^r-.* | \
| > 	   grep -v "r-base\|r-doc\|r-gnome\|r-mathlib\|r-recom" | wc -l
| >
| > leads to 80 entries all of which are indeed packages.  Is there a way to
| > proactively tell which ones use S4 and the methods package, and need updates?
| 
| Only with some difficulty.  Such packages ought to declare 'methods' in 
| the Depends or Imports fields of their DESCRIPTION files, and most do. 
| Exceptions found by 'R CMD check' are Hmisc e1071 gRbase kinship rggobi 
| rstream startupmsg wavelets:  the checks used are not exhaustive.

Ok, thanks for this.  I guess I should write a quick script to mirror or
download all DESCRIPTIONS files. 

Of those 'exceptional' ones you list above, e1071 is about to enter Debian to
I'll talk to the maintainer, and Hmisc + rggobi are among my packages; the
rest we don't cover.

Thanks, Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison



From gregor.gorjanc at bfro.uni-lj.si  Mon Sep 18 21:02:32 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Mon, 18 Sep 2006 19:02:32 +0000 (UTC)
Subject: [Rd] Using \u2030 in plot axis label -> stack smashing
References: <1158586738.28530.52.camel@gsimpson.geog.ucl.ac.uk>
Message-ID: <loom.20060918T205234-775@post.gmane.org>

Gavin Simpson <gavin.simpson <at> ucl.ac.uk> writes:
> 
> Dear List
> 
> I just noticed the following behaviour in R 2.3.1 Patched (2006-06-13
> r38342) and confirmed similar behaviour in R 2.4.0 alpha (2006-09-18
> r39383) & R 2.5.0 (2006-09-18 r39383) - which may actually be the same
> thing?, that trying to plot the unicode character \u2030 (which should
> be in a ? [per mille] sign) in an axis label leads to the following
> error:
> 
> *** stack smashing detected ***: /home/gavin/R/R-devel/build/bin/exec/R
> terminated
> Aborted
> 
> The simplest, reproducible example I have tried is:
> 
> plot(1:10, ylab = "\u2030")
> 

I can not reproduce this on my Debian GNU/Linux. I get something like "S 
for y label under 2.3.1 2006-06-01 and 2.5.0 2006-09-13 r39292 with the
following locale

[1] "LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;
LC_COLLATE=en_GB.UTF-8;LC_MONETARY=en_GB.UTF-8;LC_MESSAGES=en_GB.UTF-8;
LC_PAPER=C;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=C;
LC_IDENTIFICATION=C"

It does not change if I set everything into en_GB.UTF-8. Is this valid 
unicode code?

Gregor



From tgibson at augustcouncil.com  Mon Sep 18 22:08:46 2006
From: tgibson at augustcouncil.com (tgibson at augustcouncil.com)
Date: Mon, 18 Sep 2006 22:08:46 +0200 (CEST)
Subject: [Rd] Legend frame error (PR#9236)
Message-ID: <20060918200846.2A60944243@slim.kubism.ku.dk>

Hello,
The frame drawn around the legend appears to miscalculate when the
x-axis decreases rather than increases.  Pasted below is a simple
testcase.  When the x-axis decreases, the width of the legend frame
appears to be calculated based on the length of the first item, rather
than the maximum length of all items.

Thanks,
-TAG
Todd A. Gibson

line1=dpois(seq(0,50), 10)

par(mfcol=c(2,1))

plot(line1, col="blue", type="l")
legend(x=30,y=0.10, legend=c("binding","transcription","Random Genes"), col=c("red", "blue","black"),lty=c(1,1,2),lwd=c(2,2,1))

plot(line1, col="blue", type="l", xlim=c(50,0))
legend(x=30,y=0.10, legend=c("binding","transcription","Random Genes"), col=c("red", "blue","black"),lty=c(1,1,2),lwd=c(2,2,1))



From p.dalgaard at biostat.ku.dk  Mon Sep 18 22:43:40 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 18 Sep 2006 22:43:40 +0200
Subject: [Rd] Legend frame error (PR#9236)
In-Reply-To: <20060918200846.2A60944243@slim.kubism.ku.dk>
References: <20060918200846.2A60944243@slim.kubism.ku.dk>
Message-ID: <x21wq8kirn.fsf@turmalin.kubism.ku.dk>

tgibson at augustcouncil.com writes:

> Hello,
> The frame drawn around the legend appears to miscalculate when the
> x-axis decreases rather than increases.  Pasted below is a simple
> testcase.  When the x-axis decreases, the width of the legend frame
> appears to be calculated based on the length of the first item, rather
> than the maximum length of all items.

More likely, it is calculating the maximum of the endpoints, which
will of course be the one furthest to the left if the x axis is
reversed. (As reordering the legends would have shown you.)

The construction

    if (is.null(text.width))
        text.width <- max(strwidth(legend, units = "user", cex = cex))
    else if (!is.numeric(text.width) || text.width < 0)
        stop("'text.width' must be numeric, >= 0")

seems to be the culprit. max() should be min() in the reversed case.

And if I'm not mistaken, there's an additional issue: If the x axis is
reversed, an explicit text.width setting should in fact be negative.


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From gavin.simpson at ucl.ac.uk  Mon Sep 18 23:18:54 2006
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Mon, 18 Sep 2006 22:18:54 +0100
Subject: [Rd] Using \u2030 in plot axis label -> stack smashing
In-Reply-To: <loom.20060918T205234-775@post.gmane.org>
References: <1158586738.28530.52.camel@gsimpson.geog.ucl.ac.uk>
	<loom.20060918T205234-775@post.gmane.org>
Message-ID: <1158614334.2277.7.camel@graptoleberis.geog.ucl.ac.uk>

On Mon, 2006-09-18 at 19:02 +0000, Gregor Gorjanc wrote:
> Gavin Simpson <gavin.simpson <at> ucl.ac.uk> writes:
> > 
> > Dear List
> > 
> > I just noticed the following behaviour in R 2.3.1 Patched (2006-06-13
> > r38342) and confirmed similar behaviour in R 2.4.0 alpha (2006-09-18
> > r39383) & R 2.5.0 (2006-09-18 r39383) - which may actually be the same
> > thing?, that trying to plot the unicode character \u2030 (which should
> > be in a ? [per mille] sign) in an axis label leads to the following
> > error:
> > 
> > *** stack smashing detected ***: /home/gavin/R/R-devel/build/bin/exec/R
> > terminated
> > Aborted
> > 
> > The simplest, reproducible example I have tried is:
> > 
> > plot(1:10, ylab = "\u2030")
> > 
> 
> I can not reproduce this on my Debian GNU/Linux. I get something like "S 
> for y label under 2.3.1 2006-06-01 and 2.5.0 2006-09-13 r39292 with the
> following locale
> 
> [1] "LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;
> LC_COLLATE=en_GB.UTF-8;LC_MONETARY=en_GB.UTF-8;LC_MESSAGES=en_GB.UTF-8;
> LC_PAPER=C;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=C;
> LC_IDENTIFICATION=C"
> 
> It does not change if I set everything into en_GB.UTF-8. Is this valid 
> unicode code?
> 
> Gregor

Cheers for the follow up Gregor,

I was following advice given by Prof. Ripley in a posting on R-Help
about how to get the per mille character:

http://finzi.psych.upenn.edu/R/Rhelp02a/archive/48709.html

It should look like a "%" character but with two circles at the bottom.

I get the same (stack smashing) behaviour on my FC5 laptop with R 2.3.1
patched as below:

> sessionInfo()
Version 2.3.1 Patched (2006-09-02 r39223)
i686-pc-linux-gnu

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"
"datasets"
[7] "base"
> version
               _
platform       i686-pc-linux-gnu
arch           i686
os             linux-gnu
system         i686, linux-gnu
status         Patched
major          2
minor          3.1
year           2006
month          09
day            02
svn rev        39223
language       R
version.string Version 2.3.1 Patched (2006-09-02 r39223)

G

-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Gavin Simpson                 [t] +44 (0)20 7679 0522
 ECRC & ENSIS, UCL Geography,  [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/cv/
 London, UK. WC1E 6BT.         [w] http://www.ucl.ac.uk/~ucfagls/
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%



From deepayan.sarkar at gmail.com  Tue Sep 19 00:00:59 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Mon, 18 Sep 2006 15:00:59 -0700
Subject: [Rd] An update method for lists?
In-Reply-To: <eb555e660609151354t22c68166s4b0144a286c68f50@mail.gmail.com>
References: <eb555e660609151222u2f1a7856l6b5f786c8677966@mail.gmail.com>
	<17675.2988.727158.326024@stat.math.ethz.ch>
	<eb555e660609151354t22c68166s4b0144a286c68f50@mail.gmail.com>
Message-ID: <eb555e660609181500t4f823763t8bdae712333a8e0@mail.gmail.com>

On 9/15/06, Deepayan Sarkar <deepayan.sarkar at gmail.com> wrote:
> On 9/15/06, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
> > >>>>> "DeepS" == Deepayan Sarkar <deepayan.sarkar at gmail.com>
> > >>>>>     on Fri, 15 Sep 2006 12:22:15 -0700 writes:
> >
> >     DeepS> Hi, since lattice uses nested lists in various
> >     DeepS> situations, it has had an unexported function called
> >     DeepS> updateList for a while, which looks like
> >
> >  >>     > lattice:::updateList
> >  >>     function (x, val)
> >  >>     {
> >  >>     if (is.null(x))
> >  >>         x <- list()
> >  >>     if (!is.list(x))
> >  >>         stop("x must be NULL or a list")
> >  >>     if (!is.list(val))
> >  >>         stop("val must be a list")
> >  >>     xnames <- names(x)
> >  >>     for (v in names(val)) {
> >  >>         existing <- v %in% xnames
> >  >>         if (existing && is.list(x[[v]]) && is.list(val[[v]]))
> >  >>             x[[v]] <- updateList(x[[v]], val[[v]])
> >  >>         else x[[v]] <- val[[v]]
> >  >>     }
> >  >>     x
> >  >>     }
> >
> > [I'm not sure I'd allow NULL for 'x';  typing list() instead of
> >  NULL is not much more, but when the function name even includes  'list'
> >  I'd really require a list for 'x']
>
> Makes sense.
>
> > You could hence collapse the first 6 lines to the single
> >
> >    stopifnot(is.list(x), is.list(val))
>
> I'll check if lattice needs some fixes with this.

Actually, I do need to allow NULL, because update.trellis does things like

update.trellis <- function(object, ..., par.strip.text, ...)
{
    ...
    object$par.strip.text <- updateList(object$par.strip.text, par.strip.text)
    ...
}

where object$par.strip.text may be initially NULL. But I'll do that
inside a lattice wrapper.

> >     DeepS> Basically, it recursively replaces elements that have
> >     DeepS> been specified in val, leaving the other components
> >     DeepS> alone. I'm not aware of any other actual situation
> >     DeepS> where this is useful, but it certainly can be, so I
> >     DeepS> want to export this functionaliy. At least one other
> >     DeepS> person (Gabor) has also asked for that.
> >
> > I've had a similar need only recently:
> > If a list is used to store "defaults" and you want a safe way to
> > change only a few of the values...
> > I presume you use this for manipulating the settings of lattice
> > parts ?
>
> Yes, it's primarily used inside trellis.par.set, but many other places as well.
>
> >     DeepS> Now, as the name suggests, I think it might be
> >     DeepS> reasonable to export this as an update method for
> >     DeepS> "list" objects. Depending on what others (in
> >     DeepS> particular r-core) think, one of these things might
> >     DeepS> happen:
> >
> >     DeepS> (1) I export it as updateList (or some other name) in lattice
> >     DeepS> (2) I export it as an S3 method update.list in lattice
> >     DeepS> (3) It gets added as an S3 method update.list in one of the base packages
> > or
> >     (4) it gets added as utility function updateList() to
> >         'utils' {= one of the base packages}
>
> Yes, that a good option too (certainly better than (1))
>
> > which I'd favor momentarily.
> > - update() is typically for updating *models*
> > - it's not clear that this is *the* method for update()ing a list
>
> I agree. Part of the reason I brought this up is because it is not
> clear to me what justifies a new method for an existing generic. An
> argument for is that one doesn't introduce yet another function, which
> (I thought) might be enough if the other choice is to not have any
> method at all.
>
> > I'm also a bit wondering if it wouldn't make sense to change the name to
> > something like assignInList().
>
> I'm open to suggestions for the name. I didn't think too much about it
> since it was unexported anyway.
>
> >     DeepS> The default option is (1), and I guess Sept 19 is the deadline for any
> >     DeepS> of these to be included in R 2.4.0.
> >
> > Yes, that's true for (3) & (4) are higher if you provide a patch
> > to R-devel (not R-alpha) which includes a man page ...  [but
> > don't hurry, I'd like to see other comments]

I have checked in

https://svn.r-project.org/R-packages/trunk/lattice/R/modifyList.R
https://svn.r-project.org/R-packages/trunk/lattice/man/modifyList.Rd

which I'm happy to offer for inclusion in utils or wherever might seem
appropriate. I'll upload a version of lattice which includes these
late tomorrow if I don't see any more comments by then.

I've changed the name because I wasn't sure if assignInList might be
confusing, as the semantics are different from those of assign (assign
is like 'fix', while this is more like 'edit'). However, any name is
fine with me.

Deepayan



From ggrothendieck at gmail.com  Tue Sep 19 00:51:57 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 18 Sep 2006 18:51:57 -0400
Subject: [Rd] An update method for lists?
In-Reply-To: <eb555e660609181500t4f823763t8bdae712333a8e0@mail.gmail.com>
References: <eb555e660609151222u2f1a7856l6b5f786c8677966@mail.gmail.com>
	<17675.2988.727158.326024@stat.math.ethz.ch>
	<eb555e660609151354t22c68166s4b0144a286c68f50@mail.gmail.com>
	<eb555e660609181500t4f823763t8bdae712333a8e0@mail.gmail.com>
Message-ID: <971536df0609181551m667e20d9o2c4dbefac9d0fe6@mail.gmail.com>

It would be nice if the .Rd file had one or more examples
since its not that easy to otherwise understand what it
does.  Regards.

On 9/18/06, Deepayan Sarkar <deepayan.sarkar at gmail.com> wrote:
> On 9/15/06, Deepayan Sarkar <deepayan.sarkar at gmail.com> wrote:
> > On 9/15/06, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
> > > >>>>> "DeepS" == Deepayan Sarkar <deepayan.sarkar at gmail.com>
> > > >>>>>     on Fri, 15 Sep 2006 12:22:15 -0700 writes:
> > >
> > >     DeepS> Hi, since lattice uses nested lists in various
> > >     DeepS> situations, it has had an unexported function called
> > >     DeepS> updateList for a while, which looks like
> > >
> > >  >>     > lattice:::updateList
> > >  >>     function (x, val)
> > >  >>     {
> > >  >>     if (is.null(x))
> > >  >>         x <- list()
> > >  >>     if (!is.list(x))
> > >  >>         stop("x must be NULL or a list")
> > >  >>     if (!is.list(val))
> > >  >>         stop("val must be a list")
> > >  >>     xnames <- names(x)
> > >  >>     for (v in names(val)) {
> > >  >>         existing <- v %in% xnames
> > >  >>         if (existing && is.list(x[[v]]) && is.list(val[[v]]))
> > >  >>             x[[v]] <- updateList(x[[v]], val[[v]])
> > >  >>         else x[[v]] <- val[[v]]
> > >  >>     }
> > >  >>     x
> > >  >>     }
> > >
> > > [I'm not sure I'd allow NULL for 'x';  typing list() instead of
> > >  NULL is not much more, but when the function name even includes  'list'
> > >  I'd really require a list for 'x']
> >
> > Makes sense.
> >
> > > You could hence collapse the first 6 lines to the single
> > >
> > >    stopifnot(is.list(x), is.list(val))
> >
> > I'll check if lattice needs some fixes with this.
>
> Actually, I do need to allow NULL, because update.trellis does things like
>
> update.trellis <- function(object, ..., par.strip.text, ...)
> {
>    ...
>    object$par.strip.text <- updateList(object$par.strip.text, par.strip.text)
>    ...
> }
>
> where object$par.strip.text may be initially NULL. But I'll do that
> inside a lattice wrapper.
>
> > >     DeepS> Basically, it recursively replaces elements that have
> > >     DeepS> been specified in val, leaving the other components
> > >     DeepS> alone. I'm not aware of any other actual situation
> > >     DeepS> where this is useful, but it certainly can be, so I
> > >     DeepS> want to export this functionaliy. At least one other
> > >     DeepS> person (Gabor) has also asked for that.
> > >
> > > I've had a similar need only recently:
> > > If a list is used to store "defaults" and you want a safe way to
> > > change only a few of the values...
> > > I presume you use this for manipulating the settings of lattice
> > > parts ?
> >
> > Yes, it's primarily used inside trellis.par.set, but many other places as well.
> >
> > >     DeepS> Now, as the name suggests, I think it might be
> > >     DeepS> reasonable to export this as an update method for
> > >     DeepS> "list" objects. Depending on what others (in
> > >     DeepS> particular r-core) think, one of these things might
> > >     DeepS> happen:
> > >
> > >     DeepS> (1) I export it as updateList (or some other name) in lattice
> > >     DeepS> (2) I export it as an S3 method update.list in lattice
> > >     DeepS> (3) It gets added as an S3 method update.list in one of the base packages
> > > or
> > >     (4) it gets added as utility function updateList() to
> > >         'utils' {= one of the base packages}
> >
> > Yes, that a good option too (certainly better than (1))
> >
> > > which I'd favor momentarily.
> > > - update() is typically for updating *models*
> > > - it's not clear that this is *the* method for update()ing a list
> >
> > I agree. Part of the reason I brought this up is because it is not
> > clear to me what justifies a new method for an existing generic. An
> > argument for is that one doesn't introduce yet another function, which
> > (I thought) might be enough if the other choice is to not have any
> > method at all.
> >
> > > I'm also a bit wondering if it wouldn't make sense to change the name to
> > > something like assignInList().
> >
> > I'm open to suggestions for the name. I didn't think too much about it
> > since it was unexported anyway.
> >
> > >     DeepS> The default option is (1), and I guess Sept 19 is the deadline for any
> > >     DeepS> of these to be included in R 2.4.0.
> > >
> > > Yes, that's true for (3) & (4) are higher if you provide a patch
> > > to R-devel (not R-alpha) which includes a man page ...  [but
> > > don't hurry, I'd like to see other comments]
>
> I have checked in
>
> https://svn.r-project.org/R-packages/trunk/lattice/R/modifyList.R
> https://svn.r-project.org/R-packages/trunk/lattice/man/modifyList.Rd
>
> which I'm happy to offer for inclusion in utils or wherever might seem
> appropriate. I'll upload a version of lattice which includes these
> late tomorrow if I don't see any more comments by then.
>
> I've changed the name because I wasn't sure if assignInList might be
> confusing, as the semantics are different from those of assign (assign
> is like 'fix', while this is more like 'edit'). However, any name is
> fine with me.
>
> Deepayan
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



From deepayan.sarkar at gmail.com  Tue Sep 19 01:00:12 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Mon, 18 Sep 2006 16:00:12 -0700
Subject: [Rd] An update method for lists?
In-Reply-To: <971536df0609181551m667e20d9o2c4dbefac9d0fe6@mail.gmail.com>
References: <eb555e660609151222u2f1a7856l6b5f786c8677966@mail.gmail.com>
	<17675.2988.727158.326024@stat.math.ethz.ch>
	<eb555e660609151354t22c68166s4b0144a286c68f50@mail.gmail.com>
	<eb555e660609181500t4f823763t8bdae712333a8e0@mail.gmail.com>
	<971536df0609181551m667e20d9o2c4dbefac9d0fe6@mail.gmail.com>
Message-ID: <eb555e660609181600u4ee17a64mc5366b82eecaf766@mail.gmail.com>

On 9/18/06, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> It would be nice if the .Rd file had one or more examples
> since its not that easy to otherwise understand what it
> does.  Regards.

Added now, although it's not very realistic.

Deepayan



From mwtoews at sfu.ca  Tue Sep 19 02:32:44 2006
From: mwtoews at sfu.ca (mwtoews at sfu.ca)
Date: Tue, 19 Sep 2006 02:32:44 +0200 (CEST)
Subject: [Rd] Rgui.exe plot device "Save as" crash (PR#9237)
Message-ID: <20060919003244.CBB0F49FDD@slim.kubism.ku.dk>

Full_Name: Michael Toews
Version: 2.3.1
OS: WindowsXP Home/Proffesional SP2
Submission from: (NULL) (142.58.206.114)


Hi,
I have a bug that I can reproduce on two different MS Windows platforms
(1:AMD64x2/WinXP SP2 Home; 2:P4/WinXP SP2 Prof.) which is triggered by the "Save
as" dialog when saving a plot from a Windows device onto the Desktop. This bug
is difficult to reproduce, but here are some instructions to attempt a crash:
1) Start R from Start menu
2) Plot something simple, such as "plot(1:5)"
3) Choose "File > Save as PDF"
4) In the dialog, click the "Save in:" drop-down menu at the top, and select
"Desktop"
5) Type "boohoo" in the "File name:" field, and click "Save"
6) Repeat steps 3 and 4, but try to not hover the mouse over any files or window
controls, except for "boohoo.pdf" (although this isn't always the case). If you
don't crash, repeat steps 3 to 5 again until a crash.
7) *crash*; Windows will display the default crash dialog; Rgui.exe will appear
in the Windows Task Manager (ctrl-alt-del in Processes tab) using about 0 of
CPU.
8) Click "Don't Send" from the dialog
9) Observe that "Rgui.exe" is now using all available CPU resources for that
thread (this is about 50 for Hyper-threading-enabled or dual-core CPUs). It is
probably in an infinite loop.
10) Choose "Rgui.exe" from the Processes in Windows Task Manager, and click "End
Process". Now your system will be stable, and you can repeat the bug, if you
wish.

Here are some things that do _not_ affect the outcome:
- Presence or absence of a custom .Rprofile in C:\Program Files\R\R-2.3.1, or
Rconsole in "My Documents"
- The use of a different file name in step 5; I have also tried "tmp" and "rat a
tat tat", so spaces don't seem to matter
- The complexity of the plot
- Active or inactive Windows devices
- MDI or SDI modes for GUI

Here are some things that _do_ affect the outcome:
- No crash if you "Save as" any of the Jpeg options, but crash for all of the
other formats (Metafile, Postscript, etc.)
- No crash if in other folder, such as "My Documents"; this crash seems to
happen only in the Desktop folder when accessed through the drop-down list at
the top or the button on the left-hand side (oddly enough, when navigating an
absolute path from C:\Documents and Settings\etc..\Desktop, there is no crash)
- In the "Save as" dialog, if you navigate to the Desktop folder by selecting
the button on the left-hand side of the dialog (rather than in the "Save in:"
drop-down field as indicated in step 4), the crash does _not_ trigger the
default Microsoft crash dialog, and Rgui.exe silently crashes (disappears), but
remains as an active process, using ~ 50% of CPU resources, and requires a
manual "End Process".
- If "Debug" (if available) or "Send Report [to Microsoft]" are pressed in the
crash dialog, the Rgui.exe process ends normally, and no manual "End Process" is
required.

Sorry if this seems "TooMuchAtOnce", but it is all the same bug with lots of
details. My guess is it has something to do with the Tooltip from the Windows
system "Save as" dialog, which suggests there is a bug in R's implementation of
the system "Save as" dialog. As well, it appears to have problems with the
"Desktop" folder when navigated from the convenient "Desktop" links (either from
the upper drop-down list or left-hand button) in the "Save" dialog.

I don't have access to a pre-compiled Win32 EXE of the the R 2.4.0 alpha
releases, otherwise I would try to trigger this bug on the upcoming release.



From murdoch at stats.uwo.ca  Tue Sep 19 03:39:14 2006
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Tue, 19 Sep 2006 03:39:14 +0200 (CEST)
Subject: [Rd] Rgui.exe plot device "Save as" crash (PR#9237)
Message-ID: <20060919013914.5593649FDA@slim.kubism.ku.dk>

On 9/18/2006 8:32 PM, mwtoews at sfu.ca wrote:
> Full_Name: Michael Toews
> Version: 2.3.1
> OS: WindowsXP Home/Proffesional SP2
> Submission from: (NULL) (142.58.206.114)
> 
> 
> Hi,
> I have a bug that I can reproduce on two different MS Windows platforms
> (1:AMD64x2/WinXP SP2 Home; 2:P4/WinXP SP2 Prof.) which is triggered by the "Save
> as" dialog when saving a plot from a Windows device onto the Desktop. This bug
> is difficult to reproduce, but here are some instructions to attempt a crash:
> 1) Start R from Start menu
> 2) Plot something simple, such as "plot(1:5)"
> 3) Choose "File > Save as PDF"
> 4) In the dialog, click the "Save in:" drop-down menu at the top, and select
> "Desktop"
> 5) Type "boohoo" in the "File name:" field, and click "Save"
> 6) Repeat steps 3 and 4, but try to not hover the mouse over any files or window
> controls, except for "boohoo.pdf" (although this isn't always the case). If you
> don't crash, repeat steps 3 to 5 again until a crash.
> 7) *crash*; Windows will display the default crash dialog; Rgui.exe will appear
> in the Windows Task Manager (ctrl-alt-del in Processes tab) using about 0 of
> CPU.

Thanks for the detailed instructions.  I can reproduce this in 2.3.1, 
and a fairly recent (but not today's) R-patched build.  I'm just 
building a current Alpha build to test it there.

I'm not sure it's something we'll be able to fix:  tooltips are very 
complicated things, involving tons of DLLs outside of R.  This could be 
an Adobe bug (since Acrobat might be involved in producing a tooltip for 
a PDF), a Windows bug, or something completely unrelated that just 
happens to be hooked into Explorer.  The fact that we can both see it 
suggests it's either in R or Windows, though.


> 8) Click "Don't Send" from the dialog
> 9) Observe that "Rgui.exe" is now using all available CPU resources for that
> thread (this is about 50 for Hyper-threading-enabled or dual-core CPUs). It is
> probably in an infinite loop.
> 10) Choose "Rgui.exe" from the Processes in Windows Task Manager, and click "End
> Process". Now your system will be stable, and you can repeat the bug, if you
> wish.
> 
> Here are some things that do _not_ affect the outcome:
> - Presence or absence of a custom .Rprofile in C:\Program Files\R\R-2.3.1, or
> Rconsole in "My Documents"
> - The use of a different file name in step 5; I have also tried "tmp" and "rat a
> tat tat", so spaces don't seem to matter
> - The complexity of the plot
> - Active or inactive Windows devices
> - MDI or SDI modes for GUI
> 
> Here are some things that _do_ affect the outcome:
> - No crash if you "Save as" any of the Jpeg options, but crash for all of the
> other formats (Metafile, Postscript, etc.)
> - No crash if in other folder, such as "My Documents"; this crash seems to
> happen only in the Desktop folder when accessed through the drop-down list at
> the top or the button on the left-hand side (oddly enough, when navigating an
> absolute path from C:\Documents and Settings\etc..\Desktop, there is no crash)
> - In the "Save as" dialog, if you navigate to the Desktop folder by selecting
> the button on the left-hand side of the dialog (rather than in the "Save in:"
> drop-down field as indicated in step 4), the crash does _not_ trigger the
> default Microsoft crash dialog, and Rgui.exe silently crashes (disappears), but
> remains as an active process, using ~ 50% of CPU resources, and requires a
> manual "End Process".
> - If "Debug" (if available) or "Send Report [to Microsoft]" are pressed in the
> crash dialog, the Rgui.exe process ends normally, and no manual "End Process" is
> required.
> 
> Sorry if this seems "TooMuchAtOnce", but it is all the same bug with lots of
> details. My guess is it has something to do with the Tooltip from the Windows
> system "Save as" dialog, which suggests there is a bug in R's implementation of
> the system "Save as" dialog. As well, it appears to have problems with the
> "Desktop" folder when navigated from the convenient "Desktop" links (either from
> the upper drop-down list or left-hand button) in the "Save" dialog.
> 
> I don't have access to a pre-compiled Win32 EXE of the the R 2.4.0 alpha
> releases, otherwise I would try to trigger this bug on the upcoming release.

You can download (approximately) daily builds from 
cran.r-project.org/bin/windows/base/rtest.html.

Duncan Murdoch



From murdoch at stats.uwo.ca  Tue Sep 19 04:03:47 2006
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Tue, 19 Sep 2006 04:03:47 +0200 (CEST)
Subject: [Rd] Rgui.exe plot device "Save as" crash (PR#9237)
Message-ID: <20060919020347.D8E4E4BE66@slim.kubism.ku.dk>

On 9/18/2006 9:39 PM, murdoch at stats.uwo.ca wrote:
> On 9/18/2006 8:32 PM, mwtoews at sfu.ca wrote:
>> Full_Name: Michael Toews
>> Version: 2.3.1
>> OS: WindowsXP Home/Proffesional SP2
>> Submission from: (NULL) (142.58.206.114)
>>
>>
>> Hi,
>> I have a bug that I can reproduce on two different MS Windows platforms
>> (1:AMD64x2/WinXP SP2 Home; 2:P4/WinXP SP2 Prof.) which is triggered by the "Save
>> as" dialog when saving a plot from a Windows device onto the Desktop. This bug
>> is difficult to reproduce, but here are some instructions to attempt a crash:
>> 1) Start R from Start menu
>> 2) Plot something simple, such as "plot(1:5)"
>> 3) Choose "File > Save as PDF"
>> 4) In the dialog, click the "Save in:" drop-down menu at the top, and select
>> "Desktop"
>> 5) Type "boohoo" in the "File name:" field, and click "Save"
>> 6) Repeat steps 3 and 4, but try to not hover the mouse over any files or window
>> controls, except for "boohoo.pdf" (although this isn't always the case). If you
>> don't crash, repeat steps 3 to 5 again until a crash.
>> 7) *crash*; Windows will display the default crash dialog; Rgui.exe will appear
>> in the Windows Task Manager (ctrl-alt-del in Processes tab) using about 0 of
>> CPU.
> 
> Thanks for the detailed instructions.  I can reproduce this in 2.3.1, 
> and a fairly recent (but not today's) R-patched build.  I'm just 
> building a current Alpha build to test it there.

I do see the crash in R version 2.4.0 alpha (2006-09-17 r39373), with
this stack dump:


Call stack:
7CA5158E  SHELL32.dll:7CA5158E  SHCreateQueryCancelAutoPlayMoniker
7CB2FE26  SHELL32.dll:7CB2FE26  CallCPLEntry16
7CB2FF6A  SHELL32.dll:7CB2FF6A  CallCPLEntry16
7CB295B5  SHELL32.dll:7CB295B5  Ordinal211
7C9F208D  SHELL32.dll:7C9F208D  ILFindChild
75F81B9A  browseui.dll:75F81B9A  Ordinal113
77F69498  SHLWAPI.dll:77F69498  Ordinal120
7C927545  ntdll.dll:7C927545  RtlUpcaseUnicodeString
7C927583  ntdll.dll:7C927583  RtlUpcaseUnicodeString
7C927645  ntdll.dll:7C927645  RtlUpcaseUnicodeString
7C92761C  ntdll.dll:7C92761C  RtlUpcaseUnicodeString
7C80B683  kernel32.dll:7C80B683  GetModuleFileNameA

I really don't know where to go to start looking for this.  It would be
nice if we had something like valgrind for Windows, but we don't.

Duncan Murdoch



From gregor.gorjanc at bfro.uni-lj.si  Tue Sep 19 05:14:18 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Tue, 19 Sep 2006 05:14:18 +0200
Subject: [Rd] Using \u2030 in plot axis label -> stack smashing
In-Reply-To: <1158614334.2277.7.camel@graptoleberis.geog.ucl.ac.uk>
References: <1158586738.28530.52.camel@gsimpson.geog.ucl.ac.uk>	
	<loom.20060918T205234-775@post.gmane.org>
	<1158614334.2277.7.camel@graptoleberis.geog.ucl.ac.uk>
Message-ID: <450F608A.30508@bfro.uni-lj.si>

Gavin Simpson wrote:
> On Mon, 2006-09-18 at 19:02 +0000, Gregor Gorjanc wrote:
>> Gavin Simpson <gavin.simpson <at> ucl.ac.uk> writes:
>>> Dear List
>>>
>>> I just noticed the following behaviour in R 2.3.1 Patched (2006-06-13
>>> r38342) and confirmed similar behaviour in R 2.4.0 alpha (2006-09-18
>>> r39383) & R 2.5.0 (2006-09-18 r39383) - which may actually be the same
>>> thing?, that trying to plot the unicode character \u2030 (which should
>>> be in a ? [per mille] sign) in an axis label leads to the following
>>> error:
>>>
>>> *** stack smashing detected ***: /home/gavin/R/R-devel/build/bin/exec/R
>>> terminated
>>> Aborted
>>>
>>> The simplest, reproducible example I have tried is:
>>>
>>> plot(1:10, ylab = "\u2030")
>>>
>> I can not reproduce this on my Debian GNU/Linux. I get something like "S 
>> for y label under 2.3.1 2006-06-01 and 2.5.0 2006-09-13 r39292 with the
>> following locale
>>
>> [1] "LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;
>> LC_COLLATE=en_GB.UTF-8;LC_MONETARY=en_GB.UTF-8;LC_MESSAGES=en_GB.UTF-8;
>> LC_PAPER=C;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=C;
>> LC_IDENTIFICATION=C"
>>
>> It does not change if I set everything into en_GB.UTF-8. Is this valid 
>> unicode code?
>>
>> Gregor
> 
> Cheers for the follow up Gregor,
> 
> I was following advice given by Prof. Ripley in a posting on R-Help
> about how to get the per mille character:
> 
> http://finzi.psych.upenn.edu/R/Rhelp02a/archive/48709.html
> 
> It should look like a "%" character but with two circles at the bottom.

Perhaps I do not have appropriate font for this character.

Gregor



From nakama at ki.rim.or.jp  Tue Sep 19 06:13:26 2006
From: nakama at ki.rim.or.jp (Ei-ji Nakama)
Date: Tue, 19 Sep 2006 13:13:26 +0900
Subject: [Rd] Using \u2030 in plot axis label -> stack smashing
In-Reply-To: <450F608A.30508@bfro.uni-lj.si>
References: <1158586738.28530.52.camel@gsimpson.geog.ucl.ac.uk>
	<loom.20060918T205234-775@post.gmane.org>
	<1158614334.2277.7.camel@graptoleberis.geog.ucl.ac.uk>
	<450F608A.30508@bfro.uni-lj.si>
Message-ID: <dc41e1260609182113p48a7f35dg3b27f7100f435170@mail.gmail.com>

This seems to be the mine which I contrived. m(_|_)m

--- R-alpha.orig/src/main/gram.y        2006-09-04 23:41:33.000000000 +0900
+++ R-alpha/src/main/gram.y     2006-09-19 13:01:41.000000000 +0900
@@ -99,11 +99,12 @@
 # endif
 #endif
 #include <errno.h>
+#define MB_BUF 16

 static size_t ucstomb(char *s, wchar_t wc, mbstate_t *ps)
 {
     char     tocode[128];
-    char     buf[16];
+    char     buf[MB_BUF];
     void    *cd = NULL ;
     wchar_t  wcs[2];
     char    *inbuf = (char *) wcs;
@@ -1709,7 +1710,7 @@
                error(_("\\uxxxx sequences not supported"));
 #else
                wint_t val = 0; int i, ext; size_t res;
-               char buff[5]; Rboolean delim = FALSE;
+               char buff[MB_BUF]; Rboolean delim = FALSE;
                if((c = xxgetc()) == '{') delim = TRUE; else xxungetc(c);
                for(i = 0; i < 4; i++) {
                    c = xxgetc();
@@ -1743,7 +1744,7 @@
 #ifdef SUPPORT_MBCS
                else {
                    wint_t val = 0; int i, ext; size_t res;
-                   char buff[9]; Rboolean delim = FALSE;
+                   char buff[MB_BUF]; Rboolean delim = FALSE;
                    if((c = xxgetc()) == '{') delim = TRUE; else xxungetc(c);
                    for(i = 0; i < 8; i++) {
                        c = xxgetc();


2006/9/19, Gregor Gorjanc <gregor.gorjanc at bfro.uni-lj.si>:
> Gavin Simpson wrote:
> > On Mon, 2006-09-18 at 19:02 +0000, Gregor Gorjanc wrote:
> >> Gavin Simpson <gavin.simpson <at> ucl.ac.uk> writes:
> >>> Dear List
> >>>
> >>> I just noticed the following behaviour in R 2.3.1 Patched (2006-06-13
> >>> r38342) and confirmed similar behaviour in R 2.4.0 alpha (2006-09-18
> >>> r39383) & R 2.5.0 (2006-09-18 r39383) - which may actually be the same
> >>> thing?, that trying to plot the unicode character \u2030 (which should
> >>> be in a ? [per mille] sign) in an axis label leads to the following
> >>> error:
> >>>
> >>> *** stack smashing detected ***: /home/gavin/R/R-devel/build/bin/exec/R
> >>> terminated
> >>> Aborted
> >>>
> >>> The simplest, reproducible example I have tried is:
> >>>
> >>> plot(1:10, ylab = "\u2030")
> >>>
> >> I can not reproduce this on my Debian GNU/Linux. I get something like "S
> >> for y label under 2.3.1 2006-06-01 and 2.5.0 2006-09-13 r39292 with the
> >> following locale
> >>
> >> [1] "LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;
> >> LC_COLLATE=en_GB.UTF-8;LC_MONETARY=en_GB.UTF-8;LC_MESSAGES=en_GB.UTF-8;
> >> LC_PAPER=C;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=C;
> >> LC_IDENTIFICATION=C"
> >>
> >> It does not change if I set everything into en_GB.UTF-8. Is this valid
> >> unicode code?
> >>
> >> Gregor
> >
> > Cheers for the follow up Gregor,
> >
> > I was following advice given by Prof. Ripley in a posting on R-Help
> > about how to get the per mille character:
> >
> > http://finzi.psych.upenn.edu/R/Rhelp02a/archive/48709.html
> >
> > It should look like a "%" character but with two circles at the bottom.
>
> Perhaps I do not have appropriate font for this character.
>
> Gregor
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
EI-JI Nakama  <nakama at ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb"  <nakama at ki.rim.or.jp>



From ripley at stats.ox.ac.uk  Tue Sep 19 09:26:47 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 19 Sep 2006 08:26:47 +0100 (BST)
Subject: [Rd] Using \u2030 in plot axis label -> stack smashing
In-Reply-To: <dc41e1260609182113p48a7f35dg3b27f7100f435170@mail.gmail.com>
References: <1158586738.28530.52.camel@gsimpson.geog.ucl.ac.uk>
	<loom.20060918T205234-775@post.gmane.org>
	<1158614334.2277.7.camel@graptoleberis.geog.ucl.ac.uk>
	<450F608A.30508@bfro.uni-lj.si>
	<dc41e1260609182113p48a7f35dg3b27f7100f435170@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0609190746490.27751@gannet.stats.ox.ac.uk>

I didn't have access to my FC5 boxes yesterday (electrical testing).

This does need the FC5-specific compilation options set
(-Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
--param=ssp-buffer-size=4), so it is not surprising it is not 
reproducible elsewhere (including under valgrind, BTW).

Ei-ji's patch works (and is incorporated now), but the buffer is used at

     strncpy(s, buf, sizeof(buf) - 1); /* ensure 0-terminated */

and the 's' here should be big enough (\uxxxx can only expand to 3 bytes 
in UTF-8, so "\u2030" is four bytes in UTF-8 including the null 
terminator).  Can Ei-ji explain?

I can understand how Gavin saw this in the released FC5 RPM.  What I don't 
understand is how he saw this in 2.4.0 alpha/R-devel without setting 
non-default CFLAGS he did not tell us about.

BTW, just applying this patch will not work: you need to rebuild gram.c 
in maintainer mode.


On Tue, 19 Sep 2006, Ei-ji Nakama wrote:

> This seems to be the mine which I contrived. m(_|_)m
>
> --- R-alpha.orig/src/main/gram.y        2006-09-04 23:41:33.000000000 +0900
> +++ R-alpha/src/main/gram.y     2006-09-19 13:01:41.000000000 +0900
> @@ -99,11 +99,12 @@
> # endif
> #endif
> #include <errno.h>
> +#define MB_BUF 16
>
> static size_t ucstomb(char *s, wchar_t wc, mbstate_t *ps)
> {
>     char     tocode[128];
> -    char     buf[16];
> +    char     buf[MB_BUF];
>     void    *cd = NULL ;
>     wchar_t  wcs[2];
>     char    *inbuf = (char *) wcs;
> @@ -1709,7 +1710,7 @@
>                error(_("\\uxxxx sequences not supported"));
> #else
>                wint_t val = 0; int i, ext; size_t res;
> -               char buff[5]; Rboolean delim = FALSE;
> +               char buff[MB_BUF]; Rboolean delim = FALSE;
>                if((c = xxgetc()) == '{') delim = TRUE; else xxungetc(c);
>                for(i = 0; i < 4; i++) {
>                    c = xxgetc();
> @@ -1743,7 +1744,7 @@
> #ifdef SUPPORT_MBCS
>                else {
>                    wint_t val = 0; int i, ext; size_t res;
> -                   char buff[9]; Rboolean delim = FALSE;
> +                   char buff[MB_BUF]; Rboolean delim = FALSE;
>                    if((c = xxgetc()) == '{') delim = TRUE; else xxungetc(c);
>                    for(i = 0; i < 8; i++) {
>                        c = xxgetc();
>
>
> 2006/9/19, Gregor Gorjanc <gregor.gorjanc at bfro.uni-lj.si>:
>> Gavin Simpson wrote:
>>> On Mon, 2006-09-18 at 19:02 +0000, Gregor Gorjanc wrote:
>>>> Gavin Simpson <gavin.simpson <at> ucl.ac.uk> writes:
>>>>> Dear List
>>>>>
>>>>> I just noticed the following behaviour in R 2.3.1 Patched (2006-06-13
>>>>> r38342) and confirmed similar behaviour in R 2.4.0 alpha (2006-09-18
>>>>> r39383) & R 2.5.0 (2006-09-18 r39383) - which may actually be the same
>>>>> thing?, that trying to plot the unicode character \u2030 (which should
>>>>> be in a ?? [per mille] sign) in an axis label leads to the following
>>>>> error:
>>>>>
>>>>> *** stack smashing detected ***: /home/gavin/R/R-devel/build/bin/exec/R
>>>>> terminated
>>>>> Aborted
>>>>>
>>>>> The simplest, reproducible example I have tried is:
>>>>>
>>>>> plot(1:10, ylab = "\u2030")
>>>>>
>>>> I can not reproduce this on my Debian GNU/Linux. I get something like "S
>>>> for y label under 2.3.1 2006-06-01 and 2.5.0 2006-09-13 r39292 with the
>>>> following locale
>>>>
>>>> [1] "LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;
>>>> LC_COLLATE=en_GB.UTF-8;LC_MONETARY=en_GB.UTF-8;LC_MESSAGES=en_GB.UTF-8;
>>>> LC_PAPER=C;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=C;
>>>> LC_IDENTIFICATION=C"
>>>>
>>>> It does not change if I set everything into en_GB.UTF-8. Is this valid
>>>> unicode code?
>>>>
>>>> Gregor
>>>
>>> Cheers for the follow up Gregor,
>>>
>>> I was following advice given by Prof. Ripley in a posting on R-Help
>>> about how to get the per mille character:
>>>
>>> http://finzi.psych.upenn.edu/R/Rhelp02a/archive/48709.html
>>>
>>> It should look like a "%" character but with two circles at the bottom.
>>
>> Perhaps I do not have appropriate font for this character.
>>
>> Gregor
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From gavin.simpson at ucl.ac.uk  Tue Sep 19 12:48:03 2006
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Tue, 19 Sep 2006 11:48:03 +0100
Subject: [Rd] Using \u2030 in plot axis label -> stack smashing
In-Reply-To: <Pine.LNX.4.64.0609190746490.27751@gannet.stats.ox.ac.uk>
References: <1158586738.28530.52.camel@gsimpson.geog.ucl.ac.uk>
	<loom.20060918T205234-775@post.gmane.org>
	<1158614334.2277.7.camel@graptoleberis.geog.ucl.ac.uk>
	<450F608A.30508@bfro.uni-lj.si>
	<dc41e1260609182113p48a7f35dg3b27f7100f435170@mail.gmail.com>
	<Pine.LNX.4.64.0609190746490.27751@gannet.stats.ox.ac.uk>
Message-ID: <1158662883.10675.11.camel@gsimpson.geog.ucl.ac.uk>

On Tue, 2006-09-19 at 08:26 +0100, Prof Brian Ripley wrote:
> I didn't have access to my FC5 boxes yesterday (electrical testing).
> 
> This does need the FC5-specific compilation options set
> (-Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
> --param=ssp-buffer-size=4), so it is not surprising it is not 
> reproducible elsewhere (including under valgrind, BTW).
> 
> Ei-ji's patch works (and is incorporated now), but the buffer is used at
> 
>      strncpy(s, buf, sizeof(buf) - 1); /* ensure 0-terminated */
> 
> and the 's' here should be big enough (\uxxxx can only expand to 3 bytes 
> in UTF-8, so "\u2030" is four bytes in UTF-8 including the null 
> terminator).  Can Ei-ji explain?
> 
> I can understand how Gavin saw this in the released FC5 RPM.  What I don't 
> understand is how he saw this in 2.4.0 alpha/R-devel without setting 
> non-default CFLAGS he did not tell us about.

Thanks Prof. Ripley and Ei-Ji. I should have mentioned that all the
versions I reported for were self-compiled, and I did so with the same
set of flags as the FC5 rpm. Will add that to the list in my head of
things to report.

> 
> BTW, just applying this patch will not work: you need to rebuild gram.c 
> in maintainer mode.

I'm not clear what you mean by maintainer mode - not something I have
come across before. If I update the local source on my machine from the
svn server, and make clean, configure and make again, will this be
sufficient? Or do I need to do something else?

Many thanks,

G

> 
> 
> On Tue, 19 Sep 2006, Ei-ji Nakama wrote:
> 
> > This seems to be the mine which I contrived. m(_|_)m
> >
> > --- R-alpha.orig/src/main/gram.y        2006-09-04 23:41:33.000000000 +0900
> > +++ R-alpha/src/main/gram.y     2006-09-19 13:01:41.000000000 +0900
> > @@ -99,11 +99,12 @@
> > # endif
> > #endif
> > #include <errno.h>
> > +#define MB_BUF 16
> >
> > static size_t ucstomb(char *s, wchar_t wc, mbstate_t *ps)
> > {
> >     char     tocode[128];
> > -    char     buf[16];
> > +    char     buf[MB_BUF];
> >     void    *cd = NULL ;
> >     wchar_t  wcs[2];
> >     char    *inbuf = (char *) wcs;
> > @@ -1709,7 +1710,7 @@
> >                error(_("\\uxxxx sequences not supported"));
> > #else
> >                wint_t val = 0; int i, ext; size_t res;
> > -               char buff[5]; Rboolean delim = FALSE;
> > +               char buff[MB_BUF]; Rboolean delim = FALSE;
> >                if((c = xxgetc()) == '{') delim = TRUE; else xxungetc(c);
> >                for(i = 0; i < 4; i++) {
> >                    c = xxgetc();
> > @@ -1743,7 +1744,7 @@
> > #ifdef SUPPORT_MBCS
> >                else {
> >                    wint_t val = 0; int i, ext; size_t res;
> > -                   char buff[9]; Rboolean delim = FALSE;
> > +                   char buff[MB_BUF]; Rboolean delim = FALSE;
> >                    if((c = xxgetc()) == '{') delim = TRUE; else xxungetc(c);
> >                    for(i = 0; i < 8; i++) {
> >                        c = xxgetc();
> >
> >
> > 2006/9/19, Gregor Gorjanc <gregor.gorjanc at bfro.uni-lj.si>:
> >> Gavin Simpson wrote:
> >>> On Mon, 2006-09-18 at 19:02 +0000, Gregor Gorjanc wrote:
> >>>> Gavin Simpson <gavin.simpson <at> ucl.ac.uk> writes:
> >>>>> Dear List
> >>>>>
> >>>>> I just noticed the following behaviour in R 2.3.1 Patched (2006-06-13
> >>>>> r38342) and confirmed similar behaviour in R 2.4.0 alpha (2006-09-18
> >>>>> r39383) & R 2.5.0 (2006-09-18 r39383) - which may actually be the same
> >>>>> thing?, that trying to plot the unicode character \u2030 (which should
> >>>>> be in a ?? [per mille] sign) in an axis label leads to the following
> >>>>> error:
> >>>>>
> >>>>> *** stack smashing detected ***: /home/gavin/R/R-devel/build/bin/exec/R
> >>>>> terminated
> >>>>> Aborted
> >>>>>
> >>>>> The simplest, reproducible example I have tried is:
> >>>>>
> >>>>> plot(1:10, ylab = "\u2030")
> >>>>>
> >>>> I can not reproduce this on my Debian GNU/Linux. I get something like "S
> >>>> for y label under 2.3.1 2006-06-01 and 2.5.0 2006-09-13 r39292 with the
> >>>> following locale
> >>>>
> >>>> [1] "LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;
> >>>> LC_COLLATE=en_GB.UTF-8;LC_MONETARY=en_GB.UTF-8;LC_MESSAGES=en_GB.UTF-8;
> >>>> LC_PAPER=C;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=C;
> >>>> LC_IDENTIFICATION=C"
> >>>>
> >>>> It does not change if I set everything into en_GB.UTF-8. Is this valid
> >>>> unicode code?
> >>>>
> >>>> Gregor
> >>>
> >>> Cheers for the follow up Gregor,
> >>>
> >>> I was following advice given by Prof. Ripley in a posting on R-Help
> >>> about how to get the per mille character:
> >>>
> >>> http://finzi.psych.upenn.edu/R/Rhelp02a/archive/48709.html
> >>>
> >>> It should look like a "%" character but with two circles at the bottom.
> >>
> >> Perhaps I do not have appropriate font for this character.
> >>
> >> Gregor
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >
> >
> >
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Gavin Simpson                 [t] +44 (0)20 7679 0522
 ECRC & ENSIS, UCL Geography,  [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%



From ripley at stats.ox.ac.uk  Tue Sep 19 12:53:06 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 19 Sep 2006 11:53:06 +0100 (BST)
Subject: [Rd] Using \u2030 in plot axis label -> stack smashing
In-Reply-To: <1158662883.10675.11.camel@gsimpson.geog.ucl.ac.uk>
References: <1158586738.28530.52.camel@gsimpson.geog.ucl.ac.uk> 
	<loom.20060918T205234-775@post.gmane.org>
	<1158614334.2277.7.camel@graptoleberis.geog.ucl.ac.uk>
	<450F608A.30508@bfro.uni-lj.si>
	<dc41e1260609182113p48a7f35dg3b27f7100f435170@mail.gmail.com>
	<Pine.LNX.4.64.0609190746490.27751@gannet.stats.ox.ac.uk>
	<1158662883.10675.11.camel@gsimpson.geog.ucl.ac.uk>
Message-ID: <Pine.LNX.4.64.0609191150000.12225@gannet.stats.ox.ac.uk>

On Tue, 19 Sep 2006, Gavin Simpson wrote:
n
> On Tue, 2006-09-19 at 08:26 +0100, Prof Brian Ripley wrote:
>> I didn't have access to my FC5 boxes yesterday (electrical testing).
>>
>> This does need the FC5-specific compilation options set
>> (-Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
>> --param=ssp-buffer-size=4), so it is not surprising it is not
>> reproducible elsewhere (including under valgrind, BTW).
>>
>> Ei-ji's patch works (and is incorporated now), but the buffer is used at
>>
>>      strncpy(s, buf, sizeof(buf) - 1); /* ensure 0-terminated */
>>
>> and the 's' here should be big enough (\uxxxx can only expand to 3 bytes
>> in UTF-8, so "\u2030" is four bytes in UTF-8 including the null
>> terminator).  Can Ei-ji explain?
>>
>> I can understand how Gavin saw this in the released FC5 RPM.  What I don't
>> understand is how he saw this in 2.4.0 alpha/R-devel without setting
>> non-default CFLAGS he did not tell us about.
>
> Thanks Prof. Ripley and Ei-Ji. I should have mentioned that all the
> versions I reported for were self-compiled, and I did so with the same
> set of flags as the FC5 rpm. Will add that to the list in my head of
> things to report.

(I think this is probably FC5's flags being over-zealous, but Ei-ji Nakama 
may know better.)

>> BTW, just applying this patch will not work: you need to rebuild gram.c
>> in maintainer mode.
>
> I'm not clear what you mean by maintainer mode - not something I have
> come across before. If I update the local source on my machine from the
> svn server, and make clean, configure and make again, will this be
> sufficient? Or do I need to do something else?

Yes, now. Before the patch was applied you need to configure with 
--enable-maintainer-mode.

> Many thanks,
>
> G
>
>>
>>
>> On Tue, 19 Sep 2006, Ei-ji Nakama wrote:
>>
>>> This seems to be the mine which I contrived. m(_|_)m
>>>
>>> --- R-alpha.orig/src/main/gram.y        2006-09-04 23:41:33.000000000 +0900
>>> +++ R-alpha/src/main/gram.y     2006-09-19 13:01:41.000000000 +0900
>>> @@ -99,11 +99,12 @@
>>> # endif
>>> #endif
>>> #include <errno.h>
>>> +#define MB_BUF 16
>>>
>>> static size_t ucstomb(char *s, wchar_t wc, mbstate_t *ps)
>>> {
>>>     char     tocode[128];
>>> -    char     buf[16];
>>> +    char     buf[MB_BUF];
>>>     void    *cd = NULL ;
>>>     wchar_t  wcs[2];
>>>     char    *inbuf = (char *) wcs;
>>> @@ -1709,7 +1710,7 @@
>>>                error(_("\\uxxxx sequences not supported"));
>>> #else
>>>                wint_t val = 0; int i, ext; size_t res;
>>> -               char buff[5]; Rboolean delim = FALSE;
>>> +               char buff[MB_BUF]; Rboolean delim = FALSE;
>>>                if((c = xxgetc()) == '{') delim = TRUE; else xxungetc(c);
>>>                for(i = 0; i < 4; i++) {
>>>                    c = xxgetc();
>>> @@ -1743,7 +1744,7 @@
>>> #ifdef SUPPORT_MBCS
>>>                else {
>>>                    wint_t val = 0; int i, ext; size_t res;
>>> -                   char buff[9]; Rboolean delim = FALSE;
>>> +                   char buff[MB_BUF]; Rboolean delim = FALSE;
>>>                    if((c = xxgetc()) == '{') delim = TRUE; else xxungetc(c);
>>>                    for(i = 0; i < 8; i++) {
>>>                        c = xxgetc();
>>>
>>>
>>> 2006/9/19, Gregor Gorjanc <gregor.gorjanc at bfro.uni-lj.si>:
>>>> Gavin Simpson wrote:
>>>>> On Mon, 2006-09-18 at 19:02 +0000, Gregor Gorjanc wrote:
>>>>>> Gavin Simpson <gavin.simpson <at> ucl.ac.uk> writes:
>>>>>>> Dear List
>>>>>>>
>>>>>>> I just noticed the following behaviour in R 2.3.1 Patched (2006-06-13
>>>>>>> r38342) and confirmed similar behaviour in R 2.4.0 alpha (2006-09-18
>>>>>>> r39383) & R 2.5.0 (2006-09-18 r39383) - which may actually be the same
>>>>>>> thing?, that trying to plot the unicode character \u2030 (which should
>>>>>>> be in a ?? [per mille] sign) in an axis label leads to the following
>>>>>>> error:
>>>>>>>
>>>>>>> *** stack smashing detected ***: /home/gavin/R/R-devel/build/bin/exec/R
>>>>>>> terminated
>>>>>>> Aborted
>>>>>>>
>>>>>>> The simplest, reproducible example I have tried is:
>>>>>>>
>>>>>>> plot(1:10, ylab = "\u2030")
>>>>>>>
>>>>>> I can not reproduce this on my Debian GNU/Linux. I get something like "S
>>>>>> for y label under 2.3.1 2006-06-01 and 2.5.0 2006-09-13 r39292 with the
>>>>>> following locale
>>>>>>
>>>>>> [1] "LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;
>>>>>> LC_COLLATE=en_GB.UTF-8;LC_MONETARY=en_GB.UTF-8;LC_MESSAGES=en_GB.UTF-8;
>>>>>> LC_PAPER=C;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=C;
>>>>>> LC_IDENTIFICATION=C"
>>>>>>
>>>>>> It does not change if I set everything into en_GB.UTF-8. Is this valid
>>>>>> unicode code?
>>>>>>
>>>>>> Gregor
>>>>>
>>>>> Cheers for the follow up Gregor,
>>>>>
>>>>> I was following advice given by Prof. Ripley in a posting on R-Help
>>>>> about how to get the per mille character:
>>>>>
>>>>> http://finzi.psych.upenn.edu/R/Rhelp02a/archive/48709.html
>>>>>
>>>>> It should look like a "%" character but with two circles at the bottom.
>>>>
>>>> Perhaps I do not have appropriate font for this character.
>>>>
>>>> Gregor
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>>
>>>
>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From p.dalgaard at biostat.ku.dk  Tue Sep 19 14:23:54 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 19 Sep 2006 14:23:54 +0200
Subject: [Rd] Using \u2030 in plot axis label -> stack smashing
In-Reply-To: <Pine.LNX.4.64.0609191150000.12225@gannet.stats.ox.ac.uk>
References: <1158586738.28530.52.camel@gsimpson.geog.ucl.ac.uk>
	<loom.20060918T205234-775@post.gmane.org>
	<1158614334.2277.7.camel@graptoleberis.geog.ucl.ac.uk>
	<450F608A.30508@bfro.uni-lj.si>
	<dc41e1260609182113p48a7f35dg3b27f7100f435170@mail.gmail.com>
	<Pine.LNX.4.64.0609190746490.27751@gannet.stats.ox.ac.uk>
	<1158662883.10675.11.camel@gsimpson.geog.ucl.ac.uk>
	<Pine.LNX.4.64.0609191150000.12225@gannet.stats.ox.ac.uk>
Message-ID: <x2bqpc2gf9.fsf@viggo.kubism.ku.dk>

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> > Thanks Prof. Ripley and Ei-Ji. I should have mentioned that all the
> > versions I reported for were self-compiled, and I did so with the same
> > set of flags as the FC5 rpm. Will add that to the list in my head of
> > things to report.
> 
> (I think this is probably FC5's flags being over-zealous, but Ei-ji
> Nakama may know better.)

Probably not all that over-zealous. If you're smashing the stack you're
smashing the stack. It's not always fatal, but worth fixing.

I actually have the same set of standard FC5 flags in config.site.
Without them, we risk Fedora Extra to come out with issues that we
missed, since they use those flags as a matter of policy. 
 
> >> BTW, just applying this patch will not work: you need to rebuild gram.c
> >> in maintainer mode.
> >
> > I'm not clear what you mean by maintainer mode - not something I have
> > come across before. If I update the local source on my machine from the
> > svn server, and make clean, configure and make again, will this be
> > sufficient? Or do I need to do something else?
> 
> Yes, now. Before the patch was applied you need to configure with
> --enable-maintainer-mode.

I.e., if the maintainers have done their job maintaining things, they
will have ensured that gram.c was built from gram.y and
non-maintainers need to do nothing further. If you play with gram.y,
you need make sure rebuilding takes place, most easily by configuring
in maintainer-mode. 

The fundamental issue is that there are some build tools we don't want
to assume that everybody has (here: YACC/Bison), and also that build
times don't usually survive SVN checkouts, so gram.y may well appear
to be more recent than gram.c.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From hin-tak.leung at cimr.cam.ac.uk  Tue Sep 19 14:25:07 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Tue, 19 Sep 2006 13:25:07 +0100
Subject: [Rd] Help for methods
In-Reply-To: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com>
References: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com>
Message-ID: <450FE1A3.8030808@cimr.cam.ac.uk>

You are supposed to do:

?summary.lm
?summary.data.frame

for S3 methods. The former works, the latter doesn't - which is
probably considered a bug, but then the usage of some of the
generics are probably considered obvious and fundamental enough
that summary.data.frame doesn't really behave in any substantially
different way compared to what is said in ?summary and ?Summary .

hadley wickham wrote:
> Help for help says:
> 
> The 'topic' argument may also be a function call, to ask for
>           documentation on a corresponding method.  See the section on
>           method documentation.
> 
> and
> 
>      The authors of formal ('S4') methods can provide documentation on
>      specific methods, as well as overall documentation on the methods
>      of a particular function.  The '"?"' operator allows access to
>      this documentation in three ways.
> 
> ...
> 
>      There are two different ways to look for documentation on a
>      particular method.  The first is to supply the 'topic' argument in
>      the form of a function call, omitting the 'type' argument. The
>      effect is to look for documentation on the method that would be
>      used if this function call were actually evaluated. See the
>      examples below.  If the function is not a generic (no S4 methods
>      are defined for it), the help reverts to documentation on the
>      function name.
> 
> Which doesn't explicitly mention whether this will work for S3 either
> way, but the results from:
> 
> ?summary
> ?summary(lm(wt ~ mpg, data=mtcars)
> ?summary(data.frame())
> 
> seem to indicate that it doesn't (at least in my R2.3.0, which is out
> of date, but I did also search the latest NEWS file for anthing
> mentioning help).  Would it be possible to extend this method to deal
> with S3 classes as well?
> 
> Hadley
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



From h.wickham at gmail.com  Tue Sep 19 14:52:57 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Tue, 19 Sep 2006 07:52:57 -0500
Subject: [Rd] Help for methods
In-Reply-To: <450FE1A3.8030808@cimr.cam.ac.uk>
References: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com>
	<450FE1A3.8030808@cimr.cam.ac.uk>
Message-ID: <f8e6ff050609190552v34d29e95m4c62b9f8c7f3841e@mail.gmail.com>

> You are supposed to do:
>
> ?summary.lm
> ?summary.data.frame
>
> for S3 methods. The former works, the latter doesn't - which is
> probably considered a bug, but then the usage of some of the
> generics are probably considered obvious and fundamental enough
> that summary.data.frame doesn't really behave in any substantially
> different way compared to what is said in ?summary and ?Summary .

Well, I know that, and you know that, but how is anyone supposed to
figure it out?  It means that you need to have a working knowledge of
the S3 and S4 class systems before you can use the help to reliably
get the documentation you need.

Hadley



From ripley at stats.ox.ac.uk  Tue Sep 19 15:02:21 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 19 Sep 2006 14:02:21 +0100 (BST)
Subject: [Rd] Help for methods
In-Reply-To: <f8e6ff050609190552v34d29e95m4c62b9f8c7f3841e@mail.gmail.com>
References: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com>
	<450FE1A3.8030808@cimr.cam.ac.uk>
	<f8e6ff050609190552v34d29e95m4c62b9f8c7f3841e@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0609191400350.21406@gannet.stats.ox.ac.uk>

On Tue, 19 Sep 2006, hadley wickham wrote:

>> You are supposed to do:
>>
>> ?summary.lm
>> ?summary.data.frame
>>
>> for S3 methods. The former works, the latter doesn't - which is

?summary.data.frame does work on my systems.

>> probably considered a bug, but then the usage of some of the
>> generics are probably considered obvious and fundamental enough
>> that summary.data.frame doesn't really behave in any substantially
>> different way compared to what is said in ?summary and ?Summary .
>
> Well, I know that, and you know that, but how is anyone supposed to
> figure it out?  It means that you need to have a working knowledge of
> the S3 and S4 class systems before you can use the help to reliably
> get the documentation you need.

For S3 you do to understand that there are different methods, and it 
is in `An Introduction to R'.  And ?summary reminds you.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From murdoch at stats.uwo.ca  Tue Sep 19 15:05:24 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 19 Sep 2006 09:05:24 -0400
Subject: [Rd] Help for methods
In-Reply-To: <f8e6ff050609190552v34d29e95m4c62b9f8c7f3841e@mail.gmail.com>
References: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com>	<450FE1A3.8030808@cimr.cam.ac.uk>
	<f8e6ff050609190552v34d29e95m4c62b9f8c7f3841e@mail.gmail.com>
Message-ID: <450FEB14.1080409@stats.uwo.ca>

On 9/19/2006 8:52 AM, hadley wickham wrote:
>> You are supposed to do:
>>
>> ?summary.lm
>> ?summary.data.frame
>>
>> for S3 methods. The former works, the latter doesn't - which is
>> probably considered a bug, but then the usage of some of the
>> generics are probably considered obvious and fundamental enough
>> that summary.data.frame doesn't really behave in any substantially
>> different way compared to what is said in ?summary and ?Summary .
> 
> Well, I know that, and you know that, but how is anyone supposed to
> figure it out?  It means that you need to have a working knowledge of
> the S3 and S4 class systems before you can use the help to reliably
> get the documentation you need.

In the alpha of 2.4.0, both suggestions above work, as do ?summary and 
?summary(data.frame()).  ?summary(lm()) gives the same man page, rather
than the summary.lm page (but the page does have a link to that page).

The problem with S3 methods is that it's pretty difficult for R to know 
that a particular object is an S3 generic.  The only sign is that it has 
a call to UseMethod() in it.  I think this is one of the motivations for S4.

Duncan Murdoch



From gregor.gorjanc at bfro.uni-lj.si  Tue Sep 19 15:06:42 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Tue, 19 Sep 2006 13:06:42 +0000 (UTC)
Subject: [Rd] Help for methods
References: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com>
	<450FE1A3.8030808@cimr.cam.ac.uk>
Message-ID: <loom.20060919T150347-20@post.gmane.org>

Hin-Tak Leung <hin-tak.leung <at> cimr.cam.ac.uk> writes:

> 
> You are supposed to do:
> 
> ?summary.lm
> ?summary.data.frame
> 
> for S3 methods. The former works, the latter doesn't - which is
> probably considered a bug, but then the usage of some of the

I do not follow this. When I type ?summary.data.frame I get a
summary help page where I can also find info about S3 method for class
'data.frame'. If I am not wrong it is 

\alias{summary.data.frame}

that takes care of this.

> generics are probably considered obvious and fundamental enough
> that summary.data.frame doesn't really behave in any substantially
> different way compared to what is said in ?summary and ?Summary .
> 
...

Regards, Gregor



From h.wickham at gmail.com  Tue Sep 19 15:12:39 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Tue, 19 Sep 2006 08:12:39 -0500
Subject: [Rd] Help for methods
In-Reply-To: <Pine.LNX.4.64.0609191400350.21406@gannet.stats.ox.ac.uk>
References: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com>
	<450FE1A3.8030808@cimr.cam.ac.uk>
	<f8e6ff050609190552v34d29e95m4c62b9f8c7f3841e@mail.gmail.com>
	<Pine.LNX.4.64.0609191400350.21406@gannet.stats.ox.ac.uk>
Message-ID: <f8e6ff050609190612jd773a9bv68445a088dce3fac@mail.gmail.com>

> > Well, I know that, and you know that, but how is anyone supposed to
> > figure it out?  It means that you need to have a working knowledge of
> > the S3 and S4 class systems before you can use the help to reliably
> > get the documentation you need.
>
> For S3 you do to understand that there are different methods, and it
> is in `An Introduction to R'.  And ?summary reminds you.

But you also have to be able to identify if it is a S3 function or an
S4 method (or an ordinary function).

The reason I find this so much of a problem is that when you are
teaching R, one of the first things you want to do is teach your
students how to use help.  However, you can't teach them to use it
effectively until they know an awful lot about how the call semantics
of R.

Hadley



From ggrothendieck at gmail.com  Tue Sep 19 15:12:42 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 19 Sep 2006 09:12:42 -0400
Subject: [Rd] Help for methods
In-Reply-To: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com>
References: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com>
Message-ID: <971536df0609190612j2b7e6ec8o382426a7007ae671@mail.gmail.com>

On my system all three of the ?summary commands listed in your
post bring up help (if you add the missing parenthesis to the middle one).

I am using "Version 2.3.1 Patched (2006-06-04 r38279)" on Windows XP.

On 9/18/06, hadley wickham <h.wickham at gmail.com> wrote:
> Help for help says:
>
> The 'topic' argument may also be a function call, to ask for
>          documentation on a corresponding method.  See the section on
>          method documentation.
>
> and
>
>     The authors of formal ('S4') methods can provide documentation on
>     specific methods, as well as overall documentation on the methods
>     of a particular function.  The '"?"' operator allows access to
>     this documentation in three ways.
>
> ...
>
>     There are two different ways to look for documentation on a
>     particular method.  The first is to supply the 'topic' argument in
>     the form of a function call, omitting the 'type' argument. The
>     effect is to look for documentation on the method that would be
>     used if this function call were actually evaluated. See the
>     examples below.  If the function is not a generic (no S4 methods
>     are defined for it), the help reverts to documentation on the
>     function name.
>
> Which doesn't explicitly mention whether this will work for S3 either
> way, but the results from:
>
> ?summary
> ?summary(lm(wt ~ mpg, data=mtcars)
> ?summary(data.frame())
>
> seem to indicate that it doesn't (at least in my R2.3.0, which is out
> of date, but I did also search the latest NEWS file for anthing
> mentioning help).  Would it be possible to extend this method to deal
> with S3 classes as well?
>
> Hadley
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



From ripley at stats.ox.ac.uk  Tue Sep 19 15:14:29 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 19 Sep 2006 14:14:29 +0100 (BST)
Subject: [Rd] Using \u2030 in plot axis label -> stack smashing
In-Reply-To: <x2bqpc2gf9.fsf@viggo.kubism.ku.dk>
References: <1158586738.28530.52.camel@gsimpson.geog.ucl.ac.uk>
	<loom.20060918T205234-775@post.gmane.org>
	<1158614334.2277.7.camel@graptoleberis.geog.ucl.ac.uk>
	<450F608A.30508@bfro.uni-lj.si>
	<dc41e1260609182113p48a7f35dg3b27f7100f435170@mail.gmail.com>
	<Pine.LNX.4.64.0609190746490.27751@gannet.stats.ox.ac.uk>
	<1158662883.10675.11.camel@gsimpson.geog.ucl.ac.uk>
	<Pine.LNX.4.64.0609191150000.12225@gannet.stats.ox.ac.uk>
	<x2bqpc2gf9.fsf@viggo.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0609191336190.21406@gannet.stats.ox.ac.uk>

On Tue, 19 Sep 2006, Peter Dalgaard wrote:

> Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
>
>>> Thanks Prof. Ripley and Ei-Ji. I should have mentioned that all the
>>> versions I reported for were self-compiled, and I did so with the same
>>> set of flags as the FC5 rpm. Will add that to the list in my head of
>>> things to report.
>>
>> (I think this is probably FC5's flags being over-zealous, but Ei-ji
>> Nakama may know better.)
>
> Probably not all that over-zealous. If you're smashing the stack you're
> smashing the stack. It's not always fatal, but worth fixing.

But there is no evidence we are smashing the stack, and valgrind found no 
buffer overrun.  As far as I can tell (killing a process with no core dump 
makes it hard to trace) this occurs when we copy 4 bytes from a buffer of 
16 bytes to one of 5 bytes.

> I actually have the same set of standard FC5 flags in config.site.
> Without them, we risk Fedora Extra to come out with issues that we
> missed, since they use those flags as a matter of policy.

Apparently FC6 will have different flags/ different default behaviour, at 
least for ld.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From ripley at stats.ox.ac.uk  Tue Sep 19 15:15:51 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 19 Sep 2006 14:15:51 +0100 (BST)
Subject: [Rd] Help for methods
In-Reply-To: <f8e6ff050609190612jd773a9bv68445a088dce3fac@mail.gmail.com>
References: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com> 
	<450FE1A3.8030808@cimr.cam.ac.uk>
	<f8e6ff050609190552v34d29e95m4c62b9f8c7f3841e@mail.gmail.com>
	<Pine.LNX.4.64.0609191400350.21406@gannet.stats.ox.ac.uk>
	<f8e6ff050609190612jd773a9bv68445a088dce3fac@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0609191414430.21406@gannet.stats.ox.ac.uk>

On Tue, 19 Sep 2006, hadley wickham wrote:

>> > Well, I know that, and you know that, but how is anyone supposed to
>> > figure it out?  It means that you need to have a working knowledge of
>> > the S3 and S4 class systems before you can use the help to reliably
>> > get the documentation you need.
>> 
>> For S3 you do to understand that there are different methods, and it
>> is in `An Introduction to R'.  And ?summary reminds you.
>
> But you also have to be able to identify if it is a S3 function or an
> S4 method (or an ordinary function).

Why not just type ?summary, which as I said, does tell you up front?

> The reason I find this so much of a problem is that when you are
> teaching R, one of the first things you want to do is teach your
> students how to use help.  However, you can't teach them to use it
> effectively until they know an awful lot about how the call semantics
> of R.

In many years of teaching S/R I have not found that to be a problem.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From h.wickham at gmail.com  Tue Sep 19 15:16:13 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Tue, 19 Sep 2006 08:16:13 -0500
Subject: [Rd] Help for methods
In-Reply-To: <450FEB14.1080409@stats.uwo.ca>
References: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com>
	<450FE1A3.8030808@cimr.cam.ac.uk>
	<f8e6ff050609190552v34d29e95m4c62b9f8c7f3841e@mail.gmail.com>
	<450FEB14.1080409@stats.uwo.ca>
Message-ID: <f8e6ff050609190616h26cf45em427f3ecb8a30ca28@mail.gmail.com>

> In the alpha of 2.4.0, both suggestions above work, as do ?summary and
> ?summary(data.frame()).  ?summary(lm()) gives the same man page, rather
> than the summary.lm page (but the page does have a link to that page).

That's great.

The fact that summary includes a link to summary.lm is relevant for
this specific example, but not in general.

This is also related to my distaste for having multiple methods
documented in one function.  As a developer of R packages, I
understand why people do it (and do it myself), but as a user of help,
it makes the documentation harder to read.

> The problem with S3 methods is that it's pretty difficult for R to know
> that a particular object is an S3 generic.  The only sign is that it has
> a call to UseMethod() in it.  I think this is one of the motivations for S4.

Well, it is even more difficult for a human to know!

Hadley



From h.wickham at gmail.com  Tue Sep 19 15:23:46 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Tue, 19 Sep 2006 08:23:46 -0500
Subject: [Rd] Help for methods
In-Reply-To: <Pine.LNX.4.64.0609191414430.21406@gannet.stats.ox.ac.uk>
References: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com>
	<450FE1A3.8030808@cimr.cam.ac.uk>
	<f8e6ff050609190552v34d29e95m4c62b9f8c7f3841e@mail.gmail.com>
	<Pine.LNX.4.64.0609191400350.21406@gannet.stats.ox.ac.uk>
	<f8e6ff050609190612jd773a9bv68445a088dce3fac@mail.gmail.com>
	<Pine.LNX.4.64.0609191414430.21406@gannet.stats.ox.ac.uk>
Message-ID: <f8e6ff050609190623j3016bc3ej1cb99498d86be388@mail.gmail.com>

> > But you also have to be able to identify if it is a S3 function or an
> > S4 method (or an ordinary function).
>
> Why not just type ?summary, which as I said, does tell you up front?

If R can save the novice user a couple of steps in their search for
help, why not do it?

Getting documentation on what the summary of an mle object does is
another example.  I tried:

 * summary.mle and summary.mle-class (of course I knew those wouldn't
work, but nothing in the documentation of mle suggests that it
wouldn't)

 * mle?summary and then summary?mle in case I had gotten it back to front

 * I finally run the example in mle and used ?summary(fit)


> > The reason I find this so much of a problem is that when you are
> > teaching R, one of the first things you want to do is teach your
> > students how to use help.  However, you can't teach them to use it
> > effectively until they know an awful lot about how the call semantics
> > of R.
>
> In many years of teaching S/R I have not found that to be a problem.

In my one year of teaching R I have.  How do you teach people how to use help?

Hadley



From h.wickham at gmail.com  Tue Sep 19 15:27:12 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Tue, 19 Sep 2006 08:27:12 -0500
Subject: [Rd] Help for methods
In-Reply-To: <loom.20060919T150347-20@post.gmane.org>
References: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com>
	<450FE1A3.8030808@cimr.cam.ac.uk>
	<loom.20060919T150347-20@post.gmane.org>
Message-ID: <f8e6ff050609190627r2cdbee5fm3d8110205518b138@mail.gmail.com>

> I do not follow this. When I type ?summary.data.frame I get a
> summary help page where I can also find info about S3 method for class
> 'data.frame'. If I am not wrong it is
>
> \alias{summary.data.frame}
>
> that takes care of this.

Oops, summary.data.frame was a bad example, except perhaps to
illustrate how easy it is not to notice when you have found the
correct documentation.  summary.lm is a better one.

Hadley



From gavin.simpson at ucl.ac.uk  Tue Sep 19 15:34:29 2006
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Tue, 19 Sep 2006 14:34:29 +0100
Subject: [Rd] Using \u2030 in plot axis label -> stack smashing
In-Reply-To: <x2bqpc2gf9.fsf@viggo.kubism.ku.dk>
References: <1158586738.28530.52.camel@gsimpson.geog.ucl.ac.uk>
	<loom.20060918T205234-775@post.gmane.org>
	<1158614334.2277.7.camel@graptoleberis.geog.ucl.ac.uk>
	<450F608A.30508@bfro.uni-lj.si>
	<dc41e1260609182113p48a7f35dg3b27f7100f435170@mail.gmail.com>
	<Pine.LNX.4.64.0609190746490.27751@gannet.stats.ox.ac.uk>
	<1158662883.10675.11.camel@gsimpson.geog.ucl.ac.uk>
	<Pine.LNX.4.64.0609191150000.12225@gannet.stats.ox.ac.uk>
	<x2bqpc2gf9.fsf@viggo.kubism.ku.dk>
Message-ID: <1158672869.10675.15.camel@gsimpson.geog.ucl.ac.uk>

On Tue, 2006-09-19 at 14:23 +0200, Peter Dalgaard wrote:
> Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
> 
> > > Thanks Prof. Ripley and Ei-Ji. I should have mentioned that all the
> > > versions I reported for were self-compiled, and I did so with the same
> > > set of flags as the FC5 rpm. Will add that to the list in my head of
> > > things to report.
> > 
> > (I think this is probably FC5's flags being over-zealous, but Ei-ji
> > Nakama may know better.)
> 
> Probably not all that over-zealous. If you're smashing the stack you're
> smashing the stack. It's not always fatal, but worth fixing.
> 
> I actually have the same set of standard FC5 flags in config.site.
> Without them, we risk Fedora Extra to come out with issues that we
> missed, since they use those flags as a matter of policy. 
>  
> > >> BTW, just applying this patch will not work: you need to rebuild gram.c
> > >> in maintainer mode.
> > >
> > > I'm not clear what you mean by maintainer mode - not something I have
> > > come across before. If I update the local source on my machine from the
> > > svn server, and make clean, configure and make again, will this be
> > > sufficient? Or do I need to do something else?
> > 
> > Yes, now. Before the patch was applied you need to configure with
> > --enable-maintainer-mode.
> 
> I.e., if the maintainers have done their job maintaining things, they
> will have ensured that gram.c was built from gram.y and
> non-maintainers need to do nothing further. If you play with gram.y,
> you need make sure rebuilding takes place, most easily by configuring
> in maintainer-mode. 
> 
> The fundamental issue is that there are some build tools we don't want
> to assume that everybody has (here: YACC/Bison), and also that build
> times don't usually survive SVN checkouts, so gram.y may well appear
> to be more recent than gram.c.

Dear Prof. Ripley and Peter,

Thanks for explaining the maintainer mode and reasoning behind using it.

G

-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Gavin Simpson                 [t] +44 (0)20 7679 0522
 ECRC & ENSIS, UCL Geography,  [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%



From murdoch at stats.uwo.ca  Tue Sep 19 16:02:12 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 19 Sep 2006 10:02:12 -0400
Subject: [Rd] Help for methods
In-Reply-To: <f8e6ff050609190616h26cf45em427f3ecb8a30ca28@mail.gmail.com>
References: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com>	
	<450FE1A3.8030808@cimr.cam.ac.uk>	
	<f8e6ff050609190552v34d29e95m4c62b9f8c7f3841e@mail.gmail.com>	
	<450FEB14.1080409@stats.uwo.ca>
	<f8e6ff050609190616h26cf45em427f3ecb8a30ca28@mail.gmail.com>
Message-ID: <450FF864.20803@stats.uwo.ca>

On 9/19/2006 9:16 AM, hadley wickham wrote:
>> In the alpha of 2.4.0, both suggestions above work, as do ?summary and
>> ?summary(data.frame()).  ?summary(lm()) gives the same man page, rather
>> than the summary.lm page (but the page does have a link to that page).
> 
> That's great.
> 
> The fact that summary includes a link to summary.lm is relevant for
> this specific example, but not in general.
> 
> This is also related to my distaste for having multiple methods
> documented in one function.  As a developer of R packages, I
> understand why people do it (and do it myself), but as a user of help,
> it makes the documentation harder to read.
> 
>> The problem with S3 methods is that it's pretty difficult for R to know
>> that a particular object is an S3 generic.  The only sign is that it has
>> a call to UseMethod() in it.  I think this is one of the motivations for S4.
> 
> Well, it is even more difficult for a human to know!

Yes, I agree that the current help system doesn't work very well on S3 
methods.  But I don't know how to fix it.  I think the only way it could 
know what to do on a construction like

?summary(lm(...))

would be to actually evaluate summary(lm(...)) (or maybe just lm(...)), 
and I think that would be a huge mistake in the user interface.  Some 
functions have side effects, and you don't want to evaluate them unless 
the user asks you to.  Asking for help on something should give you 
help, it shouldn't do the thing.

Do you have an actual suggestion for a change to the current behaviour?

I'd say the long term solution is to get rid of S3 dispatch, so this 
isn't an issue.  There are improvements to S4 dispatch in 2.4.0, but I 
think there are very high barriers preventing people from using S4, so 
S3 will be around for a long time.

Duncan Murdoch



From ripley at stats.ox.ac.uk  Tue Sep 19 18:08:51 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 19 Sep 2006 17:08:51 +0100 (BST)
Subject: [Rd] Using \u2030 in plot axis label -> stack smashing
In-Reply-To: <Pine.LNX.4.64.0609191336190.21406@gannet.stats.ox.ac.uk>
References: <1158586738.28530.52.camel@gsimpson.geog.ucl.ac.uk>
	<loom.20060918T205234-775@post.gmane.org>
	<1158614334.2277.7.camel@graptoleberis.geog.ucl.ac.uk>
	<450F608A.30508@bfro.uni-lj.si>
	<dc41e1260609182113p48a7f35dg3b27f7100f435170@mail.gmail.com>
	<Pine.LNX.4.64.0609190746490.27751@gannet.stats.ox.ac.uk>
	<1158662883.10675.11.camel@gsimpson.geog.ucl.ac.uk>
	<Pine.LNX.4.64.0609191150000.12225@gannet.stats.ox.ac.uk>
	<x2bqpc2gf9.fsf@viggo.kubism.ku.dk>
	<Pine.LNX.4.64.0609191336190.21406@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0609191655320.31022@gannet.stats.ox.ac.uk>

On Tue, 19 Sep 2006, Prof Brian Ripley wrote:

> On Tue, 19 Sep 2006, Peter Dalgaard wrote:
>
>> Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
>>
>>>> Thanks Prof. Ripley and Ei-Ji. I should have mentioned that all the
>>>> versions I reported for were self-compiled, and I did so with the same
>>>> set of flags as the FC5 rpm. Will add that to the list in my head of
>>>> things to report.
>>>
>>> (I think this is probably FC5's flags being over-zealous, but Ei-ji
>>> Nakama may know better.)
>>
>> Probably not all that over-zealous. If you're smashing the stack you're
>> smashing the stack. It's not always fatal, but worth fixing.
>
> But there is no evidence we are smashing the stack, and valgrind found no
> buffer overrun.  As far as I can tell (killing a process with no core dump
> makes it hard to trace) this occurs when we copy 4 bytes from a buffer of
> 16 bytes to one of 5 bytes.

Ah, strncpy zero-pads and so assumes that dest has at least n bytes. 
This is much clearer from the Solaris man page than the glibc one.  So it 
is (our usage of) strncpy that is potentially stack-smashing.  I guess 
that is one of the things valgrind cannot catch.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From kjetilbrinchmannhalvorsen at gmail.com  Tue Sep 19 19:34:18 2006
From: kjetilbrinchmannhalvorsen at gmail.com (Kjetil Halvorsen)
Date: Tue, 19 Sep 2006 13:34:18 -0400
Subject: [Rd] wishlist --- menu entry [Rgui] misc --- stop current
	computation
Message-ID: <556e90a80609191034ma98b7e8o9fe38091b81ce7e6@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060919/09d429e2/attachment-0003.pl 

From ripley at stats.ox.ac.uk  Tue Sep 19 20:04:45 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 19 Sep 2006 19:04:45 +0100 (BST)
Subject: [Rd] wishlist --- menu entry [Rgui] misc --- stop current
 computation
In-Reply-To: <556e90a80609191034ma98b7e8o9fe38091b81ce7e6@mail.gmail.com>
References: <556e90a80609191034ma98b7e8o9fe38091b81ce7e6@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0609191845040.2465@gannet.stats.ox.ac.uk>

On Tue, 19 Sep 2006, Kjetil Halvorsen wrote:

> This is from R-2.4.0alpha on windows XP, downloaded from CRAN yesterday.
>
> I did
> update.packages(destdir= ..., ask=FALSE,checkBuilt=TRUE)
>
> which took quite a long time (as.expected). When the internet cafe
> had to close, I had to stop the downloading, but the menu item
> misc --- stop current computation only stopped the current download,
> and then R imeadiaetely continued whit the next in the waitin list, so I had
> to kill
> R. I  would be nice if this could be corrected so it really
> stopped all the waiting computastion!

As it does what it says, it cannot be 'corrected' to do something else.
I usually find hitting Ctrl-C (or ESC in Rgui) a few times breaks out 
here.

The issue is that update.packages (or more precisely download.packages) 
has a loop of try() constructs, and those are trapping interrupts.
I don't think there is any way to distinguish those from other internal 
errors.  In any case, it is a somewhat delicate question as to what you 
want: do you want pending on.exit() actions done, for example?

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From mwtoews at sfu.ca  Tue Sep 19 20:16:26 2006
From: mwtoews at sfu.ca (mwtoews at sfu.ca)
Date: Tue, 19 Sep 2006 20:16:26 +0200 (CEST)
Subject: [Rd] Rgui.exe plot device "Save as" crash (PR#9237)
Message-ID: <20060919181626.2F76E4BE93@slim.kubism.ku.dk>

I was guessing that this bug would be difficult to trace, I just wanted 
to document its presence. It is not critical, and can be easily be 
avoided by:
- Saving in Jpeg format; or
- Not saving to the Desktop (unless navigated from C:\Documents and 
Settings\etc.)

I'm not convinced that this bug is related to Adobe (as mentioned in 
Followup 1) .. my example uses PDF, but the same bug occurs when using 
Png, and others (except Jpeg!?).
> I really don't know where to go to start looking for this.  It would be
> nice if we had something like valgrind for Windows, but we don't.
Regarding valgrind (or other memory debuggers): I'm not a Windows 
programmer, but would WinDbg be helpful for debugging this? I tried this 
(free download from MS), and it shows plenty of debugging info, such as 
values of registers, and the sequences of assembly operators on the CPU, 
etc. When I open Rgui.exe, it shows all sorts of modules loading when 
the "Save as" dialog appears, and when Tooltips are triggered; such as: 
PDFShell.dll (from Acrobat 7.0), esriShellExt.dll (from ArcGIS), and 
various *.so files from TortoiseSVN\iconv. The crash occurs, and WinDbg 
prints:

(934.ba8): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=049c2038 ebx=00000000 ecx=0486f1d4 edx=0486f1cc esi=0486f3e0 
edi=000aa0ec
eip=7ca5158e esp=0486f134 ebp=0486f37c iopl=0         nv up ei pl zr na 
pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             
efl=00010246
*** ERROR: Symbol file could not be found.  Defaulted to export symbols 
for C:\WINDOWS\system32\SHELL32.dll -
SHELL32!SHCreateQueryCancelAutoPlayMoniker+0xf8a8:
7ca5158e 8b08            mov     ecx,dword ptr [eax]  
ds:0023:049c2038=????????

and when I press "Go" in WinDbg, the instruction/error repeats ad 
nauseam (with the 'efl' register flipping between 00000246 and 00010246; 
hence the infinite loop).

I didn't load the "symbols file" (I'm not sure what this is -- WinDbg is 
new territory for me today), but I would guess this could make the 
debugging output more meaningful. My first impression of WinDbg is that 
it can be useful for this situation (and others).
+mt



From murdoch at stats.uwo.ca  Tue Sep 19 20:28:04 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 19 Sep 2006 14:28:04 -0400
Subject: [Rd] Rgui.exe plot device "Save as" crash (PR#9237)
In-Reply-To: <451033AA.6060204@sfu.ca>
References: <20060919013914.5593649FDA@slim.kubism.ku.dk>
	<450F4FE1.6060704@stats.uwo.ca> <451033AA.6060204@sfu.ca>
Message-ID: <451036B4.1010202@stats.uwo.ca>

On 9/19/2006 2:15 PM, Michael Toews wrote:
> I was guessing that this bug would be difficult to trace, I just wanted 
> to document its presence. It is not critical, and can be easily be 
> avoided by:
> - Saving in Jpeg format; or
> - Not saving to the Desktop (unless navigated from C:\Documents and 
> Settings\etc.)
> 
> I'm not convinced that this bug is related to Adobe (as mentioned in 
> Followup 1) .. my example uses PDF, but the same bug occurs when using 
> Png, and others (except Jpeg!?).
>> I really don't know where to go to start looking for this.  It would be
>> nice if we had something like valgrind for Windows, but we don't.
> Regarding valgrind (or other memory debuggers): I'm not a Windows 
> programmer, but would WinDbg be helpful for debugging this? I tried this 
> (free download from MS), and it shows plenty of debugging info, such as 
> values of registers, and the sequences of assembly operators on the CPU, 
> etc. When I open Rgui.exe, it shows all sorts of modules loading when 
> the "Save as" dialog appears, and when Tooltips are triggered; such as: 
> PDFShell.dll (from Acrobat 7.0), esriShellExt.dll (from ArcGIS), and 
> various *.so files from TortoiseSVN\iconv. The crash occurs, and WinDbg 
> prints:
> 
> (934.ba8): Access violation - code c0000005 (first chance)
> First chance exceptions are reported before any exception handling.
> This exception may be expected and handled.
> eax=049c2038 ebx=00000000 ecx=0486f1d4 edx=0486f1cc esi=0486f3e0 
> edi=000aa0ec
> eip=7ca5158e esp=0486f134 ebp=0486f37c iopl=0         nv up ei pl zr na 
> pe nc
> cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             
> efl=00010246
> *** ERROR: Symbol file could not be found.  Defaulted to export symbols 
> for C:\WINDOWS\system32\SHELL32.dll -
> SHELL32!SHCreateQueryCancelAutoPlayMoniker+0xf8a8:
> 7ca5158e 8b08            mov     ecx,dword ptr [eax]  
> ds:0023:049c2038=????????
> 
> and when I press "Go" in WinDbg, the instruction/error repeats ad 
> nauseam (with the 'efl' register flipping between 00000246 and 00010246; 
> hence the infinite loop).
> 
> I didn't load the "symbols file" (I'm not sure what this is -- WinDbg is 
> new territory for me today), but I would guess this could make the 
> debugging output more meaningful. My first impression of WinDbg is that 
> it can be useful for this situation (and others).

I got a stack trace from Dr MinGW, and it also reported 
SHCreateQueryCancelAutoPlayMoniker as the most recent function call 
before the crash, but the stack trace never made it out of Windows DLLs, 
or really gave a hint what was the real cause.  I think this is probably 
an R bug (some structure getting messed up before asking for the file 
dialog) because I can't trigger it from other applications, but it might 
be a Windows bug, a MinGW run-time bug, or a MSVCRT bug, and it's 
certainly not clear to me how to determine which.

I used to have a program called BoundsChecker that could watch a running 
program and detect when it wrote outside its own area, or made API calls 
with bad parameters:  it was very useful.  However, I don't think it 
exists any more, and it almost certainly never did for the MinGW 
compiler we use.  I don't think there's any equivalent product for MinGW.

Duncan Murdoch



From jmc at r-project.org  Tue Sep 19 20:39:42 2006
From: jmc at r-project.org (John Chambers)
Date: Tue, 19 Sep 2006 14:39:42 -0400
Subject: [Rd] Help for methods
In-Reply-To: <450FF864.20803@stats.uwo.ca>
References: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com>
	<450FE1A3.8030808@cimr.cam.ac.uk>
	<f8e6ff050609190552v34d29e95m4c62b9f8c7f3841e@mail.gmail.com>
	<450FEB14.1080409@stats.uwo.ca>
	<f8e6ff050609190616h26cf45em427f3ecb8a30ca28@mail.gmail.com>
	<450FF864.20803@stats.uwo.ca>
Message-ID: <4510396E.6090501@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060919/39e1f584/attachment-0003.pl 

From kjetilbrinchmannhalvorsen at gmail.com  Tue Sep 19 20:46:27 2006
From: kjetilbrinchmannhalvorsen at gmail.com (Kjetil Halvorsen)
Date: Tue, 19 Sep 2006 14:46:27 -0400
Subject: [Rd] wishlist --- menu entry [Rgui] misc --- stop current
	computation
In-Reply-To: <Pine.LNX.4.64.0609191845040.2465@gannet.stats.ox.ac.uk>
References: <556e90a80609191034ma98b7e8o9fe38091b81ce7e6@mail.gmail.com>
	<Pine.LNX.4.64.0609191845040.2465@gannet.stats.ox.ac.uk>
Message-ID: <556e90a80609191146l780f74c6s2026b14d1d2a7d46@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060919/8cb5223e/attachment-0003.pl 

From ggrothendieck at gmail.com  Tue Sep 19 22:11:35 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 19 Sep 2006 16:11:35 -0400
Subject: [Rd] An update method for lists?
In-Reply-To: <eb555e660609181500t4f823763t8bdae712333a8e0@mail.gmail.com>
References: <eb555e660609151222u2f1a7856l6b5f786c8677966@mail.gmail.com>
	<17675.2988.727158.326024@stat.math.ethz.ch>
	<eb555e660609151354t22c68166s4b0144a286c68f50@mail.gmail.com>
	<eb555e660609181500t4f823763t8bdae712333a8e0@mail.gmail.com>
Message-ID: <971536df0609191311u1dc45bd4w9730b00349826b1@mail.gmail.com>

Perhaps it should have another name, be made generic and extended
to functions in which case it would work on the formal arguments.  e.g.

   read.table.comma <- modify(read.table, list(sep = ","))

would return a function that is the same as read.table but
has "," as the default for sep.

Python has something like this called partial:
   http://docs.python.org/dev/whatsnew/pep-309.html


On 9/18/06, Deepayan Sarkar <deepayan.sarkar at gmail.com> wrote:
> On 9/15/06, Deepayan Sarkar <deepayan.sarkar at gmail.com> wrote:
> > On 9/15/06, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
> > > >>>>> "DeepS" == Deepayan Sarkar <deepayan.sarkar at gmail.com>
> > > >>>>>     on Fri, 15 Sep 2006 12:22:15 -0700 writes:
> > >
> > >     DeepS> Hi, since lattice uses nested lists in various
> > >     DeepS> situations, it has had an unexported function called
> > >     DeepS> updateList for a while, which looks like
> > >
> > >  >>     > lattice:::updateList
> > >  >>     function (x, val)
> > >  >>     {
> > >  >>     if (is.null(x))
> > >  >>         x <- list()
> > >  >>     if (!is.list(x))
> > >  >>         stop("x must be NULL or a list")
> > >  >>     if (!is.list(val))
> > >  >>         stop("val must be a list")
> > >  >>     xnames <- names(x)
> > >  >>     for (v in names(val)) {
> > >  >>         existing <- v %in% xnames
> > >  >>         if (existing && is.list(x[[v]]) && is.list(val[[v]]))
> > >  >>             x[[v]] <- updateList(x[[v]], val[[v]])
> > >  >>         else x[[v]] <- val[[v]]
> > >  >>     }
> > >  >>     x
> > >  >>     }
> > >
> > > [I'm not sure I'd allow NULL for 'x';  typing list() instead of
> > >  NULL is not much more, but when the function name even includes  'list'
> > >  I'd really require a list for 'x']
> >
> > Makes sense.
> >
> > > You could hence collapse the first 6 lines to the single
> > >
> > >    stopifnot(is.list(x), is.list(val))
> >
> > I'll check if lattice needs some fixes with this.
>
> Actually, I do need to allow NULL, because update.trellis does things like
>
> update.trellis <- function(object, ..., par.strip.text, ...)
> {
>    ...
>    object$par.strip.text <- updateList(object$par.strip.text, par.strip.text)
>    ...
> }
>
> where object$par.strip.text may be initially NULL. But I'll do that
> inside a lattice wrapper.
>
> > >     DeepS> Basically, it recursively replaces elements that have
> > >     DeepS> been specified in val, leaving the other components
> > >     DeepS> alone. I'm not aware of any other actual situation
> > >     DeepS> where this is useful, but it certainly can be, so I
> > >     DeepS> want to export this functionaliy. At least one other
> > >     DeepS> person (Gabor) has also asked for that.
> > >
> > > I've had a similar need only recently:
> > > If a list is used to store "defaults" and you want a safe way to
> > > change only a few of the values...
> > > I presume you use this for manipulating the settings of lattice
> > > parts ?
> >
> > Yes, it's primarily used inside trellis.par.set, but many other places as well.
> >
> > >     DeepS> Now, as the name suggests, I think it might be
> > >     DeepS> reasonable to export this as an update method for
> > >     DeepS> "list" objects. Depending on what others (in
> > >     DeepS> particular r-core) think, one of these things might
> > >     DeepS> happen:
> > >
> > >     DeepS> (1) I export it as updateList (or some other name) in lattice
> > >     DeepS> (2) I export it as an S3 method update.list in lattice
> > >     DeepS> (3) It gets added as an S3 method update.list in one of the base packages
> > > or
> > >     (4) it gets added as utility function updateList() to
> > >         'utils' {= one of the base packages}
> >
> > Yes, that a good option too (certainly better than (1))
> >
> > > which I'd favor momentarily.
> > > - update() is typically for updating *models*
> > > - it's not clear that this is *the* method for update()ing a list
> >
> > I agree. Part of the reason I brought this up is because it is not
> > clear to me what justifies a new method for an existing generic. An
> > argument for is that one doesn't introduce yet another function, which
> > (I thought) might be enough if the other choice is to not have any
> > method at all.
> >
> > > I'm also a bit wondering if it wouldn't make sense to change the name to
> > > something like assignInList().
> >
> > I'm open to suggestions for the name. I didn't think too much about it
> > since it was unexported anyway.
> >
> > >     DeepS> The default option is (1), and I guess Sept 19 is the deadline for any
> > >     DeepS> of these to be included in R 2.4.0.
> > >
> > > Yes, that's true for (3) & (4) are higher if you provide a patch
> > > to R-devel (not R-alpha) which includes a man page ...  [but
> > > don't hurry, I'd like to see other comments]
>
> I have checked in
>
> https://svn.r-project.org/R-packages/trunk/lattice/R/modifyList.R
> https://svn.r-project.org/R-packages/trunk/lattice/man/modifyList.Rd
>
> which I'm happy to offer for inclusion in utils or wherever might seem
> appropriate. I'll upload a version of lattice which includes these
> late tomorrow if I don't see any more comments by then.
>
> I've changed the name because I wasn't sure if assignInList might be
> confusing, as the semantics are different from those of assign (assign
> is like 'fix', while this is more like 'edit'). However, any name is
> fine with me.
>
> Deepayan
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



From hb at stat.berkeley.edu  Tue Sep 19 22:28:29 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Tue, 19 Sep 2006 13:28:29 -0700
Subject: [Rd] wishlist --- menu entry [Rgui] misc --- stop current
	computation
In-Reply-To: <Pine.LNX.4.64.0609191845040.2465@gannet.stats.ox.ac.uk>
References: <556e90a80609191034ma98b7e8o9fe38091b81ce7e6@mail.gmail.com>
	<Pine.LNX.4.64.0609191845040.2465@gannet.stats.ox.ac.uk>
Message-ID: <59d7961d0609191328xdfeef15u83b065d46120dfd0@mail.gmail.com>

On 9/19/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On Tue, 19 Sep 2006, Kjetil Halvorsen wrote:
>
> > This is from R-2.4.0alpha on windows XP, downloaded from CRAN yesterday.
> >
> > I did
> > update.packages(destdir= ..., ask=FALSE,checkBuilt=TRUE)
> >
> > which took quite a long time (as.expected). When the internet cafe
> > had to close, I had to stop the downloading, but the menu item
> > misc --- stop current computation only stopped the current download,
> > and then R imeadiaetely continued whit the next in the waitin list, so I had
> > to kill
> > R. I  would be nice if this could be corrected so it really
> > stopped all the waiting computastion!
>
> As it does what it says, it cannot be 'corrected' to do something else.
> I usually find hitting Ctrl-C (or ESC in Rgui) a few times breaks out
> here.
>
> The issue is that update.packages (or more precisely download.packages)
> has a loop of try() constructs, and those are trapping interrupts.
> I don't think there is any way to distinguish those from other internal
> errors.  In any case, it is a somewhat delicate question as to what you
> want: do you want pending on.exit() actions done, for example?

Without digging into the update.packages() et al code, wouldn't a
distinction between 'error' and 'interrupt' using tryCatch() rather
than try() solve this?  ...assuming "stop current computation" signals
some kind of interrupt.

Some additional thoughs:  It would be very useful if we could define
different 'condition' classes that can be caught or let through using
tryCatch().  Then higher-level methods such as source() and example()
can then be made sensitive to these.  For example:

simpleExit extends simpleCondition: A script can throw this to signal
to example() or source() that it want to exit the evaluation nicely,
cf. stop().  See also R-devel topic "[Rd] New simpleExit() condition
(Was: Re: Can example() code stop the example without generating an
error?)" on March 14, 2006.

/Henrik

>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>



From deepayan.sarkar at gmail.com  Tue Sep 19 22:48:52 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Tue, 19 Sep 2006 13:48:52 -0700
Subject: [Rd] An update method for lists?
In-Reply-To: <971536df0609191311u1dc45bd4w9730b00349826b1@mail.gmail.com>
References: <eb555e660609151222u2f1a7856l6b5f786c8677966@mail.gmail.com>
	<17675.2988.727158.326024@stat.math.ethz.ch>
	<eb555e660609151354t22c68166s4b0144a286c68f50@mail.gmail.com>
	<eb555e660609181500t4f823763t8bdae712333a8e0@mail.gmail.com>
	<971536df0609191311u1dc45bd4w9730b00349826b1@mail.gmail.com>
Message-ID: <eb555e660609191348u1310c80r414ab2f0cb4b9fa8@mail.gmail.com>

On 9/19/06, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> Perhaps it should have another name, be made generic and extended
> to functions in which case it would work on the formal arguments.  e.g.
>
>    read.table.comma <- modify(read.table, list(sep = ","))
>
> would return a function that is the same as read.table but
> has "," as the default for sep.
>
> Python has something like this called partial:
>    http://docs.python.org/dev/whatsnew/pep-309.html

I have had similar thoughts, and even requested a variant a while
back, with a possible implementation:

https://stat.ethz.ch/pipermail/r-devel/2006-March/036696.html

Again, the main question is whether it makes sense to introduce this
in `one of the base packages'.

-Deepayan

> On 9/18/06, Deepayan Sarkar <deepayan.sarkar at gmail.com> wrote:
> > On 9/15/06, Deepayan Sarkar <deepayan.sarkar at gmail.com> wrote:
> > > On 9/15/06, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
> > > > >>>>> "DeepS" == Deepayan Sarkar <deepayan.sarkar at gmail.com>
> > > > >>>>>     on Fri, 15 Sep 2006 12:22:15 -0700 writes:
> > > >
> > > >     DeepS> Hi, since lattice uses nested lists in various
> > > >     DeepS> situations, it has had an unexported function called
> > > >     DeepS> updateList for a while, which looks like
> > > >
> > > >  >>     > lattice:::updateList
> > > >  >>     function (x, val)
> > > >  >>     {
> > > >  >>     if (is.null(x))
> > > >  >>         x <- list()
> > > >  >>     if (!is.list(x))
> > > >  >>         stop("x must be NULL or a list")
> > > >  >>     if (!is.list(val))
> > > >  >>         stop("val must be a list")
> > > >  >>     xnames <- names(x)
> > > >  >>     for (v in names(val)) {
> > > >  >>         existing <- v %in% xnames
> > > >  >>         if (existing && is.list(x[[v]]) && is.list(val[[v]]))
> > > >  >>             x[[v]] <- updateList(x[[v]], val[[v]])
> > > >  >>         else x[[v]] <- val[[v]]
> > > >  >>     }
> > > >  >>     x
> > > >  >>     }
> > > >
> > > > [I'm not sure I'd allow NULL for 'x';  typing list() instead of
> > > >  NULL is not much more, but when the function name even includes  'list'
> > > >  I'd really require a list for 'x']
> > >
> > > Makes sense.
> > >
> > > > You could hence collapse the first 6 lines to the single
> > > >
> > > >    stopifnot(is.list(x), is.list(val))
> > >
> > > I'll check if lattice needs some fixes with this.
> >
> > Actually, I do need to allow NULL, because update.trellis does things like
> >
> > update.trellis <- function(object, ..., par.strip.text, ...)
> > {
> >    ...
> >    object$par.strip.text <- updateList(object$par.strip.text, par.strip.text)
> >    ...
> > }
> >
> > where object$par.strip.text may be initially NULL. But I'll do that
> > inside a lattice wrapper.
> >
> > > >     DeepS> Basically, it recursively replaces elements that have
> > > >     DeepS> been specified in val, leaving the other components
> > > >     DeepS> alone. I'm not aware of any other actual situation
> > > >     DeepS> where this is useful, but it certainly can be, so I
> > > >     DeepS> want to export this functionaliy. At least one other
> > > >     DeepS> person (Gabor) has also asked for that.
> > > >
> > > > I've had a similar need only recently:
> > > > If a list is used to store "defaults" and you want a safe way to
> > > > change only a few of the values...
> > > > I presume you use this for manipulating the settings of lattice
> > > > parts ?
> > >
> > > Yes, it's primarily used inside trellis.par.set, but many other places as well.
> > >
> > > >     DeepS> Now, as the name suggests, I think it might be
> > > >     DeepS> reasonable to export this as an update method for
> > > >     DeepS> "list" objects. Depending on what others (in
> > > >     DeepS> particular r-core) think, one of these things might
> > > >     DeepS> happen:
> > > >
> > > >     DeepS> (1) I export it as updateList (or some other name) in lattice
> > > >     DeepS> (2) I export it as an S3 method update.list in lattice
> > > >     DeepS> (3) It gets added as an S3 method update.list in one of the base packages
> > > > or
> > > >     (4) it gets added as utility function updateList() to
> > > >         'utils' {= one of the base packages}
> > >
> > > Yes, that a good option too (certainly better than (1))
> > >
> > > > which I'd favor momentarily.
> > > > - update() is typically for updating *models*
> > > > - it's not clear that this is *the* method for update()ing a list
> > >
> > > I agree. Part of the reason I brought this up is because it is not
> > > clear to me what justifies a new method for an existing generic. An
> > > argument for is that one doesn't introduce yet another function, which
> > > (I thought) might be enough if the other choice is to not have any
> > > method at all.
> > >
> > > > I'm also a bit wondering if it wouldn't make sense to change the name to
> > > > something like assignInList().
> > >
> > > I'm open to suggestions for the name. I didn't think too much about it
> > > since it was unexported anyway.
> > >
> > > >     DeepS> The default option is (1), and I guess Sept 19 is the deadline for any
> > > >     DeepS> of these to be included in R 2.4.0.
> > > >
> > > > Yes, that's true for (3) & (4) are higher if you provide a patch
> > > > to R-devel (not R-alpha) which includes a man page ...  [but
> > > > don't hurry, I'd like to see other comments]
> >
> > I have checked in
> >
> > https://svn.r-project.org/R-packages/trunk/lattice/R/modifyList.R
> > https://svn.r-project.org/R-packages/trunk/lattice/man/modifyList.Rd
> >
> > which I'm happy to offer for inclusion in utils or wherever might seem
> > appropriate. I'll upload a version of lattice which includes these
> > late tomorrow if I don't see any more comments by then.
> >
> > I've changed the name because I wasn't sure if assignInList might be
> > confusing, as the semantics are different from those of assign (assign
> > is like 'fix', while this is more like 'edit'). However, any name is
> > fine with me.
> >
> > Deepayan



From kjetilbrinchmannhalvorsen at gmail.com  Tue Sep 19 22:56:24 2006
From: kjetilbrinchmannhalvorsen at gmail.com (Kjetil Halvorsen)
Date: Tue, 19 Sep 2006 16:56:24 -0400
Subject: [Rd] mgcv in R-2.4.0.alpha
Message-ID: <556e90a80609191356n7d8ed764q9f921295f10e00ac@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060919/fa2b19ae/attachment-0003.pl 

From MSchwartz at mn.rr.com  Wed Sep 20 02:14:39 2006
From: MSchwartz at mn.rr.com (Marc Schwartz)
Date: Tue, 19 Sep 2006 19:14:39 -0500
Subject: [Rd] Sweave processes \Sexpr in commented LaTeX source
	(2.3.1patched	and 2.4.0)
Message-ID: <1158711280.5348.24.camel@localhost.localdomain>

Hi all,

On FC5, using:

  Version 2.3.1 Patched (2006-08-06 r38829)

and today's

  R version 2.4.0 alpha (2006-09-19 r39397)

with the following .Rnw file:


\documentclass[10pt]{article}
\begin{document}

   This line should print '2': \Sexpr{1 + 1}
%% This line should NOT print '2': \Sexpr{1 + 1}

\end{document}


The \Sexpr in the second line is processed even though the line is
commented. This results in the following .tex file content (in the case
of R 2.4.0):


\documentclass[10pt]{article}
\usepackage{/home/marcs/R.Files/SourceCode/R-alpha/share/texmf/Sweave}
\begin{document}

   This line should print '2': 2
%% This line should NOT print '2': 2

\end{document}



Shouldn't Sweave just generally ignore commented LaTeX code? In
reviewing Sweave.R I did not see a check for this, so perhaps there are
circumstances where one wants a \Sexpr in commented LaTeX code
processed. An example escapes me at the moment however.

HTH,

Marc Schwartz



From Mark.Bravington at csiro.au  Wed Sep 20 02:54:15 2006
From: Mark.Bravington at csiro.au (Mark.Bravington at csiro.au)
Date: Wed, 20 Sep 2006 10:54:15 +1000
Subject: [Rd] An update method for lists?
Message-ID: <D79013E40FEF254AAF0D72DFC94F27482306C0@extas4-hba.tas.csiro.au>

> 
> On 9/19/06, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> > Perhaps it should have another name, be made generic and 
> extended to 
> > functions in which case it would work on the formal arguments.  e.g.
> >
> >    read.table.comma <- modify(read.table, list(sep = ","))
> >
> > would return a function that is the same as read.table but 
> has "," as 
> > the default for sep.
> >
> > Python has something like this called partial:
> >    http://docs.python.org/dev/whatsnew/pep-309.html
> 
> I have had similar thoughts, and even requested a variant a 
> while back, with a possible implementation:

There is a function that does this in the 'mvbutils' package, called
'hack':

hack <- function( fun, ...){
  mc <- match.call( expand.dots=FALSE)$...
  for( i in names( mc))
    formals( fun)[[ i]] <- mc[[ i]]
  fun
}

which is a little different to Deepayan's version-- not sure what the
pros & cons of each are. I use 'hack' extensively inside my '.First'
(and in the startup code for 'mvbutils' itself) to change default
parameters in various 'base', 'graphics' and 'utils' functions. Sounds
like this may be fairly common practice.

Mark

Mark Bravington
CSIRO Mathematical & Information Sciences
Marine Laboratory
Castray Esplanade
Hobart 7001
TAS

ph (+61) 3 6232 5118
fax (+61) 3 6232 5012
mob (+61) 438 315 623

> 
> https://stat.ethz.ch/pipermail/r-devel/2006-March/036696.html
> 
> Again, the main question is whether it makes sense to 
> introduce this in `one of the base packages'.
> 
> -Deepayan

> 
> > On 9/18/06, Deepayan Sarkar <deepayan.sarkar at gmail.com> wrote:
> > > On 9/15/06, Deepayan Sarkar <deepayan.sarkar at gmail.com> wrote:
> > > > On 9/15/06, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
> > > > > >>>>> "DeepS" == Deepayan Sarkar <deepayan.sarkar at gmail.com>
> > > > > >>>>>     on Fri, 15 Sep 2006 12:22:15 -0700 writes:
> > > > >
> > > > >     DeepS> Hi, since lattice uses nested lists in various
> > > > >     DeepS> situations, it has had an unexported 
> function called
> > > > >     DeepS> updateList for a while, which looks like
> > > > >
> > > > >  >>     > lattice:::updateList
> > > > >  >>     function (x, val)
> > > > >  >>     {
> > > > >  >>     if (is.null(x))
> > > > >  >>         x <- list()
> > > > >  >>     if (!is.list(x))
> > > > >  >>         stop("x must be NULL or a list")
> > > > >  >>     if (!is.list(val))
> > > > >  >>         stop("val must be a list")
> > > > >  >>     xnames <- names(x)
> > > > >  >>     for (v in names(val)) {
> > > > >  >>         existing <- v %in% xnames
> > > > >  >>         if (existing && is.list(x[[v]]) && 
> is.list(val[[v]]))
> > > > >  >>             x[[v]] <- updateList(x[[v]], val[[v]])
> > > > >  >>         else x[[v]] <- val[[v]]
> > > > >  >>     }
> > > > >  >>     x
> > > > >  >>     }
> > > > >
> > > > > [I'm not sure I'd allow NULL for 'x';  typing list() 
> instead of  
> > > > > NULL is not much more, but when the function name 
> even includes  'list'
> > > > >  I'd really require a list for 'x']
> > > >
> > > > Makes sense.
> > > >
> > > > > You could hence collapse the first 6 lines to the single
> > > > >
> > > > >    stopifnot(is.list(x), is.list(val))
> > > >
> > > > I'll check if lattice needs some fixes with this.
> > >
> > > Actually, I do need to allow NULL, because update.trellis does 
> > > things like
> > >
> > > update.trellis <- function(object, ..., par.strip.text, ...) {
> > >    ...
> > >    object$par.strip.text <- 
> updateList(object$par.strip.text, par.strip.text)
> > >    ...
> > > }
> > >
> > > where object$par.strip.text may be initially NULL. But 
> I'll do that 
> > > inside a lattice wrapper.
> > >
> > > > >     DeepS> Basically, it recursively replaces 
> elements that have
> > > > >     DeepS> been specified in val, leaving the other components
> > > > >     DeepS> alone. I'm not aware of any other actual situation
> > > > >     DeepS> where this is useful, but it certainly can be, so I
> > > > >     DeepS> want to export this functionaliy. At least 
> one other
> > > > >     DeepS> person (Gabor) has also asked for that.
> > > > >
> > > > > I've had a similar need only recently:
> > > > > If a list is used to store "defaults" and you want a 
> safe way to 
> > > > > change only a few of the values...
> > > > > I presume you use this for manipulating the settings 
> of lattice 
> > > > > parts ?
> > > >
> > > > Yes, it's primarily used inside trellis.par.set, but 
> many other places as well.
> > > >
> > > > >     DeepS> Now, as the name suggests, I think it might be
> > > > >     DeepS> reasonable to export this as an update method for
> > > > >     DeepS> "list" objects. Depending on what others (in
> > > > >     DeepS> particular r-core) think, one of these things might
> > > > >     DeepS> happen:
> > > > >
> > > > >     DeepS> (1) I export it as updateList (or some 
> other name) in lattice
> > > > >     DeepS> (2) I export it as an S3 method 
> update.list in lattice
> > > > >     DeepS> (3) It gets added as an S3 method 
> update.list in one 
> > > > > of the base packages or
> > > > >     (4) it gets added as utility function updateList() to
> > > > >         'utils' {= one of the base packages}
> > > >
> > > > Yes, that a good option too (certainly better than (1))
> > > >
> > > > > which I'd favor momentarily.
> > > > > - update() is typically for updating *models*
> > > > > - it's not clear that this is *the* method for update()ing a 
> > > > > list
> > > >
> > > > I agree. Part of the reason I brought this up is 
> because it is not 
> > > > clear to me what justifies a new method for an existing 
> generic. 
> > > > An argument for is that one doesn't introduce yet another 
> > > > function, which (I thought) might be enough if the 
> other choice is 
> > > > to not have any method at all.
> > > >
> > > > > I'm also a bit wondering if it wouldn't make sense to 
> change the 
> > > > > name to something like assignInList().
> > > >
> > > > I'm open to suggestions for the name. I didn't think too much 
> > > > about it since it was unexported anyway.
> > > >
> > > > >     DeepS> The default option is (1), and I guess 
> Sept 19 is the deadline for any
> > > > >     DeepS> of these to be included in R 2.4.0.
> > > > >
> > > > > Yes, that's true for (3) & (4) are higher if you 
> provide a patch 
> > > > > to R-devel (not R-alpha) which includes a man page ...  [but 
> > > > > don't hurry, I'd like to see other comments]
> > >
> > > I have checked in
> > >
> > > https://svn.r-project.org/R-packages/trunk/lattice/R/modifyList.R
> > > 
> https://svn.r-project.org/R-packages/trunk/lattice/man/modifyList.Rd
> > >
> > > which I'm happy to offer for inclusion in utils or wherever might 
> > > seem appropriate. I'll upload a version of lattice which includes 
> > > these late tomorrow if I don't see any more comments by then.
> > >
> > > I've changed the name because I wasn't sure if 
> assignInList might be 
> > > confusing, as the semantics are different from those of assign 
> > > (assign is like 'fix', while this is more like 'edit'). 
> However, any 
> > > name is fine with me.
> > >
> > > Deepayan
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>



From ripley at stats.ox.ac.uk  Wed Sep 20 07:32:27 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 20 Sep 2006 06:32:27 +0100 (BST)
Subject: [Rd] wishlist --- menu entry [Rgui] misc --- stop current
 computation
In-Reply-To: <59d7961d0609191328xdfeef15u83b065d46120dfd0@mail.gmail.com>
References: <556e90a80609191034ma98b7e8o9fe38091b81ce7e6@mail.gmail.com> 
	<Pine.LNX.4.64.0609191845040.2465@gannet.stats.ox.ac.uk>
	<59d7961d0609191328xdfeef15u83b065d46120dfd0@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0609192219350.12871@gannet.stats.ox.ac.uk>

On Tue, 19 Sep 2006, Henrik Bengtsson wrote:

> On 9/19/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>> On Tue, 19 Sep 2006, Kjetil Halvorsen wrote:
>> 
>> > This is from R-2.4.0alpha on windows XP, downloaded from CRAN yesterday.
>> >
>> > I did
>> > update.packages(destdir= ..., ask=FALSE,checkBuilt=TRUE)
>> >
>> > which took quite a long time (as.expected). When the internet cafe
>> > had to close, I had to stop the downloading, but the menu item
>> > misc --- stop current computation only stopped the current download,
>> > and then R imeadiaetely continued whit the next in the waitin list, so I 
>> had
>> > to kill
>> > R. I  would be nice if this could be corrected so it really
>> > stopped all the waiting computastion!
>> 
>> As it does what it says, it cannot be 'corrected' to do something else.
>> I usually find hitting Ctrl-C (or ESC in Rgui) a few times breaks out
>> here.
>> 
>> The issue is that update.packages (or more precisely download.packages)
>> has a loop of try() constructs, and those are trapping interrupts.
>> I don't think there is any way to distinguish those from other internal
>> errors.  In any case, it is a somewhat delicate question as to what you
>> want: do you want pending on.exit() actions done, for example?
>
> Without digging into the update.packages() et al code, wouldn't a
> distinction between 'error' and 'interrupt' using tryCatch() rather
> than try() solve this?  ...assuming "stop current computation" signals
> some kind of interrupt.

Only to change the design intention for a particular piece of code. Here 
the design intention was to abort just the current download (which can be 
quite useful if it hangs, and allows other packages in the set to be 
installed).  And that only if the interrupt is handled by R, rather than 
by a process invoked by system(), which is possible behaviour in 
download.packages depending on the options. Although it is hard to break 
this particular loop on RGui (harder than I thought as the progress bar 
shifts focus), it does not seem a common enough problem to try to solve on 
its own, and in particular not to change the design intention.

I took the request to be general, and retrospective: 'I have a computation 
running, and I have now decided I want to stop it completely and return to 
the top level'.  That's a reasonable request, especially to those who 
would like to save earlier work in the session (and on Unix we have 
SIGUSR1 to kill the session and save the workspace).  There is only one 
type of interrupt internally in R, and no way that I know of to override 
code-specific interrupt handling,

To do that it looks like we need different classes of interrupts.  Unix 
has several signals for this purpose, but Windows does not.  It's messy 
(not all Unices are the same), but I have in the past wondered about using 
(some of) SIGINT, SIGKILL, SIGTERM and SIGSTOP to do different things, and 
we could fake something similar under Windows.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From friedrich.leisch at stat.uni-muenchen.de  Wed Sep 20 08:43:31 2006
From: friedrich.leisch at stat.uni-muenchen.de (Friedrich Leisch)
Date: Wed, 20 Sep 2006 08:43:31 +0200
Subject: [Rd] Sweave processes \Sexpr in commented LaTeX
	source	(2.3.1patched	and 2.4.0)
In-Reply-To: <1158711280.5348.24.camel@localhost.localdomain>
References: <1158711280.5348.24.camel@localhost.localdomain>
Message-ID: <17680.58131.594486.582029@celebrian.ci.tuwien.ac.at>

>>>>> On Tue, 19 Sep 2006 19:14:39 -0500,
>>>>> Marc Schwartz (MS) wrote:

  > Hi all,
  > On FC5, using:

  >   Version 2.3.1 Patched (2006-08-06 r38829)

  > and today's

  >   R version 2.4.0 alpha (2006-09-19 r39397)

  > with the following .Rnw file:


  > \documentclass[10pt]{article}
  > \begin{document}

  >    This line should print '2': \Sexpr{1 + 1}
  > %% This line should NOT print '2': \Sexpr{1 + 1}

  > \end{document}


  > The \Sexpr in the second line is processed even though the line is
  > commented. This results in the following .tex file content (in the case
  > of R 2.4.0):


  > \documentclass[10pt]{article}
  > \usepackage{/home/marcs/R.Files/SourceCode/R-alpha/share/texmf/Sweave}
  > \begin{document}

  >    This line should print '2': 2
  > %% This line should NOT print '2': 2

  > \end{document}



  > Shouldn't Sweave just generally ignore commented LaTeX code? In
  > reviewing Sweave.R I did not see a check for this, so perhaps there are
  > circumstances where one wants a \Sexpr in commented LaTeX code
  > processed. An example escapes me at the moment however.

Sweave does not parse the LaTeX part of the document at all (which
makes it a lot easier), all it does is looking for its own "magic
strings" and replacing those, wherever they might occur.

If we would start to respect comments, we would need a some kind of
parser for LaTeX, which we currently don't need ... and starting to
parse LaTeX would also open a can of worms of possible requests (what
to do with Sexpr inside verbatim, etc, etc).

Best,
Fritz



From p.dalgaard at biostat.ku.dk  Wed Sep 20 12:04:39 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 20 Sep 2006 12:04:39 +0200
Subject: [Rd] mgcv in R-2.4.0.alpha
In-Reply-To: <556e90a80609191356n7d8ed764q9f921295f10e00ac@mail.gmail.com>
References: <556e90a80609191356n7d8ed764q9f921295f10e00ac@mail.gmail.com>
Message-ID: <x21wq63lc8.fsf@viggo.kubism.ku.dk>

"Kjetil Halvorsen" <kjetilbrinchmannhalvorsen at gmail.com> writes:

> Hola!
> 
> I am sending this to the list since emails from me to Simon Wood
> has bounced earlier.
> 
> I get:
> 
> > library(tsDyn)
> Loading required package: mgcv
> Erro en `parent.env<-`(`*tmp*`, value = NULL) :
>         use of NULL environment is defunct
> Error: package 'mgcv' could not be loaded
> > library(mgcv)
> Erro en `parent.env<-`(`*tmp*`, value = NULL) :
>         use of NULL environment is defunct
> Error: package/namespace load failed for 'mgcv'
>  But in the package check summary on CRAN mgcv
> gets OK.
> 
> > sessionInfo()
> R version 2.4.0 alpha (2006-09-16 r39365)
> i386-pc-mingw32
> 
> locale:
> LC_COLLATE=Spanish_Bolivia.1252;LC_CTYPE=Spanish_Bolivia.1252;LC_MONETARY=Spanish_Bolivia.1252;LC_NUMERIC=C;LC_TIME=Spanish_Bolivia.1252
> 
> attached base packages:
> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"
> [7] "base"
> 
> Kjetil B Halvorsen

If a straight library(mgcv) doesn't work, then I suspect you are
picking up a different (older) version of the package. What does
library() tell you about mgcv?

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From p.dalgaard at biostat.ku.dk  Wed Sep 20 12:20:09 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 20 Sep 2006 12:20:09 +0200
Subject: [Rd] Sweave processes \Sexpr in commented LaTeX
	source	(2.3.1patched	and 2.4.0)
In-Reply-To: <17680.58131.594486.582029@celebrian.ci.tuwien.ac.at>
References: <1158711280.5348.24.camel@localhost.localdomain>
	<17680.58131.594486.582029@celebrian.ci.tuwien.ac.at>
Message-ID: <x2wt7y261y.fsf@viggo.kubism.ku.dk>

Friedrich Leisch <friedrich.leisch at stat.uni-muenchen.de> writes:

> >>>>> On Tue, 19 Sep 2006 19:14:39 -0500,
> >>>>> Marc Schwartz (MS) wrote:
> 
>   > Hi all,
>   > On FC5, using:
> 
>   >   Version 2.3.1 Patched (2006-08-06 r38829)
> 
>   > and today's
> 
>   >   R version 2.4.0 alpha (2006-09-19 r39397)
> 
>   > with the following .Rnw file:
> 
> 
>   > \documentclass[10pt]{article}
>   > \begin{document}
> 
>   >    This line should print '2': \Sexpr{1 + 1}
>   > %% This line should NOT print '2': \Sexpr{1 + 1}
> 
>   > \end{document}
> 
> 
>   > The \Sexpr in the second line is processed even though the line is
>   > commented. This results in the following .tex file content (in the case
>   > of R 2.4.0):
> 
> 
>   > \documentclass[10pt]{article}
>   > \usepackage{/home/marcs/R.Files/SourceCode/R-alpha/share/texmf/Sweave}
>   > \begin{document}
> 
>   >    This line should print '2': 2
>   > %% This line should NOT print '2': 2
> 
>   > \end{document}
> 
> 
> 
>   > Shouldn't Sweave just generally ignore commented LaTeX code? In
>   > reviewing Sweave.R I did not see a check for this, so perhaps there are
>   > circumstances where one wants a \Sexpr in commented LaTeX code
>   > processed. An example escapes me at the moment however.
> 
> Sweave does not parse the LaTeX part of the document at all (which
> makes it a lot easier), all it does is looking for its own "magic
> strings" and replacing those, wherever they might occur.
> 
> If we would start to respect comments, we would need a some kind of
> parser for LaTeX, which we currently don't need ... and starting to
> parse LaTeX would also open a can of worms of possible requests (what
> to do with Sexpr inside verbatim, etc, etc).

..not to mention TeX comments inside Sexpr (e.g. %*%...). Skipping
lines with % as the first character might be a viable compromise
though. 

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From jaomatos at gmail.com  Wed Sep 20 12:41:05 2006
From: jaomatos at gmail.com (=?ISO-8859-1?Q?Jos=E9_Matos?=)
Date: Wed, 20 Sep 2006 11:41:05 +0100
Subject: [Rd] Using \u2030 in plot axis label -> stack smashing
In-Reply-To: <Pine.LNX.4.64.0609191336190.21406@gannet.stats.ox.ac.uk>
References: <1158586738.28530.52.camel@gsimpson.geog.ucl.ac.uk>
	<loom.20060918T205234-775@post.gmane.org>
	<1158614334.2277.7.camel@graptoleberis.geog.ucl.ac.uk>
	<450F608A.30508@bfro.uni-lj.si>
	<dc41e1260609182113p48a7f35dg3b27f7100f435170@mail.gmail.com>
	<Pine.LNX.4.64.0609190746490.27751@gannet.stats.ox.ac.uk>
	<1158662883.10675.11.camel@gsimpson.geog.ucl.ac.uk>
	<Pine.LNX.4.64.0609191150000.12225@gannet.stats.ox.ac.uk>
	<x2bqpc2gf9.fsf@viggo.kubism.ku.dk>
	<Pine.LNX.4.64.0609191336190.21406@gannet.stats.ox.ac.uk>
Message-ID: <9fd2371d0609200341g754af027n2fbad3c845f1c878@mail.gmail.com>

On 19/09/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>
> Apparently FC6 will have different flags/ different default behaviour, at
> least for ld.

Just for reference I have tested the default CFLAGS in  FC-5 and FC-6.
They are equal, namely:

CFLAGS="-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions
-fstack-protector --param=ssp-buffer-size=4"

this is common to all three supported archs, i386, x86_64 and ppc.
(There is in addition an architecture specfic part after)

  Regarding the linker you are right as is discussed in the draft
notes for FC6 release:
http://fedora.redhat.com/docs/release-notes/fc6test2/#id3068132

-- 
Jos? Ab?lio



From maechler at stat.math.ethz.ch  Wed Sep 20 12:56:45 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 20 Sep 2006 12:56:45 +0200
Subject: [Rd] mgcv in R-2.4.0.alpha
In-Reply-To: <556e90a80609191356n7d8ed764q9f921295f10e00ac@mail.gmail.com>
References: <556e90a80609191356n7d8ed764q9f921295f10e00ac@mail.gmail.com>
Message-ID: <17681.7789.276858.794197@stat.math.ethz.ch>

>>>>> "Kjetil" == Kjetil Halvorsen <kjetilbrinchmannhalvorsen at gmail.com>
>>>>>     on Tue, 19 Sep 2006 16:56:24 -0400 writes:

    Kjetil> Hola!
    Kjetil> I am sending this to the list since emails from me to Simon Wood
    Kjetil> has bounced earlier.

    Kjetil> I get:

    >> library(tsDyn)
    Kjetil> Loading required package: mgcv
    Kjetil> Erro en `parent.env<-`(`*tmp*`, value = NULL) :
    Kjetil> use of NULL environment is defunct
    Kjetil> Error: package 'mgcv' could not be loaded
    >> library(mgcv)
    Kjetil> Erro en `parent.env<-`(`*tmp*`, value = NULL) :
    Kjetil> use of NULL environment is defunct
    Kjetil> Error: package/namespace load failed for 'mgcv'
    Kjetil> But in the package check summary on CRAN mgcv
    Kjetil> gets OK.

Yes, because it *is* ok.
I'm pretty sure you are getting an old version of 'mgcv' instead
of the correct one.

Look at the result of 
 ll <- library()
 ll$res[ll$res[,1] == "mgcv" ,]

    >> sessionInfo()
    Kjetil> R version 2.4.0 alpha (2006-09-16 r39365)
    Kjetil> i386-pc-mingw32

    Kjetil> locale:
    Kjetil> LC_COLLATE=Spanish_Bolivia.1252;LC_CTYPE=Spanish_Bolivia.1252;LC_MONETARY=Spanish_Bolivia.1252;LC_NUMERIC=C;LC_TIME=Spanish_Bolivia.1252

    Kjetil> attached base packages:
    Kjetil> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"
    Kjetil> [7] "base"

    Kjetil> Kjetil B Halvorsen

    Kjetil> [[alternative HTML version deleted]]
	    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

           (I thought you would know better ...)
Martin



From kjetilbrinchmannhalvorsen at gmail.com  Wed Sep 20 15:39:07 2006
From: kjetilbrinchmannhalvorsen at gmail.com (Kjetil Halvorsen)
Date: Wed, 20 Sep 2006 09:39:07 -0400
Subject: [Rd] mgcv in R-2.4.0.alpha
In-Reply-To: <17681.7789.276858.794197@stat.math.ethz.ch>
References: <556e90a80609191356n7d8ed764q9f921295f10e00ac@mail.gmail.com>
	<17681.7789.276858.794197@stat.math.ethz.ch>
Message-ID: <556e90a80609200639q21afe342x4e23729ded6a72be@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060920/97f2ed52/attachment-0003.pl 

From kjetilbrinchmannhalvorsen at gmail.com  Wed Sep 20 15:48:37 2006
From: kjetilbrinchmannhalvorsen at gmail.com (Kjetil Halvorsen)
Date: Wed, 20 Sep 2006 09:48:37 -0400
Subject: [Rd] mgcv in R-2.4.0.alpha
In-Reply-To: <17681.7789.276858.794197@stat.math.ethz.ch>
References: <556e90a80609191356n7d8ed764q9f921295f10e00ac@mail.gmail.com>
	<17681.7789.276858.794197@stat.math.ethz.ch>
Message-ID: <556e90a80609200648p20bfd7atac07a50a6cd9a928@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060920/f0213fb4/attachment-0003.pl 

From mschwartz at mn.rr.com  Wed Sep 20 17:00:43 2006
From: mschwartz at mn.rr.com (Marc Schwartz (via MN))
Date: Wed, 20 Sep 2006 10:00:43 -0500
Subject: [Rd] Sweave processes \Sexpr in commented LaTeX
	source	(2.3.1patched	and 2.4.0)
In-Reply-To: <x2wt7y261y.fsf@viggo.kubism.ku.dk>
References: <1158711280.5348.24.camel@localhost.localdomain>
	<17680.58131.594486.582029@celebrian.ci.tuwien.ac.at>
	<x2wt7y261y.fsf@viggo.kubism.ku.dk>
Message-ID: <1158764443.3872.15.camel@localhost.localdomain>

On Wed, 2006-09-20 at 12:20 +0200, Peter Dalgaard wrote:
> Friedrich Leisch <friedrich.leisch at stat.uni-muenchen.de> writes:
> 
> > >>>>> On Tue, 19 Sep 2006 19:14:39 -0500,
> > >>>>> Marc Schwartz (MS) wrote:
> > 
> >   > Hi all,
> >   > On FC5, using:
> > 
> >   >   Version 2.3.1 Patched (2006-08-06 r38829)
> > 
> >   > and today's
> > 
> >   >   R version 2.4.0 alpha (2006-09-19 r39397)
> > 
> >   > with the following .Rnw file:
> > 
> > 
> >   > \documentclass[10pt]{article}
> >   > \begin{document}
> > 
> >   >    This line should print '2': \Sexpr{1 + 1}
> >   > %% This line should NOT print '2': \Sexpr{1 + 1}
> > 
> >   > \end{document}
> > 
> > 
> >   > The \Sexpr in the second line is processed even though the line is
> >   > commented. This results in the following .tex file content (in the case
> >   > of R 2.4.0):
> > 
> > 
> >   > \documentclass[10pt]{article}
> >   > \usepackage{/home/marcs/R.Files/SourceCode/R-alpha/share/texmf/Sweave}
> >   > \begin{document}
> > 
> >   >    This line should print '2': 2
> >   > %% This line should NOT print '2': 2
> > 
> >   > \end{document}
> > 
> > 
> > 
> >   > Shouldn't Sweave just generally ignore commented LaTeX code? In
> >   > reviewing Sweave.R I did not see a check for this, so perhaps there are
> >   > circumstances where one wants a \Sexpr in commented LaTeX code
> >   > processed. An example escapes me at the moment however.
> > 
> > Sweave does not parse the LaTeX part of the document at all (which
> > makes it a lot easier), all it does is looking for its own "magic
> > strings" and replacing those, wherever they might occur.
> > 
> > If we would start to respect comments, we would need a some kind of
> > parser for LaTeX, which we currently don't need ... and starting to
> > parse LaTeX would also open a can of worms of possible requests (what
> > to do with Sexpr inside verbatim, etc, etc).
> 
> ..not to mention TeX comments inside Sexpr (e.g. %*%...). Skipping
> lines with % as the first character might be a viable compromise
> though. 

Fritz and Peter,

Thanks for your replies.

First, for some context on what I was doing.

I have a large .Rnw file and was in the process of doing some debugging.
I had set some R chunks to 'eval=false' in the process. This resulted in
some R objects not being created that were in turn used in the
subsequent \Sexpr's.

Thus, using (C-c ;) in emacs/auctex to comment some blocks of LaTeX
code, I then ran Sweave and of course noted errors which I tracked down
to the evaluation of the (presumably) commented \Sexpr's.

I think that Peter's approach would be a reasonable option, at least in
this scenario and perhaps others, without getting into the need to parse
the LaTeX code for '%'s preceding a '\Sexpr'. This would, I believe,
require modifying the current 'docexpr' regex's in Sweave.R.

An alternative of sorts, would be to add another Sweave option,
something like:

  \SweaveOpts{eval.Sexpr=false}

which could be placed prior to a section where one wanted to disable the
evaluation of Sexpr's and then re-enable it with a:

  \SweaveOpts{eval.Sexpr=true}

at a subsequent point in the .Rnw file.

The option would of course default to 'true'. This would make the
solution more "global" and again not require the need to parse the LaTeX
code.

Food for thought.

Best regards,

Marc



From sfalcon at fhcrc.org  Wed Sep 20 17:35:37 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Wed, 20 Sep 2006 08:35:37 -0700
Subject: [Rd] Sweave processes \Sexpr in commented LaTeX
	source	(2.3.1patched	and 2.4.0)
In-Reply-To: <x2wt7y261y.fsf@viggo.kubism.ku.dk> (Peter Dalgaard's message of
	"20 Sep 2006 12:20:09 +0200")
References: <1158711280.5348.24.camel@localhost.localdomain>
	<17680.58131.594486.582029@celebrian.ci.tuwien.ac.at>
	<x2wt7y261y.fsf@viggo.kubism.ku.dk>
Message-ID: <m2psdq7dpy.fsf@ziti.local>

Peter Dalgaard <p.dalgaard at biostat.ku.dk> writes:
> ..not to mention TeX comments inside Sexpr (e.g. %*%...). Skipping
> lines with % as the first character might be a viable compromise
> though. 

+1.  You could probably ignore any lines where the first
non-whitespace char is '%'.  But if that seems to risky, then only
recognizing first-char-is-% seems a worthwhile heuristic.

Another place where this has bitten people is when they do:

%\usepackage{Sweave}

Sweave picks that up and doesn't insert the usepackage line itself.
So ignoring LaTeX comment lines would solve two problems.

Best,

+ seth



From Robert.McGehee at geodecapital.com  Wed Sep 20 17:43:53 2006
From: Robert.McGehee at geodecapital.com (Robert.McGehee at geodecapital.com)
Date: Wed, 20 Sep 2006 17:43:53 +0200 (CEST)
Subject: [Rd] seq.Date not accepting NULL length.out (PR#9239)
Message-ID: <20060920154353.357A828F8E@slim.kubism.ku.dk>

There seems to be a bug in seq.Date such that it will not allow the user
to pass in length.out =3D NULL, despite the fact that this is the =
default
argument.

For example:
> dt1 <- as.Date("2004-12-31")
> dt2 <- as.Date("2005-12-31")
> seq.Date(dt1, dt2, length.out =3D NULL, by =3D "month")
Error in seq.Date(dt1, dt2, length.out =3D NULL, by =3D "day") :=20
	'length.out' must be of length 1

This might be an issue if I want to wrap seq.Date in another function
that reports or modifies on length.out. For instance, suppose I want to
create a simple function that simply reports when length.out is NULL (or
missing), as below, but otherwise works identically to seq.Date.

FUN <- function(to, from, length.out =3D NULL, by, ...) {
    if (is.null(length.out)) cat("length.out is missing\n")
    seq.Date(to, from, length.out =3D length.out, by =3D by, ...)
}

> seq.Date(dt1, dt2, by =3D "month")
 [1] "2004-12-31" "2005-01-31" "2005-03-03" "2005-03-31" "2005-05-01"
 [6] "2005-05-31" "2005-07-01" "2005-07-31" "2005-08-31" "2005-10-01"
[11] "2005-10-31" "2005-12-01" "2005-12-31"

> FUN(dt1, dt2, by =3D "month")
length.out is missing
Error in seq.Date(dt1, dt2, length.out =3D NULL, by =3D "day") :=20
	'length.out' must be of length 1

I believe the patch to fix this error is as follows (on R2.4.0(alpha)
Revision 39430)
-   }  else if (!missing(length.out)) {
+   }  else if (!missing(length.out) && !is.null(length.out)) {

Another (perhaps better) patch would be to not have NULL be the default
for length.out.

HTH,
Robert

Robert McGehee
Quantitative Analyst
Geode Capital Management, LLC
53 State Street, 5th Floor | Boston, MA | 02109
Tel: 617/392-8396    Fax:617/476-6389
mailto:robert.mcgehee at geodecapital.com



This e-mail, and any attachments hereto, are intended for us...{{dropped}}



From antonio.fabio at gmail.com  Wed Sep 20 18:47:33 2006
From: antonio.fabio at gmail.com (Antonio, Fabio Di Narzo)
Date: Wed, 20 Sep 2006 18:47:33 +0200
Subject: [Rd] Sweave processes \Sexpr in commented LaTeX source
	(2.3.1patched and 2.4.0)
In-Reply-To: <m2psdq7dpy.fsf@ziti.local>
References: <1158711280.5348.24.camel@localhost.localdomain>
	<17680.58131.594486.582029@celebrian.ci.tuwien.ac.at>
	<x2wt7y261y.fsf@viggo.kubism.ku.dk> <m2psdq7dpy.fsf@ziti.local>
Message-ID: <b0808fdc0609200947q16f14052o49fb18e62c439439@mail.gmail.com>

2006/9/20, Seth Falcon <sfalcon at fhcrc.org>:
> Peter Dalgaard <p.dalgaard at biostat.ku.dk> writes:
> > ..not to mention TeX comments inside Sexpr (e.g. %*%...). Skipping
> > lines with % as the first character might be a viable compromise
> > though.
>
> +1.  You could probably ignore any lines where the first
> non-whitespace char is '%'.  But if that seems to risky, then only
> recognizing first-char-is-% seems a worthwhile heuristic.
>
> Another place where this has bitten people is when they do:
>
> %\usepackage{Sweave}
>
> Sweave picks that up and doesn't insert the usepackage line itself.

I've found that extremely useful for sweaving Stex files which aren't
"master" files (i.e., only files to include in a main latex file).
Inserting '\usepackage{Sweave}' in each would result in a latex error.
So commenting it out is a useful workaround.

Antonio.

> So ignoring LaTeX comment lines would solve two problems.
>
> Best,
>
> + seth
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



From sfalcon at fhcrc.org  Wed Sep 20 19:07:26 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Wed, 20 Sep 2006 10:07:26 -0700
Subject: [Rd] Sweave processes \Sexpr in commented LaTeX source
	(2.3.1patched and 2.4.0)
In-Reply-To: <b0808fdc0609200947q16f14052o49fb18e62c439439@mail.gmail.com>
	(Fabio Di Narzo Antonio's message of "Wed,
	20 Sep 2006 18:47:33 +0200")
References: <1158711280.5348.24.camel@localhost.localdomain>
	<17680.58131.594486.582029@celebrian.ci.tuwien.ac.at>
	<x2wt7y261y.fsf@viggo.kubism.ku.dk> <m2psdq7dpy.fsf@ziti.local>
	<b0808fdc0609200947q16f14052o49fb18e62c439439@mail.gmail.com>
Message-ID: <m2d59q5uwh.fsf@ziti.local>

"Antonio, Fabio Di Narzo" <antonio.fabio at gmail.com> writes:

> 2006/9/20, Seth Falcon <sfalcon at fhcrc.org>:
>> Peter Dalgaard <p.dalgaard at biostat.ku.dk> writes:
>> > ..not to mention TeX comments inside Sexpr (e.g. %*%...). Skipping
>> > lines with % as the first character might be a viable compromise
>> > though.
>>
>> +1.  You could probably ignore any lines where the first
>> non-whitespace char is '%'.  But if that seems to risky, then only
>> recognizing first-char-is-% seems a worthwhile heuristic.
>>
>> Another place where this has bitten people is when they do:
>>
>> %\usepackage{Sweave}
>>
>> Sweave picks that up and doesn't insert the usepackage line itself.
>
> I've found that extremely useful for sweaving Stex files which aren't
> "master" files (i.e., only files to include in a main latex file).
> Inserting '\usepackage{Sweave}' in each would result in a latex error.
> So commenting it out is a useful workaround.

Commenting it out _and_ having Sweave see it?



From murdoch at stats.uwo.ca  Wed Sep 20 19:19:18 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 20 Sep 2006 13:19:18 -0400
Subject: [Rd] seq.Date not accepting NULL length.out (PR#9239)
In-Reply-To: <20060920154353.357A828F8E@slim.kubism.ku.dk>
References: <20060920154353.357A828F8E@slim.kubism.ku.dk>
Message-ID: <45117816.1070903@stats.uwo.ca>

On 9/20/2006 11:43 AM, Robert.McGehee at geodecapital.com wrote:
> There seems to be a bug in seq.Date such that it will not allow the user
> to pass in length.out =3D NULL, despite the fact that this is the =
> default
> argument.

Yes, that's a bug: the test is "is.missing", when it should be 
"is.null".  I'll fix it.  Thanks!

Duncan Murdoch

> 
> For example:
>> dt1 <- as.Date("2004-12-31")
>> dt2 <- as.Date("2005-12-31")
>> seq.Date(dt1, dt2, length.out =3D NULL, by =3D "month")
> Error in seq.Date(dt1, dt2, length.out =3D NULL, by =3D "day") :=20
> 	'length.out' must be of length 1
> 
> This might be an issue if I want to wrap seq.Date in another function
> that reports or modifies on length.out. For instance, suppose I want to
> create a simple function that simply reports when length.out is NULL (or
> missing), as below, but otherwise works identically to seq.Date.
> 
> FUN <- function(to, from, length.out =3D NULL, by, ...) {
>     if (is.null(length.out)) cat("length.out is missing\n")
>     seq.Date(to, from, length.out =3D length.out, by =3D by, ...)
> }
> 
>> seq.Date(dt1, dt2, by =3D "month")
>  [1] "2004-12-31" "2005-01-31" "2005-03-03" "2005-03-31" "2005-05-01"
>  [6] "2005-05-31" "2005-07-01" "2005-07-31" "2005-08-31" "2005-10-01"
> [11] "2005-10-31" "2005-12-01" "2005-12-31"
> 
>> FUN(dt1, dt2, by =3D "month")
> length.out is missing
> Error in seq.Date(dt1, dt2, length.out =3D NULL, by =3D "day") :=20
> 	'length.out' must be of length 1
> 
> I believe the patch to fix this error is as follows (on R2.4.0(alpha)
> Revision 39430)
> -   }  else if (!missing(length.out)) {
> +   }  else if (!missing(length.out) && !is.null(length.out)) {
> 
> Another (perhaps better) patch would be to not have NULL be the default
> for length.out.
> 
> HTH,
> Robert
> 
> Robert McGehee
> Quantitative Analyst
> Geode Capital Management, LLC
> 53 State Street, 5th Floor | Boston, MA | 02109
> Tel: 617/392-8396    Fax:617/476-6389
> mailto:robert.mcgehee at geodecapital.com
> 
> 
> 
> This e-mail, and any attachments hereto, are intended for us...{{dropped}}
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



From fparlamis at mac.com  Wed Sep 20 22:38:50 2006
From: fparlamis at mac.com (Parlamis Franklin)
Date: Wed, 20 Sep 2006 10:38:50 -1000
Subject: [Rd] residual '*tmp*' variable after "[<-" error
Message-ID: <736BC96C-5E09-4DD7-AD44-ACB6DB890102@mac.com>

self-sanity check prior to filing a bug report:

attempted replacement that generates an error leaves a '*tmp*'  
variable in the global environment.

test <- 1:10
test[2:4] <- expression(e)
ls()

i've read section 3.4.4 of the "R Language Definition" which  
discusses the mechanism for replacement, and it is not clear to me  
whether this was intended, but i suspect not (to be honest, it's not  
clear to me why the process as described doesn't generate an infinite  
recursion -- perhaps the primitive treats the argument named '*tmp*'  
different than other arguments).  i've also searched the R site, and  
can't find this particular issue discussed.

even though, as below, i am using 2.4.0 alpha, this happens as well  
in 2.3.1.

from my standpoint, desirable behavior would be:

(i) if an error occurs, remove the '*tmp*' variable
(ii) report the error as occurring in the original replacement call  
(rather than the '*tmp*' replacement, which may be confusing to those  
who haven't read the "R Language Definition")

franklin parlamis

 > version
                _
platform       powerpc-apple-darwin8.7.0
arch           powerpc
os             darwin8.7.0
system         powerpc, darwin8.7.0
status         alpha
major          2
minor          4.0
year           2006
month          09
day            06
svn rev        39158
language       R
version.string R version 2.4.0 alpha (2006-09-06 r39158)



From pgilbert at bank-banque-canada.ca  Wed Sep 20 22:37:25 2006
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Wed, 20 Sep 2006 16:37:25 -0400
Subject: [Rd] alpha, portable use
Message-ID: <4511A685.6030509@bank-banque-canada.ca>

When I build one of my packages with alpha from yesterday I am getting

* checking for portable use of $BLAS_LIBS ... WARNING
apparently missing $(FLIBS) in 'PKG_LIBS=$(LAPACK_LIBS) $(BLAS_LIBS)'

Is this something I should worry about?  (Possibly I got this before and 
didn't notice.)

Paul Gilbert
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}



From ripley at stats.ox.ac.uk  Wed Sep 20 23:03:29 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 20 Sep 2006 22:03:29 +0100 (BST)
Subject: [Rd] alpha, portable use
In-Reply-To: <4511A685.6030509@bank-banque-canada.ca>
References: <4511A685.6030509@bank-banque-canada.ca>
Message-ID: <Pine.LNX.4.64.0609202202560.21267@gannet.stats.ox.ac.uk>

On Wed, 20 Sep 2006, Paul Gilbert wrote:

> When I build one of my packages with alpha from yesterday I am getting
>
> * checking for portable use of $BLAS_LIBS ... WARNING
> apparently missing $(FLIBS) in 'PKG_LIBS=$(LAPACK_LIBS) $(BLAS_LIBS)'
>
> Is this something I should worry about?  (Possibly I got this before and
> didn't notice.)

Yes, please do check Writing R Extensions ....

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From ripley at stats.ox.ac.uk  Thu Sep 21 00:10:11 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 20 Sep 2006 23:10:11 +0100 (BST)
Subject: [Rd] residual '*tmp*' variable after "[<-" error
In-Reply-To: <736BC96C-5E09-4DD7-AD44-ACB6DB890102@mac.com>
References: <736BC96C-5E09-4DD7-AD44-ACB6DB890102@mac.com>
Message-ID: <Pine.LNX.4.64.0609202304230.31076@gannet.stats.ox.ac.uk>

On Wed, 20 Sep 2006, Parlamis Franklin wrote:

> self-sanity check prior to filing a bug report:
>
> attempted replacement that generates an error leaves a '*tmp*'
> variable in the global environment.
>
> test <- 1:10
> test[2:4] <- expression(e)
> ls()
>
> i've read section 3.4.4 of the "R Language Definition" which
> discusses the mechanism for replacement, and it is not clear to me
> whether this was intended, but i suspect not (to be honest, it's not
> clear to me why the process as described doesn't generate an infinite
> recursion -- perhaps the primitive treats the argument named '*tmp*'
> different than other arguments).  i've also searched the R site, and
> can't find this particular issue discussed.
>
> even though, as below, i am using 2.4.0 alpha, this happens as well
> in 2.3.1.
>
> from my standpoint, desirable behavior would be:
>
> (i) if an error occurs, remove the '*tmp*' variable

That's a bug: it need a context set to clean up.

> (ii) report the error as occurring in the original replacement call
> (rather than the '*tmp*' replacement, which may be confusing to those
> who haven't read the "R Language Definition")

But by that point the call may have been transformed quite dramatically.
I was going to suggest traceback() would give you a sensible call, but in 
this case it is not doing so: at a quick glance that is also due to no 
context being set.

There is also the question as to whether this should have worked.  It 
probably could be made to do so as

test <- as.expression(test)
test[2:4] <- expression(e)


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From zpzhang at stanfordalumni.org  Thu Sep 21 06:50:49 2006
From: zpzhang at stanfordalumni.org (Zepu Zhang)
Date: Wed, 20 Sep 2006 21:50:49 -0700
Subject: [Rd] A Call for a Smaller R Core Package
Message-ID: <619kiuexx6742S21.1158814249@cmsweb21.cms.usa.net>

(Below is my idea on an issue that has troubled me for a fairly long time. I
hope it's not viewed as trouble making.)

A Call for a Smaller R Core Package

This document suggests downsizing the 'core' package of R
by taking out some specialized functionalities to form
their own packages. I'll use string related functions as examples,
because I happened to be troubled by them today.

1. The core is too big

R is a function rich environment.
However, non-central functions are better organized in specialized packages.
>From time to time I felt the need to go through the core package for a
complete picture of what are there at my disposal,
yet so far I haven't done that.
In the 'R Reference Manual' the core package runs for over 400 pages
with about 400 entries, and mysteriously some functions don't show up
in the TOC, e.g. 'sub'.
In the two-volume reference set printed by Network-Theory,
the core is the entire first book.
In contrast, the 'Intrinsic Functions' chapter of the classic Fortran
reference "Fortran 95/2003 Explained" runs for maybe 30(?) pages.
I flipped through it many times and I can say with confidence,
"OK these are ALL the Fortran intrinsics and I know what they do."
For R, I found it an intimidating task to flip through the 400+ pages core
and retain a clear mind at the end.

Below is a random sample of string related functions in the core package:

agrep
basename
charmatch
chartr
gregexpr
grep
gsub
regex
regexpr
strsplit
strtrim
strwrap
sub

In my opinion, anything that uses regular expressions belongs somewhere else.
Even 'utils' seems to be a better place for random items than the 'core'.

2. Benefits of a smaller core

a) A smaller core will be more carefully studied and better appreciated.

If the R core functions were documented in 100 pages,
I would be a much better R programmer than I am today
because I would have singled out and studied the more fundamental routines
about function calls, etc.

The criteria for a function to be in the core seem to be: 1) fundamental; or
2) very often used.

A smaller core is more stable.

b) A specialized 'string' package makes string related functions much easier
to find.

It could be that I still need all the functions.
But since they are grouped together, it greatly helps learning.
I would be very rarely reinventing the wheel, because
I could quickly get a sweeping view of the dedicated package.

c) It will be easier to enrich string-related functionalities without
perplexing the core.

3. Costs of such re-arrangements

a) To the R development team

(I don't really know.)

For those utility functions that are frequently used in basic functions,
they may well stay in the core.
For those that are not, it may not be too difficult to move them around.
The spin-off package may be always automatically loaded as a basic one,
but as discussed above, a cleaning grouping greatly helps learning
and finding things.

b) To R users

The system (both the core and the specialized package) will be easier to learn
and use.


-- Zepu Zhang, zpzhang at uchicago.edu



From r.hankin at noc.soton.ac.uk  Thu Sep 21 09:05:24 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Thu, 21 Sep 2006 08:05:24 +0100
Subject: [Rd] printing of complex numbers in R-alpha
Message-ID: <0BAEBFBF-7FBC-4349-BDCE-30BAE955E11B@soc.soton.ac.uk>

Hello everyone

I am finding complex numbers to be printed oddly in R-alpha.


 > 1e100+1e100i
[1] 1e+100+1e+100i
 > 1e100 + 1e44i
[1] 1e+100+100000000000000008821361405306422640701865984i
 > dput(1e100+1e44i)
1e+100+100000000000000008821361405306422640701865984i
 >

[same thing at home on a linux box]


The first line is what I would expect, the second and third lines  
aren't:
I would prefer "1e100+1e44i".  Is this possible for  R-2.4.0?


best wishes


rksh




 > R.version
                _
platform       powerpc-apple-darwin8.7.0
arch           powerpc
os             darwin8.7.0
system         powerpc, darwin8.7.0
status         alpha
major          2
minor          4.0
year           2006
month          09
day            15
svn rev        39323
language       R
version.string R version 2.4.0 alpha (2006-09-15 r39323)



--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743



From maechler at stat.math.ethz.ch  Thu Sep 21 09:41:32 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 21 Sep 2006 09:41:32 +0200
Subject: [Rd] S4 generics, modify() generic and modifyList() ...
In-Reply-To: <eb555e660609191348u1310c80r414ab2f0cb4b9fa8@mail.gmail.com>
References: <eb555e660609151222u2f1a7856l6b5f786c8677966@mail.gmail.com>
	<17675.2988.727158.326024@stat.math.ethz.ch>
	<eb555e660609151354t22c68166s4b0144a286c68f50@mail.gmail.com>
	<eb555e660609181500t4f823763t8bdae712333a8e0@mail.gmail.com>
	<971536df0609191311u1dc45bd4w9730b00349826b1@mail.gmail.com>
	<eb555e660609191348u1310c80r414ab2f0cb4b9fa8@mail.gmail.com>
Message-ID: <17682.16940.985939.341850@stat.math.ethz.ch>

>>>>> "DeepS" == Deepayan Sarkar <deepayan.sarkar at gmail.com>
>>>>>     on Tue, 19 Sep 2006 13:48:52 -0700 writes:

    DeepS> On 9/19/06, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
    >> Perhaps it should have another name, be made generic and extended
    >> to functions in which case it would work on the formal arguments.  e.g.
    >> 
    >> read.table.comma <- modify(read.table, list(sep = ","))
    >> 
    >> would return a function that is the same as read.table but
    >> has "," as the default for sep.
    >> 
    >> Python has something like this called partial:
    >> http://docs.python.org/dev/whatsnew/pep-309.html

    DeepS> I have had similar thoughts, and even requested a variant a while
    DeepS> back, with a possible implementation:

    DeepS> https://stat.ethz.ch/pipermail/r-devel/2006-March/036696.html

yes, indeed.

    DeepS> Again, the main question is whether it makes sense to introduce this
    DeepS> in `one of the base packages'.

for some reason I had hasted to port your  modifyList() not only
to R-devel, but also to R-alpha (now "beta").

[So now you, Deepayan, need to upgrade lattice before release in
 order to make the warning disappear].

For the mid to longer term I agree a modify() generic might be
nicer, and the method for "function" may even be more useful
than the one for list  [[and modifyList() would eventually be deprecated]].

OTOH, for new generics, I'd tend to argue we should be nice R-izens
and use S4 rather than S3.  For the time being that
would mean it had to go into the methods package.

Or is now {with the dramatic S4 improvements in 2.4.0} a good
time to start thinking about making "utils" depend on "methods"
or even "better" [ ;-) I know, not all agree here ]
think about a dependency tree
   base -> methods -> [everything else]  for the base packages ?
so we could merge 'stats4' into 'stats' ?

   [[yes, I'm now going into deap-sea position, not putting my head
     out to be shot easily ... ]

Martin



From ripley at stats.ox.ac.uk  Thu Sep 21 10:34:07 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 21 Sep 2006 09:34:07 +0100 (BST)
Subject: [Rd] S4 generics, modify() generic and modifyList() ...
In-Reply-To: <17682.16940.985939.341850@stat.math.ethz.ch>
References: <eb555e660609151222u2f1a7856l6b5f786c8677966@mail.gmail.com>
	<17675.2988.727158.326024@stat.math.ethz.ch>
	<eb555e660609151354t22c68166s4b0144a286c68f50@mail.gmail.com>
	<eb555e660609181500t4f823763t8bdae712333a8e0@mail.gmail.com>
	<971536df0609191311u1dc45bd4w9730b00349826b1@mail.gmail.com>
	<eb555e660609191348u1310c80r414ab2f0cb4b9fa8@mail.gmail.com>
	<17682.16940.985939.341850@stat.math.ethz.ch>
Message-ID: <Pine.LNX.4.64.0609210852320.20269@gannet.stats.ox.ac.uk>

On Thu, 21 Sep 2006, Martin Maechler wrote:

[...]

> For the mid to longer term I agree a modify() generic might be
> nicer, and the method for "function" may even be more useful
> than the one for list  [[and modifyList() would eventually be deprecated]].
>
> OTOH, for new generics, I'd tend to argue we should be nice R-izens
> and use S4 rather than S3.  For the time being that
> would mean it had to go into the methods package.
>
> Or is now {with the dramatic S4 improvements in 2.4.0} a good
> time to start thinking about making "utils" depend on "methods"
> or even "better" [ ;-) I know, not all agree here ]
> think about a dependency tree
>   base -> methods -> [everything else]  for the base packages ?
> so we could merge 'stats4' into 'stats' ?

Please no: that would have a 'dramatic' effect on startup times for the 
'lean and mean' R used as a scripting engine when building R (that often 
uses utils).

Try

gannet% cat > test.R
proc.time()
library(methods)
proc.time()
q()
gannet% env R_DEFAULT_PACKAGES='utils' Rbeta --slave < test.R 
[1] 0.124 0.016 0.125 0.000 0.000
[1] 0.632 0.040 0.657 0.000 0.000

so methods would increase the startup time ca 5x.  There has been no 
discernable progress on the cost of startup of methods when there are no 
S4 generics in the other packages: it is slower than all the other default 
packages put together.  Similarly, there is a considerable cost to S3 
dispatch of having an S4 take-over of S3 generics (especially internal 
generics).

Good 'R-izens' need to consider the environmental impact of their use of 
S4 code.  One thing we may be getting closer to is not making 'methods' a 
default package at all, but loading it only when needed.  (Now S4 objects 
can be identified easliy, that could be checked when one is 
created/loaded.) It is like the on-going debate on 4x4 vehicles (SUVs to 
Americans), which carry a lot of extra weight for off-road features that 
are almost never used.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From r.hankin at noc.soton.ac.uk  Thu Sep 21 11:05:42 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Thu, 21 Sep 2006 10:05:42 +0100
Subject: [Rd] typesetting a matrix in an Rd file
Message-ID: <F3DE250A-1D28-4A16-9A4D-038BB206F4B6@soc.soton.ac.uk>

Hello everybody

I'm trying to write an Rd file so that the resulting LaTeX-ed document
includes a matrix.

Here is the line in question:

\deqn{
   E_\theta\left(
   \begin{array}{cc}
       1 & x\theta\\
       x\theta & x^2\theta^2
       \end{array}\right)
       }{ommitted: see dvi}

which looks OK to me; the contents of the first curly brace
produce the desired matrix in a regular .tex file.

But it doesn't produce the desired matrix when included
in an Rd file: on my system the ampersands show up
literally, and the whole equation is on one line. I
suspect that the backslashes and ampersands are
being escaped somehow, and TeX isn't interpreting
them as desired.

How do I write an Rd file so that the output of R CMD Rd2dvi
includes a nicely typeset matrix?


--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743



From maechler at stat.math.ethz.ch  Thu Sep 21 14:50:15 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 21 Sep 2006 14:50:15 +0200
Subject: [Rd] printing of complex numbers in R-alpha
In-Reply-To: <0BAEBFBF-7FBC-4349-BDCE-30BAE955E11B@soc.soton.ac.uk>
References: <0BAEBFBF-7FBC-4349-BDCE-30BAE955E11B@soc.soton.ac.uk>
Message-ID: <17682.35463.124617.653585@stat.math.ethz.ch>

>>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
>>>>>     on Thu, 21 Sep 2006 08:05:24 +0100 writes:

    Robin> Hello everyone
    Robin> I am finding complex numbers to be printed oddly in R-alpha.


    >> 1e100+1e100i
    Robin> [1] 1e+100+1e+100i
    >> 1e100 + 1e44i
    Robin> [1] 1e+100+100000000000000008821361405306422640701865984i
    >> dput(1e100+1e44i)
    Robin> 1e+100+100000000000000008821361405306422640701865984i
    >> 

ouch, ouch!

    Robin> [same thing at home on a linux box]


    Robin> The first line is what I would expect, the second and third lines  
    Robin> aren't:
    Robin> I would prefer "1e100+1e44i".  Is this possible for  R-2.4.0?

It should.
It's clearly a bug --- the good news being that it's not a new
one: it already happens in 2.2.1 (e.g.)
Hence, no reason *not* to use R-beta!

Martin



From ripley at stats.ox.ac.uk  Thu Sep 21 15:11:35 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 21 Sep 2006 14:11:35 +0100 (BST)
Subject: [Rd] printing of complex numbers in R-alpha
In-Reply-To: <17682.35463.124617.653585@stat.math.ethz.ch>
References: <0BAEBFBF-7FBC-4349-BDCE-30BAE955E11B@soc.soton.ac.uk>
	<17682.35463.124617.653585@stat.math.ethz.ch>
Message-ID: <Pine.LNX.4.64.0609211409540.29357@gannet.stats.ox.ac.uk>

On Thu, 21 Sep 2006, Martin Maechler wrote:

>>>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
>>>>>>     on Thu, 21 Sep 2006 08:05:24 +0100 writes:
>
>    Robin> Hello everyone
>    Robin> I am finding complex numbers to be printed oddly in R-alpha.
>
>
>    >> 1e100+1e100i
>    Robin> [1] 1e+100+1e+100i
>    >> 1e100 + 1e44i
>    Robin> [1] 1e+100+100000000000000008821361405306422640701865984i
>    >> dput(1e100+1e44i)
>    Robin> 1e+100+100000000000000008821361405306422640701865984i
>    >>
>
> ouch, ouch!
>
>    Robin> [same thing at home on a linux box]
>
>
>    Robin> The first line is what I would expect, the second and third lines
>    Robin> aren't:
>    Robin> I would prefer "1e100+1e44i".  Is this possible for  R-2.4.0?
>
> It should.

I think the right answer is 1e100+0i: read what 'digits' means for complex 
numbers.

It's been there since 2.2.0.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From r.hankin at noc.soton.ac.uk  Thu Sep 21 15:46:34 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Thu, 21 Sep 2006 14:46:34 +0100
Subject: [Rd] printing of complex numbers in R-alpha
In-Reply-To: <Pine.LNX.4.64.0609211409540.29357@gannet.stats.ox.ac.uk>
References: <0BAEBFBF-7FBC-4349-BDCE-30BAE955E11B@soc.soton.ac.uk>
	<17682.35463.124617.653585@stat.math.ethz.ch>
	<Pine.LNX.4.64.0609211409540.29357@gannet.stats.ox.ac.uk>
Message-ID: <E01BC4CE-0616-497A-9B1B-53E227A90C53@soc.soton.ac.uk>

Hello

got it:

     o	The printing of complex numbers has changed, handling numbers
	as a whole rather than in two parts.  So both real and
	imaginary parts are shown to the same accuracy, with the
	'digits' parameter referring to the accuracy of the larger
	component, and both components are shown in fixed or
	scientific notation (unless one is entirely zero when it is
	always shown in fixed notation).

[this from the NEWS of R-2.2.0]

I'm struggling to reconcile the final clause of this with:


 > 1e100  + 1i
[1] 1e+100+1i
 > 1e100 + 1e-100i
[1] 1e+100+0i


in both of these cases, the real component is shown in scientific
notation and the imaginary component isn't.

I'm finding the following example confusing too:

 > 1e100 + pi*1i*10^(c(-100,0,1,40,100))
[1] 1e+100+3.1416e-100i 1e+100+ 3.1416e+00i 1e+100+ 3.1416e+01i
[4] 1e+100+ 3.1416e+40i 1e+100+3.1416e+100i
 >



rksh



On 21 Sep 2006, at 14:11, Prof Brian Ripley wrote:

> On Thu, 21 Sep 2006, Martin Maechler wrote:
>
>>>>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
>>>>>>>     on Thu, 21 Sep 2006 08:05:24 +0100 writes:
>>
>>    Robin> Hello everyone
>>    Robin> I am finding complex numbers to be printed oddly in R- 
>> alpha.
>>
>>
>>>> 1e100+1e100i
>>    Robin> [1] 1e+100+1e+100i
>>>> 1e100 + 1e44i
>>    Robin> [1] 1e+100+100000000000000008821361405306422640701865984i
>>>> dput(1e100+1e44i)
>>    Robin> 1e+100+100000000000000008821361405306422640701865984i
>>>>
>>
>> ouch, ouch!
>>
>>    Robin> [same thing at home on a linux box]
>>
>>
>>    Robin> The first line is what I would expect, the second and  
>> third lines
>>    Robin> aren't:
>>    Robin> I would prefer "1e100+1e44i".  Is this possible for   
>> R-2.4.0?
>>
>> It should.
>
> I think the right answer is 1e100+0i: read what 'digits' means for  
> complex
> numbers.
>
> It's been there since 2.2.0.
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743



From jmc at r-project.org  Thu Sep 21 15:54:16 2006
From: jmc at r-project.org (John Chambers)
Date: Thu, 21 Sep 2006 09:54:16 -0400
Subject: [Rd] S4 generics, modify() generic and modifyList() ...
In-Reply-To: <Pine.LNX.4.64.0609210852320.20269@gannet.stats.ox.ac.uk>
References: <eb555e660609151222u2f1a7856l6b5f786c8677966@mail.gmail.com>
	<17675.2988.727158.326024@stat.math.ethz.ch>
	<eb555e660609151354t22c68166s4b0144a286c68f50@mail.gmail.com>
	<eb555e660609181500t4f823763t8bdae712333a8e0@mail.gmail.com>
	<971536df0609191311u1dc45bd4w9730b00349826b1@mail.gmail.com>
	<eb555e660609191348u1310c80r414ab2f0cb4b9fa8@mail.gmail.com>
	<17682.16940.985939.341850@stat.math.ethz.ch>
	<Pine.LNX.4.64.0609210852320.20269@gannet.stats.ox.ac.uk>
Message-ID: <45129988.6070808@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060921/9919e229/attachment-0003.pl 

From xianjun.dong at bccs.uib.no  Thu Sep 21 15:59:07 2006
From: xianjun.dong at bccs.uib.no (xianjun.dong at bccs.uib.no)
Date: Thu, 21 Sep 2006 15:59:07 +0200 (CEST)
Subject: [Rd] Not all functions work in RSPerl package? (PR#9242)
Message-ID: <20060921135907.021884BEB1@slim.kubism.ku.dk>

Hi, 

It looks that not all function in R could be implemented by RSPerl. For
example,  when I call

&R::callWithNames("boxplot", {'', at y1});
or
R::barplot(\@y1);

There would be error:

Error in -0.01 * height : non-numeric argument to binary operator
Caught error in R::call()

The same happened when calling "barplot", but it's ok to call plot.

Is it a bug?

-- 
Xianjun Dong 
PhD Student 
Computational Biology Unit 
Bergen Center for Computational Science 
University of Bergen
H??yteknologisenteret, Thorm??hlensgate 55 
N-5008 Bergen,Norway. 
Webpage: http://www.ii.uib.no/~xianjund/ 
MSN: sterding at hotmail.com
Phone No: +47 - 55584354 (office)
          +47 - 47361688 (mobile)
Fax No: +47 - 55584295



From lobry at biomserv.univ-lyon1.fr  Thu Sep 21 16:08:12 2006
From: lobry at biomserv.univ-lyon1.fr (Jean lobry)
Date: Thu, 21 Sep 2006 16:08:12 +0200
Subject: [Rd] Sweave processes \Sexpr in commented LaTeX source
In-Reply-To: <mailman.7.1158832802.27275.r-devel@r-project.org>
References: <mailman.7.1158832802.27275.r-devel@r-project.org>
Message-ID: <p0600200ac138480b0ace@[134.214.34.142]>

Marc,

>I have a large .Rnw file and was in the process of doing some debugging.
>I had set some R chunks to 'eval=false' in the process. This resulted in
>some R objects not being created that were in turn used in the
>subsequent \Sexpr's.

I have often the same problem, I'm using a construct like :

<<eval=F>>=
x <- rnorm(100)
@

I have \Sexpr{ifelse(exists("x"), length(x), "???")} elements
in vector x.

This works well for me, and you have more control than a global
\SweaveOpts{eval.Sexpr=false} would allow, for instance :

<<TimeConsumingCodeChunk1,eval=F>>=
x <- rnorm(100)
...
@

I have \Sexpr{ifelse(exists("x"), length(x), "Ooops, I forgot
to evaluate TimeConsumingCodeChunk1")} elements in vector x.

Wouldn't it be enough to mention this in Sweave's FAQ ?

Best,

Jean
-- 
Jean R. Lobry            (lobry at biomserv.univ-lyon1.fr)
Laboratoire BBE-CNRS-UMR-5558, Univ. C. Bernard - LYON I,
43 Bd 11/11/1918, F-69622 VILLEURBANNE CEDEX, FRANCE
allo  : +33 472 43 27 56     fax    : +33 472 43 13 88
http://pbil.univ-lyon1.fr/members/lobry/



From friedrich.leisch at stat.uni-muenchen.de  Thu Sep 21 16:40:19 2006
From: friedrich.leisch at stat.uni-muenchen.de (Friedrich Leisch)
Date: Thu, 21 Sep 2006 16:40:19 +0200
Subject: [Rd] Sweave processes \Sexpr in commented LaTeX
	source	(2.3.1patched and 2.4.0)
In-Reply-To: <m2d59q5uwh.fsf@ziti.local>
References: <1158711280.5348.24.camel@localhost.localdomain>
	<17680.58131.594486.582029@celebrian.ci.tuwien.ac.at>
	<x2wt7y261y.fsf@viggo.kubism.ku.dk> <m2psdq7dpy.fsf@ziti.local>
	<b0808fdc0609200947q16f14052o49fb18e62c439439@mail.gmail.com>
	<m2d59q5uwh.fsf@ziti.local>
Message-ID: <17682.42067.760848.723873@celebrian.ci.tuwien.ac.at>

>>>>> On Wed, 20 Sep 2006 10:07:26 -0700,
>>>>> Seth Falcon (SF) wrote:

  > "Antonio, Fabio Di Narzo" <antonio.fabio at gmail.com> writes:
  >> 2006/9/20, Seth Falcon <sfalcon at fhcrc.org>:
  >>> Peter Dalgaard <p.dalgaard at biostat.ku.dk> writes:
  >>> > ..not to mention TeX comments inside Sexpr (e.g. %*%...). Skipping
  >>> > lines with % as the first character might be a viable compromise
  >>> > though.
  >>> 
  >>> +1.  You could probably ignore any lines where the first
  >>> non-whitespace char is '%'.  But if that seems to risky, then only
  >>> recognizing first-char-is-% seems a worthwhile heuristic.
  >>> 
  >>> Another place where this has bitten people is when they do:
  >>> 
  >>> %\usepackage{Sweave}
  >>> 
  >>> Sweave picks that up and doesn't insert the usepackage line itself.
  >> 
  >> I've found that extremely useful for sweaving Stex files which aren't
  >> "master" files (i.e., only files to include in a main latex file).
  >> Inserting '\usepackage{Sweave}' in each would result in a latex error.
  >> So commenting it out is a useful workaround.

  > Commenting it out _and_ having Sweave see it?

Yes, I actually do that quite often, e.g., when I have my own
definitions of the Sinput/Soutput/... environments in the document
preamble and don't want to use any Sweave style file.

Note that we recently had a thread on the \usepackage{Sweave} path
insertion problems in windows and as a result I will stop being
special about it at all, i.e., users will have to put a
\usepackage{Sweave} into their documents, and take care that latex
finds a version of it.

The thread was end of August and I didn't do it for 2.4 because I
didn't want to break all vignettes that close to a release. But I will
do for the 2.5 series once 2.4.0 is released.

Ad evaluation of \Sexpr{}: That can be considered a bug, hence I could
try a fix even in feature freeze. But as I will be offline for a week
starting tomorrow this will also have to wait until the 2.5 series (or
2.4.1, depending on the change).

My favorite would not be a separate option eval.Sexpr but eveluate
only when the global option for eval is true. Then an

	\SweaveOpts{eval=false}

at any place in a document would stop all evalualtions, be it code
chunks (which do not override the default) or Sexpr. If somebody has
good useage for a separate option I could be convinced to have it,
otherwise I'll go for \Sexpr{} listening to the eval option.

Best,
Fritz



From sfalcon at fhcrc.org  Thu Sep 21 16:43:16 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Thu, 21 Sep 2006 07:43:16 -0700
Subject: [Rd] Sweave processes \Sexpr in commented LaTeX source
In-Reply-To: <p0600200ac138480b0ace@[134.214.34.142]> (Jean lobry's message of
	"Thu, 21 Sep 2006 16:08:12 +0200")
References: <mailman.7.1158832802.27275.r-devel@r-project.org>
	<p0600200ac138480b0ace@[134.214.34.142]>
Message-ID: <m2hcz1qnzv.fsf@ziti.local>

[shameless plug]

Jean lobry <lobry at biomserv.univ-lyon1.fr> writes:
> <<TimeConsumingCodeChunk1,eval=F>>=
> x <- rnorm(100)
> ...
> @
>
> I have \Sexpr{ifelse(exists("x"), length(x), "Ooops, I forgot
> to evaluate TimeConsumingCodeChunk1")} elements in vector x.

For the case of TimeConsumingCodeChunks, another solution is the
weaver package that caches the results of such chunks.  So you could
have:

<<TimeConsumingCodeChunk1, cache=TRUE>>=
x <- rnorm(100)
...
@

Then as long as the dependencies of the expressions in
TimeConsumingCodeChunk1 don't change, it won't be recomputed.

Best,

+ seth



From jfox at mcmaster.ca  Thu Sep 21 17:22:17 2006
From: jfox at mcmaster.ca (John Fox)
Date: Thu, 21 Sep 2006 11:22:17 -0400
Subject: [Rd] Package dependencies and imports
Message-ID: <20060921152216.UGBW24981.tomts40-srv.bellnexxia.net@JohnDesktop8300>

Dear list members,

I'm encountering the following problem with package dependencies and
imports: 

The Rcmdr package doesn't declare a formal dependency (via depends or
suggests in the package DESCRIPTION) on the rgl package because the latter
apparently causes problems on some systems. This allows the Rcmdr package to
build and check on systems without rgl present; if rgl isn't present, then
menu items using it are disabled (in the development version of the Rcmdr
package, not installed in the first place). 

If rgl is present, however, the Rcmdr package uses some unexported functions
in it. I've done this via rgl::: to avoid importing from the rgl namespace:
Because rgl isn't declared as a dependency, I can't import its namespace. In
the current R 2.4.0 alpha and R 2.5.0 devel, however, using rgl::: generates
a warning when the package is checked.

Is there a way around this short of literally copying the unexported
functions in rgl that Rcmdr uses?

Thanks,
 John

--------------------------------
John Fox
Department of Sociology
McMaster University
Hamilton, Ontario
Canada L8S 4M4
905-525-9140x23604
http://socserv.mcmaster.ca/jfox



From maechler at stat.math.ethz.ch  Thu Sep 21 17:48:02 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 21 Sep 2006 17:48:02 +0200
Subject: [Rd] Package dependencies and imports
In-Reply-To: <20060921152216.UGBW24981.tomts40-srv.bellnexxia.net@JohnDesktop8300>
References: <20060921152216.UGBW24981.tomts40-srv.bellnexxia.net@JohnDesktop8300>
Message-ID: <17682.46130.408226.90557@stat.math.ethz.ch>

>>>>> "JohnF" == John Fox <jfox at mcmaster.ca>
>>>>>     on Thu, 21 Sep 2006 11:22:17 -0400 writes:

    JohnF> Dear list members,

    JohnF> I'm encountering the following problem with package dependencies and
    JohnF> imports: 

    JohnF> The Rcmdr package doesn't declare a formal dependency
    JohnF> (via depends or suggests in the package DESCRIPTION)
    JohnF> on the rgl package because the latter apparently
    JohnF> causes problems on some systems. This allows the
    JohnF> Rcmdr package to build and check on systems without
    JohnF> rgl present; if rgl isn't present, then menu items
    JohnF> using it are disabled (in the development version of
    JohnF> the Rcmdr package, not installed in the first place).

    JohnF> If rgl is present, however, the Rcmdr package uses
    JohnF> some unexported functions in it. I've done this via
    JohnF> rgl::: to avoid importing from the rgl namespace:
    JohnF> Because rgl isn't declared as a dependency, I can't
    JohnF> import its namespace. In the current R 2.4.0 alpha
    JohnF> and R 2.5.0 devel, however, using rgl::: generates a
    JohnF> warning when the package is checked.

    JohnF> Is there a way around this short of literally copying the unexported
    JohnF> functions in rgl that Rcmdr uses?

I think you should use the new DESCRIPTION field and say
  'Enhances: rgl'

but I haven't checked if this prevents the warning,  though I
think it should..

Regards,
Martin



From mschwartz at mn.rr.com  Thu Sep 21 17:58:08 2006
From: mschwartz at mn.rr.com (Marc Schwartz (via MN))
Date: Thu, 21 Sep 2006 10:58:08 -0500
Subject: [Rd] Sweave processes \Sexpr in commented
	LaTeX	source	(2.3.1patched and 2.4.0)
In-Reply-To: <17682.42067.760848.723873@celebrian.ci.tuwien.ac.at>
References: <1158711280.5348.24.camel@localhost.localdomain>
	<17680.58131.594486.582029@celebrian.ci.tuwien.ac.at>
	<x2wt7y261y.fsf@viggo.kubism.ku.dk> <m2psdq7dpy.fsf@ziti.local>
	<b0808fdc0609200947q16f14052o49fb18e62c439439@mail.gmail.com>
	<m2d59q5uwh.fsf@ziti.local>
	<17682.42067.760848.723873@celebrian.ci.tuwien.ac.at>
Message-ID: <1158854289.3888.60.camel@localhost.localdomain>

On Thu, 2006-09-21 at 16:40 +0200, Friedrich Leisch wrote:
> >>>>> On Wed, 20 Sep 2006 10:07:26 -0700,
> >>>>> Seth Falcon (SF) wrote:
> 
>   > "Antonio, Fabio Di Narzo" <antonio.fabio at gmail.com> writes:
>   >> 2006/9/20, Seth Falcon <sfalcon at fhcrc.org>:
>   >>> Peter Dalgaard <p.dalgaard at biostat.ku.dk> writes:
>   >>> > ..not to mention TeX comments inside Sexpr (e.g. %*%...). Skipping
>   >>> > lines with % as the first character might be a viable compromise
>   >>> > though.
>   >>> 
>   >>> +1.  You could probably ignore any lines where the first
>   >>> non-whitespace char is '%'.  But if that seems to risky, then only
>   >>> recognizing first-char-is-% seems a worthwhile heuristic.
>   >>> 
>   >>> Another place where this has bitten people is when they do:
>   >>> 
>   >>> %\usepackage{Sweave}
>   >>> 
>   >>> Sweave picks that up and doesn't insert the usepackage line itself.
>   >> 
>   >> I've found that extremely useful for sweaving Stex files which aren't
>   >> "master" files (i.e., only files to include in a main latex file).
>   >> Inserting '\usepackage{Sweave}' in each would result in a latex error.
>   >> So commenting it out is a useful workaround.
> 
>   > Commenting it out _and_ having Sweave see it?
> 
> Yes, I actually do that quite often, e.g., when I have my own
> definitions of the Sinput/Soutput/... environments in the document
> preamble and don't want to use any Sweave style file.
> 
> Note that we recently had a thread on the \usepackage{Sweave} path
> insertion problems in windows and as a result I will stop being
> special about it at all, i.e., users will have to put a
> \usepackage{Sweave} into their documents, and take care that latex
> finds a version of it.
> 
> The thread was end of August and I didn't do it for 2.4 because I
> didn't want to break all vignettes that close to a release. But I will
> do for the 2.5 series once 2.4.0 is released.
> 
> Ad evaluation of \Sexpr{}: That can be considered a bug, hence I could
> try a fix even in feature freeze. But as I will be offline for a week
> starting tomorrow this will also have to wait until the 2.5 series (or
> 2.4.1, depending on the change).
> 
> My favorite would not be a separate option eval.Sexpr but eveluate
> only when the global option for eval is true. Then an
> 
> 	\SweaveOpts{eval=false}
> 
> at any place in a document would stop all evalualtions, be it code
> chunks (which do not override the default) or Sexpr. If somebody has
> good useage for a separate option I could be convinced to have it,
> otherwise I'll go for \Sexpr{} listening to the eval option.

Fritz,

I appreciate your consideration of this issue.

I think that your solution using a global evaluation option would be
fine.

Thanks again,

Marc



From joe-byers at utulsa.edu  Thu Sep 21 19:50:19 2006
From: joe-byers at utulsa.edu (Joe Byers)
Date: Thu, 21 Sep 2006 12:50:19 -0500
Subject: [Rd] Help understanding how nls parses the formula argument to
 estimate the model
Message-ID: <eeujbo$ooo$1@sea.gmane.org>

I could use some help understanding how nls parses the formula argument
to a model.frame and estimates the model.  I am trying to utilize the
functionality of the nls formula argument to modify garchFit() to handle
other variables in the mean equation besides just an arma(u,v)
specification.

My nonlinear model is
      y<-nls(t~a*sin(w*2*pi/365*id+p)+b*id+int,data=t1,
	start=list(w=.5,a=.1,p=.5,b=init.y$coef[2],int=init.y$coef[1] ),
	control=list(maxiter=1000000,minFactor=1e-18))
where t is change in daily temperatures, id is just a time trend and the
a*sin is a one year fourier series.

I have tried to debug the nls code using the following code
t1<-data.frame(t=as.vector(x),id=index(x))
data=t1;
formula <- as.formula(t ~ a *sin(w *2* pi/365 * id + p) + b * id + int);
      varNames <- all.vars(formula)
      algorithm<-'default';
      mf <- match.call(definition=nls,expand.dots=FALSE,
      call('nls',formula, data=parent.frame(),start,control = nls.control(),
      algorithm = "default", trace = FALSE,
      subset, weights, na.action, model = FALSE, lower = -Inf,
      upper = Inf));
      mWeights<-F;#missing(weights);
	start=list(w=.5,a=.1,p=.5,b=init.y$coef[2],int=init.y$coef[1] );
      pnames <- names(start);
       varNames <- varNames[is.na(match(varNames, pnames, nomatch = NA))]

	varIndex <- sapply(varNames,
		function(varName, data, respLength) {
          	length(eval(as.name(varName), data))%%respLength == 0},
          	 data, length(eval(formula[[2]], data))
          );
	mf$formula <- as.formula(paste("~", paste(varNames[varIndex],
          collapse = "+")), env = environment(formula));
	mf$start <- NULL;mf$control <- NULL;mf$algorithm <- NULL;
	mf$trace <- NULL;mf$model <- NULL;
      mf$lower <- NULL;mf$upper <- NULL;
      mf[[1]] <- as.name("model.frame");
      mf<-evalq(mf,data);
      n<-nrow(mf)
      mf<-as.list(mf);
      wts <- if (!mWeights)
          model.weights(mf)
      else rep(1, n)
      if (any(wts < 0 | is.na(wts)))
          stop("missing or negative weights not allowed")

      m <- switch(algorithm,
      		plinear = nlsModel.plinear(formula, mf, start, wts),
      		port = nlsModel(formula, mf, start, wts, upper),
      		nlsModel(formula, mf, start, wts));

I am struggling with the environment issues associated with performing
these model.frame operations with the eval functions.

thank you



From mschwartz at mn.rr.com  Thu Sep 21 18:15:13 2006
From: mschwartz at mn.rr.com (Marc Schwartz (via MN))
Date: Thu, 21 Sep 2006 11:15:13 -0500
Subject: [Rd] Sweave processes \Sexpr in commented LaTeX source
In-Reply-To: <p0600200ac138480b0ace@[134.214.34.142]>
References: <mailman.7.1158832802.27275.r-devel@r-project.org>
	<p0600200ac138480b0ace@[134.214.34.142]>
Message-ID: <1158855313.3888.69.camel@localhost.localdomain>

On Thu, 2006-09-21 at 16:08 +0200, Jean lobry wrote:
> Marc,
> 
> >I have a large .Rnw file and was in the process of doing some debugging.
> >I had set some R chunks to 'eval=false' in the process. This resulted in
> >some R objects not being created that were in turn used in the
> >subsequent \Sexpr's.
> 
> I have often the same problem, I'm using a construct like :
> 
> <<eval=F>>=
> x <- rnorm(100)
> @
> 
> I have \Sexpr{ifelse(exists("x"), length(x), "???")} elements
> in vector x.
> 
> This works well for me, and you have more control than a global
> \SweaveOpts{eval.Sexpr=false} would allow, for instance :
> 
> <<TimeConsumingCodeChunk1,eval=F>>=
> x <- rnorm(100)
> ...
> @
> 
> I have \Sexpr{ifelse(exists("x"), length(x), "Ooops, I forgot
> to evaluate TimeConsumingCodeChunk1")} elements in vector x.
> 
> Wouldn't it be enough to mention this in Sweave's FAQ ?

Jean,

Thanks for your comments and approach. I will keep it in mind.

In my case, I had a large flow/org type chart that I created with
pstricks and there were quite a few Sexpr's in the chart code. All of
the Sexpr's were based upon common objects created in preceding R
chunks. I considered that it would be easier to simply treat it all as a
common block that could be commented.

Based upon Fritz' reply today, it seems that we will have an easier
solution coming.

Best regards,

Marc



From sfalcon at fhcrc.org  Thu Sep 21 19:33:06 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Thu, 21 Sep 2006 10:33:06 -0700
Subject: [Rd] Package dependencies and imports
In-Reply-To: <17682.46130.408226.90557@stat.math.ethz.ch> (Martin Maechler's
	message of "Thu, 21 Sep 2006 17:48:02 +0200")
References: <20060921152216.UGBW24981.tomts40-srv.bellnexxia.net@JohnDesktop8300>
	<17682.46130.408226.90557@stat.math.ethz.ch>
Message-ID: <m2ac4tp1kd.fsf@ziti.local>

Martin Maechler <maechler at stat.math.ethz.ch> writes:
>
> I think you should use the new DESCRIPTION field and say
>   'Enhances: rgl'
>
> but I haven't checked if this prevents the warning,  though I
> think it should..

But is Rcmdr enhancing rgl or being enhanced by rgl?  

:-( :-(



From jfox at mcmaster.ca  Thu Sep 21 18:59:12 2006
From: jfox at mcmaster.ca (John Fox)
Date: Thu, 21 Sep 2006 12:59:12 -0400
Subject: [Rd] Package dependencies and imports
In-Reply-To: <17682.46130.408226.90557@stat.math.ethz.ch>
Message-ID: <20060921165910.LCAE29052.tomts13-srv.bellnexxia.net@JohnDesktop8300>

Dear Martin and Kurt,

Adding "Enhances: rgl" to the description file did the trick!

Thank you,
 John

--------------------------------
John Fox
Department of Sociology
McMaster University
Hamilton, Ontario
Canada L8S 4M4
905-525-9140x23604
http://socserv.mcmaster.ca/jfox 
-------------------------------- 

> -----Original Message-----
> From: Martin Maechler [mailto:maechler at stat.math.ethz.ch] 
> Sent: Thursday, September 21, 2006 10:48 AM
> To: John Fox
> Cc: r-devel at stat.math.ethz.ch
> Subject: Re: [Rd] Package dependencies and imports
> 
> >>>>> "JohnF" == John Fox <jfox at mcmaster.ca>
> >>>>>     on Thu, 21 Sep 2006 11:22:17 -0400 writes:
> 
>     JohnF> Dear list members,
> 
>     JohnF> I'm encountering the following problem with 
> package dependencies and
>     JohnF> imports: 
> 
>     JohnF> The Rcmdr package doesn't declare a formal dependency
>     JohnF> (via depends or suggests in the package DESCRIPTION)
>     JohnF> on the rgl package because the latter apparently
>     JohnF> causes problems on some systems. This allows the
>     JohnF> Rcmdr package to build and check on systems without
>     JohnF> rgl present; if rgl isn't present, then menu items
>     JohnF> using it are disabled (in the development version of
>     JohnF> the Rcmdr package, not installed in the first place).
> 
>     JohnF> If rgl is present, however, the Rcmdr package uses
>     JohnF> some unexported functions in it. I've done this via
>     JohnF> rgl::: to avoid importing from the rgl namespace:
>     JohnF> Because rgl isn't declared as a dependency, I can't
>     JohnF> import its namespace. In the current R 2.4.0 alpha
>     JohnF> and R 2.5.0 devel, however, using rgl::: generates a
>     JohnF> warning when the package is checked.
> 
>     JohnF> Is there a way around this short of literally 
> copying the unexported
>     JohnF> functions in rgl that Rcmdr uses?
> 
> I think you should use the new DESCRIPTION field and say
>   'Enhances: rgl'
> 
> but I haven't checked if this prevents the warning,  though I 
> think it should..
> 
> Regards,
> Martin



From ripley at stats.ox.ac.uk  Thu Sep 21 20:38:15 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 21 Sep 2006 19:38:15 +0100 (BST)
Subject: [Rd] Package dependencies and imports
In-Reply-To: <17682.46130.408226.90557@stat.math.ethz.ch>
References: <20060921152216.UGBW24981.tomts40-srv.bellnexxia.net@JohnDesktop8300>
	<17682.46130.408226.90557@stat.math.ethz.ch>
Message-ID: <Pine.LNX.4.64.0609211936460.4448@gannet.stats.ox.ac.uk>

On Thu, 21 Sep 2006, Martin Maechler wrote:

>>>>>> "JohnF" == John Fox <jfox at mcmaster.ca>
>>>>>>     on Thu, 21 Sep 2006 11:22:17 -0400 writes:
>
>    JohnF> Dear list members,
>
>    JohnF> I'm encountering the following problem with package dependencies and
>    JohnF> imports:
>
>    JohnF> The Rcmdr package doesn't declare a formal dependency
>    JohnF> (via depends or suggests in the package DESCRIPTION)
>    JohnF> on the rgl package because the latter apparently
>    JohnF> causes problems on some systems. This allows the
>    JohnF> Rcmdr package to build and check on systems without
>    JohnF> rgl present; if rgl isn't present, then menu items
>    JohnF> using it are disabled (in the development version of
>    JohnF> the Rcmdr package, not installed in the first place).
>
>    JohnF> If rgl is present, however, the Rcmdr package uses
>    JohnF> some unexported functions in it. I've done this via
>    JohnF> rgl::: to avoid importing from the rgl namespace:
>    JohnF> Because rgl isn't declared as a dependency, I can't
>    JohnF> import its namespace. In the current R 2.4.0 alpha
>    JohnF> and R 2.5.0 devel, however, using rgl::: generates a
>    JohnF> warning when the package is checked.
>
>    JohnF> Is there a way around this short of literally copying the unexported
>    JohnF> functions in rgl that Rcmdr uses?
>
> I think you should use the new DESCRIPTION field and say
>  'Enhances: rgl'
>
> but I haven't checked if this prevents the warning,  though I
> think it should..

It does, and Suggests: would also be fine.  install.packages() can be 
tuned as the degree of dependencies which it (optionally) downloads, and 
rgl is available for Windows (where from the menus there is less control).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From fparlamis at mac.com  Thu Sep 21 23:29:38 2006
From: fparlamis at mac.com (Parlamis Franklin)
Date: Thu, 21 Sep 2006 11:29:38 -1000
Subject: [Rd] validity testing as part of '@<-'
Message-ID: <D30BD4FE-2F4A-4C43-BF75-A96E64121CF4@mac.com>

'methods' package feature request / discussion starter:

perhaps a call to 'validObject' should occur at part of any slot  
replacement operation (and the operation not be carried out if it  
would invalidate the object)?  this may prevent the need for  
prophylactic 'validObject' calls in other user-defined functions.  in  
the example below, the slot assignment occurs even though it  
invalidates the object.  the 'show' method then fails somewhat deep  
in a subsequently-called coercion method.

library(Matrix)
test <- Matrix(1:4+0.1, nrow = 2, dimnames = list(letters[1:2],  
LETTERS[1:2]))
test at Dimnames <- list(1:100)
test

direct slot access (without a validity check) seems an easily  
accessible loophole to S4 object "guarantees".

franklin parlamis



From murdoch at stats.uwo.ca  Fri Sep 22 01:21:46 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 21 Sep 2006 19:21:46 -0400
Subject: [Rd] validity testing as part of '@<-'
In-Reply-To: <D30BD4FE-2F4A-4C43-BF75-A96E64121CF4@mac.com>
References: <D30BD4FE-2F4A-4C43-BF75-A96E64121CF4@mac.com>
Message-ID: <45131E8A.5060903@stats.uwo.ca>

On 9/21/2006 5:29 PM, Parlamis Franklin wrote:
> 'methods' package feature request / discussion starter:
> 
> perhaps a call to 'validObject' should occur at part of any slot  
> replacement operation (and the operation not be carried out if it  
> would invalidate the object)?  this may prevent the need for  
> prophylactic 'validObject' calls in other user-defined functions.  in  
> the example below, the slot assignment occurs even though it  
> invalidates the object.  the 'show' method then fails somewhat deep  
> in a subsequently-called coercion method.
> 
> library(Matrix)
> test <- Matrix(1:4+0.1, nrow = 2, dimnames = list(letters[1:2],  
> LETTERS[1:2]))
> test at Dimnames <- list(1:100)
> test
> 
> direct slot access (without a validity check) seems an easily  
> accessible loophole to S4 object "guarantees".

Often changing a single slot puts the object into a temporarily invalid 
state; others need to be changed consistently before it could pass the 
validity test.

Perhaps you could handle this case by wrapping all the calls in some 
sort of wrapper, e.g.

atomic( {obj at slot1 <- 1
          obj at slot2 <- 2 })

but requiring that would break tons of existing code, and turning on 
validObject tests everywhere would slow things down a lot.  Isn't it 
easier to just sprinkle a few more validObject() calls into your code?

Duncan Murdoch



From byron.ellis at gmail.com  Fri Sep 22 02:35:07 2006
From: byron.ellis at gmail.com (Byron Ellis)
Date: Thu, 21 Sep 2006 17:35:07 -0700
Subject: [Rd] validity testing as part of '@<-'
In-Reply-To: <45131E8A.5060903@stats.uwo.ca>
References: <D30BD4FE-2F4A-4C43-BF75-A96E64121CF4@mac.com>
	<45131E8A.5060903@stats.uwo.ca>
Message-ID: <7098abec0609211735v220630fh2a5d770af5fe87a4@mail.gmail.com>

It also wouldn't cover objects constructed by external functions (a
lot of my code produces these creatures).


On 9/21/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 9/21/2006 5:29 PM, Parlamis Franklin wrote:
> > 'methods' package feature request / discussion starter:
> >
> > perhaps a call to 'validObject' should occur at part of any slot
> > replacement operation (and the operation not be carried out if it
> > would invalidate the object)?  this may prevent the need for
> > prophylactic 'validObject' calls in other user-defined functions.  in
> > the example below, the slot assignment occurs even though it
> > invalidates the object.  the 'show' method then fails somewhat deep
> > in a subsequently-called coercion method.
> >
> > library(Matrix)
> > test <- Matrix(1:4+0.1, nrow = 2, dimnames = list(letters[1:2],
> > LETTERS[1:2]))
> > test at Dimnames <- list(1:100)
> > test
> >
> > direct slot access (without a validity check) seems an easily
> > accessible loophole to S4 object "guarantees".
>
> Often changing a single slot puts the object into a temporarily invalid
> state; others need to be changed consistently before it could pass the
> validity test.
>
> Perhaps you could handle this case by wrapping all the calls in some
> sort of wrapper, e.g.
>
> atomic( {obj at slot1 <- 1
>           obj at slot2 <- 2 })
>
> but requiring that would break tons of existing code, and turning on
> validObject tests everywhere would slow things down a lot.  Isn't it
> easier to just sprinkle a few more validObject() calls into your code?
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Byron Ellis (byron.ellis at gmail.com)
"Oook" -- The Librarian



From sfalcon at fhcrc.org  Fri Sep 22 06:52:00 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Thu, 21 Sep 2006 21:52:00 -0700
Subject: [Rd] Possible bug in base::namespaceImportFrom?
Message-ID: <m2bqp8mrkf.fsf@ziti.local>

Hi,

namespaceImportFrom in base/R/namespace.R has the following:

       fdef <- methods:::getGeneric(genName, impenv)

The definition of getGeneric is in methods/R/RMethodUtils.R starts
with:

    getGeneric <-
      ## return the definition of the function named f as a generic.
      ##
      ## If there is no definition, throws an error or returns
      ## NULL according to the value of mustFind.
      function(f, mustFind = FALSE, where = .genEnv(f, topenv(parent.frame()), package),
               package = "")

I think the call to getGeneric in namespaceImportFrom should use named
arguments because impenv, an environment, will be assigned to the
mustFind arg which is most likely not desired.

An example where this seems to show up is in the check reports for
GOstats:

   http://bioconductor.org/checkResults/1.9/gopher5-GOstats-checksrc.html

Here's the snip from the check output (the results may have been
updated in the meantime):

    * checking whether the name space can be loaded with stated dependencies ... WARNING
    Loading required package: methods
    Error in if (mustFind) stop(gettextf("no generic function found for \"%s\"",  : 
    	argument is not interpretable as logical
    In addition: Warning message:
    the condition has length > 1 and only the first element will be used in: if (mustFind) stop(gettextf("no generic function found for \"%s\"",  
    Execution halted

I'm having trouble reproducing it on my local system, but thought I
would bring it to the team's attention.

Best,

+ seth



From ripley at stats.ox.ac.uk  Fri Sep 22 07:45:30 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 22 Sep 2006 06:45:30 +0100 (BST)
Subject: [Rd] residual '*tmp*' variable after "[<-" error
In-Reply-To: <Pine.LNX.4.64.0609202304230.31076@gannet.stats.ox.ac.uk>
References: <736BC96C-5E09-4DD7-AD44-ACB6DB890102@mac.com>
	<Pine.LNX.4.64.0609202304230.31076@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0609220636560.10307@gannet.stats.ox.ac.uk>

On Wed, 20 Sep 2006, Prof Brian Ripley wrote:

> On Wed, 20 Sep 2006, Parlamis Franklin wrote:
>
>> self-sanity check prior to filing a bug report:
>> 
>> attempted replacement that generates an error leaves a '*tmp*'
>> variable in the global environment.
>> 
>> test <- 1:10
>> test[2:4] <- expression(e)
>> ls()
>> 
>> i've read section 3.4.4 of the "R Language Definition" which
>> discusses the mechanism for replacement, and it is not clear to me
>> whether this was intended, but i suspect not (to be honest, it's not
>> clear to me why the process as described doesn't generate an infinite
>> recursion -- perhaps the primitive treats the argument named '*tmp*'
>> different than other arguments).  i've also searched the R site, and
>> can't find this particular issue discussed.
>> 
>> even though, as below, i am using 2.4.0 alpha, this happens as well
>> in 2.3.1.
>> 
>> from my standpoint, desirable behavior would be:
>> 
>> (i) if an error occurs, remove the '*tmp*' variable
>
> That's a bug: it need a context set to clean up.

Fixed in 2.4.0

>> (ii) report the error as occurring in the original replacement call
>> (rather than the '*tmp*' replacement, which may be confusing to those
>> who haven't read the "R Language Definition")
>
> But by that point the call may have been transformed quite dramatically.
> I was going to suggest traceback() would give you a sensible call, but in 
> this case it is not doing so: at a quick glance that is also due to no 
> context being set.

That was true for some of the subassignment error messages, but not this 
one: it depended on whether error() or errorcall() was used.  Since it 
potentially changes error messages in package checking, I have tidied this 
up for 2.5.0 only.

> There is also the question as to whether this should have worked.  It 
> probably could be made to do so as
>
> test <- as.expression(test)
> test[2:4] <- expression(e)

Yes, this was just some missing cases in subassign.c which I have added 
for 2.5.0.  Here is a related case in R-devel:

> test <- 1:10
> try(test[2:4] <- ls) # fails
Error in test[2:4] <- ls : incompatible types (from closure to integer) in 
subassignment type fix

Compare 2.4.0 beta:

> test <- 1:10
> try(test[2:4] <- ls) # fails
Error in `[<-`(`*tmp*`, 2:4, value = function (name, pos = -1, envir = 
as.environment(pos),  :
         incompatible types (from closure to integer) in subassignment type 
fix


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From maechler at stat.math.ethz.ch  Fri Sep 22 09:54:54 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 22 Sep 2006 09:54:54 +0200
Subject: [Rd] Possible bug in base::namespaceImportFrom?
In-Reply-To: <m2bqp8mrkf.fsf@ziti.local>
References: <m2bqp8mrkf.fsf@ziti.local>
Message-ID: <17683.38606.476190.127928@stat.math.ethz.ch>

>>>>> "Seth" == Seth Falcon <sfalcon at fhcrc.org>
>>>>>     on Thu, 21 Sep 2006 21:52:00 -0700 writes:

    Seth> Hi, namespaceImportFrom in base/R/namespace.R has the
    Seth> following:

    Seth>        fdef <- methods:::getGeneric(genName, impenv)

    Seth> The definition of getGeneric is in
    Seth> methods/R/RMethodUtils.R starts with:

    Seth>     getGeneric <- 
    ......
    Seth>  function(f, mustFind = FALSE, where = .........)

    Seth> I think the call to getGeneric in namespaceImportFrom
    Seth> should use named arguments because impenv, an
    Seth> environment, will be assigned to the mustFind arg
    Seth> which is most likely not desired.

Indeed. Well spotted, Seth!
Fixed and committed for R-devel and R-beta.

Martin



From maechler at stat.math.ethz.ch  Fri Sep 22 10:00:43 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 22 Sep 2006 10:00:43 +0200
Subject: [Rd] Package dependencies and imports
In-Reply-To: <m2ac4tp1kd.fsf@ziti.local>
References: <20060921152216.UGBW24981.tomts40-srv.bellnexxia.net@JohnDesktop8300>
	<17682.46130.408226.90557@stat.math.ethz.ch>
	<m2ac4tp1kd.fsf@ziti.local>
Message-ID: <17683.38955.494963.729620@stat.math.ethz.ch>

>>>>> "Seth" == Seth Falcon <sfalcon at fhcrc.org>
>>>>>     on Thu, 21 Sep 2006 10:33:06 -0700 writes:

    Seth> Martin Maechler <maechler at stat.math.ethz.ch> writes:
    >>  I think you should use the new DESCRIPTION field and say
    >> 'Enhances: rgl'
    >> 
    >> but I haven't checked if this prevents the warning,
    >> though I think it should..

    Seth> But is Rcmdr enhancing rgl or being enhanced by rgl?

    Seth> :-( :-(

I think this distinction is not so easily made on a general level.
I'd say an argument for how you can (should?) think about this
is the following abstraction:

 There are two packages, A and B. 
 A's DESCRIPTION has 'Enhances: B'.
 When B is there, A provides extra features.
 In one sense, this always enhances B ("enhance" in the usual
 English meaning), since B's area of application has been
 enlarged by code in A.

Martin



From ripley at stats.ox.ac.uk  Fri Sep 22 10:54:48 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 22 Sep 2006 09:54:48 +0100 (BST)
Subject: [Rd] Package dependencies and imports
In-Reply-To: <17683.38955.494963.729620@stat.math.ethz.ch>
References: <20060921152216.UGBW24981.tomts40-srv.bellnexxia.net@JohnDesktop8300>
	<17682.46130.408226.90557@stat.math.ethz.ch>
	<m2ac4tp1kd.fsf@ziti.local>
	<17683.38955.494963.729620@stat.math.ethz.ch>
Message-ID: <Pine.LNX.4.64.0609220950380.7482@gannet.stats.ox.ac.uk>

On Fri, 22 Sep 2006, Martin Maechler wrote:

>>>>>> "Seth" == Seth Falcon <sfalcon at fhcrc.org>
>>>>>>     on Thu, 21 Sep 2006 10:33:06 -0700 writes:
>
>    Seth> Martin Maechler <maechler at stat.math.ethz.ch> writes:
>    >>  I think you should use the new DESCRIPTION field and say
>    >> 'Enhances: rgl'
>    >>
>    >> but I haven't checked if this prevents the warning,
>    >> though I think it should..
>
>    Seth> But is Rcmdr enhancing rgl or being enhanced by rgl?
>
>    Seth> :-( :-(
>
> I think this distinction is not so easily made on a general level.
> I'd say an argument for how you can (should?) think about this
> is the following abstraction:
>
> There are two packages, A and B.
> A's DESCRIPTION has 'Enhances: B'.
> When B is there, A provides extra features.
> In one sense, this always enhances B ("enhance" in the usual
> English meaning), since B's area of application has been
> enlarged by code in A.

Yes, but that is just as true of the raft of packages that Rcmdr has in 
'Suggests'.  I suggested to John, and still think, that 'Suggests: rgl' is 
right.  Rcmdr will work without it, but works better with it and so if you 
are installing Rcmdr you would like to install rgl as well (but it fails 
to install it would not be a major loss).


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From ripley at stats.ox.ac.uk  Fri Sep 22 12:52:50 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 22 Sep 2006 11:52:50 +0100 (BST)
Subject: [Rd] printing of complex numbers in R-alpha
In-Reply-To: <E01BC4CE-0616-497A-9B1B-53E227A90C53@soc.soton.ac.uk>
References: <0BAEBFBF-7FBC-4349-BDCE-30BAE955E11B@soc.soton.ac.uk>
	<17682.35463.124617.653585@stat.math.ethz.ch>
	<Pine.LNX.4.64.0609211409540.29357@gannet.stats.ox.ac.uk>
	<E01BC4CE-0616-497A-9B1B-53E227A90C53@soc.soton.ac.uk>
Message-ID: <Pine.LNX.4.64.0609221143050.1704@gannet.stats.ox.ac.uk>

On Thu, 21 Sep 2006, Robin Hankin wrote:

> Hello
>
> got it:
>
>   o	The printing of complex numbers has changed, handling numbers
> 	as a whole rather than in two parts.  So both real and
> 	imaginary parts are shown to the same accuracy, with the
> 	'digits' parameter referring to the accuracy of the larger
> 	component, and both components are shown in fixed or
> 	scientific notation (unless one is entirely zero when it is
> 	always shown in fixed notation).
>
> [this from the NEWS of R-2.2.0]
>
> I'm struggling to reconcile the final clause of this with:
>
>
>> 1e100  + 1i
> [1] 1e+100+1i
>> 1e100 + 1e-100i
> [1] 1e+100+0i
>
>
> in both of these cases, the real component is shown in scientific
> notation and the imaginary component isn't.
>
> I'm finding the following example confusing too:
>
>> 1e100 + pi*1i*10^(c(-100,0,1,40,100))
> [1] 1e+100+3.1416e-100i 1e+100+ 3.1416e+00i 1e+100+ 3.1416e+01i
> [4] 1e+100+ 3.1416e+40i 1e+100+3.1416e+100i

Yes, there is a bug here, but I think only for cases where what is printed 
should be zero, that is for complex numbers with very different 
magnitudes of real and imaginary parts.  A better version would be

> 1e100  + 1i
[1] 1e+100+0e+00i
> 1e100 + 1e-100i
[1] 1e+100+0e+00i
> 1e100 + pi*1i*10^(c(-100,0,1,40,100))
[1] 1e+100+ 0.000000e+00i 1e+100+ 0.000000e+00i 1e+100+ 0.000000e+00i
[4] 1e+100+ 0.000000e+00i 1e+100+3.141593e+100i
> 1e50 + c(0, 1, 1e48)*1i
[1] 1e+50+0e+00i 1e+50+0e+00i 1e+50+1e+48i
> 1e50 + pi^-(1:5)*1e46*1i
[1] 1e+50+3.2e+45i 1e+50+1.0e+45i 1e+50+3.2e+44i 1e+50+1.0e+44i 1e+50+0.0e+00i

which is what R-devel now gives.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From jfox at mcmaster.ca  Fri Sep 22 14:47:36 2006
From: jfox at mcmaster.ca (John Fox)
Date: Fri, 22 Sep 2006 08:47:36 -0400
Subject: [Rd] Package dependencies and imports
In-Reply-To: <Pine.LNX.4.64.0609220950380.7482@gannet.stats.ox.ac.uk>
Message-ID: <20060922124734.VAJP29052.tomts13-srv.bellnexxia.net@JohnDesktop8300>

Dear Brian,

--------------------------------
John Fox
Department of Sociology
McMaster University
Hamilton, Ontario
Canada L8S 4M4
905-525-9140x23604
http://socserv.mcmaster.ca/jfox 
-------------------------------- 

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Prof Brian Ripley
> Sent: Friday, September 22, 2006 3:55 AM
> To: Martin Maechler
> Cc: r-devel at stat.math.ethz.ch
> Subject: Re: [Rd] Package dependencies and imports
> 
> On Fri, 22 Sep 2006, Martin Maechler wrote:
> 
> >>>>>> "Seth" == Seth Falcon <sfalcon at fhcrc.org>
> >>>>>>     on Thu, 21 Sep 2006 10:33:06 -0700 writes:
> >
> >    Seth> Martin Maechler <maechler at stat.math.ethz.ch> writes:
> >    >>  I think you should use the new DESCRIPTION field and say
> >    >> 'Enhances: rgl'
> >    >>
> >    >> but I haven't checked if this prevents the warning,
> >    >> though I think it should..
> >
> >    Seth> But is Rcmdr enhancing rgl or being enhanced by rgl?
> >
> >    Seth> :-( :-(
> >
> > I think this distinction is not so easily made on a general level.
> > I'd say an argument for how you can (should?) think about 
> this is the 
> > following abstraction:
> >
> > There are two packages, A and B.
> > A's DESCRIPTION has 'Enhances: B'.
> > When B is there, A provides extra features.
> > In one sense, this always enhances B ("enhance" in the 
> usual English 
> > meaning), since B's area of application has been enlarged 
> by code in 
> > A.
>
> Yes, but that is just as true of the raft of packages that 
> Rcmdr has in 'Suggests'.  I suggested to John, and still 
> think, that 'Suggests: rgl' is right.  Rcmdr will work 
> without it, but works better with it and so if you are 
> installing Rcmdr you would like to install rgl as well (but 
> it fails to install it would not be a major loss).
> 

Although I may have lost track of the exact sequence, I believe that I
originally had rgl under Suggests:, but when rgl is absent from a system,
that causes Rcmdr to fail R CMD check. I'd prefer to have rgl under
Suggests:, since then I wouldn't have to treat it as a special case and it
would be installed automatically by install.packages("Rcmdr",
dependencies=TRUE).

Regards,
 John



From yma at biostat.bsc.gwu.edu  Fri Sep 22 16:43:13 2006
From: yma at biostat.bsc.gwu.edu (yma at biostat.bsc.gwu.edu)
Date: Fri, 22 Sep 2006 16:43:13 +0200 (CEST)
Subject: [Rd] bug in function rpart (PR#9245)
Message-ID: <20060922144313.529874BEBB@slim.kubism.ku.dk>

Full_Name: Yong Ma
Version: R 2.3.1
OS: Windows 2000
Submission from: (NULL) (128.164.162.1)


I have a data set containing 3000 observations. while I was trying to build a
survival tree using the function rpart, I kept getting the following error
message.
>tree<-rpart(coxph(Surv(diabv, diabf) ~ weight, data = sgotdat)) 
 Error in "$<-.data.frame"(`*tmp*`, "yval2", value = c(1, 638)) : 
        replacement has 2 rows, data has 1
It was confusing to me because I was able to use the coxph function on the same
data set with no problem at all. So I googled the internet and found some help
from the following link.

http://tolstoy.newcastle.edu.au/R/devel/05/04/0598.html

It suggested that the problem has to do with the length of the data. So I tried
a subset of my original data containing 2500 observations and BINGO it worked! 

However, I need to run the analysis on the complete data set and the patch
proposed by Andy is not clear to me how to implement. Please fix the bug
systematically.



From jmacdon at med.umich.edu  Fri Sep 22 17:28:48 2006
From: jmacdon at med.umich.edu (James W. MacDonald)
Date: Fri, 22 Sep 2006 11:28:48 -0400
Subject: [Rd] R CMD build question
Message-ID: <45140130.9000306@med.umich.edu>

On Solaris when my package is built, I get the following result:

creating vignettes ...Segmentation Fault - core dumped
OK

My question isn't why I get a segfault, but why does build return an OK 
after such an inauspicious event? Is build only supposed to error out if 
something more central to the package is off?

R CMD check does issue a warning that the vignette is missing, so maybe 
that is the intended result.

Best,

Jim




-- 
James W. MacDonald, M.S.
Biostatistician
Affymetrix and cDNA Microarray Core
University of Michigan Cancer Center
1500 E. Medical Center Drive
7410 CCGC
Ann Arbor MI 48109
734-647-5623


**********************************************************
Electronic Mail is not secure, may not be read every day, and should not be used for urgent or sensitive issues.



From maechler at stat.math.ethz.ch  Fri Sep 22 18:33:35 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 22 Sep 2006 18:33:35 +0200
Subject: [Rd] R CMD build question
In-Reply-To: <45140130.9000306@med.umich.edu>
References: <45140130.9000306@med.umich.edu>
Message-ID: <17684.4191.701387.803678@stat.math.ethz.ch>

>>>>> "JimMcD" == James W MacDonald <jmacdon at med.umich.edu>
>>>>>     on Fri, 22 Sep 2006 11:28:48 -0400 writes:

    JimMcD> On Solaris when my package is built, I get the following result:

I don't think this is bound to Solaris at all.

    JimMcD> creating vignettes ...Segmentation Fault - core dumped
    JimMcD> OK

    JimMcD> My question isn't why I get a segfault, but why does
    JimMcD> build return an OK after such an inauspicious event?
    JimMcD> Is build only supposed to error out if something
    JimMcD> more central to the package is off?

    JimMcD> R CMD check does issue a warning that the vignette
    JimMcD> is missing, so maybe that is the intended result.

I have been puzzled recently by similar behavior, and I think
that current behavior is not satisfactory.
IIRC, I even got
--------------------------      
creating vignettes ... OK
--------------------------      
But from the 3 vignettes, the 2nd one gave an error (in R code),
and consequently only the pdf of the 1st vignette had been built  --- all
completely silently until you "R CMD check" the built tar file
get the warning about missing pdf.

I only did not "complain" because people could have pointed out to
me that I could fix the problem myself .. :-\

Martin



From ripley at stats.ox.ac.uk  Fri Sep 22 18:45:30 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 22 Sep 2006 17:45:30 +0100 (BST)
Subject: [Rd] bug in function rpart (PR#9245)
In-Reply-To: <20060922144313.529874BEBB@slim.kubism.ku.dk>
References: <20060922144313.529874BEBB@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0609221743130.23969@gannet.stats.ox.ac.uk>

You have not given a reproducible example, and you are specifically asked 
not to use R-bugs for contributed packages.

Unless you are able to produce a reproducible example and send it to me as 
maintainer, there is nothing I can do, not even to know if you are using 
rpart correctly.

Please do study the FAQ and posting guide.

On Fri, 22 Sep 2006, yma at biostat.bsc.gwu.edu wrote:

> Full_Name: Yong Ma
> Version: R 2.3.1
> OS: Windows 2000
> Submission from: (NULL) (128.164.162.1)
>
>
> I have a data set containing 3000 observations. while I was trying to build a
> survival tree using the function rpart, I kept getting the following error
> message.
>> tree<-rpart(coxph(Surv(diabv, diabf) ~ weight, data = sgotdat))
> Error in "$<-.data.frame"(`*tmp*`, "yval2", value = c(1, 638)) :
>        replacement has 2 rows, data has 1
> It was confusing to me because I was able to use the coxph function on the same
> data set with no problem at all. So I googled the internet and found some help
> from the following link.
>
> http://tolstoy.newcastle.edu.au/R/devel/05/04/0598.html
>
> It suggested that the problem has to do with the length of the data. So I tried
> a subset of my original data containing 2500 observations and BINGO it worked!
>
> However, I need to run the analysis on the complete data set and the patch
> proposed by Andy is not clear to me how to implement. Please fix the bug
> systematically.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From dsamperi at DecisionSynergy.com  Fri Sep 22 20:07:19 2006
From: dsamperi at DecisionSynergy.com (Dominick Samperi)
Date: Fri, 22 Sep 2006 14:07:19 -0400
Subject: [Rd] NAMESPACE
Message-ID: <45142657.9010309@DecisionSynergy.com>

Hello,

I just tried to use NAMESPACE to prevent name conflicts between
packages and it appears that once a name is exported it will clash
with the same name if it is exported from another package, in
particular, if that other package does not use NAMESPACE.

Is there a way to "export" a name so that the current package
user can see it, but other packages cannot see it? My working
assumption is that this is not possible, so I use a prefix like
the package name to keep function names "local."

Thanks,
ds



From ligges at statistik.uni-dortmund.de  Fri Sep 22 20:23:24 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Fri, 22 Sep 2006 20:23:24 +0200
Subject: [Rd] NAMESPACE
In-Reply-To: <45142657.9010309@DecisionSynergy.com>
References: <45142657.9010309@DecisionSynergy.com>
Message-ID: <45142A1C.8050206@statistik.uni-dortmund.de>



Dominick Samperi wrote:
> Hello,
> 
> I just tried to use NAMESPACE to prevent name conflicts between
> packages and it appears that once a name is exported it will clash
> with the same name if it is exported from another package, in
> particular, if that other package does not use NAMESPACE.
> 
> Is there a way to "export" a name so that the current package
> user can see it, but other packages cannot see it? My working
> assumption is that this is not possible, so I use a prefix like
> the package name to keep function names "local."

Your assumption is correct.

Uwe Ligges

> Thanks,
> ds
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



From murdoch at stats.uwo.ca  Fri Sep 22 20:29:53 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 22 Sep 2006 14:29:53 -0400
Subject: [Rd] NAMESPACE
In-Reply-To: <45142657.9010309@DecisionSynergy.com>
References: <45142657.9010309@DecisionSynergy.com>
Message-ID: <45142BA1.80506@stats.uwo.ca>

On 9/22/2006 2:07 PM, Dominick Samperi wrote:
> Hello,
> 
> I just tried to use NAMESPACE to prevent name conflicts between
> packages and it appears that once a name is exported it will clash
> with the same name if it is exported from another package, in
> particular, if that other package does not use NAMESPACE.
> 
> Is there a way to "export" a name so that the current package
> user can see it, but other packages cannot see it? My working
> assumption is that this is not possible, so I use a prefix like
> the package name to keep function names "local."

I don't think so.  Packages without namespaces start their search for 
names in the global environment, i.e. they see what a user sees.  This 
makes them very fragile, and there's not much you can do about that, 
other than encouraging the author to bite the bullet and install a 
namespace.

Duncan Murdoch



From hb at stat.berkeley.edu  Fri Sep 22 23:20:40 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Fri, 22 Sep 2006 14:20:40 -0700
Subject: [Rd] Parsing of 10xff
Message-ID: <59d7961d0609221420u40b322f8gbb54816714983f21@mail.gmail.com>

Is the following an error in the parser?

> 10xff
[1] 10


/Henrik



From fparlamis at mac.com  Fri Sep 22 23:43:36 2006
From: fparlamis at mac.com (Parlamis Franklin)
Date: Fri, 22 Sep 2006 11:43:36 -1000
Subject: [Rd] validity testing as part of '@<-'
In-Reply-To: <7098abec0609211735v220630fh2a5d770af5fe87a4@mail.gmail.com>
References: <D30BD4FE-2F4A-4C43-BF75-A96E64121CF4@mac.com>
	<45131E8A.5060903@stats.uwo.ca>
	<7098abec0609211735v220630fh2a5d770af5fe87a4@mail.gmail.com>
Message-ID: <F3777624-FBC8-456E-9977-C9E2C1A86456@mac.com>

all those points are good ones, i just wonder what happens to S4  
"guarantees" when invalid objects are allowed to exist.  one of the  
advantages of methods, as i understand, is that they can be written  
with absolute confidence about what is being passed to them, and thus  
do not need to contemplate a bunch of different possibilities (and as  
a result can be terse and stylized).  it seems if you really want  
bulletproof code, you have to make validObject the first call in any  
method definition to which an object with a validity method is being  
passed (and which relies on receiving a valid object).  i am not sure  
whether the time spent in those validObject calls is less than the  
time that might be spent in enforcing validity checks on all possible  
object mutations.

at any rate, i am certainly one of the less experienced people on  
this mailing list, so i will not shake the tree too hard, because i  
probably don't appreciate the sacrifices that might be required.   
just thought i'd toss it out there.

fp

On Sep 21, 2006, at 2:35 PM, Byron Ellis wrote:

> It also wouldn't cover objects constructed by external functions (a
> lot of my code produces these creatures).
>
>
> On 9/21/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>> On 9/21/2006 5:29 PM, Parlamis Franklin wrote:
>> > 'methods' package feature request / discussion starter:
>> >
>> > perhaps a call to 'validObject' should occur at part of any slot
>> > replacement operation (and the operation not be carried out if it
>> > would invalidate the object)?  this may prevent the need for
>> > prophylactic 'validObject' calls in other user-defined  
>> functions.  in
>> > the example below, the slot assignment occurs even though it
>> > invalidates the object.  the 'show' method then fails somewhat deep
>> > in a subsequently-called coercion method.
>> >
>> > library(Matrix)
>> > test <- Matrix(1:4+0.1, nrow = 2, dimnames = list(letters[1:2],
>> > LETTERS[1:2]))
>> > test at Dimnames <- list(1:100)
>> > test
>> >
>> > direct slot access (without a validity check) seems an easily
>> > accessible loophole to S4 object "guarantees".
>>
>> Often changing a single slot puts the object into a temporarily  
>> invalid
>> state; others need to be changed consistently before it could pass  
>> the
>> validity test.
>>
>> Perhaps you could handle this case by wrapping all the calls in some
>> sort of wrapper, e.g.
>>
>> atomic( {obj at slot1 <- 1
>>           obj at slot2 <- 2 })
>>
>> but requiring that would break tons of existing code, and turning on
>> validObject tests everywhere would slow things down a lot.  Isn't it
>> easier to just sprinkle a few more validObject() calls into your  
>> code?
>>
>> Duncan Murdoch
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
> -- 
> Byron Ellis (byron.ellis at gmail.com)
> "Oook" -- The Librarian



From tlumley at u.washington.edu  Sat Sep 23 01:04:54 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Fri, 22 Sep 2006 16:04:54 -0700 (PDT)
Subject: [Rd] validity testing as part of '@<-'
In-Reply-To: <F3777624-FBC8-456E-9977-C9E2C1A86456@mac.com>
References: <D30BD4FE-2F4A-4C43-BF75-A96E64121CF4@mac.com>
	<45131E8A.5060903@stats.uwo.ca>
	<7098abec0609211735v220630fh2a5d770af5fe87a4@mail.gmail.com>
	<F3777624-FBC8-456E-9977-C9E2C1A86456@mac.com>
Message-ID: <Pine.LNX.4.64.0609221547270.24563@homer22.u.washington.edu>

On Fri, 22 Sep 2006, Parlamis Franklin wrote:

> all those points are good ones, i just wonder what happens to S4
> "guarantees" when invalid objects are allowed to exist.  one of the
> advantages of methods, as i understand, is that they can be written
> with absolute confidence about what is being passed to them, and thus
> do not need to contemplate a bunch of different possibilities (and as
> a result can be terse and stylized). it seems if you really want
> bulletproof code, you have to make validObject the first call in any
> method definition to which an object with a validity method is being
> passed (and which relies on receiving a valid object).  i am not sure
> whether the time spent in those validObject calls is less than the
> time that might be spent in enforcing validity checks on all possible
> object mutations.

I think the contract is that new() guarantees an object is valid, and that 
programmers must guarantee that object mutation maintains validity. 
validObject() is available as a tool to help programmers fulfill their 
side of the bargain, but its use is not required. Given this contract it 
is not necessary for methods to check that the objects they are given are 
valid.

Since validObject() isn't guaranteed to be true when changes are in 
progress, it is not easy to identify a necessary and sufficient set of 
places to call validObject() to ensure validity automatically.

The other consequence of validObject() not being compulsory is that it can 
be slow -- it can check properties that are expensive to verify but are 
cheap to maintain. For example, you could have a data object where 
validObject() did a lot of range checks and consistency checks between 
variables.  Redoing these checks would be appropriate for a [<- method, 
which changes the values, but not for a [ method that just extracts a 
subset.

 	-thomas



From mtmorgan at fhcrc.org  Sat Sep 23 02:06:47 2006
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Fri, 22 Sep 2006 17:06:47 -0700
Subject: [Rd] validity testing as part of '@<-'
In-Reply-To: <Pine.LNX.4.64.0609221547270.24563@homer22.u.washington.edu>
	(Thomas
	Lumley's message of "Fri, 22 Sep 2006 16:04:54 -0700 (PDT)")
References: <D30BD4FE-2F4A-4C43-BF75-A96E64121CF4@mac.com>
	<45131E8A.5060903@stats.uwo.ca>
	<7098abec0609211735v220630fh2a5d770af5fe87a4@mail.gmail.com>
	<F3777624-FBC8-456E-9977-C9E2C1A86456@mac.com>
	<Pine.LNX.4.64.0609221547270.24563@homer22.u.washington.edu>
Message-ID: <6phr6y3la3s.fsf@gopher4.fhcrc.org>

While on the topic... validObject might check that the object (and its
slots) is actually the new S4:

> validObject(a)
[1] TRUE
> isS4(a)
[1] FALSE
> sessionInfo()
R version 2.4.0 beta (2006-09-22 r39490) 
x86_64-unknown-linux-gnu 

locale:
LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=en_US;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[7] "base"     


Thomas Lumley <tlumley at u.washington.edu> writes:

> On Fri, 22 Sep 2006, Parlamis Franklin wrote:
>
>> all those points are good ones, i just wonder what happens to S4
>> "guarantees" when invalid objects are allowed to exist.  one of the
>> advantages of methods, as i understand, is that they can be written
>> with absolute confidence about what is being passed to them, and thus
>> do not need to contemplate a bunch of different possibilities (and as
>> a result can be terse and stylized). it seems if you really want
>> bulletproof code, you have to make validObject the first call in any
>> method definition to which an object with a validity method is being
>> passed (and which relies on receiving a valid object).  i am not sure
>> whether the time spent in those validObject calls is less than the
>> time that might be spent in enforcing validity checks on all possible
>> object mutations.
>
> I think the contract is that new() guarantees an object is valid, and that 
> programmers must guarantee that object mutation maintains validity. 
> validObject() is available as a tool to help programmers fulfill their 
> side of the bargain, but its use is not required. Given this contract it 
> is not necessary for methods to check that the objects they are given are 
> valid.
>
> Since validObject() isn't guaranteed to be true when changes are in 
> progress, it is not easy to identify a necessary and sufficient set of 
> places to call validObject() to ensure validity automatically.
>
> The other consequence of validObject() not being compulsory is that it can 
> be slow -- it can check properties that are expensive to verify but are 
> cheap to maintain. For example, you could have a data object where 
> validObject() did a lot of range checks and consistency checks between 
> variables.  Redoing these checks would be appropriate for a [<- method, 
> which changes the values, but not for a [ method that just extracts a 
> subset.
>
>  	-thomas
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin T. Morgan
Bioconductor / Computational Biology
http://bioconductor.org



From fparlamis at mac.com  Sat Sep 23 06:48:22 2006
From: fparlamis at mac.com (Parlamis Franklin)
Date: Fri, 22 Sep 2006 18:48:22 -1000
Subject: [Rd] generics for primitive functions
Message-ID: <6E529B79-B0D5-4F9B-AB5D-11D588D47D0A@mac.com>

i think these two code snippets exhibit a bug.  they are identical  
but for the inclusion of an initial line in snippet [2]

[1]
setMethod("Math", signature(x = "numeric"), function(x) "Works")
getGeneric("sqrt")(4)

[2]
getGeneric("sqrt")(4)
setMethod("Math", signature(x = "numeric"), function(x) "Works")
getGeneric("sqrt")(4)

these are my results, when each is run from a fresh R session

[1]
 > setMethod("Math", signature(x = "numeric"), function(x) "Works")
[1] "Math"
 > getGeneric("sqrt")(4)
[1] "Works"

[2]
 > getGeneric("sqrt")(4)
`__Deferred_Default_Marker__`
 > setMethod("Math", signature(x = "numeric"), function(x) "Works")
[1] "Math"
 > getGeneric("sqrt")(4)
`__Deferred_Default_Marker__`

the section in "How Methods Work" that deals with this is unfinished,  
but i think it suggests that getGeneric("sqrt")(4) should work out of  
the box.

franklin parlamis

 > version
                _
platform       powerpc-apple-darwin8.7.0
arch           powerpc
os             darwin8.7.0
system         powerpc, darwin8.7.0
status         beta
major          2
minor          4.0
year           2006
month          09
day            22
svn rev        39471
language       R
version.string R version 2.4.0 beta (2006-09-22 r39471)



From dsamperi at DecisionSynergy.com  Sat Sep 23 07:31:41 2006
From: dsamperi at DecisionSynergy.com (Dominick Samperi)
Date: Sat, 23 Sep 2006 01:31:41 -0400
Subject: [Rd] Regular expressions
Message-ID: <4514C6BD.8060905@DecisionSynergy.com>

When I type

ls("package:base", pattern="log*")
functions with names like "floor" and
"Sys.setlocale" are included. I don't
think this is how "*" is supposed to work.

To get the desired response I have to use:
ls("packge:base", pattern="logg*")

I thought "log*" means "log" followed by
anything?

Thanks for any tips.

(I'm using R-alpha as of a week ago, perhaps)

ds



From ripley at stats.ox.ac.uk  Sat Sep 23 11:43:35 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 23 Sep 2006 10:43:35 +0100 (BST)
Subject: [Rd] Regular expressions
In-Reply-To: <4514C6BD.8060905@DecisionSynergy.com>
References: <4514C6BD.8060905@DecisionSynergy.com>
Message-ID: <Pine.LNX.4.64.0609230939530.29367@gannet.stats.ox.ac.uk>

On Sat, 23 Sep 2006, Dominick Samperi wrote:

> When I type
>
> ls("package:base", pattern="log*")
> functions with names like "floor" and
> "Sys.setlocale" are included. I don't
> think this is how "*" is supposed to work.
>
> To get the desired response I have to use:
> ls("packge:base", pattern="logg*")

If you want a wildcard-like behaviour, use glob2rx, e.g.

> glob2rx("log*")
[1] "^log"

> I thought "log*" means "log" followed by anything?

Please read ?regexp.
It means 'lo' followed by zero or more occurrences of 'g'.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From jmc at r-project.org  Sat Sep 23 15:35:34 2006
From: jmc at r-project.org (John Chambers)
Date: Sat, 23 Sep 2006 09:35:34 -0400
Subject: [Rd] generics for primitive functions
In-Reply-To: <6E529B79-B0D5-4F9B-AB5D-11D588D47D0A@mac.com>
References: <6E529B79-B0D5-4F9B-AB5D-11D588D47D0A@mac.com>
Message-ID: <45153826.3010203@r-project.org>

Probably a bug, but not at all the one you imply.  You have found a way 
to subvert a guarantee in R that methods for primitives can never be 
redefined for basic data types.

As you no doubt found, but didn't show us, so long as you say sqrt(4) 
the result is correct.  (Your "Works" should really read "Gotcha!").

Since a large amount of effort and not a little programming pain has 
been spent retaining the purity of primitive calls to satisfy the 
efficiency lobby, it's not clear what should happen when one insists on 
calling the generic function directly.  Either an error or just a call 
to the primitive would be the two likely candidates.  Not what happens 
in your first example though.

If you really want a "numeric" class that does something different for 
sqrt(), define an S4 class that contains "numeric"
 
 > setClass("WeirdNumber", contains="numeric")
[1] "WeirdNumber"
 > setMethod("Math", "WeirdNumber", function(x) "Weird")
[1] "Math"
 > xx = new("WeirdNumber", 1:10)
 > sqrt(xx)
[1] "Weird"


Parlamis Franklin wrote:
> i think these two code snippets exhibit a bug.  they are identical  
> but for the inclusion of an initial line in snippet [2]
>
> [1]
> setMethod("Math", signature(x = "numeric"), function(x) "Works")
> getGeneric("sqrt")(4)
>
> [2]
> getGeneric("sqrt")(4)
> setMethod("Math", signature(x = "numeric"), function(x) "Works")
> getGeneric("sqrt")(4)
>
> these are my results, when each is run from a fresh R session
>
> [1]
>  > setMethod("Math", signature(x = "numeric"), function(x) "Works")
> [1] "Math"
>  > getGeneric("sqrt")(4)
> [1] "Works"
>
> [2]
>  > getGeneric("sqrt")(4)
> `__Deferred_Default_Marker__`
>  > setMethod("Math", signature(x = "numeric"), function(x) "Works")
> [1] "Math"
>  > getGeneric("sqrt")(4)
> `__Deferred_Default_Marker__`
>
> the section in "How Methods Work" that deals with this is unfinished,  
> but i think it suggests that getGeneric("sqrt")(4) should work out of  
> the box.
>
> franklin parlamis
>
>  > version
>                 _
> platform       powerpc-apple-darwin8.7.0
> arch           powerpc
> os             darwin8.7.0
> system         powerpc, darwin8.7.0
> status         beta
> major          2
> minor          4.0
> year           2006
> month          09
> day            22
> svn rev        39471
> language       R
> version.string R version 2.4.0 beta (2006-09-22 r39471)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>



From fparlamis at mac.com  Sat Sep 23 20:44:50 2006
From: fparlamis at mac.com (Parlamis Franklin)
Date: Sat, 23 Sep 2006 08:44:50 -1000
Subject: [Rd] generics for primitive functions
In-Reply-To: <45153826.3010203@r-project.org>
References: <6E529B79-B0D5-4F9B-AB5D-11D588D47D0A@mac.com>
	<45153826.3010203@r-project.org>
Message-ID: <7399B135-3D5F-4839-9C9F-7C0BD2CDB79D@mac.com>

Yes, I figured I might have entered the forbidden zone (one hint was  
that I had to set the group method to achieve my goal -- an attempt  
to directly set a method for the 'sqrt' function was frustrated in  
the manner you suggest).  I have two followup questions and a request:

(i) Should I expect that the fix will be to seal group methods for  
groups that contain primitive functions and signatures comprising  
only basic data types, or that group methods will remain unsealed  
(and thus still work as desired for non-primitive underliers) and  
some other block applied?

(ii) In "How Methods Work" (pg. 8), you write: "So long as  
computations access the generic function through getGeneric(), most  
computations should be unaffected."  I took this as a suggestion that  
calls like getGeneric("sqrt")(4) were the suggested way to operate  
with primitives under S4.  What does it really mean?

Now the request (with some explanation).  I am not really interested  
in redefining primitives for class 'numeric.'  What I really want to  
do is define working non-primitive variants of primitives for class  
'expression'.  I have already done this for a class 'Expression'  
which contains 'expression' as you suggest, but I have been somewhat  
frustrated to go through the formality of dealing with a "custom"  
class for this purpose (as it adds unnecessary bulk and coercion to  
my code).  Since AFAIK none of the primitives in the 'Ops' or 'Math'  
groups work for objects of class 'expression' anyway, I don't see  
what purity we are retaining by sealing the methods on these  
functions for signatures comprising only objects of class 'expression'.

I'd like to request (as a feature change) that these methods be  
unsealed for signatures comprising only objects of class  
'expression'.  More broadly, I think it would be nice to unseal  
methods for primitive functions on all signatures for which the  
primitive would produce an error.  Sealing things that don't work is  
slightly cruel.  Perhaps a 'sealedPrimitives' option that the  
efficiency guys could check and freaks like me (who want to make 2+2  
= 3) could uncheck would be the simplest solution.  Of course I make  
this request humbly -- I have no idea what might be the cost in code  
of the discrimination I am requesting.

Franklin

On Sep 23, 2006, at 3:35 AM, John Chambers wrote:

> Probably a bug, but not at all the one you imply.  You have found a  
> way to subvert a guarantee in R that methods for primitives can  
> never be redefined for basic data types.
>
> As you no doubt found, but didn't show us, so long as you say sqrt 
> (4) the result is correct.  (Your "Works" should really read  
> "Gotcha!").
>
> Since a large amount of effort and not a little programming pain  
> has been spent retaining the purity of primitive calls to satisfy  
> the efficiency lobby, it's not clear what should happen when one  
> insists on calling the generic function directly.  Either an error  
> or just a call to the primitive would be the two likely  
> candidates.  Not what happens in your first example though.
>
> If you really want a "numeric" class that does something different  
> for sqrt(), define an S4 class that contains "numeric"
> > setClass("WeirdNumber", contains="numeric")
> [1] "WeirdNumber"
> > setMethod("Math", "WeirdNumber", function(x) "Weird")
> [1] "Math"
> > xx = new("WeirdNumber", 1:10)
> > sqrt(xx)
> [1] "Weird"
>
>
> Parlamis Franklin wrote:
>> i think these two code snippets exhibit a bug.  they are  
>> identical  but for the inclusion of an initial line in snippet [2]
>>
>> [1]
>> setMethod("Math", signature(x = "numeric"), function(x) "Works")
>> getGeneric("sqrt")(4)
>>
>> [2]
>> getGeneric("sqrt")(4)
>> setMethod("Math", signature(x = "numeric"), function(x) "Works")
>> getGeneric("sqrt")(4)
>>
>> these are my results, when each is run from a fresh R session
>>
>> [1]
>>  > setMethod("Math", signature(x = "numeric"), function(x) "Works")
>> [1] "Math"
>>  > getGeneric("sqrt")(4)
>> [1] "Works"
>>
>> [2]
>>  > getGeneric("sqrt")(4)
>> `__Deferred_Default_Marker__`
>>  > setMethod("Math", signature(x = "numeric"), function(x) "Works")
>> [1] "Math"
>>  > getGeneric("sqrt")(4)
>> `__Deferred_Default_Marker__`
>>
>> the section in "How Methods Work" that deals with this is  
>> unfinished,  but i think it suggests that getGeneric("sqrt")(4)  
>> should work out of  the box.
>>
>> franklin parlamis
>>
>>  > version
>>                 _
>> platform       powerpc-apple-darwin8.7.0
>> arch           powerpc
>> os             darwin8.7.0
>> system         powerpc, darwin8.7.0
>> status         beta
>> major          2
>> minor          4.0
>> year           2006
>> month          09
>> day            22
>> svn rev        39471
>> language       R
>> version.string R version 2.4.0 beta (2006-09-22 r39471)
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>



From klaus.thul at mac.com  Sun Sep 24 04:57:20 2006
From: klaus.thul at mac.com (klaus.thul at mac.com)
Date: Sun, 24 Sep 2006 04:57:20 +0200 (CEST)
Subject: [Rd] Incomplete loading of files into Windows script editor,
	suspected bug regarding non-standard EOL marker handling (PR#9248)
Message-ID: <20060924025720.1CB0F28F8E@slim.kubism.ku.dk>

Full_Name: Klaus Thul
Version: R2.3.1 (CRAN binary for Windows)
OS: Windows XP
Submission from: (NULL) (220.132.142.175)


When I read a longer text file created on Mac OS X into the built-in script
editor of R for windows, it is read only incomplete. The same file can be loaded
without problem e. g. into WordPad.

I think the reason for the behavior is that Mac OS X uses different EOL markers,
and R for windows doesn't handle these markers correctly. I don't have access to
an UNIX/LINUX system, but I guess files generated on these systems will cause
the same problem.

 I can provide an example file which fails if necessary.



From ripley at stats.ox.ac.uk  Sun Sep 24 08:07:39 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Sun, 24 Sep 2006 08:07:39 +0200 (CEST)
Subject: [Rd] (PR#9248) Incomplete loading of files into Windows script
Message-ID: <20060924060739.BF4044BEC7@slim.kubism.ku.dk>

Please, we do need complete reproduction instructions (and not 
speculation) as the FAQ asks.

1) How exactly did you read the file in?
2) 'longer' than what?
3) What line ending is this?

I've just tried loading a 1000-line 50kb file using the 'Open Script' menu 
item, and it worked with CRLF, LF or CR line endings.

Some guesses are that there are control characters in the file or an 
encoding problem (what is your locale?).


On Sun, 24 Sep 2006, klaus.thul at mac.com wrote:

> Full_Name: Klaus Thul
> Version: R2.3.1 (CRAN binary for Windows)
> OS: Windows XP
> Submission from: (NULL) (220.132.142.175)
>
>
> When I read a longer text file created on Mac OS X into the built-in script
> editor of R for windows, it is read only incomplete. The same file can be loaded
> without problem e. g. into WordPad.
>
> I think the reason for the behavior is that Mac OS X uses different EOL markers,
> and R for windows doesn't handle these markers correctly. I don't have access to
> an UNIX/LINUX system, but I guess files generated on these systems will cause
> the same problem.
>
> I can provide an example file which fails if necessary.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From kevin.hendricks at sympatico.ca  Sun Sep 24 20:06:25 2006
From: kevin.hendricks at sympatico.ca (Kevin B. Hendricks)
Date: Sun, 24 Sep 2006 14:06:25 -0400
Subject: [Rd] change in output wording causes make check to fail
Message-ID: <2265E4BB-11CF-4209-9A33-BC5541978C86@sympatico.ca>

Hi,

 From an svn update run just a few minutes ago, make check-all fails

running code in 'R-intro.R' ... OK
comparing 'R-intro.Rout' to '../../r-devel/r-devel/R/tests/R- 
intro.Rout.save' ...608c608
< alternative hypothesis: true location shift is not equal to 0
---
 > alternative hypothesis: true mu is not equal to 0


Perhaps R-intro.Rout simply needs to be updated to reflect the  
wording change?

Kevin



From whit.armstrong at hcmny.com  Sun Sep 24 20:41:30 2006
From: whit.armstrong at hcmny.com (Armstrong, Whit)
Date: Sun, 24 Sep 2006 14:41:30 -0400
Subject: [Rd] package that has a subdirectory in src
Message-ID: <E58BE6136618CF4C964F6EC7773AE569B4FEB6@ex4.nyc.hcmny.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060924/ef4ef469/attachment-0003.pl 

From ripley at stats.ox.ac.uk  Sun Sep 24 20:59:08 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 24 Sep 2006 19:59:08 +0100 (BST)
Subject: [Rd] package that has a subdirectory in src
In-Reply-To: <E58BE6136618CF4C964F6EC7773AE569B4FEB6@ex4.nyc.hcmny.com>
References: <E58BE6136618CF4C964F6EC7773AE569B4FEB6@ex4.nyc.hcmny.com>
Message-ID: <Pine.LNX.4.64.0609241954590.6277@gannet.stats.ox.ac.uk>

On Sun, 24 Sep 2006, Armstrong, Whit wrote:

> How does one tell R to compile code contained in subdirs of the /src
> directory?

Write a src/Makefile.  There are several examples on CRAN: e.g. Matrix, 
SQLiteDF, mapproj.

> I have a few files that I'd like to keep together as one unit.
>
> The cheesy way that I can think of is to put slinks in the src directory
> to the files contained in the subdir, but that's not really the solution
> I'm looking for.
>
> I was hoping to avoid adding a configure.in file to the project.
>
> By way of background information, the files in the subdirectory are a
> separate subversion project that is shared between many R packages that
> I am working on.  Does anyone have any suggestions?

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From ripley at stats.ox.ac.uk  Mon Sep 25 00:03:20 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 24 Sep 2006 23:03:20 +0100 (BST)
Subject: [Rd] change in output wording causes make check to fail
In-Reply-To: <2265E4BB-11CF-4209-9A33-BC5541978C86@sympatico.ca>
References: <2265E4BB-11CF-4209-9A33-BC5541978C86@sympatico.ca>
Message-ID: <Pine.LNX.4.64.0609242300130.12260@gannet.stats.ox.ac.uk>

On Sun, 24 Sep 2006, Kevin B. Hendricks wrote:

> Hi,
>
> From an svn update run just a few minutes ago, make check-all fails
>
> running code in 'R-intro.R' ... OK
> comparing 'R-intro.Rout' to '../../r-devel/r-devel/R/tests/R-
> intro.Rout.save' ...608c608
> < alternative hypothesis: true location shift is not equal to 0
> ---
> > alternative hypothesis: true mu is not equal to 0
>
>
> Perhaps R-intro.Rout simply needs to be updated to reflect the
> wording change?

Yes, but it is 'make check-all' and not 'make check' that fails, and in 
R-devel, which is 'Under development (unstable)'.  This is an unfinished 
change (there also needs to be a change to ks.test).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From jmc at math.ethz.ch  Mon Sep 25 00:57:42 2006
From: jmc at math.ethz.ch (Pr. Jean-Michel Collard)
Date: Mon, 25 Sep 2006 00:57:42 +0200 (CEST)
Subject: [Rd] generics for primitive functions
In-Reply-To: <7399B135-3D5F-4839-9C9F-7C0BD2CDB79D@mac.com>
References: <6E529B79-B0D5-4F9B-AB5D-11D588D47D0A@mac.com>
	<45153826.3010203@r-project.org>
	<7399B135-3D5F-4839-9C9F-7C0BD2CDB79D@mac.com>
Message-ID: <4849.74.12.142.7.1159138662.squirrel@webmail.stat.ethz.ch>

Short reply -- I'm away from regular web access for 2 days.

The exception would break a simple test (is.object() essentially) and
likely have serious efficiency problems.  You'd need a better argument, I
suspect.

> Yes, I figured I might have entered the forbidden zone (one hint was
> that I had to set the group method to achieve my goal -- an attempt
> to directly set a method for the 'sqrt' function was frustrated in
> the manner you suggest).  I have two followup questions and a request:
>
> (i) Should I expect that the fix will be to seal group methods for
> groups that contain primitive functions and signatures comprising
> only basic data types, or that group methods will remain unsealed
> (and thus still work as desired for non-primitive underliers) and
> some other block applied?
>
> (ii) In "How Methods Work" (pg. 8), you write: "So long as
> computations access the generic function through getGeneric(), most
> computations should be unaffected."  I took this as a suggestion that
> calls like getGeneric("sqrt")(4) were the suggested way to operate
> with primitives under S4.  What does it really mean?
>
> Now the request (with some explanation).  I am not really interested
> in redefining primitives for class 'numeric.'  What I really want to
> do is define working non-primitive variants of primitives for class
> 'expression'.  I have already done this for a class 'Expression'
> which contains 'expression' as you suggest, but I have been somewhat
> frustrated to go through the formality of dealing with a "custom"
> class for this purpose (as it adds unnecessary bulk and coercion to
> my code).  Since AFAIK none of the primitives in the 'Ops' or 'Math'
> groups work for objects of class 'expression' anyway, I don't see
> what purity we are retaining by sealing the methods on these
> functions for signatures comprising only objects of class 'expression'.
>
> I'd like to request (as a feature change) that these methods be
> unsealed for signatures comprising only objects of class
> 'expression'.  More broadly, I think it would be nice to unseal
> methods for primitive functions on all signatures for which the
> primitive would produce an error.  Sealing things that don't work is
> slightly cruel.  Perhaps a 'sealedPrimitives' option that the
> efficiency guys could check and freaks like me (who want to make 2+2
> = 3) could uncheck would be the simplest solution.  Of course I make
> this request humbly -- I have no idea what might be the cost in code
> of the discrimination I am requesting.
>
> Franklin
>
> On Sep 23, 2006, at 3:35 AM, John Chambers wrote:
>
>> Probably a bug, but not at all the one you imply.  You have found a
>> way to subvert a guarantee in R that methods for primitives can
>> never be redefined for basic data types.
>>
>> As you no doubt found, but didn't show us, so long as you say sqrt
>> (4) the result is correct.  (Your "Works" should really read
>> "Gotcha!").
>>
>> Since a large amount of effort and not a little programming pain
>> has been spent retaining the purity of primitive calls to satisfy
>> the efficiency lobby, it's not clear what should happen when one
>> insists on calling the generic function directly.  Either an error
>> or just a call to the primitive would be the two likely
>> candidates.  Not what happens in your first example though.
>>
>> If you really want a "numeric" class that does something different
>> for sqrt(), define an S4 class that contains "numeric"
>> > setClass("WeirdNumber", contains="numeric")
>> [1] "WeirdNumber"
>> > setMethod("Math", "WeirdNumber", function(x) "Weird")
>> [1] "Math"
>> > xx = new("WeirdNumber", 1:10)
>> > sqrt(xx)
>> [1] "Weird"
>>
>>
>> Parlamis Franklin wrote:
>>> i think these two code snippets exhibit a bug.  they are
>>> identical  but for the inclusion of an initial line in snippet [2]
>>>
>>> [1]
>>> setMethod("Math", signature(x = "numeric"), function(x) "Works")
>>> getGeneric("sqrt")(4)
>>>
>>> [2]
>>> getGeneric("sqrt")(4)
>>> setMethod("Math", signature(x = "numeric"), function(x) "Works")
>>> getGeneric("sqrt")(4)
>>>
>>> these are my results, when each is run from a fresh R session
>>>
>>> [1]
>>>  > setMethod("Math", signature(x = "numeric"), function(x) "Works")
>>> [1] "Math"
>>>  > getGeneric("sqrt")(4)
>>> [1] "Works"
>>>
>>> [2]
>>>  > getGeneric("sqrt")(4)
>>> `__Deferred_Default_Marker__`
>>>  > setMethod("Math", signature(x = "numeric"), function(x) "Works")
>>> [1] "Math"
>>>  > getGeneric("sqrt")(4)
>>> `__Deferred_Default_Marker__`
>>>
>>> the section in "How Methods Work" that deals with this is
>>> unfinished,  but i think it suggests that getGeneric("sqrt")(4)
>>> should work out of  the box.
>>>
>>> franklin parlamis
>>>
>>>  > version
>>>                 _
>>> platform       powerpc-apple-darwin8.7.0
>>> arch           powerpc
>>> os             darwin8.7.0
>>> system         powerpc, darwin8.7.0
>>> status         beta
>>> major          2
>>> minor          4.0
>>> year           2006
>>> month          09
>>> day            22
>>> svn rev        39471
>>> language       R
>>> version.string R version 2.4.0 beta (2006-09-22 r39471)
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Fluctut nec mergitur



From sfalcon at fhcrc.org  Mon Sep 25 06:52:34 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Sun, 24 Sep 2006 21:52:34 -0700
Subject: [Rd] Problem with tcltk package: tclfile.dir missing?
Message-ID: <m28xk835v1.fsf@ziti.local>

Hi,

In R version 2.4.0 beta (2006-09-24 r39502) I'm seeing the following
behavior with the tcltk package:

> library("tcltk")
Loading Tcl/Tk interface ... done

> tkfile.dir()
Error: 'tkfile.dir' is defunct.
Use 'tclfile.dir' instead.
See help("Defunct")

> tclfile.dir
Error: object "tclfile.dir" not found

## But the function is in the package, just not exported?
> tcltk:::tclfile.dir
function (...) 
tcl("file", "dir", ...)
<environment: namespace:tcltk>


--
+ seth



From p.dalgaard at biostat.ku.dk  Mon Sep 25 08:55:26 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 25 Sep 2006 08:55:26 +0200
Subject: [Rd] Problem with tcltk package: tclfile.dir missing?
In-Reply-To: <m28xk835v1.fsf@ziti.local>
References: <m28xk835v1.fsf@ziti.local>
Message-ID: <x2y7s8zb8h.fsf@turmalin.kubism.ku.dk>

Seth Falcon <sfalcon at fhcrc.org> writes:

> Hi,
> 
> In R version 2.4.0 beta (2006-09-24 r39502) I'm seeing the following
> behavior with the tcltk package:
> 
> > library("tcltk")
> Loading Tcl/Tk interface ... done
> 
> > tkfile.dir()
> Error: 'tkfile.dir' is defunct.
> Use 'tclfile.dir' instead.
> See help("Defunct")
> 
> > tclfile.dir
> Error: object "tclfile.dir" not found
> 
> ## But the function is in the package, just not exported?
> > tcltk:::tclfile.dir
> function (...) 
> tcl("file", "dir", ...)
> <environment: namespace:tcltk>

Heh, this obviously hasn't been exercised much... The issue is that
NAMESPACE contains

exportPattern("^tcl[[:alnum:]]*($|<-)") # skip S3 methods
exportPattern("^tk")

so the tk --> tcl prefix change doesn't automatically work on
functions with a dot in them. tclfile.tail is the only other case that
I can spot.

Best to fix in the obvious way at the current stage, but I wonder
whether it wouldn't have been better just to have tclfile("dir",
myfile) -- or for that matter just let users use the straightforward
tcl("file", "dir", myfile). (Or dirname(myfile) for that matter).

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From michael.bauer at lo-res.org  Mon Sep 25 10:43:08 2006
From: michael.bauer at lo-res.org (michael.bauer at lo-res.org)
Date: Mon, 25 Sep 2006 10:43:08 +0200 (CEST)
Subject: [Rd] sprintf behavior (PR#9250)
Message-ID: <20060925084308.D92334C91B@slim.kubism.ku.dk>

Full_Name: Michael Bauer
Version: 2.3.1
OS: Mac OS X 10.4.7
Submission from: (NULL) (131.130.124.155)


> sessionInfo()
Version 2.3.1 (2006-06-01) 
powerpc-apple-darwin8.6.0 

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"    
[6] "datasets"  "base"     
> 

sprintf("\p") doesn't show the backslash, this occurs with all strings that
start with certain letters. There is however no explanation to this behavior.
And there seems to be no way to get a guaranteed backslash in sprintf.



From ripley at stats.ox.ac.uk  Mon Sep 25 11:46:13 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon, 25 Sep 2006 11:46:13 +0200 (CEST)
Subject: [Rd] sprintf behavior (PR#9250)
Message-ID: <20060925094613.B5FB64C91E@slim.kubism.ku.dk>

On Mon, 25 Sep 2006, michael.bauer at lo-res.org wrote:

> Full_Name: Michael Bauer
> Version: 2.3.1
> OS: Mac OS X 10.4.7
> Submission from: (NULL) (131.130.124.155)
>
>
>> sessionInfo()
> Version 2.3.1 (2006-06-01)
> powerpc-apple-darwin8.6.0
>
> attached base packages:
> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"
> [6] "datasets"  "base"
>>
>
> sprintf("\p") doesn't show the backslash, this occurs with all strings that
> start with certain letters. There is however no explanation to this behavior.

There is: see ?Quote (and C behaves in the same way).

> And there seems to be no way to get a guaranteed backslash in sprintf.

"\\", see the FAQ 7.8 for example.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From p.dalgaard at biostat.ku.dk  Mon Sep 25 11:51:49 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 25 Sep 2006 11:51:49 +0200
Subject: [Rd] sprintf behavior (PR#9250)
In-Reply-To: <20060925084308.D92334C91B@slim.kubism.ku.dk>
References: <20060925084308.D92334C91B@slim.kubism.ku.dk>
Message-ID: <x264fci896.fsf@viggo.kubism.ku.dk>

michael.bauer at lo-res.org writes:

> Full_Name: Michael Bauer
> Version: 2.3.1
> OS: Mac OS X 10.4.7
> Submission from: (NULL) (131.130.124.155)
> 
> 
> > sessionInfo()
> Version 2.3.1 (2006-06-01) 
> powerpc-apple-darwin8.6.0 
> 
> attached base packages:
> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"    
> [6] "datasets"  "base"     
> > 
> 
> sprintf("\p") doesn't show the backslash, this occurs with all strings that
> start with certain letters. There is however no explanation to this behavior.
> And there seems to be no way to get a guaranteed backslash in sprintf.

This is *not* a bug (it is also not a FAQ, although I'm beginning to
think it should be). Please read up on R's string handling, with
particular emphasis on the concept of escape characters.

> "\\p\n"
[1] "\\p\n"

> cat("\\p\n")
\p

> nchar("\\p\n")
[1] 3

Also, do not report things as bugs before you are 100% certain that
they are bugs.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From p.dalgaard at biostat.ku.dk  Mon Sep 25 12:04:23 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 25 Sep 2006 12:04:23 +0200
Subject: [Rd] sprintf behavior (PR#9250)
In-Reply-To: <x264fci896.fsf@viggo.kubism.ku.dk>
References: <20060925084308.D92334C91B@slim.kubism.ku.dk>
	<x264fci896.fsf@viggo.kubism.ku.dk>
Message-ID: <x21wq0i7o8.fsf@viggo.kubism.ku.dk>

Peter Dalgaard <p.dalgaard at biostat.ku.dk> writes:

> This is *not* a bug (it is also not a FAQ, although I'm beginning to
> think it should be).

Just to be clear: I'm aware of FAQ 7.8, but it is about file names.

Issue is whether we need a generic "backslashes in text strings"
entry. 

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From buser at stat.math.ethz.ch  Mon Sep 25 13:57:57 2006
From: buser at stat.math.ethz.ch (Christoph Buser)
Date: Mon, 25 Sep 2006 13:57:57 +0200
Subject: [Rd] apply: new behaviour for factors in R-2.4.0
Message-ID: <17687.50245.112717.6919@stat.math.ethz.ch>

Dear R-core

There is a different output for the apply function due to the
change of unlist as mentioned in the R news.

Newly, applying as.factor() (or factor()) in

str(dat <- data.frame(x = 1:10, f1 = gl(2,5,labels = c("A", "B"))))
(d1 <- apply(dat,2,as.factor))

newly returns a character matrix while in R-2.3.1 the same
command resulted in an integer matrix that was consistent (up to
the ordering of the factor levels) with data.matrix().

The change is caused by the change of unlist() that, used for a
list of factors, newly returns a single factor instead of an
integer. I am happy with this change, but:

Is it desirable to change apply so that it does not return a
character matrix in the example above or include a warning for
such a case? 

Thank you very much for an answer.

Regards,

Christoph Buser

--------------------------------------------------------------
Christoph Buser <buser at stat.math.ethz.ch>
Seminar fuer Statistik, LEO C13
ETH Zurich	8092 Zurich	 SWITZERLAND
phone: x-41-44-632-4673		fax: 632-1228
http://stat.ethz.ch/~buser/



From thineomuto at yahoo.com  Mon Sep 25 14:35:49 2006
From: thineomuto at yahoo.com (CHRISTIAN OMUTO)
Date: Mon, 25 Sep 2006 05:35:49 -0700 (PDT)
Subject: [Rd] Fwd: Selfstarting models for soil hydrology using R
Message-ID: <20060925123549.13294.qmail@web38712.mail.mud.yahoo.com>

> Dear,
> I have developed and tested some models in soil
> hydrology with NLME library in R. I want to ask
> if it could be possible to submit this to the NLME
> library (with sample data) as a toolbox or something
> so
> that anyone downloading new components of new
> versions
> of R may simply call (say
> SSbrookscorey function to predict water retention in
> the same way someone can call SSlogis to predict
> logistic function in the current version)? I would
> be
> grateful for your support. I can also give in-depth
> description and capabilities for white papers
> concerning the applications of R in soil hydrology.
> Please advice me.
> Dr. Christian Thine,
> University of Nairobi, Kenya.
> 
> 
> __________________________________________________
> Do You Yahoo!?

> protection around 
> http://mail.yahoo.com 
>



From pgilbert at bank-banque-canada.ca  Mon Sep 25 15:27:09 2006
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Mon, 25 Sep 2006 09:27:09 -0400
Subject: [Rd] alpha, portable use
In-Reply-To: <Pine.LNX.4.64.0609202202560.21267@gannet.stats.ox.ac.uk>
References: <4511A685.6030509@bank-banque-canada.ca>
	<Pine.LNX.4.64.0609202202560.21267@gannet.stats.ox.ac.uk>
Message-ID: <4517D92D.1000707@bank-banque-canada.ca>

I am still confused about this (and it is still happening with R-beta).
Writing R Extensions suggests I need a Makefile or Makevars in my
package,  but that has not been the case previously.  Is there now a
requirement that all packages need Makefiles or Makevars if there is 
fortran to be compiled?  This is only happening on one of my systems. 
Building R and make check work fine on that system, but it seems that 
not all the information gets passed along to package compiles.

(BTW, this is just a warning, but Kurt suggested we try to eliminate 
warnings.)

Paul Gilbert

Prof Brian Ripley wrote:
> On Wed, 20 Sep 2006, Paul Gilbert wrote:
> 
>> When I build one of my packages with alpha from yesterday I am getting
>>
>> * checking for portable use of $BLAS_LIBS ... WARNING
>> apparently missing $(FLIBS) in 'PKG_LIBS=$(LAPACK_LIBS) $(BLAS_LIBS)'
>>
>> Is this something I should worry about?  (Possibly I got this before and
>> didn't notice.)
> 
> Yes, please do check Writing R Extensions ....
> 
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}



From ripley at stats.ox.ac.uk  Mon Sep 25 16:11:10 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 25 Sep 2006 15:11:10 +0100 (BST)
Subject: [Rd] apply: new behaviour for factors in R-2.4.0
In-Reply-To: <17687.50245.112717.6919@stat.math.ethz.ch>
References: <17687.50245.112717.6919@stat.math.ethz.ch>
Message-ID: <Pine.LNX.4.64.0609251454410.11772@gannet.stats.ox.ac.uk>

Christoph,

This is more complicated than your analysis.

1) apply takes a matrix as an argument, not a data frame, and so first 
coerced 'dat' to a character matrix.

2) unlist is working quite correctly.  The issue is array(), which 
contains as.vector(data).  Thus although the result could be a factor 
matrix, as.vector is coercing it to a character matrix.  It might be 
desirable to return a factor matrix, but we are not going to do that in 
feature freeze (if ever) and I really don't think it would be what you 
wanted.

Perhaps the help page should contain an explicit statement that the result 
will be coerced to a basic vector type by as.vector().

On Mon, 25 Sep 2006, Christoph Buser wrote:

> Dear R-core
>
> There is a different output for the apply function due to the
> change of unlist as mentioned in the R news.
>
> Newly, applying as.factor() (or factor()) in
>
> str(dat <- data.frame(x = 1:10, f1 = gl(2,5,labels = c("A", "B"))))
> (d1 <- apply(dat,2,as.factor))
>
> newly returns a character matrix while in R-2.3.1 the same
> command resulted in an integer matrix that was consistent (up to
> the ordering of the factor levels) with data.matrix().

That's coincidence -- try x=11:20.

> The change is caused by the change of unlist() that, used for a
> list of factors, newly returns a single factor instead of an
> integer. I am happy with this change, but:
>
> Is it desirable to change apply so that it does not return a
> character matrix in the example above or include a warning for
> such a case?
>
> Thank you very much for an answer.
>
> Regards,
>
> Christoph Buser
>
> --------------------------------------------------------------
> Christoph Buser <buser at stat.math.ethz.ch>
> Seminar fuer Statistik, LEO C13
> ETH Zurich	8092 Zurich	 SWITZERLAND
> phone: x-41-44-632-4673		fax: 632-1228
> http://stat.ethz.ch/~buser/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From bates at stat.wisc.edu  Mon Sep 25 17:42:22 2006
From: bates at stat.wisc.edu (Douglas Bates)
Date: Mon, 25 Sep 2006 10:42:22 -0500
Subject: [Rd] alpha, portable use
In-Reply-To: <4517D92D.1000707@bank-banque-canada.ca>
References: <4511A685.6030509@bank-banque-canada.ca>
	<Pine.LNX.4.64.0609202202560.21267@gannet.stats.ox.ac.uk>
	<4517D92D.1000707@bank-banque-canada.ca>
Message-ID: <40e66e0b0609250842m5f200406r5107814af3e06012@mail.gmail.com>

On 9/25/06, Paul Gilbert <pgilbert at bank-banque-canada.ca> wrote:
> I am still confused about this (and it is still happening with R-beta).
> Writing R Extensions suggests I need a Makefile or Makevars in my
> package,  but that has not been the case previously.  Is there now a
> requirement that all packages need Makefiles or Makevars if there is
> fortran to be compiled?  This is only happening on one of my systems.
> Building R and make check work fine on that system, but it seems that
> not all the information gets passed along to package compiles.
>
> (BTW, this is just a warning, but Kurt suggested we try to eliminate
> warnings.)

>From the warning it seems that you have a Makevars file in the src
directory for your package.  The change in R-2.4.0 is that packages
that did have a Makevars file of the form

PKG_LIBS=$(LAPACK_LIBS) $(BLAS_LIBS)

should change that to

PKG_LIBS=$(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)

>
> Paul Gilbert
>
> Prof Brian Ripley wrote:
> > On Wed, 20 Sep 2006, Paul Gilbert wrote:
> >
> >> When I build one of my packages with alpha from yesterday I am getting
> >>
> >> * checking for portable use of $BLAS_LIBS ... WARNING
> >> apparently missing $(FLIBS) in 'PKG_LIBS=$(LAPACK_LIBS) $(BLAS_LIBS)'
> >>
> >> Is this something I should worry about?  (Possibly I got this before and
> >> didn't notice.)
> >
> > Yes, please do check Writing R Extensions ....
> >
> ====================================================================================
>
> La version fran?aise suit le texte anglais.
>
> ------------------------------------------------------------------------------------
>
> This email may contain privileged and/or confidential inform...{{dropped}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



From pgilbert at bank-banque-canada.ca  Mon Sep 25 18:46:38 2006
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Mon, 25 Sep 2006 12:46:38 -0400
Subject: [Rd] alpha, portable use
In-Reply-To: <40e66e0b0609250842m5f200406r5107814af3e06012@mail.gmail.com>
References: <4511A685.6030509@bank-banque-canada.ca>	
	<Pine.LNX.4.64.0609202202560.21267@gannet.stats.ox.ac.uk>	
	<4517D92D.1000707@bank-banque-canada.ca>
	<40e66e0b0609250842m5f200406r5107814af3e06012@mail.gmail.com>
Message-ID: <451807EE.90904@bank-banque-canada.ca>

Doug
I do indeed have a Makevars file after all. Thanks for spelling out the 
interpretation of the warning message.

Paul

Douglas Bates wrote:
> On 9/25/06, Paul Gilbert <pgilbert at bank-banque-canada.ca> wrote:
>> I am still confused about this (and it is still happening with R-beta).
>> Writing R Extensions suggests I need a Makefile or Makevars in my
>> package,  but that has not been the case previously.  Is there now a
>> requirement that all packages need Makefiles or Makevars if there is
>> fortran to be compiled?  This is only happening on one of my systems.
>> Building R and make check work fine on that system, but it seems that
>> not all the information gets passed along to package compiles.
>>
>> (BTW, this is just a warning, but Kurt suggested we try to eliminate
>> warnings.)
> 
>  From the warning it seems that you have a Makevars file in the src
> directory for your package.  The change in R-2.4.0 is that packages
> that did have a Makevars file of the form
> 
> PKG_LIBS=$(LAPACK_LIBS) $(BLAS_LIBS)
> 
> should change that to
> 
> PKG_LIBS=$(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)
> 
>>
>> Paul Gilbert
>>
>> Prof Brian Ripley wrote:
>> > On Wed, 20 Sep 2006, Paul Gilbert wrote:
>> >
>> >> When I build one of my packages with alpha from yesterday I am getting
>> >>
>> >> * checking for portable use of $BLAS_LIBS ... WARNING
>> >> apparently missing $(FLIBS) in 'PKG_LIBS=$(LAPACK_LIBS) $(BLAS_LIBS)'
>> >>
>> >> Is this something I should worry about?  (Possibly I got this 
>> before and
>> >> didn't notice.)
>> >
>> > Yes, please do check Writing R Extensions ....
>> >
>> ==================================================================================== 
>>
>>
>> La version fran?aise suit le texte anglais.
>>
>> ------------------------------------------------------------------------------------ 
>>
>>
>> This email may contain privileged and/or confidential 
>> inform...{{dropped}}
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}



From kjetilbrinchmannhalvorsen at gmail.com  Tue Sep 26 00:17:52 2006
From: kjetilbrinchmannhalvorsen at gmail.com (Kjetil Halvorsen)
Date: Mon, 25 Sep 2006 18:17:52 -0400
Subject: [Rd] buglet in ?asin
Message-ID: <556e90a80609251517w33824cacs1ef0fb9b7879d0f9@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060925/bf00fd5c/attachment-0003.pl 

From gregor.gorjanc at bfro.uni-lj.si  Tue Sep 26 01:59:47 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Tue, 26 Sep 2006 01:59:47 +0200
Subject: [Rd] na.encode in format for Date and POSIXt classes
Message-ID: <45186D73.1020004@bfro.uni-lj.si>

Hello!

na.encode does not have any effect on format of NA values of Date and
POSIXct (POSIXlt?) "atomic" classes in a data.frame. Here is the example
(the same in R 2.3.1 and 2.5.0 (2006-09-19 r39409)):

testData <- data.frame(num=c(NA, 2.6),
                       int=c(1, NA),
                       fac=factor(c(NA, "abc")),
                       cha=c("a", NA),
                       dat=as.Date(c("1900-1-1", NA)),
                       POS=as.POSIXct(strptime(c("1900-1-1 01:01:01",
                                                 NA),
                                      format="%Y-%m-%d %H:%M:%S")))
testData$cha <- as.character(testData$cha)
testData
  num int  fac  cha        dat                 POS
1  NA   1 <NA>    a 1900-01-01 1900-01-01 01:01:01
2 2.6  NA  abc <NA>       <NA>                <NA>

format(testData)
  num int fac cha        dat                 POS
1  NA   1  NA   a 1900-01-01 1900-01-01 01:01:01
2 2.6  NA abc  NA       <NA>                <NA>
                        ^^^^                ^^^^

format(testData, na.encode=FALSE)
  num int  fac  cha        dat                 POS
1  NA   1 <NA>    a 1900-01-01 1900-01-01 01:01:01
2 2.6  NA  abc <NA>       <NA>                <NA>

format(testData, na.encode=TRUE)
  num int fac cha        dat                 POS
1  NA   1  NA   a 1900-01-01 1900-01-01 01:01:01
2 2.6  NA abc  NA       <NA>                <NA>
                        ^^^^                ^^^^

After a brief look into format.data.frame, format.POSIXct and
format.POSIXlt I notice that na.encode is not used at all in (last line
of format.POSIXlt)

 .Internal(format.POSIXlt(x, format, usetz))

but I get lost from this point forward. I guess that the same applies to
format.Date as this coerces Date to POSIXlt before formatting.

Additionally, I would suggest change in format help page for argument
na.encode. It says now

na.encode: logical: should 'NA' strings be encoded?

If I am not wrong, this applies only to non-numeric columns. Something
like the following might be more accurate:

na.encode: logical: should 'NA' strings be encoded (applies only to
non-numeric)?

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc
----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.



From gregor.gorjanc at bfro.uni-lj.si  Tue Sep 26 02:01:41 2006
From: gregor.gorjanc at bfro.uni-lj.si (gregor.gorjanc at bfro.uni-lj.si)
Date: Tue, 26 Sep 2006 02:01:41 +0200 (CEST)
Subject: [Rd] Wish: change behaviour of header in read.fwf (PR#9252)
Message-ID: <20060926000141.B248A4C8A4@slim.kubism.ku.dk>

Hello!

In my opinion read.fwf()'s behaviour of header is not really useful. Say
I have the following data:

col1  col2  col3
 123   123   123
   a           b
1234    12  1234
      65.4   4.5

Now if I want to read this data into R I can not use read.table due to
missing fields.

read.table(file="test.txt")
Error in scan(file, what, nmax, sep, dec, quote, skip, nlines,
na.strings,  :
	line 3 did not have 3 elements

However, read.fwf() can help me.

read.fwf(file="test.txt", widths=c(5, 6, 5))
     V1     V2    V3
1 col1   col2   col3
2  123    123    123
3    a             b
4 1234     12   1234
5        65.4    4.5

Upps, I need to specify header and help page says that header fields
must be separated by sep. sep part of help page says

     sep: character; the separator used internally; should be a
          character that does not occur in the file (except in the
          header).

This is quite limiting because I never know in advance which characters
do not occur in a datafile and if I do, I have to  properly modify
header in the file before import. Naive use of read.fwf returns an error

read.fwf(file="test.txt", widths=c(5, 6, 5), header=TRUE, sep=" ")
Error in read.table(file = FILE, header = header, sep = sep, as.is =
as.is,  :
	more columns than column names

read.fwf(file="test.txt", widths=c(5, 6, 5), header=TRUE, sep="  ")
Error in scan(file, what, nmax, sep, dec, quote, skip, nlines,
na.strings,  :
	invalid 'sep' value: must be one byte

I get lost in reading source of read.fwf, but I think that the following
idea should be easy to implement and it would be also similar to
read.table behaviour.

<ideaCode>

if(header) {
  ## sep is from read.fwf call
  header <- unlist(strsplit(readLines(con=file, n=1), split=sep))
}
...
## tweaks related to issues with length(header), row.names, ncol(), ...
read.table(..., col.names=header, ...)

</ideaCode>

I know that FWF is not used much these days, but I would find proposed
change really useful.

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc
----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.



From ross at biostat.ucsf.edu  Tue Sep 26 02:20:49 2006
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Tue, 26 Sep 2006 00:20:49 +0000
Subject: [Rd] S4 accessors
Message-ID: <1159230049.7161.132.camel@iron.psg.net>

I have a small S4 class for which I've written a page grouping many of
the accessors and replacement functions together.  I would be interested
in people comments on the approach I've taken.

The code has a couple of decisions for which I could imagine
alternatives.  First, even simple get/set operations on class elements
are wrapped in functions.  I suppose I could just use myinstance at slot to
do some of these operations, though that is considered bad style in more
traditional OO contexts.

Second, even though the functions are tied to the class, I've defined
them as free functions rather than methods.  I suppose I could create a
generic that would reject most arguments, and then make methods
appropriately.

For the documentation, I've created a single page that groups many of
the functions together.  This is a bit awkward, since the return values
are necessarily the same.  Things are worse for replacement functions;
as I understand it, they must use "value" for their final argument, but
the value has different meanings and types in different contexts.

Any suggestions or comments?

I've attached the .Rd file in case more specifics would help.
-- 
Ross Boylan                                      wk:  (415) 514-8146
185 Berry St #5700                               ross at biostat.ucsf.edu
Dept of Epidemiology and Biostatistics           fax: (415) 514-8150
University of California, San Francisco
San Francisco, CA 94107-1739                     hm:  (415) 550-1062
-------------- next part --------------
\name{runTime-accessors}
\alias{startTime}
\alias{endTime}
\alias{wallTime}
\alias{waitTime}
\alias{cpuTime}
\alias{mpirank}
\alias{mpirank<-}
\alias{remoteTime<-}
\title{ Accessors for runTime class}
\description{
  Set and get runTime related information.
}
\usage{
startTime(runTime)
endTime(runTime)
wallTime(runTime)
waitTime(runTime)
cpuTime(runTime)
mpirank(runTime)

mpirank(runTime) <- value
remoteTime(runTime) <- value
}
%- maybe also 'usage' for other objects documented here.
\arguments{
  \item{runTime}{a \code{runTime} object}
  \item{value}{for \code{mpirank}, the MPI rank of the associated job.
    For \code{remoteTime}, a vector of statistics from the remote processor: user
    cpu, system cpu, wall clock time for main job, wall clock time
    waiting for the root process.}
}
\details{
  All times are measured from start of job.  The sequence of events is
  that the job is created locally, started remotely, finished remotely,
  and completed locally.  Scheduling and transmission delays may occur.
  
  \item{startTime}{When the job was created, locally.}
  \item{endTime}{When job finished locally.}
  \item{wallTime}{How many seconds between local start and completion.}
  \item{cpuTime}{Remote cpu seconds used, both system and user.}
  \item{waitTime}{Remote seconds waiting for response from the local
    system after the remote computation finished.}
  \item{mpirank}{The rank of the execution unit that handled the remote computation.}
}
\value{
  Generally seconds, at a system-dependent resolution.
  \code{mpirank} is an integer.
  Replacement functions return the \code{runTime} object itself.
}
\author{Ross Boylan}
\note{Clients that use replacement functions should respect the semantics above.
}
\seealso{\code{\link{runTime-class}}}
\keyword{programming}
\keyword{environment}

From ross at biostat.ucsf.edu  Tue Sep 26 02:23:38 2006
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Tue, 26 Sep 2006 00:23:38 +0000
Subject: [Rd] S4 accessors (corrected)
In-Reply-To: <1159230049.7161.132.camel@iron.psg.net>
References: <1159230049.7161.132.camel@iron.psg.net>
Message-ID: <1159230218.7161.135.camel@iron.psg.net>

On Tue, 2006-09-26 at 00:20 +0000, Ross Boylan wrote:
> I have a small S4 class for which I've written a page grouping many of
> the accessors and replacement functions together.  I would be interested
> in people comments on the approach I've taken.
> 
> The code has a couple of decisions for which I could imagine
> alternatives.  First, even simple get/set operations on class elements
> are wrapped in functions.  I suppose I could just use myinstance at slot to
> do some of these operations, though that is considered bad style in more
> traditional OO contexts.
> 
> Second, even though the functions are tied to the class, I've defined
> them as free functions rather than methods.  I suppose I could create a
> generic that would reject most arguments, and then make methods
> appropriately.
> 
> For the documentation, I've created a single page that groups many of
> the functions together.  This is a bit awkward, since the return values
> are 
NOT
> necessarily the same.  Things are worse for replacement functions;
> as I understand it, they must use "value" for their final argument, but
> the value has different meanings and types in different contexts.
> 
> Any suggestions or comments?
> 
> I've attached the .Rd file in case more specifics would help.

Sorry!



From dsamperi at DecisionSynergy.com  Tue Sep 26 04:21:42 2006
From: dsamperi at DecisionSynergy.com (Dominick Samperi)
Date: Mon, 25 Sep 2006 22:21:42 -0400
Subject: [Rd] R CMD check and x11?
Message-ID: <45188EB6.7020905@DecisionSynergy.com>

One of my demos runs x11() so that I can resize the
window and avoid the "too large for margins" message
from plot. This seems to have a problematic side
effect.

When I run R CMD check on the package that demo
is displayed, because it appears as an example in
one of the man pages, and after this happens EVERY
demo that plots anything is displayed (probably because
they are in man pages).

Normally R CMD check does not cause anything to
be displayed, and this may cause problems if I submit
the package to CRAN.

Any pointers would be appreciated.

Thanks,

ds



From shtirlitz at verizon.net  Tue Sep 26 05:49:01 2006
From: shtirlitz at verizon.net (shtirlitz at verizon.net)
Date: Tue, 26 Sep 2006 05:49:01 +0200 (CEST)
Subject: [Rd] R script editor fails to read script longer then 1000 chars
	(non-English language settings) (PR#9254)
Message-ID: <20060926034901.21D584C921@slim.kubism.ku.dk>

Full_Name: Otto Shtirlitz
Version: 2.3.1
OS: Win XP SP2 
Submission from: (NULL) (71.102.102.246)


I believe it's the same situation as described in bug 9248. R script editor
cannot open file exceeding 1000 characters even if created in the same editor.
File is
all ANSI with symbols < 128 and with window line endings CR/LF (0x0D 0x0A).
The trick is the local settings : even if the OS is US if the language settings
for non-Unicode (Control Panel\Regional and Language options\Advanced\Language
for non-Unicode programs) is set to Russian in my case R only reads the first
1000 chars (and appends some garbage). If this setting is switched back to
English the problem goes away.



From sfalcon at fhcrc.org  Tue Sep 26 06:53:13 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Mon, 25 Sep 2006 21:53:13 -0700
Subject: [Rd] S4 accessors
In-Reply-To: <1159230049.7161.132.camel@iron.psg.net> (Ross Boylan's message
	of "Tue, 26 Sep 2006 00:20:49 +0000")
References: <1159230049.7161.132.camel@iron.psg.net>
Message-ID: <m2k63r2pqe.fsf@ziti.local>

Ross Boylan <ross at biostat.ucsf.edu> writes:
> The code has a couple of decisions for which I could imagine
> alternatives.  First, even simple get/set operations on class elements
> are wrapped in functions.  I suppose I could just use myinstance at slot to
> do some of these operations, though that is considered bad style in more
> traditional OO contexts.

I like the get/set approach as opposed to using '@'.  As long as users
don't use '@' you have a fair amount of flexibility to
redesign/refactor your code.

> Second, even though the functions are tied to the class, I've defined
> them as free functions rather than methods.  I suppose I could create a
> generic that would reject most arguments, and then make methods
> appropriately.

If anyone else is going to extend your classes, then you are doing
them a disservice by not making these proper methods.  It means that
you can control what happens when they are called on a subclass.  

> For the documentation, I've created a single page that groups many of
> the functions together.  This is a bit awkward, since the return values
> are necessarily the same.  Things are worse for replacement functions;
> as I understand it, they must use "value" for their final argument, but
> the value has different meanings and types in different contexts.
>
> Any suggestions or comments?

For accessors, I like to document them in the methods section of the
class documentation.

+ seth

--
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org



From hb at stat.berkeley.edu  Tue Sep 26 07:26:39 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Mon, 25 Sep 2006 22:26:39 -0700
Subject: [Rd] R CMD check and x11?
In-Reply-To: <45188EB6.7020905@DecisionSynergy.com>
References: <45188EB6.7020905@DecisionSynergy.com>
Message-ID: <59d7961d0609252226u3071d9d3r9fe88432ab20956f@mail.gmail.com>

You can close the x11() device using dev.off() in your example. You
may also want to look at interactive() so you can test in your example
is the code is run interactively or not; the latter is the case for R
CMD check.

/H

On 9/25/06, Dominick Samperi <dsamperi at decisionsynergy.com> wrote:
> One of my demos runs x11() so that I can resize the
> window and avoid the "too large for margins" message
> from plot. This seems to have a problematic side
> effect.
>
> When I run R CMD check on the package that demo
> is displayed, because it appears as an example in
> one of the man pages, and after this happens EVERY
> demo that plots anything is displayed (probably because
> they are in man pages).
>
> Normally R CMD check does not cause anything to
> be displayed, and this may cause problems if I submit
> the package to CRAN.
>
> Any pointers would be appreciated.
>
> Thanks,
>
> ds
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>



From ripley at stats.ox.ac.uk  Tue Sep 26 09:45:04 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 26 Sep 2006 08:45:04 +0100 (BST)
Subject: [Rd] (PR#9254)R script editor fails to read script longer then
 1000 chars (non-English language settings)
In-Reply-To: <20060926034901.21D584C921@slim.kubism.ku.dk>
References: <20060926034901.21D584C921@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0609260840080.15803@gannet.stats.ox.ac.uk>

Yes, thank you.  The conditions are that you are running in a locale with 
a different encoding from the system codepage, when a limit in graphapp 
was hit (so although the script is read correctly, it was not displayed 
correctly).

Fixed for 2.4.0.

On Tue, 26 Sep 2006, shtirlitz at verizon.net wrote:

> Full_Name: Otto Shtirlitz
> Version: 2.3.1
> OS: Win XP SP2
> Submission from: (NULL) (71.102.102.246)
>
>
> I believe it's the same situation as described in bug 9248. R script editor
> cannot open file exceeding 1000 characters even if created in the same editor.
> File is
> all ANSI with symbols < 128 and with window line endings CR/LF (0x0D 0x0A).
> The trick is the local settings : even if the OS is US if the language settings
> for non-Unicode (Control Panel\Regional and Language options\Advanced\Language
> for non-Unicode programs) is set to Russian in my case R only reads the first
> 1000 chars (and appends some garbage). If this setting is switched back to
> English the problem goes away.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From xianjun.dong at bccs.uib.no  Tue Sep 26 18:37:00 2006
From: xianjun.dong at bccs.uib.no (Xianjun Dong)
Date: Tue, 26 Sep 2006 18:37:00 +0200
Subject: [Rd] Not all functions work in RSPerl package?
In-Reply-To: <4512A2B2.1040007@wald.ucdavis.edu>
References: <1158847115.3966.21.camel@lauvtre.ii.uib.no>
	<4512A2B2.1040007@wald.ucdavis.edu>
Message-ID: <1159288621.19253.35.camel@lauvtre.ii.uib.no>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060926/5e2a0aee/attachment-0003.pl 

From rfrancois at mango-solutions.com  Tue Sep 26 18:56:54 2006
From: rfrancois at mango-solutions.com (Romain Francois)
Date: Tue, 26 Sep 2006 17:56:54 +0100
Subject: [Rd] modifs on ls
Message-ID: <45195BD6.8040208@mango-solutions.com>

Hi all,

It would be great to be able to use a syntax like :

R> ls("grid:::grid\.")

instead of :

R> ls("package:grid", pattern = "^grid\.")

Here is a modified version of `ls` that does the job. [ The only modifs 
are just after the if(!missing(name))  ]
Does that make sense ?

Cheers,

Romain


ls <- objects <-
    function (name, pos = -1, envir = as.environment(pos), all.names = 
FALSE,
              pattern)
{


    if (!missing(name)) {
       
        if(length(grep(":::", name))){
           spl <- strsplit(name, ":::")[[1]] 
           name <- paste("package:", spl[1] , sep="")
           pattern  <- paste("^", spl[2], sep="")
        }
       
       
        nameValue <- try(name)
        if(identical(class(nameValue), "try-error")) {
            name <- substitute(name)
            if (!is.character(name))
                name <- deparse(name)
            pos <- name
        }
        else
            pos <- nameValue
    }
    all.names <- .Internal(ls(envir, all.names))
   
  
   
    if (!missing(pattern)) {
       
        if ((ll <- length(grep("[", pattern, fixed=TRUE))) > 0 &&
            ll != length(grep("]", pattern, fixed=TRUE))) {
            if (pattern == "[") {
                pattern <- "\\["
                warning("replaced regular expression pattern '[' by  
'\\\\['")
            }
            else if (length(grep("[^\\\\]\\[<-", pattern) > 0)) {
                pattern <- sub("\\[<-", "\\\\\\[<-", pattern)
                warning("replaced '[<-' by '\\\\[<-' in regular 
expression pattern")
            }
        }
        grep(pattern, all.names, value = TRUE)
    }
    else all.names
}


-- 
*mangosolutions*
/data analysis that delivers/

Tel   +44 1249 467 467
Fax   +44 1249 467 468



From bill at insightful.com  Tue Sep 26 19:12:22 2006
From: bill at insightful.com (Bill Dunlap)
Date: Tue, 26 Sep 2006 10:12:22 -0700 (PDT)
Subject: [Rd] sprintf behavior (PR#9250)
In-Reply-To: <20060925094613.B5FB64C91E@slim.kubism.ku.dk>
References: <20060925094613.B5FB64C91E@slim.kubism.ku.dk>
Message-ID: <Pine.GSO.4.56.0609260959290.2640@durian.statsci.com>

On Mon, 25 Sep 2006 ripley at stats.ox.ac.uk wrote:

> On Mon, 25 Sep 2006, michael.bauer at lo-res.org wrote:
> ...
> > sprintf("\p") doesn't show the backslash, this occurs with all strings that
> > start with certain letters. There is however no explanation to this behavior.
>
> There is: see ?Quote (and C behaves in the same way).
>
> > And there seems to be no way to get a guaranteed backslash in sprintf.
>
> "\\", see the FAQ 7.8 for example.

Splus's parser emits a warning when it sees a backslash
outside of the recognized backslash sequence.  E.g.,

  > nchar("\Backslashed?")
  [1] 12
  Warning messages:
    The initial backslash is ignored in \B -- not a recognized escape sequence.
          Use \\ to make a backslash

You might want to add that warning to R's parser.  I've
seen the error in several R packages.  E.g.,

  bayesmix/R/JAGScontrol.R:  text[4] <- "-inits.R\"\n\initialize\n"
  SciViews/svDialogs/R/fixedDlg.wxPython.R:        if (length(grep("[\.]", basename(res))) == 0)

The warning is mostly emitted when the error is benign, but it
might help get people to think about what they are typing.

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."



From sfalcon at fhcrc.org  Tue Sep 26 19:43:22 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Tue, 26 Sep 2006 10:43:22 -0700
Subject: [Rd] S4 accessors
In-Reply-To: <1159291414.7161.143.camel@iron.psg.net> (Ross Boylan's message
	of "Tue, 26 Sep 2006 17:23:34 +0000")
References: <1159230049.7161.132.camel@iron.psg.net>
	<m2mz8n2prs.fsf@ziti.local> <1159291414.7161.143.camel@iron.psg.net>
Message-ID: <m21wpyzfph.fsf@ziti.local>

Ross Boylan <ross at biostat.ucsf.edu> writes:
> Did you want this offlist?  I'm happy keeping it on the list.

No, I accidentally responded privately and I believe I already resent
my reply to the list.  Sorry about that.  I've cc'd the list for this response.

>> If anyone else is going to extend your classes, then you are doing
>> them a disservice by not making these proper methods.  It means that
>> you can control what happens when they are called on a subclass. 

> My style has been to define a function, and then use setMethod if I want
> to redefine it for an extension.  That way the original version becomes
> the generic.
>
> So I don't see what I'm doing as being a barrier to adding methods.  Am
> I missing something?

You are not, but someone else might be: suppose you release your code
and I would like to extend it.  I am stuck until you decide to make
generics.

> Originally I tried defining the original using setMethod, but this
> generates a complaint about a missing function; that's one reason I fell
> into this style.

You have to create the generic first if it doesn't already exist:

   setGeneric("foo", function(x) standardGeneric("foo"))

>> For accessors, I like to document them in the methods section of the
>> class documentation.

> This is for accessors that really are methods, not my fake
> function-based accessors, right?

Which might be a further argument not to have the distinction in the
first place ;-)

To me, simple accessors are best documented with the class.  If I have
an instance, I will read help on it and find out what I can do with
it.  

> If you use foo as an accessor method, where do you define the associated
> function (i.e., \alias{foo})? I believe such a definition is expected by
> R CMD check and is desirable for users looking for help on foo (?foo)
> without paying attention to the fact it's a method.

Yes you need an alias for the _generic_ function.  You can either add
the alias to the class man page where one of its methods is documented
or you can have separate man pages for the generics.  This is
painful.  S4 documentation, in general, is rather difficult and IMO
this is in part a consequence of the more general (read more powerful)
generic function based system.

IOW, I think these are good questions.  They are ones that I struggle
with and do not know of any truly satisfying answers.

Best,

+ seth

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org



From ross at biostat.ucsf.edu  Tue Sep 26 21:34:58 2006
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Tue, 26 Sep 2006 19:34:58 +0000
Subject: [Rd] S4 accessors
In-Reply-To: <m21wpyzfph.fsf@ziti.local>
References: <1159230049.7161.132.camel@iron.psg.net>
	<m2mz8n2prs.fsf@ziti.local> <1159291414.7161.143.camel@iron.psg.net>
	<m21wpyzfph.fsf@ziti.local>
Message-ID: <1159299299.7161.239.camel@iron.psg.net>

On Tue, 2006-09-26 at 10:43 -0700, Seth Falcon wrote:
> Ross Boylan <ross at biostat.ucsf.edu> writes:

> >> If anyone else is going to extend your classes, then you are doing
> >> them a disservice by not making these proper methods.  It means that
> >> you can control what happens when they are called on a subclass. 
> 
> > My style has been to define a function, and then use setMethod if I want
> > to redefine it for an extension.  That way the original version becomes
> > the generic.
> >
> > So I don't see what I'm doing as being a barrier to adding methods.  Am
> > I missing something?
> 
> You are not, but someone else might be: suppose you release your code
> and I would like to extend it.  I am stuck until you decide to make
> generics.
This may be easier to do concretely.
I have an S4 class A.
I have defined a function foo that only operates on that class.
You make a class B that extends A.
You wish to give foo a different implementation for B.

Does anything prevent you from doing 
setMethod("foo", "B", function(x) blah blah)
(which is the same thing I do when I make a subclass)?
This turns my original foo into the catchall method.

Of course, foo is not appropriate for random objects, but that was true
even when it was a regular function.

> 
> > Originally I tried defining the original using setMethod, but this
> > generates a complaint about a missing function; that's one reason I fell
> > into this style.
> 
> You have to create the generic first if it doesn't already exist:
> 
>    setGeneric("foo", function(x) standardGeneric("foo"))
I wonder if it might be worth changing setMethod so that it does this by
default when no existing function exists. Personally, that would fit the
style I'm using better.
> 
> >> For accessors, I like to document them in the methods section of the
> >> class documentation.
> 
> > This is for accessors that really are methods, not my fake
> > function-based accessors, right?
> 
> Which might be a further argument not to have the distinction in the
> first place ;-)
> 
> To me, simple accessors are best documented with the class.  If I have
> an instance, I will read help on it and find out what I can do with
> it.  
> 
> > If you use foo as an accessor method, where do you define the associated
> > function (i.e., \alias{foo})? I believe such a definition is expected by
> > R CMD check and is desirable for users looking for help on foo (?foo)
> > without paying attention to the fact it's a method.
> 
> Yes you need an alias for the _generic_ function.  You can either add
> the alias to the class man page where one of its methods is documented
> or you can have separate man pages for the generics.  This is
> painful.  S4 documentation, in general, is rather difficult and IMO
> this is in part a consequence of the more general (read more powerful)
> generic function based system.
As my message indicates, I too am struggling with an appropriate
documentation style for S4 classes and methods.  Since "Writing R
Extensions" has said "Structure of and special markup for documenting S4
classes and methods are still under development." for as long as I cam
remember, perhaps I'm not the only one.

Some of the problem may reflect the tension between conventional OO and
functional languages, since R remains the latter even under S4.  I'm not
sure if it's the tools or my approach that is making things awkward; it
could be both!

Ross



From charles.dupont at vanderbilt.edu  Tue Sep 26 21:49:29 2006
From: charles.dupont at vanderbilt.edu (charles.dupont at vanderbilt.edu)
Date: Tue, 26 Sep 2006 21:49:29 +0200 (CEST)
Subject: [Rd] Infinite Loop when installing a package from source (PR#9258)
Message-ID: <20060926194929.AFF76281E5@slim.kubism.ku.dk>

Full_Name: Charles Dupont
Version: Version 2.3.1
OS: linux
Submission from: (NULL) (160.129.129.136)


I think that this is infinite.  I let it run for 30 minutes.  During which it
consumed 98% of my memory (1Gb) and steadily helled 90-99% of CPU.

Steps to reproduce problem

1. get a source package e.g. Hmisc.

2.
$ echo "library(Hmisc)" > Hmisc/R/test.R

3.
$ R CMD INSTALL -d -l Hmisc.Rcheck -d Hmisc

Here is the output of the call
'Rcmd INSTALL': in startdir= /home/dupontct/R with tmpdir=
/tmp/R.INSTALL.IO1457
   lib= '/home/dupontct/Hmisc.Rcheck', pkgs= ' "/home/dupontct/R/Hmisc"'
   before checking lockdir= '/home/dupontct/Hmisc.Rcheck/00LOCK'
   after checking lockdir
   build_help_opts= '--debug  --txt --html --latex --example'
'Rcmd INSTALL': now doing 'eval ... do_install':
* Installing *source* package 'Hmisc' ...
** libs
++ mkdir -p /home/dupontct/Hmisc.Rcheck/Hmisc/libs
++ test -f src/Makefile
++ cd src
+++ ls cidxcn.f cidxcp.f hoeffd.f jacklins.f largrec.f ranksort.c rcorr.f
string_box.c wclosest.f '*.cc' '*.cpp' '*.f90' '*.f95'
++ srcs='cidxcn.f
cidxcp.f
hoeffd.f
jacklins.f
largrec.f
ranksort.c
rcorr.f
string_box.c
wclosest.f'
+++ cd /usr/lib/R/bin/exec
+++ ls
++ archs=R
++ R_ARCH_keep=
++ test -n 'cidxcn.f
cidxcp.f
hoeffd.f
jacklins.f
largrec.f
ranksort.c
rcorr.f
string_box.c
wclosest.f'
++ test -x ../configure
++ for arch in '${archs}'
++ rm -f cidxcn.o cidxcp.o hoeffd.o jacklins.o largrec.o ranksort.o rcorr.o
string_box.o wclosest.o Hmisc.so '*.sl' '*.dylib'
++ test R = R
++ R_ARCH=
++ export R_ARCH
++ sh /usr/lib/R/bin/SHLIB -o Hmisc.so cidxcn.f cidxcp.f hoeffd.f jacklins.f
largrec.f ranksort.c rcorr.f string_box.c wclosest.f
gfortran   -fpic  -g -O2 -c cidxcn.f -o cidxcn.o
gfortran   -fpic  -g -O2 -c cidxcp.f -o cidxcp.o
gfortran   -fpic  -g -O2 -c hoeffd.f -o hoeffd.o
gfortran   -fpic  -g -O2 -c jacklins.f -o jacklins.o
gfortran   -fpic  -g -O2 -c largrec.f -o largrec.o
gcc -I/usr/share/R/include -I/usr/share/R/include     -fpic  -g -O2 -std=gnu99
-c ranksort.c -o ranksort.o
gfortran   -fpic  -g -O2 -c rcorr.f -o rcorr.o
gcc -I/usr/share/R/include -I/usr/share/R/include     -fpic  -g -O2 -std=gnu99
-c string_box.c -o string_box.o
gfortran   -fpic  -g -O2 -c wclosest.f -o wclosest.o
gcc -shared  -o Hmisc.so cidxcn.o cidxcp.o hoeffd.o jacklins.o largrec.o
ranksort.o rcorr.o string_box.o wclosest.o  -lgfortran -lm -lgcc_s
-L/usr/lib/R/lib -lR
++ cp Hmisc.so /home/dupontct/Hmisc.Rcheck/Hmisc/libs
++ R_ARCH=
++ cd ..
++ false
++ chmod 755 /home/dupontct/Hmisc.Rcheck/Hmisc/libs/Hmisc.so
++ true
++ set +x
** R
** inst
** preparing package for lazy loading
Loading required package: chron

Controll C administered here.  After Ctrl-C additional output followed.

Warning message:
use of NULL environment is deprecated
Error: unable to load R code in package 'Hmisc'
Error: unable to load R code in package 'Hmisc'
Error: unable to load R code in package 'Hmisc'
Error: unable to load R code in package 'Hmisc'
Error: unable to load R code in package 'Hmisc'
Error: unable to load R code in package 'Hmisc'
Error: unable to load R code in package 'Hmisc'
Error: unable to load R code in package 'Hmisc'
Error: unable to load R code in package 'Hmisc'
Error: unable to load R code in package 'Hmisc'
Error: unable to load R code in package 'Hmisc'
Execution halted
** Removing '/home/dupontct/Hmisc.Rcheck/Hmisc'

On further exploration I found that the problem resides in the 
tools:::code2LazyLoadDB function.  The call to sys.source falls into an infinite
loop when it tries to evaluate the line "library(Hmisc)" from the test.R file.



From spluque at gmail.com  Tue Sep 26 22:48:17 2006
From: spluque at gmail.com (Sebastian P. Luque)
Date: Tue, 26 Sep 2006 15:48:17 -0500
Subject: [Rd] standardization of slot access
Message-ID: <87y7s6bbhq.fsf@patagonia.sebmags.homelinux.org>

Hi,

I'm usually confused about when to use 'slot' or '@'.  I've frequently
read that it's always preferable to use accessor functions, so I would
think the '@' operator should be avoided.  However, ?slot contains the
following advise:


"Generally, the only reason to use the functional form rather than the
simpler operator is _because_ the slot name has to be computed."


How do we decide whether to use the function or the operator?


Cheers,

-- 
Seb



From ggrothendieck at gmail.com  Tue Sep 26 23:18:50 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 26 Sep 2006 17:18:50 -0400
Subject: [Rd] standardization of slot access
In-Reply-To: <87y7s6bbhq.fsf@patagonia.sebmags.homelinux.org>
References: <87y7s6bbhq.fsf@patagonia.sebmags.homelinux.org>
Message-ID: <971536df0609261418g1e2cf432yea64a0b539b2c6b9@mail.gmail.com>

I think the point is that if you use @ and then later redesign the
internals of the class so that that component is not longer stored
but is, instead, computed then @ will no longer be possible to
use in that instance and a method call will be required which means
that the internal change implies that the user interface must change.
Of course, that is undesirable.  In some programming languages
like Python one can access a variable and call a function using the
exact same syntax so that it would be possible to make such
an internal change without affecting the user.

On 9/26/06, Sebastian P. Luque <spluque at gmail.com> wrote:
> Hi,
>
> I'm usually confused about when to use 'slot' or '@'.  I've frequently
> read that it's always preferable to use accessor functions, so I would
> think the '@' operator should be avoided.  However, ?slot contains the
> following advise:
>
>
> "Generally, the only reason to use the functional form rather than the
> simpler operator is _because_ the slot name has to be computed."
>
>
> How do we decide whether to use the function or the operator?
>
>
> Cheers,
>
> --
> Seb
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



From rdpeng at gmail.com  Tue Sep 26 23:56:19 2006
From: rdpeng at gmail.com (Roger D. Peng)
Date: Tue, 26 Sep 2006 17:56:19 -0400
Subject: [Rd] standardization of slot access
In-Reply-To: <87y7s6bbhq.fsf@patagonia.sebmags.homelinux.org>
References: <87y7s6bbhq.fsf@patagonia.sebmags.homelinux.org>
Message-ID: <4519A203.10805@gmail.com>

I think slot() is only necessary in the case where you have

a <- "myslot"
slot(object, a)

which is equivalent to

object at myslot

It seems unlikely that you would use slot() during interactive use, but perhaps 
more so in programming.  Even still, I rather infrequently find the need for 
slot() because classes have defined slot names---if you're going to access a 
slot, just use the name that you gave it in the class definition since that 
doesn't change from instance to instance.

-roger

Sebastian P. Luque wrote:
> Hi,
> 
> I'm usually confused about when to use 'slot' or '@'.  I've frequently
> read that it's always preferable to use accessor functions, so I would
> think the '@' operator should be avoided.  However, ?slot contains the
> following advise:
> 
> 
> "Generally, the only reason to use the functional form rather than the
> simpler operator is _because_ the slot name has to be computed."
> 
> 
> How do we decide whether to use the function or the operator?
> 
> 
> Cheers,
> 

-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/



From tplate at acm.org  Wed Sep 27 01:04:53 2006
From: tplate at acm.org (Tony Plate)
Date: Tue, 26 Sep 2006 17:04:53 -0600
Subject: [Rd] standardization of slot access
In-Reply-To: <87y7s6bbhq.fsf@patagonia.sebmags.homelinux.org>
References: <87y7s6bbhq.fsf@patagonia.sebmags.homelinux.org>
Message-ID: <4519B215.7070205@acm.org>

I believe that the "accessor" functions you've read about are not the 
slot() function, rather they are functions specifically designed for 
extracting certain data from an object.  An example is the 'coef()' 
extractor function, which extracts coefficients from many model objects. 
  The name of the accessor function need not bear any resemblance to the 
actual name of the slot in which the data is stored, and indeed, there 
does not even need to be a one-to-one relationship between accessor 
functions and slots.

AFAIK, slot() and '@' can be regarded as syntactic variants (please 
correct me if I'm wrong).

-- Tony Plate

Sebastian P. Luque wrote:
> Hi,
> 
> I'm usually confused about when to use 'slot' or '@'.  I've frequently
> read that it's always preferable to use accessor functions, so I would
> think the '@' operator should be avoided.  However, ?slot contains the
> following advise:
> 
> 
> "Generally, the only reason to use the functional form rather than the
> simpler operator is _because_ the slot name has to be computed."
> 
> 
> How do we decide whether to use the function or the operator?
> 
> 
> Cheers,
>



From spluque at gmail.com  Wed Sep 27 01:58:22 2006
From: spluque at gmail.com (Sebastian P. Luque)
Date: Tue, 26 Sep 2006 18:58:22 -0500
Subject: [Rd] standardization of slot access
References: <87y7s6bbhq.fsf@patagonia.sebmags.homelinux.org>
	<4519B215.7070205@acm.org>
Message-ID: <87u02ub2ox.fsf@patagonia.sebmags.homelinux.org>

Thank you all for your comments, which confirm the feeling I had that
'slot' is only needed in the rare occasions Roger mentioned.  Although
'slot' is an accessor function, it seems it's not quite analogous to
functions or methods for accessing components of objects.


Cheers,

-- 
Seb



From Roger.Bivand at nhh.no  Wed Sep 27 08:26:10 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 27 Sep 2006 08:26:10 +0200 (CEST)
Subject: [Rd] standardization of slot access
In-Reply-To: <87u02ub2ox.fsf@patagonia.sebmags.homelinux.org>
Message-ID: <Pine.LNX.4.44.0609270821100.28375-100000@reclus.nhh.no>

On Tue, 26 Sep 2006, Sebastian P. Luque wrote:

> Thank you all for your comments, which confirm the feeling I had that
> 'slot' is only needed in the rare occasions Roger mentioned.  Although
> 'slot' is an accessor function, it seems it's not quite analogous to
> functions or methods for accessing components of objects.
> 

I find that slot() is useful in explaining to users what is going on. I 
also find that used inside s/lapply that say function(x) slot(x, "y") is a 
natural way to access contents of lists of objects. So I wouldn't conclude 
that it is only rarely used, and would recommend its use in explaining to 
students/users what is going on in new-style objects.

Roger

> 
> Cheers,
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From tom.mccallum at levelelimited.com  Wed Sep 27 10:18:13 2006
From: tom.mccallum at levelelimited.com (Tom McCallum)
Date: Wed, 27 Sep 2006 09:18:13 +0100
Subject: [Rd] time_t handling in R
Message-ID: <op.tgi2on1mffxks9@norisk>

Hello all,

I am converting some C code into a package for R and wondered what the  
proper way of handling time_t types from C in R was.  time_t is a typedef  
for long, but R seems to only deal in Integers or Reals, so what is the  
proper way of handling time in an R to C conversion ( or visa versa )?

Many thanks

Tom


-- 
Thomas McCallum
Systems Architect
LevelE Limited
Phone: 0131 - 4724813



From ripley at stats.ox.ac.uk  Wed Sep 27 11:10:49 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 27 Sep 2006 10:10:49 +0100 (BST)
Subject: [Rd] Warning on backslash sequences (was sprintf behavior)
In-Reply-To: <Pine.GSO.4.56.0609260959290.2640@durian.statsci.com>
References: <20060925094613.B5FB64C91E@slim.kubism.ku.dk>
	<Pine.GSO.4.56.0609260959290.2640@durian.statsci.com>
Message-ID: <Pine.LNX.4.64.0609270922370.19951@gannet.stats.ox.ac.uk>

On Tue, 26 Sep 2006, Bill Dunlap wrote:

> On Mon, 25 Sep 2006 ripley at stats.ox.ac.uk wrote:
>
>> On Mon, 25 Sep 2006, michael.bauer at lo-res.org wrote:
>> ...
>>> sprintf("\p") doesn't show the backslash, this occurs with all strings that
>>> start with certain letters. There is however no explanation to this behavior.
>>
>> There is: see ?Quotes (and C behaves in the same way).
>>
>>> And there seems to be no way to get a guaranteed backslash in sprintf.
>>
>> "\\", see the FAQ 7.8 for example.
>
> Splus's parser emits a warning when it sees a backslash
> outside of the recognized backslash sequence.  E.g.,
>
>  > nchar("\Backslashed?")
>  [1] 12
>  Warning messages:
>    The initial backslash is ignored in \B -- not a recognized escape sequence.
>          Use \\ to make a backslash
>
> You might want to add that warning to R's parser.  I've
> seen the error in several R packages.  E.g.,
>
>  bayesmix/R/JAGScontrol.R:  text[4] <- "-inits.R\"\n\initialize\n"
>  SciViews/svDialogs/R/fixedDlg.wxPython.R:        if (length(grep("[\.]", basename(res))) == 0)
>
> The warning is mostly emitted when the error is benign, but it
> might help get people to think about what they are typing.

I am not at all sure about this.  R's documentation says

      Backslash is used to start an escape sequence inside character
      constants. Unless specified in the following table, an escaped
      character is interpreted as the character itself. Single quotes
      need to be escaped by backslash in single-quoted strings, and
      double quotes in double-quoted strings.

        '\n'          newline
        '\r'          carriage return
        '\t'          tab
        '\b'          backspace
        '\a'          alert (bell)
        '\f'          form feed
        '\v'          vertical tab
        '\\'          backslash '\'
        '\nnn'        character with given octal code (1, 2 or 3 digits)
        '\xnn'        character with given hex code (1 or 2 hex digits)
        '\unnnn'      Unicode character with given code (1-4 hex digits)
        '\Unnnnnnnn'  Unicode character with given code (1-8 hex digits)

so it is not an error in R.  People tend not to like being warned about 
legitimate usage (and one can see this sort of thing being intentional in 
machine-generated scripts: for example to escape spaces in file paths 
and to escape line feeds).

What exactly does Splus's parser allow as intentional?

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From mtmorgan at fhcrc.org  Wed Sep 27 15:13:56 2006
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Wed, 27 Sep 2006 06:13:56 -0700
Subject: [Rd] colnames is slow for data.frames with implicit row.names
Message-ID: <6phu02tmoyz.fsf@gopher4.fhcrc.org>

colnames on a data.frame with implicit row.names

> df <- data.frame(x=1:6000000)

is slow

> system.time(colnames(df))
[1] 21.655  0.327 21.987  0.000  0.000
> system.time(names(df))
[1] 0 0 0 0 0

because colnames calls dimnames calls row.names.data.frame calls
as.character on the implicit row.names.
-- 
Martin T. Morgan
Bioconductor / Computational Biology
http://bioconductor.org



From ripley at stats.ox.ac.uk  Wed Sep 27 15:30:51 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 27 Sep 2006 14:30:51 +0100 (BST)
Subject: [Rd] colnames is slow for data.frames with implicit row.names
In-Reply-To: <6phu02tmoyz.fsf@gopher4.fhcrc.org>
References: <6phu02tmoyz.fsf@gopher4.fhcrc.org>
Message-ID: <Pine.LNX.4.64.0609271426220.17192@gannet.stats.ox.ac.uk>

On Wed, 27 Sep 2006, Martin Morgan wrote:

> colnames on a data.frame with implicit row.names
>
>> df <- data.frame(x=1:6000000)
>
> is slow
>
>> system.time(colnames(df))
> [1] 21.655  0.327 21.987  0.000  0.000
>> system.time(names(df))
> [1] 0 0 0 0 0
>
> because colnames calls dimnames calls row.names.data.frame calls
> as.character on the implicit row.names.

So use names() and not colnames():

    rownames and colnames for matrices
    row.names and names for data frames.

All colnames assumes is that there is a dimnames method: this could be 
relevant for objects inheriting from "data.frame", but there is a price 
for generality.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From mtmorgan at fhcrc.org  Wed Sep 27 15:45:32 2006
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Wed, 27 Sep 2006 06:45:32 -0700
Subject: [Rd] colnames is slow for data.frames with implicit row.names
In-Reply-To: <Pine.LNX.4.64.0609271426220.17192@gannet.stats.ox.ac.uk> (Brian
	Ripley's message of "Wed, 27 Sep 2006 14:30:51 +0100 (BST)")
References: <6phu02tmoyz.fsf@gopher4.fhcrc.org>
	<Pine.LNX.4.64.0609271426220.17192@gannet.stats.ox.ac.uk>
Message-ID: <6phpsdhmnib.fsf@gopher4.fhcrc.org>

Yes, obviously, with hindsight. In lieu of code change, the colnames
documentation could indicate the restricted sense of 'equivalent'.

  For a data frame, 'rownames' and 'colnames' are equivalent to
  'row.names' and 'names' respectively.
     
It might help to add 'names' to See Also of ?data.frame.

Martin

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> On Wed, 27 Sep 2006, Martin Morgan wrote:
>
>> colnames on a data.frame with implicit row.names
>>
>>> df <- data.frame(x=1:6000000)
>>
>> is slow
>>
>>> system.time(colnames(df))
>> [1] 21.655  0.327 21.987  0.000  0.000
>>> system.time(names(df))
>> [1] 0 0 0 0 0
>>
>> because colnames calls dimnames calls row.names.data.frame calls
>> as.character on the implicit row.names.
>
> So use names() and not colnames():
>
>     rownames and colnames for matrices
>     row.names and names for data frames.
>
> All colnames assumes is that there is a dimnames method: this could be
> relevant for objects inheriting from "data.frame", but there is a
> price for generality.
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-- 
Martin T. Morgan
Bioconductor / Computational Biology
http://bioconductor.org



From tlumley at u.washington.edu  Wed Sep 27 16:24:42 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Wed, 27 Sep 2006 07:24:42 -0700 (PDT)
Subject: [Rd] time_t handling in R
In-Reply-To: <op.tgi2on1mffxks9@norisk>
References: <op.tgi2on1mffxks9@norisk>
Message-ID: <Pine.LNX.4.64.0609270720400.10316@homer21.u.washington.edu>

On Wed, 27 Sep 2006, Tom McCallum wrote:

> Hello all,
>
> I am converting some C code into a package for R and wondered what the
> proper way of handling time_t types from C in R was.  time_t is a typedef
> for long, but R seems to only deal in Integers or Reals, so what is the
> proper way of handling time in an R to C conversion ( or visa versa )?
>

time_t is not portably a typedef for long, or even for an integer type 
(according to the C standard).  If it is an integer type on your system 
then you can pass it as a vector of integer (and on many systems long and 
int are the same so one integer will suffice)

 	-thomas



From jmc at r-project.org  Wed Sep 27 16:32:53 2006
From: jmc at r-project.org (John Chambers)
Date: Wed, 27 Sep 2006 10:32:53 -0400
Subject: [Rd] S4 accessors
In-Reply-To: <1159299299.7161.239.camel@iron.psg.net>
References: <1159230049.7161.132.camel@iron.psg.net>
	<m2mz8n2prs.fsf@ziti.local> <1159291414.7161.143.camel@iron.psg.net>
	<m21wpyzfph.fsf@ziti.local> <1159299299.7161.239.camel@iron.psg.net>
Message-ID: <451A8B95.8050406@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060927/110a6f57/attachment-0003.pl 

From gantonaci at gmail.com  Wed Sep 27 16:46:15 2006
From: gantonaci at gmail.com (Giuseppe Antonaci)
Date: Wed, 27 Sep 2006 11:46:15 -0300
Subject: [Rd] Building R-2.3.1 for Windows with ATLAS
Message-ID: <41b60e190609270746s50090ae9o62cbaac5ce856859@mail.gmail.com>

Ok, moved to R-devel.

I tried to build R-2.3.1. Since I intent to distribute this tuned R to
all other who have a computer like mine here at work I thought it was
best to stay with the latest stable release.

About your suggestion, I could'n find xerblas.o file. And I don't know
how to edit libf77blas.a. I tried to open it with VIM
(http://vim.sf.net/) but there was a lot of strange symbols (expected,
I think), either way I found a reference to xerblas.o inside it but
didn't know what to do with this reference.
Thanks,
Giuseppe Antonaci

On 26/09/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On Tue, 26 Sep 2006, Giuseppe Antonaci wrote:
>
> > I think this is not a R-devel question. Sorry to all if I'm wrong,
> > please let me know.
>
> In what sense is this not a programming question?
>
> > I managed to build R successfully with the default BLAS but when I
> > change the MKRULES to use ATLAS BLAS and set the path to
> > "C:/cygwin/home/Administrador/ATLAS/lib/WinNT_ATHLONSSE2" I got the
> > following error message (I'm posting only the final part, there was a
> > lot of compilation before this):
> >
> > cp R.dll ../../bin/
> > -------- Building ../../bin/Rblas.dll --------
> > gcc  -shared -s -o ../../bin/Rblas.dll blas00.o dllversion.o Rblas.def \
> >   -L../../bin -lR  -L"C:/WinNT_ATHLONSSE2" -lf77blas -latlas
>
> What version of R is this?  I get
>
> -------- Building ../../../bin/Rblas.dll --------
> gcc  -shared  -o ../../../bin/Rblas.dll blas00.o
> ../../gnuwin32/dllversion.o Rbl
> as.def \
>     -L../../../bin -lR  -L"/R/ATLAS/lib/WinNT_PM" -lf77blas -latlas -lg2c
>                                                                     ^^^^^
> in R-2.4.0 RC.
>
> You probably should not need it: you need to build ATLAS without xerbla (R
> has its own), so delete xerbla.o from libf77blas.a and all should be well.
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>

I managed to build R-2.3.1 successfully with the default BLAS but when I
change the MKRULES to use ATLAS BLAS and set the path to
"C:/WinNT_ATHLONSSE2" I got the
following error message (I'm posting only the final part, there was a
lot of compilation before this):

cp R.dll ../../bin/
-------- Building ../../bin/Rblas.dll --------
gcc  -shared -s -o ../../bin/Rblas.dll blas00.o dllversion.o Rblas.def \
  -L../../bin -lR  -L"C:/WinNT_ATHLONSSE2" -lf77blas -latlas
C:/WinNT_ATHLONSSE2/libf77blas.a(xerbla.o):xerbla.f:(.text+0xb): undefined refer
ence to `s_wsfe'
C:/WinNT_ATHLONSSE2/libf77blas.a(xerbla.o):xerbla.f:(.text+0x27): undefined refe
rence to `do_fio'
C:/WinNT_ATHLONSSE2/libf77blas.a(xerbla.o):xerbla.f:(.text+0x43): undefined refe
rence to `do_fio'
C:/WinNT_ATHLONSSE2/libf77blas.a(xerbla.o):xerbla.f:(.text+0x48): undefined refe
rence to `e_wsfe'
C:/WinNT_ATHLONSSE2/libf77blas.a(xerbla.o):xerbla.f:(.text+0x5c): undefined refe
rence to `s_stop'
collect2: ld returned 1 exit status
make[2]: *** [../../bin/Rblas.dll] Error 1
make[1]: *** [rbuild] Error 2
make: *** [all] Error 2

The ATLAS BLAS was build using Cygwin. AFTER building ATLAS BLAS I
changed the "Path" variable putting "C:\Rtools\tools\bin;C:\MinGW\bin"
before everything else.
To build R I followed "R Administration and Instalation" and Duncan
Murdoch's guide at http://www.murdoch-sutherland.com/Rtools/,
including the version of MinGW.

At ATLAS web page (http://math-atlas.sourceforge.net/errata.html) I
found the following:

Q: I'm linking with C, and getting missing symbols (such as w_wsfe,
do_fio, w_esfe or s_stop).
R: These kinds of symbols are Fortran library calls. The problem is
that the C linker does not automatically find the Fortran libraries.
The most common fix is to either link using your fortran linker, or to
rewrite your code so that Fortran routines are not called. If you know
where they are, you can also choose to link in the Fortran libraries
explicitly

Well, I think this answers my question but I didn't understand the
answer (and it was not because it is in English). Unfortunately I know
nothing of C or Fortran. Even if I
knew that I have these Fortran libraries I wouldn't know how to link
them. I tried to look at MinGW web page but found nothing.
Any help would be mostly welcome, please.
Giuseppe Antonaci



From ripley at stats.ox.ac.uk  Wed Sep 27 16:55:26 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 27 Sep 2006 15:55:26 +0100 (BST)
Subject: [Rd] Building R-2.3.1 for Windows with ATLAS
In-Reply-To: <41b60e190609270746s50090ae9o62cbaac5ce856859@mail.gmail.com>
References: <41b60e190609270746s50090ae9o62cbaac5ce856859@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0609271547360.28533@gannet.stats.ox.ac.uk>

On Wed, 27 Sep 2006, Giuseppe Antonaci wrote:

> Ok, moved to R-devel.
>
> I tried to build R-2.3.1. Since I intent to distribute this tuned R to
> all other who have a computer like mine here at work I thought it was
> best to stay with the latest stable release.

Which is 2.4.0 RC.

> About your suggestion, I could'n find xerblas.o file. And I don't know
> how to edit libf77blas.a. I tried to open it with VIM
> (http://vim.sf.net/) but there was a lot of strange symbols (expected,
> I think), either way I found a reference to xerblas.o inside it but
> didn't know what to do with this reference.

Well, I said xerbla.o, not xerblas.o.

You edit library archives with ar, something like

ar d libf77blas.a xerbla.o



> Thanks,
> Giuseppe Antonaci
>
> On 26/09/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>> On Tue, 26 Sep 2006, Giuseppe Antonaci wrote:
>> 
>> > I think this is not a R-devel question. Sorry to all if I'm wrong,
>> > please let me know.
>> 
>> In what sense is this not a programming question?
>> 
>> > I managed to build R successfully with the default BLAS but when I
>> > change the MKRULES to use ATLAS BLAS and set the path to
>> > "C:/cygwin/home/Administrador/ATLAS/lib/WinNT_ATHLONSSE2" I got the
>> > following error message (I'm posting only the final part, there was a
>> > lot of compilation before this):
>> >
>> > cp R.dll ../../bin/
>> > -------- Building ../../bin/Rblas.dll --------
>> > gcc  -shared -s -o ../../bin/Rblas.dll blas00.o dllversion.o Rblas.def \
>> >   -L../../bin -lR  -L"C:/WinNT_ATHLONSSE2" -lf77blas -latlas
>> 
>> What version of R is this?  I get
>> 
>> -------- Building ../../../bin/Rblas.dll --------
>> gcc  -shared  -o ../../../bin/Rblas.dll blas00.o
>> ../../gnuwin32/dllversion.o Rbl
>> as.def \
>>     -L../../../bin -lR  -L"/R/ATLAS/lib/WinNT_PM" -lf77blas -latlas -lg2c
>>                                                                     ^^^^^
>> in R-2.4.0 RC.
>> 
>> You probably should not need it: you need to build ATLAS without xerbla (R
>> has its own), so delete xerbla.o from libf77blas.a and all should be well.
>> 
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>> 
>
> I managed to build R-2.3.1 successfully with the default BLAS but when I
> change the MKRULES to use ATLAS BLAS and set the path to
> "C:/WinNT_ATHLONSSE2" I got the
> following error message (I'm posting only the final part, there was a
> lot of compilation before this):
>
> cp R.dll ../../bin/
> -------- Building ../../bin/Rblas.dll --------
> gcc  -shared -s -o ../../bin/Rblas.dll blas00.o dllversion.o Rblas.def \
> -L../../bin -lR  -L"C:/WinNT_ATHLONSSE2" -lf77blas -latlas
> C:/WinNT_ATHLONSSE2/libf77blas.a(xerbla.o):xerbla.f:(.text+0xb): undefined 
> refer
> ence to `s_wsfe'
> C:/WinNT_ATHLONSSE2/libf77blas.a(xerbla.o):xerbla.f:(.text+0x27): undefined 
> refe
> rence to `do_fio'
> C:/WinNT_ATHLONSSE2/libf77blas.a(xerbla.o):xerbla.f:(.text+0x43): undefined 
> refe
> rence to `do_fio'
> C:/WinNT_ATHLONSSE2/libf77blas.a(xerbla.o):xerbla.f:(.text+0x48): undefined 
> refe
> rence to `e_wsfe'
> C:/WinNT_ATHLONSSE2/libf77blas.a(xerbla.o):xerbla.f:(.text+0x5c): undefined 
> refe
> rence to `s_stop'
> collect2: ld returned 1 exit status
> make[2]: *** [../../bin/Rblas.dll] Error 1
> make[1]: *** [rbuild] Error 2
> make: *** [all] Error 2
>
> The ATLAS BLAS was build using Cygwin. AFTER building ATLAS BLAS I
> changed the "Path" variable putting "C:\Rtools\tools\bin;C:\MinGW\bin"
> before everything else.
> To build R I followed "R Administration and Instalation" and Duncan
> Murdoch's guide at http://www.murdoch-sutherland.com/Rtools/,
> including the version of MinGW.
>
> At ATLAS web page (http://math-atlas.sourceforge.net/errata.html) I
> found the following:
>
> Q: I'm linking with C, and getting missing symbols (such as w_wsfe,
> do_fio, w_esfe or s_stop).
> R: These kinds of symbols are Fortran library calls. The problem is
> that the C linker does not automatically find the Fortran libraries.
> The most common fix is to either link using your fortran linker, or to
> rewrite your code so that Fortran routines are not called. If you know
> where they are, you can also choose to link in the Fortran libraries
> explicitly
>
> Well, I think this answers my question but I didn't understand the
> answer (and it was not because it is in English). Unfortunately I know
> nothing of C or Fortran. Even if I
> knew that I have these Fortran libraries I wouldn't know how to link
> them. I tried to look at MinGW web page but found nothing.
> Any help would be mostly welcome, please.
> Giuseppe Antonaci
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From bill at insightful.com  Wed Sep 27 17:20:27 2006
From: bill at insightful.com (Bill Dunlap)
Date: Wed, 27 Sep 2006 08:20:27 -0700 (PDT)
Subject: [Rd] Warning on backslash sequences (was sprintf behavior)
In-Reply-To: <Pine.LNX.4.64.0609270922370.19951@gannet.stats.ox.ac.uk>
References: <20060925094613.B5FB64C91E@slim.kubism.ku.dk>
	<Pine.GSO.4.56.0609260959290.2640@durian.statsci.com>
	<Pine.LNX.4.64.0609270922370.19951@gannet.stats.ox.ac.uk>
Message-ID: <Pine.GSO.4.56.0609270750050.3216@durian.statsci.com>

> > Splus's parser emits a warning when it sees a backslash
> > outside of the recognized backslash sequence.  E.g.,
> >
> >  > nchar("\Backslashed?")
> >  [1] 12
> >  Warning messages:
> >    The initial backslash is ignored in \B -- not a recognized escape sequence.
> >          Use \\ to make a backslash
> >
> > You might want to add that warning to R's parser.  I've
> > seen the error in several R packages.  E.g.,
> >
> >  bayesmix/R/JAGScontrol.R:  text[4] <- "-inits.R\"\n\initialize\n"
> >  SciViews/svDialogs/R/fixedDlg.wxPython.R:        if (length(grep("[\.]", basename(res))) == 0)
> >
> > The warning is mostly emitted when the error is benign, but it
> > might help get people to think about what they are typing.
>
> I am not at all sure about this.  R's documentation says
>  ...
>         '\n'          newline
>         '\r'          carriage return
>         '\t'          tab
>         '\b'          backspace
>         '\a'          alert (bell)
>         '\f'          form feed
>         '\v'          vertical tab
>         '\\'          backslash '\'
>         '\nnn'        character with given octal code (1, 2 or 3 digits)
>         '\xnn'        character with given hex code (1 or 2 hex digits)
>         '\unnnn'      Unicode character with given code (1-4 hex digits)
>         '\Unnnnnnnn'  Unicode character with given code (1-8 hex digits)
>
> so it is not an error in R.  People tend not to like being warned about
> legitimate usage (and one can see this sort of thing being intentional in
> machine-generated scripts: for example to escape spaces in file paths
> and to escape line feeds).

We had that same sort of argument here, but enough people were
asking our support people about the matter that we put in
the warning.  As I said, the warning is odd in that it warns
about legitimate usage in the hopes that people will know to
use "\\" for a backslash when they need to.

> What exactly does Splus's parser allow as intentional?

Splus currently "supports" (does not warn about)
    \nnn  (1-3 octal digits)
    \n, \t, \b, \r, \', \", and \`
We do not support the \f, \v, \xnn, \unnnn, or \Unnnnnnnn.
We should add the \f, \v, \a, and \xnn (as well as 0xnn for integers),
but we overlooked those.  (Adding new backslash sequences is relatively
safe: we have been warning about unrecognized \f's for for years so
we shouldn't expect to find too many folks using \f where they intended
either \\f or f.)

We don't support unicode so we won't do anything with the \unnnn or
\Unnnnnnnn.  That is something Splus does need to warn about to aid in
porting stuff from R.

Neither of the examples I showed cause any ill effect,
but using the grep pattern of '[\.]' shows that he
doesn't know that dots are taken literally inside of
square brackets in regular expressions and the use of
"\." outside of brackets would give incorrect results.

> >  bayesmix/R/JAGScontrol.R:  text[4] <- "-inits.R\"\n\initialize\n"
> >  SciViews/svDialogs/R/fixedDlg.wxPython.R:        if (length(grep("[\.]", basename(res))) == 0)

In SciViews I also see
   command <- sub("view\.[A-Za-z0-9\._]+[(]", "view(", command)
which is almost certainly wrong and I suspect that its
   cat(";for Options\AutoIndent: 0=Off, 1=follow language scoping and 2=copy from previous line\n",
wants an extra \ before AutoIndent.

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."



From sfalcon at fhcrc.org  Wed Sep 27 17:34:38 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Wed, 27 Sep 2006 08:34:38 -0700
Subject: [Rd] S4 accessors
In-Reply-To: <451A8B95.8050406@r-project.org> (John Chambers's message of "Wed,
	27 Sep 2006 10:32:53 -0400")
References: <1159230049.7161.132.camel@iron.psg.net>
	<m2mz8n2prs.fsf@ziti.local> <1159291414.7161.143.camel@iron.psg.net>
	<m21wpyzfph.fsf@ziti.local> <1159299299.7161.239.camel@iron.psg.net>
	<451A8B95.8050406@r-project.org>
Message-ID: <m24putmigh.fsf@ziti.local>

John Chambers <jmc at r-project.org> writes:

> There is a point that needs to be remembered in discussions of
> accessor functions (and more generally).
>
> We're working with a class/method mechanism in a _functional_
> language.  Simple analogies made from class-based languages such as
> Java are not always good guides.
>
> In the example below, "a function foo that only operates on that
> class" is not usually a meaningful concept in R.   

If foo is a generic and the only method defined is for class Bar, then
the statement seems meaningful enough?

> Functions are first-class objects and in principle every function
> should have a "function", a purpose.  Methods implement that purpose
> for particular combinations of arguments.
>
> Accessor functions are therefore a bit anomalous.  

How?  A given accessor function has the purpose of returning the
expected data "contained" in an instance.  It provides an abstract
interface that decouples the structure of the class from the data it
needs to provide to users.

The anomaly, is IMO, a much larger challenge with generic function
based systems.  When the same name for a generic is used in different
packages, you end up with a masking problem.  This scenario is
unavoidable in general, but particularly likely, for accessors.  As S4
becomes more prevalent, I suspect that '<pkg>::foo' is going to become
a required idiom for interactive use (other options are available for
package code).

+ seth



From jmc at r-project.org  Wed Sep 27 20:08:34 2006
From: jmc at r-project.org (John Chambers)
Date: Wed, 27 Sep 2006 14:08:34 -0400
Subject: [Rd] S4 accessors
In-Reply-To: <m24putmigh.fsf@ziti.local>
References: <1159230049.7161.132.camel@iron.psg.net>
	<m2mz8n2prs.fsf@ziti.local> <1159291414.7161.143.camel@iron.psg.net>
	<m21wpyzfph.fsf@ziti.local> <1159299299.7161.239.camel@iron.psg.net>
	<451A8B95.8050406@r-project.org> <m24putmigh.fsf@ziti.local>
Message-ID: <451ABE22.90401@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060927/5ddf5e9c/attachment-0003.pl 

From vincent.goulet at act.ulaval.ca  Wed Sep 27 22:02:43 2006
From: vincent.goulet at act.ulaval.ca (Vincent Goulet)
Date: Wed, 27 Sep 2006 16:02:43 -0400
Subject: [Rd] S3 methods for cbind/rbind
Message-ID: <200609271602.43138.vincent.goulet@act.ulaval.ca>

I created a type of object similar to a data frame. In some circumstances, It 
needs special methods for "[" and "[<-" and rbind() (but not cbind()). Then I 
found this in the cbind()/rbind() man page:

     The method dispatching is _not_ done via 'UseMethod()', but by
     C-internal dispatching. Therefore, there is no need for, e.g.,
     'rbind.default'.

This seems to imply I cannot add my own method. Is there 1) a workaround to 
and 2) a rationale for this? (Other than creating a generic Rbind() or 
whatever, that is.)

I'm using S3 methods.

Thanks in advance!

-- 
  Vincent Goulet, Associate Professor
  ?cole d'actuariat
  Universit? Laval, Qu?bec 
  Vincent.Goulet at act.ulaval.ca   http://vgoulet.act.ulaval.ca



From ggrothendieck at gmail.com  Wed Sep 27 22:16:14 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 27 Sep 2006 16:16:14 -0400
Subject: [Rd] S3 methods for cbind/rbind
In-Reply-To: <200609271602.43138.vincent.goulet@act.ulaval.ca>
References: <200609271602.43138.vincent.goulet@act.ulaval.ca>
Message-ID: <971536df0609271316t70f328b3mff010628817c7125@mail.gmail.com>

Actually you can add your own method.  See

library(zoo)
rbind.zoo

for an example.

On 9/27/06, Vincent Goulet <vincent.goulet at act.ulaval.ca> wrote:
> I created a type of object similar to a data frame. In some circumstances, It
> needs special methods for "[" and "[<-" and rbind() (but not cbind()). Then I
> found this in the cbind()/rbind() man page:
>
>     The method dispatching is _not_ done via 'UseMethod()', but by
>     C-internal dispatching. Therefore, there is no need for, e.g.,
>     'rbind.default'.
>
> This seems to imply I cannot add my own method. Is there 1) a workaround to
> and 2) a rationale for this? (Other than creating a generic Rbind() or
> whatever, that is.)
>
> I'm using S3 methods.
>
> Thanks in advance!
>
> --
>  Vincent Goulet, Associate Professor
>  ?cole d'actuariat
>  Universit? Laval, Qu?bec
>  Vincent.Goulet at act.ulaval.ca   http://vgoulet.act.ulaval.ca
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



From vincent.goulet at act.ulaval.ca  Wed Sep 27 22:24:02 2006
From: vincent.goulet at act.ulaval.ca (Vincent Goulet)
Date: Wed, 27 Sep 2006 16:24:02 -0400
Subject: [Rd] S3 methods for cbind/rbind
In-Reply-To: <971536df0609271316t70f328b3mff010628817c7125@mail.gmail.com>
References: <200609271602.43138.vincent.goulet@act.ulaval.ca>
	<971536df0609271316t70f328b3mff010628817c7125@mail.gmail.com>
Message-ID: <200609271624.02523.vincent.goulet@act.ulaval.ca>

Hum. Then, I need to be more accurate. My object is of class 
c("bar", "data.frame"). So, by virtue of ...

     The dispatch algorithm is described in the source file
     ('.../src/main/bind.c') as

        1.  For each argument we get the list of possible class
           memberships from the class attribute.

        2.  We inspect each class in turn to see if there is an an
           applicable method.

... rbind(foo) is never sent to rbind.bar(). So I guess my questions stand.

Le Mercredi 27 Septembre 2006 16:16, Gabor Grothendieck a ?crit?:
> Actually you can add your own method.  See
>
> library(zoo)
> rbind.zoo
>
> for an example.
>
> On 9/27/06, Vincent Goulet <vincent.goulet at act.ulaval.ca> wrote:
> > I created a type of object similar to a data frame. In some
> > circumstances, It needs special methods for "[" and "[<-" and rbind()
> > (but not cbind()). Then I found this in the cbind()/rbind() man page:
> >
> >     The method dispatching is _not_ done via 'UseMethod()', but by
> >     C-internal dispatching. Therefore, there is no need for, e.g.,
> >     'rbind.default'.
> >
> > This seems to imply I cannot add my own method. Is there 1) a workaround
> > to and 2) a rationale for this? (Other than creating a generic Rbind() or
> > whatever, that is.)
> >
> > I'm using S3 methods.
> >
> > Thanks in advance!
> >
> > --
> >  Vincent Goulet, Associate Professor
> >  ?cole d'actuariat
> >  Universit? Laval, Qu?bec
> >  Vincent.Goulet at act.ulaval.ca   http://vgoulet.act.ulaval.ca
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
  Vincent Goulet, Associate Professor
  ?cole d'actuariat
  Universit? Laval, Qu?bec 
  Vincent.Goulet at act.ulaval.ca   http://vgoulet.act.ulaval.ca



From ggrothendieck at gmail.com  Wed Sep 27 23:02:07 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 27 Sep 2006 17:02:07 -0400
Subject: [Rd] S3 methods for cbind/rbind
In-Reply-To: <200609271624.02523.vincent.goulet@act.ulaval.ca>
References: <200609271602.43138.vincent.goulet@act.ulaval.ca>
	<971536df0609271316t70f328b3mff010628817c7125@mail.gmail.com>
	<200609271624.02523.vincent.goulet@act.ulaval.ca>
Message-ID: <971536df0609271402l11365a7bie8c74bd32d96493b@mail.gmail.com>

Maybe you could use rbind2, which has an S4 generic in the methods
package, instead?

# BOD is a data frame built into R
foo <- structure(BOD, class = c("bar", "data.frame"))
setOldClass("bar")
setMethod("rbind2", signature(x = "bar", y = "bar"),
	  function(x, y) {
		cat("Hello!\n")
		class(x) <- class(y) <- "data.frame"
		rbind(x, y)
	})

# test
foo <- structure(BOD, class = c("bar", "data.frame"))
rbind2(foo, foo)


On 9/27/06, Vincent Goulet <vincent.goulet at act.ulaval.ca> wrote:
> Hum. Then, I need to be more accurate. My object is of class
> c("bar", "data.frame"). So, by virtue of ...
>
>     The dispatch algorithm is described in the source file
>     ('.../src/main/bind.c') as
>
>        1.  For each argument we get the list of possible class
>           memberships from the class attribute.
>
>        2.  We inspect each class in turn to see if there is an an
>           applicable method.
>
> ... rbind(foo) is never sent to rbind.bar(). So I guess my questions stand.
>
> Le Mercredi 27 Septembre 2006 16:16, Gabor Grothendieck a ?crit:
> > Actually you can add your own method.  See
> >
> > library(zoo)
> > rbind.zoo
> >
> > for an example.
> >
> > On 9/27/06, Vincent Goulet <vincent.goulet at act.ulaval.ca> wrote:
> > > I created a type of object similar to a data frame. In some
> > > circumstances, It needs special methods for "[" and "[<-" and rbind()
> > > (but not cbind()). Then I found this in the cbind()/rbind() man page:
> > >
> > >     The method dispatching is _not_ done via 'UseMethod()', but by
> > >     C-internal dispatching. Therefore, there is no need for, e.g.,
> > >     'rbind.default'.
> > >
> > > This seems to imply I cannot add my own method. Is there 1) a workaround
> > > to and 2) a rationale for this? (Other than creating a generic Rbind() or
> > > whatever, that is.)
> > >
> > > I'm using S3 methods.
> > >
> > > Thanks in advance!
> > >
> > > --
> > >  Vincent Goulet, Associate Professor
> > >  ?cole d'actuariat
> > >  Universit? Laval, Qu?bec
> > >  Vincent.Goulet at act.ulaval.ca   http://vgoulet.act.ulaval.ca
> > >
> > > ______________________________________________
> > > R-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-devel
>
> --
>  Vincent Goulet, Associate Professor
>  ?cole d'actuariat
>  Universit? Laval, Qu?bec
>  Vincent.Goulet at act.ulaval.ca   http://vgoulet.act.ulaval.ca
>



From hb at stat.berkeley.edu  Thu Sep 28 00:00:06 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Wed, 27 Sep 2006 15:00:06 -0700
Subject: [Rd] S4 accessors
In-Reply-To: <451A8B95.8050406@r-project.org>
References: <1159230049.7161.132.camel@iron.psg.net>
	<m2mz8n2prs.fsf@ziti.local> <1159291414.7161.143.camel@iron.psg.net>
	<m21wpyzfph.fsf@ziti.local> <1159299299.7161.239.camel@iron.psg.net>
	<451A8B95.8050406@r-project.org>
Message-ID: <59d7961d0609271500g7f3adf37q87187311d9b277ee@mail.gmail.com>

On 9/27/06, John Chambers <jmc at r-project.org> wrote:
> There is a point that needs to be remembered in discussions of accessor
> functions (and more generally).
>
> We're working with a class/method mechanism in a _functional_ language.
> Simple analogies made from class-based languages such as Java are not
> always good guides.
>
> In the example below, "a function foo that only operates on that class"
> is not usually a meaningful concept in R.   Whereas in Java a method can
> only be invoked "on" an object, given the syntax of the Java language, R
> (that is, the S language) is different.  You can intend a function to be
> used only on one class, but that isn't normally the way to think about R
> software.
>
> Functions are first-class objects and in principle every function should
> have a "function", a purpose.  Methods implement that purpose for
> particular combinations of arguments.
>
> Accessor functions are therefore a bit anomalous.  If they had a
> standard syntactic pattern, say get_foo(object), then it would be more
> reasonable to think that you're just defining a method for that function
> for a given class that happens to have a slot with the particular name,
> "foo".
>
> Also, slot-setting functions will be different in R because we deal with
> objects, not object references as in Java.  An R-like naming convention
> would be something along the lines of
>   set_foo(object) <- value
> but in any case one will need to use replacement functions to conform to
> the way assignments work.

In the Object class system of the R.oo package I have for years worked
successfully with what I call virtual fields.  I find them really
useful and convenient to work with.

These works as follows, if there is a get<Field>(object) function,
this is called whenever object$<field> is called.  If there is no such
function, the internal field '<field>' is access (from the environment
where all fields live in).  Similarily, object$<field> <- value check
for set<Field>(object, value), which is called if available. [I work
with environments/references so my set functions don't really have to
be replacement functions, but there is nothing preventing them from
being such.]

There are several advantages doing it this way.  You can protect
fields behind a set function, e.g. preventing assignment of negative
values and similar, e.g.

  circle$radius <- -5
  Error: Negative radius: -5

You can also provide redundant fields in your API, e.g.

  circle$radius <- 5
  print(circle$diameter)
  circle$area <- 4
  print(circle$radius)

and so on. How the circle is represented internally does not matter
and may change over time. With such a design you don't have to worry
as a software developer; the API is stable.  I think this schema
carries over perfectly to S4 and '@'.

FYI: I used the above naming convention because I did this way before
the '_' operator was redefined.

Comment: If you don't want the user to access a slot/field directly, I
recommend to name the slot with a period prefix, e.g. '.radius'.  This
gives at least the user the chance to understand your design although
it does not prevent them to misuse it.  The period prefix is also
"standard" for "private" object, cf. ls(all.names=FALSE/TRUE).

/Henrik

>
> Ross Boylan wrote:
> > On Tue, 2006-09-26 at 10:43 -0700, Seth Falcon wrote:
> >
> >> Ross Boylan <ross at biostat.ucsf.edu> writes:
> >>
> >
> >
> >>>> If anyone else is going to extend your classes, then you are doing
> >>>> them a disservice by not making these proper methods.  It means that
> >>>> you can control what happens when they are called on a subclass.
> >>>>
> >>> My style has been to define a function, and then use setMethod if I want
> >>> to redefine it for an extension.  That way the original version becomes
> >>> the generic.
> >>>
> >>> So I don't see what I'm doing as being a barrier to adding methods.  Am
> >>> I missing something?
> >>>
> >> You are not, but someone else might be: suppose you release your code
> >> and I would like to extend it.  I am stuck until you decide to make
> >> generics.
> >>
> > This may be easier to do concretely.
> > I have an S4 class A.
> > I have defined a function foo that only operates on that class.
> > You make a class B that extends A.
> > You wish to give foo a different implementation for B.
> >
> > Does anything prevent you from doing
> > setMethod("foo", "B", function(x) blah blah)
> > (which is the same thing I do when I make a subclass)?
> > This turns my original foo into the catchall method.
> >
> > Of course, foo is not appropriate for random objects, but that was true
> > even when it was a regular function.
> >
> >
> >>> Originally I tried defining the original using setMethod, but this
> >>> generates a complaint about a missing function; that's one reason I fell
> >>> into this style.
> >>>
> >> You have to create the generic first if it doesn't already exist:
> >>
> >>    setGeneric("foo", function(x) standardGeneric("foo"))
> >>
> > I wonder if it might be worth changing setMethod so that it does this by
> > default when no existing function exists. Personally, that would fit the
> > style I'm using better.
> >
> >>>> For accessors, I like to document them in the methods section of the
> >>>> class documentation.
> >>>>
> >>> This is for accessors that really are methods, not my fake
> >>> function-based accessors, right?
> >>>
> >> Which might be a further argument not to have the distinction in the
> >> first place ;-)
> >>
> >> To me, simple accessors are best documented with the class.  If I have
> >> an instance, I will read help on it and find out what I can do with
> >> it.
> >>
> >>
> >>> If you use foo as an accessor method, where do you define the associated
> >>> function (i.e., \alias{foo})? I believe such a definition is expected by
> >>> R CMD check and is desirable for users looking for help on foo (?foo)
> >>> without paying attention to the fact it's a method.
> >>>
> >> Yes you need an alias for the _generic_ function.  You can either add
> >> the alias to the class man page where one of its methods is documented
> >> or you can have separate man pages for the generics.  This is
> >> painful.  S4 documentation, in general, is rather difficult and IMO
> >> this is in part a consequence of the more general (read more powerful)
> >> generic function based system.
> >>
> > As my message indicates, I too am struggling with an appropriate
> > documentation style for S4 classes and methods.  Since "Writing R
> > Extensions" has said "Structure of and special markup for documenting S4
> > classes and methods are still under development." for as long as I cam
> > remember, perhaps I'm not the only one.
> >
> > Some of the problem may reflect the tension between conventional OO and
> > functional languages, since R remains the latter even under S4.  I'm not
> > sure if it's the tools or my approach that is making things awkward; it
> > could be both!
> >
> > Ross
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>



From ross at biostat.ucsf.edu  Thu Sep 28 00:01:37 2006
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Wed, 27 Sep 2006 15:01:37 -0700
Subject: [Rd] S4 accessors
In-Reply-To: <451ABE22.90401@r-project.org>
References: <1159230049.7161.132.camel@iron.psg.net>
	<m2mz8n2prs.fsf@ziti.local>
	<1159291414.7161.143.camel@iron.psg.net>
	<m21wpyzfph.fsf@ziti.local>
	<1159299299.7161.239.camel@iron.psg.net>
	<451A8B95.8050406@r-project.org> <m24putmigh.fsf@ziti.local>
	<451ABE22.90401@r-project.org>
Message-ID: <20060927220137.GA29358@wheat.betterworld.us>

I'm trying to understand what the underlying issues are here--with the
immediate goal of how that affects my design and documentation
decisions.

On Wed, Sep 27, 2006 at 02:08:34PM -0400, John Chambers wrote:
> Seth Falcon wrote:
> > John Chambers <jmc at r-project.org> writes:
> >
> >   
> >> There is a point that needs to be remembered in discussions of
> >> accessor functions (and more generally).
> >>
> >> We're working with a class/method mechanism in a _functional_
> >> language.  Simple analogies made from class-based languages such as
> >> Java are not always good guides.
> >>
> >> In the example below, "a function foo that only operates on that
> >> class" is not usually a meaningful concept in R.   

The sense of "meaningful" here is hard for me to pin down, even with
the subsequent discussion.

I think the import is more than formal: R is not strongly typed, so
you can hand any argument to any function and the language will not
complain.

> >>     
> >
> > If foo is a generic and the only method defined is for class Bar, then
> > the statement seems meaningful enough?
> >   
> 
> This is not primarily a question about implementation but about what the 
> user understands.   IMO, a function should have an intuitive meaning to 
> the user.  Its name is taking up a "global" place in the user's brain, 
> and good software design says not to overload users with too many 
> arbitrary names to remember.

It's true that clashing uses of the same name may lead to confusion,
but that need not imply that functions must be applicable to all
objects.  Many functions only make sense in particular contexts, and
sometimes those contexts are quite narrow.

One of the usual motivations for an OO approach is precisely to limit
the amount of global space taken up by, for example, functions that
operate on the class (global in both the syntactic sense and in the
inside your brain sense).  Understanding a traditional OO system, at
least for me, is fundamentally oriented to understanding the objects
first, with the operations on them as auxiliaries.  As you point out,
this is just different from the orientation of a functional language,
which starts with the functions.

> 
> To be a bit facetious, if "flag is a slot in class Bar, it's really not 
> a good idea to define the accessor for that slot as
>  flag <- function(object)object at flag
> 
> Nor is the situation much improved by having flag() be a generic, with 
> the only method being for class Bar.  We're absconding with a word that 
> users might think has a general meaning.  OK, if need be we will have 
> different flag() functions in different packages that have _different_ 
> intuitive interpretations, but it seems to me that we should try to 
> avoid that problem when we can.
> 
> OTOH, it's not such an imposition to have accessor functions with a 
> syntax that includes the name of the slot in a standardized way:
>   get_flag(object)
> (I don't have any special attachment to this convention, it's just there 
> for an example)

I don't see why get_flag differs from flag; if "flag" lends itself to
multiple interpretations or meanings, wouldn't "get_flag" have the
same problem?

Or are you referring to the fact that "flag" sounds as if it's a verb
or action?  That's a significant ambiguity, but there's nothing about
it that is specific to a functional approach.

>   
> >   
> >> Functions are first-class objects and in principle every function
> >> should have a "function", a purpose.  Methods implement that purpose
> >> for particular combinations of arguments.
> >>

If this is a claim that every function should make sense for every
object, it's asking too much.  If it's not, I don't really see how a
function can avoid having a purpose.  The purpose of accessor
functions is to get or set the state of the object.

> >> Accessor functions are therefore a bit anomalous.  
> >>     
> >
> > How?  A given accessor function has the purpose of returning the
> > expected data "contained" in an instance.  It provides an abstract
> > interface that decouples the structure of the class from the data it
> > needs to provide to users.
> >   
> 
> See above.  That's true _if_ the name or some other syntactic sugar 
> makes it clear the this is indeed an accessor function, but not otherwise.

Aside from the fact that I don't see why get_flag is so different from
flag, the syntactic sugar argument has another problem.  The usually
conceived purpose of accessors is to hide from the client the
internals of the object.  To take an example that's pretty close to
one of my classes, I want startTime, endTime, and duration.
Internally, the object only needs to hold 2 of these quantities to get
the 3rd, but I don't want the client code to be aware of which choice
I made.  In particular, I don't what the client code to change from 
duration to get_duration if I switch to a representation that stored
the duration as a slot.

Ross



From fparlamis at mac.com  Thu Sep 28 01:21:53 2006
From: fparlamis at mac.com (Parlamis Franklin)
Date: Wed, 27 Sep 2006 13:21:53 -1000
Subject: [Rd] potential setClass bug (with user-defined environment)
Message-ID: <8C366DB3-D98A-4938-B756-C3694DDCEBCF@mac.com>

the following returns an error in an 'exists' call on my machine

MyEnv <- new.env()
setClass("Numeric", "numeric", where=MyEnv)

franklin parlamis

 > version
                _
platform       powerpc-apple-darwin8.7.0
arch           powerpc
os             darwin8.7.0
system         powerpc, darwin8.7.0
status         beta
major          2
minor          4.0
year           2006
month          09
day            22
svn rev        39471
language       R
version.string R version 2.4.0 beta (2006-09-22 r39471)



From watplatt at us.ibm.com  Thu Sep 28 02:08:41 2006
From: watplatt at us.ibm.com (watplatt at us.ibm.com)
Date: Thu, 28 Sep 2006 02:08:41 +0200 (CEST)
Subject: [Rd] 'St9bad_alloc' (PR#9261)
Message-ID: <20060928000841.2DFF74BE88@slim.kubism.ku.dk>

Full_Name: Daniel E. Platt
Version: 2.3.1
OS: Win/XP - Cygwin
Submission from: (NULL) (68.198.10.240)


Error report: 

terminate called after throwing an instance of 'St9bad_alloc'
  what():  St9bad_alloc
Aborted (core dumped)

No indication of what the calling routine was, where the request came from, etc.
 Am I simply requesting memory where non is available?

Dan



From mtmorgan at fhcrc.org  Thu Sep 28 04:18:31 2006
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Wed, 27 Sep 2006 19:18:31 -0700
Subject: [Rd] potential setClass bug (with user-defined environment)
In-Reply-To: <8C366DB3-D98A-4938-B756-C3694DDCEBCF@mac.com> (Parlamis
	Franklin's message of "Wed, 27 Sep 2006 13:21:53 -1000")
References: <8C366DB3-D98A-4938-B756-C3694DDCEBCF@mac.com>
Message-ID: <6phu02sd98o.fsf@gopher4.fhcrc.org>

A previous report (no resolution) here:

https://stat.ethz.ch/pipermail/r-devel/2006-August/038896.html

I guess that's two of us with at least a passing encounter with this!

Martin

Parlamis Franklin <fparlamis at mac.com> writes:

> the following returns an error in an 'exists' call on my machine
>
> MyEnv <- new.env()
> setClass("Numeric", "numeric", where=MyEnv)
>
> franklin parlamis
>
>  > version
>                 _
> platform       powerpc-apple-darwin8.7.0
> arch           powerpc
> os             darwin8.7.0
> system         powerpc, darwin8.7.0
> status         beta
> major          2
> minor          4.0
> year           2006
> month          09
> day            22
> svn rev        39471
> language       R
> version.string R version 2.4.0 beta (2006-09-22 r39471)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin T. Morgan
Bioconductor / Computational Biology
http://bioconductor.org



From pbautist2 at yahoo.com.mx  Thu Sep 28 04:29:30 2006
From: pbautist2 at yahoo.com.mx (Patricia Bautista)
Date: Wed, 27 Sep 2006 21:29:30 -0500 (CDT)
Subject: [Rd] eval(SEXP fn,SEXP rho) in C++ code
Message-ID: <20060928022930.39335.qmail@web32709.mail.mud.yahoo.com>

Hi r-devel, 

I am working on a R extension. I am writing the
function in C++, and in my function it is required a R
function object from the user. This R function object
will be evaluated thousand of times in my C++ code. I
generated the shared library and I loaded it on R. I
did several experiments in order to compare the speed
of my compiled code vs the speed of the equivalent
interpreted code. I was surprise!, the better was  the
interpreted code!. Then, I ask myself: What is the
benefit of compiled code??.  I think my problem is in
using the function "eval(SEXP f, SEXP rho)" because it
takes time!. Am I right?. Then, can someone tell me
what  the benefit of using compiled code is?, or can
someone give me a reference to look into?.

Thanks in advanced,
Patricia B.



From sfalcon at fhcrc.org  Thu Sep 28 04:53:34 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Wed, 27 Sep 2006 19:53:34 -0700
Subject: [Rd] eval(SEXP fn,SEXP rho) in C++ code
In-Reply-To: <20060928022930.39335.qmail@web32709.mail.mud.yahoo.com>
	(Patricia Bautista's message of "Wed,
	27 Sep 2006 21:29:30 -0500 (CDT)")
References: <20060928022930.39335.qmail@web32709.mail.mud.yahoo.com>
Message-ID: <m2lko48zwx.fsf@ziti.local>

Patricia Bautista <pbautist2 at yahoo.com.mx> writes:

> Hi r-devel, 
>
> I am working on a R extension. I am writing the
> function in C++, and in my function it is required a R
> function object from the user. This R function object
> will be evaluated thousand of times in my C++ code. I
> generated the shared library and I loaded it on R. I
> did several experiments in order to compare the speed
> of my compiled code vs the speed of the equivalent
> interpreted code. I was surprise!, the better was  the
> interpreted code!. Then, I ask myself: What is the
> benefit of compiled code??.  I think my problem is in
> using the function "eval(SEXP f, SEXP rho)" because it
> takes time!. Am I right?. Then, can someone tell me
> what  the benefit of using compiled code is?, or can
> someone give me a reference to look into?.

If you use eval in C you are doing effectively the same thing as at
the interpreter (R) level.

The benefit of doing computations in C comes from making direct calls
to R's C API, avoiding duplication (copy of R objects), etc.

+ seth



From ripley at stats.ox.ac.uk  Thu Sep 28 08:16:57 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Thu, 28 Sep 2006 08:16:57 +0200 (CEST)
Subject: [Rd] (PR#9248) Incomplete loading of files into Windows script
Message-ID: <20060928061657.D4E3F4BE85@slim.kubism.ku.dk>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--27464147-762791266-1159424200=:16565
Content-Type: TEXT/PLAIN; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 8BIT

This does look exactly like PR#9254, and I am unable to reproduce it on a 
patched version.  The patch is in r39516, so later than the version you 
tried.

On Thu, 28 Sep 2006, Klaus Thul(WAT & Device-?\?J?j) wrote:

> Dear Prof. Ripley,
>
> Sorry for late reply: your mail didn't get through the spam filter of my 
> Email provider.
>
> I saw that comment that is might be the same as PR#9254 and fixed. 
> Therefore I tried the latest snapshot binary build (2.5.0 r39503) but 
> the behavior is unchanged.
>
> Regarding your questions to reproduce the bug:
> 1) I read the file using Windows menu "File -> Open script..."
> 2+3) Attached an example file; reading the file stops after ~1000 characters.
>
> Regarding locale: I am located in Taiwan and using a "Taiwanese" laptop, but switched my windows language settings to English.
> During startup, R displays: "Natural language support but running in an English locale".
>
> Please let me know if you need further information.
>
> Best regards,
> Klaus
>
>
> Date: Sun, 24 Sep 2006 07:07:24 +0100 (BST)
> From: Prof Brian Ripley <ripley at stats.ox.ac.uk>
> To: klaus.thul at mac.com
> Cc: R-bugs at biostat.ku.dk
> Subject: Re: [Rd] (PR#9248) Incomplete loading of files into Windows script
>
> Please, we do need complete reproduction instructions (and not
> speculation) as the FAQ asks.
>
> 1) How exactly did you read the file in?
> 2) 'longer' than what?
> 3) What line ending is this?
>
> I've just tried loading a 1000-line 50kb file using the 'Open Script' menu
> item, and it worked with CRLF, LF or CR line endings.
>
> Some guesses are that there are control characters in the file or an
> encoding problem (what is your locale?).
>
>
> On Sun, 24 Sep 2006, klaus.thul at mac.com wrote:
>
>> Full_Name: Klaus Thul
>> Version: R2.3.1 (CRAN binary for Windows)
>> OS: Windows XP
>> Submission from: (NULL) (220.132.142.175)
>>
>>
>> When I read a longer text file created on Mac OS X into the built-in script
>> editor of R for windows, it is read only incomplete. The same file can be
> loaded
>> without problem e. g. into WordPad.
>>
>> I think the reason for the behavior is that Mac OS X uses different EOL
> markers,
>> and R for windows doesn't handle these markers correctly. I don't have
> access to
>> an UNIX/LINUX system, but I guess files generated on these systems will
> cause
>> the same problem.
>>
>> I can provide an example file which fails if necessary.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595
--27464147-762791266-1159424200=:16565--



From ripley at stats.ox.ac.uk  Thu Sep 28 08:22:27 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Thu, 28 Sep 2006 08:22:27 +0200 (CEST)
Subject: [Rd] 'St9bad_alloc' (PR#9261)
Message-ID: <20060928062227.6F0934BE88@slim.kubism.ku.dk>

This is not how Windows reports errors, and there are no reproduction 
instructions.  Please do study the section on BUGS in the FAQ.

If this was a report on a Windows build of R, see the rw-FAQ on how to get 
useful debugging information.

This look suspiciously like a report from C++ code.  There is no C++ in R, 
but there might be in a package you were using.

It seems unlikely this is a bug in R itself.

On Thu, 28 Sep 2006, watplatt at us.ibm.com wrote:

> Full_Name: Daniel E. Platt
> Version: 2.3.1
> OS: Win/XP - Cygwin
> Submission from: (NULL) (68.198.10.240)
>
>
> Error report:
>
> terminate called after throwing an instance of 'St9bad_alloc'
>  what():  St9bad_alloc
> Aborted (core dumped)
>
> No indication of what the calling routine was, where the request came from, etc.
> Am I simply requesting memory where non is available?
>
> Dan
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From ahenningsen at agric-econ.uni-kiel.de  Thu Sep 28 13:36:49 2006
From: ahenningsen at agric-econ.uni-kiel.de (Arne Henningsen)
Date: Thu, 28 Sep 2006 13:36:49 +0200
Subject: [Rd] R CMD build when the package name is different from the
	directory name
Message-ID: <200609281336.49794.ahenningsen@agric-econ.uni-kiel.de>

Hi,

I was really happy when I saw that in R version 2.3.0 "R CMD check" works for 
packages whose package name is different from the directory name in which it 
is located (see http://cran.r-project.org/src/base/NEWS). 
Now, I can have branches of my packages in directories like 
"[...]/branches/<version number>/", while I had to use 
"[...]/branches/<version number>/<package name>" before. 
"R CMD check <version number>" runs as expected but when I build the package 
with "R CMD build <version number>", the file name of the source package is 
"<version number>_<version number>-<patch level>.tar.gz" (and not "<package 
name>_<version number>-<patch level>.tar.gz"). Furthermore the base directory 
inside the .tar.gz archive is "<version number>" (and not "<package name>").

Is there a possibility to tell "R CMD build" to use the correct package name 
("R CMD check" uses the correct package name.) Can you change the (default) 
behaviour of "R CMD build" in future releases?

Do I have to change the file name and/or the name of the base directory before 
uploading the package to CRAN?

I use R version 2.3.1 (2006-06-01) on i686-pc-linux-gnu.
The same happens with R version 2.4.0 RC.

Thanks,
Arne

-- 
Arne Henningsen
Department of Agricultural Economics
University of Kiel
Olshausenstr. 40
D-24098 Kiel (Germany)
Tel: +49-431-880 4445
Fax: +49-431-880 1397
ahenningsen at agric-econ.uni-kiel.de
http://www.uni-kiel.de/agrarpol/ahenningsen/



From btyner at gmail.com  Thu Sep 28 15:15:46 2006
From: btyner at gmail.com (Benjamin Tyner)
Date: Thu, 28 Sep 2006 09:15:46 -0400
Subject: [Rd] unloadNamespace inside .Last.lib
Message-ID: <451BCB02.6000306@stat.purdue.edu>

In my package's zzz.R, I put

.Last.lib <- function(libpath) {
    unloadNamespace("mypackage")
}

and I exported .Last.lib in NAMESPACE, with the intent that detaching 
the package would also cause the name space to be unloaded. However, the 
result of detach("package:mypackage") is then

Error: evaluation nested too deeply: infinite recursion / 
options(expressions=)?<environment: namespace:mypackage>
<environment: namespace:mypackage>
Error in library.dynam.unload("mypackage", libpath) :
        shared library 'mypackage' was not loaded
Error in as.character(<environment>) : cannot coerce to vector
Error in unregisterNamespace(nsname) : name space not registered
<environment: namespace:mypackage>
Error in library.dynam.unload("mypackage", libpath) :
        shared library 'mypackage' was not loaded
Error in as.character(<environment>) : cannot coerce to vector
Error in unregisterNamespace(nsname) : name space not registered
<environment: namespace:mypackage>
Error in library.dynam.unload("mypackage", libpath) :
        shared library 'mypackage' was not loaded
Error in as.character(<environment>) : cannot coerce to vector
Error in unregisterNamespace(nsname) : name space not registered
<environment: namespace:mypackage>
Error in library.dynam.unload("mypackage", libpath) :
        shared library 'mypackage' was not loaded
Error in as.character(<environment>) : cannot coerce to vector
Error in unregisterNamespace(nsname) : name space not registered
<environment: namespace:mypackage>
Error in library.dynam.unload("mypackage", libpath) :
        shared library 'mypackage' was not loaded
Error in as.character(<environment>) : cannot coerce to vector
Error in unregisterNamespace(nsname) : name space not registered
<environment: namespace:mypackage>
Error in library.dynam.unload("mypackage", libpath) :
        shared library 'mypackage' was not loaded
Error in as.character(<environment>) : cannot coerce to vector
Error in unregisterNamespace(nsname) : name space not registered
<environment: namespace:mypackage>
Error in library.dynam.unload("mypackage", libpath) :
        shared library 'mypackage' was not loaded
Error in as.character(<environment>) : cannot coerce to vector
Error in unregisterNamespace(nsname) : name space not registered
Error in detach(pos) : detaching "package:base" is not allowed
Error in detach(pos) : detaching "package:base" is not allowed
Error in detach(pos) : detaching "package:base" is not allowed


With a hundred more or so of the last error. What is the correct way (if 
any) to unload a name space using detach() alone ?

Thanks,
Ben



From ggrothendieck at gmail.com  Thu Sep 28 15:30:21 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 28 Sep 2006 09:30:21 -0400
Subject: [Rd] R CMD build when the package name is different from the
	directory name
In-Reply-To: <200609281336.49794.ahenningsen@agric-econ.uni-kiel.de>
References: <200609281336.49794.ahenningsen@agric-econ.uni-kiel.de>
Message-ID: <971536df0609280630n20755e70s3ad0614b7eaa3f2f@mail.gmail.com>

Another possibility is to store your code in svn or other version
control system.

On 9/28/06, Arne Henningsen <ahenningsen at agric-econ.uni-kiel.de> wrote:
> Hi,
>
> I was really happy when I saw that in R version 2.3.0 "R CMD check" works for
> packages whose package name is different from the directory name in which it
> is located (see http://cran.r-project.org/src/base/NEWS).
> Now, I can have branches of my packages in directories like
> "[...]/branches/<version number>/", while I had to use
> "[...]/branches/<version number>/<package name>" before.
> "R CMD check <version number>" runs as expected but when I build the package
> with "R CMD build <version number>", the file name of the source package is
> "<version number>_<version number>-<patch level>.tar.gz" (and not "<package
> name>_<version number>-<patch level>.tar.gz"). Furthermore the base directory
> inside the .tar.gz archive is "<version number>" (and not "<package name>").
>
> Is there a possibility to tell "R CMD build" to use the correct package name
> ("R CMD check" uses the correct package name.) Can you change the (default)
> behaviour of "R CMD build" in future releases?
>
> Do I have to change the file name and/or the name of the base directory before
> uploading the package to CRAN?
>
> I use R version 2.3.1 (2006-06-01) on i686-pc-linux-gnu.
> The same happens with R version 2.4.0 RC.
>
> Thanks,
> Arne
>
> --
> Arne Henningsen
> Department of Agricultural Economics
> University of Kiel
> Olshausenstr. 40
> D-24098 Kiel (Germany)
> Tel: +49-431-880 4445
> Fax: +49-431-880 1397
> ahenningsen at agric-econ.uni-kiel.de
> http://www.uni-kiel.de/agrarpol/ahenningsen/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



From ripley at stats.ox.ac.uk  Thu Sep 28 15:40:16 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 28 Sep 2006 14:40:16 +0100 (BST)
Subject: [Rd] Warning on backslash sequences (was sprintf behavior)
In-Reply-To: <Pine.GSO.4.56.0609270750050.3216@durian.statsci.com>
References: <20060925094613.B5FB64C91E@slim.kubism.ku.dk>
	<Pine.GSO.4.56.0609260959290.2640@durian.statsci.com>
	<Pine.LNX.4.64.0609270922370.19951@gannet.stats.ox.ac.uk>
	<Pine.GSO.4.56.0609270750050.3216@durian.statsci.com>
Message-ID: <Pine.LNX.4.64.0609271718410.18168@gannet.stats.ox.ac.uk>

Thanks, Bill, that is helpful.

I've been running a prototype across R itself and CRAN.  It is clear that 
we do have lots of strings with escaped newlines (the escape is generated 
in the parser if there is an embedded newline) so they need to be an 
exception.  On my first version 99 CRAN packages got picked up on this, 
but about 40 are problems with escaped newlines only (often from 
inst/CITATION files).

I don't understand why \` is regarded as intentional.  It crops up in 
packages date and survival (the same code) in

        stop(paste("\`", .Generic, "' not meaningful for dates",
                    sep = ""))

which clearly should use sQuote(.Generic) in R, but there seems no reason 
to escape in either R or Splus.

On Wed, 27 Sep 2006, Bill Dunlap wrote:

>>> Splus's parser emits a warning when it sees a backslash
>>> outside of the recognized backslash sequence.  E.g.,
>>>
>>> > nchar("\Backslashed?")
>>>  [1] 12
>>>  Warning messages:
>>>    The initial backslash is ignored in \B -- not a recognized escape sequence.
>>>          Use \\ to make a backslash
>>>
>>> You might want to add that warning to R's parser.  I've
>>> seen the error in several R packages.  E.g.,
>>>
>>>  bayesmix/R/JAGScontrol.R:  text[4] <- "-inits.R\"\n\initialize\n"
>>>  SciViews/svDialogs/R/fixedDlg.wxPython.R:        if (length(grep("[\.]", basename(res))) == 0)
>>>
>>> The warning is mostly emitted when the error is benign, but it
>>> might help get people to think about what they are typing.
>>
>> I am not at all sure about this.  R's documentation says
>>  ...
>>         '\n'          newline
>>         '\r'          carriage return
>>         '\t'          tab
>>         '\b'          backspace
>>         '\a'          alert (bell)
>>         '\f'          form feed
>>         '\v'          vertical tab
>>         '\\'          backslash '\'
>>         '\nnn'        character with given octal code (1, 2 or 3 digits)
>>         '\xnn'        character with given hex code (1 or 2 hex digits)
>>         '\unnnn'      Unicode character with given code (1-4 hex digits)
>>         '\Unnnnnnnn'  Unicode character with given code (1-8 hex digits)
>>
>> so it is not an error in R.  People tend not to like being warned about
>> legitimate usage (and one can see this sort of thing being intentional in
>> machine-generated scripts: for example to escape spaces in file paths
>> and to escape line feeds).
>
> We had that same sort of argument here, but enough people were
> asking our support people about the matter that we put in
> the warning.  As I said, the warning is odd in that it warns
> about legitimate usage in the hopes that people will know to
> use "\\" for a backslash when they need to.
>
>> What exactly does Splus's parser allow as intentional?
>
> Splus currently "supports" (does not warn about)
>    \nnn  (1-3 octal digits)
>    \n, \t, \b, \r, \', \", and \`
> We do not support the \f, \v, \xnn, \unnnn, or \Unnnnnnnn.
> We should add the \f, \v, \a, and \xnn (as well as 0xnn for integers),
> but we overlooked those.  (Adding new backslash sequences is relatively
> safe: we have been warning about unrecognized \f's for for years so
> we shouldn't expect to find too many folks using \f where they intended
> either \\f or f.)
>
> We don't support unicode so we won't do anything with the \unnnn or
> \Unnnnnnnn.  That is something Splus does need to warn about to aid in
> porting stuff from R.
>
> Neither of the examples I showed cause any ill effect,
> but using the grep pattern of '[\.]' shows that he
> doesn't know that dots are taken literally inside of
> square brackets in regular expressions and the use of
> "\." outside of brackets would give incorrect results.
>
>>>  bayesmix/R/JAGScontrol.R:  text[4] <- "-inits.R\"\n\initialize\n"
>>>  SciViews/svDialogs/R/fixedDlg.wxPython.R:        if (length(grep("[\.]", basename(res))) == 0)
>
> In SciViews I also see
>   command <- sub("view\.[A-Za-z0-9\._]+[(]", "view(", command)
> which is almost certainly wrong and I suspect that its
>   cat(";for Options\AutoIndent: 0=Off, 1=follow language scoping and 2=copy from previous line\n",
> wants an extra \ before AutoIndent.
>
> ----------------------------------------------------------------------------
> Bill Dunlap
> Insightful Corporation
> bill at insightful dot com
> 360-428-8146
>
> "All statements in this message represent the opinions of the author and do
> not necessarily reflect Insightful Corporation policy or position."
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From ggrothendieck at gmail.com  Thu Sep 28 15:55:27 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 28 Sep 2006 09:55:27 -0400
Subject: [Rd] Warning on backslash sequences (was sprintf behavior)
In-Reply-To: <Pine.LNX.4.64.0609271718410.18168@gannet.stats.ox.ac.uk>
References: <20060925094613.B5FB64C91E@slim.kubism.ku.dk>
	<Pine.GSO.4.56.0609260959290.2640@durian.statsci.com>
	<Pine.LNX.4.64.0609270922370.19951@gannet.stats.ox.ac.uk>
	<Pine.GSO.4.56.0609270750050.3216@durian.statsci.com>
	<Pine.LNX.4.64.0609271718410.18168@gannet.stats.ox.ac.uk>
Message-ID: <971536df0609280655t63ce8be2ie159aba2e6539bc4@mail.gmail.com>

One area where a problem might appear is if one is
generating R code, e.g.

    paste("a <-", dQuote("xyz")) # wrong!

since in UTF-8 dQuote (and sQuote) do not necessarily
generate double quotes (and single quotes) so one winds
up using double quotes within single quotes or else
backslash-protected double quotes within double quotes.

If there were an argument on dQuote and sQuote to
specify that they should generate double and single
quotes acceptable for code regardless then that would
help in this instance.

On 9/28/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> Thanks, Bill, that is helpful.
>
> I've been running a prototype across R itself and CRAN.  It is clear that
> we do have lots of strings with escaped newlines (the escape is generated
> in the parser if there is an embedded newline) so they need to be an
> exception.  On my first version 99 CRAN packages got picked up on this,
> but about 40 are problems with escaped newlines only (often from
> inst/CITATION files).
>
> I don't understand why \` is regarded as intentional.  It crops up in
> packages date and survival (the same code) in
>
>        stop(paste("\`", .Generic, "' not meaningful for dates",
>                    sep = ""))
>
> which clearly should use sQuote(.Generic) in R, but there seems no reason
> to escape in either R or Splus.
>
> On Wed, 27 Sep 2006, Bill Dunlap wrote:
>
> >>> Splus's parser emits a warning when it sees a backslash
> >>> outside of the recognized backslash sequence.  E.g.,
> >>>
> >>> > nchar("\Backslashed?")
> >>>  [1] 12
> >>>  Warning messages:
> >>>    The initial backslash is ignored in \B -- not a recognized escape sequence.
> >>>          Use \\ to make a backslash
> >>>
> >>> You might want to add that warning to R's parser.  I've
> >>> seen the error in several R packages.  E.g.,
> >>>
> >>>  bayesmix/R/JAGScontrol.R:  text[4] <- "-inits.R\"\n\initialize\n"
> >>>  SciViews/svDialogs/R/fixedDlg.wxPython.R:        if (length(grep("[\.]", basename(res))) == 0)
> >>>
> >>> The warning is mostly emitted when the error is benign, but it
> >>> might help get people to think about what they are typing.
> >>
> >> I am not at all sure about this.  R's documentation says
> >>  ...
> >>         '\n'          newline
> >>         '\r'          carriage return
> >>         '\t'          tab
> >>         '\b'          backspace
> >>         '\a'          alert (bell)
> >>         '\f'          form feed
> >>         '\v'          vertical tab
> >>         '\\'          backslash '\'
> >>         '\nnn'        character with given octal code (1, 2 or 3 digits)
> >>         '\xnn'        character with given hex code (1 or 2 hex digits)
> >>         '\unnnn'      Unicode character with given code (1-4 hex digits)
> >>         '\Unnnnnnnn'  Unicode character with given code (1-8 hex digits)
> >>
> >> so it is not an error in R.  People tend not to like being warned about
> >> legitimate usage (and one can see this sort of thing being intentional in
> >> machine-generated scripts: for example to escape spaces in file paths
> >> and to escape line feeds).
> >
> > We had that same sort of argument here, but enough people were
> > asking our support people about the matter that we put in
> > the warning.  As I said, the warning is odd in that it warns
> > about legitimate usage in the hopes that people will know to
> > use "\\" for a backslash when they need to.
> >
> >> What exactly does Splus's parser allow as intentional?
> >
> > Splus currently "supports" (does not warn about)
> >    \nnn  (1-3 octal digits)
> >    \n, \t, \b, \r, \', \", and \`
> > We do not support the \f, \v, \xnn, \unnnn, or \Unnnnnnnn.
> > We should add the \f, \v, \a, and \xnn (as well as 0xnn for integers),
> > but we overlooked those.  (Adding new backslash sequences is relatively
> > safe: we have been warning about unrecognized \f's for for years so
> > we shouldn't expect to find too many folks using \f where they intended
> > either \\f or f.)
> >
> > We don't support unicode so we won't do anything with the \unnnn or
> > \Unnnnnnnn.  That is something Splus does need to warn about to aid in
> > porting stuff from R.
> >
> > Neither of the examples I showed cause any ill effect,
> > but using the grep pattern of '[\.]' shows that he
> > doesn't know that dots are taken literally inside of
> > square brackets in regular expressions and the use of
> > "\." outside of brackets would give incorrect results.
> >
> >>>  bayesmix/R/JAGScontrol.R:  text[4] <- "-inits.R\"\n\initialize\n"
> >>>  SciViews/svDialogs/R/fixedDlg.wxPython.R:        if (length(grep("[\.]", basename(res))) == 0)
> >
> > In SciViews I also see
> >   command <- sub("view\.[A-Za-z0-9\._]+[(]", "view(", command)
> > which is almost certainly wrong and I suspect that its
> >   cat(";for Options\AutoIndent: 0=Off, 1=follow language scoping and 2=copy from previous line\n",
> > wants an extra \ before AutoIndent.
> >
> > ----------------------------------------------------------------------------
> > Bill Dunlap
> > Insightful Corporation
> > bill at insightful dot com
> > 360-428-8146
> >
> > "All statements in this message represent the opinions of the author and do
> > not necessarily reflect Insightful Corporation policy or position."
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



From jmc at r-project.org  Thu Sep 28 16:08:38 2006
From: jmc at r-project.org (John Chambers)
Date: Thu, 28 Sep 2006 10:08:38 -0400
Subject: [Rd] S4 accessors
In-Reply-To: <20060927220137.GA29358@wheat.betterworld.us>
References: <1159230049.7161.132.camel@iron.psg.net>
	<m2mz8n2prs.fsf@ziti.local> <1159291414.7161.143.camel@iron.psg.net>
	<m21wpyzfph.fsf@ziti.local> <1159299299.7161.239.camel@iron.psg.net>
	<451A8B95.8050406@r-project.org> <m24putmigh.fsf@ziti.local>
	<451ABE22.90401@r-project.org>
	<20060927220137.GA29358@wheat.betterworld.us>
Message-ID: <451BD766.7090604@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060928/6a43c787/attachment-0003.pl 

From ahenningsen at agric-econ.uni-kiel.de  Thu Sep 28 16:12:22 2006
From: ahenningsen at agric-econ.uni-kiel.de (Arne Henningsen)
Date: Thu, 28 Sep 2006 16:12:22 +0200
Subject: [Rd] R CMD build when the package name is different from the
	directory name
In-Reply-To: <971536df0609280630n20755e70s3ad0614b7eaa3f2f@mail.gmail.com>
References: <200609281336.49794.ahenningsen@agric-econ.uni-kiel.de>
	<971536df0609280630n20755e70s3ad0614b7eaa3f2f@mail.gmail.com>
Message-ID: <200609281612.22919.ahenningsen@agric-econ.uni-kiel.de>

Dear Gabor,

Thank you for your message.

On Thursday 28 September 2006 15:30, Gabor Grothendieck wrote:
> Another possibility is to store your code in svn or other version
> control system.

Unfortunately, I can't see why this should make a difference for 
"R CMD build". Do I miss something?
The entire package is in an SVN repository. I have working copies of "trunk" 
and of "branches". Therefore, the working copy of, say, branch "0.8" 
is "branches/0.8/" (see below).

>
> On 9/28/06, Arne Henningsen <ahenningsen at agric-econ.uni-kiel.de> wrote:
> > Hi,
> >
> > I was really happy when I saw that in R version 2.3.0 "R CMD check" works
> > for packages whose package name is different from the directory name in
> > which it is located (see http://cran.r-project.org/src/base/NEWS).
> > Now, I can have branches of my packages in directories like
> > "[...]/branches/<version number>/", while I had to use
> > "[...]/branches/<version number>/<package name>" before.
> > "R CMD check <version number>" runs as expected but when I build the
> > package with "R CMD build <version number>", the file name of the source
> > package is "<version number>_<version number>-<patch level>.tar.gz" (and
> > not "<package name>_<version number>-<patch level>.tar.gz"). Furthermore
> > the base directory inside the .tar.gz archive is "<version number>" (and
> > not "<package name>").
> >
> > Is there a possibility to tell "R CMD build" to use the correct package
> > name ("R CMD check" uses the correct package name.) Can you change the
> > (default) behaviour of "R CMD build" in future releases?
> >
> > Do I have to change the file name and/or the name of the base directory
> > before uploading the package to CRAN?
> >
> > I use R version 2.3.1 (2006-06-01) on i686-pc-linux-gnu.
> > The same happens with R version 2.4.0 RC.
> >
> > Thanks,
> > Arne
> >

-- 
Arne Henningsen
Department of Agricultural Economics
University of Kiel
Olshausenstr. 40
D-24098 Kiel (Germany)
Tel: +49-431-880 4445
Fax: +49-431-880 1397
ahenningsen at agric-econ.uni-kiel.de
http://www.uni-kiel.de/agrarpol/ahenningsen/



From sfalcon at fhcrc.org  Thu Sep 28 16:22:49 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Thu, 28 Sep 2006 07:22:49 -0700
Subject: [Rd] R CMD build when the package name is different from the
	directory name
In-Reply-To: <200609281336.49794.ahenningsen@agric-econ.uni-kiel.de> (Arne
	Henningsen's message of "Thu, 28 Sep 2006 13:36:49 +0200")
References: <200609281336.49794.ahenningsen@agric-econ.uni-kiel.de>
Message-ID: <m2d59g6pfq.fsf@ziti.local>

Arne Henningsen <ahenningsen at agric-econ.uni-kiel.de> writes:

> Hi,
>
> I was really happy when I saw that in R version 2.3.0 "R CMD check" works for 
> packages whose package name is different from the directory name in which it 
> is located (see http://cran.r-project.org/src/base/NEWS). 
> Now, I can have branches of my packages in directories like 
> "[...]/branches/<version number>/", while I had to use 
> "[...]/branches/<version number>/<package name>" before. 
> "R CMD check <version number>" runs as expected but when I build the package 
> with "R CMD build <version number>", the file name of the source package is 
> "<version number>_<version number>-<patch level>.tar.gz" (and not "<package 
> name>_<version number>-<patch level>.tar.gz"). Furthermore the base directory 
> inside the .tar.gz archive is "<version number>" (and not "<package
> name>").

I think that's a feature.  Note that R CMD INSTALL on such a package
does install the package under its "real" name.

It is a feature because it allows me to distinguish the tarballs from
each other.

Perhaps you can make this work for you by using a more meaningful
description than version number in your branch name.  For example:

.../branches/foo-release
.../branches/foo-devel
.../branches/foo-someNewFeature

As another poster suggested, an SCM is the right tool for tracking
versions.

+ seth



From buser at stat.math.ethz.ch  Thu Sep 28 16:32:45 2006
From: buser at stat.math.ethz.ch (Christoph Buser)
Date: Thu, 28 Sep 2006 16:32:45 +0200
Subject: [Rd] apply: new behaviour for factors in R-2.4.0
In-Reply-To: <Pine.LNX.4.64.0609251454410.11772@gannet.stats.ox.ac.uk>
References: <17687.50245.112717.6919@stat.math.ethz.ch>
	<Pine.LNX.4.64.0609251454410.11772@gannet.stats.ox.ac.uk>
Message-ID: <17691.56589.896871.741846@stat.math.ethz.ch>

Dear Brian

Thank you for your answer and the comment you included on the
apply() help page.

1)

You are correct. My data.frame is coerced into a matrix in
apply() 

2)

I agree that the new version of unlist() is better and works
correctly and that in array() (due to as.vector()) the factor
"ans" is coerced into a character matrix.

Nevertheless I disagree that this is "feature freeze" with
R version 2.3.1:

Since in R-2.3.1, unlist() on a list of factors returned an
integer vector, the result of apply was an integer matrix and
not a character matrix.

Therefore my question is if it would be desirable to return an
integer matrix by changing apply. One could include additional
code to handle the case if the output "should" be a factor
matrix and coerce into an integer matrix.

Then the outcome would be consistent with R-2.3.1 without
changing something in unlist() or array().


But in the end I am not sure if an integer matrix is better than
a character matrix or a factor matrix. I am not sure what output
is best if one uses as.factor in apply.


Regards,

Christoph

--------------------------------------------------------------
Christoph Buser <buser at stat.math.ethz.ch>
Seminar fuer Statistik, LEO C13
ETH Zurich	8092 Zurich	 SWITZERLAND
phone: x-41-44-632-4673		fax: 632-1228
http://stat.ethz.ch/~buser/
--------------------------------------------------------------

Prof Brian Ripley writes:
 > Christoph,
 > 
 > This is more complicated than your analysis.
 > 
 > 1) apply takes a matrix as an argument, not a data frame, and so first 
 > coerced 'dat' to a character matrix.
 > 
 > 2) unlist is working quite correctly.  The issue is array(), which 
 > contains as.vector(data).  Thus although the result could be a factor 
 > matrix, as.vector is coercing it to a character matrix.  It might be 
 > desirable to return a factor matrix, but we are not going to do that in 
 > feature freeze (if ever) and I really don't think it would be what you 
 > wanted.
 > 
 > Perhaps the help page should contain an explicit statement that the result 
 > will be coerced to a basic vector type by as.vector().
 > 
 > On Mon, 25 Sep 2006, Christoph Buser wrote:
 > 
 > > Dear R-core
 > >
 > > There is a different output for the apply function due to the
 > > change of unlist as mentioned in the R news.
 > >
 > > Newly, applying as.factor() (or factor()) in
 > >
 > > str(dat <- data.frame(x = 1:10, f1 = gl(2,5,labels = c("A", "B"))))
 > > (d1 <- apply(dat,2,as.factor))
 > >
 > > newly returns a character matrix while in R-2.3.1 the same
 > > command resulted in an integer matrix that was consistent (up to
 > > the ordering of the factor levels) with data.matrix().
 > 
 > That's coincidence -- try x=11:20.
 > 
 > > The change is caused by the change of unlist() that, used for a
 > > list of factors, newly returns a single factor instead of an
 > > integer. I am happy with this change, but:
 > >
 > > Is it desirable to change apply so that it does not return a
 > > character matrix in the example above or include a warning for
 > > such a case?
 > >
 > > Thank you very much for an answer.
 > >
 > > Regards,
 > >
 > > Christoph Buser
 > >
 > > --------------------------------------------------------------
 > > Christoph Buser <buser at stat.math.ethz.ch>
 > > Seminar fuer Statistik, LEO C13
 > > ETH Zurich	8092 Zurich	 SWITZERLAND
 > > phone: x-41-44-632-4673		fax: 632-1228
 > > http://stat.ethz.ch/~buser/
 > >
 > > ______________________________________________
 > > R-devel at r-project.org mailing list
 > > https://stat.ethz.ch/mailman/listinfo/r-devel
 > >
 > 
 > -- 
 > Brian D. Ripley,                  ripley at stats.ox.ac.uk
 > Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
 > University of Oxford,             Tel:  +44 1865 272861 (self)
 > 1 South Parks Road,                     +44 1865 272866 (PA)
 > Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From p.dalgaard at biostat.ku.dk  Thu Sep 28 16:33:17 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 28 Sep 2006 16:33:17 +0200
Subject: [Rd] Warning on backslash sequences (was sprintf behavior)
In-Reply-To: <971536df0609280655t63ce8be2ie159aba2e6539bc4@mail.gmail.com>
References: <20060925094613.B5FB64C91E@slim.kubism.ku.dk>
	<Pine.GSO.4.56.0609260959290.2640@durian.statsci.com>
	<Pine.LNX.4.64.0609270922370.19951@gannet.stats.ox.ac.uk>
	<Pine.GSO.4.56.0609270750050.3216@durian.statsci.com>
	<Pine.LNX.4.64.0609271718410.18168@gannet.stats.ox.ac.uk>
	<971536df0609280655t63ce8be2ie159aba2e6539bc4@mail.gmail.com>
Message-ID: <x2odt0jc2a.fsf@viggo.kubism.ku.dk>

"Gabor Grothendieck" <ggrothendieck at gmail.com> writes:

> One area where a problem might appear is if one is
> generating R code, e.g.
> 
>     paste("a <-", dQuote("xyz")) # wrong!
> 
> since in UTF-8 dQuote (and sQuote) do not necessarily
> generate double quotes (and single quotes) so one winds
> up using double quotes within single quotes or else
> backslash-protected double quotes within double quotes.
> 
> If there were an argument on dQuote and sQuote to
> specify that they should generate double and single
> quotes acceptable for code regardless then that would
> help in this instance.

deparse() would be more to the point, would it not?

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From ggrothendieck at gmail.com  Thu Sep 28 16:42:39 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 28 Sep 2006 10:42:39 -0400
Subject: [Rd] R CMD build when the package name is different from the
	directory name
In-Reply-To: <200609281612.22919.ahenningsen@agric-econ.uni-kiel.de>
References: <200609281336.49794.ahenningsen@agric-econ.uni-kiel.de>
	<971536df0609280630n20755e70s3ad0614b7eaa3f2f@mail.gmail.com>
	<200609281612.22919.ahenningsen@agric-econ.uni-kiel.de>
Message-ID: <971536df0609280742p15701c6er16e95dd45ae0593f@mail.gmail.com>

I normally only keep one version locally since everything else
can be retrieved, if needed, from the repository.  If you do want
to keep multiple versions locally then, of course, there is still
a potential problem.

On 9/28/06, Arne Henningsen <ahenningsen at agric-econ.uni-kiel.de> wrote:
> Dear Gabor,
>
> Thank you for your message.
>
> On Thursday 28 September 2006 15:30, Gabor Grothendieck wrote:
> > Another possibility is to store your code in svn or other version
> > control system.
>
> Unfortunately, I can't see why this should make a difference for
> "R CMD build". Do I miss something?
> The entire package is in an SVN repository. I have working copies of "trunk"
> and of "branches". Therefore, the working copy of, say, branch "0.8"
> is "branches/0.8/" (see below).
>
> >
> > On 9/28/06, Arne Henningsen <ahenningsen at agric-econ.uni-kiel.de> wrote:
> > > Hi,
> > >
> > > I was really happy when I saw that in R version 2.3.0 "R CMD check" works
> > > for packages whose package name is different from the directory name in
> > > which it is located (see http://cran.r-project.org/src/base/NEWS).
> > > Now, I can have branches of my packages in directories like
> > > "[...]/branches/<version number>/", while I had to use
> > > "[...]/branches/<version number>/<package name>" before.
> > > "R CMD check <version number>" runs as expected but when I build the
> > > package with "R CMD build <version number>", the file name of the source
> > > package is "<version number>_<version number>-<patch level>.tar.gz" (and
> > > not "<package name>_<version number>-<patch level>.tar.gz"). Furthermore
> > > the base directory inside the .tar.gz archive is "<version number>" (and
> > > not "<package name>").
> > >
> > > Is there a possibility to tell "R CMD build" to use the correct package
> > > name ("R CMD check" uses the correct package name.) Can you change the
> > > (default) behaviour of "R CMD build" in future releases?
> > >
> > > Do I have to change the file name and/or the name of the base directory
> > > before uploading the package to CRAN?
> > >
> > > I use R version 2.3.1 (2006-06-01) on i686-pc-linux-gnu.
> > > The same happens with R version 2.4.0 RC.
> > >
> > > Thanks,
> > > Arne
> > >
>
> --
> Arne Henningsen
> Department of Agricultural Economics
> University of Kiel
> Olshausenstr. 40
> D-24098 Kiel (Germany)
> Tel: +49-431-880 4445
> Fax: +49-431-880 1397
> ahenningsen at agric-econ.uni-kiel.de
> http://www.uni-kiel.de/agrarpol/ahenningsen/
>



From ggrothendieck at gmail.com  Thu Sep 28 17:03:59 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 28 Sep 2006 11:03:59 -0400
Subject: [Rd] Warning on backslash sequences (was sprintf behavior)
In-Reply-To: <x2odt0jc2a.fsf@viggo.kubism.ku.dk>
References: <20060925094613.B5FB64C91E@slim.kubism.ku.dk>
	<Pine.GSO.4.56.0609260959290.2640@durian.statsci.com>
	<Pine.LNX.4.64.0609270922370.19951@gannet.stats.ox.ac.uk>
	<Pine.GSO.4.56.0609270750050.3216@durian.statsci.com>
	<Pine.LNX.4.64.0609271718410.18168@gannet.stats.ox.ac.uk>
	<971536df0609280655t63ce8be2ie159aba2e6539bc4@mail.gmail.com>
	<x2odt0jc2a.fsf@viggo.kubism.ku.dk>
Message-ID: <971536df0609280803p7e3f35e6jfd6daecfe31496ea@mail.gmail.com>

On 28 Sep 2006 16:33:17 +0200, Peter Dalgaard <p.dalgaard at biostat.ku.dk> wrote:
> "Gabor Grothendieck" <ggrothendieck at gmail.com> writes:
>
> > One area where a problem might appear is if one is
> > generating R code, e.g.
> >
> >     paste("a <-", dQuote("xyz")) # wrong!
> >
> > since in UTF-8 dQuote (and sQuote) do not necessarily
> > generate double quotes (and single quotes) so one winds
> > up using double quotes within single quotes or else
> > backslash-protected double quotes within double quotes.
> >
> > If there were an argument on dQuote and sQuote to
> > specify that they should generate double and single
> > quotes acceptable for code regardless then that would
> > help in this instance.
>
> deparse() would be more to the point, would it not?

That's a good idea for the case I mentioned although there is still
the case where one requires a single quoted string (maybe for
generating code for some other language) and that is
not handled by deparse.



From p.dalgaard at biostat.ku.dk  Thu Sep 28 17:15:27 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 28 Sep 2006 17:15:27 +0200
Subject: [Rd] Warning on backslash sequences (was sprintf behavior)
In-Reply-To: <971536df0609280803p7e3f35e6jfd6daecfe31496ea@mail.gmail.com>
References: <20060925094613.B5FB64C91E@slim.kubism.ku.dk>
	<Pine.GSO.4.56.0609260959290.2640@durian.statsci.com>
	<Pine.LNX.4.64.0609270922370.19951@gannet.stats.ox.ac.uk>
	<Pine.GSO.4.56.0609270750050.3216@durian.statsci.com>
	<Pine.LNX.4.64.0609271718410.18168@gannet.stats.ox.ac.uk>
	<971536df0609280655t63ce8be2ie159aba2e6539bc4@mail.gmail.com>
	<x2odt0jc2a.fsf@viggo.kubism.ku.dk>
	<971536df0609280803p7e3f35e6jfd6daecfe31496ea@mail.gmail.com>
Message-ID: <x2fyecja40.fsf@viggo.kubism.ku.dk>

"Gabor Grothendieck" <ggrothendieck at gmail.com> writes:

> That's a good idea for the case I mentioned although there is still
> the case where one requires a single quoted string (maybe for
> generating code for some other language) and that is
> not handled by deparse.

Yes, but there be devils lurking in there. I think you do in general
need to know what the other language is. Take a look at shQuote(), for
instance. (Why, BTW, does that not simply "escape" single quotes using
'"'"' instead of switching to double-quotes and escaping everything in
sight?)

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From hkawakat at gmail.com  Thu Sep 28 17:15:31 2006
From: hkawakat at gmail.com (Hiroyuki Kawakatsu)
Date: Thu, 28 Sep 2006 16:15:31 +0100
Subject: [Rd] unable to load lapack.so
Message-ID: <307b90470609280815j74ec19cfx263ca47984d98629@mail.gmail.com>

Hi,

I'm having problems using ACML with R. I made two changes in
config.site by setting
LDFLAGS="-L/opt/acml3.1.0/gnu64/lib"
BLAS_LIBS="-lacml"

./config and make go through but when I try to use the lm() function,
I get the error message

Error in chol2inv(Qr$qr[p1, p1, drop = FALSE]) :
        lapack routines cannot be loaded
In addition: Warning message:
unable to load shared library '/usr/local/R-patched/modules//lapack.so':
  Shared object "libRlapack.so" not found, required by "lapack.so"

What am I missing?

> version
               _
platform       x86_64-unknown-freebsd6.1
arch           x86_64
os             freebsd6.1
system         x86_64, freebsd6.1
status         Patched
major          2
minor          3.1
year           2006
month          06
day            01
svn rev        38258
language       R
version.string Version 2.3.1 Patched (2006-06-01 r38258)

-- 
----------------------------------
Hiroyuki Kawakatsu
Business School
Dublin City University
Dublin 9, Ireland
Tel +353 (0)1 700 7496



From ripley at stats.ox.ac.uk  Thu Sep 28 17:23:55 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 28 Sep 2006 16:23:55 +0100 (BST)
Subject: [Rd] apply: new behaviour for factors in R-2.4.0
In-Reply-To: <17691.56589.896871.741846@stat.math.ethz.ch>
References: <17687.50245.112717.6919@stat.math.ethz.ch>
	<Pine.LNX.4.64.0609251454410.11772@gannet.stats.ox.ac.uk>
	<17691.56589.896871.741846@stat.math.ethz.ch>
Message-ID: <Pine.LNX.4.64.0609281620140.14156@gannet.stats.ox.ac.uk>

On Thu, 28 Sep 2006, Christoph Buser wrote:

> Dear Brian
>
> Thank you for your answer and the comment you included on the
> apply() help page.
>
> 1)
>
> You are correct. My data.frame is coerced into a matrix in
> apply()
>
> 2)
>
> I agree that the new version of unlist() is better and works
> correctly and that in array() (due to as.vector()) the factor
> "ans" is coerced into a character matrix.
>
> Nevertheless I disagree that this is "feature freeze" with
> R version 2.3.1:

It is R 2.4.0 that is in 'feature freeze': we cannot change 2.4.0 now (and 
would not have done so when I answered).

See developer.r-project.org for a fuller explanation.

> Since in R-2.3.1, unlist() on a list of factors returned an
> integer vector, the result of apply was an integer matrix and
> not a character matrix.
>
> Therefore my question is if it would be desirable to return an
> integer matrix by changing apply. One could include additional
> code to handle the case if the output "should" be a factor
> matrix and coerce into an integer matrix.
>
> Then the outcome would be consistent with R-2.3.1 without
> changing something in unlist() or array().
>
>
> But in the end I am not sure if an integer matrix is better than
> a character matrix or a factor matrix. I am not sure what output
> is best if one uses as.factor in apply.

It seems best not to do so!

>
> Regards,
>
> Christoph
>
> --------------------------------------------------------------
> Christoph Buser <buser at stat.math.ethz.ch>
> Seminar fuer Statistik, LEO C13
> ETH Zurich	8092 Zurich	 SWITZERLAND
> phone: x-41-44-632-4673		fax: 632-1228
> http://stat.ethz.ch/~buser/
> --------------------------------------------------------------
>
> Prof Brian Ripley writes:
> > Christoph,
> >
> > This is more complicated than your analysis.
> >
> > 1) apply takes a matrix as an argument, not a data frame, and so first
> > coerced 'dat' to a character matrix.
> >
> > 2) unlist is working quite correctly.  The issue is array(), which
> > contains as.vector(data).  Thus although the result could be a factor
> > matrix, as.vector is coercing it to a character matrix.  It might be
> > desirable to return a factor matrix, but we are not going to do that in
> > feature freeze (if ever) and I really don't think it would be what you
> > wanted.
> >
> > Perhaps the help page should contain an explicit statement that the result
> > will be coerced to a basic vector type by as.vector().
> >
> > On Mon, 25 Sep 2006, Christoph Buser wrote:
> >
> > > Dear R-core
> > >
> > > There is a different output for the apply function due to the
> > > change of unlist as mentioned in the R news.
> > >
> > > Newly, applying as.factor() (or factor()) in
> > >
> > > str(dat <- data.frame(x = 1:10, f1 = gl(2,5,labels = c("A", "B"))))
> > > (d1 <- apply(dat,2,as.factor))
> > >
> > > newly returns a character matrix while in R-2.3.1 the same
> > > command resulted in an integer matrix that was consistent (up to
> > > the ordering of the factor levels) with data.matrix().
> >
> > That's coincidence -- try x=11:20.
> >
> > > The change is caused by the change of unlist() that, used for a
> > > list of factors, newly returns a single factor instead of an
> > > integer. I am happy with this change, but:
> > >
> > > Is it desirable to change apply so that it does not return a
> > > character matrix in the example above or include a warning for
> > > such a case?
> > >
> > > Thank you very much for an answer.
> > >
> > > Regards,
> > >
> > > Christoph Buser
> > >
> > > --------------------------------------------------------------
> > > Christoph Buser <buser at stat.math.ethz.ch>
> > > Seminar fuer Statistik, LEO C13
> > > ETH Zurich	8092 Zurich	 SWITZERLAND
> > > phone: x-41-44-632-4673		fax: 632-1228
> > > http://stat.ethz.ch/~buser/
> > >
> > > ______________________________________________
> > > R-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-devel
> > >
> >
> > --
> > Brian D. Ripley,                  ripley at stats.ox.ac.uk
> > Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> > University of Oxford,             Tel:  +44 1865 272861 (self)
> > 1 South Parks Road,                     +44 1865 272866 (PA)
> > Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From ripley at stats.ox.ac.uk  Thu Sep 28 17:28:14 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 28 Sep 2006 16:28:14 +0100 (BST)
Subject: [Rd] Warning on backslash sequences (was sprintf behavior)
In-Reply-To: <x2fyecja40.fsf@viggo.kubism.ku.dk>
References: <20060925094613.B5FB64C91E@slim.kubism.ku.dk>
	<Pine.GSO.4.56.0609260959290.2640@durian.statsci.com>
	<Pine.LNX.4.64.0609270922370.19951@gannet.stats.ox.ac.uk>
	<Pine.GSO.4.56.0609270750050.3216@durian.statsci.com>
	<Pine.LNX.4.64.0609271718410.18168@gannet.stats.ox.ac.uk>
	<971536df0609280655t63ce8be2ie159aba2e6539bc4@mail.gmail.com>
	<x2odt0jc2a.fsf@viggo.kubism.ku.dk>
	<971536df0609280803p7e3f35e6jfd6daecfe31496ea@mail.gmail.com>
	<x2fyecja40.fsf@viggo.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0609281624550.14156@gannet.stats.ox.ac.uk>

On Thu, 28 Sep 2006, Peter Dalgaard wrote:

> "Gabor Grothendieck" <ggrothendieck at gmail.com> writes:
>
>> That's a good idea for the case I mentioned although there is still
>> the case where one requires a single quoted string (maybe for
>> generating code for some other language) and that is
>> not handled by deparse.
>
> Yes, but there be devils lurking in there. I think you do in general
> need to know what the other language is. Take a look at shQuote(), for
> instance. (Why, BTW, does that not simply "escape" single quotes using
> '"'"' instead of switching to double-quotes and escaping everything in
> sight?)

I suspect because the references consulted suggested that was not 
portable.  Since 'sh' covers many variants (at least Bourne sh, ash, bash, 
ksh, zsh) it is hard to get definitive answers.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From bill at insightful.com  Thu Sep 28 17:48:43 2006
From: bill at insightful.com (Bill Dunlap)
Date: Thu, 28 Sep 2006 08:48:43 -0700 (PDT)
Subject: [Rd] Warning on backslash sequences (was sprintf behavior)
In-Reply-To: <Pine.LNX.4.64.0609271718410.18168@gannet.stats.ox.ac.uk>
References: <20060925094613.B5FB64C91E@slim.kubism.ku.dk>
	<Pine.GSO.4.56.0609260959290.2640@durian.statsci.com>
	<Pine.LNX.4.64.0609270922370.19951@gannet.stats.ox.ac.uk>
	<Pine.GSO.4.56.0609270750050.3216@durian.statsci.com>
	<Pine.LNX.4.64.0609271718410.18168@gannet.stats.ox.ac.uk>
Message-ID: <Pine.GSO.4.56.0609280803390.4761@durian.statsci.com>

On Thu, 28 Sep 2006, Prof Brian Ripley wrote:

> I don't understand why \` is regarded as intentional.  It crops up in
> packages date and survival (the same code) in
>
>         stop(paste("\`", .Generic, "' not meaningful for dates",
>                     sep = ""))
>
> which clearly should use sQuote(.Generic) in R, but there seems no reason
> to escape in either R or Splus.

The Splus parser uses the same subroutine to parse
both quoted strings and backquoted names, so we added
"\`" to the list of things not to warn about.  E.g.,
we don't want to warn about "\`" in
   `back\`quoted name`
We could warn about it in strings but not in names,
but to be consistent we would also have to warn about
unneeded backslashes in
   "double\'quoted string"
and
   'single\"quoted string'
?  We chose not to bother and don't warn about any
sort of backslash-quote.

> > Splus currently "supports" (does not warn about)
> >    \nnn  (1-3 octal digits)
> >    \n, \t, \b, \r, \', \", and \`
> > We do not support the \f, \v, \xnn, \unnnn, or \Unnnnnnnn.
> > We should add the \f, \v, \a, and \xnn (as well as 0xnn for integers),
> > but we overlooked those.  (Adding new backslash sequences is relatively
> > safe: we have been warning about unrecognized \f's for for years so
> > we shouldn't expect to find too many folks using \f where they intended
> > either \\f or f.)
> >
> > We don't support unicode so we won't do anything with the \unnnn or
> > \Unnnnnnnn.  That is something Splus does need to warn about to aid in
> > porting stuff from R.

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."



From ripley at stats.ox.ac.uk  Thu Sep 28 19:05:22 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 28 Sep 2006 18:05:22 +0100 (BST)
Subject: [Rd] unable to load lapack.so
In-Reply-To: <307b90470609280815j74ec19cfx263ca47984d98629@mail.gmail.com>
References: <307b90470609280815j74ec19cfx263ca47984d98629@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0609281756560.14992@gannet.stats.ox.ac.uk>

On Thu, 28 Sep 2006, Hiroyuki Kawakatsu wrote:

> Hi,
>
> I'm having problems using ACML with R. I made two changes in
> config.site by setting
> LDFLAGS="-L/opt/acml3.1.0/gnu64/lib"
> BLAS_LIBS="-lacml"

That's not how the R-admin manual describes how to do this.  Please try 
the way it does describe (and please try 2.4.0 RC rather than an old 
patched version of 2.3.1).

I am a bit puzzled: currently ACML is only available for Linux, Solaris 
and Windows, so where did you find a FreeBSD version?

> ./config and make go through but when I try to use the lm() function,
> I get the error message
>
> Error in chol2inv(Qr$qr[p1, p1, drop = FALSE]) :
>        lapack routines cannot be loaded
> In addition: Warning message:
> unable to load shared library '/usr/local/R-patched/modules//lapack.so':
>  Shared object "libRlapack.so" not found, required by "lapack.so"
>
> What am I missing?

Apparently libRlapack.so.  Is it there (in R_HOME/lib)?

>> version
>               _
> platform       x86_64-unknown-freebsd6.1
> arch           x86_64
> os             freebsd6.1
> system         x86_64, freebsd6.1
> status         Patched
> major          2
> minor          3.1
> year           2006
> month          06
> day            01
> svn rev        38258
> language       R
> version.string Version 2.3.1 Patched (2006-06-01 r38258)
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From bautista at cimat.mx  Thu Sep 28 19:36:24 2006
From: bautista at cimat.mx (Patricia Bautista Otero)
Date: Thu, 28 Sep 2006 12:36:24 -0500 (CDT)
Subject: [Rd] Accesing R c-code
Message-ID: <Pine.BSO.4.64.0609281226300.9383@ate.cimat.mx>

Hi r-devel,

I am working on a R extension. My package is writen on C++ and in my code 
I require a R function object. I received the R function object, then a 
point x in which the "function" is going to be evaluated is generated in 
some way, then I evalue the "function" at x and I repete this process 
several thousand of times. Since I am using the function eval(SEXP fn, 
SEXP env) my code is really slow. Due to my major concern is speed, I 
wonder to know when it is posible to access to the parse tree of the R 
function object and build my own c++ parser tree in order to have c++ 
doing the evaluations of the function instead of R, as it is now working 
in my c++ code. What I want to avoid is to have to develope a complete 
parser mainly because it would take me too much time since I am a newe in 
compilers and parsers.

It would also help me to know how R mcmc packages work, because it is more 
or less the same situation. In mcmc packages a target density function is 
required, and I suppose this density function is evaluated many many 
times, but this packages are not too slow.


Then, if anyone is able to provide me any insight into what I might to, I 
would be grateful.

pb



From sdavis2 at mail.nih.gov  Thu Sep 28 20:13:56 2006
From: sdavis2 at mail.nih.gov (Sean Davis)
Date: Thu, 28 Sep 2006 14:13:56 -0400
Subject: [Rd] Accesing R c-code
In-Reply-To: <Pine.BSO.4.64.0609281226300.9383@ate.cimat.mx>
References: <Pine.BSO.4.64.0609281226300.9383@ate.cimat.mx>
Message-ID: <200609281413.56984.sdavis2@mail.nih.gov>

On Thursday 28 September 2006 13:36, Patricia Bautista Otero wrote:
> Hi r-devel,
>
> I am working on a R extension. My package is writen on C++ and in my code
> I require a R function object. I received the R function object, then a
> point x in which the "function" is going to be evaluated is generated in
> some way, then I evalue the "function" at x and I repete this process
> several thousand of times. Since I am using the function eval(SEXP fn,
> SEXP env) my code is really slow. Due to my major concern is speed, I
> wonder to know when it is posible to access to the parse tree of the R
> function object and build my own c++ parser tree in order to have c++
> doing the evaluations of the function instead of R, as it is now working
> in my c++ code. What I want to avoid is to have to develope a complete
> parser mainly because it would take me too much time since I am a newe in
> compilers and parsers.
>
> It would also help me to know how R mcmc packages work, because it is more
> or less the same situation. In mcmc packages a target density function is
> required, and I suppose this density function is evaluated many many
> times, but this packages are not too slow.

If you want to look at a package, you can just download the source and look at 
it.  The source for most packages is available on CRAN.

Sean



From mwtoews at sfu.ca  Thu Sep 28 22:11:21 2006
From: mwtoews at sfu.ca (Michael Toews)
Date: Thu, 28 Sep 2006 13:11:21 -0700
Subject: [Rd] Documentation patch for 'match' and 'palette'
Message-ID: <451C2C69.9090600@sfu.ca>

Here is a patch to improve documentation for finding useful, yet newish, 
functions: 'findInterval' and 'colorRamp'. I think that it is worthwhile 
to mention these in the 'seealso' section of the similar 'match' and 
'palette' documents. I had difficulty finding these functions at first, 
as they have compound names. Modify the patch as needed:

Index: src/library/base/man/match.Rd
===================================================================
--- src/library/base/man/match.Rd       (revision 39542)
+++ src/library/base/man/match.Rd       (working copy)
@@ -65,6 +65,8 @@
   \code{\link{pmatch}} and \code{\link{charmatch}} for (\emph{partial})
   string matching, \code{\link{match.arg}}, etc for function argument
   matching.
+  \code{\link{findInterval}} similarly returns a vector of positions, but
+  finds numbers within intervals, rather than exact matches.
 
   \code{\link{is.element}} for an S-compatible equivalent of \code{\%in\%}.
 }
Index: src/library/grDevices/man/palette.Rd
===================================================================
--- src/library/grDevices/man/palette.Rd        (revision 39542)
+++ src/library/grDevices/man/palette.Rd        (working copy)
@@ -31,7 +31,7 @@
   \code{\link{colors}} for the vector of built-in \dQuote{named} colors;
   \code{\link{hsv}}, \code{\link{gray}}, \code{\link{rainbow}},
   \code{\link{terrain.colors}},\dots to construct colors;
- 
+  \code{\link{colorRamp}} to interpolate colors, making custom palettes;
   \code{\link{col2rgb}} for translating colors to RGB 3-vectors.
 }
 \examples{



From jmacdon at med.umich.edu  Thu Sep 28 22:21:41 2006
From: jmacdon at med.umich.edu (James MacDonald)
Date: Thu, 28 Sep 2006 16:21:41 -0400
Subject: [Rd] Build error/zlib question
Message-ID: <451BF61E.47B0.00EE.0@med.umich.edu>

Hi,

I am unable to build a package I maintain using a relatively current
build of R-2.4.0 alpha, whereas the package builds just fine on R-2.3.1.
Both versions of R were built from source. I'm hoping a guRu might be
able to give some help.

Some snippets from the build process:

R-2.3.1

  making DLL ...
gcc  -Ic:/R-2.3.1/src/extra/zlib -DHAVE_ZLIB -Ic:/R-2.3.1/include -Wall
-O2   -c read_cdffile.c -o read_cdffile.o
read_cdffile.c: In function `readQC':
read_cdffile.c:565: warning: unused variable `param_unit'
windres --include-dir c:/R-2.3.1/include  -i makecdfenv_res.rc -o
makecdfenv_res.o
gcc  -shared -s  -o makecdfenv.dll makecdfenv.def read_cdffile.o
makecdfenv_res.o  -Lc:/R-2.3.1/bin   -lR
  ... DLL made

R-2.4.0 beta

   making DLL ...
gcc  -Ic:/rw2040dev/src/extra/zlib -DHAVE_ZLIB -Ic:/rw2040dev/include 
-Wall -O2 -std=gnu99   -c read_cdffile.c -o read_cdffile.o
read_cdffile.c: In function `readQC':
read_cdffile.c:565: warning: unused variable `param_unit'
windres --include-dir c:/rw2040dev/include  -i makecdfenv_res.rc -o
makecdfenv_res.o
gcc  -shared -s  -o makecdfenv.dll makecdfenv.def read_cdffile.o
makecdfenv_res.o  -Lc:/rw2040dev/bin   -lR
read_cdffile.o:read_cdffile.c:(.text+0x42): undefined reference to
`gzgets'
read_cdffile.o:read_cdffile.c:(.text+0xf3): undefined reference to
`gzopen'
read_cdffile.o:read_cdffile.c:(.text+0x10f): undefined reference to
`gzgets'
read_cdffile.o:read_cdffile.c:(.text+0x140): undefined reference to
`gzrewind'
read_cdffile.o:read_cdffile.c:(.text+0x177): undefined reference to
`gzclose'
collect2: ld returned 1 exit status
make[3]: *** [makecdfenv.dll] Error 1
make[2]: *** [srcDynlib] Error 2
make[1]: *** [all] Error 2
make: *** [pkg-makecdfenv] Error 2

> version
               _                                        
platform       i386-pc-mingw32                          
arch           i386                                     
os             mingw32                                  
system         i386, mingw32                            
status         alpha                                    
major          2                                        
minor          4.0                                      
year           2006                                     
month          09                                       
day            10                                       
svn rev        39242                                    
language       R                                        
version.string R version 2.4.0 alpha (2006-09-10 r39242)

TIA,

Jim

James W. MacDonald, M.S.
Biostatistician
Affymetrix and cDNA Microarray Core
University of Michigan Cancer Center
1500 E. Medical Center Drive
7410 CCGC
Ann Arbor MI 48109
734-647-5623


**********************************************************
Electronic Mail is not secure, may not be read every day, and should not be used for urgent or sensitive issues.



From ahenningsen at agric-econ.uni-kiel.de  Fri Sep 29 08:26:26 2006
From: ahenningsen at agric-econ.uni-kiel.de (Arne Henningsen)
Date: Fri, 29 Sep 2006 08:26:26 +0200
Subject: [Rd] R CMD build when the package name is different from the
	directory name
In-Reply-To: <m2d59g6pfq.fsf@ziti.local>
References: <200609281336.49794.ahenningsen@agric-econ.uni-kiel.de>
	<m2d59g6pfq.fsf@ziti.local>
Message-ID: <200609290826.26621.ahenningsen@agric-econ.uni-kiel.de>

Dear Seth,

Thank you for your message.

On Thursday 28 September 2006 16:22, Seth Falcon wrote:
> Arne Henningsen <ahenningsen at agric-econ.uni-kiel.de> writes:
> > Hi,
> >
> > I was really happy when I saw that in R version 2.3.0 "R CMD check" works
> > for packages whose package name is different from the directory name in
> > which it is located (see http://cran.r-project.org/src/base/NEWS).
> > Now, I can have branches of my packages in directories like
> > "[...]/branches/<version number>/", while I had to use
> > "[...]/branches/<version number>/<package name>" before.
> > "R CMD check <version number>" runs as expected but when I build the
> > package with "R CMD build <version number>", the file name of the source
> > package is "<version number>_<version number>-<patch level>.tar.gz" (and
> > not "<package name>_<version number>-<patch level>.tar.gz"). Furthermore
> > the base directory inside the .tar.gz archive is "<version number>" (and
> > not "<package name>").
>
> I think that's a feature.  Note that R CMD INSTALL on such a package
> does install the package under its "real" name.

I don't think that this is a feature -- it is IMHO rather a bug. While "R CMD 
check" and "R CMD INSTALL" take the real name (as expected), "R CMD build" 
does not.

However, if I don't have to change the file name and the name of the base 
directory before uploading the package to CRAN, the current behaviour of 
"R CMD build" is IMHO acceptable. (I did not yet get an answer on my question 
regarding CRAN.)

> It is a feature because it allows me to distinguish the tarballs from
> each other.

You can distinguish the tarballs according their version number and patch 
level (they are called "<package name>-<version number>-<patch level>.tar.gz"

> Perhaps you can make this work for you by using a more meaningful
> description than version number in your branch name.  For example:
>
> .../branches/foo-release
> .../branches/foo-devel
> .../branches/foo-someNewFeature

In this case, the file name of the package is e.g. 
"<package name>-release-<version number>-<patch level>.tar.gz" 
and the base directory is e.g.
"<package name>-release".
Is this accepted on CRAN?

> As another poster suggested, an SCM is the right tool for tracking
> versions.
>
> + seth

Arne

>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Arne Henningsen
Department of Agricultural Economics
University of Kiel
Olshausenstr. 40
D-24098 Kiel (Germany)
Tel: +49-431-880 4445
Fax: +49-431-880 1397
ahenningsen at agric-econ.uni-kiel.de
http://www.uni-kiel.de/agrarpol/ahenningsen/



From hkawakat at gmail.com  Fri Sep 29 09:46:32 2006
From: hkawakat at gmail.com (Hiroyuki Kawakatsu)
Date: Fri, 29 Sep 2006 08:46:32 +0100
Subject: [Rd] unable to load lapack.so
In-Reply-To: <Pine.LNX.4.64.0609281756560.14992@gannet.stats.ox.ac.uk>
References: <307b90470609280815j74ec19cfx263ca47984d98629@mail.gmail.com>
	<Pine.LNX.4.64.0609281756560.14992@gannet.stats.ox.ac.uk>
Message-ID: <307b90470609290046t3acf506bq57a8ad21edcafec6@mail.gmail.com>

On 9/28/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:

>> I'm having problems using ACML with R. I made two changes in
>> config.site by setting
>> LDFLAGS="-L/opt/acml3.1.0/gnu64/lib"
>> BLAS_LIBS="-lacml"
>
>That's not how the R-admin manual describes how to do this.
>Please try the way it does describe

After re-reading appendix A2.2, I still don't see what I am doing
wrong. The comments in config.site say
## Use LAPACK_LIBS for all '-L' and '-l' options needed for linking
## against an external LAPACK implementation.
## Note that (see R-admin) that our main intention is to allow a
## LAPACK-containing BLAS to be used, so this is rarely needed, and
## it is not used if the BLAS already contains LAPACK.
so I don't need to set LAPACK_LIBS as the acml BLAS already contains LAPACK?

> I am a bit puzzled: currently ACML is only available for Linux, Solaris
> and Windows, so where did you find a FreeBSD version?

I didn't; but see
http://lists.freebsd.org/pipermail/freebsd-amd64/2005-September/006043.html

> Apparently libRlapack.so.  Is it there (in R_HOME/lib)?

yes:
erdos# ls -l /usr/local/R-patched/lib
total 1808
-rwxr-xr-x  1 root  30  1832001 Sep 29 07:08 libRlapack.so*

> (and please try 2.4.0 RC rather than an old patched version of 2.3.1).

Ah, when I tried R-rc, I found what I was doing wrong: the copy of R
in /usr/local/bin/R was not updated from R_HOME/bin/R

For R-rc with the same two changes in config.site, the build passes
make check (except for internet.R as I am behind a firewall and set
http_proxy in .Renviron which appears to be ignored by make check).
But in lib/ I now have

erdos# ls -l /usr/local/R-rc/lib/
total 2112
-rwxr-xr-x  1 root  506   289732 Sep 29 07:52 libRblas.so*
-rwxr-xr-x  1 root  506  1831697 Sep 29 07:57 libRlapack.so*

Does this mean that the acml BLAS is not being used?

> version
               _
platform       x86_64-unknown-freebsd6.1
arch           x86_64
os             freebsd6.1
system         x86_64, freebsd6.1
status         RC
major          2
minor          4.0
year           2006
month          09
day            27
svn rev        39543
language       R
version.string R version 2.4.0 RC (2006-09-27 r39543)

h.
--
----------------------------------
Hiroyuki Kawakatsu
Business School
Dublin City University
Dublin 9, Ireland
Tel +353 (0)1 700 7496



From ripley at stats.ox.ac.uk  Fri Sep 29 09:55:25 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 29 Sep 2006 08:55:25 +0100 (BST)
Subject: [Rd] unable to load lapack.so
In-Reply-To: <307b90470609290046t3acf506bq57a8ad21edcafec6@mail.gmail.com>
References: <307b90470609280815j74ec19cfx263ca47984d98629@mail.gmail.com> 
	<Pine.LNX.4.64.0609281756560.14992@gannet.stats.ox.ac.uk>
	<307b90470609290046t3acf506bq57a8ad21edcafec6@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0609290849420.15856@gannet.stats.ox.ac.uk>

On Fri, 29 Sep 2006, Hiroyuki Kawakatsu wrote:

> On 9/28/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>
>>> I'm having problems using ACML with R. I made two changes in
>>> config.site by setting
>>> LDFLAGS="-L/opt/acml3.1.0/gnu64/lib"
>>> BLAS_LIBS="-lacml"
>> 
>> That's not how the R-admin manual describes how to do this.
>> Please try the way it does describe

There is a specific section on using ACML, via command-line flags.
One point is that you want the path as part of BLAS_LIBS, not for all 
compilation.

> After re-reading appendix A2.2, I still don't see what I am doing
> wrong. The comments in config.site say
> ## Use LAPACK_LIBS for all '-L' and '-l' options needed for linking
> ## against an external LAPACK implementation.
> ## Note that (see R-admin) that our main intention is to allow a
> ## LAPACK-containing BLAS to be used, so this is rarely needed, and
> ## it is not used if the BLAS already contains LAPACK.
> so I don't need to set LAPACK_LIBS as the acml BLAS already contains LAPACK?
>
>> I am a bit puzzled: currently ACML is only available for Linux, Solaris
>> and Windows, so where did you find a FreeBSD version?
>
> I didn't; but see
> http://lists.freebsd.org/pipermail/freebsd-amd64/2005-September/006043.html

Well, you failed to mention that you were using a Linux version ....

>> Apparently libRlapack.so.  Is it there (in R_HOME/lib)?
>
> yes:
> erdos# ls -l /usr/local/R-patched/lib
> total 1808
> -rwxr-xr-x  1 root  30  1832001 Sep 29 07:08 libRlapack.so*
>
>> (and please try 2.4.0 RC rather than an old patched version of 2.3.1).
>
> Ah, when I tried R-rc, I found what I was doing wrong: the copy of R
> in /usr/local/bin/R was not updated from R_HOME/bin/R
>
> For R-rc with the same two changes in config.site, the build passes
> make check (except for internet.R as I am behind a firewall and set
> http_proxy in .Renviron which appears to be ignored by make check).

Yes, all tests are run with --vanilla.  You need to set variables in the 
global environment.


> But in lib/ I now have
>
> erdos# ls -l /usr/local/R-rc/lib/
> total 2112
> -rwxr-xr-x  1 root  506   289732 Sep 29 07:52 libRblas.so*
> -rwxr-xr-x  1 root  506  1831697 Sep 29 07:57 libRlapack.so*
>
> Does this mean that the acml BLAS is not being used?

What does libRblas.so link to?
You really do need to study the manual section on BLASes, as that suggests 
a different (and more efficient) way of doing this.

>
>> version
>              _
> platform       x86_64-unknown-freebsd6.1
> arch           x86_64
> os             freebsd6.1
> system         x86_64, freebsd6.1
> status         RC
> major          2
> minor          4.0
> year           2006
> month          09
> day            27
> svn rev        39543
> language       R
> version.string R version 2.4.0 RC (2006-09-27 r39543)
>
> h.
> --
> ----------------------------------
> Hiroyuki Kawakatsu
> Business School
> Dublin City University
> Dublin 9, Ireland
> Tel +353 (0)1 700 7496
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From ligges at statistik.uni-dortmund.de  Fri Sep 29 10:59:56 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Fri, 29 Sep 2006 10:59:56 +0200
Subject: [Rd] R CMD build when the package name is different from the
 directory name
In-Reply-To: <200609290826.26621.ahenningsen@agric-econ.uni-kiel.de>
References: <200609281336.49794.ahenningsen@agric-econ.uni-kiel.de>	<m2d59g6pfq.fsf@ziti.local>
	<200609290826.26621.ahenningsen@agric-econ.uni-kiel.de>
Message-ID: <451CE08C.6050201@statistik.uni-dortmund.de>



Arne Henningsen wrote:
> Dear Seth,
> 
> Thank you for your message.
> 
> On Thursday 28 September 2006 16:22, Seth Falcon wrote:
>> Arne Henningsen <ahenningsen at agric-econ.uni-kiel.de> writes:
>>> Hi,
>>>
>>> I was really happy when I saw that in R version 2.3.0 "R CMD check" works
>>> for packages whose package name is different from the directory name in
>>> which it is located (see http://cran.r-project.org/src/base/NEWS).
>>> Now, I can have branches of my packages in directories like
>>> "[...]/branches/<version number>/", while I had to use
>>> "[...]/branches/<version number>/<package name>" before.
>>> "R CMD check <version number>" runs as expected but when I build the
>>> package with "R CMD build <version number>", the file name of the source
>>> package is "<version number>_<version number>-<patch level>.tar.gz" (and
>>> not "<package name>_<version number>-<patch level>.tar.gz"). Furthermore
>>> the base directory inside the .tar.gz archive is "<version number>" (and
>>> not "<package name>").
>> I think that's a feature.  Note that R CMD INSTALL on such a package
>> does install the package under its "real" name.
> 
> I don't think that this is a feature -- it is IMHO rather a bug. While "R CMD 
> check" and "R CMD INSTALL" take the real name (as expected), "R CMD build" 
> does not.
> 
> However, if I don't have to change the file name and the name of the base 
> directory before uploading the package to CRAN, the current behaviour of 
> "R CMD build" is IMHO acceptable. (I did not yet get an answer on my question 
> regarding CRAN.)
> 
>> It is a feature because it allows me to distinguish the tarballs from
>> each other.
> 
> You can distinguish the tarballs according their version number and patch 
> level (they are called "<package name>-<version number>-<patch level>.tar.gz"
> 
>> Perhaps you can make this work for you by using a more meaningful
>> description than version number in your branch name.  For example:
>>
>> .../branches/foo-release
>> .../branches/foo-devel
>> .../branches/foo-someNewFeature
> 
> In this case, the file name of the package is e.g. 
> "<package name>-release-<version number>-<patch level>.tar.gz" 
> and the base directory is e.g.
> "<package name>-release".
> Is this accepted on CRAN?

No.

Uwe Ligges


>> As another poster suggested, an SCM is the right tool for tracking
>> versions.
>>
>> + seth
> 
> Arne
> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>



From ligges at statistik.uni-dortmund.de  Fri Sep 29 11:27:49 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Fri, 29 Sep 2006 11:27:49 +0200
Subject: [Rd] Build error/zlib question
In-Reply-To: <451BF61E.47B0.00EE.0@med.umich.edu>
References: <451BF61E.47B0.00EE.0@med.umich.edu>
Message-ID: <451CE715.1090701@statistik.uni-dortmund.de>



James MacDonald wrote:
> Hi,
> 
> I am unable to build a package I maintain using a relatively current
> build of R-2.4.0 alpha, whereas the package builds just fine on R-2.3.1.
> Both versions of R were built from source. I'm hoping a guRu might be
> able to give some help.


The entry points are no longer exported, you probably have to specify 
the zlib header files (which reside in R/src/extra/zlib).

Uwe Ligges


> Some snippets from the build process:
> 
> R-2.3.1
> 
>   making DLL ...
> gcc  -Ic:/R-2.3.1/src/extra/zlib -DHAVE_ZLIB -Ic:/R-2.3.1/include -Wall
> -O2   -c read_cdffile.c -o read_cdffile.o
> read_cdffile.c: In function `readQC':
> read_cdffile.c:565: warning: unused variable `param_unit'
> windres --include-dir c:/R-2.3.1/include  -i makecdfenv_res.rc -o
> makecdfenv_res.o
> gcc  -shared -s  -o makecdfenv.dll makecdfenv.def read_cdffile.o
> makecdfenv_res.o  -Lc:/R-2.3.1/bin   -lR
>   ... DLL made
> 
> R-2.4.0 beta
> 
>    making DLL ...
> gcc  -Ic:/rw2040dev/src/extra/zlib -DHAVE_ZLIB -Ic:/rw2040dev/include 
> -Wall -O2 -std=gnu99   -c read_cdffile.c -o read_cdffile.o
> read_cdffile.c: In function `readQC':
> read_cdffile.c:565: warning: unused variable `param_unit'
> windres --include-dir c:/rw2040dev/include  -i makecdfenv_res.rc -o
> makecdfenv_res.o
> gcc  -shared -s  -o makecdfenv.dll makecdfenv.def read_cdffile.o
> makecdfenv_res.o  -Lc:/rw2040dev/bin   -lR
> read_cdffile.o:read_cdffile.c:(.text+0x42): undefined reference to
> `gzgets'
> read_cdffile.o:read_cdffile.c:(.text+0xf3): undefined reference to
> `gzopen'
> read_cdffile.o:read_cdffile.c:(.text+0x10f): undefined reference to
> `gzgets'
> read_cdffile.o:read_cdffile.c:(.text+0x140): undefined reference to
> `gzrewind'
> read_cdffile.o:read_cdffile.c:(.text+0x177): undefined reference to
> `gzclose'
> collect2: ld returned 1 exit status
> make[3]: *** [makecdfenv.dll] Error 1
> make[2]: *** [srcDynlib] Error 2
> make[1]: *** [all] Error 2
> make: *** [pkg-makecdfenv] Error 2
> 
>> version
>                _                                        
> platform       i386-pc-mingw32                          
> arch           i386                                     
> os             mingw32                                  
> system         i386, mingw32                            
> status         alpha                                    
> major          2                                        
> minor          4.0                                      
> year           2006                                     
> month          09                                       
> day            10                                       
> svn rev        39242                                    
> language       R                                        
> version.string R version 2.4.0 alpha (2006-09-10 r39242)
> 
> TIA,
> 
> Jim
> 
> James W. MacDonald, M.S.
> Biostatistician
> Affymetrix and cDNA Microarray Core
> University of Michigan Cancer Center
> 1500 E. Medical Center Drive
> 7410 CCGC
> Ann Arbor MI 48109
> 734-647-5623
> 
> 
> **********************************************************
> Electronic Mail is not secure, may not be read every day, and should not be used for urgent or sensitive issues.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



From ripley at stats.ox.ac.uk  Fri Sep 29 12:48:46 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 29 Sep 2006 11:48:46 +0100 (BST)
Subject: [Rd] Build error/zlib question
In-Reply-To: <451CE715.1090701@statistik.uni-dortmund.de>
References: <451BF61E.47B0.00EE.0@med.umich.edu>
	<451CE715.1090701@statistik.uni-dortmund.de>
Message-ID: <Pine.LNX.4.64.0609291143430.19030@gannet.stats.ox.ac.uk>

On Fri, 29 Sep 2006, Uwe Ligges wrote:

>
>
> James MacDonald wrote:
>> Hi,
>>
>> I am unable to build a package I maintain using a relatively current
>> build of R-2.4.0 alpha, whereas the package builds just fine on R-2.3.1.
>> Both versions of R were built from source. I'm hoping a guRu might be
>> able to give some help.
>
> The entry points are no longer exported, you probably have to specify
> the zlib header files (which reside in R/src/extra/zlib).

I think Uwe meant to say '-L$(RHOME)/src/extra/zlib -lz' is needed in 
PKG_LIBS.

Note that this package would not build in an installed version of R, so it 
did not 'builds just fine on R-2.3.1' as claimed.

However, this is all against the advice of 'Writing R Extensions', and the 
change is documented in the CHANGES file.  What you should really do is to 
supply your own zlib compiled to your own requirements.  If you make use 
of private entry points, expect self-imposed trouble!

>
> Uwe Ligges
>
>
>> Some snippets from the build process:
>>
>> R-2.3.1
>>
>>   making DLL ...
>> gcc  -Ic:/R-2.3.1/src/extra/zlib -DHAVE_ZLIB -Ic:/R-2.3.1/include -Wall
>> -O2   -c read_cdffile.c -o read_cdffile.o
>> read_cdffile.c: In function `readQC':
>> read_cdffile.c:565: warning: unused variable `param_unit'
>> windres --include-dir c:/R-2.3.1/include  -i makecdfenv_res.rc -o
>> makecdfenv_res.o
>> gcc  -shared -s  -o makecdfenv.dll makecdfenv.def read_cdffile.o
>> makecdfenv_res.o  -Lc:/R-2.3.1/bin   -lR
>>   ... DLL made
>>
>> R-2.4.0 beta
>>
>>    making DLL ...
>> gcc  -Ic:/rw2040dev/src/extra/zlib -DHAVE_ZLIB -Ic:/rw2040dev/include
>> -Wall -O2 -std=gnu99   -c read_cdffile.c -o read_cdffile.o
>> read_cdffile.c: In function `readQC':
>> read_cdffile.c:565: warning: unused variable `param_unit'
>> windres --include-dir c:/rw2040dev/include  -i makecdfenv_res.rc -o
>> makecdfenv_res.o
>> gcc  -shared -s  -o makecdfenv.dll makecdfenv.def read_cdffile.o
>> makecdfenv_res.o  -Lc:/rw2040dev/bin   -lR
>> read_cdffile.o:read_cdffile.c:(.text+0x42): undefined reference to
>> `gzgets'
>> read_cdffile.o:read_cdffile.c:(.text+0xf3): undefined reference to
>> `gzopen'
>> read_cdffile.o:read_cdffile.c:(.text+0x10f): undefined reference to
>> `gzgets'
>> read_cdffile.o:read_cdffile.c:(.text+0x140): undefined reference to
>> `gzrewind'
>> read_cdffile.o:read_cdffile.c:(.text+0x177): undefined reference to
>> `gzclose'
>> collect2: ld returned 1 exit status
>> make[3]: *** [makecdfenv.dll] Error 1
>> make[2]: *** [srcDynlib] Error 2
>> make[1]: *** [all] Error 2
>> make: *** [pkg-makecdfenv] Error 2
>>
>>> version
>>                _
>> platform       i386-pc-mingw32
>> arch           i386
>> os             mingw32
>> system         i386, mingw32
>> status         alpha
>> major          2
>> minor          4.0
>> year           2006
>> month          09
>> day            10
>> svn rev        39242
>> language       R
>> version.string R version 2.4.0 alpha (2006-09-10 r39242)
>>
>> TIA,
>>
>> Jim
>>
>> James W. MacDonald, M.S.
>> Biostatistician
>> Affymetrix and cDNA Microarray Core
>> University of Michigan Cancer Center
>> 1500 E. Medical Center Drive
>> 7410 CCGC
>> Ann Arbor MI 48109
>> 734-647-5623
>>
>>
>> **********************************************************
>> Electronic Mail is not secure, may not be read every day, and should not be used for urgent or sensitive issues.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From peter.stencel at uni-bielefeld.de  Fri Sep 29 15:15:38 2006
From: peter.stencel at uni-bielefeld.de (Peter Stencel)
Date: Fri, 29 Sep 2006 15:15:38 +0200
Subject: [Rd] error location
Message-ID: <ed28ff68ff6.ff6ed28ff68@uni-bielefeld.de>

Dear all,

I've written a (quite long) function in R. While running it I get the
following error message: 

 Error in "[<-"(`*tmp*`, 1, 13, value =
NULL) :
        number of items to replace is not a multiple of
replacement length
   operation failed in: function ()  !!!
   evaluation not successful!!!

How to interpret this error message? (There aren't any expressions that
I'm using in my function.) 

How can I locate the error? Is it possible to do it with the command
debug("functionname")? 

I'm new to R and I hope that someone can give me a piece of advice on
finding errors. Thanks in advance.

Regards, 
Peter



From jmacdon at med.umich.edu  Fri Sep 29 15:38:52 2006
From: jmacdon at med.umich.edu (James W. MacDonald)
Date: Fri, 29 Sep 2006 09:38:52 -0400
Subject: [Rd] Build error/zlib question
In-Reply-To: <Pine.LNX.4.64.0609291143430.19030@gannet.stats.ox.ac.uk>
References: <451BF61E.47B0.00EE.0@med.umich.edu>
	<451CE715.1090701@statistik.uni-dortmund.de>
	<Pine.LNX.4.64.0609291143430.19030@gannet.stats.ox.ac.uk>
Message-ID: <451D21EC.6090107@med.umich.edu>

Prof Brian Ripley wrote:
> On Fri, 29 Sep 2006, Uwe Ligges wrote:
> 
>> 
>> 
>> James MacDonald wrote:
>> 
>>> Hi,
>>> 
>>> I am unable to build a package I maintain using a relatively
>>> current build of R-2.4.0 alpha, whereas the package builds just
>>> fine on R-2.3.1. Both versions of R were built from source. I'm
>>> hoping a guRu might be able to give some help.
>> 
>> 
>> The entry points are no longer exported, you probably have to
>> specify the zlib header files (which reside in R/src/extra/zlib).
> 
> 
> I think Uwe meant to say '-L$(RHOME)/src/extra/zlib -lz' is needed in
>  PKG_LIBS.

Thank you for the hint. This does allow the package to build.

> 
> Note that this package would not build in an installed version of R,
> so it did not 'builds just fine on R-2.3.1' as claimed.

I made no claim for this package building on an installed version; if 
you read the sentence right after the one you quote, you will notice 
that I state both versions of R were compiled from source.

> 
> However, this is all against the advice of 'Writing R Extensions',
> and the change is documented in the CHANGES file.  What you should
> really do is to supply your own zlib compiled to your own
> requirements.  If you make use of private entry points, expect
> self-imposed trouble!

Thanks for the advice. When I get the chance I will look into supplying 
such an animal with the package.

Best,

Jim


> 
>> 
>> Uwe Ligges
>> 
>> 
>>> Some snippets from the build process:
>>> 
>>> R-2.3.1
>>> 
>>> making DLL ... gcc  -Ic:/R-2.3.1/src/extra/zlib -DHAVE_ZLIB
>>> -Ic:/R-2.3.1/include -Wall -O2   -c read_cdffile.c -o
>>> read_cdffile.o read_cdffile.c: In function `readQC': 
>>> read_cdffile.c:565: warning: unused variable `param_unit' windres
>>> --include-dir c:/R-2.3.1/include  -i makecdfenv_res.rc -o 
>>> makecdfenv_res.o gcc  -shared -s  -o makecdfenv.dll
>>> makecdfenv.def read_cdffile.o makecdfenv_res.o  -Lc:/R-2.3.1/bin
>>> -lR ... DLL made
>>> 
>>> R-2.4.0 beta
>>> 
>>> making DLL ... gcc  -Ic:/rw2040dev/src/extra/zlib -DHAVE_ZLIB
>>> -Ic:/rw2040dev/include -Wall -O2 -std=gnu99   -c read_cdffile.c
>>> -o read_cdffile.o read_cdffile.c: In function `readQC': 
>>> read_cdffile.c:565: warning: unused variable `param_unit' windres
>>> --include-dir c:/rw2040dev/include  -i makecdfenv_res.rc -o 
>>> makecdfenv_res.o gcc  -shared -s  -o makecdfenv.dll
>>> makecdfenv.def read_cdffile.o makecdfenv_res.o
>>> -Lc:/rw2040dev/bin   -lR 
>>> read_cdffile.o:read_cdffile.c:(.text+0x42): undefined reference
>>> to `gzgets' read_cdffile.o:read_cdffile.c:(.text+0xf3): undefined
>>> reference to `gzopen' 
>>> read_cdffile.o:read_cdffile.c:(.text+0x10f): undefined reference
>>> to `gzgets' read_cdffile.o:read_cdffile.c:(.text+0x140):
>>> undefined reference to `gzrewind' 
>>> read_cdffile.o:read_cdffile.c:(.text+0x177): undefined reference
>>> to `gzclose' collect2: ld returned 1 exit status make[3]: ***
>>> [makecdfenv.dll] Error 1 make[2]: *** [srcDynlib] Error 2 
>>> make[1]: *** [all] Error 2 make: *** [pkg-makecdfenv] Error 2
>>> 
>>>> version
>>> 
>>> _ platform       i386-pc-mingw32 arch           i386 os
>>> mingw32 system         i386, mingw32 status         alpha major
>>> 2 minor          4.0 year           2006 month          09 day
>>> 10 svn rev        39242 language       R version.string R version
>>> 2.4.0 alpha (2006-09-10 r39242)
>>> 
>>> TIA,
>>> 
>>> Jim
>>> 
>>> James W. MacDonald, M.S. Biostatistician Affymetrix and cDNA
>>> Microarray Core University of Michigan Cancer Center 1500 E.
>>> Medical Center Drive 7410 CCGC Ann Arbor MI 48109 734-647-5623
>>> 
>>> 
>>> ********************************************************** 
>>> Electronic Mail is not secure, may not be read every day, and
>>> should not be used for urgent or sensitive issues.
>>> 
>>> ______________________________________________ 
>>> R-devel at r-project.org mailing list 
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 
>> ______________________________________________ 
>> R-devel at r-project.org mailing list 
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
> 


-- 
James W. MacDonald, M.S.
Biostatistician
Affymetrix and cDNA Microarray Core
University of Michigan Cancer Center
1500 E. Medical Center Drive
7410 CCGC
Ann Arbor MI 48109
734-647-5623


**********************************************************
Electronic Mail is not secure, may not be read every day, and should not be used for urgent or sensitive issues.



From tlumley at u.washington.edu  Fri Sep 29 15:51:02 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Fri, 29 Sep 2006 06:51:02 -0700 (PDT)
Subject: [Rd] error location
In-Reply-To: <ed28ff68ff6.ff6ed28ff68@uni-bielefeld.de>
References: <ed28ff68ff6.ff6ed28ff68@uni-bielefeld.de>
Message-ID: <Pine.LNX.4.64.0609290644040.18499@homer22.u.washington.edu>

On Fri, 29 Sep 2006, Peter Stencel wrote:

> Dear all,
>
> I've written a (quite long) function in R. While running it I get the
> following error message:
>
> Error in "[<-"(`*tmp*`, 1, 13, value =
> NULL) :
>        number of items to replace is not a multiple of
> replacement length
>   operation failed in: function ()  !!!
>   evaluation not successful!!!
>
> How to interpret this error message? (There aren't any expressions that
> I'm using in my function.)
>
> How can I locate the error? Is it possible to do it with the command
> debug("functionname")?
>
> I'm new to R and I hope that someone can give me a piece of advice on
> finding errors. Thanks in advance.
>

The first step after you get an error is

   R>   traceback()


This will give a stack trace, ie, it will show the function where the 
error occurred, the function that called it, the function that called it, 
and so on all the way up.  At some point in the list there should be an 
expression that you recognize.

traceback() is often sufficient.  When it isn't, the post-mortem debugger, 
which you use by setting options(error=recover), may help.  After the 
error occurs this gives you the opportunity to run the debugger inside any 
of the functions that were executing. The debugger is basically an R 
prompt running inside the function, so you can do anything you could do in 
R. debug(f) starts the debugger whenever the function f() is called. This 
lets you get in before the error.

There is a section on debugging in the "Writing R Extensions" manual (in 
sufficiently recent versions of R).

 	-thomas



From h.wickham at gmail.com  Fri Sep 29 18:20:18 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 29 Sep 2006 11:20:18 -0500
Subject: [Rd] Warning: a final empty element has been omitted
Message-ID: <f8e6ff050609290920i69d88d0bseff9652efbdcb83d@mail.gmail.com>

How can I suppress this warning?

> options(warn = -10)
> list(1,2,3,)
Warning: a final empty element has been omitted
the part of the args list of 'list' being evaluated was:
   (1, 2, 3, )
[[1]]
[1] 1

[[2]]
[1] 2

[[3]]
[1] 3

> suppressWarnings(list(1,))
Warning: a final empty element has been omitted
the part of the args list of 'list' being evaluated was:
   (1, )
[[1]]
[1] 1


And can anyone add some insight as to why this warning was added?  It
was nice to be able to use a construction like:

a <- list(
 b = 3,
 c = 4,
)

so when you added a new line, you could just copy and paste an existing line.

Hadley



From h.wickham at gmail.com  Fri Sep 29 18:23:57 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 29 Sep 2006 11:23:57 -0500
Subject: [Rd] Warning: a final empty element has been omitted
In-Reply-To: <f8e6ff050609290920i69d88d0bseff9652efbdcb83d@mail.gmail.com>
References: <f8e6ff050609290920i69d88d0bseff9652efbdcb83d@mail.gmail.com>
Message-ID: <f8e6ff050609290923m526a74aele6c5ee942952fe44@mail.gmail.com>

Sorry I should have mentioned:

platform       i386-apple-darwin8.7.1
arch           i386
os             darwin8.7.1
system         i386, darwin8.7.1
status         beta
major          2
minor          4.0
year           2006
month          09
day            20
svn rev        39433
language       R
version.string R version 2.4.0 beta (2006-09-20 r39433)

On 9/29/06, hadley wickham <h.wickham at gmail.com> wrote:
> How can I suppress this warning?
>
> > options(warn = -10)
> > list(1,2,3,)
> Warning: a final empty element has been omitted
> the part of the args list of 'list' being evaluated was:
>    (1, 2, 3, )
> [[1]]
> [1] 1
>
> [[2]]
> [1] 2
>
> [[3]]
> [1] 3
>
> > suppressWarnings(list(1,))
> Warning: a final empty element has been omitted
> the part of the args list of 'list' being evaluated was:
>    (1, )
> [[1]]
> [1] 1
>
>
> And can anyone add some insight as to why this warning was added?  It
> was nice to be able to use a construction like:
>
> a <- list(
>  b = 3,
>  c = 4,
> )
>
> so when you added a new line, you could just copy and paste an existing line.
>
> Hadley
>



From ggrothendieck at gmail.com  Fri Sep 29 18:50:37 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 29 Sep 2006 12:50:37 -0400
Subject: [Rd] Warning: a final empty element has been omitted
In-Reply-To: <f8e6ff050609290920i69d88d0bseff9652efbdcb83d@mail.gmail.com>
References: <f8e6ff050609290920i69d88d0bseff9652efbdcb83d@mail.gmail.com>
Message-ID: <971536df0609290950v2c7c9e6h84bf44bb8e5dc5b7@mail.gmail.com>

Here is a kludge:

List <- function(...) {
	mc <- match.call()
	mc <- mc[as.list(mc) != ""]
	mc[[1]] <- as.name("list")
	eval(mc, parent.frame())
}

List(1,2,3,)


On 9/29/06, hadley wickham <h.wickham at gmail.com> wrote:
> How can I suppress this warning?
>
> > options(warn = -10)
> > list(1,2,3,)
> Warning: a final empty element has been omitted
> the part of the args list of 'list' being evaluated was:
>   (1, 2, 3, )
> [[1]]
> [1] 1
>
> [[2]]
> [1] 2
>
> [[3]]
> [1] 3
>
> > suppressWarnings(list(1,))
> Warning: a final empty element has been omitted
> the part of the args list of 'list' being evaluated was:
>   (1, )
> [[1]]
> [1] 1
>
>
> And can anyone add some insight as to why this warning was added?  It
> was nice to be able to use a construction like:
>
> a <- list(
>  b = 3,
>  c = 4,
> )
>
> so when you added a new line, you could just copy and paste an existing line.
>
> Hadley
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



From ggrothendieck at gmail.com  Fri Sep 29 19:00:52 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 29 Sep 2006 13:00:52 -0400
Subject: [Rd] Warning: a final empty element has been omitted
In-Reply-To: <971536df0609290950v2c7c9e6h84bf44bb8e5dc5b7@mail.gmail.com>
References: <f8e6ff050609290920i69d88d0bseff9652efbdcb83d@mail.gmail.com>
	<971536df0609290950v2c7c9e6h84bf44bb8e5dc5b7@mail.gmail.com>
Message-ID: <971536df0609291000g2aa6c3bev11305d0d174fe3ab@mail.gmail.com>

By the way, this seems to be a difference between 2.3.1pat and 2.4.0
since I get the warning using list on
 "R version 2.4.0 alpha (2006-09-16 r39365)"
but not on
 "Version 2.3.1 Patched (2006-06-04 r38279)"

On 9/29/06, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> Here is a kludge:
>
> List <- function(...) {
>        mc <- match.call()
>        mc <- mc[as.list(mc) != ""]
>        mc[[1]] <- as.name("list")
>        eval(mc, parent.frame())
> }
>
> List(1,2,3,)
>
>
> On 9/29/06, hadley wickham <h.wickham at gmail.com> wrote:
> > How can I suppress this warning?
> >
> > > options(warn = -10)
> > > list(1,2,3,)
> > Warning: a final empty element has been omitted
> > the part of the args list of 'list' being evaluated was:
> >   (1, 2, 3, )
> > [[1]]
> > [1] 1
> >
> > [[2]]
> > [1] 2
> >
> > [[3]]
> > [1] 3
> >
> > > suppressWarnings(list(1,))
> > Warning: a final empty element has been omitted
> > the part of the args list of 'list' being evaluated was:
> >   (1, )
> > [[1]]
> > [1] 1
> >
> >
> > And can anyone add some insight as to why this warning was added?  It
> > was nice to be able to use a construction like:
> >
> > a <- list(
> >  b = 3,
> >  c = 4,
> > )
> >
> > so when you added a new line, you could just copy and paste an existing line.
> >
> > Hadley
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>



From jeff.horner at vanderbilt.edu  Fri Sep 29 22:22:51 2006
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Fri, 29 Sep 2006 15:22:51 -0500
Subject: [Rd] Possible bug in Rcons_vprintf
Message-ID: <451D809B.3060906@vanderbilt.edu>



In R-2-4-branch r39548, Rcons_vprintf is called from stdout_vfprintf 
when R_Outputfile is NULL. When called and output is greater than 
R_BUFSIZE, output is truncated to R_BUFSIZE. Here's a one-line fix:

Index: src/main/printutils.c
===================================================================
--- src/main/printutils.c       (revision 39548)
+++ src/main/printutils.c       (working copy)
@@ -638,7 +638,7 @@
             res = R_BUFSIZE;
      }
  #endif /* HAVE_VA_COPY */
-    R_WriteConsole(p, strlen(buf));
+    R_WriteConsole(p, strlen(p));
  #ifdef HAVE_VA_COPY
      if(usedRalloc) vmaxset(vmax);
      if(usedVasprintf) free(p);


Jeff
-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner



From hpages at fhcrc.org  Sat Sep 30 03:06:41 2006
From: hpages at fhcrc.org (Herve Pages)
Date: Fri, 29 Sep 2006 18:06:41 -0700
Subject: [Rd] Strange behaviour of the [[ operator
Message-ID: <451DC321.2030704@fhcrc.org>

Hi,

This looks like a bug:

    > a <- list(b=5)
    > a[['b']]
    [1] 5
    > a[[t<-'b']]

Nothing gets printed!

I need to use parenthesis to see the expected result:

    > a[[(t<-'b')]]
    [1] 5


Cheers,
H.



From h.wickham at gmail.com  Sat Sep 30 07:15:32 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Sat, 30 Sep 2006 00:15:32 -0500
Subject: [Rd] Help for methods
In-Reply-To: <4510396E.6090501@r-project.org>
References: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com>
	<450FE1A3.8030808@cimr.cam.ac.uk>
	<f8e6ff050609190552v34d29e95m4c62b9f8c7f3841e@mail.gmail.com>
	<450FEB14.1080409@stats.uwo.ca>
	<f8e6ff050609190616h26cf45em427f3ecb8a30ca28@mail.gmail.com>
	<450FF864.20803@stats.uwo.ca> <4510396E.6090501@r-project.org>
Message-ID: <f8e6ff050609292215h3f6bff56j7ad3debb91bce702@mail.gmail.com>

>  I think the spirit of Hadley's request could be handled by introducing a
> declaration for S3 methods and by inserting S4-style alias{} lines into
> their documentation.  For example, if a function, say
> setOldGeneric("summary"),  similar to setOldClass, informed the system that
> "summary" was an S3 generic, then having an alias for "summary.lm-method" in
> the summary.lm.Rd file would allow a consistent set of documentation tools
> to work on those S3 methods and on S4 methods.

That seems like a really nice idea.  I'd imagine that a lot of the
setOldGeneric methods could be added automatically by looking for
functions of the form function(x, ...) UseMethod("...", x) - any that
were missed could then be added by hand.

Hadley



From h.wickham at gmail.com  Sat Sep 30 07:17:39 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Sat, 30 Sep 2006 00:17:39 -0500
Subject: [Rd] Help for methods
In-Reply-To: <450FF864.20803@stats.uwo.ca>
References: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com>
	<450FE1A3.8030808@cimr.cam.ac.uk>
	<f8e6ff050609190552v34d29e95m4c62b9f8c7f3841e@mail.gmail.com>
	<450FEB14.1080409@stats.uwo.ca>
	<f8e6ff050609190616h26cf45em427f3ecb8a30ca28@mail.gmail.com>
	<450FF864.20803@stats.uwo.ca>
Message-ID: <f8e6ff050609292217t2e038583pa7a70ef490a66e54@mail.gmail.com>

> Yes, I agree that the current help system doesn't work very well on S3
> methods.  But I don't know how to fix it.  I think the only way it could
> know what to do on a construction like
>
> ?summary(lm(...))
>
> would be to actually evaluate summary(lm(...)) (or maybe just lm(...)),
> and I think that would be a huge mistake in the user interface.  Some
> functions have side effects, and you don't want to evaluate them unless
> the user asks you to.  Asking for help on something should give you
> help, it shouldn't do the thing.

I keep flipping back and forth on whether or not that's a problem.  I
agree that it's not desirable, but may be an ok compromise in
principle.  How does the S4 help search work?

> Do you have an actual suggestion for a change to the current behaviour?

One obvious heuristic (which I used with the hints function I wrote a
while back) is to iterate through the classes of the first argument
looking for functions (with documentation) of the form generic.class1,
generic.class2 etc.

Obviously this will fail for functions that don't dispatch on the
first method, but there probably aren't that many.

Hadley



From murdoch at stats.uwo.ca  Sat Sep 30 14:54:06 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 30 Sep 2006 08:54:06 -0400
Subject: [Rd] Help for methods
In-Reply-To: <f8e6ff050609292217t2e038583pa7a70ef490a66e54@mail.gmail.com>
References: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com>	
	<450FE1A3.8030808@cimr.cam.ac.uk>	
	<f8e6ff050609190552v34d29e95m4c62b9f8c7f3841e@mail.gmail.com>	
	<450FEB14.1080409@stats.uwo.ca>	
	<f8e6ff050609190616h26cf45em427f3ecb8a30ca28@mail.gmail.com>	
	<450FF864.20803@stats.uwo.ca>
	<f8e6ff050609292217t2e038583pa7a70ef490a66e54@mail.gmail.com>
Message-ID: <451E68EE.8080201@stats.uwo.ca>

On 9/30/2006 1:17 AM, hadley wickham wrote:
>> Yes, I agree that the current help system doesn't work very well on S3
>> methods.  But I don't know how to fix it.  I think the only way it could
>> know what to do on a construction like
>>
>> ?summary(lm(...))
>>
>> would be to actually evaluate summary(lm(...)) (or maybe just lm(...)),
>> and I think that would be a huge mistake in the user interface.  Some
>> functions have side effects, and you don't want to evaluate them unless
>> the user asks you to.  Asking for help on something should give you
>> help, it shouldn't do the thing.
> 
> I keep flipping back and forth on whether or not that's a problem.  I
> agree that it's not desirable, but may be an ok compromise in
> principle.  How does the S4 help search work?

See the .helpForCall function in utils.  It would recognize that the 
function was an S4 generic, and then work out the signature and look for 
matching help.  I think working out the signature in the case above 
would require it to call lm(...).  So there's a precedent for what I 
called a "huge mistake":  maybe it's not so huge...

Duncan Murdoch




> 
>> Do you have an actual suggestion for a change to the current behaviour?
> 
> One obvious heuristic (which I used with the hints function I wrote a
> while back) is to iterate through the classes of the first argument
> looking for functions (with documentation) of the form generic.class1,
> generic.class2 etc.
> 
> Obviously this will fail for functions that don't dispatch on the
> first method, but there probably aren't that many.
> 
> Hadley



From murdoch at stats.uwo.ca  Sat Sep 30 15:09:12 2006
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Sat, 30 Sep 2006 15:09:12 +0200 (CEST)
Subject: [Rd] Strange behaviour of the [[ operator (PR#9263)
Message-ID: <20060930130912.AB4E920786@slim.kubism.ku.dk>

On 9/29/2006 9:06 PM, Herve Pages wrote:
> Hi,
> 
> This looks like a bug:
> 
>     > a <- list(b=5)
>     > a[['b']]
>     [1] 5
>     > a[[t<-'b']]
> 
> Nothing gets printed!
> 
> I need to use parenthesis to see the expected result:
> 
>     > a[[(t<-'b')]]
>     [1] 5

Yes, I agree it looks like a bug, and it's still there in R-devel.  The 
problem is that the assignment sets the R_Visible flag to false, and the 
indexing never sets it to true.  The same problem happens with a[t <- 
'b'], whether a is a list or not:

 > a <- c(b=5, c=6, d=7)
 > a[t <- 'b']
 > .Last.value
b
5

Duncan Murdoch



From p.c.j.kleiweg at rug.nl  Sat Sep 30 15:46:18 2006
From: p.c.j.kleiweg at rug.nl (p.c.j.kleiweg at rug.nl)
Date: Sat, 30 Sep 2006 15:46:18 +0200 (CEST)
Subject: [Rd] lowess: parameter 'delta' has no effect (PR#9264)
Message-ID: <20060930134618.972693F24C@slim.kubism.ku.dk>


In the help page of lowess, it says:

    delta: values of 'x' which lie within 'delta' of each other are
          replaced by a single value in the output from 'lowess'. 
          Defaults to 1/100th of the range of 'x'.

It doesn't. No matter what value I give for delta, the result always
has the same number of points as there are in the input.


--please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status = 
 major = 2
 minor = 3.1
 year = 2006
 month = 06
 day = 01
 svn rev = 38247
 language = R
 version.string = Version 2.3.1 (2006-06-01)

Locale:
LC_CTYPE=nl_NL at euro;LC_NUMERIC=C;LC_TIME=nl_NL at euro;LC_COLLATE=C;LC_MONETARY=nl_NL at euro;LC_MESSAGES=nl_NL at euro;LC_PAPER=C;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=C;LC_IDENTIFICATION=C

Search Path:
 .GlobalEnv, package:iL04, package:MASS, package:methods, package:stats, package:utils, package:datasets, package:graphics, package:grDevices, Autoloads, package:base



From maechler at stat.math.ethz.ch  Sat Sep 30 16:36:30 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 30 Sep 2006 16:36:30 +0200
Subject: [Rd] Possible bug in Rcons_vprintf
In-Reply-To: <451D809B.3060906@vanderbilt.edu>
References: <451D809B.3060906@vanderbilt.edu>
Message-ID: <17694.33006.587070.870361@stat.math.ethz.ch>

Thanks, Jeffrey,

that (change) looks very logical, reasonable, ...
and I'll commit a patch to R-devel ASAP.

On the other hand, I'm currently not intending to port the fix
to the currently "deep frozen" R-2.4-branch [because "you never know ..."]
unless you can argue a bit more why the change seems important 
(or at least can demonstrate bogous behavior that is fixed by it).

Martin

>>>>> "Jeffrey" == Jeffrey Horner <jeff.horner at vanderbilt.edu>
>>>>>     on Fri, 29 Sep 2006 15:22:51 -0500 writes:

    Jeffrey> In R-2-4-branch r39548, Rcons_vprintf is called from stdout_vfprintf 
    Jeffrey> when R_Outputfile is NULL. When called and output is greater than 
    Jeffrey> R_BUFSIZE, output is truncated to R_BUFSIZE. Here's a one-line fix:

    Jeffrey> Index: src/main/printutils.c
    Jeffrey> ===================================================================
    Jeffrey> --- src/main/printutils.c       (revision 39548)
    Jeffrey> +++ src/main/printutils.c       (working copy)
    Jeffrey> @@ -638,7 +638,7 @@
    Jeffrey> res = R_BUFSIZE;
    Jeffrey> }
    Jeffrey> #endif /* HAVE_VA_COPY */
    Jeffrey> -    R_WriteConsole(p, strlen(buf));
    Jeffrey> +    R_WriteConsole(p, strlen(p));
    Jeffrey> #ifdef HAVE_VA_COPY
    Jeffrey> if(usedRalloc) vmaxset(vmax);
    Jeffrey> if(usedVasprintf) free(p);


    Jeffrey> Jeff
    Jeffrey> -- 
    Jeffrey> http://biostat.mc.vanderbilt.edu/JeffreyHorner



From maechler at stat.math.ethz.ch  Sat Sep 30 16:39:04 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 30 Sep 2006 16:39:04 +0200
Subject: [Rd] Strange behaviour of the [[ operator
In-Reply-To: <451DC321.2030704@fhcrc.org>
References: <451DC321.2030704@fhcrc.org>
Message-ID: <17694.33160.489389.196778@stat.math.ethz.ch>

>>>>> "Herve" == Herve Pages <hpages at fhcrc.org>
>>>>>     on Fri, 29 Sep 2006 18:06:41 -0700 writes:

    Herve> Hi,
    Herve> This looks like a bug:
hmm, maybe...
or maybe not; I vaguely recall that this is documented somewhere...

    >> a <- list(b=5)
    >> a[['b']]
    Herve> [1] 5
    >> a[[t<-'b']]

    Herve> Nothing gets printed!

Yes, but that is not really much related to "[[" 
but rather to  "<-"  which momentarily turns off auto-printing.

Similar things happen in many similar circumstances.

    Herve> I need to use parenthesis to see the expected result:

    >> a[[(t<-'b')]]
    Herve> [1] 5

    Herve> Cheers,
    Herve> H.

Martin



From h.wickham at gmail.com  Sat Sep 30 17:13:36 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Sat, 30 Sep 2006 10:13:36 -0500
Subject: [Rd] Help for methods
In-Reply-To: <451E68EE.8080201@stats.uwo.ca>
References: <f8e6ff050609180824y1ca82a2cm3c3520ade980f7e8@mail.gmail.com>
	<450FE1A3.8030808@cimr.cam.ac.uk>
	<f8e6ff050609190552v34d29e95m4c62b9f8c7f3841e@mail.gmail.com>
	<450FEB14.1080409@stats.uwo.ca>
	<f8e6ff050609190616h26cf45em427f3ecb8a30ca28@mail.gmail.com>
	<450FF864.20803@stats.uwo.ca>
	<f8e6ff050609292217t2e038583pa7a70ef490a66e54@mail.gmail.com>
	<451E68EE.8080201@stats.uwo.ca>
Message-ID: <f8e6ff050609300813s5a6b5f38gf4d6de07bc57f0d4@mail.gmail.com>

> See the .helpForCall function in utils.  It would recognize that the
> function was an S4 generic, and then work out the signature and look for
> matching help.  I think working out the signature in the case above
> would require it to call lm(...).  So there's a precedent for what I
> called a "huge mistake":  maybe it's not so huge...

And I'd imagine, in practice, most people would be doing something like

x<- ...
?summary(x)

so that wouldn't have to do an extra computation.

Hadley



From hpages at fhcrc.org  Sat Sep 30 18:37:15 2006
From: hpages at fhcrc.org (hpages at fhcrc.org)
Date: Sat, 30 Sep 2006 09:37:15 -0700
Subject: [Rd] Strange behaviour of the [[ operator (PR#9263)
In-Reply-To: <20060930130912.AB4E920786@slim.kubism.ku.dk>
References: <20060930130912.AB4E920786@slim.kubism.ku.dk>
Message-ID: <1159634235.451e9d3ba140d@webmail.fhcrc.org>

Hi Duncan,

This is even more confusing with a matrix:

    > x <- matrix(5:-6, 3)
    > x
         [,1] [,2] [,3] [,4]
    [1,]    5    2   -1   -4
    [2,]    4    1   -2   -5
    [3,]    3    0   -3   -6
    > x[invisible(2),3]
    [1] -2
    > x[2,invisible(3)]
    > .Last.value
    [1] -2

Thanks,
H.


Quoting murdoch at stats.uwo.ca:

> On 9/29/2006 9:06 PM, Herve Pages wrote:
> > Hi,
> > 
> > This looks like a bug:
> > 
> >     > a <- list(b=5)
> >     > a[['b']]
> >     [1] 5
> >     > a[[t<-'b']]
> > 
> > Nothing gets printed!
> > 
> > I need to use parenthesis to see the expected result:
> > 
> >     > a[[(t<-'b')]]
> >     [1] 5
> 
> Yes, I agree it looks like a bug, and it's still there in R-devel.  The 
> problem is that the assignment sets the R_Visible flag to false, and the 
> indexing never sets it to true.  The same problem happens with a[t <- 
> 'b'], whether a is a list or not:
> 
>  > a <- c(b=5, c=6, d=7)
>  > a[t <- 'b']
>  > .Last.value
> b
> 5
> 
> Duncan Murdoch
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



From sfalcon at fhcrc.org  Sat Sep 30 18:38:31 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Sat, 30 Sep 2006 09:38:31 -0700
Subject: [Rd] Strange behaviour of the [[ operator
In-Reply-To: <17694.33160.489389.196778@stat.math.ethz.ch> (Martin Maechler's
	message of "Sat, 30 Sep 2006 16:39:04 +0200")
References: <451DC321.2030704@fhcrc.org>
	<17694.33160.489389.196778@stat.math.ethz.ch>
Message-ID: <m2irj5e2d4.fsf@ziti.local>

Martin Maechler <maechler at stat.math.ethz.ch> writes:
>     >> a <- list(b=5)
>     >> a[['b']]
>     Herve> [1] 5
>     >> a[[t<-'b']]
>
>     Herve> Nothing gets printed!
>
> Yes, but that is not really much related to "[[" 
> but rather to  "<-"  which momentarily turns off auto-printing.

Yes, not being related to "[[" is exactly why it is surprising.

I would expect vv[[f(x)]] to print regardless of f's auto-printing
behavior.

f1 <- function(x) x
f2 <- function(x) return(invisible(x))
a <- list(b=5)
a[[f1("a")]]
a[[f2("a")]]

> Similar things happen in many similar circumstances.

Here's a similar thing:

> v <- 1:5
> v
[1] 1 2 3 4 5
> v[mustBeDocumentedSomewhere=3]
[1] 3

And this can be confusing if one thinks that subsetting is really a
function and behaves like other R functions w.r.t. to treatment of
named arguments:

> m <- matrix(1:4, nrow=2)
> m
     [,1] [,2]
[1,]    1    3
[2,]    2    4
> m[j=2]
[1] 2



From p.dalgaard at biostat.ku.dk  Sat Sep 30 19:00:50 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 30 Sep 2006 19:00:50 +0200
Subject: [Rd] Strange behaviour of the [[ operator
In-Reply-To: <m2irj5e2d4.fsf@ziti.local>
References: <451DC321.2030704@fhcrc.org>
	<17694.33160.489389.196778@stat.math.ethz.ch>
	<m2irj5e2d4.fsf@ziti.local>
Message-ID: <x2odsxz3ul.fsf@turmalin.kubism.ku.dk>

Seth Falcon <sfalcon at fhcrc.org> writes:

> > Similar things happen in many similar circumstances.
> 
> Here's a similar thing:

Not really, no?
 
> > v <- 1:5
> > v
> [1] 1 2 3 4 5
> > v[mustBeDocumentedSomewhere=3]
> [1] 3
> 
> And this can be confusing if one thinks that subsetting is really a
> function and behaves like other R functions w.r.t. to treatment of
> named arguments:
> 
> > m <- matrix(1:4, nrow=2)
> > m
>      [,1] [,2]
> [1,]    1    3
> [2,]    2    4
> > m[j=2]
> [1] 2

Or even
> m[j=2,i=]
[1] 2 4

However, what would the argument names be in the >2-dim case? i, j are
used only in help("[") and that page is quite specific about
explaining that named matching doesn't work. 

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907



From rgentlem at fhcrc.org  Sat Sep 30 20:10:11 2006
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Sat, 30 Sep 2006 11:10:11 -0700
Subject: [Rd] Strange behaviour of the [[ operator
In-Reply-To: <x2odsxz3ul.fsf@turmalin.kubism.ku.dk>
References: <451DC321.2030704@fhcrc.org>	<17694.33160.489389.196778@stat.math.ethz.ch>	<m2irj5e2d4.fsf@ziti.local>
	<x2odsxz3ul.fsf@turmalin.kubism.ku.dk>
Message-ID: <451EB303.2090003@fhcrc.org>

True, re name matching, but I think we might want to consider a warning 
if they are supplied as the user may not be getting what they expect, 
regardless of the documentation....


Peter Dalgaard wrote:
> Seth Falcon <sfalcon at fhcrc.org> writes:
> 
>>> Similar things happen in many similar circumstances.
>> Here's a similar thing:
> 
> Not really, no?
>  
>>> v <- 1:5
>>> v
>> [1] 1 2 3 4 5
>>> v[mustBeDocumentedSomewhere=3]
>> [1] 3
>>
>> And this can be confusing if one thinks that subsetting is really a
>> function and behaves like other R functions w.r.t. to treatment of
>> named arguments:
>>
>>> m <- matrix(1:4, nrow=2)
>>> m
>>      [,1] [,2]
>> [1,]    1    3
>> [2,]    2    4
>>> m[j=2]
>> [1] 2
> 
> Or even
>> m[j=2,i=]
> [1] 2 4
> 
> However, what would the argument names be in the >2-dim case? i, j are
> used only in help("[") and that page is quite specific about
> explaining that named matching doesn't work. 
> 

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org



From murdoch at stats.uwo.ca  Sat Sep 30 21:16:10 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 30 Sep 2006 15:16:10 -0400
Subject: [Rd] Strange behaviour of the [[ operator
In-Reply-To: <17694.33160.489389.196778@stat.math.ethz.ch>
References: <451DC321.2030704@fhcrc.org>
	<17694.33160.489389.196778@stat.math.ethz.ch>
Message-ID: <451EC27A.1060800@stats.uwo.ca>

On 9/30/2006 10:39 AM, Martin Maechler wrote:
>>>>>> "Herve" == Herve Pages <hpages at fhcrc.org>
>>>>>>     on Fri, 29 Sep 2006 18:06:41 -0700 writes:
> 
>     Herve> Hi,
>     Herve> This looks like a bug:
> hmm, maybe...
> or maybe not; I vaguely recall that this is documented somewhere...
> 
>     >> a <- list(b=5)
>     >> a[['b']]
>     Herve> [1] 5
>     >> a[[t<-'b']]
> 
>     Herve> Nothing gets printed!
> 
> Yes, but that is not really much related to "[[" 
> but rather to  "<-"  which momentarily turns off auto-printing.

I think this is probably not intentional, because the behaviour is so 
inconsistent.  In names.c, the "eval" entry for "[" and "[[" is 0, which 
is supposed to indicate R_Visible is on.  It's the same as for c(), 
substitute(), quote(), interactive(), expression(), nargs(), and those 
return a visible result.

On the other hand, dim(), dimnames(), as.character(), call(), rep(), 
seq.int(), seq_along() also have eval=0, and they give an invisible result.

Among the eval=10 functions, I see visible results from unlist(), 
cbind(), rbind(), and invisible ones from sys.parent(), sys.call() etc., 
  parent.frame(), and so on (I gave up testing at this point).

I suspect the problem is that these are low level functions where the 
evaluator does almost nothing automatically, and handling R_Visible was 
just overlooked.

Duncan Murdoch



> 
> Similar things happen in many similar circumstances.
> 
>     Herve> I need to use parenthesis to see the expected result:
> 
>     >> a[[(t<-'b')]]
>     Herve> [1] 5
> 
>     Herve> Cheers,
>     Herve> H.
> 
> Martin
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



From rmh at temple.edu  Sat Sep 30 22:30:29 2006
From: rmh at temple.edu (Richard M. Heiberger)
Date: Sat, 30 Sep 2006 16:30:29 -0400 (EDT)
Subject: [Rd] newly introduced lattice bug
Message-ID: <20060930163029.BJD98568@po-d.temple.edu>

> library(lattice)
> xyplot(rnorm(10) ~ rnorm(10) | factor(1:10), layout=c(2,3))
> version
               _                                     
platform       i386-pc-mingw32                       
arch           i386                                  
os             mingw32                               
system         i386, mingw32                         
status         RC                                    
major          2                                     
minor          4.0                                   
year           2006                                  
month          09                                    
day            27                                    
svn rev        39543                                 
language       R                                     
version.string R version 2.4.0 RC (2006-09-27 r39543)
> 


This was downloaded two minutes ago from the CRAN page
http://cran.us.r-project.org/bin/windows/base/rtest.html
dated
Last build: 2006-09-29, by Duncan Murdoch


The bug is that 2.4.0 RC displays 12 panels, with the incorrect top two panels
on the second page being copies of the correct top two panels on the first page.

I just noticed this in R version 2.4.0 beta (2006-09-20 r39421)
and immediately got a newer version of R before reporting it.

R-2.3.1 displays the correct 10 panels.

Rich



